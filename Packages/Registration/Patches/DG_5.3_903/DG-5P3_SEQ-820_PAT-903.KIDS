Released DG*5.3*903 SEQ #820
Extracted from mail message
**KIDS**:DG*5.3*903^

**INSTALL NAME**
DG*5.3*903
"BLD",9835,0)
DG*5.3*903^REGISTRATION^0^3170306^y
"BLD",9835,1,0)
^^27^27^3160722^^
"BLD",9835,1,1,0)
Increase Engagement in My HealtheVet (IEMHV)
"BLD",9835,1,2,0)
 
"BLD",9835,1,3,0)
This patch contains enhancements to Pre-Registration functionality in the
"BLD",9835,1,4,0)
Preregister a Patient [DGPRE PRE-REGISTER] option in the VistA
"BLD",9835,1,5,0)
Registration V.5.3 package to increase patient engagement in My 
"BLD",9835,1,6,0)
HealtheVet.
"BLD",9835,1,7,0)
 
"BLD",9835,1,8,0)
My HealtheVet Enrollment Alert/Reminder
"BLD",9835,1,9,0)
---------------------------------------
"BLD",9835,1,10,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9835,1,11,0)
to display a message alerting the clerk that the selected patient 
"BLD",9835,1,12,0)
has neither completed My HealtheVet registration, nor documented their 
"BLD",9835,1,13,0)
desire to be excluded from My HealtheVet registration. Recent assistance 
"BLD",9835,1,14,0)
provided by Pre-Registration clerks with the patient's My HealtheVet
"BLD",9835,1,15,0)
enrollment is displayed within the alert/reminder.
"BLD",9835,1,16,0)
 
"BLD",9835,1,17,0)
Socialization Questions and Responses
"BLD",9835,1,18,0)
-------------------------------------
"BLD",9835,1,19,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9835,1,20,0)
to capture a patient's My HealtheVet registration status during the 
"BLD",9835,1,21,0)
pre-registration process.
"BLD",9835,1,22,0)
 
"BLD",9835,1,23,0)
My HealtheVet Registration Actions
"BLD",9835,1,24,0)
--------------------------------
"BLD",9835,1,25,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9835,1,26,0)
to capture actions Pre-Registration clerks performed to assist with a
"BLD",9835,1,27,0)
patient's My HealtheVet registration.
"BLD",9835,4,0)
^9.64PA^2^6
"BLD",9835,4,2,0)
2
"BLD",9835,4,2,2,0)
^9.641^2.0537041^4
"BLD",9835,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",9835,4,2,2,2,1,0)
^9.6411^537037^12
"BLD",9835,4,2,2,2,1,537027,0)
MHV REGISTERED
"BLD",9835,4,2,2,2,1,537028,0)
MHV AUTHENTICATED
"BLD",9835,4,2,2,2,1,537029,0)
MHV SECURE MESSAGING
"BLD",9835,4,2,2,2,1,537030,0)
MHVREG UPDATE DATE/TIME
"BLD",9835,4,2,2,2,1,537031,0)
MHVAUTH UPDATE DATE/TIME
"BLD",9835,4,2,2,2,1,537032,0)
MHVSM UPDATE DATE/TIME
"BLD",9835,4,2,2,2,1,537033,0)
MHV REGISTER DECLINED TEXT
"BLD",9835,4,2,2,2,1,537034,0)
MHV AUTH DECLINED TEXT
"BLD",9835,4,2,2,2,1,537035,0)
MHV MSG DECLINED TEXT
"BLD",9835,4,2,2,2,1,537036,0)
MHV REGISTER DECLINED REASON
"BLD",9835,4,2,2,2,1,537037,0)
MHV AUTH DECLINED REASON
"BLD",9835,4,2,2,2,1,537038,0)
MHV MSG DECLINED REASON
"BLD",9835,4,2,2,2.0537026,0)
MHV SOCIALIZATION  (sub-file)
"BLD",9835,4,2,2,2.0537026,1,0)
^9.6411^^
"BLD",9835,4,2,2,2.0537041,0)
MHV MSG ACTIONS  (sub-file)
"BLD",9835,4,2,2,2.0537041,1,0)
^9.6411^^
"BLD",9835,4,2,2,2.0537042,0)
MHV AUTH ACTIONS  (sub-file)
"BLD",9835,4,2,2,2.0537042,1,0)
^9.6411^^
"BLD",9835,4,2,222)
y^n^p^^^^n^^n
"BLD",9835,4,2,224)

"BLD",9835,4,43,0)
43
"BLD",9835,4,43,2,0)
^9.641^43^1
"BLD",9835,4,43,2,43,0)
MAS PARAMETERS  (File-top level)
"BLD",9835,4,43,2,43,1,0)
^9.6411^1100.07^1
"BLD",9835,4,43,2,43,1,1100.07,0)
Enable MyHealtheVet Prompts?
"BLD",9835,4,43,222)
y^n^p^^^^n^^n
"BLD",9835,4,43,224)

"BLD",9835,4,390.01,0)
390.01
"BLD",9835,4,390.01,222)
y^n^f^^n^^y^o^n
"BLD",9835,4,390.01,224)

"BLD",9835,4,390.02,0)
390.02
"BLD",9835,4,390.02,222)
y^n^f^^n^^y^o^n
"BLD",9835,4,390.03,0)
390.03
"BLD",9835,4,390.03,222)
y^n^f^^n^^y^o^n
"BLD",9835,4,390.04,0)
390.04
"BLD",9835,4,390.04,222)
y^n^f^^n^^y^o^n
"BLD",9835,4,"APDD",2,2)

"BLD",9835,4,"APDD",2,2,537027)

"BLD",9835,4,"APDD",2,2,537028)

"BLD",9835,4,"APDD",2,2,537029)

"BLD",9835,4,"APDD",2,2,537030)

"BLD",9835,4,"APDD",2,2,537031)

"BLD",9835,4,"APDD",2,2,537032)

"BLD",9835,4,"APDD",2,2,537033)

"BLD",9835,4,"APDD",2,2,537034)

"BLD",9835,4,"APDD",2,2,537035)

"BLD",9835,4,"APDD",2,2,537036)

"BLD",9835,4,"APDD",2,2,537037)

"BLD",9835,4,"APDD",2,2,537038)

"BLD",9835,4,"APDD",2,2.0537026)

"BLD",9835,4,"APDD",2,2.0537041)

"BLD",9835,4,"APDD",2,2.0537042)

"BLD",9835,4,"APDD",43,43)

"BLD",9835,4,"APDD",43,43,1100.07)

"BLD",9835,4,"B",2,2)

"BLD",9835,4,"B",43,43)

"BLD",9835,4,"B",390.01,390.01)

"BLD",9835,4,"B",390.02,390.02)

"BLD",9835,4,"B",390.03,390.03)

"BLD",9835,4,"B",390.04,390.04)

"BLD",9835,6)
6^
"BLD",9835,6.3)
82
"BLD",9835,"ABPKG")
n
"BLD",9835,"INID")
^y
"BLD",9835,"INIT")
POST^DG903PST
"BLD",9835,"KRN",0)
^9.67PA^779.2^20
"BLD",9835,"KRN",.4,0)
.4
"BLD",9835,"KRN",.401,0)
.401
"BLD",9835,"KRN",.402,0)
.402
"BLD",9835,"KRN",.403,0)
.403
"BLD",9835,"KRN",.5,0)
.5
"BLD",9835,"KRN",.84,0)
.84
"BLD",9835,"KRN",3.6,0)
3.6
"BLD",9835,"KRN",3.8,0)
3.8
"BLD",9835,"KRN",9.2,0)
9.2
"BLD",9835,"KRN",9.8,0)
9.8
"BLD",9835,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",9835,"KRN",9.8,"NM",1,0)
DGMHV^^0^B120677809
"BLD",9835,"KRN",9.8,"NM",2,0)
DGPREP1^^0^B42976792
"BLD",9835,"KRN",9.8,"NM",3,0)
DGMHVAC^^0^B148795601
"BLD",9835,"KRN",9.8,"NM",4,0)
DGMHVUTL^^0^B136790239
"BLD",9835,"KRN",9.8,"NM",5,0)
DGRPC^^0^B33766541
"BLD",9835,"KRN",9.8,"NM",6,0)
DGRPC3^^0^B57456736
"BLD",9835,"KRN",9.8,"NM",7,0)
DG903PST^^0^B5160023
"BLD",9835,"KRN",9.8,"NM",8,0)
DGRPCE1^^0^B67438790
"BLD",9835,"KRN",9.8,"NM",9,0)
DGPAR^^0^B25879398
"BLD",9835,"KRN",9.8,"NM",10,0)
DGPAR1^^0^B23270657
"BLD",9835,"KRN",9.8,"NM","B","DG903PST",7)

"BLD",9835,"KRN",9.8,"NM","B","DGMHV",1)

"BLD",9835,"KRN",9.8,"NM","B","DGMHVAC",3)

"BLD",9835,"KRN",9.8,"NM","B","DGMHVUTL",4)

"BLD",9835,"KRN",9.8,"NM","B","DGPAR",9)

"BLD",9835,"KRN",9.8,"NM","B","DGPAR1",10)

"BLD",9835,"KRN",9.8,"NM","B","DGPREP1",2)

"BLD",9835,"KRN",9.8,"NM","B","DGRPC",5)

"BLD",9835,"KRN",9.8,"NM","B","DGRPC3",6)

"BLD",9835,"KRN",9.8,"NM","B","DGRPCE1",8)

"BLD",9835,"KRN",19,0)
19
"BLD",9835,"KRN",19.1,0)
19.1
"BLD",9835,"KRN",101,0)
101
"BLD",9835,"KRN",409.61,0)
409.61
"BLD",9835,"KRN",771,0)
771
"BLD",9835,"KRN",779.2,0)
779.2
"BLD",9835,"KRN",870,0)
870
"BLD",9835,"KRN",8989.51,0)
8989.51
"BLD",9835,"KRN",8989.52,0)
8989.52
"BLD",9835,"KRN",8994,0)
8994
"BLD",9835,"KRN","B",.4,.4)

"BLD",9835,"KRN","B",.401,.401)

"BLD",9835,"KRN","B",.402,.402)

"BLD",9835,"KRN","B",.403,.403)

"BLD",9835,"KRN","B",.5,.5)

"BLD",9835,"KRN","B",.84,.84)

"BLD",9835,"KRN","B",3.6,3.6)

"BLD",9835,"KRN","B",3.8,3.8)

"BLD",9835,"KRN","B",9.2,9.2)

"BLD",9835,"KRN","B",9.8,9.8)

"BLD",9835,"KRN","B",19,19)

"BLD",9835,"KRN","B",19.1,19.1)

"BLD",9835,"KRN","B",101,101)

"BLD",9835,"KRN","B",409.61,409.61)

"BLD",9835,"KRN","B",771,771)

"BLD",9835,"KRN","B",779.2,779.2)

"BLD",9835,"KRN","B",870,870)

"BLD",9835,"KRN","B",8989.51,8989.51)

"BLD",9835,"KRN","B",8989.52,8989.52)

"BLD",9835,"KRN","B",8994,8994)

"BLD",9835,"QUES",0)
^9.62^^
"BLD",9835,"REQB",0)
^9.611^2^2
"BLD",9835,"REQB",1,0)
DG*5.3*867^2
"BLD",9835,"REQB",2,0)
DG*5.3*855^2
"BLD",9835,"REQB","B","DG*5.3*855",2)

"BLD",9835,"REQB","B","DG*5.3*867",1)

"DATA",390.01,1,0)
Yes - I have already registered on My HealtheVet
"DATA",390.01,1,1)
1
"DATA",390.01,1,2,0)
^^4^4^3160721^
"DATA",390.01,1,2,1,0)
We are strongly encouraging patients to register online for a My
"DATA",390.01,1,2,2,0)
HealtheVet account. With My HealtheVet, you can refill VA prescriptions,
"DATA",390.01,1,2,3,0)
view lab results and medical records, and use Secure Messaging with your
"DATA",390.01,1,2,4,0)
health care team.
"DATA",390.01,1,3)
Yes - I have already registered on My HealtheVet.
"DATA",390.01,2,0)
Yes - I would like to register on My HealtheVet
"DATA",390.01,2,1)
2
"DATA",390.01,2,2,0)
^^4^4^3160721^
"DATA",390.01,2,2,1,0)
We are strongly encouraging patients to register online for a My
"DATA",390.01,2,2,2,0)
HealtheVet account. With My HealtheVet, you can refill VA prescriptions,
"DATA",390.01,2,2,3,0)
view lab results and medical records, and use Secure Messaging with your
"DATA",390.01,2,2,4,0)
health care team.
"DATA",390.01,2,3)
Yes - I would like to register on My HealtheVet.
"DATA",390.01,2,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,3,0)
Yes - But I do not want to register right now
"DATA",390.01,3,1)
3
"DATA",390.01,3,2,0)
^^11^11^3160721^
"DATA",390.01,3,2,1,0)
We are strongly encouraging patients to register online for a My 
"DATA",390.01,3,2,2,0)
HealtheVet account. With My HealtheVet, you can refill VA prescriptions,
"DATA",390.01,3,2,3,0)
view lab results and medical records, and use Secure Messaging with your
"DATA",390.01,3,2,4,0)
health care team.
"DATA",390.01,3,2,5,0)
  
"DATA",390.01,3,2,6,0)
I will give you some easy-to-follow instructions so that you can register
"DATA",390.01,3,2,7,0)
at home. Once registered you will need to return to your VA medical center
"DATA",390.01,3,2,8,0)
or clinic and sign the My HealtheVet authentication form, VA Release of
"DATA",390.01,3,2,9,0)
Information (ROI) form (10-5345a-MHV). A government issued photo ID is 
"DATA",390.01,3,2,10,0)
required. (Instructions for optional online Authentication process are
"DATA",390.01,3,2,11,0)
also available)
"DATA",390.01,3,3)
Yes - But I do not want to register right now.
"DATA",390.01,3,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,4,0)
No - No one has spoken to me/I don't know about MyHealtheVet
"DATA",390.01,4,1)
4
"DATA",390.01,4,2,0)
^^10^10^3160721^
"DATA",390.01,4,2,1,0)
We are strongly encouraging patients to register online for a My
"DATA",390.01,4,2,2,0)
HealtheVet account. With My HealtheVet, you can refill VA prescriptions,
"DATA",390.01,4,2,3,0)
view lab results and medical records, and use Secure Messaging with your
"DATA",390.01,4,2,4,0)
health care team.
"DATA",390.01,4,2,5,0)
  
"DATA",390.01,4,2,6,0)
I will give you some easy-to-follow instructions so that you can register
"DATA",390.01,4,2,7,0)
at home. Once registered you will need to return to a VA clinic and sign a
"DATA",390.01,4,2,8,0)
My HealtheVet authentication form, VA Release of Information (ROI) form
"DATA",390.01,4,2,9,0)
(10-5345a-MHV). A government issued photo ID is required. (Instructions 
"DATA",390.01,4,2,10,0)
for optional online Authentication process are also available)
"DATA",390.01,4,3)
No - No one has spoken to me/I do not know what My HealtheVet is.
"DATA",390.01,4,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,5,0)
No - I am not interested in registering on My HealtheVet
"DATA",390.01,5,1)
5
"DATA",390.01,5,2,0)
^390.12^4^4^3160721^^^
"DATA",390.01,5,2,1,0)
We are strongly encouraging patients to register online for a My 
"DATA",390.01,5,2,2,0)
HealtheVet account. With My HealtheVet, you can refill VA prescriptions,
"DATA",390.01,5,2,3,0)
view lab results and medical records, and use Secure Messaging with your
"DATA",390.01,5,2,4,0)
health care team.
"DATA",390.01,5,3)
No - I am not interested in registering on My HealtheVet
"DATA",390.01,5,4)
D NOFLW^DGMHV($G(DGSOCCOD))
"DATA",390.01,6,0)
No - I don't have computer / mobile device / internet access
"DATA",390.01,6,1)
6
"DATA",390.01,6,2,0)
^390.12^6^6^3160721^^^^
"DATA",390.01,6,2,1,0)
Do family or friends, who have a computer/mobile device/ Internet access, 
"DATA",390.01,6,2,2,0)
ever help with your VA appointments or medications?  You can also log on
"DATA",390.01,6,2,3,0)
to any public library computer to use My HealtheVet. Imagine that you are
"DATA",390.01,6,2,4,0)
out of town and you need a copy of your health records or medications -
"DATA",390.01,6,2,5,0)
with a My HealtheVet account,  you can access that information from any
"DATA",390.01,6,2,6,0)
computer/mobile device as long as there is Internet access.
"DATA",390.01,6,3)
No - I do not have computer / mobile device / internet access.
"DATA",390.01,6,4)
D NOFLW^DGMHV($G(DGSOCCOD))
"DATA",390.02,1,0)
Observed/assisted patient to register for a My HealtheVet account.
"DATA",390.02,1,1,0)
^390.21P^2^2
"DATA",390.02,1,1,1,0)
1
"DATA",390.02,1,1,2,0)
2
"DATA",390.02,1,3,0)
^^1^1^3160721^
"DATA",390.02,1,3,1,0)
Observed/assisted patient to register for a My HealtheVet account.
"DATA",390.02,2,0)
Referred patient to the My HealtheVet office/station for assistance with registration.
"DATA",390.02,2,1,0)
^390.21P^2^2
"DATA",390.02,2,1,1,0)
1
"DATA",390.02,2,1,2,0)
2
"DATA",390.02,2,3,0)
^390.23^2^2^3160721^^^^
"DATA",390.02,2,3,1,0)
Referred patient to the My HealtheVet office/station for assistance with
"DATA",390.02,2,3,2,0)
registration.
"DATA",390.02,3,0)
Scheduled future appointment for patient to register at My HealtheVet office/station.
"DATA",390.02,3,1,0)
^390.21P^2^2
"DATA",390.02,3,1,1,0)
1
"DATA",390.02,3,1,2,0)
2
"DATA",390.02,3,3,0)
^^2^2^3160719^
"DATA",390.02,3,3,1,0)
Scheduled future appointment for patient to register at My HealtheVet
"DATA",390.02,3,3,2,0)
office/station.
"DATA",390.02,4,0)
Provided patient with My HealtheVet registration information
"DATA",390.02,4,1,0)
^390.21P^2^2
"DATA",390.02,4,1,1,0)
1
"DATA",390.02,4,1,2,0)
2
"DATA",390.02,4,3,0)
^390.23^1^1^3160719^^
"DATA",390.02,4,3,1,0)
Provided patient with My HealtheVet registration information.
"DATA",390.02,5,0)
Referred patient to My HealtheVet Coordinator for assistance.
"DATA",390.02,5,1,0)
^390.21P^4^1
"DATA",390.02,5,1,4,0)
4
"DATA",390.02,5,3,0)
^390.23^1^1^3160721^^^
"DATA",390.02,5,3,1,0)
Referred patient to My HealtheVet Coordinator for assistance.
"DATA",390.02,6,0)
Patient signed My HealtheVet authentication form, VA Release of Information (ROI) form (10-5345a-MHV).
"DATA",390.02,6,1,0)
^390.21P^5^1
"DATA",390.02,6,1,5,0)
3
"DATA",390.02,6,3,0)
^390.23^2^2^3160722^^^
"DATA",390.02,6,3,1,0)
Patient signed My HealtheVet authentication form, VA Release of 
"DATA",390.02,6,3,2,0)
Information (ROI) form (10-5345a-MHV).
"DATA",390.02,7,0)
Patient could not authenticate. Advised to do so at next appt.
"DATA",390.02,7,1,0)
^390.21P^3^1
"DATA",390.02,7,1,3,0)
3
"DATA",390.02,7,3,0)
^390.23^1^1^3160719^^
"DATA",390.02,7,3,1,0)
Patient could not authenticate. Advised to do so at next appointment.
"DATA",390.02,8,0)
Clerk could not authenticate. Referred to My HealtheVet Coordinator.
"DATA",390.02,8,1,0)
^390.21P^3^1
"DATA",390.02,8,1,3,0)
3
"DATA",390.02,8,3,0)
^^3^3^3160721^
"DATA",390.02,8,3,1,0)
Clerk did not have authentication form. Referred to My HealtheVet 
"DATA",390.02,8,3,2,0)
Coordinator or advised to download from the My HealtheVet website, 
"DATA",390.02,8,3,3,0)
https://www.myhealth.domain.ext/ .
"DATA",390.02,9,0)
My HealtheVet admin portal issue prevented patient authentication. Referred to MHV Help Desk or MHV coordinator.
"DATA",390.02,9,1,0)
^390.21P^3^1
"DATA",390.02,9,1,3,0)
3
"DATA",390.02,9,3,0)
^^3^3^3160722^
"DATA",390.02,9,3,1,0)
My HealtheVet Administrative portal issue prevented patient
"DATA",390.02,9,3,2,0)
authentication. Referred My HealtheVet Coordinator or to My HealtheVet
"DATA",390.02,9,3,3,0)
Help Desk toll free #1-877-327-0022, Mon-Fri, 8 a.m. - 8 p.m. EST.
"DATA",390.02,10,0)
Caregiver not present and Veteran needs caregiver to sign form.
"DATA",390.02,10,1,0)
^390.21P^3^1
"DATA",390.02,10,1,3,0)
3
"DATA",390.02,10,3,0)
^390.23^4^4^3160719^^
"DATA",390.02,10,3,1,0)
Caregiver not present and Veteran needs caregiver to sign form.
"DATA",390.02,10,3,2,0)
Veteran advised to have caregiver present if s/he is the patient's legal
"DATA",390.02,10,3,3,0)
durable Power of Attorney and/or Legal Guardian. Consult with Privacy
"DATA",390.02,10,3,4,0)
and/or HIM Chief for guidance.
"DATA",390.02,11,0)
Veteran did not have a government issued photo ID to authenticate. Advised patient to bring to bring to next appt.
"DATA",390.02,11,1,0)
^390.21P^3^1
"DATA",390.02,11,1,3,0)
3
"DATA",390.02,11,3,0)
^390.23^2^2^3160719^^^
"DATA",390.02,11,3,1,0)
Veteran did not have a government issued photo ID to authenticate. Advised
"DATA",390.02,11,3,2,0)
patient to bring ID to next appointment.
"DATA",390.02,12,0)
Provided patient with Secure Messaging instructions.
"DATA",390.02,12,1,0)
^390.21P^4^1
"DATA",390.02,12,1,4,0)
4
"DATA",390.02,12,3,0)
^390.23^1^1^3160719^^
"DATA",390.02,12,3,1,0)
Provided patient with Secure Messaging instructions.
"DATA",390.02,13,0)
Patient had a MHV account issue. Provided MHV Help Desk toll free # 1-877-327-0022, Mon-Fri, 8 a.m.-8 p.m. (EST)
"DATA",390.02,13,1,0)
^390.21P^4^4
"DATA",390.02,13,1,1,0)
1
"DATA",390.02,13,1,2,0)
2
"DATA",390.02,13,1,3,0)
3
"DATA",390.02,13,1,4,0)
4
"DATA",390.02,13,3,0)
^390.23^3^3^3170306^^
"DATA",390.02,13,3,1,0)
Patient had a My HealtheVet account issue. Provided name/contact
"DATA",390.02,13,3,2,0)
information of local My HealtheVet Coordinator and/or My HealtheVet Help
"DATA",390.02,13,3,3,0)
Desk toll free # 1-877-327-0022, Mon-Fri, 8 a.m. - 8 p.m. (EST).
"DATA",390.02,14,0)
Helped patient set up their secure messaging account.
"DATA",390.02,14,1,0)
^390.21P^1^1
"DATA",390.02,14,1,1,0)
4
"DATA",390.02,14,3,0)
^390.23^1^1^3160726^^
"DATA",390.02,14,3,1,0)
Helped patient set up their secure messaging account.
"DATA",390.03,1,0)
No one has spoken to me/I don't know what My HealtheVet is.^1
"DATA",390.03,2,0)
I do not know what a Premium My HealtheVet account is.^2
"DATA",390.03,3,0)
I am not interested.^123
"DATA",390.03,4,0)
I do not have access to the internet.^123
"DATA",390.03,5,0)
I do not have a computer/mobile device.^123
"DATA",390.03,6,0)
I do not trust the internet.^123
"DATA",390.03,7,0)
I do not see the benefit.^123
"DATA",390.03,8,0)
I would not use it often enough.^123
"DATA",390.03,9,0)
My caregiver makes these decisions for me.^123
"DATA",390.03,10,0)
Other^123
"DATA",390.04,1,0)
S^ACTIONS SELECTABLE AT MHV SOCIALIZATION
"DATA",390.04,2,0)
R^ACTIONS SELECTABLE AT MHV REGISTRATION PROMPT
"DATA",390.04,3,0)
A^ACTIONS SELECTABLE AT MHV AUTHENTICATION PROMPT
"DATA",390.04,4,0)
M^ACTIONS SELECTABLE AT MHV SECURE MESSAGING PROMPT
"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^n^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,537026)

"FIA",2,2,537027)

"FIA",2,2,537028)

"FIA",2,2,537029)

"FIA",2,2,537030)

"FIA",2,2,537031)

"FIA",2,2,537032)

"FIA",2,2,537033)

"FIA",2,2,537034)

"FIA",2,2,537035)

"FIA",2,2,537036)

"FIA",2,2,537037)

"FIA",2,2,537038)

"FIA",2,2,537041)

"FIA",2,2,537042)

"FIA",2,2.0537026)
0
"FIA",2,2.0537041)
0
"FIA",2,2.0537042)
0
"FIA",2,2.5370262)
0
"FIA",43)
MAS PARAMETERS
"FIA",43,0)
^DG(43,
"FIA",43,0,0)
43
"FIA",43,0,1)
y^n^p^^^^n^^n
"FIA",43,0,10)

"FIA",43,0,11)

"FIA",43,0,"RLRO")

"FIA",43,0,"VR")
5.3^DG
"FIA",43,43)
1
"FIA",43,43,1100.07)

"FIA",390.01)
MHV SOCIALIZATION
"FIA",390.01,0)
^DGMHV(390.01,
"FIA",390.01,0,0)
390.01
"FIA",390.01,0,1)
y^n^f^^n^^y^o^n
"FIA",390.01,0,10)

"FIA",390.01,0,11)

"FIA",390.01,0,"RLRO")

"FIA",390.01,0,"VR")
5.3^DG
"FIA",390.01,390.01)
0
"FIA",390.01,390.12)
0
"FIA",390.02)
MHV SOCIALIZATION ACTIONS
"FIA",390.02,0)
^DGMHV(390.02,
"FIA",390.02,0,0)
390.02
"FIA",390.02,0,1)
y^n^f^^n^^y^o^n
"FIA",390.02,0,10)

"FIA",390.02,0,11)

"FIA",390.02,0,"RLRO")

"FIA",390.02,0,"VR")
5.3^DG
"FIA",390.02,390.02)
0
"FIA",390.02,390.21)
0
"FIA",390.02,390.23)
0
"FIA",390.03)
MHV DECLINED REASONS
"FIA",390.03,0)
^DGMHV(390.03,
"FIA",390.03,0,0)
390.03
"FIA",390.03,0,1)
y^n^f^^n^^y^o^n
"FIA",390.03,0,10)

"FIA",390.03,0,11)

"FIA",390.03,0,"RLRO")

"FIA",390.03,0,"VR")
5.3^DG
"FIA",390.03,390.03)
0
"FIA",390.04)
MHV ACTION SELECTION
"FIA",390.04,0)
^DGMHV(390.04,
"FIA",390.04,0,0)
390.04S
"FIA",390.04,0,1)
y^n^f^^n^^y^o^n
"FIA",390.04,0,10)

"FIA",390.04,0,11)

"FIA",390.04,0,"RLRO")

"FIA",390.04,0,"VR")
5.3^DG
"FIA",390.04,390.04)
0
"INIT")
POST^DG903PST
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
903^3170306^11959
"PKG",114,22,1,"PAH",1,1,0)
^^27^27^3170306
"PKG",114,22,1,"PAH",1,1,1,0)
Increase Engagement in My HealtheVet (IEMHV)
"PKG",114,22,1,"PAH",1,1,2,0)
 
"PKG",114,22,1,"PAH",1,1,3,0)
This patch contains enhancements to Pre-Registration functionality in the
"PKG",114,22,1,"PAH",1,1,4,0)
Preregister a Patient [DGPRE PRE-REGISTER] option in the VistA
"PKG",114,22,1,"PAH",1,1,5,0)
Registration V.5.3 package to increase patient engagement in My 
"PKG",114,22,1,"PAH",1,1,6,0)
HealtheVet.
"PKG",114,22,1,"PAH",1,1,7,0)
 
"PKG",114,22,1,"PAH",1,1,8,0)
My HealtheVet Enrollment Alert/Reminder
"PKG",114,22,1,"PAH",1,1,9,0)
---------------------------------------
"PKG",114,22,1,"PAH",1,1,10,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,11,0)
to display a message alerting the clerk that the selected patient 
"PKG",114,22,1,"PAH",1,1,12,0)
has neither completed My HealtheVet registration, nor documented their 
"PKG",114,22,1,"PAH",1,1,13,0)
desire to be excluded from My HealtheVet registration. Recent assistance 
"PKG",114,22,1,"PAH",1,1,14,0)
provided by Pre-Registration clerks with the patient's My HealtheVet
"PKG",114,22,1,"PAH",1,1,15,0)
enrollment is displayed within the alert/reminder.
"PKG",114,22,1,"PAH",1,1,16,0)
 
"PKG",114,22,1,"PAH",1,1,17,0)
Socialization Questions and Responses
"PKG",114,22,1,"PAH",1,1,18,0)
-------------------------------------
"PKG",114,22,1,"PAH",1,1,19,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,20,0)
to capture a patient's My HealtheVet registration status during the 
"PKG",114,22,1,"PAH",1,1,21,0)
pre-registration process.
"PKG",114,22,1,"PAH",1,1,22,0)
 
"PKG",114,22,1,"PAH",1,1,23,0)
My HealtheVet Registration Actions
"PKG",114,22,1,"PAH",1,1,24,0)
--------------------------------
"PKG",114,22,1,"PAH",1,1,25,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,26,0)
to capture actions Pre-Registration clerks performed to assist with a
"PKG",114,22,1,"PAH",1,1,27,0)
patient's My HealtheVet registration.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","DG903PST")
0^7^B5160023^n/a
"RTN","DG903PST",1,0)
DG903PST ;ALB/JCH - DG*5.3*903 POST INSTALL ; 11/10/14 9:51am
"RTN","DG903PST",2,0)
 ;;5.3;Registration;**903**;Aug 13, 1993;Build 82
"RTN","DG903PST",3,0)
 ;
"RTN","DG903PST",4,0)
 ; Submitted to OSEHRA 04/02/2015 by HP
"RTN","DG903PST",5,0)
 ; PCHK entry points authored by James Harris 2014-2015
"RTN","DG903PST",6,0)
 ;
"RTN","DG903PST",7,0)
 Q
"RTN","DG903PST",8,0)
POST  ; Add entry 315 in INCONSISTENT DATA ELEMENTS file (#38.6)
"RTN","DG903PST",9,0)
 ; and Enable MyHeatheVet in the MAS PARAMETERS (#43) File.
"RTN","DG903PST",10,0)
 ;
"RTN","DG903PST",11,0)
 D PCHK
"RTN","DG903PST",12,0)
 ; Enable MyHealtheVet Prompts? (#1100.07) field in the the MAS PARAMETERS (#43) File
"RTN","DG903PST",13,0)
 ; is set to "NO" which disables the "Increase Engagement in My HealtheVet" Pre-Register
"RTN","DG903PST",14,0)
 ; Patient Interface.
"RTN","DG903PST",15,0)
 N DIE,DR,DA
"RTN","DG903PST",16,0)
 S DIE="^DG(43,",DA=1,DR="1100.07///0" D ^DIE
"RTN","DG903PST",17,0)
 Q
"RTN","DG903PST",18,0)
 ;
"RTN","DG903PST",19,0)
PCHK  ; File new INCONSISTENT DATA ELEMENTS (#38.6) file entry for missing MHV Registration status
"RTN","DG903PST",20,0)
 N DIE,X,Y,DR,DA,DIC,DGFILE,DGIENS,DGFIELD,DGWROOT,DGMROOT,DGMSG,DGTXT
"RTN","DG903PST",21,0)
 Q:$D(^DGIN(38.6,315))  ; Rule #315 already exists. Can't overwrite different rule, but rule #'s are hard coded in DGRPC*
"RTN","DG903PST",22,0)
 S DIE="^DGIN(38.6,",DA=315,DR=".01////MHV REGISTRATION STATUS ABSENT;2////MY HEALTHEVET REGISTRATION STATUS ABSENT/MISSING;3////0;4////0;5////1" D ^DIE
"RTN","DG903PST",23,0)
 N DIE,X,Y,DR,DA,DIC
"RTN","DG903PST",24,0)
 S DGFILE="38.6",DGIENS="315,",DGFIELD=50,DGWROOT="DGTXT",DGMROOT="DGMSG",DGMSG=""
"RTN","DG903PST",25,0)
 S DGTXT(1)="This check ensures a patient has been asked about their registration, or "
"RTN","DG903PST",26,0)
 S DGTXT(2)="interest in registration, in My HealtheVet.  It will only be checked if the "
"RTN","DG903PST",27,0)
 S DGTXT(3)="'Enable MyHealtheVet Prompts?' (#1100.07) field in the MAS PARAMETERS (#43)"
"RTN","DG903PST",28,0)
 S DGTXT(4)="file is set to 'YES'."
"RTN","DG903PST",29,0)
 D WP^DIE(DGFILE,DGIENS,DGFIELD,,DGWROOT,DGMROOT)
"RTN","DG903PST",30,0)
 Q 
"RTN","DG903PST",31,0)
 ;
"RTN","DGMHV")
0^1^B120677809^n/a
"RTN","DGMHV",1,0)
DGMHV ;ALB/JCH - Display Pre-Registration MHV Enrollment/Registration ; 12/9/03 3:22pm
"RTN","DGMHV",2,0)
 ;;5.3;Registration;**903**;Aug 13, 1993;Build 82
"RTN","DGMHV",3,0)
 ;
"RTN","DGMHV",4,0)
 ; Submitted to OSEHRA 04/02/2015 by HP
"RTN","DGMHV",5,0)
 ; All entry points authored by James Harris 2014-2015
"RTN","DGMHV",6,0)
 ;
"RTN","DGMHV",7,0)
 Q
"RTN","DGMHV",8,0)
EN(DFN) ; Entry Point for Alert, Socialization, and MHV Enrollment/Registration field editing 'Screen'
"RTN","DGMHV",9,0)
 ;This functionality will only be executed if "Enable MyHealtheVet Prompts?" (#1100.07  
"RTN","DGMHV",10,0)
 ;field in MAS PARAMETERS (43) file is set to YES (internal value 1)
"RTN","DGMHV",11,0)
 D:$$MHVENABL^DGMHVUTL() MAIN^DGMHV(DFN)
"RTN","DGMHV",12,0)
 Q
"RTN","DGMHV",13,0)
MAIN(DFN) ; Main Entry Point for MHV socialization text/action
"RTN","DGMHV",14,0)
 ; Do not display MHV enrollment/registration 'screen' if socialization Action entered 
"RTN","DGMHV",15,0)
 ; (DGMHVOUT="A"), meaning MHV enrollment/registration is in progress, not a firm YES or NO
"RTN","DGMHV",16,0)
 ; Do not display socialization text/action if MHV ENROLLED/REGISTERED field is not null (DGMHVOUT="R")
"RTN","DGMHV",17,0)
 N DGMHVNOS,DGRSPNS,DGENTRY,DGACTS,DGMHAC,DGMHSEL,DGDPTSOC,DGMHVOUT,DGMHVNOS,DIR
"RTN","DGMHV",18,0)
 D CLEAR,ALERT,DSPLACT(DFN) I $G(DGMHVOUT)="" W !!! D CONT
"RTN","DGMHV",19,0)
 D CLEAR
"RTN","DGMHV",20,0)
 I $G(DGMHVOUT)="R" D EN^DGMHVAC(DFN) Q
"RTN","DGMHV",21,0)
 I $G(DGMHVOUT)="A" D  Q
"RTN","DGMHV",22,0)
 .N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,"S")
"RTN","DGMHV",23,0)
 .Q:$G(DGMHVOUT)!$G(DGMHVNOS)
"RTN","DGMHV",24,0)
 .D EN^DGMHVAC(DFN)
"RTN","DGMHV",25,0)
 D SOCIAL^DGMHV Q:$G(DGMHVOUT)
"RTN","DGMHV",26,0)
 Q:$G(DGMHVNOS)
"RTN","DGMHV",27,0)
 D EN^DGMHVAC(DFN)
"RTN","DGMHV",28,0)
 Q
"RTN","DGMHV",29,0)
SOCIAL ; MHV Enrollment/Registration talking point/socialization text action
"RTN","DGMHV",30,0)
 ; Display MHV socialization canned text, prompt for patient response, display and prompt for clerk action
"RTN","DGMHV",31,0)
 I $P($G(^DPT(DFN,2)),"^") Q
"RTN","DGMHV",32,0)
 N DGSODONE
"RTN","DGMHV",33,0)
 F  Q:$G(DGSODONE)!$G(DGMHVOUT)  D SLOOP
"RTN","DGMHV",34,0)
 Q
"RTN","DGMHV",35,0)
SLOOP ; Allow user to go back and enter a different patient response in case the patient changes their mind
"RTN","DGMHV",36,0)
 N DGMHV,I,DGDIR0,DGDPTSOC,DGTAB,DGREADTX,DGMHVMOD S DGDPTSOC="",DGMHVMOD="S"
"RTN","DGMHV",37,0)
 K DIRUT
"RTN","DGMHV",38,0)
 S DGREADTX="Please read the following to the patient"
"RTN","DGMHV",39,0)
 D GTSOCODS(.DGDIR0) S DGDIR0="SO^",I="" F  S I=$O(DGDIR0(I)) Q:'I  S DGDIR0=DGDIR0_I_":"_DGDIR0(I)_";"
"RTN","DGMHV",40,0)
 F  Q:$G(DGMHVOUT)!$G(DGMHV("SOCIAL"))  D
"RTN","DGMHV",41,0)
 .D CLEAR W !!,DGREADTX
"RTN","DGMHV",42,0)
 .K DIR W !!?8,"""Has a health care team member encouraged you"
"RTN","DGMHV",43,0)
 .W !?9,"to register online for My HealtheVet?"""
"RTN","DGMHV",44,0)
 .S DIR("A")="Patient response"
"RTN","DGMHV",45,0)
 .S DIR(0)=DGDIR0
"RTN","DGMHV",46,0)
 .S DIR("??")="D CLEAR" D ^DIR I $E($G(Y))="^" S DGMHVOUT=1 Q
"RTN","DGMHV",47,0)
 .I Y="" W !!,"My HealtheVet registration information is required to continue with this patient",!! D CONT Q
"RTN","DGMHV",48,0)
 .S DGMHV("SOCIAL")=$G(DGDIR0(Y,"IEN"))
"RTN","DGMHV",49,0)
 Q:$G(DGMHVOUT)
"RTN","DGMHV",50,0)
 D FILSOC(DFN,+DGMHV("SOCIAL"),$$NOW^XLFDT,.DGDPTSOC)
"RTN","DGMHV",51,0)
 I DGMHV("SOCIAL")=1 D
"RTN","DGMHV",52,0)
 .N DGOLDEN S DGOLDEN=$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHV",53,0)
 .N DIE,DR,DA S DIE="^DPT(",DR="537027////1;537030////"_$$NOW^XLFDT,DA=DFN D ^DIE
"RTN","DGMHV",54,0)
 .Q:DGOLDEN=1
"RTN","DGMHV",55,0)
 .N DGFLD F DGFLD=537033,537036 D FILRNA^DGMHVAC(DFN,DGFLD,"@")
"RTN","DGMHV",56,0)
 .N MHVND S MHVND=$G(^DPT(+DFN,2))
"RTN","DGMHV",57,0)
 .I $P(MHVND,"^",2)=0 F DGFLD=537028,537031,537034,537037 D FILRNA^DGMHVAC(DFN,DGFLD,"@")
"RTN","DGMHV",58,0)
 .I $P(MHVND,"^",3)=0 F DGFLD=537029,537032,537035,537038 D FILRNA^DGMHVAC(DFN,DGFLD,"@")
"RTN","DGMHV",59,0)
 Q:'$G(DGMHV("SOCIAL"))  D CLEAR W !!,DGREADTX W !! D CANNED(DGMHV("SOCIAL")) D CONT I (DGMHV("SOCIAL")>1) I $G(DIRUT)&($G(X)="^") S DGSODONE=0 Q
"RTN","DGMHV",60,0)
 N FLWUP,RTST S DGAR1=DGDPTSOC S FLWUP=$G(^DGMHV(390.01,DGMHV("SOCIAL"),4)) S RTST=$P(FLWUP,"^",2),RTST=$P(RTST,"(") I RTST]"" I $T(@RTST)]"" X FLWUP
"RTN","DGMHV",61,0)
 S DGSODONE=1
"RTN","DGMHV",62,0)
 Q
"RTN","DGMHV",63,0)
ALERT ; Displays the 'MHV Enrollment/Registration Information Missing' message
"RTN","DGMHV",64,0)
 Q:'$D(XQY0)
"RTN","DGMHV",65,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT
"RTN","DGMHV",66,0)
 S X="IORVON;IORVOFF"
"RTN","DGMHV",67,0)
 D ENDR^%ZISS
"RTN","DGMHV",68,0)
 W !!!!?4,$CHAR(7) W:$D(IORVON) IORVON W "** PATIENT NEEDS TO ANSWER MY HEALTHEVET REGISTRATION QUESTIONS **" W:$D(IORVOFF) IORVOFF
"RTN","DGMHV",69,0)
 W !?4,"Patient is missing required My HealtheVet Registration information",!
"RTN","DGMHV",70,0)
 Q
"RTN","DGMHV",71,0)
FILSOC(DFN,RSPNT,RSPDT,DGDPTSOC) ; File MHV Socialization Information to PATIENT (#2) file
"RTN","DGMHV",72,0)
 ;    DFN = PATIENT IEN
"RTN","DGMHV",73,0)
 ;  RSPNT = RESPONSE POINTER TO FILE 390.01
"RTN","DGMHV",74,0)
 ;  RPSDT = RESPONSE DATE/TIME
"RTN","DGMHV",75,0)
 N DINUM,DIE,DA,DR,DO,DGMHVND K DIE,DA,DR,DO
"RTN","DGMHV",76,0)
 S DIC(0)="EZ",DIC="^DPT(DFN,1,",DA(2)=DFN,DA(1)=+$O(^DPT(DFN,1,"A"),-1)+1,DGDPTSOC=DA(1)
"RTN","DGMHV",77,0)
 S DGMHVND=DA(1),DINUM=DA(1),X=RSPDT,DIC("DR")=".01////"_RSPDT_";1////"_RSPNT D FILE^DICN
"RTN","DGMHV",78,0)
 K DIE,DIC,DA S DIE="^DPT(DFN,1,",DA(1)=DFN,DA=DGMHVND
"RTN","DGMHV",79,0)
 S DR=".01////"_RSPDT_";1////"_RSPNT D ^DIE
"RTN","DGMHV",80,0)
 Q
"RTN","DGMHV",81,0)
CANNED(SCRIPT) ; Display canned text from PATIENT TEXT (#2) field in the MHV SOCIALIZATION (#390.01) file
"RTN","DGMHV",82,0)
 Q:'$G(SCRIPT)
"RTN","DGMHV",83,0)
 N DGMHVLIN,DGLINCNT,DGMHVOUT S DGMHVLIN=$P($G(^DGMHV(390.01,SCRIPT,2,0)),"^",3),DGMHVOUT=0
"RTN","DGMHV",84,0)
 S DGLINCNT=0 F  S DGLINCNT=$O(^DGMHV(390.01,SCRIPT,2,DGLINCNT)) Q:'DGLINCNT!(DGLINCNT>DGMHVLIN)  D
"RTN","DGMHV",85,0)
 .W !?2 W:DGLINCNT=1 """" W ^DGMHV(390.01,SCRIPT,2,DGLINCNT,0) S DGMHVOUT=1
"RTN","DGMHV",86,0)
 W:$G(DGMHVOUT) """" W !
"RTN","DGMHV",87,0)
 Q
"RTN","DGMHV",88,0)
GTSOCODS(DGSOCCOD) ; Get array of socialization codes and display sequences from MHV SOCIALIZATION (#390.01) file
"RTN","DGMHV",89,0)
 K DGSOCCOD,DGSOCIEN,DGSOCSEQ S DGSOCSEQ="",DGSOCCOD="",DGSOCIEN="" N I,TEXT S I=0,TEXT=""
"RTN","DGMHV",90,0)
 F  S DGSOCSEQ=$O(^DGMHV(390.01,"C",DGSOCSEQ)) Q:'DGSOCSEQ  D
"RTN","DGMHV",91,0)
 .S DGSOCIEN="" F  S DGSOCIEN=$O(^DGMHV(390.01,"C",DGSOCSEQ,DGSOCIEN)) Q:DGSOCIEN=""  D
"RTN","DGMHV",92,0)
 ..N TEXT D FIND^DIC(390.01,"","@;.01","A",DGSOCIEN,1,"","","","TEXT")
"RTN","DGMHV",93,0)
 ..S I=I+1 S DGSOCCOD(I)=TEXT("DILIST","ID",1,".01"),DGSOCCOD(I,"IEN")=DGSOCIEN
"RTN","DGMHV",94,0)
 Q
"RTN","DGMHV",95,0)
NOFLW(DGSOCCOD) ; Perform followup dialog for patient that does not wish to enroll/register
"RTN","DGMHV",96,0)
 N DIR,DIC,DA,DGAR1,DGAR2 S DGAR1="",DGAR2=""
"RTN","DGMHV",97,0)
 W !! S DIR("A",1)="   How does the patient feel now about registering in My HealtheVet?"
"RTN","DGMHV",98,0)
 S DIR("A",2)=" ",DIR("A",3)="          1) Patient is not interested."
"RTN","DGMHV",99,0)
 S DIR("A",4)="          2) Patient is interested.",DIR("A",5)=" "
"RTN","DGMHV",100,0)
 S DIR(0)="SA^1:Patient is not interested;2:Patient is interested",DIR("A")="Select a response: "
"RTN","DGMHV",101,0)
 D ^DIR I $G(Y)'="1"  D ACTIONS(.DGAR1,DGAR2,$G(DGDPTSOC),"S") Q
"RTN","DGMHV",102,0)
 ; If patient isn't interested to be enrolled/register in MHV then update Enroll/Register,
"RTN","DGMHV",103,0)
 ; Authenticated, and Secure Message fields to "NO"
"RTN","DGMHV",104,0)
 N DIE,DR,DA,DGMHVNOW S DA=DFN,DGMHVNOW=$$NOW^XLFDT
"RTN","DGMHV",105,0)
 S DIE="^DPT(",DR="537027////0;537030////"_DGMHVNOW_";537028////0;537029////0;537031////"_DGMHVNOW_";537032////"_DGMHVNOW
"RTN","DGMHV",106,0)
 D ^DIE
"RTN","DGMHV",107,0)
 F DGRPFLD=537036:1:537038 D FILRNA^DGMHVAC(DFN,DGRPFLD,+$O(^DGMHV(390.03,"B","I am not interested.","")))
"RTN","DGMHV",108,0)
 Q
"RTN","DGMHV",109,0)
ACTIONS(DGMSACT,ACTSEL,DGENRQ,DGMHVMOD) ; Display MHV Socialization actions, allow selection, return selected actions in ACTSEL
"RTN","DGMHV",110,0)
 ; Input:
"RTN","DGMHV",111,0)
 ;   DGMSACT  - Array of selectable actions from MHV SOCIALIZATION ACTIONS (#390.02) file
"RTN","DGMHV",112,0)
 ;   ACTSEL   - Array of action(s) currently selected by clerk
"RTN","DGMHV",113,0)
 ;   DGENRQ   - Internal Entry Number (IEN) of the prospective MHV SOCIALIZATION (#537026) multiple in the PATIENT (#2) file into which
"RTN","DGMHV",114,0)
 ;              the selected actions in ACTSEL will be stored.
"RTN","DGMHV",115,0)
 ;   DGMHVMOD - Mode; the section of MHV functionality from which this is invoked. Used to screen selectable actions.
"RTN","DGMHV",116,0)
 ;                    "R" - Enrollment/Registration "S" - Socialization, "A" - Authentication field, "M" - Secure Messaging field
"RTN","DGMHV",117,0)
 K DIR,DGMSACT D CLEAR
"RTN","DGMHV",118,0)
 N DINUM,DIR,ACTCNT,DGACDONE,DGSTAY,DGACSAVE,DGACCNT S DGACDONE=0,DGACSAVE=0
"RTN","DGMHV",119,0)
 D GETACTS(.DGMSACT,$G(DGMHVMOD)) S DGACCNT=+$O(DGMSACT(""),-1)
"RTN","DGMHV",120,0)
 S DIR(0)="SA^" S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=DIR(0)_ACTCNT_":"_DGMSACT(ACTCNT)_";"
"RTN","DGMHV",121,0)
 S $P(DIR(0),"^",3)="D ACTRNSFM^DGMHV"
"RTN","DGMHV",122,0)
 F  Q:$G(DGACDONE)  D ACTLOOP(.DIR,.DGMSACT,.ACTSEL)
"RTN","DGMHV",123,0)
 I $G(DGACSAVE),$D(ACTSEL)>1 D  S DGMHVNOS=1 Q
"RTN","DGMHV",124,0)
 .I $G(DGENRQ),'$G(DGDPTSOC) S DGDPTSOC=DGENRQ
"RTN","DGMHV",125,0)
 .N DGSEL,DGAIEN,DGMHVND,DGPLURAL S DGSEL=0 F DGPLURAL=1:1 S DGSEL=$O(ACTSEL(DGSEL)) Q:'DGSEL  D
"RTN","DGMHV",126,0)
 ..N DIE,DA,DIC S DGAIEN=$G(ACTSEL(DGSEL,"IEN")),DIC(0)="EZ",DIC="^DPT("_DFN_",1,"_DGDPTSOC_",1,",DA(3)=DFN,DA(2)=DGDPTSOC
"RTN","DGMHV",127,0)
 ..S DA(1)=$O(^DPT(DFN,1,DA(2),1,"A"),-1)+1,DINUM=DA(1),X=DGAIEN,DGMHVND=DA(1),DIC("DR")=".01////"_DGAIEN D FILE^DICN I $G(DGENRQ) D
"RTN","DGMHV",128,0)
 ...N DA,DIE,DIC,RSPDT S RSPDT=$$NOW^XLFDT S DIE="^DPT(DFN,1,",DA(1)=DFN,DA=DGENRQ S DR=".01////"_RSPDT D ^DIE
"RTN","DGMHV",129,0)
 ..N DA,DIE,DIC K DIE,DIC,DA S DIE="^DPT("_DFN_",1,"_DGDPTSOC_",1,",DA(2)=DFN,DA(1)=DGDPTSOC,DA=$O(^DPT(DFN,1,DGDPTSOC,1,"A"),-1)
"RTN","DGMHV",130,0)
 ..S DR=".01////"_DGAIEN D ^DIE
"RTN","DGMHV",131,0)
 .W !,$S($G(DGPLURAL)=1:"Action",1:"Actions")," Filed...",! H .5
"RTN","DGMHV",132,0)
 S DGMHVOUT=1
"RTN","DGMHV",133,0)
 Q
"RTN","DGMHV",134,0)
ACTLOOP(DIR,DGMSACT,ACTSEL) ; Redisplay and reprompt user for action(s) until they're filed, or user aborts
"RTN","DGMHV",135,0)
 D CLEAR
"RTN","DGMHV",136,0)
 S DGSTAY=1
"RTN","DGMHV",137,0)
 W !?2,"Action(s) taken today to assist patient with My HealtheVet registration."
"RTN","DGMHV",138,0)
 W !?2,"-----------------------------------------------------------------------"
"RTN","DGMHV",139,0)
 D ^DIR
"RTN","DGMHV",140,0)
 I Y="^"!$G(DIRUT) W !! N DGREALQ S DGREALQ=1 D  Q
"RTN","DGMHV",141,0)
 .N DIR,Y S DIR(0)="Y",DIR("A",1)="My HealtheVet registration questions are required to continue with this patient."
"RTN","DGMHV",142,0)
 .S DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y) S DGMHVOUT=1,DGACDONE=1,DGACSAVE=0,DGSTAY=0 Q
"RTN","DGMHV",143,0)
 .S DGSTAY=1
"RTN","DGMHV",144,0)
 I $G(Y)>0 N DGSELL F DGSELL=1:1:$L(Y,",") N DGSELIT S DGSELIT=$P(Y,",",DGSELL) I DGSELIT]"" M ACTSEL(DGSELIT)=DGMSACT(DGSELIT)
"RTN","DGMHV",145,0)
 F  Q:'$G(DGSTAY)  D
"RTN","DGMHV",146,0)
 .D CLEAR N DIR,SELAC,DGCNT,DGII S DGCNT=1,DGSTAY=0
"RTN","DGMHV",147,0)
 .S DIR("A",DGCNT)="",DGCNT=DGCNT+1
"RTN","DGMHV",148,0)
 .S DIR("A",DGCNT)="Actions Selected:"
"RTN","DGMHV",149,0)
 .S DGCNT=DGCNT+1,DIR("A",DGCNT)=" " ;"-----------------------------------------------------------------------"
"RTN","DGMHV",150,0)
 .S SELAC="" F DGII=1:1 S SELAC=$O(ACTSEL(SELAC)) Q:'SELAC  D
"RTN","DGMHV",151,0)
 ..N SELACSUB,MARX S SELACSUB=0 D TXT(ACTSEL(SELAC),65) F  S SELACSUB=$O(MARX(SELACSUB)) Q:'SELACSUB  D
"RTN","DGMHV",152,0)
 ...S DGCNT=DGCNT+1 S DIR("A",DGCNT)=" "_$S(SELACSUB=1:SELAC_" - ",1:"    ")_" "_MARX(SELACSUB)
"RTN","DGMHV",153,0)
 .S DGCNT=DGCNT+1 S DIR("A",DGCNT)=""
"RTN","DGMHV",154,0)
 .S DIR("A")="  (A)dd another, (D)elete an action, or <RET> to save and exit: ",DIR(0)="SAO^A:Add an Action;D:Delete an Action" D ^DIR W !
"RTN","DGMHV",155,0)
 .Q:Y="A"
"RTN","DGMHV",156,0)
 .I Y="D" S DGSTAY=1 D DELETE(.ACTSEL) Q
"RTN","DGMHV",157,0)
 .I Y="^" W !! N DGREALQ S DGREALQ=1 D  Q
"RTN","DGMHV",158,0)
 ..N DIR,Y S DIR(0)="Y",DIR("A",1)="My HealtheVet registration information is required to continue with this patient."
"RTN","DGMHV",159,0)
 ..S DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y) S DGMHVOUT=1,DGACDONE=1,DGACSAVE=0,DGSTAY=0 Q
"RTN","DGMHV",160,0)
 ..S DGSTAY=1
"RTN","DGMHV",161,0)
 .S DGACDONE=1,DGACSAVE=1
"RTN","DGMHV",162,0)
 Q
"RTN","DGMHV",163,0)
GETACTS(DGMSACT,DGMHVMOD) ; Get actions from the MHV SOCIALIZATION ACTIONS (#390.02) file; screen by mode (DGMHVMOD)
"RTN","DGMHV",164,0)
 ; Input: DGMHVMOD - Mode; MHV functionality from which this is invoked. Used to screen selectable Actions.
"RTN","DGMHV",165,0)
 ; DGMSACT - Array containing appropriate MHV actions, after screening based on mode (DGMHVMOD).
"RTN","DGMHV",166,0)
 N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGMHVSAT S ACTCNT=0,SELCNT=0
"RTN","DGMHV",167,0)
 S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.02,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGMHV(390.02,ACTIEN,3,1,0)),"^") I ACTTXT]"" D
"RTN","DGMHV",168,0)
 .N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_" "_^DGMHV(390.02,ACTIEN,3,TXTND,0)
"RTN","DGMHV",169,0)
 .N ACTLLIST D ACTSCRN^DGMHVUTL(ACTIEN,.ACTLLIST) I ($G(DGMHVMOD)]"") Q:'$D(ACTLLIST(DGMHVMOD))
"RTN","DGMHV",170,0)
 .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,"IEN")=ACTIEN
"RTN","DGMHV",171,0)
 .N MARX,ACTLINE D TXT(ACTTXT,65) S ACTLINE=0 F  S ACTLINE=$O(MARX(ACTLINE)) Q:'ACTLINE  D
"RTN","DGMHV",172,0)
 ..N DGDASH S DGDASH=$S(ACTLINE=1&(ACTCNT<10):ACTCNT_" -  ",(ACTLINE=1&(ACTCNT>9)):ACTCNT_" - ",1:"     ")
"RTN","DGMHV",173,0)
 ..S DIR("A",SELCNT)="  "_DGDASH_" "_MARX(ACTLINE) S SELCNT=SELCNT+1
"RTN","DGMHV",174,0)
  S DIR("A",SELCNT+1)=" "
"RTN","DGMHV",175,0)
 S DIR("A")=" Select an action or '^' to exit: "
"RTN","DGMHV",176,0)
 Q
"RTN","DGMHV",177,0)
DELETE(DGACTD) ; Delete one previously selected action
"RTN","DGMHV",178,0)
 ; Input : DGACTD - Array of MHV actions selected by clerk.
"RTN","DGMHV",179,0)
 K DGDELDIR,DIR N DGDELAR,II,DGCNT,ZZ S DGCNT=0
"RTN","DGMHV",180,0)
 M DGDELAR=DGACTD
"RTN","DGMHV",181,0)
 ;
"RTN","DGMHV",182,0)
 K DGACTD M DGACTD=DGDELAR
"RTN","DGMHV",183,0)
 S DIR(0)="SAO^" S ZZ=0 F II=1:1 S ZZ=$O(DGDELAR(ZZ)) Q:'ZZ  S DIR(0)=DIR(0)_ZZ_":"_DGDELAR(ZZ)_";"
"RTN","DGMHV",184,0)
 S DIR("A")="Select an action to delete: " D ^DIR I $G(Y)>0,$D(DGACTD(+Y)) K DGACTD(Y)
"RTN","DGMHV",185,0)
 W ! D CONT I '$D(DGACTD) S DGSTAY=0 D CLEAR
"RTN","DGMHV",186,0)
 Q
"RTN","DGMHV",187,0)
REVERSE(PAD,DGREVTXT) ; Display DGREVTXT in reverse video
"RTN","DGMHV",188,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT
"RTN","DGMHV",189,0)
 S X="IORVON;IORVOFF" S PAD=+$G(PAD)
"RTN","DGMHV",190,0)
 D ENDR^%ZISS
"RTN","DGMHV",191,0)
 W $CHAR(7) W ?PAD W:$D(IORVON) IORVON W DGREVTXT W:$D(IORVOFF) IORVOFF
"RTN","DGMHV",192,0)
 Q
"RTN","DGMHV",193,0)
TXT(TXT,LEN) ; Split string into multiple LEN length lines
"RTN","DGMHV",194,0)
 ;* Input: TXT = TXT string
"RTN","DGMHV",195,0)
 ;*        LEN = format length
"RTN","DGMHV",196,0)
 ;* Output: MARX array.
"RTN","DGMHV",197,0)
 N OLD,X1,Y D SPLIT K MARX
"RTN","DGMHV",198,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","DGMHV",199,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","DGMHV",200,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","DGMHV",201,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","DGMHV",202,0)
 . S Y=Y_OLD(X)
"RTN","DGMHV",203,0)
 S:Y]"" MARX(X1)=Y
"RTN","DGMHV",204,0)
 S MARX=X1
"RTN","DGMHV",205,0)
 Q
"RTN","DGMHV",206,0)
SPLIT ; * Split a word string into individual words.
"RTN","DGMHV",207,0)
 ;* Input: TXT  - Line of text
"RTN","DGMHV",208,0)
 ;* Input: LEN  - Maximum length one line of text will be limited to
"RTN","DGMHV",209,0)
 ;* Output: OLD(X)
"RTN","DGMHV",210,0)
 N BSD,NEWSTR,X,X1,Y
"RTN","DGMHV",211,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","DGMHV",212,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","DGMHV",213,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","DGMHV",214,0)
 . F X=0:0 S X=$O(NEWSTR(X)) Q:'X  S OLD(X)=NEWSTR(X)
"RTN","DGMHV",215,0)
 Q
"RTN","DGMHV",216,0)
LEN(X1,OLD) ;* Wrap word to next line if it doesn't fit the display length
"RTN","DGMHV",217,0)
 N X
"RTN","DGMHV",218,0)
 Q:$L(OLD)'>LEN
"RTN","DGMHV",219,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!(X["-") Q
"RTN","DGMHV",220,0)
 I $L(OLD)>LEN F X=1:1 S NEWSTR(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))
"RTN","DGMHV",221,0)
 Q
"RTN","DGMHV",222,0)
DELIM(BSD) ; Split a string into individual words
"RTN","DGMHV",223,0)
 ; Input:  BSD - Characters considered delimiters between words (i.e., for identifying/splitting-up-and/or-separating words)
"RTN","DGMHV",224,0)
 ; Input:  OLD(n) - Text array containing  
"RTN","DGMHV",225,0)
 ; Output: OLD(n) - Array containing pdated 
"RTN","DGMHV",226,0)
 K NEWSTR
"RTN","DGMHV",227,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  F Y=1:1:$L(OLD(X),BSD) D
"RTN","DGMHV",228,0)
 . S X1=X1+1
"RTN","DGMHV",229,0)
 . S NEWSTR(X1)=$P(OLD(X),BSD,Y)
"RTN","DGMHV",230,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEWSTR(X1)=NEWSTR(X1)_BSD
"RTN","DGMHV",231,0)
 . D LEN(.X1,NEWSTR(X1))
"RTN","DGMHV",232,0)
 K OLD F X=0:0 S X=$O(NEWSTR(X)) Q:'X  S OLD(X)=NEWSTR(X)
"RTN","DGMHV",233,0)
 Q
"RTN","DGMHV",234,0)
CLEAR ; Clear the display
"RTN","DGMHV",235,0)
 D CLEAR^VALM1
"RTN","DGMHV",236,0)
 D FULL^VALM1
"RTN","DGMHV",237,0)
 S VALMBCK="R"
"RTN","DGMHV",238,0)
 Q
"RTN","DGMHV",239,0)
CONT ; Prompt to Continue
"RTN","DGMHV",240,0)
 N DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","DGMHV",241,0)
 Q
"RTN","DGMHV",242,0)
ACTRNSFM ; Transform action prompt input
"RTN","DGMHV",243,0)
 Q
"RTN","DGMHV",244,0)
DSPLACT(DFN) ; Display all MHV actions associated with last 5 date/time stamps. If last action is one of the 
"RTN","DGMHV",245,0)
 ;             MHV Socialization actions, ask additional question about whether the patient was successfully enrolled/registered
"RTN","DGMHV",246,0)
 N TMPDT,LASTDT,DGACTDT,NXT1,NXT2,I,J,DGLACTS,DIC,DA,DGFLDAR S DGLACTS=""
"RTN","DGMHV",247,0)
 D GETLACT^DGMHVUTL(DFN,.DGLACTS)
"RTN","DGMHV",248,0)
 W !,"         Recent My HealtheVet actions taken by VistA Clerks "
"RTN","DGMHV",249,0)
 W !,"--------------------------------------------------------------------"
"RTN","DGMHV",250,0)
 D GETFLDS^DGMHVUTL(DFN,.DGFLDAR) I $O(DGFLDAR(0)) M DGLACTS=DGFLDAR
"RTN","DGMHV",251,0)
 I '$O(DGLACTS(0)) W !?8," - NONE - ",!! Q
"RTN","DGMHV",252,0)
 S LASTDT="" F  S LASTDT=$O(DGLACTS(LASTDT)) Q:'LASTDT  D
"RTN","DGMHV",253,0)
 .S DGACTDT=$$FMTE^XLFDT($P(LASTDT,"."),2) I ($L(DGACTDT)<8) D
"RTN","DGMHV",254,0)
 ..N NEWDT,IDT,DTPC F IDT=1:1:$L(DGACTDT,"/") D
"RTN","DGMHV",255,0)
 ...S DTPC=$P(DGACTDT,"/",IDT),DTPC=$TR($J(DTPC,2)," ",0),NEWDT=$G(NEWDT)_$S(IDT=1:"",1:"/")_DTPC
"RTN","DGMHV",256,0)
 ..I NEWDT?2N1"/"2N1"/"2N S DGACTDT=NEWDT
"RTN","DGMHV",257,0)
 .S NXT1=0 F I=1:1 S NXT1=$O(DGLACTS(LASTDT,NXT1)) Q:'NXT1  D
"RTN","DGMHV",258,0)
 ..S NXT2="" F J=1:1 S NXT2=$O(DGLACTS(LASTDT,NXT1,"TXT",NXT2)) Q:'NXT2  W ! D
"RTN","DGMHV",259,0)
 ...N DGSP S DGSP=$S($L($G(DGLACTS(LASTDT,NXT1,"IEN")))>1:" ",1:" ")
"RTN","DGMHV",260,0)
 ...W $S($G(TMPDT)'=LASTDT:DGACTDT,1:"       ") W $S((J=1):DGSP_" ",1:"   "),$G(DGLACTS(LASTDT,NXT1,"TXT",NXT2))
"RTN","DGMHV",261,0)
 ...S TMPDT=LASTDT
"RTN","DGMHV",262,0)
 D QUESUC^DGMHVUTL(DFN,.DGMHVOUT) Q:($G(DGMHVOUT)]"")
"RTN","DGMHV",263,0)
 Q
"RTN","DGMHV",264,0)
ACTHLP ; Help at action prompt
"RTN","DGMHV",265,0)
 W !?5,"Please select one of the listed actions that most closely describes"
"RTN","DGMHV",266,0)
 W !?5,"the actions taken today to help this patient register in My HealtheVet."
"RTN","DGMHV",267,0)
 Q
"RTN","DGMHVAC")
0^3^B148795601^n/a
"RTN","DGMHVAC",1,0)
DGMHVAC ;HIRMFO/WAA-REACTIONS SELECT ROUTINE ;6/9/05  11:12
"RTN","DGMHVAC",2,0)
 ;;5.3;Registration;**903**;Aug 13, 1993;Build 82
"RTN","DGMHVAC",3,0)
 ;
"RTN","DGMHVAC",4,0)
 ; Submitted to OSEHRA 04/02/2015 by HP
"RTN","DGMHVAC",5,0)
 ; All entry points authored by James Harris 2014-2015
"RTN","DGMHVAC",6,0)
 ;
"RTN","DGMHVAC",7,0)
 ;
"RTN","DGMHVAC",8,0)
EN(DFN,DGABB) ; Entry point for MHV Enrollment/Registration 'screen'
"RTN","DGMHVAC",9,0)
 ; Allow editing only if "1" is selected, always begin with Registered? field, since subsequent field logic is dependent
"RTN","DGMHVAC",10,0)
 N DIR,DGMHVOUT,DGMHVQ,DGMHVI,DGRSPNS S DGMHVQ=0
"RTN","DGMHVAC",11,0)
 F DGMHVI=1:1 Q:$G(DGMHVOUT)  D
"RTN","DGMHVAC",12,0)
 .I DGMHVI=1&'$G(DGABB) S DGRSPNS=$$DSPENR^DGMHVUTL(DFN,.DGMHVOUT)
"RTN","DGMHVAC",13,0)
 .Q:$G(DGMHVOUT)
"RTN","DGMHVAC",14,0)
 .D MAIN(DFN,.DGRSPNS)
"RTN","DGMHVAC",15,0)
 .S DGRSPNS=$$DSPENR^DGMHVUTL(DFN,.DGMHVOUT)
"RTN","DGMHVAC",16,0)
 Q
"RTN","DGMHVAC",17,0)
 ;
"RTN","DGMHVAC",18,0)
MAIN(DFN,DGABB) ; Main Driver for Enrollment/Registration 'screen'. 
"RTN","DGMHVAC",19,0)
 ; Prompt for three MHV Enrollment/Registration fields - include previously entered values as defaults
"RTN","DGMHVAC",20,0)
 ; Copy NO value and reason entered at any field to all subsequent fields.
"RTN","DGMHVAC",21,0)
 ; Do not prompt for subsequent field unless 'YES' is entered at current field.
"RTN","DGMHVAC",22,0)
 ; (A)ction (in progress) is treated as UNANSWERED.
"RTN","DGMHVAC",23,0)
 N DGRPFLD,DGMHV,DGMHAC,DGMHSEL,DGMHVNOW,DGRSNPT,DGRSNTXT,X,Y,DGRNSPT,DGRTFLD
"RTN","DGMHVAC",24,0)
 S DGMHAC="",DGMHSEL="",DGMHVNOW=$$NOW^XLFDT
"RTN","DGMHVAC",25,0)
 I '$G(DGABB) D CLEAR^DGMHV W !!!
"RTN","DGMHVAC",26,0)
 K DIRUT W !
"RTN","DGMHVAC",27,0)
 S DGMHVQ=0
"RTN","DGMHVAC",28,0)
 ;
"RTN","DGMHVAC",29,0)
 ; Don't ask enrollment/registration question if 'abbreviated' mode and already populated with YES
"RTN","DGMHVAC",30,0)
 ; Patient MHV Enrolled/Registered?
"RTN","DGMHVAC",31,0)
 D  ; Enrollment/Registration prompt
"RTN","DGMHVAC",32,0)
 .I $G(DGABB)&($G(DGABB)>1) S DGMHV("ENROLLED")=$$GETEN^DGMHVUTL(DFN) Q  ; Skip- either abbreviated+already answered, or user selected another
"RTN","DGMHVAC",33,0)
 .D ENROLL
"RTN","DGMHVAC",34,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",35,0)
 K DIRUT W !
"RTN","DGMHVAC",36,0)
 ;
"RTN","DGMHVAC",37,0)
 ; Patient MHV Authenticated?
"RTN","DGMHVAC",38,0)
 D  ; Authentication prompt
"RTN","DGMHVAC",39,0)
 .I $G(DGABB)&($G(DGABB)>2) S DGMHV("AUTH")=$$GETAUTH^DGMHVUTL(DFN) Q
"RTN","DGMHVAC",40,0)
 .D AUTHENT
"RTN","DGMHVAC",41,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",42,0)
 ;
"RTN","DGMHVAC",43,0)
 ; Secure Messaging
"RTN","DGMHVAC",44,0)
 D  ; Secure Messaging prompt
"RTN","DGMHVAC",45,0)
 .D SECMSG
"RTN","DGMHVAC",46,0)
 ;
"RTN","DGMHVAC",47,0)
 Q
"RTN","DGMHVAC",48,0)
 ;
"RTN","DGMHVAC",49,0)
ENROLLQ(MHV,DGMHVNOW) ; Prompt for "MHV Enrolled/Registered"
"RTN","DGMHVAC",50,0)
 N ENDFLT,DIR,DA,X,Y S Y=""
"RTN","DGMHVAC",51,0)
 D CLEAR^DGMHV
"RTN","DGMHVAC",52,0)
 W !,"Step 1 of 3: My HealtheVet Registration",!,"----------------------------------------",!
"RTN","DGMHVAC",53,0)
 S ENDFLT=$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHVAC",54,0)
 S ENDFLT=$S(ENDFLT=1:"YES",ENDFLT=0:"NO",1:"")
"RTN","DGMHVAC",55,0)
 S DIR(0)="Y",DIR("B")=ENDFLT
"RTN","DGMHVAC",56,0)
 S DIR("A")="Is the patient registered on My HealtheVet (Yes/No)"
"RTN","DGMHVAC",57,0)
 K DIRUT D ^DIR  Q:$D(DIRUT)
"RTN","DGMHVAC",58,0)
 S MHV("ENROLLED")=$S($G(Y):1,1:0)
"RTN","DGMHVAC",59,0)
 Q
"RTN","DGMHVAC",60,0)
 ;
"RTN","DGMHVAC",61,0)
AUTHENQ(MHV,DGMHVNOW) ; Prompt for "MHV Authenticated"
"RTN","DGMHVAC",62,0)
 I '$G(MHV("ENROLLED")) S DGMHVQ=1 Q
"RTN","DGMHVAC",63,0)
 D CLEAR^DGMHV
"RTN","DGMHVAC",64,0)
 W !,"Step 2 of 3: My HealtheVet Authentication Upgrade",!,"-------------------------------------------------------------",!
"RTN","DGMHVAC",65,0)
 N AUDFLT,DIR,DA,X,Y,DGTXT,DGTXTCNT
"RTN","DGMHVAC",66,0)
 D CANTXT^DGMHVUTL("AUTH",,,71)
"RTN","DGMHVAC",67,0)
 W !
"RTN","DGMHVAC",68,0)
 S AUDFLT=$P($G(^DPT(DFN,2)),"^",2),AUDFLT=$S(AUDFLT=1:"YES",AUDFLT=0:"NO",AUDFLT=2:"ACTION",1:"")
"RTN","DGMHVAC",69,0)
 S DIR(0)="SAO^Y:YES;N:NO;A:ACTION"
"RTN","DGMHVAC",70,0)
 S DIR("B")=AUDFLT
"RTN","DGMHVAC",71,0)
 S DIR("A",1)="Select (Y) YES if patient already has a Premium My HealtheVet account."
"RTN","DGMHVAC",72,0)
 S DIR("A",2)="Select (A) ACTION if patient wants to upgrade to Premium My HealtheVet account."
"RTN","DGMHVAC",73,0)
 S DIR("A",3)="Select (N) NO if patient refuses to upgrade to a Premium My HealtheVet account."
"RTN","DGMHVAC",74,0)
 S DIR("A",4)=""
"RTN","DGMHVAC",75,0)
 S DIR("A")="(Yes/No/(A)ction): "
"RTN","DGMHVAC",76,0)
 K DIRUT D ^DIR I $D(DIRUT) W ! Q
"RTN","DGMHVAC",77,0)
 S MHV("AUTH")=$S(Y="Y":1,Y="A":2,1:0)
"RTN","DGMHVAC",78,0)
 S DGTXT=""
"RTN","DGMHVAC",79,0)
 I MHV("AUTH")'=2 S MHV("AUTH","DATE")=DGMHVNOW
"RTN","DGMHVAC",80,0)
 I MHV("AUTH")=1 S DGTXT="- Patient already has a Premium My HealtheVet account."
"RTN","DGMHVAC",81,0)
 I MHV("AUTH")=0 S DGTXT="- Patient refuses to upgrade to a Premium My HealtheVet account."
"RTN","DGMHVAC",82,0)
 I MHV("AUTH")=2 S DGTXT="- Patient would like to upgrade to a Premium My HealtheVet account."
"RTN","DGMHVAC",83,0)
 I DGTXT]"" D TXT^DGMHV(DGTXT,50) I $G(MARX) F DGTXTCNT=1:1:+$G(MARX) D
"RTN","DGMHVAC",84,0)
 .I DGTXTCNT=1 W MARX(DGTXTCNT) Q
"RTN","DGMHVAC",85,0)
 .W !,MARX(DGTXTCNT)
"RTN","DGMHVAC",86,0)
 W !
"RTN","DGMHVAC",87,0)
 Q
"RTN","DGMHVAC",88,0)
 ;
"RTN","DGMHVAC",89,0)
OPTINQ(MHV,DGMHVNOW) ; Prompt for "Use MHV Secure Messaging" - Note previous wording was Opt In
"RTN","DGMHVAC",90,0)
 I '$G(MHV("AUTH")) S DGMHVQ=1 Q
"RTN","DGMHVAC",91,0)
 D CLEAR^DGMHV
"RTN","DGMHVAC",92,0)
 W !,"Step 3 of 3: My HealtheVet Secure Messaging",!,"--------------------------------------------",!
"RTN","DGMHVAC",93,0)
 N MSGDFLT,DIR,DA,X,Y
"RTN","DGMHVAC",94,0)
 D CANTXT^DGMHVUTL("SMSG",,,71)
"RTN","DGMHVAC",95,0)
 W !
"RTN","DGMHVAC",96,0)
 S MSGDFLT=$P($G(^DPT(DFN,2)),"^",3),MSGDFLT=$S(MSGDFLT=1:"YES",MSGDFLT=0:"NO",MSGDFLT=2:"ACTION",1:"")
"RTN","DGMHVAC",97,0)
 S DIR(0)="SAO^Y:YES;N:NO;A:ACTION",DIR("B")=MSGDFLT
"RTN","DGMHVAC",98,0)
 S DIR("A",1)="Select (Y) YES if patient already uses Secure Messaging."
"RTN","DGMHVAC",99,0)
 S DIR("A",2)="Select (A) ACTION if patient would like to use Secure Messaging."
"RTN","DGMHVAC",100,0)
 S DIR("A",3)="Select (N) NO if patient declines to use Secure Messaging."
"RTN","DGMHVAC",101,0)
 S DIR("A",4)=""
"RTN","DGMHVAC",102,0)
 S DIR("A")="Secure Messaging? (Yes/No/(A)ction): "
"RTN","DGMHVAC",103,0)
 K DIRUT D ^DIR I $D(DIRUT) W ! Q
"RTN","DGMHVAC",104,0)
 S MHV("OPTINQ")=$S(Y="Y":1,Y="A":2,1:0)
"RTN","DGMHVAC",105,0)
 S DGTXT=""
"RTN","DGMHVAC",106,0)
 I MHV("OPTINQ")'=2 S MHV("AUTH","DATE")=DGMHVNOW
"RTN","DGMHVAC",107,0)
 W !
"RTN","DGMHVAC",108,0)
 Q
"RTN","DGMHVAC",109,0)
 ;
"RTN","DGMHVAC",110,0)
ENROLL  ; MHV Enrollment/Registration
"RTN","DGMHVAC",111,0)
 D ENROLLQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q
"RTN","DGMHVAC",112,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",113,0)
 ; MHV Enrolled/Registered
"RTN","DGMHVAC",114,0)
 I '$G(DGMHV("ENROLLED")) S DGRNSPT="",DGRSNTXT="" D  Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",115,0)
 .N DGADFLT,UTILITY,DIC,DA,DR S DIC=2,DA=DFN,DR="537036" D GETS^DIQ(DIC,DFN,DR,"I","UTILITY")
"RTN","DGMHVAC",116,0)
 .S DGADFLT=$G(UTILITY(2,DFN_",",537036,"I"))
"RTN","DGMHVAC",117,0)
 .D GETRSN("patient is not registered",.DGRSNPT,.DGRSNTXT,DGADFLT,2.1) Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",118,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",119,0)
 .F DGRPFLD=537033:1:537035 D FILRNA(DFN,DGRPFLD,"@")
"RTN","DGMHVAC",120,0)
 .F DGRPFLD=537036:1:537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)
"RTN","DGMHVAC",121,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" F DGRTFLD=537033:1:537035 D FILRNA(DFN,DGRTFLD,DGRSNTXT)
"RTN","DGMHVAC",122,0)
 .N DIE,DR,DA S DIE="^DPT(",DR="537027////"_+DGMHV("ENROLLED")_";537030////"_DGMHVNOW,DA=DFN D ^DIE
"RTN","DGMHVAC",123,0)
 .N DIE,DR,DA S DA=DFN,DIE="^DPT(",DR="537028////0;537029////0;537031////"_DGMHVNOW_";537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",124,0)
 .D FILACT(DFN,3),FILACT(DFN,4)
"RTN","DGMHVAC",125,0)
 I $G(DGMHV("ENROLLED")) D
"RTN","DGMHVAC",126,0)
 .Q:$G(DGABB)&($P($G(^DPT(DFN,2)),U,1)=1)  ; Quit if 'abbreviated' mode and this was answered previously
"RTN","DGMHVAC",127,0)
 .N DGOLDEN S DGOLDEN=$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHVAC",128,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537027////1;537030////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",129,0)
 .Q:DGOLDEN=DGMHV("ENROLLED")
"RTN","DGMHVAC",130,0)
 .N DGFLD F DGFLD=537033,537036 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",131,0)
 .; If "Registered:" changed from NO or Action to YES, remove NO values in AUTHENTICATED and SECURE MESSAGING
"RTN","DGMHVAC",132,0)
 .N MHVND S MHVND=$G(^DPT(+DFN,2))
"RTN","DGMHVAC",133,0)
 .I $P(MHVND,"^",2)=0 F DGFLD=537028,537031,537034,537037 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",134,0)
 .I $P(MHVND,"^",3)=0 F DGFLD=537029,537032,537035,537038 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",135,0)
 Q
"RTN","DGMHVAC",136,0)
 ;
"RTN","DGMHVAC",137,0)
AUTHENT  ; Authenticated MHV account status
"RTN","DGMHVAC",138,0)
 D AUTHENQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q
"RTN","DGMHVAC",139,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",140,0)
 I '$G(DGMHV("AUTH")) S DGRNSPT="",DGRSNTXT="" D CANTXT^DGMHVUTL("UP",1,1) D  Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",141,0)
 .W !!,"Patient Not Authenticated Reasons"
"RTN","DGMHVAC",142,0)
 .N DGADFLT,UTILITY,DIC,DA,DR S DIC=2,DA=DFN,DR="537037" D GETS^DIQ(DIC,DFN,DR,"I","UTILITY")
"RTN","DGMHVAC",143,0)
 .S DGADFLT=$G(UTILITY(2,DFN_",",537037,"I"))
"RTN","DGMHVAC",144,0)
 .D GETRSN("patient has not upgraded/authenticated",.DGRSNPT,.DGRSNTXT,DGADFLT,2.2) Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",145,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",146,0)
 .F DGRPFLD=537034,537035 D FILRNA(DFN,DGRPFLD,"@")
"RTN","DGMHVAC",147,0)
 .F DGRPFLD=537037,537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)
"RTN","DGMHVAC",148,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" F DGRTFLD=537034:1:537035 D FILRNA(DFN,DGRTFLD,DGRSNTXT)
"RTN","DGMHVAC",149,0)
 .N DIE,DR,DA S DA=DFN
"RTN","DGMHVAC",150,0)
 .S DIE="^DPT(",DR="537028////"_DGMHV("AUTH")_";537031////"_DGMHVNOW_";537029////0;537032////"_DGMHVNOW
"RTN","DGMHVAC",151,0)
 .D ^DIE
"RTN","DGMHVAC",152,0)
 .D FILACT(DFN,3),FILACT(DFN,4)
"RTN","DGMHVAC",153,0)
 I $G(DGMHV("AUTH"))=1 D
"RTN","DGMHVAC",154,0)
 .N DGOLDAU S DGOLDAU=$P($G(^DPT(DFN,2)),"^",2)
"RTN","DGMHVAC",155,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537028////1;537031////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",156,0)
 .Q:DGOLDAU=DGMHV("AUTH")  ; User accepted default, nothing changed
"RTN","DGMHVAC",157,0)
 .;iF AUTHENTICATED is changed to YES then delete all Decline Text / Reason and Action
"RTN","DGMHVAC",158,0)
 .F DGFLD=537034,537037 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",159,0)
 .D FILACT(DFN,4)
"RTN","DGMHVAC",160,0)
 .;iF AUTHENTICATED is changed to YES then delete all SECURE MESSAGE elements
"RTN","DGMHVAC",161,0)
 .F DGFLD=537029,537032,537035,537038 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",162,0)
 .D FILACT(DFN,3)
"RTN","DGMHVAC",163,0)
 I $G(DGMHV("AUTH"))=2 D CANTXT^DGMHVUTL("UP",,1) D  S DGMHVQ=1 Q  ; Action entered instead of yes or no
"RTN","DGMHVAC",164,0)
 .N DGOLDAU S DGOLDAU=$P($G(^DPT(DFN,2)),"^",2)
"RTN","DGMHVAC",165,0)
 .W !! N DGDPTSOC,DGMHSEL S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,"A")
"RTN","DGMHVAC",166,0)
 .N DGCURSEL S DGCURSEL=$O(DGMHSEL(0)) I 'DGCURSEL Q
"RTN","DGMHVAC",167,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537028////2;537031////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",168,0)
 .D FILRNA(DFN,537034,"@"),FILRNA(DFN,537037,"@")
"RTN","DGMHVAC",169,0)
 .D FILACT(DFN,4,.DGMHSEL)
"RTN","DGMHVAC",170,0)
 .Q:DGOLDAU=DGMHV("AUTH")
"RTN","DGMHVAC",171,0)
 .;iF AUTHENTICATED is changed to ACTION then delete all SECURE MESSAGE elements
"RTN","DGMHVAC",172,0)
 .F DGFLD=537029,537032,537035,537038 D FILRNA(DFN,DGFLD,"@")
"RTN","DGMHVAC",173,0)
 .D FILACT(DFN,3)
"RTN","DGMHVAC",174,0)
 W !
"RTN","DGMHVAC",175,0)
 Q
"RTN","DGMHVAC",176,0)
 ;
"RTN","DGMHVAC",177,0)
SECMSG  ; Secure Messaging
"RTN","DGMHVAC",178,0)
 K DIRUT D OPTINQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1
"RTN","DGMHVAC",179,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",180,0)
 I '$G(DGMHV("OPTINQ")) S DGRNSPT="",DGRSNTXT="" D  Q:$G(DGMHVOUT)
"RTN","DGMHVAC",181,0)
 .N DGMDFLT,UTILITY,DIC,DA,DR S DIC=2,DA=DFN,DR="537038" D GETS^DIQ(DIC,DFN,DR,"I","UTILITY")
"RTN","DGMHVAC",182,0)
 .S DGMDFLT=$G(UTILITY(2,DFN_",",537038,"I"))
"RTN","DGMHVAC",183,0)
 .D GETRSN("not using secure messaging",.DGRSNPT,.DGRSNTXT,DGMDFLT,2.3) Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",184,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",185,0)
 .D FILRNA(DFN,537035,"@")
"RTN","DGMHVAC",186,0)
 .N DIE,DR,DA S DA=DFN,DIE="^DPT(",DR="537029////"_DGMHV("OPTINQ")_";537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",187,0)
 .D FILRNA(DFN,537038,DGRSNPT)
"RTN","DGMHVAC",188,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" D FILRNA(DFN,537035,DGRSNTXT)
"RTN","DGMHVAC",189,0)
 .D FILACT(DFN,3)
"RTN","DGMHVAC",190,0)
 I $G(DGMHV("OPTINQ"))=1 D  Q
"RTN","DGMHVAC",191,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537029////1;537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",192,0)
 .D FILRNA(DFN,537035,"@"),FILRNA(DFN,537038,"@")
"RTN","DGMHVAC",193,0)
 .D FILACT(DFN,3)
"RTN","DGMHVAC",194,0)
 I $G(DGMHV("OPTINQ"))=2 D  Q
"RTN","DGMHVAC",195,0)
 .N DGOLDMSG S DGOLDMSG=$$GETMSG^DGMHVUTL(DFN)
"RTN","DGMHVAC",196,0)
 .W !! N DGDPTSOC,DGMHSEL S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,"M")
"RTN","DGMHVAC",197,0)
 .N DGCURSEL S DGCURSEL=$O(DGMHSEL(0)) I 'DGCURSEL D  Q
"RTN","DGMHVAC",198,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537029////2;537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",199,0)
 .D FILRNA(DFN,537035,"@"),FILRNA(DFN,537038,"@")
"RTN","DGMHVAC",200,0)
 .D FILACT(DFN,3,.DGMHSEL)
"RTN","DGMHVAC",201,0)
 Q
"RTN","DGMHVAC",202,0)
 ;
"RTN","DGMHVAC",203,0)
GETRSN(TXTAD,REASPT,REASTXT,REASDFLT,DGTXTND) ; Prompt for "NO" Reason
"RTN","DGMHVAC",204,0)
 N DGDFTXT,DGMSACT,DIR,X,Y K DIRUT,DGTXTFIN,DGSCR
"RTN","DGMHVAC",205,0)
 S DGSCR=$S($G(DGTXTND)=2.1:1,$G(DGTXTND)=2.2:2,$G(DGTXTND)=2.3:3,1:"")
"RTN","DGMHVAC",206,0)
 S DGDFTXT=$$LKUPRTXT^DGMHVAC(DFN,$G(DGTXTND)),DGTXTFIN=0
"RTN","DGMHVAC",207,0)
 D GETRSNS(.DGMSACT,DGSCR)
"RTN","DGMHVAC",208,0)
 I $G(REASDFLT) N RSNSEL S RSNSEL="" F  S RSNSEL=$O(DGMSACT(RSNSEL)) Q:'RSNSEL  I $G(DGMSACT(RSNSEL,"IEN"))=REASDFLT S REASDFLT=RSNSEL
"RTN","DGMHVAC",209,0)
 D SETDIR(.DGMSACT,TXTAD,$G(REASDFLT))
"RTN","DGMHVAC",210,0)
 S REASPT="" F  Q:$G(REASPT)!$G(DGMHVOUT)  D ^DIR S:(Y>0) REASPT=+$G(DGMSACT(Y,"IEN")) I 'REASPT D
"RTN","DGMHVAC",211,0)
 .N DIR S DIR(0)="Y",DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y)>0 S DGMHVOUT=1
"RTN","DGMHVAC",212,0)
 .N UTILITY,DIC,DA,DR S DIC=2,DA=DFN,DR="537038" D GETS^DIQ(DIC,DFN,DR,"I","UTILITY")
"RTN","DGMHVAC",213,0)
 .S DGMDFLT=$G(UTILITY(2,DFN_",",537038,"I"))
"RTN","DGMHVAC",214,0)
 Q:'$G(REASPT)
"RTN","DGMHVAC",215,0)
 I $P($G(^DGMHV(390.03,REASPT,0)),"^")="Other" F  Q:$G(DGTXTFIN)!$G(DGMHVQ)  D
"RTN","DGMHVAC",216,0)
 .N DIR,X,Y S DIR("B")=$G(DGDFTXT),DIR(0)="FAR^2:250",DIR("A")="Other Reason Text (250 Chars Max): " D ^DIR
"RTN","DGMHVAC",217,0)
 .I $L(Y)>1 S REASTXT=$TR(Y,";^"," ") S DGTXTFIN=1 Q
"RTN","DGMHVAC",218,0)
 .I $G(X)="@" S DGDFTXT="" W "   Deleted",!
"RTN","DGMHVAC",219,0)
 .I $G(X)="^" S DGMHVQ=1 Q
"RTN","DGMHVAC",220,0)
 Q
"RTN","DGMHVAC",221,0)
 ;
"RTN","DGMHVAC",222,0)
FILRNA(DFN,DGFIELD,DGRSPT) ; File selected NO Reason to Patient file
"RTN","DGMHVAC",223,0)
 N DIE,DA,DR
"RTN","DGMHVAC",224,0)
 S DIE="^DPT(",DA=DFN,DR=DGFIELD_"////"_DGRSPT D ^DIE
"RTN","DGMHVAC",225,0)
 Q
"RTN","DGMHVAC",226,0)
 ;
"RTN","DGMHVAC",227,0)
FILACT(DFN,DGNODE,DGACTSEL) ; File selected MHV Action(s) to Patient file
"RTN","DGMHVAC",228,0)
 N NEXT,DGCNT
"RTN","DGMHVAC",229,0)
 S NEXT="A" F  S NEXT=$O(^DPT(DFN,DGNODE,NEXT),-1) Q:'NEXT  D
"RTN","DGMHVAC",230,0)
 .N DIE,DA,DIR S DIE="^DPT("_DFN_","_DGNODE_",",DA(1)=DFN,DA=NEXT,DR=.01_"////@" D ^DIE
"RTN","DGMHVAC",231,0)
 S NEXT=0 F DGCNT=1:1 S NEXT=$O(DGACTSEL(NEXT)) Q:'NEXT  D
"RTN","DGMHVAC",232,0)
 .Q:'$G(DGACTSEL(NEXT,"IEN"))
"RTN","DGMHVAC",233,0)
 .N DA,DINUM,X,DIC S DIC(0)="LEZ",DIC="^DPT(DFN,DGNODE,",DA(1)=DFN,DA=DGCNT,DINUM=DA,X=DGACTSEL(NEXT,"IEN") D FILE^DICN
"RTN","DGMHVAC",234,0)
 Q
"RTN","DGMHVAC",235,0)
 ;
"RTN","DGMHVAC",236,0)
GETRSNS(DGMSACT,DGSCRQ) ; Build and return array of selectable reasons from file 390.03
"RTN","DGMHVAC",237,0)
 N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGSCR S ACTCNT=0,SELCNT=0
"RTN","DGMHVAC",238,0)
 S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.03,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGMHV(390.03,ACTIEN,0)),"^"),DGSCR=$P(^(0),"^",2) I ACTTXT]"" D
"RTN","DGMHVAC",239,0)
 .I $G(DGSCRQ),$G(DGSCR) Q:DGSCR'[DGSCRQ
"RTN","DGMHVAC",240,0)
 .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,"IEN")=ACTIEN
"RTN","DGMHVAC",241,0)
 Q
"RTN","DGMHVAC",242,0)
 ;
"RTN","DGMHVAC",243,0)
SETDIR(DGMSACT,TXTAD,DGMDEF) ; Put incoming array of reasons into DIC("A")
"RTN","DGMHVAC",244,0)
 S DIR(0)="SA^",DIR("A",1)="",DIR("B")=$G(DGMDEF)
"RTN","DGMHVAC",245,0)
 S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=DIR(0)_ACTCNT_":"_DGMSACT(ACTCNT)_";",DIR("A",ACTCNT+1)="     "_ACTCNT_" - "_DGMSACT(ACTCNT)
"RTN","DGMHVAC",246,0)
 S DIR("A",$O(DIR("A","A"),-1)+1)=""
"RTN","DGMHVAC",247,0)
 N LINE,II,MARX,TXL D TXT^DGMHV(TXTAD,30)
"RTN","DGMHVAC",248,0)
 I $O(MARX(""),-1)=1 S DIR("A")="Select reason "_TXTAD_": " Q
"RTN","DGMHVAC",249,0)
 S TXL=0 F II=1:1 S TXL=$O(MARX(TXL)) Q:'TXL  D
"RTN","DGMHVAC",250,0)
 .S LINE=$S(II=1:"Select reason ",1:"")_MARX(TXL)
"RTN","DGMHVAC",251,0)
 .I $O(MARX(TXL))="" S DIR("A")=LINE Q
"RTN","DGMHVAC",252,0)
 .S DIR("A",$O(DIR("A","A"),-1)+1)=""
"RTN","DGMHVAC",253,0)
 S DIR("A")="Select reason "_TXTAD_": "
"RTN","DGMHVAC",254,0)
 Q
"RTN","DGMHVAC",255,0)
 ;
"RTN","DGMHVAC",256,0)
MHVOK(DFN) ; Check patient's MHV enrollment/registration info. 
"RTN","DGMHVAC",257,0)
 ; Logic to activate/deactivate alert
"RTN","DGMHVAC",258,0)
 ; -----------------------------------
"RTN","DGMHVAC",259,0)
 ; 1. If any field contains null (UNANSWERED), return 0
"RTN","DGMHVAC",260,0)
 ; 2. If any field contains "A" (ACTION), return 0
"RTN","DGMHVAC",261,0)
 ; 3. If neither 1 nor 2 is true, and any field contains "N" (NO):
"RTN","DGMHVAC",262,0)
 ;    a. The alert is ON if the date the NO was entered is at least 6 months prior to the current date
"RTN","DGMHVAC",263,0)
 ;    b. The alert is OFF if the date the NO was entered is less than 6 months prior to the current date
"RTN","DGMHVAC",264,0)
 ; 4. If all fields contain "Y" (YES), return 1
"RTN","DGMHVAC",265,0)
 ;
"RTN","DGMHVAC",266,0)
 N DIR,DGIQ,MHVOK,MHVOKND,MHVEN,MHVBAD,UTILITY
"RTN","DGMHVAC",267,0)
 N DIC,DA,DR S DIC=2,DA=DFN,DR="537027:537032" D GETS^DIQ(DIC,DFN,DR,"I","UTILITY")
"RTN","DGMHVAC",268,0)
 M MHVOK(DFN)=UTILITY(2,DFN_",")
"RTN","DGMHVAC",269,0)
 S MHVBAD=0
"RTN","DGMHVAC",270,0)
 F DGIQ=0:1:2 I $G(MHVOK(DFN,537027+DGIQ,"I"))="" S MHVBAD=1
"RTN","DGMHVAC",271,0)
 I $G(MHVBAD) Q 0
"RTN","DGMHVAC",272,0)
 F DGIQ=0:1:2 Q:$G(MHVBAD)  D
"RTN","DGMHVAC",273,0)
 .I $G(MHVOK(DFN,537027+DGIQ,"I"))=0 D  Q
"RTN","DGMHVAC",274,0)
 ..I '$G(MHVOK(DFN,537030+DGIQ,"I")) S MHVBAD=1 Q
"RTN","DGMHVAC",275,0)
 ..I $$FMDIFF^XLFDT($$NOW^XLFDT,MHVOK(DFN,537030+DGIQ,"I"))>179 S MHVBAD=1 D
"RTN","DGMHVAC",276,0)
 ...N DGQ F DGQ=537027+DGIQ:1:537029 Q:DGQ>537029  D FILRNA(DFN,DGQ,"@")
"RTN","DGMHVAC",277,0)
 .I (MHVOK(DFN,537027+DGIQ,"I")="")!(MHVOK(DFN,537027+DGIQ,"I")=2) S MHVBAD=1
"RTN","DGMHVAC",278,0)
 Q $S($G(MHVBAD):0,1:1)
"RTN","DGMHVAC",279,0)
 ;
"RTN","DGMHVAC",280,0)
LKUPRSN(REASON) ; Lookup "NO" Reason in file 390.03
"RTN","DGMHVAC",281,0)
 N DIC,X S DIC="390.03",DIC(0)="ZU",X=+REASON D ^DIC
"RTN","DGMHVAC",282,0)
 Q $P($G(Y(0)),"^")
"RTN","DGMHVAC",283,0)
 ;
"RTN","DGMHVAC",284,0)
LKUPRTXT(DFN,DGRFIELD) ; Lookup "OTHER" Reason free text from PATIENT (#2) file
"RTN","DGMHVAC",285,0)
 S DGRSNTXT=$P($G(^DPT(+DFN,+DGRFIELD)),"^")
"RTN","DGMHVAC",286,0)
 Q $S($L(DGRSNTXT)>1:DGRSNTXT,1:"")
"RTN","DGMHVAC",287,0)
 ;
"RTN","DGMHVAC",288,0)
LKUPACT(ACTION) ; Lookup MHV Action in file 390.02
"RTN","DGMHVAC",289,0)
 N DIC,X S DIC="390.02",DIC(0)="ZU",X=+ACTION D ^DIC
"RTN","DGMHVAC",290,0)
 Q $G(Y(0))
"RTN","DGMHVAC",291,0)
 Q
"RTN","DGMHVAC",292,0)
 ;
"RTN","DGMHVAC",293,0)
LASTACHK(DFN,ACTXT) ; Check if ACTXT contains the text matching the most recent ACTION entered for patient DFN
"RTN","DGMHVAC",294,0)
 N DGMATCH,DGLST5,DGLST1,DGL1TXT S DGMATCH=0,DGLST5=""
"RTN","DGMHVAC",295,0)
 D GETLACT^DGMHVUTL(DFN,.DGLST5) S DGLST1=$O(DGLST5($$NOW^XLFDT),-1)
"RTN","DGMHVAC",296,0)
 I $G(DGLST1) D
"RTN","DGMHVAC",297,0)
 . S DGL1TXT=$G(DGLST5(DGLST1,1,"TXT",1))
"RTN","DGMHVAC",298,0)
 . I $E($G(ACTXT),1,$L($G(DGL1TXT)))=$E($G(DGL1TXT),1,$L($G(DGL1TXT))) S DGMATCH=1
"RTN","DGMHVAC",299,0)
 Q $S($G(DGMATCH):1,1:0)
"RTN","DGMHVUTL")
0^4^B136790239^n/a
"RTN","DGMHVUTL",1,0)
DGMHVUTL ;ALB/JCH - Patient MHV Enrollment/Registration - Utilities ;09/12/14 11:30am
"RTN","DGMHVUTL",2,0)
 ;;5.3;Registration;**903**;August 13, 1993;Build 82
"RTN","DGMHVUTL",3,0)
 ;
"RTN","DGMHVUTL",4,0)
 ; Submitted to OSEHRA 04/02/2015 by HP
"RTN","DGMHVUTL",5,0)
 ; All entry points authored by James Harris 2014-2015
"RTN","DGMHVUTL",6,0)
 ;
"RTN","DGMHVUTL",7,0)
 Q
"RTN","DGMHVUTL",8,0)
QUESUC(DFN,DGMHVOUT) ; If last action entered by clerk was one of the Socialization actions
"RTN","DGMHVUTL",9,0)
 ; from MHV SOCIALIZATION ACTIONS (#390.02) file entries for which "SELECTABLE LOCATIONS" 
"RTN","DGMHVUTL",10,0)
 ; includes SOCIALIZATION, display/prompt the "were you successful" message/question
"RTN","DGMHVUTL",11,0)
 ;
"RTN","DGMHVUTL",12,0)
 N DGSUPTXT
"RTN","DGMHVUTL",13,0)
 S DGSUPTXT=$$ENQACHK(DFN)
"RTN","DGMHVUTL",14,0)
 I DGSUPTXT]"" D  Q
"RTN","DGMHVUTL",15,0)
 .Q:$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHVUTL",16,0)
 .N NXT,MARX,DIR,DGTXTCNT S DIR(0)="YA",DIR("A",1)=" Please read the following to the patient:"
"RTN","DGMHVUTL",17,0)
 .S DIR("?")=" Enter the patient's response to the question"
"RTN","DGMHVUTL",18,0)
 .D TXT^DGMHV(DGSUPTXT,55) S DGTXTCNT=0,NXT=3 F  S DGTXTCNT=$O(MARX(DGTXTCNT)) Q:'DGTXTCNT  D
"RTN","DGMHVUTL",19,0)
 ..I '$O(MARX(DGTXTCNT)) S DIR("A")="       "_MARX(DGTXTCNT)_""""_" (Y/N): " Q
"RTN","DGMHVUTL",20,0)
 ..S DIR("A",NXT)="      """_MARX(DGTXTCNT),NXT=$G(NXT)+1
"RTN","DGMHVUTL",21,0)
 .W ! D ^DIR S DGMHVOUT=$S(Y=1:"R",Y=0:"A",1:"")
"RTN","DGMHVUTL",22,0)
 .I $G(DGMHVOUT)="R" N DIE,DA S DIE="^DPT(",DA=DFN,DR="537027////1;537030////"_$$NOW^XLFDT D ^DIE
"RTN","DGMHVUTL",23,0)
 .H .5
"RTN","DGMHVUTL",24,0)
 K DIR
"RTN","DGMHVUTL",25,0)
 Q
"RTN","DGMHVUTL",26,0)
 ;
"RTN","DGMHVUTL",27,0)
DSPENR(DFN,DGMHVFIN) ; Display patient's MHV Enrollment/Registration information
"RTN","DGMHVUTL",28,0)
 ; This is the MHV Registration pseudo-screen display; allow entry of 1 to edit the fields as a group, in sequence.
"RTN","DGMHVUTL",29,0)
 N ACTION,ACTIONE,REASON,REASONE,MHVOK,MHVOKND,MHVEN,MHVEN,MHVAU,MHVMSG,DGRSNTXT
"RTN","DGMHVUTL",30,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT,DGRSNCNT,DGRSPNS,DGSCHTR,DGDIR
"RTN","DGMHVUTL",31,0)
 ;
"RTN","DGMHVUTL",32,0)
 D HEADER(DFN)
"RTN","DGMHVUTL",33,0)
 K MHVOK N DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537027:537040" D GETS^DIQ(DIC,DFN,DR,"I","MHVOK")
"RTN","DGMHVUTL",34,0)
 S MHVEN=$G(MHVOK(2,DFN_",",537027,"I")),MHVAU=$G(MHVOK(2,DFN_",",537028,"I")),MHVMSG=$G(MHVOK(2,DFN_",",537029,"I"))
"RTN","DGMHVUTL",35,0)
 S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","DGMHVUTL",36,0)
 W !!!,"[1]       Registered: ",$S(MHVEN=0:"NO",MHVEN=1:"YES",1:"UNANSWERED") I MHVEN=1!(MHVEN=0) D
"RTN","DGMHVUTL",37,0)
 .N ENRDT S ENRDT=$$ENDATE(DFN) I ENRDT&(MHVEN=1) W ?44,"Confirmed: "_ENRDT
"RTN","DGMHVUTL",38,0)
 I MHVEN=0 S REASON=$G(MHVOK(2,DFN_",",537036,"I")) I REASON W !?12,"Reason: " S REASONE=$$LKUPRSN^DGMHVAC(REASON) D
"RTN","DGMHVUTL",39,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.1) I (REASONE="Other")&($L(DGRSNTXT)>1) S REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVUTL",40,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I)) D
"RTN","DGMHVUTL",41,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVUTL",42,0)
 ..W !?20,LINE
"RTN","DGMHVUTL",43,0)
 ;
"RTN","DGMHVUTL",44,0)
 W !!
"RTN","DGMHVUTL",45,0)
 I ",1,"[(","_$G(MHVEN)_",") S DGDIR(2)=";2:Authentication" W "[2]"
"RTN","DGMHVUTL",46,0)
 W ?7,"Authenticated: ",$S(MHVAU=0:"NO",MHVAU=1:"YES",MHVAU=2:"ACTION/IN PROGRESS",1:"UNANSWERED") D
"RTN","DGMHVUTL",47,0)
 .I MHVAU!(MHVAU=0) N AUTHDT S AUTHDT=$$AUTHDATE(DFN) I AUTHDT&(MHVAU=1) W ?44,"Confirmed: "_AUTHDT
"RTN","DGMHVUTL",48,0)
 I MHVAU=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_",",537037,"I")) I REASON W !?12,"Reason: " S REASONE=$$LKUPRSN^DGMHVAC(REASON) D
"RTN","DGMHVUTL",49,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.2) I (REASONE="Other")&($L(DGRSNTXT)>1) S REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVUTL",50,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I)) D
"RTN","DGMHVUTL",51,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVUTL",52,0)
 ..W !?21,LINE
"RTN","DGMHVUTL",53,0)
 I MHVAU=2 N ACTIEN S ACTIEN="" F  S ACTIEN=$O(^DPT(DFN,4,"B",ACTIEN)) Q:ACTIEN=""  D
"RTN","DGMHVUTL",54,0)
 .N ACTTXT,LI S ACTTXT=$P($G(^DGMHV(390.02,+ACTIEN,3,1,0)),"^") I ACTTXT]"" D
"RTN","DGMHVUTL",55,0)
 ..N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_" "_^DGMHV(390.02,ACTIEN,3,TXTND,0)
"RTN","DGMHVUTL",56,0)
 ..Q:$L(ACTTXT)<2  N MARX,INOD,LINE D TXT^DGMHV(ACTTXT,48) F INOD=1:1:$O(MARX(""),-1) S LINE=$G(MARX(INOD)) D
"RTN","DGMHVUTL",57,0)
 ...I INOD=1 W !?14,"Action: ",LINE S DGRSNCNT=1 Q
"RTN","DGMHVUTL",58,0)
 ...W !?22,LINE
"RTN","DGMHVUTL",59,0)
 ;
"RTN","DGMHVUTL",60,0)
 W !!
"RTN","DGMHVUTL",61,0)
 I ",1,"[(","_$G(MHVAU)_",") S DGDIR(3)=";3:Secure Messaging"  W "[3]"
"RTN","DGMHVUTL",62,0)
 W ?4,"Secure Messaging: ",$S(MHVMSG=0:"NO",MHVMSG=1:"YES",MHVMSG=2:"ACTION/IN PROGRESS",1:"UNANSWERED") D
"RTN","DGMHVUTL",63,0)
 .I MHVMSG!(MHVMSG=0) N MSGDT S MSGDT=$$MSGDATE(DFN) I MSGDT&(MHVMSG=1) W ?44,"Confirmed: "_MSGDT
"RTN","DGMHVUTL",64,0)
 I MHVMSG=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_",",537038,"I")) I REASON W !?12,"Reason: " S REASONE=$$LKUPRSN^DGMHVAC(REASON) D
"RTN","DGMHVUTL",65,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.3) I REASONE="Other"&($L(DGRSNTXT)>1) S REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVUTL",66,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,60) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I)) D
"RTN","DGMHVUTL",67,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVUTL",68,0)
 ..W !?20,LINE
"RTN","DGMHVUTL",69,0)
 I MHVMSG=2 N ACTIEN S ACTIEN="" F  S ACTIEN=$O(^DPT(DFN,3,"B",ACTIEN)) Q:ACTIEN=""  D
"RTN","DGMHVUTL",70,0)
 .N ACTTXT,LI S ACTTXT=$P($G(^DGMHV(390.02,+ACTIEN,3,1,0)),"^") I ACTTXT]"" D
"RTN","DGMHVUTL",71,0)
 ..N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_" "_^DGMHV(390.02,ACTIEN,3,TXTND,0)
"RTN","DGMHVUTL",72,0)
 ..Q:$L(ACTTXT)<2  N MARX,INOD,LINE D TXT^DGMHV(ACTTXT,48) F INOD=1:1:$O(MARX(""),-1) S LINE=$G(MARX(INOD)) D
"RTN","DGMHVUTL",73,0)
 ...I INOD=1 W !?14,"Action: ",LINE S DGRSNCNT=1 Q
"RTN","DGMHVUTL",74,0)
 ...W !?22,LINE
"RTN","DGMHVUTL",75,0)
 W !!!!!!!
"RTN","DGMHVUTL",76,0)
 K DIRUT S DGMHVFIN=0
"RTN","DGMHVUTL",77,0)
 K DGABB
"RTN","DGMHVUTL",78,0)
 S DGSCHTR=$$SELFLDS(DFN)
"RTN","DGMHVUTL",79,0)
 N DGDONE F  Q:$G(DGDONE)  D
"RTN","DGMHVUTL",80,0)
 .N DIR S DIR("A")="Select a Registration step, or RETURN to continue: "
"RTN","DGMHVUTL",81,0)
 .S DIR(0)="SAO^1:Registration"_$G(DGDIR(2))_$G(DGDIR(3))
"RTN","DGMHVUTL",82,0)
 .D ^DIR S DGRSPNS=Y I DGSCHTR[(","_DGRSPNS_",") S DGDONE=1 Q
"RTN","DGMHVUTL",83,0)
 .I DGRSPNS=""!(DGRSPNS="^") S DGRSPNS="" S DGDONE=1 Q
"RTN","DGMHVUTL",84,0)
 .W !," Not a valid response",!
"RTN","DGMHVUTL",85,0)
 S DGMHVFIN=$S(DGSCHTR[(","_DGRSPNS_",")=1:0,1:1)
"RTN","DGMHVUTL",86,0)
 Q DGRSPNS
"RTN","DGMHVUTL",87,0)
 ;
"RTN","DGMHVUTL",88,0)
ENQACHK(DFN)  ; Return followup question in DGSUPTXT if last action taken for patient DFN was one of the socialization actions
"RTN","DGMHVUTL",89,0)
 N DGSUP1,DGSUP2,DGSUP3,DGACT,DIR
"RTN","DGMHVUTL",90,0)
 S DGMHVOUT=$G(DGMHVOUT)
"RTN","DGMHVUTL",91,0)
 ; Get MHV SOCIALIZATION ACTIONS (#390.02) file entries for which "SELECTABLE LOCATIONS" 
"RTN","DGMHVUTL",92,0)
 ; includes SOCIALIZATION
"RTN","DGMHVUTL",93,0)
 ; NOTE: If there are adjustments to the values in files 390.02 this API may need to be updated 
"RTN","DGMHVUTL",94,0)
 D GETACTS^DGMHV(.DGACT,"S")
"RTN","DGMHVUTL",95,0)
 S DGSUP1="Were you successful in creating your My HealtheVet account?"
"RTN","DGMHVUTL",96,0)
 S DGSUP2=$P(DGSUP1,"?")_" during your last visit?"
"RTN","DGMHVUTL",97,0)
 S DGSUP3="Were you able to create a My HealtheVet account from the Registration instructions we gave you last time?"
"RTN","DGMHVUTL",98,0)
 S DGSUPTXT=$S($$LASTACHK^DGMHVAC(DFN,$G(DGACT(1)))!$$LASTACHK^DGMHVAC(DFN,$G(DGACT(2))):DGSUP2,$$LASTACHK^DGMHVAC(DFN,$G(DGACT(3)))!$$LASTACHK^DGMHVAC(DFN,$G(DGACT(5))):DGSUP1,$$LASTACHK^DGMHVAC(DFN,$G(DGACT(4))):DGSUP3,1:"")
"RTN","DGMHVUTL",99,0)
 Q DGSUPTXT
"RTN","DGMHVUTL",100,0)
 ;
"RTN","DGMHVUTL",101,0)
GETLACT(DFN,DGLACTS) ; Get most recent MHV actions entered by clerk for patient DFN
"RTN","DGMHVUTL",102,0)
 ; Input: DFN - Patient IEN
"RTN","DGMHVUTL",103,0)
 ; Output: DGLACTS - Array of MHV actions
"RTN","DGMHVUTL",104,0)
 ;
"RTN","DGMHVUTL",105,0)
 N DGOT,LASTCNT,ACTCNT,X,X1,Y,LASTDT,LASTACT,LASTIEN,ACTCNT,FNDACT,LIENOK S (LASTACT,LASTIEN,DGLACTS,LASTCNT)=""
"RTN","DGMHVUTL",106,0)
 S LASTDT="" F LASTCNT=1:1 S LASTDT=$O(^DPT(DFN,1,"B",LASTDT),-1) Q:'LASTDT!($G(DGOT)>4)  D
"RTN","DGMHVUTL",107,0)
 .F  S LASTIEN=$O(^DPT(DFN,1,"B",LASTDT,LASTIEN)) Q:'LASTIEN  D
"RTN","DGMHVUTL",108,0)
 ..Q:'$O(^DPT(DFN,1,LASTIEN,1,0))  S ACTCNT("DT",LASTIEN)=LASTDT,FNDACT=1,LIENOK=LASTIEN,DGOT=$G(DGOT)+1
"RTN","DGMHVUTL",109,0)
 Q:'$G(LIENOK)
"RTN","DGMHVUTL",110,0)
 S LIENOK="" F  S LIENOK=$O(ACTCNT("DT",LIENOK)) Q:'LIENOK  N LASTDT S LASTDT=$G(ACTCNT("DT",LIENOK)) D
"RTN","DGMHVUTL",111,0)
 .S ACTCNT=0 F  S ACTCNT=$O(^DPT(DFN,1,LIENOK,1,ACTCNT)) Q:'ACTCNT  S ACTCNT(LASTDT,ACTCNT)=^DPT(DFN,1,LIENOK,1,ACTCNT,0) D
"RTN","DGMHVUTL",112,0)
 ..N ACTTXT,ACTIEN S ACTIEN=+$G(ACTCNT(LASTDT,ACTCNT)) S ACTTXT=$G(^DGMHV(390.02,ACTIEN,3,1,0)) I ACTTXT]"" D
"RTN","DGMHVUTL",113,0)
 ...N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_" "_^DGMHV(390.02,ACTIEN,3,TXTND,0)
"RTN","DGMHVUTL",114,0)
 ...S ACTCNT(LASTDT,ACTCNT,"IEN")=ACTCNT(LASTDT,ACTCNT)
"RTN","DGMHVUTL",115,0)
 ...N MARX D TXT^DGMHV(ACTTXT,60) M ACTCNT(LASTDT,ACTCNT,"TXT")=MARX
"RTN","DGMHVUTL",116,0)
 S LASTDT=$O(ACTCNT(0)) I $O(ACTCNT(0)) M DGLACTS=ACTCNT
"RTN","DGMHVUTL",117,0)
 Q
"RTN","DGMHVUTL",118,0)
 ;
"RTN","DGMHVUTL",119,0)
ACTSCRN(ACTIEN,LOCLIST) ; Check on code/functional locations at which MHV actions are selectable
"RTN","DGMHVUTL",120,0)
 ; Accepts an ACTION (#390.02) file IEN, returns array LOCLIST(LOC) where LOC is a location at which the action is selectable
"RTN","DGMHVUTL",121,0)
 ;
"RTN","DGMHVUTL",122,0)
 Q:'$G(ACTIEN)  K LOCLIST S LOCLIST=""
"RTN","DGMHVUTL",123,0)
 N ACTLOCN Q:'$D(^DGMHV(390.02,+ACTIEN,1))
"RTN","DGMHVUTL",124,0)
 S ACTLOCN=0 F  S ACTLOCN=$O(^DGMHV(390.02,ACTIEN,1,ACTLOCN)) Q:'ACTLOCN  D
"RTN","DGMHVUTL",125,0)
 .S LOCLIST=$G(^DGMHV(390.02,ACTIEN,1,ACTLOCN,0)) I LOCLIST S LOCLIST=$P($G(^DGMHV(390.04,LOCLIST,0)),"^") I LOCLIST]"" S LOCLIST(LOCLIST)=""
"RTN","DGMHVUTL",126,0)
 Q
"RTN","DGMHVUTL",127,0)
 ;
"RTN","DGMHVUTL",128,0)
HEADER(DFN) ; Print simulated screen header
"RTN","DGMHVUTL",129,0)
 N DGPTINFO,DGSCST,DGNMSSN K ^UTILITY("DIQ1",$J)
"RTN","DGMHVUTL",130,0)
 N DIC,DA,DR S DIQ(0)="E",DIC=2,DA=DFN,DR=".01;391" D EN^DIQ1 M DGPTINFO(DFN)=^UTILITY("DIQ1",$J,2,DFN)
"RTN","DGMHVUTL",131,0)
 D CLEAR^DGMHV
"RTN","DGMHVUTL",132,0)
 W !!?20,"MY HEALTHEVET REGISTRATION STATUS"
"RTN","DGMHVUTL",133,0)
 S DGNMSSN=$$SSNNM^DGRPU(DFN)
"RTN","DGMHVUTL",134,0)
 W !!,DGNMSSN,?60,$G(DGPTINFO(DFN,391,"E"))
"RTN","DGMHVUTL",135,0)
 W !,"================================================================================"
"RTN","DGMHVUTL",136,0)
 K ^UTILITY("DIQ1",$J)
"RTN","DGMHVUTL",137,0)
 Q
"RTN","DGMHVUTL",138,0)
 ;
"RTN","DGMHVUTL",139,0)
SELFLDS(DFN) ; Get selectable Enrollment/Registration fields based on values of other fields
"RTN","DGMHVUTL",140,0)
 ;
"RTN","DGMHVUTL",141,0)
 N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL
"RTN","DGMHVUTL",142,0)
 N DIC,DA,DR
"RTN","DGMHVUTL",143,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537027:537040" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",144,0)
 S MHVEN=$G(MHVFLDS(2,DFN_",",537027,"I")),MHVAU=$G(MHVFLDS(2,DFN_",",537028,"I")),MHVMSG=$G(MHVFLDS(2,DFN_",",537029,"I"))
"RTN","DGMHVUTL",145,0)
 N DGFLDSEL S DGFLDSEL=1
"RTN","DGMHVUTL",146,0)
 I $S(",0,1,"[(","_$G(MHVEN)_","):1,1:0) S DGFLDSEL=DGFLDSEL_",2"
"RTN","DGMHVUTL",147,0)
 I $S(",0,1,"[(","_$G(MHVAU)_","):1,1:0) S DGFLDSEL=DGFLDSEL_",3"
"RTN","DGMHVUTL",148,0)
 S DGFLDSEL=","_DGFLDSEL_","
"RTN","DGMHVUTL",149,0)
 Q DGFLDSEL
"RTN","DGMHVUTL",150,0)
 ;
"RTN","DGMHVUTL",151,0)
ENTRYFLD(DFN,DGUNONLY) ; Get first non-firmly answered field either unanswered or action in progress
"RTN","DGMHVUTL",152,0)
 ;
"RTN","DGMHVUTL",153,0)
 N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL
"RTN","DGMHVUTL",154,0)
 N DIC,DA,DR
"RTN","DGMHVUTL",155,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537027:537040" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",156,0)
 S MHVEN=$G(MHVFLDS(2,DFN_",",537027,"I")),MHVAU=$G(MHVFLDS(2,DFN_",",537028,"I")),MHVMSG=$G(MHVFLDS(2,DFN_",",537029,"I"))
"RTN","DGMHVUTL",157,0)
 N DGFLDSEL S DGFLDSEL=""
"RTN","DGMHVUTL",158,0)
 I '$G(DGUNONLY) D
"RTN","DGMHVUTL",159,0)
 .I MHVMSG=""!(MHVMSG=2) S DGFLDSEL=3
"RTN","DGMHVUTL",160,0)
 .I MHVAU=""!(MHVAU=2) S DGFLDSEL=2
"RTN","DGMHVUTL",161,0)
 .I MHVEN="" S DGFLDSEL=1
"RTN","DGMHVUTL",162,0)
 I $G(DGUNONLY) D
"RTN","DGMHVUTL",163,0)
 .I MHVAU=2!(MHVMSG=2) Q
"RTN","DGMHVUTL",164,0)
 .I MHVMSG="" S DGFLDSEL=3
"RTN","DGMHVUTL",165,0)
 .I MHVAU="" S DGFLDSEL=2
"RTN","DGMHVUTL",166,0)
 .I MHVEN="" S DGFLDSEL=1
"RTN","DGMHVUTL",167,0)
 Q DGFLDSEL
"RTN","DGMHVUTL",168,0)
 ;
"RTN","DGMHVUTL",169,0)
GETEN(DFN) ; Get value of MHV Registered
"RTN","DGMHVUTL",170,0)
 ;
"RTN","DGMHVUTL",171,0)
 N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL
"RTN","DGMHVUTL",172,0)
 N DIC,DA,DR
"RTN","DGMHVUTL",173,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537027" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",174,0)
 S MHVEN=$G(MHVFLDS(2,DFN_",",537027,"I"))
"RTN","DGMHVUTL",175,0)
 Q MHVEN
"RTN","DGMHVUTL",176,0)
 ;
"RTN","DGMHVUTL",177,0)
GETAUTH(DFN) ; Get value of MHV Authenticated
"RTN","DGMHVUTL",178,0)
 ;
"RTN","DGMHVUTL",179,0)
 N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL
"RTN","DGMHVUTL",180,0)
 N DIC,DA,DR
"RTN","DGMHVUTL",181,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537028" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",182,0)
 S MHVAU=$G(MHVFLDS(2,DFN_",",537028,"I"))
"RTN","DGMHVUTL",183,0)
 Q MHVAU
"RTN","DGMHVUTL",184,0)
 ;
"RTN","DGMHVUTL",185,0)
GETMSG(DFN) ; Get value of MHV Secure Messaging
"RTN","DGMHVUTL",186,0)
 ;
"RTN","DGMHVUTL",187,0)
 N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL
"RTN","DGMHVUTL",188,0)
 N DIC,DA,DR
"RTN","DGMHVUTL",189,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537029" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",190,0)
 S MHVMSG=$G(MHVFLDS(2,DFN_",",537029,"I"))
"RTN","DGMHVUTL",191,0)
 Q MHVMSG
"RTN","DGMHVUTL",192,0)
 ;
"RTN","DGMHVUTL",193,0)
CANTXT(DGMSG,CLEAR,CONT,DGTXTW) ; Display canned text to read to patient
"RTN","DGMHVUTL",194,0)
 Q:$G(DGMSG)']""
"RTN","DGMHVUTL",195,0)
 N DGINDEN,TMPCAN,NEXT,CANTXT,MARX,I S CANTXT=""
"RTN","DGMHVUTL",196,0)
 F I=0:1 S TMPCAN=$T(@(DGMSG_"+"_I)) Q:TMPCAN'[";"  S CANTXT=CANTXT_$P(TMPCAN,";",2)
"RTN","DGMHVUTL",197,0)
 Q:CANTXT=""
"RTN","DGMHVUTL",198,0)
 I $G(CLEAR) D CLEAR^DGMHV
"RTN","DGMHVUTL",199,0)
 W !,"Please read the following to the patient",!
"RTN","DGMHVUTL",200,0)
 S DGTXTW=$S($G(DGTXTW):DGTXTW,1:60)
"RTN","DGMHVUTL",201,0)
 D TXT^DGMHV(.CANTXT,DGTXTW)
"RTN","DGMHVUTL",202,0)
 S DGINDEN=(80-DGTXTW)/2
"RTN","DGMHVUTL",203,0)
 S NEXT=0 F  S NEXT=$O(MARX(NEXT)) Q:'NEXT  D
"RTN","DGMHVUTL",204,0)
 .W !?DGINDEN,MARX(NEXT)
"RTN","DGMHVUTL",205,0)
 I $G(CONT) W !! D CONT^DGMHV
"RTN","DGMHVUTL",206,0)
 Q
"RTN","DGMHVUTL",207,0)
 ;
"RTN","DGMHVUTL",208,0)
UP ;"Upgrade to a Premium My HealtheVet account to view parts of your VA health record and
"RTN","DGMHVUTL",209,0)
 ; use Secure Messaging. This requires one-time in-person identity verification (show
"RTN","DGMHVUTL",210,0)
 ; government issued photo ID). Read and sign VA Release of Information form (10-5345a-MHV).
"RTN","DGMHVUTL",211,0)
 ; Present a government issued photo ID required. (Instructions for optional online
"RTN","DGMHVUTL",212,0)
 ; Authentication process are also available)"
"RTN","DGMHVUTL",213,0)
 Q
"RTN","DGMHVUTL",214,0)
SMSG ;"With Secure Messaging, Veterans can communicate online with VA health care teams about health, medication questions, request prescription renewals, and/or appointments."
"RTN","DGMHVUTL",215,0)
 Q
"RTN","DGMHVUTL",216,0)
AUTH ;"With a Premium My HealtheVet account, patients can view VA appointments, lab results, access portions of their VA medical record and use Secure Messaging"
"RTN","DGMHVUTL",217,0)
 Q
"RTN","DGMHVUTL",218,0)
MHVPCHK(DFN) ; Consistency checker MHV update
"RTN","DGMHVUTL",219,0)
 ; Don't trigger update if MHV REGISTERED has not been answered, and Registration socialization action is pending
"RTN","DGMHVUTL",220,0)
 N DGMHVOUT,DGMHVQ,DGMHVACT,DP,DG,DK,DH,DM,DQ,DR,DL,X,Y,DC,DE,DIC,DIE,DIIENS,DIFLD,DIETMP,DW,D,D0,DG,DI,DIEL,DU,DV,DIR
"RTN","DGMHVUTL",221,0)
 S DGMHVOUT=0,DGMHVQ=0
"RTN","DGMHVUTL",222,0)
 S DGMHVACT=$$ENQACHK^DGMHVUTL(DFN) Q:(DGMHVACT]"")&'$G(^DPT(DFN,2))
"RTN","DGMHVUTL",223,0)
 S DGMHVACT=$$ENTRYFLD^DGMHVUTL(DFN)
"RTN","DGMHVUTL",224,0)
 D MAIN^DGMHVAC(DFN,DGMHVACT)
"RTN","DGMHVUTL",225,0)
 S:'$$MHVOK^DGMHVAC(DFN) FILERR(315)=""
"RTN","DGMHVUTL",226,0)
 Q
"RTN","DGMHVUTL",227,0)
 ;
"RTN","DGMHVUTL",228,0)
GETFLDS(DFN,FLDARRAY) ; Get MHV Registration status field and date values, place in array formatted for merging with historical action display
"RTN","DGMHVUTL",229,0)
 N DGEN,DGAUTH,DGMSG,DGENDT,DGAUDT,DGMSGDT
"RTN","DGMHVUTL",230,0)
 S DGEN=$$GETEN(DFN),DGAUTH=$$GETAUTH(DFN),DGMSG=$$GETMSG(DFN)
"RTN","DGMHVUTL",231,0)
 S DGENDT=$$ENDATE(DFN,1),DGAUDT=$$AUTHDATE(DFN,1),DGMSGDT=$$MSGDATE(DFN,1)
"RTN","DGMHVUTL",232,0)
 I DGENDT&($G(DGEN)=1) S FLDARRAY(DGENDT,1)="",FLDARRAY(DGENDT,1,"TXT")=1 D
"RTN","DGMHVUTL",233,0)
 .S FLDARRAY(DGENDT,1,"TXT",1)="My HealtheVet Registration "_$S(DGEN=1:"confirmed.",1:"")
"RTN","DGMHVUTL",234,0)
 I DGAUDT&($G(DGAUTH)=1) S FLDARRAY(DGAUDT,1)="",FLDARRAY(DGAUDT,1,"TXT")=1 D
"RTN","DGMHVUTL",235,0)
 .S FLDARRAY(DGAUDT,1,"TXT",1)="My HealtheVet Authenticated/Premium Upgrade "_$S(DGAUTH=1:"confirmed.",1:"")
"RTN","DGMHVUTL",236,0)
 I DGMSGDT&($G(DGMSG)=1) S FLDARRAY(DGMSGDT,1)="",FLDARRAY(DGMSGDT,1,"TXT")=1 D
"RTN","DGMHVUTL",237,0)
 .S FLDARRAY(DGMSGDT,1,"TXT",1)="My HealtheVet Secure Messaging  "_$S(DGMSG=1:"confirmed.",1:"")
"RTN","DGMHVUTL",238,0)
 Q
"RTN","DGMHVUTL",239,0)
CONSTAT(DFN,DGFLDNO) ; Write condensed patient MHV status
"RTN","DGMHVUTL",240,0)
 N DGEN,DGAUTH,DGMSG,DGMHVFLD
"RTN","DGMHVUTL",241,0)
 N DGENDT,DGAUTHDT,DGMSGDT
"RTN","DGMHVUTL",242,0)
 N DIQ,DIC,DA,DR,DGDTPC,DGTIMPC
"RTN","DGMHVUTL",243,0)
 S DGEN=$$GETEN(DFN)
"RTN","DGMHVUTL",244,0)
 S DGAUTH=$$GETAUTH(DFN)
"RTN","DGMHVUTL",245,0)
 S DGMSG=$$GETMSG(DFN)
"RTN","DGMHVUTL",246,0)
 N DGDASH S $P(DGDASH,"-",78)="-"
"RTN","DGMHVUTL",247,0)
 I $G(DGFLDNO(1))!$G(DGFLDNO(2))!$G(DGFLDNO(3)) W !?10,"MHV Registration Progress" ;,?40,"Status" D
"RTN","DGMHVUTL",248,0)
 W !,DGDASH
"RTN","DGMHVUTL",249,0)
 I $G(DGFLDNO(1)) W !,$$ENDATE(DFN),?10,"[Step 1 of 3]  My HealtheVet Registration: ",?56,$S(DGEN=1:"COMPLETED",DGEN=2:"ACTION PENDING",DGEN=0:"REFUSED",1:"UNANSWERED")
"RTN","DGMHVUTL",250,0)
 I $G(DGFLDNO(2)) W !,$$AUTHDATE(DFN),?10,"[Step 2 of 3]  Authentication Upgrade:",?56,$S(DGAUTH=1:"COMPLETED: ",DGAUTH=2:"ACTION PENDING",DGAUTH=0:"REFUSED",1:"UNANSWERED")
"RTN","DGMHVUTL",251,0)
 I $G(DGFLDNO(3)) W !,$$MSGDATE(DFN),?10,"[Step 3 of 3]  Secure Messaging Verification:",?56,$S(DGMSG=1:" COMPLETED: "_$$MSGDATE(DFN),DGMSG=2:"ACTION PENDING",DGMSG=0:"REFUSED:",1:"UNANSWERED")
"RTN","DGMHVUTL",252,0)
 Q
"RTN","DGMHVUTL",253,0)
ENDATE(DFN,INTERNAL) ; Most recent date mhv Registration was updated
"RTN","DGMHVUTL",254,0)
 N DGENDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD
"RTN","DGMHVUTL",255,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537030" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLD")
"RTN","DGMHVUTL",256,0)
 S DGENDT=$G(MHVFLD(2,DFN_",",537030,"I")) I $G(INTERNAL) Q DGENDT
"RTN","DGMHVUTL",257,0)
 I DGENDT S DGENDT=$$FMTE^XLFDT(DGENDT,2)
"RTN","DGMHVUTL",258,0)
 S $P(DGENDT,"@",2)=$P($P(DGENDT,"@",2),":",1,2)
"RTN","DGMHVUTL",259,0)
 S DGENDT=$P(DGENDT,"@")
"RTN","DGMHVUTL",260,0)
 Q DGENDT
"RTN","DGMHVUTL",261,0)
AUTHDATE(DFN,INTERNAL) ; Most recent date mhv authentication was updated
"RTN","DGMHVUTL",262,0)
 N DGAUTHDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD
"RTN","DGMHVUTL",263,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537031" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLD")
"RTN","DGMHVUTL",264,0)
 S DGAUTHDT=$G(MHVFLD(2,DFN_",",537031,"I")) I $G(INTERNAL) Q DGAUTHDT
"RTN","DGMHVUTL",265,0)
 I DGAUTHDT S DGAUTHDT=$$FMTE^XLFDT(DGAUTHDT,2)
"RTN","DGMHVUTL",266,0)
 S $P(DGAUTHDT,"@",2)=$P($P(DGAUTHDT,"@",2),":",1,2)
"RTN","DGMHVUTL",267,0)
 S DGAUTHDT=$P(DGAUTHDT,"@")
"RTN","DGMHVUTL",268,0)
 Q DGAUTHDT
"RTN","DGMHVUTL",269,0)
MSGDATE(DFN,INTERNAL) ; Most recent date mhv secure messaging was updated
"RTN","DGMHVUTL",270,0)
 N DGMSGDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD
"RTN","DGMHVUTL",271,0)
 S DIQ(0)="I",DIC=2,DA=DFN,DR="537032" D GETS^DIQ(DIC,DFN,DR,"I","MHVFLD")
"RTN","DGMHVUTL",272,0)
 S DGMSGDT=$G(MHVFLD(2,DFN_",",537032,"I")) I $G(INTERNAL) Q DGMSGDT
"RTN","DGMHVUTL",273,0)
 I DGMSGDT S DGMSGDT=$$FMTE^XLFDT(DGMSGDT,2)
"RTN","DGMHVUTL",274,0)
 S $P(DGMSGDT,"@",2)=$P($P(DGMSGDT,"@",2),":",1,2)
"RTN","DGMHVUTL",275,0)
 S DGMSGDT=$P(DGMSGDT,"@")
"RTN","DGMHVUTL",276,0)
 Q DGMSGDT
"RTN","DGMHVUTL",277,0)
MHVENABL() ; Get value of "Enable MyHealtheVet Prompts?" from MAS Parameter (#43) file
"RTN","DGMHVUTL",278,0)
 ; This API is checked to determine if the MyHealtheVet functionality is enable or not.
"RTN","DGMHVUTL",279,0)
 N DIQ,DIC,DA,DR,MHVFLDS
"RTN","DGMHVUTL",280,0)
 S DIQ(0)="I",DIC=43,DA=1,DR="1100.07" D GETS^DIQ(DIC,DA,DR,"I","MHVFLDS")
"RTN","DGMHVUTL",281,0)
 Q +$G(MHVFLDS(43,DA_",",1100.07,"I"))
"RTN","DGPAR")
0^9^B25879398^B25171023
"RTN","DGPAR",1,0)
DGPAR ;ALB/MRL - ADT PARAMETER ENTRY/EDIT ; 07 MAR 87
"RTN","DGPAR",2,0)
 ;;5.3;Registration;**51,86,93,109,214,343,903**;Aug 13, 1993;Build 82
"RTN","DGPAR",3,0)
 I '$D(^DG(43,1,0))#2 S DA=1,^DG(43,1,0)=1,DIK="^DG(43," D IX1^DIK
"RTN","DGPAR",4,0)
WR D DT^DICRW S U="^",DGHEAD="PIMS VERSION "_$S('$D(^DG(43,1,"VERSION")):"'UNKNOWN'",^("VERSION")[".":^("VERSION"),1:^("VERSION")_".0")_" PARAMETER ENTRY/EDIT",IOP="HOME" D ^%ZIS K IOP
"RTN","DGPAR",5,0)
 W @IOF,!?20,DGHEAD,! S X="",$P(X,"=",79)="" W X F I=0,"GL","BT","SCLR","DGPRE","REC","PH" S DGNOD(I)=$S($D(^DG(43,1,I)):^(I),1:"")
"RTN","DGPAR",6,0)
 S DGMULT=+$P(DGNOD("GL"),"^",2),DGPTFP=+$P(DGNOD(0),"^",31) W !,"[1] Medical Center Name : ",$S($D(^DG(40.8,+$P(DGNOD("GL"),"^",3),0)):$P(^(0),"^",1),1:"NONE SPECIFIED"),?59,"Affiliated: ",$S(+$P(DGNOD("GL"),"^",4):"YES",1:"NO")
"RTN","DGPAR",7,0)
 W !?4,"Multidivisional     : ",$S(+$P(DGNOD("GL"),"^",2):"YES",1:"NO")
"RTN","DGPAR",8,0)
 W !?4,"Nursing Home Wards  : ",$S(+$P(DGNOD(0),"^",20):"YES",1:"NO")
"RTN","DGPAR",9,0)
 W ?52,"Domiciliary Wards: ",$S(+$P(DGNOD(0),"^",21):"YES",1:"NO")
"RTN","DGPAR",10,0)
 W !?4,"System Timeout Sec. : ",+$P(DGNOD(0),"^",5),?51,"Print PTF Messages: ",$S($P(DGNOD(0),"^",31):"YES",1:"NO")
"RTN","DGPAR",11,0)
 ;W !?4,"G&L Earliest Date   : " S Y=$P(DGNOD("GL"),"^",1) X:Y]"" ^DD("DD") W $S(Y]"":Y,1:"NONE SPECIFIED")
"RTN","DGPAR",12,0)
 W !?4,"Default PTF Printer : ",$S($P(DGNOD(0),"^",19)]"":$P(DGNOD(0),"^",19),1:"NONE SPECIFIED"),?55,"High Intensity: ",$S($P(DGNOD(0),"^",36):"ON",1:"OFF")
"RTN","DGPAR",13,0)
 W !?4,"Consistency Checker : ",$S($P(DGNOD(0),"^",37):"ON",1:"OFF"),?50,"Abbreviated Inquiry: ",$S($P(DGNOD(0),"^",38):"YES",1:"NO")
"RTN","DGPAR",14,0)
 W !?4,"Auto PTF Messages   : ",$S($P(DGNOD(0),"^",40)!($P(DGNOD(0),"^",40)']""):"YES",1:"NO"),?51,"Show Status Screen: ",$S($P(DGNOD(0),"^",34):"YES",1:"NO")
"RTN","DGPAR",15,0)
 S DGX=46 W !!,"[2] Days to Update Medicaid",?31,": ",$S('$P(^DG(43,1,0),U,46):365,1:+$P(^(0),U,46))
"RTN","DGPAR",16,0)
 W ?45,"Maintain G&L Corrections: " S DGX=29,DGX1="DAY" D DAY W !?4,"Disposition late",?31,": " S DGX=7,DGX1="HOUR" D DAY
"RTN","DGPAR",17,0)
 S DGX=8 W ?51,"Supplemental 10/10: " D DO
"RTN","DGPAR",18,0)
 S DGX=27 W !?4,"Ask HINQ at Registration",?31,": " D DO
"RTN","DGPAR",19,0)
 S DGX=17 W ?46,"DRUG PROFILE with 10/10: " D DO
"RTN","DGPAR",20,0)
 I $P(^DG(43,1,0),U,17) D
"RTN","DGPAR",21,0)
 .S DGX=44 W !?4,"CHOICE OF DRUG PROFILE?",?31,": " D DO
"RTN","DGPAR",22,0)
 .W ?49,"Default Drug Profile: "
"RTN","DGPAR",23,0)
 .S X=$P(^DG(43,1,0),U,45) W $S(X="A":"ACTION",1:"INFO.")
"RTN","DGPAR",24,0)
 S X="GMTSDVR" X ^%ZOSF("TEST") I $T I $T(ENXQ^GMTSDVR)]"" S DGHSFLG=1
"RTN","DGPAR",25,0)
 W !?4,"HEALTH SUMMARY with 10/10  : " W:'$G(DGHSFLG) "N/A"
"RTN","DGPAR",26,0)
 I $G(DGHSFLG) D
"RTN","DGPAR",27,0)
 .N DIC,X,Y
"RTN","DGPAR",28,0)
 .S DGX=42 D DO
"RTN","DGPAR",29,0)
 .W ?47,"Default Health Summary: "
"RTN","DGPAR",30,0)
 .S X=$P($G(^DG(43,1,0)),U,43),DIC=142,DIC(0)="NX"
"RTN","DGPAR",31,0)
 .D ^DIC
"RTN","DGPAR",32,0)
 .W $S(Y<0:"NONE",1:$E($P(Y,U,2),1,8))
"RTN","DGPAR",33,0)
 K DGHSFLG
"RTN","DGPAR",34,0)
EMB S DGX=28 W !?4,"Ask EMBOSS at Registration : " D DO
"RTN","DGPAR",35,0)
 S DGX=30 W ?50,"Use Nearest Printer: " D DO
"RTN","DGPAR",36,0)
 W !?4,"Reg. Template (LOCAL)",?31,": ",$S('$P(DGNOD(0),"^",35):"NONE SPECIFIED",'$D(^DIE(+$P(DGNOD(0),"^",35),0)):"NONE SPECIFIED",1:$P(^DIE(+$P(DGNOD(0),"^",35),0),"^",1))
"RTN","DGPAR",37,0)
 W ?53,"Use Temp Address: ",$S($P(DGNOD("BT"),"^",3):"YES",1:"NO")
"RTN","DGPAR",38,0)
 W !?4,"Default Code Sheet Printer : ",$S($P(DGNOD(0),"^",25)]"":$P(DGNOD(0),"^",25),1:"NONE SPECIFIED"),?51,"Ask Device in Reg.: ",$S($P(DGNOD(0),"^",39):"YES",1:"NO")
"RTN","DGPAR",39,0)
 S DGX=33 W !?4,"Days to Maintain Sens. Data: ",$S('$P(^DG(43,1,0),"^",33):"Forever",1:+$P(^(0),"^",33))
"RTN","DGPAR",40,0)
 S DGX=47 W ?49,"Print Encounter Form",?31,": " D DO
"RTN","DGPAR",41,0)
 W !?4,"Default EF Printer",?31,": ",$S($P(DGNOD(0),"^",48)]"":$P(DGNOD(0),"^",48),1:"NONE SPECIFIED")
"RTN","DGPAR",42,0)
REC ;Write PATIENT (#2) file record access parameter
"RTN","DGPAR",43,0)
 W !?4,"Restrict PATIENT access    : ",$S($P($G(DGNOD("REC")),U)=1:"YES",1:"NO")
"RTN","DGPAR",44,0)
 W !?4,"Purple Heart Sort",?31,": ",$S($P($G(DGNOD("PH")),U)="A":"Ascending",1:"Descending")
"RTN","DGPAR",45,0)
PREREG ; write pre-registration parameters
"RTN","DGPAR",46,0)
 W !!?4,"[Pre-Registration]"
"RTN","DGPAR",47,0)
 W !?4,"Sort Method",?31,": ",$P($G(DGNOD("DGPRE")),U),?46,"Background Job Function: ",$P($G(DGNOD("DGPRE")),U,3)
"RTN","DGPAR",48,0)
 W !?4,"Days Between Calls",?31,": ",$P($G(DGNOD("DGPRE")),U,2),?41,"Days to Maintain Log Entries: ",$P($G(DGNOD("DGPRE")),U,4)
"RTN","DGPAR",49,0)
 W !?4,"Days to Pull Appointments",?31,": ",$P($G(DGNOD("DGPRE")),U,5),?54,"Run for Weekend: ",$S($P($G(DGNOD("DGPRE")),U,6):"YES",1:"NO")
"RTN","DGPAR",50,0)
 ;
"RTN","DGPAR",51,0)
 I +$P($G(^DG(43,1,"DGPREC",0)),U,3)>0 D
"RTN","DGPAR",52,0)
 . W !!?4,"Excluded Clinics:"
"RTN","DGPAR",53,0)
 . N NDX,LNDX
"RTN","DGPAR",54,0)
 . S LNDX=1
"RTN","DGPAR",55,0)
 . S NDX="" F  S NDX=$O(^DG(43,1,"DGPREC","B",NDX)) Q:'NDX  D
"RTN","DGPAR",56,0)
 .. I LNDX=1 W !?4,$E($P(^SC(NDX,0),U),1,20) S LNDX=2 Q
"RTN","DGPAR",57,0)
 .. I LNDX=2 W ?30,$E($P(^SC(NDX,0),U),1,20) S LNDX=3 Q
"RTN","DGPAR",58,0)
 .. I LNDX=3 W ?55,$E($P(^SC(NDX,0),U),1,20) S LNDX=1 Q
"RTN","DGPAR",59,0)
 ;
"RTN","DGPAR",60,0)
 I +$P($G(^DG(43,1,"DGPREE",0)),U,3)>0 D
"RTN","DGPAR",61,0)
 . W !!?4,"Excluded Eligibilities:"
"RTN","DGPAR",62,0)
 . N NDX,LNDX
"RTN","DGPAR",63,0)
 . S LNDX=1
"RTN","DGPAR",64,0)
 . S NDX="" F  S NDX=$O(^DG(43,1,"DGPREE","B",NDX)) Q:'NDX  D
"RTN","DGPAR",65,0)
 .. I LNDX=1 W !?4,$E($P(^DIC(8,NDX,0),U),1,20) S LNDX=2 Q
"RTN","DGPAR",66,0)
 .. I LNDX=2 W ?30,$E($P(^DIC(8,NDX,0),U),1,20) S LNDX=3 Q
"RTN","DGPAR",67,0)
 .. I LNDX=3 W ?55,$E($P(^DIC(8,NDX,0),U),1,20) S LNDX=1 Q
"RTN","DGPAR",68,0)
 W !?4,"Enable My HealtheVet Prompts",?32,": ",$S(+$P($G(DGNOD("DGPRE")),U,7)=1:"YES",1:"NO")
"RTN","DGPAR",69,0)
 ;
"RTN","DGPAR",70,0)
DIV ; write division parameters
"RTN","DGPAR",71,0)
 W !!,"[3]" I DGMULT W ?4,"Divisions: " F I=0:0 S I=$O(^DG(40.8,I)) Q:'I  S X=$P(^(I,0),"^",1)_$S($P(^(0),"^",2)]"":" ("_$P(^(0),"^",2)_"), ",1:"") W:$L(X)>(65-$X) !?15 W X
"RTN","DGPAR",72,0)
 I 'DGMULT S DGD=+$P(DGNOD("GL"),"^",3),DGDV=$S($D(^DG(40.8,DGD,"DEV")):^("DEV"),1:""),DGZE=$S($D(^(0)):^(0),1:"") D DEV^DGPAR1
"RTN","DGPAR",73,0)
 G ^DGPAR1
"RTN","DGPAR",74,0)
DAY S DGD=+$P(DGNOD(0),"^",DGX) I DGX=29,'DGD W "FOREVER" Q
"RTN","DGPAR",75,0)
 W DGD,"-",DGX1,$S(DGD=1:"",1:"S") Q
"RTN","DGPAR",76,0)
DO I DGX'=8 W $S('$P(DGNOD(0),"^",DGX):"NO",1:"YES") Q
"RTN","DGPAR",77,0)
 W $S('$P(DGNOD(0),"^",DGX):"YES",1:"NO") Q
"RTN","DGPAR1")
0^10^B23270657^B23171183
"RTN","DGPAR1",1,0)
DGPAR1 ;ALB/MRL - ADT PARAMETERS ENTRY/EDIT ; 24 Feb 2000  6:52 PM
"RTN","DGPAR1",2,0)
 ;;5.3;Registration;**51,62,86,93,109,214,265,277,343,903**;Aug 13, 1993;Build 82
"RTN","DGPAR1",3,0)
 S DGERR=0 D L W !,"Enter " W:DGMULT "'D' to view DIVISIONS, " W "1-3 to EDIT, or RETURN to QUIT:  " R DGAN:DTIME G Q1:'$T!(DGAN["^")!(DGAN']"") I $S("Dd"[$E(DGAN):0,DGAN?1N.E:0,1:1) G HELP
"RTN","DGPAR1",4,0)
 I "Dd"[$E(DGAN) G DIV:DGMULT,HELP
"RTN","DGPAR1",5,0)
 I DGAN?1N1"-"1N S DGAN1=DGAN,DGAN="" F I=+DGAN1:1:$P(DGAN1,"-",2) S DGAN=DGAN_I_","
"RTN","DGPAR1",6,0)
 S DGAN1=DGAN,DGAN="" F J=1:1 S I=$P(DGAN1,",",J) Q:I=""  I I'>DGMULT+2 S:I'["-" DGAN=DGAN_I_"," I I["-" S I1=$P(I,"-",1),I2=$P(I,"-",2) F I3=I1:1:I2 I I3'>DGMULT+2,DGAN'[(","_I3_",") S DGAN=DGAN_I3_","
"RTN","DGPAR1",7,0)
 S DGAN=","_DGAN,DR="" S:DGAN[(",1,") DR=DR_$P($T(1),";;",2) S:DGAN[(",2,") DR=DR_$P($T(2),";;",2) I DR]"" S DIE="^DG(43,",DA=1 D ^DIE K DR,DIE,DA
"RTN","DGPAR1",8,0)
 I DGAN'[",3," D Q G ^DGPAR
"RTN","DGPAR1",9,0)
 G ^DGPAR:DGAN'[(",3,") I 'DGMULT S DIE="^DG(40.8,",DA=+$P(DGNOD("GL"),"^",3),DR=$P($T(3),";;",2) I $D(^DG(40.8,DA,0)) D ^DIE
"RTN","DGPAR1",10,0)
 I 'DGMULT D Q G ^DGPAR
"RTN","DGPAR1",11,0)
 F DGI=0:0 S DIC="^DG(40.8,",DIC(0)="AEQML" D ^DIC Q:Y'>0  D:$P(Y,U,3) VASITE(Y) S DIE=DIC,DA=+Y,DR=$P($T(3),";;",2) D ^DIE
"RTN","DGPAR1",12,0)
 D Q G ^DGPAR
"RTN","DGPAR1",13,0)
Q G Q1:'$D(DFN1),Q:DFN1'=+DFN1 I $D(SDMD),SDMD=1,$D(^DIC(4,+$P(^DG(40.8,DFN1,0),"^",2),0)) S ^DIC(4,$P(^DG(40.8,DFN1,0),"^",2),"DIV")="Y"
"RTN","DGPAR1",14,0)
 I $D(SDMD),SDMD=0,$D(^DIC(4,$P(^DG(40.8,DFN1,0),"^",2),0)) K ^DIC(4,$P(^DG(40.8,DFN1,0),"^",2),"DIV")
"RTN","DGPAR1",15,0)
Q1 K C,DGIND,DA,DFN1,DGERR,DGAN,DGAN1,DGD,DGIN,DGDV,DGDV1,DGHEAD,DGI,DGMULT,DGNOD,DGPTFP,DG,SDMD,X,DGX,DGX1,DGZE,DIC,DIE,DIK,DR,I,I1,I2,I3,J,X,X1,Y Q
"RTN","DGPAR1",16,0)
DIV S (C,DGERR)=0 D H1
"RTN","DGPAR1",17,0)
 F DGD=0:0 S DGD=$O(^DG(40.8,DGD)) Q:'DGD!(DGERR)  S DGZE=$S($D(^(DGD,0)):^(0),1:""),DGDV=$S($D(^("DEV")):^("DEV"),1:"") S X=$P(DGZE,"^",1)_" DIVISION",X1="",$P(X1,"-",$L(X))="" W !,X,!,X1,!?4 D DEV W ! S C=C+1 D:'(C#2) H
"RTN","DGPAR1",18,0)
 G SC
"RTN","DGPAR1",19,0)
 ;CHANGED $N TO $O BELOW
"RTN","DGPAR1",20,0)
H Q:'+$O(^DG(40.8,+DGD))  I C>0 D L W !,"Press RETURN to see more DIVISION PARAMETERS:  " R X:DTIME I X["^" S DGERR=1 Q
"RTN","DGPAR1",21,0)
H1 W @IOF,!,"DIVISION PARAMETERS",$S(C>0:", CONTINUED",1:""),! S X="",$P(X,"=",79)="" W X Q
"RTN","DGPAR1",22,0)
DEV W ?4,"Print Wristbands",?25,": ",$S($P(DGZE,"^",8)="Y":"YES",1:"NO"),!
"RTN","DGPAR1",23,0)
 S DGDV1="AA<96 HOURS^AA" S X=$P(DGZE,"^",4) W ?4,"'",$P(DGDV1,"^",1),"' on G&L",?25,": ",$S($P(DGZE,"^",4):"YES",1:"NO")
"RTN","DGPAR1",24,0)
 D EN^DGPAR2
"RTN","DGPAR1",25,0)
P Q:'DGPTFP  S X=$S($P(DGDV,"^",4)]"":$P(DGDV,"^",4),1:$P(DGNOD(0),"^",19)) W !?4,"Division PTF printer",?25,": ",$S(X]"":X,1:"NEEDS TO BE SPECIFIED") Q
"RTN","DGPAR1",26,0)
HELP W @IOF,!,"ADT PARAMETER ENTRY/EDIT, HELP SCREEN"
"RTN","DGPAR1",27,0)
 S X="",$P(X,"=",79)="" W !,X
"RTN","DGPAR1",28,0)
 W !,">>> Enter RETURN to QUIT this option.",!
"RTN","DGPAR1",29,0)
 I DGMULT W !,">>> Enter a 'D' to display individual DIVISION parameters.",!
"RTN","DGPAR1",30,0)
 W !,">>> NOTE: To view and edit Scheduling parameters use the 'Scheduling Parameters'"
"RTN","DGPAR1",31,0)
 W !,"          option under the 'Supervisor Menu' in the Scheduling package.",!
"RTN","DGPAR1",32,0)
 W !,">>> Enter the field group number(s) you wish to edit using commas"
"RTN","DGPAR1",33,0)
 W !,"    and or dashes as delimiters."
"RTN","DGPAR1",34,0)
 W !!,"Edit Data Group(s) [Select by number]:"
"RTN","DGPAR1",35,0)
 W !,"-------------------------------------"
"RTN","DGPAR1",36,0)
 W !,"[1] Primary facility parameters, which if multi-divisional facility apply to all",!?4,"divisions, such as 'PRINT PTF MESSAGE?', etc."
"RTN","DGPAR1",37,0)
 W !!,"[2] ADT Specific parameters which, again, if the facility is multi-divisional",!?4,"apply to all divisions.  Includes such items as 'at what point is a",!?4,"disposition considered late', etc."
"RTN","DGPAR1",38,0)
 W !!,"[3] "
"RTN","DGPAR1",39,0)
 I DGMULT W "The names of the individual divisions associated with this facility.  You",!?4,"may enter a 'D' at the 'ENTER' prompt to view division specific data."
"RTN","DGPAR1",40,0)
 I 'DGMULT W "The device/G&L parameters associated with this facility."
"RTN","DGPAR1",41,0)
 G SC
"RTN","DGPAR1",42,0)
 ;
"RTN","DGPAR1",43,0)
L F I=$Y:1:21 W !
"RTN","DGPAR1",44,0)
 Q
"RTN","DGPAR1",45,0)
SC D L R:'DGERR !,"Press RETURN to return to SCREEN:  ",X:DTIME G ^DGPAR
"RTN","DGPAR1",46,0)
 ;
"RTN","DGPAR1",47,0)
VASITE(Y) ; -- add new time sensitive entry
"RTN","DGPAR1",48,0)
 N DIC,DIE,DR,DFN1,SDMD,DGI,VASITE
"RTN","DGPAR1",49,0)
 S VASITE("NEW")=Y D NEW^VASITE1
"RTN","DGPAR1",50,0)
 Q
"RTN","DGPAR1",51,0)
 ;
"RTN","DGPAR1",52,0)
1 ;;12;S DFN1=X;13;11;S SDMD=X,DGIND=1;15;16;4;9.6;9.5;9;34;76;77;37;38;
"RTN","DGPAR1",53,0)
2 ;;46;5.5;6;7;17;8;S:X'=1 Y="@42";44;45;Q;@42;42;S:X'=1 Y="@18";43;Q;@18;18;19;70;722;25;39;33;47;S:X'=1 Y="@48";48;Q;@48;1201;1100.01;1100.02;1100.03;1100.04;1100.05;1100.06;1110;1120;1202;1100.07
"RTN","DGPAR1",54,0)
3 ;;35.01;35.03;S:X'="Y"&($P($G(^DG(40.8,DA,"MT")),U)'="Y") Y="@36";35.02;@36;S:'DGMULT Y=.08;3;S:X=1 Y=.07;.08;4;5;6;.07;7;8;9;S:'$P(DGNOD(0),"^",31) Y=0;9.1;
"RTN","DGPREP1")
0^2^B42976792^B35442672
"RTN","DGPREP1",1,0)
DGPREP1 ;ALB/SCK - Program to Display Pre-Registration List Cont. 1 ; 12/9/03 3:22pm
"RTN","DGPREP1",2,0)
 ;;5.3;Registration;**109,136,574,903**;Aug 13, 1993;Build 82
"RTN","DGPREP1",3,0)
 ;
"RTN","DGPREP1",4,0)
 ; Subroutine DIREDT Linetag 26-29 added by patch DG*5.3*903 which was submitted to 
"RTN","DGPREP1",5,0)
 ; OSEHRA on 04/02/2015 by HP. This update was authored by James Harris 2014-2015
"RTN","DGPREP1",6,0)
 ;
"RTN","DGPREP1",7,0)
 Q
"RTN","DGPREP1",8,0)
EH ; Edit call log information
"RTN","DGPREP1",9,0)
 ;   Variables
"RTN","DGPREP1",10,0)
 ;     PTIFN - Patients IEN returned from the SELPAT procedure 
"RTN","DGPREP1",11,0)
 ;
"RTN","DGPREP1",12,0)
 N PTIFN,D,X,DA,DR
"RTN","DGPREP1",13,0)
 S PTIFN=""
"RTN","DGPREP1",14,0)
 D SELPAT
"RTN","DGPREP1",15,0)
 Q:'$D(PTIFN)
"RTN","DGPREP1",16,0)
 S DIC="^DGS(41.43,",DIC(0)="EQZ"
"RTN","DGPREP1",17,0)
 S X=PTIFN,D="C"
"RTN","DGPREP1",18,0)
 S DIC("A")="Select LOG ENTRY: "
"RTN","DGPREP1",19,0)
 S DIC("S")="I $P(^(0),U,2)=PTIFN"
"RTN","DGPREP1",20,0)
 ;
"RTN","DGPREP1",21,0)
 D IX^DIC K DIC
"RTN","DGPREP1",22,0)
 ;
"RTN","DGPREP1",23,0)
 I Y>0 D
"RTN","DGPREP1",24,0)
 . S DA=+Y
"RTN","DGPREP1",25,0)
 . S DIE="^DGS(41.43,"
"RTN","DGPREP1",26,0)
 . S DR="3;2///^S X=$P(^VA(200,DUZ,0),U)"
"RTN","DGPREP1",27,0)
 . D ^DIE K DIE
"RTN","DGPREP1",28,0)
 . I '$D(Y) D
"RTN","DGPREP1",29,0)
 .. S DGPDFN=PTIFN
"RTN","DGPREP1",30,0)
 .. D BLDHIST^DGPREP0
"RTN","DGPREP1",31,0)
 .. S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",32,0)
 .. S X=$$SETFLD^VALM1(DGPTAT,X,"HIST")
"RTN","DGPREP1",33,0)
 .. S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",34,0)
 S VALMBCK="R"
"RTN","DGPREP1",35,0)
 Q
"RTN","DGPREP1",36,0)
 ;
"RTN","DGPREP1",37,0)
SELPAT ;  Select patient if no patient is passed in
"RTN","DGPREP1",38,0)
 N VALMI,VALMAT,VALMY,X
"RTN","DGPREP1",39,0)
 D FULL^VALM1
"RTN","DGPREP1",40,0)
 D EN^VALM2(XQORNOD(0),"S") S VALMI=0
"RTN","DGPREP1",41,0)
 I '$D(VALMY) S VALMBCK="R" Q
"RTN","DGPREP1",42,0)
 S DGPN1="",DGPCH=$O(VALMY(DGPN1))
"RTN","DGPREP1",43,0)
 S PTIFN="",PTIFN=$O(^TMP("DGPRERG",$J,"DFN",DGPCH,PTIFN))
"RTN","DGPREP1",44,0)
 Q
"RTN","DGPREP1",45,0)
 ;
"RTN","DGPREP1",46,0)
EDIT ;  Edit Patient Information
"RTN","DGPREP1",47,0)
 ;  Variables
"RTN","DGPREP1",48,0)
 ;   DGPDIV    - Division IEN from ^TMP
"RTN","DGPREP1",49,0)
 ;   DGPSTMP   - Date/Time stamp from UPDLOG function
"RTN","DGPREP1",50,0)
 ;   DGPIFN    - Patients IEN from ^TMP
"RTN","DGPREP1",51,0)
 ;   DGPP1-3,5 - Local Var's for $O
"RTN","DGPREP1",52,0)
 ;   DGPNEW    - 
"RTN","DGPREP1",53,0)
 ;   DGPFLG    - Flag used to indicate a connect status of 'C'
"RTN","DGPREP1",54,0)
 ;   DGPST     - Call status returned by SELST function
"RTN","DGPREP1",55,0)
 ;   DGPDA     - IEN of Call log entry returned from UPDLOG function
"RTN","DGPREP1",56,0)
 ;   DGPCH     - Entry in the VALMY, selected entries, array
"RTN","DGPREP1",57,0)
 ;   
"RTN","DGPREP1",58,0)
 N VALMI,VALMAT,VALMY,X,DGPN5,DGPDIV,DGPSTMP,DGPIFN,DGPP1,DGPP2,DGPP3,DGPNEW,DGPFLG
"RTN","DGPREP1",59,0)
 ;
"RTN","DGPREP1",60,0)
 D FULL^VALM1
"RTN","DGPREP1",61,0)
 D EN^VALM2(XQORNOD(0),"S") S VALMI=0
"RTN","DGPREP1",62,0)
 I '$D(VALMY) S VALMBCK="R" Q
"RTN","DGPREP1",63,0)
 S DGPN1="",DGPCH=$O(VALMY(DGPN1))
"RTN","DGPREP1",64,0)
 S DGPIFN="",DGPIFN=$O(^TMP("DGPRERG",$J,"DFN",DGPCH,DGPIFN))
"RTN","DGPREP1",65,0)
 S DGPDIV="",DGPDIV=$O(^TMP("DGPRERG",$J,"DIV",DGPCH,DGPDIV))
"RTN","DGPREP1",66,0)
 S DGNEW=0,DGPFLG=0
"RTN","DGPREP1",67,0)
 ;
"RTN","DGPREP1",68,0)
 ; *** Check patient sensitivity before proceeding
"RTN","DGPREP1",69,0)
 S DIC=2,DIC(0)="ENQ",X=DGPIFN D ^DIC K DIC
"RTN","DGPREP1",70,0)
 Q:Y<0
"RTN","DGPREP1",71,0)
 ;
"RTN","DGPREP1",72,0)
 ; *** Check lock status before continuing
"RTN","DGPREP1",73,0)
 S DGPN5="",DGPN5=$O(^DGS(41.42,"B",DGPIFN,DGPN5))
"RTN","DGPREP1",74,0)
 I DGPN5]"" L +^DGS(41.42,DGPN5):2 I '$T W *7,!,"Another User is Editing this Patient" S VALMBCK="R" Q
"RTN","DGPREP1",75,0)
 ;
"RTN","DGPREP1",76,0)
 S (DA,DFN)=DGPIFN
"RTN","DGPREP1",77,0)
 ;
"RTN","DGPREP1",78,0)
 S DGPFLG=1
"RTN","DGPREP1",79,0)
 S DGPSTMP=""
"RTN","DGPREP1",80,0)
 D INITLE(.DGPSTMP)
"RTN","DGPREP1",81,0)
 ;
"RTN","DGPREP1",82,0)
 I DGPCH]""&(DGPFLG) D
"RTN","DGPREP1",83,0)
 . S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",84,0)
 . ;S X=$$SETSTR^VALM1("*",X,8,1)
"RTN","DGPREP1",85,0)
 . I $G(DGPSTMP)]"" S X=$$SETSTR^VALM1($$FMTE^XLFDT(DGPSTMP,"2D"),X,70,8)
"RTN","DGPREP1",86,0)
 . S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",87,0)
 . S DIE="^DGS(41.42,",DA=DGPN5
"RTN","DGPREP1",88,0)
 . S DR="4///Y" I DGPSTMP]"" S DR=DR_";3///^S X=DGPSTMP"
"RTN","DGPREP1",89,0)
 . D ^DIE K DIE
"RTN","DGPREP1",90,0)
 L -^DGS(41.42,DGPN5)
"RTN","DGPREP1",91,0)
 K DGPENT,DGPN1,DGPCH,DGPLOC,DGPST,DGPN5,DGPFLG
"RTN","DGPREP1",92,0)
 Q
"RTN","DGPREP1",93,0)
 ;
"RTN","DGPREP1",94,0)
INITLE(DGPY) ; Initialize for Load/Edit
"RTN","DGPREP1",95,0)
 ;   Variables
"RTN","DGPREP1",96,0)
 ;     Input:
"RTN","DGPREP1",97,0)
 ;        DGPY - Null value
"RTN","DGPREP1",98,0)
 ;
"RTN","DGPREP1",99,0)
 ;     Returns:
"RTN","DGPREP1",100,0)
 ;        DGPY - Returns the date/time stamp entered into ^DGS(41.41,.
"RTN","DGPREP1",101,0)
 ;
"RTN","DGPREP1",102,0)
 ;     Local:
"RTN","DGPREP1",103,0)
 ;        DGPRFLG - This flag is used by the Patient Load/Edit routines
"RTN","DGPREP1",104,0)
 ;                  to indicate they were called by preregistration
"RTN","DGPREP1",105,0)
 ;        DGPLOC  - Flag used by DG10 to indicate preselection of a patient
"RTN","DGPREP1",106,0)
 ;
"RTN","DGPREP1",107,0)
 N DGPRFLG
"RTN","DGPREP1",108,0)
 S (DGPRFLG,DGPLOC)=1
"RTN","DGPREP1",109,0)
 W !!
"RTN","DGPREP1",110,0)
 D ^DG10
"RTN","DGPREP1",111,0)
 Q:$G(DGPFLG)&($G(DGRPOUT))
"RTN","DGPREP1",112,0)
 ;
"RTN","DGPREP1",113,0)
 S DGPST=$$SELST
"RTN","DGPREP1",114,0)
 I DGPST']"" S VALMBCK="R" Q
"RTN","DGPREP1",115,0)
 ;
"RTN","DGPREP1",116,0)
 I DGPST'="L" D
"RTN","DGPREP1",117,0)
 . S DGPDA=$$UPDLOG(DGPIFN,DGPST,DGPDIV) Q:DGPDA'>0
"RTN","DGPREP1",118,0)
 . I '$G(DGMODE),$P($G(^DGS(41.43,DGPDA,0)),U,4)]"" D
"RTN","DGPREP1",119,0)
 .. S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",120,0)
 .. S DGPP1=$E(X,1,34),DGPP2=$E(X,35,38),DGPP3=$E(X,39,110)
"RTN","DGPREP1",121,0)
 .. S DGPP2=$P(^DGS(41.43,DGPDA,0),U,4)_DGPP2
"RTN","DGPREP1",122,0)
 .. S X=DGPP1_$E(DGPP2,1,4)_DGPP3
"RTN","DGPREP1",123,0)
 .. S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",124,0)
 ;
"RTN","DGPREP1",125,0)
 W !
"RTN","DGPREP1",126,0)
 S DIR(0)="YA",DIR("A")="Date/Time stamp this patient? ",DIR("B")="YES"
"RTN","DGPREP1",127,0)
 D ^DIR K DIR
"RTN","DGPREP1",128,0)
 W !
"RTN","DGPREP1",129,0)
 I Y D
"RTN","DGPREP1",130,0)
 . K DD,DO
"RTN","DGPREP1",131,0)
 . S DGPY=$$NOW^XLFDT
"RTN","DGPREP1",132,0)
 . S DIC="^DGS(41.41,",DIC(0)="EQZ",X=DFN
"RTN","DGPREP1",133,0)
 . S DIC("DR")="1///^S X=DGPY;2////^S X=DUZ"
"RTN","DGPREP1",134,0)
 . D FILE^DICN
"RTN","DGPREP1",135,0)
 . K DIC
"RTN","DGPREP1",136,0)
 ;
"RTN","DGPREP1",137,0)
 Q
"RTN","DGPREP1",138,0)
STAT ; Display call history
"RTN","DGPREP1",139,0)
 K PTIFN D SELPAT
"RTN","DGPREP1",140,0)
 I $D(PTIFN) D
"RTN","DGPREP1",141,0)
 . D EN^DGPREP2
"RTN","DGPREP1",142,0)
 K PTIFN
"RTN","DGPREP1",143,0)
 Q
"RTN","DGPREP1",144,0)
 ;
"RTN","DGPREP1",145,0)
SELST() ;  Function to select status for call log
"RTN","DGPREP1",146,0)
 ;   Returns:
"RTN","DGPREP1",147,0)
 ;       Status code as a SOC
"RTN","DGPREP1",148,0)
 ;
"RTN","DGPREP1",149,0)
 K DIRUT
"RTN","DGPREP1",150,0)
 N DIR
"RTN","DGPREP1",151,0)
 W !!
"RTN","DGPREP1",152,0)
 S DIR(0)="41.43,3"
"RTN","DGPREP1",153,0)
 S DIR("A")="STATUS OF CALL",DIR("B")="CONNECTED"
"RTN","DGPREP1",154,0)
 S DIR("?",1)="Enter the status of the current call from the list below."
"RTN","DGPREP1",155,0)
 S DIR("?")="Entries must be in uppercase, and match on of these codes."
"RTN","DGPREP1",156,0)
 D ^DIR K DIR
"RTN","DGPREP1",157,0)
 Q $G(Y)
"RTN","DGPREP1",158,0)
 ;
"RTN","DGPREP1",159,0)
UPDLOG(DFN,DGPS,DGPDV) ;  Update PRE-REGISTRATION CALL LOG File, #41.43
"RTN","DGPREP1",160,0)
 ;
"RTN","DGPREP1",161,0)
 ;  Variables
"RTN","DGPREP1",162,0)
 ;    Input:
"RTN","DGPREP1",163,0)
 ;       DFN   - The IEN of the patient being called
"RTN","DGPREP1",164,0)
 ;       DGPS  - Status of the call attempt
"RTN","DGPREP1",165,0)
 ;       DGPDV - Division IEN (used for sorting)
"RTN","DGPREP1",166,0)
 ;
"RTN","DGPREP1",167,0)
 ;    Returns:
"RTN","DGPREP1",168,0)
 ;        The IEN of the CALL LOG, File #41.43, entry that was added. 
"RTN","DGPREP1",169,0)
 ;        0 is returned if the user ^'s out.
"RTN","DGPREP1",170,0)
 ;
"RTN","DGPREP1",171,0)
 K DD,DO
"RTN","DGPREP1",172,0)
 S DIC="^DGS(41.43,"
"RTN","DGPREP1",173,0)
 S DIC(0)="L"
"RTN","DGPREP1",174,0)
 S X=$$NOW^XLFDT
"RTN","DGPREP1",175,0)
 D FILE^DICN
"RTN","DGPREP1",176,0)
 I Y<0 W *7,"Problem adding to file - PRE-REGISTRATION CALL LOG"
"RTN","DGPREP1",177,0)
 I Y'<0 D
"RTN","DGPREP1",178,0)
 . S DIE="^DGS(41.43,"
"RTN","DGPREP1",179,0)
 . S DR="1////^S X=DFN;2////^S X=DUZ;3///^S X=DGPS;5////^S X=$S(+DGPDV>0:DGPDV,1:"""")"
"RTN","DGPREP1",180,0)
 . S DA=+Y
"RTN","DGPREP1",181,0)
 . D ^DIE K DIE
"RTN","DGPREP1",182,0)
 . I $D(Y) D 
"RTN","DGPREP1",183,0)
 .. S DIK="^DGS(41.43," D ^DIK K DIK
"RTN","DGPREP1",184,0)
 Q +$G(DA)
"RTN","DGPREP1",185,0)
 ;
"RTN","DGPREP1",186,0)
DIREDT ;  Direct edit of a patient in the PRE-REGISTRATION CALL LIST, bypassing the call list.
"RTN","DGPREP1",187,0)
 ;
"RTN","DGPREP1",188,0)
 ;  Variables
"RTN","DGPREP1",189,0)
 ;    DFN    - Patients IEN, set for Load/Edit
"RTN","DGPREP1",190,0)
 ;    DGPDIV - Division IEN from File #41.42
"RTN","DGPREP1",191,0)
 ;    DGPST  - Call Status
"RTN","DGPREP1",192,0)
 ;    DGPIDX - Call List IEN, File #41.42
"RTN","DGPREP1",193,0)
 ;    DGPFLG - Flag for direct patient edit, used for setting 'called' status
"RTN","DGPREP1",194,0)
 ;    DGPSTMP - Date/time stamp
"RTN","DGPREP1",195,0)
 ;
"RTN","DGPREP1",196,0)
 N DFN,DGPDIV,DGPST,DGPIDX,DGPFLG,DGNEW,DGPXX,DGPSTMP,DGPX,DGPIFN,DGMODE
"RTN","DGPREP1",197,0)
 N DGRPOUT,DGMHVOUT,DGMHVNOS
"RTN","DGPREP1",198,0)
 ;
"RTN","DGPREP1",199,0)
 K DTOUT,DUOUT,DIC
"RTN","DGPREP1",200,0)
 S DIC=2,DIC(0)="AEQZM"
"RTN","DGPREP1",201,0)
 S DIC("A")="Select Patient to Preregister: "
"RTN","DGPREP1",202,0)
 S DIC("?")="Select a patient whose preregistration information you want to edit."
"RTN","DGPREP1",203,0)
 D ^DIC K DIC
"RTN","DGPREP1",204,0)
 I $D(DTOUT)!($D(DUOUT))!(Y<0) Q
"RTN","DGPREP1",205,0)
 ;
"RTN","DGPREP1",206,0)
 S (DFN,DGPIFN)=+Y,DGPIDX=""
"RTN","DGPREP1",207,0)
 I $D(^DGS(41.42,"B",DFN)) D  Q:$G(DGPX)
"RTN","DGPREP1",208,0)
 . S DGPIDX=$O(^DGS(41.42,"B",DFN,DGPIDX))
"RTN","DGPREP1",209,0)
 . S DGPDIV=$P($G(^DGS(41.42,DGPIDX,0)),U,2)
"RTN","DGPREP1",210,0)
 . I DGPIDX]"" L +^DGS(41.42,DGPIDX):2 I '$T W *7,!,"Another user is editing this patient." S DGPX=1
"RTN","DGPREP1",211,0)
 ;
"RTN","DGPREP1",212,0)
 D
"RTN","DGPREP1",213,0)
 .;These next 6 lines were added by patch DG*5.3*903
"RTN","DGPREP1",214,0)
 .;This functionality will not be executed if "Enable MyHealtheVet Prompts?" (#1100.07  
"RTN","DGPREP1",215,0)
 .;field in MAS PARAMETERS (43) file is not set to YES (internal value 1)
"RTN","DGPREP1",216,0)
 .Q:+$$MHVENABL^DGMHVUTL()'>0
"RTN","DGPREP1",217,0)
 .N DGABB,DGMHVOUT,DIR
"RTN","DGPREP1",218,0)
 .I '$$MHVOK^DGMHVAC(DFN) D EN^DGMHV(DFN) Q
"RTN","DGPREP1",219,0)
 .D EN^DGMHVAC(DFN)
"RTN","DGPREP1",220,0)
 ;
"RTN","DGPREP1",221,0)
 S DGNEW=0,DGPFLG=1,DGPSTMP="",DGMODE=1
"RTN","DGPREP1",222,0)
 ;
"RTN","DGPREP1",223,0)
 ;  ** Since this is a direct call for a patient, and the particular appt. is not known, set DGPDIV to primary medical center division.
"RTN","DGPREP1",224,0)
 I $G(DGPDIV)']"" D
"RTN","DGPREP1",225,0)
 . S DGPDIV=$$PRIM^VASITE
"RTN","DGPREP1",226,0)
 ;
"RTN","DGPREP1",227,0)
 D INITLE(.DGPSTMP)
"RTN","DGPREP1",228,0)
 ;
"RTN","DGPREP1",229,0)
 I $G(DGRPOUT) G UNLCK
"RTN","DGPREP1",230,0)
 ;
"RTN","DGPREP1",231,0)
 I $G(DGPFLG),DGPIDX]"" D
"RTN","DGPREP1",232,0)
 . S DA=DGPIDX
"RTN","DGPREP1",233,0)
 . S DIE="^DGS(41.42,"
"RTN","DGPREP1",234,0)
 . S DR="4///Y" I DGPSTMP]"" S DR=DR_";3///^S X=DGPSTMP"
"RTN","DGPREP1",235,0)
 . D ^DIE K DIE
"RTN","DGPREP1",236,0)
 ;
"RTN","DGPREP1",237,0)
UNLCK I $G(DGPIDX)]"" L -^DGS(41.42,DGPIDX)
"RTN","DGPREP1",238,0)
 Q
"RTN","DGRPC")
0^5^B33766541^B32590756
"RTN","DGRPC",1,0)
DGRPC    ;ALB/MRL/PJR/PHH/EG/BAJ,TDM,LBD - CHECK CONSISTENCY OF PATIENT DATA ; 6/29/11 3:50pm
"RTN","DGRPC",2,0)
 ;;5.3;Registration;**108,121,314,301,470,489,505,451,568,585,641,653,688,754,797,867,903**;Aug 13, 1993;Build 82
"RTN","DGRPC",3,0)
 ;
"RTN","DGRPC",4,0)
 ; 315 added to OVER99 local variable by patch DG*5.3*903 which was submitted to OSEHRA
"RTN","DGRPC",5,0)
 ; on 04/02/2015 by HP. This update was authored by James Harris 2014-2015 
"RTN","DGRPC",6,0)
 ;
"RTN","DGRPC",7,0)
 ;linetags in routines correspond to IEN of file 38.6
"RTN","DGRPC",8,0)
 ;
"RTN","DGRPC",9,0)
 ;variables:  DGVT = 1 if VETERAN? = YES, 0 if NO
"RTN","DGRPC",10,0)
 ;    DGSC = 1 if SC? = YES, 0 if NO
"RTN","DGRPC",11,0)
 ;    DGCD = 0 node of file EC file (#8)
"RTN","DGRPC",12,0)
 ;        DGRPCOLD = old inconsistencies for pt (separated by ,s)
"RTN","DGRPC",13,0)
 ;   DGCHK = #s to check (separated by ,s)
"RTN","DGRPC",14,0)
 ;   DGLST = next # to check
"RTN","DGRPC",15,0)
 ;    DGER = inconsistencies found (separated by ,s)
"RTN","DGRPC",16,0)
 ;   DGNCK = 1 if missing key elig data...can't process further
"RTN","DGRPC",17,0)
 ;
"RTN","DGRPC",18,0)
 N ANYMSE,CONARR,CONCHK,CONERR,CONSPEC,LOC,I5,I6,DGPMSE
"RTN","DGRPC",19,0)
 N MSECHK,MSESET,MSERR,MSDATERR,RANGE,RANSET,OVER99
"RTN","DGRPC",20,0)
 D ON I $S(('$D(DFN)#2):1,'$D(^DPT(DFN,0)):1,DGER:1,1:0) G KVAR^DGRPCE:DGER
"RTN","DGRPC",21,0)
EN       S:'$D(DGEDCN)#2 DGEDCN=0 I DGEDCN W !!,"Checking data for consistency..."
"RTN","DGRPC",22,0)
 D START:DGEDCN
"RTN","DGRPC",23,0)
 F I=0,.13,.141,.121,.122,.22,.24,.3,.31,.311,.32,.321,.322,.33,.35,.36,.362,.38,.39,.52,.53,"TYPE","VET" S DGP(I)=$G(^DPT(DFN,I))
"RTN","DGRPC",24,0)
 ;Get MSEs from MSE sub-file #2.3216 (DG*5.3*797)
"RTN","DGRPC",25,0)
 I '$D(^DPT(DFN,.3216)) D MOVMSE^DGMSEUTL(DFN)
"RTN","DGRPC",26,0)
 D GETMSE^DGMSEUTL(DFN,.DGPMSE)
"RTN","DGRPC",27,0)
 ;get old inconsistencies
"RTN","DGRPC",28,0)
 S DGRPCOLD="," I $D(^DGIN(38.5,DFN)) F I=0:0 S I=$O(^DGIN(38.5,DFN,"I",I)) Q:'I  S DGRPCOLD=DGRPCOLD_I_","
"RTN","DGRPC",29,0)
 ;find consistencies to check/not check
"RTN","DGRPC",30,0)
 ; DG*5.3*653 modified to exclude checks numbered>99  BAJ  10/25/2005
"RTN","DGRPC",31,0)
 S DGCHK="," F I=0:0 S I=$O(^DGIN(38.6,I)) Q:'I!(I=99)  I $D(^(I,0)),$S(I=2:0,I=51:0,I=9:1,I=10:1,I=13:1,I=14:1,I=22:1,I=52:1,I=53:1,'$P(^(0),"^",5):1,1:0),I'=99 S DGCHK=DGCHK_I_","
"RTN","DGRPC",32,0)
 ; On following line patch DG*5.3*903 added 315 as a new consistency
"RTN","DGRPC",33,0)
 S OVER99=",301,303,304,306,307,308,313,314,315,402,403,406,407,501,502,503,504,505,506,507,516,517,"
"RTN","DGRPC",34,0)
 S DGVT=$S(DGP("VET")="Y":1,1:0),DGSC=$S($P(DGP(.3),"^",1)="Y":1,1:0),DGCD=$S($D(^DIC(8,+DGP(.36),0)):^(0),1:""),(DGCT,DGER,DGNCK)="" I 'DGVT,$D(^DG(391,+DGP("TYPE"),0)),$P(^(0),"^",2) S DGVT=2
"RTN","DGRPC",35,0)
 S DGLST=+$P(DGCHK,",",2) G @DGLST
"RTN","DGRPC",36,0)
1        S DGD=$P(DGP(0),"^",1) I DGD?1L.E!(DGD?.E1L.E)!(DGD="") S X=1 D COMB,NEXT I +DGLST'=2 G @DGLST
"RTN","DGRPC",37,0)
 S I1=0 F I=1:1:$L(DGD) Q:I1  S J=$E(DGD,I) I J?1NP,$A(J)>32,J'=",",J'="-",J'=".",J'="'" S I1=1
"RTN","DGRPC",38,0)
 I I1 S X=1 D COMB
"RTN","DGRPC",39,0)
 D NEXT I +DGLST'=2 G @DGLST
"RTN","DGRPC",40,0)
2        S I1=0 F I=0:0 S I=$O(^DPT(DFN,.01,I)) Q:'I!(I1)  I $P(^(I,0),"^",1)'?1A.E S I1=1
"RTN","DGRPC",41,0)
 I I1 S X=2 D COMB
"RTN","DGRPC",42,0)
 D NEXT I +DGLST>7!('DGLST) G @DGLST
"RTN","DGRPC",43,0)
3        ;
"RTN","DGRPC",44,0)
4        ;
"RTN","DGRPC",45,0)
5        ;
"RTN","DGRPC",46,0)
6        ;
"RTN","DGRPC",47,0)
7        F I=2,3,5,8,9 I $P(DGP(0),"^",I)="" S X=$S(I=2:3,I=3:4,I=5:5,I=8:6,1:7) D COMB:DGCHK[(","_X_",")
"RTN","DGRPC",48,0)
 S DGLST=7 G:DGCHK'[",7," FIND^DGRPC2 D NEXT I +DGLST'=8 G @DGLST
"RTN","DGRPC",49,0)
8        S I1=0,DGD=$G(^DPT(DFN,.11)) I '$P(DGD,"^",10) S I1=1,X=8 D COMB,NEXT G @DGLST
"RTN","DGRPC",50,0)
 I '$D(^HL(779.004,$P(DGD,"^",10))) S I1=1,X=8 D COMB,NEXT G @DGLST
"RTN","DGRPC",51,0)
 N STR8 S STR8="1,4,5,6,7" I $$FORIEN^DGADDUTL($P(DGD,"^",10)) S STR8="1,4"
"RTN","DGRPC",52,0)
 F T=1:1:$L(STR8,",") S I=$P(STR8,",",T) Q:I1  I $P(DGD,"^",I)="" S I1=1
"RTN","DGRPC",53,0)
 I I1 S X=8 D COMB
"RTN","DGRPC",54,0)
 D NEXT I +DGLST'=9 G @DGLST
"RTN","DGRPC",55,0)
9        I DGP("VET")="" S X=9,DGNCK=1 D COMB
"RTN","DGRPC",56,0)
 D NEXT I +DGLST'=10 G @DGLST
"RTN","DGRPC",57,0)
10       I $P(DGP(.3),"^",1)="" S X=10,DGNCK=1 D COMB
"RTN","DGRPC",58,0)
 D NEXT I +DGLST'=11 G @DGLST
"RTN","DGRPC",59,0)
11       I 'DGVT,DGSC S X=11 D COMB
"RTN","DGRPC",60,0)
 D NEXT I +DGLST'=12 G @DGLST
"RTN","DGRPC",61,0)
12       I DGSC,DGVT,$P(DGP(.3),"^",2)="" S X=12 D COMB
"RTN","DGRPC",62,0)
 D NEXT I +DGLST'=13 G @DGLST
"RTN","DGRPC",63,0)
13       I '$D(^DIC(21,+$P(DGP(.32),"^",3),0)) S X=13,DGNCK=1 D COMB
"RTN","DGRPC",64,0)
 D NEXT I +DGLST'=14 G @DGLST
"RTN","DGRPC",65,0)
14       I $P(DGCD,"^",1)="" S X=14,DGNCK=1 D COMB
"RTN","DGRPC",66,0)
 ;
"RTN","DGRPC",67,0)
 ;Check Patient Eligibilities multiple if Primary Elig Code defined
"RTN","DGRPC",68,0)
 I DGP(.36),'$D(^DPT(DFN,"E",+DGP(.36),0)) D PRI^VADPT60 ;5.3*301
"RTN","DGRPC",69,0)
 ;
"RTN","DGRPC",70,0)
 D NEXT I +DGLST'=15 G FIND^DGRPC2:+DGLST=35,@DGLST
"RTN","DGRPC",71,0)
15       I $P($G(^DPT(DFN,.15)),"^",2)]"",$P(DGP(.3),"^",7)="" S X=15 D COMB
"RTN","DGRPC",72,0)
 D NEXT I +DGLST'=16 G FIND^DGRPC2:+DGLST=35,@DGLST
"RTN","DGRPC",73,0)
16       D H^DGUTL I +DGP(.35)>DGTIME S X=16 D COMB
"RTN","DGRPC",74,0)
 D NEXT I +DGLST'=17 G FIND^DGRPC2:+DGLST=35,@DGLST
"RTN","DGRPC",75,0)
17       K DGDATE,DGTIME
"RTN","DGRPC",76,0)
 N SDARRAY,SDCLIEN,SDDATE
"RTN","DGRPC",77,0)
 S I1=0,DGD=DT
"RTN","DGRPC",78,0)
 S SDARRAY("FLDS")=3
"RTN","DGRPC",79,0)
 S SDARRAY(4)=DFN
"RTN","DGRPC",80,0)
 I +DGP(.35),$$SDAPI^SDAMA301(.SDARRAY) D
"RTN","DGRPC",81,0)
 .;if there is data hanging from the 101 subscript,
"RTN","DGRPC",82,0)
 .;then this is a valid appointment
"RTN","DGRPC",83,0)
 .;otherwise it is an error eg 01/21/2005
"RTN","DGRPC",84,0)
 .I $D(^TMP($J,"SDAMA301",101))=1 Q
"RTN","DGRPC",85,0)
 .S SDCLIEN=0
"RTN","DGRPC",86,0)
 .F  S SDCLIEN=$O(^TMP($J,"SDAMA301",DFN,SDCLIEN)) Q:'SDCLIEN!(I1)  D
"RTN","DGRPC",87,0)
 ..S SDDATE=0
"RTN","DGRPC",88,0)
 ..F  S SDDATE=$O(^TMP($J,"SDAMA301",DFN,SDCLIEN,SDDATE)) Q:'SDDATE!(I1)  D
"RTN","DGRPC",89,0)
 ...S X=$P($P(^TMP($J,"SDAMA301",DFN,SDCLIEN,SDDATE),"^",3),";")
"RTN","DGRPC",90,0)
 ...I X=""!(X="I") S I1=1
"RTN","DGRPC",91,0)
 K ^TMP($J,"SDAMA301")
"RTN","DGRPC",92,0)
 I I1 S X=17 D COMB
"RTN","DGRPC",93,0)
 ;
"RTN","DGRPC",94,0)
END      ; end of routine...find next check to execute (or goto end)
"RTN","DGRPC",95,0)
 S:DGNCK DGLST=35 G:DGCHK'[",35,"&(DGNCK) FIND^DGRPC2 D NEXT G @DGLST
"RTN","DGRPC",96,0)
 ;
"RTN","DGRPC",97,0)
COMB     ;record inconsistency
"RTN","DGRPC",98,0)
 S DGCT=DGCT+1,DGER=DGER_X_",",DGLST=X Q
"RTN","DGRPC",99,0)
 Q
"RTN","DGRPC",100,0)
 ;
"RTN","DGRPC",101,0)
NEXT     ; find the next consistency check to check (goto end if can't process further)
"RTN","DGRPC",102,0)
 S I=$F(DGCHK,(","_DGLST_",")),DGLST=+$E(DGCHK,I,999) I +DGLST,DGLST<18 Q
"RTN","DGRPC",103,0)
 I +DGLST,DGNCK,+DGLST>17,+DGLST<36 S DGLST=35 Q:DGCHK'[",35,"  G NEXT
"RTN","DGRPC",104,0)
 S:'+DGLST DGLST="END^DGRPC3" I +DGLST S DGLST=DGLST_"^DGRPC"_$S(+DGLST<43:1,+DGLST<79:2,1:3)
"RTN","DGRPC",105,0)
 Q
"RTN","DGRPC",106,0)
 ;
"RTN","DGRPC",107,0)
PAT      ;check inconsistencies for a selected patient
"RTN","DGRPC",108,0)
 D ON G KVAR^DGRPCE:DGER W !! S DIC="^DPT(",DIC(0)="AEQMZ",DIC("A")="Check consistency for which PATIENT: " D ^DIC K DIC G KVAR^DGRPCE:Y'>0 S DFN=+Y,DGEDCN=1 D DGRPC G PAT
"RTN","DGRPC",109,0)
 ;
"RTN","DGRPC",110,0)
START    ;record start time for checker
"RTN","DGRPC",111,0)
 S DGSTART=$H Q
"RTN","DGRPC",112,0)
 ;
"RTN","DGRPC",113,0)
TIME     ;record end time for checker
"RTN","DGRPC",114,0)
 Q:'$D(DGSTART)#2  S DGEND=$H,X=$P(DGSTART,",",2),X1=$P(DGEND,",",2)
"RTN","DGRPC",115,0)
 I +DGSTART=+DGEND S DGTIME=X1-X
"RTN","DGRPC",116,0)
 E  S DGTIME=(5184000-X)+X1
"RTN","DGRPC",117,0)
 I $S(DGCT:0,DGCON=1:1,1:0) G TIMEQ
"RTN","DGRPC",118,0)
 W !!,"===> ",$S(DGCT:DGCT,DGCON<2:"No",1:"All")," inconsistenc",$S(DGCT=1:"y",1:"ies")," ",$S('DGCON:"found",DGCON=1:"filed",1:"removed")," in ",DGTIME," second",$S(DGTIME=1:"",1:"s"),"..." H 1
"RTN","DGRPC",119,0)
TIMEQ    K DGSTART,DGEND,DGTIME,X,X1,DGCON Q
"RTN","DGRPC",120,0)
 ;
"RTN","DGRPC",121,0)
ON       ;check if checker is on
"RTN","DGRPC",122,0)
 S DGER=0 I $S('$D(^DG(43,1,0)):1,'$P(^(0),"^",37):1,1:0) S DGER=1
"RTN","DGRPC",123,0)
 S:'$D(DGEDCN) DGEDCN=0 W:DGER !!,"CONSISTENCY CHECKER TURNED OFF!!",$C(7) Q
"RTN","DGRPC3")
0^6^B57456736^B55911726
"RTN","DGRPC3",1,0)
DGRPC3 ;ALB/PJR,LBD,BAJ,TDM - CHECK CONSISTENCY OF PATIENT DATA (CONT) ; 10/20/10 3:40pm
"RTN","DGRPC3",2,0)
 ;;5.3;Registration;**451,632,673,657,688,754,797,867,903**;Aug 13, 1993;Build 82
"RTN","DGRPC3",3,0)
 ;
"RTN","DGRPC3",4,0)
 ; 315 subroutine added by patch DG*5.3*903 which was submitted to OSEHRA 
"RTN","DGRPC3",5,0)
 ; on 04/02/2015 by HP. This update was authored by James Harris 2014-2015
"RTN","DGRPC3",6,0)
 ;
"RTN","DGRPC3",7,0)
79 ;; MSE Dates overlap
"RTN","DGRPC3",8,0)
 ;; Don't check if MSE Dates Incomplete or if MSE TO precedes FROM
"RTN","DGRPC3",9,0)
 ;; or unless at least 2 ranges
"RTN","DGRPC3",10,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSDATERR!($L(ANYMSE)<2) D NEXT G @DGLST
"RTN","DGRPC3",11,0)
 ;Use MSE data in DGPMSE array, if it exists (DG*5.3*797)
"RTN","DGRPC3",12,0)
 I $D(DGPMSE) D  D NEXT G @DGLST
"RTN","DGRPC3",13,0)
 .N MS,MSE,OUT S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D
"RTN","DGRPC3",14,0)
 ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE verified by HEC
"RTN","DGRPC3",15,0)
 ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE
"RTN","DGRPC3",16,0)
 ..I '$$OVRLPCHK^DGRPDT(DFN,$P(DGPMSE(MS),U),$P(DGPMSE(MS),U,2),1,"","",MSE) S X=79 D COMB S (MSERR,OUT)=1 Q
"RTN","DGRPC3",17,0)
 ;Otherwise, use MSE data in DGP(.32)
"RTN","DGRPC3",18,0)
 I ANYMSE[1,'$$OVRLPCHK^DGRPDT(DFN,$P(DGP(.32),"^",6),$P(DGP(.32),"^",7),1,".326^.327") S X=79 D COMB S MSERR=1 D NEXT G @DGLST
"RTN","DGRPC3",19,0)
 I ANYMSE'[1,'$$OVRLPCHK^DGRPDT(DFN,$P(DGP(.32),"^",11),$P(DGP(.32),"^",12),1,".3292^.3293") S X=79 D COMB S MSERR=1 D NEXT G @DGLST
"RTN","DGRPC3",20,0)
 D NEXT G @DGLST
"RTN","DGRPC3",21,0)
80 ;; POW Dates not within MSE
"RTN","DGRPC3",22,0)
 ;; Check turned off by EVC project (DG*5.3*688)
"RTN","DGRPC3",23,0)
 D NEXT G @DGLST
"RTN","DGRPC3",24,0)
81 ;; Combat Dates not within MSE
"RTN","DGRPC3",25,0)
 I '$P(DGP(.52),"^",12) D NEXT G @DGLST ;; Don't check if no COMBAT Data
"RTN","DGRPC3",26,0)
 ;; Don't check if COMBAT Data Incomplete or if COMBAT TO precedes FROM
"RTN","DGRPC3",27,0)
 I ((","_DGER_",")[(",39,"))!((","_DGER_",")[(",40,")) D NEXT G @DGLST
"RTN","DGRPC3",28,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK S:'$G(MSESET) MSESET=$$MSFROMTO^DGMSCK
"RTN","DGRPC3",29,0)
 ;; If COMBAT, but no MSE, then Range is NOT within MSE
"RTN","DGRPC3",30,0)
 I 'ANYMSE S X=81 D COMB D NEXT G @DGLST
"RTN","DGRPC3",31,0)
 I '$$RWITHIN^DGRPDT($P(MSESET,"^",1),$P(MSESET,"^",2),$P(DGP(.52),"^",13),$P(DGP(.52),"^",14)) S X=81 D COMB
"RTN","DGRPC3",32,0)
 D NEXT G @DGLST
"RTN","DGRPC3",33,0)
82 ;; Conflict Dates not within MSE
"RTN","DGRPC3",34,0)
 S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK
"RTN","DGRPC3",35,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK S:'$G(MSESET) MSESET=$$MSFROMTO^DGMSCK
"RTN","DGRPC3",36,0)
 S LOC="",I2=0 F I1=1:1 S LOC=$O(CONSPEC(LOC)) Q:LOC=""  I CONARR(LOC)=1 D
"RTN","DGRPC3",37,0)
 .N FROMDAT,FROMPC,TODAT,TOPC,NODE,DATA
"RTN","DGRPC3",38,0)
 .S DATA=CONSPEC(LOC)
"RTN","DGRPC3",39,0)
 .S NODE=$P(DATA,",",1),FROMPC=$P(DATA,",",3),TOPC=$P(DATA,",",4)
"RTN","DGRPC3",40,0)
 .S FROMDAT=$P(DGP(NODE),"^",FROMPC),TODAT=$P(DGP(NODE),"^",TOPC)
"RTN","DGRPC3",41,0)
 .I '$$RWITHIN^DGRPDT($P(MSESET,"^",1),$P(MSESET,"^",2),FROMDAT,TODAT) S X=82 D COMB:'I2 S CONARR(LOC)=2,I2=1
"RTN","DGRPC3",42,0)
 .Q
"RTN","DGRPC3",43,0)
 ; Check OIF/OEF conflict dates
"RTN","DGRPC3",44,0)
 N DGOEIF D GET^DGENOEIF(DFN,.DGOEIF,0,"",0)
"RTN","DGRPC3",45,0)
 I $G(DGOEIF("COUNT")),DGER'[",82," D
"RTN","DGRPC3",46,0)
 . N Z
"RTN","DGRPC3",47,0)
 . S Z=0 F  S Z=$O(DGOEIF("IEN",Z)) Q:'Z  D  Q:DGER[",82,"
"RTN","DGRPC3",48,0)
 .. S FROMDAT=$G(DGOEIF("FR",Z)),TODAT=$G(DGOEIF("TO",Z)),LOC=$G(DGOEIF("LOC",Z))
"RTN","DGRPC3",49,0)
 .. I '$$RWITHIN^DGRPDT($P(MSESET,"^",1),$P(MSESET,"^",2),FROMDAT,TODAT) S X=82 D COMB S I2=1
"RTN","DGRPC3",50,0)
 D NEXT G @DGLST
"RTN","DGRPC3",51,0)
83 ;Merchant Seaman or Filipino Vet BOS requires service dates during WWII
"RTN","DGRPC3",52,0)
 N BOS,BOSN,MS,MSE,OUT
"RTN","DGRPC3",53,0)
 ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)
"RTN","DGRPC3",54,0)
 I $D(DGPMSE) D  D NEXT G @DGLST
"RTN","DGRPC3",55,0)
 .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D
"RTN","DGRPC3",56,0)
 ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC
"RTN","DGRPC3",57,0)
 ..S BOS=$P(DGPMSE(MS),U,3) Q:'BOS  S BOSN=$P(^DIC(23,BOS,0),U)
"RTN","DGRPC3",58,0)
 ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE  S MSE="MSE-"_MSE
"RTN","DGRPC3",59,0)
 ..I $$BRANCH^DGRPMS(BOS_U_BOSN),'$$WWII^DGRPMS(DFN,"",MSE) S X=83 D COMB S OUT=1 Q
"RTN","DGRPC3",60,0)
 ;Otherwise, get MSE data from DGP(.32)
"RTN","DGRPC3",61,0)
 F MS=1:1:3 D  Q:$G(OUT)
"RTN","DGRPC3",62,0)
 .I MS=2,$P(DGP(.32),U,19)'="Y" S OUT=1 Q
"RTN","DGRPC3",63,0)
 .I MS=3,$P(DGP(.32),U,20)'="Y" S OUT=1 Q
"RTN","DGRPC3",64,0)
 .S BOS=$P(DGP(.32),U,(5*MS)) Q:'BOS  S BOSN=$P($G(^DIC(23,BOS,0)),U)
"RTN","DGRPC3",65,0)
 .S MSE=$S(MS=1:"MSL",MS=2:"MSNTL",1:"MSNNTL")
"RTN","DGRPC3",66,0)
 .I $$BRANCH^DGRPMS(BOS_U_BOSN),'$$WWII^DGRPMS(DFN,"",MSE) S X=83 D COMB S OUT=1 Q
"RTN","DGRPC3",67,0)
 D NEXT G @DGLST
"RTN","DGRPC3",68,0)
84 ;Filipino Vet BOS requires Filipino Vet Proof
"RTN","DGRPC3",69,0)
 N MS,BOS,OUT,MSE
"RTN","DGRPC3",70,0)
 ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)
"RTN","DGRPC3",71,0)
 I $D(DGPMSE) D  D NEXT G @DGLST
"RTN","DGRPC3",72,0)
 .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D
"RTN","DGRPC3",73,0)
 ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC
"RTN","DGRPC3",74,0)
 ..S BOS=$P(DGPMSE(MS),U,3) Q:'BOS
"RTN","DGRPC3",75,0)
 ..I $$FV^DGRPMS(BOS)=1,$P(DGP(.321),U,14)="" S X=84 D COMB S OUT=1 Q
"RTN","DGRPC3",76,0)
 ;Otherwise use MSE data in DGP(.32)
"RTN","DGRPC3",77,0)
 F MS=1:1:3 D  Q:$G(OUT)
"RTN","DGRPC3",78,0)
 .I MS=2,$P(DGP(.32),U,19)'="Y" S OUT=1 Q
"RTN","DGRPC3",79,0)
 .I MS=3,$P(DGP(.32),U,20)'="Y" S OUT=1 Q
"RTN","DGRPC3",80,0)
 .S BOS=$P(DGP(.32),U,(5*MS))
"RTN","DGRPC3",81,0)
 .I $$FV^DGRPMS(BOS)=1,$P(DGP(.321),U,14)="" S X=84 D COMB S OUT=1 Q
"RTN","DGRPC3",82,0)
 D NEXT G @DGLST
"RTN","DGRPC3",83,0)
85 ;Eligible Filipino Vet should have Veteran status = 'YES'
"RTN","DGRPC3",84,0)
86 ;Ineligible Filipino Vet should have Veteran status = 'NO'
"RTN","DGRPC3",85,0)
 N MS,BOS,FV,FILV,NOTFV,MSE,OUT
"RTN","DGRPC3",86,0)
 ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)
"RTN","DGRPC3",87,0)
 I $D(DGPMSE) D
"RTN","DGRPC3",88,0)
 .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D
"RTN","DGRPC3",89,0)
 ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC
"RTN","DGRPC3",90,0)
 ..S BOS=$P(DGPMSE(MS),U,3),FV=$$FV^DGRPMS(BOS) I 'FV S NOTFV="" Q
"RTN","DGRPC3",91,0)
 ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE  S MSE="MSE-"_MSE
"RTN","DGRPC3",92,0)
 ..I '$$WWII^DGRPMS(DFN,"",MSE) S FILV("I")="" Q
"RTN","DGRPC3",93,0)
 ..I FV=2 S FILV("E")="" Q
"RTN","DGRPC3",94,0)
 ..I $P(DGP(.321),U,14)=""!($P(DGP(.321),U,14)="NO") S FILV("I")="" Q
"RTN","DGRPC3",95,0)
 ..S FILV("E")=""
"RTN","DGRPC3",96,0)
 ;Otherwise, get MSE data from DGP(.32)
"RTN","DGRPC3",97,0)
 E  F MS=1:1:3 D  Q:$G(OUT)
"RTN","DGRPC3",98,0)
 .I MS=2,$P(DGP(.32),U,19)'="Y" S OUT=1 Q
"RTN","DGRPC3",99,0)
 .I MS=3,$P(DGP(.32),U,20)'="Y" S OUT=1 Q
"RTN","DGRPC3",100,0)
 .S BOS=$P(DGP(.32),U,(5*MS)),FV=$$FV^DGRPMS(BOS) I 'FV S NOTFV="" Q
"RTN","DGRPC3",101,0)
 .S MSE=$S(MS=1:"MSL",MS=2:"MSNTL",1:"MSNNTL")
"RTN","DGRPC3",102,0)
 .I '$$WWII^DGRPMS(DFN,"",MSE) S FILV("I")="" Q
"RTN","DGRPC3",103,0)
 .I FV=2 S FILV("E")="" Q
"RTN","DGRPC3",104,0)
 .I $P(DGP(.321),U,14)=""!($P(DGP(.321),U,14)="NO") S FILV("I")="" Q
"RTN","DGRPC3",105,0)
 .S FILV("E")=""
"RTN","DGRPC3",106,0)
 I $D(FILV) D
"RTN","DGRPC3",107,0)
 .I DGVT'=1,$D(FILV("E")) S X=85 D COMB Q
"RTN","DGRPC3",108,0)
 .I DGCHK'[(",86,") Q
"RTN","DGRPC3",109,0)
 .I DGVT=1,'$D(NOTFV),'$D(FILV("E")),$D(FILV("I")) S X=86 D COMB
"RTN","DGRPC3",110,0)
 S DGLST=86
"RTN","DGRPC3",111,0)
 D NEXT G @DGLST
"RTN","DGRPC3",112,0)
87 ; DG*5.3*657 BAJ 11/24/2005 CC #87 added
"RTN","DGRPC3",113,0)
 ; SC Eligibility but no rated Disability Codes
"RTN","DGRPC3",114,0)
 ; 1. Svc Connected is answered "YES"
"RTN","DGRPC3",115,0)
 ; 2. Eligibility code is either SC < 50% or SC 50-100%
"RTN","DGRPC3",116,0)
 ; 3. Svc connected %-age is 0 or greater
"RTN","DGRPC3",117,0)
 ; 4. Patient has no rated disabilities
"RTN","DGRPC3",118,0)
 ; .. VAEL(1) $P 1 = Primary Eligibility Code  $p 2 = Primary Elig External Value
"RTN","DGRPC3",119,0)
 ; .. VAEL(3) $P 1 = SERVICE CONNECTED? $P 2 = SC %
"RTN","DGRPC3",120,0)
 ; .. Rated Disabilities : ^DPT(DFN,.372,0) $P 4 is number of records  '($P($G(^DPT(DFN,.372,0)),"^",4)) is TRUE
"RTN","DGRPC3",121,0)
 ;
"RTN","DGRPC3",122,0)
 ; Get Eligibility info
"RTN","DGRPC3",123,0)
 D ELIG^VADPT
"RTN","DGRPC3",124,0)
 ;
"RTN","DGRPC3",125,0)
 ; If not svc connected, don't check
"RTN","DGRPC3",126,0)
 I '$G(VAEL(3)) D NEXT G @DGLST
"RTN","DGRPC3",127,0)
 ;
"RTN","DGRPC3",128,0)
 I +VAEL(3)=1!(+VAEL(3)=3) D
"RTN","DGRPC3",129,0)
 . Q:$P(VAEL(3),"^",2)<0
"RTN","DGRPC3",130,0)
 . Q:$P(VAEL(3),"^",2)=""
"RTN","DGRPC3",131,0)
 . I '($P($G(^DPT(DFN,.372,0)),"^",4)) S X=87 D COMB
"RTN","DGRPC3",132,0)
 D NEXT G @DGLST
"RTN","DGRPC3",133,0)
 ;
"RTN","DGRPC3",134,0)
88 ;Temporary Address check
"RTN","DGRPC3",135,0)
 N STR88,J,DGI,DGERR,START,END
"RTN","DGRPC3",136,0)
 S DGERR=0
"RTN","DGRPC3",137,0)
 I $P(DGP(.121),U,9)="Y" D
"RTN","DGRPC3",138,0)
 . ;check only if current date is within effective range
"RTN","DGRPC3",139,0)
 . S START=$P(DGP(.121),U,7),END=$P(DGP(.121),U,8)
"RTN","DGRPC3",140,0)
 . Q:START=""  I END="" S END=9999999
"RTN","DGRPC3",141,0)
 . ; quit if current date is not within range
"RTN","DGRPC3",142,0)
 . I '(DT'<START&(DT'>END)) Q
"RTN","DGRPC3",143,0)
 . ; country is either NULL or non-numeric
"RTN","DGRPC3",144,0)
 . I '$P(DGP(.122),U,3) S DGERR=1 Q
"RTN","DGRPC3",145,0)
 . ; country is not in Country file
"RTN","DGRPC3",146,0)
 . I '$D(^HL(779.004,$P(DGP(.122),U,3))) S DGERR=1 Q
"RTN","DGRPC3",147,0)
 . S STR88="1,4,5,6" I $$FORIEN^DGADDUTL($P(DGP(.122),"^",3)) S STR88="1,4"
"RTN","DGRPC3",148,0)
 . F J=1:1:$L(STR88,",") S DGI=$P(STR88,",",J) Q:DGERR  I $P(DGP(.121),U,DGI)="" S DGERR=1
"RTN","DGRPC3",149,0)
 I DGERR S X=88 D COMB
"RTN","DGRPC3",150,0)
 D NEXT G @DGLST
"RTN","DGRPC3",151,0)
99 ; synonymous with END
"RTN","DGRPC3",152,0)
END I DGNCK S X=99 D COMB
"RTN","DGRPC3",153,0)
 D OVER99CK
"RTN","DGRPC3",154,0)
 I DGEDCN S DGCON=0 D TIME^DGRPC
"RTN","DGRPC3",155,0)
 K C,C1,C2,DGCD,DGD,DGD1,DGD2,DGDATE,DGDEP,DGCHK,DGFL,DGINC,DGISYR,DGLST,DGMS,DGNCK,DGP,DGPMSE,DGPTYP,DGREL,DGSCT,DGT,DGTIME,DGTOT,DGVT,I,I2,I2,J,VAIN,X,X1
"RTN","DGRPC3",156,0)
 G ^DGRPCF
"RTN","DGRPC3",157,0)
 ;
"RTN","DGRPC3",158,0)
COMB S DGCT=DGCT+1,DGER=DGER_X_",",DGLST=X Q
"RTN","DGRPC3",159,0)
 ;;
"RTN","DGRPC3",160,0)
NEXT S I=$F(DGCHK,(","_+DGLST_",")),DGLST=+$E(DGCHK,I,999) S:'DGLST DGLST="END"
"RTN","DGRPC3",161,0)
 Q
"RTN","DGRPC3",162,0)
 ;
"RTN","DGRPC3",163,0)
OVER99CK N DGP,DGSD,RULE,FILERR
"RTN","DGRPC3",164,0)
 D LOADPT^IVMZ07C(DFN,.DGP),LOADSD^IVMZ072(DFN,.DGSD)
"RTN","DGRPC3",165,0)
 F RULE=301,303,304,306:1:308 S DGLST=RULE_"^IVMZ7CD" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",166,0)
 F RULE=402,403,406,407 S DGLST=RULE_"^IVMZ7CE" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",167,0)
 F RULE=501:1:507,516,517 S DGLST=RULE_"^IVMZ7CS" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",168,0)
 F RULE=313 S DGLST=RULE_"^DGRPC3" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",169,0)
 F RULE=314 S DGLST=RULE_"^DGRPC3" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",170,0)
 F RULE=315 S DGLST=RULE_"^DGRPC3" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB
"RTN","DGRPC3",171,0)
 S DGLST="END"
"RTN","DGRPC3",172,0)
 Q
"RTN","DGRPC3",173,0)
 ;
"RTN","DGRPC3",174,0)
313 ; NEWBORN REQUIRES SPONSOR
"RTN","DGRPC3",175,0)
 N X
"RTN","DGRPC3",176,0)
 S DOB=$P(^DPT(DFN,0),"^",3)
"RTN","DGRPC3",177,0)
 D NOW^%DTC
"RTN","DGRPC3",178,0)
 S NOW=X
"RTN","DGRPC3",179,0)
 I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q  ;NOT A NEWBORN
"RTN","DGRPC3",180,0)
 I $D(^IBA(355.81,"B",DFN)) Q  ;already has a sponsor
"RTN","DGRPC3",181,0)
 S FILERR(RULE)=""
"RTN","DGRPC3",182,0)
 Q
"RTN","DGRPC3",183,0)
 ; 
"RTN","DGRPC3",184,0)
314 ;NEWBORN SPONSOR MUST BE ELIGIBLE
"RTN","DGRPC3",185,0)
 I '$D(^IBA(355.81,"B",DFN)) Q  ;Does not have a sponsor
"RTN","DGRPC3",186,0)
 N X
"RTN","DGRPC3",187,0)
 S DOB=$P(^DPT(DFN,0),"^",3)
"RTN","DGRPC3",188,0)
 D NOW^%DTC
"RTN","DGRPC3",189,0)
 S NOW=X
"RTN","DGRPC3",190,0)
 I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q  ;NOT A NEWBORN
"RTN","DGRPC3",191,0)
 N RELIEN,SPNIEN,SPNDFN,ELIG
"RTN","DGRPC3",192,0)
 ;NEED TO FIND SPONSOR IN PATIENT FILE
"RTN","DGRPC3",193,0)
 S RELIEN="",SPNIEN="",SPNDFN="",ELIG=""
"RTN","DGRPC3",194,0)
 S RELIEN=$O(^IBA(355.81,"B",DFN,RELIEN))
"RTN","DGRPC3",195,0)
 S SPNIEN=$$GET1^DIQ(355.81,RELIEN,.02,"I")
"RTN","DGRPC3",196,0)
 S SPNDFN=$$GET1^DIQ(355.8,SPNIEN,.01,"I")
"RTN","DGRPC3",197,0)
 S SPNDFN=$P(SPNDFN,";",1)
"RTN","DGRPC3",198,0)
 S ELIG=$$GET1^DIQ(2,SPNDFN,.3611,"I")
"RTN","DGRPC3",199,0)
 I ELIG'="" Q  ;sponsor has an eligibility status
"RTN","DGRPC3",200,0)
 S FILERR(RULE)=""
"RTN","DGRPC3",201,0)
 Q
"RTN","DGRPC3",202,0)
 ;
"RTN","DGRPC3",203,0)
315 ; MHV - subroutine added by patch DG*5.3*903
"RTN","DGRPC3",204,0)
 Q:'$G(DFN)!'$G(DGPRFLG)
"RTN","DGRPC3",205,0)
 ;This functionality will not be executed if "Enable MyHealtheVet Prompts?" (#1100.07  
"RTN","DGRPC3",206,0)
 ;field in MAS PARAMETERS (43) file is not set to YES (internal value 1)
"RTN","DGRPC3",207,0)
 Q:+$$MHVENABL^DGMHVUTL()'>0
"RTN","DGRPC3",208,0)
 ;
"RTN","DGRPC3",209,0)
 N DGFLDCHK,DGMHVACT,DGMHVOUT,DGMHVQ,X,Y,DIR
"RTN","DGRPC3",210,0)
 Q:$$MHVOK^DGMHVAC(DFN) 
"RTN","DGRPC3",211,0)
 ; Quit if MHV ENROLLED/Registered has not been answered, and enrollment/registration
"RTN","DGRPC3",212,0)
 ; action is pending
"RTN","DGRPC3",213,0)
 S DGMHVACT=$$ENQACHK^DGMHVUTL(DFN) Q:(DGMHVACT]"")&'$G(^DPT(DFN,2))
"RTN","DGRPC3",214,0)
 S:'$$MHVOK^DGMHVAC(DFN) FILERR(315)=""
"RTN","DGRPC3",215,0)
 Q
"RTN","DGRPCE1")
0^8^B67438790^B65500857
"RTN","DGRPCE1",1,0)
DGRPCE1 ;ALB/MIR/BRM/LBD,BAJ,TDM - CONSISTENCY CHECKER EDIT ; 10/20/10 4:16pm
"RTN","DGRPCE1",2,0)
 ;;5.3;Registration;**108,226,470,454,489,505,522,451,632,689,657,688,804,754,797,855,903**;Aug 13, 1993;Build 82
"RTN","DGRPCE1",3,0)
 ;Per VHA Directive 6402, this routine should not be modified.
"RTN","DGRPCE1",4,0)
 ;DG*5.3*855
"RTN","DGRPCE1",5,0)
 ; 315 Consistency Check added by patch DG*5.3*903 which was submitted to OSEHRA on 
"RTN","DGRPCE1",6,0)
 ; 04/02/2015 by HP. This update was authored by James Harris 2014-2015 
"RTN","DGRPCE1",7,0)
 ;
"RTN","DGRPCE1",8,0)
 N DGMSERR S DGMSERR=",67,72,73,79,81,83,"
"RTN","DGRPCE1",9,0)
 N I,J F I=1:1:8,16,53,57,58,61:1:88 D SASK
"RTN","DGRPCE1",10,0)
 F I=301,303,304,306:1:308,315,402,403,406,407,501:1:507,516,517 D SASK
"RTN","DGRPCE1",11,0)
 ;F I=49,50,52 D SASK ;BELOW REPLACED WITH ^IBCNSP2 CALL
"RTN","DGRPCE1",12,0)
 ;OLDS DR(2,2.312)="S DGRPADI="""";.01;1;2;15;8;7;3;6;S DGRPADI=X;I DGRPADI'=""v"" S Y=""@2312"";17///^S X=""`""_DFN;16///^S X=""01"";S Y=""@23121"";@2312;17;16//^S X=$S(DGRPADI=""s"":""02"",1:"""");@23121;9:14;"
"RTN","DGRPCE1",13,0)
 Q
"RTN","DGRPCE1",14,0)
SASK I DGER[(","_I_","),DGASK'[(","_I_","),DGMSERR'[(","_I_",") F J=I,I*1000:1 Q:'$T(@J)  S DGD=DGD_$P($T(@J),";;",2,999) D SAVE
"RTN","DGRPCE1",15,0)
 S DGASK=DGASK_I_","
"RTN","DGRPCE1",16,0)
 Q
"RTN","DGRPCE1",17,0)
SAVE I $L(@DGDR)+$L(DGD)<241 S @DGDR=@DGDR_DGD,DGD="" Q
"RTN","DGRPCE1",18,0)
 S DGDRC=DGDRC+1,DGDR="DR(1,2,"_DGDRC_")",@DGDR=DGD,DGD="" Q
"RTN","DGRPCE1",19,0)
 ;
"RTN","DGRPCE1",20,0)
 ;
"RTN","DGRPCE1",21,0)
ELIG ;eligibility code...if M11+, use compiled template, otherwise DR string
"RTN","DGRPCE1",22,0)
 I ^%ZOSF("OS")'["M/11+" S DGD=$P($T(14),";;",2,999) D SAVE Q
"RTN","DGRPCE1",23,0)
 N DA,DIE,DR S DIE="^DPT(",DA=DFN,DR="[DG CONSISTENCY CHECKER]" D ^DIE
"RTN","DGRPCE1",24,0)
 Q
"RTN","DGRPCE1",25,0)
 ;
"RTN","DGRPCE1",26,0)
 ;
"RTN","DGRPCE1",27,0)
1 ;;.01;
"RTN","DGRPCE1",28,0)
2 ;;1;
"RTN","DGRPCE1",29,0)
3 ;;.02;
"RTN","DGRPCE1",30,0)
4 ;;.03;
"RTN","DGRPCE1",31,0)
5 ;;.05;
"RTN","DGRPCE1",32,0)
6 ;;.08;
"RTN","DGRPCE1",33,0)
7 ;;.09;
"RTN","DGRPCE1",34,0)
8 ;;N FLG S FLG(2)=1 S:$G(DGER)[",61," FLG(1)=1 D EN^DGREGAED(DFN,.FLG);
"RTN","DGRPCE1",35,0)
14 ;;.361;S DGECODE=$S($D(^DIC(8,+X,0)):$P(^(0),"^",1),1:"");S:$S(DGECODE["ALLIED":0,DGECODE["FEDERAL":0,1:1) Y=.323;.309;.323;D ^DGYZODS;S:'DGODS Y="@14";11500.02;11500.03;@14;
"RTN","DGRPCE1",36,0)
16 ;;.351;
"RTN","DGRPCE1",37,0)
53 ;;.07;.31115;I $S(X']"":1,X=3:1,X=9:1,1:0) S Y="@53";.3111;S:X']"" Y="@53";.3113;S:X']"" Y=.3116;.3114;S:X']"" Y=.3116;.3115:.3117;.2205;.3119;@53;
"RTN","DGRPCE1",38,0)
57 ;;.381;.382///NOW;
"RTN","DGRPCE1",39,0)
58 ;;.322013;S:X'="Y" Y="@589";.322014;.322015;.32201;S:X'="Y" Y="@581";.322011;.322012;@581;.322016;S:X'="Y" Y="@589";.322017;.322018;@589;
"RTN","DGRPCE1",40,0)
61 ;;S:$G(DGER)[",8," Y="@619";.132;@619;
"RTN","DGRPCE1",41,0)
62 ;;.331;
"RTN","DGRPCE1",42,0)
63 ;;D EN^DGREGTED(DFN,"CONF");
"RTN","DGRPCE1",43,0)
64 ;;.092;.093;
"RTN","DGRPCE1",44,0)
65 ;;.2403;
"RTN","DGRPCE1",45,0)
66 ;;.09;
"RTN","DGRPCE1",46,0)
67 ;;S:$$DGERCK^DGRPCE1("73^79^80^81^82",.DGER) Y="@67";W !!,$C(7),"SERVICE SEPARATION DATE [LAST] must be a precise date to determine CV Elig",!;.325;.32911;.326;.327;@67;
"RTN","DGRPCE1",47,0)
68 ;;S:$$DGERCK^DGRPCE1("39^40",.DGER) Y="@68";W !!,$C(7),"COMBAT TO DATE must be a precise date to determine CV Eligibility",!;.5291;S:X'="Y" Y="@68";.5292;.5293;.5294;@68;
"RTN","DGRPCE1",48,0)
69 ;;S:$$DGERCK^DGRPCE1("74^75^76",.DGER) Y="@69";W !!,$C(7),"YUGOSLAVIA TO DATE must be a precise date to determine CV Eligibility",!;.322019;S:X'="Y" Y="@69";.32202;.322021;@69;
"RTN","DGRPCE1",49,0)
70 ;;S:$$DGERCK^DGRPCE1("74^75^76",.DGER) Y="@70";W !!,$C(7),"SOMALIA TO DATE must be a precise date to determine CV Eligibility",!;.322016;S:X'="Y" Y="@70";.322017;.322018,@70;
"RTN","DGRPCE1",50,0)
71 ;;S:$$DGERCK^DGRPCE1("74^75^76",.DGER) Y="@71";W !!,$C(7),"PERSIAN GULF TO DATE must be a precise date to determine CV Eligibility",!;.32201;S:X'="Y" Y="@71";.322011;.322012;@71;
"RTN","DGRPCE1",51,0)
72 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@7201";.3291;.32912;.3292;.3293;.329;@7201;S:'$$YN^DGRPCE1(.32945) Y="@7202";.3296;.32913;.3297;.3298;.3295;@7202;
"RTN","DGRPCE1",52,0)
 ;
"RTN","DGRPCE1",53,0)
73 ;;S:$$DGERCK^DGRPCE1(72,.DGER) Y="@7302";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@7301";.3291;.32912;.3292;.3293;.329;@7301;S:'$$YN^DGRPCE1(.32945) Y="@7302";.3296;.32913;.3297;.3298;.3295;@7302;
"RTN","DGRPCE1",54,0)
74 ;;S:'$$YN^DGRPCE1(.32101) Y="@7401";.32101;S:X'="Y" Y="@7401";.32104;.32105;@7401;S:'$$YN^DGRPCE1(.322016) Y="@7402";.322016;S:X'="Y" Y="@7402";.322017;.322018;@7402;
"RTN","DGRPCE1",55,0)
74000 ;;S:'$$YN^DGRPCE1(.322019) Y="@7403";.322019;S:X'="Y" Y="@7403";.32202;.322021;@7403;S:'$$YN^DGRPCE1(.3221) Y="@7404";.3221;S:X'="Y" Y="@7404";.3222;.3223;@7404;
"RTN","DGRPCE1",56,0)
74001 ;;S:'$$YN^DGRPCE1(.3224) Y="@7405";.3224;S:X'="Y" Y="@7405";.3225;.3226;@7405;S:'$$YN^DGRPCE1(.3227) Y="@7406";.3227;S:X'="Y" Y="@7406";.3228;.3229;@7406;
"RTN","DGRPCE1",57,0)
74002 ;;S:'$$YN^DGRPCE1(.32201) Y="@7407";.32201;S:X'="Y" Y="@7407";.322011;.322012;@7407;
"RTN","DGRPCE1",58,0)
75 ;;S:$$DGERCK^DGRPCE1(74,.DGER) Y="@7507";S:'$$YN^DGRPCE1(.32101) Y="@7501";.32101;S:X'="Y" Y="@7501";.32104;.32105;@7501;S:'$$YN^DGRPCE1(.322016) Y="@7502";.322016;S:X'="Y" Y="@7502";.322017;.322018;@7502;
"RTN","DGRPCE1",59,0)
75000 ;;S:'$$YN^DGRPCE1(.322019) Y="@7503";.322019;S:X'="Y" Y="@7503";.32202;.322021;@7503;S:'$$YN^DGRPCE1(.3221) Y="@7504";.3221;S:X'="Y" Y="@7504";.3222;.3223;@7504;
"RTN","DGRPCE1",60,0)
75001 ;;S:'$$YN^DGRPCE1(.3224) Y="@7505";.3224;S:X'="Y" Y="@7505";.3225;.3226;@7505;S:'$$YN^DGRPCE1(.3227) Y="@7506";.3227;S:X'="Y" Y="@7506";.3228;.3229;@7506;
"RTN","DGRPCE1",61,0)
75002 ;;S:'$$YN^DGRPCE1(.32201) Y="@7507";.32201;S:X'="Y" Y="@7507";.322011;.322012;@7507;
"RTN","DGRPCE1",62,0)
76 ;;S:$$DGERCK^DGRPCE1("74^75",.DGER) Y="@7607";S:'$$YN^DGRPCE1(.32101) Y="@7601";.32101;S:X'="Y" Y="@7601";.32104;.32105;@7601;S:'$$YN^DGRPCE1(.322016) Y="@7602";.322016;S:X'="Y" Y="@7602";.322017;.322018;@7602;
"RTN","DGRPCE1",63,0)
76000 ;;S:'$$YN^DGRPCE1(.322019) Y="@7603";.322019;S:X'="Y" Y="@7603";.32202;.322021;@7603;S:'$$YN^DGRPCE1(.3221) Y="@7604";.3221;S:X'="Y" Y="@7604";.3222;.3223;@7604;
"RTN","DGRPCE1",64,0)
76001 ;;S:'$$YN^DGRPCE1(.3224) Y="@7605";.3224;S:X'="Y" Y="@7605";.3225;.3226;@7605;S:'$$YN^DGRPCE1(.3227) Y="@7606";.3227;S:X'="Y" Y="@7606";.3228;.3229;@7606;
"RTN","DGRPCE1",65,0)
76002 ;;S:'$$YN^DGRPCE1(.32201) Y="@7607";.32201;S:X'="Y" Y="@7607";.322011;.322012;@7607;
"RTN","DGRPCE1",66,0)
77 ;;S:(($$DGERCK^DGRPCE1("37^38",.DGER))!('$$YN^DGRPCE1(.525))) Y="@77";.525;S:X'="Y" Y="@77";.526;.527;.528;@77;
"RTN","DGRPCE1",67,0)
78 ;;S:(($$DGERCK^DGRPCE1("39^40^68",.DGER))!('$$YN^DGRPCE1(.5291))) Y="@78";.5291;S:X'="Y" Y="@78";.5292;.5293;.5294;@78;
"RTN","DGRPCE1",68,0)
79 ;;S:$$DGERCK^DGRPCE1("72^73",.DGER) Y="@7902";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@7901";.3291;.32912;.3292;.3293;.329;@7901;S:'$$YN^DGRPCE1(.32945) Y="@7902";.3296;.32913;.3297;.3298;.3295;@7902;
"RTN","DGRPCE1",69,0)
80 ;;S:(($$DGERCK^DGRPCE1("37^38^77",.DGER))!('$$YN^DGRPCE1(.525))) Y="@8001";.525;S:X'="Y" Y="@8001";.526;.527;.528;@8001;S:$$DGERCK^DGRPCE1("72^73^79",.DGER) Y="@8003";
"RTN","DGRPCE1",70,0)
80000 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@8002";.3291;.32912;.3292;.3293;.329;@8002;S:'$$YN^DGRPCE1(.32945) Y="@8003";.3296;.32913;.3297;.3298;.3295;@8003;
"RTN","DGRPCE1",71,0)
81 ;;S:(($$DGERCK^DGRPCE1("39^40^78",.DGER))!('$$YN^DGRPCE1(.5291))) Y="@8101";.5291;S:X'="Y" Y="@8101";.5292;.5293;.5294;@8101;S:$$DGERCK^DGRPCE1("72^73^79^80",.DGER) Y="@8103";
"RTN","DGRPCE1",72,0)
81000 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@8102";.3291;.32912;.3292;.3293;.329;@8102;S:'$$YN^DGRPCE1(.32945) Y="@8103";.3296;.32913;.3297;.3298;.3295;@8103;
"RTN","DGRPCE1",73,0)
82 ;;S:($$DGERCK^DGRPCE1("74^75^76",.DGER)) Y="@8207";S:'$$YN^DGRPCE1(.32101) Y="@8201";.32101;S:X'="Y" Y="@8201";.32104;.32105;@8201;S:'$$YN^DGRPCE1(.322016) Y="@8202";.322016;
"RTN","DGRPCE1",74,0)
82000 ;;S:X'="Y" Y="@8202";.322017;.322018;@8202;S:'$$YN^DGRPCE1(.322019) Y="@8203";.322019;S:X'="Y" Y="@8203";.32202;.322021;@8203;S:'$$YN^DGRPCE1(.3221) Y="@8204";.3221;
"RTN","DGRPCE1",75,0)
82001 ;;S:X'="Y" Y="@8204";.3222;.3223;@8204;S:'$$YN^DGRPCE1(.3224) Y="@8205";.3224;S:X'="Y" Y="@8205";.3225;.3226;@8205;S:'$$YN^DGRPCE1(.3227) Y="@8206";.3227;S:X'="Y" Y="@8206";
"RTN","DGRPCE1",76,0)
82002 ;;.3228;.3229;@8206;S:'$$YN^DGRPCE1(.32201) Y="@8207";.32201;S:X'="Y" Y="@8207";.322011;.322012;@8207;S:($$DGERCK^DGRPCE1("72^73^79^80^81",.DGER)) Y="@8209";
"RTN","DGRPCE1",77,0)
 ;DG*5.3*855
"RTN","DGRPCE1",78,0)
82003 ;;S Y="@8209";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y="@8208";.3291;.32912;.3292;.3293;.329;@8208;S:'$$YN^DGRPCE1(.32945) Y="@8209";.3296;.32913;.3297;.3298;.3295;@8209;
"RTN","DGRPCE1",79,0)
83 ;;S:$$DGERCK^DGRPCE1(73,.DGER) Y="@83";@8295;D SET32^DGRPE(DA,.DIPA,1);.325;S DIPA("X1")=X S:X']"" Y="@83";S:$$FV^DGRPMS(X)'=1 Y="@8296";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y="@8295";
"RTN","DGRPCE1",80,0)
83000 ;;@8296;D:DIPA("X1")'="" WARN32^DGRPE(DIPA("X1"),.DIPA,1,.Y) S:$E(Y,1,4)="@601" Y=.326;.32911;.326;.327;
"RTN","DGRPCE1",81,0)
83001 ;;.3285//NO;S:X'="Y" Y="@83";D SET32^DGRPE(DA,.DIPA,2);.3291;S DIPA("X2")=X S:X']"" Y="@83";S:$$FV^DGRPMS(X)'=1 Y="@832";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y=".3291";S Y=.3292;
"RTN","DGRPCE1",82,0)
83002 ;;@832;D:DIPA("X2")'="" WARN32^DGRPE(DIPA("X2"),.DIPA,2,.Y) S:$E(Y,1,4)="@601" Y=.3292;.32912;.3292;.3293;
"RTN","DGRPCE1",83,0)
83003 ;;.32945//NO;S:X'="Y" Y="@83";D SET32^DGRPE(DA,.DIPA,3);.3296;S DIPA("X3")=X S:X']"" Y="@83";S:$$FV^DGRPMS(X)'=1 Y="@833";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y=".3296";S Y=.3297;@833;
"RTN","DGRPCE1",84,0)
83004 ;;D:DIPA("X3")'="" WARN32^DGRPE(DIPA("X3"),.DIPA,3,.Y) S:$E(Y,1,4)="@601" Y=.3297;.32913;.3297;.3298;@83;
"RTN","DGRPCE1",85,0)
84 ;;.3214;
"RTN","DGRPCE1",86,0)
85 ;;1901;
"RTN","DGRPCE1",87,0)
86 ;;1901;
"RTN","DGRPCE1",88,0)
87 ;;D VETTYPE^DGRPE1;D MSG^DGRPE1 S Y=0;@114;K DGRDCHG;D DR^DGRPE1;.302;.3721;D EFF^DGRPE1;D:$G(DGRDCHG) BULL^DGRPE1;K DGRDCHG;
"RTN","DGRPCE1",89,0)
88 ;;D EN^DGREGTED(DFN,"TEMP");
"RTN","DGRPCE1",90,0)
301 ;;.01;
"RTN","DGRPCE1",91,0)
303 ;;.02;
"RTN","DGRPCE1",92,0)
304 ;;.02;
"RTN","DGRPCE1",93,0)
306 ;;.09;
"RTN","DGRPCE1",94,0)
307 ;;.0906;
"RTN","DGRPCE1",95,0)
308 ;;.351;
"RTN","DGRPCE1",96,0)
315 ;;D:$$MHVENABL^DGMHVUTL() MHVPCHK^DGMHVUTL(DFN);
"RTN","DGRPCE1",97,0)
402 ;;.381;
"RTN","DGRPCE1",98,0)
403 ;;.382;
"RTN","DGRPCE1",99,0)
406 ;;.313;
"RTN","DGRPCE1",100,0)
407 ;;.3611;
"RTN","DGRPCE1",101,0)
501 ;;.525;
"RTN","DGRPCE1",102,0)
502 ;;.3602;
"RTN","DGRPCE1",103,0)
503 ;;.3603;
"RTN","DGRPCE1",104,0)
504 ;;.32102;
"RTN","DGRPCE1",105,0)
505 ;;.32103;
"RTN","DGRPCE1",106,0)
506 ;;.322013;
"RTN","DGRPCE1",107,0)
507 ;;.32103;.3212;
"RTN","DGRPCE1",108,0)
516 ;;.03;
"RTN","DGRPCE1",109,0)
517 ;;.03;
"RTN","DGRPCE1",110,0)
 ;
"RTN","DGRPCE1",111,0)
YN(FLD,DFN,FILE) ; return binary for YES/NO flds in the Patient (#2) file
"RTN","DGRPCE1",112,0)
 N RTN
"RTN","DGRPCE1",113,0)
 Q:$G(FLD)']"" ""
"RTN","DGRPCE1",114,0)
 S:$G(FILE)="" FILE=2 S:$G(DFN)="" DFN=$G(DA) Q:$G(DFN)']"" ""
"RTN","DGRPCE1",115,0)
 S RTN=$$GET1^DIQ(FILE,DFN_",",FLD,"I")
"RTN","DGRPCE1",116,0)
 Q $S(RTN=1:1,RTN=0:0,RTN="Y":1,RTN="N":0,1:"")
"RTN","DGRPCE1",117,0)
 ;
"RTN","DGRPCE1",118,0)
DGERCK(STR,DGER) ;do any of the STR errors exist in DGER?
"RTN","DGRPCE1",119,0)
 N RTN,X
"RTN","DGRPCE1",120,0)
 Q:$G(STR)']"" 0  Q:$G(DGER)']"" 0
"RTN","DGRPCE1",121,0)
 S RTN=0 F X=1:1 Q:RTN!($P(STR,"^",X)="")  I DGER[(","_$P(STR,"^",X)_",") S RTN=1
"RTN","DGRPCE1",122,0)
 Q RTN
"RTN","DGRPCE1",123,0)
 ;
"RTN","DGRPCE1",124,0)
NEWMSE(DFN) ;Is there data in the new MSE sub-file #2.3216?
"RTN","DGRPCE1",125,0)
 I $G(DFN)="" S DFN=$G(DA)
"RTN","DGRPCE1",126,0)
 Q:$G(DFN)="" 0
"RTN","DGRPCE1",127,0)
 I $O(^DPT(DFN,.3216,0)) Q 1
"RTN","DGRPCE1",128,0)
 Q 0
"RTN","DGRPCE1",129,0)
 ;
"RTN","DGRPCE1",130,0)
MSERR() ;Are there MSE data inconsistencies?
"RTN","DGRPCE1",131,0)
 N ERR,RTN
"RTN","DGRPCE1",132,0)
 S RTN=0
"RTN","DGRPCE1",133,0)
 ;DG*5.3*855
"RTN","DGRPCE1",134,0)
 F ERR=9,10,11,12,13,14,18,19,20,22,24,36,51,67,72,73,79,81,82,83 I DGER[(","_ERR_",") S RTN=1 Q
"RTN","DGRPCE1",135,0)
 Q RTN
"UP",2,2.0537026,-1)
2^1
"UP",2,2.0537026,0)
2.0537026
"UP",2,2.0537041,-1)
2^3
"UP",2,2.0537041,0)
2.0537041
"UP",2,2.0537042,-1)
2^4
"UP",2,2.0537042,0)
2.0537042
"UP",2,2.5370262,-2)
2^1
"UP",2,2.5370262,-1)
2.0537026^1
"UP",2,2.5370262,0)
2.5370262
"VER")
8.0^22.0
"^DD",2,2,537026,0)
MHV SOCIALIZATION^2.0537026DA^^1;0
"^DD",2,2,537026,21,0)
^^7^7^3160722^
"^DD",2,2,537026,21,1,0)
This multiple contains all of patient responses to questions about My 
"^DD",2,2,537026,21,2,0)
HealtheVet registration and actions taken by the clerk to acquaint the 
"^DD",2,2,537026,21,3,0)
patient with My HealtheVet (MHV).  Once a patients registration in My 
"^DD",2,2,537026,21,4,0)
HealtheVet is confirmed by setting the MHV Registered (#537027), the MHV
"^DD",2,2,537026,21,5,0)
AUTHENTICATED (#537028), and MHV SECURE MESSAGING (#537029) fields to to 1
"^DD",2,2,537026,21,6,0)
(YES) and/or 0 (NO), no additional actions or responses will be filed
"^DD",2,2,537026,21,7,0)
here.
"^DD",2,2,537026,"DT")
3140912
"^DD",2,2,537027,0)
MHV REGISTERED^S^0:NO;1:YES;^2;1^Q
"^DD",2,2,537027,3)
Enter YES if the patient is registered in My HealtheVet, otherwise enter NO.
"^DD",2,2,537027,21,0)
^^2^2^3160719^
"^DD",2,2,537027,21,1,0)
This field indicates whether the patient is, or is not, registered in My 
"^DD",2,2,537027,21,2,0)
HealtheVet.
"^DD",2,2,537027,"DT")
3160719
"^DD",2,2,537028,0)
MHV AUTHENTICATED^S^0:NO;1:YES;2:ACTION;^2;2^Q
"^DD",2,2,537028,3)
Enter YES if the patient's My HealtheVet registration has been authenticated, otherwise enter NO.
"^DD",2,2,537028,21,0)
^^3^3^3160720^
"^DD",2,2,537028,21,1,0)
This field indicates if the patient's My HealtheVet registraton has, or 
"^DD",2,2,537028,21,2,0)
has not, been authenticated. This field may only be accessed if the 
"^DD",2,2,537028,21,3,0)
patient has been registered in My HealtheVet (MHV REGISTERED equals YES).
"^DD",2,2,537028,"DT")
3150424
"^DD",2,2,537029,0)
MHV SECURE MESSAGING^S^0:NO;1:YES;2:ACTION;^2;3^Q
"^DD",2,2,537029,3)
If the patient has opted to use secure messaging with their My HealtheVet account, enter YES. Otherwise enter NO.
"^DD",2,2,537029,21,0)
^^4^4^3160719^
"^DD",2,2,537029,21,1,0)
This field indicates whether the patient has, or has not, opted to use 
"^DD",2,2,537029,21,2,0)
secure messaging with their My HealtheVet account. This field may only be 
"^DD",2,2,537029,21,3,0)
accessed if the patient's My HealtheVet registration has been
"^DD",2,2,537029,21,4,0)
authenticated (MHV AUTHENTICATED equals YES).
"^DD",2,2,537029,"DT")
3160307
"^DD",2,2,537030,0)
MHVREG UPDATE DATE/TIME^D^^2;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537030,.1)

"^DD",2,2,537030,3)
Enter the date/time My HealtheVet registration was confirmed.
"^DD",2,2,537030,21,0)
^.001^3^3^3160720^^
"^DD",2,2,537030,21,1,0)
This field captures the Date/Time the patient was confirmed for My 
"^DD",2,2,537030,21,2,0)
HealtheVet registration and when the MHV REGISTERED field was set to 1
"^DD",2,2,537030,21,3,0)
(YES).
"^DD",2,2,537030,"DT")
3160720
"^DD",2,2,537031,0)
MHVAUTH UPDATE DATE/TIME^D^^2;5^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537031,3)
Enter the date/time My HealtheVet registration was authenticated.
"^DD",2,2,537031,21,0)
^.001^2^2^3160720^^
"^DD",2,2,537031,21,1,0)
This field captures the date/time the patient's My HealtheVet registration
"^DD",2,2,537031,21,2,0)
was authenticated by setting the MHV AUTHENTICATED field to 1 (YES).
"^DD",2,2,537031,"DT")
3150424
"^DD",2,2,537032,0)
MHVSM UPDATE DATE/TIME^D^^2;6^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537032,3)
Enter the date/time the patient opted to use secure messaging with their My HealtheVet account.
"^DD",2,2,537032,21,0)
^^2^2^3160719^
"^DD",2,2,537032,21,1,0)
This field captures the date/time the patient's My HealtheVet registration
"^DD",2,2,537032,21,2,0)
was approved for secure messaging by the patient.
"^DD",2,2,537032,"DT")
3150424
"^DD",2,2,537033,0)
MHV REGISTER DECLINED TEXT^F^^2.1;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537033,3)
Enter 2 to 250 characters free text reason the patient declined to register in My HealtheVet.
"^DD",2,2,537033,21,0)
^.001^3^3^3160720^^
"^DD",2,2,537033,21,1,0)
This field captures a free text reason the patient declined to register in
"^DD",2,2,537033,21,2,0)
My HealtheVet. This free text reason may only be entered when "9-Other" is
"^DD",2,2,537033,21,3,0)
selected in response to the MHV MSG DECLINED REASON field.
"^DD",2,2,537033,"DT")
3160720
"^DD",2,2,537034,0)
MHV AUTH DECLINED TEXT^F^^2.2;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537034,3)
Enter 2 to 250 characters free text reason the patient declined to authenticate their My HealtheVet registration.
"^DD",2,2,537034,21,0)
^^4^4^3160719^
"^DD",2,2,537034,21,1,0)
This field captures a free text reason the patient declined to 
"^DD",2,2,537034,21,2,0)
authenticate their My HealtheVet registration. This free text reason may 
"^DD",2,2,537034,21,3,0)
only be entered when "9-Other" is selected in response to the MHV AUTH 
"^DD",2,2,537034,21,4,0)
DECLINED REASON field.
"^DD",2,2,537034,"DT")
3160307
"^DD",2,2,537035,0)
MHV MSG DECLINED TEXT^F^^2.3;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537035,3)
Enter 2 to 250 characters free text reason the patient declined to use secure messaging with their My HealtheVet account.
"^DD",2,2,537035,21,0)
^^4^4^3160719^
"^DD",2,2,537035,21,1,0)
This field captures a free text reason the patient declined to use secure 
"^DD",2,2,537035,21,2,0)
messaging with their My HealtheVet registration. This free text reason may
"^DD",2,2,537035,21,3,0)
only be entered when "9-Other" is selected in response to the MHV MSG 
"^DD",2,2,537035,21,4,0)
DECLINED REASON field.
"^DD",2,2,537035,"DT")
3160307
"^DD",2,2,537036,0)
MHV REGISTER DECLINED REASON^P390.03'^DGMHV(390.03,^2;7^Q
"^DD",2,2,537036,3)
Enter the reason the patient declined to register in My HealtheVet.
"^DD",2,2,537036,21,0)
^.001^2^2^3160719^^
"^DD",2,2,537036,21,1,0)
This field captures the reason the patient declined to register in My
"^DD",2,2,537036,21,2,0)
HealtheVet.
"^DD",2,2,537036,"DT")
3160719
"^DD",2,2,537037,0)
MHV AUTH DECLINED REASON^P390.03'^DGMHV(390.03,^2;8^Q
"^DD",2,2,537037,3)
Enter the reason the patient declined to authenticate their My HealtheVet registration.
"^DD",2,2,537037,21,0)
^^2^2^3160719^
"^DD",2,2,537037,21,1,0)
This field captures the reason the patient declined to authenticate their
"^DD",2,2,537037,21,2,0)
My HealtheVet registration.
"^DD",2,2,537037,"DT")
3160328
"^DD",2,2,537038,0)
MHV MSG DECLINED REASON^P390.03'^DGMHV(390.03,^2;9^Q
"^DD",2,2,537038,3)
Enter the reason the patient declined to use secure messaging with their My HealtheVet account.
"^DD",2,2,537038,21,0)
^.001^2^2^3160719^^
"^DD",2,2,537038,21,1,0)
This field captures the reason the patient declined to use secure 
"^DD",2,2,537038,21,2,0)
messaging with their My HealtheVet account.
"^DD",2,2,537038,"DT")
3150424
"^DD",2,2,537041,0)
MHV MSG ACTIONS^2.0537041P^^3;0
"^DD",2,2,537041,21,0)
^.001^3^3^3160719^^^
"^DD",2,2,537041,21,1,0)
The MHV MSG ACTIONS multiple captures the actions taken by the 
"^DD",2,2,537041,21,2,0)
registration clerk to assist a patient opting to use secure messaging 
"^DD",2,2,537041,21,3,0)
with their My HealtheVet account.
"^DD",2,2,537042,0)
MHV AUTH ACTIONS^2.0537042P^^4;0
"^DD",2,2,537042,21,0)
^^3^3^3160719^
"^DD",2,2,537042,21,1,0)
The MHV AUTH ACTIONS multiple contains the actions taken by the 
"^DD",2,2,537042,21,2,0)
registration clerk to upgrade/authenticate the patient's My HealtheVet 
"^DD",2,2,537042,21,3,0)
registration.
"^DD",2,2.0537026,0)
MHV SOCIALIZATION SUB-FIELD^^2^3
"^DD",2,2.0537026,0,"DT")
3160722
"^DD",2,2.0537026,0,"IX","B",2.0537026,.01)

"^DD",2,2.0537026,0,"NM","MHV SOCIALIZATION")

"^DD",2,2.0537026,0,"UP")
2
"^DD",2,2.0537026,.01,0)
SOCIALIZATION DATE^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2.0537026,.01,1,0)
^.1
"^DD",2,2.0537026,.01,1,1,0)
2.0537026^B
"^DD",2,2.0537026,.01,1,1,1)
S ^DPT(DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537026,.01,1,1,2)
K ^DPT(DA(1),1,"B",$E(X,1,30),DA)
"^DD",2,2.0537026,.01,3)
Enter the date/time the patient responded to Socialization questions.
"^DD",2,2.0537026,.01,21,0)
^.001^2^2^3160719^^
"^DD",2,2.0537026,.01,21,1,0)
This is the date and time the patient responded to the My HealtheVet 
"^DD",2,2.0537026,.01,21,2,0)
socialization questions.
"^DD",2,2.0537026,.01,"DT")
3160719
"^DD",2,2.0537026,1,0)
SOCIALIZATION RESPONSE^RP390.01'^DGMHV(390.01,^0;2^Q
"^DD",2,2.0537026,1,3)
Enter the response to the Socialization question for My HealtheVet registration.
"^DD",2,2.0537026,1,21,0)
^^2^2^3160719^
"^DD",2,2.0537026,1,21,1,0)
This is the response to the Socialization question asked to the patient 
"^DD",2,2.0537026,1,21,2,0)
about My HealtheVet registration.
"^DD",2,2.0537026,1,"DT")
3150424
"^DD",2,2.0537026,2,0)
SOCIALIZATION ACTIONS^2.5370262PA^^1;0
"^DD",2,2.0537026,2,21,0)
^^2^2^3160722^^
"^DD",2,2.0537026,2,21,1,0)
This multiple field contains the responses to the Socialization Action
"^DD",2,2.0537026,2,21,2,0)
question asked to the patient about my HealtheVet registration.
"^DD",2,2.0537041,0)
MHV MSG ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.0537041,0,"DT")
3141029
"^DD",2,2.0537041,0,"IX","B",2.0537041,.01)

"^DD",2,2.0537041,0,"NM","MHV MSG ACTIONS")

"^DD",2,2.0537041,0,"UP")
2
"^DD",2,2.0537041,.01,0)
MHV MSG ACTIONS^MP390.02^DGMHV(390.02,^0;1^Q
"^DD",2,2.0537041,.01,1,0)
^.1
"^DD",2,2.0537041,.01,1,1,0)
2.0537041^B
"^DD",2,2.0537041,.01,1,1,1)
S ^DPT(DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537041,.01,1,1,2)
K ^DPT(DA(1),3,"B",$E(X,1,30),DA)
"^DD",2,2.0537041,.01,3)
Select the action taken to assist the patient's use of secure messaging with their My HealtheVet account.
"^DD",2,2.0537041,.01,21,0)
^.001^4^4^3160719^^
"^DD",2,2.0537041,.01,21,1,0)
This field contains actions taken by the clerk to assist a patient opting 
"^DD",2,2.0537041,.01,21,2,0)
to use secure messaging with their My HealtheVet account. The prompt for 
"^DD",2,2.0537041,.01,21,3,0)
actions only displays when A(ction) is entered in the MHV SECURE 
"^DD",2,2.0537041,.01,21,4,0)
MESSAGING field.
"^DD",2,2.0537041,.01,"DT")
3150424
"^DD",2,2.0537042,0)
MHV AUTH ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.0537042,0,"DT")
3141017
"^DD",2,2.0537042,0,"IX","B",2.0537042,.01)

"^DD",2,2.0537042,0,"NM","MHV AUTH ACTIONS")

"^DD",2,2.0537042,0,"UP")
2
"^DD",2,2.0537042,.01,0)
MHV AUTH ACTIONS^P390.02'^DGMHV(390.02,^0;1^Q
"^DD",2,2.0537042,.01,1,0)
^.1
"^DD",2,2.0537042,.01,1,1,0)
2.0537042^B
"^DD",2,2.0537042,.01,1,1,1)
S ^DPT(DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537042,.01,1,1,2)
K ^DPT(DA(1),4,"B",$E(X,1,30),DA)
"^DD",2,2.0537042,.01,3)
Select the action taken to upgrade/authenticate the patient's My HealtheVet registration.
"^DD",2,2.0537042,.01,21,0)
^^3^3^3160719^
"^DD",2,2.0537042,.01,21,1,0)
This field contains actions taken by the clerk to upgrade/authenticate 
"^DD",2,2.0537042,.01,21,2,0)
the patient's My HealtheVet registration. The prompt for this field only 
"^DD",2,2.0537042,.01,21,3,0)
displays when A(ction) is entered in the MHV REGISTERED field.
"^DD",2,2.0537042,.01,"DT")
3160307
"^DD",2,2.5370262,0)
SOCIALIZATION ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.5370262,0,"DT")
3160722
"^DD",2,2.5370262,0,"IX","B",2.5370262,.01)

"^DD",2,2.5370262,0,"NM","SOCIALIZATION ACTIONS")

"^DD",2,2.5370262,0,"UP")
2.0537026
"^DD",2,2.5370262,.01,0)
SOCIALIZATION ACTIONS^P390.02'^DGMHV(390.02,^0;1^Q
"^DD",2,2.5370262,.01,1,0)
^.1
"^DD",2,2.5370262,.01,1,1,0)
2.5370262^B
"^DD",2,2.5370262,.01,1,1,1)
S ^DPT(DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2,2.5370262,.01,1,1,2)
K ^DPT(DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2,2.5370262,.01,3)
Select a Socialization Action for the My HealtheVet registration response.
"^DD",2,2.5370262,.01,21,0)
^^3^3^3160722^
"^DD",2,2.5370262,.01,21,1,0)
This is the response to the Socialization Action question asked to the
"^DD",2,2.5370262,.01,21,2,0)
patient about My HealtheVet registration. It must be one of the
"^DD",2,2.5370262,.01,21,3,0)
pre-defined actions contained in the MHV Socialization (#390.02) file.
"^DD",2,2.5370262,.01,"DT")
3160722
"^DD",43,43,1100.07,0)
Enable My HealtheVet Prompts?^S^0:NO;1:YES;^DGPRE;7^Q
"^DD",43,43,1100.07,.1)
Enable "Increase Engagement in My HealtheVet" Prompts when PreRegistering Patients?
"^DD",43,43,1100.07,3)
Enter "YES" if you wish to enable the "Increase Engagement in My HealtheVet" Pre-Register Patient Interface. Leave blank or enter "NO" to disable this interface.
"^DD",43,43,1100.07,21,0)
^^8^8^3160818^
"^DD",43,43,1100.07,21,1,0)
When using the PreRegister Patient [DGPRE PreRegister Patient] option if
"^DD",43,43,1100.07,21,2,0)
"Increase Engagement in My HealtheVet" functionality is enabled then the
"^DD",43,43,1100.07,21,3,0)
clerk will be prompted to ask Veterans if they are enrolled in
"^DD",43,43,1100.07,21,4,0)
My HealtheVet and if not, to encourage them to enroll.
"^DD",43,43,1100.07,21,5,0)
 
"^DD",43,43,1100.07,21,6,0)
This is an optional field which only needs to be set to "YES" when a site
"^DD",43,43,1100.07,21,7,0)
desires to use this functionality. This field was added with Patch
"^DD",43,43,1100.07,21,8,0)
DG*5.3*903 (Increase Engagement in My HealtheVet during Pre-Registration).
"^DD",43,43,1100.07,"DT")
3160818
"^DD",390.01,390.01,0)
FIELD^^3^6
"^DD",390.01,390.01,0,"DDA")
N
"^DD",390.01,390.01,0,"DT")
3140916
"^DD",390.01,390.01,0,"IX","B",390.01,.01)

"^DD",390.01,390.01,0,"IX","C",390.01,1)

"^DD",390.01,390.01,0,"NM","MHV SOCIALIZATION")

"^DD",390.01,390.01,0,"PT",2.0537026,1)

"^DD",390.01,390.01,0,"VRPK")
DG
"^DD",390.01,390.01,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1.N) X
"^DD",390.01,390.01,.001,3)
Enter a number between 1 and 99 for the internal entry number of the record.
"^DD",390.01,390.01,.001,21,0)
^^2^2^3150424^
"^DD",390.01,390.01,.001,21,1,0)
The NUMBER field contains the internal entry number of the MHV 
"^DD",390.01,390.01,.001,21,2,0)
SOCIALIZATION record.
"^DD",390.01,390.01,.001,"DT")
3160307
"^DD",390.01,390.01,.01,0)
NAME^RF^^0;1^K:$L(X)>60!($L(X)<3) X
"^DD",390.01,390.01,.01,1,0)
^.1
"^DD",390.01,390.01,.01,1,1,0)
390.01^B
"^DD",390.01,390.01,.01,1,1,1)
S ^DGMHV(390.01,"B",$E(X,1,30),DA)=""
"^DD",390.01,390.01,.01,1,1,2)
K ^DGMHV(390.01,"B",$E(X,1,30),DA)
"^DD",390.01,390.01,.01,3)
Enter 3 to 60 characters text representing a possible patient response to the clerk's encouragement to register in My HealtheVet.
"^DD",390.01,390.01,.01,21,0)
^^2^2^3160719^
"^DD",390.01,390.01,.01,21,1,0)
This is text representing a possible patient response to the clerk's 
"^DD",390.01,390.01,.01,21,2,0)
encouragement to register in My HealtheVet.
"^DD",390.01,390.01,.01,"DT")
3160307
"^DD",390.01,390.01,1,0)
DISPLAY SEQUENCE^NJ5,0^^1;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",390.01,390.01,1,1,0)
^.1
"^DD",390.01,390.01,1,1,1,0)
390.01^C
"^DD",390.01,390.01,1,1,1,1)
S ^DGMHV(390.01,"C",$E(X,1,30),DA)=""
"^DD",390.01,390.01,1,1,1,2)
K ^DGMHV(390.01,"C",$E(X,1,30),DA)
"^DD",390.01,390.01,1,1,1,"%D",0)
^^2^2^3160307^
"^DD",390.01,390.01,1,1,1,"%D",1,0)
This cross-reference allows for the file entries to be displayed 
"^DD",390.01,390.01,1,1,1,"%D",2,0)
in the order defined in the Display Sequence Field.
"^DD",390.01,390.01,1,1,1,"DT")
3140915
"^DD",390.01,390.01,1,3)
Enter a number between 1 and 99999 representing the order in which the entry should display in relation to other entries.
"^DD",390.01,390.01,1,21,0)
^.001^3^3^3160719^^
"^DD",390.01,390.01,1,21,1,0)
This field contains an integer used to define where this entry will 
"^DD",390.01,390.01,1,21,2,0)
display in a list, in relation to other entries. A value of 1 displays 
"^DD",390.01,390.01,1,21,3,0)
before 2, a value of 2 displays before 3, etc.
"^DD",390.01,390.01,1,"DT")
3160307
"^DD",390.01,390.01,1.5,0)
DISPLAY TEXT^RF^^3;1^K:$L(X)>250!($L(X)<3) X
"^DD",390.01,390.01,1.5,3)
Enter 3 to 250 characters text to be displayed to the clerk representing a patient response to register in My HealtheVet.
"^DD",390.01,390.01,1.5,21,0)
^^3^3^3160719^
"^DD",390.01,390.01,1.5,21,1,0)
This is the text representing a possible patient response to the clerk's 
"^DD",390.01,390.01,1.5,21,2,0)
encouragement to register in My HealtheVet that is displayed during the 
"^DD",390.01,390.01,1.5,21,3,0)
registration process.
"^DD",390.01,390.01,1.5,"DT")
3160307
"^DD",390.01,390.01,2,0)
PATIENT TEXT^390.12^^2;0
"^DD",390.01,390.01,2,21,0)
^^2^2^3160719^
"^DD",390.01,390.01,2,21,1,0)
This word processing field contains text the clerk reads to the patient 
"^DD",390.01,390.01,2,21,2,0)
to encourage the patient to register in My HealtheVet.
"^DD",390.01,390.01,3,0)
FOLLOWUP ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",390.01,390.01,3,3)
Enter MUMPS code to execute after an entry is selected.
"^DD",390.01,390.01,3,9)
@
"^DD",390.01,390.01,3,21,0)
^.001^1^1^3160719^^
"^DD",390.01,390.01,3,21,1,0)
This field contains MUMPS code to execute after an entry is selected.
"^DD",390.01,390.01,3,"DT")
3160307
"^DD",390.01,390.12,0)
PATIENT TEXT SUB-FIELD^^.01^1
"^DD",390.01,390.12,0,"DT")
3140915
"^DD",390.01,390.12,0,"NM","PATIENT TEXT")

"^DD",390.01,390.12,0,"UP")
390.01
"^DD",390.01,390.12,.01,0)
PATIENT TEXT^Wx^^0;1^Q
"^DD",390.01,390.12,.01,3)
Enter the text the clerk should read to the patient to encourage the patient to register in My HealtheVet.
"^DD",390.01,390.12,.01,21,0)
^^2^2^3160719^
"^DD",390.01,390.12,.01,21,1,0)
This field contains text the clerk reads to the patient to encourage the 
"^DD",390.01,390.12,.01,21,2,0)
patient to register in My HealtheVet.
"^DD",390.01,390.12,.01,"DT")
3150424
"^DD",390.02,390.02,0)
FIELD^^1^4
"^DD",390.02,390.02,0,"DDA")
N
"^DD",390.02,390.02,0,"DT")
3141027
"^DD",390.02,390.02,0,"IX","B",390.02,.01)

"^DD",390.02,390.02,0,"NM","MHV SOCIALIZATION ACTIONS")

"^DD",390.02,390.02,0,"PT",2.0537041,.01)

"^DD",390.02,390.02,0,"PT",2.0537042,.01)

"^DD",390.02,390.02,0,"PT",2.5370262,.01)

"^DD",390.02,390.02,0,"VRPK")
DG
"^DD",390.02,390.02,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",390.02,390.02,.001,.1)
SHORT
"^DD",390.02,390.02,.001,3)
Enter a number between 1 and 99 for the internal entry number of the record.
"^DD",390.02,390.02,.001,21,0)
^^2^2^3150424^
"^DD",390.02,390.02,.001,21,1,0)
This field contains the internal entry number of the MHV SOCIALIZATIONS 
"^DD",390.02,390.02,.001,21,2,0)
ACTIONS record.
"^DD",390.02,390.02,.001,"DT")
3160307
"^DD",390.02,390.02,.01,0)
ACTION^RF^^0;1^K:$L(X)>120!($L(X)<3)!'(X'?1P.E) X
"^DD",390.02,390.02,.01,1,0)
^.1
"^DD",390.02,390.02,.01,1,1,0)
390.02^B
"^DD",390.02,390.02,.01,1,1,1)
S ^DGMHV(390.02,"B",$E(X,1,30),DA)=""
"^DD",390.02,390.02,.01,1,1,2)
K ^DGMHV(390.02,"B",$E(X,1,30),DA)
"^DD",390.02,390.02,.01,3)
Enter a 3 to 120 characters short description of the action taken by the clerk to facilitate the patient's registration in My HealtheVet.
"^DD",390.02,390.02,.01,21,0)
^.001^2^2^3160720^^
"^DD",390.02,390.02,.01,21,1,0)
This field contains an abbreviated description of the action taken by the 
"^DD",390.02,390.02,.01,21,2,0)
clerk to facilitate the patient's registration in My HealtheVet.
"^DD",390.02,390.02,.01,"DT")
3160307
"^DD",390.02,390.02,1,0)
SELECTABLE LOCATIONS^390.21P^^1;0
"^DD",390.02,390.02,1,21,0)
^.001^2^2^3160720^^^
"^DD",390.02,390.02,1,21,1,0)
This multiple contains the list of Action prompt locations in which this 
"^DD",390.02,390.02,1,21,2,0)
specific action may be displayed and selected.
"^DD",390.02,390.02,3,0)
DISPLAY TEXT^390.23^^3;0
"^DD",390.02,390.02,3,21,0)
^^3^3^3160719^
"^DD",390.02,390.02,3,21,1,0)
This word processing field contains an expanded description of the action 
"^DD",390.02,390.02,3,21,2,0)
taken by the clerk to facilitate the patient's registration in My 
"^DD",390.02,390.02,3,21,3,0)
HealtheVet.
"^DD",390.02,390.21,0)
SELECTABLE LOCATIONS SUB-FIELD^^.01^1
"^DD",390.02,390.21,0,"DT")
3141027
"^DD",390.02,390.21,0,"IX","B",390.21,.01)

"^DD",390.02,390.21,0,"NM","SELECTABLE LOCATIONS")

"^DD",390.02,390.21,0,"UP")
390.02
"^DD",390.02,390.21,.01,0)
SELECTABLE LOCATIONS^MP390.04^DGMHV(390.04,^0;1^Q
"^DD",390.02,390.21,.01,1,0)
^.1
"^DD",390.02,390.21,.01,1,1,0)
390.21^B
"^DD",390.02,390.21,.01,1,1,1)
S ^DGMHV(390.02,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",390.02,390.21,.01,1,1,2)
K ^DGMHV(390.02,DA(1),1,"B",$E(X,1,30),DA)
"^DD",390.02,390.21,.01,3)
Enter the prompts for A(ction) at which this action should display.
"^DD",390.02,390.21,.01,21,0)
^.001^5^5^3160720^^
"^DD",390.02,390.21,.01,21,1,0)
This field contains the list of A(ction) prompt locations in which this 
"^DD",390.02,390.21,.01,21,2,0)
specific action may be displayed and selected. Possible values are 
"^DD",390.02,390.21,.01,21,3,0)
Socialization, Registration, Authentication, Secure Messaging. Adding a 
"^DD",390.02,390.21,.01,21,4,0)
selectable prompt location adds the action to the list of selectable 
"^DD",390.02,390.21,.01,21,5,0)
actions for the prompt location.
"^DD",390.02,390.21,.01,"DT")
3150424
"^DD",390.02,390.23,0)
DISPLAY TEXT SUB-FIELD^^.01^1
"^DD",390.02,390.23,0,"DT")
3141030
"^DD",390.02,390.23,0,"NM","DISPLAY TEXT")

"^DD",390.02,390.23,0,"UP")
390.02
"^DD",390.02,390.23,.01,0)
DISPLAY TEXT^Wx^^0;1^Q
"^DD",390.02,390.23,.01,3)
Enter an expanded text description of the action taken by the clerk to facilitate the patient's registration in My HealtheVet.
"^DD",390.02,390.23,.01,21,0)
^^3^3^3160719^
"^DD",390.02,390.23,.01,21,1,0)
This field contains an expanded word processing description of the action 
"^DD",390.02,390.23,.01,21,2,0)
taken by the clerk to facilitate the patient's registraton in My 
"^DD",390.02,390.23,.01,21,3,0)
HealtheVet.
"^DD",390.02,390.23,.01,"DT")
3150424
"^DD",390.03,390.03,0)
FIELD^^1^3
"^DD",390.03,390.03,0,"DDA")
N
"^DD",390.03,390.03,0,"DT")
3160719
"^DD",390.03,390.03,0,"IX","B",390.03,.01)

"^DD",390.03,390.03,0,"NM","MHV DECLINED REASONS")

"^DD",390.03,390.03,0,"PT",2,537036)

"^DD",390.03,390.03,0,"PT",2,537037)

"^DD",390.03,390.03,0,"PT",2,537038)

"^DD",390.03,390.03,0,"VRPK")
DG
"^DD",390.03,390.03,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",390.03,390.03,.001,3)
Enter a number between 1 and 99 for the internal entry number for this record.
"^DD",390.03,390.03,.001,21,0)
^^2^2^3150424^
"^DD",390.03,390.03,.001,21,1,0)
This field contains the internal entry number of the MHV DECLINED REASONS 
"^DD",390.03,390.03,.001,21,2,0)
entry.
"^DD",390.03,390.03,.001,"DT")
3160307
"^DD",390.03,390.03,.01,0)
NAME^RF^^0;1^K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",390.03,390.03,.01,1,0)
^.1
"^DD",390.03,390.03,.01,1,1,0)
390.03^B
"^DD",390.03,390.03,.01,1,1,1)
S ^DGMHV(390.03,"B",$E(X,1,30),DA)=""
"^DD",390.03,390.03,.01,1,1,2)
K ^DGMHV(390.03,"B",$E(X,1,30),DA)
"^DD",390.03,390.03,.01,3)
Enter a 3 to 60 characters short reason a patient might decline My HealtheVet registration.
"^DD",390.03,390.03,.01,21,0)
^^2^2^3160719^
"^DD",390.03,390.03,.01,21,1,0)
This field contains a short pre-defined text reason a patient might 
"^DD",390.03,390.03,.01,21,2,0)
decline My HealtheVet registration.
"^DD",390.03,390.03,.01,"DT")
3160307
"^DD",390.03,390.03,1,0)
SELECTABLE AT^S^1:REGISTRATON;2:AUTHENTICATION;3:SECURE MESSAGING;12:REGISTRATION,AUTHENTICATION;123:REGISTRATION,AUTHENTICATION,SECURE MESSAGING;13:REGISTRATION,SECURE MESSAGING;23:AUTHENTICATION,SECURE MESSAGING;^0;2^Q
"^DD",390.03,390.03,1,3)
Enter the list of (A)ction prompt locations at which this action should display.
"^DD",390.03,390.03,1,21,0)
^.001^2^2^3160719^^
"^DD",390.03,390.03,1,21,1,0)
This field contains a list of (A)ction prompt locations at which this 
"^DD",390.03,390.03,1,21,2,0)
action should display.
"^DD",390.03,390.03,1,"DT")
3160719
"^DD",390.04,390.04,0)
FIELD^^1^2
"^DD",390.04,390.04,0,"DDA")
N
"^DD",390.04,390.04,0,"DT")
3160719
"^DD",390.04,390.04,0,"IX","B",390.04,.01)

"^DD",390.04,390.04,0,"NM","MHV ACTION SELECTION")

"^DD",390.04,390.04,0,"PT",390.21,.01)

"^DD",390.04,390.04,0,"VRPK")
DG
"^DD",390.04,390.04,.01,0)
NAME^S^S:SOCIALIZATION;R:REGISTRATION;A:AUTHENTICATION;M:SECURE MESSAGING;^0;1^Q
"^DD",390.04,390.04,.01,1,0)
^.1
"^DD",390.04,390.04,.01,1,1,0)
390.04^B
"^DD",390.04,390.04,.01,1,1,1)
S ^DGMHV(390.04,"B",$E(X,1,30),DA)=""
"^DD",390.04,390.04,.01,1,1,2)
K ^DGMHV(390.04,"B",$E(X,1,30),DA)
"^DD",390.04,390.04,.01,3)
Enter an (A)ction prompt location (a field that prompts for (A)ction).
"^DD",390.04,390.04,.01,21,0)
^^3^3^3160719^
"^DD",390.04,390.04,.01,21,1,0)
This field contains an (A)ction prompt location, or a field that prompts 
"^DD",390.04,390.04,.01,21,2,0)
for (A)ction. This includes the SOCIALIZATION, REGISTRATION, 
"^DD",390.04,390.04,.01,21,3,0)
AUTHENTICATION, and SECURE MESSAGING prompts.
"^DD",390.04,390.04,.01,"DT")
3160719
"^DD",390.04,390.04,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>180!($L(X)<2) X
"^DD",390.04,390.04,1,3)
Enter a 2 to 180 characters description of the (A)ction prompt location (field that prompts for (A)ction).
"^DD",390.04,390.04,1,21,0)
^^1^1^3150424^
"^DD",390.04,390.04,1,21,1,0)
This field contains a description of the (A)ction prompt location.
"^DD",390.04,390.04,1,"DT")
3160307
"^DIC",390.01,390.01,0)
MHV SOCIALIZATION^390.01
"^DIC",390.01,390.01,0,"GL")
^DGMHV(390.01,
"^DIC",390.01,390.01,"%",0)
^1.005^^0
"^DIC",390.01,390.01,"%D",0)
^^4^4^3160720^
"^DIC",390.01,390.01,"%D",1,0)
The MHV Socialization file contains informational My HealtheVet Engagement
"^DIC",390.01,390.01,"%D",2,0)
text to be read to the patient describing the benefits of My HealtheVet
"^DIC",390.01,390.01,"%D",3,0)
registration, and a follow-up dialog to capture actions taken by the clerk
"^DIC",390.01,390.01,"%D",4,0)
to assist the patient with My HealtheVet registration.
"^DIC",390.01,"B","MHV SOCIALIZATION",390.01)

"^DIC",390.02,390.02,0)
MHV SOCIALIZATION ACTIONS^390.02
"^DIC",390.02,390.02,0,"GL")
^DGMHV(390.02,
"^DIC",390.02,390.02,"%",0)
^1.005^^0
"^DIC",390.02,390.02,"%D",0)
^^3^3^3160720^
"^DIC",390.02,390.02,"%D",1,0)
The MHV Socialization Actions file contains pre-defined actions which can
"^DIC",390.02,390.02,"%D",2,0)
taken by the Pre-Registration clerk to assist the patient to register in
"^DIC",390.02,390.02,"%D",3,0)
My HealtheVet.
"^DIC",390.02,"B","MHV SOCIALIZATION ACTIONS",390.02)

"^DIC",390.03,390.03,0)
MHV DECLINED REASONS^390.03
"^DIC",390.03,390.03,0,"GL")
^DGMHV(390.03,
"^DIC",390.03,390.03,"%",0)
^1.005^^0
"^DIC",390.03,390.03,"%D",0)
^^2^2^3160720^^
"^DIC",390.03,390.03,"%D",1,0)
The MHV Declined Reasons file contains pre-defined text reasons explaining
"^DIC",390.03,390.03,"%D",2,0)
why the patient has declined My HealtheVet registration.
"^DIC",390.03,"B","MHV DECLINED REASONS",390.03)

"^DIC",390.04,390.04,0)
MHV ACTION SELECTION^390.04
"^DIC",390.04,390.04,0,"GL")
^DGMHV(390.04,
"^DIC",390.04,390.04,"%",0)
^1.005^^0
"^DIC",390.04,390.04,"%D",0)
^^6^6^3160720^
"^DIC",390.04,390.04,"%D",1,0)
The MHV Action Selection file contains the pre-defined My HealtheVet 
"^DIC",390.04,390.04,"%D",2,0)
Engagement/Registration modules that prompt for MHV SOCIALIZATION ACTIONS.
"^DIC",390.04,390.04,"%D",3,0)
This works in conjunction with the SELECTABLE LOCATIONS (#1) field in the
"^DIC",390.04,390.04,"%D",4,0)
MHV SOCIALIZATION ACTIONS (#390.02) file to screen actions and make
"^DIC",390.04,390.04,"%D",5,0)
available only actions that are appropriate for the module, or section of
"^DIC",390.04,390.04,"%D",6,0)
MHV functionality.
"^DIC",390.04,"B","MHV ACTION SELECTION",390.04)

"BLD",9835,6)
^820
**END**
**END**

