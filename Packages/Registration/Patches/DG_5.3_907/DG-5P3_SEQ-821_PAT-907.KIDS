Released DG*5.3*907 SEQ #821
Extracted from mail message
**KIDS**:DG*5.3*907^

**INSTALL NAME**
DG*5.3*907
"BLD",9684,0)
DG*5.3*907^REGISTRATION^0^3170320^y
"BLD",9684,1,0)
^^3^3^3170320^^^
"BLD",9684,1,1,0)
This patch modifies the Registration v5.3 application to update the 
"BLD",9684,1,2,0)
prompt text and display of the Birth Sex and Self-Identified Gender 
"BLD",9684,1,3,0)
Identity fields.  See patch description on Forum for full details.
"BLD",9684,4,0)
^9.64PA^2^1
"BLD",9684,4,2,0)
2
"BLD",9684,4,2,2,0)
^9.641^2^1
"BLD",9684,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",9684,4,2,2,2,1,0)
^9.6411^.024^1
"BLD",9684,4,2,2,2,1,.024,0)
SELF IDENTIFIED GENDER
"BLD",9684,4,2,222)
y^y^p^^^^n^^n
"BLD",9684,4,2,224)

"BLD",9684,4,"APDD",2,2)

"BLD",9684,4,"APDD",2,2,.024)

"BLD",9684,4,"B",2,2)

"BLD",9684,6)
6^
"BLD",9684,6.3)
28
"BLD",9684,"KRN",0)
^9.67PA^779.2^20
"BLD",9684,"KRN",.4,0)
.4
"BLD",9684,"KRN",.401,0)
.401
"BLD",9684,"KRN",.402,0)
.402
"BLD",9684,"KRN",.403,0)
.403
"BLD",9684,"KRN",.5,0)
.5
"BLD",9684,"KRN",.84,0)
.84
"BLD",9684,"KRN",.84,"NM",0)
^9.68A^^
"BLD",9684,"KRN",3.6,0)
3.6
"BLD",9684,"KRN",3.8,0)
3.8
"BLD",9684,"KRN",9.2,0)
9.2
"BLD",9684,"KRN",9.8,0)
9.8
"BLD",9684,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",9684,"KRN",9.8,"NM",1,0)
DGRPECE^^0^B89386957
"BLD",9684,"KRN",9.8,"NM",3,0)
DGRP1^^0^B40184484
"BLD",9684,"KRN",9.8,"NM",4,0)
DGRPD^^0^B69759113
"BLD",9684,"KRN",9.8,"NM","B","DGRP1",3)

"BLD",9684,"KRN",9.8,"NM","B","DGRPD",4)

"BLD",9684,"KRN",9.8,"NM","B","DGRPECE",1)

"BLD",9684,"KRN",19,0)
19
"BLD",9684,"KRN",19,"NM",0)
^9.68A^^
"BLD",9684,"KRN",19.1,0)
19.1
"BLD",9684,"KRN",101,0)
101
"BLD",9684,"KRN",409.61,0)
409.61
"BLD",9684,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9684,"KRN",771,0)
771
"BLD",9684,"KRN",779.2,0)
779.2
"BLD",9684,"KRN",870,0)
870
"BLD",9684,"KRN",8989.51,0)
8989.51
"BLD",9684,"KRN",8989.52,0)
8989.52
"BLD",9684,"KRN",8994,0)
8994
"BLD",9684,"KRN","B",.4,.4)

"BLD",9684,"KRN","B",.401,.401)

"BLD",9684,"KRN","B",.402,.402)

"BLD",9684,"KRN","B",.403,.403)

"BLD",9684,"KRN","B",.5,.5)

"BLD",9684,"KRN","B",.84,.84)

"BLD",9684,"KRN","B",3.6,3.6)

"BLD",9684,"KRN","B",3.8,3.8)

"BLD",9684,"KRN","B",9.2,9.2)

"BLD",9684,"KRN","B",9.8,9.8)

"BLD",9684,"KRN","B",19,19)

"BLD",9684,"KRN","B",19.1,19.1)

"BLD",9684,"KRN","B",101,101)

"BLD",9684,"KRN","B",409.61,409.61)

"BLD",9684,"KRN","B",771,771)

"BLD",9684,"KRN","B",779.2,779.2)

"BLD",9684,"KRN","B",870,870)

"BLD",9684,"KRN","B",8989.51,8989.51)

"BLD",9684,"KRN","B",8989.52,8989.52)

"BLD",9684,"KRN","B",8994,8994)

"BLD",9684,"PRET")

"BLD",9684,"QDEF")
^^^^NO^^^^^^YES
"BLD",9684,"QUES",0)
^9.62^^
"BLD",9684,"REQB",0)
^9.611^4^4
"BLD",9684,"REQB",1,0)
DG*5.3*876^1
"BLD",9684,"REQB",2,0)
DG*5.3*831^1
"BLD",9684,"REQB",3,0)
DG*5.3*851^1
"BLD",9684,"REQB",4,0)
DG*5.3*887^1
"BLD",9684,"REQB","B","DG*5.3*831",2)

"BLD",9684,"REQB","B","DG*5.3*851",3)

"BLD",9684,"REQB","B","DG*5.3*876",1)

"BLD",9684,"REQB","B","DG*5.3*887",4)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^y^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.024)

"IX",2,2,"AVAFC024",0)
2^AVAFC024^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"AVAFC024",.1,0)
^^5^5^3140415
"IX",2,2,"AVAFC024",.1,1,0)
This cross-reference activates the DG FIELD MONITOR event point.
"IX",2,2,"AVAFC024",.1,2,0)
Applications that wish to monitor edit activity related to this field may
"IX",2,2,"AVAFC024",.1,3,0)
subscribe to that event point and take action as indicated by the changes
"IX",2,2,"AVAFC024",.1,4,0)
that occur.  Refer to the DG FIELD MONITOR protocol for a description of
"IX",2,2,"AVAFC024",.1,5,0)
the information available at the time of the event.
"IX",2,2,"AVAFC024",1)
D FC^DGFCPROT(.DA,2,.024,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC024",2)
D FC^DGFCPROT(.DA,2,.024,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC024",11.1,0)
^.114IA^1^1
"IX",2,2,"AVAFC024",11.1,1,0)
1^F^2^.024^^^F
"MBREQ")
0
"PKG",47,-1)
1^1
"PKG",47,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",47,20,0)
^9.402P^^
"PKG",47,22,0)
^9.49I^1^1
"PKG",47,22,1,0)
5.3^2930813^2960613
"PKG",47,22,1,"PAH",1,0)
907^3170320^100948
"PKG",47,22,1,"PAH",1,1,0)
^^3^3^3170320
"PKG",47,22,1,"PAH",1,1,1,0)
This patch modifies the Registration v5.3 application to update the 
"PKG",47,22,1,"PAH",1,1,2,0)
prompt text and display of the Birth Sex and Self-Identified Gender 
"PKG",47,22,1,"PAH",1,1,3,0)
Identity fields.  See patch description on Forum for full details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGRP1")
0^3^B40184484^B35716153
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL,ERC,BAJ,PWC - DEMOGRAPHIC DATA ; 8/15/08 11:30am
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244,546,570,629,638,649,700,653,688,750,851,907**;Aug 13, 1993;Build 28
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN ;
"RTN","DGRP1",5,0)
 S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.122,.13,.15,.24,57,"SSN" S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",6,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 ;I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",8,0)
 ;Retrieve SSN Verification status DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",9,0)
 N SSNV D GETSTAT(.SSNV)
"RTN","DGRP1",10,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV
"RTN","DGRP1",11,0)
 ;Display SSN and SSN Verification status DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",12,0)
 W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV W SSNV
"RTN","DGRP1",13,0)
 W ! S Z="",Z1=8 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",14,0)
 ;add Pseuso SSN Reason - DG*5.3*653, ERC
"RTN","DGRP1",15,0)
 I $P(DGRP(0),U,9)["P" D
"RTN","DGRP1",16,0)
 . N DGSPACE
"RTN","DGRP1",17,0)
 . S DGSPACE=10-$L(Y) ;adjust to maintain spacing on screen
"RTN","DGRP1",18,0)
 . S Z1=12+DGSPACE D WW1^DGRPV W "PSSN Reason: "
"RTN","DGRP1",19,0)
 . I $P(DGRP(0),U,9)["P" D
"RTN","DGRP1",20,0)
 . . N DGREAS D SSNREAS(.DGREAS)
"RTN","DGRP1",21,0)
 . . Q:$G(DGREAS)']""
"RTN","DGRP1",22,0)
 . . W DGREAS
"RTN","DGRP1",23,0)
 D GETNCAL  ;Display name component, sex, and alias information
"RTN","DGRP1",24,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",25,0)
 S Z=4 D WW^DGRPV W " Permanent Address: " S Z=" ",Z1=17
"RTN","DGRP1",26,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Address: "
"RTN","DGRP1",27,0)
 W !?9
"RTN","DGRP1",28,0)
 S Z1=39,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",29,0)
 ; loop through DGA array beginning with DGA(2) and print data at ?9 (odds) and ?48 (evens)
"RTN","DGRP1",30,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?9 W:'(I#2) ?48 W DGA(I)
"RTN","DGRP1",31,0)
 D COUNTY(.DGRP)  ; print County if applicable
"RTN","DGRP1",32,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",33,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",34,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",35,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",36,0)
 ;
"RTN","DGRP1",37,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",38,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",39,0)
 . W !
"RTN","DGRP1",40,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1,ADDRDTTM
"RTN","DGRP1",41,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",42,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",43,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",44,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",45,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",46,0)
 . S ADDRDTTM=$P($G(^DPT(DFN,.11)),"^",13)
"RTN","DGRP1",47,0)
 . I ADDRDTTM'="" W !," [PERMANENT ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(ADDRDTTM,"5D")
"RTN","DGRP1",48,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",49,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",50,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",51,0)
 . ; The IB Insurance API does not provide date entered or edited information, so this information will not be displayed for preregistration
"RTN","DGRP1",52,0)
 . I $$INSUR^IBBAPI(DFN,"","AR",.DGDATA,"1,10,11") F DGI=0:0 S DGI=$O(DGDATA("IBBAPI","INSUR",DGI)) Q:'DGI  D
"RTN","DGRP1",53,0)
 .. W !," [INSURANCE:] ",$P(DGDATA("IBBAPI","INSUR",DGI,1),U,2)
"RTN","DGRP1",54,0)
 .. W "  EFFECTIVE DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,10),"5D"),"  EXPIRATION DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,11),"5D")
"RTN","DGRP1",55,0)
 ;
"RTN","DGRP1",56,0)
 G ^DGRPP
"RTN","DGRP1",57,0)
 ;
"RTN","DGRP1",58,0)
GETNCAL ;Get name component values
"RTN","DGRP1",59,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",60,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",61,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",62,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",63,0)
 ;Get alias values
"RTN","DGRP1",64,0)
 S DGA=0 F DGI=1:1:5 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",65,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",66,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",67,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",68,0)
 .I DGI=5 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",69,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",70,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",71,0)
 .I $L(DGX) D
"RTN","DGRP1",72,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,9)
"RTN","DGRP1",73,0)
 ..; BAJ DG*5.2*700 retrofit 06/22/06
"RTN","DGRP1",74,0)
 ..S DGALIAS(DGI)=$E(DGALIAS(DGI),1,19)
"RTN","DGRP1",75,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",76,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,32)
"RTN","DGRP1",77,0)
 .Q  ;
"RTN","DGRP1",78,0)
 ;Display name component, sex, multiple birth indicator and alias data
"RTN","DGRP1",79,0)
 F DGI=1:1:6 D
"RTN","DGRP1",80,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:28,1:27))
"RTN","DGRP1",81,0)
 .; BAJ DG*5.3*700 retrofit 06/22/06
"RTN","DGRP1",82,0)
 .; ob - 10/22/14 added "Birth" on the next line
"RTN","DGRP1",83,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?37,"Birth Sex: " S X=$P(DGRP(0),"^",2),Z=$S(X="M":"MALE",X="F":"FEMALE",1:DGRPU),Z1=3 D WW1^DGRPV ;DG*5.3*907
"RTN","DGRP1",84,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?56,"MBI: " S X=$P($G(^DPT(DFN,"MPIMB")),U),Z=$S(X="N":"NO",X="Y":"*MULTIPLE BIRTH*",1:DGRPU),Z1=16 D WW1^DGRPV
"RTN","DGRP1",85,0)
 .I DGI=2 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",86,0)
 .I DGI>1 W ?47,$G(DGALIAS(DGI-1))
"RTN","DGRP1",87,0)
 .Q
"RTN","DGRP1",88,0)
 ;*** display Self-Identified Gender Identity DG*5.3*907
"RTN","DGRP1",89,0)
 ;Get node with SIGI in it already done at EN+1
"RTN","DGRP1",90,0)
 W !?5,"Self-Identified Gender Identity: "
"RTN","DGRP1",91,0)
 S X=$P(DGRP(.24),"^",4),Z=$S(X="M":"MALE",X="F":"FEMALE",X="TM":"TRANSMALE/TRANSMAN/FEMALE-TO-MALE",X="TF":"TRANSFEMALE/TRANSWOMAN/MALE-TO-FEMALE",X="O":"OTHER",X="N":"INDIVIDUAL CHOOSES NOT TO ANSWER",1:DGRPU) W Z ;D WW1^DGRPV
"RTN","DGRP1",92,0)
 ; *** end of change 
"RTN","DGRP1",93,0)
 Q
"RTN","DGRP1",94,0)
GETSTAT(SSNV) ;get SSN VERIFIED STATUS DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",95,0)
 N T
"RTN","DGRP1",96,0)
 S T=$P($G(^DPT(DFN,"SSN")),"^",2)
"RTN","DGRP1",97,0)
 S SSNV=$S(T=2:"INVALID",T=4:"VERIFIED",1:"")
"RTN","DGRP1",98,0)
 Q
"RTN","DGRP1",99,0)
 ;
"RTN","DGRP1",100,0)
SSNREAS(DGREAS) ;get Pseuso SSN Reason - DG*5.3*653, ERC
"RTN","DGRP1",101,0)
 S DGREAS=$P(DGRP("SSN"),U)
"RTN","DGRP1",102,0)
 I $G(DGREAS)']"" Q
"RTN","DGRP1",103,0)
 S DGREAS=$S(DGREAS="R":"Refused to Provide",DGREAS="S":"SSN Unknown/Follow-up Required",DGREAS="N":"No SSN Assigned",1:"< None Entered >")
"RTN","DGRP1",104,0)
 Q
"RTN","DGRP1",105,0)
COUNTY(DGRP) ;retrieve and print County info if a US address
"RTN","DGRP1",106,0)
 N DGCC,CNODE,FNODE,FPCE,FILE,IEN,CNTRY,PLINE
"RTN","DGRP1",107,0)
 ; data location of Permanent Address County info
"RTN","DGRP1",108,0)
 S FNODE=.11,FPCE=10,DGCC=""
"RTN","DGRP1",109,0)
 ; only print county info if it's a US address
"RTN","DGRP1",110,0)
 S IEN=$P(DGRP(FNODE),U,FPCE) I '$$FORIEN^DGADDUTL(IEN) D
"RTN","DGRP1",111,0)
 . S DGCC=$S($D(^DIC(5,+$P(DGRP(FNODE),U,5),1,+$P(DGRP(FNODE),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRP1",112,0)
 S PLINE=$S(DGCC]"":"County: "_DGCC,1:"")
"RTN","DGRP1",113,0)
 W !?3,PLINE
"RTN","DGRP1",114,0)
 S DGCC=""
"RTN","DGRP1",115,0)
 ; data location of Temporary address County info
"RTN","DGRP1",116,0)
 S CNODE=.121,FNODE=.122,FPCE=3
"RTN","DGRP1",117,0)
 ; only print county info if it's a US address
"RTN","DGRP1",118,0)
 S IEN=$P(DGRP(FNODE),U,FPCE) I '$$FORIEN^DGADDUTL(IEN) D
"RTN","DGRP1",119,0)
 . S DGCC=$S($P(DGRP(CNODE),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(CNODE),U,5),1,+$P(DGRP(CNODE),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRP1",120,0)
 S PLINE=$S(DGCC]"":"County: "_DGCC,1:"")
"RTN","DGRP1",121,0)
 W ?43,PLINE
"RTN","DGRP1",122,0)
 Q
"RTN","DGRP1",123,0)
 ;
"RTN","DGRPD")
0^4^B69759113^B69529511
"RTN","DGRPD",1,0)
DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC/BAJ-PATIENT INQUIRY (NEW) ; July 09, 2014
"RTN","DGRPD",2,0)
 ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518,550,545,568,585,677,703,688,887,907**;Aug 13, 1993;Build 28
"RTN","DGRPD",3,0)
 ;  *286*  Newing variables X,Y in OKLINE subroutine
"RTN","DGRPD",4,0)
 ;  *358*  If a patient is on a domiciliary ward, don't display MEANS
"RTN","DGRPD",5,0)
 ;         TEST required/Medication Copayment Exemption messages
"RTN","DGRPD",6,0)
 ;  *436*  If an inpatient is not on a domiciliary ward, don't display
"RTN","DGRPD",7,0)
 ;         Medication Copayment Exemption message
"RTN","DGRPD",8,0)
 ;  *545*  Add death information near the remarks field
"RTN","DGRPD",9,0)
 ;  *677*  Added Emergency Response
"RTN","DGRPD",10,0)
 ;  *688*  Modified to display Country and Foreign Address
"RTN","DGRPD",11,0)
SEL K DFN,DGRPOUT W ! S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC G Q:Y'>0 S DFN=+Y N Y W ! S DIR(0)="E" D ^DIR G SEL:$D(DTOUT)!($D(DUOUT)) D EN G SEL
"RTN","DGRPD",12,0)
EN ;call to display patient inquiry - input DFN
"RTN","DGRPD",13,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",14,0)
 S DGCMOR="UNSPECIFIED",DGMPI=$G(^DPT(+DFN,"MPI"))
"RTN","DGRPD",15,0)
 S DGLOCATN=$$FIND1^DIC(4,"","MX","`"_+$P(DGMPI,U,3)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:"NOT LISTED")
"RTN","DGRPD",16,0)
 I $D(DGMPI),$D(DGLOCATN) S DGCMOR=$P(DGLOCATN,"^")
"RTN","DGRPD",17,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",18,0)
 K DGRPOUT,DGHOW S DGABBRV=$S($D(^DG(43,1,0)):+$P(^(0),"^",38),1:0),DGRPU="UNSPECIFIED" D DEM^VADPT,HDR^DGRPD1 F I=0,.11,.13,.121,.122,.31,.32,.36,.361,.141,.3 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRPD",19,0)
 S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU S DGTMPAD=0 I $P(DGRP(.121),"^",9)="Y" S DGTMPAD=$S('$P(DGRP(.121),"^",8):1,$P(DGRP(.121),"^",8)'<DT:1,1:0) I DGTMPAD S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRPD",20,0)
 W ?1,"Address: ",$S($D(DGA(1)):DGA(1),1:"NONE ON FILE"),?40,"Temporary: ",$S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRPD",21,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?9 W:'(I#2) ?48 W DGA(I)
"RTN","DGRPD",22,0)
 S DGCC=+$P(DGRP(.11),U,7),DGST=+$P(DGRP(.11),U,5),DGCC=$S($D(^DIC(5,DGST,1,DGCC,0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRPD",23,0)
 N DGCNTRY,DGFORGN S DGCNTRY=$P(DGRP(.11),"^",10),DGFORGN=$$FORIEN^DGADDUTL(DGCNTRY) I 'DGFORGN W !?2,"County: ",DGCC
"RTN","DGRPD",24,0)
 S X="NOT APPLICABLE" I DGTMPAD S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRPD",25,0)
 N DGSKIP S DGSKIP=$S(DGFORGN:"!,?42,""From/To: """,1:"?42, ""From/To: """)
"RTN","DGRPD",26,0)
 W @DGSKIP,X,!?3,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S('DGTMPAD:X,$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU) K DGTMPADW
"RTN","DGRPD",27,0)
 W !?2,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU)
"RTN","DGRPD",28,0)
 W !?4,"Cell: ",$S($P(DGRP(.13),U,4)]"":$P(DGRP(.13),U,4),1:DGRPU)
"RTN","DGRPD",29,0)
 W !?2,"E-mail: ",$S($P(DGRP(.13),U,3)]"":$P(DGRP(.13),U,3),1:DGRPU)
"RTN","DGRPD",30,0)
 W !,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$$BADADR^DGUTL3(+DFN))
"RTN","DGRPD",31,0)
 D CA
"RTN","DGRPD",32,0)
 N DGEMER S DGEMER=$$EXTERNAL^DILFD(2,.181,"",$P($G(^DPT(DFN,.18)),"^"))
"RTN","DGRPD",33,0)
 W:DGEMER]"" !?32,"Emergency Response: ",DGEMER
"RTN","DGRPD",34,0)
 I 'DGABBRV W !!?4,"POS: ",$S($D(^DIC(21,+$P(DGRP(.32),"^",3),0)):$P(^(0),"^",1),1:DGRPU),?42,"Claim #: ",$S($P(DGRP(.31),"^",3)]"":$P(DGRP(.31),"^",3),1:"UNSPECIFIED")
"RTN","DGRPD",35,0)
 I 'DGABBRV W !?2,"Relig: ",$S($D(^DIC(13,+$P(DGRP(0),"^",8),0)):$P(^(0),"^",1),1:DGRPU),?46,"Birth Sex: ",$S($P(VADM(5),"^",2)]"":$P(VADM(5),"^",2),1:"UNSPECIFIED") ; DG*5.3*907
"RTN","DGRPD",36,0)
 I 'DGABBRV W ! D
"RTN","DGRPD",37,0)
 .N RACE,ETHNIC,PTR,VAL,X,DIWL,DIWR,DIWF
"RTN","DGRPD",38,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",39,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.02,PTR)) Q:'PTR  D
"RTN","DGRPD",40,0)
 ..S VAL=+$G(^DPT(DFN,.02,PTR,0))
"RTN","DGRPD",41,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,1)
"RTN","DGRPD",42,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,1) S:+$O(^DPT(DFN,.02,PTR)) VAL=VAL_", "
"RTN","DGRPD",43,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",44,0)
 .M RACE=^UTILITY($J,"W",0) S:$G(RACE(1,0))="" RACE(1,0)="UNANSWERED"
"RTN","DGRPD",45,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",46,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.06,PTR)) Q:'PTR  D
"RTN","DGRPD",47,0)
 ..S VAL=+$G(^DPT(DFN,.06,PTR,0))
"RTN","DGRPD",48,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,2)
"RTN","DGRPD",49,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,2) S:+$O(^DPT(DFN,.06,PTR)) VAL=VAL_", "
"RTN","DGRPD",50,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",51,0)
 .M ETHNIC=^UTILITY($J,"W",0) S:$G(ETHNIC(1,0))="" ETHNIC(1,0)="UNANSWERED"
"RTN","DGRPD",52,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",53,0)
 .W ?3,"Race: ",RACE(1,0),?40,"Ethnicity: ",ETHNIC(1,0)
"RTN","DGRPD",54,0)
 .F X=2:1 Q:'$D(RACE(X,0))&'$D(ETHNIC(X,0))  W !,?9,$G(RACE(X,0)),?51,$G(ETHNIC(X,0))
"RTN","DGRPD",55,0)
 I '$$OKLINE^DGRPD1(16) G Q
"RTN","DGRPD",56,0)
 D LANGUAGE
"RTN","DGRPD",57,0)
 I '$$OKLINE^DGRPD1(10) G Q
"RTN","DGRPD",58,0)
 ;display cv status #4156
"RTN","DGRPD",59,0)
 N DGCV S DGCV=$$CVEDT^DGCV(+DFN)
"RTN","DGRPD",60,0)
 W !!,?2,"Combat Vet Status: "_$S($P(DGCV,U,3)=1:"ELIGIBLE",$P(DGCV,U,3)="":"NOT ELIGIBLE",1:"EXPIRED") I DGCV>0 W ?45,"End Date: "_$$FMTE^XLFDT($P(DGCV,U,2),"5DZ")
"RTN","DGRPD",61,0)
 ;display primary eligibility
"RTN","DGRPD",62,0)
 S X1=DGRP(.36),X=$P(DGRP(.361),"^",1) W !,"Primary Eligibility: ",$S($D(^DIC(8,+X1,0)):$P(^(0),"^",1)_" ("_$S(X="V":"VERIFIED",X="P":"PENDING VERIFICATION",X="R":"PENDING REVERIFICATION",1:"NOT VERIFIED")_")",1:DGRPU)
"RTN","DGRPD",63,0)
 W !,"Other Eligibilities: " F I=0:0 S I=$O(^DIC(8,I)) Q:'I  I $D(^DIC(8,I,0)),I'=+X1 S X=$P(^(0),"^",1)_", " I $D(^DPT("AEL",DFN,I)) W:$X+$L(X)>79 !?21 W X
"RTN","DGRPD",64,0)
 I '$$OKLINE^DGRPD1(16) G Q
"RTN","DGRPD",65,0)
 ;employability status
"RTN","DGRPD",66,0)
 W !?6,"Unemployable: ",$S($P(DGRP(.3),U,5)="Y":"YES",1:"NO")
"RTN","DGRPD",67,0)
 I '$$OKLINE^DGRPD1(19) G Q
"RTN","DGRPD",68,0)
 ;display the catastrophic disability review date if there is one
"RTN","DGRPD",69,0)
 D CATDIS^DGRPD1
"RTN","DGRPD",70,0)
 I $G(DGPRFLG)=1 G Q:'$$OKLINE^DGRPD1(19) D
"RTN","DGRPD",71,0)
 . N DGPDT,DGPTM
"RTN","DGRPD",72,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",73,0)
 . S DGPDT="",DGPDT=$O(^DGS(41.41,"ADC",DFN,DGPDT),-1)
"RTN","DGRPD",74,0)
 . W !,"[PRE-REGISTER DATE:]  "_$S(DGPDT]"":$$FMTE^XLFDT(DGPDT,"1D"),1:"NONE ON FILE")
"RTN","DGRPD",75,0)
 . S DGPTM=$$PCTEAM^DGSDUTL(DFN)
"RTN","DGRPD",76,0)
 . I $P(DGPTM,U,2)]"" W !,"[PRIMARY CARE TEAM:] "_$P(DGPTM,U,2)
"RTN","DGRPD",77,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",78,0)
 ; Check if patient is an inpatient and on a DOM ward
"RTN","DGRPD",79,0)
 ; If inpatient is on a DOM ward, don't display MT or CP messages
"RTN","DGRPD",80,0)
 ; If inpatient is NOT on a DOM ward, don't display CP message
"RTN","DGRPD",81,0)
 N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR
"RTN","DGRPD",82,0)
 G Q:'$$OKLINE^DGRPD1(16)
"RTN","DGRPD",83,0)
 D DOM^DGMTR
"RTN","DGRPD",84,0)
 I '$G(DGDOM) D
"RTN","DGRPD",85,0)
 .D DIS^DGMTU(DFN)
"RTN","DGRPD",86,0)
 .D IN5^VADPT
"RTN","DGRPD",87,0)
 .I $G(VAIP(1))="" D DISP^IBARXEU(DFN,DT,3,1)
"RTN","DGRPD",88,0)
 ;I 'DGABBRV,$E(IOST,1,2)="C-" F I=$Y:1:20 W !
"RTN","DGRPD",89,0)
 D DIS^EASECU(DFN)   ;Added for LTC III (DG*5.3*518)
"RTN","DGRPD",90,0)
 S VAIP("L")=""
"RTN","DGRPD",91,0)
 I $$OKLINE^DGRPD1(14) D INP
"RTN","DGRPD",92,0)
 I '$G(DGRPOUT),($$OKLINE^DGRPD1(10)) D SA ;*KNR*
"RTN","DGRPD",93,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",94,0)
Q D KVA^VADPT K %DT,D0,D1,DGA,DGA1,DGA2,DGABBRV,DGAD,DGCC,DGCMOR,DGDOM,DGLOCATN,DGMPI,DGRP,DGRPU,DGS,DGST,DGXFR0,DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,I,I1,L,LDM,POP,SDCT,VA,X,X1,Y Q
"RTN","DGRPD",95,0)
CA ;Confidential Address
"RTN","DGRPD",96,0)
 W !!?1,"Confidential Address:  ",?44,"Confidential Address Categories:"
"RTN","DGRPD",97,0)
 N DGCABEG,DGCAEND,DGA,DGARRAY,DGERROR
"RTN","DGRPD",98,0)
 S DGCABEG=$P(DGRP(.141),U,7),DGCAEND=$P(DGRP(.141),U,8)
"RTN","DGRPD",99,0)
 I 'DGCABEG!(DGCABEG>DT)!(DGCAEND&(DGCAEND<DT)) D  Q
"RTN","DGRPD",100,0)
 .W !?9,"NO CONFIDENTIAL ADDRESS"
"RTN","DGRPD",101,0)
 .W !?1,"From/To: NOT APPLICABLE"
"RTN","DGRPD",102,0)
 S DGAD=.141,(DGA1,DGA2)=1
"RTN","DGRPD",103,0)
 D AL^DGRPU(30)
"RTN","DGRPD",104,0)
 D GETS^DIQ(2,DFN,".141*,","E","DGARRAY","DGERROR")
"RTN","DGRPD",105,0)
 ;Format Confidential Address categories
"RTN","DGRPD",106,0)
 N DGIEN,DGCAST
"RTN","DGRPD",107,0)
 S DGIEN=0
"RTN","DGRPD",108,0)
 S DGA2=2
"RTN","DGRPD",109,0)
 F  S DGIEN=$O(DGARRAY(2.141,DGIEN)) Q:'DGIEN  D
"RTN","DGRPD",110,0)
 .S DGA(DGA2)=DGARRAY(2.141,DGIEN,.01,"E")
"RTN","DGRPD",111,0)
 .S DGCAST=DGARRAY(2.141,DGIEN,1,"E")
"RTN","DGRPD",112,0)
 .S DGA(DGA2)=DGA(DGA2)_"("_$S(DGCAST="YES":"Active",1:"Inactive")_")"
"RTN","DGRPD",113,0)
 .S DGA2=DGA2+2
"RTN","DGRPD",114,0)
 S I=0 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>43) !?9 W:'(I#2) ?44 W DGA(I)
"RTN","DGRPD",115,0)
 W !?1,"From/To:  ",$$FMTE^XLFDT(DGCABEG)_"-"_$S(DGCAEND'="":$$FMTE^XLFDT(DGCAEND),1:"UNANSWERED")
"RTN","DGRPD",116,0)
 Q
"RTN","DGRPD",117,0)
INP S VAIP("D")="L" D INP^DGPMV10
"RTN","DGRPD",118,0)
 S DGPMT=0
"RTN","DGRPD",119,0)
 D CS^DGPMV10 K DGPMT,DGPMIFN K:'$D(DGSWITCH) DGPMVI,DGPMDCD Q
"RTN","DGRPD",120,0)
SA F I=0:0 S I=$O(^DGS(41.1,"B",DFN,I)) G CL:'I S X=^DGS(41.1,I,0) I $P(X,"^",2)>(DT-1),$P(X,"^",13)']"",'$P(X,"^",17) S L=$P(X,"^",2) D:$$OKLINE^DGRPD1(17) SAA Q:$G(DGRPOUT)
"RTN","DGRPD",121,0)
 Q
"RTN","DGRPD",122,0)
SAA ;Scheduled Admit Data
"RTN","DGRPD",123,0)
 W !!?14,"Scheduled Admit"
"RTN","DGRPD",124,0)
 W:$D(^DIC(42,+$P(X,U,8),0)) " on ward "_$P(^(0),U)
"RTN","DGRPD",125,0)
 W:$D(^DIC(45.7,+$P(X,U,9),0)) " for treating specialty "_$P(^(0),U)
"RTN","DGRPD",126,0)
 W " on "_$$FMTE^XLFDT(L,"5DZ")
"RTN","DGRPD",127,0)
 Q  ;SAA
"RTN","DGRPD",128,0)
 ;
"RTN","DGRPD",129,0)
CL G FA:$O(^DPT(DFN,"DE",0))="" S SDCT=0 F I=0:0 S I=$O(^DPT(DFN,"DE",I)) Q:'I  I $D(^(I,0)),$P(^(0),"^",2)'="I",$O(^(0)) S SDCT=SDCT+1 W:SDCT=1 !!,"Currently enrolled in " W:$X>50 !?22 W $S($D(^SC(+^(0),0)):$P(^(0),"^",1)_", ",1:"")
"RTN","DGRPD",130,0)
 ;
"RTN","DGRPD",131,0)
FA ;
"RTN","DGRPD",132,0)
 N DGARRAY,SDCNT
"RTN","DGRPD",133,0)
 S DGARRAY("FLDS")="1;2;3;18",DGARRAY(4)=DFN,DGARRAY(1)=DT,DGARRAY("SORT")="P"
"RTN","DGRPD",134,0)
 S SDCNT=$$SDAPI^SDAMA301(.DGARRAY),CT=0 W !!,"Future Appointments: "
"RTN","DGRPD",135,0)
 ;if there is lower subscripts hanging from the 101 node,
"RTN","DGRPD",136,0)
 ;then it is a valid appointment, otherwise it is
"RTN","DGRPD",137,0)
 ;an error eg 01/20/2005
"RTN","DGRPD",138,0)
 ;G:'$$OKLINE^DGRPD1(13) RMK ;*///*
"RTN","DGRPD",139,0)
 I $D(^TMP($J,"SDAMA301",101))=1 W "Appointment Database is Unavailable" G RMK
"RTN","DGRPD",140,0)
 I $O(^TMP($J,"SDAMA301",DFN,DT))'>0 W "NONE" G RMK
"RTN","DGRPD",141,0)
 ;
"RTN","DGRPD",142,0)
 W ?22,"Date",?33,"Time",?39,"Clinic",!?22 F I=22:1:75 W "="
"RTN","DGRPD",143,0)
 F FA=DT:0 S FA=$O(^TMP($J,"SDAMA301",DFN,FA)) G RMK:'FA D  Q:CT>5
"RTN","DGRPD",144,0)
 .N STAT S STAT=$P($P(^TMP($J,"SDAMA301",DFN,FA),U,3),";")
"RTN","DGRPD",145,0)
 .S C=+$P(^TMP($J,"SDAMA301",DFN,FA),U,2) I STAT'["C" D
"RTN","DGRPD",146,0)
 ..D COV
"RTN","DGRPD",147,0)
 ..N DGAPPT S DGAPPT=$$FMTE^XLFDT($E(FA,1,12),"5Z")
"RTN","DGRPD",148,0)
 ..W !?22,$P(DGAPPT,"@"),?33,$P(DGAPPT,"@",2)
"RTN","DGRPD",149,0)
 ..W ?39,$P($P(^TMP($J,"SDAMA301",DFN,FA),U,2),";",2)," ",COV
"RTN","DGRPD",150,0)
 ..Q
"RTN","DGRPD",151,0)
 I $O(^TMP($J,"SDAMA301",DFN,FA))>0 W !,"See Scheduling options for additional appointments."
"RTN","DGRPD",152,0)
RMK I '$G(DGRPOUT),($$OKLINE^DGRPD1(15)) W !!,"Remarks: ",$P(^DPT(DFN,0),"^",10) ;*///*
"RTN","DGRPD",153,0)
 D GETS^DIQ(2,DFN_",",".351;.353;.354;.355","E","PDTHINFO")
"RTN","DGRPD",154,0)
 W !!
"RTN","DGRPD",155,0)
 W "Date of Death Information"
"RTN","DGRPD",156,0)
 W !,?5,"Date of Death: ",$G(PDTHINFO(2,DFN_",",.351,"E"))
"RTN","DGRPD",157,0)
 W !,?5,"Source of Notification: ",$G(PDTHINFO(2,DFN_",",.353,"E"))
"RTN","DGRPD",158,0)
 W !,?5,"Updated Date/Time: ",$G(PDTHINFO(2,DFN_",",.354,"E"))
"RTN","DGRPD",159,0)
 W !,?5,"Last Edited By: ",$G(PDTHINFO(2,DFN_",",.355,"E")),!
"RTN","DGRPD",160,0)
 I $$OKLINE^DGRPD1(14) D EC^DGRPD1
"RTN","DGRPD",161,0)
 K DGARRAY,SDCNT,^TMP($J,"SDAMA301"),ADM,L,TRN,DIS,SSN,FA,C,COV,NOW,CT,DGD,DGD1,I ;Y killed after dghinqky
"RTN","DGRPD",162,0)
 Q
"RTN","DGRPD",163,0)
COV S COV=$S(+$P(^TMP($J,"SDAMA301",DFN,FA),U,18)=7:" (Collateral) ",1:"")
"RTN","DGRPD",164,0)
 S COV=COV_$S(STAT["NT":" * NO ACTION TAKEN *",STAT["N":" * NO-SHOW *",1:""),CT=CT+1 Q
"RTN","DGRPD",165,0)
 Q
"RTN","DGRPD",166,0)
 ;
"RTN","DGRPD",167,0)
OREN S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP D EN R !!,"Press RETURN to CONTINUE: ",X:DTIME
"RTN","DGRPD",168,0)
 Q
"RTN","DGRPD",169,0)
LANGUAGE ; Get language data *///*
"RTN","DGRPD",170,0)
 S DGLANGDT=9999999,(DGPRFLAN,DGLANG0)=""
"RTN","DGRPD",171,0)
 S DGLANGDT=$O(^DPT(DFN,.207,"B",DGLANGDT),-1)
"RTN","DGRPD",172,0)
 I DGLANGDT="" G L1
"RTN","DGRPD",173,0)
 S DGLANGDA=$O(^DPT(DFN,.207,"B",DGLANGDT,0))
"RTN","DGRPD",174,0)
 S DGLANG0=$G(^DPT(DFN,.207,DGLANGDA,0)),Y=$P(DGLANG0,U),DGPRFLAN=$P(DGLANG0,U,2)
"RTN","DGRPD",175,0)
 S Y=DGLANGDT X ^DD("DD") S DGLANGDT=Y
"RTN","DGRPD",176,0)
L1 W !!,"Language Date/Time: ",$S(DGLANGDT="":"UNANSWERED",1:DGLANGDT),!
"RTN","DGRPD",177,0)
 W ?1,"Preferred Language: ",$S(DGPRFLAN="":"UNANSWERED",1:DGPRFLAN)
"RTN","DGRPD",178,0)
 K DGLANGDT,DGPRFLAN,DGLANG0,DGLANGDA
"RTN","DGRPD",179,0)
 Q
"RTN","DGRPECE")
0^1^B89386957^B72565384
"RTN","DGRPECE",1,0)
DGRPECE ;ALB/MRY,ERC,BAJ,NCA - REGISTRATION CATASTROPHIC EDITS ; 10/4/06 3:27pm
"RTN","DGRPECE",2,0)
 ;;5.3;Registration;**638,682,700,720,653,688,750,831,907**;Aug 13, 1993;Build 28
"RTN","DGRPECE",3,0)
 ;
"RTN","DGRPECE",4,0)
CEDITS(DFN) ;catastrophic edits  - buffer values, save after check
"RTN","DGRPECE",5,0)
 ;Input;
"RTN","DGRPECE",6,0)
 ;  DFN  := patient ien
"RTN","DGRPECE",7,0)
 ;Catastrophic edits will prompt for name, ssn, dob, and sex.  Placing
"RTN","DGRPECE",8,0)
 ;responses into a buffer space.  User will be alerted on catastrophic
"RTN","DGRPECE",9,0)
 ;edits on the following conditions:
"RTN","DGRPECE",10,0)
 ; 1. Two or more catastrophic edits will generate a warning message.
"RTN","DGRPECE",11,0)
 ; 2. Acceptance of two or more catastrophic edits will generate an alert
"RTN","DGRPECE",12,0)
 ; to appropriate supervising staff holding the DG CATASTROPHIC EDIT key.
"RTN","DGRPECE",13,0)
 ; 3. Acceptance of <2 catastrophic edits will process normally.
"RTN","DGRPECE",14,0)
 ;
"RTN","DGRPECE",15,0)
 ; Arrays: BEFORE - Holds patient values before the edit process
"RTN","DGRPECE",16,0)
 ;                  (before snapshot).
"RTN","DGRPECE",17,0)
 ;         BUFFER - initialized with BEFORE array, holds edited changes
"RTN","DGRPECE",18,0)
 ;                  (after snapshot).
"RTN","DGRPECE",19,0)
 ;         SAVE   - holds only edited changes for filing into file #2.
"RTN","DGRPECE",20,0)
 ;
"RTN","DGRPECE",21,0)
 N DA,DIR,DIRUT,Y,BUFFER,BEFORE,SAVE,DG20IEN,XUNOTRIG
"RTN","DGRPECE",22,0)
 D BEFORE(DFN,.BEFORE,.BUFFER) ;retrieve before patient values
"RTN","DGRPECE",23,0)
 ;buffer - get name
"RTN","DGRPECE",24,0)
 K DG20NAME
"RTN","DGRPECE",25,0)
 S BUFFER("NAME")=$$NCEDIT^DPTNAME(DFN,,.DG20NAME)
"RTN","DGRPECE",26,0)
 I BUFFER("NAME")="" S BUFFER("NAME")=BEFORE("NAME")
"RTN","DGRPECE",27,0)
 I $D(DG20NAME("FAMILY")) S BUFFER("FAMILY")=DG20NAME("FAMILY")
"RTN","DGRPECE",28,0)
 I $D(DG20NAME("GIVEN")) S BUFFER("GIVEN")=DG20NAME("GIVEN")
"RTN","DGRPECE",29,0)
 I $D(DG20NAME("MIDDLE")) S BUFFER("MIDDLE")=DG20NAME("MIDDLE")
"RTN","DGRPECE",30,0)
 I $D(DG20NAME("SUFFIX")) S BUFFER("SUFFIX")=DG20NAME("SUFFIX")
"RTN","DGRPECE",31,0)
 ; the formal name is last name, first name, middle name and suffix
"RTN","DGRPECE",32,0)
 ; the prefix and degree are only stored in file 20
"RTN","DGRPECE",33,0)
 I $D(DG20NAME("PREFIX")) S BUFFER("PREFIX")=DG20NAME("PREFIX")
"RTN","DGRPECE",34,0)
 I $D(DG20NAME("DEGREE")) S BUFFER("DEGREE")=DG20NAME("DEGREE")
"RTN","DGRPECE",35,0)
 K DG20NAME
"RTN","DGRPECE",36,0)
 ;DG*5.3*688 BAJ if SSN is verified, do not allow edits
"RTN","DGRPECE",37,0)
 I BEFORE("SSNV")="VERIFIED" D  G DOB
"RTN","DGRPECE",38,0)
 . S BUFFER("SSN")=BEFORE("SSN")
"RTN","DGRPECE",39,0)
 . W !,"SSN: "_BUFFER("SSN")
"RTN","DGRPECE",40,0)
 . W !,"SOCIAL SECURITY NUMBER "_BUFFER("SSN")_" has been verified by SSA --NO EDITING"
"RTN","DGRPECE",41,0)
 ;buffer - get ssn
"RTN","DGRPECE",42,0)
 S DIR(0)="2,.09^^"
"RTN","DGRPECE",43,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",44,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",45,0)
 S BUFFER("SSN")=Y
"RTN","DGRPECE",46,0)
 ;if SSN is pseudo, Pseudo SSN Reason is req. - DG*5.3*653, ERC
"RTN","DGRPECE",47,0)
 I $G(BUFFER("SSN"))["P" D  I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",48,0)
REAS . ;
"RTN","DGRPECE",49,0)
 . N DGREA,DGQSSN,DIR
"RTN","DGRPECE",50,0)
 . S DGQSSN=0
"RTN","DGRPECE",51,0)
 . S DGREA=$P($G(^DPT(DFN,"SSN")),U)
"RTN","DGRPECE",52,0)
 . S DIR(0)="2,.0906^^"
"RTN","DGRPECE",53,0)
 . S DA=DFN
"RTN","DGRPECE",54,0)
 . D ^DIR
"RTN","DGRPECE",55,0)
 . I ($D(DUOUT)!($D(DTOUT))!($D(DIRUT))),($G(BUFFER("SSNREAS"))']"") D
"RTN","DGRPECE",56,0)
 . . W !?10,"PSSN Reason Required if SSN is a Pseudo."
"RTN","DGRPECE",57,0)
 . . I $G(BEFORE("SSN"))["P" G REAS
"RTN","DGRPECE",58,0)
 . . I $G(BEFORE("SSN"))']"" G REAS
"RTN","DGRPECE",59,0)
 . . S DIR(0)="YA",DIR("A")="          Delete Pseudo SSN?: ",DIR("?")="If the SSN is a Pseudo SSN there must be a Pseudo SSN Reason.",DIR("B")="YES"
"RTN","DGRPECE",60,0)
 . . D ^DIR
"RTN","DGRPECE",61,0)
 . . I Y=1 S BUFFER("SSN")=BEFORE("SSN"),DGQSSN=1,Y="" Q
"RTN","DGRPECE",62,0)
 . . G REAS
"RTN","DGRPECE",63,0)
 . I DGQSSN=1 Q
"RTN","DGRPECE",64,0)
 . S BUFFER("SSNREAS")=Y
"RTN","DGRPECE",65,0)
 . I $D(DIRUT)!('$D(BUFFER("SSN"))) D CECHECK Q
"RTN","DGRPECE",66,0)
DOB ;buffer - get dob
"RTN","DGRPECE",67,0)
 S DIR(0)="2,.03^^"
"RTN","DGRPECE",68,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",69,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",70,0)
 S BUFFER("DOB")=Y
"RTN","DGRPECE",71,0)
SEX ;buffer - get sex
"RTN","DGRPECE",72,0)
 S DIR(0)="2,.02^^"
"RTN","DGRPECE",73,0)
 S DIR("A")="BIRTH SEX"   ; DG*5.3*907
"RTN","DGRPECE",74,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",75,0)
 K DIR("A")   ; DG*5.3*907
"RTN","DGRPECE",76,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",77,0)
 S BUFFER("SEX")=Y
"RTN","DGRPECE",78,0)
 ; DG*5.3*907 - begin of SIGI change in this section
"RTN","DGRPECE",79,0)
SIGI ;buffer - get Self-Identified Gender Identity    ; DG*5.3*907
"RTN","DGRPECE",80,0)
 S DIR(0)="SAB^M:Male;F:Female;TM:Transmale/Transman/Female-to-Male;TF:Transfemale/Transwoman/Male-to-Female;O:Other;N:individual chooses not to answer"
"RTN","DGRPECE",81,0)
 S DIR("?",1)="Select the code that specifies the patient's preferred gender."
"RTN","DGRPECE",82,0)
 S DIR("?",2)="This SELF IDENTIFIED GENDER value indicates the patient's view of"
"RTN","DGRPECE",83,0)
 S DIR("?")="their gender identity, if they choose to provide it."
"RTN","DGRPECE",84,0)
 S DIR("A")="SELF-IDENTIFIED GENDER IDENTITY: " S:$G(BEFORE("SIGI"))'="" DIR("B")=$$GET1^DIQ(2,+DFN_",",.024)
"RTN","DGRPECE",85,0)
 D ^DIR
"RTN","DGRPECE",86,0)
 K DIR("A"),DIR("B")
"RTN","DGRPECE",87,0)
 I $D(DIRUT) S BUFFER("SIGI")=BEFORE("SIGI") D CECHECK Q
"RTN","DGRPECE",88,0)
 S BUFFER("SIGI")=Y
"RTN","DGRPECE",89,0)
 ; DG*5.3*907 - end-section of SIGI 
"RTN","DGRPECE",90,0)
MBI ; buffer - get MBI (multiple birth indicator)
"RTN","DGRPECE",91,0)
 S DIR(0)="2,994^^"
"RTN","DGRPECE",92,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",93,0)
 S BUFFER("MBI")=Y
"RTN","DGRPECE",94,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",95,0)
CECHECK ;do catastrophic edit checks, alert, and save
"RTN","DGRPECE",96,0)
 N DGCNT,DGCEFLG
"RTN","DGRPECE",97,0)
 ;Compare before/buffer arrays, putting edits into save array.S DIR("A")="SELF IDENTIFIED GENDER IDENTITY"
"RTN","DGRPECE",98,0)
 S DGCNT=$$AFTER(.BEFORE,.BUFFER,.SAVE)
"RTN","DGRPECE",99,0)
 ;   DGCNT:  0  = no changes
"RTN","DGRPECE",100,0)
 ;           1  = only one edit change, ok to save w/o CE message
"RTN","DGRPECE",101,0)
 ;           >1 = more then 1 edit, give CE message
"RTN","DGRPECE",102,0)
 I DGCNT>1 D  ;give CE message
"RTN","DGRPECE",103,0)
 . S DGCEFLG=$$WARNING()
"RTN","DGRPECE",104,0)
 . ;    DGCEFLG: 0  = exit without saving changes
"RTN","DGRPECE",105,0)
 . ;             1  = send alert and save
"RTN","DGRPECE",106,0)
 . I DGCEFLG=0 S DGCNT=0
"RTN","DGRPECE",107,0)
 I DGCNT>0 D SAVE(DFN) I $D(DGCEFLG),DGCEFLG D ALERT
"RTN","DGRPECE",108,0)
 Q
"RTN","DGRPECE",109,0)
 ;
"RTN","DGRPECE",110,0)
SAVE(DFN) ;store accepted/edited values into patient file
"RTN","DGRPECE",111,0)
 N FDATA,DIERR
"RTN","DGRPECE",112,0)
 I $D(SAVE("NAME")) S FDATA(2,+DFN_",",.01)=SAVE("NAME")
"RTN","DGRPECE",113,0)
 I $D(SAVE("DOB")) S FDATA(2,+DFN_",",.03)=SAVE("DOB")
"RTN","DGRPECE",114,0)
 I $D(SAVE("SEX")) S FDATA(2,+DFN_",",.02)=SAVE("SEX")
"RTN","DGRPECE",115,0)
 I $D(SAVE("SSN")) S FDATA(2,+DFN_",",.09)=SAVE("SSN")
"RTN","DGRPECE",116,0)
 I $D(SAVE("SSNREAS")) S FDATA(2,+DFN_",",.0906)=SAVE("SSNREAS")
"RTN","DGRPECE",117,0)
 I $D(SAVE("MBI")) S FDATA(2,+DFN_",",994)=SAVE("MBI")
"RTN","DGRPECE",118,0)
 I $D(SAVE("SIGI")) S FDATA(2,+DFN_",",.024)=SAVE("SIGI")   ; DG*5.3*907
"RTN","DGRPECE",119,0)
 D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",120,0)
 K FDATA,DIERR
"RTN","DGRPECE",121,0)
 I '$D(^VA(20,DG20IEN)) S DG20IEN=$$GET1^DIQ(2,+DFN_",",1.01,"I")
"RTN","DGRPECE",122,0)
 I $D(SAVE("NAME")) D
"RTN","DGRPECE",123,0)
 .S FDATA(20,+DG20IEN_",",1)=BUFFER("FAMILY")
"RTN","DGRPECE",124,0)
 .S FDATA(20,+DG20IEN_",",2)=BUFFER("GIVEN")
"RTN","DGRPECE",125,0)
 .S FDATA(20,+DG20IEN_",",3)=BUFFER("MIDDLE")
"RTN","DGRPECE",126,0)
 .S FDATA(20,+DG20IEN_",",5)=BUFFER("SUFFIX")
"RTN","DGRPECE",127,0)
 .S XUNOTRIG=1
"RTN","DGRPECE",128,0)
 .D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",129,0)
 .K FDATA,DIERR
"RTN","DGRPECE",130,0)
 I $D(BUFFER("PREFIX")) S FDATA(20,+DG20IEN_",",4)=BUFFER("PREFIX")
"RTN","DGRPECE",131,0)
 I $D(BUFFER("DEGREE")) S FDATA(20,+DG20IEN_",",6)=BUFFER("DEGREE")
"RTN","DGRPECE",132,0)
 I $D(SAVE("PREFIX")) S FDATA(20,+DG20IEN_",",4)=SAVE("PREFIX")
"RTN","DGRPECE",133,0)
 I $D(SAVE("DEGREE")) S FDATA(20,+DG20IEN_",",6)=SAVE("DEGREE")
"RTN","DGRPECE",134,0)
 D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",135,0)
 K FDATA,DIERR
"RTN","DGRPECE",136,0)
 Q
"RTN","DGRPECE",137,0)
 ;
"RTN","DGRPECE",138,0)
BEFORE(IEN,BEF,BUF) ;save original name, ssn, dob, sex, mbi, prefix, degree
"RTN","DGRPECE",139,0)
 N DG20
"RTN","DGRPECE",140,0)
 S BEF("NAME")=$$GET1^DIQ(2,+IEN_",",.01),BUF("NAME")=BEF("NAME")
"RTN","DGRPECE",141,0)
 S BEF("SSN")=$$GET1^DIQ(2,+IEN_",",.09),BUF("SSN")=BEF("SSN")
"RTN","DGRPECE",142,0)
 ;Get SSN Verification flag DG*5.3*688 BAJ 11/22/2005
"RTN","DGRPECE",143,0)
 S BEF("SSNV")=$$GET1^DIQ(2,+IEN_",",.0907),BUF("SSNV")=BEF("SSNV")
"RTN","DGRPECE",144,0)
 S BEF("SSNREAS")=$$GET1^DIQ(2,+IEN_",",.0906),BUF("SSNREAS")=BEF("SSNREAS")
"RTN","DGRPECE",145,0)
 S BEF("DOB")=$$GET1^DIQ(2,+IEN_",",.03,"I"),BUF("DOB")=BEF("DOB")
"RTN","DGRPECE",146,0)
 S BEF("SEX")=$$GET1^DIQ(2,+IEN_",",.02,"I"),BUF("SEX")=BEF("SEX")
"RTN","DGRPECE",147,0)
 S BEF("MBI")=$$GET1^DIQ(2,+IEN_",",994,"I"),BUF("MBI")=BEF("MBI")
"RTN","DGRPECE",148,0)
 S BEF("SIGI")=$$GET1^DIQ(2,+IEN_",",.024,"I"),BUF("SIGI")=BEF("SIGI")   ; DG*5.3*907
"RTN","DGRPECE",149,0)
 D GETS^DIQ(2,+IEN_",",1.01,"I","DG20")
"RTN","DGRPECE",150,0)
 S BEF("FAMILY")="",BEF("GIVEN")="",BUF("FAMILY")="",BUF("GIVEN")=""
"RTN","DGRPECE",151,0)
 S BEF("MIDDLE")="",BEF("SUFFIX")="",BUF("MIDDLE")="",BUF("SUFFIX")=""
"RTN","DGRPECE",152,0)
 S BEF("PREFIX")="",BEF("DEGREE")="",BUF("PREFIX")="",BUF("DEGREE")=""
"RTN","DGRPECE",153,0)
 S DG20IEN=DG20(2,+IEN_",",1.01,"I")
"RTN","DGRPECE",154,0)
 I $$GET1^DIQ(20,+DG20IEN_",",.03)[+IEN D
"RTN","DGRPECE",155,0)
 . S BEF("FAMILY")=$$GET1^DIQ(20,+DG20IEN_",",1),BUF("FAMILY")=BEF("FAMILY")
"RTN","DGRPECE",156,0)
 . S BEF("GIVEN")=$$GET1^DIQ(20,+DG20IEN_",",2),BUF("GIVEN")=BEF("GIVEN")
"RTN","DGRPECE",157,0)
 . S BEF("MIDDLE")=$$GET1^DIQ(20,+DG20IEN_",",3),BUF("MIDDLE")=BEF("MIDDLE")
"RTN","DGRPECE",158,0)
 . S BEF("SUFFIX")=$$GET1^DIQ(20,+DG20IEN_",",5),BUF("SUFFIX")=BEF("SUFFIX")
"RTN","DGRPECE",159,0)
 . S BEF("PREFIX")=$$GET1^DIQ(20,+DG20IEN_",",4),BUF("PREFIX")=BEF("PREFIX")
"RTN","DGRPECE",160,0)
 . S BEF("DEGREE")=$$GET1^DIQ(20,+DG20IEN_",",6),BUF("DEGREE")=BEF("DEGREE")
"RTN","DGRPECE",161,0)
 ;add some demographic information (before snapshot)
"RTN","DGRPECE",162,0)
 S BEF("MAIDEN")=$E($$GET1^DIQ(2,+IEN_",",.2403),1,17)
"RTN","DGRPECE",163,0)
 S BEF("POBCITY")=$E($$GET1^DIQ(2,+IEN_",",.092),1,15)
"RTN","DGRPECE",164,0)
 S BEF("POBSTATE")=$$GET1^DIQ(2,+IEN_",",.093,"I")
"RTN","DGRPECE",165,0)
 Q
"RTN","DGRPECE",166,0)
 ;
"RTN","DGRPECE",167,0)
AFTER(BEF,BUF,SAV) ;prevent catastrophic edit checks
"RTN","DGRPECE",168,0)
 N DGCNT,DG20CNT S (DGCNT,DG20CNT)=0
"RTN","DGRPECE",169,0)
 I $D(BUF("FAMILY")),BUF("FAMILY")'="",BUF("FAMILY")'=BEF("FAMILY") D
"RTN","DGRPECE",170,0)
 . S DG20CNT=DG20CNT+1
"RTN","DGRPECE",171,0)
 . S SAV("NAME")=BUF("NAME")
"RTN","DGRPECE",172,0)
 I $D(BUF("GIVEN")),BUF("GIVEN")'="",BUF("GIVEN")'=BEF("GIVEN") D
"RTN","DGRPECE",173,0)
 . S DG20CNT=DG20CNT+1
"RTN","DGRPECE",174,0)
 . S SAV("NAME")=BUF("NAME")
"RTN","DGRPECE",175,0)
 I $D(BUF("MIDDLE")),BUF("MIDDLE")'=BEF("MIDDLE") D
"RTN","DGRPECE",176,0)
 . S SAV("NAME")=BUF("NAME") ; minor change doesn't count
"RTN","DGRPECE",177,0)
 I $D(BUF("SUFFIX")),BUF("SUFFIX")'=BEF("SUFFIX") D
"RTN","DGRPECE",178,0)
 . S SAV("NAME")=BUF("NAME") ; minor change doesn't count
"RTN","DGRPECE",179,0)
 I DG20CNT>0 S DGCNT=1
"RTN","DGRPECE",180,0)
 I $D(BUF("PREFIX")),BUF("PREFIX")'=BEF("PREFIX") D
"RTN","DGRPECE",181,0)
 . S SAV("PREFIX")=BUF("PREFIX")
"RTN","DGRPECE",182,0)
 I $D(BUF("DEGREE")),BUF("DEGREE")'=BEF("DEGREE") D
"RTN","DGRPECE",183,0)
 . S SAV("DEGREE")=BUF("DEGREE")
"RTN","DGRPECE",184,0)
 I $D(BUF("SIGI")),BUF("SIGI")'="",BUF("SIGI")'=BEF("SIGI") D   ; DG*5.3*907
"RTN","DGRPECE",185,0)
 . S SAV("SIGI")=BUF("SIGI")                                    ; DG*5.3*907
"RTN","DGRPECE",186,0)
 I $D(BUF("DOB")),BUF("DOB")'="",BUF("DOB")'=BEF("DOB") D
"RTN","DGRPECE",187,0)
 . S SAV("DOB")=BUF("DOB"),DGCNT=DGCNT+1
"RTN","DGRPECE",188,0)
 I $D(BUF("SEX")),BUF("SEX")'="",BUF("SEX")'=BEF("SEX") D
"RTN","DGRPECE",189,0)
 . S SAV("SEX")=BUF("SEX"),DGCNT=DGCNT+1
"RTN","DGRPECE",190,0)
 I $D(BUF("SSN")),BUF("SSN")'="",BUF("SSN")'=BEF("SSN") D
"RTN","DGRPECE",191,0)
 . S SAV("SSN")=BUF("SSN"),DGCNT=DGCNT+1
"RTN","DGRPECE",192,0)
 I $D(BUF("SSNREAS")),BUF("SSNREAS")'="",BUF("SSNREAS")'=BEF("SSNREAS") D
"RTN","DGRPECE",193,0)
 . S SAV("SSNREAS")=BUF("SSNREAS")
"RTN","DGRPECE",194,0)
 I $D(BUF("MBI")),BUF("MBI")'=BEF("MBI") D
"RTN","DGRPECE",195,0)
 . S SAV("MBI")=BUF("MBI")
"RTN","DGRPECE",196,0)
 I DGCNT=0,$D(SAV("NAME")) Q 1 ;minor name change (i.e. middle name or suffix)
"RTN","DGRPECE",197,0)
 I DGCNT=0,$D(SAV("PREFIX"))!($D(SAV("DEGREE"))) Q 1 ; prefix or degree change
"RTN","DGRPECE",198,0)
 I DGCNT=0,$D(SAV("MBI")) Q 1 ; multiple birth indicator change
"RTN","DGRPECE",199,0)
 I DGCNT=0,$D(SAV("SIGI")) Q 1  ; DG*5.3*907 - Add SIGI indicator change
"RTN","DGRPECE",200,0)
 I DGCNT=0 Q 0 ;no changes
"RTN","DGRPECE",201,0)
 ;DG*750 check audit file for previous changes made during the current day
"RTN","DGRPECE",202,0)
 I DGCNT=1 D DGAUD^DGRPAUD(DFN,.DGCNT)
"RTN","DGRPECE",203,0)
 ;Use temp file created in DGRPAUD to get information for other changes
"RTN","DGRPECE",204,0)
 ;that were made during the day to print on the alert.
"RTN","DGRPECE",205,0)
 N DGAUDIEN,DGFLD,DGTYP
"RTN","DGRPECE",206,0)
 S DGAUDIEN=0
"RTN","DGRPECE",207,0)
 F   S DGAUDIEN=$O(^TMP("DGRPAUD",$J,DFN,DGAUDIEN)) Q:'DGAUDIEN  D
"RTN","DGRPECE",208,0)
 .S DGFLD=$P(^TMP("DGRPAUD",$J,DFN,DGAUDIEN),U,2),DGTYP=$P(^TMP("DGRPAUD",$J,DFN,DGAUDIEN),U,5)
"RTN","DGRPECE",209,0)
 .I DGFLD=.01 S BEF("NAME")=DGTYP
"RTN","DGRPECE",210,0)
 .I DGFLD=.09 S BEF("SSN")=DGTYP
"RTN","DGRPECE",211,0)
 .I DGFLD=.02 S BEF("SEX")=DGTYP
"RTN","DGRPECE",212,0)
 .I DGFLD=.03 S BEF("DOB")=DGTYP
"RTN","DGRPECE",213,0)
 .I DGFLD=.024 S BEF("SIGI")=DGTYP    ; DG*5.3*907
"RTN","DGRPECE",214,0)
 I DGCNT<2 Q 1 ;make one change w/o CE message
"RTN","DGRPECE",215,0)
 I DGCNT>1 Q 2 ;more than 1 change, send CE message
"RTN","DGRPECE",216,0)
 K ^TMP("DGRPAUD")
"RTN","DGRPECE",217,0)
 ;
"RTN","DGRPECE",218,0)
WARNING() ;CE warning message
"RTN","DGRPECE",219,0)
 ;Output     0  = exit without saving changes
"RTN","DGRPECE",220,0)
 ;           1  = send alert and save
"RTN","DGRPECE",221,0)
 W !!,?25,"**WARNING!!**"
"RTN","DGRPECE",222,0)
 W !!,"The edits you are about to make, may potentially change the identity of"
"RTN","DGRPECE",223,0)
 W !,"this patient.  Please verify that you have selected the correct patient"
"RTN","DGRPECE",224,0)
 W !,"and ensure that supporting documentation exists for these changes.  If"
"RTN","DGRPECE",225,0)
 W !,"you continue with these edits, an alert will be generated and sent to"
"RTN","DGRPECE",226,0)
 W !,"your Supervisor and ADPAC, notifying them of the changes."
"RTN","DGRPECE",227,0)
 N DIR,DGANS,Y
"RTN","DGRPECE",228,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue and save your edits:"
"RTN","DGRPECE",229,0)
 S DIR("B")="NO" D ^DIR K DIR S DGANS=Y
"RTN","DGRPECE",230,0)
 S DGANS=$S(Y=1:1,1:0) ;0=don't save, 1=save with CE alert
"RTN","DGRPECE",231,0)
 Q DGANS
"RTN","DGRPECE",232,0)
 ;
"RTN","DGRPECE",233,0)
ALERT ;Queue alert
"RTN","DGRPECE",234,0)
 X ^%ZOSF("UCI") S ZTUCI=Y,ZTRTN="ALERT^DGRPECE1",ZTDTH=$H,ZTIO="",IEN=DFN
"RTN","DGRPECE",235,0)
 F V="IEN","BEFORE(","BUFFER(","SAVE(","XQY" S ZTSAVE(V)=""
"RTN","DGRPECE",236,0)
 S ZTDESC="Patient Catastrophic Edits alert" K V,ZTSK N X D ^%ZTLOAD  Q
"RTN","DGRPECE",237,0)
 ;D ALERT^DGRPECE1(DFN,.BEFORE,.BUFFER,.SAVE)
"RTN","DGRPECE",238,0)
 Q
"VER")
8.0^22.2
"^DD",2,2,.024,0)
SELF IDENTIFIED GENDER^Sa^M:Male;F:Female;TM:Transmale/Transman/Female-to-Male;TF:Transfemale/Transwoman/Male-to-Female;O:Other;N:individual chooses not to answer;^.24;4^Q
"^DD",2,2,.024,3)
Select the code that specifies the patient's preferred gender.
"^DD",2,2,.024,21,0)
^^2^2^3170320^
"^DD",2,2,.024,21,1,0)
This SELF IDENTIFIED GENDER value indicates the patient's view of their 
"^DD",2,2,.024,21,2,0)
gender identity, if they choose to provide it.
"^DD",2,2,.024,"AUDIT")
y
"^DD",2,2,.024,"DT")
3170320
"BLD",9684,6)
^821
**END**
**END**

