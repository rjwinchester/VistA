Released DG*5.3*944 SEQ #828
Extracted from mail message
**KIDS**:DG*5.3*944^

**INSTALL NAME**
DG*5.3*944
"BLD",3252,0)
DG*5.3*944^REGISTRATION^0^3170804^y
"BLD",3252,1,0)
^^3^3^3170804^
"BLD",3252,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - POB COUNTRY/PROVINCE
"BLD",3252,1,2,0)
Refer to patch DG*5.3*944 in the FORUM Patch Module for a complete
"BLD",3252,1,3,0)
description.
"BLD",3252,4,0)
^9.64PA^47.761^2
"BLD",3252,4,2,0)
2
"BLD",3252,4,2,2,0)
^9.641^2^1
"BLD",3252,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",3252,4,2,2,2,1,0)
^9.6411^.357^3
"BLD",3252,4,2,2,2,1,.0931,0)
PLACE OF BIRTH COUNTRY
"BLD",3252,4,2,2,2,1,.0932,0)
PLACE OF BIRTH PROVINCE
"BLD",3252,4,2,2,2,1,.357,0)
SUPPORTING DOCUMENT TYPE
"BLD",3252,4,2,222)
y^n^p^^^^n^^n
"BLD",3252,4,2,224)

"BLD",3252,4,47.761,0)
47.761
"BLD",3252,4,47.761,222)
y^y^f^^^^n
"BLD",3252,4,"APDD",2,2)

"BLD",3252,4,"APDD",2,2,.0931)

"BLD",3252,4,"APDD",2,2,.0932)

"BLD",3252,4,"APDD",2,2,.357)

"BLD",3252,4,"B",2,2)

"BLD",3252,4,"B",47.761,47.761)

"BLD",3252,6)
1^
"BLD",3252,6.3)
2
"BLD",3252,"INIT")
DG944PST
"BLD",3252,"KRN",0)
^9.67PA^779.2^20
"BLD",3252,"KRN",.4,0)
.4
"BLD",3252,"KRN",.401,0)
.401
"BLD",3252,"KRN",.402,0)
.402
"BLD",3252,"KRN",.403,0)
.403
"BLD",3252,"KRN",.5,0)
.5
"BLD",3252,"KRN",.84,0)
.84
"BLD",3252,"KRN",3.6,0)
3.6
"BLD",3252,"KRN",3.8,0)
3.8
"BLD",3252,"KRN",9.2,0)
9.2
"BLD",3252,"KRN",9.8,0)
9.8
"BLD",3252,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",3252,"KRN",9.8,"NM",1,0)
VAFCTR^^0^B5564926
"BLD",3252,"KRN",9.8,"NM",2,0)
DG944PST^^0^B47916202
"BLD",3252,"KRN",9.8,"NM",3,0)
VAFCQRY3^^0^B63911334
"BLD",3252,"KRN",9.8,"NM",4,0)
VAFCPDT2^^0^B31881197
"BLD",3252,"KRN",9.8,"NM",5,0)
DGDEATH^^0^B63218481
"BLD",3252,"KRN",9.8,"NM",6,0)
DGDTHBR^^0^B4998998
"BLD",3252,"KRN",9.8,"NM",7,0)
VAFCPTAD^^0^B70394677
"BLD",3252,"KRN",9.8,"NM","B","DG944PST",2)

"BLD",3252,"KRN",9.8,"NM","B","DGDEATH",5)

"BLD",3252,"KRN",9.8,"NM","B","DGDTHBR",6)

"BLD",3252,"KRN",9.8,"NM","B","VAFCPDT2",4)

"BLD",3252,"KRN",9.8,"NM","B","VAFCPTAD",7)

"BLD",3252,"KRN",9.8,"NM","B","VAFCQRY3",3)

"BLD",3252,"KRN",9.8,"NM","B","VAFCTR",1)

"BLD",3252,"KRN",19,0)
19
"BLD",3252,"KRN",19.1,0)
19.1
"BLD",3252,"KRN",101,0)
101
"BLD",3252,"KRN",409.61,0)
409.61
"BLD",3252,"KRN",771,0)
771
"BLD",3252,"KRN",779.2,0)
779.2
"BLD",3252,"KRN",870,0)
870
"BLD",3252,"KRN",8989.51,0)
8989.51
"BLD",3252,"KRN",8989.52,0)
8989.52
"BLD",3252,"KRN",8994,0)
8994
"BLD",3252,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",3252,"KRN",8994,"NM",1,0)
DG DEATH SOURCE/DOC UPDATE^^0
"BLD",3252,"KRN",8994,"NM","B","DG DEATH SOURCE/DOC UPDATE",1)

"BLD",3252,"KRN","B",.4,.4)

"BLD",3252,"KRN","B",.401,.401)

"BLD",3252,"KRN","B",.402,.402)

"BLD",3252,"KRN","B",.403,.403)

"BLD",3252,"KRN","B",.5,.5)

"BLD",3252,"KRN","B",.84,.84)

"BLD",3252,"KRN","B",3.6,3.6)

"BLD",3252,"KRN","B",3.8,3.8)

"BLD",3252,"KRN","B",9.2,9.2)

"BLD",3252,"KRN","B",9.8,9.8)

"BLD",3252,"KRN","B",19,19)

"BLD",3252,"KRN","B",19.1,19.1)

"BLD",3252,"KRN","B",101,101)

"BLD",3252,"KRN","B",409.61,409.61)

"BLD",3252,"KRN","B",771,771)

"BLD",3252,"KRN","B",779.2,779.2)

"BLD",3252,"KRN","B",870,870)

"BLD",3252,"KRN","B",8989.51,8989.51)

"BLD",3252,"KRN","B",8989.52,8989.52)

"BLD",3252,"KRN","B",8994,8994)

"BLD",3252,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",3252,"QUES",0)
^9.62^^
"BLD",3252,"REQB",0)
^9.611^4^4
"BLD",3252,"REQB",1,0)
DG*5.3*754^2
"BLD",3252,"REQB",2,0)
DG*5.3*937^2
"BLD",3252,"REQB",3,0)
DG*5.3*939^2
"BLD",3252,"REQB",4,0)
DG*5.3*876^2
"BLD",3252,"REQB","B","DG*5.3*754",1)

"BLD",3252,"REQB","B","DG*5.3*876",4)

"BLD",3252,"REQB","B","DG*5.3*937",2)

"BLD",3252,"REQB","B","DG*5.3*939",3)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^n^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.0931)

"FIA",2,2,.0932)

"FIA",2,2,.357)

"FIA",47.761)
SOURCE OF NOTIFICATION BUSINESS RULES
"FIA",47.761,0)
^DG(47.761,
"FIA",47.761,0,0)
47.761P
"FIA",47.761,0,1)
y^y^f^^^^n
"FIA",47.761,0,10)

"FIA",47.761,0,11)

"FIA",47.761,0,"RLRO")

"FIA",47.761,0,"VR")
5.3^DG
"FIA",47.761,47.761)
0
"FIA",47.761,47.7611)
0
"INIT")
DG944PST
"IX",2,2,"AVAFC0931",0)
2^AVAFC0931^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"AVAFC0931",.1,0)
^^5^5^3170502
"IX",2,2,"AVAFC0931",.1,1,0)
This cross-reference activates the DG FIELD MONITOR event point.
"IX",2,2,"AVAFC0931",.1,2,0)
Applications that wish to monitor edit activity related to this field may
"IX",2,2,"AVAFC0931",.1,3,0)
subscribe to that event point and take action as indicated by the changes
"IX",2,2,"AVAFC0931",.1,4,0)
that occur.  Refer to the DG FIELD MONITOR protocol for a description of
"IX",2,2,"AVAFC0931",.1,5,0)
the information available at the time of the event.
"IX",2,2,"AVAFC0931",1)
D FC^DGFCPROT(.DA,2,.0931,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC0931",2)
D FC^DGFCPROT(.DA,2,.0931,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC0931",11.1,0)
^.114IA^1^1
"IX",2,2,"AVAFC0931",11.1,1,0)
1^F^2^.0931^^^F
"IX",2,2,"AVAFC0932",0)
2^AVAFC0932^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"AVAFC0932",.1,0)
^^5^5^3170502
"IX",2,2,"AVAFC0932",.1,1,0)
This cross-reference activates the DG FIELD MONITOR event point.
"IX",2,2,"AVAFC0932",.1,2,0)
Applications that wish to monitor edit activity related to this field may
"IX",2,2,"AVAFC0932",.1,3,0)
subscribe to that event point and take action as indicated by the changes
"IX",2,2,"AVAFC0932",.1,4,0)
that occur.  Refer to the DG FIELD MONITOR protocol for a description of
"IX",2,2,"AVAFC0932",.1,5,0)
the information available at the time of the event.
"IX",2,2,"AVAFC0932",1)
D FC^DGFCPROT(.DA,2,.0932,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC0932",2)
D FC^DGFCPROT(.DA,2,.0932,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC0932",11.1,0)
^.114IA^1^1
"IX",2,2,"AVAFC0932",11.1,1,0)
1^F^2^.0932^^^F
"IX",2,2,"AVAFC357",0)
2^AVAFC357^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"AVAFC357",.1,0)
^^5^5^3160622
"IX",2,2,"AVAFC357",.1,1,0)
This cross-reference activates the DG FIELD MONITOR event point.
"IX",2,2,"AVAFC357",.1,2,0)
Applications that wish to monitor edit activity related to this field may
"IX",2,2,"AVAFC357",.1,3,0)
subscribe to that event point and take action as indicated by the changes
"IX",2,2,"AVAFC357",.1,4,0)
that occur.  Refer to the DG FIELD MONITOR protocol for a description of
"IX",2,2,"AVAFC357",.1,5,0)
the information available at the time of the event.
"IX",2,2,"AVAFC357",1)
D FC^DGFCPROT(.DA,2,.357,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC357",2)
D FC^DGFCPROT(.DA,2,.357,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"AVAFC357",11.1,0)
^.114IA^1^1
"IX",2,2,"AVAFC357",11.1,1,0)
1^F^2^.357^^^F
"IX",47.761,47.761,"AD",0)
47.761^AD^Allowed Document Type(s)^MU^^R^IR^W^47.7611^^^^^S
"IX",47.761,47.761,"AD",.1,0)
^^2^2^3170724^
"IX",47.761,47.761,"AD",.1,1,0)
The AD cross-reference is used as a quick check to see if a specific 
"IX",47.761,47.761,"AD",.1,2,0)
SOURCE of NOTIFICATION and DOCUMENT TYPE combination is active.
"IX",47.761,47.761,"AD",1)
S ^DG(47.761,"AD",$P(^DG(47.761,DA(1),0),"^"),X(1),X(2))=""
"IX",47.761,47.761,"AD",2)
K ^DG(47.761,"AD",$P(^DG(47.761,DA(1),0),"^"),X(1),X(2))
"IX",47.761,47.761,"AD",2.5)
K ^DG(47.761,"AD")
"IX",47.761,47.761,"AD",11.1,0)
^.114IA^2^2
"IX",47.761,47.761,"AD",11.1,1,0)
1^F^47.7611^.01^^1^F
"IX",47.761,47.761,"AD",11.1,2,0)
2^F^47.7611^.02^^2^F
"IX",47.761,47.761,"AF",0)
47.761^AF^Active Document Types Regardless of Notification Source^MU^^R^IR^W^47.7611^^^^^S
"IX",47.761,47.761,"AF",.1,0)
^^2^2^3170725^
"IX",47.761,47.761,"AF",.1,1,0)
The AF whole file cross-reference is used as a quick check to see if a 
"IX",47.761,47.761,"AF",.1,2,0)
specific DOCUMENT TYPE is active within any SOURCE OF NOTIFICATION.
"IX",47.761,47.761,"AF",1)
S ^DG(47.761,"AF",X(1),X(2),DA(1))=""
"IX",47.761,47.761,"AF",2)
K ^DG(47.761,"AF",X(1),X(2),DA(1))
"IX",47.761,47.761,"AF",2.5)
K ^DG(47.761,"AF")
"IX",47.761,47.761,"AF",11.1,0)
^.114IA^2^2
"IX",47.761,47.761,"AF",11.1,1,0)
1^F^47.7611^.01^^1^F
"IX",47.761,47.761,"AF",11.1,2,0)
2^F^47.7611^.02^^2^F
"IX",47.761,47.761,"AS",0)
47.761^AS^Active Source of Notification Rules^MU^^R^IR^I^47.761^^^^^S
"IX",47.761,47.761,"AS",.1,0)
^^2^2^3170724^
"IX",47.761,47.761,"AS",.1,1,0)
The AS cross-reference is used as a quick check to see if a specific 
"IX",47.761,47.761,"AS",.1,2,0)
SOURCE OF NOTIFICATION business rule is active.
"IX",47.761,47.761,"AS",1)
S ^DG(47.761,"AS",X(1),X(2))=""
"IX",47.761,47.761,"AS",2)
K ^DG(47.761,"AS",X(1),X(2))
"IX",47.761,47.761,"AS",2.5)
K ^DG(47.761,"AS")
"IX",47.761,47.761,"AS",11.1,0)
^.114IA^2^2
"IX",47.761,47.761,"AS",11.1,1,0)
1^F^47.761^.01^^1^F
"IX",47.761,47.761,"AS",11.1,1,3)

"IX",47.761,47.761,"AS",11.1,2,0)
2^F^47.761^.02^^2^F
"IX",47.761,47.761,"AS",11.1,2,3)

"KRN",8994,713,-1)
0^1
"KRN",8994,713,0)
DG DEATH SOURCE/DOC UPDATE^BRDATA^DGDTHBR^2^P
"KRN",8994,713,1,0)
^8994.01^3^3^3170726^^^
"KRN",8994,713,1,1,0)
This RPC will receive data from the MPI for updates to selectable Source
"KRN",8994,713,1,2,0)
of Notifications and Supporting Documents and their associated Business
"KRN",8994,713,1,3,0)
Rules.
"KRN",8994,713,2,0)
^8994.02A^1^1
"KRN",8994,713,2,1,0)
DGDATA^2^80^1^1
"KRN",8994,713,2,1,1,0)
^8994.021^4^4^3170726^^^^
"KRN",8994,713,2,1,1,1,0)
A list of updates in the following format: 
"KRN",8994,713,2,1,1,2,0)
 
"KRN",8994,713,2,1,1,3,0)
IEN of Source of Notification^Active^Supporting Document Type 
"KRN",8994,713,2,1,1,4,0)
(Code)^Active
"KRN",8994,713,2,"B","DGDATA",1)

"KRN",8994,713,2,"PARAMSEQ",1,1)

"KRN",8994,713,3,0)
^8994.03^2^2^3170726^^^^
"KRN",8994,713,3,1,0)
Return of 1^SUCCESS if update occurred at the site
"KRN",8994,713,3,2,0)
Or 0^Error Message if update was not successful
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
944^3170804^12700
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3170804
"PKG",5,22,1,"PAH",1,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - POB COUNTRY/PROVINCE
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*944 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","DG944PST")
0^2^B47916202^n/a
"RTN","DG944PST",1,0)
DG944PST ;BIR/CML-PATCH DG*5.3*944 POST INSTALLATION ROUTINE ;5/1/17
"RTN","DG944PST",2,0)
 ;;5.3;Registration;**944**;Aug 13, 1993;Build 2
"RTN","DG944PST",3,0)
 ;
"RTN","DG944PST",4,0)
 ;      - Story 500994 (cml)
"RTN","DG944PST",5,0)
 ; This post-init will loop thru the Patient file (^DPT(DFN)) and check the zero node looking for any names
"RTN","DG944PST",6,0)
 ; that contain lowercase letters. 
"RTN","DG944PST",7,0)
 ; Any that are found will be updated to all uppercase and saved into the .01 field of the PATIENT (#2) file.  
"RTN","DG944PST",8,0)
 ; When the job is complete it will send an email to:
"RTN","DG944PST",9,0)
 ;  -  (locally) POSTMASTER and the person who installed the patch (DUZ)
"RTN","DG944PST",10,0)
 ;  -  (MPI Outlook) Christine.Chesney@domain.ext, Link.Christine@domain.ext and John.Williams30ec0c@domain.ext.
"RTN","DG944PST",11,0)
 ;
"RTN","DG944PST",12,0)
 ;      - Story 557843 (cml)
"RTN","DG944PST",13,0)
 ; This post-init will loop thru the Patient file (^DPT(DFN)) and check for any records that have an ICN and
"RTN","DG944PST",14,0)
 ; an ICN CHECKSUM but do NOT have the FULL ICN field populated.
"RTN","DG944PST",15,0)
 ; Any that are found will have the FULL ICN field updated to be ICN_"V"_CHECKSUM.
"RTN","DG944PST",16,0)
 ; When the job is complete it will send an email to:
"RTN","DG944PST",17,0)
 ;  -  (locally) POSTMASTER and the person who installed the patch (DUZ)
"RTN","DG944PST",18,0)
 ;  -  (MPI Outlook) Christine.Chesney@domain.ext, Link.Christine@domain.ext and John.Williams30ec0c@domain.ext.
"RTN","DG944PST",19,0)
 ;
"RTN","DG944PST",20,0)
 ;      - Story 557808 (jfw)
"RTN","DG944PST",21,0)
 ; Add 'Department of Defense' entry to the SOURCE OF NOTIFICATION File (#47.76).
"RTN","DG944PST",22,0)
 ;
"RTN","DG944PST",23,0)
 ;      - Story 557909 (jfw)
"RTN","DG944PST",24,0)
 ; Enable auditing on the PLACE OF BIRTH CITY (.092)/STATE (.093) fields
"RTN","DG944PST",25,0)
 ; in the PATIENT file (#2). 
"RTN","DG944PST",26,0)
 ;
"RTN","DG944PST",27,0)
 ;      - Stories 557815 and 557804 (elz)
"RTN","DG944PST",28,0)
 ; Populate the new Source of Notification Business Rules (#47.761) file with initial
"RTN","DG944PST",29,0)
 ; business rules for both Source of Notification and Document Types allowed
"RTN","DG944PST",30,0)
 ;
"RTN","DG944PST",31,0)
 ;
"RTN","DG944PST",32,0)
POST ;queue off post-init to identify and cleanup any names with lowercase characters or missing FULL ICN
"RTN","DG944PST",33,0)
 N DGI,DGFLDS
"RTN","DG944PST",34,0)
 ;  Modifying the following field(s) in the PATIENT File #2:
"RTN","DG944PST",35,0)
 ;     - .092 PLACE OF BIRTH [CITY]
"RTN","DG944PST",36,0)
 ;     - .093 PLACE OF BIRTH [STATE]
"RTN","DG944PST",37,0)
 S DGFLDS=".092,.093"
"RTN","DG944PST",38,0)
 D BMES^XPDUTL("Post-Install:"),MES^XPDUTL("")
"RTN","DG944PST",39,0)
 ;Turning on AUDITING for PATIENT File field(s)
"RTN","DG944PST",40,0)
 F DGI=1:1:$L(DGFLDS,",")  D AUDIT(2,$P(DGFLDS,",",DGI),"PATIENT")
"RTN","DG944PST",41,0)
 D UPDTFLE  ;Add new Source of Notification
"RTN","DG944PST",42,0)
 D BRFILE  ;Add the DOD Source/Document type business rules into the new file
"RTN","DG944PST",43,0)
 D QUE  ;Task off cleanup of lowercase letters in names or missing FULL ICN
"RTN","DG944PST",44,0)
 D BMES^XPDUTL("Post-Install: Finished")
"RTN","DG944PST",45,0)
 Q
"RTN","DG944PST",46,0)
 ;
"RTN","DG944PST",47,0)
AUDIT(DGFILE,DGFLD,DGFNAME) ;Turn on Auditing for Field in File
"RTN","DG944PST",48,0)
 D TURNON^DIAUTL(DGFILE,DGFLD)  ;DBIA #4397 Supported
"RTN","DG944PST",49,0)
 D MES^XPDUTL("   Enabled AUDIT on file #"_DGFILE_" ("_DGFNAME_"), field #"_DGFLD)
"RTN","DG944PST",50,0)
 Q
"RTN","DG944PST",51,0)
 ;
"RTN","DG944PST",52,0)
UPDTFLE ;Create a new entry in SOURCE OF NOTIFICATIONS file (#47.76)
"RTN","DG944PST",53,0)
 N DGFDA,DGERRMSG
"RTN","DG944PST",54,0)
 D BMES^XPDUTL("   Add A New Source Of Notification (Department of Defense) to File #47.76.")
"RTN","DG944PST",55,0)
 I $$FIND1^DIC(47.76,"","X","Department of Defense") D MES^XPDUTL("   *** 'Department of Defense' Source of Notification entry already exists!") Q
"RTN","DG944PST",56,0)
 S DGFDA(47.76,"+1,",.01)="Department of Defense"
"RTN","DG944PST",57,0)
 S DGFDA(47.76,"+1,",1)=14
"RTN","DG944PST",58,0)
 S DGFDA(47.76,"+1,",2)=1
"RTN","DG944PST",59,0)
 D UPDATE^DIE("","DGFDA","","DGERRMSG")
"RTN","DG944PST",60,0)
 I $D(DGERRMSG) D MES^XPDUTL("   >>> ERROR! 'Department of Defense' Source of Notification NOT added!"),MES^XPDUTL("           [#"_DGERRMSG("DIERR",1)_": "_DGERRMSG("DIERR",1,"TEXT",1)_"]") Q
"RTN","DG944PST",61,0)
 D MES^XPDUTL("   *** 'Department of Defense' Source of Notification successfully added to")
"RTN","DG944PST",62,0)
 D MES^XPDUTL("        File #47.76!")
"RTN","DG944PST",63,0)
 Q
"RTN","DG944PST",64,0)
 ;
"RTN","DG944PST",65,0)
QUE ; Queue off the cleanup of names with lowercase letters and missing FULL ICNs
"RTN","DG944PST",66,0)
 D BMES^XPDUTL("   Queuing job to clean up lowercase names and missing FULL ICNs.")
"RTN","DG944PST",67,0)
 N ZTIO,ZTSK,ZTRTN,ZTDESC,ZTSAVE,ZTDTH,Y
"RTN","DG944PST",68,0)
 S ZTIO="",ZTRTN="DFNLOOP^DG944PST",ZTDTH=$H
"RTN","DG944PST",69,0)
 S ZTDESC="DG*5.3*944 post-install cleanup of patient names with lowercase letters and missing FULL ICNs"
"RTN","DG944PST",70,0)
 D ^%ZTLOAD
"RTN","DG944PST",71,0)
 I '$G(ZTSK) D MES^XPDUTL("   **** Queuing job failed!!!") Q
"RTN","DG944PST",72,0)
 D MES^XPDUTL("   Job number #"_ZTSK_" was queued.")
"RTN","DG944PST",73,0)
 Q
"RTN","DG944PST",74,0)
 ;
"RTN","DG944PST",75,0)
DFNLOOP ; entry point for queued job to loop on Patient file
"RTN","DG944PST",76,0)
 N DFNCNT,DFN,LCCNT,FICNT,NM,START,DONE,CKSUM,MPINODE,FULLICN,ICN,QUIT
"RTN","DG944PST",77,0)
 S START=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","DG944PST",78,0)
 S (DFNCNT,DFN,LCCNT,FICNT)=0
"RTN","DG944PST",79,0)
 F  S DFN=$O(^DPT(DFN)) Q:'DFN  S DFNCNT=DFNCNT+1 D
"RTN","DG944PST",80,0)
 .I $D(^DPT(DFN,-9)) Q
"RTN","DG944PST",81,0)
 .S NM=$P($G(^DPT(DFN,0)),"^") I NM]"" I NM'["MERGING" I NM'?.UPN S LCCNT=LCCNT+1 D UPDNM
"RTN","DG944PST",82,0)
 .D FULLCHK
"RTN","DG944PST",83,0)
 S DONE=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","DG944PST",84,0)
 ;
"RTN","DG944PST",85,0)
EMAILS ; Send email to person who ran the INIT, letting them know results
"RTN","DG944PST",86,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN,X,R
"RTN","DG944PST",87,0)
 S R(1)="Cleanup of patient names containing lowercase letters and missing FULL ICNs:"
"RTN","DG944PST",88,0)
 S R(2)=" "
"RTN","DG944PST",89,0)
 S R(3)="Process started: "_START
"RTN","DG944PST",90,0)
 S R(4)="Process completed: "_DONE
"RTN","DG944PST",91,0)
 S R(5)="Total number of patient names converted to uppercase: "_LCCNT
"RTN","DG944PST",92,0)
 S R(6)="Total number of records updated with FULL ICN: "_FICNT
"RTN","DG944PST",93,0)
 S R(7)=" ",R(8)="You can now delete the post-init routine ^DG944PST."
"RTN","DG944PST",94,0)
 S XMTEXT="R(",XMSUB="Results from running patch DG*5.3*944"
"RTN","DG944PST",95,0)
 S XMDUZ=.5
"RTN","DG944PST",96,0)
 S XMY(DUZ)=""
"RTN","DG944PST",97,0)
 D ^XMD
"RTN","DG944PST",98,0)
 ;
"RTN","DG944PST",99,0)
 ; Send message to MPI developers on Outlook
"RTN","DG944PST",100,0)
 ; IA#4440 supported call to check for test or production account
"RTN","DG944PST",101,0)
 Q:$$PROD^XUPROD()=0  ;not a production account. Don't send email to MPI dev
"RTN","DG944PST",102,0)
 ;
"RTN","DG944PST",103,0)
 N DGSNAME,DGSITE,XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN,R
"RTN","DG944PST",104,0)
 S X=$$SITE^VASITE()
"RTN","DG944PST",105,0)
 S DGSNAME=$P(X,"^",2),DGSITE=$P(X,"^",3)
"RTN","DG944PST",106,0)
 S R(1)="Post-Init routine ^DG944PST run at station: "_DGSITE_" - "_DGSNAME
"RTN","DG944PST",107,0)
 S R(2)=" "
"RTN","DG944PST",108,0)
 S R(3)="Process Started: "_START_"  -  Completed: "_DONE
"RTN","DG944PST",109,0)
 S R(4)=" "
"RTN","DG944PST",110,0)
 S R(5)="Total Patient file records processed: "_DFNCNT
"RTN","DG944PST",111,0)
 S R(6)=" "
"RTN","DG944PST",112,0)
 S R(7)="Total names converted to uppercase: "_LCCNT
"RTN","DG944PST",113,0)
 S R(8)=" "
"RTN","DG944PST",114,0)
 S R(9)="Total number of records updated with FULL ICN: "_FICNT
"RTN","DG944PST",115,0)
 S XMTEXT="R(",XMSUB="Results from running patch DG*5.3*944 at station: "_DGSITE
"RTN","DG944PST",116,0)
 S XMDUZ=DUZ
"RTN","DG944PST",117,0)
 S XMY("Christine.Chesney@domain.ext")=""
"RTN","DG944PST",118,0)
 S XMY("John.Williams30ec0c@domain.ext")=""
"RTN","DG944PST",119,0)
 S XMY("Christine.Link@domain.ext")=""
"RTN","DG944PST",120,0)
 D ^XMD
"RTN","DG944PST",121,0)
 Q
"RTN","DG944PST",122,0)
 ;
"RTN","DG944PST",123,0)
UPDNM ; convert lowercase letters to uppercase letters and edit .01 in Patient file
"RTN","DG944PST",124,0)
 N NEWNM,CHK
"RTN","DG944PST",125,0)
 S CHK=NM,NEWNM=$TR(CHK,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","DG944PST",126,0)
 L +^DPT(DFN):10 I '$T Q
"RTN","DG944PST",127,0)
 S DIE="^DPT(",DA=DFN,DR=".01///^S X=NEWNM"
"RTN","DG944PST",128,0)
 D ^DIE K DIE,DA,DR
"RTN","DG944PST",129,0)
 L -^DPT(DFN)
"RTN","DG944PST",130,0)
 Q
"RTN","DG944PST",131,0)
 ;
"RTN","DG944PST",132,0)
FULLCHK ; check and populate FULL ICN field if needed
"RTN","DG944PST",133,0)
 Q:'$D(^DPT(DFN,"MPI"))
"RTN","DG944PST",134,0)
 S MPINODE=$G(^DPT(DFN,"MPI"))
"RTN","DG944PST",135,0)
 S ICN=$P(MPINODE,"^"),CKSUM=$P(MPINODE,"^",2),FULLICN=$P(MPINODE,"^",10)
"RTN","DG944PST",136,0)
 Q:FULLICN]""
"RTN","DG944PST",137,0)
 I ICN,CKSUM D
"RTN","DG944PST",138,0)
 . S FULLICN=ICN_"V"_CKSUM
"RTN","DG944PST",139,0)
 . S DIE="^DPT(",DA=DFN,DR="991.1///^S X=FULLICN" D ^DIE S FICNT=FICNT+1
"RTN","DG944PST",140,0)
 Q
"RTN","DG944PST",141,0)
 ;
"RTN","DG944PST",142,0)
BRFILE ; populate business rules into new file.  To ensure this is only done once, check the
"RTN","DG944PST",143,0)
 ; file to make sure there are no entries in it already just in case the patch is re-installed.
"RTN","DG944PST",144,0)
 ; This way if there are changes broadcast from the MPI, they are not overwritten.
"RTN","DG944PST",145,0)
 D MES^XPDUTL("Filed Business Rules for Source of Notifications to Document Types.")
"RTN","DG944PST",146,0)
 N DGCOUNT,DGLINE,DGDATA,DGTIEN
"RTN","DG944PST",147,0)
 S DGCOUNT=0
"RTN","DG944PST",148,0)
 I $P($G(^DG(47.761,0)),"^",4) D  Q
"RTN","DG944PST",149,0)
 . D MES^XPDUTL("SOURCE OF NOTIFICATION BUSINESS RULES (#47.761) file already populated.")
"RTN","DG944PST",150,0)
 F DGLINE=2:1 S DGDATA=$P($T(BRDATA+DGLINE),";",3) Q:DGDATA=""  D
"RTN","DG944PST",151,0)
 . N DGFDA,DGTYPE,DGIEN,DGROOT
"RTN","DG944PST",152,0)
 . S DGTYPE=$O(^DG(47.75,"C",$P(DGDATA,"^",2),0))
"RTN","DG944PST",153,0)
 . I 'DGTYPE D MES^XPDUTL("Document Type "_$P(DGDATA,"^",2)_" NOT FOUND!!") Q
"RTN","DG944PST",154,0)
 . S DGIEN=+DGDATA
"RTN","DG944PST",155,0)
 . I '$D(^DG(47.761,DGIEN)) D
"RTN","DG944PST",156,0)
 .. N DGFDA
"RTN","DG944PST",157,0)
 .. S DGFDA(1,47.761,"+1,",.01)=DGIEN
"RTN","DG944PST",158,0)
 .. S DGFDA(1,47.761,"+1,",.02)=1
"RTN","DG944PST",159,0)
 .. S DGFDA(1,47.761,"+1,",.03)=DT
"RTN","DG944PST",160,0)
 .. S DGIEN(1)=DGIEN
"RTN","DG944PST",161,0)
 .. D UPDATE^DIE("","DGFDA(1)","DGIEN","DGROOT")
"RTN","DG944PST",162,0)
 . I $D(DGROOT) D MES^XPDUTL("ERROR filing Source "_DGDATA_$G(DGROOT("DIERR",1,"TEXT",1))) Q
"RTN","DG944PST",163,0)
 . S DGFDA(1,47.7611,"+1,"_DGIEN_",",.01)=DGTYPE
"RTN","DG944PST",164,0)
 . S DGFDA(1,47.7611,"+1,"_DGIEN_",",.02)=1
"RTN","DG944PST",165,0)
 . S DGTIEN(1)=DGTYPE
"RTN","DG944PST",166,0)
 . D UPDATE^DIE("","DGFDA(1)","DGTIEN","DGROOT")
"RTN","DG944PST",167,0)
 . I $D(DGROOT) D MES^XPDUTL("ERROR filing Doc Type "_DGDATA_".") Q
"RTN","DG944PST",168,0)
 . S DGCOUNT=DGCOUNT+1
"RTN","DG944PST",169,0)
 D MES^XPDUTL("Filed Business Rules for "_DGCOUNT_" of 15 successfully.")
"RTN","DG944PST",170,0)
 Q
"RTN","DG944PST",171,0)
 ;
"RTN","DG944PST",172,0)
BRDATA ; data to populate into the 47.761 file
"RTN","DG944PST",173,0)
 ; Format:  Source of Notification^Document Type
"RTN","DG944PST",174,0)
 ;;1^INPTD
"RTN","DG944PST",175,0)
 ;;8^DC
"RTN","DG944PST",176,0)
 ;;8^SPROD
"RTN","DG944PST",177,0)
 ;;8^CR
"RTN","DG944PST",178,0)
 ;;8^DCUSG
"RTN","DG944PST",179,0)
 ;;8^CSUSG
"RTN","DG944PST",180,0)
 ;;8^ORUS
"RTN","DG944PST",181,0)
 ;;8^NDUCROD
"RTN","DG944PST",182,0)
 ;;8^NDPRA
"RTN","DG944PST",183,0)
 ;;8^NDCEOR
"RTN","DG944PST",184,0)
 ;;8^NODAP
"RTN","DG944PST",185,0)
 ;;8^NODOF
"RTN","DG944PST",186,0)
 ;;8^NODOFAF
"RTN","DG944PST",187,0)
 ;;8^UACCM
"RTN","DG944PST",188,0)
 ;;10^EC
"RTN","DG944PST",189,0)
 ;;
"RTN","DGDEATH")
0^5^B63218481^B60550348
"RTN","DGDEATH",1,0)
DGDEATH ;ALB/MRL,PJR,DJS-PROCESS DECEASED PATIENTS ;10/27/04 9:45pm
"RTN","DGDEATH",2,0)
 ;;5.3;Registration;**45,84,101,149,392,545,595,568,563,725,772,863,901,926,939,944**;Aug 13, 1993;Build 2
"RTN","DGDEATH",3,0)
 ;
"RTN","DGDEATH",4,0)
GET N DGMTI,DATA,DGDWHO,DTOUT,DUOUT,DIRUT,DIROUT,DIR,DIE,DA,DFN,DR,DIC,DGDNEW,DGDSON,DGDOCT,DGUPDATE
"RTN","DGDEATH",5,0)
 S DGDTHEN="" W !! S (DIE,DIC)="^DPT(",DIC(0)="AEQMZ" D ^DIC G Q:Y'>0 S (DA,DFN)=+Y
"RTN","DGDEATH",6,0)
 S DGDOLD=$G(^DPT(DFN,.35))
"RTN","DGDEATH",7,0)
 I $P(DGDOLD,"^",1)="" G CONT
"RTN","DGDEATH",8,0)
 ; Story 340911 (elz), allow DOD to be deleted regardless (but not edited later on)
"RTN","DGDEATH",9,0)
 ;I $P(DGDOLD,"^",1)'="" S DGDWHO=$P($G(DGDOLD),"^",5) I DGDWHO="" G CONT
"RTN","DGDEATH",10,0)
 ;I ((DGDWHO'="")&(DGDWHO<1))!('$D(^VA(200,DGDWHO))) W !!,"YOU MAY NOT EDIT DATE OF DEATH IF IT WAS NOT ENTERED BY A USER AT THIS SITE" S ^DPT(DFN,.35)=DGDOLD G GET
"RTN","DGDEATH",11,0)
CONT I $D(^DPT(DFN,.1)) W !?3,"Patient is currently in-house.  Discharge him with a discharge type of DEATH." G GET
"RTN","DGDEATH",12,0)
 I $S($D(^DPT(DFN,.35)):^(.35),1:"") F DGY=0:0 S DGY=$O(^DGPM("ATID1",DFN,DGY)) Q:'DGY  S DGDA=$O(^(DGY,0)) I $D(^DGPM(+DGDA,0)),$P(^(0),"^",17)]"" S DGXX=$P(^(0),"^",17),DGXX=^DGPM(DGXX,0) I "^12^38^"[("^"_$P(DGXX,"^",18)_"^") G DIS
"RTN","DGDEATH",13,0)
 ; Story 340911 (elz) prompt for DOD, just keep it on hand without filing the data.
"RTN","DGDEATH",14,0)
 W ! S DIR(0)="2,.351" S:DGDOLD DIR("B")=$$FMTE^XLFDT(+DGDOLD) D ^DIR K DIR("B") S DGDNEW=Y
"RTN","DGDEATH",15,0)
 I X="@" S DIR("A")="Are you sure you want to delete the Date of Death" S DIR(0)="Y" D ^DIR K DIR("A") I Y S DR=".351///@;.352////@;.353///@;.357///@;.358///@;.354////"_$$NOW^XLFDT_".355////"_DUZ D ^DIE G GET
"RTN","DGDEATH",16,0)
 I $D(DIRUT) G GET
"RTN","DGDEATH",17,0)
 ; don't allow edit if not entered at this site
"RTN","DGDEATH",18,0)
 I '$D(^VA(200,+$P(DGDOLD,"^",5),0)),$P(DGDOLD,"^")'="",$P(DGDOLD,"^")'=Y W !!,"YOU MAY NOT EDIT DATE OF DEATH IF IT WAS NOT ENTERED BY A USER AT THIS SITE" S ^DPT(DFN,.35)=DGDOLD G GET
"RTN","DGDEATH",19,0)
 S DGDNEW=Y,^TMP("DEATH",$J)=1
"RTN","DGDEATH",20,0)
SN ; Story 340911 Source of Notification, updated to 1 or 8 (elz)
"RTN","DGDEATH",21,0)
 ; Story 557815 and 557804 (elz) update screen to new business rule file
"RTN","DGDEATH",22,0)
 S DGDSON=$P(DGDOLD,"^",3)
"RTN","DGDEATH",23,0)
 S DIC="^DG(47.76,",DIC(0)="AEMNQ",DIC("A")="SOURCE OF NOTIFICATION: ",DIC("S")="I $D(^DG(47.761,""AS"",Y,1))" S:DGDSON DIC("B")=$P(^DG(47.76,DGDSON,0),"^") D ^DIC K DIC("A"),DIC("B"),DIC("S")
"RTN","DGDEATH",24,0)
 I DGDNEW,$D(DTOUT)!($D(DUOUT)) W !!,"Death data not filed/updated!" K ^TMP("DEATH",$J) G GET
"RTN","DGDEATH",25,0)
 I DGDNEW,Y<0 W !,*7,?5,"Source of Notification is REQUIRED!!" G SN
"RTN","DGDEATH",26,0)
 S $P(DGDNEW,"^",3)=+Y
"RTN","DGDEATH",27,0)
DOCT ; Story 340911 Supporting document type, added with story (elz)
"RTN","DGDEATH",28,0)
 S DGDOCT=$P(DGDOLD,"^",7)
"RTN","DGDEATH",29,0)
 ; jls DG*5.3*939 RM#858372 Update list of entries not to include MVI Only Supporting Documentation Types
"RTN","DGDEATH",30,0)
 ; Story 557815 and 557804 (elz) update screen to use new business rule file
"RTN","DGDEATH",31,0)
 I DGDNEW,$$OCK S DIR(0)="2,.357" S:DGDOCT DIR("B")=$P(^DG(47.75,DGDOCT,0),"^") D ^DIR K DIR("B")
"RTN","DGDEATH",32,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) W !!,"Death data not filed/updated!" K ^TMP("DEATH",$J) G GET
"RTN","DGDEATH",33,0)
 I $$OCK,Y<1 W !,*7,?5,"Supporting Document Type is REQUIRED!!" G DOCT
"RTN","DGDEATH",34,0)
 S:$$OCK $P(DGDNEW,"^",7)=+Y,$P(DGDNEW,"^",8)="VDE"
"RTN","DGDEATH",35,0)
 ; Story 557815 (elz) validate source to document in business rule file
"RTN","DGDEATH",36,0)
 I DGDNEW,'$D(^DG(47.761,"AD",$P(DGDNEW,"^",3),+Y,1)) W !,*7,?5,"Invalid Document Type for the Source." G DOCT
"RTN","DGDEATH",37,0)
 S:$$OCK $P(DGDNEW,"^",7)=+Y,$P(DGDNEW,"^",8)="VDE"
"RTN","DGDEATH",38,0)
 ;
"RTN","DGDEATH",39,0)
 S DR="",DGUPDATE=0
"RTN","DGDEATH",40,0)
 F P=1,3,7,8 I $P(DGDOLD,"^",P)'=$P(DGDNEW,"^",P),$L($P(DGDNEW,"^")) S DGUPDATE=1
"RTN","DGDEATH",41,0)
 I DGUPDATE F P=1,3,7,8 S DR=DR_".35"_P_"////"_$P(DGDNEW,"^",P)_";"
"RTN","DGDEATH",42,0)
 I $L(DR) S:$P(DGDOLD,"^")'=$P(DGDNEW,"^") DR=DR_".354////"_$$NOW^XLFDT S DIE="^DPT(",^TMP("DEATH",$J)=1 D ^DIE,DISCHRGE
"RTN","DGDEATH",43,0)
 I $P(DGDOLD,"^",1)'=$P(DGDNEW,"^",1) D XFR
"RTN","DGDEATH",44,0)
 K ^TMP("DEATH",$J) G GET
"RTN","DGDEATH",45,0)
 ;
"RTN","DGDEATH",46,0)
DIS W !,"Patient has a discharge type of Death",!,"Edit the discharge",!
"RTN","DGDEATH",47,0)
Q K A,DA,DFN,DGDA,DIC,DIE,DR,DGXX,DGY,DGDTHEN,DGDOLD,DGDNEW,DGDONOT Q
"RTN","DGDEATH",48,0)
XFR ; called from set x-ref of field .351 of file 2
"RTN","DGDEATH",49,0)
 N DGPCMM,DGFAPT,DGFAPTI,DGFAPT1
"RTN","DGDEATH",50,0)
 Q:'$D(DFN)
"RTN","DGDEATH",51,0)
 K DGTEXT D ^DGPATV S DGDEATH=$$GET1^DIQ(2,DFN,.351,"I"),XMSUB="PATIENT HAS EXPIRED",DGCT=0
"RTN","DGDEATH",52,0)
 D DEMOG
"RTN","DGDEATH",53,0)
 S DGT=X-.0001,(Y,DGDDT)=X,DG1="" D:DGT]"" ^DGPMSTAT
"RTN","DGDEATH",54,0)
 S Y=$$FMTE^XLFDT(Y),Y=$S(Y]"":Y,1:"UNKNOWN")
"RTN","DGDEATH",55,0)
 S DGDONOT=0 D APTT3
"RTN","DGDEATH",56,0)
 D LINE("")
"RTN","DGDEATH",57,0)
 D LINE("      Date/Time of Death: "_DEATHVAL_$S(DGDONOT:"",'DG1:"",$D(DGDTHEN):"",1:"  (While an inpatient)"))
"RTN","DGDEATH",58,0)
 D LINE("")
"RTN","DGDEATH",59,0)
 I '$D(ADM),DG1,$D(^DGPM(+DGA1,0)) S ADM=+^DGPM($P(^(0),"^",14),0)
"RTN","DGDEATH",60,0)
 S Y=$$FMTE^XLFDT($S($D(ADM):ADM,1:""))
"RTN","DGDEATH",61,0)
 D LINE($S($D(DGDTHEN):"",DG1:"     Admission Date/Time: "_Y_$S((DGDDT-ADM)<1:"  (Within 24 hours of hospitalization)",1:""),1:""))
"RTN","DGDEATH",62,0)
 D LINE("")
"RTN","DGDEATH",63,0)
 S DGX=$P($G(^DGPM(+$G(DGA1),0)),"^",6),DGX=$P($G(^DIC(42,+DGX,0)),U,1)
"RTN","DGDEATH",64,0)
 D LINE($S($D(DGDTHEN):"",('DG1):"",$D(DGA1):"             Admitted To: "_$S(DGX]"":DGX,1:"UNKNOWN"),1:"")) K DGX
"RTN","DGDEATH",65,0)
 D LINE("")
"RTN","DGDEATH",66,0)
 I DG1&'$D(DGDTHEN) D 
"RTN","DGDEATH",67,0)
 . D LINE($S($D(DGXFR0):"           Last Transfer: "_$S($D(^DIC(42,+$P(DGXFR0,"^",6),0)):$P(^(0),"^"),1:"UNKNOWN"),1:""))
"RTN","DGDEATH",68,0)
 . D LINE("")
"RTN","DGDEATH",69,0)
F N DGARRAY,SDCNT S DGFAPT=DGDEATH,DGFAPTI=""
"RTN","DGDEATH",70,0)
 S DGARRAY("FLDS")=3,DGARRAY(4)=DFN,DGARRAY("SORT")="P",DGARRAY(1)=DT,DGARRAY(3)="I;R"
"RTN","DGDEATH",71,0)
 S SDCNT=$$SDAPI^SDAMA301(.DGARRAY)
"RTN","DGDEATH",72,0)
 ;
"RTN","DGDEATH",73,0)
 I SDCNT>0 F  S DGFAPT=$O(^TMP($J,"SDAMA301",DFN,DGFAPT)) Q:'DGFAPT  S DGFAPT1=$G(^TMP($J,"SDAMA301",DFN,DGFAPT)) Q:DGFAPT1']""  D  Q:DGFAPTI
"RTN","DGDEATH",74,0)
 .I $P($P(DGFAPT1,U,3),";")'["C" D LINE("NOTE: Patient has future appointments scheduled!!") S DGFAPTI=1
"RTN","DGDEATH",75,0)
 S DGSCHAD=0 D SA I DGSCHAD D LINE("NOTE: Patient had scheduled admissions which have been cancelled!!")
"RTN","DGDEATH",76,0)
 I 'DGVETS D LINE("Patient is a NON-VETERAN."_$S($D(^DIC(21,+$P($G(^DPT(DFN,.32)),"^",3),0)):"  ["_$P(^(0),"^",1)_"]",1:""))
"RTN","DGDEATH",77,0)
 S DGPCMM=$$PCMMXMY^SCAPMC25(1,DFN,,,0) ;creates xmy array
"RTN","DGDEATH",78,0)
 S DGCT=$$PCMAIL^SCMCMM(DFN,"DGTEXT",DT)
"RTN","DGDEATH",79,0)
Q1 S DGB=1 D ^DGBUL S X=DGDEATH
"RTN","DGDEATH",80,0)
 K DGDEATH,DGSCHAD,DGI,Y,DGDDT,^TMP($J,"SDAMA301") D KILL^DGPATV K ADM,DG1,DGA1,DGCT,DGT,DGXX,DGY,Z Q
"RTN","DGDEATH",81,0)
SA F DGI=0:0 S DGI=$O(^DGS(41.1,"B",DFN,DGI)) Q:'DGI  I $D(^DGS(41.1,DGI,0)),($P(^(0),"^",13)']""),($P(^(0),"^",17)']"") S $P(^(0),"^",13)=DGDEATH,$P(^(0),"^",14)=+DUZ,$P(^(0),"^",15)=1,$P(^(0),"^",16)=2,DGSCHAD=1
"RTN","DGDEATH",82,0)
 Q
"RTN","DGDEATH",83,0)
 ;
"RTN","DGDEATH",84,0)
DEL ; delete death bulletin
"RTN","DGDEATH",85,0)
 N DGPCMM,DELBY,DELTM,DTHINFO
"RTN","DGDEATH",86,0)
 S DFN=+$G(DA) I '$D(^DPT(DFN,0)) Q  ; no patient node
"RTN","DGDEATH",87,0)
 I +$G(^DPT(DFN,.35)) Q  ; not deletion
"RTN","DGDEATH",88,0)
 S DGDEATH=X,XMSUB="Patient Death has been Deleted",DGCT=0
"RTN","DGDEATH",89,0)
 D ^DGPATV
"RTN","DGDEATH",90,0)
 D LINE("The date of death for the following patient has been deleted.")
"RTN","DGDEATH",91,0)
 D LINE("")
"RTN","DGDEATH",92,0)
 D DEMOG
"RTN","DGDEATH",93,0)
 D LINE("")
"RTN","DGDEATH",94,0)
 S DGPCMM=$$PCMMXMY^SCAPMC25(1,DFN,,,0) ;creates xmy array
"RTN","DGDEATH",95,0)
 S DGCT=$$PCMAIL^SCMCMM(DFN,"DGTEXT",DT)
"RTN","DGDEATH",96,0)
 S DGB=1 D ^DGBUL S X=DGDEATH
"RTN","DGDEATH",97,0)
 K DGCT,DGDEATH D KILL^DGPATV
"RTN","DGDEATH",98,0)
 Q
"RTN","DGDEATH",99,0)
 ;
"RTN","DGDEATH",100,0)
DEMOG ; list main demographics
"RTN","DGDEATH",101,0)
 D LINE("                    NAME: "_DGNAME)
"RTN","DGDEATH",102,0)
 D LINE("                     SSN: "_$P(SSN,"^",2))
"RTN","DGDEATH",103,0)
 D LINE("                     DOB: "_$P(DOB,"^",2))
"RTN","DGDEATH",104,0)
 I DGVETS D
"RTN","DGDEATH",105,0)
 . N DGX
"RTN","DGDEATH",106,0)
 . S DGX=$G(^DPT(DFN,.31))
"RTN","DGDEATH",107,0)
 . S DGLOCATN=$$FIND1^DIC(4,"","MX","`"_+$P(DGX,U,4)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:"NOT LISTED")
"RTN","DGDEATH",108,0)
 . D LINE("   CLAIM FOLDER LOCATION: "_$S($D(DGLOCATN):DGLOCATN,1:"NOT LISTED"))
"RTN","DGDEATH",109,0)
 . D LINE("            CLAIM NUMBER: "_$S($P(DGX,"^",3)]"":$P(DGX,"^",3),1:"NOT LISTED"))
"RTN","DGDEATH",110,0)
 ;D LINE("   COORDINATING MASTER OF RECORD: "_DGCMOR)  ;**863 - MVI_2351 (ptd)
"RTN","DGDEATH",111,0)
 D GETS^DIQ(2,DFN_",",".351;.353;.354;.355","E","DTHINFO")
"RTN","DGDEATH",112,0)
 S DEATHVAL=$G(DTHINFO(2,DFN_",",.351,"E"))
"RTN","DGDEATH",113,0)
 S DEATHVAL=$$FMTE^XLFDT(DEATHVAL),DEATHVAL=$S(DEATHVAL]"":DEATHVAL,1:"UNKNOWN")
"RTN","DGDEATH",114,0)
 S SOURCE=$G(DTHINFO(2,DFN_",",.353,"E"))
"RTN","DGDEATH",115,0)
 S DELTM=$G(DTHINFO(2,DFN_",",.354,"E"))
"RTN","DGDEATH",116,0)
 S DELBY=$G(DTHINFO(2,DFN_",",.355,"E"))
"RTN","DGDEATH",117,0)
 D LINE("")
"RTN","DGDEATH",118,0)
 D LINE("             LAST EDITED BY: "_DELBY)
"RTN","DGDEATH",119,0)
 D LINE("    DATE/TIME LAST MODIFIED: "_DELTM)
"RTN","DGDEATH",120,0)
 D LINE("     SOURCE OF NOTIFICATION: "_$S(SOURCE="":"UNDEFINED",1:SOURCE))
"RTN","DGDEATH",121,0)
 ;K DEATHVAL,SOURCE,DELTM,DELBY
"RTN","DGDEATH",122,0)
 Q
"RTN","DGDEATH",123,0)
 ;
"RTN","DGDEATH",124,0)
LINE(X) ; add line contained in X to array
"RTN","DGDEATH",125,0)
 S DGCT=DGCT+1
"RTN","DGDEATH",126,0)
 S DGTEXT(DGCT,0)=X
"RTN","DGDEATH",127,0)
 Q
"RTN","DGDEATH",128,0)
DSBULL ;
"RTN","DGDEATH",129,0)
 ;
"RTN","DGDEATH",130,0)
 I $G(IVMDODUP)=1 Q
"RTN","DGDEATH",131,0)
 S DFN=DA
"RTN","DGDEATH",132,0)
 I $D(DGPMDA) D  Q
"RTN","DGDEATH",133,0)
 .S DISTYPE=$P($G(^DGPM(DGPMDA,0)),"^",18)
"RTN","DGDEATH",134,0)
 .I $G(^DG(405.2,DISTYPE,0))["DEATH" D
"RTN","DGDEATH",135,0)
 ..S FDA(2,DFN_",",.353)=1
"RTN","DGDEATH",136,0)
 ..; Story 940911 (elz) update document type and option used.
"RTN","DGDEATH",137,0)
 ..S:$$OCK FDA(2,DFN_",",.357)=+$O(^DG(47.75,"B","VAMC EHR INPATIENT DEATH",0)),FDA(2,DFN_",",.358)="VDP"
"RTN","DGDEATH",138,0)
 ..D FILE^DIE(,"FDA","BWFERR")
"RTN","DGDEATH",139,0)
 ..D DISCHRGE,XFR
"RTN","DGDEATH",140,0)
 I $D(^TMP("DEATH",$J)) Q
"RTN","DGDEATH",141,0)
 D DISCHRGE,XFR
"RTN","DGDEATH",142,0)
 Q
"RTN","DGDEATH",143,0)
DKBULL ;
"RTN","DGDEATH",144,0)
 S DFN=DA
"RTN","DGDEATH",145,0)
 S FDA(2,DFN_",",.353)="@"
"RTN","DGDEATH",146,0)
 ; Story 940911 (elz) update document type and option used
"RTN","DGDEATH",147,0)
 S:$$OCK FDA(2,DFN_",",.357)="@",FDA(2,DFN_",",.358)="@"
"RTN","DGDEATH",148,0)
 I $D(^TMP("DEATH",$J)) S FDA(2,DFN_",",.355)=DUZ
"RTN","DGDEATH",149,0)
 D FILE^DIE(,"FDA",)
"RTN","DGDEATH",150,0)
 D DEL
"RTN","DGDEATH",151,0)
 Q
"RTN","DGDEATH",152,0)
DISCHRGE ;
"RTN","DGDEATH",153,0)
 ; If the patient is being discharged, determine values needed for 
"RTN","DGDEATH",154,0)
 ; Source of Notification and Date/Time last entered.
"RTN","DGDEATH",155,0)
 ;
"RTN","DGDEATH",156,0)
 I '$D(DGNOW) S DGNOW=$$HTFM^XLFDT($H)
"RTN","DGDEATH",157,0)
 I $G(DGDAUTO)'=1 S FDA(2,DFN_",",.354)=DGNOW
"RTN","DGDEATH",158,0)
 S FDA(2,DFN_",",.355)=DUZ
"RTN","DGDEATH",159,0)
 D FILE^DIE(,"FDA",)
"RTN","DGDEATH",160,0)
 Q
"RTN","DGDEATH",161,0)
APTT3 ;Check to exclude "While an Inpatient" from DOD Bulletin
"RTN","DGDEATH",162,0)
 ; Input:  DFN  Output: DGDONOT
"RTN","DGDEATH",163,0)
 N DATE,XIEN,TYPE,XDOD,YES
"RTN","DGDEATH",164,0)
 S DGDONOT=0
"RTN","DGDEATH",165,0)
 S XDOD=$P($G(^DPT(DFN,.35)),"^",1) I 'XDOD Q
"RTN","DGDEATH",166,0)
 S XDOD=$P(XDOD,".",1),YES=0,TYPE=""
"RTN","DGDEATH",167,0)
 I '$D(^DGPM("APTT3",DFN)) Q
"RTN","DGDEATH",168,0)
 S DATE=$O(^DGPM("APTT3",DFN,XDOD)) I 'DATE Q
"RTN","DGDEATH",169,0)
 I $P(DATE,".",1)=XDOD S YES=1
"RTN","DGDEATH",170,0)
 I ($P(DATE,".",1)-1)=XDOD S YES=1
"RTN","DGDEATH",171,0)
 S XIEN=$O(^DGPM("APTT3",DFN,DATE,"")) I 'XIEN Q
"RTN","DGDEATH",172,0)
 S TYPE=$P($G(^DGPM(XIEN,0)),"^",4)
"RTN","DGDEATH",173,0)
 I YES,'((TYPE=27)!(TYPE=32)) S DGDONOT=1
"RTN","DGDEATH",174,0)
 Q
"RTN","DGDEATH",175,0)
OCK() ; - Only specific options for fields .357 and .358 Story 340911 (elz)
"RTN","DGDEATH",176,0)
 N RETURN
"RTN","DGDEATH",177,0)
 S RETURN=0
"RTN","DGDEATH",178,0)
 I $P(XQY0,"^")="DG DEATH ENTRY" S RETURN=1
"RTN","DGDEATH",179,0)
 I $P(XQY0,"^")="DG DISCHARGE PATIENT" S RETURN=1
"RTN","DGDEATH",180,0)
 Q RETURN
"RTN","DGDEATH",181,0)
 ;
"RTN","DGDEATH",182,0)
 ;**926, Story 323008 (JFW)
"RTN","DGDEATH",183,0)
SDTHELP ;Supporting Document Type Help (XECUTABLE HELP for 2..357)
"RTN","DGDEATH",184,0)
 D:($G(X)["??")
"RTN","DGDEATH",185,0)
 .N MPIOUT,MPII,MPIC,MPIDESC,DIWL,DIWR,DIWF,X,SCREEN
"RTN","DGDEATH",186,0)
 .S SCREEN="I $D(^DG(47.761,""AF"",+Y,1))"
"RTN","DGDEATH",187,0)
 .S MPII=0,DIWL=1,DIWR=$S($G(IOM)]"":IOM,1:70)
"RTN","DGDEATH",188,0)
 .D LIST^DIC(47.75,"",".01","P","","","","","",.SCREEN,"MPIOUT")  ;Supported DBIA #2051
"RTN","DGDEATH",189,0)
 .F  S MPII=$O(MPIOUT("DILIST",MPII)) Q:MPII=""  D
"RTN","DGDEATH",190,0)
 ..K MPIDESC D GET1^DIQ(47.75,$P(MPIOUT("DILIST",MPII,0),"^")_",","50","E","MPIDESC","")  ;Supported DBIA #2056
"RTN","DGDEATH",191,0)
 ..W !,$P(MPIOUT("DILIST",MPII,0),"^",2)_" : "
"RTN","DGDEATH",192,0)
 ..K ^UTILITY($J,"W") S MPIC=0 F  S MPIC=$O(MPIDESC(MPIC)) Q:MPIC=""  D
"RTN","DGDEATH",193,0)
 ...S X=MPIDESC(MPIC) D ^DIWP  ;Supported DBIA #10011
"RTN","DGDEATH",194,0)
 ..D ^DIWW  ;Supported DBIA #10029
"RTN","DGDEATH",195,0)
 Q
"RTN","DGDTHBR")
0^6^B4998998^n/a
"RTN","DGDTHBR",1,0)
DGDTHBR ;OAK/ELZ-MAINTAIN DEATH SOURCE OF NOTIFICATION/DOCUMENT TYPE BUSINESS RULES ;7/26/17
"RTN","DGDTHBR",2,0)
 ;;5.3;Registration;**944**;Aug 13, 1993;Build 2
"RTN","DGDTHBR",3,0)
 ;
"RTN","DGDTHBR",4,0)
 ;**944 - Stories 557804 and 557815 (elz)
"RTN","DGDTHBR",5,0)
 ;  This routine will receive RPC calls from DG DEATH SOURCE/DOC UPDATE.  The updates
"RTN","DGDTHBR",6,0)
 ;  will be sent to all sites from the MPI to allow for dynamic updates to the selectable
"RTN","DGDTHBR",7,0)
 ;  SOURCE OF NOTIFICATIONS and SUPPORTING DOCUMENTS as well as the business rules of which
"RTN","DGDTHBR",8,0)
 ;  ones are allowed in combination
"RTN","DGDTHBR",9,0)
 ;
"RTN","DGDTHBR",10,0)
 ;
"RTN","DGDTHBR",11,0)
BRDATA(RETURN,DGDATA) ; = Entry point from RPC with list of business rules to be updated
"RTN","DGDTHBR",12,0)
 ; DGDATA = Array of business rules to file in the following format:
"RTN","DGDTHBR",13,0)
 ;          IEN of Source of Notification^Active^Supporting Document Type (Type Code)^Active
"RTN","DGDTHBR",14,0)
 ;
"RTN","DGDTHBR",15,0)
 K RETURN
"RTN","DGDTHBR",16,0)
 N DGCOUNT,DGLINE,DGTIEN
"RTN","DGDTHBR",17,0)
 S DGCOUNT=0
"RTN","DGDTHBR",18,0)
 S DGLINE=0 F  S DGLINE=$O(DGDATA(DGLINE)) Q:'DGLINE  S DGDATA=DGDATA(DGLINE) D
"RTN","DGDTHBR",19,0)
 . N DGFDA,DGTYPE,DGIEN,DGROOT
"RTN","DGDTHBR",20,0)
 . S DGTYPE=$O(^DG(47.75,"C",$P(DGDATA,"^",3),0))
"RTN","DGDTHBR",21,0)
 . I 'DGTYPE S RETURN(DGLINE)="-1^Document Type "_$P(DGDATA,"^",2)_" NOT FOUND!!" Q
"RTN","DGDTHBR",22,0)
 . S DGIEN=+DGDATA
"RTN","DGDTHBR",23,0)
 . ; Source of Notifications first
"RTN","DGDTHBR",24,0)
 . I '$D(^DG(47.761,DGIEN)) D
"RTN","DGDTHBR",25,0)
 .. N DGFDA
"RTN","DGDTHBR",26,0)
 .. S DGFDA(1,47.761,"+1,",.01)=DGIEN
"RTN","DGDTHBR",27,0)
 .. S DGFDA(1,47.761,"+1,",.02)=$P(DGDATA,"^",2)
"RTN","DGDTHBR",28,0)
 .. S DGFDA(1,47.761,"+1,",.03)=DT
"RTN","DGDTHBR",29,0)
 .. S DGIEN(1)=DGIEN
"RTN","DGDTHBR",30,0)
 .. D UPDATE^DIE("","DGFDA(1)","DGIEN","DGROOT")
"RTN","DGDTHBR",31,0)
 . E  D
"RTN","DGDTHBR",32,0)
 .. N DGFDA
"RTN","DGDTHBR",33,0)
 .. S DGFDA(47.761,DGIEN_",",.02)=$P(DGDATA,"^",2)
"RTN","DGDTHBR",34,0)
 .. S DGFDA(47.761,DGIEN_",",.03)=DT
"RTN","DGDTHBR",35,0)
 .. D FILE^DIE("","DGFDA","DGROOT")
"RTN","DGDTHBR",36,0)
 . I $D(DGROOT) S RETURN(DGLINE)="-1^ERROR filing Source "_DGDATA_" "_$G(DGROOT("DIERR",1,"TEXT",1)) Q
"RTN","DGDTHBR",37,0)
 . ; Now for associated document type
"RTN","DGDTHBR",38,0)
 . I '$D(^DG(47.761,DGIEN,1,DGTYPE)) D
"RTN","DGDTHBR",39,0)
 .. S DGFDA(1,47.7611,"+1,"_DGIEN_",",.01)=DGTYPE
"RTN","DGDTHBR",40,0)
 .. S DGFDA(1,47.7611,"+1,"_DGIEN_",",.02)=$P(DGDATA,"^",4)
"RTN","DGDTHBR",41,0)
 .. S DGTIEN(1)=DGTYPE
"RTN","DGDTHBR",42,0)
 .. D UPDATE^DIE("","DGFDA(1)","DGTIEN","DGROOT")
"RTN","DGDTHBR",43,0)
 . E  D
"RTN","DGDTHBR",44,0)
 .. N DGFDA
"RTN","DGDTHBR",45,0)
 .. S DGFDA(47.7611,DGTYPE_","_DGIEN_",",.02)=$P(DGDATA,"^",4)
"RTN","DGDTHBR",46,0)
 .. D FILE^DIE("","DGFDA","DGROOT")
"RTN","DGDTHBR",47,0)
 . I $D(DGROOT) S RETURN(DGLINE)="-1^ERROR filing Doc Type "_DGDATA_"." Q
"RTN","DGDTHBR",48,0)
 . S DGCOUNT=DGCOUNT+1
"RTN","DGDTHBR",49,0)
 I '$D(RETURN) S RETURN(1)=DGCOUNT_"^Successfully filed"
"RTN","DGDTHBR",50,0)
 Q
"RTN","DGDTHBR",51,0)
 ;
"RTN","VAFCPDT2")
0^4^B31881197^B28878305
"RTN","VAFCPDT2",1,0)
VAFCPDT2 ;BIR/CML/ALS-DISPLAY MPI/PD INFORMATION FOR SELECTED PATIENT ; 1/6/11 3:57pm
"RTN","VAFCPDT2",2,0)
 ;;5.3;Registration;**414,505,627,697,797,876,937,944**;Aug 13, 1993;Build 2
"RTN","VAFCPDT2",3,0)
 ;Reference to ^MPIF(984.9,"C" supported by IA #3298
"RTN","VAFCPDT2",4,0)
 ;
"RTN","VAFCPDT2",5,0)
CMORHIS ;Find CMOR History
"RTN","VAFCPDT2",6,0)
 I '$O(^DPT(DFN,"MPICMOR",0)) G CMORCHG
"RTN","VAFCPDT2",7,0)
 I $Y+4>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDT2",8,0)
 .S LNQ=22 D SS^VAFCPDAT Q:QFLG
"RTN","VAFCPDT2",9,0)
 .W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2
"RTN","VAFCPDT2",10,0)
 D CHISHDR
"RTN","VAFCPDT2",11,0)
 S HIS=0 F  S HIS=$O(^DPT(DFN,"MPICMOR",HIS)) Q:'HIS  D  Q:QFLG
"RTN","VAFCPDT2",12,0)
 .S DIC=2,DR="993",DR(2.0993)=".01;3",DA=DFN,DA(2.0993)=HIS
"RTN","VAFCPDT2",13,0)
 .S DIQ(0)="E",DIQ="CMORNODE"
"RTN","VAFCPDT2",14,0)
 .D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","VAFCPDT2",15,0)
 .S HISCMOR=$G(CMORNODE(2.0993,HIS,.01,"E"))
"RTN","VAFCPDT2",16,0)
 .I +HISCMOR S HISCMOR=$$GET1^DIQ(4,HISCMOR,.01)
"RTN","VAFCPDT2",17,0)
 .S CHGDT=$G(CMORNODE(2.0993,HIS,3,"E"))
"RTN","VAFCPDT2",18,0)
 .I $Y+3>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDT2",19,0)
 ..S LNQ=22 D SS^VAFCPDAT Q:QFLG
"RTN","VAFCPDT2",20,0)
 ..W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D CHISHDR
"RTN","VAFCPDT2",21,0)
 .W !,$P(CHGDT,"@"),?12," - CMOR changed from ",HISCMOR
"RTN","VAFCPDT2",22,0)
 ;
"RTN","VAFCPDT2",23,0)
CMORCHG ;Find CMOR change request
"RTN","VAFCPDT2",24,0)
 I '$O(^MPIF(984.9,"C",DFN,0)) G EXT
"RTN","VAFCPDT2",25,0)
 I $Y+4>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDT2",26,0)
 .S LNQ=22 D SS^VAFCPDAT Q:QFLG
"RTN","VAFCPDT2",27,0)
 .W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2
"RTN","VAFCPDT2",28,0)
 D CCHGHDR
"RTN","VAFCPDT2",29,0)
 S CHG=0 F  S CHG=$O(^MPIF(984.9,"C",DFN,CHG)) Q:'CHG  D  Q:QFLG
"RTN","VAFCPDT2",30,0)
 .S DIC=984.9,DA=CHG,DR=".01;.03;.06;.07;.08;1.03",DIQ="CHGNODE"
"RTN","VAFCPDT2",31,0)
 .S DIQ(0)="EI" D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDT2",32,0)
 .S CHGNUM=$G(CHGNODE(984.9,CHG,.01,"E"))
"RTN","VAFCPDT2",33,0)
 .S CHGDT=$G(CHGNODE(984.9,CHG,.03,"E"))
"RTN","VAFCPDT2",34,0)
 .S TMSG=$G(CHGNODE(984.9,CHG,.08,"E"))
"RTN","VAFCPDT2",35,0)
 .S TREQ=$G(CHGNODE(984.9,CHG,1.03,"E"))
"RTN","VAFCPDT2",36,0)
 .S SITE=$G(CHGNODE(984.9,CHG,.07,"E"))
"RTN","VAFCPDT2",37,0)
 .S STATUS=$G(CHGNODE(984.9,CHG,.06,"E"))
"RTN","VAFCPDT2",38,0)
 .I $Y+4>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDT2",39,0)
 ..S LNQ=22 D SS^VAFCPDAT Q:QFLG
"RTN","VAFCPDT2",40,0)
 ..W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D CCHGHDR
"RTN","VAFCPDT2",41,0)
 .W !,"REQUEST #",CHGNUM," - ",TMSG," ",CHGDT
"RTN","VAFCPDT2",42,0)
 .W !?4,"Type of Request: ",TREQ," ",SITE
"RTN","VAFCPDT2",43,0)
 .W !?4,"Status : ",STATUS,!
"RTN","VAFCPDT2",44,0)
 ;
"RTN","VAFCPDT2",45,0)
EXT ;Extended patient demographic data
"RTN","VAFCPDT2",46,0)
 I $E(IOST,1,2)="C-" D  Q:QFLG
"RTN","VAFCPDT2",47,0)
 .S LNQ=22 D SS^VAFCPDAT Q:QFLG
"RTN","VAFCPDT2",48,0)
 .W @IOF
"RTN","VAFCPDT2",49,0)
 I QFLG=1 G QUIT^VAFCPDAT
"RTN","VAFCPDT2",50,0)
 W !!,"Additional DPT Data for: ",NAME,"  (DFN #",DFN,")",!,LN2
"RTN","VAFCPDT2",51,0)
 S DA=DFN,DIC=2,DIQ="XDATA",DIQ(0)="EI"
"RTN","VAFCPDT2",52,0)
 ;Story 513046 (elz) place of birth prov and country
"RTN","VAFCPDT2",53,0)
 S DR=".05;.08;.092;.093;.219;.2401;.2402;.2403;.211;.302;.323;.341;.331;.361;1901;.325;.328;.326;.327;.097;.525;391;.0931;.0932"  ;**876 - MVI_3432 (cml)
"RTN","VAFCPDT2",54,0)
 N COB,SOB,FNM,MNM,MMNM,NOK,NOKN,DESIG,EMER,ELIG,VET,SRVBR,SRVNUM,SRVEDT,SRVSDT,SRVCPCT,POSRVC,FILEDT,MARS,RELP,POW,NODE,MSD,PATTYPE,POBP,POBC  ;**876 - MVI_3432 (cml)
"RTN","VAFCPDT2",55,0)
 D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDT2",56,0)
 S COB=$G(XDATA(2,DFN,.092,"E")),SOB=$G(XDATA(2,DFN,.093,"E"))
"RTN","VAFCPDT2",57,0)
 S FILEDT=$G(XDATA(2,DFN,.097,"E")),FNM=$G(XDATA(2,DFN,.2401,"E"))
"RTN","VAFCPDT2",58,0)
 S MNM=$G(XDATA(2,DFN,.2402,"E")),MMNM=$G(XDATA(2,DFN,.2403,"E"))
"RTN","VAFCPDT2",59,0)
 S NOK=$G(XDATA(2,DFN,.211,"E")),DESIG=$G(XDATA(2,DFN,.341,"E"))
"RTN","VAFCPDT2",60,0)
 S EMER=$G(XDATA(2,DFN,.331,"E"))
"RTN","VAFCPDT2",61,0)
 S ELIG=$G(XDATA(2,DFN,.361,"E")),VET=$G(XDATA(2,DFN,1901,"E"))
"RTN","VAFCPDT2",62,0)
 S SRVBR=$G(XDATA(2,DFN,.325,"E")),SRVNUM=$G(XDATA(2,DFN,.328,"E"))
"RTN","VAFCPDT2",63,0)
 S SRVEDT=$G(XDATA(2,DFN,.326,"E")),SRVSDT=$G(XDATA(2,DFN,.327,"E"))
"RTN","VAFCPDT2",64,0)
 S MARS=$G(XDATA(2,DFN,.05,"E")),RELP=$G(XDATA(2,DFN,.08,"E"))
"RTN","VAFCPDT2",65,0)
 S POSRVC=$G(XDATA(2,DFN,.323,"E")),SRVCPCT=$G(XDATA(2,DFN,.302,"E"))
"RTN","VAFCPDT2",66,0)
 S NOKN=$G(XDATA(2,DFN,.219,"E")),POW=$G(XDATA(2,DFN,.525,"E"))
"RTN","VAFCPDT2",67,0)
 S PATTYPE=$G(XDATA(2,DFN,391,"E"))  ;**876 - MVI_3432 (cml)
"RTN","VAFCPDT2",68,0)
 S POBC=$G(XDATA(2,DFN,.0931,"I")) ;Story 513046 (elz)
"RTN","VAFCPDT2",69,0)
 S POBP=$G(XDATA(2,DFN,.0932,"E")) ;Story 513046 (elz)
"RTN","VAFCPDT2",70,0)
 ;
"RTN","VAFCPDT2",71,0)
 W !,"PLACE OF BIRTH [CITY]",?31,": ",COB
"RTN","VAFCPDT2",72,0)
 W:'$L(POBP) !,"PLACE OF BIRTH [STATE]",?31,": ",SOB
"RTN","VAFCPDT2",73,0)
 W:$L(POBP) !,"PLACE OF BIRTH PROVINCE",?31,": ",POBP ;Story 513046 (elz)
"RTN","VAFCPDT2",74,0)
 W !,"PLACE OF BIRTH COUNTRY",?31,": ",$S(POBC:$$GET1^DIQ(779.004,POBC_",",2),1:"") ; Story 513046 (elz)
"RTN","VAFCPDT2",75,0)
 W !,"FATHER'S NAME",?31,": ",FNM
"RTN","VAFCPDT2",76,0)
 W !,"MOTHER'S NAME",?31,": ",MNM
"RTN","VAFCPDT2",77,0)
 W !,"MOTHER'S MAIDEN NAME",?31,": ",MMNM
"RTN","VAFCPDT2",78,0)
 W !,"NAME OF PRIMARY NEXT OF KIN",?31,": ",NOK
"RTN","VAFCPDT2",79,0)
 W !,"NEXT OF KIN PHONE NUMBER",?31,": ",NOKN
"RTN","VAFCPDT2",80,0)
 W !,"NAME OF DESIGNEE",?31,": ",DESIG
"RTN","VAFCPDT2",81,0)
 W !,"EMERGENCY NAME",?31,": ",EMER
"RTN","VAFCPDT2",82,0)
 W !,"MARITAL STATUS",?31,": ",MARS
"RTN","VAFCPDT2",83,0)
 W !,"RELIGIOUS PREFERENCE",?31,": ",RELP
"RTN","VAFCPDT2",84,0)
 ;
"RTN","VAFCPDT2",85,0)
 D DEM^VADPT
"RTN","VAFCPDT2",86,0)
 ;ETHNICITY info
"RTN","VAFCPDT2",87,0)
 I $G(VADM(11,1)) W !,"ETHNICITY INFORMATION",?31,": ",$P(VADM(11,1),"^",2)
"RTN","VAFCPDT2",88,0)
 ;
"RTN","VAFCPDT2",89,0)
 ;RACE multiple
"RTN","VAFCPDT2",90,0)
 I $O(VADM(12,0)) D
"RTN","VAFCPDT2",91,0)
 .W !,"RACE INFORMATION (multiple):"
"RTN","VAFCPDT2",92,0)
 .S RACEMUL=0 F  S RACEMUL=$O(VADM(12,RACEMUL)) Q:'RACEMUL  W !?3,$P(VADM(12,RACEMUL),"^",2)
"RTN","VAFCPDT2",93,0)
 ;
"RTN","VAFCPDT2",94,0)
 W !,"PRIMARY ELIGIBILITY CODE",?31,": ",ELIG
"RTN","VAFCPDT2",95,0)
 W !,"PATIENT TYPE",?31,": ",PATTYPE  ;**876 - MVI_3432 (cml)
"RTN","VAFCPDT2",96,0)
 W !,"VETERAN (Y/N)?",?31,": ",VET
"RTN","VAFCPDT2",97,0)
 W !,"SERVICE CONNECTED PERCENT",?31,": ",SRVCPCT
"RTN","VAFCPDT2",98,0)
 W !,"PERIOD OF SERVICE",?31,": ",POSRVC
"RTN","VAFCPDT2",99,0)
 W !,"POW STATUS INDICATED?",?31,": ",POW
"RTN","VAFCPDT2",100,0)
 ;
"RTN","VAFCPDT2",101,0)
 ;Military Service Data multiple
"RTN","VAFCPDT2",102,0)
 I $O(^DPT(DFN,.3216,0)) D
"RTN","VAFCPDT2",103,0)
 .W !,"MILITARY SERVICE (multiple):"
"RTN","VAFCPDT2",104,0)
 .W !,"Service Branch   Service #   Entry DT       Separation DT"
"RTN","VAFCPDT2",105,0)
 .W !,"---------------------------------------------------------"
"RTN","VAFCPDT2",106,0)
 .K MSDARR
"RTN","VAFCPDT2",107,0)
 .S MSD=0 F  S MSD=$O(^DPT(DFN,.3216,MSD)) Q:'MSD  D
"RTN","VAFCPDT2",108,0)
 ..S NODE=^DPT(DFN,.3216,MSD,0)
"RTN","VAFCPDT2",109,0)
 ..S SRVEDT=$P(NODE,"^"),SRVSDT=$P(NODE,"^",2),SRVNUM=$P(NODE,"^",5),SRVBR=$$GET1^DIQ(23,$P(NODE,"^",3),.01)
"RTN","VAFCPDT2",110,0)
 ..S MSDARR(-SRVEDT)=SRVSDT_"^"_SRVNUM_"^"_SRVBR
"RTN","VAFCPDT2",111,0)
 .S SRVEDT="" F  S SRVEDT=$O(MSDARR(SRVEDT)) Q:'SRVEDT  D
"RTN","VAFCPDT2",112,0)
 ..W !?0,$P(MSDARR(SRVEDT),"^",3),?17,$P(MSDARR(SRVEDT),"^",2),?29,$$FMTE^XLFDT($P(SRVEDT,"-",2)),?44,$$FMTE^XLFDT(+MSDARR(SRVEDT))
"RTN","VAFCPDT2",113,0)
 ;
"RTN","VAFCPDT2",114,0)
 ;ALIAS multiple
"RTN","VAFCPDT2",115,0)
 I $O(^DPT(DFN,.01,0)) D 
"RTN","VAFCPDT2",116,0)
 .W !,"ALIAS (multiple):"
"RTN","VAFCPDT2",117,0)
 .S ALIAS=0 F  S ALIAS=$O(^DPT(DFN,.01,ALIAS)) Q:'ALIAS  W !?3,$E($P(^DPT(DFN,.01,ALIAS,0),"^"),1,30),?35,"SSN: "_$P($G(^DPT(DFN,.01,ALIAS,0)),"^",2)
"RTN","VAFCPDT2",118,0)
 ;
"RTN","VAFCPDT2",119,0)
 ; Preferred Name
"RTN","VAFCPDT2",120,0)
 I $G(DNODE(2,DFN,.2405,"E"))]"" W !,"PREFERRED NAME",?31,": ",DNODE(2,DFN,.2405,"E")
"RTN","VAFCPDT2",121,0)
 ;
"RTN","VAFCPDT2",122,0)
 W !,"DATE ENTERED IN PATIENT FILE",?31,": ",FILEDT
"RTN","VAFCPDT2",123,0)
 ;
"RTN","VAFCPDT2",124,0)
 K ALIAS,XDATA,CHG,CHGNUM,CHGDT,TMSG,TREQ,SITE,STATUS,HIS,HISCMOR,CMORNODE,CHGNODE,RACEMUL,VADM,MSDARR
"RTN","VAFCPDT2",125,0)
 Q
"RTN","VAFCPDT2",126,0)
 ;
"RTN","VAFCPDT2",127,0)
CHISHDR W !!,"CMOR History:",!,"--------------"
"RTN","VAFCPDT2",128,0)
 Q
"RTN","VAFCPDT2",129,0)
CCHGHDR W !!,"CMOR Change Request History:",!,"----------------------------"
"RTN","VAFCPDT2",130,0)
 Q
"RTN","VAFCPTAD")
0^7^B70394677^B69026178
"RTN","VAFCPTAD",1,0)
VAFCPTAD ; ISA/RJS,Zoltan;BIR/PTD,CKN - ADD NEW PATIENT ENTRY ; 8/14/14 6:07pm
"RTN","VAFCPTAD",2,0)
 ;;5.3;Registration;**149,800,876,944**;Aug 13, 1993;Build 2
"RTN","VAFCPTAD",3,0)
 ;
"RTN","VAFCPTAD",4,0)
ADD(RETURN,PARAM) ;Add an entry to the PATIENT (#2) file for VOA
"RTN","VAFCPTAD",5,0)
 ;
"RTN","VAFCPTAD",6,0)
 ;Input
"RTN","VAFCPTAD",7,0)
 ;  PARAM = List of data to be used for the creation of a VistA
"RTN","VAFCPTAD",8,0)
 ;          PATIENT (#2) record at the Preferred Facility.
"RTN","VAFCPTAD",9,0)
 ;  
"RTN","VAFCPTAD",10,0)
 ;Required elements include:
"RTN","VAFCPTAD",11,0)
 ;  PARAM("PRFCLTY")=PREFERRED FACILITY
"RTN","VAFCPTAD",12,0)
 ;  PARAM("NAME")=NAME (last name minimal; recommend full name)
"RTN","VAFCPTAD",13,0)
 ;  PARAM("GENDER")=SEX
"RTN","VAFCPTAD",14,0)
 ;  PARAM("DOB")=DATE OF BIRTH
"RTN","VAFCPTAD",15,0)
 ;  PARAM("SSN")=SOCIAL SECURITY NUMBER OR NULL IF NONE
"RTN","VAFCPTAD",16,0)
 ;  PARAM("SRVCNCTD")=SERVICE CONNECTED?
"RTN","VAFCPTAD",17,0)
 ;  PARAM("TYPE")=TYPE
"RTN","VAFCPTAD",18,0)
 ;  PARAM("VET")=VETERAN (Y/N)?
"RTN","VAFCPTAD",19,0)
 ;  PARAM("FULLICN")=INTEGRATION CONTROL NUMBER AND CHECKSUM
"RTN","VAFCPTAD",20,0)
 ;
"RTN","VAFCPTAD",21,0)
 ;Optional elements include:
"RTN","VAFCPTAD",22,0)
 ;  PARAM("POBCTY")=PLACE OF BIRTH [CITY]
"RTN","VAFCPTAD",23,0)
 ;  PARAM("POBST")=PLACE OF BIRTH [STATE]
"RTN","VAFCPTAD",24,0)
 ;  PARAM("MMN")=MOTHER'S MAIDEN NAME
"RTN","VAFCPTAD",25,0)
 ;  PARAM("MBI")=MULTIPLE BIRTH INDICATOR
"RTN","VAFCPTAD",26,0)
 ;  PARAM("ALIAS",#)=ALIAS NAME(last^first^middle^suffix)^ALIAS SSN
"RTN","VAFCPTAD",27,0)
 ;
"RTN","VAFCPTAD",28,0)
 ;Output:
"RTN","VAFCPTAD",29,0)
 ;  On Failure:  -1^error text - record add failed
"RTN","VAFCPTAD",30,0)
 ;  On Success:   1^DFN of new PATIENT (#2) record
"RTN","VAFCPTAD",31,0)
 ;
"RTN","VAFCPTAD",32,0)
EN1 ;Check value of all required fields
"RTN","VAFCPTAD",33,0)
 N ALSERR,DIERR,DPTIDS,DPTX,ERROR,FLG,FDA,FN,LN,MN,RESULT,RGRSICN,SFX,VAL,VAFCA08,X,Y
"RTN","VAFCPTAD",34,0)
 N VAFCDFN,VAFCDOB,VAFCICN,VAFCMMN,VAFCNAM,VAFCPF,VAFCPOBC,VAFCPOBS
"RTN","VAFCPTAD",35,0)
 N VAFCRSN,VAFCSRV,VAFCSSN,VAFCSUM,VAFCSX,VAFCTYP,VAFCVET,VAFCMBI
"RTN","VAFCPTAD",36,0)
 K RETURN
"RTN","VAFCPTAD",37,0)
 S (RGRSICN,VAFCA08)=1 S FLG=0 ;allow update to ICN; prevent triggering of messages
"RTN","VAFCPTAD",38,0)
 ;
"RTN","VAFCPTAD",39,0)
 ;PREFERRED FACILITY
"RTN","VAFCPTAD",40,0)
 I $G(PARAM("PRFCLTY"))="" S RETURN(1)="-1^PREFERRED FACILITY is a required field." Q
"RTN","VAFCPTAD",41,0)
 I $G(PARAM("PRFCLTY"))'=$P($$SITE^VASITE(),"^",3) S RETURN(1)="-1^PREFERRED FACILITY is not the station to which the RPC was sent." Q
"RTN","VAFCPTAD",42,0)
 I $G(PARAM("PRFCLTY"))'="" S VAL=$G(PARAM("PRFCLTY")) D CHK^DIE(2,27.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",43,0)
 S VAFCPF=VAL,FLG=1
"RTN","VAFCPTAD",44,0)
 ;
"RTN","VAFCPTAD",45,0)
 ;INTEGRATION CONTROL NUMBER and ICN CHECKSUM
"RTN","VAFCPTAD",46,0)
 I $G(PARAM("FULLICN"))="" S RETURN(1)="-1^Full INTEGRATION CONTROL NUMBER with ICN CHECKSUM is required." Q
"RTN","VAFCPTAD",47,0)
 I $G(PARAM("FULLICN"))'["V" S RETURN(1)="-1^Full INTEGRATION CONTROL NUMBER with ICN CHECKSUM is required." Q
"RTN","VAFCPTAD",48,0)
 I $G(PARAM("FULLICN"))'="" D
"RTN","VAFCPTAD",49,0)
 .S PARAM("ICN")=$P(PARAM("FULLICN"),"V")
"RTN","VAFCPTAD",50,0)
 .S PARAM("CHKSUM")=$P(PARAM("FULLICN"),"V",2)
"RTN","VAFCPTAD",51,0)
 I $G(PARAM("ICN"))'="" S VAL=$G(PARAM("ICN")) D CHK^DIE(2,991.01,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",52,0)
 S VAFCICN=VAL,FLG=1
"RTN","VAFCPTAD",53,0)
 I $G(PARAM("CHKSUM"))'="" S VAL=$G(PARAM("CHKSUM")) D CHK^DIE(2,991.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",54,0)
 S VAFCSUM=VAL,FLG=1
"RTN","VAFCPTAD",55,0)
 ;Has patient already been created at this facility?  If so get DFN and quit.
"RTN","VAFCPTAD",56,0)
 I $O(^DPT("AICN",PARAM("ICN"),0)) S RETURN(1)="1^"_$O(^DPT("AICN",PARAM("ICN"),0)) Q
"RTN","VAFCPTAD",57,0)
 ;
"RTN","VAFCPTAD",58,0)
 ;NAME INPUT AS:LAST^FIRST^MIDDLE^SUFFIX; MUST BE FORMATTED FOR VISTA INPUT
"RTN","VAFCPTAD",59,0)
 I $G(PARAM("NAME"))="" S RETURN(1)="-1^Patient NAME is a required field." Q
"RTN","VAFCPTAD",60,0)
 S LN=$P($G(PARAM("NAME")),"^"),FN=$P($G(PARAM("NAME")),"^",2),MN=$P($G(PARAM("NAME")),"^",3),SFX=$P($G(PARAM("NAME")),"^",4)
"RTN","VAFCPTAD",61,0)
 S PARAM("NAME")=LN_","
"RTN","VAFCPTAD",62,0)
 I FN'="" S PARAM("NAME")=PARAM("NAME")_FN
"RTN","VAFCPTAD",63,0)
 I MN'="" S PARAM("NAME")=PARAM("NAME")_" "_MN
"RTN","VAFCPTAD",64,0)
 I SFX'="" S PARAM("NAME")=PARAM("NAME")_" "_SFX
"RTN","VAFCPTAD",65,0)
 I $G(PARAM("NAME"))'="" S VAL=$G(PARAM("NAME")) D CHK^DIE(2,.01,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",66,0)
 S VAFCNAM=VAL,FLG=1
"RTN","VAFCPTAD",67,0)
 S DPTX=VAL ;variable used by SSN input transform
"RTN","VAFCPTAD",68,0)
 ;
"RTN","VAFCPTAD",69,0)
 ;DATE OF BIRTH
"RTN","VAFCPTAD",70,0)
 I $G(PARAM("DOB"))="" S RETURN(1)="-1^DATE OF BIRTH is a required field." Q
"RTN","VAFCPTAD",71,0)
 I $G(PARAM("DOB"))'="" S VAL=$G(PARAM("DOB")) D CHK^DIE(2,.03,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",72,0)
 S VAFCDOB=VAL,FLG=1
"RTN","VAFCPTAD",73,0)
 S DPTIDS(.03)=RESULT ;variable used by PSEUDO-SSN code
"RTN","VAFCPTAD",74,0)
 ;
"RTN","VAFCPTAD",75,0)
 ;SOCIAL SECURITY NUMBER not equal null; valid 9-digit number
"RTN","VAFCPTAD",76,0)
 I '$D(PARAM("SSN")) S RETURN(1)="-1^SOCIAL SECURITY NUMBER is a required field.  A null value may be sent." Q
"RTN","VAFCPTAD",77,0)
 I $G(PARAM("SSN"))'="" S VAL=$G(PARAM("SSN")) D CHK^DIE(2,.09,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",78,0)
 I $G(PARAM("SSN"))'="" S VAFCSSN=VAL,FLG=1
"RTN","VAFCPTAD",79,0)
 I $G(PARAM("SSN"))="" D  ;SSN null, set PSEUDO SSN REASON=SSN UNKNOWN/FOLLOW-UP
"RTN","VAFCPTAD",80,0)
 .S PARAM("SSN")="P" ;PSEUDO SSN
"RTN","VAFCPTAD",81,0)
 .S PARAM("PSEUDO")="S" ;PSEUDO SSN REASON
"RTN","VAFCPTAD",82,0)
 .S VAFCSSN=$G(PARAM("SSN")),FLG=1
"RTN","VAFCPTAD",83,0)
 .;If SSN null, set PSEUDO SSN REASON (#.0906) =SSN UNKNOWN/FOLLOW-UP
"RTN","VAFCPTAD",84,0)
 .S VAFCRSN=$G(PARAM("PSEUDO")),FLG=1
"RTN","VAFCPTAD",85,0)
 ;
"RTN","VAFCPTAD",86,0)
 ;SEX
"RTN","VAFCPTAD",87,0)
 I $G(PARAM("GENDER"))="" S RETURN(1)="-1^GENDER is a required field." Q
"RTN","VAFCPTAD",88,0)
 I $G(PARAM("GENDER"))'="" S VAL=$G(PARAM("GENDER")) D CHK^DIE(2,.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",89,0)
 S VAFCSX=VAL,FLG=1
"RTN","VAFCPTAD",90,0)
 ;
"RTN","VAFCPTAD",91,0)
 ;SERVICE CONNECTED?
"RTN","VAFCPTAD",92,0)
 I $G(PARAM("SRVCNCTD"))="" S RETURN(1)="-1^'SERVICE CONNECTED?' is a required field." Q
"RTN","VAFCPTAD",93,0)
 ;input set to either YES or NO on the MPI before RPC call; skip CHK^DIE
"RTN","VAFCPTAD",94,0)
 ;here as it resulted in error; expected DFN variable which is not yet set.
"RTN","VAFCPTAD",95,0)
 I $G(PARAM("SRVCNCTD"))'="" S VAFCSRV=$G(PARAM("SRVCNCTD"))
"RTN","VAFCPTAD",96,0)
 ;
"RTN","VAFCPTAD",97,0)
 ;TYPE
"RTN","VAFCPTAD",98,0)
 I $G(PARAM("TYPE"))="" S RETURN(1)="-1^Patient TYPE is a required field." Q
"RTN","VAFCPTAD",99,0)
 I $G(PARAM("TYPE"))'="" S VAL=$G(PARAM("TYPE")) D CHK^DIE(2,391,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",100,0)
 S VAFCTYP=VAL,FLG=1
"RTN","VAFCPTAD",101,0)
 ;
"RTN","VAFCPTAD",102,0)
 ;VETERAN Y/N?
"RTN","VAFCPTAD",103,0)
 I $G(PARAM("VET"))="" S RETURN(1)="-1^'VETERAN Y/N?' is a required field." Q
"RTN","VAFCPTAD",104,0)
 ;input set to either YES or NO on the MPI before RPC call; skip CHK^DIE
"RTN","VAFCPTAD",105,0)
 ;here as it resulted in error; expected DFN variable which is not yet set.
"RTN","VAFCPTAD",106,0)
 I $G(PARAM("VET"))'="" S VAFCVET=$E($G(PARAM("VET")),1),FLG=1 ;internal format
"RTN","VAFCPTAD",107,0)
 ;
"RTN","VAFCPTAD",108,0)
 ;Optional - POB CITY
"RTN","VAFCPTAD",109,0)
 I $D(PARAM("POBCTY")) S VAL=$G(PARAM("POBCTY")) D CHK^DIE(2,.092,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",110,0)
 I $D(PARAM("POBCTY")) S VAFCPOBC=VAL,FLG=1
"RTN","VAFCPTAD",111,0)
 ;
"RTN","VAFCPTAD",112,0)
 ;Optional - POB STATE
"RTN","VAFCPTAD",113,0)
 N STIEN,UNDEF S UNDEF=0
"RTN","VAFCPTAD",114,0)
 I $D(PARAM("POBST")) D  I UNDEF S RETURN(1)="-1^The value passed for PLACE OF BIRTH [STATE], "_PARAM("POBST")_", is not a valid STATE (#5) file entry." Q
"RTN","VAFCPTAD",115,0)
 .;Convert STATE ABBREVIATION into STATE NAME
"RTN","VAFCPTAD",116,0)
 .S STIEN=$O(^DIC(5,"C",PARAM("POBST"),0))
"RTN","VAFCPTAD",117,0)
 .I STIEN="" S UNDEF=1 Q
"RTN","VAFCPTAD",118,0)
 .I STIEN'="" S PARAM("POBST")=$P($G(^DIC(5,STIEN,0)),"^")
"RTN","VAFCPTAD",119,0)
 .S VAL=$G(PARAM("POBST"))
"RTN","VAFCPTAD",120,0)
 .D CHK^DIE(2,.093,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",121,0)
 .S VAFCPOBS=VAL,FLG=1
"RTN","VAFCPTAD",122,0)
 ;
"RTN","VAFCPTAD",123,0)
 ;Optional - MOTHER'S MAIDEN NAME
"RTN","VAFCPTAD",124,0)
 I $D(PARAM("MMN")) S VAL=$G(PARAM("MMN")) D CHK^DIE(2,.2403,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",125,0)
 I $D(PARAM("MMN")) S VAFCMMN=VAL,FLG=1
"RTN","VAFCPTAD",126,0)
 ;
"RTN","VAFCPTAD",127,0)
 ;**876 - MVI_2788 (ckn) - Add MBI
"RTN","VAFCPTAD",128,0)
 ;Optional - MULTIPLE BIRTH INDICATOR
"RTN","VAFCPTAD",129,0)
 I $D(PARAM("MBI")) S VAL=$G(PARAM("MBI")) D CHK^DIE(2,994,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",130,0)
 I $G(PARAM("MBI"))'="" S VAFCMBI=VAL,FLG=1
"RTN","VAFCPTAD",131,0)
 ;
"RTN","VAFCPTAD",132,0)
 I FLG=0 S RETURN(1)="-1^Required information is missing; please check input and try again." Q
"RTN","VAFCPTAD",133,0)
 ;Else ok to file entry
"RTN","VAFCPTAD",134,0)
FILE ;Call FILE^DICN to add new entry to PATIENT (#2) file
"RTN","VAFCPTAD",135,0)
 N DA,DIC,DR,FULLICN K DD,DO
"RTN","VAFCPTAD",136,0)
 S DIC="^DPT(",DIC(0)="FLZ",DLAYGO=2,X=VAFCNAM
"RTN","VAFCPTAD",137,0)
 ;**876 MVI_2788 (ckn) - Remove four slash use for field 1901
"RTN","VAFCPTAD",138,0)
 ;**944 Story #557843 (cml) add code to update FULL ICN (#991.1), WHO ENTERED PATIENT (#.096), and DATE ENTERED INTO FILE (#.097) fields
"RTN","VAFCPTAD",139,0)
 S FULLICN=VAFCICN_"V"_VAFCSUM
"RTN","VAFCPTAD",140,0)
 S DIC("DR")=".09///"_VAFCSSN_";.03///"_VAFCDOB_";.02///"_VAFCSX_";391///"_VAFCTYP_";1901///"_VAFCVET_";.301///"_VAFCSRV_";991.01///"_VAFCICN_";991.02///"_VAFCSUM_";991.1///"_FULLICN_";.097///"_DT_";.096///"_$G(DUZ)
"RTN","VAFCPTAD",141,0)
 I VAFCSSN="P" S DIC("DR")=DIC("DR")_";.0906///"_VAFCRSN
"RTN","VAFCPTAD",142,0)
 I $G(VAFCPOBC)'="" S DIC("DR")=DIC("DR")_";.092///"_VAFCPOBC
"RTN","VAFCPTAD",143,0)
 I $G(VAFCPOBS)'="" S DIC("DR")=DIC("DR")_";.093///"_VAFCPOBS
"RTN","VAFCPTAD",144,0)
 I $G(VAFCMMN)'="" S DIC("DR")=DIC("DR")_";.2403///"_VAFCMMN
"RTN","VAFCPTAD",145,0)
 ;**876 - MVI_2788 (ckn)
"RTN","VAFCPTAD",146,0)
 I $G(VAFCMBI)'="" S DIC("DR")=DIC("DR")_";994///"_VAFCMBI
"RTN","VAFCPTAD",147,0)
 L +^DPT(0):10
"RTN","VAFCPTAD",148,0)
 D FILE^DICN K DA,DIC,DD,DLAYGO,DO,DR
"RTN","VAFCPTAD",149,0)
 L -^DPT(0)
"RTN","VAFCPTAD",150,0)
 ;If record creation/update fails, return a -1^error text
"RTN","VAFCPTAD",151,0)
 I $P(Y,U,3)'=1 S RETURN(1)="-1^"_"Attempt to add patient "_VAFCNAM_" to the PATIENT (#2) file at station number "_$P($$SITE^VASITE,"^",3)_" failed." Q
"RTN","VAFCPTAD",152,0)
 S VAFCDFN=+Y
"RTN","VAFCPTAD",153,0)
 ;
"RTN","VAFCPTAD",154,0)
 ;File ALIAS multiple
"RTN","VAFCPTAD",155,0)
 I $D(PARAM("ALIAS")) D ALIAS  ;If ALIAS data is passed, call ALIAS module
"RTN","VAFCPTAD",156,0)
 I $G(ALSERR)="" S RETURN(1)="1^"_VAFCDFN  ;No errors for ALIAS, return DFN
"RTN","VAFCPTAD",157,0)
 I $G(ALSERR)'="" S RETURN(1)=ALSERR
"RTN","VAFCPTAD",158,0)
 Q
"RTN","VAFCPTAD",159,0)
 ;
"RTN","VAFCPTAD",160,0)
 ;
"RTN","VAFCPTAD",161,0)
ALIAS ;Optional - Add ALIAS and ALIAS SSN data for entry
"RTN","VAFCPTAD",162,0)
 ;Only occurs for a NEW record; there is no previous ALIAS data
"RTN","VAFCPTAD",163,0)
 I '$D(PARAM("ALIAS")) Q
"RTN","VAFCPTAD",164,0)
 ;ALIAS input comes in as: LAST^FIRST^MIDDLE^SUFFIX^SSN
"RTN","VAFCPTAD",165,0)
 N AFN,ALN,AMN,ASFX,ASSN,ERR,FDA,I,LOC,NUM
"RTN","VAFCPTAD",166,0)
 S (I,NUM)=0 F  S NUM=$O(PARAM("ALIAS",NUM)) Q:'NUM  D
"RTN","VAFCPTAD",167,0)
 .S ALN=$P($G(PARAM("ALIAS",NUM)),"^") Q:ALN=""  ;Last name minimal input
"RTN","VAFCPTAD",168,0)
 .S AFN=$P($G(PARAM("ALIAS",NUM)),"^",2)
"RTN","VAFCPTAD",169,0)
 .S AMN=$P($G(PARAM("ALIAS",NUM)),"^",3)
"RTN","VAFCPTAD",170,0)
 .S ASFX=$P($G(PARAM("ALIAS",NUM)),"^",4)
"RTN","VAFCPTAD",171,0)
 .S ASSN=$P($G(PARAM("ALIAS",NUM)),"^",5)
"RTN","VAFCPTAD",172,0)
 .;Change format for VistA input: LAST,FIRST MIDDLE SUFFIX^SSN
"RTN","VAFCPTAD",173,0)
 .S LOC(NUM)=ALN_","
"RTN","VAFCPTAD",174,0)
 .I AFN'="" S LOC(NUM)=LOC(NUM)_AFN
"RTN","VAFCPTAD",175,0)
 .I AMN'="" S LOC(NUM)=LOC(NUM)_" "_AMN
"RTN","VAFCPTAD",176,0)
 .I ASFX'="" S LOC(NUM)=LOC(NUM)_" "_ASFX
"RTN","VAFCPTAD",177,0)
 .S LOC(NUM)=LOC(NUM)_"^"
"RTN","VAFCPTAD",178,0)
 .I ASSN'="" S LOC(NUM)=LOC(NUM)_ASSN
"RTN","VAFCPTAD",179,0)
 .;Set FDA nodes
"RTN","VAFCPTAD",180,0)
 .S I=I+1 ;Unique sequence number for add to ALIAS SUB-FILE (#2.01
"RTN","VAFCPTAD",181,0)
 .S FDA(2.01,"+"_I_","_VAFCDFN_",",.01)=$P(LOC(NUM),"^") ; (#.01) ALIAS (name)
"RTN","VAFCPTAD",182,0)
 .I ASSN'="" S FDA(2.01,"+"_I_","_VAFCDFN_",",1)=$P(LOC(NUM),"^",2) ; (#1) ALIAS SSN
"RTN","VAFCPTAD",183,0)
 ;Update ALIAS multiple with new entries
"RTN","VAFCPTAD",184,0)
 I $D(FDA) D  ;We have ALIAS data to add
"RTN","VAFCPTAD",185,0)
 .S ALSERR=""
"RTN","VAFCPTAD",186,0)
 .L +^DPT(VAFCDFN):10
"RTN","VAFCPTAD",187,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","VAFCPTAD",188,0)
 .L -^DPT(VAFCDFN)
"RTN","VAFCPTAD",189,0)
 .I $D(ERR("DIERR")) S ALSERR="1^"_VAFCDFN_"^Patient "_PARAM("NAME")_" was successfully added at "_$P($$SITE^VASITE,"^",3)_".  However, the ALIAS data failed to update. Error message: "_$G(ERR("DIERR","1","TEXT",1)) Q
"RTN","VAFCPTAD",190,0)
 Q
"RTN","VAFCPTAD",191,0)
 ;
"RTN","VAFCQRY3")
0^3^B63911334^B59042687
"RTN","VAFCQRY3",1,0)
VAFCQRY3 ;BIR/CMC,CKN-CONT TO BLD PID 2.4 SEGMENT ; 8/21/09 4:45pm
"RTN","VAFCQRY3",2,0)
 ;;5.3;Registration;**575,707,754,944**;Aug 13, 1993;Build 2
"RTN","VAFCQRY3",3,0)
 ;
"RTN","VAFCQRY3",4,0)
CONT(DFN,APID,PID,HL,HLES,SARY,SEQ,ERROR,REP,COMP,SSN,VAFCMN) ; continue to bld pid segment
"RTN","VAFCQRY3",5,0)
ADDR ;had to split routine
"RTN","VAFCQRY3",6,0)
 I $D(SARY(11))!(SEQ="ALL") S APID(12)="" D
"RTN","VAFCQRY3",7,0)
 .I $D(^DPT(DFN,0)) D
"RTN","VAFCQRY3",8,0)
 ..;address info
"RTN","VAFCQRY3",9,0)
 ..N COUNTY K HL7STRG
"RTN","VAFCQRY3",10,0)
 ..S HL7STRG=$$GET1^DIQ(2,DFN_",",.111) D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES)
"RTN","VAFCQRY3",11,0)
 ..S $P(APID(12),COMP)=HL7STRG I $P(APID(12),COMP)="" S $P(APID(12),COMP)=HL("Q") K HL7STRG
"RTN","VAFCQRY3",12,0)
 ..K HL7STRG S HL7STRG=$$GET1^DIQ(2,DFN_",",.112) D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) ;**707 add HL7TXT call
"RTN","VAFCQRY3",13,0)
 ..S $P(APID(12),COMP,2)=HL7STRG I $P(APID(12),COMP,2)="" S $P(APID(12),COMP,2)=HL("Q")
"RTN","VAFCQRY3",14,0)
 ..K HL7STRG S HL7STRG=$$GET1^DIQ(2,DFN_",",.113) D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) ;**707 add HL7TXT call
"RTN","VAFCQRY3",15,0)
 ..S $P(APID(12),COMP,8)=HL7STRG I $P(APID(12),COMP,8)="" S $P(APID(12),COMP,8)=HL("Q")
"RTN","VAFCQRY3",16,0)
 ..K HL7STRG
"RTN","VAFCQRY3",17,0)
 ..; **707 changes to include foreign address
"RTN","VAFCQRY3",18,0)
 ..N CNTRY S CNTRY=$$GET1^DIQ(2,DFN_",",.1173) ;RETURN EXTERNAL VALUE from country code file #779.004 field .01
"RTN","VAFCQRY3",19,0)
 ..I CNTRY="US" S CNTRY="USA"
"RTN","VAFCQRY3",20,0)
 ..S HL7STRG=$$GET1^DIQ(2,DFN_",",.114) D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S $P(APID(12),COMP,3)=HL7STRG  I $P(APID(12),COMP,3)="" S $P(APID(12),COMP,3)=HL("Q")
"RTN","VAFCQRY3",21,0)
 ..I CNTRY=""!(CNTRY="USA") D
"RTN","VAFCQRY3",22,0)
 ...;have USA address
"RTN","VAFCQRY3",23,0)
 ...S STATEIEN=$$GET1^DIQ(2,DFN_",",.115,"I") S $P(APID(12),COMP,4)=$$GET1^DIQ(5,+STATEIEN_",",1)
"RTN","VAFCQRY3",24,0)
 ...I $P(APID(12),COMP,4)="" S $P(APID(12),COMP,4)=HL("Q")
"RTN","VAFCQRY3",25,0)
 ...S $P(APID(12),COMP,5)=$$GET1^DIQ(2,DFN_",",.1112) I $P(APID(12),COMP,5)="" S $P(APID(12),COMP,5)=HL("Q")
"RTN","VAFCQRY3",26,0)
 ...S $P(APID(12),COMP,6)=CNTRY I CNTRY="" S $P(APID(12),COMP,6)=HL("Q") ;country
"RTN","VAFCQRY3",27,0)
 ..I CNTRY'="",(CNTRY'="USA") D
"RTN","VAFCQRY3",28,0)
 ...;Check for foreign address fields
"RTN","VAFCQRY3",29,0)
 ...S $P(APID(12),COMP,4)=$P($G(^DPT(DFN,.11)),"^",8) I $P(APID(12),COMP,4)="" S $P(APID(12),COMP,4)=HL("Q") ;province
"RTN","VAFCQRY3",30,0)
 ...S $P(APID(12),COMP,5)=$P($G(^DPT(DFN,.11)),"^",9) I $P(APID(12),COMP,5)="" S $P(APID(12),COMP,5)=HL("Q") ;postal code
"RTN","VAFCQRY3",31,0)
 ...S $P(APID(12),COMP,6)=CNTRY I CNTRY="" S $P(APID(12),COMP,6)=HL("Q") ;COUNTRY
"RTN","VAFCQRY3",32,0)
 ...; ***707 end of code
"RTN","VAFCQRY3",33,0)
 ..S $P(APID(12),COMP,7)="P"
"RTN","VAFCQRY3",34,0)
BADADDR ..;BAD ADDRESS INDICATOR (if present overwrite the "P" ermanent type with the Bad Address type
"RTN","VAFCQRY3",35,0)
 ..I $D(^DPT(DFN,.11)) N BADADR S BADADR=$P(^DPT(DFN,.11),"^",16) I BADADR'="" S $P(APID(12),COMP,7)="VAB"_BADADR
"RTN","VAFCQRY3",36,0)
 ..S COUNTY=$$GET1^DIQ(2,DFN_",",.117) I COUNTY="" S COUNTY=HL("Q") ;**648 add COUNTY Code to PID-11, retained in PID-12 also
"RTN","VAFCQRY3",37,0)
 ..S $P(APID(12),COMP,9)=COUNTY ;county code
"RTN","VAFCQRY3",38,0)
 ..;place of birth information
"RTN","VAFCQRY3",39,0)
 ..S CITY=$$GET1^DIQ(2,DFN_",",.092) S HL7STRG=CITY D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S CITY=HL7STRG D
"RTN","VAFCQRY3",40,0)
 ...N X,POBPROV,POBCONT
"RTN","VAFCQRY3",41,0)
 ...I $G(CITY)'="" S $P(X,COMP,3)=CITY
"RTN","VAFCQRY3",42,0)
 ...I $G(CITY)="" S $P(X,COMP,3)=HL("Q")
"RTN","VAFCQRY3",43,0)
 ...; Story 513045 (elz) use pob provence if it's there vs state
"RTN","VAFCQRY3",44,0)
 ...S STATEIEN=$$GET1^DIQ(2,DFN_",",.093,"I"),STATE=$$GET1^DIQ(5,+STATEIEN_",",1),POBPROV=$$GET1^DIQ(2,DFN_",",.0932,"E") D
"RTN","VAFCQRY3",45,0)
 ....I $L(POBPROV) S HL7STRG=POBPROV D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S $P(X,COMP,4)=HL7STRG
"RTN","VAFCQRY3",46,0)
 ....I $G(STATE)'="",'$L(POBPROV) S $P(X,COMP,4)=STATE
"RTN","VAFCQRY3",47,0)
 ....I $G(STATE)="",'$L(POBPROV) S $P(X,COMP,4)=HL("Q")
"RTN","VAFCQRY3",48,0)
 ...; Story 513045 (elz) include pob country
"RTN","VAFCQRY3",49,0)
 ...S POBCONT=$$GET1^DIQ(2,DFN_",",.0931) D
"RTN","VAFCQRY3",50,0)
 ....I POBCONT="US" S POBCONT="USA"
"RTN","VAFCQRY3",51,0)
 ....I POBCONT'="" S $P(X,COMP,6)=POBCONT
"RTN","VAFCQRY3",52,0)
 ....I POBCONT="" S $P(X,COMP,6)=HL("Q")
"RTN","VAFCQRY3",53,0)
 ... S $P(X,COMP,7)="N",APID(12)=$G(APID(12))_REP_X
"RTN","VAFCQRY3",54,0)
CONF .;CONFIDENTIAL ADDRESS
"RTN","VAFCQRY3",55,0)
 .I $D(^DPT(DFN,.141)) N CNFADD S CNFADD=$$GET1^DIQ(2,DFN_",",.14105) D
"RTN","VAFCQRY3",56,0)
 ..N LINE1,LINE2,LINE3,STATEIEN,STATE,CNTRY,ZIP,LVL,LNGTH,NXT,CNFEND,CNFSTRT,SUBCOMP,CNTY,CITY
"RTN","VAFCQRY3",57,0)
 ..S SUBCOMP=$E(HL("ECH"),4)
"RTN","VAFCQRY3",58,0)
 ..S LINE1=$$GET1^DIQ(2,DFN_",",.1411) S HL7STRG=LINE1 D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S LINE1=HL7STRG
"RTN","VAFCQRY3",59,0)
 ..S LINE2=$$GET1^DIQ(2,DFN_",",.1412) S HL7STRG=LINE2 D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S LINE2=HL7STRG
"RTN","VAFCQRY3",60,0)
 ..S LINE3=$$GET1^DIQ(2,DFN_",",.1413) S HL7STRG=LINE3 D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S LINE3=HL7STRG
"RTN","VAFCQRY3",61,0)
 ..S CNFSTRT=$$FMTHL7^XLFDT($$GET1^DIQ(2,DFN_",",.1417,"I")),CNFEND=$$FMTHL7^XLFDT($$GET1^DIQ(2,DFN_",",.1418,"I"))
"RTN","VAFCQRY3",62,0)
 ..S CITY=$$GET1^DIQ(2,DFN_",",.1414) S HL7STRG=CITY D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S CITY=HL7STRG
"RTN","VAFCQRY3",63,0)
 ..S CNTRY=$$GET1^DIQ(2,DFN_",",.14116)
"RTN","VAFCQRY3",64,0)
 ..;if foriegn address
"RTN","VAFCQRY3",65,0)
 ..I CNTRY=""!(CNTRY="USA")!(CNTRY="US") S:CNTRY="US" CNTRY="USA" S STATEIEN=$$GET1^DIQ(2,DFN_",",.1415,"I") S STATE=$$GET1^DIQ(5,+STATEIEN_",",1),CNTY=$$GET1^DIQ(2,DFN_",",.14111),ZIP=$$GET1^DIQ(2,DFN_",",.1416)
"RTN","VAFCQRY3",66,0)
 ..E  S STATE=$$GET1^DIQ(2,DFN_",",.14114),ZIP=$$GET1^DIQ(2,DFN_",",.14115)  ;if USA address or null assume USA address
"RTN","VAFCQRY3",67,0)
 ..S LVL=0,LNGTH=$L(APID(12))
"RTN","VAFCQRY3",68,0)
 ..I $D(^DPT(DFN,.14,0)) N CNFTYP S CNFTYP=0 F  S CNFTYP=$O(^DPT(DFN,.14,CNFTYP)) Q:'CNFTYP  N CNFTYPA S CNFTYPA=$P(^DPT(DFN,.14,CNFTYP,0),"^",2) I CNFTYPA="Y" S CNFTYPA=$P(^DPT(DFN,.14,CNFTYP,0),"^") D
"RTN","VAFCQRY3",69,0)
 ...S NXT=""
"RTN","VAFCQRY3",70,0)
 ...S $P(NXT,COMP)=$S(LINE1'="":LINE1,1:HL("Q"))
"RTN","VAFCQRY3",71,0)
 ...S $P(NXT,COMP,2)=$S(LINE2'="":LINE2,1:HL("Q"))
"RTN","VAFCQRY3",72,0)
 ...S $P(NXT,COMP,8)=$S(LINE3'="":LINE3,1:HL("Q"))
"RTN","VAFCQRY3",73,0)
 ...S $P(NXT,COMP,3)=$S(CITY'="":CITY,1:HL("Q"))
"RTN","VAFCQRY3",74,0)
 ...S $P(NXT,COMP,4)=$S($G(STATE)'="":STATE,1:HL("Q"))
"RTN","VAFCQRY3",75,0)
 ...S $P(NXT,COMP,5)=$S(ZIP'="":ZIP,1:HL("Q"))
"RTN","VAFCQRY3",76,0)
 ...S $P(NXT,COMP,6)=$S(CNTRY'="":CNTRY,1:HL("Q"))
"RTN","VAFCQRY3",77,0)
 ...S $P(NXT,COMP,7)=$S(CNFTYPA=1:"VACAE",CNFTYPA=2:"VACAA",CNFTYPA=3:"VACAC",CNFTYPA=4:"VACAM",CNFTYPA=5:"VACAO",1:HL("Q"))
"RTN","VAFCQRY3",78,0)
 ...S $P(NXT,COMP,9)=$S($G(CNTY)'="":CNTY,1:HL("Q"))
"RTN","VAFCQRY3",79,0)
 ...S $P(NXT,COMP,12)=CNFSTRT_SUBCOMP_CNFEND
"RTN","VAFCQRY3",80,0)
 ...S NXT=REP_NXT
"RTN","VAFCQRY3",81,0)
 ...I LVL=0 D
"RTN","VAFCQRY3",82,0)
 ....I $L(APID(12)_NXT)'>244 S APID(12)=APID(12)_NXT Q
"RTN","VAFCQRY3",83,0)
 ....I $L(APID(12)_NXT)>244 S LVL=1 S LNGTH=244-$L(APID(12)),APID(12)=APID(12)_$E(NXT,1,LNGTH) S LNGTH=LNGTH+1,NXT=$E(NXT,LNGTH,$L(NXT))
"RTN","VAFCQRY3",84,0)
 ...I LVL>0 D
"RTN","VAFCQRY3",85,0)
 ....I $L($G(APID(12,LVL))_NXT)'>245 S APID(12,LVL)=$G(APID(12,LVL))_NXT Q
"RTN","VAFCQRY3",86,0)
 ....I $L($G(APID(12,LVL))_NXT)>245 S LNGTH=244-$L(APID(12,LVL)),APID(12,LVL)=APID(12,LVL)_$E(NXT,1,LNGTH) S LNGTH=LNGTH+1,NXT=$E(NXT,LNGTH,$L(NXT)) S LVL=LVL+1 S APID(12,LVL)=NXT
"RTN","VAFCQRY3",87,0)
 I $D(SARY(12))!(SEQ="ALL") S APID(13)=$$GET1^DIQ(2,DFN_",",.117) I APID(13)="" S APID(13)=HL("Q")  ;county code **648 backwards compatibility only
"RTN","VAFCQRY3",88,0)
PHONE I $D(SARY(13))!($D(SARY(14)))!(SEQ="ALL") D
"RTN","VAFCQRY3",89,0)
 .;**707 change PID-13 to have home and work phones, cell, pager and e-mail address with the components ; **754 add confidential phone number to PID-13
"RTN","VAFCQRY3",90,0)
 .N PHONEN,HNUM,WNUM,EMAIL,CELL,PAGER,CONFNUM ;**754
"RTN","VAFCQRY3",91,0)
 .S PHONEN=$G(^DPT(DFN,.13))
"RTN","VAFCQRY3",92,0)
 .; **707 change to ensure that null doesn't end up for any of these fields cmc 12/7/06
"RTN","VAFCQRY3",93,0)
 .S HNUM=$P(PHONEN,"^") I HNUM'="" S HNUM=$$HLPHONE^HLFNC(HNUM) I HNUM'="" S HL7STRG=HNUM D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S HNUM=HL7STRG_COMP_"PRN"_COMP_"PH"
"RTN","VAFCQRY3",94,0)
 .S WNUM=$P(PHONEN,"^",2) I WNUM'="" S WNUM=$$HLPHONE^HLFNC(WNUM) I WNUM'="" S HL7STRG=WNUM D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S WNUM=HL7STRG_COMP_"WPN"_COMP_"PH"
"RTN","VAFCQRY3",95,0)
 .S CELL=$P(PHONEN,"^",4) I CELL'="" S CELL=$$HLPHONE^HLFNC(CELL) I CELL'="" S HL7STRG=CELL D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S CELL=HL7STRG_COMP_"ORN"_COMP_"CP"
"RTN","VAFCQRY3",96,0)
 .S PAGER=$P(PHONEN,"^",5) I PAGER'="" S PAGER=$$HLPHONE^HLFNC(PAGER) I PAGER'="" S HL7STRG=PAGER D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S PAGER=HL7STRG_COMP_"BPN"_COMP_"BP"
"RTN","VAFCQRY3",97,0)
 .S EMAIL=$P(PHONEN,"^",3) I EMAIL'="" S HL7STRG=EMAIL D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S EMAIL=COMP_"NET"_COMP_"INTERNET"_COMP_HL7STRG
"RTN","VAFCQRY3",98,0)
 .S CONFNUM=$P(PHONEN,"^",15) I CONFNUM'="" S CONFNUM=$$HLPHONE^HLFNC(CONFNUM) I CONFNUM'="" S HL7STRG=CONFNUM D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S CONFNUM=HL7STRG_COMP_"VACPN"_COMP_"PH" ;**574
"RTN","VAFCQRY3",99,0)
 .I HNUM'="" S APID(14)=HNUM
"RTN","VAFCQRY3",100,0)
 .I WNUM'="",APID(14)'="" S APID(14)=APID(14)_REP_WNUM
"RTN","VAFCQRY3",101,0)
 .I WNUM'="",APID(14)="" S APID(14)=WNUM
"RTN","VAFCQRY3",102,0)
 .I CELL'="",APID(14)'="" S APID(14)=APID(14)_REP_CELL
"RTN","VAFCQRY3",103,0)
 .I CELL'="",APID(14)="" S APID(14)=CELL
"RTN","VAFCQRY3",104,0)
 .I PAGER'="",APID(14)'="" S APID(14)=APID(14)_REP_PAGER
"RTN","VAFCQRY3",105,0)
 .I PAGER'="",APID(14)="" S APID(14)=PAGER
"RTN","VAFCQRY3",106,0)
 .I EMAIL'="",APID(14)'="" S APID(14)=APID(14)_REP_EMAIL
"RTN","VAFCQRY3",107,0)
 .I EMAIL'="",APID(14)="" S APID(14)=EMAIL
"RTN","VAFCQRY3",108,0)
 .I CONFNUM'="",APID(14)'="" S APID(14)=APID(14)_REP_CONFNUM ;**754
"RTN","VAFCQRY3",109,0)
 .I CONFNUM'="",APID(14)="" S APID(14)=CONFNUM ;**754
"RTN","VAFCQRY3",110,0)
 .I APID(14)="" S APID(14)=HL("Q")
"RTN","VAFCQRY3",111,0)
 I $D(SARY(14))!(SEQ="ALL") N WNUM S WNUM=$P($G(^DPT(DFN,.13)),"^",2) S WNUM=$$HLPHONE^HLFNC(WNUM) S HL7STRG=WNUM D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S APID(15)=HL7STRG I APID(15)="" S APID(15)=HL("Q")
"RTN","VAFCQRY3",112,0)
 ;**707 keep work# in PID-14 for backwards compatability but should use PID-13 to get work#
"RTN","VAFCQRY3",113,0)
 I $D(SARY(19))!(SEQ="ALL") S APID(20)=SSN  ;ssn passed in PID-3
"RTN","VAFCQRY3",114,0)
 I $D(SARY(23))!(SEQ="ALL") D
"RTN","VAFCQRY3",115,0)
 .S CITY=$$GET1^DIQ(2,DFN_",",.092) S HL7STRG=CITY D HL7TXT^VAFCQRY1(.HL7STRG,.HL,HLES) S CITY=HL7STRG
"RTN","VAFCQRY3",116,0)
 .S STATEIEN=$$GET1^DIQ(2,DFN_",",.093,"I") S STATE=$$GET1^DIQ(5,+STATEIEN_",",1) D
"RTN","VAFCQRY3",117,0)
 .I CITY'=""&(STATE'="") S APID(24)=CITY_" "_STATE  ;place of birth (not used) use PID-11 with an 'N' instead
"RTN","VAFCQRY3",118,0)
 .I CITY=""&(STATE="") S APID(24)=HL("Q")
"RTN","VAFCQRY3",119,0)
 D CONT^VAFCQRY4(DFN,.APID,.PID,.HL,HLES,.SARY,SEQ,.ERROR,REP,COMP)
"RTN","VAFCQRY3",120,0)
 ;**707 had to break routine
"RTN","VAFCQRY3",121,0)
 Q
"RTN","VAFCTR")
0^1^B5564926^B5086343
"RTN","VAFCTR",1,0)
VAFCTR ;BIR/CMC,ERC,PTD-Monitoring fields for MPI/PD via DG field monitoring ; 1/31/17 11:04am
"RTN","VAFCTR",2,0)
 ;;5.3;Registration;**575,648,653,712,876,902,926,937,944**;Aug 13, 1993;Build 2
"RTN","VAFCTR",3,0)
 Q  ; quit if called from the top
"RTN","VAFCTR",4,0)
 ;
"RTN","VAFCTR",5,0)
MPIPD ; protocol entry point for monitoring fields via DG field monitoring
"RTN","VAFCTR",6,0)
 ; Currently monitoring for fields:
"RTN","VAFCTR",7,0)
 ; 1 ALIAS - .01 of the multiple
"RTN","VAFCTR",8,0)
 ; 2 RACE INFORMATION - .01 of the multiple
"RTN","VAFCTR",9,0)
 ; 6 ETHNICITY INFORMATION - .01 of the multiple
"RTN","VAFCTR",10,0)
 ; 994 MULTIPLE BIRTH INDICATOR
"RTN","VAFCTR",11,0)
 ; .525 POW STAUTS INDICATED?
"RTN","VAFCTR",12,0)
 ; .0906 PSEUDO SSN REASON
"RTN","VAFCTR",13,0)
 ; .121 BAD ADDRESS INDICATOR
"RTN","VAFCTR",14,0)
 ; .133 EMAIL ADDRESS
"RTN","VAFCTR",15,0)
 ; .134 PHONE NUMBER [CELLULAR]
"RTN","VAFCTR",16,0)
 ; .024 SELF IDENTIFIED GENDER **876
"RTN","VAFCTR",17,0)
 ; 391 TYPE ;**876
"RTN","VAFCTR",18,0)
 ; 1901 VETERAN Y/N? **876
"RTN","VAFCTR",19,0)
 ; .323 PERIOD OF SERVICE **876
"RTN","VAFCTR",20,0)
 ; .352 DEATH ENTERED BY **902 MVI_4735 (jfw)
"RTN","VAFCTR",21,0)
 ; .353 SOURCE OF NOTIFICATION **902 MVI_4735 (jfw)
"RTN","VAFCTR",22,0)
 ; .354 DATE OF DEATH LAST UPDATED **902 MVI_4735 (jfw)
"RTN","VAFCTR",23,0)
 ; .355 LAST EDITED BY **902 MVI_4735 (jfw)
"RTN","VAFCTR",24,0)
 ; .357 SUPPORTING DOCUMENT TYPE **926 STORY 323008 (jfw)
"RTN","VAFCTR",25,0)
 ; .2405 PREFERRED NAME **937 STORY 445457 [Sub-Story 455414] (jfw)
"RTN","VAFCTR",26,0)
 ; .0931 PLACE OF BIRTH COUNTRY  **944 STORY 504382 [Sub-Story 513042] (jfw)
"RTN","VAFCTR",27,0)
 ; .0932 PLACE OF BIRTH PROVINCE **944 STORY 504382 [Sub-Story 513042] (jfw)
"RTN","VAFCTR",28,0)
 ;
"RTN","VAFCTR",29,0)
 N MVIRSLT
"RTN","VAFCTR",30,0)
 I $G(DGFILE)'=2&($G(DGFILE)'=2.01)&($G(DGFILE)'=2.02)&($G(DGFILE)'=2.06) Q
"RTN","VAFCTR",31,0)
 S DGFIELD=$G(DGFIELD)
"RTN","VAFCTR",32,0)
 ;I DGFIELD'=.01&(DGFIELD'=994)&(DGFIELD'=.525)&(DGFIELD'=.0906)&(DGFIELD'=.121)&(DGFIELD'=.133)&(DGFIELD'=.134)&(DGFIELD'=391)&(DGFIELD'=1901)&(DGFIELD'=.323)&(DGFIELD'=.024) Q
"RTN","VAFCTR",33,0)
 ;**902 MVI_4735 (jfw) Add 4 new fields to list (Break apart long If line above)
"RTN","VAFCTR",34,0)
 S MVIRSLT=(DGFIELD'=.01)&(DGFIELD'=994)&(DGFIELD'=.525)&(DGFIELD'=.0906)&(DGFIELD'=.121)&(DGFIELD'=.133)
"RTN","VAFCTR",35,0)
 S MVIRSLT=MVIRSLT&(DGFIELD'=.134)&(DGFIELD'=391)&(DGFIELD'=1901)&(DGFIELD'=.323)&(DGFIELD'=.024)
"RTN","VAFCTR",36,0)
 S MVIRSLT=MVIRSLT&(DGFIELD'=.352)&(DGFIELD'=.353)&(DGFIELD'=.354)&(DGFIELD'=.355)&(DGFIELD'=.357)
"RTN","VAFCTR",37,0)
 S MVIRSLT=MVIRSLT&(DGFIELD'=.2405)&(DGFIELD'=.0931)&(DGFIELD'=.0932)
"RTN","VAFCTR",38,0)
 Q:(MVIRSLT)
"RTN","VAFCTR",39,0)
 I $T(AVAFC^VAFCDD01)="" Q
"RTN","VAFCTR",40,0)
 ;The fields below are not multiples
"RTN","VAFCTR",41,0)
 ;I (DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)!(DGFIELD=.134)!(DGFIELD=.024)!(DGFIELD=391)!(DGFIELD=1901)!(DGFIELD=.323) S VAFCF=DGFIELD_";" D AVAFC^VAFCDD01(DGDA)
"RTN","VAFCTR",42,0)
 ;**902 MVI_4735 (jfw) Add 4 new fields to list (Break apart long If line above)
"RTN","VAFCTR",43,0)
 S MVIRSLT=(DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)
"RTN","VAFCTR",44,0)
 S MVIRSLT=MVIRSLT!(DGFIELD=.134)!(DGFIELD=.024)!(DGFIELD=391)!(DGFIELD=1901)!(DGFIELD=.323)
"RTN","VAFCTR",45,0)
 S MVIRSLT=MVIRSLT!(DGFIELD=.352)!(DGFIELD=.353)!(DGFIELD=.354)!(DGFIELD=.355)!(DGFIELD=.357)
"RTN","VAFCTR",46,0)
 S MVIRSLT=MVIRSLT!(DGFIELD=.2405)!(DGFIELD=.0931)!(DGFIELD=.0932)
"RTN","VAFCTR",47,0)
 I MVIRSLT S VAFCF=DGFIELD_";" D AVAFC^VAFCDD01(DGDA)
"RTN","VAFCTR",48,0)
 ;The fields below ARE multiples
"RTN","VAFCTR",49,0)
 I DGFILE=2.01 S VAFCF="1;" D AVAFC^VAFCDD01(DGDA(1)) ;ALIAS
"RTN","VAFCTR",50,0)
 I DGFILE=2.02 S VAFCF="2.02,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;RACE INFORMATION
"RTN","VAFCTR",51,0)
 I DGFILE=2.06 S VAFCF="2.06,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;ETHNICITY INFORMATION
"RTN","VAFCTR",52,0)
 Q
"SEC","^DIC",47.761,47.761,0,"AUDIT")
@
"SEC","^DIC",47.761,47.761,0,"DD")
@
"SEC","^DIC",47.761,47.761,0,"DEL")
@
"SEC","^DIC",47.761,47.761,0,"LAYGO")
@
"SEC","^DIC",47.761,47.761,0,"RD")
@
"SEC","^DIC",47.761,47.761,0,"WR")
@
"VER")
8.0^22.2
"^DD",2,2,.0931,0)
PLACE OF BIRTH COUNTRY^P779.004'a^HL(779.004,^.24;6^Q
"^DD",2,2,.0931,3)
Select the COUNTRY CODE from the list that identifies the country where the individual was born.
"^DD",2,2,.0931,21,0)
^.001^2^2^3170501^^
"^DD",2,2,.0931,21,1,0)
The PLACE OF BIRTH COUNTRY field identifies the Country that was selected 
"^DD",2,2,.0931,21,2,0)
from the available COUNTRY CODE list for where the individual was born.
"^DD",2,2,.0931,"AUDIT")
y
"^DD",2,2,.0931,"DT")
3170501
"^DD",2,2,.0932,0)
PLACE OF BIRTH PROVINCE^FJ20a^^.24;7^K:$L(X)>20!($L(X)<1) X
"^DD",2,2,.0932,3)
Enter the Province (1-20 characters) where the individual was born.
"^DD",2,2,.0932,21,0)
^^3^3^3170501^
"^DD",2,2,.0932,21,1,0)
The PLACE OF BIRTH PROVINCE field identifies the location within certain 
"^DD",2,2,.0932,21,2,0)
countries containing additional divisions of where the individual was 
"^DD",2,2,.0932,21,3,0)
born.
"^DD",2,2,.0932,"AUDIT")
y
"^DD",2,2,.0932,"DT")
3170501
"^DD",2,2,.357,0)
SUPPORTING DOCUMENT TYPE^*P47.75'a^DG(47.75,^.35;7^S DIC("S")="I $D(^DG(47.761,""AF"",Y,1))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2,2,.357,3)
Select the appropriate SUPPORTING DOCUMENT TYPE from the list that identifies the current document used to inform of a patient's death.
"^DD",2,2,.357,4)
D SDTHELP^DGDEATH
"^DD",2,2,.357,12)
The SUPPORTING DOCUMENT TYPE screen will ensure that only valid/active supporting document types are selected based on the current business rules defined in File #47.761.
"^DD",2,2,.357,12.1)
S DIC("S")="I $D(^DG(47.761,""AF"",Y,1))"
"^DD",2,2,.357,21,0)
^.001^2^2^3170801^^^^
"^DD",2,2,.357,21,1,0)
The Supporting Document Type selected from the available list identifies 
"^DD",2,2,.357,21,2,0)
the current method of how the site was notified of a patient's death.
"^DD",2,2,.357,"AUDIT")
y
"^DD",2,2,.357,"DT")
3170801
"^DD",47.761,47.761,0)
FIELD^^.03^4
"^DD",47.761,47.761,0,"DT")
3170726
"^DD",47.761,47.761,0,"IX","B",47.761,.01)

"^DD",47.761,47.761,0,"NM","SOURCE OF NOTIFICATION BUSINESS RULES")

"^DD",47.761,47.761,.01,0)
SOURCE OF NOTIFICATION^RP47.76'^DG(47.76,^0;1^Q
"^DD",47.761,47.761,.01,.1)
Source of Notification
"^DD",47.761,47.761,.01,1,0)
^.1
"^DD",47.761,47.761,.01,1,1,0)
47.761^B
"^DD",47.761,47.761,.01,1,1,1)
S ^DG(47.761,"B",$E(X,1,30),DA)=""
"^DD",47.761,47.761,.01,1,1,2)
K ^DG(47.761,"B",$E(X,1,30),DA)
"^DD",47.761,47.761,.01,3)
Select the appropriate SOURCE OF NOTIFICATION from the list that specifies the business rule combination(s) to modify. 
"^DD",47.761,47.761,.01,21,0)
^.001^3^3^3170724^^^^
"^DD",47.761,47.761,.01,21,1,0)
SOURCE OF NOTIFICATION identifies the entry from the SOURCE OF 
"^DD",47.761,47.761,.01,21,2,0)
NOTIFICATIONS (#47.76) file that has valid corresponding SUPPORTING 
"^DD",47.761,47.761,.01,21,3,0)
DOCUMENTATION TYPES (#47.75) entry(ies).
"^DD",47.761,47.761,.01,"DT")
3170724
"^DD",47.761,47.761,.02,0)
ACTIVE?^RSa^1:YES;0:NO;^0;2^Q
"^DD",47.761,47.761,.02,1,0)
^.1^^0
"^DD",47.761,47.761,.02,3)
Is this SOURCE OF NOTIFICATION business rule active (YES/NO)?
"^DD",47.761,47.761,.02,21,0)
^.001^2^2^3170726^^^^
"^DD",47.761,47.761,.02,21,1,0)
ACTIVE? will indicate whether the business rules for this SOURCE OF 
"^DD",47.761,47.761,.02,21,2,0)
NOTIFICATION are active and available for use.
"^DD",47.761,47.761,.02,"AUDIT")
y
"^DD",47.761,47.761,.02,"DT")
3170726
"^DD",47.761,47.761,.03,0)
DATE LAST UPDATED^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",47.761,47.761,.03,3)
Enter the date that the business rule for this Source of Notification was modified.
"^DD",47.761,47.761,.03,21,0)
^^2^2^3170724^
"^DD",47.761,47.761,.03,21,1,0)
The DATE LAST UPDATED is a date attribute for when the business rule for 
"^DD",47.761,47.761,.03,21,2,0)
the corresponding SOURCE OF NOTIFICATION was last changed.
"^DD",47.761,47.761,.03,"DT")
3170724
"^DD",47.761,47.761,1,0)
DOCUMENT TYPES^47.7611PA^^1;0
"^DD",47.761,47.761,1,21,0)
^.001^3^3^3170726^^^^
"^DD",47.761,47.761,1,21,1,0)
For each SOURCE OF NOTIFICATION, the DOCUMENT TYPES multiple specifies the
"^DD",47.761,47.761,1,21,2,0)
allowable DOCUMENT TYPE(s) that will be considered as a valid combination 
"^DD",47.761,47.761,1,21,3,0)
business rule.
"^DD",47.761,47.7611,0)
DOCUMENT TYPES SUB-FIELD^^.02^2
"^DD",47.761,47.7611,0,"DT")
3170726
"^DD",47.761,47.7611,0,"IX","B",47.7611,.01)

"^DD",47.761,47.7611,0,"NM","DOCUMENT TYPES")

"^DD",47.761,47.7611,0,"UP")
47.761
"^DD",47.761,47.7611,.01,0)
DOCUMENT TYPE^MP47.75'^DG(47.75,^0;1^Q
"^DD",47.761,47.7611,.01,.1)
Document Type
"^DD",47.761,47.7611,.01,1,0)
^.1
"^DD",47.761,47.7611,.01,1,1,0)
47.7611^B
"^DD",47.761,47.7611,.01,1,1,1)
S ^DG(47.761,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",47.761,47.7611,.01,1,1,2)
K ^DG(47.761,DA(1),1,"B",$E(X,1,30),DA)
"^DD",47.761,47.7611,.01,3)
Select the appropriate DOCUMENT TYPE from the list to associate with the SOURCE OF NOTIFICATION business rule.
"^DD",47.761,47.7611,.01,21,0)
^.001^3^3^3170724^^^^
"^DD",47.761,47.7611,.01,21,1,0)
DOCUMENT TYPE identifies the entry from the SUPPORTING DOCUMENTATION 
"^DD",47.761,47.7611,.01,21,2,0)
TYPES (#47.75) file that will be considered as valid combination business 
"^DD",47.761,47.7611,.01,21,3,0)
rule for the SOURCE OF NOTIFICATION.
"^DD",47.761,47.7611,.01,"DT")
3170725
"^DD",47.761,47.7611,.02,0)
ACTIVE?^RSa^1:YES;0:NO;^0;2^Q
"^DD",47.761,47.7611,.02,1,0)
^.1^^0
"^DD",47.761,47.7611,.02,3)
Is this DOCUMENT TYPE business rule combination with the SOURCE OF NOTIFICATION active (YES/NO)?
"^DD",47.761,47.7611,.02,21,0)
^.001^2^2^3170726^^^^
"^DD",47.761,47.7611,.02,21,1,0)
ACTIVE? will indicate whether the business rule combination of SOURCE OF 
"^DD",47.761,47.7611,.02,21,2,0)
NOTIFICATION and DOCUMENT TYPE is still active and available for use.
"^DD",47.761,47.7611,.02,"AUDIT")
y
"^DD",47.761,47.7611,.02,"DT")
3170726
"^DIC",47.761,47.761,0)
SOURCE OF NOTIFICATION BUSINESS RULES^47.761
"^DIC",47.761,47.761,0,"GL")
^DG(47.761,
"^DIC",47.761,47.761,"%",0)
^1.005
"^DIC",47.761,47.761,"%D",0)
^^9^9^3170724^
"^DIC",47.761,47.761,"%D",1,0)
This file contains all of the allowable SUPPORTING DOCUMENTATION TYPES 
"^DIC",47.761,47.761,"%D",2,0)
(#47.75) and SOURCE OF NOTIFICATIONS (#47.76) combinations that can exist 
"^DIC",47.761,47.761,"%D",3,0)
between these two files. By placing these valid combinations into a file, 
"^DIC",47.761,47.761,"%D",4,0)
existing hard-coded sections of code can be removed allowing for a more 
"^DIC",47.761,47.761,"%D",5,0)
dynamic implementation of this business rule.
"^DIC",47.761,47.761,"%D",6,0)
 
"^DIC",47.761,47.761,"%D",7,0)
NOTE: Future combination additions/changes (including inactivation) will 
"^DIC",47.761,47.761,"%D",8,0)
      be performed through an RPC on the Master Patient Index and 
"^DIC",47.761,47.761,"%D",9,0)
      distributed out to all sites as needed.
"^DIC",47.761,"B","SOURCE OF NOTIFICATION BUSINES",47.761)

"BLD",3252,6)
^828
**END**
**END**

