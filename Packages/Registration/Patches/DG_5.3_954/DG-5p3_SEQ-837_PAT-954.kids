Released DG*5.3*954 SEQ #837
Extracted from mail message
**KIDS**:DG*5.3*954^

**INSTALL NAME**
DG*5.3*954
"BLD",10785,0)
DG*5.3*954^REGISTRATION^0^3180205^y
"BLD",10785,1,0)
^^2^2^3180205^
"BLD",10785,1,1,0)
Patch DG*5.3*954 fixes a <SUBSCRIPT>PIVNW+16~VAFHPIVT ~VAT(391.71,"") 
"BLD",10785,1,2,0)
error.
"BLD",10785,4,0)
^9.64PA^^
"BLD",10785,6.3)
3
"BLD",10785,"ABPKG")
n
"BLD",10785,"INID")
n^n^n
"BLD",10785,"KRN",0)
^9.67PA^779.2^20
"BLD",10785,"KRN",.4,0)
.4
"BLD",10785,"KRN",.401,0)
.401
"BLD",10785,"KRN",.402,0)
.402
"BLD",10785,"KRN",.403,0)
.403
"BLD",10785,"KRN",.5,0)
.5
"BLD",10785,"KRN",.84,0)
.84
"BLD",10785,"KRN",3.6,0)
3.6
"BLD",10785,"KRN",3.8,0)
3.8
"BLD",10785,"KRN",9.2,0)
9.2
"BLD",10785,"KRN",9.8,0)
9.8
"BLD",10785,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10785,"KRN",9.8,"NM",1,0)
VAFHPIVT^^0^B21544775
"BLD",10785,"KRN",9.8,"NM","B","VAFHPIVT",1)

"BLD",10785,"KRN",19,0)
19
"BLD",10785,"KRN",19.1,0)
19.1
"BLD",10785,"KRN",101,0)
101
"BLD",10785,"KRN",409.61,0)
409.61
"BLD",10785,"KRN",771,0)
771
"BLD",10785,"KRN",779.2,0)
779.2
"BLD",10785,"KRN",870,0)
870
"BLD",10785,"KRN",8989.51,0)
8989.51
"BLD",10785,"KRN",8989.52,0)
8989.52
"BLD",10785,"KRN",8994,0)
8994
"BLD",10785,"KRN","B",.4,.4)

"BLD",10785,"KRN","B",.401,.401)

"BLD",10785,"KRN","B",.402,.402)

"BLD",10785,"KRN","B",.403,.403)

"BLD",10785,"KRN","B",.5,.5)

"BLD",10785,"KRN","B",.84,.84)

"BLD",10785,"KRN","B",3.6,3.6)

"BLD",10785,"KRN","B",3.8,3.8)

"BLD",10785,"KRN","B",9.2,9.2)

"BLD",10785,"KRN","B",9.8,9.8)

"BLD",10785,"KRN","B",19,19)

"BLD",10785,"KRN","B",19.1,19.1)

"BLD",10785,"KRN","B",101,101)

"BLD",10785,"KRN","B",409.61,409.61)

"BLD",10785,"KRN","B",771,771)

"BLD",10785,"KRN","B",779.2,779.2)

"BLD",10785,"KRN","B",870,870)

"BLD",10785,"KRN","B",8989.51,8989.51)

"BLD",10785,"KRN","B",8989.52,8989.52)

"BLD",10785,"KRN","B",8994,8994)

"BLD",10785,"QUES",0)
^9.62^^
"BLD",10785,"REQB",0)
^9.611^1^1
"BLD",10785,"REQB",1,0)
DG*5.3*575^1
"BLD",10785,"REQB","B","DG*5.3*575",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
954^3180205
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3180205
"PKG",5,22,1,"PAH",1,1,1,0)
Patch DG*5.3*954 fixes a <SUBSCRIPT>PIVNW+16~VAFHPIVT ~VAT(391.71,"") 
"PKG",5,22,1,"PAH",1,1,2,0)
error.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VAFHPIVT")
0^1^B21544775^B21313463
"RTN","VAFHPIVT",1,0)
VAFHPIVT ;ALB/CM - PIVOT FILE UTILITY FUNCTIONS ;5/5/95
"RTN","VAFHPIVT",2,0)
 ;;5.3;Registration;**91,179,575,954**;Jun 06, 1996;Build 3
"RTN","VAFHPIVT",3,0)
 ;
"RTN","VAFHPIVT",4,0)
PIVNW(DFN,EVDT,EVTY,PTR) ;
"RTN","VAFHPIVT",5,0)
 ;function will return 0 node of pivot file and pivot file entry number
"RTN","VAFHPIVT",6,0)
 ;if no entry in pivot file, create one and return #:0 node
"RTN","VAFHPIVT",7,0)
 ;
"RTN","VAFHPIVT",8,0)
 Q:$G(DFN)=""!($G(EVDT)="")!($G(EVTY)="")!($G(PTR)="") "-1^Missing Parameters for PIVNW function"
"RTN","VAFHPIVT",9,0)
 I $G(^DPT(DFN,0))="" Q "-1^PATIENT WITH PASSED DFN DOES NOT EXIST"
"RTN","VAFHPIVT",10,0)
 N CROSS,DA,NODE,NEW,PIVOT,ERR,TNODE,NNODE,FCNT,FIELDS,FLD,X,STOP
"RTN","VAFHPIVT",11,0)
 I '$D(^VAT(391.71,"AKY",EVTY,EVDT,PTR)) D
"RTN","VAFHPIVT",12,0)
 .;not in pivot file
"RTN","VAFHPIVT",13,0)
 .S PIVOT=$$GETPIV^VAFHPIV2() ;get next pivot file number
"RTN","VAFHPIVT",14,0)
 .I +PIVOT=-1 S ERR="Y"
"RTN","VAFHPIVT",15,0)
 .I '$D(ERR) S NEW="Y"
"RTN","VAFHPIVT",16,0)
 ;
"RTN","VAFHPIVT",17,0)
 I $D(^VAT(391.71,"AKY",EVTY,EVDT,PTR)) D
"RTN","VAFHPIVT",18,0)
 .;check if it's been marked as deleted
"RTN","VAFHPIVT",19,0)
 .S DA=$O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,""))
"RTN","VAFHPIVT",20,0)
 .Q:DA=""
"RTN","VAFHPIVT",21,0)
 .I $P(^VAT(391.71,DA,0),"^",7)'="" D
"RTN","VAFHPIVT",22,0)
 ..S STOP="N"
"RTN","VAFHPIVT",23,0)
 ..F  S DA=$O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,DA)) Q:DA=""  I $D(^VAT(391.71,DA)) S:$P(^VAT(391.71,DA,0),"^",7)="" STOP="Y" Q:STOP="Y"
"RTN","VAFHPIVT",24,0)
 ..I DA="" S PIVOT=$$GETPIV^VAFHPIV2() I +PIVOT>0 S NEW="Y"
"RTN","VAFHPIVT",25,0)
 .I '$D(PIVOT) S PIVOT=$P(^VAT(391.71,DA,0),"^",2)
"RTN","VAFHPIVT",26,0)
 .I $D(PIVOT) S:+PIVOT=-1 ERR="Y"
"RTN","VAFHPIVT",27,0)
 I $D(ERR) Q "-1^Can't get new pivot number"
"RTN","VAFHPIVT",28,0)
 I $D(NEW) D
"RTN","VAFHPIVT",29,0)
 .;Set up initial entry, get next internal entry number
"RTN","VAFHPIVT",30,0)
 .L +^VAT(391.71,0):5 I '$T S ERR="-1^Unable to lock Pivot file" Q
"RTN","VAFHPIVT",31,0)
 .S DA=$P(^VAT(391.71,0),"^",3)
"RTN","VAFHPIVT",32,0)
 .F  S DA=DA+1 Q:'$D(^VAT(391.71,DA))
"RTN","VAFHPIVT",33,0)
 .S ^VAT(391.71,DA,0)="" L +^VAT(391.71,DA,0):5 I '$T S ERR="-1^Unable to lock Pivot file entry" L -^VAT(391.71,0) Q
"RTN","VAFHPIVT",34,0)
 .S $P(^VAT(391.71,0),"^",3)=DA,$P(^VAT(391.71,0),"^",4)=$P(^VAT(391.71,0),"^",4)+1 L -^VAT(391.71,0)
"RTN","VAFHPIVT",35,0)
 .S ^VAT(391.71,DA,0)=EVDT,CROSS=0
"RTN","VAFHPIVT",36,0)
 .;Set cross references for .01
"RTN","VAFHPIVT",37,0)
 .F  S CROSS=$O(^DD(391.71,.01,1,CROSS)) Q:'CROSS  I $G(^(CROSS,0))'["TRIGGER"  D
"RTN","VAFHPIVT",38,0)
 ..S X=EVDT X ^DD(391.71,.01,1,CROSS,2) ;kill cross reference
"RTN","VAFHPIVT",39,0)
 ..S X=EVDT X ^DD(391.71,.01,1,CROSS,1) ;set cross reference
"RTN","VAFHPIVT",40,0)
 .L -^VAT(391.71,DA,0)
"RTN","VAFHPIVT",41,0)
 ;
"RTN","VAFHPIVT",42,0)
 I '$D(ERR) D
"RTN","VAFHPIVT",43,0)
 .L +^VAT(391.71,DA,0):5 I '$T S ERR="-1^Unable to lock Pivot file entry" Q
"RTN","VAFHPIVT",44,0)
 .S TNODE=$G(^VAT(391.71,DA,0))
"RTN","VAFHPIVT",45,0)
 .I '$D(DGUSER) S DGUSER=DUZ
"RTN","VAFHPIVT",46,0)
 .S ^VAT(391.71,DA,0)=EVDT_"^"_PIVOT_"^"_DFN_"^"_EVTY_"^"_PTR_"^^^^"_$G(DGUSER)
"RTN","VAFHPIVT",47,0)
 .S NNODE=$G(^VAT(391.71,DA,0))
"RTN","VAFHPIVT",48,0)
 .;set cross references for all fields .01,.02,.03,.04,.05
"RTN","VAFHPIVT",49,0)
 .S FIELDS=".01,.02,.03,.04,.05",FCNT=0
"RTN","VAFHPIVT",50,0)
 .F  S FCNT=FCNT+1,FLD=$P(FIELDS,",",FCNT) Q:FLD=""  D
"RTN","VAFHPIVT",51,0)
 ..S CROSS=0
"RTN","VAFHPIVT",52,0)
 ..F  S CROSS=$O(^DD(391.71,FLD,1,CROSS)) Q:'CROSS  I $G(^(CROSS,0))'["TRIGGER" D
"RTN","VAFHPIVT",53,0)
 ...I TNODE'="" S X=$P(TNODE,"^",FCNT) I X'="" X ^DD(391.71,FLD,1,CROSS,2) ;kill cross reference
"RTN","VAFHPIVT",54,0)
 ...S X=$P(NNODE,"^",FCNT) X ^DD(391.71,FLD,1,CROSS,1) ;set cross reference
"RTN","VAFHPIVT",55,0)
 .L -^VAT(391.71,DA,0)
"RTN","VAFHPIVT",56,0)
 I $D(ERR) Q ERR
"RTN","VAFHPIVT",57,0)
 I $D(^VAT(391.71,"AKY",EVTY,EVDT,PTR)) D
"RTN","VAFHPIVT",58,0)
 .;have entry in pivot file
"RTN","VAFHPIVT",59,0)
 .S DA=$O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,"")) I DA="" S ERR="-1^Bad AKY Cross Reference"
"RTN","VAFHPIVT",60,0)
 .I '$D(ERR) S STOP="N" F  Q:DA=""!(STOP="Y")  D
"RTN","VAFHPIVT",61,0)
 ..I $D(^VAT(391.71,DA,0)) D
"RTN","VAFHPIVT",62,0)
 ...I $P(^VAT(391.71,DA,0),"^",7)'=1 S NODE=$G(^VAT(391.71,DA,0)),PIVOT=$P(NODE,"^",2),STOP="Y"
"RTN","VAFHPIVT",63,0)
 ...I $P(^VAT(391.71,DA,0),"^",7)=1 S DA=$O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,DA))
"RTN","VAFHPIVT",64,0)
 I '$D(^VAT(391.71,"AKY",EVTY,EVDT,PTR)) S ERR="-1^ERROR NO AKY CROSS REFERENCE"
"RTN","VAFHPIVT",65,0)
 I $D(ERR) Q ERR
"RTN","VAFHPIVT",66,0)
 Q PIVOT_":"_NODE
"RTN","VAFHPIVT",67,0)
 ;
"RTN","VAFHPIVT",68,0)
PIVX(PIVOT,DFN,EVDT) ;
"RTN","VAFHPIVT",69,0)
 ;given pivot #, check for existence and compare the data in file to
"RTN","VAFHPIVT",70,0)
 ;parameters, return pivot number:0 node
"RTN","VAFHPIVT",71,0)
 I $G(PIVOT)="" Q "-1^Missing Parameters for PIVX function"
"RTN","VAFHPIVT",72,0)
 I '$D(^VAT(391.71,"D",PIVOT)) Q "-1^No entry in Pivot file"
"RTN","VAFHPIVT",73,0)
 N ENT,ERR S ENT=$O(^VAT(391.71,"D",PIVOT,""))
"RTN","VAFHPIVT",74,0)
 I ENT="" Q "-1^BAD 'D' CROSS REFERENCE"
"RTN","VAFHPIVT",75,0)
 S NODE=$G(^VAT(391.71,ENT,0))
"RTN","VAFHPIVT",76,0)
 I $D(DFN) I $P(NODE,"^",3)'=DFN S ERR="-1^PATIENTS DON'T MATCH"
"RTN","VAFHPIVT",77,0)
 I $D(EVDT) I $P(NODE,"^")'=EVDT S ERR="-1^DATE/TIME DOESN'T MATCH"
"RTN","VAFHPIVT",78,0)
 I $P(NODE,"^",7)'="" S ERR="-1^No entry in Pivot file"
"RTN","VAFHPIVT",79,0)
 I $D(ERR) Q ERR
"RTN","VAFHPIVT",80,0)
 Q PIVOT_":"_NODE
"RTN","VAFHPIVT",81,0)
 ;
"RTN","VAFHPIVT",82,0)
PIVCHK(DFN,EVDT,EVTY,PTR) ;
"RTN","VAFHPIVT",83,0)
 ;check for existence of pivot file entry.
"RTN","VAFHPIVT",84,0)
 ;If exist, return pivot number:0 node.  If not exist, return 0
"RTN","VAFHPIVT",85,0)
 I $G(DFN)=""!($G(EVDT)="")!($G(EVTY)="")!($G(PTR)="") Q "-1^Missing parameter for PIVCHK function"
"RTN","VAFHPIVT",86,0)
 I $G(^DPT(DFN,0))="" Q "-1^PATIENT WITH PASSED DFN DOES NOT EXIST"
"RTN","VAFHPIVT",87,0)
 ;
"RTN","VAFHPIVT",88,0)
 I '$D(^VAT(391.71,"AKY",EVTY,EVDT,PTR)) Q "-1^No Entry in Pivot File"
"RTN","VAFHPIVT",89,0)
 I $O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,""))="" Q "-1^Bad AKY Cross Reference"
"RTN","VAFHPIVT",90,0)
 N DA,EVENT,NODE
"RTN","VAFHPIVT",91,0)
 S (DA,NODE,EVENT)=0
"RTN","VAFHPIVT",92,0)
 F  S DA=$O(^VAT(391.71,"AKY",EVTY,EVDT,PTR,DA)) Q:'DA  DO  Q:EVENT
"RTN","VAFHPIVT",93,0)
 . S NODE=$G(^VAT(391.71,DA,0))
"RTN","VAFHPIVT",94,0)
 . I $P(NODE,"^",7)=1 Q
"RTN","VAFHPIVT",95,0)
 . S EVENT=$P(NODE,"^",2)
"RTN","VAFHPIVT",96,0)
 ;
"RTN","VAFHPIVT",97,0)
 I 'EVENT Q "-1^NO Entry in Pivot File"
"RTN","VAFHPIVT",98,0)
 I $P(NODE,"^",3)'=DFN Q "-1^DFN DOES NOT MATCH PIVOT DFN"
"RTN","VAFHPIVT",99,0)
 Q EVENT_":"_NODE
"RTN","VAFHPIVT",100,0)
 ;
"RTN","VAFHPIVT",101,0)
 Q
"VER")
8.0^22.2
"BLD",10785,6)
^837
**END**
**END**

