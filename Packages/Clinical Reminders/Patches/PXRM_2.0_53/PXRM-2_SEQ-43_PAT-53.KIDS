Released PXRM*2*53 SEQ #43
Extracted from mail message
**KIDS**:PXRM*2.0*53^

**INSTALL NAME**
PXRM*2.0*53
"BLD",9172,0)
PXRM*2.0*53^CLINICAL REMINDERS^0^3150721^y
"BLD",9172,1,0)
^^1^1^3150721^
"BLD",9172,1,1,0)
Clinical Reminders Dialog Search Report.
"BLD",9172,4,0)
^9.64PA^^0
"BLD",9172,6.3)
225
"BLD",9172,"ABPKG")
n
"BLD",9172,"INI")

"BLD",9172,"INIT")

"BLD",9172,"KRN",0)
^9.67PA^779.2^20
"BLD",9172,"KRN",.4,0)
.4
"BLD",9172,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",9172,"KRN",.401,0)
.401
"BLD",9172,"KRN",.402,0)
.402
"BLD",9172,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",9172,"KRN",.403,0)
.403
"BLD",9172,"KRN",.403,"NM",0)
^9.68A^^0
"BLD",9172,"KRN",.5,0)
.5
"BLD",9172,"KRN",.84,0)
.84
"BLD",9172,"KRN",3.6,0)
3.6
"BLD",9172,"KRN",3.8,0)
3.8
"BLD",9172,"KRN",9.2,0)
9.2
"BLD",9172,"KRN",9.8,0)
9.8
"BLD",9172,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",9172,"KRN",9.8,"NM",1,0)
PXRMDLR2^^0^B230549224
"BLD",9172,"KRN",9.8,"NM",3,0)
PXRMFRPT^^0^B188701531
"BLD",9172,"KRN",9.8,"NM",4,0)
PXRMDLRH^^0^B17136839
"BLD",9172,"KRN",9.8,"NM",5,0)
PXRMCVRL^^0^B48796510
"BLD",9172,"KRN",9.8,"NM",6,0)
PXRMDUTL^^0^B11560292
"BLD",9172,"KRN",9.8,"NM",7,0)
PXRMMSG^^0^B4362273
"BLD",9172,"KRN",9.8,"NM","B","PXRMCVRL",5)

"BLD",9172,"KRN",9.8,"NM","B","PXRMDLR2",1)

"BLD",9172,"KRN",9.8,"NM","B","PXRMDLRH",4)

"BLD",9172,"KRN",9.8,"NM","B","PXRMDUTL",6)

"BLD",9172,"KRN",9.8,"NM","B","PXRMFRPT",3)

"BLD",9172,"KRN",9.8,"NM","B","PXRMMSG",7)

"BLD",9172,"KRN",19,0)
19
"BLD",9172,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",9172,"KRN",19,"NM",1,0)
PXRM DIALOG TOOLS MENU^^2
"BLD",9172,"KRN",19,"NM",2,0)
PXRM DIALOG SEARCH REPORT^^0
"BLD",9172,"KRN",19,"NM","B","PXRM DIALOG SEARCH REPORT",2)

"BLD",9172,"KRN",19,"NM","B","PXRM DIALOG TOOLS MENU",1)

"BLD",9172,"KRN",19.1,0)
19.1
"BLD",9172,"KRN",101,0)
101
"BLD",9172,"KRN",101,"NM",0)
^9.68A^^0
"BLD",9172,"KRN",409.61,0)
409.61
"BLD",9172,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",9172,"KRN",771,0)
771
"BLD",9172,"KRN",779.2,0)
779.2
"BLD",9172,"KRN",870,0)
870
"BLD",9172,"KRN",8989.51,0)
8989.51
"BLD",9172,"KRN",8989.52,0)
8989.52
"BLD",9172,"KRN",8994,0)
8994
"BLD",9172,"KRN","B",.4,.4)

"BLD",9172,"KRN","B",.401,.401)

"BLD",9172,"KRN","B",.402,.402)

"BLD",9172,"KRN","B",.403,.403)

"BLD",9172,"KRN","B",.5,.5)

"BLD",9172,"KRN","B",.84,.84)

"BLD",9172,"KRN","B",3.6,3.6)

"BLD",9172,"KRN","B",3.8,3.8)

"BLD",9172,"KRN","B",9.2,9.2)

"BLD",9172,"KRN","B",9.8,9.8)

"BLD",9172,"KRN","B",19,19)

"BLD",9172,"KRN","B",19.1,19.1)

"BLD",9172,"KRN","B",101,101)

"BLD",9172,"KRN","B",409.61,409.61)

"BLD",9172,"KRN","B",771,771)

"BLD",9172,"KRN","B",779.2,779.2)

"BLD",9172,"KRN","B",870,870)

"BLD",9172,"KRN","B",8989.51,8989.51)

"BLD",9172,"KRN","B",8989.52,8989.52)

"BLD",9172,"KRN","B",8994,8994)

"BLD",9172,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9172,"QUES",0)
^9.62^^
"BLD",9172,"REQB",0)
^9.611^1^1
"BLD",9172,"REQB",1,0)
PXRM*2.0*26^2
"BLD",9172,"REQB","B","PXRM*2.0*26",1)

"KRN",19,13024,-1)
2^1
"KRN",19,13024,0)
PXRM DIALOG TOOLS MENU^Dialog Reports^^M^10000000020^^^^^^^534
"KRN",19,13024,10,0)
^19.01IP^5^5
"KRN",19,13024,10,5,0)
14316^SEA^20
"KRN",19,13024,10,5,"^")
PXRM DIALOG SEARCH REPORT
"KRN",19,13024,"U")
DIALOG REPORTS
"KRN",19,14316,-1)
0^2
"KRN",19,14316,0)
PXRM DIALOG SEARCH REPORT^Reminder Dialog Search Report^^A^^^^^^^^CLINICAL REMINDERS^^1
"KRN",19,14316,1,0)
^19.06^2^2^3141015^^
"KRN",19,14316,1,1,0)
This option allows a user to search for Reminder Dialogs containing 
"KRN",19,14316,1,2,0)
search criteria define by the user.
"KRN",19,14316,20)
D FINDDIAL^PXRMDLR2
"KRN",19,14316,"U")
REMINDER DIALOG SEARCH REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",534,-1)
1^1
"PKG",534,0)
CLINICAL REMINDERS^PXRM^Clinical Reminders^^^3000301
"PKG",534,20,0)
^9.402P^^
"PKG",534,22,0)
^9.49I^1^1
"PKG",534,22,1,0)
2.0^3050204^3050309^10000000020
"PKG",534,22,1,"PAH",1,0)
53^3150721
"PKG",534,22,1,"PAH",1,1,0)
^^1^1^3150721
"PKG",534,22,1,"PAH",1,1,1,0)
Clinical Reminders Dialog Search Report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PXRMCVRL")
0^5^B48796510^n/a
"RTN","PXRMCVRL",1,0)
PXRMCVRL ; SLC/JM/AGP - Reminder CPRS Code ;01/12/15
"RTN","PXRMCVRL",2,0)
 ;;2.0;CLINICAL REMINDERS;**53**;Feb 04, 2005;Build 225
"RTN","PXRMCVRL",3,0)
 Q
"RTN","PXRMCVRL",4,0)
REMIND(ORY,ORPT) ;return pt's currently due PCE clinical reminders
"RTN","PXRMCVRL",5,0)
 ; in the format file 811.9 ien^reminder print name^date due^last occur.
"RTN","PXRMCVRL",6,0)
 N ORTMPLST,ORI,ORJ,ORIEN,ORTXT,ORX,ORLASTDT,ORDUEDT,ORLOC
"RTN","PXRMCVRL",7,0)
 S ORJ=0
"RTN","PXRMCVRL",8,0)
 ;
"RTN","PXRMCVRL",9,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","PXRMCVRL",10,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","PXRMCVRL",11,0)
 I +$G(ORPT)>0 D
"RTN","PXRMCVRL",12,0)
 .N DFN S DFN=ORPT,VA200="" D OERR^VADPT
"RTN","PXRMCVRL",13,0)
 .I +$G(VAIN(4))>0 S ORLOC=+$G(^DIC(42,+$G(VAIN(4)),44))
"RTN","PXRMCVRL",14,0)
 .K VA200,VAIN
"RTN","PXRMCVRL",15,0)
 ;
"RTN","PXRMCVRL",16,0)
 D REMLIST(.ORTMPLST,$G(ORLOC))
"RTN","PXRMCVRL",17,0)
 ;D GETLST^XPAR(.ORTMPLST,"USR^LOC.`"_$G(ORLOC)_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQPX SEARCH ITEMS","Q",.ORERR)
"RTN","PXRMCVRL",18,0)
 ;I ORERR>0 S ORY(1)=U_"Error: "_$P(ORERR,U,2) Q
"RTN","PXRMCVRL",19,0)
 S ORI=0 F  S ORI=$O(ORTMPLST(ORI)) Q:'ORI  D
"RTN","PXRMCVRL",20,0)
 .S ORIEN=$P(ORTMPLST(ORI),U,2)
"RTN","PXRMCVRL",21,0)
 .K ^TMP("PXRHM",$J)
"RTN","PXRMCVRL",22,0)
 .N ORPRI,ORDUE,ORSTA
"RTN","PXRMCVRL",23,0)
 .D MAIN^PXRM(ORPT,ORIEN,0)
"RTN","PXRMCVRL",24,0)
 .S ORTXT="",ORTXT=$O(^TMP("PXRHM",$J,ORIEN,ORTXT)) Q:ORTXT=""  D
"RTN","PXRMCVRL",25,0)
 ..S ORX=^TMP("PXRHM",$J,ORIEN,ORTXT)
"RTN","PXRMCVRL",26,0)
 ..S ORSTA=$P(ORX,U)
"RTN","PXRMCVRL",27,0)
 ..S ORDUEDT=$P(ORX,U,2),ORLASTDT=$P(ORX,U,3)
"RTN","PXRMCVRL",28,0)
 ..S ORLASTDT=$S(+$G(ORLASTDT)>0:ORLASTDT,1:"")  ;null if not a date
"RTN","PXRMCVRL",29,0)
 ..S ORJ=ORJ+1
"RTN","PXRMCVRL",30,0)
 ..S ORDUE=$S(ORSTA["DUE":1,ORSTA["ERROR":3,ORSTA["CNBD":4,1:2)
"RTN","PXRMCVRL",31,0)
 ..I ORDUE'=2 D
"RTN","PXRMCVRL",32,0)
 ...S ORPRI=$P($G(^PXD(811.9,ORIEN,0)),U,10) I ORPRI="" S ORPRI=2
"RTN","PXRMCVRL",33,0)
 ...S ORY(ORJ)=ORIEN_U_ORTXT_U_ORDUEDT_U_ORLASTDT_U_ORPRI_U_ORDUE_U_$$DLG^PXRMRPCA(ORIEN)_U_U_U_U_$$DLGWIPE^PXRMRPCA(ORIEN)
"RTN","PXRMCVRL",34,0)
 ..I ORDUE=2 D
"RTN","PXRMCVRL",35,0)
 ...S ORY(ORJ)=ORIEN_U_ORTXT_U_U_U_U_ORDUE_U_$$DLG^PXRMRPCA(ORIEN)_U_U_U_U_$$DLGWIPE^PXRMRPCA(ORIEN)
"RTN","PXRMCVRL",36,0)
 .K ^TMP("PXRHM",$J)
"RTN","PXRMCVRL",37,0)
 Q
"RTN","PXRMCVRL",38,0)
REMDET(ORY,ORPT,ORIEN) ;return detail for a pt's clinical reminder
"RTN","PXRMCVRL",39,0)
 ; ORY - return array
"RTN","PXRMCVRL",40,0)
 ; ORPT - patient DFN
"RTN","PXRMCVRL",41,0)
 ; ORIEN - clinical reminder (811.9 ien)
"RTN","PXRMCVRL",42,0)
 K ^TMP("PXRHM",$J)
"RTN","PXRMCVRL",43,0)
 D MAIN^PXRM(ORPT,ORIEN,5)     ; 5 returns all reminder info
"RTN","PXRMCVRL",44,0)
 N CR,I,J,ORTXT S I=1
"RTN","PXRMCVRL",45,0)
 S ORTXT="",ORTXT=$O(^TMP("PXRHM",$J,ORIEN,ORTXT)) Q:ORTXT=""  D
"RTN","PXRMCVRL",46,0)
 .S J=0 F  S J=$O(^TMP("PXRHM",$J,ORIEN,ORTXT,"TXT",J)) Q:J=""  D
"RTN","PXRMCVRL",47,0)
 ..S ORY(I)=^TMP("PXRHM",$J,ORIEN,ORTXT,"TXT",J),I=I+1
"RTN","PXRMCVRL",48,0)
 K ^TMP("PXRHM",$J)
"RTN","PXRMCVRL",49,0)
 Q
"RTN","PXRMCVRL",50,0)
NEWACTIV(ORY) ;Return true if Interactive Reminders are active
"RTN","PXRMCVRL",51,0)
 S ORY=0
"RTN","PXRMCVRL",52,0)
 I $T(APPL^PXRMRPCA)'="",+$G(DUZ) D
"RTN","PXRMCVRL",53,0)
 . N SRV
"RTN","PXRMCVRL",54,0)
 . ;S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","PXRMCVRL",55,0)
 . S SRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","PXRMCVRL",56,0)
 . S ORY=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS","PXRM GUI REMINDERS ACTIVE",1,"Q")
"RTN","PXRMCVRL",57,0)
 . I +ORY S ORY=1
"RTN","PXRMCVRL",58,0)
 . E  S ORY=0
"RTN","PXRMCVRL",59,0)
 Q
"RTN","PXRMCVRL",60,0)
 ;
"RTN","PXRMCVRL",61,0)
NEWCVOK(RESULT,USER) ; Returns status of 
"RTN","PXRMCVRL",62,0)
 N SRV,ERR,TMP
"RTN","PXRMCVRL",63,0)
 ;S ORY=0,SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","PXRMCVRL",64,0)
 S RESULT=0,SRV=$$GET1^DIQ(200,USER,29,"I")
"RTN","PXRMCVRL",65,0)
 D GETLST^XPAR(.TMP,"USR.`"_USER_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORQQPX NEW REMINDER PARAMS","Q",.ERR)
"RTN","PXRMCVRL",66,0)
 I +TMP S RESULT=$P($G(TMP(1)),U,2)
"RTN","PXRMCVRL",67,0)
 Q
"RTN","PXRMCVRL",68,0)
ADDNAME(ORX) ; Add Reminder or Category Name as 3rd piece
"RTN","PXRMCVRL",69,0)
 N CAT,IEN
"RTN","PXRMCVRL",70,0)
 S CAT=$E($P(ORX,U,2),2)
"RTN","PXRMCVRL",71,0)
 S IEN=$E($P(ORX,U,2),3,99)
"RTN","PXRMCVRL",72,0)
 I +IEN D
"RTN","PXRMCVRL",73,0)
 .I CAT="R" S $P(ORX,U,3)=$P($G(^PXD(811.9,IEN,0)),U,3)
"RTN","PXRMCVRL",74,0)
 .I CAT="C" S $P(ORX,U,3)=$P($G(^PXRMD(811.7,IEN,0)),U)
"RTN","PXRMCVRL",75,0)
 Q ORX
"RTN","PXRMCVRL",76,0)
 ;
"RTN","PXRMCVRL",77,0)
REMACCUM(RESULT,LVL,TYP,SORT,CLASS) ; Accumulates ORTMP into ORY
"RTN","PXRMCVRL",78,0)
 ; Format of entries in ORQQPX COVER SHEET REMINDERS:
"RTN","PXRMCVRL",79,0)
 ;   L:Lock;R:Remove;N:Normal / C:Category;R:Reminder / Cat or Rem IEN
"RTN","PXRMCVRL",80,0)
 N IDX,I,J,K,M,FOUND,ORERR,ORTMP,FLAG,IEN
"RTN","PXRMCVRL",81,0)
 N FFLAG,FIEN,OUT,P2,ADD,DOADD,CODE
"RTN","PXRMCVRL",82,0)
 I LVL="CLASS" D  I 1
"RTN","PXRMCVRL",83,0)
 .N ORLST,ORCLS,ORCLSPRM,ORWP
"RTN","PXRMCVRL",84,0)
 .S ORCLSPRM="ORQQPX COVER SHEET REM CLASSES"
"RTN","PXRMCVRL",85,0)
 .D GETLST^XPAR(.ORLST,"SYS",ORCLSPRM,"Q",.ORERR)
"RTN","PXRMCVRL",86,0)
 .S I=0,M=0,CLASS=$G(CLASS)
"RTN","PXRMCVRL",87,0)
 .F  S I=$O(ORLST(I)) Q:'I  D
"RTN","PXRMCVRL",88,0)
 ..S ORCLS=$P(ORLST(I),U,1)
"RTN","PXRMCVRL",89,0)
 ..I +CLASS S ADD=(ORCLS=+CLASS) I 1
"RTN","PXRMCVRL",90,0)
 ..E  S ADD=$$ISA^USRLM(DUZ,ORCLS,.ORERR)
"RTN","PXRMCVRL",91,0)
 ..I +ADD D
"RTN","PXRMCVRL",92,0)
 ...D GETWP^XPAR(.ORWP,"SYS",ORCLSPRM,ORCLS,.ORERR)
"RTN","PXRMCVRL",93,0)
 ...S K=0
"RTN","PXRMCVRL",94,0)
 ...F  S K=$O(ORWP(K)) Q:'K  D
"RTN","PXRMCVRL",95,0)
 ....S M=M+1
"RTN","PXRMCVRL",96,0)
 ....S J=$P(ORWP(K,0),";",1)
"RTN","PXRMCVRL",97,0)
 ....S ORTMP(M)=J_U_$P(ORWP(K,0),";",2)
"RTN","PXRMCVRL",98,0)
 E  D GETLST^XPAR(.ORTMP,LVL,"ORQQPX COVER SHEET REMINDERS",TYP,.ORERR)
"RTN","PXRMCVRL",99,0)
 S I=0,IDX=$O(RESULT(999999),-1)+1,ADD=(SORT="")
"RTN","PXRMCVRL",100,0)
 F  S I=$O(ORTMP(I)) Q:'I  D
"RTN","PXRMCVRL",101,0)
 .S (FOUND,J)=0,P2=$P(ORTMP(I),U,2)
"RTN","PXRMCVRL",102,0)
 .S FLAG=$E(P2),IEN=$E(P2,2,999)
"RTN","PXRMCVRL",103,0)
 .I ADD S DOADD=1
"RTN","PXRMCVRL",104,0)
 .E  D
"RTN","PXRMCVRL",105,0)
 ..S DOADD=0
"RTN","PXRMCVRL",106,0)
 ..F  S J=$O(RESULT(J)) Q:'J  D  Q:FOUND
"RTN","PXRMCVRL",107,0)
 ...S P2=$P(RESULT(J),U,2)
"RTN","PXRMCVRL",108,0)
 ...S FIEN=$E(P2,2,999)
"RTN","PXRMCVRL",109,0)
 ...I FIEN=IEN S FOUND=J,FFLAG=$E(P2)
"RTN","PXRMCVRL",110,0)
 ..I FOUND D  I 1
"RTN","PXRMCVRL",111,0)
 ...I FLAG="R",FFLAG'="L" K RESULT(FOUND)
"RTN","PXRMCVRL",112,0)
 ...I FLAG'=FFLAG,(FLAG_FFLAG)["L" S $E(P2)="L",$P(RESULT(FOUND),U,2)=P2
"RTN","PXRMCVRL",113,0)
 ..E  I (FLAG'="R") S DOADD=1
"RTN","PXRMCVRL",114,0)
 .I DOADD D
"RTN","PXRMCVRL",115,0)
 ..S OUT(IDX)=ORTMP(I)
"RTN","PXRMCVRL",116,0)
 ..S $P(OUT(IDX),U)=$P(OUT(IDX),U)_SORT
"RTN","PXRMCVRL",117,0)
 ..I SORT="" S OUT(IDX)=$$ADDNAME(OUT(IDX))
"RTN","PXRMCVRL",118,0)
 ..S IDX=IDX+1
"RTN","PXRMCVRL",119,0)
 M RESULT=OUT
"RTN","PXRMCVRL",120,0)
 Q
"RTN","PXRMCVRL",121,0)
ADDREM(RESULT,IDX,IEN) ; Add Reminder to RESULT list
"RTN","PXRMCVRL",122,0)
 I $D(RESULT("B",IEN)) Q               ; See if it's in the list
"RTN","PXRMCVRL",123,0)
 I '$D(^PXD(811.9,IEN)) Q           ; Check if Exists
"RTN","PXRMCVRL",124,0)
 I $P($G(^PXD(811.9,IEN,0)),U,6)'="" Q  ; Check if Active
"RTN","PXRMCVRL",125,0)
 ;check to see if the reminder is assigned to CPRS
"RTN","PXRMCVRL",126,0)
 I $P($G(^PXD(811.9,IEN,100)),U,4)["L" Q
"RTN","PXRMCVRL",127,0)
 I $P($G(^PXD(811.9,IEN,100)),U,4)'["C",$P($G(^PXD(811.9,IEN,100)),U,4)'="*" Q
"RTN","PXRMCVRL",128,0)
 S RESULT(IDX)=IDX_U_IEN
"RTN","PXRMCVRL",129,0)
 S RESULT("B",IEN)=""
"RTN","PXRMCVRL",130,0)
 Q
"RTN","PXRMCVRL",131,0)
ADDCAT(RESULT,IDX,IEN) ; Add Category Reminders to ORY list
"RTN","PXRMCVRL",132,0)
 N REM,I,IDX2,NREM
"RTN","PXRMCVRL",133,0)
 D CATREM^PXRMAPI0(IEN,.REM)
"RTN","PXRMCVRL",134,0)
 S I=0
"RTN","PXRMCVRL",135,0)
 F  S I=$O(REM(I)) Q:'I  D
"RTN","PXRMCVRL",136,0)
 . S IDX2="00000"_I
"RTN","PXRMCVRL",137,0)
 . S IDX2=$E(IDX2,$L(IDX2)-5,99)
"RTN","PXRMCVRL",138,0)
 . D ADDREM(.RESULT,+(IDX_"."_IDX2),$P(REM(I),U,1))
"RTN","PXRMCVRL",139,0)
 Q
"RTN","PXRMCVRL",140,0)
REMLIST(RESULT,PERSON,LOC) ;Returns a list of all cover sheet reminders
"RTN","PXRMCVRL",141,0)
 N SRV,I,J,LST,CODE,IDX,IEN,NEWP,USER
"RTN","PXRMCVRL",142,0)
 ;S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","PXRMCVRL",143,0)
 S USER=$S(+$G(PERSON)>0:+$G(PERSON),1:DUZ)
"RTN","PXRMCVRL",144,0)
 S SRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","PXRMCVRL",145,0)
 D NEWCVOK(.NEWP,USER)
"RTN","PXRMCVRL",146,0)
 I 'NEWP D GETLST^XPAR(.RESULT,"USR.`"_USER_"^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORQQPX SEARCH ITEMS","Q",.ORERR) Q
"RTN","PXRMCVRL",147,0)
 D REMACCUM(.LST,"PKG","Q",1000)
"RTN","PXRMCVRL",148,0)
 D REMACCUM(.LST,"SYS","Q",2000)
"RTN","PXRMCVRL",149,0)
 D REMACCUM(.LST,"DIV","Q",3000)
"RTN","PXRMCVRL",150,0)
 I +SRV D REMACCUM(.LST,"SRV.`"_+$G(SRV),"Q",4000)
"RTN","PXRMCVRL",151,0)
 I +LOC D REMACCUM(.LST,"LOC.`"_+$G(LOC),"Q",5000)
"RTN","PXRMCVRL",152,0)
 D REMACCUM(.LST,"CLASS","Q",6000)
"RTN","PXRMCVRL",153,0)
 D REMACCUM(.LST,"USR.`"_USER,"Q",7000)
"RTN","PXRMCVRL",154,0)
 S I=0
"RTN","PXRMCVRL",155,0)
 F  S I=$O(LST(I)) Q:'I  D
"RTN","PXRMCVRL",156,0)
 .S IDX=$P(LST(I),U,1)
"RTN","PXRMCVRL",157,0)
 .F  Q:'$D(RESULT(IDX))  S IDX=IDX+1
"RTN","PXRMCVRL",158,0)
 .S CODE=$E($P(LST(I),U,2),2)
"RTN","PXRMCVRL",159,0)
 .S IEN=$E($P(LST(I),U,2),3,999)
"RTN","PXRMCVRL",160,0)
 .I CODE="R" D ADDREM(.RESULT,IDX,IEN)
"RTN","PXRMCVRL",161,0)
 .I CODE="C" D ADDCAT(.RESULT,IDX,IEN)
"RTN","PXRMCVRL",162,0)
 K RESULT("B")
"RTN","PXRMCVRL",163,0)
 Q
"RTN","PXRMCVRL",164,0)
 ;
"RTN","PXRMCVRL",165,0)
LVREMLST(RESULT,LVL,CLASS) ;Returns cover sheet reminders at a specified level
"RTN","PXRMCVRL",166,0)
 D REMACCUM(.RESULT,LVL,"Q","",$G(CLASS))
"RTN","PXRMCVRL",167,0)
 Q
"RTN","PXRMCVRL",168,0)
 ;
"RTN","PXRMCVRL",169,0)
GETLVRD(RESULT,LVL,CLASS) ;
"RTN","PXRMCVRL",170,0)
 N CAT,CINC,DIEN,IEN,INC,REMLIST,RIEN,REM,TEMP
"RTN","PXRMCVRL",171,0)
 D LVREMLST(.REMLIST,LVL,$G(CLASS))
"RTN","PXRMCVRL",172,0)
 S INC=0 F  S INC=$O(REMLIST(INC)) Q:INC'>0  D
"RTN","PXRMCVRL",173,0)
 . S TEMP=$P($G(REMLIST(INC)),U,2) I TEMP="" Q
"RTN","PXRMCVRL",174,0)
 . I $E(TEMP)="R" Q
"RTN","PXRMCVRL",175,0)
 . I $E(TEMP,2)="C" D
"RTN","PXRMCVRL",176,0)
 .. S CAT=$E(TEMP,3,$L(TEMP))
"RTN","PXRMCVRL",177,0)
 .. D CATREM^PXRMAPI0(CAT,.REM)
"RTN","PXRMCVRL",178,0)
 .. S CINC=0 F  S CINC=$O(REM(CINC)) Q:CINC'>0  D
"RTN","PXRMCVRL",179,0)
 ... S IEN=$G(REM(CINC)) Q:IEN'>0
"RTN","PXRMCVRL",180,0)
 ... S DIEN=+$G(^PXD(811.9,IEN,51)) Q:DIEN'>0
"RTN","PXRMCVRL",181,0)
 ... S RESULT("REMINDER",DIEN)=""
"RTN","PXRMCVRL",182,0)
 . S IEN=$E(TEMP,3,$L(TEMP))
"RTN","PXRMCVRL",183,0)
 . S DIEN=+$G(^PXD(811.9,IEN,51)) Q:DIEN'>0
"RTN","PXRMCVRL",184,0)
 . S RESULT("REMINDER",DIEN)=""
"RTN","PXRMCVRL",185,0)
 Q
"RTN","PXRMCVRL",186,0)
 ;
"RTN","PXRMCVRL",187,0)
GETDLIST(RESULT,USER,LOC) ;
"RTN","PXRMCVRL",188,0)
 ;get coversheet reminders list.
"RTN","PXRMCVRL",189,0)
 N IEN,NODE,NUM,REMLIST
"RTN","PXRMCVRL",190,0)
 D GETLIST(.REMLIST,USER,$G(LOC))
"RTN","PXRMCVRL",191,0)
 S NUM=0 F  S NUM=$O(REMLIST(NUM)) Q:NUM'>0  D
"RTN","PXRMCVRL",192,0)
 .S IEN=+$G(REMLIST(NUM)) I IEN'>0 Q
"RTN","PXRMCVRL",193,0)
 .I +$G(^PXD(811.9,IEN,51))>0 S RESULT("REMINDER",+$G(^PXD(811.9,IEN,51)))=""
"RTN","PXRMCVRL",194,0)
 Q
"RTN","PXRMCVRL",195,0)
 ;
"RTN","PXRMCVRL",196,0)
GETTDLST(RESULT) ;
"RTN","PXRMCVRL",197,0)
 ;get coversheet reminders list.
"RTN","PXRMCVRL",198,0)
 N IEN,NODE,NUM,REMLIST
"RTN","PXRMCVRL",199,0)
 S IEN=0 F  S IEN=$O(^TIU(8927,IEN)) Q:IEN'>0  D
"RTN","PXRMCVRL",200,0)
 .S NODE=$G(^TIU(8927,IEN,0))
"RTN","PXRMCVRL",201,0)
 .I $P(NODE,U,15)>0  S RESULT("TEMPLATE",$P(NODE,U,15))=""
"RTN","PXRMCVRL",202,0)
 Q
"RTN","PXRMCVRL",203,0)
GETLIST(RESULT,USER,LOC) ;Returns a list of all cover sheet reminders
"RTN","PXRMCVRL",204,0)
 N I
"RTN","PXRMCVRL",205,0)
 D REMLIST(.RESULT,USER,$G(LOC))
"RTN","PXRMCVRL",206,0)
 S I=0
"RTN","PXRMCVRL",207,0)
 F  S I=$O(RESULT(I)) Q:'I  D
"RTN","PXRMCVRL",208,0)
 .S RESULT(I)=$P(RESULT(I),U,2)
"RTN","PXRMCVRL",209,0)
 Q
"RTN","PXRMCVRL",210,0)
 ;
"RTN","PXRMCVRL",211,0)
EVALCOVR(RESULT,PT,LOC) ; Evaluate Cover Sheet Reminders
"RTN","PXRMCVRL",212,0)
 N ORTMP
"RTN","PXRMCVRL",213,0)
 D GETLIST(.ORTMP,$G(LOC))
"RTN","PXRMCVRL",214,0)
 D ALIST^ORQQPXRM(.RESULT,PT,.ORTMP)
"RTN","PXRMCVRL",215,0)
 Q
"RTN","PXRMDLR2")
0^1^B230549224^n/a
"RTN","PXRMDLR2",1,0)
PXRMDLR2 ;SLC/AGP - Dialog reporting routine to find active CPRS dialogs ;12/30/2014
"RTN","PXRMDLR2",2,0)
 ;;2.0;CLINICAL REMINDERS;**53**;Feb 04, 2005;Build 225
"RTN","PXRMDLR2",3,0)
 Q
"RTN","PXRMDLR2",4,0)
 ;
"RTN","PXRMDLR2",5,0)
ASK(YESNO,PROMPT,NUM)      ;
"RTN","PXRMDLR2",6,0)
 N X,Y,TEXT
"RTN","PXRMDLR2",7,0)
 K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PXRMDLR2",8,0)
 S DIR(0)="YA0"
"RTN","PXRMDLR2",9,0)
 S DIR("A")=PROMPT
"RTN","PXRMDLR2",10,0)
 S DIR("B")="N"
"RTN","PXRMDLR2",11,0)
 S DIR("?")="Enter Y or N. For detailed help type ??"
"RTN","PXRMDLR2",12,0)
 S DIR("??")=U_"D HELP^PXRMDLRH("_NUM_")"
"RTN","PXRMDLR2",13,0)
 W !
"RTN","PXRMDLR2",14,0)
 D ^DIR K DIR
"RTN","PXRMDLR2",15,0)
 I $D(DIROUT) S DTOUT=1
"RTN","PXRMDLR2",16,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","PXRMDLR2",17,0)
 S YESNO=$E(Y(0))
"RTN","PXRMDLR2",18,0)
 Q
"RTN","PXRMDLR2",19,0)
 ;
"RTN","PXRMDLR2",20,0)
FINDDIAL ;
"RTN","PXRMDLR2",21,0)
 N DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PXRMDLR2",22,0)
 N ANS,CPRSONLY,DARRAY,DLIST,NAME,NEWP,PARAMS,FINAL,SHOWREAS,TEMPDIAL,TLIST,USER
"RTN","PXRMDLR2",23,0)
 K ^TMP("PXRM DIALOG LISTS",$J),^TMP("PXRMXMZ",$J)
"RTN","PXRMDLR2",24,0)
 S CPRSONLY=1,SHOWREAS=0
"RTN","PXRMDLR2",25,0)
 D ASK(.ANS,"Search for coding system? ",6) I $D(DTOUT)!($D(DUOUT)) G ENX
"RTN","PXRMDLR2",26,0)
 I ANS="Y" D CODES Q:$D(DTOUT)&($D(DUOUT))  G:$D(DUOUT) FINDDIAL
"RTN","PXRMDLR2",27,0)
ENF ;
"RTN","PXRMDLR2",28,0)
 K ANS D ASK(.ANS,"Search for Finding Item(s) used in dialog component(s)? ",8) G:$D(DTOUT)&($D(DUOUT)) ENX  G:$D(DUOUT) FINDDIAL
"RTN","PXRMDLR2",29,0)
 I ANS="Y" D FINDING Q:$D(DTOUT)&($D(DUOUT))  G:$D(DUOUT) FINDDIAL
"RTN","PXRMDLR2",30,0)
END ;
"RTN","PXRMDLR2",31,0)
 K ANS D ASK(.ANS,"Search for specific Reminder Dialog component(s)? ",9) G:$D(DTOUT)&($D(DUOUT)) ENX  G:$D(DUOUT) ENF
"RTN","PXRMDLR2",32,0)
 I ANS="Y" D DIALOG  Q:$D(DTOUT)&($D(DUOUT))  G:$D(DUOUT) ENF
"RTN","PXRMDLR2",33,0)
ENC ;
"RTN","PXRMDLR2",34,0)
 D NEWCVOK^PXRMCVRL(.NEWP,DUZ) I 'NEWP S CPRSONLY=0 W !!,"Cannot search by CPRS Paramater(s), Reminder New Parameter not set to Yes" G ENR
"RTN","PXRMDLR2",35,0)
 K ANS D ASK(.ANS,"Search for Reminder Dialog by CPRS parameter(s)? ",10) G:$D(DTOUT)&($D(DUOUT)) ENX  G:$D(DUOUT) ENF
"RTN","PXRMDLR2",36,0)
 I ANS="N" S CPRSONLY=0 G ENR
"RTN","PXRMDLR2",37,0)
ENU ;
"RTN","PXRMDLR2",38,0)
 D CPRSLIST G:$D(DTOUT)&($D(DUOUT)) ENX G:$D(DUOUT)&(NEWP) ENC G:$D(DUOUT)&('NEWP) END
"RTN","PXRMDLR2",39,0)
 ;
"RTN","PXRMDLR2",40,0)
ENR ;
"RTN","PXRMDLR2",41,0)
 K ANS D ASK(.ANS,"Display match criteria on the report? ",13) G:$D(DTOUT)&($D(DUOUT)) ENX   G:$D(DUOUT)&(NEWP) ENC G:$D(DUOUT)&('NEWP) END
"RTN","PXRMDLR2",42,0)
 I ANS="Y" S SHOWREAS=1
"RTN","PXRMDLR2",43,0)
 ;
"RTN","PXRMDLR2",44,0)
PROCESS ;
"RTN","PXRMDLR2",45,0)
 ;build list of dialogs that contains the items that were selected
"RTN","PXRMDLR2",46,0)
 D BLDLIST
"RTN","PXRMDLR2",47,0)
 I '$D(^TMP("PXRM DIALOG LISTS",$J,"DIALOG")) W !,"No parent dialogs found." K ^TMP("PXRM DIALOG LISTS",$J) Q
"RTN","PXRMDLR2",48,0)
 ;if searching all dialogs moved results to final array for the user.
"RTN","PXRMDLR2",49,0)
 I CPRSONLY=0 K ^TMP("PXRM DIALOG LISTS",$J,"COVER") D MERGE(.FINAL) G OUTPUT
"RTN","PXRMDLR2",50,0)
 ;
"RTN","PXRMDLR2",51,0)
 ;if searching for CPRS dialogs get dialogs for each users. get all templates for now.
"RTN","PXRMDLR2",52,0)
 D GETTDLST^PXRMCVRL(.TLIST)
"RTN","PXRMDLR2",53,0)
 D GETCPRSC(.FINAL)
"RTN","PXRMDLR2",54,0)
 D CPRSTDLG(.TEMPDIAL,.TLIST)
"RTN","PXRMDLR2",55,0)
 ;
"RTN","PXRMDLR2",56,0)
OUTPUT ;
"RTN","PXRMDLR2",57,0)
 I '$D(FINAL),'$D(TEMPDIAL) W !,"No Dialog Found" G ENX
"RTN","PXRMDLR2",58,0)
 D REPORT(.FINAL,.TEMPDIAL,CPRSONLY,SHOWREAS)
"RTN","PXRMDLR2",59,0)
 D PRINT
"RTN","PXRMDLR2",60,0)
ENX ;
"RTN","PXRMDLR2",61,0)
 K ^TMP("PXRM DIALOG LISTS",$J)
"RTN","PXRMDLR2",62,0)
 Q
"RTN","PXRMDLR2",63,0)
 ;
"RTN","PXRMDLR2",64,0)
 ;
"RTN","PXRMDLR2",65,0)
ADDDREAS(TYPE,IEN,REASON) ;add reason the dialog/dialog items in on the list
"RTN","PXRMDLR2",66,0)
 N CNT
"RTN","PXRMDLR2",67,0)
 I $D(^TMP("PXRM DIALOG LISTS",$J,TYPE,IEN,"SAVE REASON",REASON)) Q
"RTN","PXRMDLR2",68,0)
 S ^TMP("PXRM DIALOG LISTS",$J,TYPE,IEN,"SAVE REASON",REASON)=""
"RTN","PXRMDLR2",69,0)
 S CNT=$O(^TMP("PXRM DIALOG LISTS",$J,TYPE,IEN,"REASON",""),-1)
"RTN","PXRMDLR2",70,0)
 S CNT=CNT+1,^TMP("PXRM DIALOG LISTS",$J,TYPE,IEN,"REASON",CNT)=REASON
"RTN","PXRMDLR2",71,0)
 Q
"RTN","PXRMDLR2",72,0)
 ;
"RTN","PXRMDLR2",73,0)
ADDFREAS(TYPE,GBL,FIND,REASON) ;add the reason a finding item is on the list. For now only Taxonomies
"RTN","PXRMDLR2",74,0)
 N CNT
"RTN","PXRMDLR2",75,0)
 S CNT=$O(^TMP("PXRM DIALOG LISTS",$J,TYPE,GBL,FIND,"REASON",""),-1)
"RTN","PXRMDLR2",76,0)
 S CNT=CNT+1,^TMP("PXRM DIALOG LISTS",$J,TYPE,GBL,FIND,"REASON",CNT)=REASON
"RTN","PXRMDLR2",77,0)
 Q
"RTN","PXRMDLR2",78,0)
 ;
"RTN","PXRMDLR2",79,0)
BLDLIST ;build list of dialogs that contains the selected search items
"RTN","PXRMDLR2",80,0)
 N CODE,FIND,FIEN,GBL,IEN,ITEM,PATH,REASON,SHOWPATH
"RTN","PXRMDLR2",81,0)
 S SHOWPATH=$S($G(^TMP("PXRM DIALOG LISTS",$J,"PATH"))="Y":1,1:0)
"RTN","PXRMDLR2",82,0)
 ;find taxonomies for codes marked to be used in a dialog. Add taxonomies to the FINDING subscript
"RTN","PXRMDLR2",83,0)
 I $D(^TMP("PXRM DIALOG LISTS",$J,"CODES"))>0 S CODE="" F  S CODE=$O(^TMP("PXRM DIALOG LISTS",$J,"CODES",CODE)) Q:CODE=""  D
"RTN","PXRMDLR2",84,0)
 .S IEN=0 F  S IEN=$O(^PXD(811.2,IEN)) Q:IEN'>0  I $D(^PXD(811.2,IEN,20,"AUID",CODE))>0 D
"RTN","PXRMDLR2",85,0)
 ..S ^TMP("PXRM DIALOG LISTS",$J,"FINDING","PXD(811.2,",IEN)=""
"RTN","PXRMDLR2",86,0)
 ..D ADDFREAS("FINDING","PXD(811.2,",IEN,"Coding System: "_CODE)
"RTN","PXRMDLR2",87,0)
 ;
"RTN","PXRMDLR2",88,0)
 ;search for finding items and add dialog IEN to ITEM subscript
"RTN","PXRMDLR2",89,0)
 I $D(^TMP("PXRM DIALOG LISTS",$J,"FINDING"))>0 D GETITEMS
"RTN","PXRMDLR2",90,0)
 ;
"RTN","PXRMDLR2",91,0)
 ;search for dialog that contain the items.
"RTN","PXRMDLR2",92,0)
 I $D(^TMP("PXRM DIALOG LISTS",$J,"ITEM"))>0 D
"RTN","PXRMDLR2",93,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXRM DIALOG LISTS",$J,"ITEM",IEN)) Q:IEN'>0  D
"RTN","PXRMDLR2",94,0)
 ..S NODE=^TMP("PXRM DIALOG LISTS",$J,"ITEM",IEN)
"RTN","PXRMDLR2",95,0)
 ..S REASON="Dialog "_$$RETTYPE($P(NODE,U,4))_": "_$P(NODE,U)_U_IEN D GETDIAL(IEN,REASON)
"RTN","PXRMDLR2",96,0)
 ;
"RTN","PXRMDLR2",97,0)
 Q
"RTN","PXRMDLR2",98,0)
 ;
"RTN","PXRMDLR2",99,0)
BLDREAS(DARRAY,GBL,IEN) ;get finding item type and name
"RTN","PXRMDLR2",100,0)
 N RESULT,NAME
"RTN","PXRMDLR2",101,0)
 S RESULT=$G(DARRAY(GBL))_"."
"RTN","PXRMDLR2",102,0)
 S NAME=$P($G(@(U_GBL_IEN_",0)")),U) Q:NAME="" RESULT
"RTN","PXRMDLR2",103,0)
 Q RESULT_NAME
"RTN","PXRMDLR2",104,0)
 ;
"RTN","PXRMDLR2",105,0)
 ;find matching dialogs from a CPRS CoverSheet Parameter
"RTN","PXRMDLR2",106,0)
CPRSCOM(FINAL,DLIST,NAME) ;
"RTN","PXRMDLR2",107,0)
 N DIEN,NODE
"RTN","PXRMDLR2",108,0)
 S FINAL(NAME,"CPRS Cover Sheet Reminder")=""
"RTN","PXRMDLR2",109,0)
 S DIEN=0 F  S DIEN=$O(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)) Q:DIEN'>0  D
"RTN","PXRMDLR2",110,0)
 .S NODE=$G(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)) I $P(NODE,U)="" Q
"RTN","PXRMDLR2",111,0)
 .I $D(DLIST("REMINDER",DIEN)) S FINAL(NAME,"CPRS Cover Sheet Reminder",$P(NODE,U))=DIEN_U_$P(NODE,U,1,4)
"RTN","PXRMDLR2",112,0)
 Q
"RTN","PXRMDLR2",113,0)
 ;
"RTN","PXRMDLR2",114,0)
 ;find matching dialogs from CPRS Template List
"RTN","PXRMDLR2",115,0)
CPRSTDLG(TEMPDIAL,TLIST) ;
"RTN","PXRMDLR2",116,0)
 N DIEN,NODE
"RTN","PXRMDLR2",117,0)
 S DIEN=0 F  S DIEN=$O(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)) Q:DIEN'>0  D
"RTN","PXRMDLR2",118,0)
 .S NODE=$G(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)) I $P(NODE,U)="" Q
"RTN","PXRMDLR2",119,0)
 .I $D(TLIST("TEMPLATE",DIEN)) S TEMPDIAL($P(NODE,U))=DIEN_U_$P(NODE,U,1,4)
"RTN","PXRMDLR2",120,0)
 Q
"RTN","PXRMDLR2",121,0)
 ;
"RTN","PXRMDLR2",122,0)
CODES ;
"RTN","PXRMDLR2",123,0)
 N ALIST,CODESYS,CODE,DIR,DIROUT,DIRUT,INUM,LI,NUM,Y
"RTN","PXRMDLR2",124,0)
 D BLDCODE^PXRMDTAX("ALL",.CODESYS)
"RTN","PXRMDLR2",125,0)
 S CODE="",INUM=0 F  S CODE=$O(CODESYS(CODE)) Q:CODE=""  S INUM=INUM+1,ALIST(INUM)=INUM_" "_CODE
"RTN","PXRMDLR2",126,0)
 M DIR("A")=ALIST
"RTN","PXRMDLR2",127,0)
 S DIR("A")="Enter your list for search criteria"
"RTN","PXRMDLR2",128,0)
 S DIR(0)="LO^1:"_INUM
"RTN","PXRMDLR2",129,0)
 S DIR("??")=U_"D HELP^PXRMDLRH(7)"
"RTN","PXRMDLR2",130,0)
 W !!,"Select from the following coding systems:"
"RTN","PXRMDLR2",131,0)
 D ^DIR
"RTN","PXRMDLR2",132,0)
 I $D(DIROUT),$D(DIRUT) S DTOUT=1
"RTN","PXRMDLR2",133,0)
 I $D(DUOUT)!$D(DTOUT) Q
"RTN","PXRMDLR2",134,0)
 S NUM=$L(Y,",")-1
"RTN","PXRMDLR2",135,0)
 F IND=1:1:NUM D
"RTN","PXRMDLR2",136,0)
 . S LI=$P(Y,",",IND)
"RTN","PXRMDLR2",137,0)
 .I '$D(ALIST(LI)) Q
"RTN","PXRMDLR2",138,0)
 .S ^TMP("PXRM DIALOG LISTS",$J,"CODES",$P(ALIST(LI)," ",2))=""
"RTN","PXRMDLR2",139,0)
 Q
"RTN","PXRMDLR2",140,0)
 ;
"RTN","PXRMDLR2",141,0)
 ;build possible parameter values for CPRS CoverSheet pick lists
"RTN","PXRMDLR2",142,0)
CPRSLIST ;
"RTN","PXRMDLR2",143,0)
 N ALIST,DIR,LIST,NUM,TYPE,X
"RTN","PXRMDLR2",144,0)
 K ^TMP("PXRM DIALOG LISTS",$J,"COVER")
"RTN","PXRMDLR2",145,0)
 S NUM=0
"RTN","PXRMDLR2",146,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - Division",LIST(NUM)="DIV"
"RTN","PXRMDLR2",147,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - Location",LIST(NUM)="LOC"
"RTN","PXRMDLR2",148,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - Service",LIST(NUM)="SRV"
"RTN","PXRMDLR2",149,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - System",LIST(NUM)="SYS"
"RTN","PXRMDLR2",150,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - User",LIST(NUM)="USR"
"RTN","PXRMDLR2",151,0)
 S NUM=NUM+1,ALIST(NUM)=" "_$J(NUM,4)_" - User Class",LIST(NUM)="CLASS"
"RTN","PXRMDLR2",152,0)
 M DIR("A")=ALIST
"RTN","PXRMDLR2",153,0)
 S DIR("A")="Enter your list for the report"
"RTN","PXRMDLR2",154,0)
 S DIR(0)="LO^1:"_NUM
"RTN","PXRMDLR2",155,0)
 D ^DIR
"RTN","PXRMDLR2",156,0)
 I $D(DIROUT) S DTOUT=1
"RTN","PXRMDLR2",157,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","PXRMDLR2",158,0)
 F X=1:1:$L(Y,",")-1  D  I $D(DTOUT)!($D(DUOUT)) Q
"RTN","PXRMDLR2",159,0)
 .I $D(DTOUT)!($D(DUOUT)) Q
"RTN","PXRMDLR2",160,0)
 .S NUM=$P(Y,",",X) I NUM'>0 Q
"RTN","PXRMDLR2",161,0)
 .S TYPE=$G(LIST(NUM)) I TYPE="" Q
"RTN","PXRMDLR2",162,0)
 .I TYPE="SYS" S ^TMP("PXRM DIALOG LISTS",$J,"COVER","System",0)=TYPE Q
"RTN","PXRMDLR2",163,0)
 .I TYPE="LOC" D GETVALS("^SC(","Location",TYPE) Q
"RTN","PXRMDLR2",164,0)
 .I TYPE="USR" D GETVALS("^VA(200,","User",TYPE) Q
"RTN","PXRMDLR2",165,0)
 .I TYPE="SRV" D GETVALS("^DIC(49,","Service",TYPE) Q
"RTN","PXRMDLR2",166,0)
 .I TYPE="CLASS" D GETVALS("^USR(8930,","User Class",TYPE) Q
"RTN","PXRMDLR2",167,0)
 .I TYPE="DIV" D GETVALS("^AUTTLOC(","Division",TYPE) Q
"RTN","PXRMDLR2",168,0)
 Q
"RTN","PXRMDLR2",169,0)
 ;
"RTN","PXRMDLR2",170,0)
DIALOG ;
"RTN","PXRMDLR2",171,0)
 N ANS,DIC
"RTN","PXRMDLR2",172,0)
 S DIC="^PXRMD(801.41,"
"RTN","PXRMDLR2",173,0)
 S DIC(0)="AEMQ"
"RTN","PXRMDLR2",174,0)
 S DIC("A")="Select Dialog Definition: "
"RTN","PXRMDLR2",175,0)
 D SELECT("ITEM",.DIC)
"RTN","PXRMDLR2",176,0)
 Q
"RTN","PXRMDLR2",177,0)
 ;
"RTN","PXRMDLR2",178,0)
FINDING ;
"RTN","PXRMDLR2",179,0)
 N FNUM,GBL,GNAME,IND,ITEMLIST,LI,LIST,NUM,SOURCE
"RTN","PXRMDLR2",180,0)
 S SOURCE("DIALOG")=""
"RTN","PXRMDLR2",181,0)
 ;called to determine what finding types to search for
"RTN","PXRMDLR2",182,0)
 D FSEL^PXRMFRPT(.FNUM,.GBL,.GNAME,.SOURCE,.LIST)
"RTN","PXRMDLR2",183,0)
 S NUM=$L(LIST,",")-1
"RTN","PXRMDLR2",184,0)
 I NUM=0 Q
"RTN","PXRMDLR2",185,0)
 ;called to determine individual finding items or all finding items for a type to search for.
"RTN","PXRMDLR2",186,0)
 D ISEL^PXRMFRPT(.FNUM,.GBL,.GNAME,.LIST,.ITEMLIST)
"RTN","PXRMDLR2",187,0)
 I '$D(ITEMLIST) Q
"RTN","PXRMDLR2",188,0)
 F IND=1:1:NUM D
"RTN","PXRMDLR2",189,0)
 . S LI=$P(LIST,",",IND)
"RTN","PXRMDLR2",190,0)
 . I '$D(ITEMLIST(FNUM(LI))) S ^TMP("PXRM DIALOG LISTS",$J,"FINDING",GBL(LI),"ALL")="" Q
"RTN","PXRMDLR2",191,0)
 . I $D(ITEMLIST(FNUM(LI))) D
"RTN","PXRMDLR2",192,0)
 .. S FIEN=""
"RTN","PXRMDLR2",193,0)
 .. F  S FIEN=$O(ITEMLIST(FNUM(LI),FIEN)) Q:FIEN=""  S ^TMP("PXRM DIALOG LISTS",$J,"FINDING",GBL(LI),FIEN)=""
"RTN","PXRMDLR2",194,0)
 Q
"RTN","PXRMDLR2",195,0)
 ;
"RTN","PXRMDLR2",196,0)
GETCPRSL(DLIST,USER,LOC) ;
"RTN","PXRMDLR2",197,0)
 N CNT
"RTN","PXRMDLR2",198,0)
 D GETDLIST^PXRMCVRL(.DLIST,USER,$G(LOC))
"RTN","PXRMDLR2",199,0)
 Q
"RTN","PXRMDLR2",200,0)
 ;
"RTN","PXRMDLR2",201,0)
 ;loop through CPRS coversheet parameter to find CPRS dialogs.
"RTN","PXRMDLR2",202,0)
GETCPRSC(FINAL) ;
"RTN","PXRMDLR2",203,0)
 N CLASS,DIALOGS,LVL,NAME,TEMP,TYPE
"RTN","PXRMDLR2",204,0)
 S TYPE="" F  S TYPE=$O(^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE)) Q:TYPE=""  D
"RTN","PXRMDLR2",205,0)
 .S NAME="" F  S NAME=$O(^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,NAME)) Q:NAME=""  D
"RTN","PXRMDLR2",206,0)
 ..S LVL=$G(^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,NAME)) Q:LVL=""
"RTN","PXRMDLR2",207,0)
 ..K DIALOGS
"RTN","PXRMDLR2",208,0)
 ..I TYPE'="User Class" D GETLVRD^PXRMCVRL(.DIALOGS,LVL,"")
"RTN","PXRMDLR2",209,0)
 ..I TYPE="User Class" D GETLVRD^PXRMCVRL(.DIALOGS,"CLASS",LVL)
"RTN","PXRMDLR2",210,0)
 ..I TYPE="Package"!(TYPE="System") S TEMP=TYPE
"RTN","PXRMDLR2",211,0)
 ..E  S TEMP=TYPE_" ("_NAME_")"
"RTN","PXRMDLR2",212,0)
 ..D CPRSCOM(.FINAL,.DIALOGS,TEMP)
"RTN","PXRMDLR2",213,0)
 Q
"RTN","PXRMDLR2",214,0)
 ;
"RTN","PXRMDLR2",215,0)
GETDIAL(IEN,REASON) ; recurrsive function that follows up the AD cross-references 
"RTN","PXRMDLR2",216,0)
 ;until either the item is not used or a dialog is reached
"RTN","PXRMDLR2",217,0)
 N CNT,NODE,DIEN,OIEN
"RTN","PXRMDLR2",218,0)
 S NODE=$G(^PXRMD(801.41,IEN,0))
"RTN","PXRMDLR2",219,0)
 ;S CNT=$O(PATH(""),-1) S CNT=CNT+1,PATH(CNT)=NODE
"RTN","PXRMDLR2",220,0)
 I $P($G(NODE),U,4)="R" S ^TMP("PXRM DIALOG LISTS",$J,"DIALOG",IEN)=NODE D ADDDREAS("DIALOG",IEN,REASON) Q
"RTN","PXRMDLR2",221,0)
 I $P($G(NODE),U,4)="S" D  Q
"RTN","PXRMDLR2",222,0)
 .S DIEN=0 F  S DIEN=$O(^PXRMD(801.41,"RG",IEN,DIEN)) Q:DIEN'>0  D
"RTN","PXRMDLR2",223,0)
 ..;checked for result group attached to a dialog. This should not happened. Just a safety check
"RTN","PXRMDLR2",224,0)
 ..S NODE=$G(^PXRMD(801.41,DIEN,0))
"RTN","PXRMDLR2",225,0)
 ..I $P($G(NODE),U,4)="R" S ^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)=NODE D ADDDREAS("DIALOG",DIEN,REASON) Q
"RTN","PXRMDLR2",226,0)
 ..D GETDIAL(DIEN,REASON)
"RTN","PXRMDLR2",227,0)
 ;search everything else
"RTN","PXRMDLR2",228,0)
 S DIEN=0,OIEN=0 F  S DIEN=$O(^PXRMD(801.41,"AD",IEN,DIEN)) Q:DIEN'>0  D
"RTN","PXRMDLR2",229,0)
 .S NODE=$G(^PXRMD(801.41,DIEN,0))
"RTN","PXRMDLR2",230,0)
 .I $P($G(NODE),U,4)="R" S ^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)=NODE D ADDDREAS("DIALOG",DIEN,REASON) Q
"RTN","PXRMDLR2",231,0)
 .D GETDIAL(DIEN,REASON)
"RTN","PXRMDLR2",232,0)
 Q
"RTN","PXRMDLR2",233,0)
GETITEMS ;
"RTN","PXRMDLR2",234,0)
 N DARRAY,FIND,FIEN,GBL,IEN,NODE,REASON,SUB
"RTN","PXRMDLR2",235,0)
 ;
"RTN","PXRMDLR2",236,0)
 S DARRAY("AUTTEDT(")="ED"
"RTN","PXRMDLR2",237,0)
 S DARRAY("AUTTEXAM(")="EX"
"RTN","PXRMDLR2",238,0)
 S DARRAY("AUTTHF(")="HF"
"RTN","PXRMDLR2",239,0)
 S DARRAY("AUTTIMM(")="IM"
"RTN","PXRMDLR2",240,0)
 S DARRAY("AUTTSK(")="ST"
"RTN","PXRMDLR2",241,0)
 S DARRAY("GMRD(120.51,")="VM"
"RTN","PXRMDLR2",242,0)
 S DARRAY("ORD(101.41,")="Q"
"RTN","PXRMDLR2",243,0)
 S DARRAY("YTT(601.71,")="MH"
"RTN","PXRMDLR2",244,0)
 S DARRAY("WV(790.404,")="WH"
"RTN","PXRMDLR2",245,0)
 S DARRAY("WV(790.1,")="WHR"
"RTN","PXRMDLR2",246,0)
 S DARRAY("PXD(811.2,")="TX"
"RTN","PXRMDLR2",247,0)
 ;
"RTN","PXRMDLR2",248,0)
 S SUB="PXRM DIALOG FINDINGS LIST"
"RTN","PXRMDLR2",249,0)
 K ^TMP($J,SUB)
"RTN","PXRMDLR2",250,0)
 D FARRAY^PXRMDUTL(SUB,"EGS") I '$D(^TMP($J,SUB)) W !,"Problem building finding list" K ^TMP($J,SUB) Q
"RTN","PXRMDLR2",251,0)
 S GBL="" F  S GBL=$O(^TMP("PXRM DIALOG LISTS",$J,"FINDING",GBL)) Q:GBL=""  D
"RTN","PXRMDLR2",252,0)
 .S FIND="" F  S FIND=$O(^TMP("PXRM DIALOG LISTS",$J,"FINDING",GBL,FIND)) Q:FIND=""  D
"RTN","PXRMDLR2",253,0)
 ..;find dialog items for individaul findings for a gobal
"RTN","PXRMDLR2",254,0)
 ..I +FIND>0 D  Q
"RTN","PXRMDLR2",255,0)
 ...S IEN=0 F  S IEN=$O(^TMP($J,SUB,GBL,FIND,IEN)) Q:IEN'>0  D
"RTN","PXRMDLR2",256,0)
 ....S NODE=$G(^PXRMD(801.41,IEN,0)),^TMP("PXRM DIALOG LISTS",$J,"ITEM",IEN)=NODE D
"RTN","PXRMDLR2",257,0)
 .....S REASON=$$BLDREAS(.DARRAY,GBL,FIND)
"RTN","PXRMDLR2",258,0)
 .....D ADDDREAS("ITEM",IEN,"Finding: "_REASON_U_FIND_";"_GBL)
"RTN","PXRMDLR2",259,0)
 ..;find dialog items for all finding for a gobal
"RTN","PXRMDLR2",260,0)
 ..I FIND="ALL" D  Q
"RTN","PXRMDLR2",261,0)
 ...S FIEN=0 F  S FIEN=$O(^TMP($J,SUB,GBL,FIEN)) Q:FIEN'>0  D
"RTN","PXRMDLR2",262,0)
 ....S IEN=0 F  S IEN=$O(^TMP($J,SUB,GBL,FIEN,IEN)) Q:IEN'>0  D
"RTN","PXRMDLR2",263,0)
 .....S NODE=$G(^PXRMD(801.41,IEN,0)),^TMP("PXRM DIALOG LISTS",$J,"ITEM",IEN)=NODE D
"RTN","PXRMDLR2",264,0)
 ......S REASON=$$BLDREAS(.DARRAY,GBL,FIEN)
"RTN","PXRMDLR2",265,0)
 ......D ADDDREAS("ITEM",IEN,"Finding: "_REASON_U_FIEN_";"_GBL)
"RTN","PXRMDLR2",266,0)
 K ^TMP($J,SUB)
"RTN","PXRMDLR2",267,0)
 Q
"RTN","PXRMDLR2",268,0)
 ;
"RTN","PXRMDLR2",269,0)
GETVALS(GBL,TYPE,INST) ;
"RTN","PXRMDLR2",270,0)
 N DIC,NUM,X
"RTN","PXRMDLR2",271,0)
 S DIC=GBL
"RTN","PXRMDLR2",272,0)
 S DIC(0)="AEMQ"
"RTN","PXRMDLR2",273,0)
 S DIC("A")="Select "_TYPE_": "
"RTN","PXRMDLR2",274,0)
 D SELECT(TYPE,.DIC,INST)
"RTN","PXRMDLR2",275,0)
 Q
"RTN","PXRMDLR2",276,0)
 ;
"RTN","PXRMDLR2",277,0)
MERGE(FINAL) ;
"RTN","PXRMDLR2",278,0)
 N DIEN,NAME,NODE
"RTN","PXRMDLR2",279,0)
 S NAME=$$GET1^DIQ(200,DUZ,.01)
"RTN","PXRMDLR2",280,0)
 S DIEN=0 F  S DIEN=$O(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)) Q:DIEN'>0  D
"RTN","PXRMDLR2",281,0)
 .S NODE=^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN)
"RTN","PXRMDLR2",282,0)
 .S FINAL(NAME,"Reminder Dialog",$P(NODE,U))=DIEN_U_$P(NODE,U,1,4)
"RTN","PXRMDLR2",283,0)
 Q
"RTN","PXRMDLR2",284,0)
 ;
"RTN","PXRMDLR2",285,0)
PRINT ;
"RTN","PXRMDLR2",286,0)
 N ANS,BOP,X
"RTN","PXRMDLR2",287,0)
 S BOP=$$BORP^PXRMUTIL("B")
"RTN","PXRMDLR2",288,0)
 I BOP="B" D
"RTN","PXRMDLR2",289,0)
 . S X="IORESET"
"RTN","PXRMDLR2",290,0)
 . D ENDR^%ZISS
"RTN","PXRMDLR2",291,0)
 . D BROWSE^DDBR("^TMP(""PXRMXMZ"",$J)","NR","Reminder Dialog Search Report")
"RTN","PXRMDLR2",292,0)
 . W IORESET
"RTN","PXRMDLR2",293,0)
 . D KILL^%ZISS
"RTN","PXRMDLR2",294,0)
 I BOP="P" D GPRINT^PXRMUTIL("^TMP(""PXRMXMZ"",$J)")
"RTN","PXRMDLR2",295,0)
 ;Ask the user if they want the report delivered through MailMan.
"RTN","PXRMDLR2",296,0)
 S ANS=$$ASKYN^PXRMEUT("N","Deliver the report as a MailMan message")
"RTN","PXRMDLR2",297,0)
 I ANS="1" D
"RTN","PXRMDLR2",298,0)
 . S TO(DUZ)=""
"RTN","PXRMDLR2",299,0)
 . D SEND^PXRMMSG("PXRMXMZ","Clinical Reminders Dialog Search Report",.TO,DUZ)
"RTN","PXRMDLR2",300,0)
 Q
"RTN","PXRMDLR2",301,0)
 ;
"RTN","PXRMDLR2",302,0)
PROMPTS(ITEM) ;
"RTN","PXRMDLR2",303,0)
 N ANS,EXT,GUIID,IEN,NUM,NAME,TYPE
"RTN","PXRMDLR2",304,0)
 S IEN=+Y,NAME=$P(ITEM,U,2),TYPE=$P($G(^PXRMD(801.41,IEN,0)),U,4)
"RTN","PXRMDLR2",305,0)
 I "PF"'[TYPE Q
"RTN","PXRMDLR2",306,0)
 S EXT=$S(TYPE="P":"Prompt",TYPE="F":"Forced Value",1:"") I EXT="" Q
"RTN","PXRMDLR2",307,0)
 D ASK(.ANS,NAME_" is a "_EXT_" search for all "_EXT_" of the same type? ",14) I $D(DTOUT)!($D(DUOUT)) Q
"RTN","PXRMDLR2",308,0)
 I ANS'="Y" Q
"RTN","PXRMDLR2",309,0)
 S GUIID=+$G(^PXRMD(801.41,IEN,46)) I GUIID'>0 Q
"RTN","PXRMDLR2",310,0)
 S NUM=0 F  S NUM=$O(^PXRMD(801.41,NUM)) Q:NUM'>0  D
"RTN","PXRMDLR2",311,0)
 .I +$G(^PXRMD(801.41,NUM,46))'=GUIID Q
"RTN","PXRMDLR2",312,0)
 .S ^TMP("PXRM DIALOG LISTS",$J,"ITEM",NUM)=$P($G(^PXRMD(801.41,NUM,0)),U)
"RTN","PXRMDLR2",313,0)
 .W !,$P($G(^PXRMD(801.41,NUM,0)),U)_" added as search criteria."
"RTN","PXRMDLR2",314,0)
 Q
"RTN","PXRMDLR2",315,0)
 ;
"RTN","PXRMDLR2",316,0)
REASONP(ITEM,NL,START) ;
"RTN","PXRMDLR2",317,0)
 N CNT,FIND,IEN,IND,NODE,NOUT,TAB,TEMP,TEXT,TEXTOUT
"RTN","PXRMDLR2",318,0)
 I ITEM[";" S IEN=$P(ITEM,";"),FIND=$P(ITEM,";",2)
"RTN","PXRMDLR2",319,0)
 I ITEM'[";" S IEN=ITEM
"RTN","PXRMDLR2",320,0)
 S TEMP=$S(START="DIALOG":"ITEM",START="ITEM":"FINDING",1:"")
"RTN","PXRMDLR2",321,0)
 I START="FINDING" D  Q
"RTN","PXRMDLR2",322,0)
 .S CNT=0
"RTN","PXRMDLR2",323,0)
 .F  S CNT=$O(^TMP("PXRM DIALOG LISTS",$J,START,FIND,IEN,"REASON",CNT)) Q:CNT'>0  D
"RTN","PXRMDLR2",324,0)
 ..S NODE=$G(^TMP("PXRM DIALOG LISTS",$J,START,FIND,IEN,"REASON",CNT)) Q:NODE=""
"RTN","PXRMDLR2",325,0)
 ..S TEXT=NODE
"RTN","PXRMDLR2",326,0)
 ..D FORMATS^PXRMTEXT(10,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMDLR2",327,0)
 ..F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMDLR2",328,0)
 S CNT=0
"RTN","PXRMDLR2",329,0)
 F  S CNT=$O(^TMP("PXRM DIALOG LISTS",$J,START,IEN,"REASON",CNT)) Q:CNT'>0  D
"RTN","PXRMDLR2",330,0)
 .S NODE=$G(^TMP("PXRM DIALOG LISTS",$J,START,IEN,"REASON",CNT))
"RTN","PXRMDLR2",331,0)
 .S TEXT=$P(NODE,U)
"RTN","PXRMDLR2",332,0)
 .S TAB=$S(TEMP="ITEM":7,1:9)
"RTN","PXRMDLR2",333,0)
 .D FORMATS^PXRMTEXT(TAB,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMDLR2",334,0)
 .F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMDLR2",335,0)
 .I TEMP="" Q
"RTN","PXRMDLR2",336,0)
 .I START="DIALOG",$D(^TMP("PXRM DIALOG LISTS",$J,TEMP,$P(NODE,U,2),"REASON")) D REASONP($P(NODE,U,2),.NL,TEMP) Q
"RTN","PXRMDLR2",337,0)
 .I START="ITEM",$D(^TMP("PXRM DIALOG LISTS",$J,TEMP,$P($P(NODE,U,2),";",2),$P($P(NODE,U,2),";"),"REASON")) D REASONP($P(NODE,U,2),.NL,TEMP) Q
"RTN","PXRMDLR2",338,0)
 Q
"RTN","PXRMDLR2",339,0)
 ;
"RTN","PXRMDLR2",340,0)
REPORT(FINAL,TEMPDIAL,CPRSONLY,SHOWREAS) ;
"RTN","PXRMDLR2",341,0)
 N DIEN,CNT,FIRST,GROUP,HEADER,IND,LOCN,NAME,NL,NODE,NOUT,PATH,TEXT,TEXTOUT,X
"RTN","PXRMDLR2",342,0)
 ;FINAL(GROUP,"CPRS Cover Sheet Reminder",$P(NODE,U,4))=DIEN_U_$P(NODE,U,1,4)
"RTN","PXRMDLR2",343,0)
 ;FINAL(GROUP,"CPRS Template",$P(NODE,U,4))=DIEN_U_$P(NODE,U,1,4)
"RTN","PXRMDLR2",344,0)
 S NL=1,^TMP("PXRMXMZ",$J,NL,0)="Clinical Reminders Dialogs search report."
"RTN","PXRMDLR2",345,0)
 S FIRST=1
"RTN","PXRMDLR2",346,0)
 S GROUP="" F  S GROUP=$O(FINAL(GROUP)) Q:GROUP=""  D
"RTN","PXRMDLR2",347,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMDLR2",348,0)
 . I CPRSONLY=0 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="Reminder Dialogs:"
"RTN","PXRMDLR2",349,0)
 . I CPRSONLY=1 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="CPRS Cover Sheet Reminder Dialogs for "_GROUP_":"
"RTN","PXRMDLR2",350,0)
 .S CNT=0
"RTN","PXRMDLR2",351,0)
 .;write CPRS Cover Sheet or report on all dialogs
"RTN","PXRMDLR2",352,0)
 .F X="CPRS Cover Sheet Reminder","Reminder Dialog" D
"RTN","PXRMDLR2",353,0)
 ..I '$D(FINAL(GROUP,X)) Q
"RTN","PXRMDLR2",354,0)
 ..S NAME="" F  S NAME=$O(FINAL(GROUP,X,NAME)) Q:NAME=""  D
"RTN","PXRMDLR2",355,0)
 ...I SHOWREAS=1 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMDLR2",356,0)
 ...S TEXT="Dialog: "_NAME,CNT=CNT+1
"RTN","PXRMDLR2",357,0)
 ...D FORMATS^PXRMTEXT(5,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMDLR2",358,0)
 ...F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMDLR2",359,0)
 ...S DIEN=$P($G(FINAL(GROUP,X,NAME)),U)
"RTN","PXRMDLR2",360,0)
 ...I SHOWREAS=1,$D(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN,"REASON")) D
"RTN","PXRMDLR2",361,0)
 ....S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="     Match Criteria:" D REASONP(DIEN,.NL,"DIALOG")
"RTN","PXRMDLR2",362,0)
 .I CNT=0 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="    None Found"
"RTN","PXRMDLR2",363,0)
 I CPRSONLY=0 Q
"RTN","PXRMDLR2",364,0)
 ;write templates with reminder dialogs.
"RTN","PXRMDLR2",365,0)
 ;S CNT=0 W !!!,"CPRS Template Dialogs: "
"RTN","PXRMDLR2",366,0)
 S CNT=0,NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="",NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMDLR2",367,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="CPRS Template Dialogs: "
"RTN","PXRMDLR2",368,0)
 S NAME="" F  S NAME=$O(TEMPDIAL(NAME)) Q:NAME=""  D
"RTN","PXRMDLR2",369,0)
 .S TEXT="Dialog: "_NAME,CNT=CNT+1
"RTN","PXRMDLR2",370,0)
 .D FORMATS^PXRMTEXT(5,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMDLR2",371,0)
 .F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMDLR2",372,0)
 .S DIEN=$P($G(TEMPDIAL(NAME)),U)
"RTN","PXRMDLR2",373,0)
 .I SHOWREAS=1,$D(^TMP("PXRM DIALOG LISTS",$J,"DIALOG",DIEN,"REASON")) D
"RTN","PXRMDLR2",374,0)
 ..S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="     Match Criteria:" D REASONP(DIEN,.NL,"DIALOG")
"RTN","PXRMDLR2",375,0)
 I CNT=0 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="    None Found"
"RTN","PXRMDLR2",376,0)
 ;
"RTN","PXRMDLR2",377,0)
 Q
"RTN","PXRMDLR2",378,0)
 ;
"RTN","PXRMDLR2",379,0)
RETTYPE(T) ;
"RTN","PXRMDLR2",380,0)
 N RESULT
"RTN","PXRMDLR2",381,0)
 S RESULT=$S(T="E":"Element",T="G":"Group",T="P":"Prompt",T="F":"Forced Value",T="S":"Result Group",T="T":"Result Element","R":"Dialog",1:"")
"RTN","PXRMDLR2",382,0)
 Q RESULT
"RTN","PXRMDLR2",383,0)
 ;
"RTN","PXRMDLR2",384,0)
SELECT(TYPE,DIC,INST) ;
"RTN","PXRMDLR2",385,0)
 N CNT,NAME,SEL,Y
"RTN","PXRMDLR2",386,0)
 S SEL=1
"RTN","PXRMDLR2",387,0)
 W !
"RTN","PXRMDLR2",388,0)
 F  Q:'SEL  D
"RTN","PXRMDLR2",389,0)
 . D ^DIC
"RTN","PXRMDLR2",390,0)
 . I ($D(DTOUT))!($D(DUOUT)) S SEL=0 Q
"RTN","PXRMDLR2",391,0)
 . I Y=-1 S SEL=0 Q
"RTN","PXRMDLR2",392,0)
 . I TYPE="User" S ^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,$P(Y,U,2))=INST_".`"_+Y Q
"RTN","PXRMDLR2",393,0)
 . I TYPE="Location" S ^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,$P(Y,U,2))=INST_".`"_+Y Q
"RTN","PXRMDLR2",394,0)
 . I TYPE="Service" S ^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,$P(Y,U,2))=INST_".`"_+Y Q
"RTN","PXRMDLR2",395,0)
 . I TYPE="User Class" S ^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,$P(Y,U,2))=Y Q
"RTN","PXRMDLR2",396,0)
 . I TYPE="Division" D
"RTN","PXRMDLR2",397,0)
 ..S NAME=$$GET1^DIQ(4,+Y,.01,"I"),^TMP("PXRM DIALOG LISTS",$J,"COVER",TYPE,NAME)=INST_".`"_+Y Q
"RTN","PXRMDLR2",398,0)
 . ;I TYPE'="USER" S ^TMP("PXRM DIALOG LISTS",$J,TYPE,+Y)=$P(Y,U,2)
"RTN","PXRMDLR2",399,0)
 . ;I TYPE="LOCATION" S SEL=0 Q
"RTN","PXRMDLR2",400,0)
 . S ^TMP("PXRM DIALOG LISTS",$J,TYPE,+Y)=$P(Y,U,2)
"RTN","PXRMDLR2",401,0)
 . I TYPE="ITEM" D PROMPTS(Y)
"RTN","PXRMDLR2",402,0)
 . I TYPE="USER" S ^TMP("PXRM DIALOG LISTS",$J,TYPE,$P(Y,U,2))=Y
"RTN","PXRMDLR2",403,0)
 Q
"RTN","PXRMDLR2",404,0)
 ;
"RTN","PXRMDLRH")
0^4^B17136839^n/a
"RTN","PXRMDLRH",1,0)
PXRMDLRH ; SLC/AGP - Dialog Report Help Routine; 01/13/2015
"RTN","PXRMDLRH",2,0)
 ;;2.0;CLINICAL REMINDERS;**53**;Feb 04, 2005;Build 225
"RTN","PXRMDLRH",3,0)
 ; 
"RTN","PXRMDLRH",4,0)
 ; Called from PXRM PATIENT LIST CREATE protocol
"RTN","PXRMDLRH",5,0)
 ;
"RTN","PXRMDLRH",6,0)
HELP(CALL) ;General help text routine
"RTN","PXRMDLRH",7,0)
 N HTEXT
"RTN","PXRMDLRH",8,0)
 ;
"RTN","PXRMDLRH",9,0)
 I CALL=6 D
"RTN","PXRMDLRH",10,0)
 .S HTEXT(1)="Enter 'Y' to build a list of coding systems. "
"RTN","PXRMDLRH",11,0)
 .S HTEXT(2)="This list will be used to find taxonomies with at least one code from the selected coding system marked to be used in a dialog. "
"RTN","PXRMDLRH",12,0)
 .S HTEXT(3)="Enter 'N' to not search for coding systems."
"RTN","PXRMDLRH",13,0)
 ;
"RTN","PXRMDLRH",14,0)
 I CALL=7 D
"RTN","PXRMDLRH",15,0)
 .S HTEXT(1)="Select a list of coding systems to search for taxonomies containing code marked to be used in a dialog for the selected coding system."
"RTN","PXRMDLRH",16,0)
 ;
"RTN","PXRMDLRH",17,0)
 I CALL=8 D
"RTN","PXRMDLRH",18,0)
 .S HTEXT(1)="Enter 'Y' to build a list of Finding Items for which to search. "
"RTN","PXRMDLRH",19,0)
 .S HTEXT(2)="This list of items will be used to find dialogs in which they are contained in either the Finding Item, Additional Finding Items or a Result Group MH Test field. "
"RTN","PXRMDLRH",20,0)
 .S HTEXT(3)="Enter 'N' to not search for finding items."
"RTN","PXRMDLRH",21,0)
 ;
"RTN","PXRMDLRH",22,0)
 I CALL=9 D
"RTN","PXRMDLRH",23,0)
 .S HTEXT(1)="Enter 'Y' to build a list of dialog items (Element, Group, Prompt, Forced Value, Result Group, Result Element) for which to search. "
"RTN","PXRMDLRH",24,0)
 .S HTEXT(2)="This list will be used to find parent dialog(s) in which they are contained. Enter 'N' to not look for dialog items."
"RTN","PXRMDLRH",25,0)
 ;
"RTN","PXRMDLRH",26,0)
 I CALL=10 D
"RTN","PXRMDLRH",27,0)
 .S HTEXT(1)="Enter 'Y' to search for dialogs used on a CPRS CoverSheet by User(s) and dialogs assigned as a TIU Template. Enter 'N' to search all dialog."
"RTN","PXRMDLRH",28,0)
 ;
"RTN","PXRMDLRH",29,0)
 I CALL=11 D
"RTN","PXRMDLRH",30,0)
 .S HTEXT(1)="Enter 'Y' to search for specific CPRS CoverSheet List."
"RTN","PXRMDLRH",31,0)
 ;
"RTN","PXRMDLRH",32,0)
 I CALL=12 D
"RTN","PXRMDLRH",33,0)
 .S HTEXT(1)="Enter 'Y' to search for a specific CPRS CoverSheet Location for each requested parameter(s). Enter 'N' to not restrict the CPRS CoverSheet to a location."
"RTN","PXRMDLRH",34,0)
 ;
"RTN","PXRMDLRH",35,0)
 I CALL=13 D
"RTN","PXRMDLRH",36,0)
 .S HTEXT(1)="Enter 'Y' to display which search criteria was found in the dialog. This information will be displayed with the dialog name in report output under the Match Criteria heading. Enter 'N' to display the dialog name only."
"RTN","PXRMDLRH",37,0)
 ;
"RTN","PXRMDLRH",38,0)
 I CALL=14 D
"RTN","PXRMDLRH",39,0)
 .S HTEXT(1)="Enter 'Y' to add all prompts and forced values of the same type as the selected Prompt/Forced Value to the search criteria list. Enter 'N' to only search for the specific selected Prompt/Forced Value."
"RTN","PXRMDLRH",40,0)
 ;
"RTN","PXRMDLRH",41,0)
 D HELP^PXRMEUT(.HTEXT)
"RTN","PXRMDLRH",42,0)
 Q
"RTN","PXRMDLRH",43,0)
 ;
"RTN","PXRMDUTL")
0^6^B11560292^B11502615
"RTN","PXRMDUTL",1,0)
PXRMDUTL ; SLC/AGP - DIALOG UTILITIES. ;04/10/2013
"RTN","PXRMDUTL",2,0)
 ;;2.0;CLINICAL REMINDERS;**24,26,53**;Feb 04, 2005;Build 225
"RTN","PXRMDUTL",3,0)
 Q
"RTN","PXRMDUTL",4,0)
 ;
"RTN","PXRMDUTL",5,0)
 ;==========================================
"RTN","PXRMDUTL",6,0)
ALLOWDEL(IEN) ; check to see if the item can be deleted
"RTN","PXRMDUTL",7,0)
 N CLASS,TYPE
"RTN","PXRMDUTL",8,0)
 S TYPE=$P($G(^PXRMD(801.41,IEN,0)),U,4)
"RTN","PXRMDUTL",9,0)
 S CLASS=$P($G(^PXRMD(801.41,IEN,100)),U)
"RTN","PXRMDUTL",10,0)
 I (CLASS="N")&((TYPE="P")!(TYPE="F")) Q 0
"RTN","PXRMDUTL",11,0)
 Q 1
"RTN","PXRMDUTL",12,0)
 ;
"RTN","PXRMDUTL",13,0)
DELD(DIEN) ; delete the dialog item
"RTN","PXRMDUTL",14,0)
 N ARRAY,CNT,DARRAY,DA,DIK,PXRMINST
"RTN","PXRMDUTL",15,0)
 S CNT=0
"RTN","PXRMDUTL",16,0)
 D DITEMAR(DIEN,.ARRAY,.DARRAY,.CNT)
"RTN","PXRMDUTL",17,0)
 S PXRMINST=1
"RTN","PXRMDUTL",18,0)
 S DIK="^PXRMD(801.41,"
"RTN","PXRMDUTL",19,0)
 S CNT="" F  S CNT=$O(ARRAY(CNT),-1) Q:CNT=""  D
"RTN","PXRMDUTL",20,0)
 .S DA=$O(ARRAY(CNT,"")) Q:DA'>0
"RTN","PXRMDUTL",21,0)
 .I $$ALLOWDEL(DA)=0 Q
"RTN","PXRMDUTL",22,0)
 .D ^DIK
"RTN","PXRMDUTL",23,0)
 Q
"RTN","PXRMDUTL",24,0)
 ;
"RTN","PXRMDUTL",25,0)
 ; builds an array of items beneath the dialog item, lowest item first.
"RTN","PXRMDUTL",26,0)
DITEMAR(DIEN,ARRAY,DARRAY,DCNT) ;
"RTN","PXRMDUTL",27,0)
 ;  DIEN is the IEN of the dialog top level
"RTN","PXRMDUTL",28,0)
 ;  Array contains the dialog elements and groups within the dialog.
"RTN","PXRMDUTL",29,0)
 N CNT,IEN,REPIEN,TYPE
"RTN","PXRMDUTL",30,0)
 S CNT=0 F  S CNT=$O(^PXRMD(801.41,DIEN,10,CNT)) Q:CNT'>0  D
"RTN","PXRMDUTL",31,0)
 .S IEN=$P($G(^PXRMD(801.41,DIEN,10,CNT,0)),U,2) Q:IEN'>0
"RTN","PXRMDUTL",32,0)
 .S REPIEN=$P($G(^PXRMD(801.41,IEN,49)),U,3)
"RTN","PXRMDUTL",33,0)
 .I REPIEN>0 D DITEMAR(REPIEN,.ARRAY,.DARRAY,.DCNT)
"RTN","PXRMDUTL",34,0)
 .S TYPE=$P($G(^PXRMD(801.41,IEN,0)),U,4)
"RTN","PXRMDUTL",35,0)
 .I TYPE="G"!(TYPE="E") D DITEMAR(IEN,.ARRAY,.DARRAY,.DCNT)
"RTN","PXRMDUTL",36,0)
 .I '$D(DARRAY(IEN)) S DARRAY(IEN)="",DCNT=DCNT+1,ARRAY(DCNT,IEN)=""
"RTN","PXRMDUTL",37,0)
 I '$D(DARRAY(DIEN)) S DARRAY(DIEN)="",DCNT=DCNT+1,ARRAY(DCNT,DIEN)=""
"RTN","PXRMDUTL",38,0)
 Q
"RTN","PXRMDUTL",39,0)
 ;
"RTN","PXRMDUTL",40,0)
DMAKENAT(DA) ; sets the class field and renamed to the correct national format
"RTN","PXRMDUTL",41,0)
 N CLASS,DIE,DR,IEN,NAME,NEWNAME,PREFIX,TYPE
"RTN","PXRMDUTL",42,0)
 S NAME=$P($G(^PXRMD(801.41,DA,0)),U)
"RTN","PXRMDUTL",43,0)
 I $E(NAME,1,3)="VA-"!($E(NAME,1,4)="PXRM") Q
"RTN","PXRMDUTL",44,0)
 S CLASS="N"
"RTN","PXRMDUTL",45,0)
 S DIE="^PXRMXD(801.41,"
"RTN","PXRMDUTL",46,0)
 S DR="100////^S X=CLASS"
"RTN","PXRMDUTL",47,0)
 D ^DIE
"RTN","PXRMDUTL",48,0)
 S TYPE=$P($G(^PXRMD(801.41,DA,0)),U,4)
"RTN","PXRMDUTL",49,0)
 S PREFIX=$S(TYPE="R":"VA-",TYPE="G":"VA-",TYPE="E":"VA-",1:"PXRM ")
"RTN","PXRMDUTL",50,0)
 S NEWNAME=PREFIX_NAME
"RTN","PXRMDUTL",51,0)
 D RENAME^PXRMUTIL(801.41,NAME,NEWNAME)
"RTN","PXRMDUTL",52,0)
 Q
"RTN","PXRMDUTL",53,0)
 ;
"RTN","PXRMDUTL",54,0)
 ;=============================================================
"RTN","PXRMDUTL",55,0)
 ; Build a TEMP global of findings for dialog types
"RTN","PXRMDUTL",56,0)
 ; Input a string of characters for the dialog type field.
"RTN","PXRMDUTL",57,0)
 ;    example "EGS" = search element, groups, result groups
"RTN","PXRMDUTL",58,0)
 ; Output an array by finding types, Finding IEN, Dialog IEN, "F" or "A"
"RTN","PXRMDUTL",59,0)
 ;    example OUT("AUTTHF(",608,631,"F")=""
"RTN","PXRMDUTL",60,0)
FARRAY(SUB,TYPES) ;
"RTN","PXRMDUTL",61,0)
 N AFIEN,AFIND,DIEN,FIND,NODE,OI,TYPE,X
"RTN","PXRMDUTL",62,0)
 K ^TMP($J,SUB)
"RTN","PXRMDUTL",63,0)
 F X=1:1:$L(TYPES)  S TYPE=$E(TYPES,X) D 
"RTN","PXRMDUTL",64,0)
 .S DIEN=""
"RTN","PXRMDUTL",65,0)
 .F  S DIEN=$O(^PXRMD(801.41,"TYPE",TYPE,DIEN)) Q:DIEN'>0  D
"RTN","PXRMDUTL",66,0)
 ..I TYPE="S" D  Q
"RTN","PXRMDUTL",67,0)
 ...S FIND=$P($G(^PXRMD(801.41,DIEN,50)),U)
"RTN","PXRMDUTL",68,0)
 ...I FIND'="" D SETGBL(SUB,DIEN,FIND_";YTT(601.71,","RG",0)
"RTN","PXRMDUTL",69,0)
 ..S NODE=$G(^PXRMD(801.41,DIEN,1))
"RTN","PXRMDUTL",70,0)
 ..S FIND=$P(NODE,U,5),OI=$P(NODE,U,7)
"RTN","PXRMDUTL",71,0)
 ..I FIND'="" D SETGBL(SUB,DIEN,FIND,"F",0)
"RTN","PXRMDUTL",72,0)
 ..I OI'="" D SETGBL(SUB,DIEN,OI_";ORD(101.43,","O",0)
"RTN","PXRMDUTL",73,0)
 ..S AFIND=""
"RTN","PXRMDUTL",74,0)
 ..F  S AFIND=$O(^PXRMD(801.41,DIEN,3,"B",AFIND)) Q:AFIND=""  D
"RTN","PXRMDUTL",75,0)
 ...S AFIEN=$O(^PXRMD(801.41,DIEN,3,"B",AFIND,""))
"RTN","PXRMDUTL",76,0)
 ...D SETGBL(SUB,DIEN,AFIND,"A",AFIEN)
"RTN","PXRMDUTL",77,0)
 Q
"RTN","PXRMDUTL",78,0)
 ;
"RTN","PXRMDUTL",79,0)
RTAXNAME(NAME) ;
"RTN","PXRMDUTL",80,0)
 I '$D(^PXD(811.2,"B",NAME)) Q NAME
"RTN","PXRMDUTL",81,0)
 N CNT,FOUND,RESULT,TEMP
"RTN","PXRMDUTL",82,0)
 S TEMP=NAME,CNT=0
"RTN","PXRMDUTL",83,0)
 I $L(NAME)>64 S TEMP=$E(NAME,1,60)
"RTN","PXRMDUTL",84,0)
 S TEMP=TEMP_"*"
"RTN","PXRMDUTL",85,0)
 I '$D(^PXD(811.2,"B",TEMP)) Q TEMP
"RTN","PXRMDUTL",86,0)
 S FOUND=0
"RTN","PXRMDUTL",87,0)
 F  D  Q:FOUND=1
"RTN","PXRMDUTL",88,0)
 .S CNT=CNT+1
"RTN","PXRMDUTL",89,0)
 .I '$D(^PXD(811.2,"B",TEMP_CNT)) S RESULT=TEMP_CNT,FOUND=1
"RTN","PXRMDUTL",90,0)
 Q RESULT
"RTN","PXRMDUTL",91,0)
 ;
"RTN","PXRMDUTL",92,0)
SETGBL(SUB,DIEN,VARP,LOC,IEN) ;
"RTN","PXRMDUTL",93,0)
 N FIEN,GBL
"RTN","PXRMDUTL",94,0)
 S GBL=$P(VARP,";",2),FIEN=$P(VARP,";")
"RTN","PXRMDUTL",95,0)
 I LOC="A" S ^TMP($J,SUB,GBL,FIEN,DIEN,LOC,IEN)="" Q
"RTN","PXRMDUTL",96,0)
 S ^TMP($J,SUB,GBL,FIEN,DIEN,LOC)=""
"RTN","PXRMDUTL",97,0)
 Q
"RTN","PXRMDUTL",98,0)
 ;
"RTN","PXRMDUTL",99,0)
NATCONV(DIEN) ; entry point to convert a local dialog to a national dialog
"RTN","PXRMDUTL",100,0)
 N ARRAY,IEN
"RTN","PXRMDUTL",101,0)
 D DITEMAR(DIEN,.ARRAY)
"RTN","PXRMDUTL",102,0)
 S IEN=0 F  S IEN=$O(ARRAY(IEN)) Q:IEN'>0  D
"RTN","PXRMDUTL",103,0)
 .D DMAKENAT(IEN)
"RTN","PXRMDUTL",104,0)
 D DMAKENAT(DIEN)
"RTN","PXRMDUTL",105,0)
 Q
"RTN","PXRMDUTL",106,0)
 ;
"RTN","PXRMFRPT")
0^3^B188701531^B184393482
"RTN","PXRMFRPT",1,0)
PXRMFRPT ;SLC/PKR - Finding usage report. ;10/7/2014
"RTN","PXRMFRPT",2,0)
 ;;2.0;CLINICAL REMINDERS;**12,17,16,18,22,26,53**;Feb 04, 2005;Build 225
"RTN","PXRMFRPT",3,0)
 ;==============================
"RTN","PXRMFRPT",4,0)
BLDLIST(FILENUM,GBL,FIEN,SUB) ;
"RTN","PXRMFRPT",5,0)
 I FILENUM'=811.9 D DEFLIST(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",6,0)
 I FILENUM'=811.5 D TERMLIST(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",7,0)
 D DIALOG(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",8,0)
 D OIGLIST(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",9,0)
 I (FILENUM=811.5)!(FILENUM=811.9) D
"RTN","PXRMFRPT",10,0)
 . D OCRLIST(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",11,0)
 . D RSETLIST(FILENUM,GBL,FIEN,SUB)
"RTN","PXRMFRPT",12,0)
 Q
"RTN","PXRMFRPT",13,0)
 ;
"RTN","PXRMFRPT",14,0)
 ;==============================
"RTN","PXRMFRPT",15,0)
DEFLIST(FILENUM,GBL,FIEN,SUB) ;Search reminder definitions for any that are
"RTN","PXRMFRPT",16,0)
 ;using GBL as a finding. If FIEN is not null then search for only
"RTN","PXRMFRPT",17,0)
 ;those findings.
"RTN","PXRMFRPT",18,0)
 N FI,FNDIEN,IEN
"RTN","PXRMFRPT",19,0)
 S IEN=0
"RTN","PXRMFRPT",20,0)
 F  S IEN=+$O(^PXD(811.9,IEN)) Q:IEN=0  D
"RTN","PXRMFRPT",21,0)
 . I '$D(^PXD(811.9,IEN,20,"E",GBL)) Q
"RTN","PXRMFRPT",22,0)
 . I +FIEN>0 D
"RTN","PXRMFRPT",23,0)
 .. S FI=""
"RTN","PXRMFRPT",24,0)
 .. F  S FI=$O(^PXD(811.9,IEN,20,"E",GBL,FIEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",25,0)
 ... S ^TMP($J,SUB,FILENUM,FIEN,"DEF",IEN,FI)=""
"RTN","PXRMFRPT",26,0)
 . I +FIEN=0 D
"RTN","PXRMFRPT",27,0)
 ..;No finding specified, find all of them.
"RTN","PXRMFRPT",28,0)
 .. S FNDIEN=""
"RTN","PXRMFRPT",29,0)
 .. F  S FNDIEN=$O(^PXD(811.9,IEN,20,"E",GBL,FNDIEN)) Q:FNDIEN=""  D
"RTN","PXRMFRPT",30,0)
 ... S FI=""
"RTN","PXRMFRPT",31,0)
 ... F  S FI=$O(^PXD(811.9,IEN,20,"E",GBL,FNDIEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",32,0)
 .... S ^TMP($J,SUB,FILENUM,FNDIEN,"DEF",IEN,FI)=""
"RTN","PXRMFRPT",33,0)
 Q
"RTN","PXRMFRPT",34,0)
 ;
"RTN","PXRMFRPT",35,0)
DFIND(TLIST) ;
"RTN","PXRMFRPT",36,0)
 S IND=0
"RTN","PXRMFRPT",37,0)
 F  S IND=+$O(^DD(801.41,15,"V",IND)) Q:IND=0  D
"RTN","PXRMFRPT",38,0)
 . S TEMP=^DD(801.41,15,"V",IND,0)
"RTN","PXRMFRPT",39,0)
 . S TLIST($P(TEMP,U,2))=$P(TEMP,U,1)
"RTN","PXRMFRPT",40,0)
 Q
"RTN","PXRMFRPT",41,0)
 ;==============================
"RTN","PXRMFRPT",42,0)
DIALDSAR(OUTPUT) ;
"RTN","PXRMFRPT",43,0)
 ;This is used for individual dialog element checks, may be better in a
"RTN","PXRMFRPT",44,0)
 ;different routine
"RTN","PXRMFRPT",45,0)
 N FILENUM,IND,STATUS,TEMP
"RTN","PXRMFRPT",46,0)
 S IND=0 F  S IND=+$O(^DD(801.41,15,"V",IND)) Q:IND=0  D
"RTN","PXRMFRPT",47,0)
 . S TEMP=^DD(801.41,15,"V",IND,0)
"RTN","PXRMFRPT",48,0)
 . S FILENUM=$P(TEMP,U)
"RTN","PXRMFRPT",49,0)
 .;DBIA #4640
"RTN","PXRMFRPT",50,0)
 . S STATUS=+$$GETSTAT^HDISVF01(FILENUM)
"RTN","PXRMFRPT",51,0)
 . I STATUS'=6,STATUS'=7 Q
"RTN","PXRMFRPT",52,0)
 . S OUTPUT($$ROOT^DILFD(FILENUM))=FILENUM_U_STATUS
"RTN","PXRMFRPT",53,0)
 ;DBIA #4640
"RTN","PXRMFRPT",54,0)
 S STATUS=+$$GETSTAT^HDISVF01(101.43) I STATUS'=6,STATUS'=7 Q
"RTN","PXRMFRPT",55,0)
 S OUTPUT($$ROOT^DILFD("^101.43,"))=101.43_U_STATUS
"RTN","PXRMFRPT",56,0)
 Q
"RTN","PXRMFRPT",57,0)
 ;
"RTN","PXRMFRPT",58,0)
 ;==============================
"RTN","PXRMFRPT",59,0)
DIALOG(FILENUM,GBL,FIEN,SUB) ;
"RTN","PXRMFRPT",60,0)
 N DIEN,FIELD,FIND
"RTN","PXRMFRPT",61,0)
 I '$D(^TMP($J,"DLG FIND")) D BLDDLGTM^PXRMSTS("DLG FIND")
"RTN","PXRMFRPT",62,0)
 I +FIEN>0 D  Q
"RTN","PXRMFRPT",63,0)
 .I '$D(^TMP($J,"DLG FIND",GBL,FIEN)) Q
"RTN","PXRMFRPT",64,0)
 .S DIEN=0
"RTN","PXRMFRPT",65,0)
 .F  S DIEN=$O(^TMP($J,"DLG FIND",GBL,FIEN,DIEN)) Q:DIEN'>0  D
"RTN","PXRMFRPT",66,0)
 ..S FIELD=""
"RTN","PXRMFRPT",67,0)
 ..F  S FIELD=$O(^TMP($J,"DLG FIND",GBL,FIEN,DIEN,FIELD)) Q:FIELD=""  D
"RTN","PXRMFRPT",68,0)
 ...S ^TMP($J,SUB,FILENUM,FIEN,"DIALOG",DIEN,FIELD)=""
"RTN","PXRMFRPT",69,0)
 ;
"RTN","PXRMFRPT",70,0)
 S FIND="" F  S FIND=$O(^TMP($J,"DLG FIND",GBL,FIND)) Q:FIND=""  D
"RTN","PXRMFRPT",71,0)
 .S DIEN=0
"RTN","PXRMFRPT",72,0)
 .F  S DIEN=$O(^TMP($J,"DLG FIND",GBL,FIND,DIEN)) Q:DIEN'>0  D
"RTN","PXRMFRPT",73,0)
 ..S FIELD=""
"RTN","PXRMFRPT",74,0)
 ..F  S FIELD=$O(^TMP($J,"DLG FIND",GBL,FIND,DIEN,FIELD)) Q:FIELD=""  D
"RTN","PXRMFRPT",75,0)
 ...S ^TMP($J,SUB,FILENUM,FIND,"DIALOG",DIEN,FIELD)=""
"RTN","PXRMFRPT",76,0)
 Q
"RTN","PXRMFRPT",77,0)
 ;
"RTN","PXRMFRPT",78,0)
 ;==============================
"RTN","PXRMFRPT",79,0)
FINDDIAL(RESULT,GBL,FIEN) ;
"RTN","PXRMFRPT",80,0)
 ;This api is used to return a list of dialogs that contains a specific
"RTN","PXRMFRPT",81,0)
 ;finding
"RTN","PXRMFRPT",82,0)
 K ^TMP($J,"DLG FIND")
"RTN","PXRMFRPT",83,0)
 D BLDDLGTM^PXRMSTS("DLG FIND")
"RTN","PXRMFRPT",84,0)
 N DIEN,FIELD,FIND,NAME
"RTN","PXRMFRPT",85,0)
 I +FIEN'>0 Q
"RTN","PXRMFRPT",86,0)
 I '$D(^TMP($J,"DLG FIND",GBL,FIEN)) Q
"RTN","PXRMFRPT",87,0)
 S DIEN=0
"RTN","PXRMFRPT",88,0)
 F  S DIEN=$O(^TMP($J,"DLG FIND",GBL,FIEN,DIEN)) Q:DIEN'>0  D
"RTN","PXRMFRPT",89,0)
 .S NAME=$P($G(^PXRMD(801.41,DIEN,0)),U) Q:NAME=""
"RTN","PXRMFRPT",90,0)
 .S RESULT(NAME)=DIEN
"RTN","PXRMFRPT",91,0)
 Q
"RTN","PXRMFRPT",92,0)
 ;
"RTN","PXRMFRPT",93,0)
 ;==============================
"RTN","PXRMFRPT",94,0)
FSEL(FNUM,GBL,GNAME,SOURCE,LIST) ;Build a list of reminder findings and let the user
"RTN","PXRMFRPT",95,0)
 ;select from the list.
"RTN","PXRMFRPT",96,0)
 N ALIST,DIR,DIROUT,DIRUT,DTOUT,DUOUT,FILENUM,FLIST,IND,INUM
"RTN","PXRMFRPT",97,0)
 N STAR,TEMP,TLIST,X,Y
"RTN","PXRMFRPT",98,0)
 S (IND,INUM)=0
"RTN","PXRMFRPT",99,0)
 I $D(SOURCE("DEFINITION")) D RFIND(.TLIST)
"RTN","PXRMFRPT",100,0)
 I $D(SOURCE("DIALOG")) D DFIND(.TLIST)
"RTN","PXRMFRPT",101,0)
 S IND="",INUM=0
"RTN","PXRMFRPT",102,0)
 F  S IND=$O(TLIST(IND)) Q:IND=""  D
"RTN","PXRMFRPT",103,0)
 . S INUM=INUM+1
"RTN","PXRMFRPT",104,0)
 . S FILENUM=TLIST(IND)
"RTN","PXRMFRPT",105,0)
 .;DBIA #4640
"RTN","PXRMFRPT",106,0)
 . S STAR=$S($$SCREEN^HDISVF01(FILENUM):" *",1:"")
"RTN","PXRMFRPT",107,0)
 . S FLIST(FILENUM)=INUM
"RTN","PXRMFRPT",108,0)
 . S GNAME(INUM)=IND
"RTN","PXRMFRPT",109,0)
 . S ALIST(INUM)=" "_$J(INUM,4)_" - "_GNAME(INUM)_STAR
"RTN","PXRMFRPT",110,0)
 . S FNUM(INUM)=FILENUM
"RTN","PXRMFRPT",111,0)
 . S GBL(INUM)=$P($$GET1^DID(FILENUM,"","","GLOBAL NAME"),"^",2)
"RTN","PXRMFRPT",112,0)
 M DIR("A")=ALIST
"RTN","PXRMFRPT",113,0)
 S DIR("A")="Enter your list for the report"
"RTN","PXRMFRPT",114,0)
 S DIR(0)="LO^1:"_INUM
"RTN","PXRMFRPT",115,0)
 W !!,"Select from the following reminder findings (* signifies standardized):"
"RTN","PXRMFRPT",116,0)
 D ^DIR
"RTN","PXRMFRPT",117,0)
 I $D(DIROUT)!$D(DIRUT) S LIST="" Q
"RTN","PXRMFRPT",118,0)
 I $D(DUOUT)!$D(DTOUT) S LIST="" Q
"RTN","PXRMFRPT",119,0)
 S LIST=Y
"RTN","PXRMFRPT",120,0)
 Q
"RTN","PXRMFRPT",121,0)
 ;
"RTN","PXRMFRPT",122,0)
 ;==============================
"RTN","PXRMFRPT",123,0)
ISEL(FNUM,GBL,GNAME,LIST,ITEMLIST) ;See if the user wants selected items or
"RTN","PXRMFRPT",124,0)
 ;all from the selected finding types.
"RTN","PXRMFRPT",125,0)
 N DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IND,LI,NUM,SEL,TEXT,Y
"RTN","PXRMFRPT",126,0)
 S DIC(0)="AEMQ"
"RTN","PXRMFRPT",127,0)
 S DIR(0)="S^1:ALL;2:SELECTED"
"RTN","PXRMFRPT",128,0)
 S DIR("B")="SELECTED"
"RTN","PXRMFRPT",129,0)
 S NUM=$L(LIST,",")-1
"RTN","PXRMFRPT",130,0)
 F IND=1:1:NUM D
"RTN","PXRMFRPT",131,0)
 . S LI=$P(LIST,",",IND)
"RTN","PXRMFRPT",132,0)
 . S TEXT="Search for all or selected "_GNAME(LI)
"RTN","PXRMFRPT",133,0)
 . S TEXT=TEXT_$S($E(TEXT,$L(TEXT))="S":"?",1:"S?")
"RTN","PXRMFRPT",134,0)
 . W !,TEXT
"RTN","PXRMFRPT",135,0)
 . D ^DIR
"RTN","PXRMFRPT",136,0)
 . I $D(DIROUT)!$D(DIRUT) Q
"RTN","PXRMFRPT",137,0)
 . I $D(DUOUT)!$D(DTOUT) Q
"RTN","PXRMFRPT",138,0)
 . I Y=1 S ITEMLIST="ALL" Q
"RTN","PXRMFRPT",139,0)
 . S DIC=FNUM(LI)
"RTN","PXRMFRPT",140,0)
 . S DIC("A")="Select "_GNAME(LI)_": "
"RTN","PXRMFRPT",141,0)
 . S SEL=1
"RTN","PXRMFRPT",142,0)
 . F  Q:'SEL  D
"RTN","PXRMFRPT",143,0)
 .. D ^DIC
"RTN","PXRMFRPT",144,0)
 .. I ($D(DTOUT))!($D(DUOUT)) S SEL=0 Q
"RTN","PXRMFRPT",145,0)
 .. I Y=-1 S SEL=0 Q
"RTN","PXRMFRPT",146,0)
 .. S ITEMLIST(FNUM(LI),$P(Y,U,1))=""
"RTN","PXRMFRPT",147,0)
 Q
"RTN","PXRMFRPT",148,0)
 ;
"RTN","PXRMFRPT",149,0)
 ;==============================
"RTN","PXRMFRPT",150,0)
OCRLIST(FILENUM,GBL,FIEN,SUB) ;Search Reminder Order Check rules for
"RTN","PXRMFRPT",151,0)
 ;any that are using GBL as a finding. If FIEN is not null then search
"RTN","PXRMFRPT",152,0)
 ;for only those findings.
"RTN","PXRMFRPT",153,0)
 I FILENUM=811.5,'$D(^PXD(801.1,"T")) Q
"RTN","PXRMFRPT",154,0)
 I FILENUM=811.9,'$D(^PXD(801.1,"R")) Q
"RTN","PXRMFRPT",155,0)
 N IEN
"RTN","PXRMFRPT",156,0)
 I FILENUM=811.5 D
"RTN","PXRMFRPT",157,0)
 . I +FIEN>0 D
"RTN","PXRMFRPT",158,0)
 .. S IEN=0
"RTN","PXRMFRPT",159,0)
 .. F  S IEN=$O(^PXD(801.1,"T",FIEN,IEN)) Q:IEN'>0  S ^TMP($J,SUB,FILENUM,FIEN,"OCRULE",IEN)=""
"RTN","PXRMFRPT",160,0)
 . I +FIEN=0 D
"RTN","PXRMFRPT",161,0)
 .. S FIEN=""
"RTN","PXRMFRPT",162,0)
 .. F  S FIEN=$O(^PXD(801.1,"T",FIEN)) Q:FIEN=""  D
"RTN","PXRMFRPT",163,0)
 ... S IEN=0
"RTN","PXRMFRPT",164,0)
 ... F  S IEN=$O(^PXD(801.1,"T",FIEN,IEN)) Q:IEN'>0  S ^TMP($J,SUB,FILENUM,FIEN,"OCRULE",IEN)=""
"RTN","PXRMFRPT",165,0)
 I FILENUM=811.9 D
"RTN","PXRMFRPT",166,0)
 . I +FIEN>0 D
"RTN","PXRMFRPT",167,0)
 .. S IEN=0
"RTN","PXRMFRPT",168,0)
 .. F  S IEN=$O(^PXD(801.1,"R",FIEN,IEN)) Q:IEN'>0  S ^TMP($J,SUB,FILENUM,FIEN,"OCRULE",IEN)=""
"RTN","PXRMFRPT",169,0)
 . I +FIEN=0 D
"RTN","PXRMFRPT",170,0)
 .. S FIEN=""
"RTN","PXRMFRPT",171,0)
 .. F  S FIEN=$O(^PXD(801.1,"R",FIEN)) Q:FIEN=""  D
"RTN","PXRMFRPT",172,0)
 ... S IEN=0
"RTN","PXRMFRPT",173,0)
 ... F  S IEN=$O(^PXD(801.1,"R",FIEN,IEN)) Q:IEN'>0  S ^TMP($J,SUB,FILENUM,FIEN,"OCRULE",IEN)=""
"RTN","PXRMFRPT",174,0)
 Q
"RTN","PXRMFRPT",175,0)
 ;
"RTN","PXRMFRPT",176,0)
 ;==============================
"RTN","PXRMFRPT",177,0)
OIGLIST(FNUM,GBL,FIEN,SUB) ;Search reminder orderable item groups for
"RTN","PXRMFRPT",178,0)
 ;any that are using GBL as a finding. If FIEN is not null then search
"RTN","PXRMFRPT",179,0)
 ;for only those findings.
"RTN","PXRMFRPT",180,0)
 N IEN,ITEM,NODE,RIEN,RNAME
"RTN","PXRMFRPT",181,0)
 S NODE=$S(FNUM=101.43:"O",FNUM=50.605:"P",FNUM=50:"P",FNUM=50.6:"P",1:"")
"RTN","PXRMFRPT",182,0)
 I NODE="" Q
"RTN","PXRMFRPT",183,0)
 S ITEM=$S(NODE="P":FIEN_";"_GBL,1:FIEN)
"RTN","PXRMFRPT",184,0)
 I +FIEN>0 D  Q
"RTN","PXRMFRPT",185,0)
 . I '$D(^PXD(801,NODE,ITEM)) Q
"RTN","PXRMFRPT",186,0)
 . S IEN=0 F  S IEN=$O(^PXD(801,NODE,ITEM,IEN)) Q:IEN'>0  D
"RTN","PXRMFRPT",187,0)
 .. S ^TMP($J,SUB,FNUM,FIEN,"ROC",IEN)="" Q
"RTN","PXRMFRPT",188,0)
 I '$D(^PXD(801,NODE)) Q
"RTN","PXRMFRPT",189,0)
 S ITEM="" F  S ITEM=$O(^PXD(801,NODE,ITEM)) Q:ITEM=""  D
"RTN","PXRMFRPT",190,0)
 . S FIEN=$S(NODE="P":$P(ITEM,";"),1:ITEM)
"RTN","PXRMFRPT",191,0)
 . S IEN=0 F  S IEN=$O(^PXD(801,NODE,ITEM,IEN)) Q:IEN'>0  D
"RTN","PXRMFRPT",192,0)
 .. S ^TMP($J,SUB,FNUM,FIEN,"ROC",IEN)=""
"RTN","PXRMFRPT",193,0)
 Q
"RTN","PXRMFRPT",194,0)
 ;
"RTN","PXRMFRPT",195,0)
 ;==============================
"RTN","PXRMFRPT",196,0)
REPD ;Main report driver.
"RTN","PXRMFRPT",197,0)
 N DONE,FI,FIEN,FIENS,FILES,FILENUM,FNUM,GBL,GNAME,IEN,IND,ITEMLIST
"RTN","PXRMFRPT",198,0)
 N LI,LIST,NL,NUM,REP,SOURCE,STATUS,TYPE
"RTN","PXRMFRPT",199,0)
 S DONE=0
"RTN","PXRMFRPT",200,0)
 S SOURCE("DEFINITION")="",SOURCE("DIALOG")=""
"RTN","PXRMFRPT",201,0)
 W !,"Clinical Reminders Usage Report"
"RTN","PXRMFRPT",202,0)
 F  Q:DONE  D
"RTN","PXRMFRPT",203,0)
 . K ^TMP($J,"DIALOG MESSAGE"),^TMP($J,"DLG FIND")
"RTN","PXRMFRPT",204,0)
 . K ^TMP($J,"FDATA"),^TMP("PXRMXMZ",$J)
"RTN","PXRMFRPT",205,0)
 . K FNUM,GBL,GNAME,ITEMLIST,LIST
"RTN","PXRMFRPT",206,0)
 .;Get a list of findings for the report.
"RTN","PXRMFRPT",207,0)
 . D FSEL(.FNUM,.GBL,.GNAME,.SOURCE,.LIST)
"RTN","PXRMFRPT",208,0)
 . S NUM=$L(LIST,",")-1
"RTN","PXRMFRPT",209,0)
 . I NUM=0 S DONE=1 Q
"RTN","PXRMFRPT",210,0)
 . D ISEL(.FNUM,.GBL,.GNAME,.LIST,.ITEMLIST)
"RTN","PXRMFRPT",211,0)
 . I '$D(ITEMLIST) Q
"RTN","PXRMFRPT",212,0)
 . D BLDDLGTM^PXRMSTS("DLG FIND")
"RTN","PXRMFRPT",213,0)
 . F IND=1:1:NUM D
"RTN","PXRMFRPT",214,0)
 .. S LI=$P(LIST,",",IND)
"RTN","PXRMFRPT",215,0)
 .. I '$D(ITEMLIST(FNUM(LI))) D BLDLIST(FNUM(LI),GBL(LI),"","FDATA") Q
"RTN","PXRMFRPT",216,0)
 .. I $D(ITEMLIST(FNUM(LI))) D
"RTN","PXRMFRPT",217,0)
 ... S FIEN=""
"RTN","PXRMFRPT",218,0)
 ... F  S FIEN=$O(ITEMLIST(FNUM(LI),FIEN)) Q:FIEN=""  D BLDLIST(FNUM(LI),GBL(LI),FIEN,"FDATA")
"RTN","PXRMFRPT",219,0)
 .;Process the finding list and generate the MailMan message.
"RTN","PXRMFRPT",220,0)
 . D REPORT
"RTN","PXRMFRPT",221,0)
 . K ^TMP($J,"FDATA"),^TMP($J,"SDATA"),^TMP("PXRMXMZ",$J),^TMP($J,"DLG FIND")
"RTN","PXRMFRPT",222,0)
 Q
"RTN","PXRMFRPT",223,0)
 ;
"RTN","PXRMFRPT",224,0)
 ;==============================
"RTN","PXRMFRPT",225,0)
REPORT ;Generate the report.
"RTN","PXRMFRPT",226,0)
 N DTYP,FILENUM,FNAME,FNUMLIST,GNAME,IND,NAME,NL,NOUT,NTYPE
"RTN","PXRMFRPT",227,0)
 N REPFNAME,REPGNAME,RNUM,STANDARD,STATUS
"RTN","PXRMFRPT",228,0)
 N TEXT,TEXTOUT,TO,TYPELIST
"RTN","PXRMFRPT",229,0)
 D SORT
"RTN","PXRMFRPT",230,0)
 S FNUMLIST("DEF")=811.9,TYPELIST("DEF")="Reminder Definition"
"RTN","PXRMFRPT",231,0)
 S FNUMLIST("DIALOG")=801.41,TYPELIST("DIALOG")="Reminder Dialog"
"RTN","PXRMFRPT",232,0)
 S FNUMLIST("LRULE")=810.4,TYPELIST("LRULE")="Reminder List Rule"
"RTN","PXRMFRPT",233,0)
 S FNUMLIST("OCRULE")=801.1,TYPELIST("OCRULE")="Reminder Order Check Rules"
"RTN","PXRMFRPT",234,0)
 S FNUMLIST("ROC")=801,TYPELIST("ROC")="Reminder Order Check Items Group"
"RTN","PXRMFRPT",235,0)
 S FNUMLIST("TERM")=811.5,TYPELIST("TERM")="Reminder Term"
"RTN","PXRMFRPT",236,0)
 K ^TMP("PXRMXMZ",$J)
"RTN","PXRMFRPT",237,0)
 S NL=1,^TMP("PXRMXMZ",$J,NL,0)="Clinical Reminders finding usage report."
"RTN","PXRMFRPT",238,0)
 S GNAME=""
"RTN","PXRMFRPT",239,0)
 F  S GNAME=$O(^TMP($J,"SDATA",GNAME)) Q:GNAME=""  D
"RTN","PXRMFRPT",240,0)
 . S FILENUM=$P(^TMP($J,"SDATA",GNAME),U,1)
"RTN","PXRMFRPT",241,0)
 . S STANDARD=$P(^TMP($J,"SDATA",GNAME),U,2)
"RTN","PXRMFRPT",242,0)
 . S NTYPE=0
"RTN","PXRMFRPT",243,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMFRPT",244,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="The following "_GNAME_"(s) are used as follows:"
"RTN","PXRMFRPT",245,0)
 . I STANDARD S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="(This file has been standardized.)"
"RTN","PXRMFRPT",246,0)
 . S FNAME=""
"RTN","PXRMFRPT",247,0)
 . F  S FNAME=$O(^TMP($J,"SDATA",GNAME,FNAME)) Q:FNAME=""  D
"RTN","PXRMFRPT",248,0)
 .. S FIEN=^TMP($J,"SDATA",GNAME,FNAME)
"RTN","PXRMFRPT",249,0)
 .. S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMFRPT",250,0)
 .. S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="======================================================="
"RTN","PXRMFRPT",251,0)
 .. S TEXT=GNAME_" - "_FNAME_" (IEN="_FIEN_")"
"RTN","PXRMFRPT",252,0)
 .. D FORMATS^PXRMTEXT(1,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",253,0)
 .. F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",254,0)
 .. I STANDARD D
"RTN","PXRMFRPT",255,0)
 ... S STATUS=^TMP($J,"SDATA",GNAME,FNAME,"STD")
"RTN","PXRMFRPT",256,0)
 ... S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="  status is: "_STATUS
"RTN","PXRMFRPT",257,0)
 ... I $D(^TMP($J,"SDATA",GNAME,FNAME,"STD","REP")) D
"RTN","PXRMFRPT",258,0)
 .... S REPGNAME=$P(^TMP($J,"SDATA",GNAME,FNAME,"STD","REP"),U,1)
"RTN","PXRMFRPT",259,0)
 .... S REPFNAME=$P(^TMP($J,"SDATA",GNAME,FNAME,"STD","REP"),U,2)
"RTN","PXRMFRPT",260,0)
 .... S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="  its replacement is "_REPGNAME_"; "_REPFNAME
"RTN","PXRMFRPT",261,0)
 .. S TYPE=""
"RTN","PXRMFRPT",262,0)
 .. F  S TYPE=$O(TYPELIST(TYPE)) Q:TYPE=""  D
"RTN","PXRMFRPT",263,0)
 ... I '$D(^TMP($J,"FDATA",FILENUM,FIEN,TYPE)) Q
"RTN","PXRMFRPT",264,0)
 ... S NTYPE=NTYPE+1
"RTN","PXRMFRPT",265,0)
 ... S RNUM=FNUMLIST(TYPE)
"RTN","PXRMFRPT",266,0)
 ... S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMFRPT",267,0)
 ... I NTYPE>1 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="---------------------------------"
"RTN","PXRMFRPT",268,0)
 ... S TEXT=" Is used in the following "_TYPELIST(TYPE)_"(s):"
"RTN","PXRMFRPT",269,0)
 ... D FORMATS^PXRMTEXT(4,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",270,0)
 ... F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",271,0)
 ... S IEN=0
"RTN","PXRMFRPT",272,0)
 ... F  S IEN=$O(^TMP($J,"FDATA",FILENUM,FIEN,TYPE,IEN)) Q:IEN=""  D
"RTN","PXRMFRPT",273,0)
 .... S NAME=$$GET1^DIQ(RNUM,IEN,.01)
"RTN","PXRMFRPT",274,0)
 .... I NAME="" S NAME="Undefined"
"RTN","PXRMFRPT",275,0)
 .... S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMFRPT",276,0)
 ....;
"RTN","PXRMFRPT",277,0)
 .... I TYPE="DIALOG" D 
"RTN","PXRMFRPT",278,0)
 ..... S DTYP=$P(^PXRMD(801.41,IEN,0),U,4)
"RTN","PXRMFRPT",279,0)
 ..... S TEXT="Dialog "_$S(DTYP="E":"element",DTYP="G":"group",DTYP="S":"result group",1:"item")
"RTN","PXRMFRPT",280,0)
 ..... S TEXT=TEXT_" "_NAME_$S($P(^PXRMD(801.41,IEN,0),U,3)=1:" (Disable)",1:"")_" (IEN="_IEN_")"
"RTN","PXRMFRPT",281,0)
 ..... S TEXT=TEXT_", used in the"
"RTN","PXRMFRPT",282,0)
 ..... D FORMATS^PXRMTEXT(6,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",283,0)
 ..... F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",284,0)
 ..... S FI=0
"RTN","PXRMFRPT",285,0)
 ..... F  S FI=$O(^TMP($J,"FDATA",FILENUM,FIEN,TYPE,IEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",286,0)
 ...... S TEXT=$S(FI=15:"Finding Item field",FI=17:"Orderable Item field",FI=18:"Additional Finding field",FI=119:"MH Test field",1:"")
"RTN","PXRMFRPT",287,0)
 ...... D FORMATS^PXRMTEXT(8,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",288,0)
 ...... F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",289,0)
 ....;
"RTN","PXRMFRPT",290,0)
 .... I TYPE'="DIALOG" D
"RTN","PXRMFRPT",291,0)
 ..... S TEXT=NAME_" (IEN="_IEN_")"
"RTN","PXRMFRPT",292,0)
 ..... D FORMATS^PXRMTEXT(6,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",293,0)
 ..... F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",294,0)
 ..... S FI=0
"RTN","PXRMFRPT",295,0)
 ..... F  S FI=$O(^TMP($J,"FDATA",FILENUM,FIEN,TYPE,IEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",296,0)
 ...... S TEXT="Finding number "_FI
"RTN","PXRMFRPT",297,0)
 ...... D FORMATS^PXRMTEXT(8,72,TEXT,.NOUT,.TEXTOUT)
"RTN","PXRMFRPT",298,0)
 ...... F IND=1:1:NOUT S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=TEXTOUT(IND)
"RTN","PXRMFRPT",299,0)
 .....;
"RTN","PXRMFRPT",300,0)
 ;Deliver the report.
"RTN","PXRMFRPT",301,0)
 I NL=1 D  Q
"RTN","PXRMFRPT",302,0)
 . W !,"None of the selected findings are used."
"RTN","PXRMFRPT",303,0)
 . K ^TMP("PXRMXMZ",$J)
"RTN","PXRMFRPT",304,0)
 N ANS,BOP,X
"RTN","PXRMFRPT",305,0)
 S BOP=$$BORP^PXRMUTIL("B")
"RTN","PXRMFRPT",306,0)
 I BOP="B" D
"RTN","PXRMFRPT",307,0)
 . S X="IORESET"
"RTN","PXRMFRPT",308,0)
 . D ENDR^%ZISS
"RTN","PXRMFRPT",309,0)
 . D BROWSE^DDBR("^TMP(""PXRMXMZ"",$J)","NR","Reminder Usage Report")
"RTN","PXRMFRPT",310,0)
 . W IORESET
"RTN","PXRMFRPT",311,0)
 . D KILL^%ZISS
"RTN","PXRMFRPT",312,0)
 I BOP="P" D GPRINT^PXRMUTIL("^TMP(""PXRMXMZ"",$J)")
"RTN","PXRMFRPT",313,0)
 ;Ask the user if they want the report delivered through MailMan.
"RTN","PXRMFRPT",314,0)
 S ANS=$$ASKYN^PXRMEUT("N","Deliver the report as a MailMan message")
"RTN","PXRMFRPT",315,0)
 I ANS="1" D
"RTN","PXRMFRPT",316,0)
 . S TO(DUZ)=""
"RTN","PXRMFRPT",317,0)
 . D SEND^PXRMMSG("PXRMXMZ","Clinical Reminders Finding Usage Report",.TO,DUZ)
"RTN","PXRMFRPT",318,0)
 K ^TMP("PXRMXMZ",$J)
"RTN","PXRMFRPT",319,0)
 Q
"RTN","PXRMFRPT",320,0)
 ;
"RTN","PXRMFRPT",321,0)
RFIND(TLIST) ;
"RTN","PXRMFRPT",322,0)
 N IND
"RTN","PXRMFRPT",323,0)
 S IND=0
"RTN","PXRMFRPT",324,0)
 ;Create a temporary list ordered by file name.
"RTN","PXRMFRPT",325,0)
 S TLIST("REMINDER DEFINITION")=811.9
"RTN","PXRMFRPT",326,0)
 ;DBIA #2991, #5149 for access to ^DD.
"RTN","PXRMFRPT",327,0)
 F  S IND=+$O(^DD(811.902,.01,"V",IND)) Q:IND=0  D
"RTN","PXRMFRPT",328,0)
 . S TEMP=^DD(811.902,.01,"V",IND,0)
"RTN","PXRMFRPT",329,0)
 . S TLIST($P(TEMP,U,2))=$P(TEMP,U,1)
"RTN","PXRMFRPT",330,0)
 Q
"RTN","PXRMFRPT",331,0)
 ;==============================
"RTN","PXRMFRPT",332,0)
RSETLIST(FILENUM,GBL,FIEN,SUB) ;Search list rules for any that are using
"RTN","PXRMFRPT",333,0)
 ;GBL as a finding. If FIEN is not null then search for only those
"RTN","PXRMFRPT",334,0)
 ;findings.
"RTN","PXRMFRPT",335,0)
 N FNDIEN,IEN,TEMP,TYPE
"RTN","PXRMFRPT",336,0)
 S IEN=0
"RTN","PXRMFRPT",337,0)
 F  S IEN=+$O(^PXRM(810.4,IEN)) Q:IEN=0  D
"RTN","PXRMFRPT",338,0)
 . S TEMP=^PXRM(810.4,IEN,0)
"RTN","PXRMFRPT",339,0)
 . S TYPE=$P(TEMP,U,3)
"RTN","PXRMFRPT",340,0)
 .;If it is not a finding rule or reminder rule skip it.
"RTN","PXRMFRPT",341,0)
 . I (TYPE=3)!(TYPE=5) Q
"RTN","PXRMFRPT",342,0)
 . S FNDIEN=+$S(FILENUM=811.5:$P(TEMP,U,7),FILENUM=811.9:$P(TEMP,U,10),1:0)
"RTN","PXRMFRPT",343,0)
 . I FNDIEN=0 Q
"RTN","PXRMFRPT",344,0)
 .;If no finding specified find, all of them.
"RTN","PXRMFRPT",345,0)
 . I (FIEN=FNDIEN)!(FIEN="") S ^TMP($J,SUB,FILENUM,FNDIEN,"LRULE",IEN)=""
"RTN","PXRMFRPT",346,0)
 Q
"RTN","PXRMFRPT",347,0)
 ;
"RTN","PXRMFRPT",348,0)
 ;==============================
"RTN","PXRMFRPT",349,0)
SORT ;Sort by global name and finding name.
"RTN","PXRMFRPT",350,0)
 N FIEN,FILENUM,FNAME,GNAME,STANDARD
"RTN","PXRMFRPT",351,0)
 K ^TMP($J,"SDATA")
"RTN","PXRMFRPT",352,0)
 S FILENUM=0
"RTN","PXRMFRPT",353,0)
 F  S FILENUM=$O(^TMP($J,"FDATA",FILENUM)) Q:FILENUM=""  D
"RTN","PXRMFRPT",354,0)
 . S GNAME=$$GET1^DID(FILENUM,"","","NAME")
"RTN","PXRMFRPT",355,0)
 .;DBIA #4640
"RTN","PXRMFRPT",356,0)
 . S STANDARD=$$SCREEN^HDISVF01(FILENUM)
"RTN","PXRMFRPT",357,0)
 . S ^TMP($J,"SDATA",GNAME)=FILENUM_U_STANDARD
"RTN","PXRMFRPT",358,0)
 . S FIEN=0
"RTN","PXRMFRPT",359,0)
 . F  S FIEN=$O(^TMP($J,"FDATA",FILENUM,FIEN)) Q:FIEN=""  D
"RTN","PXRMFRPT",360,0)
 .. S FNAME=$$GET1^DIQ(FILENUM,FIEN,.01)
"RTN","PXRMFRPT",361,0)
 .. I FNAME="" S FNAME="Undefined"
"RTN","PXRMFRPT",362,0)
 .. S ^TMP($J,"SDATA",GNAME,FNAME)=FIEN
"RTN","PXRMFRPT",363,0)
 .. I STANDARD D
"RTN","PXRMFRPT",364,0)
 ... N REPFNAME,REPFNUM,REPGNAME,REPIEN,STATUS
"RTN","PXRMFRPT",365,0)
 ...;DBIA #4631
"RTN","PXRMFRPT",366,0)
 ... S STATUS=$P($$GETSTAT^XTID(FILENUM,.01,FIEN_","),U,3)
"RTN","PXRMFRPT",367,0)
 ... I STATUS="" S STATUS="undefined"
"RTN","PXRMFRPT",368,0)
 ... S ^TMP($J,"SDATA",GNAME,FNAME,"STD")=STATUS
"RTN","PXRMFRPT",369,0)
 ... S REP=$$RPLCMNT^XTIDTRM(FILENUM,FIEN)
"RTN","PXRMFRPT",370,0)
 ... I REP=(FIEN_";"_FILENUM) S REP=""
"RTN","PXRMFRPT",371,0)
 ... I REP'="" D
"RTN","PXRMFRPT",372,0)
 .... S REPIEN=$P(REP,";",1)
"RTN","PXRMFRPT",373,0)
 .... S REPFNUM=$P(REP,";",2)
"RTN","PXRMFRPT",374,0)
 .... S REPGNAME=$$GET1^DID(REPFNUM,"","","NAME")
"RTN","PXRMFRPT",375,0)
 .... S REPFNAME=$$GET1^DIQ(REPFNUM,REPIEN,.01)
"RTN","PXRMFRPT",376,0)
 .... S ^TMP($J,"SDATA",GNAME,FNAME,"STD","REP")=REPGNAME_U_REPFNAME
"RTN","PXRMFRPT",377,0)
 Q
"RTN","PXRMFRPT",378,0)
 ;
"RTN","PXRMFRPT",379,0)
 ;==============================
"RTN","PXRMFRPT",380,0)
TERMLIST(FILENUM,GBL,FIEN,SUB) ;Search reminder terms for any that are using
"RTN","PXRMFRPT",381,0)
 ;GBL as a finding. If FIEN is not null then search for only those
"RTN","PXRMFRPT",382,0)
 ;findings.
"RTN","PXRMFRPT",383,0)
 N FI,FNDIEN,IEN
"RTN","PXRMFRPT",384,0)
 S IEN=0
"RTN","PXRMFRPT",385,0)
 F  S IEN=+$O(^PXRMD(811.5,IEN)) Q:IEN=0  D
"RTN","PXRMFRPT",386,0)
 . I '$D(^PXRMD(811.5,IEN,20,"E",GBL)) Q
"RTN","PXRMFRPT",387,0)
 . I +FIEN>0 D
"RTN","PXRMFRPT",388,0)
 .. S FI=""
"RTN","PXRMFRPT",389,0)
 .. F  S FI=$O(^PXRMD(811.5,IEN,20,"E",GBL,FIEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",390,0)
 ... S ^TMP($J,SUB,FILENUM,FIEN,"TERM",IEN,FI)=""
"RTN","PXRMFRPT",391,0)
 . I +FIEN=0 D
"RTN","PXRMFRPT",392,0)
 ..;No finding specified find, all of them.
"RTN","PXRMFRPT",393,0)
 .. S FNDIEN=""
"RTN","PXRMFRPT",394,0)
 .. F  S FNDIEN=$O(^PXRMD(811.5,IEN,20,"E",GBL,FNDIEN)) Q:FNDIEN=""  D
"RTN","PXRMFRPT",395,0)
 ... S FI=""
"RTN","PXRMFRPT",396,0)
 ... F  S FI=$O(^PXRMD(811.5,IEN,20,"E",GBL,FNDIEN,FI)) Q:FI=""  D
"RTN","PXRMFRPT",397,0)
 .... S ^TMP($J,SUB,FILENUM,FNDIEN,"TERM",IEN,FI)=""
"RTN","PXRMFRPT",398,0)
 Q
"RTN","PXRMFRPT",399,0)
 ;
"RTN","PXRMMSG")
0^7^B4362273^B1586253
"RTN","PXRMMSG",1,0)
PXRMMSG ;SLC/PKR - Routine for sending MailMan messages. ;10/16/2014
"RTN","PXRMMSG",2,0)
 ;;2.0;CLINICAL REMINDERS;**17,18,53**;Feb 04, 2005;Build 225
"RTN","PXRMMSG",3,0)
 ;
"RTN","PXRMMSG",4,0)
 ;======================================================================
"RTN","PXRMMSG",5,0)
SEND(NODE,SUBJECT,TO,FROM) ;Send a MailMan message whose text is in
"RTN","PXRMMSG",6,0)
 ;^TMP(NODE,$J,N,0). SUBJECT is the subject. TO is the optional
"RTN","PXRMMSG",7,0)
 ;list of addresses, setup exactly like the MailMan XMY array.
"RTN","PXRMMSG",8,0)
 ;If TO is not defined try to send to the  Clinical Reminders mail
"RTN","PXRMMSG",9,0)
 ;group. If that is not defined send to the user. FROM is the
"RTN","PXRMMSG",10,0)
 ;optional message from, if it is not defined then from will be
"RTN","PXRMMSG",11,0)
 ;Clinical Reminders Support. This can be free text or a DUZ.
"RTN","PXRMMSG",12,0)
 N MGIEN,MGROUP,NL,REF,XMDUZ,XMSUB,XMY,XMZ
"RTN","PXRMMSG",13,0)
 ;
"RTN","PXRMMSG",14,0)
 ;If this is a test run write out the message.
"RTN","PXRMMSG",15,0)
 I $G(PXRMDEBG) D
"RTN","PXRMMSG",16,0)
 . S REF="^TMP(NODE,$J)"
"RTN","PXRMMSG",17,0)
 . D AWRITE^PXRMUTIL(REF)
"RTN","PXRMMSG",18,0)
 ;
"RTN","PXRMMSG",19,0)
 ;Make sure the subject does not exceed 64 characters.
"RTN","PXRMMSG",20,0)
 S XMSUB=$E(SUBJECT,1,64)
"RTN","PXRMMSG",21,0)
 ;
"RTN","PXRMMSG",22,0)
 ;Make the default sender Clinical Reminders.
"RTN","PXRMMSG",23,0)
 S XMDUZ=$S($G(FROM)="":"Clinical Reminders Support",1:FROM)
"RTN","PXRMMSG",24,0)
 ;
"RTN","PXRMMSG",25,0)
RETRY ;Get the message number.
"RTN","PXRMMSG",26,0)
 D XMZ^XMA2
"RTN","PXRMMSG",27,0)
 I XMZ<1 G RETRY
"RTN","PXRMMSG",28,0)
 ;
"RTN","PXRMMSG",29,0)
 ;Load the message
"RTN","PXRMMSG",30,0)
 M ^XMB(3.9,XMZ,2)=^TMP(NODE,$J)
"RTN","PXRMMSG",31,0)
 K ^TMP(NODE,$J)
"RTN","PXRMMSG",32,0)
 S NL=$O(^XMB(3.9,XMZ,2,""),-1)
"RTN","PXRMMSG",33,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_+NL_U_+NL_U_DT
"RTN","PXRMMSG",34,0)
 ;
"RTN","PXRMMSG",35,0)
 ;Send message only to the TO list if it is defined.
"RTN","PXRMMSG",36,0)
 I $D(TO)=10 M XMY=TO D ENT1^XMD Q
"RTN","PXRMMSG",37,0)
 ;Send the message to the site defined mail group or the user if
"RTN","PXRMMSG",38,0)
 ;there is no mail group.
"RTN","PXRMMSG",39,0)
 S MGIEN=$G(^PXRM(800,1,"MGFE"))
"RTN","PXRMMSG",40,0)
 S MGROUP=$S(MGIEN'="":"G."_$$GET1^DIQ(3.8,MGIEN,.01),1:DUZ)
"RTN","PXRMMSG",41,0)
 S XMY(MGROUP)=""
"RTN","PXRMMSG",42,0)
 D ENT1^XMD
"RTN","PXRMMSG",43,0)
 Q
"RTN","PXRMMSG",44,0)
 ;
"RTN","PXRMMSG",45,0)
 ;==========================================
"RTN","PXRMMSG",46,0)
SENDIM(BUILD) ;Send install message for a build.
"RTN","PXRMMSG",47,0)
 N FROM,NODE,SYSTEM,SUBJECT,TO
"RTN","PXRMMSG",48,0)
 S NODE=BUILD
"RTN","PXRMMSG",49,0)
 K ^TMP(NODE,$J)
"RTN","PXRMMSG",50,0)
 ;DBIA #1131 for ^XMB("NETNAME")
"RTN","PXRMMSG",51,0)
 S FROM=BUILD_" Install@"_^XMB("NETNAME")
"RTN","PXRMMSG",52,0)
 ;DBIA #2541
"RTN","PXRMMSG",53,0)
 S SYSTEM=$$KSP^XUPARAM("WHERE")
"RTN","PXRMMSG",54,0)
 I $$PROD^XUPROD(1) S TO("G.CLINICAL REMINDERS SUPPORT@FORUM.DOMAIN.EXT")=""
"RTN","PXRMMSG",55,0)
 E  D
"RTN","PXRMMSG",56,0)
 . N MGIEN,MGROUP
"RTN","PXRMMSG",57,0)
 . S MGIEN=$G(^PXRM(800,1,"MGFE"))
"RTN","PXRMMSG",58,0)
 . S MGROUP=$S(MGIEN'="":"G."_$$GET1^DIQ(3.8,MGIEN,.01),1:DUZ)
"RTN","PXRMMSG",59,0)
 . S TO(MGROUP)=""
"RTN","PXRMMSG",60,0)
 S SUBJECT="Install of "_BUILD
"RTN","PXRMMSG",61,0)
 S ^TMP(NODE,$J,1,0)="Build "_BUILD_" has been installed."
"RTN","PXRMMSG",62,0)
 S ^TMP(NODE,$J,2,0)="System is "_SYSTEM_"."
"RTN","PXRMMSG",63,0)
 D SEND^PXRMMSG(NODE,SUBJECT,.TO,FROM)
"RTN","PXRMMSG",64,0)
 Q
"RTN","PXRMMSG",65,0)
 ;
"VER")
8.0^22.0
"BLD",9172,6)
^43
**END**
**END**

