Released PSO*7*498 SEQ #416
Extracted from mail message
**KIDS**:PSO*7.0*498^

**INSTALL NAME**
PSO*7.0*498
"BLD",10678,0)
PSO*7.0*498^OUTPATIENT PHARMACY^0^3171005^y
"BLD",10678,1,0)
^^3^3^3170914^
"BLD",10678,1,1,0)
This patch will fix the following issue.
"BLD",10678,1,2,0)
1.      I9914421FY16  all prescription information is not displayed
"BLD",10678,1,3,0)
        on the Pharmacy verification screen
"BLD",10678,4,0)
^9.64PA^^
"BLD",10678,6.3)
14
"BLD",10678,"ABPKG")
n
"BLD",10678,"KRN",0)
^9.67PA^779.2^20
"BLD",10678,"KRN",.4,0)
.4
"BLD",10678,"KRN",.401,0)
.401
"BLD",10678,"KRN",.402,0)
.402
"BLD",10678,"KRN",.403,0)
.403
"BLD",10678,"KRN",.5,0)
.5
"BLD",10678,"KRN",.84,0)
.84
"BLD",10678,"KRN",3.6,0)
3.6
"BLD",10678,"KRN",3.8,0)
3.8
"BLD",10678,"KRN",9.2,0)
9.2
"BLD",10678,"KRN",9.8,0)
9.8
"BLD",10678,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10678,"KRN",9.8,"NM",1,0)
PSONEW2^^0^B43856626
"BLD",10678,"KRN",9.8,"NM",2,0)
PSOMLLD2^^0^B36987042
"BLD",10678,"KRN",9.8,"NM",3,0)
PSORN52^^0^B46214420
"BLD",10678,"KRN",9.8,"NM","B","PSOMLLD2",2)

"BLD",10678,"KRN",9.8,"NM","B","PSONEW2",1)

"BLD",10678,"KRN",9.8,"NM","B","PSORN52",3)

"BLD",10678,"KRN",19,0)
19
"BLD",10678,"KRN",19.1,0)
19.1
"BLD",10678,"KRN",101,0)
101
"BLD",10678,"KRN",409.61,0)
409.61
"BLD",10678,"KRN",771,0)
771
"BLD",10678,"KRN",779.2,0)
779.2
"BLD",10678,"KRN",870,0)
870
"BLD",10678,"KRN",8989.51,0)
8989.51
"BLD",10678,"KRN",8989.52,0)
8989.52
"BLD",10678,"KRN",8994,0)
8994
"BLD",10678,"KRN","B",.4,.4)

"BLD",10678,"KRN","B",.401,.401)

"BLD",10678,"KRN","B",.402,.402)

"BLD",10678,"KRN","B",.403,.403)

"BLD",10678,"KRN","B",.5,.5)

"BLD",10678,"KRN","B",.84,.84)

"BLD",10678,"KRN","B",3.6,3.6)

"BLD",10678,"KRN","B",3.8,3.8)

"BLD",10678,"KRN","B",9.2,9.2)

"BLD",10678,"KRN","B",9.8,9.8)

"BLD",10678,"KRN","B",19,19)

"BLD",10678,"KRN","B",19.1,19.1)

"BLD",10678,"KRN","B",101,101)

"BLD",10678,"KRN","B",409.61,409.61)

"BLD",10678,"KRN","B",771,771)

"BLD",10678,"KRN","B",779.2,779.2)

"BLD",10678,"KRN","B",870,870)

"BLD",10678,"KRN","B",8989.51,8989.51)

"BLD",10678,"KRN","B",8989.52,8989.52)

"BLD",10678,"KRN","B",8994,8994)

"BLD",10678,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10678,"QUES",0)
^9.62^^
"BLD",10678,"REQB",0)
^9.611^3^3
"BLD",10678,"REQB",1,0)
PSO*7.0*372^2
"BLD",10678,"REQB",2,0)
PSO*7.0*431^2
"BLD",10678,"REQB",3,0)
PSO*7.0*362^2
"BLD",10678,"REQB","B","PSO*7.0*362",3)

"BLD",10678,"REQB","B","PSO*7.0*372",1)

"BLD",10678,"REQB","B","PSO*7.0*431",2)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
498^3171005
"PKG",206,22,1,"PAH",1,1,0)
^^3^3^3171005
"PKG",206,22,1,"PAH",1,1,1,0)
This patch will fix the following issue.
"PKG",206,22,1,"PAH",1,1,2,0)
1.      I9914421FY16  all prescription information is not displayed
"PKG",206,22,1,"PAH",1,1,3,0)
        on the Pharmacy verification screen
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSOMLLD2")
0^2^B36987042^B30902022
"RTN","PSOMLLD2",1,0)
PSOMLLD2 ;BIR/LE - Service Connection Check for SC>50% ;02/27/04
"RTN","PSOMLLD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219,239,225,431,498**;DEC 1997;Build 14
"RTN","PSOMLLD2",3,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLD2",4,0)
 ;External reference DIS^SDROUT2 private by DBIA 112
"RTN","PSOMLLD2",5,0)
 ;External reference $$GETSHAD^DGUTL3 supported by DBIA 4462
"RTN","PSOMLLD2",6,0)
 ;External reference ^DPT(DFN,.372 private by DBIA 1476
"RTN","PSOMLLD2",7,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSOMLLD2",8,0)
SC ;This routine is used for SC>50% - OUTSIDE OF COPAY - DFN AND PSOSCP VARIABLES ARE EXPECTED TO BE PRESENT WHEN CALLED
"RTN","PSOMLLD2",9,0)
 ; Requires: DFN, PSOSCP, PSOSCA 
"RTN","PSOMLLD2",10,0)
 I '$G(DFN) N DFN S DFN=+$G(PSODFN)
"RTN","PSOMLLD2",11,0)
 ;I $G(DFN) I '$$SC^SDCO22(DFN) D  Q  ;if SC>49 don't ask if api says not to
"RTN","PSOMLLD2",12,0)
 ;. K PSOANSQ("SC>50"),PSOANSQD("SC>50") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSOMLLD2",13,0)
SC2 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOMLLD2",14,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOMLLD2",15,0)
 N PSODISAR D CHKPAG,DISSCD  ;DIS^SDROUT2
"RTN","PSOMLLD2",16,0)
 N PSOUFLAG S PSOUFLAG=0 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",17,0)
 S DIR("A")="Was treatment for a Service Connected condition"
"RTN","PSOMLLD2",18,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Service Connected."
"RTN","PSOMLLD2",19,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",20,0)
 . I PSOSCP<50 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",21,0)
 . I PSOSCP<50&($D(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",22,0)
 . I PSOSCP>49 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",23,0)
 . I '$D(DIR("B"))&($D(PSOANSQD("SC>50"))!($D(PSOANSQD("SC")))) D  I '$D(DIR("B")) K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",24,0)
 .. I $D(PSOANSQD("SC>50")) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",25,0)
 .. I $D(PSOANSQD("SC")) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",26,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOMLLD2",27,0)
 ;
"RTN","PSOMLLD2",28,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S DIR("B")=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",29,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOMLLD2",30,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOMLLD2",31,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",32,0)
 I $G(Y)=1!($G(Y)=0) D  I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC>50")=$G(Y)
"RTN","PSOMLLD2",33,0)
 . I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SC>50")=+Y
"RTN","PSOMLLD2",34,0)
 . S PSOANSQ("SC>50")=+Y
"RTN","PSOMLLD2",35,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOMLLD2",36,0)
 S:Y=0 Y=2
"RTN","PSOMLLD2",37,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="NO":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSOMLLD2",38,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="YES":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOMLLD2",39,0)
 .;W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make  corrections."
"RTN","PSOMLLD2",40,0)
 .S PSOANSQ("SC>50")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLD2",41,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOMLLD2",42,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOMLLD2",43,0)
EXIT ;
"RTN","PSOMLLD2",44,0)
 K PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X,PSOSCA
"RTN","PSOMLLD2",45,0)
 Q
"RTN","PSOMLLD2",46,0)
 ;
"RTN","PSOMLLD2",47,0)
PAUSE K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLD2",48,0)
 Q
"RTN","PSOMLLD2",49,0)
 ;
"RTN","PSOMLLD2",50,0)
SHAD ; PROJ 112/SHAD Question
"RTN","PSOMLLD2",51,0)
 I $G(PSODFN),$L($T(GETSHAD^DGUTL3)) I $$GETSHAD^DGUTL3(PSODFN)'=1 D  Q
"RTN","PSOMLLD2",52,0)
 . K PSOANSQ("SHAD"),PSOANSQD("SHAD") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SHAD")
"RTN","PSOMLLD2",53,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLD2",54,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",55,0)
 S DIR("A")="Was treatment related to PROJ 112/SHAD"
"RTN","PSOMLLD2",56,0)
 S DIR("?")=" "
"RTN","PSOMLLD2",57,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to"
"RTN","PSOMLLD2",58,0)
 S DIR("?",2)="Shipboard Hazard and Defense (SHAD) exposure."
"RTN","PSOMLLD2",59,0)
 S DIR("?",3)="This response will be used to determine whether or not a copay should"
"RTN","PSOMLLD2",60,0)
 S DIR("?",4)="be applied to the prescription."
"RTN","PSOMLLD2",61,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",62,0)
 . S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SHAD"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SHAD"))=1:"YES",1:"")
"RTN","PSOMLLD2",63,0)
 . I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",64,0)
 I $G(PSOFLAG),$G(PSONEWFF) D
"RTN","PSOMLLD2",65,0)
 . I $G(PSOANSQD("SHAD"))=0!($G(PSOANSQD("SHAD"))=1) D
"RTN","PSOMLLD2",66,0)
 . . S DIR("B")=$S($G(PSOANSQD("SHAD"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",67,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",68,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLD2",69,0)
 . I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLD2",70,0)
 . S PSOANSQ("SHAD")=Y
"RTN","PSOMLLD2",71,0)
 . I $G(PSONEWFF) S PSOANSQD("SHAD")=Y
"RTN","PSOMLLD2",72,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  Q
"RTN","PSOMLLD2",73,0)
 . W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of "
"RTN","PSOMLLD2",74,0)
 . W !,"Shipboard Hazard and Defense (SHAD) exposure." D:$G(PSOSCP)<50 MESS^PSOMLLDT D PAUSE
"RTN","PSOMLLD2",75,0)
 . S PSOANSQ(PSOX("IRXN"),"SHAD")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLD2",76,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SHAD")=Y
"RTN","PSOMLLD2",77,0)
 E  S PSOANSQ("SHAD")=Y
"RTN","PSOMLLD2",78,0)
 Q
"RTN","PSOMLLD2",79,0)
 ;
"RTN","PSOMLLD2",80,0)
CHKPAG ;
"RTN","PSOMLLD2",81,0)
 N PSOSPACE S $P(PSOSPACE," ",50)=""
"RTN","PSOMLLD2",82,0)
 S I3=0 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  D
"RTN","PSOMLLD2",83,0)
 .S I1=^DPT(DFN,.372,I,0) I $P(I1,"^",3) D
"RTN","PSOMLLD2",84,0)
 ..S I2=$S($D(^DIC(31,+I1,0)):^(0),1:""),I2=$S($P(I2,"^",4)]"":$P(I2,"^",4),1:$P(I2,"^"))
"RTN","PSOMLLD2",85,0)
 ..S PSODISAR(I)=I2_$E(PSOSPACE,1,48-$L(I2))_$J($P(I1,"^",2),4)_"% - "_$S($P(I1,"^",3):"SERVICE CONNECTED",1:""),I3=I3+1
"RTN","PSOMLLD2",86,0)
 I 'I3 S PSODISAR(1)=$S('$O(^DPT(DFN,.372,0)):"NONE STATED",1:"NO SC DISABILITIES LISTED")
"RTN","PSOMLLD2",87,0)
 S PSODISAR=I3
"RTN","PSOMLLD2",88,0)
 K I1,I2,I3
"RTN","PSOMLLD2",89,0)
 ;*498 I PSODISAR>3&$G(PSOORNEW) D HD^PSODDPR2(1,1)
"RTN","PSOMLLD2",90,0)
 Q
"RTN","PSOMLLD2",91,0)
 ;
"RTN","PSOMLLD2",92,0)
DISSCD ;DISPLAY SERVICE CONNECTED DISABILITIES - REPLACES CALL TO DIS^SDROUT2
"RTN","PSOMLLD2",93,0)
 ;
"RTN","PSOMLLD2",94,0)
 ;rated disabilities
"RTN","PSOMLLD2",95,0)
 ; -- Pharmacy is allowed to call this tag via a special agreement
"RTN","PSOMLLD2",96,0)
 ;    with MAS.  MAS should notify pharmacy developers of any
"RTN","PSOMLLD2",97,0)
 ;    changes that may impact PS* code.  (5/91 - MJK/BOK)
"RTN","PSOMLLD2",98,0)
 ;
"RTN","PSOMLLD2",99,0)
 I '$D(VAEL) D ELIG^VADPT S DGKVAR=1
"RTN","PSOMLLD2",100,0)
 W:'+VAEL(3) !!,"Service Connected: NO" W:+VAEL(3) !!,"       SC Percent: ",$P(VAEL(3),"^",2)_"%"
"RTN","PSOMLLD2",101,0)
 W !,"     Disabilities: " I 'VAEL(4),$S('$D(^DG(391,+VAEL(6),0)):1,$P(^(0),"^",2):0,1:1) W "NOT A VETERAN" G DISQ
"RTN","PSOMLLD2",102,0)
 S I=0 F  S I=$O(PSODISAR(I)) Q:'I  D
"RTN","PSOMLLD2",103,0)
 .W !,PSODISAR(I)
"RTN","PSOMLLD2",104,0)
 .I $Y+3>IOSL D
"RTN","PSOMLLD2",105,0)
 ..S DIR(0)="E",DIR("A")=" Press the return key to continue" D ^DIR W @IOF
"RTN","PSOMLLD2",106,0)
 .. W !,"DRUG: "_$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:$G(PSODRUG("NAME"))),!
"RTN","PSOMLLD2",107,0)
DISQ I $D(DGKVAR) D KVAR^VADPT K DGKVAR,I
"RTN","PSOMLLD2",108,0)
 Q
"RTN","PSONEW2")
0^1^B43856626^B43830604
"RTN","PSONEW2",1,0)
PSONEW2 ;BIR/DSD - displays new rx information for edit ;7/17/06 6:59pm
"RTN","PSONEW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,37,46,71,94,124,139,157,143,226,237,239,225,251,375,372,498**;DEC 1997;Build 14
"RTN","PSONEW2",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSONEW2",4,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSONEW2",5,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW2",6,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEW2",7,0)
 ; This routine displays the entered new rx information and
"RTN","PSONEW2",8,0)
 ; asks if correct, if not allows editing of the data.
"RTN","PSONEW2",9,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",10,0)
 ;PSO*237 issue expired error message
"RTN","PSONEW2",11,0)
 ;
"RTN","PSONEW2",12,0)
START ;
"RTN","PSONEW2",13,0)
 S (PSONEW("DFLG"),PSONEW2("QFLG"))=0
"RTN","PSONEW2",14,0)
 D STOP
"RTN","PSONEW2",15,0)
 D DISPLAY ; Displays information
"RTN","PSONEW2",16,0)
 ;Copay exemption checks
"RTN","PSONEW2",17,0)
 D SCP^PSORN52D
"RTN","PSONEW2",18,0)
 S PSONEWFF=1,PSOFLAG=1 K PSOANSQ,PSOANSQD S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0
"RTN","PSONEW2",19,0)
 ;can't check PSOSCA for <50 here because of PSOBILL check in PSOCPB
"RTN","PSONEW2",20,0)
 I (PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1)),$G(DUZ("AG"))="V" D COPAY^PSOCPB W !
"RTN","PSONEW2",21,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1))!(PSOSCP>49&(PSOBILL=2)) D SC^PSOMLLD2
"RTN","PSONEW2",22,0)
 I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEW2",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOANSQ,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEW2",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D CV^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("CV"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",27,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D VEH^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("VEH"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",28,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D RAD^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("RAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",29,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D PGW^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("PGW"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",30,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D SHAD^PSOMLLD2 I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("SHAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",31,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MST^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("MST"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",32,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D HNC^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("HNC"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",33,0)
 K PSOCPZ("DFLG"),PSONEWFF
"RTN","PSONEW2",34,0)
 D ASK K:$G(PSONEW("DFLG")) PSOANSQ G:PSONEW2("QFLG")!PSONEW("DFLG") END
"RTN","PSONEW2",35,0)
 S PSORX("EDIT")=1 D EN^PSOORNE1(.PSONEW),FULL^VALM1 G:$G(PSORX("FN")) END  I '$G(PSORX("FN")) S PSONEW("DFLG")=1 K PSOANSQ G END ;D EDIT
"RTN","PSONEW2",36,0)
 G:'$G(PSONEW("DFLG")) START
"RTN","PSONEW2",37,0)
 S PSONEW("QFLG")=1,PSONEW("DFLG")=0
"RTN","PSONEW2",38,0)
END D EOJ
"RTN","PSONEW2",39,0)
 Q
"RTN","PSONEW2",40,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",41,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0
"RTN","PSONEW2",42,0)
 S X1=PSOID,X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSONEW2",43,0)
 S X2=$S(PSONEW("DAYS SUPPLY")=X2:X2,+$G(PSONEW("CS")):184,1:366)
"RTN","PSONEW2",44,0)
 I X2<30 D
"RTN","PSONEW2",45,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSONEW2",46,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSONEW2",47,0)
 D C^%DTC I PSONEW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSONEW2",48,0)
 K X1,X2,X,%DT
"RTN","PSONEW2",49,0)
 Q
"RTN","PSONEW2",50,0)
DISPLAY ;
"RTN","PSONEW2",51,0)
 D:+$$DS^PSSDSAPI&($G(PSOFOERR)) HD3^PSODOSUN()
"RTN","PSONEW2",52,0)
 W @IOF,!!,"Rx # ",PSONEW("RX #")
"RTN","PSONEW2",53,0)
 W ?23,$E(PSONEW("FILL DATE"),4,5),"/",$E(PSONEW("FILL DATE"),6,7),"/",$E(PSONEW("FILL DATE"),2,3),!,$G(PSORX("NAME")),?30,"#",PSONEW("QTY")
"RTN","PSONEW2",54,0)
 I $G(SIGOK),$O(SIG(0)) D  K D G TRN
"RTN","PSONEW2",55,0)
 .F D=0:0 S D=$O(SIG(D)) W !,SIG(D) Q:'$O(SIG(D))  D:+$$DS^PSSDSAPI&($G(PSOFOERR)) HD3^PSODOSUN(7)
"RTN","PSONEW2",56,0)
 E  S X=PSONEW("SIG") D SIGONE^PSOHELP W !,$G(INS1) D:+$$DS^PSSDSAPI&($G(PSOFOERR)) HD3^PSODOSUN(7)
"RTN","PSONEW2",57,0)
TRN ;I $G(PSOPRC) F I=0:0 S I=$O(PRC(I)) Q:'I  W !,PRC(I)
"RTN","PSONEW2",58,0)
 W !!,$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:PSODRUG("NAME"))
"RTN","PSONEW2",59,0)
 W !,PSONEW("PROVIDER NAME"),?25,PSORX("CLERK CODE"),!,"# of Refills: ",PSONEW("# OF REFILLS"),! D:+$$DS^PSSDSAPI&($G(PSOFOERR)) HD3^PSODOSUN()
"RTN","PSONEW2",60,0)
 Q
"RTN","PSONEW2",61,0)
 ;
"RTN","PSONEW2",62,0)
ASK ;
"RTN","PSONEW2",63,0)
 K DIR,X,Y S DIR("A")="Is this correct"
"RTN","PSONEW2",64,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S PSONEW("DFLG")=1 G ASKX
"RTN","PSONEW2",65,0)
ASK1 I Y D  S PSONEW2("QFLG")=1
"RTN","PSONEW2",66,0)
 .S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT=Y,BINGRTE="W"
"RTN","PSONEW2",67,0)
 .D:+$G(PSEXDT)
"RTN","PSONEW2",68,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSONEW2",69,0)
 .D DCORD K RORD,^TMP("PSORXDC",$J)
"RTN","PSONEW2",70,0)
ASKX I $D(DIRUT) D
"RTN","PSONEW2",71,0)
 .I +$G(PSEXDT) K DIRUT S (PSONEW2("QFLG"),PSONEW2("DFLG"),PSONEW("DFLG"),Y)=1
"RTN","PSONEW2",72,0)
 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSONEW2",73,0)
 D:+$G(PSEXDT) PAUSE^VALM1
"RTN","PSONEW2",74,0)
 Q
"RTN","PSONEW2",75,0)
DCORD ;dc rxs and pending orders after new order is entered
"RTN","PSONEW2",76,0)
 I $G(PSORX("DFLG")) K ^TMP("PSORXDC",$J) Q
"RTN","PSONEW2",77,0)
 F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D @$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"PEN",1:"RX52")
"RTN","PSONEW2",78,0)
 I $G(PSORX("FN")) S VALMBCK="Q",PSOFROM="NEW"
"RTN","PSONEW2",79,0)
 K RORD,PSOTECCK H 2
"RTN","PSONEW2",80,0)
 Q
"RTN","PSONEW2",81,0)
PEN ;pending ^tmp("psorxdc",$j,rord,0)="p^"_rord_"^"_msg
"RTN","PSONEW2",82,0)
 N PSOR,DNM S PSOR=^PS(52.41,RORD,0) S $P(^PS(52.41,RORD,0),"^",3)="DC",^PS(52.41,RORD,4)=$P(^TMP("PSORXDC",$J,RORD,0),"^",3)
"RTN","PSONEW2",83,0)
 K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,RORD,"INI")),"^"),RORD)
"RTN","PSONEW2",84,0)
 S DNM=$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSONEW2",85,0)
 D EN^PSOHLSN($P(^PS(52.41,RORD,0),"^"),"OC",$P(^TMP("PSORXDC",$J,RORD,0),"^",3),"D")
"RTN","PSONEW2",86,0)
 I $G(PSOTECCK),'$D(^XUSEC("PSORPH",DUZ)) G PENX
"RTN","PSONEW2",87,0)
 W $C(7),! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSONEW2",88,0)
 S X=" Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Pending Order "_DNM_" has been discontinued..." D ^DIWP
"RTN","PSONEW2",89,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSONEW2",90,0)
PENX K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W !
"RTN","PSONEW2",91,0)
 D PSOUL^PSSLOCK(RORD_"S") K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",92,0)
 Q
"RTN","PSONEW2",93,0)
RX52 ;rxs in file 52 ^tmp("psorxdc",$j,rord,0)=52^rord^msg^rea^act^sta^dnm
"RTN","PSONEW2",94,0)
 S PSCAN($P(^PSRX(RORD,0),"^"))=RORD_"^"_$P(^TMP("PSORXDC",$J,RORD,0),"^",4)
"RTN","PSONEW2",95,0)
 S MSG=$P(^TMP("PSORXDC",$J,RORD,0),"^",3),REA=$P(^(0),"^",4),ACT=$P(^(0),"^",5)
"RTN","PSONEW2",96,0)
 N PSONOOR S PSONOOR="D",DUP=1,DA=RORD D CAN^PSOCAN K PSONOOR
"RTN","PSONEW2",97,0)
 I $G(PSOTECCK),'$D(^XUSEC("PSORPH",DUZ)) G RX52X
"RTN","PSONEW2",98,0)
 W $C(7),! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSONEW2",99,0)
 S X=" Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Rx #"_$P(^PSRX(RORD,0),"^")_" "_$P(^TMP("PSORXDC",$J,RORD,0),"^",7)_" has been discontinued..." D ^DIWP
"RTN","PSONEW2",100,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSONEW2",101,0)
RX52X K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W !
"RTN","PSONEW2",102,0)
 K PSOSD($P(^TMP("PSORXDC",$J,RORD,0),"^",6),$P(^TMP("PSORXDC",$J,RORD,0),"^",7))
"RTN","PSONEW2",103,0)
 D PSOUL^PSSLOCK(RORD) K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",104,0)
 Q
"RTN","PSONEW2",105,0)
 ;
"RTN","PSONEW2",106,0)
EDIT ;
"RTN","PSONEW2",107,0)
 S PSORX("EDIT")=1
"RTN","PSONEW2",108,0)
 D ^PSONEW3
"RTN","PSONEW2",109,0)
 S PSONEW("DFLG")=$S($G(PSORX("DFLG")):1,1:0)
"RTN","PSONEW2",110,0)
 Q
"RTN","PSONEW2",111,0)
 ;
"RTN","PSONEW2",112,0)
EOJ ;
"RTN","PSONEW2",113,0)
 K PSONEW2,PSORX("EDIT"),PSORX("DFLG"),PSOEDIT,PSOSCA
"RTN","PSONEW2",114,0)
 Q
"RTN","PSONEW2",115,0)
 ;
"RTN","PSONEW2",116,0)
EN1(PSONEW2) ; Entry point to just display and ask if okay
"RTN","PSONEW2",117,0)
 S PSONEW("DFLG")=0
"RTN","PSONEW2",118,0)
 I $G(^PSRX(PSONEW2("IRXN"),0))']"" S PSONEW("DFLG")=1 G EN1X
"RTN","PSONEW2",119,0)
 S PSOX=^PSRX(PSONEW2("IRXN"),0),PSONEW("TRADE NAME")=$G(^("TN")),PSONEW("FILL DATE")=$P($G(^(2)),"^",2)
"RTN","PSONEW2",120,0)
 S PSONEW("RX #")=$P(PSOX,"^"),PSORX("NAME")=$P(^DPT($P(PSOX,"^",2),0),"^")
"RTN","PSONEW2",121,0)
 S PSONEW("QTY")=$P(PSOX,"^",7),PSODRUG("NAME")=$P(^PSDRUG($P(PSOX,"^",6),0),"^"),PSONEW("# OF REFILLS")=$P(PSOX,"^",9)
"RTN","PSONEW2",122,0)
 S PSORX("CLERK CODE")=$P(^VA(200,$P(PSOX,"^",16),0),"^")
"RTN","PSONEW2",123,0)
 S:$G(PSONEW("PROVIDER NAME"))="" PSONEW("PROVIDER NAME")=$P(^VA(200,$P(PSOX,"^",4),0),"^")
"RTN","PSONEW2",124,0)
 S PSONEW("SIG")=$P($G(^PSRX(PSONEW2("IRXN"),"SIG")),"^")
"RTN","PSONEW2",125,0)
 D DISPLAY
"RTN","PSONEW2",126,0)
 D ASK
"RTN","PSONEW2",127,0)
 I PSONEW("DFLG")=1 S PSONEW2("DFLG")=1
"RTN","PSONEW2",128,0)
EN1X ;
"RTN","PSONEW2",129,0)
 Q
"RTN","PSONEW2",130,0)
 ;
"RTN","PSONEW2",131,0)
EXPR ;Display Expired error message                               ;PSO*237
"RTN","PSONEW2",132,0)
 S PSONEW("DFLG")=1
"RTN","PSONEW2",133,0)
 W $C(7)
"RTN","PSONEW2",134,0)
 S VALMSG="Order is older than 365 days and can't be finished"
"RTN","PSONEW2",135,0)
 S XQORM("B")="DC"
"RTN","PSONEW2",136,0)
 Q
"RTN","PSORN52")
0^3^B46214420^B44851851
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219,148,239,201,225,303,358,251,387,379,362,498**;DEC 1997;Build 14
"RTN","PSORN52",3,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",4,0)
 ;Ext ref to SWSTAT^IBBAPI sup by DBIA 4663
"RTN","PSORN52",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSORN52",6,0)
EN(PSOX) ;EP
"RTN","PSORN52",7,0)
START ;
"RTN","PSORN52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",9,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",10,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",11,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",12,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",13,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",15,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",7)=1:1,$P(PSOIBHLX,"^",7)=0:0,1:"")
"RTN","PSORN52",16,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1)!($P(PSOIBHLX,"^",6)=1)!($P(PSOIBHLX,"^",7)=1) S PSOSCOTH=1
"RTN","PSORN52",17,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",18,0)
 S PSOANSQ("SC>50")="" D SCP^PSORN52D
"RTN","PSORN52",19,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",20,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",21,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",22,0)
 .N PSOLDIBQ S PSOLDIBQ=""  ;*362 ;do not copy over IBQ node for a renewal
"RTN","PSORN52",23,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",24,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",25,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",26,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",27,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",28,0)
 D INIT G:PSORN52("QFLG") END D FILE^PSORN52A
"RTN","PSORN52",29,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",30,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",31,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",32,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",33,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",34,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",35,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",42,0)
 .I $P(PSOIBHLD,"^",8)=1!($P(PSOIBHLD,"^",8)=0) S PSOANSQ(PSOX("IRXN"),"SHAD")=$P(PSOIBHLD,"^",8)
"RTN","PSORN52",43,0)
 K PSOIBHLD
"RTN","PSORN52",44,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",45,0)
 S PSONEW("NEWCOPAY")=""
"RTN","PSORN52",46,0)
 I (PSOSCP<50&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7))),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",47,0)
 ;I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",48,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1)) S PSOFLAG=0 W @IOF W !,"DRUG: "_$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:$G(PSODRUG("NAME"))) D SC^PSOMLLD2
"RTN","PSORN52",49,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",50,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",54,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D MESS D SHAD^PSOMLLD2 I $G(PSOANSQ(PSOX("IRXN"),"SHAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",56,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",57,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",58,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",59,0)
 ;
"RTN","PSORN52",60,0)
 D FINISH,ACP^PSOUTIL
"RTN","PSORN52",61,0)
 ;
"RTN","PSORN52",62,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",63,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"SHAD"))
"RTN","PSORN52",64,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)) S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",65,0)
 ;
"RTN","PSORN52",66,0)
 D FILE2^PSORN52D
"RTN","PSORN52",67,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSORN52",68,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",69,0)
END D EOJ
"RTN","PSORN52",70,0)
 Q
"RTN","PSORN52",71,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",72,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",73,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",74,0)
 Q
"RTN","PSORN52",75,0)
 ;
"RTN","PSORN52",76,0)
FINISH ;
"RTN","PSORN52",77,0)
 N PSOTFIN
"RTN","PSORN52",78,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S PSOTFIN="",PSOTFIN=$$TECH2^PSODGDGP(PSOX("IRXN"),PSODFN,DUZ,.PSOX)
"RTN","PSORN52",79,0)
 I '$D(^XUSEC("PSORPH",DUZ)) G FINISHP:$G(PSOTFIN)=1 G FINISHX:$G(PSOTFIN)=2
"RTN","PSORN52",80,0)
 ;
"RTN","PSORN52",81,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",82,0)
 ;
"RTN","PSORN52",83,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",84,0)
 ;
"RTN","PSORN52",85,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSORN52",86,0)
 N ACTION
"RTN","PSORN52",87,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSORN52",88,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,"","RN")
"RTN","PSORN52",89,0)
 .; Quit if there is an unresolved Tricare/CHAMPVA non-billable reject code, PSO*7*358
"RTN","PSORN52",90,0)
 . I $$PSOET^PSOREJP3(PSOX("IRXN"),0) S ACTION="Q" Q
"RTN","PSORN52",91,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSORN52",92,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","RN","IOQ","Q")
"RTN","PSORN52",93,0)
 ;
"RTN","PSORN52",94,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",95,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",96,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",97,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",98,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",99,0)
 . Q
"RTN","PSORN52",100,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",101,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",102,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",103,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",104,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",105,0)
FINISHX ;
"RTN","PSORN52",106,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",107,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11)
"RTN","PSORN52",108,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",109,0)
 K PSOX1,PSOX2,^TMP("PSODOSF")
"RTN","PSORN52",110,0)
 Q
"RTN","PSORN52",111,0)
EOJ ;
"RTN","PSORN52",112,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",113,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",114,0)
 Q
"RTN","PSORN52",115,0)
MESS ;
"RTN","PSORN52",116,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",117,0)
 Q
"VER")
8.0^22.2
"BLD",10678,6)
^416
**END**
**END**

