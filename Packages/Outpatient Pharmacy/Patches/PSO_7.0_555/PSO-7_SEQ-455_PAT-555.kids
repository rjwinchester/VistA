Released PSO*7*555 SEQ #455
Extracted from mail message
**KIDS**:PSO*7.0*555^

**INSTALL NAME**
PSO*7.0*555
"BLD",11399,0)
PSO*7.0*555^OUTPATIENT PHARMACY^0^3190219^y
"BLD",11399,1,0)
^^4^4^3190219^^
"BLD",11399,1,1,0)
This patch addresses one (1) VistA Outpatient Pharmacy issue:
"BLD",11399,1,2,0)
 
"BLD",11399,1,3,0)
The installment of patch PSO*7*537 introduced an error that occurs 
"BLD",11399,1,4,0)
after a user edits a dosage.
"BLD",11399,4,0)
^9.64PA^^
"BLD",11399,6.3)
5
"BLD",11399,"ABPKG")
n
"BLD",11399,"KRN",0)
^9.67PA^1.61^23
"BLD",11399,"KRN",.4,0)
.4
"BLD",11399,"KRN",.401,0)
.401
"BLD",11399,"KRN",.402,0)
.402
"BLD",11399,"KRN",.403,0)
.403
"BLD",11399,"KRN",.5,0)
.5
"BLD",11399,"KRN",.84,0)
.84
"BLD",11399,"KRN",1.6,0)
1.6
"BLD",11399,"KRN",1.61,0)
1.61
"BLD",11399,"KRN",1.62,0)
1.62
"BLD",11399,"KRN",3.6,0)
3.6
"BLD",11399,"KRN",3.8,0)
3.8
"BLD",11399,"KRN",9.2,0)
9.2
"BLD",11399,"KRN",9.8,0)
9.8
"BLD",11399,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11399,"KRN",9.8,"NM",1,0)
PSOORED5^^0^B105280160
"BLD",11399,"KRN",9.8,"NM","B","PSOORED5",1)

"BLD",11399,"KRN",19,0)
19
"BLD",11399,"KRN",19.1,0)
19.1
"BLD",11399,"KRN",101,0)
101
"BLD",11399,"KRN",409.61,0)
409.61
"BLD",11399,"KRN",771,0)
771
"BLD",11399,"KRN",779.2,0)
779.2
"BLD",11399,"KRN",870,0)
870
"BLD",11399,"KRN",8989.51,0)
8989.51
"BLD",11399,"KRN",8989.52,0)
8989.52
"BLD",11399,"KRN",8994,0)
8994
"BLD",11399,"KRN","B",.4,.4)

"BLD",11399,"KRN","B",.401,.401)

"BLD",11399,"KRN","B",.402,.402)

"BLD",11399,"KRN","B",.403,.403)

"BLD",11399,"KRN","B",.5,.5)

"BLD",11399,"KRN","B",.84,.84)

"BLD",11399,"KRN","B",1.6,1.6)

"BLD",11399,"KRN","B",1.61,1.61)

"BLD",11399,"KRN","B",1.62,1.62)

"BLD",11399,"KRN","B",3.6,3.6)

"BLD",11399,"KRN","B",3.8,3.8)

"BLD",11399,"KRN","B",9.2,9.2)

"BLD",11399,"KRN","B",9.8,9.8)

"BLD",11399,"KRN","B",19,19)

"BLD",11399,"KRN","B",19.1,19.1)

"BLD",11399,"KRN","B",101,101)

"BLD",11399,"KRN","B",409.61,409.61)

"BLD",11399,"KRN","B",771,771)

"BLD",11399,"KRN","B",779.2,779.2)

"BLD",11399,"KRN","B",870,870)

"BLD",11399,"KRN","B",8989.51,8989.51)

"BLD",11399,"KRN","B",8989.52,8989.52)

"BLD",11399,"KRN","B",8994,8994)

"BLD",11399,"QUES",0)
^9.62^^
"BLD",11399,"REQB",0)
^9.611^1^1
"BLD",11399,"REQB",1,0)
PSO*7.0*537^2
"BLD",11399,"REQB","B","PSO*7.0*537",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
555^3190219
"PKG",206,22,1,"PAH",1,1,0)
^^4^4^3190219
"PKG",206,22,1,"PAH",1,1,1,0)
This patch addresses one (1) VistA Outpatient Pharmacy issue:
"PKG",206,22,1,"PAH",1,1,2,0)
 
"PKG",206,22,1,"PAH",1,1,3,0)
The installment of patch PSO*7*537 introduced an error that occurs 
"PKG",206,22,1,"PAH",1,1,4,0)
after a user edits a dosage.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOORED5")
0^1^B105280160^B105365217
"RTN","PSOORED5",1,0)
PSOORED5 ;BIR/SAB-Rxs without dosing info ;07/20/00
"RTN","PSOORED5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,75,78,100,99,117,133,251,378,372,416,313,450,486,402,500,507,525,537,555**;DEC 1997;Build 5
"RTN","PSOORED5",3,0)
 ;Reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORED5",4,0)
 ;Reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED5",5,0)
 ;Reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOORED5",6,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORED5",7,0)
 ;External reference to START^PSSJORDF(PSODRUG supported by DBIA 2418
"RTN","PSOORED5",8,0)
 ;called by psoored2 and psodir
"RTN","PSOORED5",9,0)
 ;pre-poe rxs and new backdoor rxs
"RTN","PSOORED5",10,0)
 ;
"RTN","PSOORED5",11,0)
 ;*507 indicate inactive file #51.1 sched entries
"RTN","PSOORED5",12,0)
 ;
"RTN","PSOORED5",13,0)
DOSE1(PSORXED) ;for new rxs
"RTN","PSOORED5",14,0)
DOSE ;pre-poe rx
"RTN","PSOORED5",15,0)
 D KV K ROU,STRE,FIELD,DOSEOR,DUPD,X,Y,UNITS,ENTBKP S:$D(PSORXED("ENT")) ENTBKP=PSORXED("ENT") S ENT=1,OLENT=ENT ;p555 added ENTBKP
"RTN","PSOORED5",16,0)
ASK S ROU="PSOORED5" D ASK^PSOBKDED K ROU G:$D(DIRUT) EXE  ;486
"RTN","PSOORED5",17,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED5",18,0)
 I $G(QUIT)]"" K QUIT,ROU Q
"RTN","PSOORED5",19,0)
 ;
"RTN","PSOORED5",20,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED5",21,0)
 I $G(PSORX("EDIT"))']"" W:$G(PSORXED("VERB",ENT))]"" !,"VERB: "_PSORXED("VERB",ENT) G DUPD
"RTN","PSOORED5",22,0)
VER D VER^PSOOREDX
"RTN","PSOORED5",23,0)
 I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED5",24,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT) I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED5",25,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED5",26,0)
DUPD ;
"RTN","PSOORED5",27,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED5",28,0)
 D KV S DIR(0)="52.0113,1",DIR("A")="DISPENSE UNITS PER DOSE"_$S($G(PSORXED("NOUN",ENT))]"":"("_PSORXED("NOUN",ENT)_")",1:"")
"RTN","PSOORED5",29,0)
 I '$G(PSORXED("DOSE",ENT)),$G(PSORXED("DOSE",ENT-1)) S PSORXED("DOSE",ENT)=PSORXED("DOSE",ENT-1)
"RTN","PSOORED5",30,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),$G(DUPD)]"":DUPD,1:"") S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED5",31,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED5",32,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",33,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED5",34,0)
 D STR^PSOOREDX
"RTN","PSOORED5",35,0)
 ;
"RTN","PSOORED5",36,0)
NOU1 G:'$D(DUPD) RTE D CNON^PSOORED3 N PSONDEF
"RTN","PSOORED5",37,0)
 I $G(NOUN)]"",$G(PSORX("EDIT"))']"" S PSORXED("NOUN",ENT)=NOUN W !,"NOUN: "_$G(NOUN) G RTE
"RTN","PSOORED5",38,0)
 I $G(PSORX("EDIT"))']"",$G(PSORXED("NOUN",ENT))]"" W !,"NOUN: "_PSORXED("NOUN",ENT) G RTE
"RTN","PSOORED5",39,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED5",40,0)
 G EXE:$D(DTOUT)!$D(DUOUT) I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED5",41,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED5",42,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED5",43,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED5",44,0)
 ;
"RTN","PSOORED5",45,0)
RTE I $G(ENT)>1,$G(PSORX("EDIT"))']"",$G(PSORXED("ROUTE",ENT-1)),$G(PSORXED("ROUTE",ENT))']"" S PSORXED("ROUTE",ENT)=PSORXED("ROUTE",ENT-1) G SCH
"RTN","PSOORED5",46,0)
 I '$G(DRET),'$G(PSORXED("ROUTE",ENT)),$P(^PS(50.7,PSODRUG("OI"),0),"^",6) S PSORXED("ROUTE",ENT)=$P(^PS(50.7,PSODRUG("OI"),0),"^",6)
"RTN","PSOORED5",47,0)
 I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOORED5",48,0)
 I $G(RTE) K RTE
"RTN","PSOORED5",49,0)
 ;*525
"RTN","PSOORED5",50,0)
 D KV N MRSLS,MRX,MRDFV,MRQ S MRQ=0,MRDFV=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"")
"RTN","PSOORED5",51,0)
 S X=""
"RTN","PSOORED5",52,0)
 W !,"ROUTE: "_MRDFV_"//"
"RTN","PSOORED5",53,0)
 D  G:$G(MRSLS) DQ G:MRQ=1 RTE
"RTN","PSOORED5",54,0)
 . R MRX:DTIME
"RTN","PSOORED5",55,0)
 . I '$T S DTOUT=1 Q
"RTN","PSOORED5",56,0)
 . I MRX="^" S DUOUT=1 Q
"RTN","PSOORED5",57,0)
 . I MRX="?" D MRSL
"RTN","PSOORED5",58,0)
 . I (MRX="")!(MRX=" ")&($G(MRDFV)]"") S MRX=$G(MRDFV)
"RTN","PSOORED5",59,0)
 . I $E(MRX,1)=" " S MRQ=1
"RTN","PSOORED5",60,0)
 S X=MRX
"RTN","PSOORED5",61,0)
 K MRSLS,MRX,MRDFV,MRQ
"RTN","PSOORED5",62,0)
 I X[U,$L(X)>1 S FIELD="RTE" G JUMP
"RTN","PSOORED5",63,0)
 S:($D(DTOUT))!($D(DUOUT)) PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",64,0)
 I X="^" S PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",65,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" G SCH
"RTN","PSOORED5",66,0)
 D CKMRSL
"RTN","PSOORED5",67,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) G SCH
"RTN","PSOORED5",68,0)
 ;D KV S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOORED5",69,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",70,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",71,0)
 ;D ^DIR I X[U,$L(X)>1 S FIELD="RTE" G JUMP
"RTN","PSOORED5",72,0)
 ;S:($D(DTOUT))!($D(DUOUT)) PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",73,0)
 ;I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" G SCH
"RTN","PSOORED5",74,0)
 ;K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) G SCH
"RTN","PSOORED5",75,0)
 ;S DIC=51.2,DIC(0)="QEZM",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOORED5",76,0)
DQ ;
"RTN","PSOORED5",77,0)
 S DIC=51.2,DIC(0)="QEZMX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOORED5",78,0)
RTF ;
"RTN","PSOORED5",79,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOORED5",80,0)
 ;
"RTN","PSOORED5",81,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED5",82,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",83,0)
 S SCH=$$SCHASL(Y) D SCH^PSOSIG I $G(SCH)']""!($D(DTOUT))!($D(DUOUT)) G SCH
"RTN","PSOORED5",84,0)
 S PSORXED("SCHEDULE",ENT)=SCH IF $G(SCHEX)'="" W " ("_SCHEX_")"
"RTN","PSOORED5",85,0)
 K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED5",86,0)
 S:$G(PSORXED("ENT"))<ENT PSORXED("ENT")=ENT
"RTN","PSOORED5",87,0)
 ;
"RTN","PSOORED5",88,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOORED5",89,0)
 S DIR("B")=$S($D(DUR):DUR,$G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",90,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED5",91,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",92,0)
 D DUR1^PSOOREDX
"RTN","PSOORED5",93,0)
 ;
"RTN","PSOORED5",94,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED5",95,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",96,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED5",97,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED5",98,0)
 I X="@" D CON1^PSOOREDX G:$D(DIRUT) EX G:'Y CON S:'$G(COPY) PSOSIGFL=1 D UPD^PSOOREDX G CON
"RTN","PSOORED5",99,0)
 ;
"RTN","PSOORED5",100,0)
 I '$$DUROK^PSOORED3(.PSORXED,ENT) D  G DUR
"RTN","PSOORED5",101,0)
 . W !!,"Duration is required for the dosage entered prior to the THEN conjunction.",$C(7),!
"RTN","PSOORED5",102,0)
 N PSODLBD4 S PSOSAVX=X,PSODLBD4=1
"RTN","PSOORED5",103,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" S PSOCKCON=1 D DCHK1^PSODOSUT G:$G(PSORXED("DFLG"))!($G(PSORX("DFLG"))) EX S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED5",104,0)
 E  K PSOCKCON I $$DCHK^PSODOSUT S PSORXED("DFLG")=1,PSORX("DFLG")=1 G EX
"RTN","PSOORED5",105,0)
 I PSOSAVX="",$G(PSORXED)!($D(PSOEDDOS)) K PSOCKCON
"RTN","PSOORED5",106,0)
 K PSOSAVX
"RTN","PSOORED5",107,0)
 ;
"RTN","PSOORED5",108,0)
EXS ;Entry point for EXE to rebuild SIG  PSO*7.0*450
"RTN","PSOORED5",109,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOORED5",110,0)
 D EN^PSOFSIG(.PSORXED) I $O(SIG(0)) S PSORXED("ENT")=ENT,SIGOK=1
"RTN","PSOORED5",111,0)
 Q:$G(PSOREEDT)!($G(PSOORRNW))
"RTN","PSOORED5",112,0)
 K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED5",113,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED5",114,0)
 K QTYHLD Q:$G(PSOFROM)="NEW"!($G(COPY))!($G(PSOFROM))!($G(PSOREEDT))
"RTN","PSOORED5",115,0)
 Q:$G(PSOSIGFL)  D
"RTN","PSOORED5",116,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSOORED5",117,0)
 .S (A,I)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),"A",I)) Q:'I  S A=A+1
"RTN","PSOORED5",118,0)
 .S:'$D(^PSRX(PSORXED("IRXN"),"A",0)) ^PSRX(PSORXED("IRXN"),"A",0)="^52.3DA^"
"RTN","PSOORED5",119,0)
 .S $P(^PSRX(PSORXED("IRXN"),"A",0),"^",3)=$P($G(^PSRX(PSORXED("IRXN"),"A",0)),"^",3)+1,$P(^(0),"^",4)=$P($G(^(0)),"^",4)+1
"RTN","PSOORED5",120,0)
 .D NOW^%DTC S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^New Dosing Instructions Added",^PSRX(PSORXED("IRXN"),"A",A,1)="ORIGINAL SIG^" D
"RTN","PSOORED5",121,0)
 ..I '$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) S $P(^PSRX(PSORXED("IRXN"),"A",A,1),"^",2)=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^") Q
"RTN","PSOORED5",122,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S ^PSRX(PSORXED("IRXN"),"A",A,2,I,0)=^PSRX(PSORXED("IRXN"),"SIG1",I,0),^PSRX(PSORXED("IRXN"),"A",A,2,0)="^52.34A^"_I_"^"_I
"RTN","PSOORED5",123,0)
 .S ^PSRX(PSORXED("IRXN"),"SIG")="^1" K SIG,A,I
"RTN","PSOORED5",124,0)
 S ^PSRX(PSORXED("IRXN"),6,0)="^52.0113^"_ENT_"^"_ENT
"RTN","PSOORED5",125,0)
 F I=1:1:ENT S ^PSRX(PSORXED("IRXN"),6,I,0)=PSORXED("DOSE",I)_"^"_$G(PSORXED("DOSE ORDERED",I))_"^"_$G(PSORXED("UNITS",I))_"^"_$G(PSORXED("NOUN",I))_"^" D
"RTN","PSOORED5",126,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,0)=^PSRX(PSORXED("IRXN"),6,I,0)_$G(PSORXED("DURATION",I))_"^"_$G(PSORXED("CONJUNCTION",I))_"^"_$G(PSORXED("ROUTE",I))_"^"_$G(PSORXED("SCHEDULE",I))_"^"_$G(PSORXED("VERB",I))
"RTN","PSOORED5",127,0)
 .I $G(PSORXED("DOSE",I))]"" S ^PSRX(PSORXED("IRXN"),6,I,1)=PSORXED("DOSE",I)
"RTN","PSOORED5",128,0)
 S ^PSRX(PSORXED("IRXN"),"POE")=1 G EX
"RTN","PSOORED5",129,0)
 Q
"RTN","PSOORED5",130,0)
EX I $D(DUOUT)!($D(DTOUT)) S PSONEW("DFLG")=1 S:$D(ENTBKP) ENT=ENTBKP ;p555 added ENTBKP
"RTN","PSOORED5",131,0)
 ;I $D(DUOUT)!($D(DTOUT)) S:'$G(PSORX("EDIT")) PSONEW("DFLG")=1
"RTN","PSOORED5",132,0)
 G:$G(PSOSIGFL)!($G(PSORX("EDIT")))!($G(PSORXED))!($G(PSOREEDT)) EX1
"RTN","PSOORED5",133,0)
 K PSORXED("DOSE"),PSORXED("NOUN"),PSORXED("VERB"),PSORXED("DOSE ORDERED"),PSORXED("ROUTE"),SIG,PSORXED("SCHEDULE"),PSORXED("DURATION"),PSORXED("CONJUNCTION"),PSORXED("ODOSE")
"RTN","PSOORED5",134,0)
EX1 K UNITN,STRE,DOSE,DUPD,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSOSCH,ENT,PSORTE,DURA,ERTE,ROU
"RTN","PSOORED5",135,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED5",136,0)
 Q
"RTN","PSOORED5",137,0)
 ;This line tag was added to check if EXit is being performed while EDITing.  If it is,
"RTN","PSOORED5",138,0)
 ;process SIG and do not delete order.  Previous calls to EX when due to $D(DUOUT) were
"RTN","PSOORED5",139,0)
 ;changed to go to this line tag instead.
"RTN","PSOORED5",140,0)
EXE I $G(PSORX("EDIT"))]"" K DUOUT S:$D(ENTBKP) ENT=ENTBKP G EXS  ;*PSO*7.0*450 p555 added ENTBKP
"RTN","PSOORED5",141,0)
 G EX
"RTN","PSOORED5",142,0)
 ;
"RTN","PSOORED5",143,0)
UPD ;updates dosing array
"RTN","PSOORED5",144,0)
 D UPD^PSOORED6
"RTN","PSOORED5",145,0)
 Q
"RTN","PSOORED5",146,0)
JUMP ;
"RTN","PSOORED5",147,0)
 I $G(PSORXED("SCHEDULE",1))']"" W $C(7),!!,"All Dosing Instructions must be entered before Jumping to other Fields!",!! G @FIELD
"RTN","PSOORED5",148,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED5",149,0)
 D FNM^PSOOREDX
"RTN","PSOORED5",150,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED5",151,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED5",152,0)
 D KV
"RTN","PSOORED5",153,0)
 I $G(PSOFROM)'="NEW",'$G(COPY) S DIR("A",1)="* Indicates which fields will create a New Order"
"RTN","PSOORED5",154,0)
 S DIR("A")="Select Field by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED5",155,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED5",156,0)
 G EX
"RTN","PSOORED5",157,0)
 Q
"RTN","PSOORED5",158,0)
LAN ;
"RTN","PSOORED5",159,0)
 Q:'$G(PSODRUG("IEN"))
"RTN","PSOORED5",160,0)
 I $G(OR0),'$G(PSONEW("DOSE ORDERED",II)),$P($G(^PS(55,PSODFN,"LAN")),"^") D  K QI,QII Q
"RTN","PSOORED5",161,0)
 .Q:$G(OTHDOS(II))
"RTN","PSOORED5",162,0)
 .F QI=0:0 S QI=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",QI)) Q:'QI  D  Q:$G(QII)
"RTN","PSOORED5",163,0)
 ..Q:$G(PSONEW("DOSE",II))']""
"RTN","PSOORED5",164,0)
 ..I PSONEW("DOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^") S PSONEW("ODOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^",4),QII=1
"RTN","PSOORED5",165,0)
 I $G(Y),$P($G(DOSE(Y)),"^",13)]"" S PSORXED("ODOSE",ENT)=$P(DOSE(Y),"^",13) Q
"RTN","PSOORED5",166,0)
 K QII F I=0:0 S I=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",I)) Q:'I  I DOSE=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^") D  Q:$G(QII)
"RTN","PSOORED5",167,0)
 .S PSORXED("ODOSE",ENT)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^",4),QII=1
"RTN","PSOORED5",168,0)
 K QII,I
"RTN","PSOORED5",169,0)
 Q
"RTN","PSOORED5",170,0)
 ;
"RTN","PSOORED5",171,0)
SCHASL(SCHA) ;
"RTN","PSOORED5",172,0)
 N SCHEA,SCHFL1 S SCHEA="",SCHFL1=0
"RTN","PSOORED5",173,0)
 ;**Lookup into the ADMINISTRATION SCHEDULE (#51.1) file 
"RTN","PSOORED5",174,0)
 K X,Y,DIC,D SET X=$G(SCHA),DIC="^PS(51.1,",DIC(0)="CEMOV"
"RTN","PSOORED5",175,0)
 S DIC("W")="W ""  ""_$G(X)_""  ""_$P(^PS(51.1,+Y,0),U,8)_$S($P(^(0),U,12):""   **INACTIVE**"",1:"""")"      ;*507
"RTN","PSOORED5",176,0)
 S D="APPSJ^D" W !,"Now searching ADMINISTRATION SCHEDULE (#51.1) file...",! D MIX^DIC1                      ;*507
"RTN","PSOORED5",177,0)
 K DIC,D S:Y'>0 SCHFL1=1 IF '$G(SCHFL1),'$D(DTOUT),'$D(DUOUT) SET SCHEA=$P(Y,U,2) Q SCHEA
"RTN","PSOORED5",178,0)
 I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","PSOORED5",179,0)
 I $G(SCHFL1)=1 S SCHEA=$$SCHMI(SCHA) Q SCHEA
"RTN","PSOORED5",180,0)
 Q ""
"RTN","PSOORED5",181,0)
 ;
"RTN","PSOORED5",182,0)
SCHMI(SCHM) ;
"RTN","PSOORED5",183,0)
 N SCHEM,SCHFL2 S SCHEM="",SCHFL2=0
"RTN","PSOORED5",184,0)
 ;**Lookup into the MEDICATION INSRUCTION (#51) file
"RTN","PSOORED5",185,0)
 K X,Y,DIC,D SET X=$G(SCHM),DIC="^PS(51,",DIC(0)="CEMOV",DIC("W")="W ""  ""_$G(X)_""  ""_$P(^PS(51,+Y,0),U,2)",D="A^B^D" W !,"Now searching MEDICATION INSTRUCTION (#51) file...",! D MIX^DIC1
"RTN","PSOORED5",186,0)
 K DIC,D S:Y'>0 SCHFL2=1 IF '$G(SCHFL2),'$D(DTOUT),'$D(DUOUT) SET SCHEM=$P(Y,U,2) Q SCHEM
"RTN","PSOORED5",187,0)
 ;
"RTN","PSOORED5",188,0)
 I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","PSOORED5",189,0)
 I $G(SCHFL2)=1 Q SCHM
"RTN","PSOORED5",190,0)
 Q ""
"RTN","PSOORED5",191,0)
 ;
"RTN","PSOORED5",192,0)
MRSL ;;check for OI med route short list ;*525
"RTN","PSOORED5",193,0)
 I $G(PSODRUG("OI")) D START^PSSJORDF(PSODRUG("OI"),"O") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSOORED5",194,0)
 . N MRTP S MRTP="PSOTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSOORED5",195,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSOORED5",196,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)="" W !,?10,I_"  "_$P(^TMP("PSJMR",$J,I),U)_"  "_$P(^TMP("PSJMR",$J,I),U,2)
"RTN","PSOORED5",197,0)
 . N DIC S DIC("A")="Select MED ROUTE: ",DIC="^TMP(MRTP,$J,",DIC(0)="AEQZ" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J)
"RTN","PSOORED5",198,0)
 . I Y=-1 S MRQ=1 Q
"RTN","PSOORED5",199,0)
 . S MRSLS=1,X=$P(Y,"^",2)
"RTN","PSOORED5",200,0)
 Q
"RTN","PSOORED5",201,0)
 ;
"RTN","PSOORED5",202,0)
CKMRSL ;;check for med route short list leading letters ;*525
"RTN","PSOORED5",203,0)
 I $G(PSODRUG("OI")) D START^PSSJORDF(PSODRUG("OI"),"O") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSOORED5",204,0)
 . N MRTP S MRTP="PSOTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSOORED5",205,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSOORED5",206,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)=""
"RTN","PSOORED5",207,0)
 . N DIC S DIC("T")="",DIC="^TMP(MRTP,$J,",DIC(0)="EM" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J)
"RTN","PSOORED5",208,0)
 . I Y=-1 Q
"RTN","PSOORED5",209,0)
 . S X=$P(Y,"^",2)
"RTN","PSOORED5",210,0)
 Q
"VER")
8.0^22.2
"BLD",11399,6)
^455
**END**
**END**

