Released PSO*7*454 SEQ #388
Extracted from mail message
**KIDS**:PSO*7.0*454^

**INSTALL NAME**
PSO*7.0*454
"BLD",9799,0)
PSO*7.0*454^OUTPATIENT PHARMACY^0^3161110^y
"BLD",9799,1,0)
^^1^1^3160601^^
"BLD",9799,1,1,0)
One VA Pharmacy remote prescription enhancements.
"BLD",9799,4,0)
^9.64PA^59^3
"BLD",9799,4,52,0)
52
"BLD",9799,4,52,2,0)
^9.641^52.2^2
"BLD",9799,4,52,2,52.1,0)
REFILL  (sub-file)
"BLD",9799,4,52,2,52.1,1,0)
^9.6411^93^3
"BLD",9799,4,52,2,52.1,1,91,0)
REMOTE FILL SITE
"BLD",9799,4,52,2,52.1,1,92,0)
REMOTE PHARMACIST
"BLD",9799,4,52,2,52.1,1,93,0)
REMOTE PHARMACIST PHONE
"BLD",9799,4,52,2,52.2,0)
PARTIAL DATE  (sub-file)
"BLD",9799,4,52,2,52.2,1,0)
^9.6411^93^3
"BLD",9799,4,52,2,52.2,1,91,0)
REMOTE FILL SITE
"BLD",9799,4,52,2,52.2,1,92,0)
REMOTE PHARMACIST
"BLD",9799,4,52,2,52.2,1,93,0)
REMOTE PHARMACIST PHONE
"BLD",9799,4,52,222)
y^y^p^^^^n^^n
"BLD",9799,4,52,224)

"BLD",9799,4,52.09,0)
52.09
"BLD",9799,4,52.09,222)
y^y^f^^^^n
"BLD",9799,4,59,0)
59
"BLD",9799,4,59,2,0)
^9.641^59^1
"BLD",9799,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",9799,4,59,2,59,1,0)
^9.6411^3001^1
"BLD",9799,4,59,2,59,1,3001,0)
ONEVA PHARMACY FLAG
"BLD",9799,4,59,222)
y^y^p^^^^n^^n
"BLD",9799,4,59,224)

"BLD",9799,4,"APDD",52,52.1)

"BLD",9799,4,"APDD",52,52.1,91)

"BLD",9799,4,"APDD",52,52.1,92)

"BLD",9799,4,"APDD",52,52.1,93)

"BLD",9799,4,"APDD",52,52.2)

"BLD",9799,4,"APDD",52,52.2,91)

"BLD",9799,4,"APDD",52,52.2,92)

"BLD",9799,4,"APDD",52,52.2,93)

"BLD",9799,4,"APDD",59,59)

"BLD",9799,4,"APDD",59,59,3001)

"BLD",9799,4,"B",52,52)

"BLD",9799,4,"B",52.09,52.09)

"BLD",9799,4,"B",59,59)

"BLD",9799,6.3)
349
"BLD",9799,"ABPKG")
n
"BLD",9799,"INIT")
POST^PSORRX1
"BLD",9799,"KRN",0)
^9.67PA^779.2^20
"BLD",9799,"KRN",.4,0)
.4
"BLD",9799,"KRN",.401,0)
.401
"BLD",9799,"KRN",.402,0)
.402
"BLD",9799,"KRN",.403,0)
.403
"BLD",9799,"KRN",.5,0)
.5
"BLD",9799,"KRN",.84,0)
.84
"BLD",9799,"KRN",3.6,0)
3.6
"BLD",9799,"KRN",3.8,0)
3.8
"BLD",9799,"KRN",9.2,0)
9.2
"BLD",9799,"KRN",9.8,0)
9.8
"BLD",9799,"KRN",9.8,"NM",0)
^9.68A^22^21
"BLD",9799,"KRN",9.8,"NM",1,0)
PSORRX1^^0^B139750868
"BLD",9799,"KRN",9.8,"NM",2,0)
PSORREF^^0^B44063843
"BLD",9799,"KRN",9.8,"NM",3,0)
PSORREF0^^0^B46515290
"BLD",9799,"KRN",9.8,"NM",4,0)
PSORREF1^^0^B3242931
"BLD",9799,"KRN",9.8,"NM",6,0)
PSOROS^^0^B917829
"BLD",9799,"KRN",9.8,"NM",7,0)
PSORX1^^0^B82763052
"BLD",9799,"KRN",9.8,"NM",8,0)
PSOORUT1^^0^B124954661
"BLD",9799,"KRN",9.8,"NM",9,0)
PSOORNE2^^0^B107800723
"BLD",9799,"KRN",9.8,"NM",10,0)
PSORWRAP^^0^B112263517
"BLD",9799,"KRN",9.8,"NM",11,0)
PSORRP^^0^B74346330
"BLD",9799,"KRN",9.8,"NM",12,0)
PSORRPA1^^0^B75304679
"BLD",9799,"KRN",9.8,"NM",13,0)
PSORRD^^0^B2373596
"BLD",9799,"KRN",9.8,"NM",14,0)
PSOORAL2^^0^B25020405
"BLD",9799,"KRN",9.8,"NM",15,0)
PSORLLL1^^0^B70716253
"BLD",9799,"KRN",9.8,"NM",16,0)
PSORLLLI^^0^B70303116
"BLD",9799,"KRN",9.8,"NM",17,0)
PSORLLL2^^0^B16763889
"BLD",9799,"KRN",9.8,"NM",18,0)
PSORLLL3^^0^B8122377
"BLD",9799,"KRN",9.8,"NM",19,0)
PSORLLL4^^0^B11420707
"BLD",9799,"KRN",9.8,"NM",20,0)
PSORLLL5^^0^B32390251
"BLD",9799,"KRN",9.8,"NM",21,0)
PSORLLLH^^0^B10351529
"BLD",9799,"KRN",9.8,"NM",22,0)
PSORRX2^^0^B32510176
"BLD",9799,"KRN",9.8,"NM","B","PSOORAL2",14)

"BLD",9799,"KRN",9.8,"NM","B","PSOORNE2",9)

"BLD",9799,"KRN",9.8,"NM","B","PSOORUT1",8)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLL1",15)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLL2",17)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLL3",18)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLL4",19)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLL5",20)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLLH",21)

"BLD",9799,"KRN",9.8,"NM","B","PSORLLLI",16)

"BLD",9799,"KRN",9.8,"NM","B","PSOROS",6)

"BLD",9799,"KRN",9.8,"NM","B","PSORRD",13)

"BLD",9799,"KRN",9.8,"NM","B","PSORREF",2)

"BLD",9799,"KRN",9.8,"NM","B","PSORREF0",3)

"BLD",9799,"KRN",9.8,"NM","B","PSORREF1",4)

"BLD",9799,"KRN",9.8,"NM","B","PSORRP",11)

"BLD",9799,"KRN",9.8,"NM","B","PSORRPA1",12)

"BLD",9799,"KRN",9.8,"NM","B","PSORRX1",1)

"BLD",9799,"KRN",9.8,"NM","B","PSORRX2",22)

"BLD",9799,"KRN",9.8,"NM","B","PSORWRAP",10)

"BLD",9799,"KRN",9.8,"NM","B","PSORX1",7)

"BLD",9799,"KRN",19,0)
19
"BLD",9799,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",9799,"KRN",19,"NM",1,0)
PSO RX^^3
"BLD",9799,"KRN",19,"NM",2,0)
PSO REMOTE RX REPORT^^0
"BLD",9799,"KRN",19,"NM","B","PSO REMOTE RX REPORT",2)

"BLD",9799,"KRN",19,"NM","B","PSO RX",1)

"BLD",9799,"KRN",19.1,0)
19.1
"BLD",9799,"KRN",101,0)
101
"BLD",9799,"KRN",101,"NM",0)
^9.68A^14^10
"BLD",9799,"KRN",101,"NM",5,0)
PSO LM REMOTE ORDER MENU^^0
"BLD",9799,"KRN",101,"NM",6,0)
PSO LM REFILL REMOTE ORDER^^0
"BLD",9799,"KRN",101,"NM",7,0)
PSO LM REMOTE PARTIAL^^0
"BLD",9799,"KRN",101,"NM",8,0)
PSO LM REMOTE RX REPORT MENU^^0
"BLD",9799,"KRN",101,"NM",9,0)
PSO LM SELECT REPORT ITEM^^0
"BLD",9799,"KRN",101,"NM",10,0)
PSO REMOTE RX QBP-Q13 EVENT^^0
"BLD",9799,"KRN",101,"NM",11,0)
PSO REMOTE RX QBP-Q13 ESUBS^^0
"BLD",9799,"KRN",101,"NM",12,0)
PSO REMOTE RX RDS-O13 EVENT^^0
"BLD",9799,"KRN",101,"NM",13,0)
PSO REMOTE RX RDS-O13 ESUBS^^0
"BLD",9799,"KRN",101,"NM",14,0)
PSO LM MEDICATION PROFILE^^3
"BLD",9799,"KRN",101,"NM","B","PSO LM MEDICATION PROFILE",14)

"BLD",9799,"KRN",101,"NM","B","PSO LM REFILL REMOTE ORDER",6)

"BLD",9799,"KRN",101,"NM","B","PSO LM REMOTE ORDER MENU",5)

"BLD",9799,"KRN",101,"NM","B","PSO LM REMOTE PARTIAL",7)

"BLD",9799,"KRN",101,"NM","B","PSO LM REMOTE RX REPORT MENU",8)

"BLD",9799,"KRN",101,"NM","B","PSO LM SELECT REPORT ITEM",9)

"BLD",9799,"KRN",101,"NM","B","PSO REMOTE RX QBP-Q13 ESUBS",11)

"BLD",9799,"KRN",101,"NM","B","PSO REMOTE RX QBP-Q13 EVENT",10)

"BLD",9799,"KRN",101,"NM","B","PSO REMOTE RX RDS-O13 ESUBS",13)

"BLD",9799,"KRN",101,"NM","B","PSO REMOTE RX RDS-O13 EVENT",12)

"BLD",9799,"KRN",409.61,0)
409.61
"BLD",9799,"KRN",409.61,"NM",0)
^9.68A^3^3
"BLD",9799,"KRN",409.61,"NM",1,0)
PSO LM REMOTE ORDER SELECTION^^0
"BLD",9799,"KRN",409.61,"NM",2,0)
PSO LM REMOTE RX REPORT^^0
"BLD",9799,"KRN",409.61,"NM",3,0)
PSO LM REMOTE REPORT DETAILS^^0
"BLD",9799,"KRN",409.61,"NM","B","PSO LM REMOTE ORDER SELECTION",1)

"BLD",9799,"KRN",409.61,"NM","B","PSO LM REMOTE REPORT DETAILS",3)

"BLD",9799,"KRN",409.61,"NM","B","PSO LM REMOTE RX REPORT",2)

"BLD",9799,"KRN",771,0)
771
"BLD",9799,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",9799,"KRN",771,"NM",1,0)
PSO EMI PHARM^^0
"BLD",9799,"KRN",771,"NM",2,0)
PSO VISTA PHARM^^0
"BLD",9799,"KRN",771,"NM","B","PSO EMI PHARM",1)

"BLD",9799,"KRN",771,"NM","B","PSO VISTA PHARM",2)

"BLD",9799,"KRN",779.2,0)
779.2
"BLD",9799,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",9799,"KRN",870,0)
870
"BLD",9799,"KRN",870,"NM",0)
^9.68A^2^1
"BLD",9799,"KRN",870,"NM",2,0)
PSORRXSEND^^0
"BLD",9799,"KRN",870,"NM","B","PSORRXSEND",2)

"BLD",9799,"KRN",8989.51,0)
8989.51
"BLD",9799,"KRN",8989.52,0)
8989.52
"BLD",9799,"KRN",8994,0)
8994
"BLD",9799,"KRN","B",.4,.4)

"BLD",9799,"KRN","B",.401,.401)

"BLD",9799,"KRN","B",.402,.402)

"BLD",9799,"KRN","B",.403,.403)

"BLD",9799,"KRN","B",.5,.5)

"BLD",9799,"KRN","B",.84,.84)

"BLD",9799,"KRN","B",3.6,3.6)

"BLD",9799,"KRN","B",3.8,3.8)

"BLD",9799,"KRN","B",9.2,9.2)

"BLD",9799,"KRN","B",9.8,9.8)

"BLD",9799,"KRN","B",19,19)

"BLD",9799,"KRN","B",19.1,19.1)

"BLD",9799,"KRN","B",101,101)

"BLD",9799,"KRN","B",409.61,409.61)

"BLD",9799,"KRN","B",771,771)

"BLD",9799,"KRN","B",779.2,779.2)

"BLD",9799,"KRN","B",870,870)

"BLD",9799,"KRN","B",8989.51,8989.51)

"BLD",9799,"KRN","B",8989.52,8989.52)

"BLD",9799,"KRN","B",8994,8994)

"BLD",9799,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9799,"QUES",0)
^9.62^^
"BLD",9799,"REQB",0)
^9.611^2^2
"BLD",9799,"REQB",1,0)
PSO*7.0*444^2
"BLD",9799,"REQB",2,0)
PSO*7.0*427^2
"BLD",9799,"REQB","B","PSO*7.0*427",2)

"BLD",9799,"REQB","B","PSO*7.0*444",1)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52.1)
1
"FIA",52,52.1,91)

"FIA",52,52.1,92)

"FIA",52,52.1,93)

"FIA",52,52.2)
1
"FIA",52,52.2,91)

"FIA",52,52.2,92)

"FIA",52,52.2,93)

"FIA",52.09)
REMOTE PRESCRIPTION LOG
"FIA",52.09,0)
^PSRXR(52.09,
"FIA",52.09,0,0)
52.09D
"FIA",52.09,0,1)
y^y^f^^^^n
"FIA",52.09,0,10)

"FIA",52.09,0,11)

"FIA",52.09,0,"RLRO")

"FIA",52.09,0,"VR")
7.0^PSO
"FIA",52.09,52.09)
0
"FIA",52.09,52.092)
0
"FIA",52.09,52.093)
0
"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,3001)

"INIT")
POST^PSORRX1
"KRN",19,142,-1)
3^1
"KRN",19,142,0)
PSO RX^Rx (Prescriptions)^^M^^^^^^^^OUTPATIENT PHARMACY^^1^
"KRN",19,142,1,0)
^19.06^1^1^3060322^^^^
"KRN",19,142,1,1,0)
This menu gives access to all prescription functions.
"KRN",19,142,10,0)
^19.01IP^28^28
"KRN",19,142,10,28,0)
2921719^
"KRN",19,142,10,28,"^")
PSO REMOTE RX REPORT
"KRN",19,142,10,"A6359",1)
New Prescription Entry^449^^
"KRN",19,142,10,"A6359",2)
Refill Prescriptions^459^^
"KRN",19,142,10,"A6359",3)
Edit Prescriptions^469^^
"KRN",19,142,10,"A6359",4)
Reprint An Outpatient Label^470^^
"KRN",19,142,10,"A6359",5)
View Prescriptions^475^^
"KRN",19,142,10,"A6359",6)
Cancel Prescription^476^^
"KRN",19,142,10,"A6359",7)
Hold/Remove from Hold^479^^
"KRN",19,142,10,"A6359",8)
Partial Prescription^478^^
"KRN",19,142,15)

"KRN",19,142,20)
D ^PSOLSET:'$D(PSOPAR) D CHK^PSOORFIN
"KRN",19,142,99)
64159,81275
"KRN",19,142,99.1)
60633,14411
"KRN",19,142,"U")
RX (PRESCRIPTIONS)
"KRN",19,2921719,-1)
0^2
"KRN",19,2921719,0)
PSO REMOTE RX REPORT^OneVA Pharmacy Prescription Report^^A^^^^^^^^^^1
"KRN",19,2921719,1,0)
^19.06^1^1^3160523^^
"KRN",19,2921719,1,1,0)
This report shows what actions have been taken on remote Rx's.
"KRN",19,2921719,20)
D ^PSORRP
"KRN",19,2921719,"U")
ONEVA PHARMACY PRESCRIPTION RE
"KRN",101,5506,-1)
3^14
"KRN",101,5506,0)
PSO LM MEDICATION PROFILE^Patient Medication Profile^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5506,.1)
profile
"KRN",101,5506,4)
40^4
"KRN",101,5506,10,0)
^101.01PA^4^4
"KRN",101,5506,20)
D PENTRY^PSOLMAO
"KRN",101,5506,26)
D A^PSOORUT3,SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","PSO LM NEW SELECT ORDER",0))_"^1:"_$S($G(PSORCNT):PSORCNT,1:PSOCNT)
"KRN",101,5506,28)
Select Action: 
"KRN",101,5506,99)
63945,28433
"KRN",101,7817,-1)
0^10
"KRN",101,7817,0)
PSO REMOTE RX QBP-Q13 EVENT^^^E^^^^^^^^
"KRN",101,7817,770)
PSO VISTA PHARM^^QBP^Q13^^^^NE^AL^2.5.1^
"KRN",101,7817,775,0)
^101.0775PA^1^1
"KRN",101,7817,775,1,0)
7818
"KRN",101,7817,775,1,"^")
PSO REMOTE RX QBP-Q13 ESUBS
"KRN",101,7818,-1)
0^11
"KRN",101,7818,0)
PSO REMOTE RX QBP-Q13 ESUBS^^^S^^^^^^^^
"KRN",101,7818,770)
^PSO EMI PHARM^^K13^^^PSORRXSEND^^^^ACK
"KRN",101,7818,773)
1^1
"KRN",101,7819,-1)
0^5
"KRN",101,7819,0)
PSO LM REMOTE ORDER MENU^Remote Order Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,7819,4)
40
"KRN",101,7819,10,0)
^101.01PA^2^2
"KRN",101,7819,10,1,0)
7820^RF^1^
"KRN",101,7819,10,1,"^")
PSO LM REFILL REMOTE ORDER
"KRN",101,7819,10,2,0)
7821^PR^2^
"KRN",101,7819,10,2,"^")
PSO LM REMOTE PARTIAL
"KRN",101,7819,26)
D SHOW^VALM
"KRN",101,7819,28)
Select Action:
"KRN",101,7819,99)
64159,81275
"KRN",101,7820,-1)
0^6
"KRN",101,7820,0)
PSO LM REFILL REMOTE ORDER^Refill Rx from Another VA Pharmacy^^A^^^^^^^^
"KRN",101,7820,2,0)
^101.02A^1^1
"KRN",101,7820,2,1,0)
RF
"KRN",101,7820,2,"B","RF",1)

"KRN",101,7820,20)
D REFREQ^PSORRX1
"KRN",101,7820,99)
64159,81275
"KRN",101,7821,-1)
0^7
"KRN",101,7821,0)
PSO LM REMOTE PARTIAL^Partial^^A^^^^^^^^
"KRN",101,7821,20)
D PARTIAL^PSORRX1
"KRN",101,7821,99)
64159,81275
"KRN",101,7822,-1)
0^12
"KRN",101,7822,0)
PSO REMOTE RX RDS-O13 EVENT^Pharmacy/Treatment Dispense Message^^E^^^^^^^^
"KRN",101,7822,99)
64159,81275
"KRN",101,7822,770)
PSO VISTA PHARM^^RDS^O13^^^^^^2.5.1^
"KRN",101,7822,775,0)
^101.0775PA^1^1
"KRN",101,7822,775,1,0)
7823
"KRN",101,7822,775,1,"^")
PSO REMOTE RX RDS-O13 ESUBS
"KRN",101,7823,-1)
0^13
"KRN",101,7823,0)
PSO REMOTE RX RDS-O13 ESUBS^Pharmacy/Treatment Dispense Message^^S^^^^^^^^
"KRN",101,7823,20)

"KRN",101,7823,99)
64159,81275
"KRN",101,7823,770)
^PSO EMI PHARM^^O14^^^PSORRXSEND^^^^RRD
"KRN",101,7823,771)
D PROCESS^PSORWRAP
"KRN",101,7823,773)
1^1
"KRN",101,7824,-1)
0^8
"KRN",101,7824,0)
PSO LM REMOTE RX REPORT MENU^Remote Rx Selection^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,7824,4)
40^9
"KRN",101,7824,10,0)
^101.01PA^1^1
"KRN",101,7824,10,1,0)
7825^SI^^
"KRN",101,7824,10,1,"^")
PSO LM SELECT REPORT ITEM
"KRN",101,7824,26)
D SHOW^VALM I $G(VALMLST) S XQORM("#")=$O(^ORD(101,"B","PSO LM SELECT REPORT ITEM",0))_"^1:"_VALMLST
"KRN",101,7824,28)
Select Action:
"KRN",101,7824,99)
64159,81275
"KRN",101,7825,-1)
0^9
"KRN",101,7825,0)
PSO LM SELECT REPORT ITEM^Select Item^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,7825,2,0)
^101.02A^^0
"KRN",101,7825,15)
Q
"KRN",101,7825,20)
D SEL^PSORRP
"KRN",101,7825,99)
64159,81275
"KRN",409.61,728,-1)
0^1
"KRN",409.61,728,0)
PSO LM REMOTE ORDER SELECTION^1^^80^8^20^0^1^^PSO LM REMOTE ORDER MENU^PSO LM REMOTE ORDER SELECTION^1^^1
"KRN",409.61,728,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,728,"ARRAY")
 ^TMP("PSOAO",$J)
"KRN",409.61,728,"FNL")
D EXIT^PSOROS
"KRN",409.61,728,"HDR")
D HDR^PSOLMUTL
"KRN",409.61,728,"HLP")
D HELP^PSOROS
"KRN",409.61,728,"INIT")
D INIT^PSOROS
"KRN",409.61,729,-1)
0^2
"KRN",409.61,729,0)
PSO LM REMOTE RX REPORT^1^^80^5^20^0^1^^PSO LM REMOTE RX REPORT MENU^OneVA PHARMACY RX REPORT^1^^1
"KRN",409.61,729,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,729,"COL",0)
^409.621^7^7
"KRN",409.61,729,"COL",1,0)
LINENO^1^4^a#
"KRN",409.61,729,"COL",2,0)
DATE^6^12^DATE
"KRN",409.61,729,"COL",3,0)
PATIENT^20^21^PATIENT
"KRN",409.61,729,"COL",4,0)
DRUG^43^20^DRUG NAME
"KRN",409.61,729,"COL",5,0)
TYPE^65^4^TYPE
"KRN",409.61,729,"COL",6,0)
QTY^71^3^QTY
"KRN",409.61,729,"COL",7,0)
DSUPP^76^4^DSUP
"KRN",409.61,729,"COL","B","DATE",2)

"KRN",409.61,729,"COL","B","DRUG",4)

"KRN",409.61,729,"COL","B","DSUPP",7)

"KRN",409.61,729,"COL","B","LINENO",1)

"KRN",409.61,729,"COL","B","PATIENT",3)

"KRN",409.61,729,"COL","B","QTY",6)

"KRN",409.61,729,"COL","B","TYPE",5)

"KRN",409.61,729,"FNL")
D EXIT^PSORRP
"KRN",409.61,729,"HDR")
D HDR^PSORRP
"KRN",409.61,729,"HLP")
D HELP^PSORRP
"KRN",409.61,729,"INIT")
D INIT^PSORRP
"KRN",409.61,730,-1)
0^3
"KRN",409.61,730,0)
PSO LM REMOTE REPORT DETAILS^2^^80^4^20^0^1^^^OneVA PHARMACY RX DETAILS^1^^1
"KRN",409.61,730,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,730,"ARRAY")
 ^TMP("PSORRD",$J)
"KRN",409.61,730,"FNL")
D EXIT^PSORRD
"KRN",409.61,730,"HDR")
D HDR^PSORRD
"KRN",409.61,730,"HLP")
D HELP^PSORRD
"KRN",409.61,730,"INIT")
D INIT^PSORRD
"KRN",771,251,-1)
0^2
"KRN",771,251,0)
PSO VISTA PHARM^a^^^^^USA
"KRN",771,251,"EC")

"KRN",771,251,"FS")

"KRN",771,252,-1)
0^1
"KRN",771,252,0)
PSO EMI PHARM^a^^^^^USA
"KRN",771,252,"EC")

"KRN",771,252,"FS")

"KRN",870,278,-1)
0^2
"KRN",870,278,0)
PSORRXSEND^^TCP^^^^^VIPDEV31.AAC.DOMAIN.EXT^^^^^^^^^^^^^10
"KRN",870,278,200)
^^^60^60^^^^^R
"KRN",870,278,400)
vaaussoalebp2.aac.domain.ext^2200^C^N^15^^^^
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
454^3161110^520736444
"PKG",170,22,1,"PAH",1,1,0)
^^1^1^3161110
"PKG",170,22,1,"PAH",1,1,1,0)
One VA Pharmacy remote prescription enhancements.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
21
"RTN","PSOORAL2")
0^14^B25020405^B19100790
"RTN","PSOORAL2",1,0)
PSOORAL2 ;BHAM-ISC/SAB - build listman activity logs con't ;7/27/16 6:45pm
"RTN","PSOORAL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**258,260,386,427,454**;DEC 1997;Build 349
"RTN","PSOORAL2",3,0)
 ;
"RTN","PSOORAL2",4,0)
RF ;refill log
"RTN","PSOORAL2",5,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSOORAL2",6,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",7,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSOORAL2",8,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSOORAL2",9,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORAL2",10,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSOORAL2",11,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORAL2",12,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORAL2",13,0)
 .; grab remote fill information as part of OneVA project
"RTN","PSOORAL2",14,0)
 .; and display if available
"RTN","PSOORAL2",15,0)
 .N REMOTEF,REMOTEPH,REMOTES
"RTN","PSOORAL2",16,0)
 .S REMOTEF=$G(^PSRX(DA,1,N,"RF")),REMOTEPH=$P(REMOTEF,U,2),REMOTES=$P(REMOTEF,U)
"RTN","PSOORAL2",17,0)
 .I REMOTES D
"RTN","PSOORAL2",18,0)
 .. S REMOTES=$$FIND1^DIC(4,,"X",REMOTES,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)")
"RTN","PSOORAL2",19,0)
 .. I 'REMOTES S REMOTES="" Q
"RTN","PSOORAL2",20,0)
 .. S REMOTES=$$GET1^DIQ(4,REMOTES_",",99)
"RTN","PSOORAL2",21,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S(REMOTEPH]"":REMOTEPH,$D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",22,0)
 .S PSDIV=$S(REMOTES]"":REMOTES,$D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORAL2",23,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORAL2",24,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSOORAL2",25,0)
 .; Always display the NDC# - PSO*7*427
"RTN","PSOORAL2",26,0)
 .S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSOORAL2",27,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSOORAL2",28,0)
 K RTS Q
"RTN","PSOORAL2",29,0)
PAR ;partial log
"RTN","PSOORAL2",30,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSOORAL2",31,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",32,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSOORAL2",33,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSOORAL2",34,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSOORAL2",35,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSOORAL2",36,0)
 .; grab remote fill information as part of OneVA project
"RTN","PSOORAL2",37,0)
 .; and display if available
"RTN","PSOORAL2",38,0)
 .N REMOTEF,REMOTEPH,REMOTES
"RTN","PSOORAL2",39,0)
 .S REMOTEF=$G(^PSRX(DA,"P",N,"PF")),REMOTEPH=$P(REMOTEF,U,2),REMOTES=$P(REMOTEF,U)
"RTN","PSOORAL2",40,0)
 .I REMOTES D
"RTN","PSOORAL2",41,0)
 .. S REMOTES=$$FIND1^DIC(4,,"X",REMOTES,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)")
"RTN","PSOORAL2",42,0)
 .. I 'REMOTES S REMOTES="" Q
"RTN","PSOORAL2",43,0)
 .. S REMOTES=$$GET1^DIQ(4,REMOTES_",",99)
"RTN","PSOORAL2",44,0)
 .S PSDIV=$S(REMOTES]"":REMOTES,$D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSOORAL2",45,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSOORAL2",46,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S(REMOTEPH]"":REMOTEPH,$D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",47,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSOORAL2",48,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(^VA(200,$P(P1,"^",7),0),"^")
"RTN","PSOORAL2",49,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSOORAL2",50,0)
 Q
"RTN","PSOORAL2",51,0)
HLD ;hold info
"RTN","PSOORAL2",52,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$$GET1^DIQ(52,DA,99)
"RTN","PSOORAL2",53,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT
"RTN","PSOORAL2",54,0)
 I $P($G(^PSRX(DA,"H")),"^",2)]"" D
"RTN","PSOORAL2",55,0)
 . N HLDCOMM S HLDCOMM=$P(^PSRX(DA,"H"),"^",2)
"RTN","PSOORAL2",56,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSOORAL2",57,0)
 . F  Q:HLDCOMM=""  D
"RTN","PSOORAL2",58,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="               "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSOORAL2",59,0)
 K RN,DAT,DTT,HLDR
"RTN","PSOORAL2",60,0)
 Q
"RTN","PSOORAL2",61,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORAL2",62,0)
 Q
"RTN","PSOORNE2")
0^9^B107800723^B68332016
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB - Display finished orders from backdoor ;7/15/16 2:30pm
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148,222,238,264,281,289,251,379,391,313,282,427,454**;DEC 1997;Build 349
"RTN","PSOORNE2",3,0)
 ;
"RTN","PSOORNE2",4,0)
 ;^PSDRUG( -  221
"RTN","PSOORNE2",5,0)
 ;^YSCL(603.01 - 2697
"RTN","PSOORNE2",6,0)
 ;^PS(50.606 - 2174
"RTN","PSOORNE2",7,0)
 ;^PS(50.7 - 2223
"RTN","PSOORNE2",8,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",9,0)
 ;$$DAWEXT^PSSDAWUT - 4708
"RTN","PSOORNE2",10,0)
 ;
"RTN","PSOORNE2",11,0)
SEL N ORN,ORD,PSORRBLD I '$G(PSOCNT),'$G(PSORCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_$S($G(PSORCNT):PSORCNT,1:PSOCNT) D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",13,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",14,0)
 ;*282 Correct Patient Instructions Copy
"RTN","PSOORNE2",15,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  D  D UL1 K ^TMP("PSORXPO",$J),PSORXED,PSONEW,PSOPINS I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",16,0)
 .; bwf 1/21/2014 - replaced line below with the one that follows for remote rx data handling.
"RTN","PSOORNE2",17,0)
 .;S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5")
"RTN","PSOORNE2",18,0)
 .S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",$P(PSOLST(ORN),"^")="R52":"RACT",1:"PEN^PSOORNE5")
"RTN","PSOORNE2",19,0)
 .K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1
"RTN","PSOORNE2",20,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",21,0)
 K PSONACT,PSOOELSE,CLOZPAT
"RTN","PSOORNE2",22,0)
 ;
"RTN","PSOORNE2",23,0)
 ; Only rebuild remote if something changed
"RTN","PSOORNE2",24,0)
 I $G(PSORRBLD) W !!,"Updating prescription order list...",!! D REMOTERX^PSORRX1(PSODFN,PSOSITE) K PSORRBLD
"RTN","PSOORNE2",25,0)
 ;
"RTN","PSOORNE2",26,0)
 D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",27,0)
 Q
"RTN","PSOORNE2",28,0)
 ;
"RTN","PSOORNE2",29,0)
ACT N REF,RPHKEY,PKIND K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",30,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",31,0)
 I 'RX3 S RX3=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",32,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",33,0)
 ;PSO*7*238;SET PSODRUG ARRAY ; PSOY KILLED AT END OF SET^PSODRG
"RTN","PSOORNE2",34,0)
 K PSODRUG
"RTN","PSOORNE2",35,0)
 S PSOY=PSODRG,PSOY(0)=PSODRUG0 D SET^PSODRG
"RTN","PSOORNE2",36,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",37,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",38,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",39,0)
 .;S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",40,0)
 .S CLOZPAT=$P(^YSCL(603.01,CLOZPAT,0),"^",3)
"RTN","PSOORNE2",41,0)
 .S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORNE2",42,0)
 S PKIND=$D(^PSRX(RXN,"PKI")),RPHKEY=$S('PKIND&($D(^XUSEC("PSORPH",DUZ))):1,PKIND&($D(^XUSEC("PSDRPH",DUZ))):1,1:0)
"RTN","PSOORNE2",43,0)
 I RPHKEY S RPH=1 D
"RTN","PSOORNE2",44,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1!(ST=4):"DVE",ST=3:"DU",ST=5:"ELTD",ST=11:"ETDPCL",ST=12&EXDT:"EDCL",ST=12&'EXDT:"ECL",(ST=14!(ST=15))&'EXDT:"ECL",ST=13:"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",45,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",46,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",47,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",48,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",49,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",50,0)
 E  D
"RTN","PSOORNE2",51,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",52,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",53,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",54,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",55,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",56,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",57,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",58,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",59,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$$TITRX^PSOUTL(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$$TITRX^PSOUTL(RXN))+1,12)
"RTN","PSOORNE2",60,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",61,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",62,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",63,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",64,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",65,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",66,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",67,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",68,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",69,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",70,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",71,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",72,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",73,0)
 S SIGOK=1
"RTN","PSOORNE2",74,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",75,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",76,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",77,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",78,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",79,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",80,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",81,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",82,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",83,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",84,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",85,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",86,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",87,0)
 ;*282 Correct return to stock/release display
"RTN","PSOORNE2",88,0)
 S IEN=IEN+1 D
"RTN","PSOORNE2",89,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",90,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",91,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",92,0)
 .I $P(RX2,"^",15)&'$G(RLD) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",93,0)
 .E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: "_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",94,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",95,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",96,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",97,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",98,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",99,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",100,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",101,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",102,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",103,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",104,0)
 I +$P($G(^PSDRUG($P(RX0,"^",6),0)),"^",3)>1,+$P($G(^PSDRUG($P(RX0,"^",6),0)),"^",3)<6 D PRV^PSOORNE5
"RTN","PSOORNE2",105,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",106,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",107,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",108,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",109,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",110,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",111,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",112,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",113,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",114,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",115,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",116,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",117,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",118,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",119,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",120,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))
"RTN","PSOORNE2",121,0)
 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1
"RTN","PSOORNE2",122,0)
RENERR S PSORERR=0 D ^PSOLMLST
"RTN","PSOORNE2",123,0)
 I PSORERR=1 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 G RENERR
"RTN","PSOORNE2",124,0)
 K DRET,SIG
"RTN","PSOORNE2",125,0)
 Q
"RTN","PSOORNE2",126,0)
UL1 ;
"RTN","PSOORNE2",127,0)
 Q
"RTN","PSOORNE2",128,0)
 ; bwf 1/21/2014 - adding display of remote active orders.
"RTN","PSOORNE2",129,0)
RACT ; display remote active order
"RTN","PSOORNE2",130,0)
 N REMSITE,CNT,REMDATA,RSITENM,RRXNUM,RDETSTR,RSIGSTR,RDET,RSIG,REMSIEN,RXSTAT,SIGLOOP,DETLOOP,DONE,SRXSTAT,SDNAME,DNAME
"RTN","PSOORNE2",131,0)
 K ^TMP("PSOAO",$J)
"RTN","PSOORNE2",132,0)
 S (RSIG,RDET)=""
"RTN","PSOORNE2",133,0)
 S REMSITE=$P(PSOLST(ORN),U,4) Q:'REMSITE
"RTN","PSOORNE2",134,0)
 S REMSIEN=$O(^DIC(4,"D",REMSITE,""))
"RTN","PSOORNE2",135,0)
 S REMSIEN=$$FIND1^DIC(4,,"X",REMSITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)") Q:'REMSIEN
"RTN","PSOORNE2",136,0)
 S RSITENM=$$GET1^DIQ(4,REMSIEN,.01,"E")
"RTN","PSOORNE2",137,0)
 ; do not continue if we are missing the remote order number for some reason
"RTN","PSOORNE2",138,0)
 S RRXNUM=$P(PSOLST(ORN),U,2) Q:'RRXNUM
"RTN","PSOORNE2",139,0)
 S DONE=0
"RTN","PSOORNE2",140,0)
 S RXSTAT="" F  S RXSTAT=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT)) Q:RXSTAT=""!DONE  D
"RTN","PSOORNE2",141,0)
 .S SRXSTAT=RXSTAT
"RTN","PSOORNE2",142,0)
 .S DNAME="" F  S DNAME=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT,DNAME)) Q:DNAME=""!DONE  D
"RTN","PSOORNE2",143,0)
 ..S SDNAME=DNAME
"RTN","PSOORNE2",144,0)
 ..I $P(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT,DNAME,0),U,1)=RRXNUM S DONE=1 Q
"RTN","PSOORNE2",145,0)
 Q:$G(SRXSTAT)=""
"RTN","PSOORNE2",146,0)
 S REMDATA=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,0))
"RTN","PSOORNE2",147,0)
 S RDETSTR=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,"DETAIL"))
"RTN","PSOORNE2",148,0)
 S RSIGSTR=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,"SIG"))
"RTN","PSOORNE2",149,0)
 S CNT=1
"RTN","PSOORNE2",150,0)
 S ^TMP("PSOAO",$J,CNT,0)="         Site #: "_REMSITE_"("_RSITENM_")",CNT=CNT+1
"RTN","PSOORNE2",151,0)
 S ^TMP("PSOAO",$J,CNT,0)="           Rx #: "_RRXNUM,CNT=CNT+1
"RTN","PSOORNE2",152,0)
 S ^TMP("PSOAO",$J,CNT,0)="      Drug Name: "_$P(REMDATA,U,11),CNT=CNT+1
"RTN","PSOORNE2",153,0)
 S ^TMP("PSOAO",$J,CNT,0)="    Days Supply: "_$S($E($P(REMDATA,U,4),1)?1A:$E($P(REMDATA,U,4),2,99),1:$P(REMDATA,U,4)),CNT=CNT+1
"RTN","PSOORNE2",154,0)
 S ^TMP("PSOAO",$J,CNT,0)="       Quantity: "_$P(REMDATA,U,2),CNT=CNT+1
"RTN","PSOORNE2",155,0)
 S ^TMP("PSOAO",$J,CNT,0)="        Refills: "_$P(REMDATA,U,3),CNT=CNT+1
"RTN","PSOORNE2",156,0)
 S ^TMP("PSOAO",$J,CNT,0)="Expiration Date: "_$$RDT($P($P(REMDATA,U,5),".")),CNT=CNT+1
"RTN","PSOORNE2",157,0)
 S ^TMP("PSOAO",$J,CNT,0)="     Issue Date: "_$$RDT($P($P(REMDATA,U,6),".")),CNT=CNT+1
"RTN","PSOORNE2",158,0)
 S ^TMP("PSOAO",$J,CNT,0)="      Stop Date: "_$$RDT($P($P(REMDATA,U,7),".")),CNT=CNT+1
"RTN","PSOORNE2",159,0)
 S ^TMP("PSOAO",$J,CNT,0)=" Last Fill Date: "_$$RDT($P($P(REMDATA,U,8),".")),CNT=CNT+1
"RTN","PSOORNE2",160,0)
 ;D RCHUNK(.RDET,RDETSTR),RCHUNK(.RSIG,RSIGSTR)
"RTN","PSOORNE2",161,0)
 ;S ^TMP("PSOAO",$J,CNT,0)="         Detail: "_$G(RDET(1)),CNT=CNT+1
"RTN","PSOORNE2",162,0)
 ;S DETLOOP=1 F  S DETLOOP=$O(RDET(DETLOOP)) Q:'DETLOOP  D
"RTN","PSOORNE2",163,0)
 ;.S ^TMP("PSOAO",$J,CNT,0)="               "_RDET(DETLOOP),CNT=CNT+1
"RTN","PSOORNE2",164,0)
 D RCHUNK(.RSIG,RSIGSTR)
"RTN","PSOORNE2",165,0)
 S ^TMP("PSOAO",$J,CNT,0)="            Sig: "_$G(RSIG(1))
"RTN","PSOORNE2",166,0)
 S SIGLOOP=1 F  S SIGLOOP=$O(RSIG(SIGLOOP)) Q:'SIGLOOP  D
"RTN","PSOORNE2",167,0)
 .S CNT=CNT+1,^TMP("PSOAO",$J,CNT,0)="               "_RSIG(SIGLOOP)
"RTN","PSOORNE2",168,0)
 ; ^PSOLMLST is the local order template
"RTN","PSOORNE2",169,0)
 D EN^PSOROS
"RTN","PSOORNE2",170,0)
 Q
"RTN","PSOORNE2",171,0)
RCHUNK(ARR,STR) ;
"RTN","PSOORNE2",172,0)
 N START,END,I,C,ROOM
"RTN","PSOORNE2",173,0)
 S ROOM=60
"RTN","PSOORNE2",174,0)
 ; if there is enough room for 1 line, no wrapping needed
"RTN","PSOORNE2",175,0)
 I $L(STR)'>ROOM S ARR(1)=STR Q
"RTN","PSOORNE2",176,0)
 ; add a space to the end of the string to avoid dropping last character
"RTN","PSOORNE2",177,0)
 S START=1,END=ROOM,STR=STR_" "
"RTN","PSOORNE2",178,0)
 F C=1:1 D  Q:$L(STR)<START  ; stop if we have made it to the end of the data string
"RTN","PSOORNE2",179,0)
 .; start at the end and work backwards until you find a blank space, cut the line there and move on to the next line 
"RTN","PSOORNE2",180,0)
 .F I=END:-1:START I $E(STR,I)=" " S ARR(C)=$E(STR,START,I),START=I+1,END=ROOM+START Q
"RTN","PSOORNE2",181,0)
 .; make sure there wasn't a really long string without spaces
"RTN","PSOORNE2",182,0)
 .I I=START S ARR(C)=$E(STR,START,END),START=END+1,END=ROOM+START
"RTN","PSOORNE2",183,0)
 Q
"RTN","PSOORNE2",184,0)
RDT(DATE) ;
"RTN","PSOORNE2",185,0)
 N Y,M,D
"RTN","PSOORNE2",186,0)
 S Y=$E(DATE,3,4),M=$E(DATE,5,6),D=$E(DATE,7,8)
"RTN","PSOORNE2",187,0)
 Q M_"/"_D_"/"_Y
"RTN","PSOORUT1")
0^8^B124954661^B83321658
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;8/26/16 1:41pm
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148,233,274,225,305,289,251,387,385,313,427,444,454**;DEC 1997;Build 349
"RTN","PSOORUT1",3,0)
 ;
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",5,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",6,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",7,0)
REL ;removed order from hold
"RTN","PSOORUT1",8,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",9,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",10,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",11,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",12,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",13,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",14,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",15,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",16,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",17,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",18,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",19,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",20,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",21,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",22,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",23,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",24,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",25,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",26,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",27,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",28,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",29,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",30,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,"","",$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",31,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",32,0)
ACT1 I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",33,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",34,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",35,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",36,0)
 Q
"RTN","PSOORUT1",37,0)
SUS ;
"RTN","PSOORUT1",38,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",39,0)
 Q
"RTN","PSOORUT1",40,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",41,0)
 K PSODCREV,^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD),'$D(^XTMP("PSORRX1",$J,PSODFN)) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",42,0)
 D EOJ,SHOW
"RTN","PSOORUT1",43,0)
EOJ ;
"RTN","PSOORUT1",44,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",45,0)
 Q
"RTN","PSOORUT1",46,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",47,0)
SHOW ;
"RTN","PSOORUT1",48,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",49,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",50,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",51,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",52,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",53,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",54,0)
  . . ; PSO*7*427 - add a new section for open TRICARE/CHAMPVA/RRR rejects after the 79/88 open rejects
"RTN","PSOORUT1",55,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX,,,"79,88") S PSOTMP(" REJECT",PSODRNM)=PSOSTS Q   ; DUR/RTS
"RTN","PSOORUT1",56,0)
 . . I PSOSTS="ACTIVE",$$TRIC^PSOREJP1(PSORX),$$FIND^PSOREJUT(PSORX,,,,1) S PSOTMP(" REJECT2",PSODRNM)=PSOSTS Q  ; TRI/CVA
"RTN","PSOORUT1",57,0)
 . . I PSOSTS="ACTIVE",'$$TRIC^PSOREJP1(PSORX),$$FIND^PSOREJUT(PSORX,,,,,1) S PSOTMP(" REJECT2",PSODRNM)=PSOSTS Q  ; RRR
"RTN","PSOORUT1",58,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",59,0)
 ;
"RTN","PSOORUT1",60,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",61,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",62,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",63,0)
 . D STA
"RTN","PSOORUT1",64,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",65,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",66,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",67,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",68,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",69,0)
 ;S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",70,0)
 ; bwf - 1/9/2014, PHARMACY INNOVATIONS. Adding display of remote rx's.
"RTN","PSOORUT1",71,0)
SHOWREM ;
"RTN","PSOORUT1",72,0)
 N REMSITE,RRXIEN,RRXDAT,RRXDNAME,RRXDNL,RRXQTY,RRXQTYL,RREFILLS,RRXDSUPP,RRXEXP,RRXISSDT,RRXISSDT1,RRXLFDT,RRXLFDT1,RRXDNSP,RRXQSP,REMSIEN,STAT,STATABBR,DLINE,DLEN
"RTN","PSOORUT1",73,0)
 N BSPACE,FSPACE,RSPACE,BDNAME,RRXISP,RXDUPP,PSORRLST
"RTN","PSOORUT1",74,0)
 ; SET UP PSORCNT
"RTN","PSOORUT1",75,0)
 S PSORCNT=$G(PSOCNT)
"RTN","PSOORUT1",76,0)
 I '$D(^TMP("PSOPF",$J)) S ^TMP("PSOPF",$J,1,0)="<No local prescriptions found.>",IEN=$G(IEN)+1
"RTN","PSOORUT1",77,0)
 ;S IEN=$G(IEN)+1,^TMP("PSOPF",$J,IEN,0)="-------------------------------------REMOTE-------------------------------------"
"RTN","PSOORUT1",78,0)
 S REMSITE=0 F  S REMSITE=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE)) Q:'REMSITE  D
"RTN","PSOORUT1",79,0)
 .I REMSITE=$G(DUZ(2)) Q
"RTN","PSOORUT1",80,0)
 .;S REMSIEN=$O(^DIC(4,"D",REMSITE,0))
"RTN","PSOORUT1",81,0)
 .S REMSIEN=$$FIND1^DIC(4,,"X",REMSITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)") Q:'REMSIEN
"RTN","PSOORUT1",82,0)
 .S STAT=0 F  S STAT=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,STAT)) Q:STAT=""  D
"RTN","PSOORUT1",83,0)
 ..S STATABBR=$S(STAT="ACTIVE":"A",STAT="HOLD":"H",STAT="PROVIDER HOLD":"PH",STAT="SUSPENDED":"S",STAT["DISCONTINUED":"DC",STAT="EXPIRED":"E",1:"")
"RTN","PSOORUT1",84,0)
 ..S DLINE=$E($$GET1^DIQ(4,REMSIEN,.01,"E"),1,30)_" ("_REMSITE_")"_$S(STAT="ERR":"",1:" "_STAT),DLEN=$L(DLINE)
"RTN","PSOORUT1",85,0)
 ..S (FSPACE,RSPACE)=""
"RTN","PSOORUT1",86,0)
 ..S BSPACE=IOM-$L(DLINE),$P(FSPACE,"-",(BSPACE\2))="-",$P(RSPACE,"-",(BSPACE\2)+$S(BSPACE#2:1,1:0))="-"
"RTN","PSOORUT1",87,0)
 ..S IEN=$G(IEN)+1,^TMP("PSOPF",$J,IEN,0)=FSPACE_$E($$GET1^DIQ(4,REMSIEN,.01,"E"),1,30)_" ("_REMSITE_")"_$S(STAT="ERR":"",1:" "_STAT)_RSPACE
"RTN","PSOORUT1",88,0)
 ..I $D(^XTMP("PSORRX1",$J,PSODFN,REMSITE,"ERR")) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,"ERR"))
"RTN","PSOORUT1",89,0)
 ..S RRXDNAME="" F  S RRXDNAME=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,STAT,RRXDNAME)) Q:RRXDNAME=""  D
"RTN","PSOORUT1",90,0)
 ...S RRXDAT=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,STAT,RRXDNAME,0))
"RTN","PSOORUT1",91,0)
 ...S BDNAME=$E(RRXDNAME,1,35)
"RTN","PSOORUT1",92,0)
 ...S RRXIEN=$P(RRXDAT,U),RRXDNL=$L(BDNAME),RRXQTY=$P(RRXDAT,U,2),RRXQTYL=$L(RRXQTY),RREFILLS=$P(RRXDAT,U,3),RRXDSUPP=$E($P(RRXDAT,U,4),2,4),RRXEXP=$P(RRXDAT,U,5)
"RTN","PSOORUT1",93,0)
 ...S RRXISSDT=$P($P(RRXDAT,U,6),"."),RRXISSDT1=$E(RRXISSDT,5,6)_"-"_$E(RRXISSDT,7,8),RRXLFDT=$P($P(RRXDAT,U,8),"."),RRXLFDT1=$E(RRXLFDT,5,6)_"-"_$E(RRXLFDT,7,8)
"RTN","PSOORUT1",94,0)
 ...S IEN=$G(IEN)+1,PSORCNT=PSORCNT+1
"RTN","PSOORUT1",95,0)
 ...S (RRXDNSP,RRXISP)=""
"RTN","PSOORUT1",96,0)
 ...S RRXQSP=" "_STATABBR
"RTN","PSOORUT1",97,0)
 ...S $P(RRXISP," ",14-$L(RRXIEN))=" "  ; length of Rx# varies
"RTN","PSOORUT1",98,0)
 ...S:RRXDNL+RRXQTYL>39 BDNAME=$E(BDNAME,1,$L(BDNAME)-(RRXDNL+RRXQTYL-39)),RRXDNL=$L(BDNAME)
"RTN","PSOORUT1",99,0)
 ...S $P(RRXDNSP," ",40-RRXQTYL-RRXDNL)=" "
"RTN","PSOORUT1",100,0)
 ...S $P(RRXQSP," ",4)=""
"RTN","PSOORUT1",101,0)
 ...I $L(STATABBR)=2 S RRXQSP=$E(RRXQSP,1,$L(RRXQSP)-1)
"RTN","PSOORUT1",102,0)
 ...S ^TMP("PSOPF",$J,IEN,0)=$J(PSORCNT,2)_$S($L(PSORCNT)<3:" ",1:"")_RRXIEN_RRXISP_BDNAME_RRXDNSP_RRXQTY_RRXQSP_RRXISSDT1_" "
"RTN","PSOORUT1",103,0)
 ...S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_RRXLFDT1_$S($L(RREFILLS)=1:"   ",$L(RREFILLS=2):"  ")_RREFILLS_$S($L(RRXDSUPP=2):"  ",$L(RXDUPP=1):"   ",1:" ")_RRXDSUPP
"RTN","PSOORUT1",104,0)
 ...S PSORRLST(PSORCNT)=IEN
"RTN","PSOORUT1",105,0)
 ...; PSO*7*454 - Need to specify this differently for remote rx's.
"RTN","PSOORUT1",106,0)
 ...; BWF 20161110 - LOOKING AT COUNT/DISPLAY
"RTN","PSOORUT1",107,0)
 ...;S PSOLST(PSOCNT)="R52^"_RRXIEN_U_"REMOTE"_U_REMSITE
"RTN","PSOORUT1",108,0)
 ...S PSOLST(PSORCNT)="R52^"_RRXIEN_U_"REMOTE"_U_REMSITE
"RTN","PSOORUT1",109,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",110,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",111,0)
 Q
"RTN","PSOORUT1",112,0)
 ;
"RTN","PSOORUT1",113,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME,TITRX
"RTN","PSOORUT1",114,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",115,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",116,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",117,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",118,0)
 S TITRX=$$TITRX^PSOUTL(+PSODATA) I TITRX'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",119,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_TITRX_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",120,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DP^DE^HP^P^"
"RTN","PSOORUT1",121,0)
 S PSOCMOP=""
"RTN","PSOORUT1",122,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",123,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",124,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",125,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",126,0)
 .K PSXZ
"RTN","PSOORUT1",127,0)
 S (STA,STATLTH)=$P(STA,"^",$P(PSODATA,"^",2)+1) D
"RTN","PSOORUT1",128,0)
 .I $G(^PSRX(+PSODATA,"DDSTA"))]"" S (STATLTH,STA)="DD" Q
"RTN","PSOORUT1",129,0)
 .S (STATLTH,STA)=$S($P($G(^PSRX(+PSODATA,7)),"^")=1:"DA",$P($G(^PSRX(+PSODATA,7)),"^")=2:"DF",1:STA)
"RTN","PSOORUT1",130,0)
 S STAPRT=STA_PSOCMOP,STATLTH=$L(STAPRT)
"RTN","PSOORUT1",131,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_STAPRT_$S(STATLTH=0:"   ",STATLTH=1:"  ",STATLTH=2:" ",1:"")
"RTN","PSOORUT1",132,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",133,0)
 N RFLZRO,PSOLRD S PSOLRD=$P($G(^PSRX(+PSODATA,2)),"^",13)
"RTN","PSOORUT1",134,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",135,0)
 . S RFLZRO=$G(^PSRX(+PSODATA,1,PSOX,0))
"RTN","PSOORUT1",136,0)
 . I +RFLZRO=PSOLF,$P(RFLZRO,"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",137,0)
 . S:$P(RFLZRO,"^",18)'="" PSOLRD=$P(RFLZRO,"^",18) I $P(RFLZRO,"^",16) S PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",138,0)
 K PSOX
"RTN","PSOORUT1",139,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R",PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",140,0)
 S PSOLF=$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",141,0)
 S PSOLRD=$S($G(PSOLRD):$E(PSOLRD,4,5),1:"  ")_"-"_$S($G(PSOLRD):$E(PSOLRD,6,7),1:"  ")_$S($P(PSOLRD,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",142,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSORFG):PSOLRD,1:PSOLF)
"RTN","PSOORUT1",143,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",144,0)
 ;recently dc'd rxs
"RTN","PSOORUT1",145,0)
 I $P($G(^PSRX(+PSODATA,3)),"^",5) D  K X
"RTN","PSOORUT1",146,0)
 .S X2=$S($P(PSOPAR,"^",33):$P(PSOPAR,"^",33),1:7),X1=$P(^PSRX(+PSODATA,3),"^",5) D C^%DTC
"RTN","PSOORUT1",147,0)
 .I DT<X S PSODCREV(IEN)=IEN
"RTN","PSOORUT1",148,0)
 ;recently expired rxs
"RTN","PSOORUT1",149,0)
 I $P($G(^PSRX(+PSODATA,2)),"^",6)<DT,'$P($G(^PSRX(+PSODATA,3)),"^",5) D  K X
"RTN","PSOORUT1",150,0)
 .S X2=$S($P(PSOPAR,"^",33):$P(PSOPAR,"^",33),1:7),X1=$P(^PSRX(+PSODATA,2),"^",6) D C^%DTC
"RTN","PSOORUT1",151,0)
 .I DT<X S PSODCREV(IEN)=IEN
"RTN","PSOORUT1",152,0)
 ;
"RTN","PSOORUT1",153,0)
 I (PSODQL>38)!$$BADADDFL^PSOUTIL(+PSODATA) D
"RTN","PSOORUT1",154,0)
 .S IEN=IEN+1
"RTN","PSOORUT1",155,0)
 .I PSODQL>38 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",156,0)
 .I $$BADADDFL^PSOUTIL(+PSODATA) S $E(^TMP("PSOPF",$J,IEN,0),61)="*** Bad Address ***"
"RTN","PSOORUT1",157,0)
 ;
"RTN","PSOORUT1",158,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",159,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",160,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",161,0)
 Q
"RTN","PSOORUT1",162,0)
 ;
"RTN","PSOORUT1",163,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",164,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",165,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",166,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",167,0)
 I PSOSTS=" REJECT2" S LABEL="OTHER REJECTS PENDING RESOLUTION"  ;PSO*7*427 added new section
"RTN","PSOORUT1",168,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",169,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",170,0)
 Q
"RTN","PSOORUT1",171,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",172,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",173,0)
 Q
"RTN","PSOORUT1",174,0)
PEN ;
"RTN","PSOORUT1",175,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",176,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",177,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",178,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",179,0)
 I $P($G(^PS(52.41,+$P(PSODATA,"^",10),0)),"^",23)=1 S ^TMP("PSOPF",$J,IEN,"RV")=""
"RTN","PSOORUT1",180,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",181,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",182,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",183,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",184,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",185,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",186,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",187,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",188,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",189,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",190,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",191,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",192,0)
 G PENX
"RTN","PSOORUT1",193,0)
 ;
"RTN","PSOORUT1",194,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",195,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",196,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",197,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",198,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",199,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",200,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",201,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",202,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",203,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",204,0)
 Q
"RTN","PSORLLL1")
0^15^B70716253^n/a
"RTN","PSORLLL1",1,0)
PSORLLL1 ;AITC/BWF - LASER LABELS ;10/24/2002
"RTN","PSORLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLL1",3,0)
 ;
"RTN","PSORLLL1",4,0)
 ;bwf - modified copy of PSOLLL1 - OneVa Pharmacy
"RTN","PSORLLL1",5,0)
 ;
"RTN","PSORLLL1",6,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSORLLL1",7,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSORLLL1",8,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSORLLL1",9,0)
 ;
"RTN","PSORLLL1",10,0)
ST ;
"RTN","PSORLLL1",11,0)
 ; Cosigner logic removed since it doesn't exist locally in RX file (dispensing site) nor on host site.
"RTN","PSORLLL1",12,0)
 ;I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSORLLL1",13,0)
 ;. I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_$P($G(^VA(200,+$P($G(^PSRX(RX,3)),"^",3),0)),"^") 
"RTN","PSORLLL1",14,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSORLLL1",15,0)
 ;
"RTN","PSORLLL1",16,0)
 ;get issue date from HL7 return
"RTN","PSORLLL1",17,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P($G(RX0),U,13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSORLLL1",18,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSORLLL1",19,0)
 ;
"RTN","PSORLLL1",20,0)
 ;getting finishing person
"RTN","PSORLLL1",21,0)
 ;using same logic to get TECH as PSORLLLI
"RTN","PSORLLL1",22,0)
 S TECH="("_PSOINST_":"_$G(DUZ)_")"
"RTN","PSORLLL1",23,0)
 ;
"RTN","PSORLLL1",24,0)
 ;get HOST ZIP from HL7 return
"RTN","PSORLLL1",25,0)
 N HINFOZIP
"RTN","PSORLLL1",26,0)
 S HINFOZIP=$P($P($P(HINFO,U,2),"~",5),"&")
"RTN","PSORLLL1",27,0)
 S PSOHZIP=$S(HINFOZIP["-":HINFOZIP,1:$E(HINFOZIP,1,5)_$S($E(HINFOZIP,6,9)]"":"-"_$E(HINFOZIP,6,9),1:""))
"RTN","PSORLLL1",28,0)
 ;
"RTN","PSORLLL1",29,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSORLLL1",30,0)
 ;get HOST CITY from HL7 return
"RTN","PSORLLL1",31,0)
 S T="VAMC "_$P(HINFO,"^")_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSORLLL1",32,0)
 ;
"RTN","PSORLLL1",33,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P($G(HINFO),"^",3) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSORLLL1",34,0)
 ;
"RTN","PSORLLL1",35,0)
 ;get DISPENSE UNIT of LOCDRUG
"RTN","PSORLLL1",36,0)
 S PSDU=$P($G(^PSDRUG(LOCDRUG,660)),"^",8)
"RTN","PSORLLL1",37,0)
 ;
"RTN","PSORLLL1",38,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSORLLL1",39,0)
 ;
"RTN","PSORLLL1",40,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSORLLL1",41,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSORLLL1",42,0)
 ;
"RTN","PSORLLL1",43,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSORLLL1",44,0)
 S DR=$G(SIGF("DR"))
"RTN","PSORLLL1",45,0)
 ;
"RTN","PSORLLL1",46,0)
 S RXF=$G(REFIEN) ;at least that's where I think we left it. 
"RTN","PSORLLL1",47,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSORLLL1",48,0)
 ;
"RTN","PSORLLL1",49,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSORLLL1",50,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSORLLL1",51,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSORLLL1",52,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSORLLL1",53,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSORLLL1",54,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSORLLL1",55,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSORLLL1",56,0)
 S DR=SIGF("DR")
"RTN","PSORLLL1",57,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSORLLL1",58,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSORLLL1",59,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSORLLL1",60,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSORLLL1",61,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSORLLL1",62,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSORLLL1",63,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSORLLL1",64,0)
 I '$D(NSGY) G CONT
"RTN","PSORLLL1",65,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSORLLL1",66,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSORLLL1",67,0)
 S DEA=$P($G(^PSDRUG(LOCDRUG,0)),"^",3),T=""
"RTN","PSORLLL1",68,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSORLLL1",69,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSORLLL1",70,0)
 S PSOY=PSOY-5
"RTN","PSORLLL1",71,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSORLLL1",72,0)
 . S NOR=$P(RXY,"^",9)
"RTN","PSORLLL1",73,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSORLLL1",74,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSORLLL1",75,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSORLLL1",76,0)
 S PPHYS=$G(PHYS)
"RTN","PSORLLL1",77,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSORLLL1",78,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSORLLL1",79,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSORLLL1",80,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSORLLL1",81,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSORLLL1",82,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSORLLL1",83,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSORLLL1",84,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSORLLL1",85,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSORLLL1",86,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSORLLL1",87,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSORLLL1",88,0)
 D PRINT(T,1)
"RTN","PSORLLL1",89,0)
 I SIGM G CONT
"RTN","PSORLLL1",90,0)
 ;S ^PSRX(RX,"TYPE")=0
"RTN","PSORLLL1",91,0)
WARN ;PRINT WARNING LABELS
"RTN","PSORLLL1",92,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSORLLL1",93,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSORLLL1",94,0)
 K PSOWLBL
"RTN","PSORLLL1",95,0)
 ; BWF - what if there is no language defined in the pharmacy patient file?
"RTN","PSORLLL1",96,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSORLLL1",97,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSORLLL1",98,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSORLLL1",99,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSORLLL1",100,0)
 . D WARN54^PSOLLLW
"RTN","PSORLLL1",101,0)
 ;RETURN MAIL
"RTN","PSORLLL1",102,0)
 ;S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSORLLL1",103,0)
 ;S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSORLLL1",104,0)
 S VAADDR1=$P(HINFO,U)
"RTN","PSORLLL1",105,0)
 S VASTREET=$P($P(HINFO,U,2),"~")
"RTN","PSORLLL1",106,0)
 S STATE=$S($P($P(HINFO,U,2),"~",4)]"":$P($P(HINFO,U,2),"~",4),1:"UNKNOWN")
"RTN","PSORLLL1",107,0)
 ;S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSORLLL1",108,0)
 S PSZIP=$P($P($P(HINFO,U,2),"~",5),"&"),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSORLLL1",109,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSORLLL1",110,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSORLLL1",111,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSORLLL1",112,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSORLLL1",113,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSORLLL1",114,0)
 S T=$P($P(HINFO,"^",2),"~",3)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSORLLL1",115,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSORLLL1",116,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"",1:"CERTIFIED MAIL-") S T=T_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSORLLL1",117,0)
 S PSOFONT=OFONT
"RTN","PSORLLL1",118,0)
 S T=PNM
"RTN","PSORLLL1",119,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(T,0)
"RTN","PSORLLL1",120,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSORLLL1",121,0)
 ; ADD CHECK FOR BAD ADDRESS INDICATOR OR FOREIGN ADDRESS
"RTN","PSORLLL1",122,0)
 N PSOBADR,PSOTEMP,PSOFORGN,I
"RTN","PSORLLL1",123,0)
 S PSOBADR=0,PSOTEMP=0
"RTN","PSORLLL1",124,0)
 ;
"RTN","PSORLLL1",125,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2)
"RTN","PSORLLL1",126,0)
 I PSOFORGN'="" D  ;*370
"RTN","PSORLLL1",127,0)
 . N PSOFOREN S PSOFOREN=1
"RTN","PSORLLL1",128,0)
 . I PSOFORGN["UNITED STATES",$P(PS,"^")'["MANILA" S PSOFOREN=0
"RTN","PSORLLL1",129,0)
 . I PSOFORGN["PHILIPPINES",$P(PS,"^")["MANILA" S PSOFOREN=0
"RTN","PSORLLL1",130,0)
 . S PSOFORGN=PSOFOREN
"RTN","PSORLLL1",131,0)
 I 'PSOFORGN S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSORLLL1",132,0)
 I 'PSOFORGN,PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN)
"RTN","PSORLLL1",133,0)
 ;
"RTN","PSORLLL1",134,0)
 F I=1:1:3 I $G(VAPA(I))]"" D
"RTN","PSORLLL1",135,0)
 . S T="" I I=1,'PSOFORGN,PSOBADR,'$G(PSOTEMP) S T="** BAD ADDRESS INDICATED **"
"RTN","PSORLLL1",136,0)
 . I I=1,T="",PSOFORGN S T="*** FOREIGN ADDRESS ***"
"RTN","PSORLLL1",137,0)
 . I T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(I))
"RTN","PSORLLL1",138,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSORLLL1",139,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSORLLL1",140,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSORLLL1",141,0)
 S T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSORLLL1",142,0)
 D PRINT(T,0)
"RTN","PSORLLL1",143,0)
W ;
"RTN","PSORLLL1",144,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSORLLL1",145,0)
 N XFONT
"RTN","PSORLLL1",146,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSORLLL1",147,0)
 I T["WINDOW" D
"RTN","PSORLLL1",148,0)
 . ;I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSORLLL1",149,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSORLLL1",150,0)
 . ;S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSORLLL1",151,0)
 . ; bwf replaced line above with line below
"RTN","PSORLLL1",152,0)
 . S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSORLLL1",153,0)
 . N FIRST
"RTN","PSORLLL1",154,0)
 . S FIRST=1
"RTN","PSORLLL1",155,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSORLLL1",156,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSORLLL1",157,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSORLLL1",158,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSORLLL1",159,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSORLLL1",160,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSORLLL1",161,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSORLLL1",162,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSORLLL1",163,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSORLLL1",164,0)
 S PSOFONT=OFONT
"RTN","PSORLLL1",165,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSORLLL1",166,0)
 I $G(COPIES)>1 G BARC
"RTN","PSORLLL1",167,0)
 I 'L2!PFM D ^PSORLLL2 S L2=1
"RTN","PSORLLL1",168,0)
 I 'L3 D ^PSORLLL3 S L3=1
"RTN","PSORLLL1",169,0)
 I 'L4!PMIM S PIMI=0 D ^PSORLLL4 S L4=1
"RTN","PSORLLL1",170,0)
 I L5 W @IOF G CONT2
"RTN","PSORLLL1",171,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSORLLL1",172,0)
 S BOTTLBL=1
"RTN","PSORLLL1",173,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSORLLL1",174,0)
 S X2=$P(HINFO,"^",4)_"-"_RX W X2
"RTN","PSORLLL1",175,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSORLLL1",176,0)
BARCE W @IOF
"RTN","PSORLLL1",177,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSORLLL1",178,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSORLLL1",179,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSORLLL1",180,0)
 . S COPIES=COPIES-1
"RTN","PSORLLL1",181,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSORLLL1",182,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSORLLL1",183,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSORLLL1",184,0)
 N PSOBADR,PSOTEMP
"RTN","PSORLLL1",185,0)
 S (PSOBADR,PSOTEMP)=""
"RTN","PSORLLL1",186,0)
 S L5=1
"RTN","PSORLLL1",187,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSORLLL1",188,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSORLLL1",189,0)
 I $G(PSOBLALL)=1,$P(RPPL,",",PI+1)="" D TRAIL
"RTN","PSORLLL1",190,0)
 Q
"RTN","PSORLLL1",191,0)
PRINT(T,B) ;
"RTN","PSORLLL1",192,0)
 S BOLD=$G(B)
"RTN","PSORLLL1",193,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL1",194,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLL1",195,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL1",196,0)
 W T,!
"RTN","PSORLLL1",197,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL1",198,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSORLLL1",199,0)
 Q
"RTN","PSORLLL1",200,0)
TRAIL I $G(SIDE) G END
"RTN","PSORLLL1",201,0)
 D ^PSORLLL5
"RTN","PSORLLL1",202,0)
 D ^PSORLLLH G END
"RTN","PSORLLL1",203,0)
 ; BWF - not planning on going further than PSOLLLH for OneVA Pharmacy
"RTN","PSORLLL1",204,0)
 ;D ^PSOLLL6
"RTN","PSORLLL1",205,0)
 ;I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSORLLL1",206,0)
 ;I '$G(REPRINT) D ^PSOLLL7
"RTN","PSORLLL1",207,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSORLLL1",208,0)
 W @IOF
"RTN","PSORLLL1",209,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSORLLL1",210,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL1",211,0)
 S T="NEXT PATIENT"
"RTN","PSORLLL1",212,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSORLLL1",213,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL1",214,0)
 W T,!
"RTN","PSORLLL1",215,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL1",216,0)
 Q
"RTN","PSORLLL1",217,0)
 ;
"RTN","PSORLLL2")
0^17^B16763889^n/a
"RTN","PSORLLL2",1,0)
PSORLLL2 ;AITC/BWF-LASER LABEL ;11/19/02
"RTN","PSORLLL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLL2",3,0)
 ;
"RTN","PSORLLL2",4,0)
 ; BWF - modified copy of PSOLLL2
"RTN","PSORLLL2",5,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSORLLL2",6,0)
L1 I $G(PSOIO("PFDI"))]"" X PSOIO("PFDI")
"RTN","PSORLLL2",7,0)
 I '$G(PFF) D
"RTN","PSORLLL2",8,0)
 .N PGY
"RTN","PSORLLL2",9,0)
 .M PGY=SGY I $D(OSGY) K PGY M PGY=OSGY
"RTN","PSORLLL2",10,0)
 .D COUNTSGF^PSOLLLW
"RTN","PSORLLL2",11,0)
 S PFM=0,T=$S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"")
"RTN","PSORLLL2",12,0)
 S T=T_$S($G(RXP):"(PARTIAL)",1:"")_$S($D(REPRINT):" ",$G(RXP):" ",1:"")_$P(PS2,"^",2)_"  "_TECH_"  "_$P(PSONOWT,":",1,2) D PRINT(T)
"RTN","PSORLLL2",13,0)
 S T="Rx# "_RXN_"  "_DATE_"  "_$S('PFF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(fill document continued)") D PRINT(T)
"RTN","PSORLLL2",14,0)
 S SSNPN=""
"RTN","PSORLLL2",15,0)
 S T=PNM_" "_$G(SSNPN) D PRINT(T,1) S SSNPN=""
"RTN","PSORLLL2",16,0)
 S LENGTH=0,PTEXT="",PFF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSORLLL2",17,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSORLLL2",18,0)
 S DR=PFF("DR")
"RTN","PSORLLL2",19,0)
 F I=1:1 Q:'$D(NPGY(DR,I))  S TEXT=NPGY(DR,I) D PRINT(TEXT)
"RTN","PSORLLL2",20,0)
 I I>4,$D(NPGY(DR,5)) S PFF=1,PFF("DR")=DR+1
"RTN","PSORLLL2",21,0)
 S OPSOY=PSOY
"RTN","PSORLLL2",22,0)
 I $G(PSOIO("PFDQ"))]"" X PSOIO("PFDQ")
"RTN","PSORLLL2",23,0)
 I PFF S PSOX=PSOCX,PSOY=OPSOY,T="(continued on next fill document)" S PFM=1 D PRINT(T) Q
"RTN","PSORLLL2",24,0)
 K NPGY,^TMP($J,"PSOSIGF")
"RTN","PSORLLL2",25,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSORLLL2",26,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSORLLL2",27,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSORLLL2",28,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSORLLL2",29,0)
 S PPHYS=$G(PHYS)
"RTN","PSORLLL2",30,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG2",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSORLLL2",31,0)
 I LENGTH>3.7 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG2",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.7 Q
"RTN","PSORLLL2",32,0)
 S OPSOX=PSOX,PSOX=Q(1)*300+OPSOX,T=$G(QTY) D PRINT(T) S PSOX=OPSOX
"RTN","PSORLLL2",33,0)
 S PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSORLLL2",34,0)
 S PSOY=PSOY-PSOYI,PSOX=Q(1)+Q(4)*300+OPSOX,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSORLLL2",35,0)
 I $G(PSOIO("PFDT"))]"" X PSOIO("PFDT")
"RTN","PSORLLL2",36,0)
 S T=DRUG D PRINT(T)
"RTN","PSORLLL2",37,0)
L11 ;
"RTN","PSORLLL2",38,0)
 N NDCTEXT
"RTN","PSORLLL2",39,0)
 S NDCTEXT="NDC/MFR_______________"
"RTN","PSORLLL2",40,0)
 I $$ECMEON^BPSUTIL(PSOSITE) S NDCTEXT="NDC "_$$NDCFMT^PSSNDCUT($$GET1^DIQ(50,LOCDRUG,31,"E"))
"RTN","PSORLLL2",41,0)
 S OPSOX=PSOX,T=NDCTEXT D PRINT(T)
"RTN","PSORLLL2",42,0)
 S T="Lot# ___________________" D STRT^PSOLLU1("SIG2",T,.L)
"RTN","PSORLLL2",43,0)
 S PSOY=PSOY-PSOYI,PSOX=L(XFONT+2)*300+OPSOX,T="Lot# _____________________" D PRINT(T)
"RTN","PSORLLL2",44,0)
L12 S PSOX=OPSOX,T="Tech___________________    RPh _____________________" D PRINT(T)
"RTN","PSORLLL2",45,0)
 S PSOFONT=PSOTFONT
"RTN","PSORLLL2",46,0)
 S T="Routing: "_$S("W"[$E(MW):MW,PS55=2:"DO NOT MAIL",1:MW_" MAIL")_"    Days supply: "_$G(DAYS)_"     Cap: "_$S('PSCAP:"SAFETY",1:"") D PRINT(T)
"RTN","PSORLLL2",47,0)
 I PSCAP D
"RTN","PSORLLL2",48,0)
 .D STRT^PSOLLU1("SIG2",T,.L) S LENGTH=L(XFONT+1)
"RTN","PSORLLL2",49,0)
 .S OPSOX=PSOX,T="NON-SAFETY",PSOX=LENGTH*300+OPSOX,PSOY=PSOY-PSOYI D PRINT(T,1) S PSOX=OPSOX
"RTN","PSORLLL2",50,0)
 S T="Isd: "_ISD_"    Exp: "_EXPDT_"    Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSORLLL2",51,0)
 S PSOYI=PSOBYI,PSOY=PSOBY
"RTN","PSORLLL2",52,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSORLLL2",53,0)
 S X2=$P($G(HINFO),"^",4)_"-"_RX
"RTN","PSORLLL2",54,0)
 W X2
"RTN","PSORLLL2",55,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSORLLL2",56,0)
 I $G(PSOIO("PFDW"))]"" X PSOIO("PFDW")
"RTN","PSORLLL2",57,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSORLLL2",58,0)
 I $G(WARN)'="" S PTEXT="DRUG WARNING " D STRT^PSOLLU1("SIG2",PTEXT,.L) S LENGTH=L(XFONT) D
"RTN","PSORLLL2",59,0)
 . F I=1:1:$L(WARN,",") S TEXT=$P(WARN,",",I)_"," D
"RTN","PSORLLL2",60,0)
 .. D STRT^PSOLLU1("SIG2",TEXT,.L)
"RTN","PSORLLL2",61,0)
 .. I LENGTH+L(XFONT)<1.8 S PTEXT=PTEXT_TEXT,LENGTH=LENGTH+L(XFONT) Q
"RTN","PSORLLL2",62,0)
 .. S LENGTH=0,I=I-1
"RTN","PSORLLL2",63,0)
 .. S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T) S PTEXT=""
"RTN","PSORLLL2",64,0)
 .. I PSOY>PSOYM W "*"
"RTN","PSORLLL2",65,0)
 . I PTEXT]"" S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T)
"RTN","PSORLLL2",66,0)
 S PTEXT="Pat. Stat "_PATST_" Clinic: "_PSCLN D STRT^PSOLLU1("SIG2",PTEXT,.L) S T=PTEXT D PRINT(T)
"RTN","PSORLLL2",67,0)
 Q
"RTN","PSORLLL2",68,0)
 ;
"RTN","PSORLLL2",69,0)
PRINT(T,B) ;
"RTN","PSORLLL2",70,0)
 S BOLD=$G(B)
"RTN","PSORLLL2",71,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL2",72,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLL2",73,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL2",74,0)
 W T,!
"RTN","PSORLLL2",75,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL2",76,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSORLLL2",77,0)
 Q
"RTN","PSORLLL3")
0^18^B8122377^n/a
"RTN","PSORLLL3",1,0)
PSORLLL3 ;AITC/BWF - LASER LABELS ;11/20/02
"RTN","PSORLLL3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLL3",3,0)
 ; BWF - modified copy of PSOLLL3
"RTN","PSORLLL3",4,0)
 ;  - References to $$GETNDC^PSSNDCUT,$$NDCFMT^PSSNDCUT,SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSORLLL3",5,0)
 ;
"RTN","PSORLLL3",6,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSORLLL3",7,0)
PF ;PATIENT FILL DOCUMENT
"RTN","PSORLLL3",8,0)
 I $G(PSOIO("PFI"))]"" X PSOIO("PFI")
"RTN","PSORLLL3",9,0)
 D  S PSOFONT=OFONT
"RTN","PSORLLL3",10,0)
 . S OFONT=PSOFONT,PSOFONT=PSOHFONT
"RTN","PSORLLL3",11,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSORLLL3",12,0)
 . I RXF+1=(1+$P(RXY,"^",9)) S T="NO REFILLS LEFT for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSORLLL3",13,0)
 . S T="PHONE IN OR MAIL THIS REFILL REQUEST" D PRINT(T,1,1)
"RTN","PSORLLL3",14,0)
 . S PSOFONT=OFONT,T="Follow the refill instructions provided with your prescription." D PRINT(T,0,1)
"RTN","PSORLLL3",15,0)
 . ;S PSOFONT=OFONT,OPSOX=PSOX,PSOX=PSOX+300,T="For Refill Call "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T,0) S PSOX=OPSOX
"RTN","PSORLLL3",16,0)
 . S PSOFONT=OFONT,OPSOX=PSOX,PSOX=PSOX+300,T="For Refill Call "_$P(HINFO,"^",3) D PRINT(T,0) S PSOX=OPSOX
"RTN","PSORLLL3",17,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T,1)
"RTN","PSORLLL3",18,0)
 S T="Rx# "_RXN_"   " D PRINT(T,1)
"RTN","PSORLLL3",19,0)
 D STRT^PSOLLU1("SEC2",T,.L) S OPSOX=PSOX,PSOX=L($E(PSOFONT,2,99))*300+PSOX
"RTN","PSORLLL3",20,0)
 S T=DATE_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),PSOY=PSOY-PSOYI D PRINT(T) S PSOX=OPSOX
"RTN","PSORLLL3",21,0)
 S T="" D PRINT(T,1)
"RTN","PSORLLL3",22,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PSDU)_"    Days supply: "_$G(DAYS) D PRINT(T,0)
"RTN","PSORLLL3",23,0)
 S T=DRUG D PRINT(T,0)
"RTN","PSORLLL3",24,0)
 S T=$$GET1^DIQ(50,LOCDRUG,31,"E"),T=$$NDCFMT^PSSNDCUT(T) D PRINT(T,1)
"RTN","PSORLLL3",25,0)
 D  D PRINT(T,1)
"RTN","PSORLLL3",26,0)
 . S NOR=$P(RXY,"^",9)
"RTN","PSORLLL3",27,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSORLLL3",28,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSORLLL3",29,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSORLLL3",30,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSORLLL3",31,0)
 D PRINT($G(COPAYVAR))
"RTN","PSORLLL3",32,0)
 ;S T=$P(PS,"^")_"-"_$P(PS,"^",6) D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSORLLL3",33,0)
 S T=$P($G(HINFO),"^")_"-"_$P($G(HINFO),"^",4) D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSORLLL3",34,0)
 S OPSOX=PSOX,PSOX=2340-(L($E(PSOFONT,2,99))*300),PSOY=PSOY-PSOYI
"RTN","PSORLLL3",35,0)
 D PRINT(T)
"RTN","PSORLLL3",36,0)
 S PSOX=OPSOX,PSOYI=PSOBYI
"RTN","PSORLLL3",37,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSORLLL3",38,0)
 S X2=$P($G(HINFO),"^",4)_"-"_RX
"RTN","PSORLLL3",39,0)
 W X2
"RTN","PSORLLL3",40,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSORLLL3",41,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL3",42,0)
 Q
"RTN","PSORLLL3",43,0)
PRINT(T,BOLD,HDR) ;
"RTN","PSORLLL3",44,0)
 S BOLD=+$G(BOLD),HDR=+$G(HDR)
"RTN","PSORLLL3",45,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL3",46,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLL3",47,0)
 I HDR D
"RTN","PSORLLL3",48,0)
 . S OPSOX=PSOX D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSORLLL3",49,0)
 . S PSOX=4.2-L($E(PSOFONT,2,99))*300/2+OPSOX
"RTN","PSORLLL3",50,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL3",51,0)
 W T,!
"RTN","PSORLLL3",52,0)
 I HDR S PSOX=OPSOX
"RTN","PSORLLL3",53,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL3",54,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSORLLL3",55,0)
 Q
"RTN","PSORLLL4")
0^19^B11420707^n/a
"RTN","PSORLLL4",1,0)
PSORLLL4 ;AITC/BWF - LASER LABELS PRINT PMI ;12/13/02
"RTN","PSORLLL4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLL4",3,0)
 ;
"RTN","PSORLLL4",4,0)
 ; BWF - modified copy of PSOLLL4 for OneVa Pharmacy
"RTN","PSORLLL4",5,0)
 ;Reference to PSNPPIO supported by DBIA 3794
"RTN","PSORLLL4",6,0)
 ;
"RTN","PSORLLL4",7,0)
 S FLAG=$$EN^PSNPPIO($G(LOCDRUG),.MSG)
"RTN","PSORLLL4",8,0)
EN I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSORLLL4",9,0)
 ;
"RTN","PSORLLL4",10,0)
 I '$G(PMIM) D MOREWARN
"RTN","PSORLLL4",11,0)
 S T=PNM_"  Rx#: "_RXN_"   "_DRUG D PRINT(T,0) S PSOY=PSOY+PSOYI-25
"RTN","PSORLLL4",12,0)
 S CONT=0 I PMIM S CONT=1 D PRINT(PMIF("T"),PMIF("H")) G CONT
"RTN","PSORLLL4",13,0)
 I 'FLAG D PRINT(MSG) Q
"RTN","PSORLLL4",14,0)
 S T=^TMP($J,"PSNPMI",0)_": "_$G(^TMP($J,"PSNPMI","F",1,0)) D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSORLLL4",15,0)
 S T=$G(^TMP($J,"PSNPMI","C",1,0)) I T]"" D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSORLLL4",16,0)
CONT S XFONT=$E(PSOFONT,2,99),(CNT,OUT,PMIM)=0
"RTN","PSORLLL4",17,0)
 K A F A="W","U","H","S","M","P","I","O","N","D","R" S CNT=CNT+1,A(CNT)=A
"RTN","PSORLLL4",18,0)
 F J=PMIF("A"):1 Q:$G(A(J))=""  S A=A(J) I $D(^TMP($J,"PSNPMI",A,1,0)) S HDR=$S(PMIF("A")=1:1,PMIF("B")=1:1,J=PMIF("A"):0,1:1),LENGTH=0,PTEXT="" D  Q:OUT  S PSOY=PSOY+PSOYI-25
"RTN","PSORLLL4",19,0)
 . F B=PMIF("B"):1 Q:'$D(^TMP($J,"PSNPMI",A,B,0))  S TEXT=^(0) D  Q:OUT
"RTN","PSORLLL4",20,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSORLLL4",21,0)
 .. F I=PMIF("I"):1:$L(TEXT," ") D STRT^PSOLLU1("FULL",$P(TEXT," ",I)_" ",.L) D  Q:OUT
"RTN","PSORLLL4",22,0)
 ... I LENGTH+L(XFONT)<8.1 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSORLLL4",23,0)
 ... S LENGTH=0,I=I-1
"RTN","PSORLLL4",24,0)
 ... I HDR D  Q
"RTN","PSORLLL4",25,0)
 .... I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1
"RTN","PSORLLL4",26,0)
 .... D PRINT(PTEXT,1) S PTEXT="",HDR=0
"RTN","PSORLLL4",27,0)
 ... I PSOY>(PSOYM+25) S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1 Q
"RTN","PSORLLL4",28,0)
 ... D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSORLLL4",29,0)
 .. I 'PMIM F I="I","B" S PMIF(I)=1
"RTN","PSORLLL4",30,0)
 . I 'PMIM S PMIF("B")=1
"RTN","PSORLLL4",31,0)
 . I OUT S PMIF("T")=PTEXT,PMIF("H")=HDR
"RTN","PSORLLL4",32,0)
 . Q:OUT  I HDR,PTEXT[":" D  Q
"RTN","PSORLLL4",33,0)
 .. I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSORLLL4",34,0)
 .. I PTEXT]"" D PRINT(PTEXT,1)
"RTN","PSORLLL4",35,0)
 . I PTEXT]"",PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSORLLL4",36,0)
 . I PTEXT]"" D PRINT(PTEXT,0)
"RTN","PSORLLL4",37,0)
 Q
"RTN","PSORLLL4",38,0)
PRINT(T,HDR) ;
"RTN","PSORLLL4",39,0)
 ; Input: T - text to be printed
"RTN","PSORLLL4",40,0)
 ;        HDR - 0-no / 1-yes
"RTN","PSORLLL4",41,0)
 ;
"RTN","PSORLLL4",42,0)
 S HDR=+$G(HDR)
"RTN","PSORLLL4",43,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL4",44,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL4",45,0)
 I HDR,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLL4",46,0)
 I HDR D  G PRINT2
"RTN","PSORLLL4",47,0)
 . W $P(T,":"),":"
"RTN","PSORLLL4",48,0)
 . I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL4",49,0)
 . W $P(T,":",2,99)
"RTN","PSORLLL4",50,0)
 W T
"RTN","PSORLLL4",51,0)
PRINT2 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL4",52,0)
 W ! Q
"RTN","PSORLLL4",53,0)
 ;
"RTN","PSORLLL4",54,0)
MOREWARN ; SEE ID MORE THAN 5 WARNINGS AND PRINT REMAINDER, IF SO
"RTN","PSORLLL4",55,0)
 N LEN,LEN2,I,J,PSOWARN,NEWWARN,PRE
"RTN","PSORLLL4",56,0)
 S LEN=$L($G(WARN),",") I LEN<6,'$G(PSOWLBL) Q
"RTN","PSORLLL4",57,0)
 S NEWWARN=$G(PSOWLBL)_$P(WARN,",",6,99)
"RTN","PSORLLL4",58,0)
 I $E(NEWWARN,$L(NEWWARN))="," S NEWWARN=$E(NEWWARN,1,$L(NEWWARN)-1) I NEWWARN="" Q
"RTN","PSORLLL4",59,0)
 S T="Additional Warnings:" D PRINT(T,1)
"RTN","PSORLLL4",60,0)
 F I=1:1:$L(NEWWARN,",") S PSOWARN=$P(NEWWARN,",",I) D
"RTN","PSORLLL4",61,0)
 .S PRE=PSOWARN_": ",LEN2=$L(PRE)
"RTN","PSORLLL4",62,0)
 .S TEXT=$$WTEXT^PSSWRNA(PSOWARN,PSOLAN) I TEXT'="" D
"RTN","PSORLLL4",63,0)
 ..I $L(TEXT)<100 S T=PRE_TEXT D PRINT(T) Q
"RTN","PSORLLL4",64,0)
 ..S PTEXT="" F J=1:1:$L(TEXT," ") S PTEXT=PTEXT_$P(TEXT," ",J)_" " D
"RTN","PSORLLL4",65,0)
 ...I $L(PTEXT)>90 D
"RTN","PSORLLL4",66,0)
 ....S T=PRE_PTEXT D PRINT(T) S PRE=$E("      ",1,LEN2),PTEXT=""
"RTN","PSORLLL4",67,0)
 ..I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSORLLL4",68,0)
 I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSORLLL4",69,0)
 S PSOY=PSOY+PSOYI
"RTN","PSORLLL4",70,0)
 K PSOWLBL
"RTN","PSORLLL4",71,0)
 Q
"RTN","PSORLLL5")
0^20^B32390251^n/a
"RTN","PSORLLL5",1,0)
PSORLLL5 ;AITC/BWF - LASER LABEL CONTINUED ;11/14/05 10:09am
"RTN","PSORLLL5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLL5",3,0)
 ; BWF - OneVa Pharmacy modified copy of PSOLLL5
"RTN","PSORLLL5",4,0)
 ;
"RTN","PSORLLL5",5,0)
START ;
"RTN","PSORLLL5",6,0)
 N TEXT,BLNKLIN
"RTN","PSORLLL5",7,0)
 S $P(BLNKLIN,"_",90)="_"
"RTN","PSORLLL5",8,0)
 D MAIL
"RTN","PSORLLL5",9,0)
 I $G(PSOIO("ACI"))]"" X PSOIO("ACI")
"RTN","PSORLLL5",10,0)
 S TEXT="HAS YOUR ADDRESS CHANGED?" D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSORLLL5",11,0)
 S OPSOX=PSOX,PSOX=4.2-L($E(PSOHFONT,2,99))*300/2+OPSOX
"RTN","PSORLLL5",12,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,OFONT) D PRINT(TEXT,1) S PSOX=OPSOX,PSOY=PSOY+10,PSOFONT=OFONT
"RTN","PSORLLL5",13,0)
 S TEXT="Write address changes in the blanks, sign the form, and return to" D PRINT(TEXT,0)
"RTN","PSORLLL5",14,0)
 S TEXT="your pharmacy." D PRINT(TEXT,0)
"RTN","PSORLLL5",15,0)
 S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),PNM=$P(X,"^")
"RTN","PSORLLL5",16,0)
 D PID^VADPT6,ADD^VADPT S SSNP=""
"RTN","PSORLLL5",17,0)
 S PSOY=PSOY+PSOYI,TEXT=PNM_"  "_SSNP D PRINT(TEXT,0)
"RTN","PSORLLL5",18,0)
 I $G(VAPA(1))="" G ALLERGY
"RTN","PSORLLL5",19,0)
 F I=1:1:3 I $G(VAPA(I))]"" S TEXT=$G(VAPA(I))_$E(BLNKLIN,1,80-$L(VAPA(I))) D PRINT(TEXT,0)
"RTN","PSORLLL5",20,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSORLLL5",21,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSORLLL5",22,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSORLLL5",23,0)
 S B=VAPA(8)
"RTN","PSORLLL5",24,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSORLLL5",25,0)
 S:$G(VAPA(3))="" PSOY=PSOY+PSOYI
"RTN","PSORLLL5",26,0)
 S TEXT="[   ] Permanent                     [   ] Temporary until ____/____/____" D PRINT(TEXT,0)
"RTN","PSORLLL5",27,0)
 S PSOY=$G(PSOFY),TEXT="Signature "_$E(BLNKLIN,1,45) D PRINT(TEXT,0)
"RTN","PSORLLL5",28,0)
 ;
"RTN","PSORLLL5",29,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSORLLL5",30,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSORLLL5",31,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSORLLL5",32,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSORLLL5",33,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSORLLL5",34,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSORLLL5",35,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSORLLL5",36,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSORLLL5",37,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSORLLL5",38,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSORLLL5",39,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSORLLL5",40,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSORLLL5",41,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSORLLL5",42,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSORLLL5",43,0)
 I $G(PSOIO("ALI"))]"" X PSOIO("ALI")
"RTN","PSORLLL5",44,0)
 S XFONT=$E($G(PSOFONT),2,99)
"RTN","PSORLLL5",45,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,PSOFONT) S TEXT=^TMP($J,"PSOAPT",1) D PRINT(TEXT,1) S PSOFONT=OFONT
"RTN","PSORLLL5",46,0)
 S TEXT="" D PRINT(TEXT,0)
"RTN","PSORLLL5",47,0)
 F CCC=3,4,5 I '$O(^TMP($J,"PSOAPT",CCC,0)) K ^TMP($J,"PSOAPT",CCC)
"RTN","PSORLLL5",48,0)
 D ASSESS
"RTN","PSORLLL5",49,0)
 I CCC="NKA" S ^TMP($J,"PSOAPT",2,1)="No Known Allergies" K ^TMP($J,"PSOAPT",3)
"RTN","PSORLLL5",50,0)
 S CCC=1,OUT=0
"RTN","PSORLLL5",51,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSORLLL5",52,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSORLLL5",53,0)
 .I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL5",54,0)
 .S PSOY=PSOY+PSOYI D PRINT(TEXT,0,1)
"RTN","PSORLLL5",55,0)
 .I TEXT="No Assessment Made" Q
"RTN","PSORLLL5",56,0)
 .I PSOY>PSOYM S OUT=1 Q
"RTN","PSORLLL5",57,0)
 .S (TEXT,PTEXT,CCC2)="",LENGTH=0
"RTN","PSORLLL5",58,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D  Q:OUT
"RTN","PSORLLL5",59,0)
 ..D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSORLLL5",60,0)
 ..I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_TEXT_",",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSORLLL5",61,0)
 ..I PTEXT="" D  Q
"RTN","PSORLLL5",62,0)
 ... F JJ=$L(TEXT):-1 S PTEXT=$E(TEXT,1,JJ) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT,0) S PTEXT=$E(TEXT,JJ+1,512)_"," Q
"RTN","PSORLLL5",63,0)
 ... D STRT^PSOLLU1("SEC2",PTEXT,.L) S LENGTH=L(XFONT)
"RTN","PSORLLL5",64,0)
 ..S LENGTH=0,CCC2=CCC2-1
"RTN","PSORLLL5",65,0)
 ..I PSOY>PSOYM S OUT=1 Q
"RTN","PSORLLL5",66,0)
 ..D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSORLLL5",67,0)
 .I 'OUT,PTEXT]"" D PRINT($P(PTEXT,",",1,$L(PTEXT,",")-1),0)
"RTN","PSORLLL5",68,0)
 I OUT S T="Additional Allergies or Adverse Reactions Exist." D PRINT(T,0) S T="Talk to your Physician or Pharmacist." D PRINT(T,0)
"RTN","PSORLLL5",69,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,CCC2,FNTFLG,TEXT,TEXT2
"RTN","PSORLLL5",70,0)
 Q
"RTN","PSORLLL5",71,0)
PRINT(T,B,UL) ;
"RTN","PSORLLL5",72,0)
 S BOLD=$G(B),UL=$G(UL)
"RTN","PSORLLL5",73,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLL5",74,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLL5",75,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLL5",76,0)
 I UL,$G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSORLLL5",77,0)
 W T,!
"RTN","PSORLLL5",78,0)
 I UL,$G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSORLLL5",79,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLL5",80,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSORLLL5",81,0)
 Q
"RTN","PSORLLL5",82,0)
ASSESS ;
"RTN","PSORLLL5",83,0)
 N FLG3,FLG4,FLG5
"RTN","PSORLLL5",84,0)
 S CCC=$G(^TMP($J,"PSOAPT",2,1))
"RTN","PSORLLL5",85,0)
 S FLG3=$G(^TMP($J,"PSOAPT",3,1))
"RTN","PSORLLL5",86,0)
 S FLG4=$G(^TMP($J,"PSOAPT",4,1))
"RTN","PSORLLL5",87,0)
 S FLG5=$G(^TMP($J,"PSOAPT",5,1))
"RTN","PSORLLL5",88,0)
 I CCC="",FLG3="",FLG4="",FLG5="" S ^TMP($J,"PSOAPT",2,1)="No Assessment Made" K ^TMP($J,"PSOAPT",3)
"RTN","PSORLLL5",89,0)
 Q
"RTN","PSORLLL5",90,0)
MAIL ;PRINT MAILING ADHESIVE LABEL
"RTN","PSORLLL5",91,0)
 ;S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSORLLL5",92,0)
 ;I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSORLLL5",93,0)
 S VAADDR1=$P(HINFO,"^"),VASTREET=$P($P(HINFO,"^",2),"~"),STATE=$S($P($P(HINFO,"^",2),"~",4)]"":$P($P(HINFO,"^",2),"~",4),1:"UNKNOWN")
"RTN","PSORLLL5",94,0)
 S PSZIP=$P($P($P(HINFO,"^",2),"~",5),"&"),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSORLLL5",95,0)
 I $G(PSOIO("MLI"))]"" X PSOIO("MLI")
"RTN","PSORLLL5",96,0)
 I $G(PSOIO("PSOFONT"))]"" X PSOIO("PSOFONT")
"RTN","PSORLLL5",97,0)
 S TEXT="Attn: (119)" D PRINT(TEXT)
"RTN","PSORLLL5",98,0)
 S TEXT=VAADDR1 D PRINT(TEXT)
"RTN","PSORLLL5",99,0)
 S TEXT=$G(VASTREET) D PRINT(TEXT)
"RTN","PSORLLL5",100,0)
 S TEXT=$P($P(HINFO,"^",2),"~",3)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(TEXT)
"RTN","PSORLLL5",101,0)
 Q
"RTN","PSORLLLH")
0^21^B10351529^n/a
"RTN","PSORLLLH",1,0)
PSORLLLH ;AITC/BWF - HIPAA/NCPDP LASER LABELS ;7/20/06 10:21am
"RTN","PSORLLLH",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLLH",3,0)
 ;
"RTN","PSORLLLH",4,0)
 ; BWF - OneVA Pharmacy: modified copy of PSOLLLH
"RTN","PSORLLLH",5,0)
 ;
"RTN","PSORLLLH",6,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSORLLLH",7,0)
 ;
"RTN","PSORLLLH",8,0)
 ;*244 ignore Rx status > 11
"RTN","PSORLLLH",9,0)
 ;
"RTN","PSORLLLH",10,0)
SIGLOG N PSOSEQ,J,RXF,RXY,RXN,RX,FIRST,DATE,BLNKLIN,RX2,FDT,BLNKLN2,LAST,CNT
"RTN","PSORLLLH",11,0)
 D DEM^VADPT
"RTN","PSORLLLH",12,0)
 S FIRST=1,LAST=0
"RTN","PSORLLLH",13,0)
 K NOWIN
"RTN","PSORLLLH",14,0)
 S $P(BLNKLN2," ",32)=" "
"RTN","PSORLLLH",15,0)
 S $P(BLNKLIN,"_",32)="_"
"RTN","PSORLLLH",16,0)
 F PSOSEQ=1:1:$L(RPPL,",") S RX=$P(RPPL,",",PSOSEQ) D
"RTN","PSORLLLH",17,0)
 .I RX="" Q                         ;*244
"RTN","PSORLLLH",18,0)
 .Q:$G(RXSTA)>11
"RTN","PSORLLLH",19,0)
 .S RXY=$G(RX0) I RXY="" Q
"RTN","PSORLLLH",20,0)
 .S CNT=$G(CNT)+1
"RTN","PSORLLLH",21,0)
 .S RX2=$G(RX2),FDT=$P(RX2,"^",2)
"RTN","PSORLLLH",22,0)
 .I FIRST!(CNT#4=1) D HDR,BARC S FIRST=0
"RTN","PSORLLLH",23,0)
 .S RXF=$G(RFIEN)
"RTN","PSORLLLH",24,0)
 .I +$G(RREF0)'<FDT S FDT=+$G(RREF0)
"RTN","PSORLLLH",25,0)
 .S DATE=$E(FDT,1,7),Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSORLLLH",26,0)
 .S RXN=$P(RXY,"^")
"RTN","PSORLLLH",27,0)
 .S T=RXN_" ("_(RXF)_") "
"RTN","PSORLLLH",28,0)
 .N PSODRNM
"RTN","PSORLLLH",29,0)
 .S PSODRNM=$$ZZ^PSORLLLI($G(LOCDRUG))
"RTN","PSORLLLH",30,0)
 .S T=T_$E(FDT,4,5)_"/"_$E(FDT,6,7)_"/"_$E(FDT,2,3)_" "_$E(PSODRNM,1,(27-$L(RXN))) D PRINT(T)
"RTN","PSORLLLH",31,0)
 S LAST=1 D SIGN
"RTN","PSORLLLH",32,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSORLLLH",33,0)
 Q
"RTN","PSORLLLH",34,0)
 ;
"RTN","PSORLLLH",35,0)
SIGN ;
"RTN","PSORLLLH",36,0)
 I '$G(CNT) Q
"RTN","PSORLLLH",37,0)
 N II
"RTN","PSORLLLH",38,0)
 S II=CNT#4
"RTN","PSORLLLH",39,0)
 I LAST,II>0 F J=1:1:(4-II) S T=" " D PRINT(T)
"RTN","PSORLLLH",40,0)
 S PSOY=PSOY+10
"RTN","PSORLLLH",41,0)
 S T="Pt. Sig."_BLNKLIN D PRINT(T)
"RTN","PSORLLLH",42,0)
 S PSOY=PSOY+5
"RTN","PSORLLLH",43,0)
 D PRINT("")
"RTN","PSORLLLH",44,0)
 S PSOY=PSOY+15
"RTN","PSORLLLH",45,0)
 S T="Relation_____ Counseling Refused__ Accepted__" D PRINT(T)
"RTN","PSORLLLH",46,0)
 S PSOY=PSOY+10
"RTN","PSORLLLH",47,0)
 S T=PNM_"  "_$G(SSNP) D PRINT(T,1)
"RTN","PSORLLLH",48,0)
 Q
"RTN","PSORLLLH",49,0)
 ;
"RTN","PSORLLLH",50,0)
HDR ;
"RTN","PSORLLLH",51,0)
 N HINFOZIP
"RTN","PSORLLLH",52,0)
 S HINFOZIP=$P($P($P(HINFO,"^",2),"~",5),"&")
"RTN","PSORLLLH",53,0)
 S PSOHZIP=$S(HINFOZIP["-":HINFOZIP,1:$E(HINFOZIP,1,5)_$S($E(HINFOZIP,6,9)]"":"-"_$E(HINFOZIP,6,9),1:""))
"RTN","PSORLLLH",54,0)
 I 'FIRST D SIGN W @IOF
"RTN","PSORLLLH",55,0)
 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSORLLLH",56,0)
 S T="VAMC "_$P(HINFO,"^")_", "_STATE_" "_$G(PSOHZIP) D PRINT(T)
"RTN","PSORLLLH",57,0)
 ; change based on incoming HL7 data
"RTN","PSORLLLH",58,0)
 ;S T=$P(PS2,"^",2)_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4)_"       "_$G(PSONOW) D PRINT(T)
"RTN","PSORLLLH",59,0)
 S T=$P(HINFO,"^",4)_"  Ph: "_$P(HINFO,"^",3)_"       "_$G(PSONOW) D PRINT(T)
"RTN","PSORLLLH",60,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSORLLLH",61,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSORLLLH",62,0)
 N REPMSG
"RTN","PSORLLLH",63,0)
 S REPMSG=BLNKLN2_"(REPRINT)"
"RTN","PSORLLLH",64,0)
 S T="By signing below"_$S($G(REPRINT):REPMSG,1:"") D PRINT(T,1)
"RTN","PSORLLLH",65,0)
 S T="you acknowledge receipt of the following Rx's" D PRINT(T,1)
"RTN","PSORLLLH",66,0)
 S T=" " D PRINT(T)
"RTN","PSORLLLH",67,0)
 S PSOY=PSOY-20
"RTN","PSORLLLH",68,0)
 Q
"RTN","PSORLLLH",69,0)
 ;
"RTN","PSORLLLH",70,0)
PRINT(T,B) ;
"RTN","PSORLLLH",71,0)
 S BOLD=$G(B)
"RTN","PSORLLLH",72,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSORLLLH",73,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSORLLLH",74,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSORLLLH",75,0)
 W T,!
"RTN","PSORLLLH",76,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSORLLLH",77,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSORLLLH",78,0)
 Q
"RTN","PSORLLLH",79,0)
BARC I '$G(FIRST) G BARCE ; PRINT BARCODE FOR 1 RX ON 1ST SIGLOG LABEL ONLY
"RTN","PSORLLLH",80,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSORLLLH",81,0)
 S X2=$P($G(HINFO),"^",4)_"-"_RX W X2
"RTN","PSORLLLH",82,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSORLLLH",83,0)
BARCE Q
"RTN","PSORLLLH",84,0)
 ;
"RTN","PSORLLLH",85,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSORLLLH",86,0)
 K DIC,DFN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSORLLLH",87,0)
 Q
"RTN","PSORLLLI")
0^16^B70303116^n/a
"RTN","PSORLLLI",1,0)
PSORLLLI ;AITC/BWF - ONEVA LASER LABELS INITIALIZATION ;10/06/16 9:28am
"RTN","PSORLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORLLLI",3,0)
 ;
"RTN","PSORLLLI",4,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSORLLLI",5,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSORLLLI",6,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSORLLLI",7,0)
 ;External reference to ^DIC(5 supported by DBIA 4293
"RTN","PSORLLLI",8,0)
 ;External reference to ^SC( supported by DBIA 2675
"RTN","PSORLLLI",9,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSORLLLI",10,0)
 ;
"RTN","PSORLLLI",11,0)
 ;*244 remove test for partial fill when testing status > 11
"RTN","PSORLLLI",12,0)
 ;
"RTN","PSORLLLI",13,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSORLLLI",14,0)
DQ1 I '$D(RPPL) G HLEX
"RTN","PSORLLLI",15,0)
 I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSORLLLI",16,0)
 K RRXFLX,RXFDAMG S PSOCKHN=","_$G(RPPL),PSRESOLV=+RPPL D CHECK
"RTN","PSORLLLI",17,0)
 S PSOINT=1 F PI=1:1 S RX=$P(RPPL,",",PI) Q:RX=""  D
"RTN","PSORLLLI",18,0)
 .S PSOPDFN=$G(PSODFN),RXY=$G(RX0)
"RTN","PSORLLLI",19,0)
 .K RXP,REPRINT D C
"RTN","PSORLLLI",20,0)
 I 'PSOINT D TRAIL^PSORLLL1
"RTN","PSORLLLI",21,0)
 ;
"RTN","PSORLLLI",22,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSORLLLI",23,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSORLLLI",24,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X,REF
"RTN","PSORLLLI",25,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RRXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSORLLLI",26,0)
 ; NEW kill lines for cleanup - OneVA Pharmacy
"RTN","PSORLLLI",27,0)
 K RX0,RX2,RX3,RXSTA,HINFO,RSIG,PSODFN,LOCDRUG,ROR1,RPAR0,RREF0,RFIEN,PARIEN,RIEN,PATST,RRFTYP,RRXFL,RRXPR,RSIG1,RPPL,HINFOST
"RTN","PSORLLLI",28,0)
 K BOTTLBL,CONT,DOB,F8,FILLCONT,FLAG,JJ,L2,L3,L4,L5,LENGTH,MAILCOM,NOBARC,NOR,OFONT,OPSOX,OPSOY,ORS,OUT,PATSTIEN
"RTN","PSORLLLI",29,0)
 K PFM,PI,PIMI,PLANNM,PMIM,PPHYS,PRCOPAY,PSCAP,PSCLN,PSDU,PSMP,PSOBY,PSOBYI,PSOCX,PSODFONT,PSODY,PSOFLAST,PSOFNOW
"RTN","PSORLLLI",30,0)
 K PSOFONT,PSOFY,PSOHFONT,PSOINT,PSOLAN,PSONOW,PSONOWT,PSOQFONT,PSOQY,PSORYI,PSOSITE7,PSOSUREP,PSOSUSPR,PSOTFONT,X0,ZDRUG
"RTN","PSORLLLI",31,0)
 K PSOTRAIL,PSOTY,PSOTYI,PSOYI,PSOYM,PTEXT,Q,EXP,PSLION,PSOBLRX,PSOHYI,PSOIO,SGC,SIG1,SIGDONE,SIGM,SS,ULN,VAADDR1,WARN5,ZY
"RTN","PSORLLLI",32,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSORLLLI",33,0)
 Q
"RTN","PSORLLLI",34,0)
 ;
"RTN","PSORLLLI",35,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSORLLLI",36,0)
 U IO Q:'$D(RX0)  S RXY=$G(RX0),RX2=$G(RX2),RXSTA=$G(RXSTA),RREF0=$G(RREF0),RPAR0=$G(RPAR0) K SGY,OSGY
"RTN","PSORLLLI",37,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSORLLLI",38,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSORLLLI",39,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSORLLLI",40,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSORLLLI",41,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RRXPR(RX)) RXP=RRXPR(RX)
"RTN","PSORLLLI",42,0)
 S RXY=$G(RX0),RX2=$G(RX2),RXSTA=$G(RXSTA),RREF0=$G(RREF0),RPAR0=$G(RPAR0),ROR1=$G(ROR1),RSIG=$G(RSIG),RSIG1=$G(RSIG1)
"RTN","PSORLLLI",43,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSORLLLI",44,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSORLLLI",45,0)
 S RXN=$P(RXY,"^"),DFN=$G(PSODFN),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$G(LOCDRUG)
"RTN","PSORLLLI",46,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(RSIG),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSORLLLI",47,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSORLLLI",48,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSORLLLI",49,0)
 S PS2=$P($G(HINFO),"^")_"^"_$P($G(HINFO),"^",4)
"RTN","PSORLLLI",50,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSORLLLI",51,0)
 S COPIES=$S($P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSORLLLI",52,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSORLLLI",53,0)
 .S PSOCKHA=","_RX_","
"RTN","PSORLLLI",54,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSORLLLI",55,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSORLLLI",56,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSORLLLI",57,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSORLLLI",58,0)
 I '$G(RXP) D OSET
"RTN","PSORLLLI",59,0)
 I '$G(RXP) D  G STA
"RTN","PSORLLLI",60,0)
 . I '$G(RRXFL(RX)) S XTYPE=1 D REF
"RTN","PSORLLLI",61,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSORLLLI",62,0)
ORIG S TECH=$P(RXY,"^",16),PHYS=$S($P(RXY,"^",4)'="":$P(RXY,"^",4),1:"UKN")
"RTN","PSORLLLI",63,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSORLLLI",64,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSORLLLI",65,0)
STA ;
"RTN","PSORLLLI",66,0)
 S HINFOST=$P($P(HINFO,U,2),"~",4)
"RTN","PSORLLLI",67,0)
 S STATE=$S($G(HINFOST)'="":HINFOST,1:"UKN")
"RTN","PSORLLLI",68,0)
 S DRUG=$$ZZ($G(LOCDRUG)),DEA=$P($G(^PSDRUG(+$G(LOCDRUG),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSORLLLI",69,0)
 S WARN=$$DRUG^PSSWRNA(+$G(LOCDRUG),+$G(DFN))
"RTN","PSORLLLI",70,0)
 I $G(PARIEN) S RXPI=$G(PARIEN) D
"RTN","PSORLLLI",71,0)
 .S RXP=$G(RPAR0)
"RTN","PSORLLLI",72,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(RSIG),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(RXSTA,"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSORLLLI",73,0)
 .S FDT=$P(RXP,"^")
"RTN","PSORLLLI",74,0)
 S MW=$P(RXY,"^",11) I $G(RRXFL(RX))'=0 D:$G(RRXFL(RX))  I '$G(RRXFL(RX)) S RXF=$P(RX0,"^",9) S:'$G(RXP) MW=$P(RREF0,"^",2) S FDT=+$G(RREF0)
"RTN","PSORLLLI",75,0)
 .I $G(RRXFL(RX)),'$L(RREF0) K RRXFL(RX) Q
"RTN","PSORLLLI",76,0)
 .;PSO*7*266
"RTN","PSORLLLI",77,0)
 .S RXF=RRXFL(RX) S:'$G(RXP) MW=$P($G(RREF0),"^",2) S FDT=+$G(RREF0)
"RTN","PSORLLLI",78,0)
 ; always 'W' for oneva pharmacy
"RTN","PSORLLLI",79,0)
 S MW="W"
"RTN","PSORLLLI",80,0)
 ;New mail codes for CMOP
"RTN","PSORLLLI",81,0)
 S MAILCOM=""
"RTN","PSORLLLI",82,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSORLLLI",83,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=0
"RTN","PSORLLLI",84,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSORLLLI",85,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSORLLLI",86,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9) S:REF<1 REF=0 D PSOLBL2
"RTN","PSORLLLI",87,0)
 S PSOLASTF=$P(RX3,"^")
"RTN","PSORLLLI",88,0)
 S:$L(PSOLASTF) PSOLASTF=$E(PSOLASTF,4,5)_"/"_$E(PSOLASTF,6,7)_"/"_$E(PSOLASTF,2,3)
"RTN","PSORLLLI",89,0)
 I '$L(PSOLASTF) S PSOLASTF="N/A"
"RTN","PSORLLLI",90,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSORLLLI",91,0)
 S PATST=$G(PATST)
"RTN","PSORLLLI",92,0)
 I PATST]"",$D(^PS(53,"C",PATST)) S PATSTIEN=$O(^PS(53,"C",PATST,0))
"RTN","PSORLLLI",93,0)
 I $G(PATSTIEN) S PATST=$G(^PS(53,PATSTIEN,0))
"RTN","PSORLLLI",94,0)
 S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSORLLLI",95,0)
 S VRPH=$P(RX2,"^",10),PSCLN=$S($P($G(HINFO),U,5)]"":$P(HINFO,U,5),1:"OneVA")
"RTN","PSORLLLI",96,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(RX2),$P(RX2,"^",6),REF,X'<$P(RX2,"^",6) S REF=0,VRPH=$P(RX2,"^",10)
"RTN","PSORLLLI",97,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSORLLLI",98,0)
 I $P(RXSTA,"^")>0,$P(RXSTA,"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSORLLLI",99,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSORLLLI",100,0)
LBL2 S PSOINT=0 G ^PSORLLL1
"RTN","PSORLLLI",101,0)
REF S TECH=$S(XTYPE=1:$P($G(RREF0),"^",7),XTYPE="P":$P($G(RPAR0),"^",7),1:"UNKNOWN")
"RTN","PSORLLLI",102,0)
 S QTY=$S(XTYPE=1:$P(RREF0,U,4),XTYPE="P":$P(RPAR0,U,4),1:"")
"RTN","PSORLLLI",103,0)
 I XTYPE=1 S PHYS=$S($P($G(RREF0),"^",17)]"":$P($G(RREF0),"^",17),1:"UNKNOWN")
"RTN","PSORLLLI",104,0)
 I XTYPE="P" S PHYS=$S($P($G(RPAR0),"^",17)]"":$P($G(RPAR0),"^",17),1:"UNKNOWN")
"RTN","PSORLLLI",105,0)
 S DAYS=$S(XTYPE=1:$P(RREF0,U,10),XTYPE="P":$P(RPAR0,U,10),1:"")
"RTN","PSORLLLI",106,0)
 Q
"RTN","PSORLLLI",107,0)
CHECK ; use DFN from ZTSAVE instead of from RX
"RTN","PSORLLLI",108,0)
 S PSDFNFLG=0,PSOZERO=$P(RPPL,","),PSOPDFN=$G(DFN)
"RTN","PSORLLLI",109,0)
 Q
"RTN","PSORLLLI",110,0)
OSET ;
"RTN","PSORLLLI",111,0)
 N A
"RTN","PSORLLLI",112,0)
 I $G(RRXFL(RX))']""!($G(RRXFL(RX))=0) D  Q
"RTN","PSORLLLI",113,0)
 .S A=$G(RX0)
"RTN","PSORLLLI",114,0)
 .S TECH=$P(A,"^",16),QTY=$P(A,"^",7),PHYS=$S($P(A,"^",4)]"":$P(A,"^",4),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSORLLLI",115,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSORLLLI",116,0)
 I $G(RREF0)']"" K RRXFL(RX) Q
"RTN","PSORLLLI",117,0)
 S A=$G(RREF0)
"RTN","PSORLLLI",118,0)
 S TECH=$S($P(A,"^",7)]"":$P(A,"^",7),1:"UNKNOWN")
"RTN","PSORLLLI",119,0)
 S QTY=$P(A,"^",4),PHYS=$S($P(A,"^",17)]"":$P(A,"^",17),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSORLLLI",120,0)
 S DAYS=$P(A,"^",10)
"RTN","PSORLLLI",121,0)
 Q
"RTN","PSORLLLI",122,0)
DOUB ;
"RTN","PSORLLLI",123,0)
 Q:'$D(RRXFL(RX))
"RTN","PSORLLLI",124,0)
 I +$G(RRXFL(RX))-PSOCKHNX<0 Q
"RTN","PSORLLLI",125,0)
 S RRXFLX(RX)=$G(RRXFL(RX))
"RTN","PSORLLLI",126,0)
 S RRXFL(RX)=$G(RRXFL(RX))-PSOCKHNX
"RTN","PSORLLLI",127,0)
 Q
"RTN","PSORLLLI",128,0)
SNO ;
"RTN","PSORLLLI",129,0)
 S COPAYVAR="NO COPAY"
"RTN","PSORLLLI",130,0)
 Q
"RTN","PSORLLLI",131,0)
ZZ(LDIEN) ; Returns VA print name, Trade Name, Generic Name
"RTN","PSORLLLI",132,0)
 S I50=LDIEN,ZDRUG=$P(^PSDRUG(I50,0),U)
"RTN","PSORLLLI",133,0)
 I $G(ZDRUG)']"" S ZDRUG="DRUG NOT ON FILE ("_I50_")" G END
"RTN","PSORLLLI",134,0)
 I $D(^PSDRUG("AQ",I50)),($D(^PSDRUG(I50,"ND"))) D
"RTN","PSORLLLI",135,0)
 .S Z1=$P($G(^PSDRUG(I50,"ND")),U),Z2=$P($G(^("ND")),U,3)
"RTN","PSORLLLI",136,0)
 .I $G(Z1),($G(Z2)) D
"RTN","PSORLLLI",137,0)
 ..I $T(^PSNAPIS)]"" S PSOXN=$$PROD2^PSNAPIS(Z1,Z2) S ZDRUG=$P($G(PSOXN),"^") K PSOXN Q
"RTN","PSORLLLI",138,0)
 ..S ZDRUG=$P($G(^PSNDF(Z1,5,Z2,2)),"^")
"RTN","PSORLLLI",139,0)
 .K Z1,Z2,I50
"RTN","PSORLLLI",140,0)
END K I50
"RTN","PSORLLLI",141,0)
 Q ZDRUG
"RTN","PSORLLLI",142,0)
 ; copy of PSOLBL2 logic
"RTN","PSORLLLI",143,0)
PSOLBL2 ;
"RTN","PSORLLLI",144,0)
 ;I $P($G(SIG),"^",2) K SGY D PSOLBL3 G SIGOLD
"RTN","PSORLLLI",145,0)
 I $P($G(RSIG),"^")]"" S SIG=$P($G(RSIG),"^") D SIG Q
"RTN","PSORLLLI",146,0)
 S SIGDONE=0
"RTN","PSORLLLI",147,0)
 F I=1:1 D  Q:SIGDONE
"RTN","PSORLLLI",148,0)
 .I '$D(RSIG1(I)) S SIGDONE=1 Q
"RTN","PSORLLLI",149,0)
 .I '$L(SIG) S SIG=$G(RSIG1(I)) Q
"RTN","PSORLLLI",150,0)
 .S SIG=$G(SIG)_" "_$G(RSIG1(I))
"RTN","PSORLLLI",151,0)
 D SIG
"RTN","PSORLLLI",152,0)
QUIT K SIG,E,F,S Q
"RTN","PSORLLLI",153,0)
SIG K OT S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""
"RTN","PSORLLLI",154,0)
 .I $D(^PS(51,"A",X)) D
"RTN","PSORLLLI",155,0)
 ..;PSO*7*282 Intended use
"RTN","PSORLLLI",156,0)
 ..I $P($G(^PS(55,DFN,"LAN")),"^") S OT=$O(^PS(51,"B",X,0)) I OT,$P($G(^PS(51,OT,0)),"^",4)<2,$P($G(^PS(51,OT,4)),"^")]"" S X=$P(^PS(51,OT,4),"^") K OT Q
"RTN","PSORLLLI",157,0)
 ..S %=^PS(51,"A",X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSORLLLI",158,0)
 .S SGY=SGY_X_" "
"RTN","PSORLLLI",159,0)
 S X="",SGC=1 F J=1:1 S Z=$P(SGY," ",J) S:Z="" SGY(SGC)=X Q:Z=""  S:$L(X)+$L(Z)'<$S($P(PSOPAR,"^",28):46,1:34) SGY(SGC)=X,SGC=SGC+1,X="" S X=X_Z_" "
"RTN","PSORLLLI",160,0)
SIGOLD I '$P(PSOPAR,"^",28) D  K NHC
"RTN","PSORLLLI",161,0)
 .K DIC,DR,DIQ,NHC S DIC=2,DA=DFN,DR=148,DIQ="NHC",DIQ(0)="I"
"RTN","PSORLLLI",162,0)
 .D EN^DIQ1 K DIC,DR,DIQ
"RTN","PSORLLLI",163,0)
 .I NHC(2,DFN,148,"I")="Y"!($P($G(^PS(55,DFN,40)),"^")) S SGC=SGC+1,SGY(SGC)="Expiration:________ Mfg:_________"
"RTN","PSORLLLI",164,0)
 ;
"RTN","PSORLLLI",165,0)
DPT S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),DOB=$P(X,"^",3),L=$E(X,1)
"RTN","PSORLLLI",166,0)
 S Y=$P(X,"^",9),PNM=$P(X,"^") D PID^VADPT S SS="",SSNP=""
"RTN","PSORLLLI",167,0)
 I $P(PSOPAR,"^",28) K SIG,E,F,S Q
"RTN","PSORLLLI",168,0)
 Q
"RTN","PSORLLLI",169,0)
 ;--- end PSOLBL2 LOGIC
"RTN","PSORLLLI",170,0)
PSOLBL3 ;
"RTN","PSORLLLI",171,0)
 N CTCT,FFFF,LLIM,LLLL,LVAR,LVAR1,PPP,PPPP,SGCT,SIG9,OSIG,ZZZZ,PSLONG,PPPP
"RTN","PSORLLLI",172,0)
 S PSLONG=$S($P(PSOPAR,"^",28):46,1:34)
"RTN","PSORLLLI",173,0)
 ; NEXT LINE IF SIG IS MOVED BACK TO MULTIPLE
"RTN","PSORLLLI",174,0)
 S PPPP=1 F PPP=0:0 S PPP=$O(RSIG1(PPP)) Q:'PPP  I $G(RSIG1(PPP))'="" S SIG9(PPPP)=$G(SIG1("SIG1",PPP)) S PPPP=PPPP+1
"RTN","PSORLLLI",175,0)
 ;NEXT LINE IF 1ST FRONT DOOR SIG LINE LIVES IN BACK DOOR SPOT
"RTN","PSORLLLI",176,0)
 ;S SIG9(1)=$P($G(^PSRX(RX,"SIG")),"^") S PPP=2 F PPPP=0:0 S PPPP=$O(^PSRX(RX,"SIG1",PPPP)) Q:'PPPP  I $G(^(PPPP,0))'="" S SIG9(PPP)=$G(^(0)),PPP=PPP+1
"RTN","PSORLLLI",177,0)
FMSIG S (LVAR,LVAR1)="",LLLL=1
"RTN","PSORLLLI",178,0)
 F FFFF=0:0 S FFFF=$O(SIG9(FFFF)) Q:'FFFF  S SGCT=0 F ZZZZ=1:1:$L(SIG9(FFFF)) I $E(SIG9(FFFF),ZZZZ)=" "!($L(SIG9(FFFF))=ZZZZ) S SGCT=SGCT+1 D  I $L(LVAR)>PSLONG S SGY(LLLL)=LLIM_" ",LLLL=LLLL+1,LVAR=LVAR1
"RTN","PSORLLLI",179,0)
 .S LVAR1=$P(SIG9(FFFF)," ",(SGCT))
"RTN","PSORLLLI",180,0)
 .S LLIM=LVAR
"RTN","PSORLLLI",181,0)
 .S LVAR=$S(LVAR="":LVAR1,1:LVAR_" "_LVAR1)
"RTN","PSORLLLI",182,0)
 I $G(LVAR)'="" S SGY(LLLL)=LVAR
"RTN","PSORLLLI",183,0)
 I '$P(PSOPAR,"^",28) S SGC=0 F CTCT=0:0 S CTCT=$O(SGY(CTCT)) Q:'CTCT  S SGC=SGC+1
"RTN","PSORLLLI",184,0)
 I $O(OSGY(0)) D
"RTN","PSORLLLI",185,0)
 .F I=0:0 S I=$O(SGY(I)) Q:'I  I $G(OSGY(I))']"" S OSGY(I)=" "
"RTN","PSORLLLI",186,0)
 .F I=0:0 S I=$O(OSGY(I)) Q:'I  I $G(SGY(I))']"" S SGY(I)=" "
"RTN","PSORLLLI",187,0)
 Q
"RTN","PSOROS")
0^6^B917829^n/a
"RTN","PSOROS",1,0)
PSOROS ;AITC/BWF - REMOTE RX UTILITY ;7/15/16 2:35am
"RTN","PSOROS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSOROS",3,0)
 ;
"RTN","PSOROS",4,0)
 Q
"RTN","PSOROS",5,0)
 ;
"RTN","PSOROS",6,0)
EN ; -- main entry point for PSO LM REMOTE ORDER SELECTION
"RTN","PSOROS",7,0)
 D EN^VALM("PSO LM REMOTE ORDER SELECTION")
"RTN","PSOROS",8,0)
 Q
"RTN","PSOROS",9,0)
 ;
"RTN","PSOROS",10,0)
HDR ; -- header code
"RTN","PSOROS",11,0)
 S VALMHDR(1)="This is a test header for PSO LM REMOTE ORDER SELECTION."
"RTN","PSOROS",12,0)
 S VALMHDR(2)="This is the second line"
"RTN","PSOROS",13,0)
 Q
"RTN","PSOROS",14,0)
 ;
"RTN","PSOROS",15,0)
INIT ; -- init variables and list array
"RTN","PSOROS",16,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSOROS",17,0)
 ;S VALMCNT=30
"RTN","PSOROS",18,0)
 ;S $P(RN," ",12)=" ",VALMCNT=PSOPF
"RTN","PSOROS",19,0)
 S $P(RN," ",12)=" ",VALMCNT=$G(CNT)
"RTN","PSOROS",20,0)
 S VALM("TITLE")="REMOTE OP Medications ("_$G(SRXSTAT)_")"
"RTN","PSOROS",21,0)
 D RV^PSONFI Q
"RTN","PSOROS",22,0)
 Q
"RTN","PSOROS",23,0)
 ;
"RTN","PSOROS",24,0)
HELP ; -- help code
"RTN","PSOROS",25,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOROS",26,0)
 Q
"RTN","PSOROS",27,0)
 ;
"RTN","PSOROS",28,0)
EXIT ; -- exit code
"RTN","PSOROS",29,0)
 K VALMCNT,VALMHDR
"RTN","PSOROS",30,0)
 Q
"RTN","PSOROS",31,0)
 ;
"RTN","PSOROS",32,0)
EXPND ; -- expand code
"RTN","PSOROS",33,0)
 Q
"RTN","PSOROS",34,0)
 ;
"RTN","PSORRD")
0^13^B2373596^n/a
"RTN","PSORRD",1,0)
PSORRD ;AITC/BWF - Remote RX report details ;8/15/16 5:43pm
"RTN","PSORRD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORRD",3,0)
 ;
"RTN","PSORRD",4,0)
EN ; -- main entry point for PSO LM REMOTE REPORT DETAILS
"RTN","PSORRD",5,0)
 D EN^VALM("PSO LM REMOTE REPORT DETAILS")
"RTN","PSORRD",6,0)
 Q
"RTN","PSORRD",7,0)
 ;
"RTN","PSORRD",8,0)
HDR ; -- header code
"RTN","PSORRD",9,0)
 S VALMHDR(1)="Detailed report of "_$P("Prescriptions dispensed for other Host Pharmacies^Our RXs filled by other facilities as the Dispensing Pharmacy^All OneVA Pharmacy Prescription Activity","^",PSOREPORT)
"RTN","PSORRD",10,0)
 Q
"RTN","PSORRD",11,0)
 ;
"RTN","PSORRD",12,0)
INIT ; -- init variables and list array
"RTN","PSORRD",13,0)
 S VALMCNT=PSORCNT
"RTN","PSORRD",14,0)
 Q
"RTN","PSORRD",15,0)
 ;
"RTN","PSORRD",16,0)
HELP ; -- help code
"RTN","PSORRD",17,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSORRD",18,0)
 Q
"RTN","PSORRD",19,0)
 ;
"RTN","PSORRD",20,0)
EXIT ; -- exit code
"RTN","PSORRD",21,0)
 S VALMBCK="R"
"RTN","PSORRD",22,0)
 K PSORCNT
"RTN","PSORRD",23,0)
 Q
"RTN","PSORRD",24,0)
 ;
"RTN","PSORRD",25,0)
EXPND ; -- expand code
"RTN","PSORRD",26,0)
 Q
"RTN","PSORRD",27,0)
 ;
"RTN","PSORREF")
0^2^B44063843^n/a
"RTN","PSORREF",1,0)
PSORREF ;AITC/BWF - Remote RX retrieval API ;7/15/16 1:47am
"RTN","PSORREF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORREF",3,0)
 ;
"RTN","PSORREF",4,0)
 Q
"RTN","PSORREF",5,0)
 ; RET    - return data
"RTN","PSORREF",6,0)
 ; RXNUM  - RX Number from remote system
"RTN","PSORREF",7,0)
 ; FDATE  - Fill Date
"RTN","PSORREF",8,0)
 ; MW     - Mail/Window - Default of 'W' for now.
"RTN","PSORREF",9,0)
 ; RPHARM - Pharmacist from remote site
"RTN","PSORREF",10,0)
 ; RPHONE - Contact number
"RTN","PSORREF",11,0)
 ; RSITE  - Filling site number
"RTN","PSORREF",12,0)
 ;
"RTN","PSORREF",13,0)
REMREF(RET,RXNUM,FDATE,MW,RPHARM,RPHONE,RSITE,RX0,RX2,RXSTA,RPROV,RSIG,RREF0,ROR1,RX3) ;
"RTN","PSORREF",14,0)
 ;
"RTN","PSORREF",15,0)
 N MSG,BACK,PSOPAR,RRXIEN,PSOSIEN,DSUPP,LASTREF,XTMPLOC,PASSLOC,HFSIEN,FULLPTH,HFSDONE,PTHDAT,PTHPIECE,FOUND,STRT,STATION,FTGOPEN,PPL1,PSOSITE
"RTN","PSORREF",16,0)
 N PSOX,PTHFILE,SITENUM,X,X1,X2,HDRUG,CSVAL,PSISSDT,TFILLS,OFFSET,CHKDT,DINACT,DEL,FTGSTRT,PDIR,PFIL,PSODTCUT,PSOEXREP,PSOPHDUZ
"RTN","PSORREF",17,0)
 N PSODFDIR,PSOFNAME,PAR,DELARR,RREFIEN
"RTN","PSORREF",18,0)
 N PSOBBC,PSOBBC1,PSODIR,PSOMVH
"RTN","PSORREF",19,0)
 ; check 3rd party payer rejects. Send message to initiating site if applicable.
"RTN","PSORREF",20,0)
 S $ETRAP="D ^%ZTER Q"
"RTN","PSORREF",21,0)
 S RET(0)=""
"RTN","PSORREF",22,0)
 S RRXIEN=$O(^PSRX("B",RXNUM,0)),PSOSIEN=$$GET1^DIQ(52,RRXIEN,20,"I")
"RTN","PSORREF",23,0)
 I '$$GET1^DIQ(59,PSOSIEN,3001,"I") D  Q
"RTN","PSORREF",24,0)
 .S RET(1)="The OneVA pharmacy flag is turned 'OFF' at this facility."
"RTN","PSORREF",25,0)
 .S RET(2)="Unable to process refill/partial fill requests."
"RTN","PSORREF",26,0)
 .D RET0
"RTN","PSORREF",27,0)
 S PSOPHDUZ=$$GET1^DIQ(52,RRXIEN,23,"I") I 'PSOPHDUZ S PSOPHDUZ=.5
"RTN","PSORREF",28,0)
 S HDRUG=$$GET1^DIQ(52,RRXIEN,6,"I")
"RTN","PSORREF",29,0)
 ; quit if drug is inactive
"RTN","PSORREF",30,0)
 S DINACT=$$GET1^DIQ(50,HDRUG,100,"I")
"RTN","PSORREF",31,0)
 I DINACT>0,DINACT<$$NOW^XLFDT S RET(1)="Drug is inactive for Rx# "_RXNUM_". Cannot refill." D RET0 Q
"RTN","PSORREF",32,0)
 S CSVAL=$$GET1^DIQ(50,HDRUG,3,"E"),CSVAL=$E(CSVAL,1)
"RTN","PSORREF",33,0)
 I CSVAL,CSVAL>0,CSVAL<6 D RET0 S RET(1)="Rx #"_RXNUM_" cannot be refilled.",RET(2)="The associated drug is considered a controlled substance",RET(3)="at the host facility." Q
"RTN","PSORREF",34,0)
 S PSOPAR=$G(^PS(59,PSOSIEN,1)),PSOSITE=PSOSIEN
"RTN","PSORREF",35,0)
 S RPHONE=$G(RPHONE,"")
"RTN","PSORREF",36,0)
 ; check to see if this action will throw the prescription into suspense. If so, quit and return a message
"RTN","PSORREF",37,0)
 S DSUPP=$$GET1^DIQ(52,RRXIEN,8,"I")
"RTN","PSORREF",38,0)
 S X2=-120,X1=DT D C^%DTC S PSODTCUT=X
"RTN","PSORREF",39,0)
 S (PSODFN,PSOREF("PSODFN"))=$$GET1^DIQ(52,RRXIEN,2,"I") K PSOSD D ^PSOBUILD
"RTN","PSORREF",40,0)
 N RXN K PSORX("FILL DATE") S PSOFROM="REFILL" S PSOREF("DFLG")=0,PSOREF("IRXN")=$O(^PSRX("B",RXNUM,0)),PSOREF("QFLG")=0
"RTN","PSORREF",41,0)
 I $$LMREJ^PSOREJU1(RXNUM,,.MSG,.BACK) S RET(1)=MSG D RET0 Q
"RTN","PSORREF",42,0)
 S PSORX("FILL DATE")=FDATE
"RTN","PSORREF",43,0)
 K PSOID D START^PSORREF1(FDATE) I PSOREF("DFLG") D EOJ Q
"RTN","PSORREF",44,0)
 ; check ability to refill given issue date/days supply
"RTN","PSORREF",45,0)
 S PSISSDT=$$GET1^DIQ(52,RRXIEN,1,"I")
"RTN","PSORREF",46,0)
 S TFILLS=$O(^PSRX(RRXIEN,1,"A"),-1)+1
"RTN","PSORREF",47,0)
 S OFFSET=DSUPP*TFILLS,OFFSET=OFFSET-10
"RTN","PSORREF",48,0)
 S CHKDT=$$FMADD^XLFDT(PSISSDT,OFFSET)
"RTN","PSORREF",49,0)
 I PSORX("FILL DATE")<CHKDT D RET0 S RET(1)="Cannot refill Rx# "_RXNUM_". Next possible fill date is "_$$FMTE^XLFDT(CHKDT,"5D") Q
"RTN","PSORREF",50,0)
 I PSORX("FILL DATE")>$$GET1^DIQ(52,RRXIEN,26,"I") D RET0 S RET(1)="Cannot refill Rx# "_RXNUM_".",RET(2)="Cannot refill after expiration date "_$$GET1^DIQ(52,RRXIEN,11,"E") Q
"RTN","PSORREF",51,0)
 D PROCESS^PSORREF0(.RET)
"RTN","PSORREF",52,0)
 ; make sure not errors are returned
"RTN","PSORREF",53,0)
 I $D(RET(1)) D EOJ Q
"RTN","PSORREF",54,0)
 I '$D(RET(1)) D
"RTN","PSORREF",55,0)
 .; bwf 8/14/14 - set up needed variables for label printing
"RTN","PSORREF",56,0)
 .S PSODFN=$P(^PSRX(RRXIEN,0),U,2)
"RTN","PSORREF",57,0)
 .S PSORX("IRXN")=RXNUM
"RTN","PSORREF",58,0)
 .S PSORX("PSOL",1)=RRXIEN_","
"RTN","PSORREF",59,0)
 .S PSORX("MAIL/WINDOW")="WINDOW"
"RTN","PSORREF",60,0)
 .S PSORX("NAME")=$$GET1^DIQ(2,PSODFN,.01)
"RTN","PSORREF",61,0)
 .S PSORX("QFLG")=0
"RTN","PSORREF",62,0)
 .S PSORX("METHOD OF PICKUP")=""
"RTN","PSORREF",63,0)
 .S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORREF",64,0)
 .S PPL1=RRXIEN
"RTN","PSORREF",65,0)
 .; bwf 8/14/14 - end setup for label printing.
"RTN","PSORREF",66,0)
 .S PSODFDIR=$$DEFDIR^%ZISH()
"RTN","PSORREF",67,0)
 .S PSOFNAME="PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT"
"RTN","PSORREF",68,0)
 .S FULLPTH=PSODFDIR_PSOFNAME
"RTN","PSORREF",69,0)
 .S HFSDONE=0,PTHDAT=""
"RTN","PSORREF",70,0)
 .; preserve IO
"RTN","PSORREF",71,0)
 .D SAVDEV^%ZISUTL("ONEVAHLIO")
"RTN","PSORREF",72,0)
 .S DELARR("PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT")="" S DEL=$$DEL^%ZISH(PSODFDIR,$NA(DELARR))
"RTN","PSORREF",73,0)
 .S PSOEXREP=1
"RTN","PSORREF",74,0)
 .; call out to generate label
"RTN","PSORREF",75,0)
 .D LABEL^PSORWRAP(RRXIEN,"HFS",PSOSITE,PSOPHDUZ,"",PSOFNAME)
"RTN","PSORREF",76,0)
 .S XTMPLOC="^XTMP(""PSORLBL"","_HLINSTN_","_RXNUM_",1,0)"
"RTN","PSORREF",77,0)
 .S PASSLOC="XTMP(""PSORLBL"","_HLINSTN_","_RXNUM_")"
"RTN","PSORREF",78,0)
 .K ^XTMP("PSORLBL",HLINSTN,RXNUM,0)
"RTN","PSORREF",79,0)
 .S ^XTMP("PSORLBL",HLINSTN,RXNUM,0)=DT_U_$$FMADD^XLFDT(DT,30)
"RTN","PSORREF",80,0)
 .; looks like we have to wait a moment before the file shows up.
"RTN","PSORREF",81,0)
 .S FTGSTRT=$$NOW^XLFDT,(FOUND,FTGOPEN)=0
"RTN","PSORREF",82,0)
 .N PAR S PAR=0
"RTN","PSORREF",83,0)
 .F  D  Q:$$NOW^XLFDT>$$FMADD^XLFDT(FTGSTRT,,,,15)!(FOUND)!(FTGOPEN)
"RTN","PSORREF",84,0)
 ..S FTGOPEN=$$FTG^%ZISH(PSODFDIR,PSOFNAME,XTMPLOC,4)
"RTN","PSORREF",85,0)
 ..I $O(^XTMP("PSORLBL",HLINSTN,RXNUM,0)) S FOUND=1
"RTN","PSORREF",86,0)
 .S DELARR("PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT")="" S DEL=$$DEL^%ZISH(PSODFDIR,$NA(DELARR))
"RTN","PSORREF",87,0)
 .; restore IO
"RTN","PSORREF",88,0)
 .D USE^%ZISUTL("ONEVAHLIO"),RMDEV^%ZISUTL("ONEVAHLIO")
"RTN","PSORREF",89,0)
 .D UPDREF(.RET,RRXIEN,RPHARM,RPHONE,RSITE,PASSLOC)
"RTN","PSORREF",90,0)
 .S RET(1)="Rx # "_RXNUM_" refilled."
"RTN","PSORREF",91,0)
 .S RX0=$G(^PSRX(RRXIEN,0)),RX2=$G(^PSRX(RRXIEN,2)),RX3=$G(^PSRX(RRXIEN,3))
"RTN","PSORREF",92,0)
 .S RXSTA=$G(^PSRX(RRXIEN,"STA")),RPROV=$$GET1^DIQ(200,$P(RX0,U,4),.01,"E")_U_$$GET1^DIQ(200,$P(RX0,U,16),.01,"E")
"RTN","PSORREF",93,0)
 .S RSIG=$G(^PSRX(RRXIEN,"SIG"))
"RTN","PSORREF",94,0)
 .S RREFIEN=$O(^PSRX(RRXIEN,1,"A"),-1)
"RTN","PSORREF",95,0)
 .I RREFIEN S RREF0=$G(^PSRX(RRXIEN,1,RREFIEN,0))
"RTN","PSORREF",96,0)
 .S ROR1=$G(^PSRX(RRXIEN,"OR1"))
"RTN","PSORREF",97,0)
 D EOJ
"RTN","PSORREF",98,0)
 Q
"RTN","PSORREF",99,0)
EOJ ;
"RTN","PSORREF",100,0)
 D RET0
"RTN","PSORREF",101,0)
 K PSOMSG,PSOREF,PSORX("BAR CODE"),PSOLIST,LFD,MAX,MIN,NODE,PS,PSOERR,REF,RF,RXO,RXN,RXP,RXS,SD,VAERR,PSORX("FILL DATE")
"RTN","PSORREF",102,0)
 K PSOFROM,PSODFN,PSORX
"RTN","PSORREF",103,0)
 Q
"RTN","PSORREF",104,0)
 ; build ret(0) if needed
"RTN","PSORREF",105,0)
RET0 ;
"RTN","PSORREF",106,0)
 I '$L(RET(0)) S RET(0)=0_U_RXNUM_U_RRXIEN_U_U_FDATE,$P(RET(0),U,15)=$G(RPHARM),$P(RET(0),U,16)=$G(RPHONE),$P(RET(0),U,17)=$G(RSITE)
"RTN","PSORREF",107,0)
 Q
"RTN","PSORREF",108,0)
 ;
"RTN","PSORREF",109,0)
ULK ;
"RTN","PSORREF",110,0)
 Q
"RTN","PSORREF",111,0)
 ; successful refill. Update data, and build response
"RTN","PSORREF",112,0)
UPDREF(PSOMSG,PSOIEN,RPHARM,RPHONE,RSITE,PASSLOC) ;
"RTN","PSORREF",113,0)
 N REFIEN,REFIENS,REFDATA,FIL,RXNUM,RFILLDT,QTY,DSUPP,CLERK,LOGDATE,IDIV,EDIV,DISPDT,NDC,FDA,DNAME,DIEN,DAT
"RTN","PSORREF",114,0)
 S FIL=52.1
"RTN","PSORREF",115,0)
 ; get last refill data node
"RTN","PSORREF",116,0)
 S REFIEN=$O(^PSRX(PSOIEN,1,"B",DT,""),-1)
"RTN","PSORREF",117,0)
 S RXNUM=$$GET1^DIQ(52,PSOIEN,.01,"E")
"RTN","PSORREF",118,0)
 S DNAME=$$GET1^DIQ(52,PSOIEN,6,"E")
"RTN","PSORREF",119,0)
 S DIEN=$$GET1^DIQ(52,PSOIEN,6,"I")
"RTN","PSORREF",120,0)
 S REFIENS=REFIEN_","_PSOIEN_","
"RTN","PSORREF",121,0)
 ; first, set in the remote pharmacist data
"RTN","PSORREF",122,0)
 S FDA(FIL,REFIENS,91)=RSITE
"RTN","PSORREF",123,0)
 S FDA(FIL,REFIENS,92)=RPHARM
"RTN","PSORREF",124,0)
 S FDA(FIL,REFIENS,93)=RPHONE
"RTN","PSORREF",125,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSORREF",126,0)
 ; now query data and build RET(0) holding accurate information from the refill multiple
"RTN","PSORREF",127,0)
 D GETS^DIQ(FIL,REFIENS,"**","IE","REFDATA")
"RTN","PSORREF",128,0)
 S RFILLDT=$G(REFDATA(FIL,REFIENS,.01,"I"))
"RTN","PSORREF",129,0)
 S QTY=$G(REFDATA(FIL,REFIENS,1,"I"))
"RTN","PSORREF",130,0)
 S DSUPP=$G(REFDATA(FIL,REFIENS,1.1,"I"))
"RTN","PSORREF",131,0)
 S CLERK=$G(REFDATA(FIL,REFIENS,6,"E"))
"RTN","PSORREF",132,0)
 S LOGDATE=$G(REFDATA(FIL,REFIENS,7,"I"))
"RTN","PSORREF",133,0)
 ; internal division number (IEN to PSO SITE file)
"RTN","PSORREF",134,0)
 S IDIV=$G(REFDATA(FIL,REFIENS,8,"I"))
"RTN","PSORREF",135,0)
 S EDIV=$G(REFDATA(FIL,REFIENS,8,"E"))
"RTN","PSORREF",136,0)
 S DISPDT=$G(REFDATA(FIL,REFIENS,10.1,"I"))
"RTN","PSORREF",137,0)
 S NDC=$G(REFDATA(FIL,REFIENS,11,"E"))
"RTN","PSORREF",138,0)
 S RSITE=$G(REFDATA(FIL,REFIENS,91,"I"))
"RTN","PSORREF",139,0)
 S RPHARM=$G(REFDATA(FIL,REFIENS,92,"E"))
"RTN","PSORREF",140,0)
 S RPHONE=$G(REFDATA(FIL,REFIENS,93,"E"))
"RTN","PSORREF",141,0)
 S $P(DAT(1),U,3)=RXNUM,$P(DAT(1),U,4)=RSITE,$P(DAT(1),U,7)=QTY,$P(DAT(1),U,8)=DISPDT,$P(DAT(1),U,9)=DNAME,$P(DAT(1),U,10)=DSUPP,$P(DAT(1),U,11)=RPHARM,$P(DAT(1),U,12)=RFILLDT
"RTN","PSORREF",142,0)
 D LOGDATA^PSORWRAP($NA(DAT),"OR",,,PSOIEN)
"RTN","PSORREF",143,0)
 S PSOMSG(0)=1_U_RXNUM_U_PSOIEN_U_REFIEN_U_RFILLDT_U_DNAME_U_QTY_U_DSUPP_U_CLERK_U_LOGDATE_U_IDIV_U_EDIV_U_DISPDT_U_NDC_U_RPHARM_U_RPHONE_U_RSITE_U_PASSLOC
"RTN","PSORREF",144,0)
 Q
"RTN","PSORREF0")
0^3^B46515290^n/a
"RTN","PSORREF0",1,0)
PSORREF0 ;AITC/BWF  Remote RX refill API ;7/15/16 1:57am
"RTN","PSORREF0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORREF0",3,0)
 ;
"RTN","PSORREF0",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORREF0",5,0)
 ;
"RTN","PSORREF0",6,0)
 ; Modified copy of ^PSOREF0 for the OneVA Pharmacy Project - remote prescriptions
"RTN","PSORREF0",7,0)
 ;
"RTN","PSORREF0",8,0)
 ;PSO*186 add check for DEA Special handling field refill restrictions
"RTN","PSORREF0",9,0)
 Q
"RTN","PSORREF0",10,0)
PROCESS(PSORMSG) ;
"RTN","PSORREF0",11,0)
 K PSODF S PSOREF("RX0")=^PSRX(PSOREF("IRXN"),0),PSOREF("RX2")=^(2),PSOREF("RX3")=^(3),PSOREF("STA")=+$G(^("STA")),PSOREF("SIG")=$P($G(^("SIG")),"^"),PSOREF("PSODFN")=$P(PSOREF("RX0"),"^",2)
"RTN","PSORREF0",12,0)
 S PSOREF("DAYS SUPPLY")=$P(PSOREF("RX0"),"^",8)
"RTN","PSORREF0",13,0)
 K ZD(PSOREF("IRXN"))   ;*306
"RTN","PSORREF0",14,0)
 S PSOREF("DFLG")=0 D DSPLY G:PSOREF("DFLG") PROCESSX
"RTN","PSORREF0",15,0)
 D CHECK G:$G(PSODF) PROCESS G:PSOREF("DFLG") PROCESSX D EN^PSOR52(.PSOREF)
"RTN","PSORREF0",16,0)
PROCESSX D:$G(PSOREF("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSOREF)
"RTN","PSORREF0",17,0)
 Q
"RTN","PSORREF0",18,0)
DSPLY ;
"RTN","PSORREF0",19,0)
 K FSIG,BSIG I $P($G(^PSRX(PSOREF("IRXN"),"SIG")),"^",2) D FSIG^PSOUTLA("R",PSOREF("IRXN"),54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSORREF0",20,0)
 K FSIG,PSREV I '$P($G(^PSRX(PSOREF("IRXN"),"SIG")),"^",2) D EN2^PSOUTLA1(PSOREF("IRXN"),54)
"RTN","PSORREF0",21,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSORREF0",22,0)
 K BSIG,PSREV
"RTN","PSORREF0",23,0)
DSPLYX Q
"RTN","PSORREF0",24,0)
CHECK ;
"RTN","PSORREF0",25,0)
 N STA
"RTN","PSORREF0",26,0)
 I '$P(PSOPAR,"^",11),$G(^PSDRUG($P(PSOREF("RX0"),"^",6),"I"))]"",DT>$G(^("I")) D  G CKQ
"RTN","PSORREF0",27,0)
 .S PSORMSG(1)=" *** Drug is inactive for Rx # "_$P(PSOREF("RX0"),"^")_" cannot be refilled ***"
"RTN","PSORREF0",28,0)
 I PSOREF("PSODFN")'=PSODFN S PSORMSG(1)="Can't refill Rx # "_$P(PSOREF("RX0"),"^")_", it is not for this patient." G CKQ
"RTN","PSORREF0",29,0)
 S (PSOX,PSOY,STA)=""
"RTN","PSORREF0",30,0)
 I $G(PSOSD) F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S PSOX=$O(PSOSD(STA,PSOX)) Q:PSOX']""!(PSOREF("DFLG"))  I PSOREF("IRXN")=+PSOSD(STA,PSOX) S PSOY=PSOSD(STA,PSOX) I $P(PSOY,"^",4)]"" D
"RTN","PSORREF0",31,0)
 . S PSOREF("DFLG")=1 S:'$G(PSOERR) PSORMSG(1)="Cannot refill Rx # "_$P(PSOREF("RX0"),"^") S PSOREA=$P(PSOY,"^",4),PSOSTAT=PSOREF("STA")
"RTN","PSORREF0",32,0)
 . D STATUS(PSOREA,PSOSTAT,.PSORMSG) K PSOREA,PSOSTAT
"RTN","PSORREF0",33,0)
 . Q
"RTN","PSORREF0",34,0)
 I PSOY="" S PSORMSG(1)="Cannot refill, Rx is discontinued or expired.  Later Rx may exist." D  I $G(PSODF) Q
"RTN","PSORREF0",35,0)
 .D LOOK I $G(PSODF) Q
"RTN","PSORREF0",36,0)
 .S PSOREF("DFLG")=1
"RTN","PSORREF0",37,0)
 K PSOX,PSOY G:PSOREF("DFLG") CHECKX
"RTN","PSORREF0",38,0)
 I $O(^PS(52.5,"B",PSOREF("IRXN"),0)),'$G(^PS(52.5,+$O(^PS(52.5,"B",PSOREF("IRXN"),0)),"P")) S PSORMSG(1)="Rx is in suspense and cannot be refilled" S PSOREF("DFLG")=1 G CHECKX
"RTN","PSORREF0",39,0)
 S PSOREF("RXSTATUS")=PSOREF("STA")
"RTN","PSORREF0",40,0)
 I PSOREF("RXSTATUS"),PSOREF("RXSTATUS")'=6 D  G CHECKX
"RTN","PSORREF0",41,0)
 . S PSOY=";"_PSOREF("RXSTATUS"),PSOX=$P(^DD(52,100,0),"^",3),PSOY=$F(PSOX,PSOY),PSOY=$P($E(PSOX,PSOY,999),";",1)   ;IA#999
"RTN","PSORREF0",42,0)
 . S PSORMSG(1)="Rx is in "_PSOY_" status, cannot be refilled" S PSOREF("DFLG")=1
"RTN","PSORREF0",43,0)
 D CHKDIV G:PSOREF("DFLG") CHECKX
"RTN","PSORREF0",44,0)
 D NUMBER I PSOREF("NUMBER")>$P(PSOREF("RX0"),"^",9) S PSORMSG(1)="Can't refill, no refills remaining." S PSOREF("DFLG")=1 G CHECKX
"RTN","PSORREF0",45,0)
 ;PSO*7*186  check DEA, SPEC HNDLG field, in case changed, and apply
"RTN","PSORREF0",46,0)
 N PSODRG,PSODEA,PSODAY
"RTN","PSORREF0",47,0)
 S PSODRG=$G(^PSDRUG($P(PSOREF("RX0"),U,6),0)),PSODEA=$P(PSODRG,U,3)
"RTN","PSORREF0",48,0)
 S PSODAY=$P(PSOREF("RX0"),U,8)
"RTN","PSORREF0",49,0)
 I $$DEACHK^PSOUTLA1(PSOREF("IRXN"),PSODEA,PSODAY) D  G CHECKX
"RTN","PSORREF0",50,0)
 . S PSORMSG(1)="This drug has been changed, No refills allowed"
"RTN","PSORREF0",51,0)
 . S PSOREF("DFLG")=1
"RTN","PSORREF0",52,0)
 D DATES
"RTN","PSORREF0",53,0)
CHECKX Q
"RTN","PSORREF0",54,0)
CKQ ;
"RTN","PSORREF0",55,0)
 S PSOREF("DFLG")=1 D PAUSE^VALM1 G CHECKX
"RTN","PSORREF0",56,0)
 Q
"RTN","PSORREF0",57,0)
 ;
"RTN","PSORREF0",58,0)
CHKDIV G:$P(PSOREF("RX2"),"^",9)=+PSOSITE CHKDIVX
"RTN","PSORREF0",59,0)
 S PSORMSG(1)="RX # "_$P(PSOREF("RX0"),"^")_" is for ("_$P(^PS(59,$P(PSOREF("RX2"),"^",9),0),"^")_") division."
"RTN","PSORREF0",60,0)
 I '$P($G(PSOSYS),"^",2) S (PSOREF("DFLG"),PSOMHV)=1 W !,"********* Not Refilled *********" G CHKDIVX
"RTN","PSORREF0",61,0)
 D:$P($G(PSOSYS),"^",3) DIR
"RTN","PSORREF0",62,0)
CHKDIVX Q
"RTN","PSORREF0",63,0)
 ;
"RTN","PSORREF0",64,0)
NUMBER K PSOX,PSOY S PSOREF("# OF REFILLS")=0
"RTN","PSORREF0",65,0)
 I $G(^PSRX(PSOREF("IRXN"),1,0))]"" F PSOX=0:0 S PSOX=$O(^PSRX(PSOREF("IRXN"),1,PSOX)) Q:'PSOX  S PSOREF("# OF REFILLS")=PSOX
"RTN","PSORREF0",66,0)
 S PSOREF("NUMBER")=PSOREF("# OF REFILLS")+1
"RTN","PSORREF0",67,0)
 Q
"RTN","PSORREF0",68,0)
 ;
"RTN","PSORREF0",69,0)
DATES S PSOREF("STOP DATE")=$P(PSOREF("RX2"),"^",6) D NEXT^PSOUTIL(.PSOREF)
"RTN","PSORREF0",70,0)
 D:$G(PSOBBC("QFLG"))&($P(PSOPAR,"^",6)) EDATE Q:$G(PSOREF("DFLG"))
"RTN","PSORREF0",71,0)
 S PSOREF("FILL DATE")=$S($G(PSOREF("FILL DATE")):PSOREF("FILL DATE"),1:DT)
"RTN","PSORREF0",72,0)
 I $P(PSOPAR,"^",6),PSOREF("FILL DATE")<$P(PSOREF("RX3"),"^",2) D SUSDATE^PSOUTIL(.PSOREF)
"RTN","PSORREF0",73,0)
 ;
"RTN","PSORREF0",74,0)
 I PSOREF("FILL DATE")>PSOREF("STOP DATE") D
"RTN","PSORREF0",75,0)
 . S PSORMSG(1)="Can't refill, Refill Date "_$E(PSOREF("FILL DATE"),4,5)_"/"_$E(PSOREF("FILL DATE"),6,7)_"/"
"RTN","PSORREF0",76,0)
 . S PSORMSG(2)=$E(PSOREF("FILL DATE"),2,3)_" is past Expiration Date "_$E(PSOREF("STOP DATE"),4,5)_"/"_$E(PSOREF("STOP DATE"),6,7)_"/"
"RTN","PSORREF0",77,0)
 . S PSORMSG(3)=$E(PSOREF("STOP DATE"),2,3) S PSOREF("DFLG")=1
"RTN","PSORREF0",78,0)
EDATE S PSOREF("LAST REFILL DATE")=$P(PSOREF("RX3"),"^",1)
"RTN","PSORREF0",79,0)
 I PSOREF("LAST REFILL DATE"),PSOREF("FILL DATE")=PSOREF("LAST REFILL DATE") D  G DATESX
"RTN","PSORREF0",80,0)
 . S PSORMSG(1)="Can't refill, Fill Date already exists for "_$E(PSOREF("FILL DATE"),4,5)_"/"_$E(PSOREF("FILL DATE"),6,7)_"/"_$E(PSOREF("FILL DATE"),2,3)
"RTN","PSORREF0",81,0)
 . S PSOREF("DFLG")=1
"RTN","PSORREF0",82,0)
 I PSOREF("LAST REFILL DATE"),PSOREF("FILL DATE")<PSOREF("LAST REFILL DATE") D  G DATESX
"RTN","PSORREF0",83,0)
 . S PSORMSG(1)="Can't refill, later Refill Date already exists for "_$E(PSOREF("LAST REFILL DATE"),4,5)_"/"_$E(PSOREF("LAST REFILL DATE"),6,7)_"/"_$E(PSOREF("LAST REFILL DATE"),2,3)
"RTN","PSORREF0",84,0)
 . S PSOREF("DFLG")=1
"RTN","PSORREF0",85,0)
 I '$P(PSOPAR,"^",6),'$D(PSOREF("EAOK")),$P(PSOREF("RX3"),"^",2)>PSOREF("FILL DATE") D
"RTN","PSORREF0",86,0)
 . S PSOX1=(PSOREF("NUMBER")+1)*PSOREF("DAYS SUPPLY")-10
"RTN","PSORREF0",87,0)
 . W !?5,$C(7),"LESS THAN ",PSOX1," DAYS FOR ",PSOREF("NUMBER")+1," FILLS",! D DIR K PSOX1
"RTN","PSORREF0",88,0)
 I '$P(PSOPAR,"^",6),$G(PSOREF("EAOK"))=0,$P(PSOREF("RX3"),"^",2)>PSOREF("FILL DATE") D
"RTN","PSORREF0",89,0)
 . S Y=$P(PSOREF("RX3"),"^",2) D DD^%DT W !!,$C(7),"Cannot be refilled until "_Y_"." S (PSOREF("DFLG"),PSOMHV)=1 K Y
"RTN","PSORREF0",90,0)
DATESX Q
"RTN","PSORREF0",91,0)
DIR K DIR,X,Y S DIR(0)="Y",DIR("A")="Continue ",DIR("B")="N",DIR("?")="Answer YES to Refill, NO to bypass"
"RTN","PSORREF0",92,0)
 D ^DIR K DIR S:$D(DIRUT)!('Y) (PSOREF("DFLG"),PSOMHV)=1 K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSORREF0",93,0)
 Q
"RTN","PSORREF0",94,0)
 ;
"RTN","PSORREF0",95,0)
EN(PSOREF)         ; Entry Point for Batch Barcode Option
"RTN","PSORREF0",96,0)
 D PROCESS K DRUG,PSODF
"RTN","PSORREF0",97,0)
 Q
"RTN","PSORREF0",98,0)
LOOK ;this entry is used to try and find current med order
"RTN","PSORREF0",99,0)
 S (PSOY,STA,PSOX)="",DRUG=$P(^PSDRUG($P(^PSRX(PSOREF("IRXN"),0),"^",6),0),"^")
"RTN","PSORREF0",100,0)
 I $G(PSOSD) F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S PSOX=$O(PSOSD(STA,PSOX)) Q:PSOX']""  I DRUG=PSOX,+PSOSD(STA,PSOX) S PSOY=PSOSD(STA,PSOX),PSOREF("IRXN")=+PSOSD(STA,PSOX),PSODF=1,PSOBBC("DONE")=PSOREF("IRXN")_"," Q
"RTN","PSORREF0",101,0)
 K DRUG
"RTN","PSORREF0",102,0)
 Q
"RTN","PSORREF0",103,0)
 ;
"RTN","PSORREF0",104,0)
STATUS(PSOREA,PSOSTAT,PSORMSG) ;
"RTN","PSORREF0",105,0)
 N DSMSG,PSOA,PSOB,TARGET
"RTN","PSORREF0",106,0)
 S DSMSG=PSORMSG(1)
"RTN","PSORREF0",107,0)
 I PSOREA["A" S DSMSG=DSMSG_" Inactive Drug."
"RTN","PSORREF0",108,0)
 I PSOREA["M" S DSMSG=DSMSG_" Drug no longer used by Outpatient."
"RTN","PSORREF0",109,0)
 I PSOREA["B" S DSMSG=DSMSG_" Narcotic Drug."
"RTN","PSORREF0",110,0)
 I PSOREA["C" S DSMSG=DSMSG_" Non-Renewable Drug."
"RTN","PSORREF0",111,0)
 I PSOREA["D" S DSMSG=DSMSG_" Non-Renewable Patient Status."
"RTN","PSORREF0",112,0)
 I PSOREA["E" S DSMSG=DSMSG_" Non-Verified Rx."
"RTN","PSORREF0",113,0)
 I PSOREA["F" S DSMSG=DSMSG_" Maximum of 26 Renewals."
"RTN","PSORREF0",114,0)
 I PSOREA["G" S DSMSG=DSMSG_" No refills left."
"RTN","PSORREF0",115,0)
 I PSOREA["Z" D
"RTN","PSORREF0",116,0)
 . S:PSOSTAT=4 PSOSTAT=1
"RTN","PSORREF0",117,0)
 . S PSOA=";"_PSOSTAT
"RTN","PSORREF0",118,0)
 . D FIELD^DID(52,100,,"POINTER","TARGET")
"RTN","PSORREF0",119,0)
 . S PSOB=$G(TARGET("POINTER"))
"RTN","PSORREF0",120,0)
 . Q:PSOB=""
"RTN","PSORREF0",121,0)
 . S PSOA=$F(PSOB,PSOA),PSOA=$P($E(PSOB,PSOA,999),";",1)
"RTN","PSORREF0",122,0)
 . S DSMSG=DSMSG_" Rx is in "_$P(PSOA,":",2)_" status."
"RTN","PSORREF0",123,0)
 . K PSOA,PSOB
"RTN","PSORREF0",124,0)
 . Q
"RTN","PSORREF0",125,0)
 S PSORMSG(1)=DSMSG
"RTN","PSORREF0",126,0)
 Q
"RTN","PSORREF1")
0^4^B3242931^n/a
"RTN","PSORREF1",1,0)
PSORREF1 ;AITC/BWF - Remote RX refill API ;12/3/2013 2:51pm
"RTN","PSORREF1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORREF1",3,0)
 ;
"RTN","PSORREF1",4,0)
 Q
"RTN","PSORREF1",5,0)
 ; This is a modified copy of PSOREF1, for processing remote prescription requests.
"RTN","PSORREF1",6,0)
START(FDATE) ;
"RTN","PSORREF1",7,0)
 S (PSOREF("DFLG"),PSOREF("FIELD"),PSOREF1)=0
"RTN","PSORREF1",8,0)
 S X="T-6M",%DT="X" D ^%DT
"RTN","PSORREF1",9,0)
 S (PSOID,PSOREF("ISSUE DATE"))=$S($P(^PSRX(PSOREF("IRXN"),0),"^",13)<Y:Y,1:$P(^PSRX(PSOREF("IRXN"),0),"^",13))
"RTN","PSORREF1",10,0)
 S:$G(PSORX("BAR CODE"))&($G(PSOBBC1("FROM"))="NEW") PSOREF("ISSUE DATE")=DT
"RTN","PSORREF1",11,0)
 K X,X1,X2
"RTN","PSORREF1",12,0)
 S PSOREF("CS")=0,PSODRUG("DEA")=$P(^PSDRUG($P(^PSRX(PSOREF("IRXN"),0),"^",6),0),"^",3)
"RTN","PSORREF1",13,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOREF("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOREF("CS"),"^",2)=1
"RTN","PSORREF1",14,0)
 ;
"RTN","PSORREF1",15,0)
 ;
"RTN","PSORREF1",16,0)
1 S PSONEW("DAYS SUPPLY")=$P(^PSRX(PSOREF("IRXN"),0),"^",8),PSONEW("# OF REFILLS")=$P(^(0),"^",9)
"RTN","PSORREF1",17,0)
 S PSODIR("FILL DATE")=FDATE
"RTN","PSORREF1",18,0)
 ;
"RTN","PSORREF1",19,0)
END ;
"RTN","PSORREF1",20,0)
 K PSOREF1
"RTN","PSORREF1",21,0)
 Q
"RTN","PSORREF1",22,0)
JUMP ;
"RTN","PSORREF1",23,0)
 S PSOREF("FIELD")=$S(+Y=22:1,+Y=11:2,+Y=16:3,+Y=29:4,1:PSOREF("FLD"))
"RTN","PSORREF1",24,0)
 I PSOREF("FIELD")>PSOREF("FLD") W !,$C(7),"Cannot jump ahead ..",! S PSOREF("FIELD")=PSOREF("FLD")
"RTN","PSORREF1",25,0)
 Q
"RTN","PSORREF1",26,0)
 ;
"RTN","PSORRP")
0^11^B74346330^n/a
"RTN","PSORRP",1,0)
PSORRP ;AITC/BWF - Remote RX report ;8/15/16 5:44pm
"RTN","PSORRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORRP",3,0)
 ;
"RTN","PSORRP",4,0)
EN ; -- main entry point for PSO LM REMOTE RX REPORT
"RTN","PSORRP",5,0)
 N PSOREPORT
"RTN","PSORRP",6,0)
 D EN^VALM("PSO LM REMOTE RX REPORT")
"RTN","PSORRP",7,0)
 Q
"RTN","PSORRP",8,0)
 ;
"RTN","PSORRP",9,0)
HDR ; -- header code
"RTN","PSORRP",10,0)
 S VALMHDR(1)=$P("Prescriptions dispensed for other Host Pharmacies^Our prescriptions, filled by other facilities as the Dispensing Pharmacy^All OneVA Pharmacy Prescription Activity","^",PSOREPORT)
"RTN","PSORRP",11,0)
 Q
"RTN","PSORRP",12,0)
 ;
"RTN","PSORRP",13,0)
INIT ; -- init variables and list array
"RTN","PSORRP",14,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSORRP",15,0)
 ;S VALMCNT=30
"RTN","PSORRP",16,0)
 N SBY,DONE,QUIT,SDATE,EDATE,DFN,SITEIEN,DISP,DIR,Y,%DT,DIC,DFN,SITEIEN,DISP
"RTN","PSORRP",17,0)
 S VALMCNT=0
"RTN","PSORRP",18,0)
 ;S DIR(0)="S^1:Prescriptions dispensed for other Host Pharmacies;2:Our prescriptions, filled by other facilities as the Dispensing Pharmacy;3:All OneVA Pharmacy Prescription Activity"
"RTN","PSORRP",19,0)
 ;S DIR("A")="Select item" D ^DIR S PSOREPORT=Y
"RTN","PSORRP",20,0)
 S DIR(0)="N^1:3:0"
"RTN","PSORRP",21,0)
 S DIR("A",1)=""
"RTN","PSORRP",22,0)
 S DIR("A",2)="   1.   Prescriptions dispensed for other Host Pharmacies"
"RTN","PSORRP",23,0)
 S DIR("A",3)="   2.   Our prescriptions, filled by other facilities as the Dispensing Pharmacy"
"RTN","PSORRP",24,0)
 S DIR("A",4)="   3.   All OneVA Pharmacy Prescription Activity"
"RTN","PSORRP",25,0)
 S DIR("A",5)=""
"RTN","PSORRP",26,0)
 S DIR("A")="   Select item"
"RTN","PSORRP",27,0)
 S DIR("?")="Answer with 1, 2, or 3."
"RTN","PSORRP",28,0)
 S DIR("?",1)=""
"RTN","PSORRP",29,0)
 S DIR("?",2)="Selecting 1 will display the list of prescriptions that our local facility has"
"RTN","PSORRP",30,0)
 S DIR("?",3)="dispensed on behalf of other host Pharmacy locations as part of the OneVA"
"RTN","PSORRP",31,0)
 S DIR("?",4)="Pharmacy program. Selecting 2 will display the list of prescriptions other VA"
"RTN","PSORRP",32,0)
 S DIR("?",5)="Pharmacy locations have filled as a dispensing site for a prescription that"
"RTN","PSORRP",33,0)
 S DIR("?",6)="originated from our location. Selecting 3 will list all prescriptions that"
"RTN","PSORRP",34,0)
 S DIR("?",7)="either we have filled for other Pharmacy locations as the dispensing site or"
"RTN","PSORRP",35,0)
 S DIR("?",8)="other Pharmacy locations have filled on our behalf."
"RTN","PSORRP",36,0)
 S DIR("?",9)=""
"RTN","PSORRP",37,0)
 ;S DIR("??")="^D EXTHLP^PSORRP"
"RTN","PSORRP",38,0)
 ;
"RTN","PSORRP",39,0)
 ;
"RTN","PSORRP",40,0)
 D ^DIR S PSOREPORT=Y
"RTN","PSORRP",41,0)
 ;
"RTN","PSORRP",42,0)
 I Y="^" S VALMQUIT="" Q
"RTN","PSORRP",43,0)
 S DISP=Y
"RTN","PSORRP",44,0)
 W "  ",$S(DISP=1:"Prescriptions dispensed for other Host Pharmacies",DISP=2:"Our prescriptions, filled by other facilities as the Dispensing Pharmacy",DISP=3:"All OneVA Pharmacy Prescription Activity",1:"")
"RTN","PSORRP",45,0)
 ;
"RTN","PSORRP",46,0)
 S DISP=$S(DISP=1:"RF^PR",DISP=2:"OR^OP",1:"RF^PR^OR^OP")
"RTN","PSORRP",47,0)
 K DIR
"RTN","PSORRP",48,0)
 S DIR(0)="S^D:DATE RANGE;P:PATIENT;S:SITE"
"RTN","PSORRP",49,0)
 S DIR("A")="Search by"
"RTN","PSORRP",50,0)
 S DIR("?")="specific patient or S for a report for a specific VA Pharmacy."
"RTN","PSORRP",51,0)
 S DIR("?",1)="Answer with D for report within a specific date range or P for a report for a"
"RTN","PSORRP",52,0)
 ;
"RTN","PSORRP",53,0)
 D ^DIR
"RTN","PSORRP",54,0)
 I Y="^" S VALMQUIT="" Q
"RTN","PSORRP",55,0)
 S SBY=Y
"RTN","PSORRP",56,0)
 ; if date range
"RTN","PSORRP",57,0)
 S QUIT=0
"RTN","PSORRP",58,0)
 I SBY="D" D  G:QUIT INIT
"RTN","PSORRP",59,0)
 .S DONE=0
"RTN","PSORRP",60,0)
 .F  D  Q:DONE!(QUIT)
"RTN","PSORRP",61,0)
 ..S %DT="AQEP",%DT("A")="Enter start date: ",%DT("B")=$$FMTE^XLFDT($$FMADD^XLFDT(DT,-30),1) D ^%DT
"RTN","PSORRP",62,0)
 ..I Y<0 S QUIT=1 Q
"RTN","PSORRP",63,0)
 ..I Y S SDATE=Y,DONE=1
"RTN","PSORRP",64,0)
 . Q:QUIT
"RTN","PSORRP",65,0)
 .S DONE=0
"RTN","PSORRP",66,0)
 .F  D  Q:DONE!(QUIT)
"RTN","PSORRP",67,0)
 ..S %DT="AQEP",%DT("A")="Enter end date: ",%DT("B")=$$FMTE^XLFDT(DT,1) D ^%DT
"RTN","PSORRP",68,0)
 ..I Y<0 S QUIT=1 Q
"RTN","PSORRP",69,0)
 ..I Y S EDATE=Y,DONE=1
"RTN","PSORRP",70,0)
 . Q:QUIT
"RTN","PSORRP",71,0)
 .D DTRNG(SDATE,EDATE,DISP)
"RTN","PSORRP",72,0)
 I SBY="P" D  G:QUIT INIT
"RTN","PSORRP",73,0)
 .S DIC="^DPT(",DIC(0)="QEAMZ" D ^DIC I Y<0 S QUIT=1 Q
"RTN","PSORRP",74,0)
 .S DFN=+Y
"RTN","PSORRP",75,0)
 .D PAT(DFN,DISP)
"RTN","PSORRP",76,0)
 I SBY="S" D  G:QUIT INIT
"RTN","PSORRP",77,0)
 .S DIC="^DIC(4,",DIC(0)="QEAMZ" D ^DIC I Y<0 S QUIT=1 Q
"RTN","PSORRP",78,0)
 .S SITEIEN=+Y
"RTN","PSORRP",79,0)
 .D SITE(SITEIEN,DISP)
"RTN","PSORRP",80,0)
 I 'VALMCNT,SBY="D" K DIR S DIR(0)="FO",DIR("A")="Nothing to list for this date range. Press return to continue" D ^DIR S VALMQUIT=1
"RTN","PSORRP",81,0)
 I 'VALMCNT,SBY="P" K DIR S DIR(0)="FO",DIR("A")="Nothing to list for this patient. Press return to continue" D ^DIR S VALMQUIT=1
"RTN","PSORRP",82,0)
 I 'VALMCNT,SBY="S" K DIR S DIR(0)="FO",DIR("A")="Nothing to list for this site. Press return to continue" D ^DIR S VALMQUIT=1
"RTN","PSORRP",83,0)
 Q
"RTN","PSORRP",84,0)
INITQ ;
"RTN","PSORRP",85,0)
 Q
"RTN","PSORRP",86,0)
 ;
"RTN","PSORRP",87,0)
HELP ; -- help code
"RTN","PSORRP",88,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSORRP",89,0)
 Q
"RTN","PSORRP",90,0)
 ;
"RTN","PSORRP",91,0)
EXIT ; -- exit code
"RTN","PSORRP",92,0)
 D CLEAN^VALM10
"RTN","PSORRP",93,0)
 K VALMQUIT,VALMLST,VALMHDR,VALMAR,VALMBG,VALMCNT
"RTN","PSORRP",94,0)
 Q
"RTN","PSORRP",95,0)
 ;
"RTN","PSORRP",96,0)
EXPND ; -- expand code
"RTN","PSORRP",97,0)
 Q
"RTN","PSORRP",98,0)
 ;
"RTN","PSORRP",99,0)
DTRNG(BEG,END,FLTR) ;
"RTN","PSORRP",100,0)
 N IEN,LINE,TCOST,TYPE
"RTN","PSORRP",101,0)
 S (LINE,TCOST)=0
"RTN","PSORRP",102,0)
 S BEG=BEG-.01,END=END_.2359
"RTN","PSORRP",103,0)
 F  S BEG=$O(^PSRXR(52.09,"B",BEG)) Q:'BEG!(BEG>END)  D
"RTN","PSORRP",104,0)
 .S IEN=0 F  S IEN=$O(^PSRXR(52.09,"B",BEG,IEN)) Q:'IEN  D
"RTN","PSORRP",105,0)
 ..S TYPE=$$GET1^DIQ(52.09,IEN,.05,"I") I FLTR'[TYPE Q
"RTN","PSORRP",106,0)
 ..S TCOST=$G(TCOST)+$J($$GET1^DIQ(52.09,IEN,1.2,"I"),0,2)
"RTN","PSORRP",107,0)
 ..S LINE=LINE+1 D BLDLINE(IEN,.LINE)
"RTN","PSORRP",108,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSORRP",109,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Total Cost for items in this report: $"_$J(TCOST,0,2))
"RTN","PSORRP",110,0)
 Q
"RTN","PSORRP",111,0)
PAT(DFN,FLTR) ;
"RTN","PSORRP",112,0)
 N IEN,LINE,TCOST,TYPE
"RTN","PSORRP",113,0)
 S (LINE,TCOST)=0
"RTN","PSORRP",114,0)
 S IEN=0 F  S IEN=$O(^PSRXR(52.09,"C",DFN,IEN)) Q:'IEN  D
"RTN","PSORRP",115,0)
 .S TYPE=$$GET1^DIQ(52.09,IEN,.05,"I") I FLTR'[TYPE Q
"RTN","PSORRP",116,0)
 .S TCOST=$G(TCOST)+$J($$GET1^DIQ(52.09,IEN,1.2,"I"),0,2)
"RTN","PSORRP",117,0)
 .S LINE=LINE+1 D BLDLINE(IEN,.LINE)
"RTN","PSORRP",118,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSORRP",119,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Total Cost for items in this report: $"_$J(TCOST,0,2))
"RTN","PSORRP",120,0)
 Q
"RTN","PSORRP",121,0)
SITE(SITEIEN,FLTR) ;
"RTN","PSORRP",122,0)
 N IEN,LINE,TCOST,TYPE
"RTN","PSORRP",123,0)
 S (LINE,TCOST)=0
"RTN","PSORRP",124,0)
 S IEN=0 F  S IEN=$O(^PSRXR(52.09,"E",SITEIEN,IEN)) Q:'IEN  D
"RTN","PSORRP",125,0)
 .S TYPE=$$GET1^DIQ(52.09,IEN,.05,"I") I FLTR'[TYPE Q
"RTN","PSORRP",126,0)
 .S TCOST=$G(TCOST)+$J($$GET1^DIQ(52.09,IEN,1.2,"I"),0,2)
"RTN","PSORRP",127,0)
 .S LINE=LINE+1 D BLDLINE(IEN,.LINE)
"RTN","PSORRP",128,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSORRP",129,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Total Cost for items in this report: $"_$J(TCOST,0,2))
"RTN","PSORRP",130,0)
 Q
"RTN","PSORRP",131,0)
BLDLINE(IEN,LINE) ;
"RTN","PSORRP",132,0)
 N DATE,PAT,DRUG,SITE,TYPE,QTY,DSUPP,F,IENS,DATA,IENS,LINEVAR
"RTN","PSORRP",133,0)
 S IENS=IEN_","
"RTN","PSORRP",134,0)
 S F=52.09
"RTN","PSORRP",135,0)
 D GETS^DIQ(F,IENS,"**","IE","DATA")
"RTN","PSORRP",136,0)
 S LINEVAR=""
"RTN","PSORRP",137,0)
 S DATE=$P(DATA(F,IENS,.01,"E"),U)
"RTN","PSORRP",138,0)
 S PAT=$G(DATA(F,IENS,.02,"E"))
"RTN","PSORRP",139,0)
 S SITE=$G(DATA(F,IENS,.04,"E"))
"RTN","PSORRP",140,0)
 S TYPE=$G(DATA(F,IENS,.05,"I"))
"RTN","PSORRP",141,0)
 S QTY=$G(DATA(F,IENS,.07,"E"))
"RTN","PSORRP",142,0)
 S DSUPP=$G(DATA(F,IENS,.08,"E"))
"RTN","PSORRP",143,0)
 S DRUG=$G(DATA(F,IENS,1,"E"))
"RTN","PSORRP",144,0)
 S LINEVAR=$$SETFLD^VALM1($J(LINE,2),LINEVAR,"LINENO")
"RTN","PSORRP",145,0)
 S LINEVAR=$$SETFLD^VALM1(DATE,LINEVAR,"DATE")
"RTN","PSORRP",146,0)
 S LINEVAR=$$SETFLD^VALM1(PAT,LINEVAR,"PATIENT")
"RTN","PSORRP",147,0)
 ;S LINEVAR=$$SETFLD^VALM1(SITE,LINEVAR,"SITE")
"RTN","PSORRP",148,0)
 S LINEVAR=$$SETFLD^VALM1(DRUG,LINEVAR,"DRUG")
"RTN","PSORRP",149,0)
 S LINEVAR=$$SETFLD^VALM1(TYPE,LINEVAR,"TYPE")
"RTN","PSORRP",150,0)
 S LINEVAR=$$SETFLD^VALM1(QTY,LINEVAR,"QTY")
"RTN","PSORRP",151,0)
 S LINEVAR=$$SETFLD^VALM1(DSUPP,LINEVAR,"DSUPP")
"RTN","PSORRP",152,0)
 D SET^VALM10(LINE,LINEVAR,IEN)
"RTN","PSORRP",153,0)
 S VALMCNT=$G(VALMCNT)+1
"RTN","PSORRP",154,0)
 Q
"RTN","PSORRP",155,0)
SEL ;
"RTN","PSORRP",156,0)
 N DIR,ITEM,IEN,IENS,DATA,CNT,F,TYPE,ARY,SITELBL
"RTN","PSORRP",157,0)
 S ARY=$NA(^TMP("PSORRD",$J))
"RTN","PSORRP",158,0)
 K @ARY
"RTN","PSORRP",159,0)
 S CNT=1
"RTN","PSORRP",160,0)
 S F=52.09
"RTN","PSORRP",161,0)
 I $P(XQORNOD(0),"=",2) S Y=+$P(XQORNOD(0),"=",2)
"RTN","PSORRP",162,0)
 I '$P(XQORNOD(0),"=",2) D  Q:'Y
"RTN","PSORRP",163,0)
 .;S DIR(0)="N^"_VALMBG_":"_VALMLST_":0" D ^DIR Q:'Y
"RTN","PSORRP",164,0)
 . S DIR(0)="N^"_1_":"_VALMCNT_":0" D ^DIR Q:'Y
"RTN","PSORRP",165,0)
 S ITEM=Y,IEN=$O(@VALMAR@("IDX",ITEM,0))
"RTN","PSORRP",166,0)
 Q:'IEN
"RTN","PSORRP",167,0)
 S IENS=IEN_","
"RTN","PSORRP",168,0)
 D GETS^DIQ(F,IENS,"**","IE","DATA")
"RTN","PSORRP",169,0)
 S TYPE=$G(DATA(F,IENS,.05,"I"))
"RTN","PSORRP",170,0)
 ; set up data
"RTN","PSORRP",171,0)
 S @ARY@(CNT,0)="Request Date/Time:                    "_$G(DATA(F,IENS,.01,"E")),CNT=CNT+1
"RTN","PSORRP",172,0)
 S @ARY@(CNT,0)="Patient:                              "_$G(DATA(F,IENS,.02,"E")),CNT=CNT+1
"RTN","PSORRP",173,0)
 S @ARY@(CNT,0)="RX #:                                 "_$G(DATA(F,IENS,.03,"I")),CNT=CNT+1
"RTN","PSORRP",174,0)
 S SITELBL=$S(TYPE?1"O".E:"Rx Dispensed by Site:                 ",1:"Rx Hosted at Site:                    ")
"RTN","PSORRP",175,0)
 S @ARY@(CNT,0)=SITELBL_$G(DATA(F,IENS,.04,"E")),CNT=CNT+1
"RTN","PSORRP",176,0)
 S @ARY@(CNT,0)="Request Type:                         "_$G(DATA(F,IENS,.05,"E")),CNT=CNT+1
"RTN","PSORRP",177,0)
 S @ARY@(CNT,0)="Requesting Pharmacist:                "_$S((TYPE="PR")!(TYPE="RF"):$G(DATA(F,IENS,.06,"E")),(TYPE="OR")!(TYPE="OP"):$G(DATA(F,IENS,.061,"E"))),CNT=CNT+1
"RTN","PSORRP",178,0)
 S @ARY@(CNT,0)="Quantity:   "_$G(DATA(F,IENS,.07,"E"))_"   Days Supply: "_$G(DATA(F,IENS,.08,"E"))
"RTN","PSORRP",179,0)
 S @ARY@(CNT,0)="Dispensed Date:                       "_$G(DATA(F,IENS,.1,"E")),CNT=CNT+1
"RTN","PSORRP",180,0)
 S @ARY@(CNT,0)="Drug Name at Originating (Host) site: "_$G(DATA(F,IENS,1,"E")),CNT=CNT+1
"RTN","PSORRP",181,0)
 S @ARY@(CNT,0)="Local (matched) drug:                 "_$G(DATA(F,IENS,1.1,"E")),CNT=CNT+1
"RTN","PSORRP",182,0)
 S @ARY@(CNT,0)="Cost of Local Refill/Partial:         $"_$J($G(DATA(F,IENS,1.2,"E")),0,2)
"RTN","PSORRP",183,0)
 S PSORCNT=CNT
"RTN","PSORRP",184,0)
 D ^PSORRD
"RTN","PSORRP",185,0)
 K @ARY,PSORCNT
"RTN","PSORRP",186,0)
 S VALMBCK="R"
"RTN","PSORRP",187,0)
 Q
"RTN","PSORRP",188,0)
 ;
"RTN","PSORRP",189,0)
EXTHLP ;
"RTN","PSORRP",190,0)
 W !,"Selecting 1 will display the list of prescriptions that our local facility has"
"RTN","PSORRP",191,0)
 W !,"dispensed on behalf of other host Pharmacy locations as part of the OneVA"
"RTN","PSORRP",192,0)
 W !,"Pharmacy program. Selecting 2 will display the list of prescriptions other VA"
"RTN","PSORRP",193,0)
 W !,"Pharmacy locations have filled as a dispensing site for a prescription that"
"RTN","PSORRP",194,0)
 W !,"originated from our location. Selecting 3 will list all prescriptions that"
"RTN","PSORRP",195,0)
 W !,"either we have filled for other Pharmacy locations as the dispensing site or"
"RTN","PSORRP",196,0)
 W !,"other Pharmacy locations have filled on our behalf."
"RTN","PSORRP",197,0)
 Q
"RTN","PSORRPA1")
0^12^B75304679^n/a
"RTN","PSORRPA1",1,0)
PSORRPA1 ;AITC/BWF - remote partial prescriptions ;7/16/16 5:10pm
"RTN","PSORRPA1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORRPA1",3,0)
 ;
"RTN","PSORRPA1",4,0)
 ;External references L,UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORRPA1",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORRPA1",6,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORRPA1",7,0)
 ; bwf - Modified copy of PSORXPA1
"RTN","PSORRPA1",8,0)
 ; bwf - 2/24/14 adding PAR refill tag for API usage.
"RTN","PSORRPA1",9,0)
 ; VALMSG  - return data for remote facility
"RTN","PSORRPA1",10,0)
 ; RXNUM   - rx number
"RTN","PSORRPA1",11,0)
 ; PFDATE  - Partial Fill Date
"RTN","PSORRPA1",12,0)
 ; MW      - Mail or Window
"RTN","PSORRPA1",13,0)
 ; QTY     - Quantity
"RTN","PSORRPA1",14,0)
 ; DSUPP   - Days Supply
"RTN","PSORRPA1",15,0)
 ; REMARKS - Remarks entered by 'remote' (filling) facility.
"RTN","PSORRPA1",16,0)
 ; PHARM   - Remote pharmacist's name
"RTN","PSORRPA1",17,0)
 ; PHONE   - remote pharmacists phone number
"RTN","PSORRPA1",18,0)
 ; SITE    - remote filling site.
"RTN","PSORRPA1",19,0)
 ;
"RTN","PSORRPA1",20,0)
PAR(VALMSG,RXNUM,PFDATE,MW,QTY,DSUPP,REMARKS,PHARM,PHONE,SITE,RX0,RX2,RXSTA,RPROV,RSIG,RPAR0,ROR1,RX3,RREF0) ;
"RTN","PSORRPA1",21,0)
 N RRXIEN,PSOPAR,ORN,PSOLST,XTMPLOC,PASSLOC,HFSIEN,FULLPTH,HFSDONE,PTHDAT,PTHPIECE,DEL,DELARR,FTGOPEN,FOUND,FTGSTRT,FTGOPEN,STATION,HDRUG
"RTN","PSORRPA1",22,0)
 N PERR,PDIR,PFIL,CSVAL,C,D,E,NEWPFIEN,PFIEN,PFIENS,PSOEXREP,PSOFROM,DINACT,PSOPHDUZ,PSODFDIR,PSOFNAME,PSOZ1,RREFIEN
"RTN","PSORRPA1",23,0)
 S $ETRAP="D ^%ZTER Q"
"RTN","PSORRPA1",24,0)
 S (RRXIEN,RXN)=$O(^PSRX("B",RXNUM,0)),PSOSIEN=$$GET1^DIQ(52,RRXIEN,20,"I")
"RTN","PSORRPA1",25,0)
 I '$$GET1^DIQ(59,PSOSIEN,3001,"I") D  Q
"RTN","PSORRPA1",26,0)
 .S VALMSG(1)="The OneVA pharmacy flag is turned 'OFF' at this facility."
"RTN","PSORRPA1",27,0)
 .S VALMSG(2)="Unable to process refill/partial fill requests."
"RTN","PSORRPA1",28,0)
 .D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE)
"RTN","PSORRPA1",29,0)
 S HDRUG=$$GET1^DIQ(52,RRXIEN,6,"I")
"RTN","PSORRPA1",30,0)
 S DINACT=$$GET1^DIQ(50,HDRUG,100,"I")
"RTN","PSORRPA1",31,0)
 I DINACT>0,DINACT<$$NOW^XLFDT S VALMSG(1)="Drug is inactive for Rx# "_RXNUM_". Cannot process partial fill." D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE) Q
"RTN","PSORRPA1",32,0)
 S CSVAL=$$GET1^DIQ(50,HDRUG,3,"E"),CSVAL=$E(CSVAL,1)
"RTN","PSORRPA1",33,0)
 I CSVAL,CSVAL>0,CSVAL<6 D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE) S VALMSG(1)="Rx #"_RXNUM_" cannot be partially filled. The associated drug is considered a controlled substance at the host facility." Q
"RTN","PSORRPA1",34,0)
 I $D(^PSRX(RRXIEN,"ADP",PFDATE,RRXIEN)) S VALMSG(1)="A partial fill already exists for "_$$FMTE^XLFDT(PFDATE,"5D")_".",VALMSG(2)="Partial cannot be processed" D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE) Q
"RTN","PSORRPA1",35,0)
 S PSOPAR=$G(^PS(59,PSOSIEN,1)),PSOSITE=PSOSIEN
"RTN","PSORRPA1",36,0)
 ; set up PSOLST
"RTN","PSORRPA1",37,0)
 S ORN=1,PSOLST(ORN)=52_U_RRXIEN_U_U
"RTN","PSORRPA1",38,0)
 S PSOPHDUZ=$$GET1^DIQ(52,RRXIEN,23,"I") I 'PSOPHDUZ S PSOPHDUZ=.5
"RTN","PSORRPA1",39,0)
 S PSORPDFN=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",2)
"RTN","PSORRPA1",40,0)
 S DA=$P(PSOLST(ORN),"^",2),RX0=^PSRX(DA,0),J=DA,RX2=$G(^(2)),R3=$G(^(3)) S:'$G(BBFLG) BBRX(1)=""
"RTN","PSORRPA1",41,0)
 N PSORF,PSOTRIC D TRIC^PSORXL1(DA) I PSOTRIC&($$STATUS^PSOBPSUT(DA,PSORF)'["PAYABLE") D  Q
"RTN","PSORRPA1",42,0)
 . S VALMSG(1)="Partial cannot be filled on Tricare non-payable Rx."
"RTN","PSORRPA1",43,0)
 . D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE)
"RTN","PSORRPA1",44,0)
 I +$P($G(^PSRX(DA,2)),"^",6)<DT D
"RTN","PSORRPA1",45,0)
 .S:$P($G(^PSRX(DA,"STA")),"^")<12 $P(^PSRX(DA,"STA"),"^")=11
"RTN","PSORRPA1",46,0)
 .S COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"/"_$E($P(^(2),"^",6),6,7)_"/"_$E($P(^(2),"^",6),2,3)
"RTN","PSORRPA1",47,0)
 .S STAT="SC",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM) K STAT,PHARMST,COMM,RX0,J,RX2,R3
"RTN","PSORRPA1",48,0)
 I +^PSRX(DA,"STA"),+^("STA")'=5,+^("STA")'=11 D  K DA D ULK Q
"RTN","PSORRPA1",49,0)
 .S C=";"_+^PSRX(DA,"STA")_":",X=$P(^DD(52,100,0),"^",3),E=$F(X,C),D=$P($E(X,E,999),";")   ;IA#999
"RTN","PSORRPA1",50,0)
 .S VALMSG(1)="Prescription is in a "_D_" status."
"RTN","PSORRPA1",51,0)
 .D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE)
"RTN","PSORRPA1",52,0)
 I $G(PSXSYS),($O(^PS(52.5,"B",DA,""))) S PSOZ1=$O(^PS(52.5,"B",DA,"")) D
"RTN","PSORRPA1",53,0)
 .I $P($G(^PS(52.5,PSOZ1,0)),"^",7)="Q"!($P($G(^(0)),"^",7)="L") D
"RTN","PSORRPA1",54,0)
 ..S VALMSG(1)="A partial entered for this Rx cannot be suspended."
"RTN","PSORRPA1",55,0)
 ..S VALMSG(2)="A fill for this Rx is already suspended for CMOP transmission."
"RTN","PSORRPA1",56,0)
 ..S VALMSG(3)="You may pull this fill from suspense or enter a partial and print the label."
"RTN","PSORRPA1",57,0)
 ..D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE)
"RTN","PSORRPA1",58,0)
CLC S PSOCLC=PSOPHDUZ,PHYS=$P(^PSRX(DA,0),"^",4),DRG=$P(^(0),"^",6)
"RTN","PSORRPA1",59,0)
 I 'PHYS,$O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S PHYS=$S($P(^PSRX(DA,1,I,0),"^",17):$P(^PSRX(DA,1,I,0),"^",17),1:PHYS)
"RTN","PSORRPA1",60,0)
 S PSOPRZ=0 I $O(^PSRX(DA,"P",0)) N Z2 F Z2=0:0 S Z2=$O(^PSRX(DA,"P",Z2)) Q:'Z2  S PSOPRZ=Z2
"RTN","PSORRPA1",61,0)
 I $D(RXPR(DA)),'$D(^PSRX(DA,"P",$G(RXPR(DA)))) D RMP^PSOCAN3
"RTN","PSORRPA1",62,0)
 ; bwf - save information into database, just as it would be through ^DIE
"RTN","PSORRPA1",63,0)
 S FDA(52.2,"+1,"_RRXIEN_",",.01)=PFDATE D UPDATE^DIE(,"FDA","NEWPFIEN","PERR") K FDA
"RTN","PSORRPA1",64,0)
 I $D(PERR) M VALMSG=PERR
"RTN","PSORRPA1",65,0)
 S PFIEN=$O(NEWPFIEN(0)),PFIEN=$G(NEWPFIEN(PFIEN))
"RTN","PSORRPA1",66,0)
 ; set Z1 variable as was done in the ^DIE call for later use.
"RTN","PSORRPA1",67,0)
 S Z1=PFIEN
"RTN","PSORRPA1",68,0)
 S PFIENS=PFIEN_","_RRXIEN_","
"RTN","PSORRPA1",69,0)
 ; set PM variable as was done in the ^DIE call for later use.
"RTN","PSORRPA1",70,0)
 I MW="M"!('$P($G(PSOPAR),U,12)) S PM=1
"RTN","PSORRPA1",71,0)
 S FDA(52.2,PFIENS,.02)=MW
"RTN","PSORRPA1",72,0)
 S FDA(52.2,PFIENS,.04)=QTY
"RTN","PSORRPA1",73,0)
 S FDA(52.2,PFIENS,.041)=DSUPP
"RTN","PSORRPA1",74,0)
 ; currently we have no local pharmacist. May need to add entry to file 200 for 'REMOTE,PHARMACIST' or 'PHARMACIST,REMOTE'
"RTN","PSORRPA1",75,0)
 S FDA(52.2,PFIENS,.05)=PSOPHDUZ
"RTN","PSORRPA1",76,0)
 ; can we use DUZ as the clerk code, or will this need another value??
"RTN","PSORRPA1",77,0)
 S FDA(52.2,PFIENS,.07)=PSOPHDUZ
"RTN","PSORRPA1",78,0)
 S FDA(52.2,PFIENS,6)=PHYS
"RTN","PSORRPA1",79,0)
 S FDA(52.2,PFIENS,.08)=$$NOW^XLFDT
"RTN","PSORRPA1",80,0)
 S FDA(52.2,PFIENS,.09)=PSOSITE
"RTN","PSORRPA1",81,0)
 S FDA(52.2,PFIENS,.03)=REMARKS
"RTN","PSORRPA1",82,0)
 ;
"RTN","PSORRPA1",83,0)
 ; setting the partial fill date to the dispense date to match the 
"RTN","PSORRPA1",84,0)
 ; HL7 response
"RTN","PSORRPA1",85,0)
 S FDA(52.2,PFIENS,7.5)=PFDATE
"RTN","PSORRPA1",86,0)
 ;
"RTN","PSORRPA1",87,0)
 S RXPR(RRXIEN)=PFIEN,PSOZZ=1,PRMK=REMARKS
"RTN","PSORRPA1",88,0)
 ; file the rest of the data onto the newly created multiple.
"RTN","PSORRPA1",89,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSORRPA1",90,0)
 I Z1,$G(PRMK)]"" D  D:$T(EN^PSOHDR)]"" EN^PSOHDR("PPAR",RXN) K DIE,RXN,RXF
"RTN","PSORRPA1",91,0)
 .D ACT
"RTN","PSORRPA1",92,0)
 .S ZD(RXN)=+^PSRX(RXN,"P",Z1,0),^PSRX(RXN,"TYPE")=Z1,$P(^PSRX(RXN,"P",Z1,0),"^",11)=$P($G(^PSDRUG(DRG,660)),"^",6)
"RTN","PSORRPA1",93,0)
 S:'$D(PSOFROM) PSOFROM="PARTIAL" S BINGCRT=1 ;D:$D(BINGRTE)&($D(DISGROUP)) ^PSOBING1 K BINGRTE,TM,TM1
"RTN","PSORRPA1",94,0)
 ; bwf 8/14/14 - set up needed variables for label printing
"RTN","PSORRPA1",95,0)
 S PSODFN=$P(^PSRX(RRXIEN,0),U,2)
"RTN","PSORRPA1",96,0)
 S PSORX("PSOL",1)=RRXIEN_","
"RTN","PSORRPA1",97,0)
 S PSORX("MAIL/WINDOW")="WINDOW"
"RTN","PSORRPA1",98,0)
 S PSORX("NAME")=$$GET1^DIQ(2,PSODFN,.01)
"RTN","PSORRPA1",99,0)
 S PSORX("QFLG")=0
"RTN","PSORRPA1",100,0)
 S PSORX("METHOD OF PICKUP")=""
"RTN","PSORRPA1",101,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORRPA1",102,0)
 N PPL1
"RTN","PSORRPA1",103,0)
 S PPL1=RRXIEN
"RTN","PSORRPA1",104,0)
 S HFSDONE=0,PTHDAT=""
"RTN","PSORRPA1",105,0)
 S PSODFDIR=$$DEFDIR^%ZISH()
"RTN","PSORRPA1",106,0)
 S PSOFNAME="PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT"
"RTN","PSORRPA1",107,0)
 S FULLPTH=PSODFDIR_PSOFNAME
"RTN","PSORRPA1",108,0)
 ; bwf 8/14/14 - end setup for label printing.
"RTN","PSORRPA1",109,0)
 ; preserve IO
"RTN","PSORRPA1",110,0)
 D SAVDEV^%ZISUTL("ONEVAHLIO")
"RTN","PSORRPA1",111,0)
 ; delete the file first to ensure there isn't one lingering around
"RTN","PSORRPA1",112,0)
 S DELARR("PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT")="" S DEL=$$DEL^%ZISH(PSODFDIR,$NA(DELARR))
"RTN","PSORRPA1",113,0)
 S PSOEXREP=1
"RTN","PSORRPA1",114,0)
 ; call out to generate label
"RTN","PSORRPA1",115,0)
 D LABEL^PSORWRAP(RRXIEN,"HFS",PSOSITE,PSOPHDUZ,"",PSOFNAME)
"RTN","PSORRPA1",116,0)
 S XTMPLOC="^XTMP(""PSORLBL"","_HLINSTN_","_RXNUM_",1,0)"
"RTN","PSORRPA1",117,0)
 S PASSLOC="XTMP(""PSORLBL"","_HLINSTN_","_RXNUM_")"
"RTN","PSORRPA1",118,0)
 K ^XTMP("PSORLBL",HLINSTN,RXNUM)
"RTN","PSORRPA1",119,0)
 S ^XTMP("PSORLBL",HLINSTN,RXNUM,0)=DT_U_$$FMADD^XLFDT(DT,30)
"RTN","PSORRPA1",120,0)
 ; looks like we have to wait a moment before the file shows up.
"RTN","PSORRPA1",121,0)
 S FTGSTRT=$$NOW^XLFDT,(FOUND,FTGOPEN)=0
"RTN","PSORRPA1",122,0)
 N PAR S PAR=0
"RTN","PSORRPA1",123,0)
 F  D  Q:$$NOW^XLFDT>$$FMADD^XLFDT(FTGSTRT,,,,15)!(FOUND)!(FTGOPEN)
"RTN","PSORRPA1",124,0)
 .S FTGOPEN=$$FTG^%ZISH(PSODFDIR,PSOFNAME,XTMPLOC,4)
"RTN","PSORRPA1",125,0)
 .I $O(^XTMP("PSORLBL",HLINSTN,RXNUM,0)) S FOUND=1
"RTN","PSORRPA1",126,0)
 S DELARR("PSOLBL_"_RXNUM_"_"_PSOSITE_"_"_DT_".DAT")="" S DEL=$$DEL^%ZISH(PSODFDIR,$NA(DELARR))
"RTN","PSORRPA1",127,0)
 ; restore IO
"RTN","PSORRPA1",128,0)
 D USE^%ZISUTL("ONEVAHLIO"),RMDEV^%ZISUTL("ONEVAHLIO")
"RTN","PSORRPA1",129,0)
 D UPDPAR(.VALMSG,RRXIEN,PHARM,PHONE,SITE,PASSLOC)
"RTN","PSORRPA1",130,0)
 S RX0=$G(^PSRX(RRXIEN,0)),RX2=$G(^PSRX(RRXIEN,2)),RX3=$G(^PSRX(RRXIEN,3))
"RTN","PSORRPA1",131,0)
 S RXSTA=$G(^PSRX(RRXIEN,"STA")),RPROV=$$GET1^DIQ(200,$P(RX0,U,4),.01,"E")_U_$$GET1^DIQ(200,$P(RX0,U,16),.01,"E")
"RTN","PSORRPA1",132,0)
 S RSIG=$G(^PSRX(RRXIEN,"SIG"))
"RTN","PSORRPA1",133,0)
 S RPAR0=$G(^PSRX(RRXIEN,"P",PFIEN,0))
"RTN","PSORRPA1",134,0)
 S ROR1=$G(^PSRX(RRXIEN,"OR1"))
"RTN","PSORRPA1",135,0)
 S RREFIEN=$O(^PSRX(RRXIEN,1,"A"),-1)
"RTN","PSORRPA1",136,0)
 I RREFIEN S RREF0=$G(^PSRX(RRXIEN,1,RREFIEN,0))
"RTN","PSORRPA1",137,0)
CLCX D ULK K DR,DIE,DRG,PPL,RXP,IOP,DA,PHYS,PSOPRZ,PSORX,PSOSIEN,PSOSITE,PSOX,PSOZZ,PSXSYS,RXPR Q
"RTN","PSORRPA1",138,0)
 ;
"RTN","PSORRPA1",139,0)
KILL S DA=Z1,DIK="^PSRX("_RXN_",""P""," D ^DIK S ^PSRX(RXN,"TYPE")=0
"RTN","PSORRPA1",140,0)
 D ULK S VALMSG(1)="No Partial Fill Dispensed" D PARFAIL(.VALMSG,RRXIEN,PHARM,PHONE,SITE) Q
"RTN","PSORRPA1",141,0)
KL K DFN,RFDAT,RLL,%,PRMK,PM,%Y,%X,D0,D1,DA,DI,DIC,DIE,DLAYGO,DQ,DR,I,II,J,JJJ,N,PHYS,PS,PSDATE,RFL,RFL1,RXF,ST,ST0,Z,Z1,X,Y,PDT,PSL,PSNP
"RTN","PSORRPA1",142,0)
 K PSOM,PSOP,PSOD,PSOU,DIK,DUOUT,IFN,RXN,DRG,HRX,I1,PSOCLC,PSOLIST,PSOLST,PSPAR,RXP D KVA^VADPT Q
"RTN","PSORRPA1",143,0)
ACT ;adds activity info for partial rx
"RTN","PSORRPA1",144,0)
 S RXF=0 F I=0:0 S I=$O(^PSRX(RRXIEN,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORRPA1",145,0)
 S DA=0 F FDA=0:0 S FDA=$O(^PSRX(RRXIEN,"A",FDA)) Q:'FDA  S DA=FDA
"RTN","PSORRPA1",146,0)
 S DA=DA+1,^PSRX(RRXIEN,"A",0)="^52.3DA^"_DA_"^"_DA,^PSRX(RRXIEN,"A",DA,0)=DT_"^"_"P"_"^"_PSOPHDUZ_"^"_RXF_"^"_PRMK
"RTN","PSORRPA1",147,0)
EX K RXF,I,FDA S DA=RXN
"RTN","PSORRPA1",148,0)
 Q
"RTN","PSORRPA1",149,0)
ULK ;
"RTN","PSORRPA1",150,0)
 K PSOMSG,PSOPLCK,PSORPDFN
"RTN","PSORRPA1",151,0)
 Q
"RTN","PSORRPA1",152,0)
PARFAIL(PSOMSG,PSOIEN,RPHARM,RPHONE,RSITE) ;
"RTN","PSORRPA1",153,0)
 S PSOMSG(0)=0_U_$$GET1^DIQ(52,PSOIEN,.01,"I")_U_PSOIEN,$P(PSOMSG(0),U,15)=RPHARM,$P(PSOMSG(0),U,16)=RPHONE,$P(PSOMSG(0),U,17)=RSITE
"RTN","PSORRPA1",154,0)
 Q
"RTN","PSORRPA1",155,0)
UPDPAR(PSOMSG,PSOIEN,RPHARM,RPHONE,RSITE,PASSLOC) ;
"RTN","PSORRPA1",156,0)
 N PARIEN,PARIENS,PARDATA,FIL,RXNUM,RFILLDT,QTY,DSUPP,CLERK,LOGDATE,IDIV,EDIV,DISPDT,NDC,FDA,DNAME,DIEN
"RTN","PSORRPA1",157,0)
 S FIL=52.2
"RTN","PSORRPA1",158,0)
 ; get last partial data node
"RTN","PSORRPA1",159,0)
 S PARIEN=$O(^PSRX(PSOIEN,"P",""),-1)
"RTN","PSORRPA1",160,0)
 S RXNUM=$$GET1^DIQ(52,PSOIEN,.01,"E")
"RTN","PSORRPA1",161,0)
 S DNAME=$$GET1^DIQ(52,PSOIEN,6,"E")
"RTN","PSORRPA1",162,0)
 S DIEN=$$GET1^DIQ(52,PSOIEN,6,"I")
"RTN","PSORRPA1",163,0)
 S PARIENS=PARIEN_","_PSOIEN_","
"RTN","PSORRPA1",164,0)
 ; first, set in the remote pharmacist data
"RTN","PSORRPA1",165,0)
 S FDA(52.2,PARIENS,91)=RSITE
"RTN","PSORRPA1",166,0)
 S FDA(52.2,PARIENS,92)=RPHARM
"RTN","PSORRPA1",167,0)
 S FDA(52.2,PARIENS,93)=RPHONE
"RTN","PSORRPA1",168,0)
 D FILE^DIE(,"FDA","MSG") K FDA,RPHARM,RPHONE,RSITE
"RTN","PSORRPA1",169,0)
 ; now query data and build RET(0) holding accurate information from the refill multiple
"RTN","PSORRPA1",170,0)
 D GETS^DIQ(FIL,PARIENS,"**","IE","PARDATA")
"RTN","PSORRPA1",171,0)
 S RFILLDT=$G(PARDATA(FIL,PARIENS,.01,"I"))
"RTN","PSORRPA1",172,0)
 S QTY=$G(PARDATA(FIL,PARIENS,.04,"I"))
"RTN","PSORRPA1",173,0)
 S DSUPP=$G(PARDATA(FIL,PARIENS,.041,"I"))
"RTN","PSORRPA1",174,0)
 S CLERK=$G(PARDATA(FIL,PARIENS,.07,"E"))
"RTN","PSORRPA1",175,0)
 S LOGDATE=$G(PARDATA(FIL,PARIENS,.08,"I"))
"RTN","PSORRPA1",176,0)
 ; internal division number (IEN to PSO SITE file)
"RTN","PSORRPA1",177,0)
 S IDIV=$G(PARDATA(FIL,PARIENS,.09,"I"))
"RTN","PSORRPA1",178,0)
 S EDIV=$G(PARDATA(FIL,PARIENS,.09,"E"))
"RTN","PSORRPA1",179,0)
 ;
"RTN","PSORRPA1",180,0)
 ; there is nothing in this field.
"RTN","PSORRPA1",181,0)
 ; HL7 is returning refill date in the RXD
"RTN","PSORRPA1",182,0)
 ; but trying to log the blank dispense date from file 52.2 into 52.09
"RTN","PSORRPA1",183,0)
 S DISPDT=$G(PARDATA(FIL,PARIENS,7.5,"I"))
"RTN","PSORRPA1",184,0)
 ;
"RTN","PSORRPA1",185,0)
 S NDC=$G(PARDATA(FIL,PARIENS,1,"E"))
"RTN","PSORRPA1",186,0)
 S RSITE=$G(PARDATA(FIL,PARIENS,91,"I"))
"RTN","PSORRPA1",187,0)
 S RPHARM=$G(PARDATA(FIL,PARIENS,92,"E"))
"RTN","PSORRPA1",188,0)
 S RPHONE=$G(PARDATA(FIL,PARIENS,93,"E"))
"RTN","PSORRPA1",189,0)
 S $P(DAT(1),U,3)=RXNUM,$P(DAT(1),U,4)=RSITE,$P(DAT(1),U,7)=QTY,$P(DAT(1),U,8)=DISPDT,$P(DAT(1),U,9)=DNAME,$P(DAT(1),U,10)=DSUPP,$P(DAT(1),U,11)=RPHARM,$P(DAT(1),U,12)=RFILLDT
"RTN","PSORRPA1",190,0)
 D LOGDATA^PSORWRAP($NA(DAT),"OP",,,PSOIEN)
"RTN","PSORRPA1",191,0)
 S PSOMSG(0)=1_U_RXNUM_U_PSOIEN_U_PARIEN_U_RFILLDT_U_DNAME_U_QTY_U_DSUPP_U_CLERK_U_LOGDATE_U_IDIV_U_EDIV_U_DISPDT_U_NDC_U_RPHARM_U_RPHONE_U_RSITE_U_PASSLOC
"RTN","PSORRPA1",192,0)
 I '$L($G(PSOMSG(1))) S PSOMSG(1)="Partial complete for RX #"_RXNUM_"."
"RTN","PSORRPA1",193,0)
 Q
"RTN","PSORRX1")
0^1^B139750868^n/a
"RTN","PSORRX1",1,0)
PSORRX1 ;AITC/BWF - Remote RX driver ;8/30/16 12:00am
"RTN","PSORRX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORRX1",3,0)
 ;
"RTN","PSORRX1",4,0)
 Q
"RTN","PSORRX1",5,0)
 ;
"RTN","PSORRX1",6,0)
REMOTERX(DFN,PSOSITE) ;
"RTN","PSORRX1",7,0)
 N RXRES,MSG,HLARR,CNT,RXDAT,HLARR,HLPROT,DONE,ORFS,ORCS,ORRS,ORES,ORSS,ORQUIT,HLQUIT,HLDAT,TFLIST,HLP,HLNODE,HLNEXT,HLINSTN
"RTN","PSORRX1",8,0)
 N PID1,PID4,PID5,PID6,TFDAT,LOOP,RXMSG,PSORRDAT,PSOHCNT,ERR,HL,PSORRDAT,ORERR,SITE
"RTN","PSORRX1",9,0)
 S HLARR=$NA(^TMP("HLS",$J)) K @HLARR
"RTN","PSORRX1",10,0)
 S HLDAT=$NA(^XTMP("PSORRX1",$J)) K @HLDAT
"RTN","PSORRX1",11,0)
 ; moved to PSORX1
"RTN","PSORRX1",12,0)
 ;I '$$GET1^DIQ(59,PSOSITE,3001,"I") D  Q
"RTN","PSORRX1",13,0)
 ;.W !!,"The OneVA Pharmacy flag is turned off. Queries will NOT"
"RTN","PSORRX1",14,0)
 ;.W !,"be made to other VA Pharmacy locations.",!
"RTN","PSORRX1",15,0)
 ; possibly add error message to be returned if no DFN.
"RTN","PSORRX1",16,0)
 I 'DFN Q
"RTN","PSORRX1",17,0)
 S SITE=$P($$SITE^VASITE(),U)
"RTN","PSORRX1",18,0)
 S TFSTRING=$$GET1^DIQ(2,DFN,991.01,"I")_"^^^USVHA^NI^"_SITE
"RTN","PSORRX1",19,0)
 S HLPROT="PSO REMOTE RX QBP-Q13 EVENT"
"RTN","PSORRX1",20,0)
 D INIT^HLFNC2(HLPROT,.HL)
"RTN","PSORRX1",21,0)
 D BLDPID^PSOTPHL2(DFN,"",.PSORRDAT,.HL,.ERR)
"RTN","PSORRX1",22,0)
 I $D(ERR) W !,"There was a problem creating the PID segment for this patient.",!,"Please contact technical support.",!
"RTN","PSORRX1",23,0)
 S @HLARR@(1)="QPD^Q13~Active Prescriptions~HL70471^"
"RTN","PSORRX1",24,0)
 S DONE=0
"RTN","PSORRX1",25,0)
 F PSOHCNT=1:1 D  Q:DONE
"RTN","PSORRX1",26,0)
 .I '$D(PSORRDAT(PSOHCNT)) S DONE=1 Q
"RTN","PSORRX1",27,0)
 .S @HLARR@(2)=$G(@HLARR@(2))_PSORRDAT(PSOHCNT)
"RTN","PSORRX1",28,0)
 S @HLARR@(3)="RCP^I"
"RTN","PSORRX1",29,0)
 S HLP("SUBSCRIBER")="^^^^200HD~HDR.DOMAIN.EXT~DNS"
"RTN","PSORRX1",30,0)
 D DIRECT^HLMA(HLPROT,"GM",1,.RXDAT,"",.HLP)
"RTN","PSORRX1",31,0)
 S ORFS=$G(HL("FS")),ORCS=$E($G(HL("ECH")),1),ORRS=$E($G(HL("ECH")),2),ORES=$E($G(HL("ECH")),3),ORSS=$E($G(HL("ECH")),4)
"RTN","PSORRX1",32,0)
 S HLQUIT=0,ORQUIT="",ORERR=""
"RTN","PSORRX1",33,0)
 I $P(RXDAT,U,3)="No response"!($P(RXDAT,U,3)="Connection Failed") D  Q
"RTN","PSORRX1",34,0)
 .W !,"The system is down or not responding.",!,"Could not query prescriptions at other VA Pharmacy locations.",!
"RTN","PSORRX1",35,0)
 .K DIR S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","PSORRX1",36,0)
 F  X HLNEXT Q:HLQUIT'>0!(ORQUIT'="")  D
"RTN","PSORRX1",37,0)
 .N LOOP
"RTN","PSORRX1",38,0)
 .S LOOP=0 F  S LOOP=$O(HLNODE(LOOP)) Q:LOOP=""  S HLNODE=HLNODE_HLNODE(LOOP)
"RTN","PSORRX1",39,0)
 .I $E(HLNODE,1,3)="MSA"&(($P(HLNODE,ORFS,2)'="CA")) D LOGERR(DFN,.HLNODE,.HLDAT,$P(HLNODE,ORFS,4)) S ORQUIT=$P(HLNODE,ORFS,4)
"RTN","PSORRX1",40,0)
 .I $E(HLNODE,1,3)="ERR" D LOGERR(DFN,.HLNODE,.HLDAT) S ORQUIT=$P(HLNODE,ORFS,4)
"RTN","PSORRX1",41,0)
 .I $E(HLNODE,1,3)="RDT" D
"RTN","PSORRX1",42,0)
 ..S @HLDAT@(0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","PSORRX1",43,0)
 ..D RXPRSE(DFN,.HLNODE,.HLDAT)
"RTN","PSORRX1",44,0)
 Q
"RTN","PSORRX1",45,0)
LOGERR(DFN,DATA,HLDAT,NMSG) ;
"RTN","PSORRX1",46,0)
 N HLERR
"RTN","PSORRX1",47,0)
 S NMSG=$G(NMSG,"")
"RTN","PSORRX1",48,0)
 S HLERR=$S(NMSG'="":NMSG,1:$P(DATA,ORFS,9))
"RTN","PSORRX1",49,0)
 S:'$D(@HLDAT@(0)) @HLDAT@(0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","PSORRX1",50,0)
 S @HLDAT@(DFN,"ERR")="<"_HLERR_">"
"RTN","PSORRX1",51,0)
 W !!,"When trying to query prescriptions at other VA Pharmacy",!,"Locations the following message was encountered:",!,"***",!,HLERR,!,"***",! K DIR S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",52,0)
 Q
"RTN","PSORRX1",53,0)
 ; parse rx data from RDF segment
"RTN","PSORRX1",54,0)
RXPRSE(DFN,DATA,HLDAT) ;
"RTN","PSORRX1",55,0)
 ;RDF|14|Site Number~Rx Number~Drug Name~Quantity~Refills~Days Supply~Expiration Date
"RTN","PSORRX1",56,0)
 ;~Issue Date~Stop Date~Last Fill Date~Sig~Detail~Status~VA Product ID
"RTN","PSORRX1",57,0)
 N RXSITE,RXNUM,DNAME,QTY,REFILLS,DSUPP,EXPDT,ISSDATE,STOPDT,LFDT,SIG,DETAIL,STAT,STATNM,STATERR,DDONE,I,VAPID,VAFQDN,DAT
"RTN","PSORRX1",58,0)
 ; put data into one variable. This handles overflow nodes
"RTN","PSORRX1",59,0)
 S DAT=0 F  S DAT=$O(DATA(DAT)) Q:'DAT  D
"RTN","PSORRX1",60,0)
 .S DATA=$G(DATA)_$G(DATA(DAT))
"RTN","PSORRX1",61,0)
 S RXSITE=$P(DATA,ORFS,2),RXNUM=$P(DATA,ORFS,3),DNAME=$P(DATA,ORFS,4),QTY=$P(DATA,ORFS,5)
"RTN","PSORRX1",62,0)
 Q:DNAME=""
"RTN","PSORRX1",63,0)
 S REFILLS=$P(DATA,ORFS,6),DSUPP=$P(DATA,ORFS,7),EXPDT=$P(DATA,ORFS,8),ISSDATE=$P(DATA,ORFS,9)
"RTN","PSORRX1",64,0)
 S STOPDT=$P(DATA,ORFS,10),LFDT=$P(DATA,ORFS,11),SIG=$P(DATA,ORFS,12),DETAIL=$P(DATA,ORFS,13)
"RTN","PSORRX1",65,0)
 S STAT=$P(DATA,ORFS,14) Q:STAT=""
"RTN","PSORRX1",66,0)
 ; VA Product ID
"RTN","PSORRX1",67,0)
 S VAPID=$P(DATA,ORFS,15)
"RTN","PSORRX1",68,0)
 S VAFQDN=$P(DATA,ORFS,16)
"RTN","PSORRX1",69,0)
 Q:STAT=""
"RTN","PSORRX1",70,0)
 Q:'RXSITE!('RXNUM)
"RTN","PSORRX1",71,0)
 S @HLDAT@(DFN,RXSITE,STAT,DNAME,0)=RXNUM_U_QTY_U_REFILLS_U_DSUPP_U_EXPDT_U_ISSDATE_U_STOPDT_U_LFDT_U_STAT_U_VAPID_U_DNAME_U_VAFQDN
"RTN","PSORRX1",72,0)
 S @HLDAT@(DFN,RXSITE,STAT,DNAME,"SIG")=SIG
"RTN","PSORRX1",73,0)
 S @HLDAT@(DFN,RXSITE,STAT,DNAME,"DETAIL")=DETAIL
"RTN","PSORRX1",74,0)
 Q
"RTN","PSORRX1",75,0)
 ; build and send refill request
"RTN","PSORRX1",76,0)
REFREQ ;
"RTN","PSORRX1",77,0)
 N PHARM,PHONE,LOCSITE,DSUPP,MW,FILLDT,MSG,RXNUM,HLSTR,REMSITE,PHARMLN,PHARMFN,PHARMMI,TFSTRING,HLPROT,LOCDRUG,REMDRUG,DINACT
"RTN","PSORRX1",78,0)
 N ORFS,ORCS,ORRS,ORES,ORSS,HLQUIT,ORQUIT,RESP,RETDFN,VAPID,DONE,PSORRDAT,PSOHCNT,DONE,HL,CSVAL,DIR,REMSIEN,PSOHLNK,PSOLNKDN,DOMOVR,RMSDOM
"RTN","PSORRX1",79,0)
 S HLARR=$NA(^TMP("HLS",$J)) K @HLARR
"RTN","PSORRX1",80,0)
 S HLDAT=$NA(^XTMP("REFREQ^PSORRX1",$J)) K @HLDAT
"RTN","PSORRX1",81,0)
 S HLPROT="PSO REMOTE RX RDS-O13 EVENT"
"RTN","PSORRX1",82,0)
 S MW="W"
"RTN","PSORRX1",83,0)
 D FULL^VALM1
"RTN","PSORRX1",84,0)
 S LOCSITE=$$STA^XUAF4(DUZ(2))
"RTN","PSORRX1",85,0)
 S PHARM=$$GET1^DIQ(200,DUZ,.01,"E"),PHARMLN=$P(PHARM,","),PHARMFN=$P($P(PHARM,",",2)," "),PHARMMI=$P($P(PHARM,",",2)," ",2)
"RTN","PSORRX1",86,0)
 S PHONE=$$GET1^DIQ(200,DUZ,.132,"E")
"RTN","PSORRX1",87,0)
 S RXNUM=$P(PSOLST(ORN),U,2) I 'RXNUM S MSG(1)="Invalid Rx #. Please contact technical support." Q
"RTN","PSORRX1",88,0)
 I SRXSTAT'="ACTIVE" W !!,"Only 'ACTIVE' remote prescriptions may be refilled at this time." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",89,0)
 S REMSITE=$P(PSOLST(ORN),U,4)   ;,REMSIEN=$O(^DIC(4,"D",REMSITE,0))
"RTN","PSORRX1",90,0)
 S REMSIEN=$$FIND1^DIC(4,,"X",REMSITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)") Q:'REMSIEN
"RTN","PSORRX1",91,0)
 S PSOREF("DFLG")=""
"RTN","PSORRX1",92,0)
 S REMDRUG=$P(REMDATA,U,11),VAPID=$P(REMDATA,U,10)
"RTN","PSORRX1",93,0)
 I '$L(VAPID) W !!,"Missing VA Product ID. Rx# ",RXNUM," cannot be refilled." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",94,0)
 S LOCDRUG=$$DRUGMTCH(REMDRUG,VAPID)
"RTN","PSORRX1",95,0)
 I $G(LOCDRUG)=-1 Q  ; user entered no so no reason to prompt again
"RTN","PSORRX1",96,0)
 I '$G(LOCDRUG) W !!,"Could not match remote drug to a local drug. Cannot refill Rx# ",RXNUM,"." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",97,0)
 S DINACT=$$GET1^DIQ(50,LOCDRUG,100,"I")
"RTN","PSORRX1",98,0)
 I DINACT>0,DINACT<$$NOW^XLFDT W !!,"Matched Drug "_$$GET1^DIQ(50,LOCDRUG,.01,"E")_" is inactive.",!,"Cannot refill."  S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",99,0)
 ; ****** controlled substance check
"RTN","PSORRX1",100,0)
 S CSVAL=$$GET1^DIQ(50,LOCDRUG,3,"E"),CSVAL=$E(CSVAL,1)
"RTN","PSORRX1",101,0)
 I CSVAL,CSVAL>0,CSVAL<6 W !!,"This is a controlled substance. Cannot refill Rx#",RXNUM,"." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",102,0)
 ;
"RTN","PSORRX1",103,0)
 ; if we got this far, fill is most likely happening and remote
"RTN","PSORRX1",104,0)
 ; worklist needs to be rebuilt when returning so set flag. PSORRBLD
"RTN","PSORRX1",105,0)
 ; was New'ed in calling routine. May change my mind if we get an
"RTN","PSORRX1",106,0)
 ; error from host.
"RTN","PSORRX1",107,0)
 S PSORRBLD=1
"RTN","PSORRX1",108,0)
 ;
"RTN","PSORRX1",109,0)
 S (FILLDT,PSOREF("FILL DATE"))=DT
"RTN","PSORRX1",110,0)
 D INIT^HLFNC2(HLPROT,.HL)
"RTN","PSORRX1",111,0)
 D BLDPID^PSOTPHL2(DFN,"",.PSORRDAT,.HL,.ERR)
"RTN","PSORRX1",112,0)
 S DONE=0
"RTN","PSORRX1",113,0)
 F PSOHCNT=1:1 D  Q:DONE
"RTN","PSORRX1",114,0)
 .I '$D(PSORRDAT(PSOHCNT)) S DONE=1 Q
"RTN","PSORRX1",115,0)
 .S @HLARR@(1)=$G(@HLARR@(1))_PSORRDAT(PSOHCNT)
"RTN","PSORRX1",116,0)
 ;S @HLARR@(2)="ORC^RF^"_RXNUM_"~"_REMSITE_"~"_$$GET1^DIQ(4,REMSIEN,60,"E")_"^^^^^^^"_FILLDT_U_DUZ_"~"_PHARMLN_"~"_PHARMFN_"~"_PHARMMI_"^^^~~~"_LOCSITE_U_PHONE
"RTN","PSORRX1",117,0)
 S @HLARR@(2)="ORC^RF^"_RXNUM_"~"_REMSITE_"~"_$$FQDN^PSORWRAP(,REMSIEN)_"^^^^^^^"_FILLDT_U_DUZ_"~"_PHARMLN_"~"_PHARMFN_"~"_PHARMMI_"^^^~~~"_LOCSITE_U_PHONE
"RTN","PSORRX1",118,0)
 S @HLARR@(3)="RXO^^^^^^^^"_MW_"~~~"_LOCSITE
"RTN","PSORRX1",119,0)
 W !!,"Processing refill request. Please be patient as it may take a moment"
"RTN","PSORRX1",120,0)
 W !,"for the host site to respond and generate your label data..."
"RTN","PSORRX1",121,0)
 ;S PSOHLNK=$O(^HLCS(870,"C",REMSIEN,0))
"RTN","PSORRX1",122,0)
 ;S PSOLNKNM=$$GET1^DIQ(870,PSOHLNK,.01,"E")
"RTN","PSORRX1",123,0)
 ;S RMSDOM=$$GET1^DIQ(870,PSOHLNK,.03,"E")  ; get domain name
"RTN","PSORRX1",124,0)
 ;S RMSDOM=$$GET1^DIQ(4,REMSIEN,60,"E")
"RTN","PSORRX1",125,0)
 ;S:$$PROD^XUPROD() RMSDOM="HL7."_RMSDOM   ; prefix domain name
"RTN","PSORRX1",126,0)
 S RMSDOM=$$FQDN^PSORWRAP(,REMSIEN)
"RTN","PSORRX1",127,0)
 S DOMOVR=REMSITE_"~"_RMSDOM_"~DNS"
"RTN","PSORRX1",128,0)
 S HLP("SUBSCRIBER")="^^^^"_DOMOVR
"RTN","PSORRX1",129,0)
 D DIRECT^HLMA(HLPROT,"GM",1,.RESP,"",.HLP)
"RTN","PSORRX1",130,0)
 D READMSG^PSORRX2(.HLDAT,"RF",LOCDRUG)
"RTN","PSORRX1",131,0)
 K @HLDAT,@HLARR
"RTN","PSORRX1",132,0)
 Q
"RTN","PSORRX1",133,0)
 ; build and send partial fill request
"RTN","PSORRX1",134,0)
PARTIAL() ;
"RTN","PSORRX1",135,0)
 N DIR,DONE,I,PRMPDAT,VAR,PRXNUM,PHARM,PHARMLN,PHARMFN,PHARMMI,PHONE,RXNUM,HLPROT,TFSTRING,HLARR,PHONE,REMSITE,HLDAT,LOCDRUG,EXIT,VAPID,HL,ERR
"RTN","PSORRX1",136,0)
 N PSOHCNT,DONE,PSORRDAT,CSVAL,REMSIEN,PSOHLNK,PSOLNKDN,REMDRUG,Y,DINACT,EXE,DOMOVR,RMSDOM
"RTN","PSORRX1",137,0)
 S HLPROT="PSO REMOTE RX RDS-O13 EVENT"
"RTN","PSORRX1",138,0)
 S HLDAT=$NA(^XTMP("PARTIAL^PSORRX1",$J)) K @HLDAT
"RTN","PSORRX1",139,0)
 S HLARR=$NA(^TMP("HLS",$J)) K @HLARR
"RTN","PSORRX1",140,0)
 D FULL^VALM1
"RTN","PSORRX1",141,0)
 I SRXSTAT'="ACTIVE" W !!,"Only 'ACTIVE' remote prescriptions may be actioned at this time." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",142,0)
 S LOCSITE=$$STA^XUAF4(DUZ(2))
"RTN","PSORRX1",143,0)
 S PHONE=$$GET1^DIQ(200,DUZ,.132,"E")
"RTN","PSORRX1",144,0)
 S PRXNUM=$P(PSOLST(ORN),U,2) I 'PRXNUM S MSG(1)="Invalid Rx #. Please contact technical support." Q
"RTN","PSORRX1",145,0)
 S REMSITE=$P(PSOLST(ORN),U,4)
"RTN","PSORRX1",146,0)
 S REMSIEN=$$FIND1^DIC(4,,"X",REMSITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)") Q:'REMSIEN
"RTN","PSORRX1",147,0)
 S DONE=0,CNT=1
"RTN","PSORRX1",148,0)
 ; prompt for fields that would normally be prompted for a local partial fill.
"RTN","PSORRX1",149,0)
 D FULL^VALM1
"RTN","PSORRX1",150,0)
 S REMDRUG=$P(REMDATA,U,11),VAPID=$P(REMDATA,U,10)
"RTN","PSORRX1",151,0)
 I '$L(VAPID) W !!,"Missing VA Product ID. Rx# ",PRXNUM," cannot be refilled." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",152,0)
 S LOCDRUG=$$DRUGMTCH(REMDRUG,VAPID)
"RTN","PSORRX1",153,0)
 I $G(LOCDRUG)=-1 Q  ; user entered no so no reason to prompt again
"RTN","PSORRX1",154,0)
 I '$G(LOCDRUG) W !!,"Could not match remote drug to a local drug.",!,"Cannot complete partial fill for Rx# ",PRXNUM,"." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",155,0)
  S DINACT=$$GET1^DIQ(50,LOCDRUG,100,"I")
"RTN","PSORRX1",156,0)
 I DINACT>0,DINACT<$$NOW^XLFDT W !!,"Matched Drug "_$$GET1^DIQ(50,LOCDRUG,.01,"E")_" is inactive.",!,"Cannot create partial fill request."  S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",157,0)
 ; controlled substance check
"RTN","PSORRX1",158,0)
 S CSVAL=$$GET1^DIQ(50,LOCDRUG,3,"E"),CSVAL=$E(CSVAL,1)
"RTN","PSORRX1",159,0)
 I CSVAL,CSVAL>0,CSVAL<6 W !!,"This is a controlled substance. Cannot refill Rx#",PRXNUM,"." S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",160,0)
 S EXIT=0
"RTN","PSORRX1",161,0)
 S PDATE=DT
"RTN","PSORRX1",162,0)
 S MW="W"
"RTN","PSORRX1",163,0)
 F I=1:1 D  Q:DONE!(EXIT)
"RTN","PSORRX1",164,0)
 .S PRMPDAT=$T(PRMPTXT+I)
"RTN","PSORRX1",165,0)
 .S PRMPDAT=$P(PRMPDAT,";;",2)
"RTN","PSORRX1",166,0)
 .I PRMPDAT="Q" S DONE=1 Q
"RTN","PSORRX1",167,0)
 .K DIR
"RTN","PSORRX1",168,0)
 .S DIR(0)=$P(PRMPDAT,"|"),DIR("A")=$P(PRMPDAT,"|",2),VAR=$P(PRMPDAT,"|",4) S:$L($P(PRMPDAT,"|",3)) DIR("B")=$P(PRMPDAT,"|",3)
"RTN","PSORRX1",169,0)
 .I $G(DIR("B"))["~" D
"RTN","PSORRX1",170,0)
 ..S EXE=$TR(DIR("B"),"~","^") X EXE S DIR("B")=DEF
"RTN","PSORRX1",171,0)
 .D ^DIR
"RTN","PSORRX1",172,0)
 .I Y="^" S EXIT=1 Q
"RTN","PSORRX1",173,0)
 .S @VAR=$S(DIR(0)["P":$P(Y,U,2),1:Y)
"RTN","PSORRX1",174,0)
 K DEF
"RTN","PSORRX1",175,0)
 I EXIT W !,"Cancelling partial fill request.",! K DIR S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q
"RTN","PSORRX1",176,0)
 ; if we got this far, fill attempt happening and remote worklist
"RTN","PSORRX1",177,0)
 ; needs to be rebuilt when returning so set flag. PSORRBLD was New'ed
"RTN","PSORRX1",178,0)
 ; in calling routine.  May change my mind if we get an error from
"RTN","PSORRX1",179,0)
 ; host
"RTN","PSORRX1",180,0)
 S PSORRBLD=1
"RTN","PSORRX1",181,0)
 S PHARMLN=$P(PHARM,","),PHARMFN=$P($P(PHARM,",",2)," "),PHARMMI=$P($P(PHARM,",",2)," ",2)
"RTN","PSORRX1",182,0)
 D INIT^HLFNC2(HLPROT,.HL)
"RTN","PSORRX1",183,0)
 D BLDPID^PSOTPHL2(DFN,"",.PSORRDAT,.HL,.ERR)
"RTN","PSORRX1",184,0)
 S DONE=0
"RTN","PSORRX1",185,0)
 F PSOHCNT=1:1 D  Q:DONE
"RTN","PSORRX1",186,0)
 .I '$D(PSORRDAT(PSOHCNT)) S DONE=1 Q
"RTN","PSORRX1",187,0)
 .S @HLARR@(1)=$G(@HLARR@(1))_PSORRDAT(PSOHCNT)
"RTN","PSORRX1",188,0)
 ;S @HLARR@(2)="ORC^PF^"_PRXNUM_"~"_REMSITE_"~"_$$GET1^DIQ(4,REMSIEN,60,"E")_"^^^^^^^"_PDATE_"^"_DUZ_"~"_PHARMLN_"~"_PHARMFN_"~"_PHARMMI_"^^^~~~"_LOCSITE_U_PHONE
"RTN","PSORRX1",189,0)
 S @HLARR@(2)="ORC^PF^"_PRXNUM_"~"_REMSITE_"~"_$$FQDN^PSORWRAP(,REMSIEN)_"^^^^^^^"_PDATE_"^"_DUZ_"~"_PHARMLN_"~"_PHARMFN_"~"_PHARMMI_"^^^~~~"_LOCSITE_U_PHONE
"RTN","PSORRX1",190,0)
 S @HLARR@(3)="RXO^1^"_QTY_"^^^^^^"_MW_"~~~"_LOCSITE_"^^^"_DSUPP
"RTN","PSORRX1",191,0)
 S @HLARR@(4)="NTE^1^L^"_REMARKS
"RTN","PSORRX1",192,0)
 W !!,"Processing partial fill request. Please be patient as it may take a moment"
"RTN","PSORRX1",193,0)
 W !,"for the host site to respond and generate your label data...",!
"RTN","PSORRX1",194,0)
 ;S RMSDOM=$$GET1^DIQ(4,REMSIEN,60,"E")
"RTN","PSORRX1",195,0)
 ;S PSOHLNK=$O(^HLCS(870,"C",REMSIEN,0)) ; get first entry (should only be one but you never know)
"RTN","PSORRX1",196,0)
 ;S RMSDOM=$$GET1^DIQ(870,PSOHLNK,.03,"E")  ; get domain name
"RTN","PSORRX1",197,0)
 ;S:$$PROD^XUPROD() RMSDOM="HL7."_RMSDOM   ; prefix domain name
"RTN","PSORRX1",198,0)
 S RMSDOM=$$FQDN^PSORWRAP(,REMSIEN)
"RTN","PSORRX1",199,0)
 S DOMOVR=REMSITE_"~"_RMSDOM_"~DNS"
"RTN","PSORRX1",200,0)
 S HLP("SUBSCRIBER")="^^^^"_DOMOVR
"RTN","PSORRX1",201,0)
 D DIRECT^HLMA(HLPROT,"GM",1,.HL,"",.HLP)
"RTN","PSORRX1",202,0)
 I $P(HL,U,2) D  Q
"RTN","PSORRX1",203,0)
 . W !,"An error was encountered when trying to process the results",!,"from the refill/partial fill request.",!!,$P(HL,U,3)
"RTN","PSORRX1",204,0)
 . K DIR S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","PSORRX1",205,0)
 . D CL
"RTN","PSORRX1",206,0)
 ; clean up variables used
"RTN","PSORRX1",207,0)
 D READMSG^PSORRX2(.HLDAT,"PR",LOCDRUG)
"RTN","PSORRX1",208,0)
CL ;
"RTN","PSORRX1",209,0)
 K PDATE,QTY,DSUPP,PHARM,REMARKS,MW
"RTN","PSORRX1",210,0)
 K @HLDAT,@HLARR
"RTN","PSORRX1",211,0)
 Q
"RTN","PSORRX1",212,0)
 ;
"RTN","PSORRX1",213,0)
DRUGMTCH(DRGNM,VAPID) ;
"RTN","PSORRX1",214,0)
 ; returns -1 if a match was found but user said NO
"RTN","PSORRX1",215,0)
 N LDIEN,MATCH,EXIT,VAPIDSTR,DRL,VAPIEN,VAGENER,FOUND,CHECK,DIC,DRGARY,LDNAME,Y,DRGNM2,VAPSTR,MTCHSTR,DRLCNT
"RTN","PSORRX1",216,0)
 S CHECK=""
"RTN","PSORRX1",217,0)
 S VAPIEN=$O(^PSNDF(50.68,"C",VAPID,0))
"RTN","PSORRX1",218,0)
 I 'VAPIEN Q ""  ; ID from HDR not found - most likely CMOP ID/VA PID mismatch
"RTN","PSORRX1",219,0)
 S VAPSTR=$$GET1^DIQ(50.68,VAPIEN,2,"E")
"RTN","PSORRX1",220,0)
 S VAPIDSTR=$$GET1^DIQ(50.68,VAPIEN,.01,"E")
"RTN","PSORRX1",221,0)
 W !!,"Remote site drug name: "_DRGNM
"RTN","PSORRX1",222,0)
 I $D(^PSDRUG("B",DRGNM)) S LDIEN=$O(^PSDRUG("B",DRGNM,0))
"RTN","PSORRX1",223,0)
 I $D(LDIEN) D
"RTN","PSORRX1",224,0)
 .S LDNAME=$$GET1^DIQ(50,LDIEN,.01,"E")
"RTN","PSORRX1",225,0)
 .W !,"Matching Drug Found for Dispensing: "_LDNAME
"RTN","PSORRX1",226,0)
 .S CHECK=$$DIR
"RTN","PSORRX1",227,0)
 I $D(LDIEN),'CHECK Q -1  ; match was found but user said NO
"RTN","PSORRX1",228,0)
 I $D(LDIEN) Q LDIEN
"RTN","PSORRX1",229,0)
 S VAGENER=$$GET1^DIQ(50.68,VAPIEN,.05,"I")
"RTN","PSORRX1",230,0)
 ; loop through AND index to find drugs associated with this va generic product.
"RTN","PSORRX1",231,0)
 S FOUND=0
"RTN","PSORRX1",232,0)
 S (DRL,DRLCNT)=0 F  S DRL=$O(^PSDRUG("AND",VAGENER,DRL)) Q:'DRL!(FOUND)  D
"RTN","PSORRX1",233,0)
 .S MTCHSTR=$$GET1^DIQ(50,DRL,901,"E")
"RTN","PSORRX1",234,0)
 .I VAPSTR]"" Q:MTCHSTR'=VAPSTR
"RTN","PSORRX1",235,0)
 .S DRGARY(DRL)="",DRLCNT=DRLCNT+1
"RTN","PSORRX1",236,0)
 ; only one match found.
"RTN","PSORRX1",237,0)
 I DRLCNT=1 S LDIEN=$O(DRGARY(0))
"RTN","PSORRX1",238,0)
 I 'DRLCNT W !!,"No local match could be found for "_DRGNM_".",! K DIR S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR Q -1
"RTN","PSORRX1",239,0)
 I $D(LDIEN) D
"RTN","PSORRX1",240,0)
 .S LDNAME=$$GET1^DIQ(50,LDIEN,.01,"E")
"RTN","PSORRX1",241,0)
 .W !,"Matching Drug Found for Dispensing: "_LDNAME
"RTN","PSORRX1",242,0)
 .S CHECK=$$DIR()
"RTN","PSORRX1",243,0)
 I $D(LDIEN),'CHECK Q -1  ; match was found but user said NO
"RTN","PSORRX1",244,0)
 I $D(LDIEN) Q LDIEN
"RTN","PSORRX1",245,0)
 ; list the items that match strength
"RTN","PSORRX1",246,0)
 S (MATCH,EXIT)=0
"RTN","PSORRX1",247,0)
 F  D  Q:MATCH!(EXIT)
"RTN","PSORRX1",248,0)
 .S DIC=50,DIC(0)="AEQMZ",DIC("A")="Select matching local drug: ",DIC("S")="I $D(DRGARY(Y))" D ^DIC
"RTN","PSORRX1",249,0)
 .I Y=-1 S EXIT=1 Q
"RTN","PSORRX1",250,0)
 .S LDIEN=$P(Y,U) I LDIEN>0 S MATCH=1 Q
"RTN","PSORRX1",251,0)
 I $G(LDIEN) K DIR S DIR(0)="Y",DIR("A")="Would you like to use this drug" D ^DIR I +Y<0!($D(DUOUT))!($D(DTOUT)) Q -1
"RTN","PSORRX1",252,0)
 Q $G(LDIEN)
"RTN","PSORRX1",253,0)
 ; TEXT to build prompts
"RTN","PSORRX1",254,0)
 ;;DIR(0)|DIR(A)|DIR(B)|VARIABLE
"RTN","PSORRX1",255,0)
PRMPTXT ;
"RTN","PSORRX1",256,0)
 ;;N|Enter Quantity||QTY
"RTN","PSORRX1",257,0)
 ;;N|DAYS SUPPLY||DSUPP
"RTN","PSORRX1",258,0)
 ;;P^200:QEAMZ|Select PHARMACIST Name|S DEF=$$GET1~DIQ(200,DUZ,.01,"E")|PHARM
"RTN","PSORRX1",259,0)
 ;;F^0:60|REMARKS||REMARKS
"RTN","PSORRX1",260,0)
 ;;Q
"RTN","PSORRX1",261,0)
 Q
"RTN","PSORRX1",262,0)
DIR() ;
"RTN","PSORRX1",263,0)
 N DIR,Y
"RTN","PSORRX1",264,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","PSORRX1",265,0)
 S DIR("A",1)="Would you like to use the system matched drug for this"
"RTN","PSORRX1",266,0)
 S DIR("A")="refill/partial fill"
"RTN","PSORRX1",267,0)
 D ^DIR
"RTN","PSORRX1",268,0)
 Q Y
"RTN","PSORRX1",269,0)
POST ; post init for PSO*7*454
"RTN","PSORRX1",270,0)
 N LIEN,OPSITE,DOMAIN,VAL
"RTN","PSORRX1",271,0)
 ; add TCP/IP address for EMI
"RTN","PSORRX1",272,0)
 ;S DOMAIN=$$GET1^DIQ(4,DUZ(2),60,"E")
"RTN","PSORRX1",273,0)
 S DOMAIN=$$FQDN^PSORWRAP(,DUZ(2))
"RTN","PSORRX1",274,0)
 S VAL="PSORRXSEND"
"RTN","PSORRX1",275,0)
 S LIEN=$$FIND1^DIC(870,,"B",.VAL) Q:'LIEN
"RTN","PSORRX1",276,0)
 S FDA(870,LIEN_",",.08)=DOMAIN
"RTN","PSORRX1",277,0)
 S FDA(870,LIEN_",",400.01)="vaaussoalebp2.aac.domain.ext" D FILE^DIE(,"FDA") K FDA
"RTN","PSORRX1",278,0)
 ; turn off the OneVA Pharmacy flag for all outpatient sites.
"RTN","PSORRX1",279,0)
 S OPSITE=0 F  S OPSITE=$O(^PS(59,OPSITE)) Q:'OPSITE  D
"RTN","PSORRX1",280,0)
 .S FDA(59,OPSITE_",",3001)="" D FILE^DIE(,"FDA") K FDA
"RTN","PSORRX1",281,0)
 Q
"RTN","PSORRX2")
0^22^B32510176^n/a
"RTN","PSORRX2",1,0)
PSORRX2 ;AITC/BWF - Remote RX driver ;8/30/16 12:00am
"RTN","PSORRX2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORRX2",3,0)
 ;
"RTN","PSORRX2",4,0)
 Q
"RTN","PSORRX2",5,0)
 ; read response from refill site
"RTN","PSORRX2",6,0)
READMSG(HLDAT,TYPE,LOCDRUG) ;
"RTN","PSORRX2",7,0)
 N ORFS,ORCS,ORRS,ORES,ORSS,HLQUIT,ORQUIT,OREMSG1,OREMSG2,ORSMSG,ORSMSG,GBLLOC,LBLOOP,LBTXT,LBLOVF,DIR,ORERR,MSGDONE,MSGCNT,MSGTXT
"RTN","PSORRX2",8,0)
 S ORFS=$G(HL("FS")),ORCS=$E($G(HL("ECH")),1),ORRS=$E($G(HL("ECH")),2),ORES=$E($G(HL("ECH")),3),ORSS=$E($G(HL("ECH")),4)
"RTN","PSORRX2",9,0)
 S TYPE=$G(TYPE,"")
"RTN","PSORRX2",10,0)
 S HLQUIT=0,ORQUIT="",OREMSG1="",OREMSG2="",ORERR=""
"RTN","PSORRX2",11,0)
 F  X HLNEXT Q:HLQUIT'>0!(ORQUIT'="")  D
"RTN","PSORRX2",12,0)
 .N LOOP
"RTN","PSORRX2",13,0)
 .S LOOP=0 F  S LOOP=$O(HLNODE(LOOP)) Q:LOOP=""  S HLNODE=HLNODE_HLNODE(LOOP)
"RTN","PSORRX2",14,0)
 .I $E(HLNODE,1,3)="MSA"&($P(HLNODE,ORFS,2)'="AA") S ORERR=$P(HLNODE,ORFS,4)
"RTN","PSORRX2",15,0)
 .I $E(HLNODE,1,3)="ERR" S OREMSG1=$P(HLNODE,ORFS,9)
"RTN","PSORRX2",16,0)
 .I $E(HLNODE,1,3)="NTE" D
"RTN","PSORRX2",17,0)
 ..D REFNTE(.HLNODE,.HLDAT)
"RTN","PSORRX2",18,0)
 ..S ORSMSG=$P(@HLDAT@(1),ORFS)
"RTN","PSORRX2",19,0)
 .I $E(HLNODE,1,3)="PID" D
"RTN","PSORRX2",20,0)
 ..S @HLDAT@(0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","PSORRX2",21,0)
 ..D REFPID(.HLNODE,.HLDAT)
"RTN","PSORRX2",22,0)
 .I $E(HLNODE,1,3)="ORC" D
"RTN","PSORRX2",23,0)
 ..D REFORC(.HLNODE,.HLDAT,TYPE)
"RTN","PSORRX2",24,0)
 .I $E(HLNODE,1,3)="RXD" D
"RTN","PSORRX2",25,0)
 ..D REFRXD(.HLNODE,.HLDAT,TYPE)
"RTN","PSORRX2",26,0)
 I '$L(ORERR),'$L(OREMSG1) D
"RTN","PSORRX2",27,0)
 .I '$D(@HLDAT) S ORERR="No data was returned from the target vista." Q
"RTN","PSORRX2",28,0)
 .D LOGDATA^PSORWRAP(.HLDAT,TYPE,LOCDRUG,"")
"RTN","PSORRX2",29,0)
 I $L(ORERR) D
"RTN","PSORRX2",30,0)
 . K PSORRBLD  ; no need to rebuild worklist
"RTN","PSORRX2",31,0)
 . I ORERR="Invalid Receiving Application" S ORERR="OneVA software not installed at host site"  ; This error is returned if patch is not installed at remote/host site.  Making it more user friendly.
"RTN","PSORRX2",32,0)
 . W !!,ORERR
"RTN","PSORRX2",33,0)
 . S DIR(0)="FO",DIR("A")="Press RETURN to continue"
"RTN","PSORRX2",34,0)
 . D ^DIR
"RTN","PSORRX2",35,0)
 I OREMSG1'="" D
"RTN","PSORRX2",36,0)
 . K PSORRBLD  ; no need to rebuild worklist
"RTN","PSORRX2",37,0)
 . W !!,OREMSG1_". "_$S($L(OREMSG2):OREMSG2_".",1:""),!
"RTN","PSORRX2",38,0)
 . I '$D(ORSMSG) S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","PSORRX2",39,0)
 I $D(ORSMSG) D
"RTN","PSORRX2",40,0)
 .S MSGDONE=0
"RTN","PSORRX2",41,0)
 .F MSGCNT=1:1 D  Q:MSGDONE
"RTN","PSORRX2",42,0)
 ..S MSGTXT=$P(ORSMSG,"|",MSGCNT) I MSGTXT']"" S MSGDONE=1 Q
"RTN","PSORRX2",43,0)
 ..W !,MSGTXT
"RTN","PSORRX2",44,0)
 .S DIR(0)="FO",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","PSORRX2",45,0)
 Q
"RTN","PSORRX2",46,0)
 ; HLDAT(1)=MESSAGE^PATIENT DFN^RX NUMBER^REMOTE SITE#^FILL/PARTIAL DATE^PHARMACIST NAME^QUANTITY^DISPENSE DATE^DRUG NAME^DAYS SUPPLY
"RTN","PSORRX2",47,0)
REFNTE(DATA,HLDAT) ;
"RTN","PSORRX2",48,0)
 ; Message details
"RTN","PSORRX2",49,0)
 N NTETYP,NTETEXT,NTETYPE
"RTN","PSORRX2",50,0)
 S NTETYPE=$P(DATA,ORFS,3)
"RTN","PSORRX2",51,0)
 S NTETEXT=$P(DATA,ORFS,4)
"RTN","PSORRX2",52,0)
 I NTETYPE="L" D
"RTN","PSORRX2",53,0)
 .I $L($P($G(@HLDAT@(1)),U)) S $P(@HLDAT@(1),U)=$P($G(@HLDAT@(1)),U)_"|"_NTETEXT Q
"RTN","PSORRX2",54,0)
 .S $P(@HLDAT@(1),U)=NTETEXT
"RTN","PSORRX2",55,0)
 I NTETYPE="O" D
"RTN","PSORRX2",56,0)
 .S @HLDAT@("LBL",$O(@HLDAT@("LBL",""),-1)+1)=NTETEXT
"RTN","PSORRX2",57,0)
 Q
"RTN","PSORRX2",58,0)
 ;
"RTN","PSORRX2",59,0)
REFPID(DATA,HLDAT) ;
"RTN","PSORRX2",60,0)
 ; patient IEN from remote site
"RTN","PSORRX2",61,0)
 S $P(@HLDAT@(1),U,2)=$P($P($P(DATA,ORFS,4),ORCS,11),ORRS,2)
"RTN","PSORRX2",62,0)
 Q
"RTN","PSORRX2",63,0)
 ;
"RTN","PSORRX2",64,0)
REFORC(DATA,HLDAT,TYPE) ;
"RTN","PSORRX2",65,0)
 N RXNUM,RXSITE,RXDATE,PHARMLN,PHARMFN,REQSITE,PHONE,PHNAME,PNAME,RPDATE,RPROV
"RTN","PSORRX2",66,0)
 S RXNUM=$P($P(DATA,ORFS,3),ORCS)
"RTN","PSORRX2",67,0)
 S RXSITE=$P($P(DATA,ORFS,14),ORCS,4)
"RTN","PSORRX2",68,0)
 S RPDATE=$P(DATA,ORFS,10)
"RTN","PSORRX2",69,0)
 S RPROV=$P(DATA,ORFS,12)
"RTN","PSORRX2",70,0)
 S PHNAME=$P(DATA,ORFS,11)
"RTN","PSORRX2",71,0)
 S $P(@HLDAT@(1),U,3)=RXNUM
"RTN","PSORRX2",72,0)
 S $P(@HLDAT@(1),U,4)=RXSITE
"RTN","PSORRX2",73,0)
 S $P(@HLDAT@(1),U,5)=RPDATE
"RTN","PSORRX2",74,0)
 S $P(@HLDAT@(1),U,6)=PHNAME
"RTN","PSORRX2",75,0)
 S $P(@HLDAT@("RX0"),U)=RXNUM,$P(@HLDAT@("RX0"),U,2)=DFN,$P(@HLDAT@("RX0"),U,5)=$P($P($P(DATA,ORFS,22),ORCS,8),ORSS,2),$P(@HLDAT@("RX0"),U,6)=LOCDRUG
"RTN","PSORRX2",76,0)
 S $P(@HLDAT@("RX0"),U,4)=$P($P($P(DATA,ORFS,20),ORRS,1),ORCS,2)
"RTN","PSORRX2",77,0)
 S $P(@HLDAT@("RX0"),U,13)=$P(DATA,ORFS,16),$P(@HLDAT@("RX0"),U,19)=""
"RTN","PSORRX2",78,0)
 ; dont forget copies in p18, if needed
"RTN","PSORRX2",79,0)
 S $P(@HLDAT@("RX2"),U,2)=RPDATE,$P(@HLDAT@("RX2"),U,10)=$P($P($P(DATA,ORFS,20),ORRS,2),ORCS,2)
"RTN","PSORRX2",80,0)
 S $P(@HLDAT@("RX3"),U)=$P(DATA,ORFS,28)
"RTN","PSORRX2",81,0)
 I TYPE="RF" D
"RTN","PSORRX2",82,0)
 .S $P(@HLDAT@("RREF0"),U)=RPDATE,$P(@HLDAT@("RREF0"),U,2)="W",$P(@HLDAT@("RREF0"),U,7)=$P($P($P(DATA,ORFS,20),ORRS,3),ORCS,2)
"RTN","PSORRX2",83,0)
 .S $P(@HLDAT@("RREF0"),U,17)=$P($P($P(DATA,ORFS,20),ORRS,4),ORCS,2)
"RTN","PSORRX2",84,0)
 I TYPE="PR" D
"RTN","PSORRX2",85,0)
 .S $P(@HLDAT@("RPAR0"),U)=RPDATE,$P(@HLDAT@("RPAR0"),U,2)="W",$P(@HLDAT@("RPAR0"),U,7)=$P($P($P(DATA,ORFS,20),ORRS,3),ORCS,2)
"RTN","PSORRX2",86,0)
 .S $P(@HLDAT@("RPAR0"),U,17)=$P($P($P(DATA,ORFS,20),ORRS,4),ORCS,2)
"RTN","PSORRX2",87,0)
 S $P(@HLDAT@("ROR1"),U,5)=$P($P($P(DATA,ORFS,20),ORRS,5),ORCS,2)
"RTN","PSORRX2",88,0)
 S @HLDAT@("RXSTA")=$P($P(DATA,ORFS,26),ORCS),@HLDAT@("RXSTA2")=$P($P(DATA,ORFS,26),ORCS,2)
"RTN","PSORRX2",89,0)
 S @HLDAT@("PATST")=$P($P(DATA,ORFS,26),ORCS,4)
"RTN","PSORRX2",90,0)
 ; HOST INFO
"RTN","PSORRX2",91,0)
 ; P1 - NAME, P2 - ADDRESS~~CITY~STATE~ZIP, P3 - PHONE NUMBER, P4 - HOST SITE NUMBER
"RTN","PSORRX2",92,0)
 S $P(DATA,ORFS,23)=$P($P(DATA,ORFS,23),ORSS)_ORSS_$P($P(DATA,ORFS,23),ORSS,3,5)
"RTN","PSORRX2",93,0)
 S @HLDAT@("HINFO")=$P($P(DATA,ORFS,22),ORCS)_U_$P(DATA,ORFS,23)_U_$P(DATA,ORFS,24)
"RTN","PSORRX2",94,0)
 S $P(@HLDAT@("HINFO"),U,4)=RXSITE
"RTN","PSORRX2",95,0)
 S $P(@HLDAT@("HINFO"),U,5)=$P($P($P(DATA,ORFS,22),ORCS,8),ORSS,2)  ;Clinic
"RTN","PSORRX2",96,0)
 Q
"RTN","PSORRX2",97,0)
REFRXD(DATA,HLDAT,TYPE)  ;
"RTN","PSORRX2",98,0)
 N QTY,DSUPP,DNAME,HINFO,SIG1D,SIGDAT,SIGNUM,SIGTXT,I
"RTN","PSORRX2",99,0)
 S ($P(@HLDAT@(1),U,7),$P(@HLDAT@("RX0"),U,7))=$P(DATA,ORFS,5)  ; quantity
"RTN","PSORRX2",100,0)
 S $P(@HLDAT@(1),U,8)=$P(DATA,ORFS,4) ; dispense date
"RTN","PSORRX2",101,0)
 S $P(@HLDAT@(1),U,9)=$P($P(DATA,ORFS,3),ORCS,1) ; drug name
"RTN","PSORRX2",102,0)
 S ($P(@HLDAT@(1),U,10),$P(@HLDAT@("RX0"),U,8))=$P(DATA,ORFS,13) ; days supply
"RTN","PSORRX2",103,0)
 S $P(@HLDAT@("RX0"),U,9)=$P(DATA,ORFS,9),$P(@HLDAT@("RX0"),U,11)="W"
"RTN","PSORRX2",104,0)
 S $P(@HLDAT@("RX0"),U,18)=$P(DATA,ORFS,23)  ; Copies
"RTN","PSORRX2",105,0)
 S $P(@HLDAT@("RX2"),U,6)=$P(DATA,ORFS,20)  ; Rx Expiration Date 
"RTN","PSORRX2",106,0)
 ;
"RTN","PSORRX2",107,0)
 I TYPE="RF" D
"RTN","PSORRX2",108,0)
 .S $P(@HLDAT@("RREF0"),U,4)=$P(DATA,ORFS,5),$P(@HLDAT@("RREF0"),U,10)=$P(DATA,ORFS,13)
"RTN","PSORRX2",109,0)
 .S @HLDAT@("RFIEN")=$P($P(DATA,ORFS,8),":",3)
"RTN","PSORRX2",110,0)
 I TYPE="PR" D
"RTN","PSORRX2",111,0)
 .S $P(@HLDAT@("RPAR0"),U,4)=$P(DATA,ORFS,5),$P(@HLDAT@("RPAR0"),U,10)=$P(DATA,ORFS,13)
"RTN","PSORRX2",112,0)
 .S @HLDAT@("PARIEN")=$P($P(DATA,ORFS,8),":",3)
"RTN","PSORRX2",113,0)
 ;
"RTN","PSORRX2",114,0)
 S @HLDAT@("RSIG")=$P($P($P(DATA,ORFS,16),ORRS,1),ORCS,2)_U_$P($P($P(DATA,ORFS,16),ORRS,1),ORCS)
"RTN","PSORRX2",115,0)
 S @HLDAT@("RIEN")=$P($P(DATA,ORFS,8),":")
"RTN","PSORRX2",116,0)
 ;I '$P($G(@HLDAT@("RSIG")),U,2) Q
"RTN","PSORRX2",117,0)
 S SIG1D=0
"RTN","PSORRX2",118,0)
 F I=2:1 D  Q:SIG1D
"RTN","PSORRX2",119,0)
 .S SIGDAT=$P($P(DATA,ORFS,16),ORRS,I) I SIGDAT']"" S SIG1D=1 Q
"RTN","PSORRX2",120,0)
 .S SIGNUM=$P(SIGDAT,ORCS),SIGNUM=$P(SIGNUM,"_",2),SIGTXT=$P(SIGDAT,ORCS,2) Q:'SIGNUM
"RTN","PSORRX2",121,0)
 .S @HLDAT@("RSIG1",SIGNUM)=SIGTXT
"RTN","PSORRX2",122,0)
 Q
"RTN","PSORWRAP")
0^10^B112263517^n/a
"RTN","PSORWRAP",1,0)
PSORWRAP ;AITC/BWF - Remote RX API wrapper ;8/30/16 12:03am
"RTN","PSORWRAP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**454**;DEC 1997;Build 349
"RTN","PSORWRAP",3,0)
 ;
"RTN","PSORWRAP",4,0)
 Q
"RTN","PSORWRAP",5,0)
PROCESS ;
"RTN","PSORWRAP",6,0)
 N I,NUM,HLQUIT,DONE,ORCS,ORRS,ORES,ORSS,RXFTYP,RXNUM,RXFDATE,PHINFO,PHDUZ,PHLN,PHFN,RFSITE,RPHONE,RPHARM,QTY,MW,DSUPP,REMARKS
"RTN","PSORWRAP",7,0)
 N HLFS,RET,RXIEN,ZD,RX0,RX2,RXSTA,RPROV,SIG,RPAR0,RREF0,RREF0,ROR1,RX3
"RTN","PSORWRAP",8,0)
 S (RX0,RX2,RX3,RXSTA,RPROV,SIG,RPAR0,RREF0,RREF0,ROR1)=""
"RTN","PSORWRAP",9,0)
 S $ETRAP="D ^%ZTER Q"
"RTN","PSORWRAP",10,0)
 S HLFS=HL("FS")
"RTN","PSORWRAP",11,0)
 S ORCS=$E($G(HL("ECH")),1),ORRS=$E($G(HL("ECH")),2),ORES=$E($G(HL("ECH")),3),ORSS=$E($G(HL("ECH")),4)
"RTN","PSORWRAP",12,0)
 S (I,DONE,HLQUIT)=0
"RTN","PSORWRAP",13,0)
 F  X HLNEXT Q:DONE!HLQUIT'>0  D
"RTN","PSORWRAP",14,0)
 .I '$L($G(HLNODE)) S DONE=1 Q
"RTN","PSORWRAP",15,0)
 .N LOOP
"RTN","PSORWRAP",16,0)
 .S LOOP=0 F  S LOOP=$O(HLNODE(LOOP)) Q:LOOP=""  S HLNODE=HLNODE_HLNODE(LOOP)
"RTN","PSORWRAP",17,0)
 .I $E(HLNODE,1,3)="ORC" D
"RTN","PSORWRAP",18,0)
 ..S RXFTYP=$P(HLNODE,HLFS,2),RXNUM=$P($P(HLNODE,HLFS,3),ORCS),RXFDATE=$P(HLNODE,HLFS,10),PHINFO=$P(HLNODE,HLFS,11)
"RTN","PSORWRAP",19,0)
 ..S PHDUZ=$P(PHINFO,ORCS),PHLN=$P(PHINFO,ORCS,2),PHFN=$P(PHINFO,ORCS,3),RFSITE=$P($P(HLNODE,HLFS,14),ORCS,4),RPHONE=$P(HLNODE,HLFS,15)
"RTN","PSORWRAP",20,0)
 ..S RPHARM=PHLN_","_PHFN
"RTN","PSORWRAP",21,0)
 .I $E(HLNODE,1,3)="RXO" D
"RTN","PSORWRAP",22,0)
 ..S QTY=$P(HLNODE,HLFS,3),MW=$P($P(HLNODE,HLFS,9),ORCS),DSUPP=$P(HLNODE,HLFS,12)
"RTN","PSORWRAP",23,0)
 .I $E(HLNODE,1,3)="NTE" D
"RTN","PSORWRAP",24,0)
 ..S REMARKS=$P(HLNODE,HLFS,4)
"RTN","PSORWRAP",25,0)
 .S I=I+1
"RTN","PSORWRAP",26,0)
 S RXIEN=$O(^PSRX("B",RXNUM,0))
"RTN","PSORWRAP",27,0)
 S DFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSORWRAP",28,0)
 I RXFTYP="RF" D
"RTN","PSORWRAP",29,0)
 .D REMREF^PSORREF(.RET,RXNUM,RXFDATE,MW,RPHARM,RPHONE,RFSITE,.RX0,.RX2,.RXSTA,.RPROV,.SIG,.RREF0,.ROR1,.RX3)
"RTN","PSORWRAP",30,0)
 .D BLDACK(.RET,DFN,RXFTYP,RX0,RX2,RXSTA,RPROV,SIG,RREF0,"",ROR1,RX3)
"RTN","PSORWRAP",31,0)
 I RXFTYP="PF" D
"RTN","PSORWRAP",32,0)
 .D PAR^PSORRPA1(.RET,RXNUM,RXFDATE,MW,QTY,DSUPP,REMARKS,RPHARM,RPHONE,RFSITE,.RX0,.RX2,.RXSTA,.RPROV,.SIG,.RPAR0,.ROR1,.RX3,.RREF0)
"RTN","PSORWRAP",33,0)
 .D BLDACK(.RET,DFN,RXFTYP,RX0,RX2,RXSTA,RPROV,SIG,RREF0,RPAR0,ROR1,RX3)
"RTN","PSORWRAP",34,0)
 Q
"RTN","PSORWRAP",35,0)
 ;
"RTN","PSORWRAP",36,0)
 ;Build Acknowlegement to show Rx was filled or in error
"RTN","PSORWRAP",37,0)
BLDACK(DAT,DFN,TYPE,RX0,RX2,RXSTA,RPROV,SIG,RREF0,RPAR0,ROR1,RX3) ;
"RTN","PSORWRAP",38,0)
 N CNT,PIDLP,DONE,PSOHCNT,PNAME,PLNAME,PFNAME,PSOIEN,LBLGLB,LBLOOP,NTECNT,DATLP,ERR,LBLGBL,LBLOVF,LBTXT,PSACKERR,PSORRDAT
"RTN","PSORWRAP",39,0)
 N NODE,HSITE,T,HSNAM,HMFSADD,HACODE,HPHONE,HMFSZIP,HSNUM,HCITY,HSTATE,OFNAME,OFADD,OFPHONE,NODEDAT
"RTN","PSORWRAP",40,0)
 S (NTECNT,CNT)=0
"RTN","PSORWRAP",41,0)
 ; MSA segment
"RTN","PSORWRAP",42,0)
 K ^TMP("HLA",$J)
"RTN","PSORWRAP",43,0)
 S CNT=CNT+1,^TMP("HLA",$J,CNT)="MSA"_HLFS_"AA"_HLFS_$G(HL("MID"))
"RTN","PSORWRAP",44,0)
 ; ERR segment if error
"RTN","PSORWRAP",45,0)
 I $E($G(DAT(0)))=0 D
"RTN","PSORWRAP",46,0)
 .N ERRSEG
"RTN","PSORWRAP",47,0)
 .S $P(ERRSEG,HLFS)="ERR"
"RTN","PSORWRAP",48,0)
 .S $P(ERRSEG,HLFS,4)=207  ; error code - application internal error
"RTN","PSORWRAP",49,0)
 .S $P(ERRSEG,HLFS,5)="E"  ; severity - "E"rror
"RTN","PSORWRAP",50,0)
 .S $P(ERRSEG,HLFS,9)="Unable to complete transaction" ; User Message
"RTN","PSORWRAP",51,0)
 .S CNT=CNT+1
"RTN","PSORWRAP",52,0)
 .S ^TMP("HLA",$J,CNT)=ERRSEG
"RTN","PSORWRAP",53,0)
 ; NTE segment
"RTN","PSORWRAP",54,0)
 S DATLP=0 F  S DATLP=$O(DAT(DATLP)) Q:'DATLP  D
"RTN","PSORWRAP",55,0)
 .S CNT=CNT+1,NTECNT=NTECNT+1,^TMP("HLA",$J,CNT)="NTE"_HLFS_NTECNT_HLFS_"L"_HLFS_$G(DAT(DATLP))
"RTN","PSORWRAP",56,0)
 S LBLGBL=$P($G(DAT(0)),U,18)
"RTN","PSORWRAP",57,0)
 ; build label data into NTE segments
"RTN","PSORWRAP",58,0)
 I $L(LBLGBL) D
"RTN","PSORWRAP",59,0)
 .S LBLGBL=U_LBLGBL
"RTN","PSORWRAP",60,0)
 .S LBLOOP=0 F  S LBLOOP=$O(@LBLGBL@(LBLOOP)) Q:'LBLOOP  D
"RTN","PSORWRAP",61,0)
 ..S LBTXT=$G(@LBLGBL@(LBLOOP,0))
"RTN","PSORWRAP",62,0)
 ..I $D(@LBLGBL@(LBLOOP,"OVF")) D
"RTN","PSORWRAP",63,0)
 ...S LBLOVF=0 F  S LBLOVF=$O(@LBLGBL@(LBLOOP,"OVF",LBLOVF)) Q:'LBLOVF  D
"RTN","PSORWRAP",64,0)
 ....S LBTXT=$G(LBTXT)_$G(@LBLGBL@(LBLOOP,"OVF",LBLOVF,0))
"RTN","PSORWRAP",65,0)
 ..S CNT=CNT+1,NTECNT=NTECNT+1,^TMP("HLA",$J,CNT)="NTE"_HLFS_NTECNT_HLFS_"O"_HLFS_$G(LBTXT)
"RTN","PSORWRAP",66,0)
 ; end label build
"RTN","PSORWRAP",67,0)
 D BLDPID^PSOTPHL2(DFN,"",.PSORRDAT,.HL,.ERR)
"RTN","PSORWRAP",68,0)
 S PSOIEN=$P(DAT(0),U,3)
"RTN","PSORWRAP",69,0)
 S PNAME=$$GET1^DIQ(52,PSOIEN,2,"E")
"RTN","PSORWRAP",70,0)
 S PLNAME=$P(PNAME,","),PFNAME=$P($P(PNAME,",",2)," ")
"RTN","PSORWRAP",71,0)
 S DONE=0
"RTN","PSORWRAP",72,0)
 S CNT=CNT+1
"RTN","PSORWRAP",73,0)
 ; build PID segment
"RTN","PSORWRAP",74,0)
 F PSOHCNT=1:1 D  Q:DONE
"RTN","PSORWRAP",75,0)
 .I '$D(PSORRDAT(PSOHCNT)) S DONE=1 Q
"RTN","PSORWRAP",76,0)
 .S ^TMP("HLA",$J,CNT)=$G(^TMP("HLA",$J,CNT))_PSORRDAT(PSOHCNT)
"RTN","PSORWRAP",77,0)
 S CNT=CNT+1
"RTN","PSORWRAP",78,0)
 S HSITE=$P(RX2,U,9)
"RTN","PSORWRAP",79,0)
 S HSNAM=$$GET1^DIQ(59,HSITE,.01,"E")
"RTN","PSORWRAP",80,0)
 S HMFSADD=$$GET1^DIQ(59,HSITE,.02,"E")
"RTN","PSORWRAP",81,0)
 S HACODE=$$GET1^DIQ(59,HSITE,.03,"E")
"RTN","PSORWRAP",82,0)
 S HPHONE=$$GET1^DIQ(59,HSITE,.04,"E")
"RTN","PSORWRAP",83,0)
 S HMFSZIP=$$GET1^DIQ(59,HSITE,.05,"E")
"RTN","PSORWRAP",84,0)
 S HSNUM=$$GET1^DIQ(59,HSITE,.06,"E")
"RTN","PSORWRAP",85,0)
 S HCITY=$$GET1^DIQ(59,HSITE,.07,"E")
"RTN","PSORWRAP",86,0)
 S HSTATE=$$GET1^DIQ(59,HSITE,.08,"I"),HSTATE=$$GET1^DIQ(5,HSTATE,1,"E")
"RTN","PSORWRAP",87,0)
 S T="~"
"RTN","PSORWRAP",88,0)
 S OFNAME=HSNAM
"RTN","PSORWRAP",89,0)
 S OFADD=HMFSADD_T_T_HCITY_T_HSTATE_T_HMFSZIP
"RTN","PSORWRAP",90,0)
 S OFPHONE=HACODE_"-"_HPHONE
"RTN","PSORWRAP",91,0)
 ;
"RTN","PSORWRAP",92,0)
 ; build ORC segment
"RTN","PSORWRAP",93,0)
 ;S ^TMP("HLA",$J,CNT)="ORC"_HLFS_TYPE_HLFS_$P(DAT(0),U,2)_ORCS_$P(DAT(0),U,17)_ORCS_$$GET1^DIQ(4,$P(DAT(0),U,17),60,"E")
"RTN","PSORWRAP",94,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,1)="ORC"
"RTN","PSORWRAP",95,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,2)=TYPE
"RTN","PSORWRAP",96,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,3)=$P(DAT(0),U,2)_ORCS_$P(DAT(0),U,17)_ORCS_$$FQDN(,$P(DAT(0),U,17))
"RTN","PSORWRAP",97,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,10)=$P(DAT(0),U,5)
"RTN","PSORWRAP",98,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,11)=DFN_ORCS_PLNAME_ORCS_PFNAME
"RTN","PSORWRAP",99,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,14)=ORCS_ORCS_ORCS_$P($$SITE^VASITE(),U,3)
"RTN","PSORWRAP",100,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,16)=$P(RX0,U,13) ; Issue Date
"RTN","PSORWRAP",101,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,20)="P"_ORCS_$$GET1^DIQ(200,$P(RX0,U,16),.01)   ; seq #1
"RTN","PSORWRAP",102,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"VP"_ORCS_$$GET1^DIQ(200,$P(RX2,U,10),.01)  ; seq #2
"RTN","PSORWRAP",103,0)
 ;
"RTN","PSORWRAP",104,0)
 I $G(RREF0)]"" D
"RTN","PSORWRAP",105,0)
 .S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"C"_ORCS_$$GET1^DIQ(200,$P(RREF0,U,7),.01)  ; seq #3
"RTN","PSORWRAP",106,0)
 .S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"RP"_ORCS_$$GET1^DIQ(200,$P(RREF0,U,17),.01)   ; seq #4
"RTN","PSORWRAP",107,0)
 ;
"RTN","PSORWRAP",108,0)
 I $G(RPAR0)]"" D
"RTN","PSORWRAP",109,0)
 .S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"C"_ORCS_$$GET1^DIQ(200,$P(RPAR0,U,7),.01)  ; seq #3
"RTN","PSORWRAP",110,0)
 .S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"PP"_ORCS_$$GET1^DIQ(200,$P(RPAR0,U,17),.01)   ; seq #4
"RTN","PSORWRAP",111,0)
 ;
"RTN","PSORWRAP",112,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(^TMP("HLA",$J,CNT),HLFS,20)_ORRS_"FP"_ORCS_$$GET1^DIQ(200,$P(ROR1,U,5),.01)   ; seq #5
"RTN","PSORWRAP",113,0)
 N DATA
"RTN","PSORWRAP",114,0)
 S $P(DATA,ORSS,2)=$$GET1^DIQ(44,$P(RX0,U,5),.01)  ; Clinic 
"RTN","PSORWRAP",115,0)
 S $P(OFNAME,ORCS,8)=DATA
"RTN","PSORWRAP",116,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,22)=OFNAME
"RTN","PSORWRAP",117,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,23)=OFADD
"RTN","PSORWRAP",118,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,24)=OFPHONE
"RTN","PSORWRAP",119,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,26)=$$GET1^DIQ(52,PSOIEN,100,"I")_ORCS_$$GET1^DIQ(52,PSOIEN,100,"E")_ORCS_ORCS_$$GET1^DIQ(53,$P(RX0,U,3),2)_ORCS_$$GET1^DIQ(53,$P(RX0,U,3),.01)  ; Rx Status (ex - 1 ACTIVE)
"RTN","PSORWRAP",120,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,28)=$P(RX3,U)  ; Last dispense date in ORC-27 Fillers expected availability date
"RTN","PSORWRAP",121,0)
 S CNT=CNT+1
"RTN","PSORWRAP",122,0)
 ;
"RTN","PSORWRAP",123,0)
 ; build RXD segment
"RTN","PSORWRAP",124,0)
 ;S ^TMP("HLA",$J,CNT)="RXD"_HLFS_1_HLFS_$P(DAT(0),U,6)_ORCS_"NDC"_HLFS_$P(DAT(0),U,5)_HLFS_$P(DAT(0),U,7)
"RTN","PSORWRAP",125,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,1)="RXD"
"RTN","PSORWRAP",126,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,2)=1
"RTN","PSORWRAP",127,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,3)=$P(DAT(0),U,6)_ORCS_"NDC"
"RTN","PSORWRAP",128,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,4)=$P(DAT(0),U,5) ; Fill date
"RTN","PSORWRAP",129,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,5)=$P(DAT(0),U,7) ; Quantity
"RTN","PSORWRAP",130,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,8)=$P(DAT(0),U,3)_"::"_$P(DAT(0),U,4)
"RTN","PSORWRAP",131,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,9)=$$GET1^DIQ(52,PSOIEN,9,"I") ; # of refills remaining
"RTN","PSORWRAP",132,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,11)=$P(DAT(0),U,15) ; Dispensing Pharmacy
"RTN","PSORWRAP",133,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,13)=$P(DAT(0),U,8) ; Days Supply
"RTN","PSORWRAP",134,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,16)=$$GET1^DIQ(52,PSOIEN,10.1,"I")_ORCS_$$GET1^DIQ(52,PSOIEN,10,"I") ; SIGs
"RTN","PSORWRAP",135,0)
 I $D(^PSRX(PSOIEN,"SIG1",1)) D
"RTN","PSORWRAP",136,0)
 .N SIG1CNT
"RTN","PSORWRAP",137,0)
 .S SIG1CNT=0 F  S SIG1CNT=$O(^PSRX(PSOIEN,"SIG1",SIG1CNT)) Q:'SIG1CNT  D
"RTN","PSORWRAP",138,0)
 ..S DATA="SIG1_"_SIG1CNT_ORCS_$G(^PSRX(PSOIEN,"SIG1",SIG1CNT,0))
"RTN","PSORWRAP",139,0)
 ..S $P(^TMP("HLA",$J,CNT),HLFS,16)=$P(^TMP("HLA",$J,CNT),HLFS,16)_ORRS_DATA
"RTN","PSORWRAP",140,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,20)=$P(RX2,U,6)  ; Rx expiration date
"RTN","PSORWRAP",141,0)
 ;
"RTN","PSORWRAP",142,0)
 S $P(^TMP("HLA",$J,CNT),HLFS,23)=$P(RX0,U,18) ; Number of copies into DISPENSE PACKAGE SIZE
"RTN","PSORWRAP",143,0)
 ;
"RTN","PSORWRAP",144,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.PSACKERR)
"RTN","PSORWRAP",145,0)
 K ^TMP("HLA",$J)
"RTN","PSORWRAP",146,0)
 Q
"RTN","PSORWRAP",147,0)
LABEL(RX,PSOLAP,PSOSITE,DUZ,PSOTRAMT,FNAME) ; Print the label.
"RTN","PSORWRAP",148,0)
 ;  Input:        RX  --  Pointer to the prescription in file #52
"RTN","PSORWRAP",149,0)
 ;            PSOLAP  --  Label printer
"RTN","PSORWRAP",150,0)
 ;           PSOSITE  --  Pointer to the Pharmacy in file #59
"RTN","PSORWRAP",151,0)
 ;               DUZ  --  Pointer to the use in file #200
"RTN","PSORWRAP",152,0)
 ;          PSOTRAMT  --  Amount to be paid
"RTN","PSORWRAP",153,0)
 ;
"RTN","PSORWRAP",154,0)
 ;
"RTN","PSORWRAP",155,0)
 Q:PSOLAP["LAT-TERM"
"RTN","PSORWRAP",156,0)
 Q:'$D(^PSRX(RX,0))
"RTN","PSORWRAP",157,0)
 Q:'$D(^PS(59,PSOSITE,0))
"RTN","PSORWRAP",158,0)
 N CT,II,III,NOW,RXFF,X,Y,PSOSYS,PSOPAR,PSOBARS,PDUZ,PSOBAR0,PSOBAR1,REPRINT,PSOCHAMP,PSHRX,DIQUIET
"RTN","PSORWRAP",159,0)
 S DIQUIET=1 D DT^DICRW
"RTN","PSORWRAP",160,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORWRAP",161,0)
 S:$P($G(^PSRX(RX,"STA")),"^")'=3 REPRINT=""
"RTN","PSORWRAP",162,0)
 ;
"RTN","PSORWRAP",163,0)
IO D SAVDEV^%ZISUTL("ONEVAHLIO")
"RTN","PSORWRAP",164,0)
 N PAR S PAR="0"
"RTN","PSORWRAP",165,0)
 S PAR("HFSNAME")=FNAME,PAR("HFSMODE")="W"
"RTN","PSORWRAP",166,0)
 D OPEN^%ZISUTL("ONEVALABEL",PSOLAP,.PAR)
"RTN","PSORWRAP",167,0)
 Q:POP
"RTN","PSORWRAP",168,0)
 ;
"RTN","PSORWRAP",169,0)
 D USE^%ZISUTL("ONEVALABEL")
"RTN","PSORWRAP",170,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORWRAP",171,0)
 S PSOSYS=$G(^PS(59,PSOSITE,1))
"RTN","PSORWRAP",172,0)
 S PSOPAR=$G(^PS(59,PSOSITE,1)),PDUZ=DUZ
"RTN","PSORWRAP",173,0)
 S PPL=RX
"RTN","PSORWRAP",174,0)
 S PSOCHAMP=1
"RTN","PSORWRAP",175,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&($P(PSOPAR,"^",19))
"RTN","PSORWRAP",176,0)
 D DQ^PSOLBL
"RTN","PSORWRAP",177,0)
 D CLOSE^%ZISUTL("ONEVALABEL")
"RTN","PSORWRAP",178,0)
 D RMDEV^%ZISUTL("ONEVALABEL")
"RTN","PSORWRAP",179,0)
 K PPL
"RTN","PSORWRAP",180,0)
 ;
"RTN","PSORWRAP",181,0)
 Q
"RTN","PSORWRAP",182,0)
 ; log information about the refill or partial fill locally for reporting
"RTN","PSORWRAP",183,0)
 ;HLDAT(1)=MESSAGE^PATIENT DFN^RX NUMBER^REMOTE SITE#^FILL/PARTIAL DATE^PHARMACIST NAME^QUANTITY^DISPENSE DATE^DRUG NAME^DAYS SUPPLY
"RTN","PSORWRAP",184,0)
LOGDATA(HLDAT,TYPE,LOCDRUG,LBLGBL,PSOIEN) ;
"RTN","PSORWRAP",185,0)
 N F,ERR,FDA,DATA,FILERR,NIEN,MSG,LBL,TMPIEN,REFREM,LIEN,LDCOST,TCOST,DSAV,DSAV2,RRFTYP,RRXPR,RRXFL,RPPL
"RTN","PSORWRAP",186,0)
 N RX0,RX2,RX3,RXSTA,HINFO,RSIG,ROR1,RPAR0,RREF0,RFIEN,PARIEN,RIEN,PATST,RSIG1
"RTN","PSORWRAP",187,0)
 S DATA=$G(@HLDAT@(1))
"RTN","PSORWRAP",188,0)
 ;
"RTN","PSORWRAP",189,0)
 ;Q:'+$P(DATA,U,7)  ; no quantity dispensed. WCJ
"RTN","PSORWRAP",190,0)
 ;
"RTN","PSORWRAP",191,0)
 I '$G(PSODFN) S PSODFN=$$GET1^DIQ(52,PSOIEN,2,"I")
"RTN","PSORWRAP",192,0)
 S F=52.09
"RTN","PSORWRAP",193,0)
 ;set up FDA and file data
"RTN","PSORWRAP",194,0)
 S FDA(F,"+1,",.01)=$$NOW^XLFDT
"RTN","PSORWRAP",195,0)
 S FDA(F,"+1,",.02)=PSODFN
"RTN","PSORWRAP",196,0)
 S FDA(F,"+1,",.03)=$P(@HLDAT@(1),U,3)
"RTN","PSORWRAP",197,0)
 S FDA(F,"+1,",.04)=$$FIND1^DIC(4,,"X",$P(@HLDAT@(1),U,4),"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)")
"RTN","PSORWRAP",198,0)
 S FDA(F,"+1,",.05)=TYPE
"RTN","PSORWRAP",199,0)
 I TYPE="PR"!(TYPE="RF") S FDA(F,"+1,",.06)=$G(DUZ)
"RTN","PSORWRAP",200,0)
 I TYPE="OR"!(TYPE="OP") S FDA(F,"+1,",.061)=$P(@HLDAT@(1),U,11)
"RTN","PSORWRAP",201,0)
 S FDA(F,"+1,",.07)=$P(@HLDAT@(1),U,7)
"RTN","PSORWRAP",202,0)
 S FDA(F,"+1,",.08)=$P(@HLDAT@(1),U,10)
"RTN","PSORWRAP",203,0)
 S FDA(F,"+1,",.09)=$P(@HLDAT@(1),U,12)
"RTN","PSORWRAP",204,0)
 S FDA(F,"+1,",.1)=$P(@HLDAT@(1),U,8)
"RTN","PSORWRAP",205,0)
 S FDA(F,"+1,",1)=$P(@HLDAT@(1),U,9)
"RTN","PSORWRAP",206,0)
 ; local drug will not be passed in if this is an OF or OR type.
"RTN","PSORWRAP",207,0)
 I $G(LOCDRUG) D
"RTN","PSORWRAP",208,0)
 .S FDA(F,"+1,",1.1)=LOCDRUG
"RTN","PSORWRAP",209,0)
 .S QTY=$P(@HLDAT@(1),U,7) Q:'QTY
"RTN","PSORWRAP",210,0)
 .S LDCOST=$$GET1^DIQ(50,LOCDRUG,16,"I") Q:LDCOST=""
"RTN","PSORWRAP",211,0)
 .S TCOST=QTY*LDCOST
"RTN","PSORWRAP",212,0)
 .S FDA(F,"+1,",1.2)=TCOST
"RTN","PSORWRAP",213,0)
 .S FDA(F,"+1,",1.3)=$$GET1^DIQ(50,LOCDRUG,22,"I")
"RTN","PSORWRAP",214,0)
 D UPDATE^DIE(,"FDA","NIEN","FILERR")
"RTN","PSORWRAP",215,0)
 I $D(FILERR) D  Q
"RTN","PSORWRAP",216,0)
 .; display error
"RTN","PSORWRAP",217,0)
 S NIEN=$G(NIEN(1))
"RTN","PSORWRAP",218,0)
 S MSG(1)=$P(@HLDAT@(1),U)
"RTN","PSORWRAP",219,0)
 D WP^DIE(52.09,NIEN_",",2,"K","MSG")
"RTN","PSORWRAP",220,0)
 S RRFTYP=TYPE
"RTN","PSORWRAP",221,0)
 ;
"RTN","PSORWRAP",222,0)
 ; if you have a label, store it in the log and print it out.
"RTN","PSORWRAP",223,0)
 I $D(@HLDAT@("LBL")) D
"RTN","PSORWRAP",224,0)
 .N %ZIS,ZTRTN,ZTDESC,ZTDTH,ZTSAVE,ZTSK,ZTREQ,RRXPR,RRXFL,RPPL
"RTN","PSORWRAP",225,0)
 .I TYPE="PR" S RRXPR($G(@HLDAT@("RIEN")))=1
"RTN","PSORWRAP",226,0)
 .I TYPE="RF" S RRXFL($G(@HLDAT@("RIEN")))=1
"RTN","PSORWRAP",227,0)
 .S RPPL=$G(@HLDAT@("RIEN"))
"RTN","PSORWRAP",228,0)
 .I 'RPPL Q
"RTN","PSORWRAP",229,0)
 .S RPPL=RPPL_","
"RTN","PSORWRAP",230,0)
 .M LBL=@HLDAT@("LBL")
"RTN","PSORWRAP",231,0)
 .D WP^DIE(52.09,NIEN_",",3,"K","LBL")
"RTN","PSORWRAP",232,0)
 .N IOP S IOP="Q"  ; default to Queueing this
"RTN","PSORWRAP",233,0)
 .W ! K POP S %ZIS("B")="",%ZIS("S")="I $$GET1^DIQ(3.5,Y,3,""I""),$D(^%ZIS(2,$$GET1^DIQ(3.5,Y,3,""I""),55,""B"",""LL""))",%ZIS="QMN",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS
"RTN","PSORWRAP",234,0)
 .Q:POP  ; do not pass GO, do not collect $200 - User wants out - sad cause RX was already filled
"RTN","PSORWRAP",235,0)
 .;I '$G(IO("Q")) D RRXLBL Q  ; user really didn't want to queue it and overrode that
"RTN","PSORWRAP",236,0)
 .;I $P(RSIG,U)="" S $P(RSIG,U)=$G(RSIGSTR)
"RTN","PSORWRAP",237,0)
 .F DSAV="RX0","RX2","RX3","RXSTA","HINFO","RSIG","PSODFN","LOCDRUG","ROR1","RPAR0","RREF0","RFIEN","PARIEN","RIEN","PATST" D
"RTN","PSORWRAP",238,0)
 ..M @DSAV=@HLDAT@(DSAV)
"RTN","PSORWRAP",239,0)
 ..S ZTSAVE(DSAV)=""
"RTN","PSORWRAP",240,0)
 .M RSIG1=@HLDAT@("RSIG1")
"RTN","PSORWRAP",241,0)
 .F DSAV2="PSOSITE","PSODFN","PSOPAR","PSOSYS","RRFTYP","RRXFL(","RRXPR(","RSIG1(","RPPL" D
"RTN","PSORWRAP",242,0)
 ..S ZTSAVE(DSAV2)=""
"RTN","PSORWRAP",243,0)
 .;I '$G(IO("Q")) K ZTSAVE D DQ^PSORLLLI,^%ZISC Q
"RTN","PSORWRAP",244,0)
 .; if you made it here, they picked a queueable device to queue this to
"RTN","PSORWRAP",245,0)
 .;S ZTRTN="RRXLBL^PSORWRAP"
"RTN","PSORWRAP",246,0)
 .S ZTDESC="OneVA label print",ZTDTH=$H
"RTN","PSORWRAP",247,0)
 .S ZTRTN="DQ^PSORLLLI"
"RTN","PSORWRAP",248,0)
 .D ^%ZTLOAD
"RTN","PSORWRAP",249,0)
 .I $D(ZTSK)[0 W !!?5,"Problems queuing label!"
"RTN","PSORWRAP",250,0)
 .E  W !!?5,"Label queued!"
"RTN","PSORWRAP",251,0)
 .D HOME^%ZIS K IO("Q") Q
"RTN","PSORWRAP",252,0)
 Q
"RTN","PSORWRAP",253,0)
 ;
"RTN","PSORWRAP",254,0)
RRXLBL ;Remote RX Label print
"RTN","PSORWRAP",255,0)
 N LBLLOOP,LBLTXT
"RTN","PSORWRAP",256,0)
 U IO
"RTN","PSORWRAP",257,0)
 S LBLOOP=0 F  S LBLOOP=$O(LBL(LBLOOP)) Q:'LBLOOP  D
"RTN","PSORWRAP",258,0)
 .S LBTXT=$G(LBL(LBLOOP))
"RTN","PSORWRAP",259,0)
 .W !,LBTXT
"RTN","PSORWRAP",260,0)
 D ^%ZISC
"RTN","PSORWRAP",261,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSORWRAP",262,0)
 Q
"RTN","PSORWRAP",263,0)
 ;
"RTN","PSORWRAP",264,0)
FQDN(SITE,IEN4) ; get Fully Qualified Domain Name
"RTN","PSORWRAP",265,0)
 ;
"RTN","PSORWRAP",266,0)
 I $G(IEN4)="",$G(SITE)="" Q ""  ; Need site # or institution file IEN
"RTN","PSORWRAP",267,0)
 ;
"RTN","PSORWRAP",268,0)
 I $G(IEN4)="" D  Q:$G(IEN4)="" ""
"RTN","PSORWRAP",269,0)
 .S IEN4=$$FIND1^DIC(4,,"X",SITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)")
"RTN","PSORWRAP",270,0)
 ;
"RTN","PSORWRAP",271,0)
 N PSOHLNK,RMSDOM
"RTN","PSORWRAP",272,0)
 S PSOHLNK=$O(^HLCS(870,"C",IEN4,0)) ; get first entry (should only be one but you never know) IA#3550
"RTN","PSORWRAP",273,0)
 Q:'$G(PSOHLNK) ""
"RTN","PSORWRAP",274,0)
 ;
"RTN","PSORWRAP",275,0)
 S RMSDOM=$$GET1^DIQ(870,PSOHLNK,.03,"E")  ; get domain name IA#3335
"RTN","PSORWRAP",276,0)
 Q:$G(RMSDOM)="" ""
"RTN","PSORWRAP",277,0)
 ;
"RTN","PSORWRAP",278,0)
 S:$$PROD^XUPROD() RMSDOM="HL7."_RMSDOM   ; prefix domain name
"RTN","PSORWRAP",279,0)
 Q RMSDOM
"RTN","PSORX1")
0^7^B82763052^B66023082
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;8/17/16 5:10pm
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233,268,300,170,320,326,324,334,251,454**;DEC 1997;Build 349
"RTN","PSORX1",3,0)
 ;
"RTN","PSORX1",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",7,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",8,0)
 ;External reference ^ORRDI1 is supported by DBIA 4659
"RTN","PSORX1",9,0)
 ;External reference ^XTMP("ORRDI" is supported by DBIA 4660
"RTN","PSORX1",10,0)
 ;External reference ^PSUHL supported by DBIA 4803
"RTN","PSORX1",11,0)
 ;
"RTN","PSORX1",12,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",13,0)
 ;
"RTN","PSORX1",14,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG,^TMP($J,"PSOTDD"),^TMP("PSORXPO",$J),^TMP("PSORXBO",$J)
"RTN","PSORX1",15,0)
 I '$G(PSOONEVA) N PSOONEVA S PSOONEVA=1
"RTN","PSORX1",16,0)
 D EOJ S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",17,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",18,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",19,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",20,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",21,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",22,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX
"RTN","PSORX1",23,0)
 G:$G(NOBG) NX
"RTN","PSORX1",24,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",25,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",26,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",27,0)
 D EOJ G START
"RTN","PSORX1",28,0)
END Q
"RTN","PSORX1",29,0)
 ;---------------------------------------------------------
"RTN","PSORX1",30,0)
INIT ;
"RTN","PSORX1",31,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",32,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",33,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",34,0)
INITX Q
"RTN","PSORX1",35,0)
 ;
"RTN","PSORX1",36,0)
PT ;
"RTN","PSORX1",37,0)
 K ^TMP("PSORXDC",$J),^TMP($J,"PSEXC","OUT"),CLOZPAT,DIC,PSODFN,PSOPTLK
"RTN","PSORX1",38,0)
 S PSORX("QFLG")=0,DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK
"RTN","PSORX1",39,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",40,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",41,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1
"RTN","PSORX1",42,0)
 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",43,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",44,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",45,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",46,0)
 I $G(XQY0)["PSO LMOE FINISH",'$G(MEDP),$D(^TMP($J,"PSOFLPO",PSODFN)) D
"RTN","PSORX1",47,0)
 .I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSORX1",48,0)
 .W "  ",IORVON_IOINHI,"<This patient has flagged orders>",IOINORM_IORVOFF
"RTN","PSORX1",49,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D  I PSONOAL'="" D PAUSE
"RTN","PSORX1",50,0)
 .I PSONOAL'="" W !,$C(7),"     No Allergy Assessment!"
"RTN","PSORX1",51,0)
 D REMOTE
"RTN","PSORX1",52,0)
 ; bwf - 1/9/2014 - PHARMACY INNOVATIONS, adding call and on screen message to get remote rx's from MDWS.
"RTN","PSORX1",53,0)
 I $G(PSOONEVA) D
"RTN","PSORX1",54,0)
 .N TFL,TFILIST,TFLP,TFLSITE,TFLIEN,TFLCNT,TFLDUP
"RTN","PSORX1",55,0)
 .D TFL^VAFCTFU1(.TFL,PSODFN)
"RTN","PSORX1",56,0)
 .S TFLCNT=0
"RTN","PSORX1",57,0)
 .S TFILIST="^VAMC^M&ROC^M&ROC(M&RO)^OC^OPC^CBOC^PRRTP^DOM^HCS^MC(M)^MC(M&D)^MORC^NHC^VANPH^SOC^SARRTP^"  ; only exact matches
"RTN","PSORX1",58,0)
 .S TFLP=0 F  S TFLP=$O(TFL(TFLP)) Q:'TFLP!(TFLCNT=2)  D
"RTN","PSORX1",59,0)
 ..S TFLSITE=$P(TFL(TFLP),U) Q:TFLSITE=""
"RTN","PSORX1",60,0)
 ..Q:$D(TFLDUP(TFLSITE))
"RTN","PSORX1",61,0)
 ..S TFLDUP(TFLSITE)=""
"RTN","PSORX1",62,0)
 ..Q:TFILIST'[(U_$P(TFL(TFLP),U,5)_U)
"RTN","PSORX1",63,0)
 ..S TFLCNT=$G(TFLCNT)+1
"RTN","PSORX1",64,0)
 .I $G(TFLCNT)<2 Q
"RTN","PSORX1",65,0)
 .I '$$GET1^DIQ(59,PSOSITE,3001,"I") D  Q
"RTN","PSORX1",66,0)
 ..W !!,"The OneVA Pharmacy flag is turned off. Queries will NOT"
"RTN","PSORX1",67,0)
 ..W !,"be made to other VA Pharmacy locations.",!
"RTN","PSORX1",68,0)
 .K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="locations",DIR("A",1)="Would you like to query prescriptions from other OneVA Pharmacy" D ^DIR
"RTN","PSORX1",69,0)
 .K DIR
"RTN","PSORX1",70,0)
 .Q:'Y
"RTN","PSORX1",71,0)
 .W !!,"Please wait. Checking for prescriptions at other VA Pharmacy locations. This may take a moment...",!
"RTN","PSORX1",72,0)
 .D REMOTERX^PSORRX1(PSODFN,PSOSITE)
"RTN","PSORX1",73,0)
 N PSOUPDT
"RTN","PSORX1",74,0)
 S PSOUPDT=1
"RTN","PSORX1",75,0)
 I $G(XQY0)["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",76,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",77,0)
 D:($G(XQY0)["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",78,0)
 ;
"RTN","PSORX1",79,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",80,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",81,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",82,0)
 ;Call to display remote/local prescriptions
"RTN","PSORX1",83,0)
 I '$G(PSOFIN) D RDICHK^PSORMRX(PSODFN)
"RTN","PSORX1",84,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",85,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",86,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",87,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",88,0)
 D RXSTA
"RTN","PSORX1",89,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",90,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",91,0)
 .L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",92,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",93,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",94,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",95,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",96,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",97,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="RX PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",98,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",99,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",100,0)
 ..I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",101,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",102,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",103,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",104,0)
 D ^PSOBUILD
"RTN","PSORX1",105,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",106,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",107,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",108,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",109,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",110,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",111,0)
 I $O(RXFL("")),$P(^PS(55,PSODFN,0),"^",7)="" D
"RTN","PSORX1",112,0)
 . N %
"RTN","PSORX1",113,0)
 . D NOW^%DTC
"RTN","PSORX1",114,0)
 . S $P(^PS(55,PSODFN,0),"^",7)=$E(%,1,12),$P(^(0),"^",8)="A" D LOGDFN^PSUHL(PSODFN)
"RTN","PSORX1",115,0)
PTX ;
"RTN","PSORX1",116,0)
 K X,Y,^TMP("PS",$J),^TMP($J,"PSEXC","OUT"),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR,PSOPTLK
"RTN","PSORX1",117,0)
 Q
"RTN","PSORX1",118,0)
EOJ ;
"RTN","PSORX1",119,0)
 I $G(PSODFN) K ^TMP($J,"PSOINTERVENE",PSODFN)
"RTN","PSORX1",120,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC
"RTN","PSORX1",121,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",122,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",123,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",124,0)
 K ^TMP("PSORXDD",$J),^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J),^TMP("PSORXPO",$J)
"RTN","PSORX1",125,0)
 I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",126,0)
 K ^TMP("PSORXBO",$J),PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG,^TMP($J,"PSOFLPO")
"RTN","PSORX1",127,0)
 K PPL,PPL1,PSOQFLAG ;*334 ADDED KILLS
"RTN","PSORX1",128,0)
 K ^XTMP("PSORRX1",$J),PSORCNT ;*454 added kill
"RTN","PSORX1",129,0)
 Q
"RTN","PSORX1",130,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",131,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",132,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",133,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",134,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",135,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",136,0)
 K N
"RTN","PSORX1",137,0)
 Q
"RTN","PSORX1",138,0)
PROFILE ;
"RTN","PSORX1",139,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",140,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",141,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",142,0)
 K PSOX
"RTN","PSORX1",143,0)
PROFILEX Q
"RTN","PSORX1",144,0)
 ;
"RTN","PSORX1",145,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",146,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",147,0)
 N MAIL
"RTN","PSORX1",148,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",149,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions. Please select mail"
"RTN","PSORX1",150,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",151,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",152,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",153,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",154,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",155,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",156,0)
 Q
"RTN","PSORX1",157,0)
REMOTE ; 
"RTN","PSORX1",158,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSORX1",159,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSORX1",160,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSORX1",161,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)'>IOSL) Q
"RTN","PSORX1",162,0)
 Q
"RTN","PSORX1",163,0)
PAUSE ;
"RTN","PSORX1",164,0)
 W ! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORX1",165,0)
 Q
"RTN","PSORX1",166,0)
 ;
"RTN","PSORX1",167,0)
RXSTA ; DISPLAY ELIGIBILITY & PROMPT FOR RX PATIENT STATUS
"RTN","PSORX1",168,0)
 N DA,PSOSTA
"RTN","PSORX1",169,0)
 I '$G(PSODFN) Q
"RTN","PSORX1",170,0)
 S DA=PSODFN,PSOSTA=$G(^PS(55,PSODFN,"PS"))
"RTN","PSORX1",171,0)
 I $G(XQY0)["PSO LMOE FINISH"!(XQY0["PSO LM BACKDOOR ORDERS") I PSOSTA]"" D
"RTN","PSORX1",172,0)
 .D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSORX1",173,0)
 .S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",174,0)
 .S DIC("A")="RX PATIENT STATUS: ",DIC("B")=PSOSTA,DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",175,0)
 .I +Y>0,+Y'=PSOSTA S DIE="^PS(55,",DR="3////"_+Y D ^DIE
"RTN","PSORX1",176,0)
 Q
"SEC","^DIC",52.09,52.09,0,"DD")
#
"SEC","^DIC",52.09,52.09,0,"DEL")
p
"SEC","^DIC",52.09,52.09,0,"LAYGO")
P
"SEC","^DIC",52.09,52.09,0,"RD")
P
"SEC","^DIC",52.09,52.09,0,"WR")
P
"UP",52,52.1,-1)
52^1
"UP",52,52.1,0)
52.1
"UP",52,52.2,-1)
52^P
"UP",52,52.2,0)
52.2
"VER")
8.0^22.0
"^DD",52,52.1,91,0)
REMOTE FILL SITE^P4'^DIC(4,^RF;1^Q
"^DD",52,52.1,91,1,0)
^.1
"^DD",52,52.1,91,1,1,0)
52^RFIL
"^DD",52,52.1,91,1,1,1)
S ^PSRX("RFIL",$E(X,1,30),DA(1),DA)=""
"^DD",52,52.1,91,1,1,2)
K ^PSRX("RFIL",$E(X,1,30),DA(1),DA)
"^DD",52,52.1,91,1,1,"%D",0)
^.101^1^1^3140506^^
"^DD",52,52.1,91,1,1,"%D",1,0)
Index to identify remote refills.
"^DD",52,52.1,91,1,1,"DT")
3140426
"^DD",52,52.1,91,3)
Select the remote fill site taking action on this prescription.
"^DD",52,52.1,91,21,0)
^.001^2^2^3160308^^^
"^DD",52,52.1,91,21,1,0)
This is the institution number of the facility that performed the 
"^DD",52,52.1,91,21,2,0)
physical refill.
"^DD",52,52.1,91,"DT")
3140426
"^DD",52,52.1,92,0)
REMOTE PHARMACIST^F^^RF;2^K:$L(X)>45!($L(X)<1) X
"^DD",52,52.1,92,3)
Answer must be 1-45 characters in length.
"^DD",52,52.1,92,21,0)
^^2^2^3140422^
"^DD",52,52.1,92,21,1,0)
This is the name of the Pharmacist that remotely completed a refill for a 
"^DD",52,52.1,92,21,2,0)
prescription.
"^DD",52,52.1,92,"DT")
3140422
"^DD",52,52.1,93,0)
REMOTE PHARMACIST PHONE^F^^RF;3^K:$L(X)>15!($L(X)<1) X
"^DD",52,52.1,93,3)
Answer must be 1-15 characters in length.
"^DD",52,52.1,93,21,0)
^^2^2^3140422^
"^DD",52,52.1,93,21,1,0)
This is the contact telephone number for the remote pharmacist requesting 
"^DD",52,52.1,93,21,2,0)
a refill.
"^DD",52,52.1,93,"DT")
3140422
"^DD",52,52.2,91,0)
REMOTE FILL SITE^P4'^DIC(4,^PF;1^Q
"^DD",52,52.2,91,1,0)
^.1
"^DD",52,52.2,91,1,1,0)
52^PFIL
"^DD",52,52.2,91,1,1,1)
S ^PSRX("PFIL",$E(X,1,30),DA(1),DA)=""
"^DD",52,52.2,91,1,1,2)
K ^PSRX("PFIL",$E(X,1,30),DA(1),DA)
"^DD",52,52.2,91,1,1,"%D",0)
^^1^1^3160308^
"^DD",52,52.2,91,1,1,"%D",1,0)
Index to identify partial fill site.
"^DD",52,52.2,91,1,1,"DT")
3140426
"^DD",52,52.2,91,3)
Enter the site number that is requesting this partial fill.
"^DD",52,52.2,91,21,0)
^.001^2^2^3160308^^
"^DD",52,52.2,91,21,1,0)
This holds the site number for the facility requesting a remote partial 
"^DD",52,52.2,91,21,2,0)
fill.
"^DD",52,52.2,91,"DT")
3140426
"^DD",52,52.2,92,0)
REMOTE PHARMACIST^F^^PF;2^K:$L(X)>45!($L(X)<1) X
"^DD",52,52.2,92,3)
Enter the name of the Pharmacist that made this remote partial fill request. 1-45 characters.
"^DD",52,52.2,92,21,0)
^.001^2^2^3160308^^
"^DD",52,52.2,92,21,1,0)
This holds the name of the pharmacist that initiated the remote partail 
"^DD",52,52.2,92,21,2,0)
fill request.
"^DD",52,52.2,92,"DT")
3140426
"^DD",52,52.2,93,0)
REMOTE PHARMACIST PHONE^F^^PF;3^K:$L(X)>15!($L(X)<1) X
"^DD",52,52.2,93,3)
Enter the contact telephone number for the pharmacist requesting this partial fill. 1-15 characters.
"^DD",52,52.2,93,21,0)
^.001^2^2^3160308^^
"^DD",52,52.2,93,21,1,0)
This is the contact number for the remote pharmacist who initiated this 
"^DD",52,52.2,93,21,2,0)
partial fill request.
"^DD",52,52.2,93,"DT")
3140426
"^DD",52.09,52.09,0)
FIELD^^1.3^17
"^DD",52.09,52.09,0,"DDA")
N
"^DD",52.09,52.09,0,"DT")
3160629
"^DD",52.09,52.09,0,"IX","B",52.09,.01)

"^DD",52.09,52.09,0,"IX","C",52.09,.02)

"^DD",52.09,52.09,0,"IX","D",52.09,.03)

"^DD",52.09,52.09,0,"IX","E",52.09,.04)

"^DD",52.09,52.09,0,"NM","REMOTE PRESCRIPTION LOG")

"^DD",52.09,52.09,0,"VRPK")
PSO
"^DD",52.09,52.09,.01,0)
LOG DATE/TIME^RD^^0;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",52.09,52.09,.01,1,0)
^.1
"^DD",52.09,52.09,.01,1,1,0)
52.09^B
"^DD",52.09,52.09,.01,1,1,1)
S ^PSRXR(52.09,"B",$E(X,1,30),DA)=""
"^DD",52.09,52.09,.01,1,1,2)
K ^PSRXR(52.09,"B",$E(X,1,30),DA)
"^DD",52.09,52.09,.01,3)
Enter the date/time for this transaction.
"^DD",52.09,52.09,.01,21,0)
^^3^3^3140426^
"^DD",52.09,52.09,.01,21,1,0)
This is the date/time associated with this remote prescription 
"^DD",52.09,52.09,.01,21,2,0)
transaction. The date/time represents the date/time the message was 
"^DD",52.09,52.09,.01,21,3,0)
processed and filed locally.
"^DD",52.09,52.09,.01,"DT")
3140426
"^DD",52.09,52.09,.02,0)
PATIENT^RP2'^DPT(^0;2^Q
"^DD",52.09,52.09,.02,1,0)
^.1
"^DD",52.09,52.09,.02,1,1,0)
52.09^C
"^DD",52.09,52.09,.02,1,1,1)
S ^PSRXR(52.09,"C",$E(X,1,30),DA)=""
"^DD",52.09,52.09,.02,1,1,2)
K ^PSRXR(52.09,"C",$E(X,1,30),DA)
"^DD",52.09,52.09,.02,1,1,"%D",0)
^^1^1^3140426^
"^DD",52.09,52.09,.02,1,1,"%D",1,0)
Cross reference for patient IEN.
"^DD",52.09,52.09,.02,1,1,"DT")
3140426
"^DD",52.09,52.09,.02,3)
Enter the Patient for which this refill or partial fill occured.
"^DD",52.09,52.09,.02,21,0)
^^2^2^3140426^
"^DD",52.09,52.09,.02,21,1,0)
This is the patient for which a refill or partial fill request was 
"^DD",52.09,52.09,.02,21,2,0)
generated.
"^DD",52.09,52.09,.02,"DT")
3140426
"^DD",52.09,52.09,.03,0)
RX NUMBER^RF^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",52.09,52.09,.03,1,0)
^.1
"^DD",52.09,52.09,.03,1,1,0)
52.09^D
"^DD",52.09,52.09,.03,1,1,1)
S ^PSRXR(52.09,"D",$E(X,1,30),DA)=""
"^DD",52.09,52.09,.03,1,1,2)
K ^PSRXR(52.09,"D",$E(X,1,30),DA)
"^DD",52.09,52.09,.03,1,1,"%D",0)
^^1^1^3160308^
"^DD",52.09,52.09,.03,1,1,"%D",1,0)
Cross reference for remote RX number.
"^DD",52.09,52.09,.03,1,1,"DT")
3140426
"^DD",52.09,52.09,.03,3)
Enter the remote RX number. This is the RX number from the remote facility. 1-20 characters.
"^DD",52.09,52.09,.03,21,0)
^.001^1^1^3160308^^
"^DD",52.09,52.09,.03,21,1,0)
The RX# as stored at the remote facility.
"^DD",52.09,52.09,.03,"DT")
3140426
"^DD",52.09,52.09,.04,0)
SITE NUMBER^RP4'^DIC(4,^0;4^Q
"^DD",52.09,52.09,.04,1,0)
^.1
"^DD",52.09,52.09,.04,1,1,0)
52.09^E
"^DD",52.09,52.09,.04,1,1,1)
S ^PSRXR(52.09,"E",$E(X,1,30),DA)=""
"^DD",52.09,52.09,.04,1,1,2)
K ^PSRXR(52.09,"E",$E(X,1,30),DA)
"^DD",52.09,52.09,.04,1,1,"%D",0)
^^1^1^3140428^
"^DD",52.09,52.09,.04,1,1,"%D",1,0)
Site Number Cross reference.
"^DD",52.09,52.09,.04,1,1,"DT")
3140428
"^DD",52.09,52.09,.04,3)
Select the site associated with this remote RX.
"^DD",52.09,52.09,.04,21,0)
^.001^1^1^3160308^^
"^DD",52.09,52.09,.04,21,1,0)
Site number for the remote facility.
"^DD",52.09,52.09,.04,"DT")
3140428
"^DD",52.09,52.09,.05,0)
REQUEST TYPE^S^RF:REFILL;PR:PARTIAL FILL;OR:OUTSIDE REFILL;OP:OUTSIDE PARTIAL FILL;^0;5^Q
"^DD",52.09,52.09,.05,3)
Select the type of request being made. Refill(RF), Partial Fill(PR), Outside Refill (OR), or Outside Partial Fill (OP).
"^DD",52.09,52.09,.05,21,0)
^.001^1^1^3160308^^^^
"^DD",52.09,52.09,.05,21,1,0)
This fields holds the type of request being made for this RX.
"^DD",52.09,52.09,.05,"DT")
3140804
"^DD",52.09,52.09,.06,0)
OUTGOING REQUEST PHARMACIST^RP200'^VA(200,^0;6^Q
"^DD",52.09,52.09,.06,3)
Enter the Pharmacist for this refill or partial fill request.
"^DD",52.09,52.09,.06,21,0)
^^2^2^3140426^
"^DD",52.09,52.09,.06,21,1,0)
This is the Pharmacist who initiated the refill or partial fill request 
"^DD",52.09,52.09,.06,21,2,0)
to the remote facility.
"^DD",52.09,52.09,.06,"DT")
3140804
"^DD",52.09,52.09,.061,0)
REMOTE FILLING PHARMACIST^F^^0;11^K:$L(X)>30!($L(X)<3) X
"^DD",52.09,52.09,.061,3)
Answer must be 3-30 characters in length.
"^DD",52.09,52.09,.061,21,0)
^^1^1^3160308^
"^DD",52.09,52.09,.061,21,1,0)
This is the pharmacist taking action on the selected RX.
"^DD",52.09,52.09,.061,"DT")
3140804
"^DD",52.09,52.09,.07,0)
QUANTITY^NJ4,0^^0;7^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.09,52.09,.07,3)
Enter the quantity that was dispensed with this refill or partial fill.
"^DD",52.09,52.09,.07,21,0)
^^1^1^3140426^
"^DD",52.09,52.09,.07,21,1,0)
This is the quantity associated with this refill or partial fill.
"^DD",52.09,52.09,.07,"DT")
3140426
"^DD",52.09,52.09,.08,0)
DAYS SUPPLY^NJ3,0^^0;8^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.09,52.09,.08,3)
Enter the days supply for this refill or partial fill. A numeric value 0-999.
"^DD",52.09,52.09,.08,21,0)
^.001^1^1^3160308^^
"^DD",52.09,52.09,.08,21,1,0)
This is the days supply for this refill or partial fill action.
"^DD",52.09,52.09,.08,"DT")
3140426
"^DD",52.09,52.09,.09,0)
REFILL/PARTIAL DATE^D^^0;9^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.09,52.09,.09,3)
Enter the date/time for this refill or partial fill request.
"^DD",52.09,52.09,.09,21,0)
^^4^4^3160309^
"^DD",52.09,52.09,.09,21,1,0)
This is the date for the refill or partial fill request. This represents 
"^DD",52.09,52.09,.09,21,2,0)
the date/time as it is logged in the .01 field of either the REFILL or
"^DD",52.09,52.09,.09,21,3,0)
PARTIAL fill.
"^DD",52.09,52.09,.09,21,4,0)
subfile within the PRESCRIPTION file (#52) on the remote system.
"^DD",52.09,52.09,.09,"DT")
3160308
"^DD",52.09,52.09,.1,0)
DISPENSED DATE^D^^0;10^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.09,52.09,.1,3)
Enter the dispense date for this refill or partial fill request.
"^DD",52.09,52.09,.1,21,0)
^.001^3^3^3160309^^
"^DD",52.09,52.09,.1,21,1,0)
This is the Dispense date/time as it is held in the DISPENSED DATE within 
"^DD",52.09,52.09,.1,21,2,0)
the REFILL subfile of the PRESCRIPTION (#52) file, or the DISPENSED DATE 
"^DD",52.09,52.09,.1,21,3,0)
within the PARTIAL subfile of the PRESCRIPTION file.
"^DD",52.09,52.09,.1,"DT")
3160308
"^DD",52.09,52.09,1,0)
REMOTE DRUG NAME^F^^1;1^K:$L(X)>120!($L(X)<1) X
"^DD",52.09,52.09,1,3)
Enter the name of the drug associated with this refill or partial fill request, 1-120 characters.
"^DD",52.09,52.09,1,21,0)
^.001^1^1^3160308^^^
"^DD",52.09,52.09,1,21,1,0)
This is the name of the drug being dispense for this request.
"^DD",52.09,52.09,1,"DT")
3140812
"^DD",52.09,52.09,1.1,0)
LOCAL (MATCHED) DRUG^P50'^PSDRUG(^1;2^Q
"^DD",52.09,52.09,1.1,3)
Enter the name of the local drug that matches the remote (incoming) drug.
"^DD",52.09,52.09,1.1,21,0)
^.001^3^3^3160308^^
"^DD",52.09,52.09,1.1,21,1,0)
This is the drug that was used for locally for the 'remote' refill or 
"^DD",52.09,52.09,1.1,21,2,0)
partial fill. Since drug IENS and names may differ between sites, a user 
"^DD",52.09,52.09,1.1,21,3,0)
must match the remote drug name to a local drug.
"^DD",52.09,52.09,1.1,"DT")
3140812
"^DD",52.09,52.09,1.2,0)
TOTAL REFILL/PARTIAL FILL COST^NJ15,7^^1;3^K:+X'=X!(X>9999999.9999999)!(X<0)!(X?.E1"."8.N) X
"^DD",52.09,52.09,1.2,3)
Type a number between 0 and 9999999.9999999, 7 decimal digits.
"^DD",52.09,52.09,1.2,21,0)
^^3^3^3160629^^
"^DD",52.09,52.09,1.2,21,1,0)
This is the total cost for the 'remote'/filling facility. The cost is 
"^DD",52.09,52.09,1.2,21,2,0)
derived by using the cost of the drug at the time of the refill or 
"^DD",52.09,52.09,1.2,21,3,0)
partial fill. The cost is being retrieved from file 50, field 13.
"^DD",52.09,52.09,1.2,"DT")
3160629
"^DD",52.09,52.09,1.3,0)
VA PRODUCT ID^F^^1;4^K:$L(X)>50!($L(X)<1) X
"^DD",52.09,52.09,1.3,3)
Answer must be 1-50 characters in length.
"^DD",52.09,52.09,1.3,21,0)
^.001^2^2^3160406^^^
"^DD",52.09,52.09,1.3,21,1,0)
This is the VA product ID that will be passed in by the 'host' vista 
"^DD",52.09,52.09,1.3,21,2,0)
system.
"^DD",52.09,52.09,1.3,"DT")
3160406
"^DD",52.09,52.09,2,0)
MESSAGE DETAILS^52.092^^2;0
"^DD",52.09,52.09,2,21,0)
^^2^2^3160308^
"^DD",52.09,52.09,2,21,1,0)
This is the HL7 message that is associated with the refill or partial 
"^DD",52.09,52.09,2,21,2,0)
fill request.
"^DD",52.09,52.09,3,0)
LABEL DATA^52.093^^3;0
"^DD",52.09,52.09,3,21,0)
^^2^2^3160308^
"^DD",52.09,52.09,3,21,1,0)
This contains the label data returned from the remote facility for a 
"^DD",52.09,52.09,3,21,2,0)
refill or partial fill.
"^DD",52.09,52.092,0)
MESSAGE DETAILS SUB-FIELD^^.01^1
"^DD",52.09,52.092,0,"DT")
3140426
"^DD",52.09,52.092,0,"NM","MESSAGE DETAILS")

"^DD",52.09,52.092,0,"UP")
52.09
"^DD",52.09,52.092,.01,0)
MESSAGE DETAILS^Wx^^0;1^Q
"^DD",52.09,52.092,.01,3)
Enter the message details for this refill or partial fill request.
"^DD",52.09,52.092,.01,21,0)
^.001^2^2^3160308^^^
"^DD",52.09,52.092,.01,21,1,0)
Contains the message details that were passed back by the remote system. 
"^DD",52.09,52.092,.01,21,2,0)
This gives more information on what occured with this RX request.
"^DD",52.09,52.092,.01,"DT")
3140426
"^DD",52.09,52.093,0)
LABEL DATA SUB-FIELD^^.01^1
"^DD",52.09,52.093,0,"DT")
3140828
"^DD",52.09,52.093,0,"NM","LABEL DATA")

"^DD",52.09,52.093,0,"UP")
52.09
"^DD",52.09,52.093,.01,0)
LABEL DATA^WLx^^0;1^Q
"^DD",52.09,52.093,.01,3)
Enter the label data, as processed and generated by the remote facility.
"^DD",52.09,52.093,.01,21,0)
^.001^2^2^3160308^^^^
"^DD",52.09,52.093,.01,21,1,0)
This is the label data that was built by the remote facility for printing 
"^DD",52.09,52.093,.01,21,2,0)
at the local (requesting) facility.
"^DD",52.09,52.093,.01,"DT")
3140828
"^DD",59,59,3001,0)
ONEVA PHARMACY FLAG^S^1:ON;0:OFF;^9;2^Q
"^DD",59,59,3001,3)
Select '1' to turn on the OneVA Pharmacy remote prescription logic. Select '0' to turn it off.
"^DD",59,59,3001,21,0)
^^6^6^3160706^
"^DD",59,59,3001,21,1,0)
This flag controls the functionality of the OneVA Pharmacy remote 
"^DD",59,59,3001,21,2,0)
prescription logic. If the flag is turned on, this facility will be able 
"^DD",59,59,3001,21,3,0)
to query prescriptions from other facilities, and will accept incoming 
"^DD",59,59,3001,21,4,0)
refill and partial fills from other VA medical facilities. If the flag is 
"^DD",59,59,3001,21,5,0)
turned 'off', no queries will be made, and external refill/partial fill 
"^DD",59,59,3001,21,6,0)
requests will be declined.
"^DD",59,59,3001,"DT")
3160530
"^DIC",52.09,52.09,0)
REMOTE PRESCRIPTION LOG^52.09
"^DIC",52.09,52.09,0,"GL")
^PSRXR(52.09,
"^DIC",52.09,52.09,"%",0)
^1.005^1^1
"^DIC",52.09,52.09,"%",1,0)
PSO
"^DIC",52.09,52.09,"%","B","PSO",1)

"^DIC",52.09,52.09,"%D",0)
^1.001^3^3^3160517^^^^
"^DIC",52.09,52.09,"%D",1,0)
This file logs all activity related to remote refills and partial fills. 
"^DIC",52.09,52.09,"%D",2,0)
This file will hold actions taken locally on a remote prescription, as 
"^DIC",52.09,52.09,"%D",3,0)
well as actions taken by an external facility on any local prescriptions.
"^DIC",52.09,"B","REMOTE PRESCRIPTION LOG",52.09)

"BLD",9799,6)
^388
**END**
**END**

