Released PSO*7*362 SEQ #365
Extracted from mail message
**KIDS**:PSO*7.0*362^

**INSTALL NAME**
PSO*7.0*362
"BLD",9277,0)
PSO*7.0*362^OUTPATIENT PHARMACY^0^3130719^y
"BLD",9277,1,0)
^^8^8^3130719^
"BLD",9277,1,1,0)
This patch resolves the following issues:
"BLD",9277,1,2,0)
Prevent labels for patients whose mail is routed from being marked as a
"BLD",9277,1,3,0)
foreign address.
"BLD",9277,1,4,0)
 
"BLD",9277,1,5,0)
A patient's prescription is changing from Co-pay to No Co-pay when
"BLD",9277,1,6,0)
it is released.
"BLD",9277,1,7,0)
 
"BLD",9277,1,8,0)
The Sig does not match between the prescription and the order.
"BLD",9277,4,0)
^9.64PA^^
"BLD",9277,6.3)
8
"BLD",9277,"ABPKG")
n
"BLD",9277,"KRN",0)
^9.67PA^779.2^20
"BLD",9277,"KRN",.4,0)
.4
"BLD",9277,"KRN",.401,0)
.401
"BLD",9277,"KRN",.402,0)
.402
"BLD",9277,"KRN",.403,0)
.403
"BLD",9277,"KRN",.5,0)
.5
"BLD",9277,"KRN",.84,0)
.84
"BLD",9277,"KRN",3.6,0)
3.6
"BLD",9277,"KRN",3.8,0)
3.8
"BLD",9277,"KRN",9.2,0)
9.2
"BLD",9277,"KRN",9.8,0)
9.8
"BLD",9277,"KRN",9.8,"NM",0)
^9.68A^6^4
"BLD",9277,"KRN",9.8,"NM",2,0)
PSOOREDX^^0^B19671149
"BLD",9277,"KRN",9.8,"NM",3,0)
PSORN52^^0^B44851851
"BLD",9277,"KRN",9.8,"NM",5,0)
PSOBAIR2^^0^B40647574
"BLD",9277,"KRN",9.8,"NM",6,0)
PSOSULOG^^0^B63262026
"BLD",9277,"KRN",9.8,"NM","B","PSOBAIR2",5)

"BLD",9277,"KRN",9.8,"NM","B","PSOOREDX",2)

"BLD",9277,"KRN",9.8,"NM","B","PSORN52",3)

"BLD",9277,"KRN",9.8,"NM","B","PSOSULOG",6)

"BLD",9277,"KRN",19,0)
19
"BLD",9277,"KRN",19,"NM",0)
^9.68A^^
"BLD",9277,"KRN",19.1,0)
19.1
"BLD",9277,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9277,"KRN",101,0)
101
"BLD",9277,"KRN",101,"NM",0)
^9.68A^^
"BLD",9277,"KRN",409.61,0)
409.61
"BLD",9277,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9277,"KRN",771,0)
771
"BLD",9277,"KRN",771,"NM",0)
^9.68A^^
"BLD",9277,"KRN",779.2,0)
779.2
"BLD",9277,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",9277,"KRN",870,0)
870
"BLD",9277,"KRN",870,"NM",0)
^9.68A^^
"BLD",9277,"KRN",8989.51,0)
8989.51
"BLD",9277,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",9277,"KRN",8989.52,0)
8989.52
"BLD",9277,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9277,"KRN",8994,0)
8994
"BLD",9277,"KRN",8994,"NM",0)
^9.68A^^
"BLD",9277,"KRN","B",.4,.4)

"BLD",9277,"KRN","B",.401,.401)

"BLD",9277,"KRN","B",.402,.402)

"BLD",9277,"KRN","B",.403,.403)

"BLD",9277,"KRN","B",.5,.5)

"BLD",9277,"KRN","B",.84,.84)

"BLD",9277,"KRN","B",3.6,3.6)

"BLD",9277,"KRN","B",3.8,3.8)

"BLD",9277,"KRN","B",9.2,9.2)

"BLD",9277,"KRN","B",9.8,9.8)

"BLD",9277,"KRN","B",19,19)

"BLD",9277,"KRN","B",19.1,19.1)

"BLD",9277,"KRN","B",101,101)

"BLD",9277,"KRN","B",409.61,409.61)

"BLD",9277,"KRN","B",771,771)

"BLD",9277,"KRN","B",779.2,779.2)

"BLD",9277,"KRN","B",870,870)

"BLD",9277,"KRN","B",8989.51,8989.51)

"BLD",9277,"KRN","B",8989.52,8989.52)

"BLD",9277,"KRN","B",8994,8994)

"BLD",9277,"QDEF")
^^^^NO^^^^^^YES
"BLD",9277,"QUES",0)
^9.62^^
"BLD",9277,"REQB",0)
^9.611^4^3
"BLD",9277,"REQB",2,0)
PSO*7.0*133^2
"BLD",9277,"REQB",3,0)
PSO*7.0*379^2
"BLD",9277,"REQB",4,0)
PSO*7.0*264^2
"BLD",9277,"REQB","B","PSO*7.0*133",2)

"BLD",9277,"REQB","B","PSO*7.0*264",4)

"BLD",9277,"REQB","B","PSO*7.0*379",3)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
362^3130719
"PKG",206,22,1,"PAH",1,1,0)
^^8^8^3130719
"PKG",206,22,1,"PAH",1,1,1,0)
This patch resolves the following issues:
"PKG",206,22,1,"PAH",1,1,2,0)
Prevent labels for patients whose mail is routed from being marked as a
"PKG",206,22,1,"PAH",1,1,3,0)
foreign address.
"PKG",206,22,1,"PAH",1,1,4,0)
 
"PKG",206,22,1,"PAH",1,1,5,0)
A patient's prescription is changing from Co-pay to No Co-pay when
"PKG",206,22,1,"PAH",1,1,6,0)
it is released.
"PKG",206,22,1,"PAH",1,1,7,0)
 
"PKG",206,22,1,"PAH",1,1,8,0)
The Sig does not match between the prescription and the order.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOBAIR2")
0^5^B40647574^B39307918
"RTN","PSOBAIR2",1,0)
PSOBAIR2 ;BIR/RTR-Report of suspended prescriptions with bad address ;08/16/2006
"RTN","PSOBAIR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233,200,264,362**;DEC 1997;Build 8
"RTN","PSOBAIR2",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOBAIR2",4,0)
EN ;
"RTN","PSOBAIR2",5,0)
 N PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2,PSUSDIV,PII,PSOCNT,PSOBDF
"RTN","PSOBAIR2",6,0)
 W !!,"This option shows unprinted suspended prescriptions for the following:",!
"RTN","PSOBAIR2",7,0)
 W !,"- BAD ADDRESS INDICATOR set in the PATIENT file (#2) and no active temporary",!,"  address"
"RTN","PSOBAIR2",8,0)
 W !,"- DO NOT MAIL set in the PHARMACY PATIENT file (#55)"
"RTN","PSOBAIR2",9,0)
 W !,"- FOREIGN ADDRESS set in the PATIENT file (#2) and no active US temporary",!,"  address",!
"RTN","PSOBAIR2",10,0)
 K DIR S DIR(0)="S^B:Bad Address Indicator;D:Do Not Mail;F:Foreign;A:All;",DIR("B")="A"
"RTN","PSOBAIR2",11,0)
 S DIR("A")="Print for Bad Address Indicator/Do Not Mail/Foreign/All (B/D/F/A)"
"RTN","PSOBAIR2",12,0)
 S DIR("?")="Print prescriptions with Bad Address Indicated/Do Not Mail/Foreign Address, or all"
"RTN","PSOBAIR2",13,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) D MESS Q
"RTN","PSOBAIR2",14,0)
 S PSOBDF=Y
"RTN","PSOBAIR2",15,0)
DATE ;
"RTN","PSOBAIR2",16,0)
 W ! S %DT="AEX",%DT("A")="Ending suspense date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIR2",17,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOBAIR2",18,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOBAIR2",19,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) D MESS Q
"RTN","PSOBAIR2",20,0)
 S PSOCNT=0 F PII=0:0 S PII=$O(^PS(59,PII)) Q:'PII  S PSOCNT=PSOCNT+1
"RTN","PSOBAIR2",21,0)
 I PSOCNT=1 G SKIP
"RTN","PSOBAIR2",22,0)
 W !!?3,"You are logged in under the "_$P($G(^PS(59,+$G(PSOSITE),0)),"^")_" division.",!
"RTN","PSOBAIR2",23,0)
 K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Print only those Rx's suspended for this division",DIR("?")="Enter 'Yes' to print only those Rx's for this division, enter 'No' to print Rx's suspended for all divisions."
"RTN","PSOBAIR2",24,0)
 D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS Q
"RTN","PSOBAIR2",25,0)
 S PSUSDIV=Y
"RTN","PSOBAIR2",26,0)
SKIP ;
"RTN","PSOBAIR2",27,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOBAIR2",28,0)
 I $D(IO("Q")) D  Q
"RTN","PSOBAIR2",29,0)
 .N GG
"RTN","PSOBAIR2",30,0)
 .S ZTRTN="REP^PSOBAIR2",ZTDESC="Pharmacy bad address suspense report" D
"RTN","PSOBAIR2",31,0)
 ..F GG="PSOSITE","PSOAPAT","PSOSDT","PSOEDT","PSOEDTX","PSOSDTX","PSUSDIV" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOBAIR2",32,0)
 ..S ZTSAVE("PSOBDF*")="" D ^%ZTLOAD K %ZIS
"RTN","PSOBAIR2",33,0)
 .W !!,"Report queued to print.",!
"RTN","PSOBAIR2",34,0)
REP ;
"RTN","PSOBAIR2",35,0)
 K ^TMP("PSOBADL",$J) S (PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0
"RTN","PSOBAIR2",36,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,SFN,PSOADATE,PSOC,PSOAALL,PSODFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOBAIR2",37,0)
 U IO
"RTN","PSOBAIR2",38,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOBAIR2",39,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOBAIR2",40,0)
ALL ;
"RTN","PSOBAIR2",41,0)
 N PSORD,SFN,PSOLBL,PSOX,PSODFN,RXIEN,PRINTED,RXSITE,RXSTS,PARTIAL
"RTN","PSOBAIR2",42,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(52.5,"AC",PSODFN)) Q:'PSODFN  D
"RTN","PSOBAIR2",43,0)
 .S (PSOBAI,PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0 D CHKADDR,FOREIGN,CHKMAIL Q:(PSOBDF("B")+PSOBDF("D")+PSOBDF("F"))=0
"RTN","PSOBAIR2",44,0)
 .Q:(PSOBDF="A"&'(PSOBDF("B")!PSOBDF("F")!PSOBDF("D")))  I PSOBDF'="A" Q:('PSOBDF(PSOBDF))
"RTN","PSOBAIR2",45,0)
 .S PSORD=0 F  S PSORD=$O(^PS(52.5,"AC",PSODFN,PSORD)) Q:'PSORD!(PSORD>PSOEDT)  D
"RTN","PSOBAIR2",46,0)
 ..S SFN=0 F  S SFN=$O(^PS(52.5,"AC",PSODFN,PSORD,SFN)) Q:'SFN  D DETAIL
"RTN","PSOBAIR2",47,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(52.5,"AG",PSODFN)) Q:'PSODFN  D
"RTN","PSOBAIR2",48,0)
 .S (PSOBAI,PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0 D CHKADDR,FOREIGN,CHKMAIL Q:(PSOBDF("B")+PSOBDF("D")+PSOBDF("F"))=0
"RTN","PSOBAIR2",49,0)
 .Q:(PSOBDF="A"&'(PSOBDF("B")!PSOBDF("F")!PSOBDF("D")))  I PSOBDF'="A" Q:('PSOBDF(PSOBDF))
"RTN","PSOBAIR2",50,0)
 .S SFN=0 F  S SFN=$O(^PS(52.5,"AG",PSODFN,SFN)) Q:'SFN  D
"RTN","PSOBAIR2",51,0)
 ..S PSORD=$G(^PS(52.5,SFN,0)),PSORD=$P(PSORD,"^",2) I PSORD<PSOEDT D DETAIL
"RTN","PSOBAIR2",52,0)
 D HD
"RTN","PSOBAIR2",53,0)
 I '$D(^TMP("PSOBADL",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOBAIR2",54,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOBADL",$J,PSONI)) Q:PSONI=""!(PSOUT)  D
"RTN","PSOBAIR2",55,0)
 .S PSONX="" F  S PSONX=$O(^TMP("PSOBADL",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME,PRALL D
"RTN","PSOBAIR2",56,0)
 ..S PSONB="" F  S PSONB=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOBAIR2",57,0)
 ...S SFN="" F  S SFN=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,SFN)) Q:SFN=""!(PSOUT)  D
"RTN","PSOBAIR2",58,0)
 ....I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",59,0)
 ....S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOBAIR2",60,0)
 ....S PNODE=$G(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,SFN)) D PRONE
"RTN","PSOBAIR2",61,0)
END ;
"RTN","PSOBAIR2",62,0)
 I PSOBDF="A" W !!!,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOBAIR2",63,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIR2",64,0)
 K DTOUT,DUOUT,PSOBAI
"RTN","PSOBAIR2",65,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAIR2",66,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOBAIR2",67,0)
 I PSODEV W !
"RTN","PSOBAIR2",68,0)
 E  W @IOF
"RTN","PSOBAIR2",69,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBAIR2",70,0)
 Q
"RTN","PSOBAIR2",71,0)
HD ;
"RTN","PSOBAIR2",72,0)
 S PSOAFLAG=1
"RTN","PSOBAIR2",73,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOBAIR2",74,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOBAIR2",75,0)
 E  W @IOF
"RTN","PSOBAIR2",76,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOBAIR2",77,0)
 .W !,"Suspense "_$S(PSOBDF="A":"BAI/DO NOT MAIL/FOREIGN ADRESS",PSOBDF="B":"BAD ADDRESS INDICATOR",PSOBDF="D":"DO NOT MAIL",1:"FOREIGN ADDRESS")_" report - division = ",$S($G(PSUSDIV):$P($G(^PS(59,+$G(PSOSITE),0)),"^"),1:"ALL")
"RTN","PSOBAIR2",78,0)
 W !,"for suspense dates through "_$G(PSOEDTX) W:PSOBDF="A" ?70,"B/D/F"
"RTN","PSOBAIR2",79,0)
 W !,PSOLINE
"RTN","PSOBAIR2",80,0)
 Q
"RTN","PSOBAIR2",81,0)
MESS ;
"RTN","PSOBAIR2",82,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOBAIR2",83,0)
 K DTOUT,DUOUT
"RTN","PSOBAIR2",84,0)
 Q
"RTN","PSOBAIR2",85,0)
NAME ;Set name(ssn)
"RTN","PSOBAIR2",86,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOBAIR2",87,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOBAIR2",88,0)
 K VA
"RTN","PSOBAIR2",89,0)
 Q
"RTN","PSOBAIR2",90,0)
PRALL ;Print data for all patients
"RTN","PSOBAIR2",91,0)
 N PSOADDR
"RTN","PSOBAIR2",92,0)
 S PSOADDR=""
"RTN","PSOBAIR2",93,0)
 S PSOAFLAG=0
"RTN","PSOBAIR2",94,0)
 W !!,$G(PSONSSN) D CHKADDR W ?30,"  ",PSOADDR I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",95,0)
 Q
"RTN","PSOBAIR2",96,0)
PRONE ;Print data for one patient
"RTN","PSOBAIR2",97,0)
 N SFN0
"RTN","PSOBAIR2",98,0)
 S SFN0=$G(^PSRX(SFN,0)) I SFN0=""!($P(SFN0,"^",6)="") Q
"RTN","PSOBAIR2",99,0)
 D CON W !,$G(PSOADATE),?15," Rx#: ",$P(SFN0,"^"),?30,"  ",$P($G(^PSDRUG($P(SFN0,"^",6),0)),"^")
"RTN","PSOBAIR2",100,0)
 W:PSOBDF="A" ?70,PNODE
"RTN","PSOBAIR2",101,0)
 I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",102,0)
 Q
"RTN","PSOBAIR2",103,0)
CON ;
"RTN","PSOBAIR2",104,0)
 I PSOAFLAG W !,$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOBAIR2",105,0)
 Q
"RTN","PSOBAIR2",106,0)
 ;
"RTN","PSOBAIR2",107,0)
CHKADDR ;
"RTN","PSOBAIR2",108,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAIR2",109,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAIR2",110,0)
 I PSOBADR D
"RTN","PSOBAIR2",111,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSODFN)
"RTN","PSOBAIR2",112,0)
 I PSOBADR,'PSOTEMP S (PSOBAI,PSOBDF("B"))=1 Q
"RTN","PSOBAIR2",113,0)
 Q
"RTN","PSOBAIR2",114,0)
 ;
"RTN","PSOBAIR2",115,0)
FOREIGN ;
"RTN","PSOBAIR2",116,0)
 N PSOFORGN,PSON
"RTN","PSOBAIR2",117,0)
 S DFN=PSODFN D ADD^VADPT
"RTN","PSOBAIR2",118,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="" D   ;*362
"RTN","PSOBAIR2",119,0)
 .S PSOBDF("F")=1
"RTN","PSOBAIR2",120,0)
 .S PSON=$$GET1^DIQ(59,PSOSITE,.01)
"RTN","PSOBAIR2",121,0)
 .I PSON'["MANILA",PSOFORGN["UNITED STATES" S PSOBDF("F")=0 Q
"RTN","PSOBAIR2",122,0)
 .I PSON["MANILA",PSOFORGN["PHILIPPINES" S PSOBDF("F")=0
"RTN","PSOBAIR2",123,0)
 Q
"RTN","PSOBAIR2",124,0)
 ;
"RTN","PSOBAIR2",125,0)
CHKMAIL ;
"RTN","PSOBAIR2",126,0)
 N PSOTEMP,MAILEXP
"RTN","PSOBAIR2",127,0)
 S PSOTEMP=$G(^PS(55,PSODFN,0)) Q:$P(PSOTEMP,"^",3)'=2
"RTN","PSOBAIR2",128,0)
 S MAILEXP=$P(PSOTEMP,"^",5) I MAILEXP=""!(MAILEXP>DT) S PSOBDF("D")=1
"RTN","PSOBAIR2",129,0)
 Q
"RTN","PSOBAIR2",130,0)
 ;
"RTN","PSOBAIR2",131,0)
DETAIL ;
"RTN","PSOBAIR2",132,0)
 I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+PSODFN,0)) Q
"RTN","PSOBAIR2",133,0)
 S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I")
"RTN","PSOBAIR2",134,0)
 S RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I")
"RTN","PSOBAIR2",135,0)
 I $G(PSUSDIV),RXSITE'=$G(PSOSITE) Q
"RTN","PSOBAIR2",136,0)
 S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I") I RXSTS>8 Q
"RTN","PSOBAIR2",137,0)
 S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I")
"RTN","PSOBAIR2",138,0)
 I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOBAIR2",139,0)
 S PSOANAME=$P($G(^DPT(PSODFN,0)),"^") Q:PSOANAME=""
"RTN","PSOBAIR2",140,0)
 S ^TMP("PSOBADL",$J,PSOANAME,PSODFN,PSORD,RXIEN)=$S(PSOBDF("B"):"B",PSOBDF("D"):"D",PSOBDF("F"):"F",1:"")
"RTN","PSOBAIR2",141,0)
 Q
"RTN","PSOOREDX")
0^2^B19671149^B19354107
"RTN","PSOOREDX",1,0)
PSOOREDX ;BIR/MHA-Rxs dosing common calls ;03/06/03
"RTN","PSOOREDX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**133,362**;DEC 1997;Build 8
"RTN","PSOOREDX",3,0)
 ;External reference to PS(51.2 supported by DBIA 2226
"RTN","PSOOREDX",4,0)
 ;called from psoored4 & psoored5
"RTN","PSOOREDX",5,0)
VER D KV S DIR(0)="52.0113,8"
"RTN","PSOOREDX",6,0)
 S:$G(PSORXED("VERB",ENT))]"" DIR("B")=PSORXED("VERB",ENT)
"RTN","PSOOREDX",7,0)
 D ^DIR Q
"RTN","PSOOREDX",8,0)
DUPD ;
"RTN","PSOOREDX",9,0)
 D KV S DIR(0)="52.0113,1",DIR("A")="DISPENSE UNITS PER DOSE"_$S($G(PSORXED("NOUN",ENT))]"":"("_PSORXED("NOUN",ENT)_")",1:"")
"RTN","PSOOREDX",10,0)
 I '$G(PSORXED("DOSE",ENT)),$G(PSORXED("DOSE",ENT-1)) S PSORXED("DOSE",ENT)=PSORXED("DOSE",ENT-1)
"RTN","PSOOREDX",11,0)
 Q
"RTN","PSOOREDX",12,0)
 ;
"RTN","PSOOREDX",13,0)
STR S:+STRE>0&(X>0) PSORXED("DOSE",ENT)=(X*STRE) W !,"Dosage Ordered: "_$S($E(PSORXED("DOSE",ENT),1)=".":"0",1:"")_PSORXED("DOSE",ENT)_UNITN,!
"RTN","PSOOREDX",14,0)
 S:X'="" (PSORXED("DOSE ORDERED",ENT),DUPD)=X
"RTN","PSOOREDX",15,0)
 Q
"RTN","PSOOREDX",16,0)
 ;
"RTN","PSOOREDX",17,0)
NOU D KV S DIR(0)="52.0113,3"
"RTN","PSOOREDX",18,0)
 S DIR("B")=$S($G(NOUN)]"":NOUN,1:$G(PSORXED("NOUN",ENT))) K:DIR("B")="" DIR("B")
"RTN","PSOOREDX",19,0)
 S PSONDEF=$G(DIR("B"))
"RTN","PSOOREDX",20,0)
 D ^DIR Q
"RTN","PSOOREDX",21,0)
 ;
"RTN","PSOOREDX",22,0)
DUR1 I X="@" K DUR,PSORXED("DURATION",ENT) S PSOSIGFL=1  ;*362 - create new order in CPRS
"RTN","PSOOREDX",23,0)
 I Y'="" S PSORXED("DURATION",ENT)=Y W " ("_$S(Y["L":"MONTHS",Y["W":"WEEKS",Y["H":"HOURS",Y["M":"MINUTES",1:"DAYS")_")"
"RTN","PSOOREDX",24,0)
 Q
"RTN","PSOOREDX",25,0)
 ;
"RTN","PSOOREDX",26,0)
CON D KV S DIR(0)="52.0113,5"
"RTN","PSOOREDX",27,0)
 S:$G(PSORXED("CONJUNCTION",ENT))'="" DIR("B")=PSORXED("CONJUNCTION",ENT)
"RTN","PSOOREDX",28,0)
 D ^DIR Q
"RTN","PSOOREDX",29,0)
 ;
"RTN","PSOOREDX",30,0)
CON1 D KV S DIR(0)="Y",DIR("A",1)="Deleting this conjunction will delete the dosing sequence that follows!"
"RTN","PSOOREDX",31,0)
 S DIR("A")="Are you sure you want to delete",DIR("B")="NO" D ^DIR
"RTN","PSOOREDX",32,0)
 Q
"RTN","PSOOREDX",33,0)
 ;
"RTN","PSOOREDX",34,0)
KV K DIR,DIRUT,DTOUT,DUOUT Q
"RTN","PSOOREDX",35,0)
 ;
"RTN","PSOOREDX",36,0)
 ;
"RTN","PSOOREDX",37,0)
FNM S NM=$E(X,2,4),NM=$TR(NM,"qwertyuioplkjhgfdsazxcvbnm","QWERTYUIOPLKJHGFDSAZXCVBNM")
"RTN","PSOOREDX",38,0)
 S FLDNM=$S(NM="DOS":"DOSE^*Dosage",NM="DIS":"DOSE ORDERED^Dispense Units",NM="ROU":"ROUTE^*Route",NM="SCH":"SCHEDULE^*Schedule",NM="DUR"!(NM="LIM"):"DURATION^*Duration",1:"")
"RTN","PSOOREDX",39,0)
 S:FLDNM="" FLDNM=$S(NM="CON":"CONJUNCTION^*Conjunction",NM="NOU":"NOUN^Noun",NM="VER":"VERB^Verb",1:"")
"RTN","PSOOREDX",40,0)
 Q
"RTN","PSOOREDX",41,0)
JFN K FLDNM,AR S ENT=+Y,FLDNM=$S(NM="NOU":"NOU",NM="VER":"VER",NM="DOS":"ASK",NM="DIS":"DUPD",NM="ROU":"RTE",NM="SCH":"SCH",NM="DUR"!(NM="LIM"):"DUR",NM="CON":"CON",1:"")
"RTN","PSOOREDX",42,0)
 Q
"RTN","PSOOREDX",43,0)
JP2 F AR=1:1:PSORXED("ENT") D:$G(PSORXED("SCHEDULE",AR))]""
"RTN","PSOOREDX",44,0)
 .W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOOREDX",45,0)
 Q
"RTN","PSOOREDX",46,0)
UPD ;updates dosing array
"RTN","PSOOREDX",47,0)
 K PSORXED("CONJUNCTION",ENT) S I=ENT+1 D RV
"RTN","PSOOREDX",48,0)
 S HENT=ENT
"RTN","PSOOREDX",49,0)
UPD1 ;
"RTN","PSOOREDX",50,0)
 S I=HENT+1,J=I+1
"RTN","PSOOREDX",51,0)
 I $G(PSORXED("CONJUNCTION",I))]"",'$D(PSORXED("DOSE",J)) K PSORXED("CONJUNCTION",I) Q
"RTN","PSOOREDX",52,0)
 I $G(PSORXED("CONJUNCTION",I))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",I) D  G UPD1
"RTN","PSOOREDX",53,0)
 .K PSORXED("CONJUNCTION",I) I $D(PSORXED("DOSE",J)) D
"RTN","PSOOREDX",54,0)
 ..S PSORXED("DOSE",I)=PSORXED("DOSE",J)
"RTN","PSOOREDX",55,0)
 ..S PSORXED("DOSE ORDERED",I)=$G(PSORXED("DOSE ORDERED",J))
"RTN","PSOOREDX",56,0)
 ..S PSORXED("UNITS",I)=$G(PSORXED("UNITS",J))
"RTN","PSOOREDX",57,0)
 ..S PSORXED("NOUN",I)=$G(PSORXED("NOUN",J))
"RTN","PSOOREDX",58,0)
 ..S PSORXED("VERB",I)=$G(PSORXED("VERB",J))
"RTN","PSOOREDX",59,0)
 ..S PSORXED("DURATION",I)=$G(PSORXED("DURATION",J))
"RTN","PSOOREDX",60,0)
 ..S PSORXED("CONJUNCTION",I)=$G(PSORXED("CONJUNCTION",J))
"RTN","PSOOREDX",61,0)
 ..S PSORXED("ROUTE",I)=$G(PSORXED("ROUTE",J))
"RTN","PSOOREDX",62,0)
 ..S PSORXED("SCHEDULE",I)=$G(PSORXED("SCHEDULE",J))
"RTN","PSOOREDX",63,0)
 ..S PSORXED("ODOSE",I)=$G(PSORXED("ODOSE",J))
"RTN","PSOOREDX",64,0)
 ..S HENT=HENT+1,I=HENT+1
"RTN","PSOOREDX",65,0)
 ..I $G(PSORXED("CONJUNCTION",I))]"" Q
"RTN","PSOOREDX",66,0)
 ..K PSORXED("CONJUNCTION",I) D RV
"RTN","PSOOREDX",67,0)
 S PSORXED("ENT")=HENT K HENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOOREDX",68,0)
 Q
"RTN","PSOOREDX",69,0)
RV K PSORXED("UNITS",I),PSORXED("NOUN",I),PSORXED("DURATION",I),PSORXED("ROUTE",I),PSORXED("SCHEDULE",I),PSORXED("DOSE",I),PSORXED("DOSE ORDERED",I),PSORXED("VERB",I),PSORXED("ODOSE",I)
"RTN","PSOOREDX",70,0)
 Q
"RTN","PSOOREDX",71,0)
M1 S VALMSG="Prescription Not Updated!"
"RTN","PSOOREDX",72,0)
 Q
"RTN","PSOOREDX",73,0)
M2 S VALMSG="This edit will create a new prescription!"
"RTN","PSOOREDX",74,0)
 Q
"RTN","PSOOREDX",75,0)
M3 S VALMSG=$S($G(COPY):"Copy Request Cancelled!",1:"Prescription Not Updated!")
"RTN","PSOOREDX",76,0)
 Q
"RTN","PSOOREDX",77,0)
MP1 S VALMSG="Pending Order Not Updated!"
"RTN","PSOOREDX",78,0)
 Q
"RTN","PSORN52")
0^3^B44851851^B44688558
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219,148,239,201,225,303,358,251,387,379,362**;DEC 1997;Build 8
"RTN","PSORN52",3,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",4,0)
 ;Ext ref to SWSTAT^IBBAPI sup by DBIA 4663
"RTN","PSORN52",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSORN52",6,0)
EN(PSOX) ;EP
"RTN","PSORN52",7,0)
START ;
"RTN","PSORN52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",9,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",10,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",11,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",12,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",13,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",15,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",7)=1:1,$P(PSOIBHLX,"^",7)=0:0,1:"")
"RTN","PSORN52",16,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1)!($P(PSOIBHLX,"^",6)=1)!($P(PSOIBHLX,"^",7)=1) S PSOSCOTH=1
"RTN","PSORN52",17,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",18,0)
 S PSOANSQ("SC>50")="" D SCP^PSORN52D
"RTN","PSORN52",19,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",20,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",21,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",22,0)
 .N PSOLDIBQ S PSOLDIBQ=""  ;*362 ;do not copy over IBQ node for a renewal
"RTN","PSORN52",23,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",24,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",25,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",26,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",27,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",28,0)
 D INIT G:PSORN52("QFLG") END D FILE^PSORN52A
"RTN","PSORN52",29,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",30,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",31,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",32,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",33,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",34,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",35,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",42,0)
 .I $P(PSOIBHLD,"^",8)=1!($P(PSOIBHLD,"^",8)=0) S PSOANSQ(PSOX("IRXN"),"SHAD")=$P(PSOIBHLD,"^",8)
"RTN","PSORN52",43,0)
 K PSOIBHLD
"RTN","PSORN52",44,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",45,0)
 S PSONEW("NEWCOPAY")=""
"RTN","PSORN52",46,0)
 I (PSOSCP<50&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7))),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",47,0)
 ;I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",48,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1)) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",49,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",50,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",54,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D MESS D SHAD^PSOMLLD2 I $G(PSOANSQ(PSOX("IRXN"),"SHAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",56,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",57,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",58,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",59,0)
 ;
"RTN","PSORN52",60,0)
 D FINISH,ACP^PSOUTIL
"RTN","PSORN52",61,0)
 ;
"RTN","PSORN52",62,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",63,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"SHAD"))
"RTN","PSORN52",64,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)) S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",65,0)
 ;
"RTN","PSORN52",66,0)
 D FILE2^PSORN52D
"RTN","PSORN52",67,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSORN52",68,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",69,0)
END D EOJ
"RTN","PSORN52",70,0)
 Q
"RTN","PSORN52",71,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",72,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",73,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",74,0)
 Q
"RTN","PSORN52",75,0)
 ;
"RTN","PSORN52",76,0)
FINISH ;
"RTN","PSORN52",77,0)
 N PSOTFIN
"RTN","PSORN52",78,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S PSOTFIN="",PSOTFIN=$$TECH2^PSODGDGP(PSOX("IRXN"),PSODFN,DUZ,.PSOX)
"RTN","PSORN52",79,0)
 I '$D(^XUSEC("PSORPH",DUZ)) G FINISHP:$G(PSOTFIN)=1 G FINISHX:$G(PSOTFIN)=2
"RTN","PSORN52",80,0)
 ;
"RTN","PSORN52",81,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",82,0)
 ;
"RTN","PSORN52",83,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",84,0)
 ;
"RTN","PSORN52",85,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSORN52",86,0)
 N ACTION
"RTN","PSORN52",87,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSORN52",88,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,"","RN")
"RTN","PSORN52",89,0)
 .; Quit if there is an unresolved Tricare/CHAMPVA non-billable reject code, PSO*7*358
"RTN","PSORN52",90,0)
 . I $$PSOET^PSOREJP3(PSOX("IRXN"),0) S ACTION="Q" Q
"RTN","PSORN52",91,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSORN52",92,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","RN","IOQ","Q")
"RTN","PSORN52",93,0)
 ;
"RTN","PSORN52",94,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",95,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",96,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",97,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",98,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",99,0)
 . Q
"RTN","PSORN52",100,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",101,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",102,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",103,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",104,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",105,0)
FINISHX ;
"RTN","PSORN52",106,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",107,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11)
"RTN","PSORN52",108,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",109,0)
 K PSOX1,PSOX2,^TMP("PSODOSF")
"RTN","PSORN52",110,0)
 Q
"RTN","PSORN52",111,0)
EOJ ;
"RTN","PSORN52",112,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",113,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",114,0)
 Q
"RTN","PSORN52",115,0)
MESS ;
"RTN","PSORN52",116,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",117,0)
 Q
"RTN","PSOSULOG")
0^6^B63262026^B61735277
"RTN","PSOSULOG",1,0)
PSOSULOG ;BHAM ISC/RTR-Log of prescriptions on suspense by day ; 11/18/92
"RTN","PSOSULOG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**18,264,362**;DEC 1997;Build 8
"RTN","PSOSULOG",3,0)
 I '$G(PSOSITE) D ^PSOLSET I '$G(PSOSITE) D WARN^PSOSUDCN Q
"RTN","PSOSULOG",4,0)
 K ^TMP($J,"PSOSPLOG") N BDATE,EDATE,GG,HDAT,HPAT,PII,LINE,NODE,PAGE,PAT,PATNAME,PATPTR,PDAT,PP,PSOSCMOP,PSOCNT,PSODATE,PSODATEX,PSOINRX,PSORT,PSPRINT,PSUSDIV,QFLAG,SIN,SINRX,X,Y,ZZ
"RTN","PSOSULOG",5,0)
LOG W ! K DIR S DIR("A")="Sort by Patient Name or SSN",DIR(0)="SB^P:PATIENT NAME;S:SOCIAL SECURITY NUMBER",DIR("B")="PATIENT NAME"
"RTN","PSOSULOG",6,0)
 S DIR("?")="Enter 'P' to sort by patient name, 'S' to sort by SSN, enter '^' to exit."
"RTN","PSOSULOG",7,0)
 D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT S PSORT=Y
"RTN","PSOSULOG",8,0)
DATE W ! K %DT S %DT="AEX",%DT("A")="Start Date: " D ^%DT K %DT G:Y=-1&(X'["^") DATE I X["^"!($D(DTOUT)) D MESS G EXIT
"RTN","PSOSULOG",9,0)
EDATE W ! S BDATE=$E(Y,1,7) S %DT(0)=BDATE,%DT="AEX",%DT("A")="End Date: " D ^%DT K %DT G:Y=-1&(X'["^") EDATE I X["^"!($D(DTOUT)) D MESS G EXIT
"RTN","PSOSULOG",10,0)
 S EDATE=$E(Y,1,7) W !
"RTN","PSOSULOG",11,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to see only those Rx's that have NOT yet been printed" D ^DIR K DIR D:$D(DIRUT) MESS G:Y["^"!($D(DIRUT)) EXIT S PSPRINT=$S(Y:1,1:0)
"RTN","PSOSULOG",12,0)
 S PSOCNT=0 F PII=0:0 S PII=$O(^PS(59,PII)) Q:'PII  S PSOCNT=PSOCNT+1
"RTN","PSOSULOG",13,0)
 I PSOCNT=1 G SKIP
"RTN","PSOSULOG",14,0)
 W !!?3,"You are logged in under the "_$P($G(^PS(59,+$G(PSOSITE),0)),"^")_" division.",!
"RTN","PSOSULOG",15,0)
 K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Print only those Rx's suspended for this division",DIR("?")="Enter 'Yes' to print only those Rx's for this division, enter 'No' to print Rx's suspended for all divisions."
"RTN","PSOSULOG",16,0)
 D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",17,0)
 S PSUSDIV=Y
"RTN","PSOSULOG",18,0)
SKIP ;
"RTN","PSOSULOG",19,0)
 I '$G(PSXSYS) G SKIPC
"RTN","PSOSULOG",20,0)
 K DIR W ! S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want suspended CMOP Rx's included in this report" D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",21,0)
 I $G(Y) S PSOSCMOP=1
"RTN","PSOSULOG",22,0)
SKIPC ;
"RTN","PSOSULOG",23,0)
 W ! K DIR S DIR("A")="Do you want this report to print in 80 or 132 column format: ",DIR("B")="132",DIR(0)="SAM^1:132;8:80" D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",24,0)
 W ! S PSORMZ=$S(Y=1:1,1:0)
"RTN","PSOSULOG",25,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I POP D MESS G EXIT
"RTN","PSOSULOG",26,0)
 I $D(IO("Q")) S ZTRTN="REP^PSOSULOG",ZTDESC="Report is suspended Rx's" D  G EXIT
"RTN","PSOSULOG",27,0)
 .F GG="PSORMZ","PSOSITE","PSOPAR","PSORT","BDATE","EDATE","PSPRINT","PSUSDIV","PSOSCMOP" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOSULOG",28,0)
 .D ^%ZTLOAD W !,"Task queued to print"
"RTN","PSOSULOG",29,0)
 G REP
"RTN","PSOSULOG",30,0)
EXIT ;
"RTN","PSOSULOG",31,0)
 K ^TMP($J,"PSOSPLOG") S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULOG",32,0)
 K BDATE,EDATE,GG,HDAT,HPAT,PII,LINE,NODE,PAGE,PAT,PATNAME,PATPTR,PDAT,PP,PSOBAD,PSOSCMOP,PSOCNT,PSODATE,PSODATEX,PSOINRX,PSORMZ,PSORT,PSPRINT,PSUSDIV,QFLAG,SIN,SINRX,X,Y,ZZ
"RTN","PSOSULOG",33,0)
 Q
"RTN","PSOSULOG",34,0)
MESS W !!,"No report printed!",!! Q
"RTN","PSOSULOG",35,0)
REP ;
"RTN","PSOSULOG",36,0)
 K ^TMP($J,"PSOSPLOG")
"RTN","PSOSULOG",37,0)
 U IO S $P(LINE,"-",$S($G(PSORMZ):130,1:79))=""
"RTN","PSOSULOG",38,0)
 S BDATE=BDATE-.0001,QFLAG=0,PAGE=1
"RTN","PSOSULOG",39,0)
 F ZZ=BDATE:0 S ZZ=$O(^PS(52.5,"C",ZZ)) Q:'ZZ!(ZZ>EDATE)  F SIN=0:0 S SIN=$O(^PS(52.5,"C",ZZ,SIN)) Q:'SIN  D
"RTN","PSOSULOG",40,0)
 .Q:'$P($G(^PS(52.5,SIN,0)),"^",3)
"RTN","PSOSULOG",41,0)
 .I $G(PSPRINT),$G(^PS(52.5,SIN,"P")) Q
"RTN","PSOSULOG",42,0)
 .I '$G(PSOSCMOP),$P($G(^PS(52.5,SIN,0)),"^",7)'="" Q
"RTN","PSOSULOG",43,0)
 .I $G(PSUSDIV),$G(PSOSITE)'=$P($G(^PS(52.5,SIN,0)),"^",6) Q
"RTN","PSOSULOG",44,0)
 .S PAT=+$P($G(^PS(52.5,SIN,0)),"^",3) I $P($G(^DPT(PAT,0)),"^")="" Q
"RTN","PSOSULOG",45,0)
 .I $P($G(^DPT(PAT,0)),"^",9)="",PSORT="S" Q
"RTN","PSOSULOG",46,0)
 .S ^TMP($J,"PSOSPLOG",ZZ,$S(PSORT="P":$P(^DPT(PAT,0),"^"),1:$P(^DPT(PAT,0),"^",9)),SIN)=SIN
"RTN","PSOSULOG",47,0)
 I $G(PSORMZ) G BIG
"RTN","PSOSULOG",48,0)
 I '$D(^TMP($J,"PSOSPLOG")) D HEAD W !!,"NO RECORDS TO PRINT",! D:$E(IOST)="C"  D ^%ZISC G EXIT
"RTN","PSOSULOG",49,0)
 .K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",50,0)
 S HPAT="",HDAT=""
"RTN","PSOSULOG",51,0)
 F PSODATE=0:0 S PSODATE=$O(^TMP($J,"PSOSPLOG",PSODATE)) Q:'PSODATE!($G(QFLAG))  S (Y,PDAT)=PSODATE D DD^%DT S PSODATEX=Y D HEAD S PAT="" F  S PAT=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT)) Q:PAT=""!($G(QFLAG))  D
"RTN","PSOSULOG",52,0)
 .F SINRX=0:0 S SINRX=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT,SINRX)) Q:'SINRX!($G(QFLAG))  D
"RTN","PSOSULOG",53,0)
 ..S NODE=$G(^PS(52.5,SINRX,0)),PATPTR=+$P(NODE,"^",3)
"RTN","PSOSULOG",54,0)
 ..I 'PATPTR Q
"RTN","PSOSULOG",55,0)
 ..S PATNAME=$P($G(^DPT(PATPTR,0)),"^") Q:PATNAME=""
"RTN","PSOSULOG",56,0)
 ..I $G(PSPRINT),$G(^PS(52.5,SINRX,"P")) Q
"RTN","PSOSULOG",57,0)
 ..I $G(PSUSDIV),$G(PSOSITE)'=$P(NODE,"^",6) Q
"RTN","PSOSULOG",58,0)
 ..I PAT'=HPAT!(HDAT'=PDAT) W !!?9,"Patient Name: "_$G(PATNAME) S HPAT=PAT,PDAT=HDAT
"RTN","PSOSULOG",59,0)
 ..D:($Y+4)>IOSL HEAD Q:$G(QFLAG)
"RTN","PSOSULOG",60,0)
 ..S PSOINRX=+$P($G(NODE),"^")
"RTN","PSOSULOG",61,0)
 ..W !,$P($G(^PSRX(+$G(NODE),0)),"^")
"RTN","PSOSULOG",62,0)
 ..W ?13,$P($G(^PSDRUG(+$P($G(^PSRX(PSOINRX,0)),"^",6),0)),"^")
"RTN","PSOSULOG",63,0)
 ..K PSOMW D
"RTN","PSOSULOG",64,0)
 ...I $P(NODE,"^",5) S PSOMW=$P($G(^PSRX(+$G(NODE),"P",$P(NODE,"^",5),0)),"^",2) Q
"RTN","PSOSULOG",65,0)
 ...I $P(NODE,"^",13)!($O(^PSRX(+$G(NODE),1,0))) D  Q
"RTN","PSOSULOG",66,0)
 ....I $P(NODE,"^",13) S PSOMW=$P($G(^PSRX(+$G(NODE),1,$P(NODE,"^",13),0)),"^",2) Q
"RTN","PSOSULOG",67,0)
 ....F PP=0:0 S PP=$O(^PSRX(+$G(NODE),1,PP)) Q:'PP  S PSOMW=$P($G(^PSRX(+$G(NODE),1,PP,0)),"^",2)
"RTN","PSOSULOG",68,0)
 ...S PSOMW=$P($G(^PSRX(+$G(NODE),0)),"^",11)
"RTN","PSOSULOG",69,0)
 ..W ?54,$G(PSOMW)
"RTN","PSOSULOG",70,0)
 ..S PSOPRINT=$S($G(^PS(52.5,SINRX,"P")):"YES",1:"NO")
"RTN","PSOSULOG",71,0)
 ..W ?56,PSOPRINT
"RTN","PSOSULOG",72,0)
 ..I PSOPRINT="NO" S PSOBAD="" D CHKBAD I PSOBAD'="" W ?62,PSOBAD
"RTN","PSOSULOG",73,0)
 ..I $G(PSOSCMOP),$P(NODE,"^",7)'="" D
"RTN","PSOSULOG",74,0)
 ...W ?64,$S($P(NODE,"^",7)="Q":"QUEUED/TRANS",$P(NODE,"^",7)="X":"TRANS/COMPLETE",$P(NODE,"^",7)="L":"LOADING/TRANS",$P(NODE,"^",7)="P":"PRINTED/LOCAL",1:"")
"RTN","PSOSULOG",75,0)
 I $E(IOST)'="P",'$G(QFLAG) W ! K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",76,0)
 W !,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOSULOG",77,0)
 W !,"** END OF REPORT **"
"RTN","PSOSULOG",78,0)
 D ^%ZISC G EXIT
"RTN","PSOSULOG",79,0)
HEAD ;
"RTN","PSOSULOG",80,0)
 I $E(IOST)'="P",PAGE K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S QFLAG=1 Q
"RTN","PSOSULOG",81,0)
 W @IOF W !?22,"RX SUSPENSE LIST "_$S($G(PSODATEX)'="":"FOR ",1:"")_$G(PSODATEX) W ?68,"PAGE: ",$G(PAGE) W !,"RX #",?13,"DRUG",?53,"MW",?56,"PRNT B/D/F",?66,$S($G(PSOSCMOP):"CMOP STATUS",1:"") W !,LINE S PAGE=PAGE+1
"RTN","PSOSULOG",82,0)
 Q
"RTN","PSOSULOG",83,0)
BIG ;
"RTN","PSOSULOG",84,0)
 N PSOPRINT
"RTN","PSOSULOG",85,0)
 I '$D(^TMP($J,"PSOSPLOG")) D HEADB W !!,"NO RECORDS TO PRINT",! D:$E(IOST)="C"  D ^%ZISC G EXIT
"RTN","PSOSULOG",86,0)
 .K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",87,0)
 F PSODATE=0:0 S PSODATE=$O(^TMP($J,"PSOSPLOG",PSODATE)) Q:'PSODATE!($G(QFLAG))  S Y=PSODATE D DD^%DT S PSODATEX=Y D:PAGE=1 HEADB D HEADND S PAT="" F  S PAT=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT)) Q:PAT=""!($G(QFLAG))  D
"RTN","PSOSULOG",88,0)
 .F SINRX=0:0 S SINRX=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT,SINRX)) Q:'SINRX!($G(QFLAG))  D
"RTN","PSOSULOG",89,0)
 ..S NODE=$G(^PS(52.5,SINRX,0)),PATPTR=+$P(NODE,"^",3)
"RTN","PSOSULOG",90,0)
 ..I 'PATPTR Q
"RTN","PSOSULOG",91,0)
 ..S PATNAME=$P($G(^DPT(PATPTR,0)),"^") Q:PATNAME=""
"RTN","PSOSULOG",92,0)
 ..I $G(PSPRINT),$G(^PS(52.5,SINRX,"P")) Q
"RTN","PSOSULOG",93,0)
 ..I $G(PSUSDIV),$G(PSOSITE)'=$P(NODE,"^",6) Q
"RTN","PSOSULOG",94,0)
 ..D:($Y+4)>IOSL HEADB Q:$G(QFLAG)
"RTN","PSOSULOG",95,0)
 ..S PSOINRX=+$P($G(NODE),"^")
"RTN","PSOSULOG",96,0)
 ..W !,$P($G(^PSRX(+$G(NODE),0)),"^")
"RTN","PSOSULOG",97,0)
 ..W ?13,$G(PATNAME)
"RTN","PSOSULOG",98,0)
 ..W ?45,$P($G(^PSDRUG(+$P($G(^PSRX(PSOINRX,0)),"^",6),0)),"^")
"RTN","PSOSULOG",99,0)
 ..K PSOMW D
"RTN","PSOSULOG",100,0)
 ...I $P(NODE,"^",5) S PSOMW=$P($G(^PSRX(+$G(NODE),"P",$P(NODE,"^",5),0)),"^",2) Q
"RTN","PSOSULOG",101,0)
 ...I $P(NODE,"^",13)!($O(^PSRX(+$G(NODE),1,0))) D  Q
"RTN","PSOSULOG",102,0)
 ....I $P(NODE,"^",13) S PSOMW=$P($G(^PSRX(+$G(NODE),1,$P(NODE,"^",13),0)),"^",2) Q
"RTN","PSOSULOG",103,0)
 ....F PP=0:0 S PP=$O(^PSRX(+$G(NODE),1,PP)) Q:'PP  S PSOMW=$P($G(^PSRX(+$G(NODE),1,PP,0)),"^",2)
"RTN","PSOSULOG",104,0)
 ...S PSOMW=$P($G(^PSRX(+$G(NODE),0)),"^",11)
"RTN","PSOSULOG",105,0)
 ..W ?88,$S($G(PSOMW)="W":"WINDOW",1:"MAIL")
"RTN","PSOSULOG",106,0)
 ..S PSOPRINT=$S($G(^PS(52.5,SINRX,"P")):"YES",1:"NO")
"RTN","PSOSULOG",107,0)
 ..W ?95,PSOPRINT
"RTN","PSOSULOG",108,0)
 ..I PSOPRINT="NO" S PSOBAD="" D CHKBAD I PSOBAD'="" W ?103,PSOBAD
"RTN","PSOSULOG",109,0)
 ..I $G(PSOSCMOP),$P(NODE,"^",7)'="" D
"RTN","PSOSULOG",110,0)
 ...W ?104,$S($P(NODE,"^",7)="Q":"QUEUED FOR TRANSMISSION",$P(NODE,"^",7)="X":"TRANSMISSION COMPLETED",$P(NODE,"^",7)="L":"LOADING FOR TRANSMISSION",$P(NODE,"^",7)="P":"PRINTED LOCALLY",1:"")
"RTN","PSOSULOG",111,0)
 I $E(IOST)'="P",'$G(QFLAG) W ! K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",112,0)
 W !,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOSULOG",113,0)
 W !,"** END OF REPORT **"
"RTN","PSOSULOG",114,0)
 D ^%ZISC G EXIT
"RTN","PSOSULOG",115,0)
HEADB ;
"RTN","PSOSULOG",116,0)
 I $E(IOST)'="P",PAGE K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S QFLAG=1 Q
"RTN","PSOSULOG",117,0)
 W @IOF
"RTN","PSOSULOG",118,0)
 W !,"RX #",?13,"PATIENT",?45,"DRUG",?88,"TYPE",?93,"PRINTED B/D/F",?108,$S($G(PSOSCMOP):"CMOP STATUS",1:""),?122,"PAGE ",$G(PAGE) W !,LINE S PAGE=PAGE+1
"RTN","PSOSULOG",119,0)
 Q
"RTN","PSOSULOG",120,0)
HEADND W !!?40,"RX SUSPENSE LIST "_$S($G(PSODATEX)'="":"FOR ",1:"")_$G(PSODATEX)
"RTN","PSOSULOG",121,0)
 Q
"RTN","PSOSULOG",122,0)
 ;
"RTN","PSOSULOG",123,0)
CHKADDR  ;
"RTN","PSOSULOG",124,0)
 N PSOBADR,PSOTEMP
"RTN","PSOSULOG",125,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOSULOG",126,0)
 I PSOBADR D
"RTN","PSOSULOG",127,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSODFN)
"RTN","PSOSULOG",128,0)
 I PSOBADR,'PSOTEMP S (PSOBAI,PSOBDF("B"))=1 Q
"RTN","PSOSULOG",129,0)
 Q
"RTN","PSOSULOG",130,0)
 ;
"RTN","PSOSULOG",131,0)
FOREIGN  ;
"RTN","PSOSULOG",132,0)
 N PSOFORGN,DFN
"RTN","PSOSULOG",133,0)
 S DFN=PSODFN D ADD^VADPT
"RTN","PSOSULOG",134,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="" D   ;*362
"RTN","PSOSULOG",135,0)
 .N PSON
"RTN","PSOSULOG",136,0)
 .S PSOBDF("F")=1
"RTN","PSOSULOG",137,0)
 .S PSON=$$GET1^DIQ(59,PSOSITE,.01)
"RTN","PSOSULOG",138,0)
 .I PSON'["MANILA",PSOFORGN["UNITED STATES" K PSOBDF("F") Q
"RTN","PSOSULOG",139,0)
 .I PSON["MANILA",PSOFORGN["PHILIPPINES" K PSOBDF("F")
"RTN","PSOSULOG",140,0)
 Q
"RTN","PSOSULOG",141,0)
 ;
"RTN","PSOSULOG",142,0)
CHKMAIL  ;
"RTN","PSOSULOG",143,0)
 N PSOTEMP,MAILEXP
"RTN","PSOSULOG",144,0)
 S PSOTEMP=$G(^PS(55,PSODFN,0)) Q:$P(PSOTEMP,"^",3)'=2
"RTN","PSOSULOG",145,0)
 S MAILEXP=$P(PSOTEMP,"^",5) I MAILEXP=""!(MAILEXP>DT) S PSOBDF("D")=1
"RTN","PSOSULOG",146,0)
 Q
"RTN","PSOSULOG",147,0)
 ;
"RTN","PSOSULOG",148,0)
CHKBAD ;
"RTN","PSOSULOG",149,0)
 K PSOBDF
"RTN","PSOSULOG",150,0)
 S PSODFN=PATPTR
"RTN","PSOSULOG",151,0)
 D CHKADDR I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",152,0)
 D CHKMAIL I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",153,0)
 D FOREIGN I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",154,0)
 Q
"RTN","PSOSULOG",155,0)
 ; CHANGE TO USE FOLLOWING IF WANT TO SEE WHY RX'S DID NOT PRINT PREVIOUSLY (INSTEAD OF CURRENT BAD STATUS)
"RTN","PSOSULOG",156,0)
 N RX,SEQ,FILL,ZZ
"RTN","PSOSULOG",157,0)
 S RX=+$G(NODE),FILL=$P(NODE,"^",13)
"RTN","PSOSULOG",158,0)
 S SEQ=0 F  S SEQ=$O(^PSRX(RX,"A",SEQ)) Q:'SEQ  S X=$G(^PSRX(RX,"A",SEQ,0)) D
"RTN","PSOSULOG",159,0)
 .I $P(X,"^",2)="S" S ZZ=$P(X,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=FILL,X["due to" D
"RTN","PSOSULOG",160,0)
 ..I X["DO NOT MAIL" S PSOBAD="D" Q
"RTN","PSOSULOG",161,0)
 ..I X["BAD ADDRESS" S PSOBAD="B" Q
"RTN","PSOSULOG",162,0)
 ..I X["FOREIGN ADDRESS" S PSOBAD="F" Q
"RTN","PSOSULOG",163,0)
 Q
"RTN","PSOSULOG",164,0)
 ;
"VER")
8.0^22.0
"BLD",9277,6)
^365
**END**
**END**

