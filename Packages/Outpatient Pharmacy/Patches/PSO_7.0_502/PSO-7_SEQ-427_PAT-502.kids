Released PSO*7*502 SEQ #427
Extracted from mail message
**KIDS**:PSO*7.0*502^

**INSTALL NAME**
PSO*7.0*502
"BLD",10487,0)
PSO*7.0*502^OUTPATIENT PHARMACY^0^3171220^y
"BLD",10487,4,0)
^9.64PA^59^1
"BLD",10487,4,59,0)
59
"BLD",10487,4,59,2,0)
^9.641^59^1
"BLD",10487,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",10487,4,59,2,59,1,0)
^9.6411^107.3^2
"BLD",10487,4,59,2,59,1,107.2,0)
SCRIPTALK PRINTER TYPE
"BLD",10487,4,59,2,59,1,107.3,0)
VOID OTHER LABELS
"BLD",10487,4,59,222)
y^y^p^^^^n^^n
"BLD",10487,4,59,224)

"BLD",10487,4,"APDD",59,59)

"BLD",10487,4,"APDD",59,59,107.2)

"BLD",10487,4,"APDD",59,59,107.3)

"BLD",10487,4,"B",59,59)

"BLD",10487,6)
7^
"BLD",10487,6.3)
13
"BLD",10487,"ABPKG")
n
"BLD",10487,"KRN",0)
^9.67PA^779.2^20
"BLD",10487,"KRN",.4,0)
.4
"BLD",10487,"KRN",.401,0)
.401
"BLD",10487,"KRN",.402,0)
.402
"BLD",10487,"KRN",.403,0)
.403
"BLD",10487,"KRN",.5,0)
.5
"BLD",10487,"KRN",.84,0)
.84
"BLD",10487,"KRN",3.6,0)
3.6
"BLD",10487,"KRN",3.8,0)
3.8
"BLD",10487,"KRN",9.2,0)
9.2
"BLD",10487,"KRN",9.8,0)
9.8
"BLD",10487,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10487,"KRN",9.8,"NM",1,0)
PSOTALK^^0^B177380845
"BLD",10487,"KRN",9.8,"NM",2,0)
PSOTALK1^^0^B5507505
"BLD",10487,"KRN",9.8,"NM",3,0)
PSOTALK3^^0^B23477900
"BLD",10487,"KRN",9.8,"NM",4,0)
PSOBING1^^0^B63701322
"BLD",10487,"KRN",9.8,"NM","B","PSOBING1",4)

"BLD",10487,"KRN",9.8,"NM","B","PSOTALK",1)

"BLD",10487,"KRN",9.8,"NM","B","PSOTALK1",2)

"BLD",10487,"KRN",9.8,"NM","B","PSOTALK3",3)

"BLD",10487,"KRN",19,0)
19
"BLD",10487,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",10487,"KRN",19,"NM",1,0)
PSO SCRIPTALK VOID LABEL DEF'N^^0
"BLD",10487,"KRN",19,"NM",2,0)
PSO SCRIPTALK MAIN MENU^^2
"BLD",10487,"KRN",19,"NM","B","PSO SCRIPTALK MAIN MENU",2)

"BLD",10487,"KRN",19,"NM","B","PSO SCRIPTALK VOID LABEL DEF'N",1)

"BLD",10487,"KRN",19.1,0)
19.1
"BLD",10487,"KRN",101,0)
101
"BLD",10487,"KRN",409.61,0)
409.61
"BLD",10487,"KRN",771,0)
771
"BLD",10487,"KRN",779.2,0)
779.2
"BLD",10487,"KRN",870,0)
870
"BLD",10487,"KRN",8989.51,0)
8989.51
"BLD",10487,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",10487,"KRN",8989.52,0)
8989.52
"BLD",10487,"KRN",8994,0)
8994
"BLD",10487,"KRN","B",.4,.4)

"BLD",10487,"KRN","B",.401,.401)

"BLD",10487,"KRN","B",.402,.402)

"BLD",10487,"KRN","B",.403,.403)

"BLD",10487,"KRN","B",.5,.5)

"BLD",10487,"KRN","B",.84,.84)

"BLD",10487,"KRN","B",3.6,3.6)

"BLD",10487,"KRN","B",3.8,3.8)

"BLD",10487,"KRN","B",9.2,9.2)

"BLD",10487,"KRN","B",9.8,9.8)

"BLD",10487,"KRN","B",19,19)

"BLD",10487,"KRN","B",19.1,19.1)

"BLD",10487,"KRN","B",101,101)

"BLD",10487,"KRN","B",409.61,409.61)

"BLD",10487,"KRN","B",771,771)

"BLD",10487,"KRN","B",779.2,779.2)

"BLD",10487,"KRN","B",870,870)

"BLD",10487,"KRN","B",8989.51,8989.51)

"BLD",10487,"KRN","B",8989.52,8989.52)

"BLD",10487,"KRN","B",8994,8994)

"BLD",10487,"QUES",0)
^9.62^^
"BLD",10487,"REQB",0)
^9.611^4^4
"BLD",10487,"REQB",1,0)
PSO*7.0*326^2
"BLD",10487,"REQB",2,0)
PSO*7.0*385^2
"BLD",10487,"REQB",3,0)
PSO*7.0*442^2
"BLD",10487,"REQB",4,0)
PSS*1.0*217^2
"BLD",10487,"REQB","B","PSO*7.0*326",1)

"BLD",10487,"REQB","B","PSO*7.0*385",2)

"BLD",10487,"REQB","B","PSO*7.0*442",3)

"BLD",10487,"REQB","B","PSS*1.0*217",4)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,107.2)

"FIA",59,59,107.3)

"KRN",19,2919543,-1)
2^2
"KRN",19,2919543,0)
PSO SCRIPTALK MAIN MENU^ScripTalk Main Menu^^M^568^^^^^^^170
"KRN",19,2919543,10,0)
^19.01IP^7^7
"KRN",19,2919543,10,7,0)
2921948
"KRN",19,2919543,10,7,"^")
PSO SCRIPTALK VOID LABEL DEF'N
"KRN",19,2919543,"U")
SCRIPTALK MAIN MENU
"KRN",19,2921948,-1)
0^1
"KRN",19,2921948,0)
PSO SCRIPTALK VOID LABEL DEF'N^Void Label Setup^^R^^^^^^^^
"KRN",19,2921948,1,0)
^^1^1^3171105^
"KRN",19,2921948,1,1,0)
This allows the site to define, by division, whether or not the non-ScripTalk label will be 'voided' or not.
"KRN",19,2921948,25)
STVLP^PSOTALK3
"KRN",19,2921948,"U")
VOID LABEL SETUP
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
502^3171220^520824645
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOBING1")
0^4^B63701322^B55582853
"RTN","PSOBING1",1,0)
PSOBING1 ;BHAM ISC/LC - bingo board utility routine ;11/09/17  20:19
"RTN","PSOBING1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,28,56,135,244,268,357,385,502**;DEC 1997;Build 13
"RTN","PSOBING1",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOBING1",4,0)
 ;External reference to DD(52.11 and DD(59.2 supported by DBIA 999
"RTN","PSOBING1",5,0)
 ;
"RTN","PSOBING1",6,0)
 ;*244 don't store to file 52.11 if Rx Status > 11
"RTN","PSOBING1",7,0)
 ;
"RTN","PSOBING1",8,0)
BEG Q:'$G(PSODFN)  D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOBING1",9,0)
NEW K DD,DO S (DIC,DIE)="^PS(52.11,",(NDA,X,DA)=PSODFN,DIC(0)="LMNQZ" D FILE^DICN K DIC G:Y'>0 NEW S (ODA,DA)=+Y,BNGSUS=0 S:$D(SUSROUTE) BNGSUS=1
"RTN","PSOBING1",10,0)
NEW1 S GRTP=$P($G(^PS(59.3,DISGROUP,0)),"^",2),NAM=$P($G(^DPT(PSODFN,0)),"^"),SSN=$P($G(^DPT(PSODFN,0)),"^",9) I GRTP="T" D  G:'$D(DA) END
"RTN","PSOBING1",11,0)
 .K TFLAG S DR="1;2////"_DISGROUP_";3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////"_BNGSUS_"" D STO  Q:'$D(DA)
"RTN","PSOBING1",12,0)
 .W !! S TIC=$P(^PS(52.11,DA,0),"^",2) D
"RTN","PSOBING1",13,0)
 ..F TIEN=0:0 S TIEN=$O(^PS(52.11,"C",TIC,TIEN)) Q:'TIEN  I DA'=TIEN,($P(^PS(52.11,DA,0),"^",4)=+$P(^PS(52.11,TIEN,0),"^",4)) D
"RTN","PSOBING1",14,0)
 ...S TDFN=$P(^PS(52.11,TIEN,0),"^"),TSSN=$P(^PS(52.11,TIEN,1),"^",2),TFLAG=0 W !,$C(7),$P(^DPT(TDFN,0),"^")_" ("_TSSN_") was issued ticket # "_TIC,". Try again!",!
"RTN","PSOBING1",15,0)
 ..K TDFN,TIEN,TSSN Q:'TFLAG
"RTN","PSOBING1",16,0)
 I $G(GRTP)="T" G:'TFLAG NEW1 G:TFLAG END
"RTN","PSOBING1",17,0)
 S DR="2////"_DISGROUP_";3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////"_BNGSUS_""
"RTN","PSOBING1",18,0)
STO S NFLAG=1 L +^PS(52.11,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) E  W !!,$C(7),Y(0,0)," is being edited!",! S DA=NDA D WARN Q:$G(GRTP)="T"  G END
"RTN","PSOBING1",19,0)
 S XDA=DA D ^DIE I $G(DUOUT)!($G(DTOUT))!(X="") S DA=ODA D WARN G END
"RTN","PSOBING1",20,0)
 S DA=XDA D STORX S DA=XDA L -^PS(52.11,DA)
"RTN","PSOBING1",21,0)
 S TFLAG=1 D:$G(GRTP)="N" CHKUP^PSOBINGO,NOTE D STALK G:$G(GRTP)="N" END
"RTN","PSOBING1",22,0)
 Q
"RTN","PSOBING1",23,0)
NOTE S DFN=$P($G(^PS(52.11,DA,0)),"^"),NFLAG=1 W !!,?5,"NAME",?30,"SSN",?45,"ID",?50,"ORDER"
"RTN","PSOBING1",24,0)
 F Z=0:0 S Z=$O(^PS(52.11,"B",DFN,Z)) Q:'Z  S ZDA=Z S NODE=^PS(52.11,ZDA,1),Z1=$P($G(NODE),"^"),Z2=$P($G(NODE),"^",3),Z3=$P($G(NODE),"^",4),Z4=$P($G(NODE),"^",2) W !,?5,Z1,?30,Z4,?46,Z2,?52,Z3
"RTN","PSOBING1",25,0)
 W !!,"Please advise the patient that the above ID # and/or ORDER Letter"
"RTN","PSOBING1",26,0)
 W !,"will be displayed with his/her name on the Bingo Display",!!
"RTN","PSOBING1",27,0)
 Q
"RTN","PSOBING1",28,0)
STALK I $G(^PS(55,"ASTALK",DFN)) W !!,$C(7),"** ",$P($G(^DPT(DFN,0)),"^")," is enrolled for ScripTalk.",! D
"RTN","PSOBING1",29,0)
 .N X,Y,PSOSTDEV,PSOSTMAP
"RTN","PSOBING1",30,0)
 .S (PSOSTMAP,PSOSTDEV)=""
"RTN","PSOBING1",31,0)
 .S X=$G(PSOLAP) I X]"" S DIC=3.5,DIC(0)="" D ^DIC S PSOSTMAP=+Y
"RTN","PSOBING1",32,0)
 .I PSOSTMAP D  I PSOSTMAP,PSOSTDEV="" Q
"RTN","PSOBING1",33,0)
 ..N A
"RTN","PSOBING1",34,0)
 ..S A=$O(^PS(59.7,1,47,"B",PSOSTMAP,"")) I A="" S PSOSTMAP=0 Q
"RTN","PSOBING1",35,0)
 ..S PSOSTDEV="" D
"RTN","PSOBING1",36,0)
 ...I A S PSOSTDEV=$P($G(^PS(59.7,1,47,A,0)),"^",2)
"RTN","PSOBING1",37,0)
 ...I PSOSTDEV="" W !!?5,"Please review ScripTalk mapped device setup.",!!?5,"No ScripTalk label will print.",!!
"RTN","PSOBING1",38,0)
 .I $P($G(^PS(59,+PSOSITE,"STALK")),"^")="" W !,"  ** NO SCRIPTALK PRINTER DEFINED FOR THIS DIVISION!" D  I 'PSOSTMAP Q
"RTN","PSOBING1",39,0)
 ..I PSOSTMAP W !?5,"Using Mapped printer",!! Q
"RTN","PSOBING1",40,0)
 ..W !!?5,"No mapped printer defined. No ScripTalk label will print.",!!
"RTN","PSOBING1",41,0)
 .I 'PSOSTMAP,$P($G(^PS(59,+PSOSITE,"STALK")),"^",2)="M" W !!?5,"There is no Mapped printer and the Division printer is set for Manual.",!!?5,"You must manually queue the ScripTalk label(s) to print.",! Q
"RTN","PSOBING1",42,0)
 .W "  Please use label(s) from ScripTalk printer." W !
"RTN","PSOBING1",43,0)
 K NODE,Z1,Z2,Z3
"RTN","PSOBING1",44,0)
 Q
"RTN","PSOBING1",45,0)
HELP W !!,"Wand the barcode of the Rx or manually key in",!,"the number below the barcode, the Rx number, or the",!,"patient name in the format - 'LASTNAME,FIRSTNAME'"
"RTN","PSOBING1",46,0)
 W !!,"The barcode # should be of the format - 'NNN-NNNNNNN'"
"RTN","PSOBING1",47,0)
 Q
"RTN","PSOBING1",48,0)
BCRMV W !! K DIR S DIR("A")="Enter/Wand Rx # or Enter PATIENT NAME",DIR("?")="^D HELP^PSOBING1",DIR(0)="FO^1:45" D ^DIR
"RTN","PSOBING1",49,0)
 G:$D(DIRUT) END
"RTN","PSOBING1",50,0)
 I X'["-" D BCI^PSODISP Q:'$G(RXP)  G BCRMV1
"RTN","PSOBING1",51,0)
 I X["-",$P(X,"-")'=$P($$SITE^VASITE(),"^",3) W !?7,$C(7)," INVALID STATION # !",! G BCRMV
"RTN","PSOBING1",52,0)
 I X["-" S RXP=$P(X,"-",2) I '$D(^PSRX(+$G(RXP),0))!($G(RXP)']"") W !?7,$C(7)," NON-EXISTENT RX #" G BCRMV
"RTN","PSOBING1",53,0)
 G:$D(^PSRX(RXP,0)) BCRMV1
"RTN","PSOBING1",54,0)
 W !?7,$C(7)," IMPROPER BARCODE FORMAT" G BCRMV
"RTN","PSOBING1",55,0)
BCRMV1 S NME=$P($G(^PSRX(RXP,0)),"^",2),BNAME=$P($G(^DPT(NME,0)),"^"),BDA="",CNT1=0
"RTN","PSOBING1",56,0)
 F XX=0:0 S XX=$O(^PS(52.11,"B",NME,XX)) Q:'XX  D
"RTN","PSOBING1",57,0)
 .F BRX=0:0 S BRX=$O(^PS(52.11,XX,2,"B",BRX)) Q:'BRX  D
"RTN","PSOBING1",58,0)
 ..I BRX=RXP S DA=XX
"RTN","PSOBING1",59,0)
 I '$D(DA) W !!,BNAME," isn't in the Bingo Board file.",$C(7) G BCRMV
"RTN","PSOBING1",60,0)
 I $D(^PS(52.11,"ANAMK",DA)) W !!,BNAME," has already been removed from the display.",$C(7) G BCRMV
"RTN","PSOBING1",61,0)
 I $$STATUS^PSOBPSUT(RXP)]"" D SIGMSG^PSOBINGO
"RTN","PSOBING1",62,0)
 D REMOVE1^PSOBINGO
"RTN","PSOBING1",63,0)
 K BRX,DIK,DA,XX W !!,BNAME," is removed from the display."
"RTN","PSOBING1",64,0)
 G BCRMV
"RTN","PSOBING1",65,0)
WARN W !!,$C(7),"Bingo record is incomplete!" S DIK="^PS(52.11," D ^DIK K DIK,DA W !!,"Bingo record removed.",!
"RTN","PSOBING1",66,0)
 Q
"RTN","PSOBING1",67,0)
STORX ;Sto Rx # for each entry in 52.11
"RTN","PSOBING1",68,0)
 Q:'$D(BBRX(1))  N DIC,DIE,NUM,BB,BBN,DR,FL,FLN,I
"RTN","PSOBING1",69,0)
 S DA(1)=DA,(DIC,DIE)="^PS(52.11,"_DA(1)_",2,",DIC(0)="L",DIC("P")=$P(^DD(52.11,12,0),"^",2),DLAYGO=52.11
"RTN","PSOBING1",70,0)
 F BBN=0:0 S BBN=$O(BBRX(BBN)) Q:'BBN  F NUM=1:1 S BB=$P(BBRX(BBN),",",NUM) Q:'BB  D
"RTN","PSOBING1",71,0)
 .Q:$G(^PSRX(BB,"STA"))>11                            ;*244
"RTN","PSOBING1",72,0)
 .I $D(RXPR(BB)) S FL="P",FLN=$G(RXPR(BB))
"RTN","PSOBING1",73,0)
 .I '$D(RXPR(BB)) F I=0:0 S I=$O(^PSRX(BB,1,I)) Q:'I  S FL="F",FLN=I
"RTN","PSOBING1",74,0)
 .I '$D(FL) S FL="F",FLN=0
"RTN","PSOBING1",75,0)
 .S X=$P(^PSRX(BB,0),"^") D ^DIC
"RTN","PSOBING1",76,0)
 .S DA=$P(Y,"^"),DR="1////"_FL_";2////"_FLN_"" D ^DIE K FL,FLN
"RTN","PSOBING1",77,0)
 Q
"RTN","PSOBING1",78,0)
 ;
"RTN","PSOBING1",79,0)
WTIME ;sto bingo wait time in 52
"RTN","PSOBING1",80,0)
 Q:'$D(DA)!'$D(DIF)  S BDA=DA
"RTN","PSOBING1",81,0)
 N DIE,XX,BRX1,BRXFL,BRXFLN,DR
"RTN","PSOBING1",82,0)
 S DA(1)=DA,DIE="^PS(52.11,"_DA(1)_",2,"
"RTN","PSOBING1",83,0)
 F XX=0:0 S XX=$O(^PS(52.11,BDA,2,XX)) Q:'XX  S DA=XX,BRX=$G(^PS(52.11,BDA,2,DA,0)),BRX1=$P(^(0),"^"),BRXFL=$P(^(0),"^",2),BRXFLN=$P(^(0),"^",3) D
"RTN","PSOBING1",84,0)
 .S DR="3////"_DIF_"" D ^DIE D
"RTN","PSOBING1",85,0)
 ..N DA,DIE S DA=BRX1
"RTN","PSOBING1",86,0)
 ..I $G(BRXFLN)=0 S DIE="^PSRX(",DR="32.3////"_DIF_"" D ^DIE K DIE
"RTN","PSOBING1",87,0)
 ..I $G(BRXFLN)>0,$G(BRXFL)="F",$G(^PSRX(DA,1,BRXFLN,0)) S DA(1)=DA,DIE="^PSRX("_DA(1)_",1,",DA=BRXFLN,DR="18////"_DIF_"" D ^DIE K DIE
"RTN","PSOBING1",88,0)
 ..I $G(BRXFLN)>0,$G(BRXFL)="P",$G(^PSRX(DA,"P",BRXFLN,0)) S DA(1)=DA,DIE="^PSRX("_DA(1)_",""P"",",DA=BRXFLN,DR="9////"_DIF_"" D ^DIE K DIE
"RTN","PSOBING1",89,0)
 S DA=BDA K DIE,XX,BRX,BRX1,BRXFL,BRXFLN,DR,DA(1)
"RTN","PSOBING1",90,0)
 Q
"RTN","PSOBING1",91,0)
 ;
"RTN","PSOBING1",92,0)
CREF ;check for deleted refills
"RTN","PSOBING1",93,0)
 S BDA=DA,XX=0,BRB="" F  S XX=$O(^PS(52.11,BDA,2,XX)) Q:'XX  S DA=XX D
"RTN","PSOBING1",94,0)
 .S BRX0=$G(^PS(52.11,BDA,2,DA,0)),BRX1=$P(BRX0,"^"),BRXFL=$P(BRX0,"^",2),BRXFLN=$P(BRX0,"^",3)
"RTN","PSOBING1",95,0)
 .I BRXFLN,BRXFL="F",$G(^PSRX(BRX1,1,BRXFLN,0))']"" D
"RTN","PSOBING1",96,0)
 ..S DA(1)=BDA,DIK="^PS(52.11,"_DA(1)_",2," D ^DIK K DIK,DA(1)
"RTN","PSOBING1",97,0)
 ..S BRB=BRB_$S(BRB="":"",1:"; ")_BRX1_","_BRXFLN
"RTN","PSOBING1",98,0)
 S DA=BDA I BRB]"",$P($G(^PS(52.11,BDA,2,0)),"^",4)=0 D
"RTN","PSOBING1",99,0)
 .W !!,$C(7),"Refill(s) "_BRB_" does not exist.",!,"It can't be displayed and is now deleted."
"RTN","PSOBING1",100,0)
 .S DIK="^PS(52.11," D ^DIK S PSODRF=1
"RTN","PSOBING1",101,0)
 K BDA,BRB,BRX0,BRX1,BRXFL,BRXFLN
"RTN","PSOBING1",102,0)
 Q
"RTN","PSOBING1",103,0)
 ;
"RTN","PSOBING1",104,0)
REL S BNGRXP=RXP N NAM,NAME,RXO,SSN
"RTN","PSOBING1",105,0)
 S NAM=$P($G(^DPT(BINGNAM,0)),"^"),ADA="",BNGRXP=RXP
"RTN","PSOBING1",106,0)
 F XX=0:0 S XX=$O(^PS(52.11,"B",BINGNAM,XX)) Q:'XX  D
"RTN","PSOBING1",107,0)
 .F BRX=0:0 S BRX=$O(^PS(52.11,XX,2,"B",BRX)) Q:'BRX  D
"RTN","PSOBING1",108,0)
 ..I BRX=BNGRXP S (DA,ODA)=XX
"RTN","PSOBING1",109,0)
 I '$D(DA) W !!,"The Rx for ",NAM," isn't in the Bingo Board",!,"file and must be entered manually.",$C(7) G END
"RTN","PSOBING1",110,0)
 I $P($G(^PS(52.11,DA,0)),"^",7)]"" W !!,NAM,"  is already in the display queue.",$C(7) G END
"RTN","PSOBING1",111,0)
 I $P($P($G(^PS(52.11,DA,0)),"^",5),".")'=DT S Y=$P($P($G(^PS(52.11,DA,0)),"^",5),".") D DD^%DT W !!,$C(7),NAM," was entered on "_Y_".",!,"It can't be displayed and is now deleted." S DIK="^PS(52.11," D ^DIK K DIK G END
"RTN","PSOBING1",112,0)
 G:$P($G(^PS(52.11,DA,0)),"^",9) REL1
"RTN","PSOBING1",113,0)
 I $P($G(^PS(52.11,DA,0)),"^",4)'=PSOSITE W !!,NAM," is from another division",!,"and must be displayed manually.",$C(7) G END
"RTN","PSOBING1",114,0)
 I $D(BINGRO),$D(BINGDIV) S BDIV=BINGDIV G REL1
"RTN","PSOBING1",115,0)
 I $D(BINGRPR),$D(BNGPDV) S BDIV=BNGPDV G REL1
"RTN","PSOBING1",116,0)
 I $D(BINGRPR),$D(BNGRDV) S BDIV=BNGRDV G REL1
"RTN","PSOBING1",117,0)
REL1 N TM,TM1 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2)
"RTN","PSOBING1",118,0)
 S NM=$P(^DPT($P(^PS(52.11,DA,0),"^"),0),"^"),DR="6////"_$E(TM1_"0000",1,4)_";8////"_NM_"",DIE="^PS(52.11,"
"RTN","PSOBING1",119,0)
 L +^PS(52.11,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) E  W !!,$C(7),NM," is being edited!",! D WARN G END
"RTN","PSOBING1",120,0)
 D ^DIE L -^PS(52.11,DA) I $G(DUOUT)!($G(DTOUT))!(X="") D WARN G END
"RTN","PSOBING1",121,0)
 S RX0=^PS(52.11,DA,0),JOES=$P(RX0,"^",4),TICK=+$P($G(RX0),"^",2),GRP=$P($G(^PS(59.3,$P($G(^PS(52.11,DA,0)),"^",3),0)),"^",2) D:GRP="T"&('$G(TICK)) WARN G:'$D(DA) END
"RTN","PSOBING1",122,0)
 W !!,NAM," added to the "_$P($G(^PS(59.3,$P(RX0,"^",3),0)),"^")_" display."
"RTN","PSOBING1",123,0)
 I +$G(^PS(55,"ASTALK",$P(^PS(52.11,DA,0),"^"))) W !,$C(7),"This patient is enrolled in ScripTalk and may benefit from",!,"a non-visual announcement that prescriptions are ready."
"RTN","PSOBING1",124,0)
 S PSZ=0 I '$D(^PS(59.2,DT,0)) K DD,DIC,DO,DA S X=DT,DIC="^PS(59.2,",DIC(0)="",DINUM=X D FILE^DICN S PSZ=1 Q:Y'>0
"RTN","PSOBING1",125,0)
 I PSZ=1 S DA(1)=+Y,DIC=DIC_DA(1)_",1,",(DINUM,X)=JOES,DIC(0)="",DIC("P")=$P(^DD(59.2,1,0),"^",2) K DD,DO D FILE^DICN K DIC,DA Q:Y'>0
"RTN","PSOBING1",126,0)
 I PSZ=0 K DD,DIC,DO,DA S DA(1)=DT,(DINUM,X)=JOES,DIC="^PS(59.2,"_DT_",1,",DIC(0)="LZ" D FILE^DICN K DIC,DA,DO
"RTN","PSOBING1",127,0)
 S DA=ODA D STATS1^PSOBRPRT,WTIME
"RTN","PSOBING1",128,0)
END K ADA,BDA,BDIV,BNGRXP,BNGSUS,BNAME,BRX,CNT1,CT,DA,DD,DIC,DIE,DIK,DIR,DO,DR,DTOUT,DUOUT,GRP,GRTP,JOES
"RTN","PSOBING1",129,0)
 K NAM,NDA,NFLAG,NME,ODA,PSZ,RXO,SSN,TDFN,TFLAG,TIC,TICK,TIEN,TM,TM1,TSSN,X,Y,XX
"RTN","PSOBING1",130,0)
 Q
"RTN","PSOTALK")
0^1^B177380845^B83851636
"RTN","PSOTALK",1,0)
PSOTALK ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA ;12/20/17  19:09
"RTN","PSOTALK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182,211,200,249,297,326,502**;DEC 1997;Build 13
"RTN","PSOTALK",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOTALK",5,0)
 ;External reference to ^PS(59.7 controlled subscription by DBIA 694
"RTN","PSOTALK",6,0)
 ;External reference to WTEXT^PSSWRNA supported by DBIA 4444
"RTN","PSOTALK",7,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOTALK",8,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK",9,0)
EN Q:'$$PAT55  ; QUIT IF NOT A SCRIPTALK ELIGIBLE PATIENT
"RTN","PSOTALK",10,0)
 S PSOSTALK=1
"RTN","PSOTALK",11,0)
 N PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,LINE
"RTN","PSOTALK",12,0)
 D GATHER,TRANSQ,CLEAN
"RTN","PSOTALK",13,0)
 Q
"RTN","PSOTALK",14,0)
 ;
"RTN","PSOTALK",15,0)
CLEAN K PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,VADM
"RTN","PSOTALK",16,0)
 K PSOCTP,PSOCTV,XMIT,PSORCT,PSOTSSN,PSOEXPDT
"RTN","PSOTALK",17,0)
 K PSOLNE,PSOLEN,PSOLINE,PSOWORD,PSOWDS,LINE
"RTN","PSOTALK",18,0)
 K PSOSIG1,PSOLSIG,PSOSIG,PSOSTOP,PSOPMAP
"RTN","PSOTALK",19,0)
 Q
"RTN","PSOTALK",20,0)
BARE N RX,PSOPMAP,PSOTKBT,PSOTKRX,PSOTKDFN,PSOTKZT,ZTIO
"RTN","PSOTALK",21,0)
 D CLEAN
"RTN","PSOTALK",22,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQM" D ^DIC K DIC Q:Y<0  S RX=+Y
"RTN","PSOTALK",23,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",24,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BAREO
"RTN","PSOTALK",25,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BAREO
"RTN","PSOTALK",26,0)
 D GATHER
"RTN","PSOTALK",27,0)
 W !!!,$S($G(PSOTKZT)'="`":"  Queuing ScripTalk label",1:" *** UNABLE TO QUEUE SCRIPTALK LABEL ***")
"RTN","PSOTALK",28,0)
 D TRANSQ
"RTN","PSOTALK",29,0)
BAREO D CLEAN
"RTN","PSOTALK",30,0)
 W !!
"RTN","PSOTALK",31,0)
 G BARE
"RTN","PSOTALK",32,0)
 Q
"RTN","PSOTALK",33,0)
BARI N RX,PSOPMAP,PSOTKBT,PSOTKRX,PSOTKDFN,PSOTKZT,ZTIO
"RTN","PSOTALK",34,0)
 D CLEAN
"RTN","PSOTALK",35,0)
 S RX=$$READER^PSOTALK1("FO^1:12","Enter Barcode Rx#")
"RTN","PSOTALK",36,0)
 Q:RX']""
"RTN","PSOTALK",37,0)
 G:RX'["-" BARIO
"RTN","PSOTALK",38,0)
 S RX=$P(RX,"-",2)
"RTN","PSOTALK",39,0)
 I '$D(^PSRX(RX,0)) W !,"Prescription not on file" G BARIO
"RTN","PSOTALK",40,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BARIO
"RTN","PSOTALK",41,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BARIO
"RTN","PSOTALK",42,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",43,0)
 D GATHER
"RTN","PSOTALK",44,0)
 W !!!,$S($G(PSOTKZT)'="`":"  Queuing ScripTalk label",1:" *** UNABLE TO QUEUE SCRIPTALK LABEL ***")
"RTN","PSOTALK",45,0)
 D TRANSQ
"RTN","PSOTALK",46,0)
BARIO D CLEAN
"RTN","PSOTALK",47,0)
 W !!
"RTN","PSOTALK",48,0)
 G BARI
"RTN","PSOTALK",49,0)
 Q
"RTN","PSOTALK",50,0)
GATHER ;
"RTN","PSOTALK",51,0)
 N DFN
"RTN","PSOTALK",52,0)
 S (DFN,PSOTKDFN)=$P(^PSRX(RX,0),"^",2),PSOTKRX=RX
"RTN","PSOTALK",53,0)
 D DEM^VADPT
"RTN","PSOTALK",54,0)
 S PHONE=$$PHONE
"RTN","PSOTALK",55,0)
 S RXNUM=+$$RXNUM
"RTN","PSOTALK",56,0)
 S RXALPHA=$$RXALPHA
"RTN","PSOTALK",57,0)
 S DATE=$$DATE
"RTN","PSOTALK",58,0)
 S FILLS=$$RFILLS I $L(RFILLS)=1 S FILLS="0"_FILLS
"RTN","PSOTALK",59,0)
 S PTNAME=VADM(1) D
"RTN","PSOTALK",60,0)
 .N FNAM,MI
"RTN","PSOTALK",61,0)
 .S FNAM=$P(PTNAME,",",2) I FNAM[" " D
"RTN","PSOTALK",62,0)
 ..S MI=$P(FNAM," ",2,99) I MI[" " S MI=$P(MI," ")
"RTN","PSOTALK",63,0)
 ..S FNAM=$P(FNAM," ")
"RTN","PSOTALK",64,0)
 .S PTNAME=FNAM_$S($G(MI)'="":" "_MI,1:"")_" "_$P(PTNAME,",")
"RTN","PSOTALK",65,0)
 .S PTNAME=$$UP^XLFSTR(PTNAME)
"RTN","PSOTALK",66,0)
 .S PTNAME=$TR(PTNAME,"-"," ")
"RTN","PSOTALK",67,0)
 .S PTNAME=$TR(PTNAME,".","")
"RTN","PSOTALK",68,0)
 .S PTNAME=$TR(PTNAME,"'"," ")
"RTN","PSOTALK",69,0)
 D TRANS Q:$G(PSOTKBT)=""!(PSOTKZT="`")
"RTN","PSOTALK",70,0)
 S SIG=$TR($$UP^XLFSTR($$SIGPOE),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",71,0)
 S SIGX=$TR($$UP^XLFSTR($$SIGPOEX),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",72,0)
 S PROV=$E($$UP^XLFSTR($$PROV),1,30)
"RTN","PSOTALK",73,0)
 S DRUG=$TR($$UP^XLFSTR($$DRUG),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",74,0)
 S WARN=$$WARN
"RTN","PSOTALK",75,0)
 D PSOEXP
"RTN","PSOTALK",76,0)
 S LINE(1)="VAMC "_$$CITY_", "_$$STATE_"  "_$$ZIP
"RTN","PSOTALK",77,0)
 S LINE(2)=$$SITE_" ("_$$CLERK_"/"_$$VRPH_") "_$$ACODE_"-"_$$EPHON_" Exp: "_PSOEXPDT
"RTN","PSOTALK",78,0)
 S LINE(3)="Rx# "_$$RXNUM_"  "_$$EDATE_"  Fill "_$$FILNO_" of "_$$TFILLS
"RTN","PSOTALK",79,0)
 S LINE(4)=$$EPAT_"  "_$$LAST4
"RTN","PSOTALK",80,0)
 D INST^PSOTALK1 S LINE(5)=$G(PSOLNE(1)),LINE(6)=$G(PSOLNE(2)),LINE(7)=$G(PSOLNE(3))
"RTN","PSOTALK",81,0)
 S LINE(8)=$$EPROV,LINE(10)=$$DRUG
"RTN","PSOTALK",82,0)
 S LINE(9)="Qty: "_$$QTY_"  "_$$DF
"RTN","PSOTALK",83,0)
 Q
"RTN","PSOTALK",84,0)
TRANS ;If printer mapping defined use it; otherwise print by division 01/19/07
"RTN","PSOTALK",85,0)
 D PCHK:'$D(PSOPMAP)  ;don't recheck for mapped printer if PSOPMAP equal 0 (not defined) or 1 (defined)
"RTN","PSOTALK",86,0)
 I '$D(^PS(59.7,1,47,"B",IOS))&('$G(PSOPMAP)) S PSOTKZT="`"_$P($G(^PS(59,PSOSITE,"STALK")),U),PSOTKBT=$S($P($G(^PS(59,PSOSITE,"STALK")),"^",3)=10:1,1:0)
"RTN","PSOTALK",87,0)
 Q
"RTN","PSOTALK",88,0)
 ;
"RTN","PSOTALK",89,0)
TRANSQ ;
"RTN","PSOTALK",90,0)
 Q:$G(PSOTKBT)=""!(PSOTKZT="`")
"RTN","PSOTALK",91,0)
 S ZTRTN="GO^PSOTALK",ZTSAVE("*")="",ZTDTH=$$NOW^XLFDT,ZTDESC="ScripTalk Interface Transmission",ZTIO=PSOTKZT
"RTN","PSOTALK",92,0)
 D ^%ZTLOAD
"RTN","PSOTALK",93,0)
 Q
"RTN","PSOTALK",94,0)
PCHK ;Check for printers that are mapped to a ScripTalk printer
"RTN","PSOTALK",95,0)
 N PSOLPRT,PSONIOS,PSOLBSEQ
"RTN","PSOTALK",96,0)
 S PSOTKZT="`",PSOLPRT=$S($D(PSOLAP):PSOLAP,$G(SUSPT):PSLION,$D(ION):ION,1:"") Q:PSOLPRT=""  Q:'$D(^%ZIS(1,"B",PSOLPRT))
"RTN","PSOTALK",97,0)
 S PSONIOS="",PSOPMAP=0,PSONIOS=$O(^%ZIS(1,"B",PSOLPRT,PSONIOS))
"RTN","PSOTALK",98,0)
 I $D(^PS(59.7,1,47,"B",PSONIOS)) D
"RTN","PSOTALK",99,0)
 . S PSOLBSEQ="",PSOLBSEQ=$O(^PS(59.7,1,47,"B",PSONIOS,PSOLBSEQ))
"RTN","PSOTALK",100,0)
 . S PSOTKZT=PSOTKZT_$P(^PS(59.7,1,47,PSOLBSEQ,0),"^",2),PSOPMAP=1,PSOTKBT=$S($P($G(^PS(59.7,1,47,PSOLBSEQ,0)),"^",3)=10:1,1:0)
"RTN","PSOTALK",101,0)
 Q
"RTN","PSOTALK",102,0)
 ;
"RTN","PSOTALK",103,0)
GO W !,"^XA",!,"^FO250,700^XGE:RX.GRF^FS"  ;;1.2e 4-17-02 TO MOVE GRAPHIC
"RTN","PSOTALK",104,0)
 D OVERLAY,PICOTAG  ;;FOR LARGER LABELS
"RTN","PSOTALK",105,0)
 W !,"^PQ1,0,1,Y",!,"^XZ"  ;;FOR LARGER LABELS
"RTN","PSOTALK",106,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK",107,0)
 Q
"RTN","PSOTALK",108,0)
 ;
"RTN","PSOTALK",109,0)
OVERLAY F PSOLINE=1:1:7 D DEFLINE((9+((20-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",110,0)
 F PSOLINE=8:1:10 D DEFLINE((9+((19-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",111,0)
 Q
"RTN","PSOTALK",112,0)
 ;
"RTN","PSOTALK",113,0)
DEFLINE(XCORD,YCORD,PRTOUT,FIELDNO,OFFSET) ;
"RTN","PSOTALK",114,0)
 W !,"^AFR,20,10^FO"_XCORD_","_YCORD_"^FR^CI0^FD"_PRTOUT_"^FS"
"RTN","PSOTALK",115,0)
 Q
"RTN","PSOTALK",116,0)
 ;
"RTN","PSOTALK",117,0)
PICOTAG S PSOCTP=1
"RTN","PSOTALK",118,0)
 I PSOTKBT D SET10 Q
"RTN","PSOTALK",119,0)
 S DRUG=$E(DRUG,1,39)  ;1.2c*1 TEMPORARY FIX FOR DRUG TRUNCATE AT 39
"RTN","PSOTALK",120,0)
 F XMIT=PTNAME,DRUG,SIGX,DATE,FILLS,WARN,PROV,PHONE,RXNUM,RXALPHA D XMITP
"RTN","PSOTALK",121,0)
 Q
"RTN","PSOTALK",122,0)
 ;
"RTN","PSOTALK",123,0)
XMITP W !,"^RX"_$S(PSOCTP<10:"0",1:"")_PSOCTP_","_XMIT_"^FS"
"RTN","PSOTALK",124,0)
 S PSOCTP=PSOCTP+1
"RTN","PSOTALK",125,0)
 Q
"RTN","PSOTALK",126,0)
ID() I $$PAT55 Q "+SCRIPTALK"
"RTN","PSOTALK",127,0)
 E  Q ""
"RTN","PSOTALK",128,0)
AUTO ;;v1.2c - LABEL REPRINTING FUNCTIONS 3-12-02
"RTN","PSOTALK",129,0)
 Q:$G(PSOTREP)  ;NO AUTO-PRINT DURING REGULAR NON-VOIDED LABEL REPRINT
"RTN","PSOTALK",130,0)
 N PSOPMAP,PSOTKBT,PSOTKRX,PSOTKDFN,PSOTKZT,ZTIO
"RTN","PSOTALK",131,0)
 D PCHK
"RTN","PSOTALK",132,0)
 I $P($G(^PS(59,+PSOSITE,"STALK")),U,2)="A"!($G(PSOPMAP)) D EN
"RTN","PSOTALK",133,0)
 Q
"RTN","PSOTALK",134,0)
 ;
"RTN","PSOTALK",135,0)
PAT55() Q +$G(^PS(55,"ASTALK",$P(^PSRX(RX,0),"^",2)))  ;IS PATIENT ENROLLED (NEW FIELD POSITION 2-12-02 RMS UPDATE v1.2b)
"RTN","PSOTALK",136,0)
PHONE() ;changes below 1.2c*1 to swap to site signed-on vs. site from Rx
"RTN","PSOTALK",137,0)
 Q $E($P(^PS(59,+PSOSITE,0),"^",3),1,3)_$E($TR($P(^PS(59,+PSOSITE,0),"^",4),"-,",""),1,7) ; RX DIVISION PHONE NUMBER
"RTN","PSOTALK",138,0)
CITY() Q $P(^PS(59,+PSOSITE,0),"^",7)
"RTN","PSOTALK",139,0)
STATE() Q $P(^DIC(5,$P(^PS(59,+PSOSITE,0),"^",8),0),"^",2)
"RTN","PSOTALK",140,0)
ZIP() Q $P(^PS(59,+PSOSITE,0),"^",5)
"RTN","PSOTALK",141,0)
SITE() Q $P(^PS(59,+PSOSITE,0),"^",6)
"RTN","PSOTALK",142,0)
ACODE() Q $P(^PS(59,+PSOSITE,0),"^",3)
"RTN","PSOTALK",143,0)
EPHON() Q $P(^PS(59,+PSOSITE,0),"^",4)
"RTN","PSOTALK",144,0)
CLERK() Q $P($G(^PSRX(RX,"OR1")),"^",5)
"RTN","PSOTALK",145,0)
PSOEXP ;
"RTN","PSOTALK",146,0)
 I 'PSOTKBT N X1,X2,X S X1=DT,X2=365 D C^%DTC S PSOEXPDT=X
"RTN","PSOTALK",147,0)
 I PSOTKBT S PSOEXPDT=$P($G(^PSRX(RX,2)),"^",6)
"RTN","PSOTALK",148,0)
 S PSOEXPDT=$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3)
"RTN","PSOTALK",149,0)
 Q
"RTN","PSOTALK",150,0)
VRPH() Q $P($G(^PSRX(RX,2)),"^",10)
"RTN","PSOTALK",151,0)
RXNUM() Q $P(^PSRX(RX,0),"^",1) ;RETURN RX EXTERNAL NUMBER
"RTN","PSOTALK",152,0)
RXALPHA() ;RETURN RENEWAL LETTER OR SPACE CHARACTER
"RTN","PSOTALK",153,0)
 N RXALPHA
"RTN","PSOTALK",154,0)
 S RXALPHA=$E($P(^PSRX(RX,0),"^",1),$L($P(^PSRX(RX,0),"^",1)))
"RTN","PSOTALK",155,0)
 Q $S(RXALPHA?1A:RXALPHA,1:" ")
"RTN","PSOTALK",156,0)
DATE() ;CHANGED 7-30-01 TO USE EDATE FORMAT ALSO WHEN SPEAKING
"RTN","PSOTALK",157,0)
 S EDATE=$P(^PSRX(RX,3),"^")
"RTN","PSOTALK",158,0)
 Q $E(EDATE,4,5)_$E(EDATE,6,7)_$E(EDATE,2,3)
"RTN","PSOTALK",159,0)
EDATE() Q $$FMTE^XLFDT($P(^PSRX(RX,3),"^"))  ; EXTERNAL DATE / LAST DISPENSED
"RTN","PSOTALK",160,0)
FILLS() Q $G(RXF)+1 ; FILL COUNT
"RTN","PSOTALK",161,0)
TFILLS() Q $P(^PSRX(RX,0),"^",9)+1 ; TOTAL FILLS
"RTN","PSOTALK",162,0)
RFILLS() ;NEW REFILLS REMAINING METHOD 9-21-00, BASED ON PTST+5^PSORXVW
"RTN","PSOTALK",163,0)
 S RFILLS=$P(^PSRX(RX,0),"^",9),PSORCT=0 F  S PSORCT=$O(^PSRX(RX,1,PSORCT)) Q:'PSORCT  S RFILLS=RFILLS-1
"RTN","PSOTALK",164,0)
 Q RFILLS
"RTN","PSOTALK",165,0)
FILNO() Q $$TFILLS-$$RFILLS
"RTN","PSOTALK",166,0)
EPAT() Q $P(^DPT($P(^PSRX(RX,0),"^",2),0),"^") ; EXTERNAL PATIENT NAME
"RTN","PSOTALK",167,0)
LAST4() S PSOTSSN="" ; REMOVED LAST 4 SSN - PATCH *326
"RTN","PSOTALK",168,0)
 Q PSOTSSN
"RTN","PSOTALK",169,0)
SIG() ;THIS SUBROUTINE WILL BE ABANDONED IF SIGPOE WORKS v1.2c 3-13-02
"RTN","PSOTALK",170,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG1",1,0),"^",1)),1,196)
"RTN","PSOTALK",171,0)
 E  Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196) ; SIG -- NEEDS TO BE EXPANDED
"RTN","PSOTALK",172,0)
SIGPOE() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE HUMAN READABLE PORTION
"RTN","PSOTALK",173,0)
 S PSOSIG=""
"RTN","PSOTALK",174,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEE
"RTN","PSOTALK",175,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",176,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",177,0)
 .N XX,X
"RTN","PSOTALK",178,0)
 .;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",179,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X I $L(PSOSIG)>138 D  Q
"RTN","PSOTALK",180,0)
 ..S PSOSIG=" THE SIG IS TOO LONG FOR PRINTED INSTRUCTIONS. >> REPRINT A NON-VOIDED RX LABEL AND AFFIX OVER THIS SCRIPTALK AUDIBLE LABEL."
"RTN","PSOTALK",181,0)
 E  D  ;
"RTN","PSOTALK",182,0)
 . N PSOSEQ
"RTN","PSOTALK",183,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",184,0)
 . S PSOLSIG=" THE SIG IS TOO LONG FOR PRINTED INSTRUCTIONS. >> REPRINT A NON-VOIDED RX LABEL AND AFFIX OVER THIS SCRIPTALK AUDIBLE LABEL."
"RTN","PSOTALK",185,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",186,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",187,0)
 ..;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",188,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>138 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",189,0)
 .. S PSOSIG=$G(PSOSIG)_$S($G(PSOSIG)]"":"",1:" ")_PSOSIG1
"RTN","PSOTALK",190,0)
SIGPOEE Q:'PSOTKBT $E(PSOSIG,2,197)  Q PSOSIG
"RTN","PSOTALK",191,0)
 ;
"RTN","PSOTALK",192,0)
SIGPOEX() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE READ ALOUD PORTION
"RTN","PSOTALK",193,0)
 S PSOSIG=""
"RTN","PSOTALK",194,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEEX
"RTN","PSOTALK",195,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",196,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",197,0)
 .N XX,X
"RTN","PSOTALK",198,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X I $L(PSOSIG)>196,'PSOTKBT D  Q
"RTN","PSOTALK",199,0)
 ..S PSOSIG=" LAS INSTRUCCIONES DE ESTA RECETA SON MUY LARGAS.  POR FAVOR SOLICITE A SU CUIDADOR QUE LE LEA LAS INSTRUCCIONES IMPRESAS EN EL ROTULO O COMUNIQUESE CON SU MEDICO PARA INSTRUCCIONES COMPLETAS."
"RTN","PSOTALK",200,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))'=0 Q:'PSOTKBT $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196)  Q $$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1))
"RTN","PSOTALK",201,0)
 E  D  ;
"RTN","PSOTALK",202,0)
 . N PSOSEQ
"RTN","PSOTALK",203,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",204,0)
 . S PSOLSIG=" THE INSTRUCTIONS FOR THIS PRESCRIPTION ARE TOO LONG. PLEASE HAVE A CAREGIVER READ THE PRINTED LABEL OR CONTACT YOUR PHYSICIAN FOR COMPLETE INSTRUCTIONS."
"RTN","PSOTALK",205,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",206,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",207,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>196,'PSOTKBT S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",208,0)
 .. S PSOSIG=$G(PSOSIG)_$S($G(PSOSIG)]"":"",1:" ")_PSOSIG1
"RTN","PSOTALK",209,0)
SIGPOEEX Q:'PSOTKBT $E(PSOSIG,2,197) Q PSOSIG
"RTN","PSOTALK",210,0)
PROV() ;PROVIDER NAME
"RTN","PSOTALK",211,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",212,0)
 Q $P($$NAMEFMT^XLFNAME(PSOPHYS)," MD")
"RTN","PSOTALK",213,0)
EPROV() ;
"RTN","PSOTALK",214,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",215,0)
 Q PSOPHYS
"RTN","PSOTALK",216,0)
QTY() Q $S($G(RXP):$P(RXP,"^",4),1:$P(^PSRX(RX,0),"^",7))
"RTN","PSOTALK",217,0)
DF() Q $P($G(^PSDRUG($P(^PSRX(RX,0),"^",6),660)),"^",8)
"RTN","PSOTALK",218,0)
DRUG() Q $$ZZ^PSOSUTL(RX) ; DRUG NAME
"RTN","PSOTALK",219,0)
WARN() N WARN,NWARN,IWARN,XWARN ; 1-28-02 UPDATE v1.2a TO ELIMINATE LOCAL CODES
"RTN","PSOTALK",220,0)
 S WARN=$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",8) ; WARNING LABEL CODES
"RTN","PSOTALK",221,0)
 F NWARN=1:1:3 S IWARN=$P(WARN,",",NWARN) S:IWARN>20 IWARN="" S:$L(IWARN)=1 IWARN="0"_IWARN S:$L(IWARN)=0 IWARN="00" S XWARN=$G(XWARN)_IWARN
"RTN","PSOTALK",222,0)
 Q XWARN
"RTN","PSOTALK",223,0)
 ;
"RTN","PSOTALK",224,0)
SET10 ;Set readable data for 10K printers, 1280 max characters
"RTN","PSOTALK",225,0)
 ;PSOTKLG("SIG")=Sig length
"RTN","PSOTALK",226,0)
 ;PSOTKLG("WARN",#)=Individual warning length
"RTN","PSOTALK",227,0)
 ;PSOTKLG("WARN","TOTAL")=Total warning length
"RTN","PSOTALK",228,0)
 ;PSOTKLG("OTHER")=Total length of other fields
"RTN","PSOTALK",229,0)
 ;PSOTKLG("LABEL")=Total label/heading length of RX11 including preceding spaces for data
"RTN","PSOTALK",230,0)
 N PSOTKEX,PSOTKEXD,PSOTKQTY,PSOTKLD,PSOTKLDT,PSOTKDRG,PSODKDFU,PSOTKWR,PSOTKLAN,PSOTKLG,PSOTKWN,PSOTKLP,PSOTKWIN,PSOTKWRT,PSOTK11,PSOTKRNM,PSOTKPHN,PSOTKWTO,PSOTKLOP,PSOTKNUM,PSOTKZND
"RTN","PSOTALK",231,0)
 S PSODKDFU=$$DF S PSOTKQTY="QUANTITY: "_$$QTY_$S(PSODKDFU'="":"  "_PSODKDFU,1:"")
"RTN","PSOTALK",232,0)
 S PSOTKEX=$P($G(^PSRX(PSOTKRX,2)),"^",6),PSOTKLD=$P($G(^PSRX(PSOTKRX,3)),"^"),PSOTKZND=$G(^PSRX(PSOTKRX,0)),PSOTKDRG=$P(PSOTKZND,"^",6),PSOTKNUM=$P(PSOTKZND,"^")
"RTN","PSOTALK",233,0)
 S PSOTKEXD="EXPIRATION: "_$E(PSOTKEX,4,5)_"/"_$E(PSOTKEX,6,7)_"/"_(1700+($E(PSOTKEX,1,3)))
"RTN","PSOTALK",234,0)
 S PSOTKLDT="DISPENSED ON: "_$E(PSOTKLD,4,5)_"/"_$E(PSOTKLD,6,7)_"/"_(1700+($E(PSOTKLD,1,3)))
"RTN","PSOTALK",235,0)
 I $E($G(SIGX))'=" " S SIGX=" "_$G(SIGX)
"RTN","PSOTALK",236,0)
 S PSOTKLG("SIG")=$L(SIGX)
"RTN","PSOTALK",237,0)
 S PSOTKLAN=$P($G(^PS(55,PSOTKDFN,"LAN")),"^",2),PSOTKWR=$$DRUG^PSSWRNA(PSOTKDRG,PSOTKDFN)
"RTN","PSOTALK",238,0)
 S PSOTKRNM="" F PSOTKLP=1:1:$L(PSOTKNUM) S PSOTKRNM=PSOTKRNM_$S(PSOTKLP>1:" ",1:"")_$E(PSOTKNUM,PSOTKLP)
"RTN","PSOTALK",239,0)
 S (PSOTKLG("WARN","TOTAL"),PSOTKWTO)=0 I PSOTKWR'="" F PSOTKLP=1:1 S PSOTKWIN=$P(PSOTKWR,",",PSOTKLP) Q:PSOTKWIN=""  D
"RTN","PSOTALK",240,0)
 .S PSOTKWN=$$WTEXT^PSSWRNA(PSOTKWIN,PSOTKLAN) Q:PSOTKWN=""
"RTN","PSOTALK",241,0)
 .S PSOTKWTO=PSOTKWTO+1 S PSOTKWRT(PSOTKWTO)=PSOTKWN,PSOTKLG("WARN",PSOTKWTO)=$L(PSOTKWN),PSOTKLG("WARN","TOTAL")=PSOTKLG("WARN","TOTAL")+$L(PSOTKWN)
"RTN","PSOTALK",242,0)
 S PSOTKLG("LABEL")=58+$S('PSOTKWTO:0,1:(6*PSOTKWTO))  ; 58 = all label data including spaces, also including 2 semicolons in F13, minus 1 from leading space in Sig
"RTN","PSOTALK",243,0)
 S PSOTKPHN=$S(PHONE="":" ",1:$$HLPHONE^HLFNC(PHONE))
"RTN","PSOTALK",244,0)
 S PSOTKLG("OTHER")=$L(PTNAME)+$L(DRUG)+$L(SIGX)+$L(PSOTKLDT)+$L(PSOTKEXD)+$L(PSOTKQTY)+$L(FILLS)+$L(PROV)+$L(PSOTKPHN)+$L(PSOTKRNM)
"RTN","PSOTALK",245,0)
 ;
"RTN","PSOTALK",246,0)
 I PSOTKLG("LABEL")+PSOTKLG("OTHER")+PSOTKLG("WARN","TOTAL")<1281 D  W !,PSOTK11 Q  ;All data fits on RX11
"RTN","PSOTALK",247,0)
 .S PSOTK11="^RX11,_F10 "_PTNAME_";_F11 "_DRUG_";_F12"_SIGX_";_F13 "_PSOTKLDT_";"_PSOTKEXD_";"_PSOTKQTY_";_F14 "_FILLS
"RTN","PSOTALK",248,0)
 .F PSOTKLP=1:1 Q:$G(PSOTKWRT(PSOTKLP))=""  D
"RTN","PSOTALK",249,0)
 ..S PSOTK11=PSOTK11_";_F15 "_PSOTKWRT(PSOTKLP)
"RTN","PSOTALK",250,0)
 .S PSOTK11=PSOTK11_";_F16 "_PROV_";_F17 "_PSOTKPHN_";_F18 "_PSOTKRNM_";^FS"
"RTN","PSOTALK",251,0)
 ;
"RTN","PSOTALK",252,0)
 I PSOTKLG("LABEL")+PSOTKLG("OTHER")>1280 D  W !,PSOTK11 Q  ;All Data (excluding Warnings) does not fit on label
"RTN","PSOTALK",253,0)
 .S PSOTK11="^RX11,_F10 "_PTNAME_";_F11 "_DRUG_";_F12 "_$$SIGALL_";_F13 "_PSOTKLDT_";"_PSOTKEXD_";"_PSOTKQTY_";_F14 "_FILLS_$S(PSOTKWTO:";F15 "_$$WNALL,1:"")_";_F16 "_PROV_";_F17 "_PSOTKPHN_";_F18 "_PSOTKRNM_";^FS"
"RTN","PSOTALK",254,0)
 ;
"RTN","PSOTALK",255,0)
 ;rest of code is for when PSOTKGL("OTHER")+PSOTKLG("LABEL") fits on label but adding the warning(s) take you over:
"RTN","PSOTALK",256,0)
 S PSOTKLG("REM")=1280-(PSOTKLG("OTHER")+PSOTKLG("LABEL"))  ;Set remaining length to work with for warnings
"RTN","PSOTALK",257,0)
 ;
"RTN","PSOTALK",258,0)
 I 143>PSOTKLG("REM"),PSOTKLG("WARN","TOTAL")>PSOTKLG("REM") D  W !,PSOTK11 Q  ;Cannot fit any warnings on label
"RTN","PSOTALK",259,0)
 .S PSOTK11="^RX11,_F10 "_PTNAME_";_F11 "_DRUG_";_F12 "_$$SIGALL_";_F13 "_PSOTKLDT_";"_PSOTKEXD_";"_PSOTKQTY_";_F14 "_FILLS_";F15 "_$$WNALL_";_F16 "_PROV_";_F17 "_PSOTKPHN_";_F18 "_PSOTKRNM_";^FS"
"RTN","PSOTALK",260,0)
 ;
"RTN","PSOTALK",261,0)
 ;Fit as many warnings as you can on label
"RTN","PSOTALK",262,0)
 F PSOTKLP=1:1 Q:PSOTKLG("WARN",PSOTKLP)+148>PSOTKLG("REM")  S PSOTKLG("REM")=PSOTKLG("REM")-(PSOTKLG("WARN",PSOTKLP)+6)
"RTN","PSOTALK",263,0)
 S PSOTKLP=PSOTKLP-1
"RTN","PSOTALK",264,0)
 S PSOTK11="^RX11,_F10 "_PTNAME_";_F11 "_DRUG_";_F12"_SIGX_";_F13 "_PSOTKLDT_";"_PSOTKEXD_";"_PSOTKQTY_";_F14 "_FILLS
"RTN","PSOTALK",265,0)
 F PSOTKLOP=1:1:PSOTKLP  D
"RTN","PSOTALK",266,0)
 .S PSOTK11=PSOTK11_";_F15 "_PSOTKWRT(PSOTKLOP)
"RTN","PSOTALK",267,0)
 S PSOTK11=PSOTK11_";_F15 "_$$WNREM_";_F16 "_PROV_";_F17 "_PSOTKPHN_";_F18 "_PSOTKRNM_";^FS"
"RTN","PSOTALK",268,0)
 W !,PSOTK11 Q
"RTN","PSOTALK",269,0)
 Q
"RTN","PSOTALK",270,0)
 ;
"RTN","PSOTALK",271,0)
WNALL() ;Message when unable to print any warnings
"RTN","PSOTALK",272,0)
 Q "Please note. No warnings could be included. Please ask a care giver or VHA professional to read the remainder of this information to you."
"RTN","PSOTALK",273,0)
 ;
"RTN","PSOTALK",274,0)
WNREM() ;Message when only able to print some warnings
"RTN","PSOTALK",275,0)
 Q "Please note. Not all warnings could be included. Please ask a care giver or VHA professional to read the remainder of this information to you."
"RTN","PSOTALK",276,0)
 ;
"RTN","PSOTALK",277,0)
SIGALL() ;Sig plus all other information besides warnings is too long
"RTN","PSOTALK",278,0)
 Q "Please note. Instructions "_$S(PSOTKWTO:"and warnings ",1:"")_"could not be included. Please ask a care giver or VHA professional to read the remainder of this information to you."
"RTN","PSOTALK1")
0^2^B5507505^B5211959
"RTN","PSOTALK1",1,0)
PSOTALK1 ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA (CONT'D) ;11/09/17  12:18
"RTN","PSOTALK1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,318,282,442,502**;DEC 1997;Build 13
"RTN","PSOTALK1",3,0)
 ;External reference to File ^PS(51 supported by DBIA 2224
"RTN","PSOTALK1",4,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK1",5,0)
INST ;PARSE OUT PRINTED INSTRUCTIONS TO MAX 46 CHAR PER LINE
"RTN","PSOTALK1",6,0)
 K PSOLNE
"RTN","PSOTALK1",7,0)
 S PSOLEN=0,PSOLINE=1,PSOWDS=$L(SIG," ")
"RTN","PSOTALK1",8,0)
 F PSOWORD=1:1 Q:PSOWORD>PSOWDS  D  ;
"RTN","PSOTALK1",9,0)
 . S PSOLNE(PSOLINE)=$G(PSOLNE(PSOLINE))_$P(SIG," ",PSOWORD)_" "
"RTN","PSOTALK1",10,0)
 . S PSOLEN=$G(PSOLEN)+$L($P(SIG," ",PSOWORD))+1
"RTN","PSOTALK1",11,0)
 . I PSOLEN+$L($P(SIG," ",PSOWORD+1))>46 S PSOLINE=PSOLINE+1,PSOLEN=0
"RTN","PSOTALK1",12,0)
 Q
"RTN","PSOTALK1",13,0)
 ;
"RTN","PSOTALK1",14,0)
LSIG(SIG) ;EXPAND A SIG
"RTN","PSOTALK1",15,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","PSOTALK1",16,0)
 .;PSO*7*282 Intended Use Check
"RTN","PSOTALK1",17,0)
 .N PSOIN S PSOIN=$O(^PS(51,"B",X,0)) I PSOIN,($P(^PS(51,PSOIN,0),"^",4)<2)&($D(^PS(51,"A",X))) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG,"",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSOTALK1",18,0)
 .S SGY=SGY_X_" "
"RTN","PSOTALK1",19,0)
 Q SGY
"RTN","PSOTALK1",20,0)
 ;
"RTN","PSOTALK1",21,0)
READER(ZDIR0,ZDIRA,ZDIRB) ;BASIC SHELL FOR DIR READS
"RTN","PSOTALK1",22,0)
 N X,Y,DIRUT,DIROUT,DTOUT,DUOUT,DIR,ZREAD
"RTN","PSOTALK1",23,0)
 S DIR(0)=ZDIR0 S:$G(ZDIRA)]"" DIR("A")=ZDIRA S:$G(ZDIRB)]"" DIR("B")=ZDIRB
"RTN","PSOTALK1",24,0)
 D ^DIR K DIR
"RTN","PSOTALK1",25,0)
 S:Y]"" ZREAD=Y
"RTN","PSOTALK1",26,0)
 I $D(DTOUT)!($D(DIRUT)) K ZREAD
"RTN","PSOTALK1",27,0)
 Q $G(ZREAD,"")
"RTN","PSOTALK1",28,0)
 ;
"RTN","PSOTALK1",29,0)
PSOSTALK ; SEE IF SCRIPTALK PATIENT AND PRINTER EXISTS AND IS SET TO AUTO-PRINT
"RTN","PSOTALK1",30,0)
 N A
"RTN","PSOTALK1",31,0)
 S PSOSTALK=0
"RTN","PSOTALK1",32,0)
 D AUTO^PSOTALK
"RTN","PSOTALK1",33,0)
 I 'PSOSTALK Q
"RTN","PSOTALK1",34,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOTALK1",35,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOTALK1",36,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOTALK1",37,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ScripTalk label printed"_$S($G(RXP):" (Partial)",1:"")_$S($G(REPRINT):" (Reprint)",1:"")_"^"_PDUZ_"^^"_$G(PSOLAP) ;*442
"RTN","PSOTALK1",38,0)
 S A=$P($G(^PS(59,+PSOSITE,"STALK")),"^",4) I A=0 S PSOSTALK=0
"RTN","PSOTALK1",39,0)
 Q
"RTN","PSOTALK1",40,0)
 ;
"RTN","PSOTALK3")
0^3^B23477900^B21440926
"RTN","PSOTALK3",1,0)
PSOTALK3 ;BIR/EJW - SCRIPTALK UTILITIES ;11/05/17  19:22
"RTN","PSOTALK3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,200,268,502**;DEC 1997;Build 13
"RTN","PSOTALK3",3,0)
 ;External reference to ^PS(59.7 controlled subscription by DBIA 694
"RTN","PSOTALK3",4,0)
TTRANS ;RE-INITIALIZE SCRIPTALK PRINTER
"RTN","PSOTALK3",5,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOTALK3",6,0)
 S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U)
"RTN","PSOTALK3",7,0)
 I ZTIO="`" W !,"No ScripTalk printer defined for division." Q
"RTN","PSOTALK3",8,0)
 S ZTDTH=$$NOW^XLFDT,ZTDESC="ScripTalk Printer Re-initialize"
"RTN","PSOTALK3",9,0)
 S ZTRTN="TINIT^PSOTALK3",ZTSAVE("*")=""
"RTN","PSOTALK3",10,0)
 D ^%ZTLOAD K ZTDTH,ZTRTN,ZTIO,ZTDESC
"RTN","PSOTALK3",11,0)
 W:$D(ZTSK)&('$D(ZTQUEUED)) !!,"Task Queued !",!
"RTN","PSOTALK3",12,0)
 Q
"RTN","PSOTALK3",13,0)
 ;
"RTN","PSOTALK3",14,0)
TINIT ;
"RTN","PSOTALK3",15,0)
 W !,"^XA ^MD30 ^XZ"
"RTN","PSOTALK3",16,0)
 W !,"^XA ^MD30 ^XZ"
"RTN","PSOTALK3",17,0)
 W !,"^XA ~SD30 ^XZ"
"RTN","PSOTALK3",18,0)
 W !,"^XA ^MFF,F ^XZ"
"RTN","PSOTALK3",19,0)
 W !,"^XA ^LT20 ^XZ"
"RTN","PSOTALK3",20,0)
 W !,"^XA ^MTT ^XZ"
"RTN","PSOTALK3",21,0)
 W !,"^XA ^JUS ^XZ"
"RTN","PSOTALK3",22,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK3",23,0)
 Q
"RTN","PSOTALK3",24,0)
 ;
"RTN","PSOTALK3",25,0)
TEST ;
"RTN","PSOTALK3",26,0)
 I $G(PSOTEST)?."?" R !,"Enter a Zebra Print Language test command to be sent",!,"to the ScripTalk printer: ",PSOTEST:DTIME
"RTN","PSOTALK3",27,0)
 I $G(PSOTEST)="" Q
"RTN","PSOTALK3",28,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOTALK3",29,0)
 S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U),ZTDTH=$$NOW^XLFDT,ZTDESC="ScripTalk Interface Test"
"RTN","PSOTALK3",30,0)
 I ZTIO="`" W !,"No ScripTalk printer defined for division." Q
"RTN","PSOTALK3",31,0)
 S ZTRTN="TPUT^PSOTALK3",ZTSAVE("*")=""
"RTN","PSOTALK3",32,0)
 D ^%ZTLOAD K ZTDTH,ZTRTN,ZTIO,ZTDESC
"RTN","PSOTALK3",33,0)
 W:$D(ZTSK)&('$D(ZTQUEUED)) !!,"Task Queued !",!
"RTN","PSOTALK3",34,0)
 K PSOTEST
"RTN","PSOTALK3",35,0)
 Q
"RTN","PSOTALK3",36,0)
TPUT ;SET VARIABLE 'PSOTEST' TO OUTPUT STRING
"RTN","PSOTALK3",37,0)
 W !,PSOTEST
"RTN","PSOTALK3",38,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK3",39,0)
 Q
"RTN","PSOTALK3",40,0)
 ;
"RTN","PSOTALK3",41,0)
TESTLAB ;
"RTN","PSOTALK3",42,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOTALK3",43,0)
 S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U),ZTDTH=$$NOW^XLFDT,ZTDESC="ScripTalk Sample Label"
"RTN","PSOTALK3",44,0)
 I ZTIO="`" W !,"No ScripTalk printer defined for division." Q
"RTN","PSOTALK3",45,0)
 S ZTRTN="TLABEL^PSOTALK3",ZTSAVE("*")=""
"RTN","PSOTALK3",46,0)
 W !,"The following test data will be sent to the ScripTalk printer:",! D TLABEL W !
"RTN","PSOTALK3",47,0)
 D ^%ZTLOAD K ZTDTH,ZTRTN,ZTIO,ZTDESC
"RTN","PSOTALK3",48,0)
 W:$D(ZTSK)&('$D(ZTQUEUED)) !!,"Task Queued !",!
"RTN","PSOTALK3",49,0)
 Q
"RTN","PSOTALK3",50,0)
TLABEL ;
"RTN","PSOTALK3",51,0)
 W !,"^XA"
"RTN","PSOTALK3",52,0)
 W !,"^FO250,700^XGE:RX.GRF^FS"
"RTN","PSOTALK3",53,0)
 W !,"^FO250,700^XGE:RX.GRF^FS"
"RTN","PSOTALK3",54,0)
 W !,"^AFR,20,10^FO531,50^FR^CI0^FD7305 N. MILITARY TRL  Exp: January 01,2002^FS"
"RTN","PSOTALK3",55,0)
 W !,"^AFR,20,10^FO503,50^FR^CI0^FDRX#82382787 January 01,2001  Fill 01 OF 01^FS"
"RTN","PSOTALK3",56,0)
 W !,"^AFR,20,10^FO475,50^FR^CI0^FDJOE VETERAN^FS"
"RTN","PSOTALK3",57,0)
 W !,"^AFR,20,10^FO447,50^FR^CI0^FDTAKE 1 CAPSULE THREE TIMES DAILY^FS"
"RTN","PSOTALK3",58,0)
 W !,"^AFR,20,10^FO419,50^FR^CI0^FD^FS"
"RTN","PSOTALK3",59,0)
 W !,"^AFR,20,10^FO391,50^FR^CI0^FD^FS"
"RTN","PSOTALK3",60,0)
 W !,"^AFR,20,10^FO363,50^FR^CI0^FD^FS"
"RTN","PSOTALK3",61,0)
 W !,"^AFR,20,10^FO335,50^FR^CI0^FDDr. BEN CASEY MD^FS"
"RTN","PSOTALK3",62,0)
 W !,"^AFR,20,10^FO279,50^FR^CI0^FDQTY: 24 TABS^FS"
"RTN","PSOTALK3",63,0)
 W !,"^AFR,20,10^FO251,50^FR^CI0^FDAMOXICILLIN 500MG CAP^FS"
"RTN","PSOTALK3",64,0)
 W !,"^RX01,JOE VETERAN^FS"
"RTN","PSOTALK3",65,0)
 W !,"^RX02,AMOXICILLIN 500MG CAP^FS"
"RTN","PSOTALK3",66,0)
 W !,"^RX03,TAKE 1 CAPSULE THREE TIMES DAILY ^FS"
"RTN","PSOTALK3",67,0)
 W !,"^RX04,010101^FS"
"RTN","PSOTALK3",68,0)
 W !,"^RX05,00^FS"
"RTN","PSOTALK3",69,0)
 W !,"^RX06,020000^FS"
"RTN","PSOTALK3",70,0)
 W !,"^RX07,BEN CASEY^FS"
"RTN","PSOTALK3",71,0)
 W !,"^RX08,2928993888^FS"
"RTN","PSOTALK3",72,0)
 W !,"^RX09,82382787^FS"
"RTN","PSOTALK3",73,0)
 W !,"^RX10, ^FS"
"RTN","PSOTALK3",74,0)
 W !,"^PQ1,0,1,Y"
"RTN","PSOTALK3",75,0)
 W !,"^XZ"
"RTN","PSOTALK3",76,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK3",77,0)
 Q
"RTN","PSOTALK3",78,0)
 ;
"RTN","PSOTALK3",79,0)
STDEV ;Define ScripTalk printer for a Division or map another print device to the ScripTalk Printer
"RTN","PSOTALK3",80,0)
 N PSOSITE,PSOTYPE
"RTN","PSOTALK3",81,0)
STDEV1 ;
"RTN","PSOTALK3",82,0)
 W !!!
"RTN","PSOTALK3",83,0)
 K DIC,DIR,DIE,DA,DR
"RTN","PSOTALK3",84,0)
 S DIR(0)="SBO^D:Division;P:Printer",DIR("A")="Define ScripTalk Printer by (D)ivision or (P)rinter mapping?"
"RTN","PSOTALK3",85,0)
 S DIR("?")=" "
"RTN","PSOTALK3",86,0)
 S DIR("?",1)="Enter D to define ScripTalk printer by Division or enter P to tie a ScripTalk"
"RTN","PSOTALK3",87,0)
 S DIR("?",2)="printer to regular Pharmacy label printer(s) to control where the ScripTalk"
"RTN","PSOTALK3",88,0)
 S DIR("?",3)="labels print for multi-divisions."
"RTN","PSOTALK3",89,0)
 S PSOSITE=""
"RTN","PSOTALK3",90,0)
 D ^DIR G:$D(DIRUT)!(Y<0) STDEVQ S PSOTYPE=Y
"RTN","PSOTALK3",91,0)
 D STDEVM:PSOTYPE="P"
"RTN","PSOTALK3",92,0)
 D STDEVD:PSOTYPE="D"
"RTN","PSOTALK3",93,0)
 G STDEV1
"RTN","PSOTALK3",94,0)
STDEVQ ;
"RTN","PSOTALK3",95,0)
 K DIC,DIR,DIE,DA,DR,DIRUT,Y
"RTN","PSOTALK3",96,0)
 Q
"RTN","PSOTALK3",97,0)
 ;
"RTN","PSOTALK3",98,0)
STDEVD ;Define ScripTalk device by division
"RTN","PSOTALK3",99,0)
 W ! S DIC("A")="Division: ",DIC=59,DIC(0)="AEMQ"
"RTN","PSOTALK3",100,0)
 S:$G(PSOVEX)'=1 DIC("S")="I $S('$D(^PS(59,+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"RTN","PSOTALK3",101,0)
 D ^DIC K DIC Q:$D(DIRUT)!(Y<0)
"RTN","PSOTALK3",102,0)
 Q:+Y<0
"RTN","PSOTALK3",103,0)
 S PSOSITE=+Y
"RTN","PSOTALK3",104,0)
 S DIE="^PS(59,",DA=PSOSITE,DR="107;107.1;107.2" D ^DIE
"RTN","PSOTALK3",105,0)
 Q
"RTN","PSOTALK3",106,0)
 ;
"RTN","PSOTALK3",107,0)
STDEVM ;Map a printer to a ScripTalk printer
"RTN","PSOTALK3",108,0)
 S DIE="^PS(59.7,",DA=1,DR="47" L +^PS(59.7,1,47):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) D  I $T D ^DIE L -^PS(59.7,1,47)
"RTN","PSOTALK3",109,0)
 . I '$T W !?5,"Another user is editing this entry."
"RTN","PSOTALK3",110,0)
 Q
"RTN","PSOTALK3",111,0)
 ;
"RTN","PSOTALK3",112,0)
STVLP ;Define VOIDED label print by division
"RTN","PSOTALK3",113,0)
 W ! S DIC("A")="Division: ",DIC=59,DIC(0)="AEMQ"
"RTN","PSOTALK3",114,0)
 S:$G(PSOVEX)'=1 DIC("S")="I $S('$D(^PS(59,+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"RTN","PSOTALK3",115,0)
 D ^DIC K DIC Q:$D(DIRUT)!(Y<0)
"RTN","PSOTALK3",116,0)
 Q:+Y<0
"RTN","PSOTALK3",117,0)
 S PSOSITE=+Y
"RTN","PSOTALK3",118,0)
 S DIE="^PS(59,",DA=PSOSITE,DR="107.3" D ^DIE
"RTN","PSOTALK3",119,0)
 Q
"VER")
8.0^22.2
"^DD",59,59,107.2,0)
SCRIPTALK PRINTER TYPE^S^2:2K LABEL;10:10K LABEL;^STALK;3^Q
"^DD",59,59,107.2,3)
Enter 2 if this ScripTalk printer is a 2K printer, enter 10 if this ScripTalk printer is a 10K printer.
"^DD",59,59,107.2,21,0)
^.001^9^9^3170908^^^
"^DD",59,59,107.2,21,1,0)
This field is used to determine the amount of readable prescription data
"^DD",59,59,107.2,21,2,0)
that is printed on the ScripTalk labels that are read aloud by the
"^DD",59,59,107.2,21,3,0)
ScripTalk Station Reader. Set this field according to the type of
"^DD",59,59,107.2,21,4,0)
ScripTalk printer, either 2K or 10K. This setting is used to determine
"^DD",59,59,107.2,21,5,0)
when to stop sending prescription data to the readable portion of the
"^DD",59,59,107.2,21,6,0)
label and print a readable message to the patient to seek help for this
"^DD",59,59,107.2,21,7,0)
particular prescription label, since there was not enough space for the
"^DD",59,59,107.2,21,8,0)
prescription data. If this field is not set, the software will assume it
"^DD",59,59,107.2,21,9,0)
is a 2K printer.
"^DD",59,59,107.2,"DT")
3170908
"^DD",59,59,107.3,0)
VOID OTHER LABELS^S^0:NO;1:YES;^STALK;4^Q
"^DD",59,59,107.3,3)
Enter Yes to VOID non ScripTalk labels, No to not void.
"^DD",59,59,107.3,21,0)
^^3^3^3171103^
"^DD",59,59,107.3,21,1,0)
This field allows the site to define, by division, whether or not they 
"^DD",59,59,107.3,21,2,0)
wish to void the print of the drug name for the non-ScripTalk labels when 
"^DD",59,59,107.3,21,3,0)
the patient is enrolled in ScripTalk.
"^DD",59,59,107.3,"DT")
3171103
"BLD",10487,6)
^427
**END**
**END**

