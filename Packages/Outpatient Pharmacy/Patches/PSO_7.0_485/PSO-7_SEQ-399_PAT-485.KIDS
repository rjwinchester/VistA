EMERGENCY Released PSO*7*485 SEQ #399
Extracted from mail message
**KIDS**:PSO*7.0*485^

**INSTALL NAME**
PSO*7.0*485
"BLD",9647,0)
PSO*7.0*485^OUTPATIENT PHARMACY^0^3170413^y
"BLD",9647,1,0)
^^3^3^3170413^^
"BLD",9647,1,1,0)
This is a follow-up patch for Fixed Medication Copayment Tier (FMCT) 
"BLD",9647,1,2,0)
patch PSO*7*460, where the mail message, "PRESCRIPTION QUESTIONS REVIEW 
"BLD",9647,1,3,0)
NEEDED" was not generating.
"BLD",9647,4,0)
^9.64PA^^
"BLD",9647,6)
1^
"BLD",9647,6.3)
37
"BLD",9647,"ABPKG")
n
"BLD",9647,"INID")
^n
"BLD",9647,"INIT")

"BLD",9647,"KRN",0)
^9.67PA^779.2^20
"BLD",9647,"KRN",.4,0)
.4
"BLD",9647,"KRN",.401,0)
.401
"BLD",9647,"KRN",.402,0)
.402
"BLD",9647,"KRN",.403,0)
.403
"BLD",9647,"KRN",.5,0)
.5
"BLD",9647,"KRN",.84,0)
.84
"BLD",9647,"KRN",3.6,0)
3.6
"BLD",9647,"KRN",3.8,0)
3.8
"BLD",9647,"KRN",9.2,0)
9.2
"BLD",9647,"KRN",9.8,0)
9.8
"BLD",9647,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9647,"KRN",9.8,"NM",1,0)
PSOCP^^0^B75724132
"BLD",9647,"KRN",9.8,"NM","B","PSOCP",1)

"BLD",9647,"KRN",19,0)
19
"BLD",9647,"KRN",19.1,0)
19.1
"BLD",9647,"KRN",101,0)
101
"BLD",9647,"KRN",409.61,0)
409.61
"BLD",9647,"KRN",771,0)
771
"BLD",9647,"KRN",779.2,0)
779.2
"BLD",9647,"KRN",870,0)
870
"BLD",9647,"KRN",8989.51,0)
8989.51
"BLD",9647,"KRN",8989.52,0)
8989.52
"BLD",9647,"KRN",8994,0)
8994
"BLD",9647,"KRN","B",.4,.4)

"BLD",9647,"KRN","B",.401,.401)

"BLD",9647,"KRN","B",.402,.402)

"BLD",9647,"KRN","B",.403,.403)

"BLD",9647,"KRN","B",.5,.5)

"BLD",9647,"KRN","B",.84,.84)

"BLD",9647,"KRN","B",3.6,3.6)

"BLD",9647,"KRN","B",3.8,3.8)

"BLD",9647,"KRN","B",9.2,9.2)

"BLD",9647,"KRN","B",9.8,9.8)

"BLD",9647,"KRN","B",19,19)

"BLD",9647,"KRN","B",19.1,19.1)

"BLD",9647,"KRN","B",101,101)

"BLD",9647,"KRN","B",409.61,409.61)

"BLD",9647,"KRN","B",771,771)

"BLD",9647,"KRN","B",779.2,779.2)

"BLD",9647,"KRN","B",870,870)

"BLD",9647,"KRN","B",8989.51,8989.51)

"BLD",9647,"KRN","B",8989.52,8989.52)

"BLD",9647,"KRN","B",8994,8994)

"BLD",9647,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9647,"QUES",0)
^9.62^^
"BLD",9647,"REQB",0)
^9.611^1^1
"BLD",9647,"REQB",1,0)
PSO*7.0*480^2
"BLD",9647,"REQB","B","PSO*7.0*480",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
485^3170413
"PKG",141,22,1,"PAH",1,1,0)
^^3^3^3170413
"PKG",141,22,1,"PAH",1,1,1,0)
This is a follow-up patch for Fixed Medication Copayment Tier (FMCT) 
"PKG",141,22,1,"PAH",1,1,2,0)
patch PSO*7*460, where the mail message, "PRESCRIPTION QUESTIONS REVIEW 
"PKG",141,22,1,"PAH",1,1,3,0)
NEEDED" was not generating.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOCP")
0^1^B75724132^B81967302
"RTN","PSOCP",1,0)
PSOCP ;BIR/BAB - Pharmacy CO-PAY Application Utilities for IB ;02/06/92
"RTN","PSOCP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,46,71,85,137,157,143,219,239,201,225,303,460,480,485**;DEC 1997;Build 37
"RTN","PSOCP",3,0)
 ;
"RTN","PSOCP",4,0)
 ;REF/IA - IBARX/125, SDCO22/1579, PS(55/2228, PSDRUG(/221, DGMSTAPI/2716, $$GETSHAD^DGUTL3/4462
"RTN","PSOCP",5,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSOCP",6,0)
 ;Reference to $$GETSTAT^DGMSTAPI supported by DBIA 3457
"RTN","PSOCP",7,0)
 ; 
"RTN","PSOCP",8,0)
CP ;Check if COPAY-Requires RXP,PSOSITE7
"RTN","PSOCP",9,0)
 I '$D(PSOPAR) D ^PSOLSET G CP
"RTN","PSOCP",10,0)
 K PSOCP
"RTN","PSOCP",11,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2) ; Set COPAY dfn PTR TO PATIENT
"RTN","PSOCP",12,0)
 S PSOCP=$P($G(^PSRX(RXP,"IB")),"^") ; IB action type
"RTN","PSOCP",13,0)
 S PSOSAVE=$S(PSOCP:1,1:"") ; save current copay status
"RTN","PSOCP",14,0)
 ; Set x=service^dfn^actiontype^user duz
"RTN","PSOCP",15,0)
 I +$G(PSOSITE7)'>0 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",16,0)
 S X=PSOSITE7_"^"_PSOCPN_"^"_PSOCP_"^"_$P(^PSRX(RXP,0),"^",16)
"RTN","PSOCP",17,0)
 ;
"RTN","PSOCP",18,0)
RX ;Determine Orig or Refill for RX
"RTN","PSOCP",19,0)
 N PSOIB,PSOPFS,PSOCPT S (PSOIB,PSOREF)=0
"RTN","PSOCP",20,0)
 I $G(^PSRX(RXP,1,+$G(YY),0))]"" S PSOREF=YY
"RTN","PSOCP",21,0)
 D PFSA^PSOPFSU1(RXP,PSOREF,2) G PFS:+PSOPFS
"RTN","PSOCP",22,0)
 ; Check if bill exists
"RTN","PSOCP",23,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",24,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",4)>0 G QUIT ; 'POTENTIAL BILL' - ALREADY ATTEMPTED TO BILL, BUT EXCEEDED ANNUAL COPAY CAP
"RTN","PSOCP",25,0)
 I PSOREF,+$G(^PSRX(RXP,1,PSOREF,"IB")) D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",26,0)
 I PSOREF,+$P($G(^PSRX(RXP,1,PSOREF,"IB")),"^",2) G QUIT ; POTENTIAL BILL
"RTN","PSOCP",27,0)
PFS ;
"RTN","PSOCP",28,0)
 S PSOCHG=1 ; set tem var to copay and check exception
"RTN","PSOCP",29,0)
 N MAILMSG
"RTN","PSOCP",30,0)
 D COPAYREL
"RTN","PSOCP",31,0)
 I 'PSOCHG D  D:PSOPFS CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS) G QUIT
"RTN","PSOCP",32,0)
 . I PSOSAVE S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",33,0)
 I PSOCHG=2 D  I 'PSOCP D:PSOPFS CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS) G QUIT ; IF 'SC' QUESTION APPLIES, BUT HAS NOT BEEN ANSWERED, SEND MAIL MSG AND KEEP COPAY STATUS AS IT WAS
"RTN","PSOCP",34,0)
 . D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF THE PSO COPAY KEY
"RTN","PSOCP",35,0)
 I PSOCHG=1,PSOSAVE="" D  I PSOREF S PSOCOMM="",PSOOLD="No Copay",PSONW="Copay" S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCP",36,0)
 . I '$D(^PSRX(RXP,"IB")),'PSOREF S $P(^PSRX(RXP,"IB"),"^",1)=1 Q
"RTN","PSOCP",37,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=1
"RTN","PSOCP",38,0)
 . S PSOCP=1,$P(X,"^",3)=PSOCP
"RTN","PSOCP",39,0)
 I PSOCHG'=2 I $G(MAILMSG) D MAIL2^PSOCPE ; SEND MAIL TO PHARM, PROV, AND HOLDERS OF PSO COPAY KEY HOLDERS
"RTN","PSOCP",40,0)
 ; Units for COPAY
"RTN","PSOCP",41,0)
 S PSOCPUN=$P(($P(^PSRX(RXP,0),"^",8)+29)/30,".",1)
"RTN","PSOCP",42,0)
 ; Build softlink for x(n)=softlink^units
"RTN","PSOCP",43,0)
 S X(1)="52:"_RXP S:PSOREF>0 X(1)=X(1)_";1:"_PSOREF S X(1)=X(1)_"^"_PSOCPUN
"RTN","PSOCP",44,0)
 ; Set correct user duz if refill
"RTN","PSOCP",45,0)
 I PSOREF S:+$P(^PSRX(RXP,1,PSOREF,0),"^",7)>0 $P(X,"^",4)=$P(^PSRX(RXP,1,PSOREF,0),"^",7)
"RTN","PSOCP",46,0)
 ;
"RTN","PSOCP",47,0)
IBNEW ;  Load ^TMP global for IB call
"RTN","PSOCP",48,0)
 Q:$G(RXP)'>0
"RTN","PSOCP",49,0)
 I PSOPFS D CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS)
"RTN","PSOCP",50,0)
 G QUIT:PSOPFS
"RTN","PSOCP",51,0)
 N D0
"RTN","PSOCP",52,0)
 G QUIT:'$D(X)
"RTN","PSOCP",53,0)
 S XTMP=X,XTMP(1)=X(1)
"RTN","PSOCP",54,0)
 ;
"RTN","PSOCP",55,0)
 ; Requires x=service^dfn^action type^user duz
"RTN","PSOCP",56,0)
 ;   x(n)=softlink^units 
"RTN","PSOCP",57,0)
 I $P(X,"^",3)="" S $P(X,"^",3)=$P(^PSRX(RXP,"IB"),"^",1)
"RTN","PSOCP",58,0)
 D NEW^IBARX
"RTN","PSOCP",59,0)
 ; Returns y=1^total charges for this group or Y=-1^error code
"RTN","PSOCP",60,0)
 ;         y(n)=IB number^charge for this Rx^AR bill #^Cap met^Partial or Full charge^Copay Exempt^Number from file 354.71
"RTN","PSOCP",61,0)
 ;         Cap met ('1' - If patient has met cap amount or reached cap with this charge or '0' if not)
"RTN","PSOCP",62,0)
 ;         Partial or Full ('P' for partial billing, 'F' for full billing, null for no billing)
"RTN","PSOCP",63,0)
 ;         Copay Exempt - ('1' for exempt, '0' for non-exempt, '-1' for copay off (manila)),
"RTN","PSOCP",64,0)
 ;            ('1' - If patient has met cap amount or reach cap with this charge
"RTN","PSOCP",65,0)
 ; Entry from file 354.71 will only be saved for fills that met the annual cap and could not be fully billed
"RTN","PSOCP",66,0)
 ;
"RTN","PSOCP",67,0)
 G QUIT:+Y=-1
"RTN","PSOCP",68,0)
 S XTMP=XTMP_"^"_Y,XTMP(1)=XTMP(1)_"^"_Y(1)
"RTN","PSOCP",69,0)
 ;
"RTN","PSOCP",70,0)
 ; see if exempt or copay cap was met
"RTN","PSOCP",71,0)
 I $P(Y(1),"^",6) D  G QUIT
"RTN","PSOCP",72,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay"
"RTN","PSOCP",73,0)
 . S PSOCOMM="RX COPAY INCOME EXEMPTION" S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",74,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",75,0)
 I $P(Y(1),"^",4) D
"RTN","PSOCP",76,0)
 . S PSOCOMM=$S($P(Y(1),"^",5)="F":" FULL BILLING FOR THIS FILL",$P(Y(1),"^",5)="P":" PARTIAL BILLING FOR THIS FILL ",1:" NO BILLING FOR THIS FILL")
"RTN","PSOCP",77,0)
 . S PREA="A"
"RTN","PSOCP",78,0)
 . S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",79,0)
 . I $P(Y(1),"^",5)'="F" D
"RTN","PSOCP",80,0)
 . . I PSOREF S $P(^PSRX(RXP,1,PSOREF,"IB"),"^",2)=$P(Y(1),"^",7) Q
"RTN","PSOCP",81,0)
 . . S $P(^PSRX(RXP,"IB"),"^",4)=$P(Y(1),"^",7)
"RTN","PSOCP",82,0)
 I $P(Y(1),"^",1)="" G QUIT
"RTN","PSOCP",83,0)
 ;
"RTN","PSOCP",84,0)
FILE ;File IB number in ^PSRX
"RTN","PSOCP",85,0)
 S PSOCP2=0
"RTN","PSOCP",86,0)
 S PSOCP2=+$P(XTMP(1),":",3)
"RTN","PSOCP",87,0)
 S:PSOCP2>0 ^PSRX(RXP,1,PSOCP2,"IB")=$P(XTMP(1),U,3) ;  Filing in refill node
"RTN","PSOCP",88,0)
 I PSOCP2>0,'$D(^PSRX(RXP,"IB")) S ^PSRX(RXP,"IB")="1^^" ;  If refill "IB" exists, need "IB" entry on original fill node
"RTN","PSOCP",89,0)
 S:PSOCP2=0 $P(^PSRX(RXP,"IB"),"^",2)=$P(XTMP(1),U,3) ;Filing in original fill (zero node)
"RTN","PSOCP",90,0)
QUIT ;
"RTN","PSOCP",91,0)
 K Y,PSOCP1,PSOCP2,QQ,PSOCPN,X,X2,XTMP,PSOCPUN,PSOREF,PSOCHG,PSOSAVE,PSOCOMM,PSOOLD,PSONW,PREA,PSORSN
"RTN","PSOCP",92,0)
 Q
"RTN","PSOCP",93,0)
EN D ^PSOLSET
"RTN","PSOCP",94,0)
EN1 S DIR(0)="NO",DIR("A")="Enter PRESCRIPTION number" D ^DIR K DIR G:$D(DIRUT) EXIT S RXP=X I +$G(^PSRX(RXP,0))'>0!+$P($G(^PSRX(RXP,"IB")),"^",0)>0 W !,?10,"RE-CHECK PRESCRIPTION NUMBER AND RE-ENTER " G EN1
"RTN","PSOCP",95,0)
 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",96,0)
 S PSODFN=$P(^PSRX(RXP,0),"^",2)
"RTN","PSOCP",97,0)
 D CP G EN1
"RTN","PSOCP",98,0)
EXIT K RXP D FINAL^PSOLSET Q
"RTN","PSOCP",99,0)
 ;
"RTN","PSOCP",100,0)
SC(PSODFN,PSODD) ;sup ref for CPRS, Pre-Copay enhancement
"RTN","PSOCP",101,0)
 N PSOSC
"RTN","PSOCP",102,0)
 I $$DT^PSOMLLDT S PSOSC="" G SCQ
"RTN","PSOCP",103,0)
 I $G(PSODD),($P($G(^PSDRUG(PSODD,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I")!($P($G(^(0)),"^",3)["N") S PSOSC=1 G SCQ
"RTN","PSOCP",104,0)
 I $P($G(^PS(55,+$G(PSODFN),"PS")),"^"),$P($G(^PS(53,+$P(^("PS"),"^"),0)),"^",7) S PSOSC=1 G SCQ
"RTN","PSOCP",105,0)
 N I,J,X S (X,PSOSC)=""
"RTN","PSOCP",106,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",107,0)
 G:'X SCQ
"RTN","PSOCP",108,0)
 S X=X_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOCP",109,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSC=I
"RTN","PSOCP",110,0)
SCQ Q $S($G(PSOSC)=2:0,1:1)
"RTN","PSOCP",111,0)
 ;
"RTN","PSOCP",112,0)
COPAYREL ; Recheck copay status at release
"RTN","PSOCP",113,0)
 ; check Rx patient status
"RTN","PSOCP",114,0)
 I $P(^PSRX(RXP,0),"^",3)'="",$P($G(^PS(53,$P(^PSRX(RXP,0),"^",3),0)),"^",7)=1 S PSOCHG=0,PSOCOMM="Rx Patient Status Change",PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",115,0)
 ; see if drug is nutritional supplement, investigational or supply
"RTN","PSOCP",116,0)
 N DRG,DRGTYP,X,PSOEXMPT
"RTN","PSOCP",117,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6),DRGTYP=$P($G(^PSDRUG(DRG,0)),"^",3)
"RTN","PSOCP",118,0)
 I DRGTYP["I" S PSOCOMM="Investigational Drug",PSOOLD="Copay",PSONW="No Copay",PSOCHG=0,PSOEXMPT=1
"RTN","PSOCP",119,0)
 I DRGTYP["S" S PSOCOMM="Supply Item",PSOOLD="Copay",PSONW="No Copay",PSOCHG=0,PSOEXMPT=1
"RTN","PSOCP",120,0)
 I DRGTYP["N" S PSOCOMM="Nutritional Supplement",PSOOLD="Copay",PSONW="No Copay",PSOCHG=0,PSOEXMPT=1
"RTN","PSOCP",121,0)
 K PSOTG,CHKXTYPE
"RTN","PSOCP",122,0)
 I +$G(^PSRX(RXP,"IBQ")) D XTYPE1^PSOCP1
"RTN","PSOCP",123,0)
 I $G(^PSRX(RXP,"IBQ"))["1" D  S PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOEXMPT=1 Q  ; COPAY EXEMPT
"RTN","PSOCP",124,0)
 . N EXMT,II,PSOCIBQ
"RTN","PSOCP",125,0)
 . S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",126,0)
 . F II=1,7,3,4,5,6,2,8 I $P(PSOCIBQ,"^",II)=1 S EXMT=$S(II=1:"SC",II=7:"CV",II=3:"AO",II=4:"IR",II=5:"EC",II=8:"SHAD",II=2:"MST",II=6:"HNC",1:"") D:EXMT'="" SETCOMM Q
"RTN","PSOCP",127,0)
 D SCNEW(.PSOTG,PSOCPN,DRG,RXP)
"RTN","PSOCP",128,0)
 N EXMT
"RTN","PSOCP",129,0)
 I '$D(CHKXTYPE) D XTYPE
"RTN","PSOCP",130,0)
 F EXMT="SC","CV","AO","IR","EC","SHAD","MST","HNC" I $D(PSOTG(EXMT)) D  I 'PSOCHG Q
"RTN","PSOCP",131,0)
 . I PSOTG(EXMT)=1 S PSOCHG=0 D SETCOMM
"RTN","PSOCP",132,0)
 ;Check copay tier. Tier zero does not have copay charges. Tier billing will be effective 2/27/17 and IB rate table decides what amount to bill based on rate effective date
"RTN","PSOCP",133,0)
 N CPDATE,X D NOW^%DTC S CPDATE=X,PSOCPT=$$CPTIER^PSNAPIS("",CPDATE,DRG) K CPDATE,X
"RTN","PSOCP",134,0)
 I $P(PSOCPT,"^")=0 S PSOCHG=0 Q  ;Tier zero do not send to IB for copay charge
"RTN","PSOCP",135,0)
 S EXMT="",MAILMSG=0 F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S MAILMSG=1 Q
"RTN","PSOCP",136,0)
 I MAILMSG,$D(PSOTG("SC")) I $G(PSOTG("SC"))="" S PSOCHG=2 ; 'SC' quest not answered, don't reset copay status to 'copay'
"RTN","PSOCP",137,0)
 I '$G(PSOEXMPT),$P(PSOCPT,"^")=""!($P(PSOCPT,"^")>0) S PSOCOMM="Copay Tier "_$S(PSOCPT="":"Null",1:+PSOCPT),PSOOLD="No Copay",PSONW="Copay",PSODA=RXP,PREA="R",PSOCHG=1 D ACTLOG^PSOCPA Q
"RTN","PSOCP",138,0)
 Q
"RTN","PSOCP",139,0)
 ;
"RTN","PSOCP",140,0)
SCNEW(PSOTG,PSOPT,PSODR,PSORN) ;CPRS supported ref
"RTN","PSOCP",141,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOCP",142,0)
 I '$G(PSOPT) Q
"RTN","PSOCP",143,0)
 ;I $G(PSODR),($P($G(^PSDRUG(PSODR,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") Q ;CIDC ALWAYS ASK
"RTN","PSOCP",144,0)
 N PSOCIBQ,PSOQMSH,PSOQVEH,PSOQRQD,PSOQHNC,PSOQPGW,DFN,PSOSCA,ZXX
"RTN","PSOCP",145,0)
 K PSOANSQ("SC>50")
"RTN","PSOCP",146,0)
 S DFN=PSOPT
"RTN","PSOCP",147,0)
 D SCP^PSORN52D S:PSOSCP>49&(PSOSCA) PSOANSQ("SC>50")=1
"RTN","PSOCP",148,0)
 I $G(PSORN) D
"RTN","PSOCP",149,0)
 . S PSOCIBQ=$G(^PSRX(PSORN,"IBQ"))
"RTN","PSOCP",150,0)
 . I $TR(PSOCIBQ,"^")="" S ZXX=$G(^PSRX(PSORN,"ICD",1,0)) D ICD:ZXX'=""
"RTN","PSOCP",151,0)
 I '$G(PSORN) S PSOCIBQ=""
"RTN","PSOCP",152,0)
 ;Rx Patient Status check is not being done here
"RTN","PSOCP",153,0)
 N PSOSCMX,Y,I,J,X S (X,PSOSCMX)=""
"RTN","PSOCP",154,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",155,0)
 G:'X SKIP
"RTN","PSOCP",156,0)
 S X=X_"^"_PSOPT D XTYPE^IBARX
"RTN","PSOCP",157,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",158,0)
SKIP ;
"RTN","PSOCP",159,0)
 I $G(PSOSCA)!($G(PSOSCMX)=2) S PSOTG("SC")=$S($P(PSOCIBQ,"^")=1:1,$P(PSOCIBQ,"^")=0:0,$G(PSORN)&($P($G(^PSRX(+$G(PSORN),"IB")),"^")):0,1:"")
"RTN","PSOCP",160,0)
 S:$$AO^SDCO22(PSOPT) PSOTG("AO")=$S($P(PSOCIBQ,"^",3)=1:1,$P(PSOCIBQ,"^",3)=0:0,1:"")
"RTN","PSOCP",161,0)
 S:$$IR^SDCO22(PSOPT) PSOTG("IR")=$S($P(PSOCIBQ,"^",4)=1:1,$P(PSOCIBQ,"^",4)=0:0,1:"")
"RTN","PSOCP",162,0)
 S:$$EC^SDCO22(PSOPT) PSOTG("EC")=$S($P(PSOCIBQ,"^",5)=1:1,$P(PSOCIBQ,"^",5)=0:0,1:"")
"RTN","PSOCP",163,0)
 S:$P($$GETSTAT^DGMSTAPI(PSOPT),"^",2)="Y" PSOTG("MST")=$S($P(PSOCIBQ,"^",2)=1:1,$P(PSOCIBQ,"^",2)=0:0,1:"")
"RTN","PSOCP",164,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONC,PSONCX S PSONCX=$$GETCUR^DGNTAPI(PSOPT,"PSONC") I $P($G(PSONC("IND")),"^")="Y" S PSOTG("HNC")=$S($P(PSOCIBQ,"^",6)=1:1,$P(PSOCIBQ,"^",6)=0:0,1:"")
"RTN","PSOCP",165,0)
 S:$P($$CVEDT^DGCV(PSOPT),"^",3) PSOTG("CV")=$S($P(PSOCIBQ,"^",7)=1:1,$P(PSOCIBQ,"^",7)=0:0,1:"")
"RTN","PSOCP",166,0)
 I $L($T(GETSHAD^DGUTL3)) S:$$GETSHAD^DGUTL3(PSOPT)=1 PSOTG("SHAD")=$S($P(PSOCIBQ,"^",8)=1:1,$P(PSOCIBQ,"^",8)=0:0,1:"")
"RTN","PSOCP",167,0)
 Q
"RTN","PSOCP",168,0)
 ;
"RTN","PSOCP",169,0)
ICD ;
"RTN","PSOCP",170,0)
 D ICD^PSOCP1
"RTN","PSOCP",171,0)
 Q
"RTN","PSOCP",172,0)
XTYPE ;
"RTN","PSOCP",173,0)
 N PSOCIBQ,PSOSCMX,Y,I,J,X,SAVY,ZXX
"RTN","PSOCP",174,0)
 S (X,PSOSCMX,SAVY)=""
"RTN","PSOCP",175,0)
 S PSOCIBQ=$G(^PSRX(RXP,"IBQ")) I $TR(PSOCIBQ,"^")="" S ZXX=$G(^PSRX(RXP,"ICD",1,0)) D ICD:ZXX'=""
"RTN","PSOCP",176,0)
 I $P(PSOCIBQ,"^",1)'="" S PSOTG("SC")=$P(PSOCIBQ,"^",1)
"RTN","PSOCP",177,0)
 I $D(PSOTG("SC")),$P(PSOCIBQ,"^",1)="" S PSOTG("SC")="" ; USE "CURRENT" SETTING AS ANS TO SC QUEST IF IT APPLIES
"RTN","PSOCP",178,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",179,0)
 I 'X Q
"RTN","PSOCP",180,0)
 S X=X_"^"_PSOCPN D XTYPE^IBARX
"RTN","PSOCP",181,0)
 I $G(Y)'=1 Q
"RTN","PSOCP",182,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S SAVY=I,I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",183,0)
 I PSOSCMX="",SAVY=0 S PSOCHG=0,PSOEXMPT=1 S PSOCOMM="Exempt from copayment" Q  ; INCOME EXEMPT OR SC
"RTN","PSOCP",184,0)
 I PSOSCMX=2,'$D(PSOTG("SC")) S PSOTG("SC")=$S(($G(RXP)&($P($G(^PSRX(+$G(RXP),"IB")),"^")))!($P(PSOCIBQ,"^")=0):0,$P(PSOCIBQ,"^")=1:1,1:"") Q
"RTN","PSOCP",185,0)
 Q
"RTN","PSOCP",186,0)
 ;
"RTN","PSOCP",187,0)
SETCOMM ;
"RTN","PSOCP",188,0)
 D SETCOMM^PSOCP1
"RTN","PSOCP",189,0)
 Q
"RTN","PSOCP",190,0)
 ;
"VER")
8.0^22.0
"BLD",9647,6)
^399
**END**
**END**

