Released PSO*7*526 SEQ #433
Extracted from mail message
**KIDS**:PSO*7.0*526^

**INSTALL NAME**
PSO*7.0*526
"BLD",11046,0)
PSO*7.0*526^OUTPATIENT PHARMACY^0^3180420^y
"BLD",11046,1,0)
^^4^4^3180420^
"BLD",11046,1,1,0)
This patch will resolve the following issues.
"BLD",11046,1,2,0)
 
"BLD",11046,1,3,0)
INC0105896 - <SYNTAX> error
"BLD",11046,1,4,0)
INC0320678 - <UNDEFINED> Error
"BLD",11046,4,0)
^9.64PA^^
"BLD",11046,6.3)
3
"BLD",11046,"ABPKG")
n
"BLD",11046,"KRN",0)
^9.67PA^779.2^20
"BLD",11046,"KRN",.4,0)
.4
"BLD",11046,"KRN",.401,0)
.401
"BLD",11046,"KRN",.402,0)
.402
"BLD",11046,"KRN",.403,0)
.403
"BLD",11046,"KRN",.5,0)
.5
"BLD",11046,"KRN",.84,0)
.84
"BLD",11046,"KRN",3.6,0)
3.6
"BLD",11046,"KRN",3.8,0)
3.8
"BLD",11046,"KRN",9.2,0)
9.2
"BLD",11046,"KRN",9.8,0)
9.8
"BLD",11046,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11046,"KRN",9.8,"NM",1,0)
PSOUTLA^^0^B52284744
"BLD",11046,"KRN",9.8,"NM",2,0)
PSODIR2^^0^B29095518
"BLD",11046,"KRN",9.8,"NM",3,0)
PSODIR3^^0^B18349076
"BLD",11046,"KRN",9.8,"NM","B","PSODIR2",2)

"BLD",11046,"KRN",9.8,"NM","B","PSODIR3",3)

"BLD",11046,"KRN",9.8,"NM","B","PSOUTLA",1)

"BLD",11046,"KRN",19,0)
19
"BLD",11046,"KRN",19.1,0)
19.1
"BLD",11046,"KRN",101,0)
101
"BLD",11046,"KRN",409.61,0)
409.61
"BLD",11046,"KRN",771,0)
771
"BLD",11046,"KRN",779.2,0)
779.2
"BLD",11046,"KRN",870,0)
870
"BLD",11046,"KRN",8989.51,0)
8989.51
"BLD",11046,"KRN",8989.52,0)
8989.52
"BLD",11046,"KRN",8994,0)
8994
"BLD",11046,"KRN","B",.4,.4)

"BLD",11046,"KRN","B",.401,.401)

"BLD",11046,"KRN","B",.402,.402)

"BLD",11046,"KRN","B",.403,.403)

"BLD",11046,"KRN","B",.5,.5)

"BLD",11046,"KRN","B",.84,.84)

"BLD",11046,"KRN","B",3.6,3.6)

"BLD",11046,"KRN","B",3.8,3.8)

"BLD",11046,"KRN","B",9.2,9.2)

"BLD",11046,"KRN","B",9.8,9.8)

"BLD",11046,"KRN","B",19,19)

"BLD",11046,"KRN","B",19.1,19.1)

"BLD",11046,"KRN","B",101,101)

"BLD",11046,"KRN","B",409.61,409.61)

"BLD",11046,"KRN","B",771,771)

"BLD",11046,"KRN","B",779.2,779.2)

"BLD",11046,"KRN","B",870,870)

"BLD",11046,"KRN","B",8989.51,8989.51)

"BLD",11046,"KRN","B",8989.52,8989.52)

"BLD",11046,"KRN","B",8994,8994)

"BLD",11046,"QDEF")
^^^^NO^^^^^^NO
"BLD",11046,"QUES",0)
^9.62^^
"BLD",11046,"REQB",0)
^9.611^2^2
"BLD",11046,"REQB",1,0)
PSO*7.0*496^2
"BLD",11046,"REQB",2,0)
PSO*7.0*504^2
"BLD",11046,"REQB","B","PSO*7.0*496",1)

"BLD",11046,"REQB","B","PSO*7.0*504",2)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
526^3180420
"PKG",206,22,1,"PAH",1,1,0)
^^4^4^3180420
"PKG",206,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues.
"PKG",206,22,1,"PAH",1,1,2,0)
 
"PKG",206,22,1,"PAH",1,1,3,0)
INC0105896 - <SYNTAX> error
"PKG",206,22,1,"PAH",1,1,4,0)
INC0320678 - <UNDEFINED> Error
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSODIR2")
0^2^B29095518^B28893582
"RTN","PSODIR2",1,0)
PSODIR2 ;IHS/DSD/JCM - rx order entry contd ;01/27/93 7:12
"RTN","PSODIR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,9,26,46,124,146,139,152,166,504,526**;DEC 1997;Build 3
"RTN","PSODIR2",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSODIR2",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSODIR2",5,0)
 ;External reference to ^%DTC supported by DBIA 10000
"RTN","PSODIR2",6,0)
 ;External reference to ^DIC supported by DBIA 10006
"RTN","PSODIR2",7,0)
 ;External reference to ^DIR supported by DBIA 10026
"RTN","PSODIR2",8,0)
 ;
"RTN","PSODIR2",9,0)
 ;---------------------------------------------------------------------
"RTN","PSODIR2",10,0)
 ;
"RTN","PSODIR2",11,0)
EXP(PSODIR) ;
"RTN","PSODIR2",12,0)
 K DIR,DIC
"RTN","PSODIR2",13,0)
 I $G(PSODRUG("EXPIRATION DATE"))]"" S Y=PSODRUG("EXPIRATION DATE") X ^DD("DD") S PSORX("EXPIRATION DATE")=Y
"RTN","PSODIR2",14,0)
 S DIR("A")="EXPIRES",DIR("B")=$S($G(PSORX("EXPIRATION DATE"))]"":PSORX("EXPIRATION DATE"),1:"T+6M")
"RTN","PSODIR2",15,0)
 S DIR(0)="D^NOW::EX"
"RTN","PSODIR2",16,0)
 S DIR("?")="Both the month and date are required."
"RTN","PSODIR2",17,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") EXPX
"RTN","PSODIR2",18,0)
 S PSODIR("EXPIRATION DATE")=Y
"RTN","PSODIR2",19,0)
EXPX K X,Y
"RTN","PSODIR2",20,0)
 Q
"RTN","PSODIR2",21,0)
 ;
"RTN","PSODIR2",22,0)
CLINIC(PSODIR) ;
"RTN","PSODIR2",23,0)
 K DIR,DIC S PSODIR("FIELD")=0
"RTN","PSODIR2",24,0)
 S DIR(0)="52,5" S:$G(PSORX("CLINIC"))]"" DIR("B")=PSORX("CLINIC"),DIR("A")="CLINIC"
"RTN","PSODIR2",25,0)
 D ^DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) CLINICX  ;526
"RTN","PSODIR2",26,0)
 I +Y>0 S PSODIR("CLINIC")=+Y,PSORX("CLINIC")=$P(Y,"^",2)
"RTN","PSODIR2",27,0)
 E  S (PSORX("CLINIC"),PSODIR("CLINIC"))=""
"RTN","PSODIR2",28,0)
CLINICX K X,Y,PSOX,DIC
"RTN","PSODIR2",29,0)
 Q
"RTN","PSODIR2",30,0)
 ;
"RTN","PSODIR2",31,0)
MW(PSODIR) ;
"RTN","PSODIR2",32,0)
 K DIR,DIC
"RTN","PSODIR2",33,0)
 S DIR(0)="52,11" S:$G(POERR)&'$D(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$S($P($G(OR0),"^",17)="M":"MAIL",1:"WINDOW")
"RTN","PSODIR2",34,0)
 S DIR("B")=$S($G(PSORX("MAIL/WINDOW"))]"":PSORX("MAIL/WINDOW"),$G(PSOTPBFG)&($G(PSOFROM)="NEW"):"MAIL",1:"WINDOW")
"RTN","PSODIR2",35,0)
 D DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) MWX
"RTN","PSODIR2",36,0)
 I $G(Y(0))']"" S PSODIR("DFLG")=1 G MWX
"RTN","PSODIR2",37,0)
 S PSODIR("MAIL/WINDOW")=Y,PSORX("MAIL/WINDOW")=Y(0)
"RTN","PSODIR2",38,0)
 I $G(PSORX("EDIT"))]"",PSODIR("MAIL/WINDOW")'="W" K PSODIR("METHOD OF PICK-UP")
"RTN","PSODIR2",39,0)
MW1 G:PSODIR("MAIL/WINDOW")'="W"!('$P($G(PSOPAR),"^",12)) MWX
"RTN","PSODIR2",40,0)
 S DIR(0)="52,35O"
"RTN","PSODIR2",41,0)
 S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP")
"RTN","PSODIR2",42,0)
 D DIR G:$G(PSODIR("DFLG")) MWX
"RTN","PSODIR2",43,0)
 I X[U W !,"Cannot jump to another field ..",! G MW1
"RTN","PSODIR2",44,0)
 S (PSODIR("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y
"RTN","PSODIR2",45,0)
MWX K X,Y
"RTN","PSODIR2",46,0)
 Q
"RTN","PSODIR2",47,0)
 ;
"RTN","PSODIR2",48,0)
RMK(PSODIR) ;
"RTN","PSODIR2",49,0)
RMKEN K DIR,DIC
"RTN","PSODIR2",50,0)
 S DIR(0)="52,12"
"RTN","PSODIR2",51,0)
 S:$G(PSODIR("REMARKS"))]"" DIR("B")=PSODIR("REMARKS")
"RTN","PSODIR2",52,0)
 D DIR G:$G(PSODIR("DFLG")) RMKX  ;*526
"RTN","PSODIR2",53,0)
 I X[U W !,"Cannot jump to another field ..",! G RMKEN
"RTN","PSODIR2",54,0)
 S:$L(X)>0 PSODIR("REMARKS")=X
"RTN","PSODIR2",55,0)
 S:X="@" PSODIR("REMARKS")=""
"RTN","PSODIR2",56,0)
RMKX K X,Y
"RTN","PSODIR2",57,0)
 Q
"RTN","PSODIR2",58,0)
 ;
"RTN","PSODIR2",59,0)
ISSDT(PSODIR) ;
"RTN","PSODIR2",60,0)
 K DIR,DIC
"RTN","PSODIR2",61,0)
 S DIR("A")="ISSUE DATE",DIR("B")=$S($G(POERR)&($G(PSORX("ISSUE DATE"))']"")&($G(PSODIR("ISSUE DATE"))]""):PSODIR("ISSUE DATE"),$G(PSORX("ISSUE DATE"))]"":PSORX("ISSUE DATE"),1:"TODAY")
"RTN","PSODIR2",62,0)
 I DIR("B") S Y=DIR("B") X ^DD("DD") S DIR("B")=Y
"RTN","PSODIR2",63,0)
 S DIR(0)="52,1"
"RTN","PSODIR2",64,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") ISSDTX
"RTN","PSODIR2",65,0)
 S (PSODIR("ISSUE DATE"),PSOID)=Y
"RTN","PSODIR2",66,0)
 X ^DD("DD") S (PSORX("ISSUE DATE"),PSODIR("ISSUE DATE"))=Y
"RTN","PSODIR2",67,0)
ISSDTX K X,Y
"RTN","PSODIR2",68,0)
 Q
"RTN","PSODIR2",69,0)
 ;
"RTN","PSODIR2",70,0)
FILLDT(PSODIR) ;
"RTN","PSODIR2",71,0)
 K DIR,DIC
"RTN","PSODIR2",72,0)
 S:'$G(PSONEW("DAYS SUPPLY")) PSONEW("DAYS SUPPLY")=30,PSONEW("# OF REFILLS")=1
"RTN","PSODIR2",73,0)
 S DIR("A")="FILL DATE",DIR("B")=$S($G(PSORX("FILL DATE"))]"":PSORX("FILL DATE"),1:"TODAY")
"RTN","PSODIR2",74,0)
 S X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSODIR2",75,0)
 S X1=$S($G(PSOID):PSOID,1:DT)
"RTN","PSODIR2",76,0)
 S X2=$S(+$G(PSODIR("CS")):184,1:366)
"RTN","PSODIR2",77,0)
 D C^%DTC S PSOFDMX=$P(X,".") I DT>X S Y=$S($G(PSOID):PSOID,1:PSORX("ISSUE DATE")) X ^DD("DD") S DIR("B")=Y
"RTN","PSODIR2",78,0)
 S DIR(0)="D^"_$S($G(PSOID):PSOID,+$G(PSODIR("ISSUE DATE")):PSODIR("ISSUE DATE"),1:DT)_$S($G(DUZ("AG"))="I":":"_DT_":EX",1:":"_PSOFDMX_":EX")
"RTN","PSODIR2",79,0)
 S Y=PSOFDMX X ^DD("DD")
"RTN","PSODIR2",80,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the ISSUE DATE,"
"RTN","PSODIR2",81,0)
 S DIR("?",2)="the FILL DATE cannot be before the ISSUE DATE or AFTER the Expiration Date "
"RTN","PSODIR2",82,0)
 S DIR("?")=Y_".  Both the month and date are required."
"RTN","PSODIR2",83,0)
 D DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) FILLDTX  ;*526
"RTN","PSODIR2",84,0)
 S PSODIR("FILL DATE")=Y
"RTN","PSODIR2",85,0)
 X ^DD("DD") S PSORX("FILL DATE")=Y
"RTN","PSODIR2",86,0)
FILLDTX K X,Y,PSOFDMX
"RTN","PSODIR2",87,0)
 Q
"RTN","PSODIR2",88,0)
 ;
"RTN","PSODIR2",89,0)
CLERK(PSODIR) ;
"RTN","PSODIR2",90,0)
 I $G(DUZ("AG"))'="I" D  G CLERKX
"RTN","PSODIR2",91,0)
 .S PSODIR("CLERK CODE")=$S($G(PSOFDR):$P(OR0,"^",4),1:DUZ),PSORX("CLERK CODE")=$P($G(^VA(200,PSODIR("CLERK CODE"),0)),"^")
"RTN","PSODIR2",92,0)
 K DIR,DIC
"RTN","PSODIR2",93,0)
 S DIR("A")="CLERK",DIR("B")=$S($G(PSORX("CLERK CODE"))]"":PSORX("CLERK CODE"),1:$P($G(^VA(200,DUZ,0)),"^",2)),DIR(0)="52,16"
"RTN","PSODIR2",94,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") CLERKX
"RTN","PSODIR2",95,0)
 S PSODIR("CLERK CODE")=+Y,PSORX("CLERK CODE")=$P(Y,"^")
"RTN","PSODIR2",96,0)
CLERKX Q
"RTN","PSODIR2",97,0)
 ;
"RTN","PSODIR2",98,0)
DIR ;
"RTN","PSODIR2",99,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR2",100,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR2",101,0)
 D ^DIR K DIR,DIE,DIC,DA I X="^^" S (PSODIR("QFLG"),PSODIR("DFLG"))=1 G DIRX
"RTN","PSODIR2",102,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1!(Y="") S PSODIR("DFLG")=1 S:$G(SPEED) PSODIR("QFLG")=1 G DIRX
"RTN","PSODIR2",103,0)
 I $D(DUOUT)!($D(DTOUT)),$G(SPEED) S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR2",104,0)
 I X[U,$L(X)>1 D JUMP
"RTN","PSODIR2",105,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR2",106,0)
 Q
"RTN","PSODIR2",107,0)
 ;
"RTN","PSODIR2",108,0)
JUMP ;
"RTN","PSODIR2",109,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR2",110,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR2",111,0)
 I Y=-1 S PSODIR("FIELD")=$G(PSODIR("FLD")) G JUMPX
"RTN","PSODIR2",112,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR2",113,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR2",114,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR2",115,0)
JUMPX S X="^"_X
"RTN","PSODIR2",116,0)
 Q
"RTN","PSODIR2",117,0)
 ;Reset refills when drug changed to a controlled sub
"RTN","PSODIR2",118,0)
RFRSET ;
"RTN","PSODIR2",119,0)
 N RFN,RFNC
"RTN","PSODIR2",120,0)
 S (RFN,RFNC)=0
"RTN","PSODIR2",121,0)
 F  S RFN=$O(^PSRX(+$G(PSODIR("IRXN")),1,RFN)) Q:'RFN  S RFNC=RFNC+1
"RTN","PSODIR2",122,0)
 I $D(PSODIR("FIELD")) S PSODIR("FIELD")=0
"RTN","PSODIR2",123,0)
 S PSODIR("# OF REFILLS")=RFNC
"RTN","PSODIR2",124,0)
 S VALMSG="The drug has been changed and no longer allows refills."
"RTN","PSODIR2",125,0)
 W !,VALMSG,!
"RTN","PSODIR2",126,0)
 Q
"RTN","PSODIR3")
0^3^B18349076^B18185000
"RTN","PSODIR3",1,0)
PSODIR3 ;ISC-BIRM/SAB - rx order entry contd ; 7/3/13 4:09pm
"RTN","PSODIR3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,46,184,222,206,318,444,526**;DEC 1997;Build 3
"RTN","PSODIR3",3,0)
 ;
"RTN","PSODIR3",4,0)
EXP(PSODIR) ;
"RTN","PSODIR3",5,0)
 K DIC,DIR
"RTN","PSODIR3",6,0)
 I $G(PSODRUG("EXPIRATION DATE"))]"" S Y=PSODRUG("EXPIRATION DATE") X ^DD("DD") S PSORX("EXPIRATION DATE")=Y
"RTN","PSODIR3",7,0)
 S DIR("A")="EXPIRES",DIR("B")=$S($G(PSORX("EXPIRATION DATE"))]"":PSORX("EXPIRATION DATE"),1:"T+6M")
"RTN","PSODIR3",8,0)
 S DIR(0)="D^NOW::EX",DIR("?")="Both the month and date are required." D ^DIR
"RTN","PSODIR3",9,0)
 G:PSODIR("DFLG")!PSODIR("FIELD") EXPX
"RTN","PSODIR3",10,0)
 S PSODIR("EXPIRATION DATE")=Y
"RTN","PSODIR3",11,0)
EXPX K X,Y
"RTN","PSODIR3",12,0)
 Q
"RTN","PSODIR3",13,0)
 ;
"RTN","PSODIR3",14,0)
MW(PSODIR) ;
"RTN","PSODIR3",15,0)
 K DIR,DIC
"RTN","PSODIR3",16,0)
 S DIR(0)="52,11"
"RTN","PSODIR3",17,0)
 S DIR("B")=$S($G(PSORX("MAIL/WINDOW"))]"":PSORX("MAIL/WINDOW"),1:"WINDOW")
"RTN","PSODIR3",18,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") MWX
"RTN","PSODIR3",19,0)
 I $G(Y(0))']"" S PSODIR("DFLG")=1 G MWX
"RTN","PSODIR3",20,0)
 S PSODIR("MAIL/WINDOW")=Y,PSORX("MAIL/WINDOW")=Y(0)
"RTN","PSODIR3",21,0)
 I $G(PSORX("EDIT"))]"",PSODIR("MAIL/WINDOW")'="W" K PSODIR("METHOD OF PICK-UP")
"RTN","PSODIR3",22,0)
MW1 G:PSODIR("MAIL/WINDOW")'="W"!('$P($G(PSOPAR),"^",12)) MWX
"RTN","PSODIR3",23,0)
 S DIR(0)="52,35O"
"RTN","PSODIR3",24,0)
 S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP")
"RTN","PSODIR3",25,0)
 D DIR G:PSODIR("DFLG") MWX
"RTN","PSODIR3",26,0)
 I X[U W !,"Cannot jump to another field ..",! G MW1
"RTN","PSODIR3",27,0)
 S (PSODIR("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y
"RTN","PSODIR3",28,0)
MWX K X,Y
"RTN","PSODIR3",29,0)
 Q
"RTN","PSODIR3",30,0)
 ;
"RTN","PSODIR3",31,0)
FILLDT(PSODIR) ;
"RTN","PSODIR3",32,0)
 K DIR,DIC
"RTN","PSODIR3",33,0)
 S DIR("A")="FILL DATE",DIR("B")=$S($G(PSORX("FILL DATE"))]"":PSORX("FILL DATE"),1:"TODAY")
"RTN","PSODIR3",34,0)
 S DIR(0)="D^"_$S($G(PSODIR("ISSUE DATE"))]"":PSODIR("ISSUE DATE"),1:DT)_$S($G(DUZ("AG"))="I":":"_DT_":EX",1:"::EX")
"RTN","PSODIR3",35,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the ISSUE DATE,"
"RTN","PSODIR3",36,0)
 S DIR("?",2)="the FILL DATE cannot be before the ISSUE DATE."
"RTN","PSODIR3",37,0)
 S DIR("?")="Both the month and date are required."
"RTN","PSODIR3",38,0)
 D DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) FILLDTX  ;*526
"RTN","PSODIR3",39,0)
 S PSODIR("FILL DATE")=Y
"RTN","PSODIR3",40,0)
 X ^DD("DD") S PSORX("FILL DATE")=Y
"RTN","PSODIR3",41,0)
FILLDTX K X,Y
"RTN","PSODIR3",42,0)
 Q
"RTN","PSODIR3",43,0)
 ;
"RTN","PSODIR3",44,0)
CLERK(PSODIR) ;
"RTN","PSODIR3",45,0)
 I $G(DUZ("AG"))'="I",$G(DUZ) S PSODIR("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P($G(^VA(200,DUZ,0)),"^") G CLERKX
"RTN","PSODIR3",46,0)
 K DIR,DIC
"RTN","PSODIR3",47,0)
 S DIR("A")="CLERK",DIR("B")=$S($G(PSORX("CLERK CODE"))]"":PSORX("CLERK CODE"),1:$P($G(^VA(200,DUZ,0)),"^",2)),DIR(0)="52,16"
"RTN","PSODIR3",48,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") CLERKX
"RTN","PSODIR3",49,0)
 S PSODIR("CLERK CODE")=+Y,PSORX("CLERK CODE")=$P(Y,"^")
"RTN","PSODIR3",50,0)
CLERKX Q
"RTN","PSODIR3",51,0)
 ;
"RTN","PSODIR3",52,0)
DIR ;
"RTN","PSODIR3",53,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR3",54,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR3",55,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR3",56,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1!(Y="") S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR3",57,0)
 I X[U,$L(X)>1 D JUMP
"RTN","PSODIR3",58,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR3",59,0)
 Q
"RTN","PSODIR3",60,0)
 ;
"RTN","PSODIR3",61,0)
JUMP ;
"RTN","PSODIR3",62,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR3",63,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR3",64,0)
 I Y=-1 S PSODIR("FIELD")=PSODIR("FLD") G JUMPX
"RTN","PSODIR3",65,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR3",66,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR3",67,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR3",68,0)
JUMPX S X="^"_X
"RTN","PSODIR3",69,0)
 Q
"RTN","PSODIR3",70,0)
 ;Continued from PSODIR1, Tag REFOR, Added PSOCS set and changed G REFILLX references to a QUIT
"RTN","PSODIR3",71,0)
REFOR ;
"RTN","PSODIR3",72,0)
 N PSOX
"RTN","PSODIR3",73,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F")!($G(PSODRUG("DEA"))[1)!($G(PSODRUG("DEA"))[2) D  Q
"RTN","PSODIR3",74,0)
 .S VALMSG="No refills allowed on "_$S($G(PSODRUG("DEA"))["A":"this narcotic drug.",1:"this drug.")
"RTN","PSODIR3",75,0)
 .W !,VALMSG,!
"RTN","PSODIR3",76,0)
 .S:$D(PSODIR("FIELD")) PSODIR("FIELD")=0 S PSODIR("# OF REFILLS")=0
"RTN","PSODIR3",77,0)
 ;
"RTN","PSODIR3",78,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSODIR3",79,0)
 S PSOX=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),+$G(PSODIR("DAYS SUPPLY")),+$G(PSODIR("PATIENT STATUS")),.CLOZPAT)
"RTN","PSODIR3",80,0)
 ;
"RTN","PSODIR3",81,0)
 I $D(CLOZPAT) D
"RTN","PSODIR3",82,0)
 .S (PSODIR("# OF REFILLS"),PSODIR("N# REF"))=PSOX
"RTN","PSODIR3",83,0)
 S DIR(0)="N^0:"_PSOX,DIR("A")="# OF REFILLS"
"RTN","PSODIR3",84,0)
 S DIR("B")=$S($G(POERR)&($G(PSODIR("# OF REFILLS"))):PSODIR("# OF REFILLS"),$G(PSODIR("N# REF"))]"":PSODIR("N# REF"),$G(PSODIR("# OF REFILLS"))]"":PSODIR("# OF REFILLS"),1:PSOX)
"RTN","PSODIR3",85,0)
 S DIR("?")="Enter a whole number.  The maximum is set by the DAYS SUPPLY field."
"RTN","PSODIR3",86,0)
 D DIR Q:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD"))  ;*526
"RTN","PSODIR3",87,0)
 S (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=Y
"RTN","PSODIR3",88,0)
 Q
"RTN","PSOUTLA")
0^1^B52284744^B52204149
"RTN","PSOUTLA",1,0)
PSOUTLA ;BHAM ISC/AMC - pharmacy utility program ;07/24/96  1:13 pm
"RTN","PSOUTLA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,15,23,56,126,222,354,444,496,526**;DEC 1997;Build 3
"RTN","PSOUTLA",3,0)
 ;External reference ^PS(54 supported by DBIA 2227
"RTN","PSOUTLA",4,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOUTLA",5,0)
CHK I '$D(PY(PSPR)) W !?10,$C(7),"  # ",PSPR," is not a valid choice." S PSPOP=1 Q
"RTN","PSOUTLA",6,0)
 I $D(PSDUP(PY(PSPR))) W !?10,$C(7),"RX# ",$P(^PSRX(+$P(PY(PSPR),"^"),0),"^")," is a duplicate choice." S PSPOP=1 Q
"RTN","PSOUTLA",7,0)
 S PSDUP(PY(PSPR))="" Q:'PSODIV  Q:'$P(^PSRX(+PY(PSPR),2),"^",9)  Q:+$P(^(2),"^",9)=PSOSITE
"RTN","PSOUTLA",8,0)
 S PSPRXN=+$P(PY(PSPR),"^")
"RTN","PSOUTLA",9,0)
CHK1 I '$P(PSOSYS,"^",2) W !!,$C(7),"RX# "_$P(^PSRX(PSPRXN,0),"^")_" is not a valid choice. (Different Division)",! S PSPOP=1 Q
"RTN","PSOUTLA",10,0)
 I $P(PSOSYS,"^",3) K DIR,DUOUT,DTOUT D
"RTN","PSOUTLA",11,0)
 .W $C(7) S DIR("A",1)="",DIR("A",2)="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is from another division.",DIR("A")="Continue: (Y/N)",DIR(0)="Y",DIR("?",1)="'Y' FOR YES",DIR("?")="'N' FOR NO"
"RTN","PSOUTLA",12,0)
 .S DIR("B")="N" D ^DIR I 'Y!($D(DUOUT))!($D(DTOUT)) S PSPOP=1 W !
"RTN","PSOUTLA",13,0)
 K DIR,DUOUT,DTOUT Q
"RTN","PSOUTLA",14,0)
 ;
"RTN","PSOUTLA",15,0)
ZIPIN ; input transform for ZIP field in file #59 internal format (no '-'s)
"RTN","PSOUTLA",16,0)
 ;  Input:  X as user entered value
"RTN","PSOUTLA",17,0)
 ; Output:  X as internal value of user input OR
"RTN","PSOUTLA",18,0)
 ;            undefined if input from user was invalid
"RTN","PSOUTLA",19,0)
 N % I X'?.N F %=1:1:$L(X) I $E(X,%)?1P S X=$E(X,0,%-1)_$E(X,%+1,20),%=%-1
"RTN","PSOUTLA",20,0)
 I X'?5N,(X'?9N) K X
"RTN","PSOUTLA",21,0)
 Q
"RTN","PSOUTLA",22,0)
 ;
"RTN","PSOUTLA",23,0)
ZIPOUT ; output transform for ZIP - prints either ZIP or ZIP+4 (in 12345-1234)
"RTN","PSOUTLA",24,0)
 ; format.
"RTN","PSOUTLA",25,0)
 ; Input:  Y internal value
"RTN","PSOUTLA",26,0)
 ; Output:  Y external (12345 or 12345-1234)
"RTN","PSOUTLA",27,0)
 S Y=$E(Y,1,5)_$S($E(Y,6,9)]"":"-"_$E(Y,6,9),1:"")
"RTN","PSOUTLA",28,0)
 Q
"RTN","PSOUTLA",29,0)
YN ;YES/NO PROMPT
"RTN","PSOUTLA",30,0)
 W !?5,"'Y' FOR YES",!?5,"'N' FOR NO",!
"RTN","PSOUTLA",31,0)
 Q
"RTN","PSOUTLA",32,0)
DAYS ;
"RTN","PSOUTLA",33,0)
 K PSFMAX S ED=1,PSODEA=$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^",3),PSDAYS=$P(^PSRX(DA,0),"^",8),CS=0
"RTN","PSOUTLA",34,0)
 D EDNEW K:ED PSFMAX,ED K:$P(^PSRX(DA,0),"^",9)'>MAX PSMAX
"RTN","PSOUTLA",35,0)
 Q
"RTN","PSOUTLA",36,0)
EDNEW ;
"RTN","PSOUTLA",37,0)
 K PSMAX,PSFMAX
"RTN","PSOUTLA",38,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSOUTLA",39,0)
 S PSMAX=$$MAXNUMRF^PSOUTIL(+$P(^PSRX(DA,0),"^",6),PSDAYS,+$P(^PSRX(DA,0),"^",3),.CLOZPAT)
"RTN","PSOUTLA",40,0)
 ;
"RTN","PSOUTLA",41,0)
 I PSRF>PSMAX D
"RTN","PSOUTLA",42,0)
 .W $C(7),!!,PSRF_" refills are not correct for a "_PSDAYS_" day supply.",!,"Please enter correct # of refills for a "_PSDAYS_" day supply. Max refills allowed is "_PSMAX_".",!
"RTN","PSOUTLA",43,0)
 K PSTMAX D EDSTAT
"RTN","PSOUTLA",44,0)
 Q
"RTN","PSOUTLA",45,0)
STATDAY K PSMAX,PSRMAX,PSFMAX,PSTMAX S PSDAYS=$P(^PSRX(DA,0),"^",8),PSRF=$P(^PSRX(DA,0),"^",9),PTST=$P(^PS(53,X,0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4)
"RTN","PSOUTLA",46,0)
EDSTAT I PSRF>PTRF D EN^DDIOL(PSRF_" refills are greater than "_PTRF_" allowed for "_$P(PTST,"^")_" Rx Patient Status.","","$C(7),!") D EN^DDIOL(" ","","!")
"RTN","PSOUTLA",47,0)
 Q
"RTN","PSOUTLA",48,0)
PARKILL S CNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA(1),"A",SUB)) Q:'SUB  S CNT=SUB
"RTN","PSOUTLA",49,0)
 I '$G(RESK) D  G:$D(DIRUT) PARKILL
"RTN","PSOUTLA",50,0)
 .D EN^DDIOL(" ","","!") K DIR S DIR(0)="FO^10:75",DIR("A",1)="Enter Reason for Edit:",DIR("A")="=>",DIR("?",1)="This is a required response.  No Up-arrowing allowed."
"RTN","PSOUTLA",51,0)
 .S DIR("?")="Response must be 10-75 characters in length.",DIR("B")="Entered In Error"
"RTN","PSOUTLA",52,0)
 .D ^DIR I $D(DIRUT) D EN^DDIOL("This is a required response.  No Up-arrowing allowed.","","!") Q
"RTN","PSOUTLA",53,0)
 .S ACOM=$S($G(Y)]""&('$D(DIRUT)):Y,1:"Partial Entered In Error.")
"RTN","PSOUTLA",54,0)
 .S PSOPRZ=$G(PSOPRZ)-1 S:PSOPRZ<0 PSOPRZ=0
"RTN","PSOUTLA",55,0)
 S:$G(RESK) ACOM="Partial fill returned to stock."
"RTN","PSOUTLA",56,0)
 D NOW^%DTC S CNT=CNT+1 S ^PSRX(DA(1),"A",0)="^52.3DA^"_CNT_"^"_CNT,^PSRX(DA(1),"A",CNT,0)=%_"^D^"_DUZ_"^6^"_ACOM K CNT,SUB,DIR,DTOUT,DUOUT
"RTN","PSOUTLA",57,0)
 Q
"RTN","PSOUTLA",58,0)
SETUP ;enter/edit clinic sort groups
"RTN","PSOUTLA",59,0)
 W ! S (DLAYGO,DIC,DIE)=59.8,DIC("A")="Select Clinic Sort Group: ",DIC(0)="AEQML" D ^DIC G:"^"[$E(X) SETUPX G:Y<1 SETUP S DA=+Y,DR=".01;1" D ^DIE
"RTN","PSOUTLA",60,0)
SETUPX K DIE,DIC,DA,DLAYGO,Y,X,DR
"RTN","PSOUTLA",61,0)
 Q
"RTN","PSOUTLA",62,0)
FSIG(PSOFILE,PSOINTR,PSOLENTH) ;Format front door sig
"RTN","PSOUTLA",63,0)
 ;PSOFILE is 'P' if in Pending File, 'R' if in Prescription File
"RTN","PSOUTLA",64,0)
 ;PSOINTR is internal number for either file
"RTN","PSOUTLA",65,0)
 ;PSOLENTH is length of each line of the Sig
"RTN","PSOUTLA",66,0)
 ;returned in the FSIG array
"RTN","PSOUTLA",67,0)
 K FSIG I $G(PSOFILE)=""!('$G(PSOINTR))!('$G(PSOLENTH)) G FQUIT
"RTN","PSOUTLA",68,0)
 I PSOFILE'="P",PSOFILE'="R" G FQUIT
"RTN","PSOUTLA",69,0)
 I PSOFILE="P",'$D(^PS(52.41,+PSOINTR,0)) G FQUIT
"RTN","PSOUTLA",70,0)
 I PSOFILE="R",'$D(^PSRX(+PSOINTR,0)) G FQUIT
"RTN","PSOUTLA",71,0)
 I PSOFILE="R",'$P($G(^PSRX(+PSOINTR,"SIG")),"^",2) G FQUIT
"RTN","PSOUTLA",72,0)
 N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II
"RTN","PSOUTLA",73,0)
 I PSOFILE="P" F NNN=0:0 S NNN=$O(^PS(52.41,PSOINTR,"SIG",NNN)) Q:'NNN  S:$G(^(NNN,0))'="" HSIG(NNN)=^(0)
"RTN","PSOUTLA",74,0)
 I PSOFILE="P" G:'$O(HSIG(0)) FQUIT G FSTART
"RTN","PSOUTLA",75,0)
 ;S HSIG(1)=$P($G(^PSRX(PSOINTR,"SIG")),"^") S FFF=2 F NNN=0:0 S NNN=$O(^PSRX(PSOINTR,"SIG1",NNN)) Q:'NNN  I $G(^(NNN,0))'="" S HSIG(FFF)=$G(^(0)),FFF=FFF+1
"RTN","PSOUTLA",76,0)
 S FFF=1 F NNN=0:0 S NNN=$O(^PSRX(PSOINTR,"SIG1",NNN)) Q:'NNN  I $G(^(NNN,0))'="" S HSIG(FFF)=^(0) S FFF=FFF+1
"RTN","PSOUTLA",77,0)
 G:'$O(HSIG(0)) FQUIT
"RTN","PSOUTLA",78,0)
FSTART S (FVAR,FVAR1)="",II=1
"RTN","PSOUTLA",79,0)
 F FFF=0:0 S FFF=$O(HSIG(FFF)) Q:'FFF  S CNT=0 F NNN=1:1:$L(HSIG(FFF)) I $E(HSIG(FFF),NNN)=" "!($L(HSIG(FFF))=NNN) S CNT=CNT+1 D  I $L(FVAR)>PSOLENTH S FSIG(II)=FLIM_" ",II=II+1,FVAR=FVAR1
"RTN","PSOUTLA",80,0)
 .S FVAR1=$P(HSIG(FFF)," ",(CNT))
"RTN","PSOUTLA",81,0)
 .S FLIM=FVAR
"RTN","PSOUTLA",82,0)
 .S FVAR=$S(FVAR="":FVAR1,1:FVAR_" "_FVAR1)
"RTN","PSOUTLA",83,0)
 I $G(FVAR)'="" S FSIG(II)=FVAR
"RTN","PSOUTLA",84,0)
 I $G(FSIG(1))=""!($G(FSIG(1))=" ") S FSIG(1)=$G(FSIG(2)) K FSIG(2)
"RTN","PSOUTLA",85,0)
FQUIT Q
"RTN","PSOUTLA",86,0)
DRUGW ;
"RTN","PSOUTLA",87,0)
 F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?35,$P(^(0),"^"),! I '$D(^(0)) W ?35,"NO SUCH WARNING LABEL" K X Q
"RTN","PSOUTLA",88,0)
 Q
"RTN","PSOUTLA",89,0)
HLNEW ;formats provider instructions in FSIG for front door order
"RTN","PSOUTLA",90,0)
 K FSIG N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II,LLP,PSOLENTH
"RTN","PSOUTLA",91,0)
 S PSOLENTH=59,LLP=1 F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S HSIG(LLP)=$G(WPARRAY(7,LLL)),LLP=LLP+1
"RTN","PSOUTLA",92,0)
 D FSTART Q
"RTN","PSOUTLA",93,0)
HLNEWX ;
"RTN","PSOUTLA",94,0)
 K FSIG N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II,LLP,PSOLENTH
"RTN","PSOUTLA",95,0)
 S PSOLENTH=59,LLP=1 F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S HSIG(LLP)=$G(WPARRAY(6,LLL)),LLP=LLP+1
"RTN","PSOUTLA",96,0)
 D FSTART Q
"RTN","PSOUTLA",97,0)
 ;
"RTN","PSOUTLA",98,0)
SUSFDS ;
"RTN","PSOUTLA",99,0)
 N SUSIEN
"RTN","PSOUTLA",100,0)
 Q:$O(^PSRX(DA,1,0))
"RTN","PSOUTLA",101,0)
 S SUSIEN=+$O(^PS(52.5,"B",DA,0)) Q:'$G(SUSIEN)
"RTN","PSOUTLA",102,0)
 Q:'$D(^PS(52.5,SUSIEN,0))!($G(^PS(52.5,SUSIEN,"P")))
"RTN","PSOUTLA",103,0)
 I '$P($G(^PS(52.5,SUSIEN,0)),"^",5),'$P($G(^(0)),"^",13) S $P(^PS(52.5,SUSIEN,0),"^",2)=X,^PS(52.5,"C",X,SUSIEN)="" D
"RTN","PSOUTLA",104,0)
 .I $P($G(^PS(52.5,SUSIEN,0)),"^",7)="Q" S ^PS(52.5,"AQ",X,+$P($G(^PS(52.5,SUSIEN,0)),"^",3),SUSIEN)="" D SCMPX^PSOCMOP(SUSIEN,"Q") Q
"RTN","PSOUTLA",105,0)
 .S ^PS(52.5,"AC",+$P($G(^PS(52.5,SUSIEN,0)),"^",3),X,SUSIEN)=""
"RTN","PSOUTLA",106,0)
 Q
"RTN","PSOUTLA",107,0)
SUSFDK ;
"RTN","PSOUTLA",108,0)
 N SUSIEN
"RTN","PSOUTLA",109,0)
 Q:$O(^PSRX(DA,1,0))
"RTN","PSOUTLA",110,0)
 S SUSIEN=+$O(^PS(52.5,"B",DA,0)) Q:'$G(SUSIEN)
"RTN","PSOUTLA",111,0)
 Q:'$D(^PS(52.5,SUSIEN,0))!($G(^PS(52.5,SUSIEN,"P")))
"RTN","PSOUTLA",112,0)
 I '$P($G(^PS(52.5,SUSIEN,0)),"^",5),'$P($G(^(0)),"^",13) K ^PS(52.5,"C",X,SUSIEN) D
"RTN","PSOUTLA",113,0)
 .I $P($G(^PS(52.5,SUSIEN,0)),"^",7)="Q" K ^PS(52.5,"AQ",X,+$P($G(^PS(52.5,SUSIEN,0)),"^",3),SUSIEN) D KCMPX^PSOCMOP(SUSIEN,"Q") Q
"RTN","PSOUTLA",114,0)
 .K ^PS(52.5,"AC",+$P($G(^PS(52.5,SUSIEN,0)),"^",3),X,SUSIEN)
"RTN","PSOUTLA",115,0)
 Q
"RTN","PSOUTLA",116,0)
ADD ;enter/edit automated devices - OPAI
"RTN","PSOUTLA",117,0)
 W ! S (DLAYGO,DIC,DIE)=52.53,DIC("A")="Select ADD Name: ",DIC(0)="AEQML" D ^DIC G:"^"[$E(X) ADDX G:Y<1 ADD S DA=+Y,DR=".01;1;2;3" D ^DIE G ADD
"RTN","PSOUTLA",118,0)
ADDX K DIE,DIC,DA,Y,X,DR
"RTN","PSOUTLA",119,0)
 Q
"RTN","PSOUTLA",120,0)
 ;
"RTN","PSOUTLA",121,0)
FLDTINTR(FILLTYPE) ; Input Transform for FILL DATE, REFILL DATE and PARTIAL DATE fields in the PRESCRIPTION file (#52)
"RTN","PSOUTLA",122,0)
 ;Input Parameter: FILLTYPE - Prescription Fill Type: "O": Original, "R": Refill, "P": Partial
"RTN","PSOUTLA",123,0)
 ;Input Variables: X - Fill Date entered / DA/DA(1) - Pointer to the PRESCRIPTION file (#52)
"RTN","PSOUTLA",124,0)
 N RXIEN,%DT,Y
"RTN","PSOUTLA",125,0)
 I '$D(X) Q
"RTN","PSOUTLA",126,0)
 S RXIEN=+$S(FILLTYPE="O":$G(DA),1:$G(DA(1)))
"RTN","PSOUTLA",127,0)
 S %DT="EX" D ^%DT S X=Y I Y<1 D EN^DDIOL("INVALID DATE","","$C(7),!!?5") K X Q  ;*526
"RTN","PSOUTLA",128,0)
 I '$D(^PSRX(RXIEN,0)) Q
"RTN","PSOUTLA",129,0)
 I $P(^PSRX(RXIEN,0),U,13),X<$P(^PSRX(RXIEN,0),U,13) D  K X Q
"RTN","PSOUTLA",130,0)
 . D EN^DDIOL($S(FILLTYPE="O":"FILL",FILLTYPE="R":"REFILL",1:"PARTIAL")_" DATE cannot be before ISSUE DATE ("_$$FMTE^XLFDT($P(^PSRX(RXIEN,0),U,13),"2Z")_")","","$C(7),!!?5")
"RTN","PSOUTLA",131,0)
 I '$D(^PSRX(RXIEN,2)) Q
"RTN","PSOUTLA",132,0)
 I $P(^PSRX(RXIEN,2),U,6),X>$P(^PSRX(RXIEN,2),U,6) D  K X Q
"RTN","PSOUTLA",133,0)
 . D EN^DDIOL($S(FILLTYPE="O":"FILL",FILLTYPE="R":"REFILL",1:"PARTIAL")_" DATE cannot be after EXPIRATION DATE ("_$$FMTE^XLFDT($P(^PSRX(RXIEN,2),U,6),"2Z")_")","","$C(7),!!?5")
"RTN","PSOUTLA",134,0)
 Q
"RTN","PSOUTLA",135,0)
 ;
"RTN","PSOUTLA",136,0)
FLDTHELP(FILLTYPE) ; Executable Help for FILL DATE, REFILL DATE and PARTIAL DATE fields in the PRESCRIPTION file (#52)
"RTN","PSOUTLA",137,0)
 ;Input Parameter: FILLTYPE - Prescription Fill Type: "O": Original, "R": Refill, "P": Partial
"RTN","PSOUTLA",138,0)
 ;Input Variables: DA/DA(1) - Pointer to the PRESCRIPTION file (#52)
"RTN","PSOUTLA",139,0)
 N RXIEN
"RTN","PSOUTLA",140,0)
 S RXIEN=+$S(FILLTYPE="O":$G(DA),1:$G(DA(1)))
"RTN","PSOUTLA",141,0)
 I $P($G(^PSRX(RXIEN,0)),"^",13) D
"RTN","PSOUTLA",142,0)
 . D EN^DDIOL("The "_$S(FILLTYPE="O":"FILL",FILLTYPE="R":"REFILL",1:"PARTIAL")_" DATE cannot be before ISSUE DATE ("_$$FMTE^XLFDT($P(^PSRX(RXIEN,0),U,13),"2Z")_")","","!")
"RTN","PSOUTLA",143,0)
 I $P($G(^PSRX(RXIEN,2)),"^",6) D
"RTN","PSOUTLA",144,0)
 . D EN^DDIOL("The "_$S(FILLTYPE="O":"FILL",FILLTYPE="R":"REFILL",1:"PARTIAL")_" DATE cannot be after EXPIRATION DATE ("_$$FMTE^XLFDT($P(^PSRX(RXIEN,2),U,6),"2Z")_")","","!")
"RTN","PSOUTLA",145,0)
 Q
"VER")
8.0^22.2
"BLD",11046,6)
^433
**END**
**END**

