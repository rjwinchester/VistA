Released PSO*7*564 SEQ #469
Extracted from mail message
**KIDS**:PSO*7.0*564^

**INSTALL NAME**
PSO*7.0*564
"BLD",11170,0)
PSO*7.0*564^OUTPATIENT PHARMACY^0^3190812^y
"BLD",11170,1,0)
^^2^2^3190618^^
"BLD",11170,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",11170,1,2,0)
under PSO*7*564.
"BLD",11170,4,0)
^9.64PA^^
"BLD",11170,6)
2^
"BLD",11170,6.3)
6
"BLD",11170,"ABPKG")
n
"BLD",11170,"KRN",0)
^9.67PA^1.5^24
"BLD",11170,"KRN",.4,0)
.4
"BLD",11170,"KRN",.401,0)
.401
"BLD",11170,"KRN",.402,0)
.402
"BLD",11170,"KRN",.403,0)
.403
"BLD",11170,"KRN",.5,0)
.5
"BLD",11170,"KRN",.84,0)
.84
"BLD",11170,"KRN",1.5,0)
1.5
"BLD",11170,"KRN",1.6,0)
1.6
"BLD",11170,"KRN",1.61,0)
1.61
"BLD",11170,"KRN",1.62,0)
1.62
"BLD",11170,"KRN",3.6,0)
3.6
"BLD",11170,"KRN",3.8,0)
3.8
"BLD",11170,"KRN",9.2,0)
9.2
"BLD",11170,"KRN",9.8,0)
9.8
"BLD",11170,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11170,"KRN",9.8,"NM",1,0)
PSOORRL^^0^B66889915
"BLD",11170,"KRN",9.8,"NM",2,0)
PSODEMSB^^0^B62149131
"BLD",11170,"KRN",9.8,"NM",3,0)
PSOPATLK^^0^B6979395
"BLD",11170,"KRN",9.8,"NM","B","PSODEMSB",2)

"BLD",11170,"KRN",9.8,"NM","B","PSOORRL",1)

"BLD",11170,"KRN",9.8,"NM","B","PSOPATLK",3)

"BLD",11170,"KRN",19,0)
19
"BLD",11170,"KRN",19.1,0)
19.1
"BLD",11170,"KRN",101,0)
101
"BLD",11170,"KRN",409.61,0)
409.61
"BLD",11170,"KRN",771,0)
771
"BLD",11170,"KRN",779.2,0)
779.2
"BLD",11170,"KRN",870,0)
870
"BLD",11170,"KRN",8989.51,0)
8989.51
"BLD",11170,"KRN",8989.52,0)
8989.52
"BLD",11170,"KRN",8994,0)
8994
"BLD",11170,"KRN","B",.4,.4)

"BLD",11170,"KRN","B",.401,.401)

"BLD",11170,"KRN","B",.402,.402)

"BLD",11170,"KRN","B",.403,.403)

"BLD",11170,"KRN","B",.5,.5)

"BLD",11170,"KRN","B",.84,.84)

"BLD",11170,"KRN","B",1.5,1.5)

"BLD",11170,"KRN","B",1.6,1.6)

"BLD",11170,"KRN","B",1.61,1.61)

"BLD",11170,"KRN","B",1.62,1.62)

"BLD",11170,"KRN","B",3.6,3.6)

"BLD",11170,"KRN","B",3.8,3.8)

"BLD",11170,"KRN","B",9.2,9.2)

"BLD",11170,"KRN","B",9.8,9.8)

"BLD",11170,"KRN","B",19,19)

"BLD",11170,"KRN","B",19.1,19.1)

"BLD",11170,"KRN","B",101,101)

"BLD",11170,"KRN","B",409.61,409.61)

"BLD",11170,"KRN","B",771,771)

"BLD",11170,"KRN","B",779.2,779.2)

"BLD",11170,"KRN","B",870,870)

"BLD",11170,"KRN","B",8989.51,8989.51)

"BLD",11170,"KRN","B",8989.52,8989.52)

"BLD",11170,"KRN","B",8994,8994)

"BLD",11170,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11170,"QUES",0)
^9.62^^
"BLD",11170,"REQB",0)
^9.611^4^3
"BLD",11170,"REQB",2,0)
PSO*7.0*452^1
"BLD",11170,"REQB",3,0)
PSO*7.0*438^1
"BLD",11170,"REQB",4,0)
PSO*7.0*558^1
"BLD",11170,"REQB","B","PSO*7.0*438",3)

"BLD",11170,"REQB","B","PSO*7.0*452",2)

"BLD",11170,"REQB","B","PSO*7.0*558",4)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
564^3190812^520824736
"PKG",170,22,1,"PAH",1,1,0)
^^2^2^3190812
"PKG",170,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",170,22,1,"PAH",1,1,2,0)
under PSO*7*564.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSODEMSB")
0^2^B62149131^B62505884
"RTN","PSODEMSB",1,0)
PSODEMSB ;EPIP/RTW - PSODEM subroutines ; 7/29/17 3:24pm
"RTN","PSODEMSB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**452,564**;Dec 1997;Build 6
"RTN","PSODEMSB",3,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",4,0)
 ; External reference  to $$OUTPTTM^SDUTL3  supported by ICR  1252
"RTN","PSODEMSB",5,0)
 ; External reference  to ^DIE              supported by ICR  2022
"RTN","PSODEMSB",6,0)
 ; External references to $$GET1^DIQ        supported by ICR  2056
"RTN","PSODEMSB",7,0)
 ; External reference  to ^PS(55            supported by ICR  2228
"RTN","PSODEMSB",8,0)
 ; External reference  to $$GETALL^SCAPMCA  supported by ICR  2848
"RTN","PSODEMSB",9,0)
 ; External reference  to VST^ORWCV         supported by ICR  4211
"RTN","PSODEMSB",10,0)
 ; External reference  to $$SDAPI^SDMACA301 supported by ICR  4433
"RTN","PSODEMSB",11,0)
 ; External reference  to ^DD("DILOCKTM"    supported by ICR  4909
"RTN","PSODEMSB",12,0)
 ; External reference  to ^DIC              supported by ICR 10006
"RTN","PSODEMSB",13,0)
 ; External reference  to ^DIR              supported by ICR 10026
"RTN","PSODEMSB",14,0)
 ; External reference  to ^DPT(             supported by ICR 10035
"RTN","PSODEMSB",15,0)
 ; External reference  to ^VA(200           supported by ICR 10060
"RTN","PSODEMSB",16,0)
 ; External reference  to LOCK^DILF($NA(    supported by ICR  2054
"RTN","PSODEMSB",17,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",18,0)
DEMOG(PSODFN) ;
"RTN","PSODEMSB",19,0)
 ;     Extend patient demographics with PC Team, Current Facility
"RTN","PSODEMSB",20,0)
 ;     Remarks, and Clinical Alerts, pause the screen until <Enter>
"RTN","PSODEMSB",21,0)
 ; Input:
"RTN","PSODEMSB",22,0)
 ;   DFN ; Required ; IEN of Patient file (#2) entry
"RTN","PSODEMSB",23,0)
 ;
"RTN","PSODEMSB",24,0)
 Q:$D(XQORNOD(0))
"RTN","PSODEMSB",25,0)
 N PSOTEAM,PSOCLINA,DIR,DIRUT,X,Y
"RTN","PSODEMSB",26,0)
 I $G(XQY0)["PSO P",($I=$P) D  ;
"RTN","PSODEMSB",27,0)
 . W !
"RTN","PSODEMSB",28,0)
 . S DIR("T")=DTIME,DIR(0)="EA",DIR("A")="Press <Enter> to continue: " D ^DIR
"RTN","PSODEMSB",29,0)
 ;
"RTN","PSODEMSB",30,0)
 D PCTEAM(PSODFN)
"RTN","PSODEMSB",31,0)
 I 'PSOTEAM W !! D HDR("Extended Patient Demographics:")
"RTN","PSODEMSB",32,0)
 D REMARKS(PSODFN)
"RTN","PSODEMSB",33,0)
 W !?1,"Assigned/Recent Facility: ",$$CURRFAC(PSODFN)
"RTN","PSODEMSB",34,0)
 D CA(PSODFN)
"RTN","PSODEMSB",35,0)
 Q:$D(DIRUT)
"RTN","PSODEMSB",36,0)
 I $G(XQY0)'["OR CPRS GUI CHART",($I=$P) D  ;
"RTN","PSODEMSB",37,0)
 . W !
"RTN","PSODEMSB",38,0)
 . S DIR("T")=DTIME,DIR(0)="EA",DIR("A")="Press <Enter> to continue: " D ^DIR
"RTN","PSODEMSB",39,0)
 Q
"RTN","PSODEMSB",40,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",41,0)
CA(PSODFN) ; Print PHARMACY PATIENT CLINICAL ALERTS multiple field (#2)
"RTN","PSODEMSB",42,0)
 ; Input:
"RTN","PSODEMSB",43,0)
 ;   DFN ; Required ; IEN of Patient file (#2) entry
"RTN","PSODEMSB",44,0)
 ;
"RTN","PSODEMSB",45,0)
 N PSOFLAG1,PSODATER
"RTN","PSODEMSB",46,0)
 ;
"RTN","PSODEMSB",47,0)
 Q:'$G(PSODFN)  ; Quit, if no Patient IEN
"RTN","PSODEMSB",48,0)
 Q:'$P($G(^PS(55,PSODFN,2,0)),U,4)  ; No CLINICAL ALERTS
"RTN","PSODEMSB",49,0)
 ;
"RTN","PSODEMSB",50,0)
 S PSOFLAG1=1,PSOCLINA=0 ; First time flag to display field header
"RTN","PSODEMSB",51,0)
 ;
"RTN","PSODEMSB",52,0)
 ; PSODATER format DINUMed: 9999999.999999-CLINICAL ALERT DATE/TIME
"RTN","PSODEMSB",53,0)
 S PSODATER=0
"RTN","PSODEMSB",54,0)
 F  S PSODATER=$O(^PS(55,PSODFN,2,PSODATER)) Q:'PSODATER  D  Q:$D(DIRUT)  ;
"RTN","PSODEMSB",55,0)
 . I PSOFLAG1=1 W !!,"Clinical Alerts:" S PSOFLAG1=0
"RTN","PSODEMSB",56,0)
 . ; Display CLINICAL ALERT DATE/TIME (#.01) & CLINICAL ALERT (#1)
"RTN","PSODEMSB",57,0)
 . W !!,?2,$$GET1^DIQ(55.0109,PSODATER_","_PSODFN,.01)
"RTN","PSODEMSB",58,0)
 . W "  ",$$GET1^DIQ(55.0109,PSODATER_","_PSODFN,1)
"RTN","PSODEMSB",59,0)
 . I '$G(PAGE)!($Y+7>IOSL),$O(^PS(55,PSODFN,2,PSODATER)) D HDR("Clinical Alerts:")
"RTN","PSODEMSB",60,0)
 Q
"RTN","PSODEMSB",61,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",62,0)
HDR(HDR) ;
"RTN","PSODEMSB",63,0)
 N DIR
"RTN","PSODEMSB",64,0)
 W !
"RTN","PSODEMSB",65,0)
 I $I=$P S DIR("T")=DTIME,DIR(0)="EA",DIR("A")="Type <Enter> to continue or '^' to exit Clinical Alerts:" D ^DIR I $D(DIRUT) Q
"RTN","PSODEMSB",66,0)
 I HDR]"" W @IOF S PAGE=$G(PAGE)+1 W HDR,?70,"Page: ",PAGE,! S $Y=1
"RTN","PSODEMSB",67,0)
 Q
"RTN","PSODEMSB",68,0)
CURRFAC(PSODFN) ; Return: The Assigned/Recent Facility INSTITUTION for the Patient's DFN
"RTN","PSODEMSB",69,0)
 ; Input:
"RTN","PSODEMSB",70,0)
 ;   DFN ; Required ; IEN of Patient file (#2) entry
"RTN","PSODEMSB",71,0)
 ;
"RTN","PSODEMSB",72,0)
 N DATA,DTBEG,DTEND,FLAGQ,IEN4,ORVISIT,PCTEAM,PREVSCDT,RETURN,SUB
"RTN","PSODEMSB",73,0)
 ;
"RTN","PSODEMSB",74,0)
 S RETURN="" ; Default return value is null
"RTN","PSODEMSB",75,0)
 ;
"RTN","PSODEMSB",76,0)
 I $$GET1^DIQ(2,PSODFN,.351,"I") Q RETURN ; .351 Patient DATE OF DEATH
"RTN","PSODEMSB",77,0)
 ;
"RTN","PSODEMSB",78,0)
 ; The first choice for returning the INSTITUTION would be the
"RTN","PSODEMSB",79,0)
 ; INSTITUTION field (#.07) of the TEAM file (#404.51)
"RTN","PSODEMSB",80,0)
 ;
"RTN","PSODEMSB",81,0)
 S PCTEAM=$$OUTPTTM^SDUTL3(PSODFN,DT,1) ; IEN^NAME of file (#404.51) ; ICR #1252
"RTN","PSODEMSB",82,0)
 ; *** End   patch #1 change #1 by R2/Confer on 08/07/2015
"RTN","PSODEMSB",83,0)
 I +PCTEAM>0 D  Q RETURN
"RTN","PSODEMSB",84,0)
 . S RETURN=$$GET1^DIQ(404.51,+PCTEAM,.07) ; INSTITUTION [R*P4']
"RTN","PSODEMSB",85,0)
 ;
"RTN","PSODEMSB",86,0)
 ; Return future appointments and past visits for a patient
"RTN","PSODEMSB",87,0)
 ;
"RTN","PSODEMSB",88,0)
 S DTBEG=DT-20000 ; Begin with TODAY - 2 years
"RTN","PSODEMSB",89,0)
 S DTEND=DT+20000 ; End   with TODAY + 2 years
"RTN","PSODEMSB",90,0)
 D VST^ORWCV(.ORVISIT,PSODFN,DTBEG,DTEND) ; ICR #4211
"RTN","PSODEMSB",91,0)
 ;
"RTN","PSODEMSB",92,0)
 ; Process ORVISIT array in reverse chronological order.  Quantify
"RTN","PSODEMSB",93,0)
 ; visits & appointments based upon the INSTITUTION pointer field (#3)
"RTN","PSODEMSB",94,0)
 ; of the HOSPITAL LOCATION file (#44).  Once the count reaches
"RTN","PSODEMSB",95,0)
 ; 3 for a given INSTITUTION, that INSTITUION is returned.
"RTN","PSODEMSB",96,0)
 ;
"RTN","PSODEMSB",97,0)
 S FLAGQ=0 ; Quit flag, set to 1 once the Institution is determined
"RTN","PSODEMSB",98,0)
 S PREVSCDT="" ; Previous appt/visit date
"RTN","PSODEMSB",99,0)
 S SUB=":" ;.... Sequential number of ORVISIT array subscript
"RTN","PSODEMSB",100,0)
 F  S SUB=$O(ORVISIT(SUB),-1) Q:'SUB!FLAGQ  D  ;
"RTN","PSODEMSB",101,0)
 . N DATA,SC,SCDT
"RTN","PSODEMSB",102,0)
 . S DATA=ORVISIT(SUB)
"RTN","PSODEMSB",103,0)
 . S SC=$P($P(DATA,U),";",3) Q:'SC  ; HOSPITAL LOCATION file (#44) IEN
"RTN","PSODEMSB",104,0)
 . S IEN4=+$$GET1^DIQ(44,SC,3,"I") ; INSTITUTION file (#4) IEN
"RTN","PSODEMSB",105,0)
 . S SCDT=$P($P(DATA,U),";",2) Q:'SCDT  ; Appt/visit date (fm format)
"RTN","PSODEMSB",106,0)
 . S SCDT=$P(SCDT,".") ; Strip the time
"RTN","PSODEMSB",107,0)
 . Q:SCDT=PREVSCDT  ; Appt/visit must be a N day
"RTN","PSODEMSB",108,0)
 . I '$D(IEN4(IEN4)) S IEN4(IEN4)=0 ; Initialize INSTITUTION counter
"RTN","PSODEMSB",109,0)
 . S IEN4(IEN4)=IEN4(IEN4)+1 ; Quantify by INSTITUTION ien
"RTN","PSODEMSB",110,0)
 . I IEN4(IEN4)=3 D  Q  ; When count reaches 3, INSTITUTION found
"RTN","PSODEMSB",111,0)
 . . S RETURN=$$GET1^DIQ(4,IEN4,.01) ; INSTITUTION NAME (#.01)
"RTN","PSODEMSB",112,0)
 . . S FLAGQ=1
"RTN","PSODEMSB",113,0)
 . ;
"RTN","PSODEMSB",114,0)
 . S PREVSCDT=SCDT ; Save as previous appt/visit date
"RTN","PSODEMSB",115,0)
 ;
"RTN","PSODEMSB",116,0)
 ; IF  no PCTEAM INSTITUTION
"RTN","PSODEMSB",117,0)
 ; AND three appt/visits were not found for an INSTITUTION ien
"RTN","PSODEMSB",118,0)
 ; AND at least one appt/visit was found
"RTN","PSODEMSB",119,0)
 ; THEN
"RTN","PSODEMSB",120,0)
 ;     return the most recent appt/visit INSTITUTION
"RTN","PSODEMSB",121,0)
 ;
"RTN","PSODEMSB",122,0)
 I RETURN="" D  ;
"RTN","PSODEMSB",123,0)
 . N DATA,IEN4,SC,SUB
"RTN","PSODEMSB",124,0)
 . S SUB=$O(ORVISIT(":"),-1) Q:'SUB
"RTN","PSODEMSB",125,0)
 . S DATA=ORVISIT(SUB)
"RTN","PSODEMSB",126,0)
 . S SC=$P($P(DATA,U),";",3) Q:'SC  ; HOSPITAL LOCATION file (#44) IEN
"RTN","PSODEMSB",127,0)
 . S IEN4=$$GET1^DIQ(44,SC,3,"I") ; INSTITUTION file (#4) IEN
"RTN","PSODEMSB",128,0)
 . S RETURN=$$GET1^DIQ(4,IEN4,.01) ; INSTITUTION file (#4) NAME (#.01)
"RTN","PSODEMSB",129,0)
 ;
"RTN","PSODEMSB",130,0)
 Q RETURN
"RTN","PSODEMSB",131,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",132,0)
PCTEAM(PSODFN) ; Display current PC TEAM, PC Provider, and phone.
"RTN","PSODEMSB",133,0)
 ; Input:
"RTN","PSODEMSB",134,0)
 ;   DFN ; Required ; IEN of Patient file (#2) entry
"RTN","PSODEMSB",135,0)
 ;
"RTN","PSODEMSB",136,0)
 S PSOTEAM=0
"RTN","PSODEMSB",137,0)
 N DATA,PAGER,PCPOS,PCPROV,PCPROVI,PHONE,PCTM
"RTN","PSODEMSB",138,0)
 N SCDT2,SCP,SDI,TEAM,TEAMI
"RTN","PSODEMSB",139,0)
 ;
"RTN","PSODEMSB",140,0)
 S PCTM="^TMP(""SDPLIST"",$J)"
"RTN","PSODEMSB",141,0)
 K @PCTM
"RTN","PSODEMSB",142,0)
 S SDI=$$GETALL^SCAPMCA(PSODFN,DT,PCTM) Q:'SDI  ; ICR #2848
"RTN","PSODEMSB",143,0)
 S SDI=0
"RTN","PSODEMSB",144,0)
 F  S SDI=$O(^TMP("SDPLIST",$J,PSODFN,"PCTM",SDI)) Q:'SDI  D  ;
"RTN","PSODEMSB",145,0)
 . ;
"RTN","PSODEMSB",146,0)
 . ; "PCTM" node (PC Team)
"RTN","PSODEMSB",147,0)
 . S PSOTEAM=1
"RTN","PSODEMSB",148,0)
 . S DATA=$G(^TMP("SDPLIST",$J,PSODFN,"PCTM",SDI)) Q:DATA=""
"RTN","PSODEMSB",149,0)
 . S TEAMI=$P(DATA,U,1) ; IEN  of TEAM file (#404.51)
"RTN","PSODEMSB",150,0)
 . S TEAM=$P(DATA,U,2) ;. NAME of TEAM file entry
"RTN","PSODEMSB",151,0)
 . ;
"RTN","PSODEMSB",152,0)
 . ; "PCPR" node (PC Provider)
"RTN","PSODEMSB",153,0)
 . S DATA=$G(^TMP("SDPLIST",$J,PSODFN,"PCPR",SDI))
"RTN","PSODEMSB",154,0)
 . S PCPROVI=+$P(DATA,U,1) ; IEN of PC Provider
"RTN","PSODEMSB",155,0)
 . S PCPROV=$P(DATA,U,2) ;. PC Provider
"RTN","PSODEMSB",156,0)
 . S PCPOS=$P(DATA,U,4) ;.. PC Provider Position
"RTN","PSODEMSB",157,0)
 . S PAGER=$$GET1^DIQ(200,PCPROVI,.138) ; DIGITAL PAGER
"RTN","PSODEMSB",158,0)
 . S:PAGER="" PAGER=$$GET1^DIQ(200,PCPROVI,.137) ;  VOICE PAGER
"RTN","PSODEMSB",159,0)
 . S PHONE=$$GET1^DIQ(200,PCPROVI,.132) ; OFFICE PHONE
"RTN","PSODEMSB",160,0)
 . ;
"RTN","PSODEMSB",161,0)
 . I PSOTEAM W !! D HDR("Extended Patient Demographics:")
"RTN","PSODEMSB",162,0)
 . ;
"RTN","PSODEMSB",163,0)
 . W !," Primary Care Team: ",TEAM
"RTN","PSODEMSB",164,0)
 . W ?52,"   Phone: ",$$GET1^DIQ(404.51,TEAMI,.02) ; TEAM PHONE NUMBER
"RTN","PSODEMSB",165,0)
 . ;
"RTN","PSODEMSB",166,0)
 . W !,"       PC Provider: ",PCPROV
"RTN","PSODEMSB",167,0)
 . W ?52,"Position: ",$E(PCPOS,1,18)
"RTN","PSODEMSB",168,0)
 . ;
"RTN","PSODEMSB",169,0)
 . W !?13,"Pager: ",PAGER
"RTN","PSODEMSB",170,0)
 . W ?52,"   Phone: ",PHONE
"RTN","PSODEMSB",171,0)
 ;
"RTN","PSODEMSB",172,0)
 K @PCTM
"RTN","PSODEMSB",173,0)
 Q
"RTN","PSODEMSB",174,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",175,0)
REMARKS(PSODFN) ; Display PATIENT file (#2) REMARKS field (#.091)
"RTN","PSODEMSB",176,0)
 ; Input:
"RTN","PSODEMSB",177,0)
 ;   DFN ; Required ; IEN of Patient file (#2) entry
"RTN","PSODEMSB",178,0)
 ;
"RTN","PSODEMSB",179,0)
 W !?11,"Remarks: ",$$GET1^DIQ(2,PSODFN_",",.091)
"RTN","PSODEMSB",180,0)
 ;
"RTN","PSODEMSB",181,0)
 Q
"RTN","PSODEMSB",182,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",183,0)
ENTER ; PSO CLINICAL ENTER/EDIT OPTION ENTRY POINT.
"RTN","PSODEMSB",184,0)
 N PSODFN
"RTN","PSODEMSB",185,0)
PROMPT ;
"RTN","PSODEMSB",186,0)
 W @IOF,!?1,"*** CLINICAL ALERT ENTER/EDIT ***"
"RTN","PSODEMSB",187,0)
START ;
"RTN","PSODEMSB",188,0)
 W !
"RTN","PSODEMSB",189,0)
 S PSODFN=+$$PATIENT G:'PSODFN EXIT  W ! ; Prompt for Select PHARMACY PATIENT
"RTN","PSODEMSB",190,0)
 D EDITCA(PSODFN) ; Edit CLINICAL ALERTS (multiple)
"RTN","PSODEMSB",191,0)
 G START
"RTN","PSODEMSB",192,0)
 ;
"RTN","PSODEMSB",193,0)
EXIT ;
"RTN","PSODEMSB",194,0)
 Q
"RTN","PSODEMSB",195,0)
 ;------------------------------------------------------------------
"RTN","PSODEMSB",196,0)
EDITCA(PSODFN) ; Edit the CLINICAL ALERTS multiple (#109) of file (#55)
"RTN","PSODEMSB",197,0)
 ; Input:
"RTN","PSODEMSB",198,0)
 ;   DFN ; Patient file (#2) entry internal entry number
"RTN","PSODEMSB",199,0)
 ;
"RTN","PSODEMSB",200,0)
 NEW %,%X,%Y,D,D0,D1,DA,DG,DI,DIC,DIDEL,DIE,DIERR,DIW,DQ,DR,DTOUT,X
"RTN","PSODEMSB",201,0)
 ;
"RTN","PSODEMSB",202,0)
 S DA=PSODFN
"RTN","PSODEMSB",203,0)
 S DIE="^PS(55,",DR="[PSO CLINICAL ALERT ENTER/EDIT]"
"RTN","PSODEMSB",204,0)
 ;
"RTN","PSODEMSB",205,0)
 D LOCK^DILF($NA(^PS(55,DA))) E  D  Q
"RTN","PSODEMSB",206,0)
 . W $C(7),!?4
"RTN","PSODEMSB",207,0)
 . W "Patient ",$$GET1^DIQ(2,DA,.01)," is being edited by another user."
"RTN","PSODEMSB",208,0)
 D ^DIE
"RTN","PSODEMSB",209,0)
 LOCK -^PS(55,DA)
"RTN","PSODEMSB",210,0)
 ;
"RTN","PSODEMSB",211,0)
 Q
"RTN","PSODEMSB",212,0)
 ;-----------------------------------------------------------------
"RTN","PSODEMSB",213,0)
PATIENT() ; Extrinsic, prompt for 'Select PHARMACY PATIENT: '
"RTN","PSODEMSB",214,0)
 ; Output:
"RTN","PSODEMSB",215,0)
 ;   IEN^Name ; Of the selected Pharmacy Patient file #55 entry
"RTN","PSODEMSB",216,0)
 ;              Return null if no patient selected
"RTN","PSODEMSB",217,0)
 ;
"RTN","PSODEMSB",218,0)
 N %,%H,%I,%X,%Y,C,D,D0,DA,DDH,DG,DIC,DILN,DINUM,DIPGM,DIY
"RTN","PSODEMSB",219,0)
 N DLAYGO,DTOUT,DUOUT,I,RETURN,X,Y
"RTN","PSODEMSB",220,0)
 ;
"RTN","PSODEMSB",221,0)
 S RETURN=""
"RTN","PSODEMSB",222,0)
 S DIC="^PS(55,"
"RTN","PSODEMSB",223,0)
 S DIC(0)="AEMQZ"
"RTN","PSODEMSB",224,0)
 D ^DIC I Y>0 S RETURN=+Y_"^"_Y(0,0)
"RTN","PSODEMSB",225,0)
 ;
"RTN","PSODEMSB",226,0)
 Q RETURN
"RTN","PSODEMSB",227,0)
 ;
"RTN","PSODEMSB",228,0)
APPT() ; get appointments up to +/-2 yrs from now
"RTN","PSODEMSB",229,0)
 ;  return null or name of institution
"RTN","PSODEMSB",230,0)
 ;  ICR# 10061 - VADPT supported
"RTN","PSODEMSB",231,0)
 ;  ICR# 10040 - FM read of file 44, field 3 supported
"RTN","PSODEMSB",232,0)
 ;  ICR# 2171  - $$NS^XUAF4
"RTN","PSODEMSB",233,0)
 N I,X,Y,DIV,F4,GL,NOW,VAERR,VAST,XI,XE
"RTN","PSODEMSB",234,0)
 S GL=$NA(^UTILITY("VASD",$J)) K @GL
"RTN","PSODEMSB",235,0)
 S NOW=$$NOW^XLFDT
"RTN","PSODEMSB",236,0)
 S VASD("F")=DT-20000
"RTN","PSODEMSB",237,0)
 S VASD("T")=DT+20000
"RTN","PSODEMSB",238,0)
 D SDA^VADPT
"RTN","PSODEMSB",239,0)
 ;   div("F",inst)=total count of visits
"RTN","PSODEMSB",240,0)
 ;   div("F",0) = appt_dt ^ inst_ptr
"RTN","PSODEMSB",241,0)
 ;   div("P") set up similarly for past kept appointments
"RTN","PSODEMSB",242,0)
 ;   ^utility("VASD",$j,inc,"I"/"E")=appt_dt^clinic^status^appt_type
"RTN","PSODEMSB",243,0)
 ;   only use one visit per day for division count
"RTN","PSODEMSB",244,0)
 ;   if institution has more than 2 future appts, use that
"RTN","PSODEMSB",245,0)
 ;   if institution has more than 2 past appts, use that
"RTN","PSODEMSB",246,0)
 ;   if future appts, use institution of next appt
"RTN","PSODEMSB",247,0)
 ;   if past appts, use institution of last appt
"RTN","PSODEMSB",248,0)
 ;   use ^UTILITY("VASD",$J,"D",DATE)="" to track visit days
"RTN","PSODEMSB",249,0)
 S F4="",I=0 F  S I=$O(@GL@(I)) Q:'I  S XI=^(I,"I"),XE=^("E") D  Q:F4>2
"RTN","PSODEMSB",250,0)
 . N CL,APPT,DATE,INST
"RTN","PSODEMSB",251,0)
 . S APPT=+XI,CL=+$P(XI,U,2) Q:'CL
"RTN","PSODEMSB",252,0)
 . S DATE=$P(APPT,".") Q:$D(@GL@("D",DATE))  S ^(DATE)=""
"RTN","PSODEMSB",253,0)
 . S INST=+$$GET1^DIQ(44,SC,3,"I") Q:'INST
"RTN","PSODEMSB",254,0)
 . I APPT>NOW D
"RTN","PSODEMSB",255,0)
 . . S Y=1+$G(DIV("F",INST)) I Y>2 S F4=INST Q
"RTN","PSODEMSB",256,0)
 . . S DIV("F",INST)=Y I '$D(DIV("F",0)) S DIV("F",0)=APPT_U_INST Q
"RTN","PSODEMSB",257,0)
 . . I APPT<DIV("F",0) S DIV("F",0)=APPT_U_INST
"RTN","PSODEMSB",258,0)
 . . Q
"RTN","PSODEMSB",259,0)
 . I APPT'>NOW D
"RTN","PSODEMSB",260,0)
 . . S Y=1+$G(DIV("P",INST)),DIV("F",INST)=Y
"RTN","PSODEMSB",261,0)
 . . I '$D(DIV("P",0)) S DIV("F",0)=APPT_U_INST Q
"RTN","PSODEMSB",262,0)
 . . I APPT>DIV("P",0) S DIV("F",0)=APPT_U_INST
"RTN","PSODEMSB",263,0)
 . . Q
"RTN","PSODEMSB",264,0)
 . Q
"RTN","PSODEMSB",265,0)
 I 'F4 S (I,X,Y)=0 D
"RTN","PSODEMSB",266,0)
 . F  S I=$O(DIV("P",I)) Q:'I  I DIV("P",I)>Y S X=I,Y=DIV("P",I)
"RTN","PSODEMSB",267,0)
 . I X,Y>2 S F4=X Q
"RTN","PSODEMSB",268,0)
 . S X=$G(DIV("F",0)) I +X S F4=$P(X,U,2) Q
"RTN","PSODEMSB",269,0)
 . S X=$G(DIV("P",0)) I +X S F4=$P(X,U,2)
"RTN","PSODEMSB",270,0)
 . Q
"RTN","PSODEMSB",271,0)
 I F4 S F4=$P($$NS^XUAF4(F4),U)
"RTN","PSODEMSB",272,0)
 K @GL
"RTN","PSODEMSB",273,0)
 Q F4
"RTN","PSOORRL")
0^1^B66889915^B66471559
"RTN","PSOORRL",1,0)
PSOORRL ;BHAM ISC/SAB - returns patient's outpatient meds ; 7/3/13 4:00pm
"RTN","PSOORRL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,9,34,54,82,124,132,159,214,225,318,558,564**;DEC 1997;Build 6
"RTN","PSOORRL",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRL",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRL",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRL",10,0)
 ;External reference to OEL^PSJORRE1 supported by DBIA 2384
"RTN","PSOORRL",11,0)
OCL(DFN,BDT,EDT,VIEW) ;entry point to return condensed list
"RTN","PSOORRL",12,0)
 ; VIEW=0   -  This returns the list as it was returned prior to GUI 27
"RTN","PSOORRL",13,0)
 ; VIEW=1   -  This returns the list in original view GUI 27
"RTN","PSOORRL",14,0)
 ; VIEW=2   -  This is the new sort with GUI 27
"RTN","PSOORRL",15,0)
 ; VIEW=3   -  New sort by Sort by Drug Name/status with GUI 27
"RTN","PSOORRL",16,0)
 D @$S($G(VIEW)=3:"OCL^PSOORRL3",$G(VIEW)=1:"OCL^PSOORRLO",$G(VIEW)=2:"OCL^PSOORRLN",1:"ST")
"RTN","PSOORRL",17,0)
 Q
"RTN","PSOORRL",18,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRL",19,0)
ST N SD,SDT,SDT1
"RTN","PSOORRL",20,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRL",21,0)
 K ^TMP("PS",$J) S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRL",22,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRL",23,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRL",24,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRL",25,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRL",26,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRL",27,0)
 .S ^TMP("PS",$J,TFN,0)=IFN_"R;O"_"^"_$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRL",28,0)
 .S ^TMP("PS",$J,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",29,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",30,0)
 .S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUED^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",31,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRL",32,0)
 .S ^TMP("PS",$J,TFN,"SCH",0)=0
"RTN","PSOORRL",33,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PS",$J,TFN,"SCH",0)=^TMP("PS",$J,TFN,"SCH",0)+1
"RTN","PSOORRL",34,0)
 .S ^TMP("PS",$J,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL",35,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL",36,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL",37,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL",38,0)
 ..S ^TMP("PS",$J,TFN,"MDR",0)=^TMP("PS",$J,TFN,"MDR",0)+1
"RTN","PSOORRL",39,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRL",40,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",41,0)
 ..S ^TMP("PS",$J,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",42,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",43,0)
 K PSOELSE
"RTN","PSOORRL",44,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRL",45,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRL",46,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRL",47,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRL",48,0)
 .S TFN=TFN+1,^TMP("PS",$J,TFN,0)=IFN_"P;O^"_$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRL",49,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRL",50,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRL",51,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PS",$J,TFN,"SCH",0)=SD
"RTN","PSOORRL",52,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PS",$J,TFN,"SIG",0)=SD
"RTN","PSOORRL",53,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PS",$J,TFN,"SIO",0)=SD D
"RTN","PSOORRL",54,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PS",$J,TFN,"SIO",0)=SD S ^TMP("PS",$J,TFN,"SIO",IEN,0)=$G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRL",55,0)
 D NVA,OCL^PSJORRE(DFN,BDT,EDT,.TFN,+$G(VIEW)),END^PSOORRL1
"RTN","PSOORRL",56,0)
 K SDT,SDT1,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRL",57,0)
 Q
"RTN","PSOORRL",58,0)
OEL(DFN,RXNUM) ;returns expanded list on specific order
"RTN","PSOORRL",59,0)
 I $P(RXNUM,";",2)="I" D OEL^PSJORRE1(DFN,$P(RXNUM,";")) Q
"RTN","PSOORRL",60,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) Q:RXNUM=""
"RTN","PSOORRL",61,0)
 ;BHW;PSO*7*159;New SD
"RTN","PSOORRL",62,0)
 N SD
"RTN","PSOORRL",63,0)
 K INST,IFN,^TMP("PS",$J) S FL=$P(RXNUM,";"),IFN=+FL,RXNUM=$P(RXNUM,";",2)
"RTN","PSOORRL",64,0)
 I $G(FL)["P"!($G(FL)["S") D PEN^PSOORRL1 Q
"RTN","PSOORRL",65,0)
 I $G(FL)["N" D NVA^PSOORRL1 Q
"RTN","PSOORRL",66,0)
 I $G(FL)["V" Q  ;QUIT IF IV ORDER  ;*318
"RTN","PSOORRL",67,0)
 Q:'$D(^PSRX(IFN,0))
"RTN","PSOORRL",68,0)
 S RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2)
"RTN","PSOORRL",69,0)
 S ^TMP("PS",$J,"RXN",0)=$P(RX0,"^")_"^"_$E($P(RX2,"^",13),1,7)_"^"_$S($P(RX0,"^",11)="W":"W",1:"M")_"^"_$P(RX3,"^",7)
"RTN","PSOORRL",70,0)
 S ^TMP("PS",$J,"RXN",0)=^TMP("PS",$J,"RXN",0)_"^"_$S($P(RX2,"^",10):$P(RX2,"^",10),$P($G(^PSRX(IFN,"OR1")),"^",5):$P(^PSRX(IFN,"OR1"),"^",5),1:"")_"^"_$E($P(RX2,"^",2),1,7)_"^"_$E($P(RX2,"^",13),1,7)
"RTN","PSOORRL",71,0)
 D RSTC(0) ;set return to stock node for original
"RTN","PSOORRL",72,0)
 F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^") D
"RTN","PSOORRL",73,0)
 .S ^TMP("PS",$J,"REF",I,0)=$P(^PSRX(IFN,1,I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",18),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",74,0)
 .I $P(^PSRX(IFN,1,I,0),"^",18) S $P(^TMP("PS",$J,"RXN",0),"^",2)=$E($P(^PSRX(IFN,1,I,0),"^",18),1,7)
"RTN","PSOORRL",75,0)
 .S ^TMP("PS",$J,"REF",0)=$G(^TMP("PS",$J,"REF",0))+1
"RTN","PSOORRL",76,0)
 .D RSTC(I) ;set return to stock node for refills
"RTN","PSOORRL",77,0)
 F I=0:0 S I=$O(^PSRX(IFN,"P",I)) Q:'I  D
"RTN","PSOORRL",78,0)
 .S ^TMP("PS",$J,"PAR",I,0)=$P(^PSRX(IFN,"P",I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",19),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",79,0)
 .S ^TMP("PS",$J,"PAR",0)=$G(^TMP("PS",$J,"PAR",0))+1
"RTN","PSOORRL",80,0)
 S ^TMP("PS",$J,0)=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)
"RTN","PSOORRL",81,0)
 S ^TMP("PS",$J,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",82,0)
 S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",83,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUE^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",84,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^"_($P(RX0,"^",9)-TRM)_"^"_$P(RX0,"^",13)_"^"_ST_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)_"^"_LSTFD_"^^"
"RTN","PSOORRL",85,0)
 S ^TMP("PS",$J,"DD",0)=1,^TMP("PS",$J,"DD",1,0)=$P(RX0,"^",6)_"^^"
"RTN","PSOORRL",86,0)
 S COD=$S('$G(^PSDRUG(+$P(RX0,"^",6),"I")):1,+$G(^PSDRUG(+$P(RX0,"^",6),"I"))>DT:1,1:0)
"RTN","PSOORRL",87,0)
 S ^TMP("PS",$J,"DD",1,0)=^TMP("PS",$J,"DD",1,0)_$S($P($G(^PSDRUG(+$P(RX0,"^",6),2)),"^",3)["U"&(COD):$P(RX0,"^",6),1:"") K COD
"RTN","PSOORRL",88,0)
 S ^TMP("PS",$J,"SCH",0)=0,(SCH,SC)=0
"RTN","PSOORRL",89,0)
 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^") D
"RTN","PSOORRL",90,0)
 .S ^TMP("PS",$J,"SCH",0)=^TMP("PS",$J,"SCH",0)+1
"RTN","PSOORRL",91,0)
 D MDR^PSOORRL1
"RTN","PSOORRL",92,0)
 S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG^PSOORRL1
"RTN","PSOORRL",93,0)
 I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",94,0)
 .S ^TMP("PS",$J,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",95,0)
 .F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",96,0)
 K PSOELSE
"RTN","PSOORRL",97,0)
 S ^TMP("PS",$J,"PC",0)=0,ITFN=0
"RTN","PSOORRL",98,0)
 F I=0:0 S I=$O(^PSRX(IFN,"PRC",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"PC",ITFN,0)=^PSRX(IFN,"PRC",I,0),^TMP("PS",$J,"PC",0)=^TMP("PS",$J,"PC",0)+1
"RTN","PSOORRL",99,0)
 Q
"RTN","PSOORRL",100,0)
 ;
"RTN","PSOORRL",101,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRL",102,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRL",103,0)
 Q
"RTN","PSOORRL",104,0)
 ;
"RTN","PSOORRL",105,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRL",106,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRL",107,0)
 N SDT,SDT1
"RTN","PSOORRL",108,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRL",109,0)
 .Q:'$P(X,"^")
"RTN","PSOORRL",110,0)
 .I $L($P(X,"^",7)),($P(X,"^",7)<PSBDT)!($P(X,"^",7)>PSEDT) Q  ;p558 bypass if DISCONTINUED DATE outside reported date range
"RTN","PSOORRL",111,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL",112,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRL",113,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRL",114,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",115,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRL",116,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRL",117,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRL",118,0)
 ..D TMPBLD
"RTN","PSOORRL",119,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRL",120,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRL",121,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",122,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",123,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRL",124,0)
 ..D TMPBLD
"RTN","PSOORRL",125,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRL",126,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",127,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRL",128,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",129,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",130,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRL",131,0)
 ..D TMPBLD
"RTN","PSOORRL",132,0)
 Q
"RTN","PSOORRL",133,0)
TMPBLD S TFN=$G(TFN)+1,^TMP("PS",$J,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRL",134,0)
 S $P(^TMP("PS",$J,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRL",135,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=1,^TMP("PS",$J,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRL",136,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=1,^TMP("PS",$J,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRL",137,0)
 Q
"RTN","PSOORRL",138,0)
RSTC(REF) ; return to stock
"RTN","PSOORRL",139,0)
 F J=0:0 S J=$O(^PSRX(IFN,"A",J)) Q:'J  S II=$G(^(J,0)) I $P(II,"^",2)="I",$P(II,"^",4)=REF D
"RTN","PSOORRL",140,0)
 .I REF=0,'$$RXRLDT^PSOBPSUT(IFN,0) S ^TMP("PS",$J,"RXN","RSTC")=$P(II,"^")_"^"_$P(II,"^",3)_"^"_$P(II,"^",5) Q
"RTN","PSOORRL",141,0)
 .I REF>0,'$$RXRLDT^PSOBPSUT(IFN,REF) S ^TMP("PS",$J,"REF",REF,"RSTC")=$P(II,"^")_"^"_$P(II,"^",3)_"^"_$P(II,"^",5)
"RTN","PSOORRL",142,0)
 Q
"RTN","PSOPATLK")
0^3^B6979395^B6969813
"RTN","PSOPATLK",1,0)
PSOPATLK ;BIR/JAM - Patient Lookup utility ;7/21/08
"RTN","PSOPATLK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**326,348,438,564**;DEC 1997;Build 6
"RTN","PSOPATLK",3,0)
 ;
"RTN","PSOPATLK",4,0)
 ; This API looks for a patient using a prescription number, barcode,
"RTN","PSOPATLK",5,0)
 ; universal Member ID number from the patient's VHIC Card
"RTN","PSOPATLK",6,0)
 ; or the registration standard patient lookup.
"RTN","PSOPATLK",7,0)
 ;
"RTN","PSOPATLK",8,0)
EN ;Entry point - Prompts for Patient, Prescription Number or Barcode
"RTN","PSOPATLK",9,0)
 ; 
"RTN","PSOPATLK",10,0)
 ; Input  - DIC(0) & DIC("A") [Optional] 
"RTN","PSOPATLK",11,0)
 ;          Used by DIR if defined by the calling routine.
"RTN","PSOPATLK",12,0)
 ;
"RTN","PSOPATLK",13,0)
 ; Output - PSOPTLK [Processed user response]
"RTN","PSOPATLK",14,0)
 ;
"RTN","PSOPATLK",15,0)
 N DIR
"RTN","PSOPATLK",16,0)
 K PSOPTLK,PAGE
"RTN","PSOPATLK",17,0)
 S DIR(0)="FOU"_$S($D(DIC("A")):"A",1:"")_"^^K:$$PATVAL^PSOPATLK() X"
"RTN","PSOPATLK",18,0)
 S DIR("A")=$S($D(DIC("A")):DIC("A"),1:"Select PATIENT NAME")
"RTN","PSOPATLK",19,0)
 S (DIR("?"),DIR("??"))="^D PATHLP^PSOPATLK"
"RTN","PSOPATLK",20,0)
 D ^DIR
"RTN","PSOPATLK",21,0)
 M PSOPTLK=Y
"RTN","PSOPATLK",22,0)
 K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PSOPATLK",23,0)
 Q
"RTN","PSOPATLK",24,0)
PATHLP ;Help text for patient prompt
"RTN","PSOPATLK",25,0)
 N DIC
"RTN","PSOPATLK",26,0)
 I $E(X)'="?" Q
"RTN","PSOPATLK",27,0)
 I X="?" D
"RTN","PSOPATLK",28,0)
 .W !?1,"Enter the prescription number prefixed by a # (ex. #XXXXXXX) or"
"RTN","PSOPATLK",29,0)
 .W !?1,"Wand the barcode of the prescription. The format of the barcode is"
"RTN","PSOPATLK",30,0)
 .W !?1,"NNN-NNNNNNN where the first 3 digits are your station number."
"RTN","PSOPATLK",31,0)
 .W !?1,"         - OR -           "
"RTN","PSOPATLK",32,0)
 .W !?1,"Enter the universal Member ID number from the patient's VHIC Card"
"RTN","PSOPATLK",33,0)
 .W !?1,"or wand the barcode of the VHIC card"
"RTN","PSOPATLK",34,0)
 .W !?1,"         - OR -           "
"RTN","PSOPATLK",35,0)
 S DIC="^DPT(",DIC(0)="QZEXN" D ^DIC
"RTN","PSOPATLK",36,0)
 Q
"RTN","PSOPATLK",37,0)
 ;
"RTN","PSOPATLK",38,0)
PATVAL() ;Validate user input
"RTN","PSOPATLK",39,0)
 N OUT
"RTN","PSOPATLK",40,0)
 S OUT=0
"RTN","PSOPATLK",41,0)
 ;Prescription lookup
"RTN","PSOPATLK",42,0)
 I X?1"#".E D RXLK Q OUT
"RTN","PSOPATLK",43,0)
 ;Barcode lookup
"RTN","PSOPATLK",44,0)
 I X?3N1"-".N D RXLK Q OUT
"RTN","PSOPATLK",45,0)
 ;Standard patient lookup
"RTN","PSOPATLK",46,0)
 S DIC="^DPT(" S:'$D(DIC(0)) DIC(0)="QEMZ" D ^DIC
"RTN","PSOPATLK",47,0)
 S OUT=$S(+Y>0:0,1:1)
"RTN","PSOPATLK",48,0)
 Q OUT
"RTN","PSOPATLK",49,0)
 ;
"RTN","PSOPATLK",50,0)
RXLK ;Prescription Lookup
"RTN","PSOPATLK",51,0)
 N DFN,DIC,RXNUM,RX,Z
"RTN","PSOPATLK",52,0)
 S RXNUM=X,RX=$S($E(RXNUM)="#":$E(RXNUM,2,999999999),1:$P(RXNUM,"-",2))
"RTN","PSOPATLK",53,0)
 I RX="" W !,$C(7),"No prescription number entered." S OUT=1 Q
"RTN","PSOPATLK",54,0)
 I $E(RXNUM)'="#",$P(RXNUM,"-")'=$$INST() D  S OUT=1 Q
"RTN","PSOPATLK",55,0)
 .W !!,$C(7),"This prescription is not from this institution."
"RTN","PSOPATLK",56,0)
 S Z=$S($E(RXNUM)="#":$O(^PSRX("B",RX,0)),1:RX),Y=$G(^PSRX(+Z,0))
"RTN","PSOPATLK",57,0)
 I (Y="")!(Z="") D  S OUT=1 Q
"RTN","PSOPATLK",58,0)
 .W !,$C(7),"No Prescription Record found"_$S($E(RXNUM)="#":".",1:" for this barcode.")
"RTN","PSOPATLK",59,0)
 S DFN=$P(Y,"^",2) K Y
"RTN","PSOPATLK",60,0)
 N DIC,X S DIC="^DPT(",DIC(0)="QZEXN" S X=DFN D ^DIC
"RTN","PSOPATLK",61,0)
 Q 
"RTN","PSOPATLK",62,0)
INST() ;get institution number
"RTN","PSOPATLK",63,0)
 N PSOINST,DA,DIQ
"RTN","PSOPATLK",64,0)
 S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOPATLK",65,0)
 S PSOINST=$$GET1^DIQ(4,DA,99,"I")
"RTN","PSOPATLK",66,0)
 Q PSOINST
"RTN","PSOPATLK",67,0)
 ;
"VER")
8.0^22.2
"BLD",11170,6)
^469
**END**
**END**

