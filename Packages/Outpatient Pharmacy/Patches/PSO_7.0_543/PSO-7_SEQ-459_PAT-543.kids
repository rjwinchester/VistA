Released PSO*7*543 SEQ #459
Extracted from mail message
**KIDS**:PSO*7.0*543^

**INSTALL NAME**
PSO*7.0*543
"BLD",10944,0)
PSO*7.0*543^OUTPATIENT PHARMACY^0^3190110^y
"BLD",10944,1,0)
^^2^2^3181106^^^
"BLD",10944,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",10944,1,2,0)
under PSO*7*543.
"BLD",10944,4,0)
^9.64PA^^
"BLD",10944,6.3)
5
"BLD",10944,"KRN",0)
^9.67PA^1.61^23
"BLD",10944,"KRN",.4,0)
.4
"BLD",10944,"KRN",.401,0)
.401
"BLD",10944,"KRN",.402,0)
.402
"BLD",10944,"KRN",.403,0)
.403
"BLD",10944,"KRN",.5,0)
.5
"BLD",10944,"KRN",.84,0)
.84
"BLD",10944,"KRN",1.6,0)
1.6
"BLD",10944,"KRN",1.61,0)
1.61
"BLD",10944,"KRN",1.62,0)
1.62
"BLD",10944,"KRN",3.6,0)
3.6
"BLD",10944,"KRN",3.8,0)
3.8
"BLD",10944,"KRN",9.2,0)
9.2
"BLD",10944,"KRN",9.8,0)
9.8
"BLD",10944,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10944,"KRN",9.8,"NM",1,0)
PSODIR1^^0^B95790697
"BLD",10944,"KRN",9.8,"NM","B","PSODIR1",1)

"BLD",10944,"KRN",19,0)
19
"BLD",10944,"KRN",19.1,0)
19.1
"BLD",10944,"KRN",101,0)
101
"BLD",10944,"KRN",409.61,0)
409.61
"BLD",10944,"KRN",771,0)
771
"BLD",10944,"KRN",779.2,0)
779.2
"BLD",10944,"KRN",870,0)
870
"BLD",10944,"KRN",8989.51,0)
8989.51
"BLD",10944,"KRN",8989.52,0)
8989.52
"BLD",10944,"KRN",8994,0)
8994
"BLD",10944,"KRN","B",.4,.4)

"BLD",10944,"KRN","B",.401,.401)

"BLD",10944,"KRN","B",.402,.402)

"BLD",10944,"KRN","B",.403,.403)

"BLD",10944,"KRN","B",.5,.5)

"BLD",10944,"KRN","B",.84,.84)

"BLD",10944,"KRN","B",1.6,1.6)

"BLD",10944,"KRN","B",1.61,1.61)

"BLD",10944,"KRN","B",1.62,1.62)

"BLD",10944,"KRN","B",3.6,3.6)

"BLD",10944,"KRN","B",3.8,3.8)

"BLD",10944,"KRN","B",9.2,9.2)

"BLD",10944,"KRN","B",9.8,9.8)

"BLD",10944,"KRN","B",19,19)

"BLD",10944,"KRN","B",19.1,19.1)

"BLD",10944,"KRN","B",101,101)

"BLD",10944,"KRN","B",409.61,409.61)

"BLD",10944,"KRN","B",771,771)

"BLD",10944,"KRN","B",779.2,779.2)

"BLD",10944,"KRN","B",870,870)

"BLD",10944,"KRN","B",8989.51,8989.51)

"BLD",10944,"KRN","B",8989.52,8989.52)

"BLD",10944,"KRN","B",8994,8994)

"BLD",10944,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10944,"QUES",0)
^9.62^^
"BLD",10944,"REQB",0)
^9.611^1^1
"BLD",10944,"REQB",1,0)
PSO*7.0*505^2
"BLD",10944,"REQB","B","PSO*7.0*505",1)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
543^3190110
"PKG",170,22,1,"PAH",1,1,0)
^^2^2^3190110
"PKG",170,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",170,22,1,"PAH",1,1,2,0)
under PSO*7*543.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSODIR1")
0^1^B95790697^B95371987
"RTN","PSODIR1",1,0)
PSODIR1 ;IHS/DSD - ASKS DATA FOR RX ORDER ENTRY CONT. ;5/18/10 2:28pm
"RTN","PSODIR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,46,78,102,121,131,146,166,184,222,268,206,266,340,391,444,446,505,543**;DEC 1997;Build 5
"RTN","PSODIR1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSODIR1",4,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSODIR1",5,0)
 ;External reference $$MXDAYSUP^PSSUTIL1 supported by DBIA 6229
"RTN","PSODIR1",6,0)
 ;
"RTN","PSODIR1",7,0)
PTSTAT(PSODIR) ;
"RTN","PSODIR1",8,0)
PTSTATEN K DIC,DR,DIE S PSODIR("FIELD")=0
"RTN","PSODIR1",9,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" K PSORX("PATIENT STATUS"),PSODIR("PATIENT STATUS") N PSOFNDRX,PSOFNDFL,PSOFNDPS D
"RTN","PSODIR1",10,0)
 .S PSOFNDFL=0 F PSOFNDPS=0:0 S PSOFNDPS=$O(^PS(53,PSOFNDPS)) Q:'PSOFNDPS!(PSOFNDFL)  D
"RTN","PSODIR1",11,0)
 ..S PSOFNDRX=$P($G(^PS(53,PSOFNDPS,0)),"^") S PSOFNDRX=$$UP^XLFSTR(PSOFNDRX) I PSOFNDRX="NON-VA" S PSOFNDFL=1 S (PSORX("PATIENT STATUS"),DIC("B"))=$P($G(^PS(53,PSOFNDPS,0)),"^")
"RTN","PSODIR1",12,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW",$G(PSORX("PATIENT STATUS"))="" W !,"Could not find a 'NON-VA' Patient Status in the RX PATIENT STATUS file (#53)!" D PSTPB D  S PSODIR("DFLG")=1 G PTSTATX
"RTN","PSODIR1",13,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODIR1",14,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" G TPBB
"RTN","PSODIR1",15,0)
 N PSOX
"RTN","PSODIR1",16,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^"),DIC("B")=PSORX("PATIENT STATUS")
"RTN","PSODIR1",17,0)
 S:$G(PSODIR("PATIENT STATUS"))]"" DIC("B")=PSODIR("PATIENT STATUS")
"RTN","PSODIR1",18,0)
TPBB ;
"RTN","PSODIR1",19,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSODIR1",20,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSODIR1",21,0)
 S DIC("A")="RX PATIENT STATUS: "
"RTN","PSODIR1",22,0)
 S DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSODIR1",23,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" N PSOPSDIR,PSOFNDZZ,PSOPSUPA S (PSOPSDIR,PSOPSUPA)=0 D  I PSOPSDIR S:PSOPSUPA PSODIR("DFLG")=1 G:PSOPSUPA PTSTATX W ! D PSTPB G PTSTATEN
"RTN","PSODIR1",24,0)
 .I +Y'>0!($D(DTOUT))!($D(DUOUT)) S (PSOPSDIR,PSOPSUPA)=1 Q
"RTN","PSODIR1",25,0)
 .S (PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"))=+Y,PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",26,0)
 .S PSOFNDZZ=$P($G(^PS(53,+Y,0)),"^") S PSOFNDZZ=$$UP^XLFSTR(PSOFNDZZ) I PSOFNDZZ'="NON-VA" S PSOPSDIR=1 K PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"),PSODIR("PTST NODE")
"RTN","PSODIR1",27,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" G TPBSC
"RTN","PSODIR1",28,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP G PTSTATX
"RTN","PSODIR1",29,0)
 I $D(DUOUT)!$D(DTOUT) S PSODIR("DFLG")=1 G PTSTATX
"RTN","PSODIR1",30,0)
 I Y=-1 W $C(7)," Required" G PTSTATEN
"RTN","PSODIR1",31,0)
 N PSOFNDX,PSOFNDXY,PSOFNDXX,PSOFNDYY
"RTN","PSODIR1",32,0)
 S PSOFNDXY=$G(Y),PSOFNDYY=$G(Y(0))
"RTN","PSODIR1",33,0)
 I '$G(PSOTPBFG),$G(PSOFROM)="NEW" S PSOFNDX=$P($G(^PS(53,+Y,0)),"^") S PSOFNDXX=$$UP^XLFSTR(PSOFNDX) I PSOFNDXX="NON-VA" K PSOFNDX,PSOFNDXY,PSOFNDYY,PSOFNDXX,Y W !!,"Cannot select 'NON-VA' Rx Patient Status!",! G PTSTATEN
"RTN","PSODIR1",34,0)
 S Y=$G(PSOFNDXY),Y(0)=$G(PSOFNDYY)
"RTN","PSODIR1",35,0)
 K PSOFNDXY,PSOFNDYY,PSOFNDX,PSOFNDXX
"RTN","PSODIR1",36,0)
 S (PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"))=+Y
"RTN","PSODIR1",37,0)
 S PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",38,0)
TPBSC ;
"RTN","PSODIR1",39,0)
 I $G(PSOFDR),$P($G(OR0),"^",17)="C" G PTSTATX
"RTN","PSODIR1",40,0)
 L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T G PTSTATX
"RTN","PSODIR1",41,0)
 S DIE="55",DR="3////"_+Y,DA=PSODFN D ^DIE K DIE,DA,D0
"RTN","PSODIR1",42,0)
 L -^PS(55,PSODFN)
"RTN","PSODIR1",43,0)
PTSTATX K DTOUT,DUOUT,X,Y,DA
"RTN","PSODIR1",44,0)
 Q
"RTN","PSODIR1",45,0)
SIG(PSODIR) ;
"RTN","PSODIR1",46,0)
 I $G(PSOFDR),$G(PSODIR("SIG"))']"" D SIGOK G:$G(SIGOK)!($G(PSODIR("DFLG"))) SIGX
"RTN","PSODIR1",47,0)
 K DIR,DIC
"RTN","PSODIR1",48,0)
 S DIR(0)="52,10"
"RTN","PSODIR1",49,0)
 S:$G(PSODRUG("SIG"))]"" DIR("B")=PSODRUG("SIG")
"RTN","PSODIR1",50,0)
 S:$G(PSODIR("SIG"))]"" DIR("B")=PSODIR("SIG")
"RTN","PSODIR1",51,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") SIGX
"RTN","PSODIR1",52,0)
 S PSODIR("SIG")=Y,SIGOK=0 K SIG
"RTN","PSODIR1",53,0)
SIGX K X,Y
"RTN","PSODIR1",54,0)
 Q
"RTN","PSODIR1",55,0)
QTY(PSODIR) ;
"RTN","PSODIR1",56,0)
QTYA K DIR,DIC N RFL,RXIEN
"RTN","PSODIR1",57,0)
 I $G(CLOZPAT)=1 S DIR("A",1)="Patient Eligible for 14 day supply or 7 day supply with 1 refill"
"RTN","PSODIR1",58,0)
 I $G(CLOZPAT)=2 S DIR("A",1)="Patient Eligible 28 day supply or 14 day supply with 1 refill or 7 day supply with 3 refill"
"RTN","PSODIR1",59,0)
 S DIR(0)="52,7" S:$G(PSODRUG("IEN")) DIR("A")="QTY ( "_$G(PSODRUG("UNIT"))_" ) "_$S($P($G(^PSDRUG(+PSODRUG("IEN"),5)),"^")]"":$P(^PSDRUG(+PSODRUG("IEN"),5),"^"),1:"")
"RTN","PSODIR1",60,0)
 K QTYHLD I $G(PSODIR("QTY"))]"" S QTYHLD=PSODIR("QTY") K PSODIR("QTY")
"RTN","PSODIR1",61,0)
 D:'$G(PSOQTY) QTY^PSOSIG(.PSODIR)
"RTN","PSODIR1",62,0)
 I '$G(SPEED),$G(QTYHLD),'$G(PSODIR("QTY")) S PSODIR("QTY")=QTYHLD
"RTN","PSODIR1",63,0)
 K QTYHLD K:'$G(PSODIR("QTY")) PSODIR("QTY")
"RTN","PSODIR1",64,0)
 I $G(SPEED),$G(PSODIR("QTY"))']"" S PSODIR("QTY")=$P(^PSRX(PSORENW("OIRXN"),0),"^",7)
"RTN","PSODIR1",65,0)
 S:$G(PSODIR("QTY"))]"" DIR("B")=PSODIR("QTY")
"RTN","PSODIR1",66,0)
 D DIR
"RTN","PSODIR1",67,0)
 ;/BLB/ PSO*7.0*505 ;MODIFIED QTY CHECK TO ALLOW LEADING ZEROS
"RTN","PSODIR1",68,0)
 I Y[".",$P(Y,".")<1 S Y="0"_"."_$P(Y,".",2)
"RTN","PSODIR1",69,0)
 G:PSODIR("DFLG")!PSODIR("FIELD") QTYX
"RTN","PSODIR1",70,0)
 I $G(Y),$G(PSODRUG("MAXDOSE"))]"",$G(PSODIR("DAYS SUPPLY")),(Y/+PSODIR("DAYS SUPPLY")>PSODRUG("MAXDOSE")) D  G:$G(PSODIR("DFLG")) QTYX  G QTYA
"RTN","PSODIR1",71,0)
 .W !,$C(7)," Greater than Maximum dose of "_PSODRUG("MAXDOSE")_" per day" D DAYSEN
"RTN","PSODIR1",72,0)
 I $G(PSOFDR),$P($G(OR0),"^",24),$G(PSODIR("QTY")),+Y>$G(PSODIR("QTY")) D  G QTYX
"RTN","PSODIR1",73,0)
 .W !!,"Digitally Signed Order - QTY cannot be increased",!
"RTN","PSODIR1",74,0)
 .N DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR W !
"RTN","PSODIR1",75,0)
 S PSODIR("QTY")=Y
"RTN","PSODIR1",76,0)
QTYX K X,Y
"RTN","PSODIR1",77,0)
 Q
"RTN","PSODIR1",78,0)
COPIES(PSODIR) ;
"RTN","PSODIR1",79,0)
 K DIR,DIC
"RTN","PSODIR1",80,0)
 S DIR(0)="52,10.6"
"RTN","PSODIR1",81,0)
 S DIR("B")=$S($G(PSODIR("COPIES"))]"":PSODIR("COPIES"),1:1)
"RTN","PSODIR1",82,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") COPIESX
"RTN","PSODIR1",83,0)
 S PSODIR("COPIES")=Y
"RTN","PSODIR1",84,0)
COPIESX K X,Y
"RTN","PSODIR1",85,0)
 Q
"RTN","PSODIR1",86,0)
DAYS(PSODIR) ;
"RTN","PSODIR1",87,0)
DAYSEN K DIR,DIC N PSORFLS
"RTN","PSODIR1",88,0)
 ;PSO*7*266
"RTN","PSODIR1",89,0)
 N S2DS,MXDAYSUP,DFDAYSUP,CSDRUG,NEWTOTDS S S2DS=0
"RTN","PSODIR1",90,0)
 S MXDAYSUP=90,CSDRUG=0
"RTN","PSODIR1",91,0)
 I $D(PSODRUG("IEN")) D
"RTN","PSODIR1",92,0)
 .S MXDAYSUP=$$MXDAYSUP^PSSUTIL1(PSODRUG("IEN"))
"RTN","PSODIR1",93,0)
 .S S2DS=$$CSDS^PSOSIGDS(PSODRUG("IEN")) I S2DS,$P($G(PSODIR("PTST NODE")),"^",3)>29 S S2DS=30
"RTN","PSODIR1",94,0)
 .S PSORFLS=$S($G(PSODIR("# OF REFILLS")):PSODIR("# OF REFILLS"),1:$P($G(PSODIR("RX0")),"^",9))
"RTN","PSODIR1",95,0)
 .I '$D(PSODRUG("DEA")) S PSODRUG("DEA")=$$GET1^DIQ(50,PSODRUG("IEN"),3,"")
"RTN","PSODIR1",96,0)
 .I (PSODRUG("DEA")["2")!(PSODRUG("DEA")["3")!(PSODRUG("DEA")["4")!(PSODRUG("DEA")["5") S CSDRUG=1
"RTN","PSODIR1",97,0)
 S DIR(0)="N^1:"_$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:MXDAYSUP)
"RTN","PSODIR1",98,0)
 S DFDAYSUP=$S($D(CLOZPAT)&('$G(PSODIR("DAYS SUPPLY"))):7,$G(PSODIR("DAYS SUPPLY"))]"":PSODIR("DAYS SUPPLY"),S2DS>1:S2DS,$P($G(PSODIR("PTST NODE")),"^",3):$P(PSODIR("PTST NODE"),"^",3),1:30)
"RTN","PSODIR1",99,0)
 I DFDAYSUP>MXDAYSUP D  S DFDAYSUP=MXDAYSUP
"RTN","PSODIR1",100,0)
 .W:$G(PSODIR("DAYS SUPPLY")) !!,$C(7),"Invalid DAYS SUPPLY value (",DFDAYSUP,"), resetting it to ",MXDAYSUP," (maximum allowed).",!
"RTN","PSODIR1",101,0)
 S DIR("B")=DFDAYSUP
"RTN","PSODIR1",102,0)
 S DIR("A")="DAYS SUPPLY",DIR("?")="Enter a whole number between 1 and "_$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:MXDAYSUP)
"RTN","PSODIR1",103,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") DAYSX
"RTN","PSODIR1",104,0)
 I $G(Y),$G(PSODRUG("MAXDOSE"))]"",$G(PSODIR("QTY"))]"",(+PSODIR("QTY")/Y>PSODRUG("MAXDOSE")) D  G DAYSEN
"RTN","PSODIR1",105,0)
 .W !,$C(7)," Greater than Maximum dose of "_PSODRUG("MAXDOSE")_" per day"
"RTN","PSODIR1",106,0)
 I $G(PSOFDR),$P($G(OR0),"^",24),$G(PSODIR("DAYS SUPPLY")),+Y>$G(PSODIR("DAYS SUPPLY")) D  G DAYSX
"RTN","PSODIR1",107,0)
 .W !!,"Digitally Signed Order - Days Supply cannot be increased",!
"RTN","PSODIR1",108,0)
 .N DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR W !
"RTN","PSODIR1",109,0)
 I $G(PSONEW("FLD"))=8,PSODIR("DAYS SUPPLY")=Y Q
"RTN","PSODIR1",110,0)
 S:$G(PSODIR("DAYS SUPPLY")) PSODIR("OLD DAYS SUPPLY")=PSODIR("DAYS SUPPLY")
"RTN","PSODIR1",111,0)
 S PSODIR("DAYS SUPPLY")=Y
"RTN","PSODIR1",112,0)
 ; Checking the # Of Refills field value after the Days Supply field was edited
"RTN","PSODIR1",113,0)
 I $D(PSODRUG("IEN")),$G(Y) D
"RTN","PSODIR1",114,0)
 .N PTST
"RTN","PSODIR1",115,0)
 .S PTST=+$G(PSODIR("PATIENT STATUS")) S:'PTST PTST=$P($G(PSODIR("RX0")),"^",3)
"RTN","PSODIR1",116,0)
 .I 'PTST,$G(PSODFN) S PTST=+$G(^PS(55,PSODFN,"PS"))
"RTN","PSODIR1",117,0)
 .I PSORFLS>$$MAXNUMRF^PSOUTIL(PSODRUG("IEN"),Y,PTST,.CLOZPAT) D
"RTN","PSODIR1",118,0)
 .. W !,$C(7),"Invalid number of REFILLS for amount of DAYS SUPPLY.",!,"REFILL EDIT FORCED." D REFILL(.PSODIR)
"RTN","PSODIR1",119,0)
 .. S PSODIR("FLD",9)=PSODIR("# OF REFILLS")
"RTN","PSODIR1",120,0)
 S:$G(CLOZPAT)=0 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",121,0)
 D:$G(CLOZPAT)=2
"RTN","PSODIR1",122,0)
 .S:PSODIR("DAYS SUPPLY")=28 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",123,0)
 .S:PSODIR("DAYS SUPPLY")=14 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=1
"RTN","PSODIR1",124,0)
 .S:PSODIR("DAYS SUPPLY")=7 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=3
"RTN","PSODIR1",125,0)
 D:$G(CLOZPAT)=1
"RTN","PSODIR1",126,0)
 .S:PSODIR("DAYS SUPPLY")=14 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",127,0)
 .S:PSODIR("DAYS SUPPLY")=7 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=1
"RTN","PSODIR1",128,0)
 K QTYHLD S:$G(PSODIR("QTY")) QTYHLD=PSODIR("QTY") D QTY^PSOSIG(.PSODIR)
"RTN","PSODIR1",129,0)
 I $G(QTYHLD),'$G(PSODIR("QTY")) S PSODIR("QTY")=QTYHLD
"RTN","PSODIR1",130,0)
 K QTYHLD K:'$G(PSODIR("QTY")) PSODIR("QTY")
"RTN","PSODIR1",131,0)
DAYSX K X,Y
"RTN","PSODIR1",132,0)
 Q
"RTN","PSODIR1",133,0)
REFILL(PSODIR) ;
"RTN","PSODIR1",134,0)
 N PSODAYS,PSOX
"RTN","PSODIR1",135,0)
 S PSODAYS=+$G(PSODIR("DAYS SUPPLY"))
"RTN","PSODIR1",136,0)
 ;Recalculating RFTT if it doesn't exist
"RTN","PSODIR1",137,0)
 I '$G(PSONEW) D
"RTN","PSODIR1",138,0)
 .N I I '$G(RFTT),$G(PSORXED("IRXN")) F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFTT=$G(RFTT)+1
"RTN","PSODIR1",139,0)
 ;
"RTN","PSODIR1",140,0)
 I $G(PSODIR("PTST NODE"))="" D
"RTN","PSODIR1",141,0)
 .N X,Y
"RTN","PSODIR1",142,0)
 .S X=$G(PSODIR("PATIENT STATUS")) S:'X X=$P(RX0,"^",3)
"RTN","PSODIR1",143,0)
 .S DIC=53,DIC(0)="QXZ" D ^DIC K DIC
"RTN","PSODIR1",144,0)
 .S:+Y PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",145,0)
 .S:'$G(PSODIR("PATIENT STATUS")) PSODIR("PATIENT STATUS")=+Y
"RTN","PSODIR1",146,0)
 S $P(PSODIR("PTST NODE"),"^",4)=+$P($G(PSODIR("PTST NODE")),"^",4)
"RTN","PSODIR1",147,0)
 I $G(OR0) G REFOR
"RTN","PSODIR1",148,0)
 K DIR,DIC,PSOX
"RTN","PSODIR1",149,0)
 ; Controlled Substance
"RTN","PSODIR1",150,0)
 S PSODIR("CS")=0
"RTN","PSODIR1",151,0)
 I (PSODRUG("DEA")["2")!(PSODRUG("DEA")["3")!(PSODRUG("DEA")["4")!(PSODRUG("DEA")["5") D
"RTN","PSODIR1",152,0)
 . S $P(PSODIR("CS"),"^")=1 S:(PSODRUG("DEA")["2") $P(PSODIR("CS"),"^",2)=1
"RTN","PSODIR1",153,0)
 ;
"RTN","PSODIR1",154,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSODIR1",155,0)
 S PSOX=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),PSODAYS,+$G(PSODIR("PATIENT STATUS")),.CLOZPAT)
"RTN","PSODIR1",156,0)
 ;
"RTN","PSODIR1",157,0)
 I '$D(CLOZPAT) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) D  G REFILLX
"RTN","PSODIR1",158,0)
 .I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2)!'$O(^PSRX(+$G(PSODIR("IRXN")),1,0))!('$G(PSOLOKED)) D  Q
"RTN","PSODIR1",159,0)
 ..S VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["F":"this drug.",1:"Narcotics.") W !,VALMSG,!
"RTN","PSODIR1",160,0)
 ..S:$D(PSODIR("FIELD")) PSODIR("FIELD")=0 S PSODIR("# OF REFILLS")=0
"RTN","PSODIR1",161,0)
 ..Q
"RTN","PSODIR1",162,0)
 .;reset refills to the # given
"RTN","PSODIR1",163,0)
 .D RFRSET^PSODIR2
"RTN","PSODIR1",164,0)
 .Q
"RTN","PSODIR1",165,0)
 I $P($G(PSODIR("CS")),"^",2)=1 W !,"No refills allowed on Schedule 2 drugs...",! S:$D(PSODIR("FIELD")) PSODIR("FIELD")=0 S PSODIR("# OF REFILLS")=0 G REFILLX
"RTN","PSODIR1",166,0)
 ;PSO*7*266 make sure PSOX is greater than RFTT
"RTN","PSODIR1",167,0)
 S DIR(0)="N^"_$S($G(RFTT):RFTT,1:0)_":"_$S(+$G(RFTT)>PSOX:RFTT,1:PSOX),DIR("A")="# OF REFILLS"
"RTN","PSODIR1",168,0)
 ;PSO*7*340 Correct Default Value.
"RTN","PSODIR1",169,0)
 S DIR("B")=$S($G(COPY)&('$G(PSOTITRX)):$G(PSODIR("# OF REFILLS")),$G(PSODIR("N# REF"))]"":PSODIR("N# REF"),$G(PSODIR("# OF REFILLS"))]"":PSODIR("# OF REFILLS"),$G(RFTT)>PSOX:RFTT,1:PSOX)
"RTN","PSODIR1",170,0)
 S DIR("?",1)="Enter a whole number. The maximum number of refills is based on"
"RTN","PSODIR1",171,0)
 S DIR("?")="the DAYS SUPPLY and the PATIENT STATUS fields."
"RTN","PSODIR1",172,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") REFILLX
"RTN","PSODIR1",173,0)
 S (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=Y
"RTN","PSODIR1",174,0)
REFILLX S:$G(PSODIR("# OF REFILLS"))']"" PSODIR("# OF REFILLS")=$S($G(PSODIR("N# REF"))]"":PSODIR("N# REF"),1:PSOX)
"RTN","PSODIR1",175,0)
 K X,Y,PSOX,DEA,PSOCS,RFTT ;PSO*7*340 Kill RFTT
"RTN","PSODIR1",176,0)
 Q
"RTN","PSODIR1",177,0)
 ;OERR CALL
"RTN","PSODIR1",178,0)
REFOR ;
"RTN","PSODIR1",179,0)
 D REFOR^PSODIR3
"RTN","PSODIR1",180,0)
 G REFILLX
"RTN","PSODIR1",181,0)
 Q
"RTN","PSODIR1",182,0)
DIR ;
"RTN","PSODIR1",183,0)
 S (PSODIR("FIELD"),PSODIR("DFLG"))=0
"RTN","PSODIR1",184,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR1",185,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR1",186,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1!(Y="") S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR1",187,0)
 I $D(DIRUT)!($D(DIROUT)),$G(SPEED) S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR1",188,0)
 I X[U,$L(X)>1 D JUMP
"RTN","PSODIR1",189,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT
"RTN","PSODIR1",190,0)
 Q
"RTN","PSODIR1",191,0)
JUMP ;
"RTN","PSODIR1",192,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR1",193,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR1",194,0)
 I Y=-1 S PSODIR("FIELD")=PSODIR("FLD") G JUMPX
"RTN","PSODIR1",195,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR1",196,0)
 I $G(PSOREF1)=0 D JUMP^PSOREF1 G JUMPX
"RTN","PSODIR1",197,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR1",198,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR1",199,0)
JUMPX S X="^"_X
"RTN","PSODIR1",200,0)
 Q
"RTN","PSODIR1",201,0)
SIGOK ;review and decide on oerr sig
"RTN","PSODIR1",202,0)
 I '$O(SIG(0)) S SIGOK=0 Q
"RTN","PSODIR1",203,0)
 K SIGOK W !,"SIG: "
"RTN","PSODIR1",204,0)
 F SIG=0:0 S SIG=$O(SIG(SIG)) W SIG(SIG)_" ",!?5 Q:'$O(SIG(SIG))
"RTN","PSODIR1",205,0)
 K DIR,DIRUT,DUOUT,DTOUT S DIR("B")="YES",DIR(0)="Y",DIR("A")="Is this SIG correct" D ^DIR K DIR I $D(DIRUT) S PSODIR("DFLG")=1 K DIRUT,DUOUT,DTOUT Q
"RTN","PSODIR1",206,0)
 S SIGOK=Y I Y K PSODIR("SIG")
"RTN","PSODIR1",207,0)
 Q
"RTN","PSODIR1",208,0)
PSTPB ;
"RTN","PSODIR1",209,0)
 W !,"New orders entered through this option must have a Patient Status of 'NON-VA'!",!
"RTN","PSODIR1",210,0)
 Q
"VER")
8.0^22.2
"BLD",10944,6)
^459
**END**
**END**

