EMERGENCY Released PSO*7*565 SEQ #466
Extracted from mail message
**KIDS**:PSO*7.0*565^

**INSTALL NAME**
PSO*7.0*565
"BLD",11185,0)
PSO*7.0*565^OUTPATIENT PHARMACY^0^3190620^y
"BLD",11185,1,0)
^^34^34^3190620^
"BLD",11185,1,1,0)
This patch will address the following two issues:
"BLD",11185,1,2,0)
 
"BLD",11185,1,3,0)
INC6047771    - ERX not including info after patch PSO*7*551
"BLD",11185,1,4,0)
(d)INC6131517 - Recommendations for improvements to new eRx system
"BLD",11185,1,5,0)
(d)INC6087293 - Inbound eRx prescriptions not showing quantity, days supply
"BLD",11185,1,6,0)
                and refills under the
"BLD",11185,1,7,0)
    
"BLD",11185,1,8,0)
Defect Tracking System Ticket(s) & Overview:
"BLD",11185,1,9,0)
--------------------------------------------
"BLD",11185,1,10,0)
1. INC6047771    - ERX not including info after patch PSO*7*551
"BLD",11185,1,11,0)
   (d)INC6131517 - Recommendations for improvements to new eRx system
"BLD",11185,1,12,0)
   (d)INC6087293 - Inbound eRx prescriptions not showing quantity, days
"BLD",11185,1,13,0)
                   supply and refills under the
"BLD",11185,1,14,0)
 
"BLD",11185,1,15,0)
Problem: 
"BLD",11185,1,16,0)
--------
"BLD",11185,1,17,0)
VA Sierra Nevada Health Care System reported that after the installation of 
"BLD",11185,1,18,0)
the patch PSO*7*551 they noticed that some fields related to the eRx 
"BLD",11185,1,19,0)
prescription (Qty, Days Supply and Refills) were no longer being displayed
"BLD",11185,1,20,0)
when viewing the corresponding VistA Pending Order or Active Prescription. 
"BLD",11185,1,21,0)
It was confirmed that this issue was indeed caused by the patch PSO*7*551.
"BLD",11185,1,22,0)
   
"BLD",11185,1,23,0)
Resolution:
"BLD",11185,1,24,0)
-----------
"BLD",11185,1,25,0)
This patch will restore the functionality accidently removed by the patch
"BLD",11185,1,26,0)
PSO*7*551 by restoring the display of the fields Qty, Days Supply and 
"BLD",11185,1,27,0)
Refills from the original external prescription (eRx).
"BLD",11185,1,28,0)
      
"BLD",11185,1,29,0)
Technical Resolution:
"BLD",11185,1,30,0)
---------------------
"BLD",11185,1,31,0)
Changed the routine PSOERXU1 at line tag DERX1+95 to re-include the line 
"BLD",11185,1,32,0)
below that was removed by PSO*7*551:
"BLD",11185,1,33,0)
 
"BLD",11185,1,34,0)
   S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"BLD",11185,4,0)
^9.64PA^^
"BLD",11185,6.3)
1
"BLD",11185,"KRN",0)
^9.67PA^1.5^24
"BLD",11185,"KRN",.4,0)
.4
"BLD",11185,"KRN",.401,0)
.401
"BLD",11185,"KRN",.402,0)
.402
"BLD",11185,"KRN",.403,0)
.403
"BLD",11185,"KRN",.5,0)
.5
"BLD",11185,"KRN",.84,0)
.84
"BLD",11185,"KRN",1.5,0)
1.5
"BLD",11185,"KRN",1.6,0)
1.6
"BLD",11185,"KRN",1.61,0)
1.61
"BLD",11185,"KRN",1.62,0)
1.62
"BLD",11185,"KRN",3.6,0)
3.6
"BLD",11185,"KRN",3.8,0)
3.8
"BLD",11185,"KRN",9.2,0)
9.2
"BLD",11185,"KRN",9.8,0)
9.8
"BLD",11185,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11185,"KRN",9.8,"NM",1,0)
PSOERXU1^^0^B153595246
"BLD",11185,"KRN",9.8,"NM","B","PSOERXU1",1)

"BLD",11185,"KRN",19,0)
19
"BLD",11185,"KRN",19.1,0)
19.1
"BLD",11185,"KRN",101,0)
101
"BLD",11185,"KRN",409.61,0)
409.61
"BLD",11185,"KRN",771,0)
771
"BLD",11185,"KRN",779.2,0)
779.2
"BLD",11185,"KRN",870,0)
870
"BLD",11185,"KRN",8989.51,0)
8989.51
"BLD",11185,"KRN",8989.52,0)
8989.52
"BLD",11185,"KRN",8994,0)
8994
"BLD",11185,"KRN","B",.4,.4)

"BLD",11185,"KRN","B",.401,.401)

"BLD",11185,"KRN","B",.402,.402)

"BLD",11185,"KRN","B",.403,.403)

"BLD",11185,"KRN","B",.5,.5)

"BLD",11185,"KRN","B",.84,.84)

"BLD",11185,"KRN","B",1.5,1.5)

"BLD",11185,"KRN","B",1.6,1.6)

"BLD",11185,"KRN","B",1.61,1.61)

"BLD",11185,"KRN","B",1.62,1.62)

"BLD",11185,"KRN","B",3.6,3.6)

"BLD",11185,"KRN","B",3.8,3.8)

"BLD",11185,"KRN","B",9.2,9.2)

"BLD",11185,"KRN","B",9.8,9.8)

"BLD",11185,"KRN","B",19,19)

"BLD",11185,"KRN","B",19.1,19.1)

"BLD",11185,"KRN","B",101,101)

"BLD",11185,"KRN","B",409.61,409.61)

"BLD",11185,"KRN","B",771,771)

"BLD",11185,"KRN","B",779.2,779.2)

"BLD",11185,"KRN","B",870,870)

"BLD",11185,"KRN","B",8989.51,8989.51)

"BLD",11185,"KRN","B",8989.52,8989.52)

"BLD",11185,"KRN","B",8994,8994)

"BLD",11185,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11185,"QUES",0)
^9.62^^
"BLD",11185,"REQB",0)
^9.611^1^1
"BLD",11185,"REQB",1,0)
PSO*7.0*551^2
"BLD",11185,"REQB","B","PSO*7.0*551",1)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
565^3190620
"PKG",170,22,1,"PAH",1,1,0)
^^34^34^3190620
"PKG",170,22,1,"PAH",1,1,1,0)
This patch will address the following two issues:
"PKG",170,22,1,"PAH",1,1,2,0)
 
"PKG",170,22,1,"PAH",1,1,3,0)
INC6047771    - ERX not including info after patch PSO*7*551
"PKG",170,22,1,"PAH",1,1,4,0)
(d)INC6131517 - Recommendations for improvements to new eRx system
"PKG",170,22,1,"PAH",1,1,5,0)
(d)INC6087293 - Inbound eRx prescriptions not showing quantity, days supply
"PKG",170,22,1,"PAH",1,1,6,0)
                and refills under the
"PKG",170,22,1,"PAH",1,1,7,0)
    
"PKG",170,22,1,"PAH",1,1,8,0)
Defect Tracking System Ticket(s) & Overview:
"PKG",170,22,1,"PAH",1,1,9,0)
--------------------------------------------
"PKG",170,22,1,"PAH",1,1,10,0)
1. INC6047771    - ERX not including info after patch PSO*7*551
"PKG",170,22,1,"PAH",1,1,11,0)
   (d)INC6131517 - Recommendations for improvements to new eRx system
"PKG",170,22,1,"PAH",1,1,12,0)
   (d)INC6087293 - Inbound eRx prescriptions not showing quantity, days
"PKG",170,22,1,"PAH",1,1,13,0)
                   supply and refills under the
"PKG",170,22,1,"PAH",1,1,14,0)
 
"PKG",170,22,1,"PAH",1,1,15,0)
Problem: 
"PKG",170,22,1,"PAH",1,1,16,0)
--------
"PKG",170,22,1,"PAH",1,1,17,0)
VA Sierra Nevada Health Care System reported that after the installation of 
"PKG",170,22,1,"PAH",1,1,18,0)
the patch PSO*7*551 they noticed that some fields related to the eRx 
"PKG",170,22,1,"PAH",1,1,19,0)
prescription (Qty, Days Supply and Refills) were no longer being displayed
"PKG",170,22,1,"PAH",1,1,20,0)
when viewing the corresponding VistA Pending Order or Active Prescription. 
"PKG",170,22,1,"PAH",1,1,21,0)
It was confirmed that this issue was indeed caused by the patch PSO*7*551.
"PKG",170,22,1,"PAH",1,1,22,0)
   
"PKG",170,22,1,"PAH",1,1,23,0)
Resolution:
"PKG",170,22,1,"PAH",1,1,24,0)
-----------
"PKG",170,22,1,"PAH",1,1,25,0)
This patch will restore the functionality accidently removed by the patch
"PKG",170,22,1,"PAH",1,1,26,0)
PSO*7*551 by restoring the display of the fields Qty, Days Supply and 
"PKG",170,22,1,"PAH",1,1,27,0)
Refills from the original external prescription (eRx).
"PKG",170,22,1,"PAH",1,1,28,0)
      
"PKG",170,22,1,"PAH",1,1,29,0)
Technical Resolution:
"PKG",170,22,1,"PAH",1,1,30,0)
---------------------
"PKG",170,22,1,"PAH",1,1,31,0)
Changed the routine PSOERXU1 at line tag DERX1+95 to re-include the line 
"PKG",170,22,1,"PAH",1,1,32,0)
below that was removed by PSO*7*551:
"PKG",170,22,1,"PAH",1,1,33,0)
 
"PKG",170,22,1,"PAH",1,1,34,0)
   S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOERXU1")
0^1^B153595246^B152819795
"RTN","PSOERXU1",1,0)
PSOERXU1 ;ALB/BWF - eRx utilities ; 5/26/2017 9:57am
"RTN","PSOERXU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467,520,508,551,565**;DEC 1997;Build 1
"RTN","PSOERXU1",3,0)
 ;
"RTN","PSOERXU1",4,0)
 Q
"RTN","PSOERXU1",5,0)
 ; OR0 - OR0 FROM PENDING OUTPATIENT ORDERS OR BACKDOOR ORDERS
"RTN","PSOERXU1",6,0)
 ; OR0 can also be just the order number
"RTN","PSOERXU1",7,0)
CHKERX(OR0) ;
"RTN","PSOERXU1",8,0)
 N ORIEN,ERXIEN
"RTN","PSOERXU1",9,0)
 S ORIEN=$P(OR0,U) Q:'ORIEN 0
"RTN","PSOERXU1",10,0)
 I '$D(^PS(52.49,"ORN",ORIEN)) Q 0
"RTN","PSOERXU1",11,0)
 S ERXIEN=$O(^PS(52.49,"ORN",ORIEN,0))
"RTN","PSOERXU1",12,0)
 I 'ERXIEN Q 0
"RTN","PSOERXU1",13,0)
 Q ERXIEN
"RTN","PSOERXU1",14,0)
PROVPMT(ERXIEN) ;
"RTN","PSOERXU1",15,0)
 N ERXPHYS,ERXPHNM,ERXCON,DIR,Y
"RTN","PSOERXU1",16,0)
 S $P(LINE,"*",80)="" W !!,LINE
"RTN","PSOERXU1",17,0)
 W !!,"This prescription is an inbound electronic prescription (eRx).",!,"Please contact the original provider for approval to renew."
"RTN","PSOERXU1",18,0)
 S ERXPHYS=$$GET1^DIQ(52.49,ERXIEN,2.1,"I")
"RTN","PSOERXU1",19,0)
 S ERXPHNM=$$GET1^DIQ(52.48,ERXPHYS,.01,"E") W !,ERXPHNM
"RTN","PSOERXU1",20,0)
 I '$D(^PS(52.48,ERXPHYS,3,"C","TE")) W !!,"No telephone information on file for this provider." Q
"RTN","PSOERXU1",21,0)
 W !
"RTN","PSOERXU1",22,0)
 S ERXCON=0 F  S ERXCON=$O(^PS(52.48,ERXPHYS,3,"C","TE",ERXCON)) Q:'ERXCON  D
"RTN","PSOERXU1",23,0)
 .W !,"Telephone: "_$$GET1^DIQ(52.483,ERXCON_","_ERXPHYS_",",.01,"E")
"RTN","PSOERXU1",24,0)
 W !!,"Answering 'Yes' indicates you have contacted the prescribing physician"
"RTN","PSOERXU1",25,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Would you like to proceed with renewing this prescription" D ^DIR K DIR
"RTN","PSOERXU1",26,0)
 I Y=1 Q 1
"RTN","PSOERXU1",27,0)
 Q 0
"RTN","PSOERXU1",28,0)
 ; STORE IN ^TMP("PSOPO",$J,IEN,0)
"RTN","PSOERXU1",29,0)
DERX1(GL,PSOIEN,DFLG,IEN) ;
"RTN","PSOERXU1",30,0)
 N EDRG,ERXDAT,ESIG,COMM,SUBS,DFORM,DSTR,QQUAL,POTUC,QTY,DAYS,REFILL,PSOIENS,LINE,LINETXT,ADLINE,ADARY,ALOOP,COMMARY
"RTN","PSOERXU1",31,0)
 N ERXPAT,ERXPIEN,ERXPDOB,ERXPSSN,ERXPROV,ERXPRIEN,ERXPRDEA,ERXPRNPI,ERXPRSA1,ERXPRSA2,ERXPRCTY,ERXPRST,ERXPRZIP,I
"RTN","PSOERXU1",32,0)
 N PROVDAT,SIGARY,STHIS,STAT,ACBY,FOUND,ACDTTM,DRGARY,DLP,CTYSTZIP,ADLINE1,MTYPE,ERXDSUB
"RTN","PSOERXU1",33,0)
 Q:'PSOIEN
"RTN","PSOERXU1",34,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERXU1",35,0)
 D GETS^DIQ(52.49,PSOIENS,".04;.08;2.1;3.1;4.6;4.8;5.1;5.2;5.4;5.5;5.6;5.7;5.8;7;8;41;42;43","IE","ERXDAT")
"RTN","PSOERXU1",36,0)
 S DFLG=$G(DFLG,"")
"RTN","PSOERXU1",37,0)
 S EDRG=$G(ERXDAT(52.49,PSOIENS,3.1,"E"))
"RTN","PSOERXU1",38,0)
 S ESIG=$G(ERXDAT(52.49,PSOIENS,7,"E"))
"RTN","PSOERXU1",39,0)
 S COMM=$G(ERXDAT(52.49,PSOIENS,8,"E"))
"RTN","PSOERXU1",40,0)
 S SUBS=$G(ERXDAT(52.49,PSOIENS,5.8,"E"))
"RTN","PSOERXU1",41,0)
 S DFORM=$G(ERXDAT(52.49,PSOIENS,41,"E"))
"RTN","PSOERXU1",42,0)
 S DSTR=$G(ERXDAT(52.49,PSOIENS,43,"E"))
"RTN","PSOERXU1",43,0)
 S QQUAL=$G(ERXDAT(52.49,PSOIENS,5.2,"E"))
"RTN","PSOERXU1",44,0)
 S POTUC=$G(ERXDAT(52.49,PSOIENS,42,"E"))
"RTN","PSOERXU1",45,0)
 S QTY=$G(ERXDAT(52.49,PSOIENS,5.1,"E"))
"RTN","PSOERXU1",46,0)
 S DAYS=$G(ERXDAT(52.49,PSOIENS,5.5,"E"))
"RTN","PSOERXU1",47,0)
 S MTYPE=$G(ERXDAT(52.49,PSOIENS,.08,"I"))
"RTN","PSOERXU1",48,0)
 S REFILL=$G(ERXDAT(52.49,PSOIENS,5.6,"E"))
"RTN","PSOERXU1",49,0)
 I MTYPE="RE",REFILL>0 S REFILL=REFILL-1
"RTN","PSOERXU1",50,0)
 ;/BLB/ PSO*7.0*520 - BEGIN CHANGE
"RTN","PSOERXU1",51,0)
 I REFILL="" D
"RTN","PSOERXU1",52,0)
 .S REFILL=$G(ERXDAT(52.49,PSOIENS,5.7,"I"))
"RTN","PSOERXU1",53,0)
 ;/BLB/ - END CHANGE
"RTN","PSOERXU1",54,0)
 S ERXPAT=$G(ERXDAT(52.49,PSOIENS,.04,"E"))
"RTN","PSOERXU1",55,0)
 S ERXPIEN=$G(ERXDAT(52.49,PSOIENS,.04,"I"))
"RTN","PSOERXU1",56,0)
 S ERXPDOB=$$GET1^DIQ(52.46,ERXPIEN,.08,"E")
"RTN","PSOERXU1",57,0)
 S ERXPSSN=$$GET1^DIQ(52.46,ERXPIEN,1.4,"E")
"RTN","PSOERXU1",58,0)
 S ERXPROV=$G(ERXDAT(52.49,PSOIENS,2.1,"E"))
"RTN","PSOERXU1",59,0)
 S ERXPRIEN=$G(ERXDAT(52.49,PSOIENS,2.1,"I"))
"RTN","PSOERXU1",60,0)
 D GETS^DIQ(52.48,ERXPRIEN_",","1.5;1.6;4.1;4.2;4.3;4.4;4.5","E","PROVDAT")
"RTN","PSOERXU1",61,0)
 S ERXPRDEA=$G(PROVDAT(52.48,ERXPRIEN_",",1.6,"E"))
"RTN","PSOERXU1",62,0)
 S ERXPRNPI=$G(PROVDAT(52.48,ERXPRIEN_",",1.5,"E"))
"RTN","PSOERXU1",63,0)
 S ERXPRSA1=$G(PROVDAT(52.48,ERXPRIEN_",",4.1,"E"))
"RTN","PSOERXU1",64,0)
 S ERXPRSA2=$G(PROVDAT(52.48,ERXPRIEN_",",4.2,"E"))
"RTN","PSOERXU1",65,0)
 S ERXPRCTY=$G(PROVDAT(52.48,ERXPRIEN_",",4.3,"E"))
"RTN","PSOERXU1",66,0)
 S ERXPRST=$G(PROVDAT(52.48,ERXPRIEN_",",4.4,"E"))
"RTN","PSOERXU1",67,0)
 S ERXPRZIP=$G(PROVDAT(52.48,ERXPRIEN_",",4.5,"E"))
"RTN","PSOERXU1",68,0)
 D TXT2ARY^PSOERXD1(.SIGARY,ESIG,,69)
"RTN","PSOERXU1",69,0)
 D TXT2ARY^PSOERXD1(.COMMARY,COMM,,65)
"RTN","PSOERXU1",70,0)
 S STHIS=99999,FOUND=0
"RTN","PSOERXU1",71,0)
 F  S STHIS=$O(^PS(52.49,PSOIEN,19,STHIS),-1) Q:'STHIS!(FOUND)  D
"RTN","PSOERXU1",72,0)
 .S STAT=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.02,"I")
"RTN","PSOERXU1",73,0)
 .I $$GET1^DIQ(52.45,STAT,.01,"E")'="PR" Q
"RTN","PSOERXU1",74,0)
 .S ACDTTM=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.01,"E")
"RTN","PSOERXU1",75,0)
 .S ACBY=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.03,"E"),FOUND=1
"RTN","PSOERXU1",76,0)
 I $L($G(ACBY)) S IEN=IEN+1,@GL@(IEN,0)="eRx Accepted By: "_ACBY_" ("_ACDTTM_")"
"RTN","PSOERXU1",77,0)
 S LINETXT=""
"RTN","PSOERXU1",78,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Patient: ",ERXPAT,1,55)
"RTN","PSOERXU1",79,0)
 D ADDITEM^PSOERX1A(.LINETXT,"SSN: ",ERXPSSN,57,15)
"RTN","PSOERXU1",80,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",81,0)
 S LINETXT=""
"RTN","PSOERXU1",82,0)
 I $L(ERXPAT)>42 D ADDITEM^PSOERX1A(.LINETXT,"             ",$E(ERXPAT,43,84),1,55)
"RTN","PSOERXU1",83,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",ERXPDOB,57,20)
"RTN","PSOERXU1",84,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",85,0)
 I $L(ERXPAT)>84 D
"RTN","PSOERXU1",86,0)
 .S IEN=IEN+1,@GL@(IEN,0)="             "_$E(ERXPAT,85,117)
"RTN","PSOERXU1",87,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",88,0)
 I $L(ERXPAT)>117 D
"RTN","PSOERXU1",89,0)
 .S IEN=IEN+1,@GL@(IEN,0)="             "_$E(ERXPAT,118,135)
"RTN","PSOERXU1",90,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",91,0)
 S LINETXT=""
"RTN","PSOERXU1",92,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Provider: ",$E(ERXPROV,1,55),1,55)
"RTN","PSOERXU1",93,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DEA: ",ERXPRDEA,57,20)
"RTN","PSOERXU1",94,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",95,0)
 I $L(ERXPROV)>55 D ADDITEM^PSOERX1A(.LINETXT,"              ",$E(ERXPROV,56,96),1,55)
"RTN","PSOERXU1",96,0)
 D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",ERXPRNPI,57,20)
"RTN","PSOERXU1",97,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",98,0)
 I $L(ERXPROV)>96 D ADDITEM^PSOERX1A(.LINETXT,"              ",$E(ERXPROV,97,135),1,55)
"RTN","PSOERXU1",99,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",100,0)
 ;/BLB/ PSO*7.0*520 - BEGIN CHANGE
"RTN","PSOERXU1",101,0)
 S ADLINE1=$S($L(ERXPRSA1):ERXPRSA1,1:"ADDRESS UNKNOWN ")
"RTN","PSOERXU1",102,0)
 S CTYSTZIP=$S($L(ERXPRCTY):ERXPRCTY_",",1:"")
"RTN","PSOERXU1",103,0)
 S CTYSTZIP=CTYSTZIP_$S($L(ERXPRST):ERXPRST_" ",1:"")
"RTN","PSOERXU1",104,0)
 S CTYSTZIP=" "_CTYSTZIP_$S($L(ERXPRZIP):ERXPRZIP,1:"")
"RTN","PSOERXU1",105,0)
 S IEN=IEN+1,@GL@(IEN,0)="Address: "_ADLINE1
"RTN","PSOERXU1",106,0)
 S IEN=IEN+1,@GL@(IEN,0)=CTYSTZIP
"RTN","PSOERXU1",107,0)
 I $L(ERXPRSA2) D
"RTN","PSOERXU1",108,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Address Line 2: "_ERXPRSA2
"RTN","PSOERXU1",109,0)
 ;/BLB/ - END CHANGE
"RTN","PSOERXU1",110,0)
 I $O(ADARY(0)) D
"RTN","PSOERXU1",111,0)
 .S ALOOP=1 F  S ALOOP=$O(ADARY(ALOOP)) Q:'ALOOP  D
"RTN","PSOERXU1",112,0)
 ..S IEN=IEN+1,@GL@(IEN,0)="         "_ADARY(ALOOP)
"RTN","PSOERXU1",113,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",114,0)
 D TXT2ARY^PSOERXD1(.DRGARY,EDRG,,70)
"RTN","PSOERXU1",115,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Drug: "_$G(DRGARY(1))
"RTN","PSOERXU1",116,0)
 S DLP=1
"RTN","PSOERXU1",117,0)
 F  S DLP=$O(DRGARY(DLP)) Q:'DLP  D
"RTN","PSOERXU1",118,0)
 .S IEN=IEN+1,@GL@(IEN,0)="          "_$G(DRGARY(DLP))
"RTN","PSOERXU1",119,0)
 S LINETXT=""
"RTN","PSOERXU1",120,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Qty: ",QTY,1,25)
"RTN","PSOERXU1",121,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Days Supply: ",DAYS,27,16)
"RTN","PSOERXU1",122,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Refills: ",REFILL,58,20)
"RTN","PSOERXU1",123,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",124,0)
 ;/BLB/ PSO*7.0*551 - BEGIN CHANGE - CHANGED TEXT FROM "DO NOT SUB" TO "SUBSTITUTIONS? :"
"RTN","PSOERXU1",125,0)
 S ERXDSUB=$$GET1^DIQ(52.49,PSOIEN,5.8,"I")
"RTN","PSOERXU1",126,0)
 S ERXDSUB=$S(ERXDSUB=1:"NO",ERXDSUB=0:"YES",1:"")
"RTN","PSOERXU1",127,0)
 S LINETXT=""
"RTN","PSOERXU1",128,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Substitutions? :",ERXDSUB,1,25)
"RTN","PSOERXU1",129,0)
 ;/BLB/ PSO*7.0*551 - END CHANGE
"RTN","PSOERXU1",130,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",131,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Sig: "
"RTN","PSOERXU1",132,0)
 S I=0 F  S I=$O(SIGARY(I)) Q:'I  D
"RTN","PSOERXU1",133,0)
 .I I=1 S @GL@(IEN,0)=@GL@(IEN,0)_SIGARY(I) Q
"RTN","PSOERXU1",134,0)
 .S IEN=IEN+1,@GL@(IEN,0)=$S(I>1:"         "_SIGARY(I),1:SIGARY(I))
"RTN","PSOERXU1",135,0)
 I '$L(ESIG) S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",136,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Notes: "
"RTN","PSOERXU1",137,0)
 S I=0 F  S I=$O(COMMARY(I)) Q:'I  D
"RTN","PSOERXU1",138,0)
 .I I=1 S @GL@(IEN,0)=@GL@(IEN,0)_$S(I>1:"              "_COMMARY(I),1:COMMARY(I)) Q
"RTN","PSOERXU1",139,0)
 .S IEN=IEN+1,@GL@(IEN,0)=$S(I>1:"              "_COMMARY(I),1:COMMARY(I))
"RTN","PSOERXU1",140,0)
 I '$L(COMM) S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",141,0)
 Q:DFLG=1
"RTN","PSOERXU1",142,0)
 S LINETXT=""
"RTN","PSOERXU1",143,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",144,0)
 S IEN=IEN+1,@GL@(IEN,0)="Drug Form: "_DFORM
"RTN","PSOERXU1",145,0)
 S IEN=IEN+1,@GL@(IEN,0)="Strength: "_DSTR
"RTN","PSOERXU1",146,0)
 S LINETXT=""
"RTN","PSOERXU1",147,0)
 ;/BLB/ PSO*7.0*551 BEGIN CHANGE - CORRECTING QTY QUAL TO CODE LIST QUAL
"RTN","PSOERXU1",148,0)
 S IEN=IEN+1,@GL@(IEN,0)="Code List Qualifier: "_QQUAL
"RTN","PSOERXU1",149,0)
 ;/BLB/ PSO*7.0*551 - END CHANGE
"RTN","PSOERXU1",150,0)
 S IEN=IEN+1,@GL@(IEN,0)="Potency Unit Code: "_POTUC
"RTN","PSOERXU1",151,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",152,0)
 ;/BLB/ PSO*7.0*551 - BEGIN CHANGE - ADDING SUBSTITUTION TEXT
"RTN","PSOERXU1",153,0)
 S ERXDSUB=$$GET1^DIQ(52.49,PSOIEN,5.8,"I")
"RTN","PSOERXU1",154,0)
 S ERXDSUB=$S(ERXDSUB=1:"NO",ERXDSUB=0:"YES",1:"")
"RTN","PSOERXU1",155,0)
 S IEN=IEN+1,@GL@(IEN,0)="Substitutions?: "_ERXDSUB
"RTN","PSOERXU1",156,0)
 ;/BLB/ PSO*7.0*551
"RTN","PSOERXU1",157,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",158,0)
 D DIAG(PSOIEN,.IEN,.GL)
"RTN","PSOERXU1",159,0)
 S $P(LINE,"-",80)=""
"RTN","PSOERXU1",160,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINE
"RTN","PSOERXU1",161,0)
 Q
"RTN","PSOERXU1",162,0)
 ; diagnosis information
"RTN","PSOERXU1",163,0)
DIAG(PSOIEN,LINE,GL) ;
"RTN","PSOERXU1",164,0)
 N DIAGIEN,DIAGDAT,DIAGSEQ,PDIAGQ,PDIAGV,SDIAGQ,SDIAGV,DIAGDAT,DIACIC,DRES,SDRES,PDIAGTXT,SDIAGTXT
"RTN","PSOERXU1",165,0)
 N SDRESL,SDRESDAT,DRESL,DRESDAT,PDIAGARY,SDIAGARY,PDFRST,SDFRST,PDLOOP,SDLOOP,DIENS
"RTN","PSOERXU1",166,0)
 S DIAGIEN=0 F  S DIAGIEN=$O(^PS(52.49,PSOIEN,9,DIAGIEN)) Q:'DIAGIEN  D
"RTN","PSOERXU1",167,0)
 .S DIENS=DIAGIEN_","_PSOIEN_"," K PDIAGARY,SDIAGARY,DIAGDAT
"RTN","PSOERXU1",168,0)
 .D GETS^DIQ(52.499,DIENS,".01:.06","IE","DIAGDAT")
"RTN","PSOERXU1",169,0)
 .S DIAGSEQ=$G(DIAGDAT(52.499,DIENS,.01,"E"))
"RTN","PSOERXU1",170,0)
 .S DIACIC=$G(DIAGDAT(52.499,DIENS,.02,"E"))
"RTN","PSOERXU1",171,0)
 .S PDIAGQ=$G(DIAGDAT(52.499,DIENS,.03,"E"))
"RTN","PSOERXU1",172,0)
 .S PDIAGV=$G(DIAGDAT(52.499,DIENS,.04,"E"))
"RTN","PSOERXU1",173,0)
 .I PDIAGQ["ICD" D
"RTN","PSOERXU1",174,0)
 ..K DRES,PDIAGARY
"RTN","PSOERXU1",175,0)
 ..D ICDDESC^ICDXCODE(PDIAGQ,PDIAGV,,.DRES)
"RTN","PSOERXU1",176,0)
 ..I '$O(DRES(0)) D TXT2ARY^PSOERXD1(.PDIAGARY,"Primary Dx:   ("_PDIAGQ_" - "_PDIAGV_")"," ",78) Q
"RTN","PSOERXU1",177,0)
 ..S PDIAGTXT="Primary Dx:   ("_PDIAGQ_" "_PDIAGV_") "
"RTN","PSOERXU1",178,0)
 ..S DRESL=0 F  S DRESL=$O(DRES(DRESL)) Q:'DRESL  D
"RTN","PSOERXU1",179,0)
 ...S DRESDAT=$G(DRES(DRESL)) Q:DRESDAT=""
"RTN","PSOERXU1",180,0)
 ...S PDIAGTXT=$G(PDIAGTXT)_" "_DRESDAT
"RTN","PSOERXU1",181,0)
 ..D TXT2ARY^PSOERXD1(.PDIAGARY,PDIAGTXT," ",78)
"RTN","PSOERXU1",182,0)
 .S SDIAGQ=$G(DIAGDAT(52.499,DIENS,.05,"E"))
"RTN","PSOERXU1",183,0)
 .S SDIAGV=$G(DIAGDAT(52.499,DIENS,.06,"E"))
"RTN","PSOERXU1",184,0)
 .I SDIAGQ["ICD" D
"RTN","PSOERXU1",185,0)
 ..K SDRES,SDIAGARY
"RTN","PSOERXU1",186,0)
 ..D ICDDESC^ICDXCODE(SDIAGQ,SDIAGV,,.SDRES)
"RTN","PSOERXU1",187,0)
 ..I '$O(DRES(0)) D TXT2ARY^PSOERXD1(.SDIAGARY,"Secondary Dx: ("_SDIAGQ_" - "_SDIAGV_")"," ",78) Q
"RTN","PSOERXU1",188,0)
 ..S SDIAGTXT="Secondary Dx: ("_SDIAGQ_" "_SDIAGV_") "
"RTN","PSOERXU1",189,0)
 ..S SDRESL=0 F  S SDRESL=$O(SDRES(SDRESL)) Q:'SDRESL  D
"RTN","PSOERXU1",190,0)
 ...S SDRESDAT=$G(SDRES(SDRESL)) Q:SDRESDAT=""
"RTN","PSOERXU1",191,0)
 ...S SDIAGTXT=$G(SDIAGTXT)_" "_SDRESDAT
"RTN","PSOERXU1",192,0)
 ..D TXT2ARY^PSOERXD1(.SDIAGARY,SDIAGTXT," ",78)
"RTN","PSOERXU1",193,0)
 .I '$D(PDIAGARY) D TXT2ARY^PSOERXD1(.PDIAGARY,"Primary Dx:   ("_PDIAGQ_" - "_PDIAGV_")"," ",78)
"RTN","PSOERXU1",194,0)
 .S PDFRST=$O(PDIAGARY(0))
"RTN","PSOERXU1",195,0)
 .S LINE=LINE+1
"RTN","PSOERXU1",196,0)
 .I $D(GL) D SETGL(LINE,PDIAGARY(PDFRST))
"RTN","PSOERXU1",197,0)
 .I '$D(GL) D SETLOC(LINE,$G(PDIAGARY(PDFRST)))
"RTN","PSOERXU1",198,0)
 .S PDLOOP=PDFRST F  S PDLOOP=$O(PDIAGARY(PDLOOP)) Q:'PDLOOP  D
"RTN","PSOERXU1",199,0)
 ..S LINE=LINE+1
"RTN","PSOERXU1",200,0)
 ..I $D(GL) D SETGL(LINE,"              "_$G(PDIAGARY(PDLOOP)))
"RTN","PSOERXU1",201,0)
 ..I '$D(GL) D SETLOC(LINE,"              "_$G(PDIAGARY(PDLOOP)))
"RTN","PSOERXU1",202,0)
 .S LINE=LINE+1
"RTN","PSOERXU1",203,0)
 .I $D(GL) D SETGL(LINE,"")
"RTN","PSOERXU1",204,0)
 .I '$D(GL) D SETLOC(LINE,"")
"RTN","PSOERXU1",205,0)
 .I '$D(SDIAGARY) D TXT2ARY^PSOERXD1(.SDIAGARY,"Secondary Dx: ("_SDIAGQ_" - "_SDIAGV_")"," ",78)
"RTN","PSOERXU1",206,0)
 .S SDFRST=$O(SDIAGARY(0))
"RTN","PSOERXU1",207,0)
 .S LINE=LINE+1
"RTN","PSOERXU1",208,0)
 .I $D(GL) D SETGL(LINE,$G(SDIAGARY(SDFRST)))
"RTN","PSOERXU1",209,0)
 .I '$D(GL) D SETLOC(LINE,$G(SDIAGARY(SDFRST)))
"RTN","PSOERXU1",210,0)
 .S SDLOOP=SDFRST F  S SDLOOP=$O(SDIAGARY(SDLOOP)) Q:'SDLOOP  D
"RTN","PSOERXU1",211,0)
 ..S LINE=LINE+1
"RTN","PSOERXU1",212,0)
 ..I $D(GL) D SETGL(LINE,"              "_$G(SDIAGARY(SDLOOP)))
"RTN","PSOERXU1",213,0)
 ..I '$D(GL) D SETLOC(LINE,"              "_$G(SDIAGARY(SDLOOP)))
"RTN","PSOERXU1",214,0)
 .I $O(^PS(52.49,PSOIEN,9,DIAGIEN)) D
"RTN","PSOERXU1",215,0)
 ..S LINE=LINE+1
"RTN","PSOERXU1",216,0)
 ..I $D(GL) D SETGL(LINE,"")
"RTN","PSOERXU1",217,0)
 ..I '$D(GL) D SETLOC(LINE,"")
"RTN","PSOERXU1",218,0)
 Q
"RTN","PSOERXU1",219,0)
SETLOC(LINE,TEXT) ;
"RTN","PSOERXU1",220,0)
 D SET^VALM10(LINE,TEXT)
"RTN","PSOERXU1",221,0)
 Q
"RTN","PSOERXU1",222,0)
SETGL(IEN,TEXT) ;
"RTN","PSOERXU1",223,0)
 S @GL@(IEN,0)=TEXT
"RTN","PSOERXU1",224,0)
 Q
"RTN","PSOERXU1",225,0)
OPACCESS(OPTION,DUZ,ERXIEN) ;
"RTN","PSOERXU1",226,0)
 N MTYPE,EVAL,RESVAL,MSTAT,DELTA,RET,RESIEN,REQIEN
"RTN","PSOERXU1",227,0)
 S MTYPE=$$GET1^DIQ(52.49,PSOIEN,.08,"I")
"RTN","PSOERXU1",228,0)
 S MSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E")
"RTN","PSOERXU1",229,0)
 S RESVAL=$$GET1^DIQ(52.49,PSOIEN,52.1,"I")
"RTN","PSOERXU1",230,0)
 I MSTAT="RRE"!(MSTAT="RRN") Q 0
"RTN","PSOERXU1",231,0)
 I MTYPE="RE",((RESVAL="D")!(RESVAL="DNP"))!(RESVAL="A") Q 0
"RTN","PSOERXU1",232,0)
 I MTYPE="RE",(MSTAT="RXP")!(MSTAT="RXC") Q 0
"RTN","PSOERXU1",233,0)
 I MTYPE="RE"!(MTYPE="RR"),(MSTAT="CAN")!(MSTAT="RXD")!(MSTAT="RRP") Q 0
"RTN","PSOERXU1",234,0)
 I MTYPE="CA"!(MTYPE="CN")!(MTYPE="IE") Q 0
"RTN","PSOERXU1",235,0)
 I MTYPE="N",$$GET1^DIQ(52.49,PSOIEN,1,"E")="CAN" Q 0
"RTN","PSOERXU1",236,0)
 I OPTION="PSO ERX ACCEPT ERX",RESVAL="AWC",MTYPE="RE",(MSTAT="RXN"!(MSTAT="RXW")) D  Q RET
"RTN","PSOERXU1",237,0)
 .S RET=0 I ('$D(^XUSEC("PSDRPH",DUZ))),('$D(^XUSEC("PSO ERX ADV TECH",DUZ))) Q
"RTN","PSOERXU1",238,0)
 .I MSTAT="RXW" S RET=1 Q
"RTN","PSOERXU1",239,0)
 .S RESIEN=PSOIEN,REQIEN=$$GETREQ^PSOERXU2(PSOIEN)
"RTN","PSOERXU1",240,0)
 .D RRDELTA^PSOERXU2(.DELTA,REQIEN,RESIEN)
"RTN","PSOERXU1",241,0)
 .I $D(DELTA(52.49,"EXTERNAL PROVIDER")) S RET=1
"RTN","PSOERXU1",242,0)
 ; block all but accept erx on eRx's in RXW status
"RTN","PSOERXU1",243,0)
 I OPTION'="PSO ERX ACCEPT ERX",MSTAT="RXW" Q 0
"RTN","PSOERXU1",244,0)
 I OPTION="PSO ERX REJECT"!(OPTION="PSO ERX REMOVE")!(OPTION="PSO ERX HOLD")!(OPTION="PSO ERX UNHOLD"),MSTAT="RXN" Q 0
"RTN","PSOERXU1",245,0)
 I OPTION="PSO ERX ACCEPT ERX",('$D(^XUSEC("PSDRPH",DUZ))),('$D(^XUSEC("PSO ERX ADV TECH",DUZ))) Q 0
"RTN","PSOERXU1",246,0)
 I OPTION="PSO ERX ACCEPT VALIDATION",($D(^XUSEC("PSO ERX TECH",DUZ))!($D(^XUSEC("PSO ERX VIEW",DUZ)))) Q 0
"RTN","PSOERXU1",247,0)
 I OPTION="PSO ERX REJECT",($D(^XUSEC("PSO ERX VIEW",DUZ))) Q 0
"RTN","PSOERXU1",248,0)
 I OPTION="PSO ERX REMOVE",($D(^XUSEC("PSO ERX VIEW",DUZ))) Q 0
"RTN","PSOERXU1",249,0)
 ; UNREMOVE NEEDS TO BE ADDED IF WE ADD THE OPTION
"RTN","PSOERXU1",250,0)
 I OPTION="PSO ERX VALIDATE PATIENT",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",251,0)
 I OPTION="PSO ERX VALIDATE PROVIDER",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",252,0)
 I OPTION="PSO ERX VALIDATE DRUG",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",253,0)
 I OPTION="PSO ERX HOLD",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",254,0)
 I OPTION="PSO ERX UNHOLD",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",255,0)
 Q 1
"RTN","PSOERXU1",256,0)
 ; update the status of an eRx
"RTN","PSOERXU1",257,0)
 ; PSOIEN - ien for file 52.49 (required)
"RTN","PSOERXU1",258,0)
 ; STAT - The status value to change the eRx to (required)
"RTN","PSOERXU1",259,0)
 ; SCOMM - status comments (optional)
"RTN","PSOERXU1",260,0)
UPDSTAT(PSOIEN,STAT,SCOMM) ;
"RTN","PSOERXU1",261,0)
 N DIE,NSTAT,DA,DR
"RTN","PSOERXU1",262,0)
 Q:'PSOIEN!(STAT="")
"RTN","PSOERXU1",263,0)
 Q:'$D(^PS(52.45,"C","ERX",STAT))
"RTN","PSOERXU1",264,0)
 S NSTAT=$O(^PS(52.45,"C","ERX",STAT,0))
"RTN","PSOERXU1",265,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="1///"_NSTAT D ^DIE
"RTN","PSOERXU1",266,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.01)=$$NOW^XLFDT
"RTN","PSOERXU1",267,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.02)=NSTAT
"RTN","PSOERXU1",268,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.03)=$G(DUZ)
"RTN","PSOERXU1",269,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",1)=$G(SCOMM)
"RTN","PSOERXU1",270,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",271,0)
 Q
"RTN","PSOERXU1",272,0)
ERRSEQ(EIEN) ;
"RTN","PSOERXU1",273,0)
 N SEQ
"RTN","PSOERXU1",274,0)
 I '$O(^PS(52.49,EIEN,100,0)) S SEQ=1
"RTN","PSOERXU1",275,0)
 I '$G(SEQ) S SEQ=$O(^PS(52.49,EIEN,100,999999),-1)+1
"RTN","PSOERXU1",276,0)
 Q SEQ
"RTN","PSOERXU1",277,0)
 ;
"RTN","PSOERXU1",278,0)
 ; IENS - ien of the erx holding queue entry
"RTN","PSOERXU1",279,0)
 ;  SEQ - sequence number of the error
"RTN","PSOERXU1",280,0)
 ; TYPE - type (d-drug, pr-provider, pa-patient, a-allergy, o-order check, t-transfer)
"RTN","PSOERXU1",281,0)
 ;  SRC - v - vista, e - erx processing hub
"RTN","PSOERXU1",282,0)
 ;  TXT - error text
"RTN","PSOERXU1",283,0)
FILERR(IENS,SEQ,TYPE,SRC,TXT) ;
"RTN","PSOERXU1",284,0)
 N FDA
"RTN","PSOERXU1",285,0)
 S FDA(52.49101,"+1,"_IENS,.01)=SEQ
"RTN","PSOERXU1",286,0)
 S FDA(52.49101,"+1,"_IENS,.02)=TYPE
"RTN","PSOERXU1",287,0)
 S FDA(52.49101,"+1,"_IENS,.03)=SRC
"RTN","PSOERXU1",288,0)
 ; all new errors are set to pending
"RTN","PSOERXU1",289,0)
 S FDA(52.49101,"+1,"_IENS,.04)="P"
"RTN","PSOERXU1",290,0)
 S FDA(52.49101,"+1,"_IENS,1)=TXT
"RTN","PSOERXU1",291,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",292,0)
 ; now set the eRx entry status to error
"RTN","PSOERXU1",293,0)
 ;S FDA(52.49,IENS,1)=$O(^PS(52.45,"C","ERX","E",0)) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",294,0)
 Q
"RTN","PSOERXU1",295,0)
MSGDIR(MSG) ;
"RTN","PSOERXU1",296,0)
 N DIR,MLOOP,MTXT
"RTN","PSOERXU1",297,0)
 S VALMBCK="R"
"RTN","PSOERXU1",298,0)
 D FULL^VALM1
"RTN","PSOERXU1",299,0)
 W !!,"Errors encountered during processing:",!
"RTN","PSOERXU1",300,0)
 S MLOOP=0 F  S MLOOP=$O(MSG(MLOOP)) Q:'MLOOP  D
"RTN","PSOERXU1",301,0)
 .S MTXT=$G(MSG(MLOOP)) W !,MLOOP_".) ",MTXT
"RTN","PSOERXU1",302,0)
 W !!,"Cannot process eRx.",!
"RTN","PSOERXU1",303,0)
 S DIR(0)="E" D ^DIR
"RTN","PSOERXU1",304,0)
 Q
"RTN","PSOERXU1",305,0)
 ; provider change screen on refill response
"RTN","PSOERXU1",306,0)
CHPRCHG(ERXIEN) ;
"RTN","PSOERXU1",307,0)
 N REQIEN,RESIEN,DELTA,MTYPE,RESVAL,MSTAT
"RTN","PSOERXU1",308,0)
 S MTYPE=$$GET1^DIQ(52.49,ERXIEN,.08,"I")
"RTN","PSOERXU1",309,0)
 S MSTAT=$$GET1^DIQ(52.49,ERXIEN,1,"E")
"RTN","PSOERXU1",310,0)
 S RESVAL=$$GET1^DIQ(52.49,ERXIEN,52.1,"I")
"RTN","PSOERXU1",311,0)
 I MTYPE="RE",((RESVAL="D")!(RESVAL="DNP")) Q 0
"RTN","PSOERXU1",312,0)
 I MTYPE="RR"!(MTYPE="CA")!(MTYPE="CN")!(MTYPE="IE") Q 0
"RTN","PSOERXU1",313,0)
 I MTYPE'="RE" Q 1
"RTN","PSOERXU1",314,0)
 I MTYPE="RE",MSTAT="RXW" Q 1
"RTN","PSOERXU1",315,0)
 I RESVAL'="AWC",MTYPE="RE",",RXP,RXC,RXD,"[MSTAT Q 0
"RTN","PSOERXU1",316,0)
 I MTYPE="RE",($$GET1^DIQ(52.49,ERXIEN,52.1,"I")'["A") Q 0
"RTN","PSOERXU1",317,0)
 S RESIEN=ERXIEN,REQIEN=$$GETREQ^PSOERXU2(ERXIEN)
"RTN","PSOERXU1",318,0)
 D RRDELTA^PSOERXU2(.DELTA,REQIEN,RESIEN) Q:'$D(DELTA) 0
"RTN","PSOERXU1",319,0)
 I $D(DELTA(52.49,"EXTERNAL PROVIDER")) Q 1
"RTN","PSOERXU1",320,0)
 Q 0
"RTN","PSOERXU1",321,0)
 ;/BLB/ PSO*7.0*520 -BEGIN CHANGE- ALLERGY INFO
"RTN","PSOERXU1",322,0)
ALG(LINE) ;
"RTN","PSOERXU1",323,0)
 N ALGINFO,ALGLINE,DFN,IEN,X,LDAT,GMRAL,PSONOAL
"RTN","PSOERXU1",324,0)
 S ALGLINE=""
"RTN","PSOERXU1",325,0)
 S DFN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERXU1",326,0)
 D EN1^GMRADPT
"RTN","PSOERXU1",327,0)
 S IEN=1
"RTN","PSOERXU1",328,0)
 I 'GMRAL D
"RTN","PSOERXU1",329,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Allergies: "_$S(GMRAL=0:"NKA",1:"")
"RTN","PSOERXU1",330,0)
 .I GMRAL'=0 S PSONOAL="" D ALLERGY^PSOORUT2 I PSONOAL'="" S ^TMP("PSOPI",$J,IEN,0)="Allergies: "_PSONOAL K PSONOAL
"RTN","PSOERXU1",331,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOERXU1",332,0)
 .D REMOTE^PSOORUT2
"RTN","PSOERXU1",333,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Adverse Reactions:"
"RTN","PSOERXU1",334,0)
 D:$G(GMRAL) ^PSOORUT3
"RTN","PSOERXU1",335,0)
 S LINE=LINE+1
"RTN","PSOERXU1",336,0)
 S X=0 F  S X=$O(^TMP("PSOPI",$J,X)) Q:'X  D
"RTN","PSOERXU1",337,0)
 .S LDAT=$G(^TMP("PSOPI",$J,X,0))
"RTN","PSOERXU1",338,0)
 .S LINE=LINE+1
"RTN","PSOERXU1",339,0)
 .D SET^VALM10(LINE,LDAT)
"RTN","PSOERXU1",340,0)
 K ^TMP("PSOPI",$J)
"RTN","PSOERXU1",341,0)
 Q
"RTN","PSOERXU1",342,0)
 ;/BLB/ - END CHANGE
"VER")
8.0^22.2
"BLD",11185,6)
^466
**END**
**END**

