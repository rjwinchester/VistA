Released PSO*7*548 SEQ #461
Extracted from mail message
**KIDS**:PSO*7.0*548^

**INSTALL NAME**
PSO*7.0*548
"BLD",11273,0)
PSO*7.0*548^OUTPATIENT PHARMACY^0^3181114^y
"BLD",11273,1,0)
^^4^4^3181114^
"BLD",11273,1,1,0)
When finishing a non-controlled drug order immediately after finishing a
"BLD",11273,1,2,0)
renewal of a controlled drug, an incorrect expiration date occurs. The
"BLD",11273,1,3,0)
non-controlled drugs are finished with the expiration date of the
"BLD",11273,1,4,0)
controlled drug.
"BLD",11273,4,0)
^9.64PA^^
"BLD",11273,6.3)
1
"BLD",11273,"ABPKG")
n
"BLD",11273,"KRN",0)
^9.67PA^1.61^23
"BLD",11273,"KRN",.4,0)
.4
"BLD",11273,"KRN",.401,0)
.401
"BLD",11273,"KRN",.402,0)
.402
"BLD",11273,"KRN",.403,0)
.403
"BLD",11273,"KRN",.5,0)
.5
"BLD",11273,"KRN",.84,0)
.84
"BLD",11273,"KRN",1.6,0)
1.6
"BLD",11273,"KRN",1.61,0)
1.61
"BLD",11273,"KRN",1.62,0)
1.62
"BLD",11273,"KRN",3.6,0)
3.6
"BLD",11273,"KRN",3.8,0)
3.8
"BLD",11273,"KRN",9.2,0)
9.2
"BLD",11273,"KRN",9.8,0)
9.8
"BLD",11273,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11273,"KRN",9.8,"NM",1,0)
PSORENW1^^0^B63062494
"BLD",11273,"KRN",9.8,"NM","B","PSORENW1",1)

"BLD",11273,"KRN",19,0)
19
"BLD",11273,"KRN",19.1,0)
19.1
"BLD",11273,"KRN",101,0)
101
"BLD",11273,"KRN",409.61,0)
409.61
"BLD",11273,"KRN",771,0)
771
"BLD",11273,"KRN",779.2,0)
779.2
"BLD",11273,"KRN",870,0)
870
"BLD",11273,"KRN",8989.51,0)
8989.51
"BLD",11273,"KRN",8989.52,0)
8989.52
"BLD",11273,"KRN",8994,0)
8994
"BLD",11273,"KRN","B",.4,.4)

"BLD",11273,"KRN","B",.401,.401)

"BLD",11273,"KRN","B",.402,.402)

"BLD",11273,"KRN","B",.403,.403)

"BLD",11273,"KRN","B",.5,.5)

"BLD",11273,"KRN","B",.84,.84)

"BLD",11273,"KRN","B",1.6,1.6)

"BLD",11273,"KRN","B",1.61,1.61)

"BLD",11273,"KRN","B",1.62,1.62)

"BLD",11273,"KRN","B",3.6,3.6)

"BLD",11273,"KRN","B",3.8,3.8)

"BLD",11273,"KRN","B",9.2,9.2)

"BLD",11273,"KRN","B",9.8,9.8)

"BLD",11273,"KRN","B",19,19)

"BLD",11273,"KRN","B",19.1,19.1)

"BLD",11273,"KRN","B",101,101)

"BLD",11273,"KRN","B",409.61,409.61)

"BLD",11273,"KRN","B",771,771)

"BLD",11273,"KRN","B",779.2,779.2)

"BLD",11273,"KRN","B",870,870)

"BLD",11273,"KRN","B",8989.51,8989.51)

"BLD",11273,"KRN","B",8989.52,8989.52)

"BLD",11273,"KRN","B",8994,8994)

"BLD",11273,"QUES",0)
^9.62^^
"BLD",11273,"REQB",0)
^9.611^1^1
"BLD",11273,"REQB",1,0)
PSO*7.0*444^2
"BLD",11273,"REQB","B","PSO*7.0*444",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
548^3181114
"PKG",206,22,1,"PAH",1,1,0)
^^4^4^3181114
"PKG",206,22,1,"PAH",1,1,1,0)
When finishing a non-controlled drug order immediately after finishing a
"PKG",206,22,1,"PAH",1,1,2,0)
renewal of a controlled drug, an incorrect expiration date occurs. The
"PKG",206,22,1,"PAH",1,1,3,0)
non-controlled drugs are finished with the expiration date of the
"PKG",206,22,1,"PAH",1,1,4,0)
controlled drug.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSORENW1")
0^1^B63062494^B63022534
"RTN","PSORENW1",1,0)
PSORENW1 ;BIR/DSD - Renew Main Driver Continuation ;03/29/93
"RTN","PSORENW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,37,51,46,71,117,157,143,219,239,225,444,548**;DEC 1997;Build 1
"RTN","PSORENW1",3,0)
 ;External reference ^VA(200 supported by DBIA 10060
"RTN","PSORENW1",4,0)
 ;
"RTN","PSORENW1",5,0)
START ;
"RTN","PSORENW1",6,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=+$P($G(^("SIG")),"^",2)
"RTN","PSORENW1",7,0)
 S PSOIBOLD=$G(PSORENW("OIRXN"))
"RTN","PSORENW1",8,0)
 D SETIB
"RTN","PSORENW1",9,0)
 S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW1",10,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",11,0)
 S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5),PSORENW("COPIES")=$P(PSORENW("RX0"),"^",18)
"RTN","PSORENW1",12,0)
 I $G(PSOFDR),$P($G(OR0),"^",13) S PSORENW("CLINIC")=$P($G(OR0),"^",13)
"RTN","PSORENW1",13,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",14,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW1",15,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",16,0)
 S (PSODFN,PSORENW("PSODFN"))=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",17,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",18,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW1",19,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",20,0)
 S D=0 F  S D=$O(^PSRX(PSORENW("OIRXN"),"INS1",D)) Q:'D  S PSORENW("SIG",D)=^PSRX(PSORENW("OIRXN"),"INS1",D,0)
"RTN","PSORENW1",21,0)
 I '$O(PSORENW("SIG",0)),$G(PSORENW("INS"))]"" S PSORENW("SIG",1)=PSORENW("INS")
"RTN","PSORENW1",22,0)
 G:$G(PSORENW("ENT")) FDR
"RTN","PSORENW1",23,0)
 I $G(PSORENW("ENT"))'>0,'$O(^PSRX(PSORENW("OIRXN"),6,0)) S PSORENW("ENT")=0 G FDR
"RTN","PSORENW1",24,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",25,0)
 .S PSORENW("ENT")=$G(PSORENW("ENT"))+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",26,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",27,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",28,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",29,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",30,0)
 .K DOSE
"RTN","PSORENW1",31,0)
FDR I $G(PSOFDR) D
"RTN","PSORENW1",32,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",I)=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",33,0)
 .S $P(PSORENW("RX0"),"^",7)=$P(OR0,"^",10),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",34,0)
 .S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",35,0)
 .K PSORENW("COSIGNING PROVIDER")
"RTN","PSORENW1",36,0)
 .I $G(PSORENW("PROVIDER")),$P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSORENW1",37,0)
 .S (PSDY,PSORENW("DAYS SUPPLY"))=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW1",38,0)
 .S POERR=1,DREN=$P(PSORENW("RX0"),"^",6) D DRG^PSOORDRG K POERR S PSODIR("CS")=0
"RTN","PSORENW1",39,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW1",40,0)
 .; Retrieving the Maximum Number of Refills allowed
"RTN","PSORENW1",41,0)
 .S RFMX=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),+$G(PSORENW("DAYS SUPPLY")),+$P(^PSRX(PSORENW("OIRXN"),0),"^",3),.CLOZPAT)
"RTN","PSORENW1",42,0)
 .S $P(PSORENW("RX0"),"^",9)=$S($P(OR0,"^",11)'>RFMX:$P(OR0,"^",11),1:RFMX),$P(OR0,"^",11)=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW1",43,0)
 .K RFMX,PSODIR("CS"),PSDY
"RTN","PSORENW1",44,0)
 S:'$G(PSORENW("QTY")) PSORENW("QTY")=$P(PSORENW("RX0"),"^",7)
"RTN","PSORENW1",45,0)
 S:'$G(PSORENW("DAYS SUPPLY")) PSORENW("DAYS SUPPLY")=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW1",46,0)
 D DAYSUP^PSOUTIL($P(PSORENW("RX0"),"^",6),.PSORENW,1)
"RTN","PSORENW1",47,0)
END Q
"RTN","PSORENW1",48,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0,DAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSORENW1",49,0)
 S DEA("CS")=0 K DIR,DIC
"RTN","PSORENW1",50,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S DEA("CS")=1
"RTN","PSORENW1",51,0)
 S X1=$S($G(PSORENW("ISSUE DATE")):$G(PSORENW("ISSUE DATE")),1:DT),X2=DAYS*($P(PSORENW("RX0"),"^",9)+1)\1
"RTN","PSORENW1",52,0)
 S X2=$S(DAYS=X2&('DEA("CS")):X2,DEA("CS"):184,1:366) D C^%DTC
"RTN","PSORENW1",53,0)
 I PSORENW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSORENW1",54,0)
 K X1,X2,X,%DT,DEA("CS")
"RTN","PSORENW1",55,0)
 Q
"RTN","PSORENW1",56,0)
OERR ;renewal finish from oe/rr
"RTN","PSORENW1",57,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSORENW1",58,0)
 S $P(PSORENW("RX0"),"^",4)=$P(OR0,"^",5)
"RTN","PSORENW1",59,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",60,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",61,0)
 S $P(PSORENW("RX0"),"^",5)=$P(OR0,"^",13)
"RTN","PSORENW1",62,0)
 S PSORENW("CLINIC")=$P(OR0,"^",13)
"RTN","PSORENW1",63,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")_"."_$S($P(OR0,"^",17)="C":" Administered in Clinic.",1:"")
"RTN","PSORENW1",64,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^"),SIGOK=$P(^("SIG"),"^",2) I SIGOK D
"RTN","PSORENW1",65,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW1",66,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",67,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",68,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",69,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",70,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",71,0)
 Q:$G(PSORENW("ENT"))>0
"RTN","PSORENW1",72,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",73,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",74,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",75,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",76,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",77,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",78,0)
 .K DOSE
"RTN","PSORENW1",79,0)
 Q
"RTN","PSORENW1",80,0)
 ;
"RTN","PSORENW1",81,0)
SETIB ;Set defaults on Renewals with Copay information
"RTN","PSORENW1",82,0)
 ;If answer is in Pending File, use that, else look in Prescription file
"RTN","PSORENW1",83,0)
 N PSOOICD,JJJ
"RTN","PSORENW1",84,0)
 K PSOSCP,PSOANSQ("SC>50") D SCP^PSORN52D S PSOANSQ("SC>50")="" K PSOSCA
"RTN","PSORENW1",85,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",86,0)
 I $G(PSOFDR),$G(ORD) D SETIBP Q
"RTN","PSORENW1",87,0)
 ;I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",88,0)
 I $G(PSORX(PSOIBOLD,"SC"))'=0,$G(PSORX(PSOIBOLD,"SC"))'=1 S PSORX(PSOIBOLD,"SC")=$S($P($G(^PSRX(PSOIBOLD,"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSOIBOLD,"IB")),"^"):0,1:"")
"RTN","PSORENW1",89,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",90,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",91,0)
 I $G(PSORX(PSOIBOLD,"MST"))'=0,$G(PSORX(PSOIBOLD,"MST"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",2)'="" S PSORX(PSOIBOLD,"MST")=$P($G(^("IBQ")),"^",2)
"RTN","PSORENW1",92,0)
 I $G(PSORX(PSOIBOLD,"VEH"))'=0,$G(PSORX(PSOIBOLD,"VEH"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",3)'="" S PSORX(PSOIBOLD,"VEH")=$P($G(^("IBQ")),"^",3)
"RTN","PSORENW1",93,0)
 I $G(PSORX(PSOIBOLD,"RAD"))'=0,$G(PSORX(PSOIBOLD,"RAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",4)'="" S PSORX(PSOIBOLD,"RAD")=$P($G(^("IBQ")),"^",4)
"RTN","PSORENW1",94,0)
 I $G(PSORX(PSOIBOLD,"PGW"))'=0,$G(PSORX(PSOIBOLD,"PGW"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",5)'="" S PSORX(PSOIBOLD,"PGW")=$P($G(^("IBQ")),"^",5)
"RTN","PSORENW1",95,0)
 I $G(PSORX(PSOIBOLD,"HNC"))'=0,$G(PSORX(PSOIBOLD,"HNC"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",6)'="" S PSORX(PSOIBOLD,"HNC")=$P($G(^("IBQ")),"^",6)
"RTN","PSORENW1",96,0)
 I $G(PSORX(PSOIBOLD,"CV"))'=0,$G(PSORX(PSOIBOLD,"CV"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",7)'="" S PSORX(PSOIBOLD,"CV")=$P($G(^("IBQ")),"^",7)
"RTN","PSORENW1",97,0)
 I $G(PSORX(PSOIBOLD,"SHAD"))'=0,$G(PSORX(PSOIBOLD,"SHAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",8)'="" S PSORX(PSOIBOLD,"SHAD")=$P($G(^("IBQ")),"^",8)
"RTN","PSORENW1",98,0)
 ;
"RTN","PSORENW1",99,0)
SET2 ;for when patient status is exempt or SC>50
"RTN","PSORENW1",100,0)
 I $TR($G(^PSRX(PSOIBOLD,"IBQ")),"^")="" S PSOOICD=$G(^PSRX(PSOIBOLD,"ICD",1,0)) D SET3:PSOOICD'=""
"RTN","PSORENW1",101,0)
 ;
"RTN","PSORENW1",102,0)
ICD I $D(^PSRX(PSORENW("OIRXN"),"ICD",0)) D
"RTN","PSORENW1",103,0)
 . N JJ,ICD,II,FLD,RXN S RXN=PSOIBOLD
"RTN","PSORENW1",104,0)
 . S II=0 F  S II=$O(^PSRX(PSORENW("OIRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",105,0)
 .. S ICD=^PSRX(PSORENW("OIRXN"),"ICD",II,0),FLD=$P(ICD,U) D ICD^PSONEWF
"RTN","PSORENW1",106,0)
 Q
"RTN","PSORENW1",107,0)
SET3 ;for when patient status is exempt or SC>50
"RTN","PSORENW1",108,0)
 D SET3^PSORN52D
"RTN","PSORENW1",109,0)
 Q
"RTN","PSORENW1",110,0)
 ;
"RTN","PSORENW1",111,0)
SETIBP ;
"RTN","PSORENW1",112,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") S PSORX(PSOIBOLD,"SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0)
"RTN","PSORENW1",113,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",114,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",115,0)
 N PSOIBQFN S PSOIBQFN=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORENW1",116,0)
 I $P(PSOIBQFN,"^",1)=0!($P(PSOIBQFN,"^",1)=1) S PSORX(PSOIBOLD,"MST")=$P(PSOIBQFN,"^")
"RTN","PSORENW1",117,0)
 I $P(PSOIBQFN,"^",2)=0!($P(PSOIBQFN,"^",2)=1) S PSORX(PSOIBOLD,"VEH")=$P(PSOIBQFN,"^",2)
"RTN","PSORENW1",118,0)
 I $P(PSOIBQFN,"^",3)=0!($P(PSOIBQFN,"^",3)=1) S PSORX(PSOIBOLD,"RAD")=$P(PSOIBQFN,"^",3)
"RTN","PSORENW1",119,0)
 I $P(PSOIBQFN,"^",4)=0!($P(PSOIBQFN,"^",4)=1) S PSORX(PSOIBOLD,"PGW")=$P(PSOIBQFN,"^",4)
"RTN","PSORENW1",120,0)
 I $P(PSOIBQFN,"^",5)=0!($P(PSOIBQFN,"^",5)=1) S PSORX(PSOIBOLD,"HNC")=$P(PSOIBQFN,"^",5)
"RTN","PSORENW1",121,0)
 I $P(PSOIBQFN,"^",6)=0!($P(PSOIBQFN,"^",6)=1) S PSORX(PSOIBOLD,"CV")=$P(PSOIBQFN,"^",6)
"RTN","PSORENW1",122,0)
 I $P(PSOIBQFN,"^",7)=0!($P(PSOIBQFN,"^",7)=1) S PSORX(PSOIBOLD,"SHAD")=$P(PSOIBQFN,"^",7)
"RTN","PSORENW1",123,0)
 ;for when patient status is exempt, null IBQ node was set for exempts or SC>50 - data is in ICD node
"RTN","PSORENW1",124,0)
 I $TR($G(^PS(52.41,ORD,"IBQ")),"^")="" S PSOOICD=$G(^PS(52.41,ORD,"ICD",1,0)) D SET3:PSOOICD'=""
"RTN","PSORENW1",125,0)
 ;
"RTN","PSORENW1",126,0)
ICD2 ;
"RTN","PSORENW1",127,0)
 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSORENW1",128,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSORENW1",129,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",130,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSORENW1",131,0)
 .. I $G(PSOSCP)>49&(II=1) S PSORX(PSOIBOLD,"SC>50")=$P(ICD,"^",4)
"RTN","PSORENW1",132,0)
 .. S JJ="" F JJ=1:1:9 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",133,0)
 K PSOIBQFN
"RTN","PSORENW1",134,0)
 Q
"RTN","PSORENW1",135,0)
KLIB ;Kill renewal IB array
"RTN","PSORENW1",136,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",137,0)
 K PSORX(PSOIBOLD,"SC"),PSORX(PSOIBOLD,"MST"),PSORX(PSOIBOLD,"VEH"),PSORX(PSOIBOLD,"RAD"),PSORX(PSOIBOLD,"PGW"),PSORX(PSOIBOLD,"HNC"),PSORX(PSOIBOLD,"CV"),PSORX(PSOIBOLD,"SHAD")
"RTN","PSORENW1",138,0)
 K PSOIBOLD
"RTN","PSORENW1",139,0)
 Q
"VER")
8.0^22.2
"BLD",11273,6)
^461
**END**
**END**

