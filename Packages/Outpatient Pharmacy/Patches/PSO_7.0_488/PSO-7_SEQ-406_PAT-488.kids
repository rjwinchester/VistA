Released PSO*7*488 SEQ #406
Extracted from mail message
**KIDS**:PSO*7.0*488^

**INSTALL NAME**
PSO*7.0*488
"BLD",10554,0)
PSO*7.0*488^OUTPATIENT PHARMACY^0^3170609^y
"BLD",10554,1,0)
^^3^3^3170609^
"BLD",10554,1,1,0)
This patch will resolve the following issues.
"BLD",10554,1,2,0)
1.    I9899883FY16  Drug Enter/edit option issue
"BLD",10554,1,3,0)
2.    I6126024FY16  Patient name does not come up on the Bingo Board
"BLD",10554,4,0)
^9.64PA^^
"BLD",10554,6.3)
4
"BLD",10554,"KRN",0)
^9.67PA^779.2^20
"BLD",10554,"KRN",.4,0)
.4
"BLD",10554,"KRN",.401,0)
.401
"BLD",10554,"KRN",.402,0)
.402
"BLD",10554,"KRN",.403,0)
.403
"BLD",10554,"KRN",.5,0)
.5
"BLD",10554,"KRN",.84,0)
.84
"BLD",10554,"KRN",3.6,0)
3.6
"BLD",10554,"KRN",3.8,0)
3.8
"BLD",10554,"KRN",9.2,0)
9.2
"BLD",10554,"KRN",9.8,0)
9.8
"BLD",10554,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",10554,"KRN",9.8,"NM",3,0)
PSOHLD^^0^B89811890
"BLD",10554,"KRN",9.8,"NM",4,0)
PSOORNE6^^0^B50160901
"BLD",10554,"KRN",9.8,"NM",5,0)
PSORX1^^0^B83034701
"BLD",10554,"KRN",9.8,"NM","B","PSOHLD",3)

"BLD",10554,"KRN",9.8,"NM","B","PSOORNE6",4)

"BLD",10554,"KRN",9.8,"NM","B","PSORX1",5)

"BLD",10554,"KRN",19,0)
19
"BLD",10554,"KRN",19.1,0)
19.1
"BLD",10554,"KRN",101,0)
101
"BLD",10554,"KRN",409.61,0)
409.61
"BLD",10554,"KRN",771,0)
771
"BLD",10554,"KRN",779.2,0)
779.2
"BLD",10554,"KRN",870,0)
870
"BLD",10554,"KRN",8989.51,0)
8989.51
"BLD",10554,"KRN",8989.52,0)
8989.52
"BLD",10554,"KRN",8994,0)
8994
"BLD",10554,"KRN","B",.4,.4)

"BLD",10554,"KRN","B",.401,.401)

"BLD",10554,"KRN","B",.402,.402)

"BLD",10554,"KRN","B",.403,.403)

"BLD",10554,"KRN","B",.5,.5)

"BLD",10554,"KRN","B",.84,.84)

"BLD",10554,"KRN","B",3.6,3.6)

"BLD",10554,"KRN","B",3.8,3.8)

"BLD",10554,"KRN","B",9.2,9.2)

"BLD",10554,"KRN","B",9.8,9.8)

"BLD",10554,"KRN","B",19,19)

"BLD",10554,"KRN","B",19.1,19.1)

"BLD",10554,"KRN","B",101,101)

"BLD",10554,"KRN","B",409.61,409.61)

"BLD",10554,"KRN","B",771,771)

"BLD",10554,"KRN","B",779.2,779.2)

"BLD",10554,"KRN","B",870,870)

"BLD",10554,"KRN","B",8989.51,8989.51)

"BLD",10554,"KRN","B",8989.52,8989.52)

"BLD",10554,"KRN","B",8994,8994)

"BLD",10554,"QDEF")
^^^^NO^^^^^^NO
"BLD",10554,"QUES",0)
^9.62^^
"BLD",10554,"REQB",0)
^9.611^4^3
"BLD",10554,"REQB",1,0)
PSO*7.0*210^2
"BLD",10554,"REQB",2,0)
PSO*7.0*370^2
"BLD",10554,"REQB",4,0)
PSO*7.0*454^2
"BLD",10554,"REQB","B","PSO*7.0*210",1)

"BLD",10554,"REQB","B","PSO*7.0*370",2)

"BLD",10554,"REQB","B","PSO*7.0*454",4)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
488^3170609
"PKG",206,22,1,"PAH",1,1,0)
^^3^3^3170609
"PKG",206,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues.
"PKG",206,22,1,"PAH",1,1,2,0)
1.    I9899883FY16  Drug Enter/edit option issue
"PKG",206,22,1,"PAH",1,1,3,0)
2.    I6126024FY16  Patient name does not come up on the Bingo Board
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSOHLD")
0^3^B89811890^B87531422
"RTN","PSOHLD",1,0)
PSOHLD ;BIR/SAB - hold unhold functionality ; 7/23/09 1:16pm
"RTN","PSOHLD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,21,24,27,32,55,82,114,130,166,148,268,281,298,358,353,385,386,370,488**;DEC 1997;Build 4
"RTN","PSOHLD",3,0)
 ;External reference to ^DD(52-DBIA 999,  VA(200-DBIA 224, NA^ORX1-DBIA 2186,
"RTN","PSOHLD",4,0)
 ; L, UL, PSOL, and PSOUL^PSSLOCK-DBIA 2789, ^%DTC-DBIA 10000, ^DIE-DBIA 10018, ^DIR-DBIA 10026,
"RTN","PSOHLD",5,0)
 ; ^DIK-DBIA 10013, ^VALM1-DBIA 10016, ^XUSEC(-DBIA 10076
"RTN","PSOHLD",6,0)
UHLD ; Rx Unhold
"RTN","PSOHLD",7,0)
 N REASON,RXIEN
"RTN","PSOHLD",8,0)
 S PSOFROM="UNHOLD" ;*488
"RTN","PSOHLD",9,0)
 I '$D(PSOPAR) D ^PSOLSET G:'$D(PSOPAR) EX
"RTN","PSOHLD",10,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",11,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",12,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOHLD",13,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",14,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA"))
"RTN","PSOHLD",15,0)
 I STA=16 S VALMSG="Placed on HOLD by Provider!" K Y,STA D PSOUL^PSSLOCK(DA) D ULP S VALMBCK="" Q
"RTN","PSOHLD",16,0)
 I STA'=3!(('$D(^XUSEC("PSORPH",DUZ)))&('$D(^XUSEC("PSO TECH ADV",DUZ)))) S VALMSG="Invalid Action Selection!",VALMBCK="" K Y,STA D PSOUL^PSSLOCK(DA) D ULP Q
"RTN","PSOHLD",17,0)
 S REASON=$$GET1^DIQ(52,DA,99,"I")
"RTN","PSOHLD",18,0)
 I ('$D(^XUSEC("PSORPH",DUZ))),",1,7,8,98,"'[(","_REASON_",") D  K Y,STA D PSOUL^PSSLOCK(DA) D ULP Q
"RTN","PSOHLD",19,0)
 . S VALMSG="The HOLD can only be removed by a pharmacist",VALMBCK=""
"RTN","PSOHLD",20,0)
 D FULL^VALM1 K DIR,DTOUT,DUOUT,DIRUT D NOOR I $D(DIRUT) D ULP G EX
"RTN","PSOHLD",21,0)
 I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G EX
"RTN","PSOHLD",22,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11
"RTN","PSOHLD",23,0)
 .S ^PSRX(DA,"H")="",COMM="Medication Expired on "_$E($P(^(2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM,"") K COMM
"RTN","PSOHLD",24,0)
EN S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I,RSDT=$P(^(I,0),"^")
"RTN","PSOHLD",25,0)
 S RXIEN=DA
"RTN","PSOHLD",26,0)
 ; - Asking for UNHOLD Comments
"RTN","PSOHLD",27,0)
 N HLDCOM
"RTN","PSOHLD",28,0)
 S HLDCOM=$$GET1^DIQ(52,RXIEN,99.1)_" (REASON: "_$$GET1^DIQ(52,RXIEN,99)_") on "_$$GET1^DIQ(52,RXIEN,99.2)
"RTN","PSOHLD",29,0)
 W !!,"HOLD COMMENTS: " F I=1:1 Q:HLDCOM=""  W ?15,$E(HLDCOM,1,65),! S HLDCOM=$E(HLDCOM,66,999)
"RTN","PSOHLD",30,0)
 K DIR,DUOUT,DTOUT S DIR(0)="FO^3:200",DIR("A")="UNHOLD COMMENTS" D ^DIR I $D(DTOUT)!$D(DUOUT) D ULP G EX
"RTN","PSOHLD",31,0)
 S OTHCOM=X
"RTN","PSOHLD",32,0)
 ;
"RTN","PSOHLD",33,0)
 K Y I RXF D  I $D(Y) D ULP G EX
"RTN","PSOHLD",34,0)
 .N DA,DIE S DA(1)=RXIEN,DA=RXF,DIE="^PSRX("_DA(1)_",1,",PSOUNHLD=1
"RTN","PSOHLD",35,0)
 .S RLDT=$P(^PSRX(DA(1),1,DA,0),"^",18)
"RTN","PSOHLD",36,0)
 .I 'RLDT D
"RTN","PSOHLD",37,0)
 ..I RSDT<DT D  ;353 Do not display a past date for refill date'
"RTN","PSOHLD",38,0)
 ...N Y,TD S Y=DT X ^DD("DD") S TD=Y
"RTN","PSOHLD",39,0)
 ...S DR=".01R///^S X=TD"
"RTN","PSOHLD",40,0)
 ...D ^DIE
"RTN","PSOHLD",41,0)
 ..S DR=".01R;2"
"RTN","PSOHLD",42,0)
 ..D ^DIE
"RTN","PSOHLD",43,0)
 ..I $D(Y) D  ;User quit the UNHOLD process
"RTN","PSOHLD",44,0)
 ...I RSDT<DT D  ;reset refill date
"RTN","PSOHLD",45,0)
 ....N Y,TD S Y=RSDT X ^DD("DD") S TD=Y
"RTN","PSOHLD",46,0)
 ....S DR=".01R///^S X=TD"
"RTN","PSOHLD",47,0)
 ....D ^DIE
"RTN","PSOHLD",48,0)
 .I $$GET1^DIQ(52.1,RXF_","_RXIEN,2)["W" S BINGRTE="W",BINGCRT=1  ;*488
"RTN","PSOHLD",49,0)
 .S ZD(RXIEN)=$P(^PSRX(DA(1),1,DA,0),"^")
"RTN","PSOHLD",50,0)
 .K PSOUNHLD Q:$D(Y)  S PSORX("FILL DATE")=$P(^PSRX(DA(1),1,DA,0),"^"),DA=PSDA K DA(1)
"RTN","PSOHLD",51,0)
 ;
"RTN","PSOHLD",52,0)
 ;PSO*7*298 Require an entry into fill date
"RTN","PSOHLD",53,0)
 S ACT=1,DIE="^PSRX(",FDT=$S($P(^PSRX(RXIEN,2),"^",2):$P(^PSRX(RXIEN,2),"^",2),1:DT)
"RTN","PSOHLD",54,0)
 S RLDT=$P(^PSRX(RXIEN,2),"^",13),DR="",RLDTP1=$P(RLDT,".",1)
"RTN","PSOHLD",55,0)
 I 'RXF&'RLDT S DR="22R//^S X=FDT;11;Q;"
"RTN","PSOHLD",56,0)
 I RLDT&($P(^PSRX(RXIEN,2),"^",2)="") S DR="22R//^S X=RLDTP1;11;Q;"
"RTN","PSOHLD",57,0)
 S DR=DR_"100///0;101///^S X=$S(RXF:$G(ZD(RXIEN)),1:$P(^PSRX(RXIEN,2),""^"",2))"
"RTN","PSOHLD",58,0)
 ;
"RTN","PSOHLD",59,0)
 D ^DIE K FDT I $D(Y) S VALMBCK="R" D ULP G EX
"RTN","PSOHLD",60,0)
 I 'RXF,$$GET1^DIQ(52,RXIEN,11)["W" S BINGRTE="W",BINGCRT=1  ;*488
"RTN","PSOHLD",61,0)
 ;
"RTN","PSOHLD",62,0)
 ; - Saving UNHOLD COMMENTS in the Refill REMARKS field.
"RTN","PSOHLD",63,0)
 I $G(OTHCOM)'="" D
"RTN","PSOHLD",64,0)
 . N DA,DIE,DR S DA(1)=RXIEN,DA=RXF,DIE="^PSRX("_DA(1)_",1,",DR="3///"_$E($TR(OTHCOM,";",","),1,60) D ^DIE
"RTN","PSOHLD",65,0)
 ; - Logging Rx Activity Log
"RTN","PSOHLD",66,0)
 D RXACT(RXIEN,"U",,$G(OTHCOM))
"RTN","PSOHLD",67,0)
 ; 
"RTN","PSOHLD",68,0)
 S COMM="Medication Removed from Hold by Pharmacy" D EN^PSOHLSN1(RXIEN,"OE","",COMM,PSONOOR) K COMM,PSONOOR
"RTN","PSOHLD",69,0)
 S PSORX("FILL DATE")=$S('RXF:$P(^PSRX(RXIEN,2),"^",2),1:ZD(RXIEN)) I $G(^PSRX(RXIEN,"H")) K ^PSRX("AH",$P(^PSRX(RXIEN,"H"),"^"),DA)
"RTN","PSOHLD",70,0)
 S ^PSRX(RXIEN,"H")=""
"RTN","PSOHLD",71,0)
 ;D ACT^PSOHLDA
"RTN","PSOHLD",72,0)
 S (NEW1,NEW11)="^^"
"RTN","PSOHLD",73,0)
 S (RXF,RXFL(RXIEN))=0 F JJ=0:0 S JJ=$O(^PSRX(RXIEN,1,JJ)) Q:'JJ  S (RXFL(RXIEN),RXF)=JJ
"RTN","PSOHLD",74,0)
 I $G(PSXSYS) D UNHOLD^PSOCMOPA I $G(XFLAG) D ULP G EX
"RTN","PSOHLD",75,0)
 I $G(RXIEN) D RELC I $G(PSOHRL) D ULP G EX
"RTN","PSOHLD",76,0)
 I PSORX("FILL DATE")>DT,$P(PSOPAR,"^",6) D S^PSORXL,EX,ULP Q
"RTN","PSOHLD",77,0)
 S PCOMH(RXIEN)="Medication Removed from Hold by Pharmacy"
"RTN","PSOHLD",78,0)
 I $G(RXIEN) S RXRH(RXIEN)=RXIEN
"RTN","PSOHLD",79,0)
 I $P($G(^PSRX(RXIEN,2)),"^",15)'="" S $P(^PSRX(RXIEN,2),"^",14)=1,RXRP(RXIEN)=1,$P(RXRP(RXIEN),"^",2)=$P($G(^PSRX(RXIEN,0)),"^",18) ; MARK PRESCRIPTION AND LABEL AS BEING REPRINTED WHEN UNHOLDING A RETURNED TO STOCK PRESCRIPTION
"RTN","PSOHLD",80,0)
 ;
"RTN","PSOHLD",81,0)
 ; - Submitting Rx to ECME
"RTN","PSOHLD",82,0)
 N ACTION
"RTN","PSOHLD",83,0)
 I $$SUBMIT^PSOBPSUT(RXIEN,+$G(RXFL(RXIEN))) D  I ACTION="Q"!(ACTION="^") D ULP G EX
"RTN","PSOHLD",84,0)
 . N RX,RFL S RX=RXIEN,RFL=+$G(RXFL(RXIEN))
"RTN","PSOHLD",85,0)
 . N DA S ACTION=""
"RTN","PSOHLD",86,0)
 . D ECMESND^PSOBPSU1(RX,RFL,,$S(RFL:"RF",1:"OF"))
"RTN","PSOHLD",87,0)
 . ; Quit if there is an unresolved TRICARE/CHAMPVA non-billable reject code, PSO*7*358
"RTN","PSOHLD",88,0)
 . I $$PSOET^PSOREJP3(RX,RFL) S ACTION="Q" Q
"RTN","PSOHLD",89,0)
 . I $$FIND^PSOREJUT(RX,RFL) D
"RTN","PSOHLD",90,0)
 . . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","Q")
"RTN","PSOHLD",91,0)
 ;
"RTN","PSOHLD",92,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RXIEN_"," D ULP G EX
"RTN","PSOHLD",93,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOHLD",94,0)
 I $L(PSORX("PSOL",PSOX2))+$L(RXIEN)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RXIEN_","
"RTN","PSOHLD",95,0)
 E  S PSORX("PSOL",PSOX2+1)=RXIEN_","
"RTN","PSOHLD",96,0)
 ; 
"RTN","PSOHLD",97,0)
 D ULP
"RTN","PSOHLD",98,0)
EX D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) D ^PSOBUILD
"RTN","PSOHLD",99,0)
 K PSOHRL,PSOMSG,PSOPLCK,ST,PSL,PSNP,IR,NOW,DR,NEW1,NEW11,RTN,DA,PPL,RXN,RX0,RXS,DIK,RXP,FLD,ACT,DIE,DIC,DIR,DIE,X,Y,DIRUT,DUOUT,SUSPT,C,D0,LFD,I,RFDATE,DI,DQ,%,RFN,XFLAG
"RTN","PSOHLD",100,0)
 K HRX,PSHLD,PSOLIST,PSORX("FILL DATE"),STA,QTY,RFDT,PSORX0,PSRXN,RXF,JJ Q
"RTN","PSOHLD",101,0)
 ;
"RTN","PSOHLD",102,0)
HLD ;
"RTN","PSOHLD",103,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",104,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",105,0)
 I '$D(^XUSEC("PSORPH",DUZ))&'$D(^XUSEC("PSO TECH ADV",DUZ)) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOHLD",106,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient."),VALMBCK="" K PSOPLCK Q
"RTN","PSOHLD",107,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",108,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA")) I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G D1
"RTN","PSOHLD",109,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3),VALMBCK="R"
"RTN","PSOHLD",110,0)
 .I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSOHLD",111,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSOHLD",112,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUED^DELETED^DISCONTINUED^DISCONTINUED (EDIT)^PROVIDER HOLD^","^",STA+2)
"RTN","PSOHLD",113,0)
 I STA,STA'>4!(STA>11) D  D ULP G D1
"RTN","PSOHLD",114,0)
 .S VALMSG="Rx: "_$P(Y(0),"^")_" is currently in a status of "_ST,VALMBCK="R" K ST,Y Q
"RTN","PSOHLD",115,0)
 D FULL^VALM1 D NOOR I $D(DIRUT) D ULP G D1
"RTN","PSOHLD",116,0)
 D HLD^PSOCMOPA I $G(XFLAG) K XFLAG D ULP G D1
"RTN","PSOHLD",117,0)
 K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99"
"RTN","PSOHLD",118,0)
 ; A reduced set of HOLD REASON CODEs is available for Pharmacy Techs
"RTN","PSOHLD",119,0)
 I '$D(^XUSEC("PSORPH",DUZ)) D
"RTN","PSOHLD",120,0)
 . S DIR(0)="S^1:INSUFFICIENT QTY IN STOCK;7:BAD ADDRESS;8:PER PATIENT REQUEST;98:OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",121,0)
 . S DIR("L",1)="Enter reason medication is placed in a 'Hold' status."
"RTN","PSOHLD",122,0)
 . S DIR("L",2)="Choose from:"
"RTN","PSOHLD",123,0)
 . S DIR("L",3)="1        INSUFFICIENT QTY IN STOCK"
"RTN","PSOHLD",124,0)
 . S DIR("L",4)="7        BAD ADDRESS"
"RTN","PSOHLD",125,0)
 . S DIR("L",5)="8        PER PATIENT REQUEST"
"RTN","PSOHLD",126,0)
 . S DIR("L")="98       OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",127,0)
 ;
"RTN","PSOHLD",128,0)
 D ^DIR S FLD(99)=Y I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,DIR D ULP G D1
"RTN","PSOHLD",129,0)
 I ($G(FLD(99))=98!($G(FLD(99))=99)) K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR S FLD(99.1)=Y G AR
"RTN","PSOHLD",130,0)
 E  K DIR S DIR(0)="FO^10:100",DIR("A")="HOLD COMMENTS" D ^DIR S FLD(99.1)=Y
"RTN","PSOHLD",131,0)
AR I $D(DUOUT)!($D(DTOUT)) K DIRUT,DUOUT,DIR S VALMBCK="R" D ULP G D1
"RTN","PSOHLD",132,0)
 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D H S DA=PSDA K PSDA D:$D(PSORX("PSOL")) RMP^PSOHLDA
"RTN","PSOHLD",133,0)
 K PI D ^PSOBUILD
"RTN","PSOHLD",134,0)
 D ULP
"RTN","PSOHLD",135,0)
D1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) K PSOMSG,PSOPLCK,RFN,DIR,RSDT,FLD,DA,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PSOHLD",136,0)
 Q
"RTN","PSOHLD",137,0)
 ;
"RTN","PSOHLD",138,0)
H ; - Rx HOLD update
"RTN","PSOHLD",139,0)
 D HOLD^PSOHLDA
"RTN","PSOHLD",140,0)
 Q
"RTN","PSOHLD",141,0)
 ;
"RTN","PSOHLD",142,0)
FLD N DA K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99" D
"RTN","PSOHLD",143,0)
 .; A reduced set of HOLD REASON CODEs is available for Pharmacy Techs  ;*370
"RTN","PSOHLD",144,0)
 .I $D(^XUSEC("PSORPH",DUZ)) Q
"RTN","PSOHLD",145,0)
 .S DIR(0)="S^1:INSUFFICIENT QTY IN STOCK;7:BAD ADDRESS;8:PER PATIENT REQUEST;98:OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",146,0)
 .S DIR("L",1)="Enter reason medication is placed in a 'Hold' status."
"RTN","PSOHLD",147,0)
 .S DIR("L",2)="Choose from:"
"RTN","PSOHLD",148,0)
 .S DIR("L",3)="1        INSUFFICIENT QTY IN STOCK"
"RTN","PSOHLD",149,0)
 .S DIR("L",4)="7        BAD ADDRESS"
"RTN","PSOHLD",150,0)
 .S DIR("L",5)="8        PER PATIENT REQUEST"
"RTN","PSOHLD",151,0)
 .S DIR("L")="98       OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",152,0)
 D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S FLD(99)=Y
"RTN","PSOHLD",153,0)
 S COMM=Y(0)
"RTN","PSOHLD",154,0)
 I $G(FLD(99))=99 K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S (FLD(99.1),COMM)=Y Q
"RTN","PSOHLD",155,0)
 E  S FLD(99.1)=""
"RTN","PSOHLD",156,0)
 Q
"RTN","PSOHLD",157,0)
NOOR ;ask nature of order
"RTN","PSOHLD",158,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSOHLD",159,0)
 .S PSONOOR=$$NA^ORX1("W",0,"B","Nature of Order",0,"WPSDIVR"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSOHLD",160,0)
 .I +PSONOOR S PSONOOR=$P(PSONOOR,"^",3) Q
"RTN","PSOHLD",161,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSOHLD",162,0)
 S DIR("A")="Nature of Order: ",DIR("B")="WRITTEN"
"RTN","PSOHLD",163,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSOHLD",164,0)
NOORX D ^DIR K DIR,DTOUT,DTOUT Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSOHLD",165,0)
 Q
"RTN","PSOHLD",166,0)
ULP ;
"RTN","PSOHLD",167,0)
 D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOHLD",168,0)
 Q
"RTN","PSOHLD",169,0)
RELC ;
"RTN","PSOHLD",170,0)
 S (PSOHRL,PSOHTX)=0  F PSOHT=0:0 S PSOHT=$O(^PSRX(DA,1,PSOHT)) Q:'PSOHT  S:$D(^PSRX(DA,1,PSOHT,0)) PSOHTX=PSOHT
"RTN","PSOHLD",171,0)
 I $G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,1,PSOHTX,0)),"^",18):1,1:0)
"RTN","PSOHLD",172,0)
 I '$G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,2)),"^",13):1,1:0)
"RTN","PSOHLD",173,0)
 K PSOHTX,PSOHT
"RTN","PSOHLD",174,0)
 Q
"RTN","PSOHLD",175,0)
RXACT(RX,ACTION,REASON,OTHCOM,SUS) ; Adds HOLD/UNHOLD comments to the Rx Activity Log
"RTN","PSOHLD",176,0)
 N RFL,X,DIC,DA,DD,DO,DR,DINUM,Y,DLAYGO,COMM
"RTN","PSOHLD",177,0)
 S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOHLD",178,0)
 I ACTION="H" S COMM="Rx placed on HOLD (Reason: "_REASON_")"_$S(+$G(SUS):" and removed from SUSPENSE",1:"")
"RTN","PSOHLD",179,0)
 I ACTION="U" S COMM="Rx removed from HOLD"
"RTN","PSOHLD",180,0)
 S DA(1)=RX,DIC="^PSRX("_RX_",""A"",",DLAYGO=52.3,DIC(0)="L" S:$G(OTHCOM)'="" OTHCOM=$TR(OTHCOM,";",","),COMM=COMM_" -"
"RTN","PSOHLD",181,0)
 S DIC("DR")=".02///"_ACTION_";.03////"_DUZ_";.04///"_$S((RFL>5):RFL+1,1:RFL)_";.05///"_COMM_$S($G(OTHCOM)'="":";4///"_OTHCOM,1:"")
"RTN","PSOHLD",182,0)
 S X=$$NOW^XLFDT() D FILE^DICN
"RTN","PSOHLD",183,0)
 Q
"RTN","PSOORNE6")
0^4^B50160901^B49921838
"RTN","PSOORNE6",1,0)
PSOORNE6 ;ISC-BHAM/SAB-display  orders from backdoor ;5/23/05 2:08pm
"RTN","PSOORNE6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,103,117,156,210,488**;DEC 1997;Build 4
"RTN","PSOORNE6",3,0)
 ;External reference to MAIN^TIUEDIT is supported by DBIA 2410
"RTN","PSOORNE6",4,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE6",5,0)
 ;
"RTN","PSOORNE6",6,0)
SIG ;called from psoorne3
"RTN","PSOORNE6",7,0)
 I $G(PSOSIGFL)!$G(PSOCOPY)!($O(SIG(0))) G DOSE
"RTN","PSOORNE6",8,0)
 I '$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) D  Q
"RTN","PSOORNE6",9,0)
 .S X=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE6",10,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE6",11,0)
 F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S MIG=$P(^PSRX(PSORXED("IRXN"),"SIG1",I,0),"^") D
"RTN","PSOORNE6",12,0)
 .S SIG(I)=MIG
"RTN","PSOORNE6",13,0)
 .F SG=1:1:$L(MIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORNE6",14,0)
 .S SIGOK=1 K MIG,SG
"RTN","PSOORNE6",15,0)
 Q
"RTN","PSOORNE6",16,0)
DOSE ;displays new SIG with dosing
"RTN","PSOORNE6",17,0)
 F I=0:0 S I=$O(SIG(I)) Q:'$D(SIG(+I))  D
"RTN","PSOORNE6",18,0)
 .F SG=1:1:$L(SIG(I)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG(I)," ",SG))>75 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " S:$P(SIG(I)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG(I)," ",SG)
"RTN","PSOORNE6",19,0)
 S SIGOK=1 K MIG,I
"RTN","PSOORNE6",20,0)
 Q
"RTN","PSOORNE6",21,0)
K1 ;
"RTN","PSOORNE6",22,0)
 K DRET,SIG,RTE,PRC,PHI,PSONOOR,PSOFDR,PSORXED,REF,DIR,DUOUT,DIRUT,SIGOK
"RTN","PSOORNE6",23,0)
 Q
"RTN","PSOORNE6",24,0)
K2 ;
"RTN","PSOORNE6",25,0)
 K SIG,DRET,RTE,PRC,PHI,DIR,DIRUT,DTOUT,PSOOELSE,DUOUT,PSOFDR,SIGOK,PSORXED,REF,INS1
"RTN","PSOORNE6",26,0)
 Q
"RTN","PSOORNE6",27,0)
K3 ;
"RTN","PSOORNE6",28,0)
 K PSLST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,CC,CRIT,CT,DAYS,DDER,DEA,DSMSG,HDR,PSOAC,PSOFLAG,RFCNT
"RTN","PSOORNE6",29,0)
 K UPMI,RIFN,RX,RXDA,RXOR,RXREF,SEG1,SER,STA,PSOFDR,SIGOK,INCOM,PSONOOR,ACTREF,ACTREN,INS1,RX0,RX2,RX3
"RTN","PSOORNE6",30,0)
 Q
"RTN","PSOORNE6",31,0)
ACP1 ;
"RTN","PSOORNE6",32,0)
 K REA,DA,MSG S REA="C",DA=PSONEW("OIRXN") S MSG="Renewed"_$S($G(PSOFDR):" from CPRS",1:"")
"RTN","PSOORNE6",33,0)
 S PSCAN(PSONEW("ORX #"))=DA_"^C" D CAN^PSOCAN,DCORD^PSONEW2 K REA,DA,MSG,PSCAN,RXXN
"RTN","PSOORNE6",34,0)
 S RXXN=$O(^TMP("PSORXN",$J,0)) I RXXN D
"RTN","PSOORNE6",35,0)
 .S RXN1=^TMP("PSORXN",$J,RXXN) D EN^PSOHLSN1(RXXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSOORNE6",36,0)
 .I $P(^PSRX(RXXN,"STA"),"^")=5 D EN^PSOHLSN1(RXXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSOORNE6",37,0)
 I $G(PSONOTE) D FULL^VALM1,MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1) K PSONOTE
"RTN","PSOORNE6",38,0)
 K VERB,RTE,DRET,RXXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSOORNE6",39,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSONEW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W"
"RTN","PSOORNE6",40,0)
 Q
"RTN","PSOORNE6",41,0)
INST ;formats instruction from front door
"RTN","PSOORNE6",42,0)
 I $O(^PSRX(RXN,"PI",0)) S PHI=^PSRX(RXN,"PI",0),T=0 D
"RTN","PSOORNE6",43,0)
 .F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  S PHI(T)=^PSRX(RXN,"PI",T,0)
"RTN","PSOORNE6",44,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Instructions:"
"RTN","PSOORNE6",45,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSOORNE6",46,0)
 .. S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSOORNE6",47,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE6",48,0)
 K T,TY,MIG,SG
"RTN","PSOORNE6",49,0)
 Q
"RTN","PSOORNE6",50,0)
PC ;displays provider comments
"RTN","PSOORNE6",51,0)
 I $O(^PSRX(RXN,"PRC",0)) S PRC=^PSRX(RXN,"PRC",0),T=0 D
"RTN","PSOORNE6",52,0)
 .F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  S PRC(T)=^PSRX(RXN,"PRC",T,0)
"RTN","PSOORNE6",53,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="   Provider Comments:"
"RTN","PSOORNE6",54,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSOORNE6",55,0)
 .. S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSOORNE6",56,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE6",57,0)
 K T,TY,MIG,SG
"RTN","PSOORNE6",58,0)
 Q
"RTN","PSOORNE6",59,0)
INST1 ;formats instruction from front door
"RTN","PSOORNE6",60,0)
 I $O(^PSRX(RXN,"PI",0)) S PHI=^PSRX(RXN,"PI",0),T=0 D
"RTN","PSOORNE6",61,0)
 .F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  S PHI(T)=^PSRX(RXN,"PI",T,0)
"RTN","PSOORNE6",62,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="        Instructions:"
"RTN","PSOORNE6",63,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSOORNE6",64,0)
 .. S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSOORNE6",65,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOPO",$J)),21)
"RTN","PSOORNE6",66,0)
 K T,TY,MIG,SG
"RTN","PSOORNE6",67,0)
 Q
"RTN","PSOORNE6",68,0)
PC1 ;displays provider comments
"RTN","PSOORNE6",69,0)
 I $O(^PSRX(RXN,"PRC",0)) S PRC=^PSRX(RXN,"PRC",0),T=0 D
"RTN","PSOORNE6",70,0)
 .F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  S PRC(T)=^PSRX(RXN,"PRC",T,0)
"RTN","PSOORNE6",71,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Provider Comments:"
"RTN","PSOORNE6",72,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSOORNE6",73,0)
 .. S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSOORNE6",74,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOPO",$J)),21)
"RTN","PSOORNE6",75,0)
 K T,TY,MIG,SG
"RTN","PSOORNE6",76,0)
 Q
"RTN","PSOORNE6",77,0)
ORCHK ;
"RTN","PSOORNE6",78,0)
 S (PSONEW("QFLG"),PSONEW("DFLG"))=0
"RTN","PSOORNE6",79,0)
 D FULL^VALM1 W !
"RTN","PSOORNE6",80,0)
 I $G(PSODRUG("NAME"))']""  D  S:$D(DIRUT)!($G(PSODRUG("NAME"))']"") ACP=0 Q:$G(PSOQFLG)!($D(DIRUT))
"RTN","PSOORNE6",81,0)
 .W !,"DRUG NAME REQUIRED" D 2^PSOORNW1,FULL^VALM1 I $G(PSODRUG("NAME"))']"" S VALMSG="No Dispense Drug selected."
"RTN","PSOORNE6",82,0)
 S PSOMIS=$S($G(PSONEW("DOSE",1))']"":1,$G(PSONEW("SCHEDULE",1))']"":2,1:0)
"RTN","PSOORNE6",83,0)
 D:PSOMIS  I PSODIR("DFLG")=1 S (PSONEW("QFLG"),POERR("DFLG"))=1 Q
"RTN","PSOORNE6",84,0)
 .W !!,"Incomplete Dosaging Instructions - "_$S(PSOMIS=2:"Schedule",1:"Dosage")_".",! S FDORC=1 D DOSE^PSOORED4(.PSONEW) K FDORC
"RTN","PSOORNE6",85,0)
 .I $G(PSONEW("DOSE",1))']""!($G(PSONEW("SCHEDULE",1))']"") S PSODIR("DFLG")=1 Q
"RTN","PSOORNE6",86,0)
 .D EN^PSOFSIG(.PSONEW) I PSONEW("ENT")>0,$O(SIG(0)) S (SIGOK,NEWDOSE)=1
"RTN","PSOORNE6",87,0)
 .D INS^PSODIR(.PSONEW),EN^PSOFSIG(.PSONEW)
"RTN","PSOORNE6",88,0)
 K PSOMIS,PSODOSE,POERR("DFLG"),PSONEW("QFLG") S I=0
"RTN","PSOORNE6",89,0)
 F  S I=$O(PSONEW("DOSE",I)) Q:'I  I $L(PSONEW("DOSE",I))>60 S (PSONEW("QFLG"),POERR("DFLG"))=1,PSODOSE("MSG",I)="Dosage #"_I_" is greater 60 characters in length!",VALMSG="Dosage Greater than 60 Characters, Please Edit!"
"RTN","PSOORNE6",90,0)
 I $G(POERR("DFLG"))=1 D  K PSODOSE,I Q
"RTN","PSOORNE6",91,0)
 .S I=0 F  S I=$O(PSODOSE("MSG",I)) Q:'I  W !,PSODOSE("MSG",I)
"RTN","PSOORNE6",92,0)
 .H 3
"RTN","PSOORNE6",93,0)
 Q:$G(PSONEW("QFLG"))
"RTN","PSOORNE6",94,0)
 K PSONEW("FLD") F FLD="PATIENT STATUS^5","QTY^9","DAYS SUPPLY^8","# OF REFILLS^10","ISSUE DATE^6","FILL DATE^7","MAIL/WINDOW^11","PROVIDER NAME^13" D  I $G(PSONEW($P(FLD,"^")))']"" S VALMBCK="R",PSONEW("FLD")=1
"RTN","PSOORNE6",95,0)
 .I $G(PSONEW($P(FLD,"^")))']"" W !,$P(FLD,"^")_" is required data" N RTN S RTN=$P(FLD,"^",2)_"^PSOORNEW" D @RTN K RTN
"RTN","PSOORNE6",96,0)
 Q:$G(PSONEW("DFLG"))=1
"RTN","PSOORNE6",97,0)
QTY I PSONEW("QTY")'=+PSONEW("QTY") W !,"Quantity must be ALL numeric!",! D 9^PSOORNEW Q:$G(PSONEW("DFLG"))=1  G QTY
"RTN","PSOORNE6",98,0)
 I $G(PSODRUG("MAXDOSE"))]"",(PSONEW("QTY")/PSONEW("DAYS SUPPLY")>PSODRUG("MAXDOSE")) D  Q:$G(PSONEW("DFLG"))=1!($G(PSONEW("QFLG")))  G QTY
"RTN","PSOORNE6",99,0)
 .W !,$C(7)," Greater than Maximum dose of "_PSODRUG("MAXDOSE")_" per day"
"RTN","PSOORNE6",100,0)
 .D KV^PSOVER1 S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do You Want to Edit Days Supply and Quantity Fields"
"RTN","PSOORNE6",101,0)
 .S DIR("?")="Enter 'Y' for Yes, 'N' for No, '^' to exit."
"RTN","PSOORNE6",102,0)
 .D ^DIR I $D(DIRUT) D KV^PSOVER1 K X,Y S (PSONEW("DFLG"),PSONEW("QFLG"))=1 Q  ;*488
"RTN","PSOORNE6",103,0)
 .D KV^PSOVER1 I 'Y K X,Y Q
"RTN","PSOORNE6",104,0)
 .D 8^PSOORNEW Q:$G(PSONEW("DFLG"))  D 9^PSOORNEW
"RTN","PSOORNE6",105,0)
 I $G(PSONEW("PROVIDER")) D PROV^PSOUTIL(.PSONEW) I $G(PSONEW("DFLG")) S PSODIR("DFLG")=1 Q
"RTN","PSOORNE6",106,0)
 S PSONEW("DFLG")=0 K DIC,X,Y
"RTN","PSOORNE6",107,0)
 Q
"RTN","PSOORNE6",108,0)
DISP ;
"RTN","PSOORNE6",109,0)
 S:$P(RX2,"^",10)&('$G(PSOCOPY)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="         Verified By: "_$P(^VA(200,$P(RX2,"^",10),0),"^")
"RTN","PSOORNE6",110,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",5) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="         Finished By: "_$P(^VA(200,$P(^PSRX(RXN,"OR1"),"^",5),0),"^")
"RTN","PSOORNE6",111,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",6) D
"RTN","PSOORNE6",112,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="           Filled By: "_$P(^VA(200,$P(^PSRX(RXN,"OR1"),"^",6),0),"^")
"RTN","PSOORNE6",113,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",7) D
"RTN","PSOORNE6",114,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Checked By: "_$P(^VA(200,$P(^PSRX(RXN,"OR1"),"^",7),0),"^")
"RTN","PSOORNE6",115,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="   Entry By: "_$P(^VA(200,$P(RX0,"^",16),0),"^")_$E(RN,$L($P(^VA(200,$P(RX0,"^",16),0),"^"))+1,35)
"RTN","PSOORNE6",116,0)
 S Y=$P(RX2,"^") X ^DD("DD")
"RTN","PSOORNE6",117,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"Entry Date: "_$E($P(RX2,"^"),4,5)_"/"_$E($P(RX2,"^"),6,7)_"/"_$E($P(RX2,"^"),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNE6",118,0)
 S (VALMCNT,PSOPF)=IEN S:$P($G(^PSRX(RXN,"PKI")),"^") VALMSG="Digitally Signed Order"
"RTN","PSOORNE6",119,0)
 Q
"RTN","PSORX1")
0^5^B83034701^B82763052
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;8/17/16 5:10pm
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233,268,300,170,320,326,324,334,251,454,488**;DEC 1997;Build 4
"RTN","PSORX1",3,0)
 ;
"RTN","PSORX1",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",7,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",8,0)
 ;External reference ^ORRDI1 is supported by DBIA 4659
"RTN","PSORX1",9,0)
 ;External reference ^XTMP("ORRDI" is supported by DBIA 4660
"RTN","PSORX1",10,0)
 ;External reference ^PSUHL supported by DBIA 4803
"RTN","PSORX1",11,0)
 ;
"RTN","PSORX1",12,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",13,0)
 ;
"RTN","PSORX1",14,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG,^TMP($J,"PSOTDD"),^TMP("PSORXPO",$J),^TMP("PSORXBO",$J)
"RTN","PSORX1",15,0)
 I '$G(PSOONEVA) N PSOONEVA S PSOONEVA=1
"RTN","PSORX1",16,0)
 D EOJ S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",17,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",18,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",19,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",20,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",21,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",22,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX
"RTN","PSORX1",23,0)
 G:$G(NOBG) NX
"RTN","PSORX1",24,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",25,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL")!($G(PSOFROM)="UNHOLD") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",26,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",27,0)
 D EOJ G START
"RTN","PSORX1",28,0)
END Q
"RTN","PSORX1",29,0)
 ;---------------------------------------------------------
"RTN","PSORX1",30,0)
INIT ;
"RTN","PSORX1",31,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",32,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",33,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",34,0)
INITX Q
"RTN","PSORX1",35,0)
 ;
"RTN","PSORX1",36,0)
PT ;
"RTN","PSORX1",37,0)
 K ^TMP("PSORXDC",$J),^TMP($J,"PSEXC","OUT"),CLOZPAT,DIC,PSODFN,PSOPTLK
"RTN","PSORX1",38,0)
 S PSORX("QFLG")=0,DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK
"RTN","PSORX1",39,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",40,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",41,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1
"RTN","PSORX1",42,0)
 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",43,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",44,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",45,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",46,0)
 I $G(XQY0)["PSO LMOE FINISH",'$G(MEDP),$D(^TMP($J,"PSOFLPO",PSODFN)) D
"RTN","PSORX1",47,0)
 .I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSORX1",48,0)
 .W "  ",IORVON_IOINHI,"<This patient has flagged orders>",IOINORM_IORVOFF
"RTN","PSORX1",49,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D  I PSONOAL'="" D PAUSE
"RTN","PSORX1",50,0)
 .I PSONOAL'="" W !,$C(7),"     No Allergy Assessment!"
"RTN","PSORX1",51,0)
 D REMOTE
"RTN","PSORX1",52,0)
 ; bwf - 1/9/2014 - PHARMACY INNOVATIONS, adding call and on screen message to get remote rx's from MDWS.
"RTN","PSORX1",53,0)
 I $G(PSOONEVA) D
"RTN","PSORX1",54,0)
 .N TFL,TFILIST,TFLP,TFLSITE,TFLIEN,TFLCNT,TFLDUP
"RTN","PSORX1",55,0)
 .D TFL^VAFCTFU1(.TFL,PSODFN)
"RTN","PSORX1",56,0)
 .S TFLCNT=0
"RTN","PSORX1",57,0)
 .S TFILIST="^VAMC^M&ROC^M&ROC(M&RO)^OC^OPC^CBOC^PRRTP^DOM^HCS^MC(M)^MC(M&D)^MORC^NHC^VANPH^SOC^SARRTP^"  ; only exact matches
"RTN","PSORX1",58,0)
 .S TFLP=0 F  S TFLP=$O(TFL(TFLP)) Q:'TFLP!(TFLCNT=2)  D
"RTN","PSORX1",59,0)
 ..S TFLSITE=$P(TFL(TFLP),U) Q:TFLSITE=""
"RTN","PSORX1",60,0)
 ..Q:$D(TFLDUP(TFLSITE))
"RTN","PSORX1",61,0)
 ..S TFLDUP(TFLSITE)=""
"RTN","PSORX1",62,0)
 ..Q:TFILIST'[(U_$P(TFL(TFLP),U,5)_U)
"RTN","PSORX1",63,0)
 ..S TFLCNT=$G(TFLCNT)+1
"RTN","PSORX1",64,0)
 .I $G(TFLCNT)<2 Q
"RTN","PSORX1",65,0)
 .I '$$GET1^DIQ(59,PSOSITE,3001,"I") D  Q
"RTN","PSORX1",66,0)
 ..W !!,"The OneVA Pharmacy flag is turned off. Queries will NOT"
"RTN","PSORX1",67,0)
 ..W !,"be made to other VA Pharmacy locations.",!
"RTN","PSORX1",68,0)
 .K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="locations",DIR("A",1)="Would you like to query prescriptions from other OneVA Pharmacy" D ^DIR
"RTN","PSORX1",69,0)
 .K DIR
"RTN","PSORX1",70,0)
 .Q:'Y
"RTN","PSORX1",71,0)
 .W !!,"Please wait. Checking for prescriptions at other VA Pharmacy locations. This may take a moment...",!
"RTN","PSORX1",72,0)
 .D REMOTERX^PSORRX1(PSODFN,PSOSITE)
"RTN","PSORX1",73,0)
 N PSOUPDT
"RTN","PSORX1",74,0)
 S PSOUPDT=1
"RTN","PSORX1",75,0)
 I $G(XQY0)["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",76,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",77,0)
 D:($G(XQY0)["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",78,0)
 ;
"RTN","PSORX1",79,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",80,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",81,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",82,0)
 ;Call to display remote/local prescriptions
"RTN","PSORX1",83,0)
 I '$G(PSOFIN) D RDICHK^PSORMRX(PSODFN)
"RTN","PSORX1",84,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",85,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",86,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",87,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",88,0)
 D RXSTA
"RTN","PSORX1",89,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",90,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",91,0)
 .L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",92,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",93,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",94,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",95,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",96,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",97,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="RX PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",98,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",99,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",100,0)
 ..I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",101,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",102,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",103,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",104,0)
 D ^PSOBUILD
"RTN","PSORX1",105,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",106,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",107,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",108,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",109,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",110,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",111,0)
 I $O(RXFL("")),$P(^PS(55,PSODFN,0),"^",7)="" D
"RTN","PSORX1",112,0)
 . N %
"RTN","PSORX1",113,0)
 . D NOW^%DTC
"RTN","PSORX1",114,0)
 . S $P(^PS(55,PSODFN,0),"^",7)=$E(%,1,12),$P(^(0),"^",8)="A" D LOGDFN^PSUHL(PSODFN)
"RTN","PSORX1",115,0)
PTX ;
"RTN","PSORX1",116,0)
 K X,Y,^TMP("PS",$J),^TMP($J,"PSEXC","OUT"),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR,PSOPTLK
"RTN","PSORX1",117,0)
 Q
"RTN","PSORX1",118,0)
EOJ ;
"RTN","PSORX1",119,0)
 I $G(PSODFN) K ^TMP($J,"PSOINTERVENE",PSODFN)
"RTN","PSORX1",120,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC
"RTN","PSORX1",121,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",122,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",123,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",124,0)
 K ^TMP("PSORXDD",$J),^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J),^TMP("PSORXPO",$J)
"RTN","PSORX1",125,0)
 I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",126,0)
 K ^TMP("PSORXBO",$J),PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG,^TMP($J,"PSOFLPO")
"RTN","PSORX1",127,0)
 K PPL,PPL1,PSOQFLAG ;*334 ADDED KILLS
"RTN","PSORX1",128,0)
 K ^XTMP("PSORRX1",$J),PSORCNT ;*454 added kill
"RTN","PSORX1",129,0)
 Q
"RTN","PSORX1",130,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",131,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",132,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",133,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",134,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",135,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",136,0)
 K N
"RTN","PSORX1",137,0)
 Q
"RTN","PSORX1",138,0)
PROFILE ;
"RTN","PSORX1",139,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",140,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",141,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",142,0)
 K PSOX
"RTN","PSORX1",143,0)
PROFILEX Q
"RTN","PSORX1",144,0)
 ;
"RTN","PSORX1",145,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",146,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",147,0)
 N MAIL
"RTN","PSORX1",148,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",149,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions. Please select mail"
"RTN","PSORX1",150,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",151,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",152,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",153,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",154,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",155,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",156,0)
 Q
"RTN","PSORX1",157,0)
REMOTE ; 
"RTN","PSORX1",158,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSORX1",159,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSORX1",160,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSORX1",161,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)'>IOSL) Q
"RTN","PSORX1",162,0)
 Q
"RTN","PSORX1",163,0)
PAUSE ;
"RTN","PSORX1",164,0)
 W ! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORX1",165,0)
 Q
"RTN","PSORX1",166,0)
 ;
"RTN","PSORX1",167,0)
RXSTA ; DISPLAY ELIGIBILITY & PROMPT FOR RX PATIENT STATUS
"RTN","PSORX1",168,0)
 N DA,PSOSTA
"RTN","PSORX1",169,0)
 I '$G(PSODFN) Q
"RTN","PSORX1",170,0)
 S DA=PSODFN,PSOSTA=$G(^PS(55,PSODFN,"PS"))
"RTN","PSORX1",171,0)
 I $G(XQY0)["PSO LMOE FINISH"!(XQY0["PSO LM BACKDOOR ORDERS") I PSOSTA]"" D
"RTN","PSORX1",172,0)
 .D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSORX1",173,0)
 .S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",174,0)
 .S DIC("A")="RX PATIENT STATUS: ",DIC("B")=PSOSTA,DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",175,0)
 .I +Y>0,+Y'=PSOSTA S DIE="^PS(55,",DR="3////"_+Y D ^DIE
"RTN","PSORX1",176,0)
 Q
"VER")
8.0^22.2
"BLD",10554,6)
^406
**END**
**END**

