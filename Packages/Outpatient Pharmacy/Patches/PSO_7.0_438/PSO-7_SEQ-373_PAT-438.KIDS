Released PSO*7*438 SEQ #373
Extracted from mail message
**KIDS**:PSO*7.0*438^

**INSTALL NAME**
PSO*7.0*438
"BLD",9834,0)
PSO*7.0*438^OUTPATIENT PHARMACY^0^3141016^y
"BLD",9834,1,0)
^^4^4^3141015^
"BLD",9834,1,1,0)
The new universal member ID# is not included in the description of
"BLD",9834,1,2,0)
acceptable criteria to select a patient at the VistA Outpatient
"BLD",9834,1,3,0)
selection prompt.
"BLD",9834,1,4,0)
Drug-Drug Interaction is not occurring with Non-VA Meds
"BLD",9834,4,0)
^9.64PA^^
"BLD",9834,6.3)
4
"BLD",9834,"KRN",0)
^9.67PA^779.2^20
"BLD",9834,"KRN",.4,0)
.4
"BLD",9834,"KRN",.401,0)
.401
"BLD",9834,"KRN",.402,0)
.402
"BLD",9834,"KRN",.403,0)
.403
"BLD",9834,"KRN",.5,0)
.5
"BLD",9834,"KRN",.84,0)
.84
"BLD",9834,"KRN",3.6,0)
3.6
"BLD",9834,"KRN",3.8,0)
3.8
"BLD",9834,"KRN",9.2,0)
9.2
"BLD",9834,"KRN",9.8,0)
9.8
"BLD",9834,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9834,"KRN",9.8,"NM",1,0)
PSOPATLK^^0^B6969813
"BLD",9834,"KRN",9.8,"NM",2,0)
PSODDPR5^^0^B160751448
"BLD",9834,"KRN",9.8,"NM","B","PSODDPR5",2)

"BLD",9834,"KRN",9.8,"NM","B","PSOPATLK",1)

"BLD",9834,"KRN",19,0)
19
"BLD",9834,"KRN",19.1,0)
19.1
"BLD",9834,"KRN",101,0)
101
"BLD",9834,"KRN",409.61,0)
409.61
"BLD",9834,"KRN",771,0)
771
"BLD",9834,"KRN",779.2,0)
779.2
"BLD",9834,"KRN",870,0)
870
"BLD",9834,"KRN",8989.51,0)
8989.51
"BLD",9834,"KRN",8989.52,0)
8989.52
"BLD",9834,"KRN",8994,0)
8994
"BLD",9834,"KRN","B",.4,.4)

"BLD",9834,"KRN","B",.401,.401)

"BLD",9834,"KRN","B",.402,.402)

"BLD",9834,"KRN","B",.403,.403)

"BLD",9834,"KRN","B",.5,.5)

"BLD",9834,"KRN","B",.84,.84)

"BLD",9834,"KRN","B",3.6,3.6)

"BLD",9834,"KRN","B",3.8,3.8)

"BLD",9834,"KRN","B",9.2,9.2)

"BLD",9834,"KRN","B",9.8,9.8)

"BLD",9834,"KRN","B",19,19)

"BLD",9834,"KRN","B",19.1,19.1)

"BLD",9834,"KRN","B",101,101)

"BLD",9834,"KRN","B",409.61,409.61)

"BLD",9834,"KRN","B",771,771)

"BLD",9834,"KRN","B",779.2,779.2)

"BLD",9834,"KRN","B",870,870)

"BLD",9834,"KRN","B",8989.51,8989.51)

"BLD",9834,"KRN","B",8989.52,8989.52)

"BLD",9834,"KRN","B",8994,8994)

"BLD",9834,"QDEF")
^^^^NO^^^^^^NO
"BLD",9834,"QUES",0)
^9.62^^
"BLD",9834,"REQB",0)
^9.611^3^2
"BLD",9834,"REQB",2,0)
PSO*7.0*416^2
"BLD",9834,"REQB",3,0)
PSO*7.0*348^2
"BLD",9834,"REQB","B","PSO*7.0*348",3)

"BLD",9834,"REQB","B","PSO*7.0*416",2)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
438^3141016
"PKG",206,22,1,"PAH",1,1,0)
^^4^4^3141016
"PKG",206,22,1,"PAH",1,1,1,0)
The new universal member ID# is not included in the description of
"PKG",206,22,1,"PAH",1,1,2,0)
acceptable criteria to select a patient at the VistA Outpatient
"PKG",206,22,1,"PAH",1,1,3,0)
selection prompt.
"PKG",206,22,1,"PAH",1,1,4,0)
Drug-Drug Interaction is not occurring with Non-VA Meds
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSODDPR5")
0^2^B160751448^B160645085
"RTN","PSODDPR5",1,0)
PSODDPR5 ;BIR/SAB - displays OP/rdi/pending/nva orders ;09/320/06 11:33am
"RTN","PSODDPR5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251,375,379,390,372,416,438**;DEC 1997;Build 4
"RTN","PSODDPR5",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODDPR5",4,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSODDPR5",5,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODDPR5",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228 
"RTN","PSODDPR5",7,0)
 ;
"RTN","PSODDPR5",8,0)
EXC ;displays order check exceptions
"RTN","PSODDPR5",9,0)
 N Q,CT,ONT,OT,ON,TD,ERRTY,OP,OPP,ZEXC,ZREA,X,DIWL,DIWR,DIWF,PSOWROTE
"RTN","PSODDPR5",10,0)
 I ($Y+5)'>IOSL D HD^PSODDPR2() Q:$G(PSODLQT)  ;W @IOF
"RTN","PSODDPR5",11,0)
 S (CT,Q)=0,ONT=""
"RTN","PSODDPR5",12,0)
 F  S ONT=$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT)) Q:ONT=""  F  S CT=$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT)) Q:'CT  D
"RTN","PSODDPR5",13,0)
 .S ZEXC=^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),ZREA=$P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",10)
"RTN","PSODDPR5",14,0)
 .S OT=$P(ONT,";"),ON=$P(ONT,";",2),OP=$P(ONT,";",3),OPP=OT_";"_ON_";"_OP
"RTN","PSODDPR5",15,0)
 .I '$D(PSODGCK),'$D(PSSDGCK),OT="Z",ZREA="Drug not matched to NDF"!($P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",7)["manual check") S PSODRUG("BAD",PSODRUG("IEN"))=1
"RTN","PSODDPR5",16,0)
 .Q:$G(^TMP($J,"PSEXC","OUT",OPP))
"RTN","PSODDPR5",17,0)
 .S Q=Q+1,ERRTY=$S(OT="R":"RDI",OT="N":"Non-VA",OT="P":"Pending",OT="O":"Rx",1:"")
"RTN","PSODDPR5",18,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR5",19,0)
 .W ! S X=$P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",7) D ^DIWP
"RTN","PSODDPR5",20,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0) S PSOWROTE=1
"RTN","PSODDPR5",21,0)
 .I $D(PSODGCK)!$D(PSSDGCK) K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." W ! D ^DIR K DIR W @IOF
"RTN","PSODDPR5",22,0)
 .S:OT'="Z" ^TMP($J,"PSEXC","OUT",OPP)=1,PSOWROTE=1
"RTN","PSODDPR5",23,0)
 .Q:ZREA=""
"RTN","PSODDPR5",24,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR5",25,0)
 .S X="   Reason(s): "_ZREA D ^DIWP
"RTN","PSODDPR5",26,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0) S PSOWROTE=1
"RTN","PSODDPR5",27,0)
 .K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF
"RTN","PSODDPR5",28,0)
 .D:$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT)) HD^PSODDPR2() Q:$G(PSODLQT)
"RTN","PSODDPR5",29,0)
 W !! I $G(PSOWROTE) K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR S:($D(DTOUT))!($D(DUOUT)) PSODLQT=1,PSORX("DFLG")=1 W ! K DIR,X,Y I ($Y+5)>IOSL W @IOF
"RTN","PSODDPR5",30,0)
 Q
"RTN","PSODDPR5",31,0)
NOCAN ;shows duplicate therapeutic when cancel duplicate class parameter is et to 'no'
"RTN","PSODDPR5",32,0)
 K ^UTILITY($J,"W"),DDTH,DOCPL S DIWL=1,DIWR=78,DIWF="",(CT,SUB)=0 K TCT,TCTP,TCTL,TCTI,ZZQ,ZHDR
"RTN","PSODDPR5",33,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D
"RTN","PSODDPR5",34,0)
 .S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^"),PDRG=$P(^(SUB),"^",3),RXREC=$P(ON,";",2)
"RTN","PSODDPR5",35,0)
 .I $G(PSODCTH(ON)) Q
"RTN","PSODDPR5",36,0)
 .I $P(ON,";")="Z" Q
"RTN","PSODDPR5",37,0)
 .I $P(ON,";")="N",$G(^TMP($J,"PSONVADD",RXREC,0)) Q
"RTN","PSODDPR5",38,0)
 .I $P(ON,";")="R",$G(^TMP($J,"PSORMDD",RXREC,0)) Q
"RTN","PSODDPR5",39,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",40,0)
 .I $P(ON,";")="P",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",41,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDD",$J,RXREC,0)) Q
"RTN","PSODDPR5",42,0)
 .I '$G(ZHDR) D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !,PSONULN,!,"*** THERAPEUTIC DUPLICATION(S) *** "_PSODRUG("NAME")_" with",! S ZHDR=1
"RTN","PSODDPR5",43,0)
 Q:'$G(ZHDR)  Q:$G(PSODLQT)
"RTN","PSODDPR5",44,0)
 N ST,STA,STAT,ORT K DOCPL
"RTN","PSODDPR5",45,0)
 S (SUB,CT)=0 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D DUPCL K DDTH
"RTN","PSODDPR5",46,0)
 D DUPCP
"RTN","PSODDPR5",47,0)
 Q
"RTN","PSODDPR5",48,0)
DUPCL ;
"RTN","PSODDPR5",49,0)
 S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^"),PDRG=$P(^(SUB),"^",3),RXREC=$P(ON,";",2)
"RTN","PSODDPR5",50,0)
 I $P(ON,";")="Z" Q
"RTN","PSODDPR5",51,0)
 I $P(ON,";")="N",$G(^TMP($J,"PSONVADD",RXREC,0)) Q
"RTN","PSODDPR5",52,0)
 I $P(ON,";")="R",$G(^TMP($J,"PSORMDD",RXREC,0)) Q
"RTN","PSODDPR5",53,0)
 I $P(ON,";")="O",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",54,0)
 I $P(ON,";")="P",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",55,0)
 I $P(ON,";")="O",$G(^TMP("PSORXDD",$J,RXREC,0)) Q
"RTN","PSODDPR5",56,0)
 S ORT=$S($P(ON,";")="N":4,$P(ON,";")="P":3,$P(ON,";")="R":2,1:1)
"RTN","PSODDPR5",57,0)
 S DOCPL(ORT,ON)=""
"RTN","PSODDPR5",58,0)
 Q
"RTN","PSODDPR5",59,0)
DUPCP D HD^PSODDPR2():(($Y+5)'>IOSL) S ORT=0,ON=""  F  S ORT=$O(DOCPL(ORT)) Q:'ORT!$G(PSODLQT)  F  S ON=$O(DOCPL(ORT,ON)) Q:ON=""!$G(PSODLQT)  D
"RTN","PSODDPR5",60,0)
 .I $P(ON,";")="O" D
"RTN","PSODDPR5",61,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S ST=$P(^PSRX($P(ON,";",2),"STA"),"^")+1
"RTN","PSODDPR5",62,0)
 ..S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^^EXPIRED^DISCONTINUED^^DISCONTINUED BY PROVIDER^DISCONTINUE EDIT^PROVIDER HOLD"
"RTN","PSODDPR5",63,0)
 ..S STAT=$P(STA,"^",ST) W !?2,"Local Rx #"_$P(^PSRX($P(ON,";",2),0),"^")_" ("_STAT_") for "_$P(^PSDRUG($P(^PSRX($P(ON,";",2),0),"^",6),0),"^")
"RTN","PSODDPR5",64,0)
 .I $P(ON,";")="P" D
"RTN","PSODDPR5",65,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",66,0)
 ..S RXREC=$P(ON,";",2),DNM=$P(^PS(52.41,RXREC,0),"^",9)
"RTN","PSODDPR5",67,0)
 ..S DUPRX0=^PS(52.41,RXREC,0)
"RTN","PSODDPR5",68,0)
 ..W !?2,"Pending Order for "
"RTN","PSODDPR5",69,0)
 ..I '$P(DUPRX0,"^",9) W $P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR5",70,0)
 ..E  W $P(^PSDRUG($P(DUPRX0,"^",9),0),"^")
"RTN","PSODDPR5",71,0)
 .I $P(ON,";")="R" N RXDAT D
"RTN","PSODDPR5",72,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",73,0)
 ..S RXDAT=^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2))
"RTN","PSODDPR5",74,0)
 ..S RDIRX=$P(RXDAT,"^",5) D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !?2,"Remote Rx #"_RDIRX_" ("_$P(RXDAT,"^",4)_") for "_$P(RXDAT,"^",3)
"RTN","PSODDPR5",75,0)
 .I $P(ON,";")="N" D
"RTN","PSODDPR5",76,0)
 ..Q:'$D(^PS(55,PSODFN,"NVA",$P(ON,";",2),0))
"RTN","PSODDPR5",77,0)
 ..S DUPRX0=^PS(55,PSODFN,"NVA",$P(ON,";",2),0) N NVAQ
"RTN","PSODDPR5",78,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",79,0)
 ..W !?2,"Non-VA Med for "
"RTN","PSODDPR5",80,0)
 ..I '$P(DUPRX0,"^",2) W $P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR5",81,0)
 ..E  W $P(^PSDRUG($P(DUPRX0,"^",2),0),"^")
"RTN","PSODDPR5",82,0)
 .S DDTH(ON)=1
"RTN","PSODDPR5",83,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",84,0)
 D CLASSES^PSODDPR3
"RTN","PSODDPR5",85,0)
 D HD^PSODDPR2(0,1) Q:$G(PSODLQT)
"RTN","PSODDPR5",86,0)
 Q
"RTN","PSODDPR5",87,0)
REMOTE ;backdoor RDI
"RTN","PSODDPR5",88,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR5",89,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,LIST,"OUT","REMOTE",PSORDI)) Q:'PSORDI!$G(PSODLQT)  S RDITMP=^(PSORDI) D  K PSOSEQN
"RTN","PSODDPR5",90,0)
 .I $P(RDITMP,"^",2)="" Q
"RTN","PSODDPR5",91,0)
 .S RDIVUID=$P(RDITMP,"^",2),RDIDNAM=$P(RDITMP,"^",3)
"RTN","PSODDPR5",92,0)
 .I $O(PDRG(0)) F ZI=0:0 S ZI=$O(PDRG(ZI)) Q:'ZI  I $P(^PSDRUG($P(PDRG(ZI),"^"),0),"^")=RDIDNAM S INDD=+$G(INDD)+1,^TMP($J,"DD",INDD,0)=$P(PDRG(ZI),"^")_"^"_RDIDNAM_"^^"_PSORDI_"Z;O"
"RTN","PSODDPR5",93,0)
 .S DO=$G(DO)+1 D GETIREF^XTID(50.68,.01,RDIVUID,"PSOSEQN",1) I 'PSOSEQN S ^TMP($J,LIST,"IN","PROFILE","R;"_PSORDI_";PROFILE;"_DO)=0_"^"_RDIVUID_"^0^"_RDIDNAM_"^^" Q
"RTN","PSODDPR5",94,0)
 .S SEQN="" S SEQN=$O(PSOSEQN(50.68,.01,SEQN)) Q:SEQN=""
"RTN","PSODDPR5",95,0)
 .S P3=+SEQN,SEQN=$P($$PROD0^PSNAPIS(,P3),"^",7)
"RTN","PSODDPR5",96,0)
 .S ^TMP($J,LIST,"IN","PROFILE","R;"_PSORDI_";PROFILE;"_DO)=SEQN_"^"_RDIVUID_"^0^"_RDIDNAM_"^^"
"RTN","PSODDPR5",97,0)
 Q
"RTN","PSODDPR5",98,0)
NSRT ;sort of drug interactions ; called by psoddpr2
"RTN","PSODDPR5",99,0)
 ;Q:$G(PSODLQT)
"RTN","PSODDPR5",100,0)
 N SV,SEV,STOP,TYP,CNT,CHK,DRG,ON,CT,ZOT,PSOVAG,PSODD,COUNT,NSRT,NSRT2 S COUNT=0,(SV,DRG,ON,CT,PSOVAG)=""
"RTN","PSODDPR5",101,0)
 F  S SV=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV)) Q:SV=""!$G(PSODLQT)  D  Q:$G(PSORX("DFLG"))
"RTN","PSODDPR5",102,0)
 .F  S DRG=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG)) Q:DRG=""!$G(PSODLQT)  F  S ON=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON)) Q:ON=""!$G(PSODLQT)  F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT!$G(PSODLQT)  D
"RTN","PSODDPR5",103,0)
 ..I $P(ON,";")'="Z",$P(ON,";")="O",$P(^PSRX($P(ON,";",2),"STA"),"^")>5,$P(^PSRX($P(ON,";",2),"STA"),"^")'=16 Q
"RTN","PSODDPR5",104,0)
 ..I $P(ON,";")'="Z",$P(ON,";")="R" D RVAGEN Q
"RTN","PSODDPR5",105,0)
 ..I $P(ON,";")'="Z",$P(ON,";")="P",'$P($G(^PS(52.41,$P(ON,";",2),0)),"^",9) S PSORDIT=$P($G(^PS(52.41,$P(ON,";",2),0)),"^",8) D:$G(PSORDIT) DVAGEN Q
"RTN","PSODDPR5",106,0)
 ..I $P(ON,";")'="Z",$P(ON,";")="N",'$P($G(^PS(55,PSODFN,"NVA",$P(ON,";",2),0)),"^",2) S PSORDIT=$P($G(^PS(55,PSODFN,"NVA",$P(ON,";",2),0)),"^") D:$G(PSORDIT) DVAGEN ;Q  ;*438
"RTN","PSODDPR5",107,0)
 ..S PSODD=$O(^PSDRUG("B",DRG,0)) D:PSODD'="" VAGEN^PSODDPR3(PSODD)
"RTN","PSODDPR5",108,0)
 ..S:PSOVAG="" PSOVAG=DRG
"RTN","PSODDPR5",109,0)
 ..S ZOT=$S($P(ON,";")["C":1,$P(ON,";")="O":2,$P(ON,";")="R":3,$P(ON,";")="P":4,1:5)
"RTN","PSODDPR5",110,0)
 ..S ZDGDG(SV,ZOT,PSOVAG,DRG)=ON_"^"_CT
"RTN","PSODDPR5",111,0)
 ..I ZOT=1 S PSOCLNS(SV,PSOVAG,DRG,ON)=CT
"RTN","PSODDPR5",112,0)
 ..I '$D(NSRT(SV,PSOVAG)) S NSRT(SV,PSOVAG)=ZOT
"RTN","PSODDPR5",113,0)
 ..E  S $P(NSRT(SV,PSOVAG),"^",1)=$P(NSRT(SV,PSOVAG),"^",1)_","_ZOT
"RTN","PSODDPR5",114,0)
 ;resort of zdgdg
"RTN","PSODDPR5",115,0)
 K ZZDGDG S (SEV,STOP,PSOVAG,TYP,ON)="",CNT=0
"RTN","PSODDPR5",116,0)
 F J=1:1:5 F  S SEV=$O(NSRT(SEV)) Q:SEV=""  F I=1:1:5 F  S PSOVAG=$O(NSRT(SEV,PSOVAG)) Q:PSOVAG=""  D
"RTN","PSODDPR5",117,0)
 .S TYP="",TYP=","_$P(NSRT(SEV,PSOVAG),"^",1)_","
"RTN","PSODDPR5",118,0)
 .Q:TYP'[(","_J_",")
"RTN","PSODDPR5",119,0)
 .S STOP=0 F CHK=1:1:5 I TYP[(","_CHK_",")&(CHK<J) S STOP=1
"RTN","PSODDPR5",120,0)
 .Q:STOP
"RTN","PSODDPR5",121,0)
 .S CNT=CNT+1 F I=J:1:5 S TYP=I I $D(ZDGDG(SEV,TYP)) D S2(SEV,TYP,PSOVAG,CNT)
"RTN","PSODDPR5",122,0)
 K NSRT,J,F,ZDGDG,COUNT,CNT
"RTN","PSODDPR5",123,0)
 Q
"RTN","PSODDPR5",124,0)
 ;print order sort
"RTN","PSODDPR5",125,0)
S2(SEV,TYP,PSOVAG,CNT) ;
"RTN","PSODDPR5",126,0)
 N PSONAM,COUNT2 S (PSONAM)="",COUNT2=0
"RTN","PSODDPR5",127,0)
 F  S PSONAM=$O(ZDGDG(SEV,TYP,PSOVAG,PSONAM)) Q:PSONAM=""  S COUNT2=COUNT2+1 D
"RTN","PSODDPR5",128,0)
 .S:$G(ZZDGDG2(SEV,PSOVAG)) ZZDGDG2(SEV,PSOVAG)=ZZDGDG2(SEV,PSOVAG)+1 S:'$G(ZZDGDG2(SEV,PSOVAG)) ZZDGDG2(SEV,PSOVAG)=1
"RTN","PSODDPR5",129,0)
 .S ZZDGDG(SEV,CNT,TYP,PSOVAG,PSONAM)=ZDGDG(SEV,TYP,PSOVAG,PSONAM)
"RTN","PSODDPR5",130,0)
 .S ZZDGCK(SEV,CNT,TYP,PSOVAG,PSONAM)=ZDGDG(SEV,TYP,PSOVAG,PSONAM)
"RTN","PSODDPR5",131,0)
 Q
"RTN","PSODDPR5",132,0)
 ;
"RTN","PSODDPR5",133,0)
NSRT1 ;sort out dc'd drug therapies local and remote rxs
"RTN","PSODDPR5",134,0)
 S (SUB,CT)=0 K PSODCTH N RXN
"RTN","PSODDPR5",135,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D
"RTN","PSODDPR5",136,0)
 .S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^")
"RTN","PSODDPR5",137,0)
 .I $P(ON,";")="O",$P($G(^PSRX($P(ON,";",2),3)),"^",5) D  Q
"RTN","PSODDPR5",138,0)
 ..S RXN=$P(ON,";",2),X1=$P($G(^PSRX($P(ON,";",2),3)),"^",5),X2=(+$P(^PSRX($P(ON,";",2),0),"^",8)+7)
"RTN","PSODDPR5",139,0)
 ..D C^%DTC I X<DT S PSODCTH(ON)=1 K X,Y,X1,X2
"RTN","PSODDPR5",140,0)
 .I $P(ON,";")="R",$P($G(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2))),"^",4)["DISC" D
"RTN","PSODDPR5",141,0)
 ..S RXN=$P(ON,";",2) K X,Y,X1,X2
"RTN","PSODDPR5",142,0)
 ..S X=$P(^TMP($J,LIST,"OUT","REMOTE",RXN),"^",6) D ^%DT S X1=Y,X2=(+$P(^TMP($J,LIST,"OUT","REMOTE",RXN),"^",7)+7)
"RTN","PSODDPR5",143,0)
 ..D C^%DTC I X<DT S PSODCTH(ON)=1 K X,Y,X1,X2
"RTN","PSODDPR5",144,0)
 Q
"RTN","PSODDPR5",145,0)
 ;
"RTN","PSODDPR5",146,0)
RVAGEN ;va generic for remote drugs
"RTN","PSODDPR5",147,0)
 N PSOVIUD,PSONDF,PSOVAG,DIC
"RTN","PSODDPR5",148,0)
 S PSOVUID=$P(^TMP($J,"PSOPEPS","OUT","REMOTE",$P(ON,";",2)),"^",2) Q:'$G(PSOVUID)
"RTN","PSODDPR5",149,0)
 K PSORDIID S PSOVAGEN="" D GETIREF^XTID("50.68",".01",PSOVUID,"PSORDIID")
"RTN","PSODDPR5",150,0)
 S PSONDF=$O(PSORDIID(50.68,.01,"")) K PSORDIID
"RTN","PSODDPR5",151,0)
 I +PSONDF D DATA^PSN50P68(+PSONDF,,"PSONDF") S PSOVAG=$P($G(^TMP($J,"PSONDF",+PSONDF,.05)),U,2),ZDGDG(SV,2,PSOVAG,DRG)=ON_"^"_CT
"RTN","PSODDPR5",152,0)
 K ^TMP($J,"PSONDF")
"RTN","PSODDPR5",153,0)
 Q
"RTN","PSODDPR5",154,0)
 ;
"RTN","PSODDPR5",155,0)
DVAGEN ;va generic for non-va/pending meds
"RTN","PSODDPR5",156,0)
 S PSI=0 N PSID,PSODD,PSOVAG
"RTN","PSODDPR5",157,0)
 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["X":0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",158,0)
 I PSI="" S PSI=0 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",159,0)
 I PSI="" S PSI=0 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["U":0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",160,0)
 I PSI="" S PSI=0 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["I":0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",161,0)
 I PSI="" S PSI=0 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S('$L($P($G(^PSDRUG(PSI,2)),"^",3)):0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",162,0)
 I PSI="" S PSI=0 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI!($G(PSID)'="")  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($L($P($G(^PSDRUG(PSI,2)),"^",3)):0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^")
"RTN","PSODDPR5",163,0)
 Q:$G(PSID)']""
"RTN","PSODDPR5",164,0)
 S PSODD=$O(^PSDRUG("B",PSID,0)) D VAGEN^PSODDPR3(PSODD)
"RTN","PSODDPR5",165,0)
 Q:$G(PSOVAG)']""
"RTN","PSODDPR5",166,0)
 S ZOT=$S($P(ON,";")="O":1,$P(ON,";")="R":2,$P(ON,";")="P":3,1:4),ZDGDG(SV,ZOT,PSOVAG,DRG)=ON_"^"_CT,COUNT=COUNT+1
"RTN","PSODDPR5",167,0)
 K PSI,PSID,PSORDIT,PSODD,PSOVAG
"RTN","PSODDPR5",168,0)
 Q
"RTN","PSODDPR5",169,0)
 ;
"RTN","PSODDPR5",170,0)
INT ;
"RTN","PSODDPR5",171,0)
 I $G(PSOVORD),$P(PSOINTV,"^")=1 D  Q
"RTN","PSODDPR5",172,0)
 .K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODDPR5",173,0)
 .W ! S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Continue? ",DIR("B")="Y" D ^DIR S:($D(DTOUT))!($D(DUOUT))!($G(DIRUT)) PSODLQT=1,PSORX("DFLG")=1 Q:$G(PSODLQT)
"RTN","PSODDPR5",174,0)
 .K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODDPR5",175,0)
 .I 'Y S PSODLQT=1,PSORX("DFLG")=1 Q
"RTN","PSODDPR5",176,0)
 .S DA=PSONV,RXREC=DA,RX=$G(^PSRX(RXREC,0)),PSORX("INTERVENE")=1
"RTN","PSODDPR5",177,0)
 .D:'$D(PSODGCK) CRI^PSODGDG1
"RTN","PSODDPR5",178,0)
 .I $G(OLDDA) S DA=OLDDA K OLDDA
"RTN","PSODDPR5",179,0)
 Q:$G(PSODLQT)!($G(PSORX("DFLG")))
"RTN","PSODDPR5",180,0)
 I '$D(PSODGCK),$P(PSOINTV,"^") S IT=$P(PSOINTV,"^"),ON=$P(PSOINTV,"^",2) D ^PSODGDGP K DIR S IT=$P(PSOINTV,"^")
"RTN","PSODDPR5",181,0)
 Q
"RTN","PSODDPR5",182,0)
 ;
"RTN","PSODDPR5",183,0)
DGCK ;CK - Drug check option at patient profile
"RTN","PSODDPR5",184,0)
 I '$D(PSOSD) D FULL^VALM1 W !!,"Not enough drugs found in profile!",! K DIR S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR G DGCKQ
"RTN","PSODDPR5",185,0)
 S PSODGCK=1
"RTN","PSODDPR5",186,0)
 D FULL^VALM1
"RTN","PSODDPR5",187,0)
 D PSOCK^PSOUTL
"RTN","PSODDPR5",188,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." W ! D ^DIR K DIR W @IOF,!
"RTN","PSODDPR5",189,0)
 D SELECT
"RTN","PSODDPR5",190,0)
 I $G(PSONEW("DFLG"))=1!'$D(PSOSD) W ! G DGCKQ
"RTN","PSODDPR5",191,0)
 D SET^PSODRG
"RTN","PSODDPR5",192,0)
DGCKNP D POST^PSODRG
"RTN","PSODDPR5",193,0)
DGCKQ S VALMBCK="R"
"RTN","PSODDPR5",194,0)
 K PSODGCK,PSODGCKX,MON,PSONEW("DFLG"),PSORX("DFLG"),PSOIENID,PSOGCNPT,PSOGCNID,PSONDFID,DGCKDUPF
"RTN","PSODDPR5",195,0)
 Q
"RTN","PSODDPR5",196,0)
 ;
"RTN","PSODDPR5",197,0)
GCN(PSOIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSODDPR5",198,0)
 N PSONDFID,PSOGCNPT,PSOGCNID
"RTN","PSODDPR5",199,0)
 S PSONDFID=$P($G(^PSDRUG(PSOIENID,"ND")),"^"),PSOGCNPT=$P($G(^PSDRUG(PSOIENID,"ND")),"^",3)
"RTN","PSODDPR5",200,0)
 I 'PSONDFID!('PSOGCNPT) Q 0
"RTN","PSODDPR5",201,0)
 S PSOGCNID=$$PROD0^PSNAPIS(PSONDFID,PSOGCNPT)
"RTN","PSODDPR5",202,0)
 I $P(PSOGCNID,"^",7) Q PSOIENID_";"_PSONDFID_";"_$P(PSOGCNID,"^",7)
"RTN","PSODDPR5",203,0)
 Q PSOIENID_";"_PSONDFID
"RTN","PSODDPR5",204,0)
 ;
"RTN","PSODDPR5",205,0)
PKGFLG(PKF1) ;Return 0 for not in range of acceptable package flags, 1 for within range
"RTN","PSODDPR5",206,0)
 I $S(PKF1["O":1,1:0) Q 1
"RTN","PSODDPR5",207,0)
 I $S(PKF1["X":1,1:0) Q 1
"RTN","PSODDPR5",208,0)
 Q 0
"RTN","PSODDPR5",209,0)
 ;
"RTN","PSODDPR5",210,0)
SELECT ;
"RTN","PSODDPR5",211,0)
 N PSODGCKD S PSODGCKD=0 K:'$G(PSORXED) CLOZPAT
"RTN","PSODDPR5",212,0)
 K IT,DIC,X,Y,PSODRUG("TRADE NAME"),PSODRUG("NDC"),PSODRUG("DAW"),PSODRUG("BAD") S:$G(POERR)&($P($G(OR0),"^",9)) Y=$P(^PSDRUG($P(OR0,"^",9),0),"^")
"RTN","PSODDPR5",213,0)
 I $G(PSODRUG("IEN"))]"",'$D(PSODGCK) S Y=PSODRUG("NAME"),PSONEW("OLD VAL")=PSODRUG("IEN")
"RTN","PSODDPR5",214,0)
 W !,"DRUG: " R X:$S($D(DTIME):DTIME,1:300) I '$T S DTOUT=1
"RTN","PSODDPR5",215,0)
 I PSODGCK,X="",PSOSD<2 W !!,"Not enough drugs found in profile!",! K DIR S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODDPR5",216,0)
 S:X="" PSODGCKX=1
"RTN","PSODDPR5",217,0)
 I X="",$G(Y)]"" S:Y X=Y S:'X X=$G(PSODRUG("IEN")) S:X X="`"_X
"RTN","PSODDPR5",218,0)
 I X="",$D(PSOSD) S X=$O(PSOSD($O(PSOSD("")),"")),PSODGCKD=1
"RTN","PSODDPR5",219,0)
 I X="",'$D(PSOSD) D  Q
"RTN","PSODDPR5",220,0)
 .W !!,"Now Processing Enhanced Order Checks!  Please wait..." H 1
"RTN","PSODDPR5",221,0)
 .W !!,"No Order Check Warnings Found",! K DIR S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR
"RTN","PSODDPR5",222,0)
 I X?1."?" W !!,"Answer with DRUG NUMBER, or GENERIC NAME, or VA PRODUCT NAME, or",!,"NATIONAL DRUG CLASS, or SYNONYM" G SELECT
"RTN","PSODDPR5",223,0)
 I $G(PSORXED),X["^" S PSORXED("DFLG")=1 G SELECTX
"RTN","PSODDPR5",224,0)
 I X="^"!(X["^^")!($D(DTOUT)) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODDPR5",225,0)
 I '$G(POERR),X[U,$L(X)>1 S PSODIR("FLD")=PSONEW("FLD") D JUMP^PSODIR1 S:$G(PSODIR("FIELD")) PSONEW("FIELD")=PSODIR("FIELD") K PSODIR S PSODRG("QFLG")=1 G SELECTX
"RTN","PSODDPR5",226,0)
 S DIC=50,DIC(0)="MZV",D="B^C^VAPN^VAC"
"RTN","PSODDPR5",227,0)
 I 'PSODGCKD S DIC=50,DIC(0)="EMQZVT",DIC("T")="",D="B^C^VAPN^VAC"
"RTN","PSODDPR5",228,0)
 S DIC("S")="I $S('$D(^PSDRUG(+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$$GCN^PSODDPR5(+Y),$$PKGFLG^PSODDPR5($P($G(^PSDRUG(+Y,2)),""^"",3)),$D(^PSDRUG(""ASP"",+$G(^(2)),+Y))"
"RTN","PSODDPR5",229,0)
 D MIX^DIC1 K DIC,PKF1,D
"RTN","PSODDPR5",230,0)
 I $$PSOSUPCK^PSOUTL(+Y) G SELECT
"RTN","PSODDPR5",231,0)
 S (DGCKSTA,DGCKDNM)=""
"RTN","PSODDPR5",232,0)
 I '$D(PSODGCKX),$D(PSOSD) F  S DGCKSTA=$O(PSOSD(DGCKSTA)) Q:DGCKSTA=""!$G(DGCKDUPF)  F  S DGCKDNM=$O(PSOSD(DGCKSTA,DGCKDNM)) Q:DGCKDNM=""!$G(DGCKDUPF)  D
"RTN","PSODDPR5",233,0)
 .I DGCKDNM=$G(Y(0,0)) D
"RTN","PSODDPR5",234,0)
 ..S DGCKDUPF=1 W !!,"Duplicate Drug in Patient profile, please select a different drug:",!
"RTN","PSODDPR5",235,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSODDPR5",236,0)
 I $D(DGCKDUPF) K DGCKDUPF,PSODGCKX G SELECT
"RTN","PSODDPR5",237,0)
 I '$D(PSOSD) D  Q
"RTN","PSODDPR5",238,0)
 .W !!,"Now Processing Enhanced Order Checks!  Please wait..." H 1
"RTN","PSODDPR5",239,0)
 .W !!,"No Order Check Warnings Found",! K DIR S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR
"RTN","PSODDPR5",240,0)
 I $D(DTOUT) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODDPR5",241,0)
 I $D(DUOUT) K DUOUT G SELECT
"RTN","PSODDPR5",242,0)
 I Y<0 G SELECT
"RTN","PSODDPR5",243,0)
 S:$G(PSONEW("OLD VAL"))=+Y&('$G(PSOEDIT)) PSODRG("QFLG")=1
"RTN","PSODDPR5",244,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSODDPR5",245,0)
 I $P(PSOY(0),"^")="OTHER DRUG"!($P(PSOY(0),"^")="OUTSIDE DRUG") D TRADE^PSODRG
"RTN","PSODDPR5",246,0)
SELECTX K X,Y,DTOUT,DUOUT,PSONEW("OLD VAL"),PSODGCKD,DGCKDNM,DGCKSTA
"RTN","PSODDPR5",247,0)
 Q
"RTN","PSODDPR5",248,0)
 ;
"RTN","PSOPATLK")
0^1^B6969813^B5993258
"RTN","PSOPATLK",1,0)
PSOPATLK ;BIR/JAM - Patient Lookup utility ;7/21/08
"RTN","PSOPATLK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**326,348,438**;DEC 1997;Build 4
"RTN","PSOPATLK",3,0)
 ;
"RTN","PSOPATLK",4,0)
 ; This API looks for a patient using a prescription number, barcode,
"RTN","PSOPATLK",5,0)
 ; universal Member ID number from the patient's VHIC Card
"RTN","PSOPATLK",6,0)
 ; or the registration standard patient lookup.
"RTN","PSOPATLK",7,0)
 ;
"RTN","PSOPATLK",8,0)
EN ;Entry point - Prompts for Patient, Prescription Number or Barcode
"RTN","PSOPATLK",9,0)
 ; 
"RTN","PSOPATLK",10,0)
 ; Input  - DIC(0) & DIC("A") [Optional] 
"RTN","PSOPATLK",11,0)
 ;          Used by DIR if defined by the calling routine.
"RTN","PSOPATLK",12,0)
 ;
"RTN","PSOPATLK",13,0)
 ; Output - PSOPTLK [Processed user response]
"RTN","PSOPATLK",14,0)
 ;
"RTN","PSOPATLK",15,0)
 N DIR
"RTN","PSOPATLK",16,0)
 K PSOPTLK
"RTN","PSOPATLK",17,0)
 S DIR(0)="FOU"_$S($D(DIC("A")):"A",1:"")_"^^K:$$PATVAL^PSOPATLK() X"
"RTN","PSOPATLK",18,0)
 S DIR("A")=$S($D(DIC("A")):DIC("A"),1:"Select PATIENT NAME")
"RTN","PSOPATLK",19,0)
 S (DIR("?"),DIR("??"))="^D PATHLP^PSOPATLK"
"RTN","PSOPATLK",20,0)
 D ^DIR
"RTN","PSOPATLK",21,0)
 M PSOPTLK=Y
"RTN","PSOPATLK",22,0)
 K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PSOPATLK",23,0)
 Q
"RTN","PSOPATLK",24,0)
PATHLP ;Help text for patient prompt
"RTN","PSOPATLK",25,0)
 N DIC
"RTN","PSOPATLK",26,0)
 I $E(X)'="?" Q
"RTN","PSOPATLK",27,0)
 I X="?" D
"RTN","PSOPATLK",28,0)
 .W !?1,"Enter the prescription number prefixed by a # (ex. #XXXXXXX) or"
"RTN","PSOPATLK",29,0)
 .W !?1,"Wand the barcode of the prescription. The format of the barcode is"
"RTN","PSOPATLK",30,0)
 .W !?1,"NNN-NNNNNNN where the first 3 digits are your station number."
"RTN","PSOPATLK",31,0)
 .W !?1,"         - OR -           "
"RTN","PSOPATLK",32,0)
 .W !?1,"Enter the universal Member ID number from the patient's VHIC Card"
"RTN","PSOPATLK",33,0)
 .W !?1,"or wand the barcode of the VHIC card"
"RTN","PSOPATLK",34,0)
 .W !?1,"         - OR -           "
"RTN","PSOPATLK",35,0)
 S DIC="^DPT(",DIC(0)="QZEXN" D ^DIC
"RTN","PSOPATLK",36,0)
 Q
"RTN","PSOPATLK",37,0)
 ;
"RTN","PSOPATLK",38,0)
PATVAL() ;Validate user input
"RTN","PSOPATLK",39,0)
 N OUT
"RTN","PSOPATLK",40,0)
 S OUT=0
"RTN","PSOPATLK",41,0)
 ;Prescription lookup
"RTN","PSOPATLK",42,0)
 I X?1"#".E D RXLK Q OUT
"RTN","PSOPATLK",43,0)
 ;Barcode lookup
"RTN","PSOPATLK",44,0)
 I X?3N1"-".N D RXLK Q OUT
"RTN","PSOPATLK",45,0)
 ;Standard patient lookup
"RTN","PSOPATLK",46,0)
 S DIC="^DPT(" S:'$D(DIC(0)) DIC(0)="QEMZ" D ^DIC
"RTN","PSOPATLK",47,0)
 S OUT=$S(+Y>0:0,1:1)
"RTN","PSOPATLK",48,0)
 Q OUT
"RTN","PSOPATLK",49,0)
 ;
"RTN","PSOPATLK",50,0)
RXLK ;Prescription Lookup
"RTN","PSOPATLK",51,0)
 N DFN,DIC,RXNUM,RX,Z
"RTN","PSOPATLK",52,0)
 S RXNUM=X,RX=$S($E(RXNUM)="#":$E(RXNUM,2,999999999),1:$P(RXNUM,"-",2))
"RTN","PSOPATLK",53,0)
 I RX="" W !,$C(7),"No prescription number entered." S OUT=1 Q
"RTN","PSOPATLK",54,0)
 I $E(RXNUM)'="#",$P(RXNUM,"-")'=$$INST() D  S OUT=1 Q
"RTN","PSOPATLK",55,0)
 .W !!,$C(7),"This prescription is not from this institution."
"RTN","PSOPATLK",56,0)
 S Z=$S($E(RXNUM)="#":$O(^PSRX("B",RX,0)),1:RX),Y=$G(^PSRX(+Z,0))
"RTN","PSOPATLK",57,0)
 I (Y="")!(Z="") D  S OUT=1 Q
"RTN","PSOPATLK",58,0)
 .W !,$C(7),"No Prescription Record found"_$S($E(RXNUM)="#":".",1:" for this barcode.")
"RTN","PSOPATLK",59,0)
 S DFN=$P(Y,"^",2) K Y
"RTN","PSOPATLK",60,0)
 N DIC,X S DIC="^DPT(",DIC(0)="QZEXN" S X=DFN D ^DIC
"RTN","PSOPATLK",61,0)
 Q 
"RTN","PSOPATLK",62,0)
INST() ;get institution number
"RTN","PSOPATLK",63,0)
 N PSOINST,DA,DIQ
"RTN","PSOPATLK",64,0)
 S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOPATLK",65,0)
 S PSOINST=$$GET1^DIQ(4,DA,99,"I")
"RTN","PSOPATLK",66,0)
 Q PSOINST
"RTN","PSOPATLK",67,0)
 ;
"VER")
8.0^22.0
"BLD",9834,6)
^373
**END**
**END**

