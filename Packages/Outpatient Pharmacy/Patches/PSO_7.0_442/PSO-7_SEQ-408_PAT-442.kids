Released PSO*7*442 SEQ #408
Extracted from mail message
**KIDS**:PSO*7.0*442^

**INSTALL NAME**
PSO*7.0*442
"BLD",9875,0)
PSO*7.0*442^OUTPATIENT PHARMACY^0^3170505^y
"BLD",9875,1,0)
^^14^14^3170130^
"BLD",9875,1,1,0)
 
"BLD",9875,1,2,0)
 
"BLD",9875,1,3,0)
The patch addresses the following issues:
"BLD",9875,1,4,0)
 
"BLD",9875,1,5,0)
1.      Users report that when a Window Partial is filled, the Patient 
"BLD",9875,1,6,0)
Notification (Rx Ready) file entry (52.11) is showing the Fill Type as 
"BLD",9875,1,7,0)
full instead of partial.
"BLD",9875,1,8,0)
2.      The PSO RX Discontinue Prescription(s) reinstate process displays 
"BLD",9875,1,9,0)
a Therapeutic Duplication warning message then prompts to discontinue the 
"BLD",9875,1,10,0)
active  prescription containing the duplicate class drug but does not 
"BLD",9875,1,11,0)
discontinue the drug when "Y" is entered at the prompt.
"BLD",9875,1,12,0)
3.      The Outpatient Pharmacy ScripTalk label process is using %ZTIO 
"BLD",9875,1,13,0)
variable to write to the Prescription file's Device field. The ZTIO 
"BLD",9875,1,14,0)
variable is used to hold the Scrip Talk device not %ZTIO. 
"BLD",9875,4,0)
^9.64PA^^
"BLD",9875,6.3)
29
"BLD",9875,"ABPKG")
n
"BLD",9875,"KRN",0)
^9.67PA^779.2^20
"BLD",9875,"KRN",.4,0)
.4
"BLD",9875,"KRN",.401,0)
.401
"BLD",9875,"KRN",.402,0)
.402
"BLD",9875,"KRN",.403,0)
.403
"BLD",9875,"KRN",.5,0)
.5
"BLD",9875,"KRN",.84,0)
.84
"BLD",9875,"KRN",3.6,0)
3.6
"BLD",9875,"KRN",3.8,0)
3.8
"BLD",9875,"KRN",9.2,0)
9.2
"BLD",9875,"KRN",9.8,0)
9.8
"BLD",9875,"KRN",9.8,"NM",0)
^9.68A^12^4
"BLD",9875,"KRN",9.8,"NM",5,0)
PSOTALK1^^0^B5211959
"BLD",9875,"KRN",9.8,"NM",9,0)
PSORXL^^0^B124632613
"BLD",9875,"KRN",9.8,"NM",10,0)
PSORXPA1^^0^B35364749
"BLD",9875,"KRN",9.8,"NM",12,0)
PSOCAN1^^0^B60678355
"BLD",9875,"KRN",9.8,"NM","B","PSOCAN1",12)

"BLD",9875,"KRN",9.8,"NM","B","PSORXL",9)

"BLD",9875,"KRN",9.8,"NM","B","PSORXPA1",10)

"BLD",9875,"KRN",9.8,"NM","B","PSOTALK1",5)

"BLD",9875,"KRN",19,0)
19
"BLD",9875,"KRN",19.1,0)
19.1
"BLD",9875,"KRN",101,0)
101
"BLD",9875,"KRN",409.61,0)
409.61
"BLD",9875,"KRN",771,0)
771
"BLD",9875,"KRN",779.2,0)
779.2
"BLD",9875,"KRN",870,0)
870
"BLD",9875,"KRN",8989.51,0)
8989.51
"BLD",9875,"KRN",8989.52,0)
8989.52
"BLD",9875,"KRN",8994,0)
8994
"BLD",9875,"KRN","B",.4,.4)

"BLD",9875,"KRN","B",.401,.401)

"BLD",9875,"KRN","B",.402,.402)

"BLD",9875,"KRN","B",.403,.403)

"BLD",9875,"KRN","B",.5,.5)

"BLD",9875,"KRN","B",.84,.84)

"BLD",9875,"KRN","B",3.6,3.6)

"BLD",9875,"KRN","B",3.8,3.8)

"BLD",9875,"KRN","B",9.2,9.2)

"BLD",9875,"KRN","B",9.8,9.8)

"BLD",9875,"KRN","B",19,19)

"BLD",9875,"KRN","B",19.1,19.1)

"BLD",9875,"KRN","B",101,101)

"BLD",9875,"KRN","B",409.61,409.61)

"BLD",9875,"KRN","B",771,771)

"BLD",9875,"KRN","B",779.2,779.2)

"BLD",9875,"KRN","B",870,870)

"BLD",9875,"KRN","B",8989.51,8989.51)

"BLD",9875,"KRN","B",8989.52,8989.52)

"BLD",9875,"KRN","B",8994,8994)

"BLD",9875,"QDEF")
^^^^NO^^^^^^NO
"BLD",9875,"QUES",0)
^9.62^^
"BLD",9875,"REQB",0)
^9.611^9^4
"BLD",9875,"REQB",1,0)
PSO*7.0*385^2
"BLD",9875,"REQB",6,0)
PSO*7.0*282^2
"BLD",9875,"REQB",8,0)
PSO*7.0*370^2
"BLD",9875,"REQB",9,0)
PSO*7.0*372^2
"BLD",9875,"REQB","B","PSO*7.0*282",6)

"BLD",9875,"REQB","B","PSO*7.0*370",8)

"BLD",9875,"REQB","B","PSO*7.0*372",9)

"BLD",9875,"REQB","B","PSO*7.0*385",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
442^3170505
"PKG",206,22,1,"PAH",1,1,0)
^^14^14^3170505
"PKG",206,22,1,"PAH",1,1,1,0)
 
"PKG",206,22,1,"PAH",1,1,2,0)
 
"PKG",206,22,1,"PAH",1,1,3,0)
The patch addresses the following issues:
"PKG",206,22,1,"PAH",1,1,4,0)
 
"PKG",206,22,1,"PAH",1,1,5,0)
1.      Users report that when a Window Partial is filled, the Patient 
"PKG",206,22,1,"PAH",1,1,6,0)
Notification (Rx Ready) file entry (52.11) is showing the Fill Type as 
"PKG",206,22,1,"PAH",1,1,7,0)
full instead of partial.
"PKG",206,22,1,"PAH",1,1,8,0)
2.      The PSO RX Discontinue Prescription(s) reinstate process displays 
"PKG",206,22,1,"PAH",1,1,9,0)
a Therapeutic Duplication warning message then prompts to discontinue the 
"PKG",206,22,1,"PAH",1,1,10,0)
active  prescription containing the duplicate class drug but does not 
"PKG",206,22,1,"PAH",1,1,11,0)
discontinue the drug when "Y" is entered at the prompt.
"PKG",206,22,1,"PAH",1,1,12,0)
3.      The Outpatient Pharmacy ScripTalk label process is using %ZTIO 
"PKG",206,22,1,"PAH",1,1,13,0)
variable to write to the Prescription file's Device field. The ZTIO 
"PKG",206,22,1,"PAH",1,1,14,0)
variable is used to hold the Scrip Talk device not %ZTIO. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOCAN1")
0^12^B60678355^B60132005
"RTN","PSOCAN1",1,0)
PSOCAN1 ;BIR/BHW - modular rx cancel with speed cancel ability ;2/22/93
"RTN","PSOCAN1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,20,24,27,32,131,163,185,238,372,442**;DEC 1997;Build 29
"RTN","PSOCAN1",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN1",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOCAN1",5,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSOCAN1",6,0)
 ;External references L, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN1",7,0)
 ;
"RTN","PSOCAN1",8,0)
PAT S RXCNT=0 K X,PSODFN,ASKED,BC,DELCNT,WARN W ! S DIR("A")="Are you entering the patient name or barcode",DIR(0)="SBO^P:Patient Name;B:Barcode"
"RTN","PSOCAN1",9,0)
 S DIR("?")="Enter a P if you are going to enter the patient name.  Enter a B if you are going to enter or wand the barcode."
"RTN","PSOCAN1",10,0)
 D ^DIR K DIR G:$D(DIRUT) ^PSOCAN S BC=Y
"RTN","PSOCAN1",11,0)
BC D KCAN1^PSOCAN3 S OUT=0 I BC="B" W ! S DIR("A")="Enter/wand barcode",DIR(0)="FO^5:20",DIR("?")="Enter the barcode number or wand the barcode to discontinue all prescriptions for one patient" D ^DIR K DIR G:$G(DIRUT) PAT S BCNUM=Y D
"RTN","PSOCAN1",12,0)
 .D PSOINST^PSOSUPAT Q:OUT  S RX=$P(BCNUM,"-",2) D:$D(^PSRX(RX,0))
"RTN","PSOCAN1",13,0)
 ..S PSODFN=$P(^PSRX(RX,0),"^",2) W " ",$P($G(^DPT(PSODFN,0)),"^")
"RTN","PSOCAN1",14,0)
 ..D ICN^PSODPT(PSODFN)
"RTN","PSOCAN1",15,0)
 .I '$D(^PSRX(RX,0)) W !,$C(7),"No Prescription record for this barcode." S OUT=1
"RTN","PSOCAN1",16,0)
 G:OUT BC
"RTN","PSOCAN1",17,0)
NAM D KCAN^PSOCAN3 S PSOCANRA=1 I BC="P" W ! S DIC(0)="AEMZQ",DIC="^DPT(" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) PAT S PSODFN=+Y S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOCAN1",18,0)
 I PSODFN'=$G(PSOODOSP) K PSORX("DOSING OFF"),PSOREINF S PSOODOSP=PSODFN
"RTN","PSOCAN1",19,0)
 I $G(PSOREINF)!($G(PSORX("DOSING INFO"))) S PSOONOFO=1
"RTN","PSOCAN1",20,0)
 N PSONEW,PSORX S PSFROM="N" D CHK^PSOCAN G:DEAD NAM K PSOSD D ^PSOBUILD S PSOOPT=-1 D ^PSODSPL G:'$D(PSOSD) NAM
"RTN","PSOCAN1",21,0)
 D ONOFF
"RTN","PSOCAN1",22,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY K PSOPLCK G PAT
"RTN","PSOCAN1",23,0)
 W ! S DIR("A")="Discontinue all or specific Rx#'s?",DIR(0)="SBO^A:ALL Rx's;S:SPECIFIC Rx's"
"RTN","PSOCAN1",24,0)
 S DIR("?")="Enter the letter A for all listed Rx's OR the letter for specific Rx's." D ^DIR K DIR I $D(DIRUT) D ULP^PSOCAN G PAT
"RTN","PSOCAN1",25,0)
 S ALL=Y G:Y="S" LINE D RTESTA D COM I '$D(INCOM)!($D(DIRUT)) D ULP^PSOCAN G NAM
"RTN","PSOCAN1",26,0)
 K PSOSDX,PSOSDXY,PENCAN,PSOCANPN S SPEED=1,(DRG,DRUG,IN,STA)="",II=0 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DRUG=$O(PSOSD(STA,DRUG)) Q:DRUG=""  S II=II+1,DRG=DRUG D
"RTN","PSOCAN1",27,0)
 .I STA="PENDING" S DA=$P(PSOSD(STA,DRG),"^",10) S PSOSDX(DA)="" Q
"RTN","PSOCAN1",28,0)
 .;PSO*7*238
"RTN","PSOCAN1",29,0)
 .I STA="ZNONVA" D  Q
"RTN","PSOCAN1",30,0)
 ..D NOW^%DTC
"RTN","PSOCAN1",31,0)
 ..N TMP
"RTN","PSOCAN1",32,0)
 ..S TMP(55.05,PSOOI_","_PSODFN_",",5)=1
"RTN","PSOCAN1",33,0)
 ..S TMP(55.05,PSOOI_","_PSODFN_",",6)=%
"RTN","PSOCAN1",34,0)
 ..D FILE^DIE("","TMP")
"RTN","PSOCAN1",35,0)
 .S PSOCANPN=1
"RTN","PSOCAN1",36,0)
 .D PSPEED
"RTN","PSOCAN1",37,0)
 K SPEED D ASK D:$G(REA)="C"&('$G(PSOSDXY))&($O(PSOSDX(0)))&($G(PSOCANPN))  D:'$G(PSOCANPN)  K PSOCANPN,PSOSDX,PSOSDXY,PENCAN D ULP^PSOCAN G PAT
"RTN","PSOCAN1",38,0)
 .S PENCAN="" F  S PENCAN=$O(PSOSDX(PENCAN)) Q:'PENCAN  S DA=PENCAN D PSOL^PSSLOCK(DA_"S") I $G(PSOMSG) D PEN,PSOUL^PSSLOCK(DA_"S")
"RTN","PSOCAN1",39,0)
LINE W !! S DIR(0)="LO^1:"_$S($G(PSOHI):PSOHI,1:PSOSD),DIR("A")="ENTER THE LINE #",DIR("?",1)="Enter the line number(s) displayed to the left of the Rx#."
"RTN","PSOCAN1",40,0)
 S DIR("?",2)="   Separate the numbers with commas (Example: 3,8,10,7),",DIR("?",3)="   OR a dash (Example: 12-20), OR a combination of commas and",DIR("?",4)="   dashes (Example: 3-5,1,12)."
"RTN","PSOCAN1",41,0)
 S DIR("?")="Do not exceed 245 characters including commas and dashes." D ^DIR K DIR D:$D(DIRUT) ULP^PSOCAN G:$G(DIRUT) KILL I Y["." W !?53,$C(7),"INVALID LINE NUMBER(S)." G LINE
"RTN","PSOCAN1",42,0)
 S LINE=Y K PSCAN,PSOCAN S (DRG,IN,STA)="",CNT=0
"RTN","PSOCAN1",43,0)
 F  S STA=$O(PSOSD(STA))  Q:STA=""  F  S DRG=$O(PSOSD(STA,DRG)) Q:DRG=""  S CNT=CNT+1,PSOCAN(CNT)=$S(STA'="PENDING":$P(PSOSD(STA,DRG),"^"),1:$P(PSOSD(STA,DRG),"^",10)_"^P")
"RTN","PSOCAN1",44,0)
 F CNT=1:1 S PLINE=$P(LINE,",",CNT) Q:'$P(LINE,",",CNT)  S IN=$S(IN="":PSOCAN(PLINE),1:IN_","_PSOCAN(PLINE))
"RTN","PSOCAN1",45,0)
 D RTEST D SPEED D ULP^PSOCAN G:BC="P" NAM G:BC="B" BC
"RTN","PSOCAN1",46,0)
PSPEED S (YY,DA)=$P(PSOSD(STA,DRG),"^"),RX=$P($G(^PSRX(DA,0)),"^") D SPEED1 Q:PSPOP!($D(PSINV(RX)))
"RTN","PSOCAN1",47,0)
 Q:$G(SPEED)&(REA="R")
"RTN","PSOCAN1",48,0)
SHOW S DRG=+$P(^PSRX(DA,0),"^",6),DRG=$S($D(^PSDRUG(DRG,0)):$P(^(0),"^"),1:"")
"RTN","PSOCAN1",49,0)
PSHOW S LC=0 W !,$P(^PSRX(DA,0),"^"),"  ",DRG,?52,$S($D(^DPT(+$P(^PSRX(DA,0),"^",2),0)):$P(^(0),"^"),1:"PATIENT UNKNOWN")
"RTN","PSOCAN1",50,0)
 I REA="C" W !?25,"Rx to be Discontinued",! G SHOW1
"RTN","PSOCAN1",51,0)
 W !?21,"*** Rx to be Reinstated ***",!
"RTN","PSOCAN1",52,0)
SHOW1 ;S LC=LC+3 I LC>20 R !,"Press return to continue",X:DTIME G:X'="" SHOW1 S LC=0
"RTN","PSOCAN1",53,0)
 I $Y+4>IOSL K DIR,DUOUT,DTOUT,DIRUT S DIR(0)="E",DIR("A")="Press Return to Continue",DIR("?")="Press Return to continue Listing Orders" D ^DIR K DIR,DTOUT,DIRUT,DUOUT W @IOF
"RTN","PSOCAN1",54,0)
 Q
"RTN","PSOCAN1",55,0)
SPEED1 S PSPOP=0 I $G(PSODIV),+$P($G(^PSRX(DA,2)),"^",9)'=$G(PSOSITE) D:'$G(SPEED) DIV^PSOCAN
"RTN","PSOCAN1",56,0)
 K STAT S STAT=+$P(^PSRX(DA,"STA"),"^"),REA=$E("C00CCCCCCCCCR000C",STAT+1)
"RTN","PSOCAN1",57,0)
 Q:$G(SPEED)&(REA="R")
"RTN","PSOCAN1",58,0)
 I REA="R",$P($G(^PSRX(DA,"PKI")),"^") S PKI=1 S PSINV(RX)="" Q
"RTN","PSOCAN1",59,0)
 I REA=0!(PSPOP)!($P(^PSRX(+YY,"STA"),"^")>12),$P(^("STA"),"^")<16 S PSINV(RX)="" Q
"RTN","PSOCAN1",60,0)
 S:REA'=0&('PSPOP) PSCAN(RX)=DA_"^"_REA,RXCNT=$G(RXCNT)+1
"RTN","PSOCAN1",61,0)
 Q
"RTN","PSOCAN1",62,0)
AREC S:'$G(DEAD) REA=$S($G(REA)="L":"L",1:$P(PSCAN($P(^PSRX(DA,0),"^")),"^",2)) S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN1",63,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOCAN1",64,0)
 D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1) S ^PSRX(DA,"A",ACNT+1,0)=%_"^"_REA_"^"_DUZ_"^"_RFCNT_"^"_$S($G(MSG)]"":MSG,1:$G(ACOM)_$G(INCOM)) S ACOM=""
"RTN","PSOCAN1",65,0)
 I $D(PKIR) N J S J=ACNT+2 D ADR^PSOPKIV1
"RTN","PSOCAN1",66,0)
 D EXP^PSOHELP1
"RTN","PSOCAN1",67,0)
 Q
"RTN","PSOCAN1",68,0)
SPEED D COM Q:'$D(INCOM)!($D(DIRUT))  N PKI K PSINV,PSCAN F II=1:1 S DA=$P(IN,",",II) Q:'$P(IN,",",II)  D
"RTN","PSOCAN1",69,0)
 .I $P(DA,"^",2)="P" S DA=+DA D  Q
"RTN","PSOCAN1",70,0)
 ..D PSOL^PSSLOCK(DA_"S") I $G(PSOMSG) D PEN D PSOUL^PSSLOCK(DA_"S")
"RTN","PSOCAN1",71,0)
 .I $D(^PSRX(DA,0)) S YY=DA,RX=$P(^(0),"^") S:DA<0 PSINV(RX)="" D:DA>0 SPEED1
"RTN","PSOCAN1",72,0)
 G:'$D(PSCAN) INVALD S II="",RXCNT=0 F  S II=$O(PSCAN(II)) Q:II=""  S DA=+PSCAN(II),REA=$P(PSCAN(II),"^",2),RXCNT=RXCNT+1  D SHOW
"RTN","PSOCAN1",73,0)
 ;
"RTN","PSOCAN1",74,0)
ASK G:'$D(PSCAN) INVALD W ! S DIR("A")="OK to "_$S($G(RXCNT)>1:"Change Status",REA="C":"Discontinue",1:"Reinstate"),DIR(0)="Y",DIR("B")="N" D ^DIR K DIR I $D(DIRUT) S:$O(PSOSDX(0)) PSOSDXY=1 Q
"RTN","PSOCAN1",75,0)
 I 'Y S:$O(PSOSDX(0)) PSOSDXY=1 K PSCAN D INVALD Q
"RTN","PSOCAN1",76,0)
 S RX="" F  S RX=$O(PSCAN(RX)) Q:RX=""  D PSOL^PSSLOCK(+PSCAN(RX)) I $G(PSOMSG) D ACT D PSOUL^PSSLOCK(+PSCAN(RX))
"RTN","PSOCAN1",77,0)
 D INVALD Q
"RTN","PSOCAN1",78,0)
ACT S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),II=RX,PSODFN=$P(^PSRX(DA,0),"^",2) I REA="R" D REINS^PSOCAN2 I '$G(PSORX("DFLG")) D DCORD^PSONEW2 Q  ;*442
"RTN","PSOCAN1",79,0)
 D CAN^PSOCAN Q
"RTN","PSOCAN1",80,0)
INVALD K PSCAN Q:'$D(PSINV)  W !! F I=1:1:80 W "="
"RTN","PSOCAN1",81,0)
 W $C(7),!!,"The Following Rx Number(s) Are Invalid Choices, Expired, "_$S($G(PKI):"Digitally Signed",1:""),!,"Discontinued by Provider, or Marked As Deleted:" S II="" F  S II=$O(PSINV(II)) Q:II=""  W !?10,II
"RTN","PSOCAN1",82,0)
 K PSINV I $G(PSOERR)!($G(SPEED)) K DIR,DUOUT,DTOUT,DIRUT S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOCAN1",83,0)
 G KILL Q
"RTN","PSOCAN1",84,0)
LISTPAT S X="?",DIC(0)="EMQ",DIC="^DPT(" D ^DIC K DIC Q
"RTN","PSOCAN1",85,0)
 ;
"RTN","PSOCAN1",86,0)
COM W !
"RTN","PSOCAN1",87,0)
 K MSG  ;Added to prevent INCOM from being superseded in AREC tag if DC comments entered.
"RTN","PSOCAN1",88,0)
 S DIR("A")="Comments"_$S($D(PKIR):"/Reason for DCing",1:""),DIR(0)="F^5:75"
"RTN","PSOCAN1",89,0)
 S DIR("?")="Comments must be entered.  Comments must be 5 to 75 characters and must not contain embedded uparrow"
"RTN","PSOCAN1",90,0)
 S:$D(INCOM) DIR("B")=INCOM
"RTN","PSOCAN1",91,0)
 D ^DIR I $D(DIRUT) K DIR,DTOUT,DUOUT,Y Q
"RTN","PSOCAN1",92,0)
 S INCOM=Y S:$D(PKIR) PKIR=Y K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOCAN1",93,0)
 D NOOR^PSOCAN4
"RTN","PSOCAN1",94,0)
 Q
"RTN","PSOCAN1",95,0)
KILL D KILL^PSOCAN2
"RTN","PSOCAN1",96,0)
 K PSOMSG,PSOPLCK,PSOWUN,PSOULRX
"RTN","PSOCAN1",97,0)
 Q
"RTN","PSOCAN1",98,0)
PEN ;discontinue pending orders
"RTN","PSOCAN1",99,0)
 S PSODAPND=DA
"RTN","PSOCAN1",100,0)
 K ^PS(52.41,"AOR",$P(^PS(52.41,DA,0),"^",2),+$P($G(^PS(52.41,DA,"INI")),"^"),DA) S $P(^PS(52.41,DA,0),"^",3)="DC",^PS(52.41,DA,4)=INCOM_" Discontinued by Pharmacy."
"RTN","PSOCAN1",101,0)
 D EN^PSOHLSN(+^PS(52.41,DA,0),"OC",INCOM,PSONOOR)
"RTN","PSOCAN1",102,0)
 S DA=PSODAPND K PSODAPND
"RTN","PSOCAN1",103,0)
 Q
"RTN","PSOCAN1",104,0)
RTEST ;
"RTN","PSOCAN1",105,0)
 Q:'$G(LINE)
"RTN","PSOCAN1",106,0)
 N PCIN,PCINFLAG,PCINX
"RTN","PSOCAN1",107,0)
 S PCINFLAG=0 F PCIN=1:1 S PCINX=$P(LINE,",",PCIN) Q:$P(LINE,",",PCIN)']""  D
"RTN","PSOCAN1",108,0)
 .Q:'$G(PCINX)
"RTN","PSOCAN1",109,0)
 .Q:'$G(PSOCAN(PCINX))
"RTN","PSOCAN1",110,0)
 .I PSOCAN(PCINX)'["^P" I $P($G(^PSRX(+$G(PSOCAN(PCINX)),"STA")),"^")'=12,'$G(PCINFLAG) S PSOCANRD=+$P($G(^PSRX($G(PSOCAN(PCINX)),0)),"^",4) S PCINFLAG=1
"RTN","PSOCAN1",111,0)
 .I PSOCAN(PCINX)["^P",'$G(PCINFLAG) S PSOCANRD=+$P($G(^PS(52.41,+$P(PSOCAN(PCINX),"^"),0)),"^",5) S PCINFLAG=1
"RTN","PSOCAN1",112,0)
 I '$G(PCINFLAG) S PSOCANRZ=1
"RTN","PSOCAN1",113,0)
 Q
"RTN","PSOCAN1",114,0)
RTESTA ;
"RTN","PSOCAN1",115,0)
 N PFIN,PFINZ,PFINFLAG
"RTN","PSOCAN1",116,0)
 S PFINFLAG=0 S PFIN="" F  S PFIN=$O(PSOSD(PFIN)) Q:PFIN=""  S PFINZ="" F  S PFINZ=$O(PSOSD(PFIN,PFINZ)) Q:PFINZ=""  D
"RTN","PSOCAN1",117,0)
 .I $G(PFIN)'="PENDING" I $P($G(^PSRX(+$P($G(PSOSD(PFIN,PFINZ)),"^"),"STA")),"^")'=12,'$G(PFINFLAG) S PSOCANRD=+$P($G(^(0)),"^",4),PFINFLAG=1
"RTN","PSOCAN1",118,0)
 .I $G(PFIN)="PENDING",'$G(PFINFLAG) S PSOCANRD=+$P($G(^PS(52.41,+$P($G(PSOSD(PFIN,PFINZ)),"^",10),0)),"^",5) S PFINFLAG=1
"RTN","PSOCAN1",119,0)
 I '$G(PFINFLAG) S PSOCANRZ=1
"RTN","PSOCAN1",120,0)
 Q
"RTN","PSOCAN1",121,0)
ONOFF ;
"RTN","PSOCAN1",122,0)
 I $G(PSOREINF) S PSORX("DOSING INFO")=1
"RTN","PSOCAN1",123,0)
 I $G(PSORX("DOSING INFO"))&'$G(PSOREINF) S PSOREINF=1
"RTN","PSOCAN1",124,0)
 Q
"RTN","PSORXL")
0^9^B124632613^B124759619
"RTN","PSORXL",1,0)
PSORXL ;BHAM ISC/SAB - action to be taken on prescriptions ;10/15/08 2:12pm
"RTN","PSORXL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,24,32,47,135,148,287,334,251,354,367,370,442**;DEC 1997;Build 29
"RTN","PSORXL",3,0)
 ;External reference to File #50 supported by DBIA 221
"RTN","PSORXL",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSORXL",5,0)
 I $G(PSOTRVV),$G(PPL) S PSORX("PSOL",1)=PPL K PPL
"RTN","PSORXL",6,0)
 N SLBL,PSOSONE,PSOKLRXS,PSOSKIP S PSOSKIP=1
"RTN","PSORXL",7,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$P(PSOPAR,"^",26) P
"RTN","PSORXL",8,0)
LBL ;
"RTN","PSORXL",9,0)
 I $G(PPL) N PSOCKDC S PSOCKDC=1 D ECME^PSORXL1 I '$G(PPL) S PPL="" G RXSQUIT  ;*334 ;don't prompt to print labels for DC'ed Rx's
"RTN","PSORXL",10,0)
 W !! S DIR("A",1)="Label Printer: "_$S($G(SUSPT):PSLION,1:$G(PSOLAP))
"RTN","PSORXL",11,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" D
"RTN","PSORXL",12,0)
 . I $G(PSOFDAPT)="" S PSOFDAPT=$$DEFPRT^PSOFDAUT(PSOSITE)
"RTN","PSORXL",13,0)
 . S DIR("A",2)="FDA Med Guide Printer: "_$S($G(PSOFDAPT)="":"HOME",1:$P(PSOFDAPT,"^"))
"RTN","PSORXL",14,0)
 S DIR("A")="LABEL: QUEUE/CHANGE PRINTER"_$S($P(PSOPAR,"^",23)&($D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSO TECH ADV",DUZ)))):"/HOLD",1:"")_$S($P(PSOPAR,"^",24):"/SUSPEND",1:"")_$S($P(PSOPAR,"^",26):"/LABEL",1:"")_" or '^' to bypass "
"RTN","PSORXL",15,0)
 S DIR("?",1)="Enter 'Q' to queue labels to print",DIR("?")="Enter '^' to bypass label functions",DIR("?",4)="Enter 'S' to suspend labels to print later"
"RTN","PSORXL",16,0)
 S DIR("?",2)="Enter 'H' to hold label until Rx can be filled",DIR("?",3)="Enter 'P' for Rx profile"
"RTN","PSORXL",17,0)
 S DIR("?",5)="Enter 'C' to select another label printer"
"RTN","PSORXL",18,0)
 S:$P(PSOPAR,"^",26) DIR("?",5)="Enter 'L' to print labels without queuing"
"RTN","PSORXL",19,0)
TRI ;Tricare
"RTN","PSORXL",20,0)
 S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G PASS
"RTN","PSORXL",21,0)
 I '$$TRI^IBACUS() G PASS
"RTN","PSORXL",22,0)
 I '$D(PSORX("PSOL",1))!($G(PSOSUREP))!($G(PSOEXREP)) G PASS
"RTN","PSORXL",23,0)
 N GGG,PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,TRXI,TRIRX,PSTRIVAR,VV,VVV,VVCT
"RTN","PSORXL",24,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",25,0)
 K ^TMP($J,"PSONOB"),^TMP($J,"PSOBILL")
"RTN","PSORXL",26,0)
 S VVCT=0 F VV=0:0 S VV=$O(PSORX("PSOL",VV)) Q:'VV  F VVV=1:1 S TRXI=$P(PSORX("PSOL",VV),",",VVV) Q:'TRXI  D
"RTN","PSORXL",27,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",28,0)
 .I $P($G(^PSRX(+TRXI,"STA")),"^")=3 Q
"RTN","PSORXL",29,0)
 .S PSTRP=$P($G(^PSRX(+TRXI,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",30,0)
 .S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRXI,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",31,0)
 .S VVCT=VVCT+1
"RTN","PSORXL",32,0)
 .I $G(RXRP(TRXI))!($G(RXPR(TRXI)))!($G(RXRH(TRXI))) S ^TMP($J,"PSONOB",VVCT)=TRXI Q
"RTN","PSORXL",33,0)
 .S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRXI,PSTRF,PSOLAP,PSTRD,PSTRDZ) S ^TMP($J,$S($G(PBILL):"PSOBILL",1:"PSONOB"),VVCT)=TRXI
"RTN","PSORXL",34,0)
 I '$D(^TMP($J,"PSOBILL")) K ^TMP($J,"PSONOB") G PASS
"RTN","PSORXL",35,0)
 I '$D(^TMP($J,"PSONOB")),$D(^TMP($J,"PSOBILL")) S (Y,LBL)="H" G H1
"RTN","PSORXL",36,0)
 ;If some Rx's are billable, and some are not
"RTN","PSORXL",37,0)
SETP K PSORX("PSOL"),PPL S VVCT=1 F VV=0:0 S VV=$O(^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV)) Q:'VV  S TRIRX=^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV) I +TRIRX D
"RTN","PSORXL",38,0)
 .I $G(PSORX("PSOL",1))="" S PSORX("PSOL",1)=TRIRX_"," Q
"RTN","PSORXL",39,0)
 .I $L(PSORX("PSOL",VVCT))+$L(TRIRX)<220 S PSORX("PSOL",VVCT)=PSORX("PSOL",VVCT)_TRIRX_"," Q
"RTN","PSORXL",40,0)
 .S VVCT=VVCT+1 S PSORX("PSOL",VVCT)=TRIRX_","
"RTN","PSORXL",41,0)
 I '$G(PSTRIVAR) S (Y,LBL)="H" S PSOKLRXS=1 K PSORSAVE,PSOPSAVE,PSOHSAVE D RSAVE D H1 D RREST K PSORSAVE,PSOPSAVE,PSOHSAVE K PSOKLRXS S PSTRIVAR=1 G SETP
"RTN","PSORXL",42,0)
 K ^TMP($J,"PSONOB") S PPL=$G(PSORX("PSOL",1))
"RTN","PSORXL",43,0)
PASS ;
"RTN","PSORXL",44,0)
 I $E($G(DIR("A")),1,6)'="LABEL:" D RESDIR^PSOCPTRI
"RTN","PSORXL",45,0)
 S DIR(0)="SA^P:PROFILE;Q:QUEUE;C:CHANGE PRINTER"_$S($P(PSOPAR,"^",23)&($D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSO TECH ADV",DUZ)))):";H:HOLD",1:"")
"RTN","PSORXL",46,0)
 S DIR(0)=DIR(0)_$S($P(PSOPAR,"^",24):";S:SUSPENSE",1:"")_$S($P(PSOPAR,"^",26):";L:PRINT",1:""),DIR("B")="Q" D ^DIR D  G:$D(DIRUT)!($D(DUOUT)) EX  ;*370
"RTN","PSORXL",47,0)
 .I $D(DIRUT)!($D(DUOUT)) D AL^PSOLBL("UT") I $G(PSOEXREP) S PSOEXREX=1
"RTN","PSORXL",48,0)
 .I $G(PSOPULL) I $D(DIRUT)!($D(DUOUT)) S PSOQFLAG=1
"RTN","PSORXL",49,0)
 S:$G(PSOBEDT) NOPP=Y
"RTN","PSORXL",50,0)
 I $G(Y)="C" K PSOCLBL,%ZIS("B") S PSOCLBL=1 D @$S('$D(PSOPAR):"^PSOLSET",1:"PLBL^PSOLSET") K PSOCLBL G LBL
"RTN","PSORXL",51,0)
 I $G(Y)="Q",$D(RXRS),'$G(PSOPULL) D PPLADD^PSOSUPOE
"RTN","PSORXL",52,0)
 I $G(PSXSYS),($G(Y)'="H"),($G(Y)'="P"),('$G(PSOEXREP)) S LBL=Y,(RXLTOP,PPL1)=1 S:'$G(PSOPULL) SLBL=Y D A^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",53,0)
 K DIR S LBL=Y S:'$G(PSOPULL) SLBL=Y G Q:Y="Q",S:Y="S",H1:Y="H",P:Y="L" I Y="P" W ! S PSDFN=DFN,PSFROM="" D ^PSODSPL K PSDFN,PSFROM G LBL
"RTN","PSORXL",54,0)
EX I $D(DUOUT)!$D(DIRUT) K BINGCRT,BINGRTE,BBRX,BBFLG S:$D(RXRS) SLBL="^" G:$D(RXRS) RXS K DIR,X,DIRUT,DUOUT,ACT,Y,DTOUT,PPL,REPRINT S NOBG=1 G RXSQUIT  ;*334
"RTN","PSORXL",55,0)
Q S PPL1=1 G:$G(PPL)']"" D1 S PSNP=0,PSL=1 D  I $G(PSOFROM)="NEW",$P(PSOPAR,"^",8) S PSNP=1
"RTN","PSORXL",56,0)
 .Q:'$P(PSOPAR,"^",8)!($G(PSONOPRT))
"RTN","PSORXL",57,0)
 .F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL!($G(PSNP))  I '$O(^PSRX(SLPPL,1,0)),'$D(RXPR(SLPPL)) S PSNP=1
"RTN","PSORXL",58,0)
 I $G(PSOLAP)]"",$G(PSOLAP)'=ION G Q2
"RTN","PSORXL",59,0)
Q1 W ! K POP S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSORXL",60,0)
 G:$G(POP)&($G(PSPARTXX)) RXSQUIT G:$G(POP)&($G(PSOSONE)) RXSQ D:$G(POP)&($G(PSONOPRT))
"RTN","PSORXL",61,0)
 .S PSOQFLAG=1
"RTN","PSORXL",62,0)
 G:$G(PSOQFLAG) RXSQUIT G:POP!(IO=IO(0)) LBL S PSOLAP=ION  ;*334
"RTN","PSORXL",63,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",64,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10)
"RTN","PSORXL",65,0)
 D ^%ZISC S PSL=0
"RTN","PSORXL",66,0)
Q2 ; Checking FDA Med Guide printer
"RTN","PSORXL",67,0)
 I ($$GET1^DIQ(59,PSOSITE,134)="")!($G(PSOEXREP)&'$G(PSOMGREP))!'$$FDARX(PPL)!($G(PSOSKIP)&($G(PSOFDAPT)'="")) G QLBL
"RTN","PSORXL",68,0)
 I $G(PSOEXREP),'$G(PSOMGREP) G QLBL
"RTN","PSORXL",69,0)
 N FDAPRT S FDAPRT=""
"RTN","PSORXL",70,0)
 F  D  Q:FDAPRT'=""!(FDAPRT="^")
"RTN","PSORXL",71,0)
 . S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^"))
"RTN","PSORXL",72,0)
 . I FDAPRT="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSORXL",73,0)
 I FDAPRT="^"!(FDAPRT="") G LBL
"RTN","PSORXL",74,0)
 S PSOFDAPT=FDAPRT
"RTN","PSORXL",75,0)
 ;
"RTN","PSORXL",76,0)
QLBL I $G(PSXSYS),('$G(RXLTOP)),('$G(PSOEXREP)) D RXL^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",77,0)
 ;
"RTN","PSORXL",78,0)
 ;- Submitting list of Rx to ECME for DUR/79 REJECT check and possible submission to 3rd Pary Payer
"RTN","PSORXL",79,0)
 D ECME^PSORXL1 I '$G(PPL) W !!,"No Label(s) printed.",!! S PSOQFLAG=1 G RXSQUIT  ;*334
"RTN","PSORXL",80,0)
 ;
"RTN","PSORXL",81,0)
 S ZTRTN="DQ^PSOLBL",ZTIO=$S($G(SUSPT):PSLION,1:PSOLAP),ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H),PDUZ=DUZ,OPAIO=ZTIO
"RTN","PSORXL",82,0)
 S ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",$G(DG):"DRUG INTERACTION ",1:"")_"LABELS OUTPUT ROUTINE"
"RTN","PSORXL",83,0)
 F G="PPL1","PSOSYS","DFN","PSOPAR","PDUZ","PCOMX",$S($G(SUSPT):"PFION",1:"PSOLAP"),"PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",84,0)
 F G="RXY","PSOSITE","COPIES","SIDE","PSOSUSPR","PSOBARS","PSOBAR1","PSOBAR0","PSODELE" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",85,0)
 F G="PSOPULL","PSTAT","PSODBQ","PSOEXREP","PSOTREP","PSOFDAPT","PSOMGREP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",86,0)
 S ZTSAVE("PSORX(")="",ZTSAVE("RXRP(")="",ZTSAVE("RXPR(")="",ZTSAVE("RXRS(")="",ZTSAVE("RXFL(")="",ZTSAVE("PCOMH(")=""
"RTN","PSORXL",87,0)
 D ^%ZISC,^%ZTLOAD K:$G(PSOSONE) RXRS
"RTN","PSORXL",88,0)
 I $D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) D
"RTN","PSORXL",89,0)
 . W !!,"LABEL(S) QUEUED TO PRINT",!!
"RTN","PSORXL",90,0)
 . D OPAI
"RTN","PSORXL",91,0)
 K OPAIO
"RTN","PSORXL",92,0)
 G:$G(PSPARTXX) RXSQUIT K G,PDUZ K:'$G(SUSPT) ZTSK G:$G(DG) RXSQUIT  ;*334
"RTN","PSORXL",93,0)
 G:'$G(PSNP) QUEUP G:$G(PSOPRFLG) QUEUP S HOLDRPAS=$G(PSOPRPAS),PSOPRPAS=$P(PSOPAR,"^",13)
"RTN","PSORXL",94,0)
PLBL S PSOION=ION
"RTN","PSORXL",95,0)
 I '$D(PSOPROP)!($G(PSOPROP)=ION) W $C(7),!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP QUEUP G:$E(IOST)["C"!(PSOION=ION) PLBL S PSOPROP=ION
"RTN","PSORXL",96,0)
QPRF S ZTRTN="DQ^PSOPRF",ZTIO=PSOPROP,ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",1:"")_"PATIENT PROFILES",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H)
"RTN","PSORXL",97,0)
 F G="PSOPAR","PSODTCUT","PSOPRPAS","DFN","PSOSITE","NEW1","NEW11","PSOBMST","PFIO","PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",98,0)
 D ^%ZTLOAD W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !,"PROFILE IS QUEUED TO PRINT",!! K G K:'$G(SUSPT) ZTSK D ^%ZISC
"RTN","PSORXL",99,0)
QUEUP D:$G(POP)&($G(PSONOPRT))  G:$G(PSOQFLAG) RXSQUIT S PSNP=0,PSOPRPAS=$G(HOLDRPAS) K:PSOPRPAS']"" PSOPRPAS K HOLDRPAS G D1  ;*334
"RTN","PSORXL",100,0)
 .S PSOQFLAG=1
"RTN","PSORXL",101,0)
 Q
"RTN","PSORXL",102,0)
 ;
"RTN","PSORXL",103,0)
S G S^PSORXL1
"RTN","PSORXL",104,0)
SUS S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G SUSL1
"RTN","PSORXL",105,0)
 N TRIDA S TRIDA=DA I '$$TRI^IBACUS() S DA=TRIDA G SUSL1
"RTN","PSORXL",106,0)
 I $G(RXRP(TRIDA))!($G(RXPR(TRIDA)))!($G(RXRH(TRIDA))) S DA=TRIDA G SUSL1
"RTN","PSORXL",107,0)
 N PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,GGG
"RTN","PSORXL",108,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",109,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",110,0)
 S PSTRP=$P($G(^PSRX(+TRIDA,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",111,0)
 S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRIDA,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",112,0)
 S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRIDA,PSTRF,PSOLAP,PSTRD,PSTRDZ)
"RTN","PSORXL",113,0)
 I '$G(PBILL) S DA=TRIDA G SUSL1
"RTN","PSORXL",114,0)
 S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSORXL",115,0)
 N RSDT,ACT,PSUS,RXF,RFN,I,PSDA,NOW,IR,FDA
"RTN","PSORXL",116,0)
 S DA=TRIDA D H^PSOCPTRH
"RTN","PSORXL",117,0)
 Q
"RTN","PSORXL",118,0)
SUSL1 G SUS^PSORXL1
"RTN","PSORXL",119,0)
H1 S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1))
"RTN","PSORXL",120,0)
 D:'$D(^TMP($J,"PSOBILL")) NOOR^PSOHLD I $D(DIRUT) K DIRUT G PSORXL
"RTN","PSORXL",121,0)
 I $D(^TMP($J,"PSOBILL")) S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval" G H
"RTN","PSORXL",122,0)
 G:$G(PPL)']"" D1 D FLD^PSOHLD I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,FLD,DIR G LBL
"RTN","PSORXL",123,0)
H K SPPL G:$D(DTOUT) D1 S SPPL="" F PI=1:1 Q:$P(PPL,",",PI)=""  D
"RTN","PSORXL",124,0)
 .S DA=$P(PPL,",",PI) I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D @$S($D(^TMP($J,"PSOBILL")):"H^PSOCPTRH",1:"H^PSOHLD") Q
"RTN","PSORXL",125,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL",126,0)
 I $G(SPPL)]"" D
"RTN","PSORXL",127,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL",128,0)
 .S PPL=SPPL,DG=1 D Q K DG,SPPL
"RTN","PSORXL",129,0)
D1 K RXLTOP I $G(PPL1),$O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",PPL1)),PPL=PSORX("PSOL",PPL1) G @$S(LBL="H":"H",LBL="L":"P1",1:"QLBL")
"RTN","PSORXL",130,0)
RXS I $D(RXRS),'$G(PSOKLRXS) I $G(SLBL)="H"!($G(SLBL)="S")!($G(SLBL)="^")!($G(SLBL)="") D  G:$G(PPL)'="" Q
"RTN","PSORXL",131,0)
 .K PPL,PSORX("PSOL") S PSOSONE=1 D PPLADD^PSOSUPOE
"RTN","PSORXL",132,0)
 .Q:$G(PPL)=""  W !!,"You have selected the following Rx(s) to be pulled from suspense:",!
"RTN","PSORXL",133,0)
 .F RXSS=0:0 S RXSS=$O(RXRS(RXSS)) Q:'RXSS  W !," Rx # ",$P($G(^PSRX(+$G(RXSS),0)),"^"),?23,$P($G(^PSDRUG(+$P($G(^PSRX(+$G(RXSS),0)),"^",6),0)),"^")
"RTN","PSORXL",134,0)
 .K DIR W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you still want to pull these Rx(s) from suspense" D ^DIR K DIR I Y'=1 W !!,"Rx(s) will remain in Suspense!",! D RESET^PSOSUPOE K RXRS,PPL
"RTN","PSORXL",135,0)
RXSQUIT K:'$G(PSOKLRXS) RXRS K ^TMP($J,"PSOBILL"),RXRP,RXRH,RXSS,LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT Q  ;*334 ADDED TAG NAME
"RTN","PSORXL",136,0)
P S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSORXL",137,0)
 I $G(PSOLAP)']"" W ! K POP,ZTSK S %ZIS="M",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS K %ZIS("A") G:POP LBL S PSOLAP=ION
"RTN","PSORXL",138,0)
 S IOP=PSOLAP D ^%ZIS
"RTN","PSORXL",139,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",140,0)
P1 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10),PDUZ=DUZ D DQ1^PSOLBL,^%ZISC
"RTN","PSORXL",141,0)
 G:'$P(PSOPAR,"^",8)!(+$G(REPRINT))!($G(PSOFROM)'="NEW") D1 I $G(PSOPROP)']"" S PSOION=ION,%ZIS="M",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP D1 S PSOPROP=ION
"RTN","PSORXL",142,0)
 S IOP=PSOPROP D ^%ZIS D DQ^PSOPRF,^%ZISC G D1
"RTN","PSORXL",143,0)
 Q
"RTN","PSORXL",144,0)
RXSQ K RXRS G RXS
"RTN","PSORXL",145,0)
 Q
"RTN","PSORXL",146,0)
FDARX(PPL) ; Check if any Rx to be printed has an FDA Med Guide
"RTN","PSORXL",147,0)
 N FDARX,FDARXIEN,I S FDARX=0
"RTN","PSORXL",148,0)
 F I=1:1:$L($G(PPL),",") D  Q:FDARX
"RTN","PSORXL",149,0)
 . S FDARXIEN=+$P(PPL,",",I) I 'FDARXIEN Q
"RTN","PSORXL",150,0)
 . I $D(RXRP(FDARXIEN)),'$D(RXRP(FDARXIEN,"MG")) Q
"RTN","PSORXL",151,0)
 . I FDARXIEN,$$MGONFILE^PSOFDAUT(FDARXIEN) S FDARX=1
"RTN","PSORXL",152,0)
 Q FDARX
"RTN","PSORXL",153,0)
 ;
"RTN","PSORXL",154,0)
RSAVE N PMX
"RTN","PSORXL",155,0)
 S PMX="" F  S PMX=$O(RXRP(PMX)) Q:PMX=""  S PSORSAVE(PMX)=RXRP(PMX)
"RTN","PSORXL",156,0)
 S PMX="" F  S PMX=$O(RXPR(PMX)) Q:PMX=""  S PSOPSAVE(PMX)=RXPR(PMX)
"RTN","PSORXL",157,0)
 S PMX="" F  S PMX=$O(RXRH(PMX)) Q:PMX=""  S PSOHSAVE(PMX)=RXRH(PMX)
"RTN","PSORXL",158,0)
 Q
"RTN","PSORXL",159,0)
RREST N PMXZ
"RTN","PSORXL",160,0)
 S PMXZ="" F  S PMXZ=$O(PSORSAVE(PMXZ)) Q:PMXZ=""  S RXRP(PMXZ)=PSORSAVE(PMXZ)
"RTN","PSORXL",161,0)
 S PMXZ="" F  S PMXZ=$O(PSOPSAVE(PMXZ)) Q:PMXZ=""  S RXPR(PMXZ)=PSOPSAVE(PMXZ)
"RTN","PSORXL",162,0)
 S PMXZ="" F  S PMXZ=$O(PSOHSAVE(PMXZ)) Q:PMXZ=""  S RXRH(PMXZ)=PSOHSAVE(PMXZ)
"RTN","PSORXL",163,0)
 Q
"RTN","PSORXL",164,0)
 ;
"RTN","PSORXL",165,0)
OPAI ;This section of code will display where an RX is routed.
"RTN","PSORXL",166,0)
 ;To determine where an RX will be routed, check:
"RTN","PSORXL",167,0)
 ;1) if the drug for the RX is associated with an ADD device in
"RTN","PSORXL",168,0)
 ;   file #50 and if the printer is in the DISPENSING SYSTEM 
"RTN","PSORXL",169,0)
 ;   PRINTER multiple sub-file #59.02008. If it is then the RX 
"RTN","PSORXL",170,0)
 ;   will display as being routed to that device.  
"RTN","PSORXL",171,0)
 ;2) Otherwise, the category of the ADD associated with the
"RTN","PSORXL",172,0)
 ;   printer in sub-file #59.20081 will be used to determine 
"RTN","PSORXL",173,0)
 ;   where the RX will be routed and the ADD displayed.
"RTN","PSORXL",174,0)
 ;
"RTN","PSORXL",175,0)
 N DIC,X,Y,PN,II,RX,DEV,DDEV,ADD,DAT,DAT1,PDAT,DRG,DRG0,OPAI,CSB,RTE,FLG
"RTN","PSORXL",176,0)
 N ZTIO,MTH,NPPL
"RTN","PSORXL",177,0)
 I ($G(OPAIO)="")!($G(PPL)="") Q
"RTN","PSORXL",178,0)
 S DIC=3.5,DIC(0)="",X=OPAIO D ^DIC K DIC,X Q:Y=-1  S ZTIO=+Y
"RTN","PSORXL",179,0)
 S FLG=1,DEV=0,PN=$O(^PS(59,PSOSITE,"P","B",ZTIO,"")) I PN="" Q 
"RTN","PSORXL",180,0)
 I '$P($G(PSOPAR),"^",30) Q
"RTN","PSORXL",181,0)
 I $$GET1^DIQ(59,PSOSITE_",",105,"I")'=2.4 Q
"RTN","PSORXL",182,0)
 ;
"RTN","PSORXL",183,0)
 ;ADD array built base on category.
"RTN","PSORXL",184,0)
 ; if category is not "S" then 
"RTN","PSORXL",185,0)
 ;               ADD(category)=ADD name^dns^port^inactive date
"RTN","PSORXL",186,0)
 ; if category is "S" then (Category "S" can be multiple)
"RTN","PSORXL",187,0)
 ;               ADD(category,ADD name)=ADD name^dns^port^inactive date
"RTN","PSORXL",188,0)
 ;Array OPAI will be used to display the data on the screen.
"RTN","PSORXL",189,0)
 ;               OPAI(ADD name)=ADD name^dns^port^inactive date
"RTN","PSORXL",190,0)
 ;               OPAI(ADD name,RX)=drug
"RTN","PSORXL",191,0)
 ;
"RTN","PSORXL",192,0)
 F  S DEV=$O(^PS(59,PSOSITE,"P",PN,"OPAI",DEV)) Q:'DEV  D
"RTN","PSORXL",193,0)
 .S DAT=$G(^PS(59,PSOSITE,"P",PN,"OPAI",DEV,0)) I $P(DAT,"^",2)="" Q
"RTN","PSORXL",194,0)
 .S DAT1=$$ADDCHK^PSOHLDS($P(DAT,"^"))
"RTN","PSORXL",195,0)
 .I DAT1 D
"RTN","PSORXL",196,0)
 ..I $P(DAT,"^",2)'="S" S ADD($P(DAT,"^",2))=$P(DAT1,"^",2,99) Q
"RTN","PSORXL",197,0)
 ..S ADD($P(DAT,"^",2),$P(DAT1,"^",2))=$P(DAT1,"^",2,99)
"RTN","PSORXL",198,0)
 S NPPL=""
"RTN","PSORXL",199,0)
 F II=1:1:$L(PPL,",") S RX=$P(PPL,",",II) D:RX'=""
"RTN","PSORXL",200,0)
 .I $G(RXRP(RX,"RP")) Q 
"RTN","PSORXL",201,0)
 .S PDAT=$G(^PSRX(RX,0)),DRG=$P(PDAT,"^",6),RTE=$$RTE()
"RTN","PSORXL",202,0)
 .S DRG0=$G(^PSDRUG(+DRG,0)),DDEV=$G(^PSDRUG(+DRG,"OPAI",PSOSITE,0))
"RTN","PSORXL",203,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,DRG,28,"I") Q
"RTN","PSORXL",204,0)
 .S NPPL=NPPL_","_RX,DAT1=$$ADDCHK^PSOHLDS($S(RTE="W":$P(DDEV,"^",2),RTE="M":$P(DDEV,"^",3),1:"")) I DAT1 D  Q
"RTN","PSORXL",205,0)
 ..D SETOP($P(DAT1,"^",2,99),$P(PDAT,"^"),$P(DRG0,"^"))
"RTN","PSORXL",206,0)
 .I $D(ADD("A")) D SETOP(ADD("A"),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",207,0)
 .S CSB=+$P(DRG0,"^",3),CSB=$S((CSB>0)&(CSB<6):"CS",1:"NCS")
"RTN","PSORXL",208,0)
 .I $D(ADD(CSB)) D SETOP(ADD(CSB),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",209,0)
 .I $D(ADD(RTE_CSB)) D SETOP(ADD(RTE_CSB),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",210,0)
 .S MTH=$S(RTE="W":"WIND",RTE="M":"MAIL",1:"")
"RTN","PSORXL",211,0)
 .I MTH'="",$D(ADD(MTH)) D SETOP(ADD(MTH),$P(PDAT,"^"),$P(DRG0,"^"))
"RTN","PSORXL",212,0)
 .S FLG=0
"RTN","PSORXL",213,0)
 I FLG Q  ;nothing found to print
"RTN","PSORXL",214,0)
 I ($D(OPAI))!($D(ADD("S"))) W !,"PRESCRIPTIONS SENT TO:" D
"RTN","PSORXL",215,0)
 .S DEV="" F  S DEV=$O(OPAI(DEV)) Q:DEV=""  W !?3,DEV D  W !
"RTN","PSORXL",216,0)
 ..S RX=0 F  S RX=$O(OPAI(DEV,RX)) Q:'RX  W !?5,RX,?20,$P(OPAI(DEV,RX),"^")
"RTN","PSORXL",217,0)
 I $D(ADD("S")) W !,"STORAGE DEVICES" S II="" D
"RTN","PSORXL",218,0)
 .F  S II=$O(ADD("S",II)) Q:II=""  W !?3,II I $D(OPAI) ;W ?20,"The above Prescriptions"
"RTN","PSORXL",219,0)
 .F II=1:1:$L(NPPL,",") S RX=$P(NPPL,",",II) D:RX'=""
"RTN","PSORXL",220,0)
 ..Q:$G(RXRP(RX,"RP"))  S PDAT=$G(^PSRX(RX,0)),DRG=$P($G(^PSDRUG(+$P(PDAT,"^",6),0)),"^")
"RTN","PSORXL",221,0)
 ..W !?5,$P(PDAT,"^"),?20,DRG
"RTN","PSORXL",222,0)
 .W !
"RTN","PSORXL",223,0)
 Q
"RTN","PSORXL",224,0)
 ;
"RTN","PSORXL",225,0)
SETOP(DINF,DRX,DDRG) ; Set OPAI array
"RTN","PSORXL",226,0)
 N DNAM
"RTN","PSORXL",227,0)
 S DNAM=$P(DINF,"^"),OPAI(DNAM)=DINF,OPAI(DNAM,DRX)=DDRG,FLG=0
"RTN","PSORXL",228,0)
 Q
"RTN","PSORXL",229,0)
 ;
"RTN","PSORXL",230,0)
RTE() ; get route for RX
"RTN","PSORXL",231,0)
 N FP,FPN,LRF,MW,XX
"RTN","PSORXL",232,0)
 S FP=$S($G(RXPR(RX)):"P",1:"F")
"RTN","PSORXL",233,0)
 I '$G(RXPR(RX)) S LRF=0 F XX=0:0 S XX=$O(^PSRX(RX,1,XX)) Q:'XX  I +^(XX,0) S LRF=XX
"RTN","PSORXL",234,0)
 I '$G(RXPR(RX)),$G(RXFL(RX))'="" S LRF=$S($G(RXFL(RX))=0:0,$D(^PSRX(RX,1,+$G(RXFL(RX)),0)):+$G(RXFL(RX)),1:$G(LRF))
"RTN","PSORXL",235,0)
 S FPN=$S($G(RXPR(RX)):RXPR(RX),1:$G(LRF))
"RTN","PSORXL",236,0)
 I FP="F"&('FPN) S MW=$P($G(^PSRX(RX,0)),"^",11)       ;original
"RTN","PSORXL",237,0)
 I FP="F"&(FPN) S MW=$P($G(^PSRX(RX,1,FPN,0)),"^",2)   ;refill
"RTN","PSORXL",238,0)
 I FP="P"&(FPN) S MW=$P($G(^PSRX(RX,"P",FPN,0)),"^",2) ;partial
"RTN","PSORXL",239,0)
 Q $G(MW)
"RTN","PSORXPA1")
0^10^B35364749^B35082205
"RTN","PSORXPA1",1,0)
PSORXPA1 ;BIR/SAB - listman partial prescriptions ;07/14/93
"RTN","PSORXPA1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,56,77,130,152,181,174,287,385,442**;DEC 1997;Build 29
"RTN","PSORXPA1",3,0)
 ;External references L,UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXPA1",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXPA1",5,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXPA1",6,0)
 I $D(RXRP($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Reprint Label has been requested!" Q
"RTN","PSORXPA1",7,0)
 ;I $D(RXPR($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Partial has already been requested!" Q
"RTN","PSORXPA1",8,0)
 I $D(RXRS($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="Rx is being pulled from suspense!" Q
"RTN","PSORXPA1",9,0)
 S PSORPDFN=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",2)
"RTN","PSORXPA1",10,0)
 S PSOPLCK=$$L^PSSLOCK(PSORPDFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK,PSORPDFN D  Q
"RTN","PSORXPA1",11,0)
 .S VALMBCK=""
"RTN","PSORXPA1",12,0)
 K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(PSORPDFN) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG,PSORPDFN Q
"RTN","PSORXPA1",13,0)
 I '$G(RXPR($P(PSOLST(ORN),"^",2))) S RX=$P(PSOLST(ORN),"^",2) D VALID^PSORXRP1 I $G(QFLG) S VALMBCK="",VALMSG="A New Label has been requested already!" K QFLG,RX D ULK Q
"RTN","PSORXPA1",14,0)
 D FULL^VALM1 I '$D(PSOPAR) D ^PSOLSET D:'$D(PSOPAR) ULK G:'$D(PSOPAR) KL
"RTN","PSORXPA1",15,0)
 S DA=$P(PSOLST(ORN),"^",2),RX0=^PSRX(DA,0),J=DA,RX2=$G(^(2)),R3=$G(^(3)) S:'$G(BBFLG) BBRX(1)=""
"RTN","PSORXPA1",16,0)
 ; BNT PSO*7*385
"RTN","PSORXPA1",17,0)
 N PSORF,PSOTRIC,PSOTCQ
"RTN","PSORXPA1",18,0)
 S PSORF=$$LSTRFL^PSOBPSU1(DA),PSOTRIC=$$TRIC^PSOREJP1(DA,PSORF),PSOTCQ=0
"RTN","PSORXPA1",19,0)
 I PSOTRIC D  Q:PSOTCQ
"RTN","PSORXPA1",20,0)
 . ; Check for PSO TRICARE/CHAMPVA security key
"RTN","PSORXPA1",21,0)
 . I '$D(^XUSEC("PSO TRICARE/CHAMPVA",DUZ)) D  Q
"RTN","PSORXPA1",22,0)
 . . S PSOTCQ=1,VALMBCK="R",VALMSG="Action Requires <PSO TRICARE/CHAMPVA> security key"
"RTN","PSORXPA1",23,0)
 . ; Is this RX non-billable?
"RTN","PSORXPA1",24,0)
 . I $$ECME^PSOBPSUT(DA)="" D  Q:PSOTCQ
"RTN","PSORXPA1",25,0)
 . . N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSORXPA1",26,0)
 . . S DIR(0)="Y"
"RTN","PSORXPA1",27,0)
 . . S DIR("A",1)="This partial fill is for a "_$$ELIGDISP^PSOREJP1(DA,PSORF)_" non-billable Rx and will not be reimbursed."
"RTN","PSORXPA1",28,0)
 . . S DIR("A")="Do you wish to continue"
"RTN","PSORXPA1",29,0)
 . . D ^DIR I Y'=1 S PSOTCQ=1,VALMBCK="R"
"RTN","PSORXPA1",30,0)
 . ; Is this RX rejected?
"RTN","PSORXPA1",31,0)
 . I $$STATUS^PSOBPSUT(DA,PSORF)="E REJECTED" D  Q:PSOTCQ
"RTN","PSORXPA1",32,0)
 . . N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSORXPA1",33,0)
 . . S DIR(0)="Y"
"RTN","PSORXPA1",34,0)
 . . S DIR("A",1)="This partial fill is for a "_$$ELIGDISP^PSOREJP1(DA,PSORF)_" rejected Rx and will not be reimbursed."
"RTN","PSORXPA1",35,0)
 . . S DIR("A")="Do you wish to continue"
"RTN","PSORXPA1",36,0)
 . . D ^DIR I Y'=1 S PSOTCQ=1,VALMBCK="R"
"RTN","PSORXPA1",37,0)
 I +$P($G(^PSRX(DA,2)),"^",6)<DT D
"RTN","PSORXPA1",38,0)
 .S:$P($G(^PSRX(DA,"STA")),"^")<12 $P(^PSRX(DA,"STA"),"^")=11
"RTN","PSORXPA1",39,0)
 .S COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"/"_$E($P(^(2),"^",6),6,7)_"/"_$E($P(^(2),"^",6),2,3)
"RTN","PSORXPA1",40,0)
 .S STAT="SC",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM) K STAT,PHARMST,COMM,RX0,J,RX2,R3
"RTN","PSORXPA1",41,0)
 ;I +$P($G(^PSRX(DA,2)),"^",6)<PSODTCUT D  K DA S VALMBCK="R" Q
"RTN","PSORXPA1",42,0)
 ;.S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"/"_$E($P(^(2),"^",6),6,7)_"/"_$E($P(^(2),"^",6),2,3)
"RTN","PSORXPA1",43,0)
 I +^PSRX(DA,"STA"),+^("STA")'=5,+^("STA")'=11 D  K DA S VALMBCK="R" D ULK Q
"RTN","PSORXPA1",44,0)
 .S C=";"_+^PSRX(DA,"STA")_":",X=$P(^DD(52,100,0),"^",3),E=$F(X,C),D=$P($E(X,E,999),";")
"RTN","PSORXPA1",45,0)
 .S VALMSG="Prescription is in a "_D_" status."
"RTN","PSORXPA1",46,0)
 I $G(PSXSYS),($O(^PS(52.5,"B",DA,""))) S PSOZ1=$O(^PS(52.5,"B",DA,"")) D
"RTN","PSORXPA1",47,0)
 .I $P($G(^PS(52.5,PSOZ1,0)),"^",7)="Q"!($P($G(^(0)),"^",7)="L") D
"RTN","PSORXPA1",48,0)
 ..W !!,"A partial entered for this Rx cannot be suspended."
"RTN","PSORXPA1",49,0)
 ..W !,"A fill for this Rx is already suspended for CMOP transmission."
"RTN","PSORXPA1",50,0)
 ..W !,"You may pull this fill from suspense or enter a partial and print the label.",!!
"RTN","PSORXPA1",51,0)
 ;..S PSOZZ=1 K PSOZ1
"RTN","PSORXPA1",52,0)
CLC S PSOCLC=DUZ,PHYS=$P(^PSRX(DA,0),"^",4),DRG=$P(^(0),"^",6)
"RTN","PSORXPA1",53,0)
 I 'PHYS,$O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S PHYS=$S($P(^PSRX(DA,1,I,0),"^",17):$P(^PSRX(DA,1,I,0),"^",17),1:PHYS)
"RTN","PSORXPA1",54,0)
 S PSOPRZ=0 I $O(^PSRX(DA,"P",0)) N Z2 F Z2=0:0 S Z2=$O(^PSRX(DA,"P",Z2)) Q:'Z2  S PSOPRZ=Z2
"RTN","PSORXPA1",55,0)
 K Z1,PRMK S PM=1,RXN=DA,RXF=6,DIE("NO^")="BACKOUTOK",DIE=52
"RTN","PSORXPA1",56,0)
 ;DR="[PSO PARTIAL]"
"RTN","PSORXPA1",57,0)
 S DR="K PM,PQ;60;Q;S:$O(Y(1))]""""!($G(PM)) Y=""@1"";35;@1;K PM;"
"RTN","PSORXPA1",58,0)
 S DR(2,52.2)=".01;S Z1=D1;.02;S:X=""M""!('$P($G(PSOPAR),U,12)) PM=1;.04;S:X=U PQ=1;.041R;S:X=U PQ=1;.05;.07////^S X=DUZ;6////^S X=PHYS;Q;.08///^S X=""NOW"";S PDT=X;.09////^S X=PSOSITE;.03;S:X=U PQ=1;S PRMK=X"
"RTN","PSORXPA1",59,0)
 D ^DIE
"RTN","PSORXPA1",60,0)
 I $D(RXPR(DA)),'$D(^PSRX(DA,"P",$G(RXPR(DA)))) D RMP^PSOCAN3
"RTN","PSORXPA1",61,0)
 G:'$G(Z1) CLCX
"RTN","PSORXPA1",62,0)
 I $G(PRMK)']"",Z1>PSOPRZ D ULK G KILL
"RTN","PSORXPA1",63,0)
 I Z1,$G(PRMK)]"" D  D:$T(EN^PSOHDR)]"" EN^PSOHDR("PPAR",RXN) K DIE,RXN,RXF
"RTN","PSORXPA1",64,0)
 .D ACT S:$P($G(^PSRX(RXN,"P",Z1,0)),"^",2)["W" PSODFN=$P(^PSRX(RXN,0),"^",2),BINGRTE="W",BBFLG=1,BBRX(1)=$G(BBRX(1))_RXN_","
"RTN","PSORXPA1",65,0)
 .S ZD(RXN)=+^PSRX(RXN,"P",Z1,0),^PSRX(RXN,"TYPE")=Z1,$P(^PSRX(RXN,"P",Z1,0),"^",11)=$P($G(^PSDRUG(DRG,660)),"^",6),RXF=6,RXP=Z1,RXPR(RXN)=RXP
"RTN","PSORXPA1",66,0)
 .;I $G(PSOZZ)=1,($G(Z1)) D Q1^PSORXL K Z1,PSOZZ Q
"RTN","PSORXPA1",67,0)
 .I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RXN_"," Q
"RTN","PSORXPA1",68,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  Q:PSORX("PSOL",PSOX1)[RXN_","  S PSOX2=PSOX1
"RTN","PSORXPA1",69,0)
 .I PSOX1 Q
"RTN","PSORXPA1",70,0)
 .I $L(PSORX("PSOL",PSOX2))+$L(RXN)<220 S:PSORX("PSOL",PSOX2)'[RXN_"," PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RXN_","
"RTN","PSORXPA1",71,0)
 .E  S PSORX("PSOL",PSOX2+1)=RXN_","
"RTN","PSORXPA1",72,0)
 S:('$D(PSOFROM)!$D(^PSRX(DA,"P",Z1,0))) PSOFROM="PARTIAL" S BINGCRT=1 ;D:$D(BINGRTE)&($D(DISGROUP)) ^PSOBING1 K BINGRTE,TM,TM1
"RTN","PSORXPA1",73,0)
CLCX D ULK K DR,DIE,DRG,PPL,RXP,IOP,DA,PHYS,PSOPRZ S VALMBCK="R" Q
"RTN","PSORXPA1",74,0)
 ;
"RTN","PSORXPA1",75,0)
KILL S DA=Z1,DIK="^PSRX("_RXN_",""P""," D ^DIK S ^PSRX(RXN,"TYPE")=0
"RTN","PSORXPA1",76,0)
 D ULK S VALMSG="No Partial Fill Dispensed",VALMBCK="R" Q
"RTN","PSORXPA1",77,0)
KL K DFN,RFDAT,RLL,%,PRMK,PM,%Y,%X,D0,D1,DA,DI,DIC,DIE,DLAYGO,DQ,DR,I,II,J,JJJ,N,PHYS,PS,PSDATE,RFL,RFL1,RXF,ST,ST0,Z,Z1,X,Y,PDT,PSL,PSNP
"RTN","PSORXPA1",78,0)
 K PSOM,PSOP,PSOD,PSOU,DIK,DUOUT,IFN,RXN,DRG,HRX,I1,PSOCLC,PSOLIST,PSOLST,PSPAR,RXP D KVA^VADPT Q
"RTN","PSORXPA1",79,0)
ACT ;adds activity info for partial rx
"RTN","PSORXPA1",80,0)
 S RXF=0 F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORXPA1",81,0)
 S DA=0 F FDA=0:0 S FDA=$O(^PSRX(RXN,"A",FDA)) Q:'FDA  S DA=FDA
"RTN","PSORXPA1",82,0)
 S DA=DA+1,^PSRX(RXN,"A",0)="^52.3DA^"_DA_"^"_DA,^PSRX(RXN,"A",DA,0)=DT_"^"_"P"_"^"_DUZ_"^"_RXF_"^"_PRMK
"RTN","PSORXPA1",83,0)
 ; BNT PSO*7*385 Add audit log entry for TRICARE or CHAMPVA RX
"RTN","PSORXPA1",84,0)
 N RXJST
"RTN","PSORXPA1",85,0)
 I PSOTRIC D
"RTN","PSORXPA1",86,0)
 . S RXJST=$S(PSOTRIC=1:"TRICARE",PSOTRIC=2:"CHAMPVA",1:"")_" Partial Fill"
"RTN","PSORXPA1",87,0)
 . D AUDIT^PSOTRI(RXN,RXF,,RXJST,"P",$S(PSOTRIC=1:"T",1:"C"))
"RTN","PSORXPA1",88,0)
EX K RXF,I,FDA S DA=RXN
"RTN","PSORXPA1",89,0)
 Q
"RTN","PSORXPA1",90,0)
ULK ;
"RTN","PSORXPA1",91,0)
 D UL^PSSLOCK(+$G(PSORPDFN))
"RTN","PSORXPA1",92,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSORXPA1",93,0)
 K PSOMSG,PSOPLCK,PSORPDFN
"RTN","PSORXPA1",94,0)
 Q
"RTN","PSOTALK1")
0^5^B5211959^B5110576
"RTN","PSOTALK1",1,0)
PSOTALK1 ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA (CONT'D) ; 7/16/15 3:32pm
"RTN","PSOTALK1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,318,282,442**;DEC 1997;Build 29
"RTN","PSOTALK1",3,0)
 ;External reference to File ^PS(51 supported by DBIA 2224
"RTN","PSOTALK1",4,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK1",5,0)
INST ;PARSE OUT PRINTED INSTRUCTIONS TO MAX 46 CHAR PER LINE
"RTN","PSOTALK1",6,0)
 K PSOLNE
"RTN","PSOTALK1",7,0)
 S PSOLEN=0,PSOLINE=1,PSOWDS=$L(SIG," ")
"RTN","PSOTALK1",8,0)
 F PSOWORD=1:1 Q:PSOWORD>PSOWDS  D  ;
"RTN","PSOTALK1",9,0)
 . S PSOLNE(PSOLINE)=$G(PSOLNE(PSOLINE))_$P(SIG," ",PSOWORD)_" "
"RTN","PSOTALK1",10,0)
 . S PSOLEN=$G(PSOLEN)+$L($P(SIG," ",PSOWORD))+1
"RTN","PSOTALK1",11,0)
 . I PSOLEN+$L($P(SIG," ",PSOWORD+1))>46 S PSOLINE=PSOLINE+1,PSOLEN=0
"RTN","PSOTALK1",12,0)
 Q
"RTN","PSOTALK1",13,0)
 ;
"RTN","PSOTALK1",14,0)
LSIG(SIG) ;EXPAND A SIG
"RTN","PSOTALK1",15,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","PSOTALK1",16,0)
 .;PSO*7*282 Intended Use Check
"RTN","PSOTALK1",17,0)
 .N PSOIN S PSOIN=$O(^PS(51,"B",X,0)) I PSOIN,($P(^PS(51,PSOIN,0),"^",4)<2)&($D(^PS(51,"A",X))) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG,"",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSOTALK1",18,0)
 .S SGY=SGY_X_" "
"RTN","PSOTALK1",19,0)
 Q SGY
"RTN","PSOTALK1",20,0)
 ;
"RTN","PSOTALK1",21,0)
READER(ZDIR0,ZDIRA,ZDIRB) ;BASIC SHELL FOR DIR READS
"RTN","PSOTALK1",22,0)
 N X,Y,DIRUT,DIROUT,DTOUT,DUOUT,DIR,ZREAD
"RTN","PSOTALK1",23,0)
 S DIR(0)=ZDIR0 S:$G(ZDIRA)]"" DIR("A")=ZDIRA S:$G(ZDIRB)]"" DIR("B")=ZDIRB
"RTN","PSOTALK1",24,0)
 D ^DIR K DIR
"RTN","PSOTALK1",25,0)
 S:Y]"" ZREAD=Y
"RTN","PSOTALK1",26,0)
 I $D(DTOUT)!($D(DIRUT)) K ZREAD
"RTN","PSOTALK1",27,0)
 Q $G(ZREAD,"")
"RTN","PSOTALK1",28,0)
 ;
"RTN","PSOTALK1",29,0)
PSOSTALK ; SEE IF SCRIPTALK PATIENT AND PRINTER EXISTS AND IS SET TO AUTO-PRINT
"RTN","PSOTALK1",30,0)
 S PSOSTALK=0
"RTN","PSOTALK1",31,0)
 D AUTO^PSOTALK
"RTN","PSOTALK1",32,0)
 I 'PSOSTALK Q
"RTN","PSOTALK1",33,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOTALK1",34,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOTALK1",35,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOTALK1",36,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ScripTalk label printed"_$S($G(RXP):" (Partial)",1:"")_$S($G(REPRINT):" (Reprint)",1:"")_"^"_PDUZ_"^^"_$G(PSOLAP) ;*442
"RTN","PSOTALK1",37,0)
 Q
"RTN","PSOTALK1",38,0)
 ;
"VER")
8.0^22.2
"BLD",9875,6)
^408
**END**
**END**

