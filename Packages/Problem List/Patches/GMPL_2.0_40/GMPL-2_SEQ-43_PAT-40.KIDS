Released GMPL*2*40 SEQ #43
Extracted from mail message
**KIDS**:GMPL*2.0*40^

**INSTALL NAME**
GMPL*2.0*40
"BLD",9306,0)
GMPL*2.0*40^PROBLEM LIST^0^3160121^y
"BLD",9306,1,0)
^^2^2^3160120^
"BLD",9306,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",9306,1,2,0)
under GMPL*2.0*40.
"BLD",9306,4,0)
^9.64PA^^
"BLD",9306,6.3)
9
"BLD",9306,"INID")
^y
"BLD",9306,"INIT")
POST^GMPLY40
"BLD",9306,"KRN",0)
^9.67PA^779.2^20
"BLD",9306,"KRN",.4,0)
.4
"BLD",9306,"KRN",.401,0)
.401
"BLD",9306,"KRN",.402,0)
.402
"BLD",9306,"KRN",.403,0)
.403
"BLD",9306,"KRN",.5,0)
.5
"BLD",9306,"KRN",.84,0)
.84
"BLD",9306,"KRN",3.6,0)
3.6
"BLD",9306,"KRN",3.8,0)
3.8
"BLD",9306,"KRN",9.2,0)
9.2
"BLD",9306,"KRN",9.8,0)
9.8
"BLD",9306,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9306,"KRN",9.8,"NM",1,0)
GMPLCLN^^0^B143436186
"BLD",9306,"KRN",9.8,"NM",2,0)
GMPLY40^^0^B38628
"BLD",9306,"KRN",9.8,"NM",3,0)
GMPLX^^0^B102602938
"BLD",9306,"KRN",9.8,"NM",4,0)
GMPLUTL^^0^B62818534
"BLD",9306,"KRN",9.8,"NM",5,0)
GMPLCLNP^^0^B88965830
"BLD",9306,"KRN",9.8,"NM","B","GMPLCLN",1)

"BLD",9306,"KRN",9.8,"NM","B","GMPLCLNP",5)

"BLD",9306,"KRN",9.8,"NM","B","GMPLUTL",4)

"BLD",9306,"KRN",9.8,"NM","B","GMPLX",3)

"BLD",9306,"KRN",9.8,"NM","B","GMPLY40",2)

"BLD",9306,"KRN",19,0)
19
"BLD",9306,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",9306,"KRN",19,"NM",1,0)
GMPL DIAG CLEANUP REPORT^^0
"BLD",9306,"KRN",19,"NM",2,0)
GMPL DIAG ERROR REPORT^^0
"BLD",9306,"KRN",19,"NM",3,0)
GMPL GENERATE DIAG RPTS^^0
"BLD",9306,"KRN",19,"NM",4,0)
GMPL MGT MENU^^2
"BLD",9306,"KRN",19,"NM","B","GMPL DIAG CLEANUP REPORT",1)

"BLD",9306,"KRN",19,"NM","B","GMPL DIAG ERROR REPORT",2)

"BLD",9306,"KRN",19,"NM","B","GMPL GENERATE DIAG RPTS",3)

"BLD",9306,"KRN",19,"NM","B","GMPL MGT MENU",4)

"BLD",9306,"KRN",19.1,0)
19.1
"BLD",9306,"KRN",101,0)
101
"BLD",9306,"KRN",409.61,0)
409.61
"BLD",9306,"KRN",771,0)
771
"BLD",9306,"KRN",779.2,0)
779.2
"BLD",9306,"KRN",870,0)
870
"BLD",9306,"KRN",8989.51,0)
8989.51
"BLD",9306,"KRN",8989.52,0)
8989.52
"BLD",9306,"KRN",8994,0)
8994
"BLD",9306,"KRN","B",.4,.4)

"BLD",9306,"KRN","B",.401,.401)

"BLD",9306,"KRN","B",.402,.402)

"BLD",9306,"KRN","B",.403,.403)

"BLD",9306,"KRN","B",.5,.5)

"BLD",9306,"KRN","B",.84,.84)

"BLD",9306,"KRN","B",3.6,3.6)

"BLD",9306,"KRN","B",3.8,3.8)

"BLD",9306,"KRN","B",9.2,9.2)

"BLD",9306,"KRN","B",9.8,9.8)

"BLD",9306,"KRN","B",19,19)

"BLD",9306,"KRN","B",19.1,19.1)

"BLD",9306,"KRN","B",101,101)

"BLD",9306,"KRN","B",409.61,409.61)

"BLD",9306,"KRN","B",771,771)

"BLD",9306,"KRN","B",779.2,779.2)

"BLD",9306,"KRN","B",870,870)

"BLD",9306,"KRN","B",8989.51,8989.51)

"BLD",9306,"KRN","B",8989.52,8989.52)

"BLD",9306,"KRN","B",8994,8994)

"BLD",9306,"QUES",0)
^9.62^^
"BLD",9306,"REQB",0)
^9.611^1^1
"BLD",9306,"REQB",1,0)
GMPL*2.0*42^2
"BLD",9306,"REQB","B","GMPL*2.0*42",1)

"INIT")
POST^GMPLY40
"KRN",19,8487,-1)
2^4
"KRN",19,8487,0)
GMPL MGT MENU^Problem List Mgt Menu^^M^.5^^^^^^^402^^1^1
"KRN",19,8487,10,0)
^19.01IP^14^14
"KRN",19,8487,10,12,0)
14290^9^9
"KRN",19,8487,10,12,"^")
GMPL DIAG ERROR REPORT
"KRN",19,8487,10,13,0)
14291^10^10
"KRN",19,8487,10,13,"^")
GMPL DIAG CLEANUP REPORT
"KRN",19,8487,10,14,0)
14292^11^11
"KRN",19,8487,10,14,"^")
GMPL GENERATE DIAG RPTS
"KRN",19,8487,"U")
PROBLEM LIST MGT MENU
"KRN",19,14290,-1)
0^2
"KRN",19,14290,0)
GMPL DIAG ERROR REPORT^SNOMED in Diagnosis Field Error Report^^A^^^^^^^^PROBLEM LIST^^1
"KRN",19,14290,1,0)
^19.06^3^3^3150706^^
"KRN",19,14290,1,1,0)
This report allows sites to evaluate and review erroneous problems found 
"KRN",19,14290,1,2,0)
in the Problem file that have a SNOMED CT concept code stored in the
"KRN",19,14290,1,3,0)
Diagnosis field.
"KRN",19,14290,20)
D VWERRPT^GMPLCLN
"KRN",19,14290,"U")
SNOMED IN DIAGNOSIS FIELD ERRO
"KRN",19,14291,-1)
0^1
"KRN",19,14291,0)
GMPL DIAG CLEANUP REPORT^SNOMED in Diagnosis Field Cleanup Report^^A^^^^^^^^PROBLEM LIST^^1
"KRN",19,14291,1,0)
^19.06^4^4^3150706^^
"KRN",19,14291,1,1,0)
This report allows sites to review a list of records that have been 
"KRN",19,14291,1,2,0)
corrected and cleaned up by patch GMPL*2.0*40 or as a result of running 
"KRN",19,14291,1,3,0)
the Generate SNOMED in Diagnosis Field Err/Cleanup Rpt [GMPL GENERATE 
"KRN",19,14291,1,4,0)
DIAG RPTS] menu option.
"KRN",19,14291,20)
D VWCLRPT^GMPLCLN
"KRN",19,14291,"U")
SNOMED IN DIAGNOSIS FIELD CLEA
"KRN",19,14292,-1)
0^3
"KRN",19,14292,0)
GMPL GENERATE DIAG RPTS^Generate SNOMED in Diagnosis Field Err/Cleanup Rpt^^A^^^^^^^^PROBLEM LIST^^1
"KRN",19,14292,1,0)
^^5^5^3150625^
"KRN",19,14292,1,1,0)
This option allows sites to run a scan of the Problem file for errors 
"KRN",19,14292,1,2,0)
whereby the SNOMED CT concept code is incorrectly stored in the Diagnosis 
"KRN",19,14292,1,3,0)
field. If errors are found, a cleanup of the Problem file is performed and
"KRN",19,14292,1,4,0)
two separate Mailman messages will be sent to the installer containing 
"KRN",19,14292,1,5,0)
instructions on how to access the error and cleanup reports.
"KRN",19,14292,20)
D EN^GMPLCLNP
"KRN",19,14292,"U")
GENERATE SNOMED IN DIAGNOSIS F
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",402,-1)
1^1
"PKG",402,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",402,20,0)
^9.402P^^
"PKG",402,22,0)
^9.49I^1^1
"PKG",402,22,1,0)
2.0^2940825^2941216
"PKG",402,22,1,"PAH",1,0)
40^3160121
"PKG",402,22,1,"PAH",1,1,0)
^^2^2^3160121
"PKG",402,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",402,22,1,"PAH",1,1,2,0)
under GMPL*2.0*40.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMPLCLN")
0^1^B143436186^n/a
"RTN","GMPLCLN",1,0)
GMPLCLN ;ISP/TC - Problem File Cleanup Utilities ;01/21/16  09:31
"RTN","GMPLCLN",2,0)
 ;;2.0;Problem List;**40**;Aug 25, 1994;Build 9
"RTN","GMPLCLN",3,0)
 ;
"RTN","GMPLCLN",4,0)
 ;
"RTN","GMPLCLN",5,0)
 ; External References
"RTN","GMPLCLN",6,0)
 ;    BROWSE^DDBR           ICR   2607
"RTN","GMPLCLN",7,0)
 ;    XMZ^XMA2              ICR  10066
"RTN","GMPLCLN",8,0)
 ;    ENT1^XMD              ICR  10070
"RTN","GMPLCLN",9,0)
 ;    $$NOW^XLFDT           ICR  10103
"RTN","GMPLCLN",10,0)
 ;    $$FMADD^XLFDT         ICR  10103
"RTN","GMPLCLN",11,0)
 ;    $$FMTE^XLFDT          ICR  10103
"RTN","GMPLCLN",12,0)
 ;    $$REPEAT^XLFSTR       ICR  10104
"RTN","GMPLCLN",13,0)
 ;    $$LJ^XLFSTR           ICR  10104
"RTN","GMPLCLN",14,0)
 ;    MES^XPDUTL            ICR  10141
"RTN","GMPLCLN",15,0)
 ;
"RTN","GMPLCLN",16,0)
BLDLEMSG(GMPLMSG,GMPLNERR,GMPLFROM,GMPLNODE) ; Build Lock Error MailMan message and send to installer
"RTN","GMPLCLN",17,0)
 N GMPLTO,GMPXMSUB,SUB,GMPMAXER,GMPLEND,GMPI,GMPJ,GMPK,GMPCNT,GMPCNTR
"RTN","GMPLCLN",18,0)
 S GMPCNT=4,GMPK=""
"RTN","GMPLCLN",19,0)
 I GMPLNERR=0 Q
"RTN","GMPLCLN",20,0)
 S GMPMAXER=200
"RTN","GMPLCLN",21,0)
 K ^TMP("GMPXMZLE",$J)
"RTN","GMPLCLN",22,0)
 S SUB="GMPXMZLE"
"RTN","GMPLCLN",23,0)
 S ^TMP(SUB,$J,1,0)="A lock on the following record entries could not be obtained because another"
"RTN","GMPLCLN",24,0)
 S ^TMP(SUB,$J,2,0)="user was editing the entry. As a result these entries could not be corrected/"
"RTN","GMPLCLN",25,0)
 S ^TMP(SUB,$J,3,0)="updated."
"RTN","GMPLCLN",26,0)
 S ^TMP(SUB,$J,4,0)=""
"RTN","GMPLCLN",27,0)
 I $D(GMPLMSG) D
"RTN","GMPLCLN",28,0)
 . F  S GMPK=$O(GMPLMSG(GMPK)) Q:'GMPK  D
"RTN","GMPLCLN",29,0)
 . . S GMPCNT=GMPCNT+1
"RTN","GMPLCLN",30,0)
 . . S ^TMP(SUB,$J,GMPCNT,0)=$G(GMPLMSG(GMPK))
"RTN","GMPLCLN",31,0)
 S GMPCNT=GMPCNT+1
"RTN","GMPLCLN",32,0)
 I $D(GMPLMSG) S ^TMP(SUB,$J,GMPCNT,0)=""
"RTN","GMPLCLN",33,0)
 S GMPLEND=$S(GMPLNERR'>GMPMAXER:GMPLNERR+GMPCNT,1:GMPMAXER)
"RTN","GMPLCLN",34,0)
 S GMPLEND=$S(GMPLNERR'>GMPMAXER:GMPLEND-1,1:GMPLEND)
"RTN","GMPLCLN",35,0)
 S GMPJ=GMPLNERR+1
"RTN","GMPLCLN",36,0)
 F GMPI=GMPCNT:1:GMPLEND D
"RTN","GMPLCLN",37,0)
 . S GMPJ=GMPJ-1,GMPCNTR=$S($D(GMPLMSG):GMPI+1,1:GMPI)
"RTN","GMPLCLN",38,0)
 . S ^TMP(SUB,$J,GMPCNTR,0)=^TMP(GMPLNODE,$J,GMPJ,0)
"RTN","GMPLCLN",39,0)
 I GMPLEND=GMPMAXER S ^TMP(SUB,$J,GMPMAXER+1,0)="Maximum number of errors reached, will not report anymore."
"RTN","GMPLCLN",40,0)
 K ^TMP(GMPLNODE,$J)
"RTN","GMPLCLN",41,0)
 S GMPXMSUB="Lock Errors during Problem File Cleanup"
"RTN","GMPLCLN",42,0)
 S GMPLTO(DUZ)=""
"RTN","GMPLCLN",43,0)
 D SEND(SUB,GMPXMSUB,.GMPLTO,GMPLFROM)
"RTN","GMPLCLN",44,0)
 Q
"RTN","GMPLCLN",45,0)
BLDNEMSG(GMPLMSG,GMPLSUB,GMPLFROM,GMPLRNTM) ; Build No Error Found MailMan message and send to installer
"RTN","GMPLCLN",46,0)
 N GMPLTO,SUB,GMPJ,GMPCNT S GMPJ="",GMPCNT=3
"RTN","GMPLCLN",47,0)
 K ^TMP("GMPXMZNE",$J)
"RTN","GMPLCLN",48,0)
 S SUB="GMPXMZNE"
"RTN","GMPLCLN",49,0)
 S GMPLTO(DUZ)=""
"RTN","GMPLCLN",50,0)
 S ^TMP(SUB,$J,1,0)="A scan of your system's Problem file #9000011 has been performed on:"
"RTN","GMPLCLN",51,0)
 S ^TMP(SUB,$J,2,0)=""_$$FMTE^XLFDT(GMPLRNTM,1)_""
"RTN","GMPLCLN",52,0)
 S ^TMP(SUB,$J,3,0)=""
"RTN","GMPLCLN",53,0)
 I $D(GMPLMSG) D
"RTN","GMPLCLN",54,0)
 . F  S GMPJ=$O(GMPLMSG(GMPJ)) Q:'GMPJ  D
"RTN","GMPLCLN",55,0)
 . . S GMPCNT=GMPCNT+1
"RTN","GMPLCLN",56,0)
 . . S ^TMP(SUB,$J,GMPCNT,0)=$G(GMPLMSG(GMPJ))
"RTN","GMPLCLN",57,0)
 D SEND(SUB,GMPLSUB,.GMPLTO,GMPLFROM)
"RTN","GMPLCLN",58,0)
 Q
"RTN","GMPLCLN",59,0)
BLDERMSG(GMPLNERR) ; Build MailMan error message content and send to installer
"RTN","GMPLCLN",60,0)
 N GMPLTO,GMPLFROM,GMPXMSUB,SUB
"RTN","GMPLCLN",61,0)
 K ^TMP("GMPLXMZE",$J)
"RTN","GMPLCLN",62,0)
 S SUB="GMPLXMZE"
"RTN","GMPLCLN",63,0)
 S GMPXMSUB="Problem File Error Scan Complete"
"RTN","GMPLCLN",64,0)
 S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLN",65,0)
 S GMPLTO(DUZ)=""
"RTN","GMPLCLN",66,0)
 S ^TMP(SUB,$J,1,0)="A scan of your system's Problem file #9000011 has been performed for possible"
"RTN","GMPLCLN",67,0)
 S ^TMP(SUB,$J,2,0)="errors. There are "_GMPLNERR_" record entries that contain a SNOMED CT concept code"
"RTN","GMPLCLN",68,0)
 S ^TMP(SUB,$J,3,0)="in the Diagnosis field #.01."
"RTN","GMPLCLN",69,0)
 S ^TMP(SUB,$J,4,0)=""
"RTN","GMPLCLN",70,0)
 S ^TMP(SUB,$J,5,0)="To see a report of these records, please access the SNOMED in Diagnosis Field"
"RTN","GMPLCLN",71,0)
 S ^TMP(SUB,$J,6,0)="Error Report [GMPL DIAG ERROR REPORT] which is attached to the Problem List Mgt"
"RTN","GMPLCLN",72,0)
 S ^TMP(SUB,$J,7,0)="Menu [GMPL MGT MENU]."
"RTN","GMPLCLN",73,0)
 S ^TMP(SUB,$J,8,0)=""
"RTN","GMPLCLN",74,0)
 S ^TMP(SUB,$J,9,0)="These record entries will initially be corrected with the installation of"
"RTN","GMPLCLN",75,0)
 S ^TMP(SUB,$J,10,0)="GMPL*2.0*40 or by running the Generate SNOMED in Diagnosis Field Err/Cleanup"
"RTN","GMPLCLN",76,0)
 S ^TMP(SUB,$J,11,0)="Rpt [GMPL GENERATE DIAG RPTS] menu option off the Problem List Mgt Menu."
"RTN","GMPLCLN",77,0)
 S ^TMP(SUB,$J,12,0)=""
"RTN","GMPLCLN",78,0)
 S ^TMP(SUB,$J,13,0)="Once the cleanup is complete, a separate MailMan message will be sent to the"
"RTN","GMPLCLN",79,0)
 S ^TMP(SUB,$J,14,0)="installer containing instructions on how to access the cleanup report."
"RTN","GMPLCLN",80,0)
 D SEND(SUB,GMPXMSUB,.GMPLTO,GMPLFROM)
"RTN","GMPLCLN",81,0)
 Q
"RTN","GMPLCLN",82,0)
BLDCLMSG(GMPLMSG,GMPLSUB,GMPLFROM,GMPLNCLN) ; Build MailMan cleanup message content and send to installer
"RTN","GMPLCLN",83,0)
 N GMPLTO,SUB,GMPJ,GMPCNT S GMPJ="",GMPCNT=3
"RTN","GMPLCLN",84,0)
 K ^TMP("GMPLXMZC",$J)
"RTN","GMPLCLN",85,0)
 S SUB="GMPLXMZC"
"RTN","GMPLCLN",86,0)
 S GMPLTO(DUZ)=""
"RTN","GMPLCLN",87,0)
 S ^TMP(SUB,$J,1,0)="A cleanup of the Problem file has been performed and "_GMPLNCLN_" record"
"RTN","GMPLCLN",88,0)
 S ^TMP(SUB,$J,2,0)="entries have been corrected."
"RTN","GMPLCLN",89,0)
 S ^TMP(SUB,$J,3,0)=""
"RTN","GMPLCLN",90,0)
 I $D(GMPLMSG) D
"RTN","GMPLCLN",91,0)
 . F  S GMPJ=$O(GMPLMSG(GMPJ)) Q:'GMPJ  D
"RTN","GMPLCLN",92,0)
 . . S GMPCNT=GMPCNT+1
"RTN","GMPLCLN",93,0)
 . . S ^TMP(SUB,$J,GMPCNT,0)=$G(GMPLMSG(GMPJ))
"RTN","GMPLCLN",94,0)
 D SEND(SUB,GMPLSUB,.GMPLTO,GMPLFROM)
"RTN","GMPLCLN",95,0)
 Q
"RTN","GMPLCLN",96,0)
BLDRPMSG(GMPLNERR,GMPLRNTM) ; Build Error Report Mailman Message and send to installer
"RTN","GMPLCLN",97,0)
 N GMPLTO,GMPLFROM,GMPXMSUB,SUB,GMPLREC,GMPLCNT,GMPLDA S GMPLCNT=20,GMPLDA=""
"RTN","GMPLCLN",98,0)
 K ^TMP("GMPLXMZR",$J)
"RTN","GMPLCLN",99,0)
 S SUB="GMPLXMZR"
"RTN","GMPLCLN",100,0)
 S GMPXMSUB="Incorrect Mapping Report"
"RTN","GMPLCLN",101,0)
 S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLN",102,0)
 S GMPLTO(DUZ)=""
"RTN","GMPLCLN",103,0)
 S ^TMP(SUB,$J,1,0)=""
"RTN","GMPLCLN",104,0)
 S ^TMP(SUB,$J,2,0)="Problem file scan runtime: "_$$FMTE^XLFDT(GMPLRNTM,1)
"RTN","GMPLCLN",105,0)
 S ^TMP(SUB,$J,3,0)=""
"RTN","GMPLCLN",106,0)
 S ^TMP(SUB,$J,4,0)="A scan of your system's Problem file #9000011 has been performed for possible"
"RTN","GMPLCLN",107,0)
 S ^TMP(SUB,$J,5,0)="errors. There are "_GMPLNERR_" record entries that contain an incorrect SNOMED CT"
"RTN","GMPLCLN",108,0)
 S ^TMP(SUB,$J,6,0)="428283002 to ICD-9-CM V15.89 code mapping for the term ""History of polyp of"
"RTN","GMPLCLN",109,0)
 S ^TMP(SUB,$J,7,0)="colon"". As a result the V15.89 code is incorrectly stored in the Diagnosis"
"RTN","GMPLCLN",110,0)
 S ^TMP(SUB,$J,8,0)="field #.01."
"RTN","GMPLCLN",111,0)
 S ^TMP(SUB,$J,9,0)=""
"RTN","GMPLCLN",112,0)
 S ^TMP(SUB,$J,10,0)="This report contains a list of these erroneous record entries which will be"
"RTN","GMPLCLN",113,0)
 S ^TMP(SUB,$J,11,0)="corrected after the installation of GMPL*2.0*40. Once the cleanup is complete,"
"RTN","GMPLCLN",114,0)
 S ^TMP(SUB,$J,12,0)="the correct V12.72 code will be stored in the Diagnosis field."
"RTN","GMPLCLN",115,0)
 S ^TMP(SUB,$J,13,0)=""
"RTN","GMPLCLN",116,0)
 S ^TMP(SUB,$J,14,0)="**ATTENTION CACs!!**: Once the cleanup is complete, please also review the"
"RTN","GMPLCLN",117,0)
 S ^TMP(SUB,$J,15,0)="Colonoscopy clinical reminders for the corresponding patients and verify that"
"RTN","GMPLCLN",118,0)
 S ^TMP(SUB,$J,16,0)="the corrections have been updated appropriately for those as well."
"RTN","GMPLCLN",119,0)
 S ^TMP(SUB,$J,17,0)=""
"RTN","GMPLCLN",120,0)
 S ^TMP(SUB,$J,18,0)=""
"RTN","GMPLCLN",121,0)
 S ^TMP(SUB,$J,19,0)="IEN"_$J("PATIENT",22)_$J("PROVIDER NARRATIVE",44)
"RTN","GMPLCLN",122,0)
 S ^TMP(SUB,$J,20,0)=$$REPEAT^XLFSTR("-",15)_$J($$REPEAT^XLFSTR("-",30),33)_$J($$REPEAT^XLFSTR("-",28),31)
"RTN","GMPLCLN",123,0)
 F  S GMPLDA=$O(^TMP("GMPLVCDE",$J,GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLN",124,0)
 . S GMPLREC=$G(^TMP("GMPLVCDE",$J,GMPLDA)),GMPLCNT=GMPLCNT+1
"RTN","GMPLCLN",125,0)
 . S ^TMP(SUB,$J,GMPLCNT,0)=$$LJ^XLFSTR($G(GMPLDA),18)_$$LJ^XLFSTR($P(GMPLREC,U,1),33)_$$LJ^XLFSTR($P(GMPLREC,U,2),28)
"RTN","GMPLCLN",126,0)
 D SEND(SUB,GMPXMSUB,.GMPLTO,GMPLFROM)
"RTN","GMPLCLN",127,0)
 Q
"RTN","GMPLCLN",128,0)
SEND(GMPLNODE,GMPLSUB,GMPLTO,GMPLFROM) ; Send a MailMan message whose text is in
"RTN","GMPLCLN",129,0)
 ;^TMP(GMPLNODE,$J,N,0). GMPLSUB is the subject. GMPLTO is the optional
"RTN","GMPLCLN",130,0)
 ;list of addresses, setup exactly like ;the MailMan XMY array.
"RTN","GMPLCLN",131,0)
 ;GMPLFROM is the optional message from, if it is not defined then from will be
"RTN","GMPLCLN",132,0)
 ;Problem List Support. This can be free text or a DUZ.
"RTN","GMPLCLN",133,0)
 ;
"RTN","GMPLCLN",134,0)
 N GMPLNL,XMDUZ,XMSUB,XMY,XMZ
"RTN","GMPLCLN",135,0)
 ;
"RTN","GMPLCLN",136,0)
 ;Make sure the subject does not exceed 64 characters.
"RTN","GMPLCLN",137,0)
 S XMSUB=$E(GMPLSUB,1,64)
"RTN","GMPLCLN",138,0)
 ;
"RTN","GMPLCLN",139,0)
 ;Make the default sender Problem List.
"RTN","GMPLCLN",140,0)
 S XMDUZ=$S($G(GMPLFROM)="":"Problem List Support",1:GMPLFROM)
"RTN","GMPLCLN",141,0)
 ;
"RTN","GMPLCLN",142,0)
RETRY ;Get the message number.
"RTN","GMPLCLN",143,0)
 D XMZ^XMA2
"RTN","GMPLCLN",144,0)
 I XMZ<1 G RETRY
"RTN","GMPLCLN",145,0)
 ;
"RTN","GMPLCLN",146,0)
 ;Load the message
"RTN","GMPLCLN",147,0)
 M ^XMB(3.9,XMZ,2)=^TMP(GMPLNODE,$J)
"RTN","GMPLCLN",148,0)
 K ^TMP(GMPLNODE,$J)
"RTN","GMPLCLN",149,0)
 S GMPLNL=$O(^XMB(3.9,XMZ,2,""),-1)
"RTN","GMPLCLN",150,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_+GMPLNL_U_+GMPLNL_U_DT
"RTN","GMPLCLN",151,0)
 ;
"RTN","GMPLCLN",152,0)
 ;Send message to TO list if it is defined.
"RTN","GMPLCLN",153,0)
 I $D(GMPLTO) M XMY=GMPLTO D ENT1^XMD Q
"RTN","GMPLCLN",154,0)
 ;
"RTN","GMPLCLN",155,0)
BLDERRPT(GMPLNERR,GMPLRNTM) ; Build Error Report
"RTN","GMPLCLN",156,0)
 N GMPDLM,GMPDA,GMPX,GMPJ,SUB,GMPLPSUB S (GMPDLM,GMPDA)="",GMPJ=20
"RTN","GMPLCLN",157,0)
 S GMPLPSUB=$O(^XTMP("GMPLERPT;"))
"RTN","GMPLCLN",158,0)
 I GMPLPSUB["GMPLERPT" K ^XTMP(GMPLPSUB)
"RTN","GMPLCLN",159,0)
 S SUB="GMPLERPT;"_$H
"RTN","GMPLCLN",160,0)
 S ^XTMP(SUB,0)=$$FMADD^XLFDT($$NOW^XLFDT,30)_U_$$NOW^XLFDT()_U_"SNOMED in Diagnosis Field Error Rpt"
"RTN","GMPLCLN",161,0)
 S ^XTMP(SUB,1,0)=""
"RTN","GMPLCLN",162,0)
 S ^XTMP(SUB,2,0)="**NOTE**: This report is retroactive as of the last Problem file scan runtime:"
"RTN","GMPLCLN",163,0)
 S ^XTMP(SUB,3,0)=""_$$FMTE^XLFDT(GMPLRNTM,1)_". This report will expire and be purged from the system in"
"RTN","GMPLCLN",164,0)
 S ^XTMP(SUB,4,0)="30 days. If the Generate SNOMED in Diagnosis Field Err/Cleanup Rpt [GMPL"
"RTN","GMPLCLN",165,0)
 S ^XTMP(SUB,5,0)="GENERATE DIAG RPTS] menu option is run prior to the 30 days, then this report"
"RTN","GMPLCLN",166,0)
 S ^XTMP(SUB,6,0)="will expire on the date/time the option is run. Whichever comes first."
"RTN","GMPLCLN",167,0)
 S ^XTMP(SUB,7,0)=""
"RTN","GMPLCLN",168,0)
 S ^XTMP(SUB,8,0)="A scan of your system's Problem file #9000011 has been performed for possible"
"RTN","GMPLCLN",169,0)
 S ^XTMP(SUB,9,0)="errors. The following "_GMPLNERR_" record entries contain a SNOMED CT concept code"
"RTN","GMPLCLN",170,0)
 S ^XTMP(SUB,10,0)="in the Diagnosis field #.01. This report contains 4 columns. Please scroll to"
"RTN","GMPLCLN",171,0)
 S ^XTMP(SUB,11,0)="the right to see a full display of the Problem text."
"RTN","GMPLCLN",172,0)
 S ^XTMP(SUB,12,0)=""
"RTN","GMPLCLN",173,0)
 S ^XTMP(SUB,13,0)="These record entries will be corrected and upon completion, a separate MailMan"
"RTN","GMPLCLN",174,0)
 S ^XTMP(SUB,14,0)="message will be sent to the installer containing instructions on how to access"
"RTN","GMPLCLN",175,0)
 S ^XTMP(SUB,15,0)="the cleanup report."
"RTN","GMPLCLN",176,0)
 S ^XTMP(SUB,16,0)=""
"RTN","GMPLCLN",177,0)
 S ^XTMP(SUB,17,0)=""
"RTN","GMPLCLN",178,0)
 S ^XTMP(SUB,18,0)=$J("DATE LAST",27)
"RTN","GMPLCLN",179,0)
 S ^XTMP(SUB,19,0)="IEN"_$J("MODIFIED",23)_$J("DIAGNOSIS",16)_$J("PROBLEM",19)
"RTN","GMPLCLN",180,0)
 S ^XTMP(SUB,20,0)=$$REPEAT^XLFSTR("-",15)_$J($$REPEAT^XLFSTR("-",12),15)_$J($$REPEAT^XLFSTR("-",18),21)_$J($$REPEAT^XLFSTR("-",25),28)
"RTN","GMPLCLN",181,0)
 F  S GMPDLM=$O(^TMP("GMPLSCT",$J,GMPDLM)) Q:'GMPDLM  D
"RTN","GMPLCLN",182,0)
 . F  S GMPDA=$O(^TMP("GMPLSCT",$J,GMPDLM,GMPDA)) Q:'GMPDA  D
"RTN","GMPLCLN",183,0)
 . . S GMPX=$G(^TMP("GMPLSCT",$J,GMPDLM,GMPDA)),GMPJ=GMPJ+1
"RTN","GMPLCLN",184,0)
 . . S ^XTMP(SUB,GMPJ,0)=$$LJ^XLFSTR($G(GMPDA),18)_$$LJ^XLFSTR($P(GMPX,U,1),15)_$$LJ^XLFSTR($P(GMPX,U,2),21)_$$LJ^XLFSTR($P(GMPX,U,3),$L($P(GMPX,U,3)))
"RTN","GMPLCLN",185,0)
 Q
"RTN","GMPLCLN",186,0)
 ;
"RTN","GMPLCLN",187,0)
BLDCLRPT(GMPLNCLN,GMPLRNTM) ; Build Cleanup Report
"RTN","GMPLCLN",188,0)
 N GMPLDLM,GMPLDA,GMPX,GMPJ,SUB,GMPLPSUB S (GMPLDLM,GMPLDA)="",GMPJ=21
"RTN","GMPLCLN",189,0)
 S GMPLPSUB=$O(^XTMP("GMPLCRPT;"))
"RTN","GMPLCLN",190,0)
 I GMPLPSUB["GMPLCRPT" K ^XTMP(GMPLPSUB)
"RTN","GMPLCLN",191,0)
 S SUB="GMPLCRPT;"_$H
"RTN","GMPLCLN",192,0)
 S ^XTMP(SUB,0)=$$FMADD^XLFDT($$NOW^XLFDT,30)_U_$$NOW^XLFDT()_U_"SNOMED in Diagnosis Field Cleanup Rpt"
"RTN","GMPLCLN",193,0)
 S ^XTMP(SUB,1,0)=""
"RTN","GMPLCLN",194,0)
 S ^XTMP(SUB,2,0)="**NOTE**: This report is retroactive as of the last Problem file cleanup runtime"
"RTN","GMPLCLN",195,0)
 S ^XTMP(SUB,3,0)=":"_$$FMTE^XLFDT(GMPLRNTM,1)_". This report will expire and be purged from the system in"
"RTN","GMPLCLN",196,0)
 S ^XTMP(SUB,4,0)="30 days. If the Generate SNOMED in Diagnosis Field Err/Cleanup Rpt [GMPL"
"RTN","GMPLCLN",197,0)
 S ^XTMP(SUB,5,0)="GENERATE DIAG RPTS] menu option is run prior to the 30 days, then this report"
"RTN","GMPLCLN",198,0)
 S ^XTMP(SUB,6,0)="will expire on the date/time the option is run. Whichever comes first."
"RTN","GMPLCLN",199,0)
 S ^XTMP(SUB,7,0)=""
"RTN","GMPLCLN",200,0)
 S ^XTMP(SUB,8,0)="A cleanup of the Problem file has been performed and the following "_GMPLNCLN
"RTN","GMPLCLN",201,0)
 S ^XTMP(SUB,9,0)="record entries have been corrected. This report contains 7 columns."
"RTN","GMPLCLN",202,0)
 S ^XTMP(SUB,10,0)="Please scroll to the right for more information."
"RTN","GMPLCLN",203,0)
 S ^XTMP(SUB,11,0)=""
"RTN","GMPLCLN",204,0)
 S ^XTMP(SUB,12,0)="These entries no longer contain a SNOMED CT concept code in the Diagnosis field"
"RTN","GMPLCLN",205,0)
 S ^XTMP(SUB,13,0)="#.01. The correct primary ICD diagnosis and secondary diagnosis code(s) is now"
"RTN","GMPLCLN",206,0)
 S ^XTMP(SUB,14,0)="stored in the appropriate fields. The corresponding SNOMED CT concept and"
"RTN","GMPLCLN",207,0)
 S ^XTMP(SUB,15,0)="designation codes have also been correctly filed in their respective fields. The "
"RTN","GMPLCLN",208,0)
 S ^XTMP(SUB,16,0)="provider narrative and problem fields were also updated accordingly as well."
"RTN","GMPLCLN",209,0)
 S ^XTMP(SUB,17,0)=""
"RTN","GMPLCLN",210,0)
 S ^XTMP(SUB,18,0)=""
"RTN","GMPLCLN",211,0)
 S ^XTMP(SUB,19,0)=$J("DATE LAST",27)_$J("PRIMARY",13)_$J("SNOMED CT",44)_$J("SNOMED CT",21)
"RTN","GMPLCLN",212,0)
 S ^XTMP(SUB,20,0)="IEN"_$J("MODIFIED",23)_$J("DIAGNOSIS",16)_$J("SECONDARY DIAGNOSIS",22)_$J("CONCEPT CODE",23)_$J("DESIGNATION CODE",25)_$J("PROBLEM",12)
"RTN","GMPLCLN",213,0)
 S ^XTMP(SUB,21,0)=$$REPEAT^XLFSTR("-",15)_$J($$REPEAT^XLFSTR("-",12),15)_$J($$REPEAT^XLFSTR("-",9),12)_$J($$REPEAT^XLFSTR("-",27),30)_$J($$REPEAT^XLFSTR("-",18),21)_$J($$REPEAT^XLFSTR("-",18),21)_$J($$REPEAT^XLFSTR("-",33),36)
"RTN","GMPLCLN",214,0)
 F  S GMPLDLM=$O(^TMP("GMPLCLNP",$J,GMPLDLM)) Q:'GMPLDLM  D
"RTN","GMPLCLN",215,0)
 . F  S GMPLDA=$O(^TMP("GMPLCLNP",$J,GMPLDLM,GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLN",216,0)
 . . S GMPX=$G(^TMP("GMPLCLNP",$J,GMPLDLM,GMPLDA)),GMPJ=GMPJ+1
"RTN","GMPLCLN",217,0)
 . . S ^XTMP(SUB,GMPJ,0)=$$LJ^XLFSTR($G(GMPLDA),18)_$$LJ^XLFSTR($P(GMPX,U,1),15)_$$LJ^XLFSTR($P($P(GMPX,U,2),"/"),12)_$$LJ^XLFSTR($P($P(GMPX,U,2),"/",2,$L($P(GMPX,U,2),"/")),30)
"RTN","GMPLCLN",218,0)
 . . S ^XTMP(SUB,GMPJ,0)=^XTMP(SUB,GMPJ,0)_$$LJ^XLFSTR($P(GMPX,U,3),21)_$$LJ^XLFSTR($P(GMPX,U,4),21)_$$LJ^XLFSTR($P(GMPX,U,5),$L($P(GMPX,U,5)))
"RTN","GMPLCLN",219,0)
 K ^TMP("GMPLCLNP",$J)
"RTN","GMPLCLN",220,0)
 Q
"RTN","GMPLCLN",221,0)
 ;
"RTN","GMPLCLN",222,0)
VWERRPT ; View Error Report
"RTN","GMPLCLN",223,0)
 N GMPLX
"RTN","GMPLCLN",224,0)
 S GMPLX=$O(^XTMP("GMPLERPT;"))
"RTN","GMPLCLN",225,0)
 I GMPLX["GMPLERPT",$D(^XTMP(GMPLX)) D BROWSE^DDBR("^XTMP("""_GMPLX_""")","NR","Erroneous Problem File Record Entries Report")
"RTN","GMPLCLN",226,0)
 E  D
"RTN","GMPLCLN",227,0)
 . N GMPLTEXT
"RTN","GMPLCLN",228,0)
 . S GMPLTEXT(1)="There are currently no Problem File entries that contain this error."
"RTN","GMPLCLN",229,0)
 . D MES^XPDUTL(.GMPLTEXT)
"RTN","GMPLCLN",230,0)
 Q
"RTN","GMPLCLN",231,0)
VWCLRPT ; View Cleanup Report
"RTN","GMPLCLN",232,0)
 N GMPLX
"RTN","GMPLCLN",233,0)
 S GMPLX=$O(^XTMP("GMPLCRPT;"))
"RTN","GMPLCLN",234,0)
 I GMPLX["GMPLCRPT",$D(^XTMP(GMPLX)) D BROWSE^DDBR("^XTMP("""_GMPLX_""")","NR","Problem File Cleanup Report")
"RTN","GMPLCLN",235,0)
 E  D
"RTN","GMPLCLN",236,0)
 . N GMPLTEXT
"RTN","GMPLCLN",237,0)
 . S GMPLTEXT(1)="There are currently no Problem File entries that need correction."
"RTN","GMPLCLN",238,0)
 . D MES^XPDUTL(.GMPLTEXT)
"RTN","GMPLCLN",239,0)
 Q
"RTN","GMPLCLNP")
0^5^B88965830^n/a
"RTN","GMPLCLNP",1,0)
GMPLCLNP ;ISP/TC - Problem File Cleanup Routine ;01/14/16  13:41
"RTN","GMPLCLNP",2,0)
 ;;2.0;Problem List;**40**;Aug 25, 1994;Build 9
"RTN","GMPLCLNP",3,0)
 ;
"RTN","GMPLCLNP",4,0)
 ;
"RTN","GMPLCLNP",5,0)
 ; External References
"RTN","GMPLCLNP",6,0)
 ;    ^%ZTLOAD              ICR  10063
"RTN","GMPLCLNP",7,0)
 ;    MES^XPDUTL            ICR  10141
"RTN","GMPLCLNP",8,0)
 ;    FILE^DIE              ICR   2053
"RTN","GMPLCLNP",9,0)
 ;    UPDATE^DIE            ICR   2053
"RTN","GMPLCLNP",10,0)
 ;    $$GET1^DIQ            ICR   2056
"RTN","GMPLCLNP",11,0)
 ;    $$NOW^XLFDT           ICR  10103
"RTN","GMPLCLNP",12,0)
 ;    $$FMTE^XLFDT          ICR  10103
"RTN","GMPLCLNP",13,0)
 ;    $$SAB^ICDEX           ICR   5747
"RTN","GMPLCLNP",14,0)
 ;    $$CODEC^ICDEX         ICR   5747
"RTN","GMPLCLNP",15,0)
 ;    $$CODECS^ICDEX        ICR   5747
"RTN","GMPLCLNP",16,0)
 ;    $$CODEN^ICDEX         ICR   5747
"RTN","GMPLCLNP",17,0)
 ;    $$GETSYN^LEXTRAN1     ICR   5006
"RTN","GMPLCLNP",18,0)
 ;
"RTN","GMPLCLNP",19,0)
 ;
"RTN","GMPLCLNP",20,0)
EN ; Main entry point to task off SCT error scan & cleanup
"RTN","GMPLCLNP",21,0)
 ;
"RTN","GMPLCLNP",22,0)
 N GMPLTEXT,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","GMPLCLNP",23,0)
 S ZTRTN="SCANSCT^GMPLCLNP"
"RTN","GMPLCLNP",24,0)
 S ZTDESC="Problem File SNOMED Error Scan and Cleanup"
"RTN","GMPLCLNP",25,0)
 S ZTDTH=$H,ZTIO=""
"RTN","GMPLCLNP",26,0)
 D ^%ZTLOAD
"RTN","GMPLCLNP",27,0)
 S GMPLTEXT(1)=""
"RTN","GMPLCLNP",28,0)
 S GMPLTEXT(2)=" Problem File SNOMED Error Scan and Cleanup queued."
"RTN","GMPLCLNP",29,0)
 S GMPLTEXT(3)=" The task number is "_ZTSK_"."
"RTN","GMPLCLNP",30,0)
 D MES^XPDUTL(.GMPLTEXT)
"RTN","GMPLCLNP",31,0)
 Q
"RTN","GMPLCLNP",32,0)
EN1 ; Main entry point to task off incorrect mapping scan & cleanup
"RTN","GMPLCLNP",33,0)
 ;
"RTN","GMPLCLNP",34,0)
 N GMPLTEXT,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","GMPLCLNP",35,0)
 S ZTRTN="SCANVCDE^GMPLCLNP"
"RTN","GMPLCLNP",36,0)
 S ZTDESC="Problem File Incorrect Mapping Scan and Cleanup"
"RTN","GMPLCLNP",37,0)
 S ZTDTH=$H,ZTIO=""
"RTN","GMPLCLNP",38,0)
 D ^%ZTLOAD
"RTN","GMPLCLNP",39,0)
 S GMPLTEXT(1)=""
"RTN","GMPLCLNP",40,0)
 S GMPLTEXT(2)=" Problem File Incorrect Mapping Scan and Cleanup queued."
"RTN","GMPLCLNP",41,0)
 S GMPLTEXT(3)=" The task number is "_ZTSK_"."
"RTN","GMPLCLNP",42,0)
 D MES^XPDUTL(.GMPLTEXT)
"RTN","GMPLCLNP",43,0)
 Q
"RTN","GMPLCLNP",44,0)
SCANSCT ; Scan Problem file for SCT in Diagnosis field errors
"RTN","GMPLCLNP",45,0)
 N GMPLDIAG,GMPLDA,GMPLDLM,GMPLNERR,GMPLPROB,GMPLNARR,GMPLNIEN
"RTN","GMPLCLNP",46,0)
 N GMPLPIEN,GMPLRNTM,GMPL0,GMPL1,GMPLSUB,GMPLFROM,GMPLMSG
"RTN","GMPLCLNP",47,0)
 S (GMPLDIAG,GMPLDA,GMPLDLM)="",GMPLNERR=0
"RTN","GMPLCLNP",48,0)
 K ^TMP("GMPLSCT",$J)
"RTN","GMPLCLNP",49,0)
 S GMPLRNTM=$$NOW^XLFDT
"RTN","GMPLCLNP",50,0)
 F  S GMPLDIAG=$O(^AUPNPROB("B",GMPLDIAG),-1) Q:GMPLDIAG=""  D
"RTN","GMPLCLNP",51,0)
 . F  S GMPLDA=$O(^AUPNPROB("B",GMPLDIAG,GMPLDA),-1) Q:'GMPLDA  D
"RTN","GMPLCLNP",52,0)
 . . I ($L(GMPLDIAG)>5),($L(GMPLDIAG)<19),($P($$CODEC^ICDEX(80,GMPLDIAG),U,1)=-1) D
"RTN","GMPLCLNP",53,0)
 . . . S GMPL0=$G(^AUPNPROB(GMPLDA,0)),GMPL1=$G(^AUPNPROB(GMPLDA,1))
"RTN","GMPLCLNP",54,0)
 . . . S GMPLDLM=$P(GMPL0,U,3)   ;Date Last Modified of erroneous record
"RTN","GMPLCLNP",55,0)
 . . . S GMPLNIEN=$P(GMPL0,U,5)  ;IEN of Provider Narrative entry
"RTN","GMPLCLNP",56,0)
 . . . S GMPLPROB=$$GET1^DIQ(9000011,""_GMPLDA_",",1.01,"E") ;Problem description
"RTN","GMPLCLNP",57,0)
 . . . S GMPLNERR=GMPLNERR+1
"RTN","GMPLCLNP",58,0)
 . . . S ^TMP("GMPLSCT",$J,GMPLDLM,GMPLDA)=$$FMTE^XLFDT(GMPLDLM,"1D")_U_GMPLDIAG_U_GMPLPROB_U_GMPLNIEN
"RTN","GMPLCLNP",59,0)
 I GMPLNERR>0 D
"RTN","GMPLCLNP",60,0)
 . D BLDERRPT^GMPLCLN(GMPLNERR,GMPLRNTM)
"RTN","GMPLCLNP",61,0)
 . D BLDERMSG^GMPLCLN(GMPLNERR)
"RTN","GMPLCLNP",62,0)
 . D CLNSCTE
"RTN","GMPLCLNP",63,0)
 E  D
"RTN","GMPLCLNP",64,0)
 . S GMPLSUB="Problem File Error Scan: No Errors Found"
"RTN","GMPLCLNP",65,0)
 . S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLNP",66,0)
 . S GMPLMSG(1)="No errors were found that contain a SNOMED CT concept code in the"
"RTN","GMPLCLNP",67,0)
 . S GMPLMSG(2)="Diagnosis field #.01."
"RTN","GMPLCLNP",68,0)
 . D BLDNEMSG^GMPLCLN(.GMPLMSG,GMPLSUB,GMPLFROM,GMPLRNTM)
"RTN","GMPLCLNP",69,0)
 Q
"RTN","GMPLCLNP",70,0)
CLNSCTE ; Clean up erroneous PL entries in ^TMP("GMPLSCT")
"RTN","GMPLCLNP",71,0)
 N GMPLDLM,GMPLDA,GMPLSCTC,GMPLSCTD,GMPLNARR,GMPLICD,GMPLNCLN,GMPLFDA,GMPLFROM
"RTN","GMPLCLNP",72,0)
 N GMPLFDA1,GMPLREC,GMPLNIEN,GMPLPROB,GMPSYN,GMPLRNTM,GMPCNT,GMPLDIEN,GMPLIEN
"RTN","GMPLCLNP",73,0)
 K ^TMP("GMPLCLNP",$J),^TMP("GMPLCLER",$J)
"RTN","GMPLCLNP",74,0)
 S (GMPLDLM,GMPLDA)="",GMPLNCLN=0,GMPLRNTM=$$NOW^XLFDT,GMPCNT=0
"RTN","GMPLCLNP",75,0)
 S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLNP",76,0)
 F  S GMPLDLM=$O(^TMP("GMPLSCT",$J,GMPLDLM)) Q:'GMPLDLM  D
"RTN","GMPLCLNP",77,0)
 . F  S GMPLDA=$O(^TMP("GMPLSCT",$J,GMPLDLM,GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLNP",78,0)
 . . L +^AUPNPROB(GMPLDA):5 I '$T D  Q
"RTN","GMPLCLNP",79,0)
 . . . S GMPCNT=GMPCNT+1
"RTN","GMPLCLNP",80,0)
 . . . S ^TMP("GMPLCLER",$J,GMPCNT,0)="Error updating record #"_GMPLDA_" in File #9000011."
"RTN","GMPLCLNP",81,0)
 . . . Q
"RTN","GMPLCLNP",82,0)
 . . S GMPLREC=$G(^TMP("GMPLSCT",$J,GMPLDLM,GMPLDA))
"RTN","GMPLCLNP",83,0)
 . . S GMPLSCTC=$P(GMPLREC,U,2),GMPLNIEN=$P(GMPLREC,U,4)
"RTN","GMPLCLNP",84,0)
 . . S GMPLICD=$$GETDX^GMPLUTL(GMPLSCTC,GMPLDLM)
"RTN","GMPLCLNP",85,0)
 . . S GMPLDIEN=$P($$CODEN^ICDEX($P(GMPLICD,"/"),80),"~",1)
"RTN","GMPLCLNP",86,0)
 . . I $G(GMPLICD)["/" D FILEMT(GMPLDA,GMPLICD,GMPLDLM)
"RTN","GMPLCLNP",87,0)
 . . I $P($$GETSYN^LEXTRAN1("SCT",GMPLSCTC,GMPLDLM,"GMPSYN",1,1),U)>0 D
"RTN","GMPLCLNP",88,0)
 . . . S GMPLNARR=$P(GMPSYN("P"),U),GMPLPROB=$P(GMPSYN("P"),U,2),GMPLSCTD=$P(GMPSYN("P"),U,3)
"RTN","GMPLCLNP",89,0)
 . . E  D
"RTN","GMPLCLNP",90,0)
 . . . S GMPLNARR="Unresolved",GMPLPROB="1",GMPLSCTD="@"
"RTN","GMPLCLNP",91,0)
 . . S GMPLIEN=""_GMPLDA_","
"RTN","GMPLCLNP",92,0)
 . . S GMPLFDA(9000011,GMPLIEN,.01)=$S($G(GMPLICD)["/":$P(GMPLICD,"/"),1:$G(GMPLICD)) ; Primary Diagnosis (#.01)
"RTN","GMPLCLNP",93,0)
 . . S GMPLFDA(9999999.27,""_GMPLNIEN_",",.01)=GMPLNARR ; Provider Narrative (#.05)
"RTN","GMPLCLNP",94,0)
 . . S GMPLFDA1(9000011,GMPLIEN,1.01)=GMPLPROB ; Problem (#1.01)
"RTN","GMPLCLNP",95,0)
 . . S GMPLFDA(9000011,GMPLIEN,80001)=GMPLSCTC ; SNOMED CT Concept code (#80001)
"RTN","GMPLCLNP",96,0)
 . . S GMPLFDA(9000011,GMPLIEN,80002)=GMPLSCTD ; SNOMED CT Designation code (#80002)
"RTN","GMPLCLNP",97,0)
 . . D FILE^DIE("E","GMPLFDA")
"RTN","GMPLCLNP",98,0)
 . . D FILE^DIE("","GMPLFDA1")
"RTN","GMPLCLNP",99,0)
 . . D CLNAUD(GMPLDLM,GMPLDA,GMPLDIEN)
"RTN","GMPLCLNP",100,0)
 . . L -^AUPNPROB(GMPLDA)
"RTN","GMPLCLNP",101,0)
 . . S GMPLNCLN=GMPLNCLN+1
"RTN","GMPLCLNP",102,0)
 . . S ^TMP("GMPLCLNP",$J,GMPLDLM,GMPLDA)=$$FMTE^XLFDT(GMPLDLM,"1D")_U_GMPLICD_U_GMPLSCTC_U_GMPLSCTD_U_GMPLNARR
"RTN","GMPLCLNP",103,0)
 K ^TMP("GMPLSCT",$J)
"RTN","GMPLCLNP",104,0)
 I GMPCNT>0,$D(^TMP("GMPLCLER")) D
"RTN","GMPLCLNP",105,0)
 . N GMPLMSG,GMPLNODE
"RTN","GMPLCLNP",106,0)
 . S GMPLNODE="GMPLCLER"
"RTN","GMPLCLNP",107,0)
 . S GMPLMSG(1)="Please run the Generate SNOMED in Diagnosis Field Err/Cleanup Rpt [GMPL"
"RTN","GMPLCLNP",108,0)
 . S GMPLMSG(2)="GENERATE DIAG RPTS] menu option again to rerun the file scan and clean up"
"RTN","GMPLCLNP",109,0)
 . S GMPLMSG(3)="these missed entries."
"RTN","GMPLCLNP",110,0)
 . D BLDLEMSG^GMPLCLN(.GMPLMSG,GMPCNT,GMPLFROM,GMPLNODE)
"RTN","GMPLCLNP",111,0)
 I GMPLNCLN>0 D
"RTN","GMPLCLNP",112,0)
 . N GMPMSG,GMPSUB
"RTN","GMPLCLNP",113,0)
 . S GMPSUB="SNOMED Error Cleanup Complete"
"RTN","GMPLCLNP",114,0)
 . S GMPMSG(1)="These entries no longer contain a SNOMED CT concept code in the Diagnosis"
"RTN","GMPLCLNP",115,0)
 . S GMPMSG(2)="field #.01. To see a report of these corrected records, please access the"
"RTN","GMPLCLNP",116,0)
 . S GMPMSG(3)="SNOMED in Diagnosis Field Cleanup Report [GMPL DIAG CLEANUP REPORT] which is"
"RTN","GMPLCLNP",117,0)
 . S GMPMSG(4)="attached to the Problem List Mgt Menu [GMPL MGT MENU]."
"RTN","GMPLCLNP",118,0)
 . D BLDCLRPT^GMPLCLN(GMPLNCLN,GMPLRNTM)
"RTN","GMPLCLNP",119,0)
 . D BLDCLMSG^GMPLCLN(.GMPMSG,GMPSUB,GMPLFROM,GMPLNCLN)
"RTN","GMPLCLNP",120,0)
 Q
"RTN","GMPLCLNP",121,0)
FILEMT(GMPDA,GMPICD,GMPDLM) ; File the associating Mapping Target codes
"RTN","GMPLCLNP",122,0)
 N GMPN,GMPI,GMPCSYS,GMPNCNT,GMPFDA,GMPLFDA,GMPJ
"RTN","GMPLCLNP",123,0)
 S GMPCSYS=$$SAB^ICDEX(+$$CODECS^ICDEX($P(GMPICD,"/"),80,GMPDLM),GMPDLM)
"RTN","GMPLCLNP",124,0)
 ; Remove previous entries
"RTN","GMPLCLNP",125,0)
 S GMPNCNT=+$P($G(^AUPNPROB(GMPDA,803,0)),U,4)
"RTN","GMPLCLNP",126,0)
 I GMPNCNT>0 D
"RTN","GMPLCLNP",127,0)
 . F GMPJ=1:1:GMPNCNT D
"RTN","GMPLCLNP",128,0)
 . . S GMPLFDA(9000011.803,""_GMPJ_","_GMPDA_",",.01)="@"
"RTN","GMPLCLNP",129,0)
 . . D FILE^DIE("","GMPLFDA")
"RTN","GMPLCLNP",130,0)
 ; File new entries so that ACRMT xref is updated
"RTN","GMPLCLNP",131,0)
 S GMPN=$L(GMPICD,"/")-1
"RTN","GMPLCLNP",132,0)
 F GMPI=1:1:GMPN D
"RTN","GMPLCLNP",133,0)
 . N GMPCODE,GMPNOS,GMPFDA,GMPDT S GMPNOS=$$NOS^GMPLX(GMPCSYS)
"RTN","GMPLCLNP",134,0)
 . S GMPCODE=$P(GMPICD,"/",(GMPI+1)) Q:(GMPCODE="")
"RTN","GMPLCLNP",135,0)
 . I GMPCODE=$P(GMPNOS,U,2) Q
"RTN","GMPLCLNP",136,0)
 . S GMPDT=$$FMTE^XLFDT(GMPDLM,"1D")
"RTN","GMPLCLNP",137,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.01)=GMPCODE
"RTN","GMPLCLNP",138,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.02)=GMPCSYS
"RTN","GMPLCLNP",139,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.03)=GMPDT
"RTN","GMPLCLNP",140,0)
 . D UPDATE^DIE("E","GMPFDA")
"RTN","GMPLCLNP",141,0)
 Q
"RTN","GMPLCLNP",142,0)
CLNAUD(GMPLDLM,GMPLDA,GMPLDIEN) ; Cleanup audit history for Diagnosis field
"RTN","GMPLCLNP",143,0)
 N GMPLAIEN,GMPLINVD,GMPLFLDN,GMPLNVAL,GMPQT,GMPL0
"RTN","GMPLCLNP",144,0)
 S (GMPLINVD,GMPLAIEN)="",GMPQT=0,GMPLDA=GMPLDA-1
"RTN","GMPLCLNP",145,0)
 F  S GMPLDA=$O(^GMPL(125.8,"AD",GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLNP",146,0)
 . F  S GMPLINVD=$O(^GMPL(125.8,"AD",GMPLDA,GMPLINVD)) Q:'GMPLINVD  D
"RTN","GMPLCLNP",147,0)
 . . I $$CNVTFMDT(GMPLINVD)=GMPLDLM D
"RTN","GMPLCLNP",148,0)
 . . . F  S GMPLAIEN=$O(^GMPL(125.8,"AD",GMPLDA,GMPLINVD,GMPLAIEN)) Q:'GMPLAIEN!GMPQT  D
"RTN","GMPLCLNP",149,0)
 . . . . S GMPL0=$G(^GMPL(125.8,GMPLAIEN,0))
"RTN","GMPLCLNP",150,0)
 . . . . S GMPLFLDN=$P(GMPL0,U,2),GMPLNVAL=$P(GMPL0,U,6)
"RTN","GMPLCLNP",151,0)
 . . . . I (GMPLFLDN=".01"),($L(GMPLNVAL)>5),($L(GMPLNVAL)<19),($P($$CODEC^ICDEX(80,GMPLNVAL),U,1)=-1) D
"RTN","GMPLCLNP",152,0)
 . . . . . N GMPFDA
"RTN","GMPLCLNP",153,0)
 . . . . . S GMPFDA(125.8,""_GMPLAIEN_",",5)=GMPLDIEN,GMPQT=1
"RTN","GMPLCLNP",154,0)
 . . . . . D FILE^DIE("K","GMPFDA")
"RTN","GMPLCLNP",155,0)
 Q
"RTN","GMPLCLNP",156,0)
CNVTFMDT(GMPLINVD) ; Convert an inverted date into FileMan format
"RTN","GMPLCLNP",157,0)
 N GMPLFMDT
"RTN","GMPLCLNP",158,0)
 S GMPLFMDT=9999999-GMPLINVD
"RTN","GMPLCLNP",159,0)
 S GMPLFMDT=$P(GMPLFMDT,".")
"RTN","GMPLCLNP",160,0)
 Q GMPLFMDT
"RTN","GMPLCLNP",161,0)
SCANVCDE ; Scan Problem file for incorrect mapping (SCT 428283002, ICD-9 V15.89)
"RTN","GMPLCLNP",162,0)
 N GMPLDA,GMPLNERR,GMPLNARR,GMPLSCTC,GMPLRNTM,GMPLPAT,GMPLICD,GMPL0,GMPLDIEN,GMPL1,GMPLPROV
"RTN","GMPLCLNP",163,0)
 N GMPLSUB,GMPLFROM,GMPLMSG
"RTN","GMPLCLNP",164,0)
 S GMPLDA="",GMPLNERR=0
"RTN","GMPLCLNP",165,0)
 K ^TMP("GMPLVCDE",$J)
"RTN","GMPLCLNP",166,0)
 S GMPLRNTM=$$NOW^XLFDT,GMPLSCTC="428283002"
"RTN","GMPLCLNP",167,0)
 F  S GMPLDA=$O(^AUPNPROB("ASCT",GMPLSCTC,GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLNP",168,0)
 . S GMPL0=$G(^AUPNPROB(GMPLDA,0)),GMPL1=$G(^AUPNPROB(GMPLDA,1))
"RTN","GMPLCLNP",169,0)
 . S GMPLDIEN=$P(GMPL0,U,1)
"RTN","GMPLCLNP",170,0)
 . S GMPLICD=$$CODEC^ICDEX(80,GMPLDIEN) I $G(GMPLICD)="V15.89" D
"RTN","GMPLCLNP",171,0)
 . . S GMPLPAT=$P($G(^DPT($P(GMPL0,U,2),0)),U)   ;Patient Name - ICR 10035
"RTN","GMPLCLNP",172,0)
 . . S GMPLNARR=$$GET1^DIQ(9000011,""_GMPLDA_",",.05,"E")  ;Provider Narrative Text - ICR 1593
"RTN","GMPLCLNP",173,0)
 . . S GMPLPROV=$P(GMPL1,U,4) ;Recording Provider
"RTN","GMPLCLNP",174,0)
 . . S GMPLNERR=GMPLNERR+1
"RTN","GMPLCLNP",175,0)
 . . S ^TMP("GMPLVCDE",$J,GMPLDA)=GMPLPAT_U_GMPLNARR_U_GMPLDIEN_U_GMPLPROV
"RTN","GMPLCLNP",176,0)
 I GMPLNERR>0 D
"RTN","GMPLCLNP",177,0)
 . D BLDRPMSG^GMPLCLN(GMPLNERR,GMPLRNTM)
"RTN","GMPLCLNP",178,0)
 . D CLNVCDE
"RTN","GMPLCLNP",179,0)
 E  D
"RTN","GMPLCLNP",180,0)
 . S GMPLSUB="Incorrect Mapping Scan: No Errors Found"
"RTN","GMPLCLNP",181,0)
 . S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLNP",182,0)
 . S GMPLMSG(1)="No incorrect SNOMED CT 428283002 to ICD-9-CM V15.89 code mappings"
"RTN","GMPLCLNP",183,0)
 . S GMPLMSG(2)="for the term ""History of polyp of colon"" were found."
"RTN","GMPLCLNP",184,0)
 . D BLDNEMSG^GMPLCLN(.GMPLMSG,GMPLSUB,GMPLFROM,GMPLRNTM)
"RTN","GMPLCLNP",185,0)
 Q
"RTN","GMPLCLNP",186,0)
CLNVCDE ; Clean up erroneous PL entries in ^TMP("GMPLVCDE")
"RTN","GMPLCLNP",187,0)
 N GMPLDA,GMPLFDA,GMPCNT,GMPFDA,GMPLREC,GMPLPROV,GMPLDIEN,GMPLNCLN,GMPLFROM
"RTN","GMPLCLNP",188,0)
 S GMPLDA="",GMPCNT=0,GMPLNCLN=0
"RTN","GMPLCLNP",189,0)
 S GMPLFROM="GMPL*2.0*40 INSTALL"
"RTN","GMPLCLNP",190,0)
 K ^TMP("GMPLLKER",$J)
"RTN","GMPLCLNP",191,0)
 F  S GMPLDA=$O(^TMP("GMPLVCDE",$J,GMPLDA)) Q:'GMPLDA  D
"RTN","GMPLCLNP",192,0)
 . L +^AUPNPROB(GMPLDA):5 I '$T D  Q
"RTN","GMPLCLNP",193,0)
 . . S GMPCNT=GMPCNT+1
"RTN","GMPLCLNP",194,0)
 . . S ^TMP("GMPLLKER",$J,GMPCNT,0)="Error updating record #"_GMPLDA_" in File #9000011."
"RTN","GMPLCLNP",195,0)
 . . Q
"RTN","GMPLCLNP",196,0)
 . S GMPLFDA(9000011,""_GMPLDA_",",.01)="V12.72"
"RTN","GMPLCLNP",197,0)
 . D FILE^DIE("E","GMPLFDA")
"RTN","GMPLCLNP",198,0)
 . L -^AUPNPROB(GMPLDA)
"RTN","GMPLCLNP",199,0)
 . S GMPLNCLN=GMPLNCLN+1
"RTN","GMPLCLNP",200,0)
 . ; Create audit history entry for modified Diagnosis field
"RTN","GMPLCLNP",201,0)
 . S GMPLREC=$G(^TMP("GMPLVCDE",$J,GMPLDA))
"RTN","GMPLCLNP",202,0)
 . S GMPLPROV=$P(GMPLREC,U,4),GMPLDIEN=$P(GMPLREC,U,3)
"RTN","GMPLCLNP",203,0)
 . S GMPFDA(125.8,"+1,",.01)=GMPLDA
"RTN","GMPLCLNP",204,0)
 . S GMPFDA(125.8,"+1,",1)=".01"
"RTN","GMPLCLNP",205,0)
 . S GMPFDA(125.8,"+1,",2)=$$NOW^XLFDT
"RTN","GMPLCLNP",206,0)
 . S GMPFDA(125.8,"+1,",3)=GMPLPROV
"RTN","GMPLCLNP",207,0)
 . S GMPFDA(125.8,"+1,",4)=GMPLDIEN
"RTN","GMPLCLNP",208,0)
 . S GMPFDA(125.8,"+1,",5)=$P($$CODEN^ICDEX("V12.72",80),"~")
"RTN","GMPLCLNP",209,0)
 . S GMPFDA(125.8,"+1,",6)="DIAGNOSIS CORRECTION"
"RTN","GMPLCLNP",210,0)
 . S GMPFDA(125.8,"+1,",7)=GMPLPROV
"RTN","GMPLCLNP",211,0)
 . D UPDATE^DIE("","GMPFDA")
"RTN","GMPLCLNP",212,0)
 K ^TMP("GMPLVCDE",$J)
"RTN","GMPLCLNP",213,0)
 I GMPCNT>0,$D(^TMP("GMPLLKER")) D
"RTN","GMPLCLNP",214,0)
 . N GMPLNODE S GMPLNODE="GMPLLKER"
"RTN","GMPLCLNP",215,0)
 . D BLDLEMSG^GMPLCLN(,GMPCNT,GMPLFROM,GMPLNODE)
"RTN","GMPLCLNP",216,0)
 I GMPLNCLN>0 D
"RTN","GMPLCLNP",217,0)
 . N GMPMSG,GMPSUB
"RTN","GMPLCLNP",218,0)
 . S GMPSUB="Incorrect Mapping Cleanup Complete"
"RTN","GMPLCLNP",219,0)
 . S GMPMSG(1)="These entries no longer contain an incorrect mapping and a V15.89 code in the"
"RTN","GMPLCLNP",220,0)
 . S GMPMSG(2)="Diagnosis field #.01. The correct code of V12.82 is now stored in this field."
"RTN","GMPLCLNP",221,0)
 . D BLDCLMSG^GMPLCLN(.GMPMSG,GMPSUB,GMPLFROM,GMPLNCLN)
"RTN","GMPLCLNP",222,0)
 Q
"RTN","GMPLUTL")
0^4^B62818534^B62326591
"RTN","GMPLUTL",1,0)
GMPLUTL ; SLC/MKB/KER/TC -- PL Utilities ;01/19/16  13:13
"RTN","GMPLUTL",2,0)
 ;;2.0;Problem List;**3,6,8,10,16,26,35,39,36,42,40**;Aug 25, 1994;Build 9
"RTN","GMPLUTL",3,0)
 ;
"RTN","GMPLUTL",4,0)
 ; External References
"RTN","GMPLUTL",5,0)
 ;   DBIA    348  ^DPT(
"RTN","GMPLUTL",6,0)
 ;    ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL",7,0)
 ;   DBIA  10006  ^VA(200
"RTN","GMPLUTL",8,0)
 ;
"RTN","GMPLUTL",9,0)
ACTIVE(GMPDFN,GMPL) ; Returns list of Active Problems for a Patient
"RTN","GMPLUTL",10,0)
 ;
"RTN","GMPLUTL",11,0)
 ;   GMPDFN   Pointer to Patient
"RTN","GMPLUTL",12,0)
 ;   GMPL     Array in which the problems will be
"RTN","GMPLUTL",13,0)
 ;            returned, passed by reference
"RTN","GMPLUTL",14,0)
 ;
"RTN","GMPLUTL",15,0)
 ;   GMPL(#,0)  Problem file (#9000011) IEN
"RTN","GMPLUTL",16,0)
 ;   GMPL(#,1)  Piece 1:  Pointer to Problem (Lexicon file #757.01)
"RTN","GMPLUTL",17,0)
 ;                    2:  Provider Narrative
"RTN","GMPLUTL",18,0)
 ;                 NOTE:  the provider narrative may be different
"RTN","GMPLUTL",19,0)
 ;                        from the Lexicon term in file 757.01
"RTN","GMPLUTL",20,0)
 ;   GMPL(#,2)  Piece 1:  Pointer to ICD Diagnosis (file #80)
"RTN","GMPLUTL",21,0)
 ;                    2:  ICD-9/10 Code
"RTN","GMPLUTL",22,0)
 ;   GMPL(#,3)  Piece 1:  Internal Date of Onset
"RTN","GMPLUTL",23,0)
 ;                    2:  External Date of Onset 00/00/00
"RTN","GMPLUTL",24,0)
 ;   GMPL(#,4)  Piece 1:  Abbreviated Service Connection
"RTN","GMPLUTL",25,0)
 ;                            SC^Service Connected
"RTN","GMPLUTL",26,0)
 ;                            NSC^Not Service Connected
"RTN","GMPLUTL",27,0)
 ;                            null
"RTN","GMPLUTL",28,0)
 ;                    2:  Full text Service Connection
"RTN","GMPLUTL",29,0)
 ;   GMPL(#,5)  Piece 1:  Abbreviated Exposure
"RTN","GMPLUTL",30,0)
 ;                        Full text Exposure
"RTN","GMPLUTL",31,0)
 ;                            AO^Agent Orange
"RTN","GMPLUTL",32,0)
 ;                            IR^Radiation
"RTN","GMPLUTL",33,0)
 ;                            EC^Evn Contaminants
"RTN","GMPLUTL",34,0)
 ;                            HNC^Head/Neck Cancer
"RTN","GMPLUTL",35,0)
 ;                            MST^Mil Sexual Trauma
"RTN","GMPLUTL",36,0)
 ;                            CV^Combat Vet
"RTN","GMPLUTL",37,0)
 ;                            SHD^SHAD
"RTN","GMPLUTL",38,0)
 ;                            null
"RTN","GMPLUTL",39,0)
 ;
"RTN","GMPLUTL",40,0)
 N IFN,CNT,SP,NUM,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL",41,0)
 Q:$G(GMPDFN)'>0  S CNT=0,SP=""
"RTN","GMPLUTL",42,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL",43,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL",44,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL",45,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL",46,0)
 . N I,GMPL0,GMPL1,GMPL802,ICDC,GMPCSYS,GMPDT,ONSET
"RTN","GMPLUTL",47,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL",48,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL802=$G(^(802)),CNT=CNT+1,GMPL(CNT,0)=IFN
"RTN","GMPLUTL",49,0)
 . S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPDT))
"RTN","GMPLUTL",50,0)
 . S ICDC=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2)
"RTN","GMPLUTL",51,0)
 . S GMPL(CNT,1)=+GMPL1_U_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL",52,0)
 . S GMPL(CNT,2)=+GMPL0_U_ICDC,ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL",53,0)
 . S GMPL(CNT,3)=$S(ONSET:ONSET_U_$$EXTDT^GMPLX(ONSET),1:"")
"RTN","GMPLUTL",54,0)
 . S GMPL(CNT,4)=$S(+$P(GMPL1,U,10):"SC^SERVICE-CONNECTED",$P(GMPL1,U,10)=0:"NSC^NOT SERVICE-CONNECTED",1:"")
"RTN","GMPLUTL",55,0)
 . F I=11,12,13,15,16,17,18 S:$P(GMPL1,U,I) SP=$S(I=11:"A",I=12:"I",I=13:"P",I=15:"H",I=16:"M",I=17:"C",1:"S")
"RTN","GMPLUTL",56,0)
 . S GMPL(CNT,5)=$S(SP="A":"AO^AGENT ORANGE",SP="I":"IR^RADIATION",SP="P":"EC^ENV CONTAMINANTS",SP="H":"HNC^HEAD AND/OR NECK CANCER",SP="M":"MST^MILIARY SEXUAL TRAUMA",SP="C":"CV^COMBAT VET",SP="S":"SHD^SHAD",1:"")
"RTN","GMPLUTL",57,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL",58,0)
 Q
"RTN","GMPLUTL",59,0)
 ;
"RTN","GMPLUTL",60,0)
CREATE(PL,PLY) ; Creates a new problem
"RTN","GMPLUTL",61,0)
 ;
"RTN","GMPLUTL",62,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",63,0)
 ;    Required
"RTN","GMPLUTL",64,0)
 ;      PL("PATIENT")    Pointer to Patient #2
"RTN","GMPLUTL",65,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",66,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",67,0)
 ;    Optional
"RTN","GMPLUTL",68,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",69,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",70,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",71,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",72,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",73,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",74,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",75,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",76,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",77,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",78,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",79,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",80,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",81,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",82,0)
 ;      PL("CV")         Combat Vet        1 = Yes 0 = No
"RTN","GMPLUTL",83,0)
 ;      PL("SHD")        Shipboard Hazard & Defense 1=Yes  0=No
"RTN","GMPLUTL",84,0)
 ;      PL("DX_DATE_OF_INTEREST") For historical encounters (=Today's date) & all other encounters (=encounter date/time)
"RTN","GMPLUTL",85,0)
 ;
"RTN","GMPLUTL",86,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",87,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",88,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",89,0)
 ;
"RTN","GMPLUTL",90,0)
 N GMPI,GMPQUIT,GMPVAMC,GMPVA,GMPFLD,GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",91,0)
 N GMPHNC,GMPMST,GMPCV,GMPSHD,DA,GMPDFN,GMPROV
"RTN","GMPLUTL",92,0)
 K PLY S PLY=-1,PLY(0)=""
"RTN","GMPLUTL",93,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0)
"RTN","GMPLUTL",94,0)
 I '$L($G(PL("NARRATIVE"))) S PLY(0)="Missing problem narrative" Q
"RTN","GMPLUTL",95,0)
 I '$D(^DPT(+$G(PL("PATIENT")),0)) S PLY(0)="Invalid patient" Q
"RTN","GMPLUTL",96,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",97,0)
 S GMPDFN=+PL("PATIENT"),(GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD)=0
"RTN","GMPLUTL",98,0)
 S:'$L($G(PL("DX_DATE_OF_INTEREST"))) PL("DX_DATE_OF_INTEREST")=$$DT^XLFDT
"RTN","GMPLUTL",99,0)
 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",100,0)
 F GMPI="DIAGNOSI","LEXICON","DUPLICAT","LOCATION","STATUS" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",101,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",102,0)
 F GMPI="ONSET","RESOLVED","RECORDED","SC","AO","IR","EC","HNC","MST","CV","SHD" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",103,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",104,0)
CR1 ; Ok to Create
"RTN","GMPLUTL",105,0)
 I $S(PL("LEXICON")=1:1,PL("LEXICON")="":1,$P(PL("LEXICON"),U,2)']"":1,1:0),(PL("NARRATIVE")["SNOMED CT") D FIXLEX(.PL)
"RTN","GMPLUTL",106,0)
 S GMPFLD(.01)=PL("DIAGNOSIS")_U_$S(PL("NARRATIVE")["(ICD-9-CM":$P($P(PL("NARRATIVE"),"ICD-9-CM ",2),")"),1:"")
"RTN","GMPLUTL",107,0)
 S GMPFLD(1.01)=PL("LEXICON")
"RTN","GMPLUTL",108,0)
 S GMPFLD(.05)=U_$E(PL("NARRATIVE"),1,80)
"RTN","GMPLUTL",109,0)
 S (GMPROV,GMPFLD(1.04),GMPFLD(1.05))=+PL("PROVIDER")
"RTN","GMPLUTL",110,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+PL("PROVIDER"))
"RTN","GMPLUTL",111,0)
 S GMPFLD(.13)=PL("ONSET"),GMPFLD(1.09)=PL("RECORDED")
"RTN","GMPLUTL",112,0)
 S GMPFLD(1.02)=$S('$P(^GMPL(125.99,1,0),U,2):"P",$G(GMPLUSER):"P",1:"T")
"RTN","GMPLUTL",113,0)
 S GMPFLD(.12)=PL("STATUS"),GMPFLD(1.14)="",GMPFLD(1.07)=PL("RESOLVED")
"RTN","GMPLUTL",114,0)
 S GMPFLD(10,0)=0,GMPFLD(1.03)=$G(DUZ),GMPFLD(1.08)=PL("LOCATION")
"RTN","GMPLUTL",115,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60)
"RTN","GMPLUTL",116,0)
 S GMPFLD(1.1)=PL("SC"),GMPFLD(1.11)=PL("AO"),GMPFLD(1.12)=PL("IR")
"RTN","GMPLUTL",117,0)
 S GMPFLD(1.13)=PL("EC"),GMPFLD(1.15)=$G(PL("HNC")),GMPFLD(1.16)=$G(PL("MST"))
"RTN","GMPLUTL",118,0)
 S GMPFLD(1.17)=$G(PL("CV")),GMPFLD(1.18)=$G(PL("SHD"))
"RTN","GMPLUTL",119,0)
 S GMPFLD(80201)=$G(PL("DX_DATE_OF_INTEREST"))
"RTN","GMPLUTL",120,0)
 D NEW^GMPLSAVE S PLY=DA
"RTN","GMPLUTL",121,0)
CRQ ; Quit Create
"RTN","GMPLUTL",122,0)
 Q
"RTN","GMPLUTL",123,0)
 ;
"RTN","GMPLUTL",124,0)
FIXLEX(PL) ; Fix Lexicon expression pointer value for SNOMED Concepts
"RTN","GMPLUTL",125,0)
 N SCT,LEXS,ICDS
"RTN","GMPLUTL",126,0)
 S SCT=+$P(PL("NARRATIVE"),"SNOMED CT ",2) I +SCT'>0 Q
"RTN","GMPLUTL",127,0)
 D EN^LEXCODE(SCT) I '$D(LEXS("SCT",1)) Q
"RTN","GMPLUTL",128,0)
 S PL("NARRATIVE")=$P(PL("NARRATIVE")," (")
"RTN","GMPLUTL",129,0)
 S PL("LEXICON")=$P(LEXS("SCT",1),U)_U_PL("NARRATIVE")_" (SNOMED CT "_SCT_")"
"RTN","GMPLUTL",130,0)
 S ICDS=$$GETDX(SCT,$G(PL("DX_DATE_OF_INTEREST")))
"RTN","GMPLUTL",131,0)
 S:($L(ICDS,"/")>1)&(ICDS'=$P($G(PL("DIAGNOSIS")),U,2)) $P(PL("DIAGNOSIS"),U,2)=ICDS
"RTN","GMPLUTL",132,0)
 Q
"RTN","GMPLUTL",133,0)
 ;
"RTN","GMPLUTL",134,0)
GETDX(CODE,GMPDT) ; Get ICD associated with SNOMED CT Code
"RTN","GMPLUTL",135,0)
 N LEX,ORI,ORY,GMPIMPDT,GMPMPDEF S GMPDT=$G(GMPDT,$$DT^XLFDT)
"RTN","GMPLUTL",136,0)
 S ORY=0,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLUTL",137,0)
 S GMPMPDEF=$S(GMPDT<GMPIMPDT:"SCT2ICD",1:"SCT210D")
"RTN","GMPLUTL",138,0)
 S ORY=$$GETASSN^LEXTRAN1(CODE,GMPMPDEF,GMPDT)
"RTN","GMPLUTL",139,0)
 I $S(+ORY'>0:1,+$P(ORY,U,2)'>0:1,+LEX'>0:1,1:0) S ORY=$S(GMPDT<GMPIMPDT:"799.9",1:"R69.") G GETDXX
"RTN","GMPLUTL",140,0)
 S (ORI,ORY)=0
"RTN","GMPLUTL",141,0)
 F  S ORI=$O(LEX(ORI)) Q:+ORI'>0  D
"RTN","GMPLUTL",142,0)
 . N ICD
"RTN","GMPLUTL",143,0)
 . S ICD=$O(LEX(ORI,""))
"RTN","GMPLUTL",144,0)
 . I ICD]"" S ORY=$S(ORY'=0:ORY_"/",1:"")_ICD
"RTN","GMPLUTL",145,0)
 I ORY'["." S ORY=ORY_"."
"RTN","GMPLUTL",146,0)
GETDXX Q ORY
"RTN","GMPLUTL",147,0)
 ;
"RTN","GMPLUTL",148,0)
UPDATE(PL,PLY) ; Update a Problem/Create if Not Found
"RTN","GMPLUTL",149,0)
 ;
"RTN","GMPLUTL",150,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",151,0)
 ;    Required
"RTN","GMPLUTL",152,0)
 ;      PL("PROBLEM")    Pointer to Problem #9000011
"RTN","GMPLUTL",153,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",154,0)
 ;
"RTN","GMPLUTL",155,0)
 ;    Optional
"RTN","GMPLUTL",156,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",157,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",158,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",159,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",160,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",161,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",162,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",163,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",164,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",165,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",166,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",167,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",168,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",169,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",170,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",171,0)
 ;      PL("CV")         Combat Veteran    1 = Yes 0 = No
"RTN","GMPLUTL",172,0)
 ;      PL("SHD")        SHAD              1 = Yes 0 = No
"RTN","GMPLUTL",173,0)
 ;      PL("SCTC")       SNOMED CT Concept Code
"RTN","GMPLUTL",174,0)
 ;      PL("SCTD")       SNOMED CT Designation Code
"RTN","GMPLUTL",175,0)
 ;      PL("CODEDT")     Date of interest for the primary ICD Diagnosis
"RTN","GMPLUTL",176,0)
 ;      PL("CODESYS")    Coding system of the primary ICD Diagnosis
"RTN","GMPLUTL",177,0)
 ;      PL("DX_DATE_OF_INTEREST") For historical encounters (=Today's date) & all other encounters (=encounter date/time)
"RTN","GMPLUTL",178,0)
 ;
"RTN","GMPLUTL",179,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",180,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",181,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",182,0)
 ;
"RTN","GMPLUTL",183,0)
 N GMPORIG,GMPFLD,FLD,ITEMS,SUB,GMPI,DIFFRENT,GMPIFN,GMPVAMC,GMPVA,GMPROV,GMPQUIT,GMPDFN
"RTN","GMPLUTL",184,0)
 N GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",185,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0),PLY=-1,PLY(0)=""
"RTN","GMPLUTL",186,0)
 S GMPIFN=$G(PL("PROBLEM")) I GMPIFN="" D CREATE(.PL,.PLY) Q
"RTN","GMPLUTL",187,0)
 I '$D(^AUPNPROB(GMPIFN,0)) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",188,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",189,0)
 S GMPROV=+$G(PL("PROVIDER")),GMPDFN=+$P(^AUPNPROB(GMPIFN,0),U,2)
"RTN","GMPLUTL",190,0)
 D GETFLDS^GMPLEDT3(GMPIFN) I '$D(GMPFLD) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",191,0)
 I +$G(PL("PATIENT")),+PL("PATIENT")'=GMPDFN S PLY(0)="Patient does not match for this problem" Q
"RTN","GMPLUTL",192,0)
 I $L($G(PL("RECORDED"))) S PLY(0)="Date Recorded is not editable" Q
"RTN","GMPLUTL",193,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",194,0)
 S:'$L($G(PL("DX_DATE_OF_INTEREST"))) PL("DX_DATE_OF_INTEREST")=$$DT^XLFDT
"RTN","GMPLUTL",195,0)
 I '$L($G(PL("CODESYS"))),$L($G(PL("DIAGNOSIS"))) D
"RTN","GMPLUTL",196,0)
 . S PL("CODESYS")=$$SAB^ICDEX($$CSI^ICDEX(80,+PL("DIAGNOSIS")),PL("DX_DATE_OF_INTEREST"))
"RTN","GMPLUTL",197,0)
 S ITEMS="LEXICON^DIAGNOSIS^LOCATION^STATUS^ONSET^RESOLVED^SC^AO^IR^EC^HNC^MST^CV^SHD",FLD="1.01^.01^1.08^.12^.13^1.07^1.1^1.11^1.12^1.13^1.15^1.16^1.17^1.18"
"RTN","GMPLUTL",198,0)
 F GMPI=1:1 S SUB=$P(ITEMS,U,GMPI) Q:SUB=""  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL",199,0)
 . I '$L($G(PL(SUB))) S PL(SUB)=$P(GMPFLD($P(FLD,U,GMPI)),U) Q
"RTN","GMPLUTL",200,0)
 . I SUB="STATUS",PL(SUB)="@" S GMPQUIT=1,PLY(0)="Cannot delete problem status" Q
"RTN","GMPLUTL",201,0)
 . I PL(SUB)'="@" D @($E(SUB,1,8)_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",202,0)
 . S GMPFLD($P(FLD,U,GMPI))=$S(PL(SUB)="@":"",1:PL(SUB)),DIFFRENT=1
"RTN","GMPLUTL",203,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",204,0)
 I +GMPFLD(1.07),GMPFLD(1.07)<GMPFLD(.13) S PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",205,0)
 I +GMPFLD(1.09),GMPFLD(1.09)<GMPFLD(.13) S PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",206,0)
 S:$L($G(PL("NARRATIVE"))) GMPFLD(.05)=U_PL("NARRATIVE"),DIFFRENT=1
"RTN","GMPLUTL",207,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60),DIFFRENT=1
"RTN","GMPLUTL",208,0)
 D:$D(DIFFRENT) EN^GMPLSAVE S PLY=GMPIFN,PLY(0)=""
"RTN","GMPLUTL",209,0)
 Q
"RTN","GMPLX")
0^3^B102602938^B101606054
"RTN","GMPLX",1,0)
GMPLX ; ISL/MKB,AJB,JER,TC -- Problem List Problem Utilities ;01/19/16  13:09
"RTN","GMPLX",2,0)
 ;;2.0;Problem List;**7,23,26,28,27,36,42,40**;Aug 25, 1994;Build 9
"RTN","GMPLX",3,0)
 ;
"RTN","GMPLX",4,0)
 ; External References
"RTN","GMPLX",5,0)
 ;  DBIA   446 ^AUTNPOV(
"RTN","GMPLX",6,0)
 ;   ICR  5679 $$IMPDATE^LEXU
"RTN","GMPLX",7,0)
 ;   ICR  5699 $$ICDDATA^ICDXCODE,$$STATCHK^ICDXCODE
"RTN","GMPLX",8,0)
 ;   ICR  5747 $$CSI/SAB^ICDEX
"RTN","GMPLX",9,0)
 ;  DBIA 10060 ^VA(200
"RTN","GMPLX",10,0)
 ;  DBIA 10006 ^DIC
"RTN","GMPLX",11,0)
 ;  DBIA 10009 FILE^DICN
"RTN","GMPLX",12,0)
 ;  DBIA 10013 EN^DIK
"RTN","GMPLX",13,0)
 ;  DBIA 10013 IX1^DIK
"RTN","GMPLX",14,0)
 ;  DBIA 10026 ^DIR
"RTN","GMPLX",15,0)
 ;  DBIA  1609 CONFIG^LEXSET
"RTN","GMPLX",16,0)
 ;  DBIA 10103 $$FMTE^XLFDT
"RTN","GMPLX",17,0)
 ;  DBIA 10104 $$UP^XLFSTR
"RTN","GMPLX",18,0)
 ;  DBIA  2742 GMPLX
"RTN","GMPLX",19,0)
 ;
"RTN","GMPLX",20,0)
SEARCH(X,Y,PROMPT,UNRES,VIEW) ; Search Lexicon for Problem X
"RTN","GMPLX",21,0)
 N DIC S:'$L($G(VIEW)) VIEW="PLS" D CONFIG^LEXSET("GMPX",VIEW,DT)
"RTN","GMPLX",22,0)
 S DIC("A")=$S($L($G(PROMPT)):PROMPT,1:"Select PROBLEM: ")
"RTN","GMPLX",23,0)
 S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"A",1:"")_"EQM"
"RTN","GMPLX",24,0)
 S:'$G(UNRES) LEXUN=0 D ^DIC
"RTN","GMPLX",25,0)
 I +Y>1 D
"RTN","GMPLX",26,0)
 .N CODE,SRC
"RTN","GMPLX",27,0)
 .S X=$P(Y,U,2)
"RTN","GMPLX",28,0)
 .D EXP2CODE(+Y,.SRC,.CODE)
"RTN","GMPLX",29,0)
 .I (SRC["SNOMED")!(SRC["VHAT") S (X,$P(Y,U,2))=X_" ("_$S(SRC["SNOMED":"SCT",1:"VHAT")_" "_CODE_")",Y(1)=$$GETDX(CODE,SRC)
"RTN","GMPLX",30,0)
 Q
"RTN","GMPLX",31,0)
 ;
"RTN","GMPLX",32,0)
PROVNARR(X,CL) ; Returns IFN ^ Text of Narrative (#9999999.27)
"RTN","GMPLX",33,0)
 N DIC,Y,DLAYGO,DD,DO,DA S:$L(X)>245 X=$E(X,1,245)
"RTN","GMPLX",34,0)
 S DIC="^AUTNPOV(",DIC(0)="L",DLAYGO=9999999.27,(DA,Y)=0
"RTN","GMPLX",35,0)
 F  S DA=$O(^AUTNPOV("B",$E(X,1,30),DA)) Q:DA'>0  I $P(^AUTNPOV(DA,0),U)=X S Y=DA_U_X Q
"RTN","GMPLX",36,0)
 I '(+Y) K DA,Y D FILE^DICN S:Y'>0 Y=U_X I Y>0,CL>1 S ^AUTNPOV(+Y,757)=CL
"RTN","GMPLX",37,0)
 Q $P(Y,U,1,2)
"RTN","GMPLX",38,0)
 ;
"RTN","GMPLX",39,0)
PROBTEXT(IFN) ; Returns Display Text
"RTN","GMPLX",40,0)
 N X,Y,ICD,SCTC,GMPL0,GMPL800,GMPL802,GMPLEXP,GMPLPOV,GMPLSO,GMPLTXT,GMPLDT,GMPLCSYS,GMPLILBL
"RTN","GMPLX",41,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL800=$G(^(800)),GMPL802=$G(^(802))
"RTN","GMPLX",42,0)
 I '$L(GMPL0) S X="" G PROBTX
"RTN","GMPLX",43,0)
 S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLX",44,0)
 S GMPLILBL=$S(GMPLCSYS="10D":"ICD-10-CM ",1:"ICD-9-CM ")
"RTN","GMPLX",45,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2),SCTC=$P(GMPL800,U)
"RTN","GMPLX",46,0)
 S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",47,0)
 S GMPLEXP=$$EP(IFN),GMPLSO=$$CS(X),GMPLPOV=$$PT(X,GMPLSO)
"RTN","GMPLX",48,0)
 S GMPLTXT=GMPLPOV S:$L(GMPLEXP) GMPLTXT=GMPLTXT_" ("_GMPLEXP_")"
"RTN","GMPLX",49,0)
 ;S:$L(GMPLSO)&(GMPLSO'["SNOMED") GMPLTXT=GMPLTXT_" "_GMPLSO
"RTN","GMPLX",50,0)
 S:GMPLTXT["*" GMPLTXT=$TR(GMPLTXT,"*","")
"RTN","GMPLX",51,0)
 ;S:$L(GMPLTXT) GMPLTXT=GMPLTXT_" ("_$$HFP^GMPLUTL4_","_$$PTR^GMPLUTL4_")"
"RTN","GMPLX",52,0)
 S:$L(GMPLTXT) GMPLTXT=GMPLTXT_$S($L($G(ICD))&('$L($G(SCTC))):" ("_GMPLILBL_$G(ICD)_")",$L($G(SCTC)):" (SCT "_$G(SCTC)_")",1:"")
"RTN","GMPLX",53,0)
 S:$L(GMPLTXT) X=GMPLTXT
"RTN","GMPLX",54,0)
PROBTX Q X
"RTN","GMPLX",55,0)
PROBNARR(IFN) ; Returns Provider Narrative
"RTN","GMPLX",56,0)
 N X,Y S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",57,0)
 Q X
"RTN","GMPLX",58,0)
CS(X) ; Problem Codes
"RTN","GMPLX",59,0)
 N GMPLSAB,GMPLSO S GMPLSO="" S X=$G(X) Q:X'["(" ""
"RTN","GMPLX",60,0)
 F GMPLSAB="ICD-","CPT-","DSM-","HCPCS","NANDA","NIC","NOC","LOINC","SNOMED","OMAHA","SCT" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",61,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",62,0)
 F GMPLSAB="ACR","AI/RHEUM","CONGRESS","COSTAR","COSTART","CRISP","DODFAC" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",63,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",64,0)
 F GMPLSAB="DORLAND","DXPLAIN","HHCC","MCMASTER","META","MTF","MeSH","RVC","TITLE 38","UMDNS","UWA" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",65,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",66,0)
 Q ""
"RTN","GMPLX",67,0)
EP(X) ; Exposures
"RTN","GMPLX",68,0)
 N GMPLSC S X=+($G(X)) D SCS^GMPLX1(+X,.GMPLSC) S X=$G(GMPLSC(1)) Q X
"RTN","GMPLX",69,0)
PT(X,C) ; Problem Text (only)
"RTN","GMPLX",70,0)
 N GMPLTERM,GMPLSO S GMPLTERM=$G(X),GMPLSO=$G(C)
"RTN","GMPLX",71,0)
 S:$L(GMPLSO)&(GMPLTERM[GMPLSO) GMPLTERM=$P(GMPLTERM,GMPLSO,1) S GMPLTERM=$$TRIM(GMPLTERM)
"RTN","GMPLX",72,0)
 S:$L(GMPLTERM) X=GMPLTERM Q X
"RTN","GMPLX",73,0)
TRIM(X) ; Trim Spaces and "*"
"RTN","GMPLX",74,0)
 S X=$G(X) F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",75,0)
 F  Q:$E(X,$L(X))'="*"  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",76,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",77,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMPLX",78,0)
 Q X
"RTN","GMPLX",79,0)
WRAP(PROB,MAX,TEXT) ; Splits Text into TEXT array
"RTN","GMPLX",80,0)
 N I,J S J=0 K TEXT I $L(PROB)'>MAX S J=J+1,TEXT(J)=PROB G WRQ
"RTN","GMPLX",81,0)
WR0 ;   Loop for Remaining Text
"RTN","GMPLX",82,0)
 S I=$F(PROB," ") I ('I)!(I>(MAX+2)) S J=J+1,TEXT(J)=$E(PROB,1,MAX),PROB=$E(PROB,MAX+1,999)
"RTN","GMPLX",83,0)
 I $L(PROB)>MAX F I=(MAX+1):-1:1 I $E(PROB,I)=" " S J=J+1,TEXT(J)=$E(PROB,1,I-1),PROB=$E(PROB,I+1,999) Q
"RTN","GMPLX",84,0)
 G:$L(PROB)>MAX WR0
"RTN","GMPLX",85,0)
 S:$L(PROB) J=J+1,TEXT(J)=PROB
"RTN","GMPLX",86,0)
WRQ ;   Quit Wrap
"RTN","GMPLX",87,0)
 S TEXT=J
"RTN","GMPLX",88,0)
 Q
"RTN","GMPLX",89,0)
 ;
"RTN","GMPLX",90,0)
NOS(GMPLCSYS,GMPLDT) ; Return PTR ^ 799.9 or PTR ^ R69 ICD code
"RTN","GMPLX",91,0)
 N GMPIMPDT S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLX",92,0)
 S:'$D(GMPLDT) GMPLDT=DT
"RTN","GMPLX",93,0)
 S:'$D(GMPLCSYS) GMPLCSYS=$S(GMPLDT<GMPIMPDT:"ICD",1:"10D")
"RTN","GMPLX",94,0)
 Q $S(GMPLCSYS="10D":+$$ICDDATA^ICDXCODE(GMPLCSYS,"R69.",GMPLDT,"E")_"^R69.",1:+$$ICDDATA^ICDXCODE(GMPLCSYS,"799.9",GMPLDT,"E")_"^799.9")
"RTN","GMPLX",95,0)
 ;
"RTN","GMPLX",96,0)
SEL(HELP) ; Select List of Problems
"RTN","GMPLX",97,0)
 N X,Y,DIR,MAX,DTOUT S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",98,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select Problem(s)"
"RTN","GMPLX",99,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",100,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",101,0)
 S DIR("?")="Enter the problems you wish to "
"RTN","GMPLX",102,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")_", as a range or list of numbers"
"RTN","GMPLX",103,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",104,0)
 Q Y
"RTN","GMPLX",105,0)
 ;
"RTN","GMPLX",106,0)
SEL1(HELP) ; Select 1 Problem
"RTN","GMPLX",107,0)
 N X,Y,DIR,MAX,DTOUT S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",108,0)
 S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select Problem"
"RTN","GMPLX",109,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",110,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",111,0)
 S DIR("?")="Enter the number of the problem you wish to "
"RTN","GMPLX",112,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")
"RTN","GMPLX",113,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",114,0)
 Q Y
"RTN","GMPLX",115,0)
 ;
"RTN","GMPLX",116,0)
DUPL(DFN,TERM,TEXT) ; Check for Duplicates
"RTN","GMPLX",117,0)
 N DA,IFN,GMPOTHR,GMPNOW S DA=0,TEXT=$$UP^XLFSTR($S(TEXT["SCT":$P(TEXT," (SCT"),1:TEXT))
"RTN","GMPLX",118,0)
 I '$D(^AUPNPROB("AC",DFN)) G DUPLX
"RTN","GMPLX",119,0)
 S GMPNOW=$E($$NOW^XLFDT,1,7)
"RTN","GMPLX",120,0)
 S GMPOTHR=$S(GMPNOW<($$IMPDATE^LEXU("10D")):"799.9",1:"R69.")
"RTN","GMPLX",121,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",DFN,IFN)) Q:IFN'>0  D  Q:DA>0
"RTN","GMPLX",122,0)
 .N PICDOLD,PICDNEW,NODE0,NODE1,NODE800,NODE802,NODE803,SCTD,PROVNAR,EXPTXT,GMPSRC,GMPCODE,GMPLDT,GMPLCSYS
"RTN","GMPLX",123,0)
 .S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)),NODE800=$G(^(800)),NODE802=$G(^(802)),NODE803=$G(^(803,0)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLX",124,0)
 .S GMPLDT=$S(+$P(NODE802,U,1):$P(NODE802,U,1),1:$P(NODE0,U,8)),GMPLCSYS=$S($P(NODE802,U,2)]"":$P(NODE802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+NODE0),GMPLDT))
"RTN","GMPLX",125,0)
 .S PICDOLD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+NODE0,GMPLDT,"I"),U,2)
"RTN","GMPLX",126,0)
 .D EXP2CODE(TERM,.GMPSRC,.GMPCODE)
"RTN","GMPLX",127,0)
 .S ICDNEW=$S(GMPSRC="SNOMED CT":$$GETDX(GMPCODE,GMPSRC),1:GMPCODE)
"RTN","GMPLX",128,0)
 .S PICDNEW=$P(ICDNEW,"/")
"RTN","GMPLX",129,0)
 .;Compare problems with SNOMED CT concept codes & ICD code(s) only
"RTN","GMPLX",130,0)
 .I +NODE800,(GMPSRC="SNOMED CT"),(+$G(GMPCODE)>0),($L(ICDNEW)) D  Q
"RTN","GMPLX",131,0)
 ..;if SCT concepts & primary + multiple ICD targets match => dup
"RTN","GMPLX",132,0)
 ..I $P(NODE803,U,4)>0,ICDNEW["/" D
"RTN","GMPLX",133,0)
 ...N I,J,SICDNEW S J=0 F I=2:1:$L(ICDNEW,"/") D
"RTN","GMPLX",134,0)
 ....S J=J+1,SICDNEW(J)=$P(ICDNEW,"/",I)
"RTN","GMPLX",135,0)
 ...N T F T=1:1:J D
"RTN","GMPLX",136,0)
 ....N IEN S IEN=0 F  S IEN=$O(^AUPNPROB(IFN,803,IEN)) Q:'+IEN  D
"RTN","GMPLX",137,0)
 .....I +NODE800=GMPCODE,(PICDOLD=PICDNEW),$P($G(^AUPNPROB(IFN,803,IEN,0)),U)=SICDNEW(T) S DA=IFN Q
"RTN","GMPLX",138,0)
 ..;if SCT concept codes match => dup
"RTN","GMPLX",139,0)
 ..E  I ICDNEW=GMPOTHR!(PICDNEW=GMPOTHR) D
"RTN","GMPLX",140,0)
 ...I +NODE800=GMPCODE S DA=IFN Q
"RTN","GMPLX",141,0)
 ..;if SCT concepts & primary ICD diagnosis match => dup
"RTN","GMPLX",142,0)
 ..E  I +NODE800=GMPCODE,(PICDOLD=PICDNEW) S DA=IFN Q
"RTN","GMPLX",143,0)
 .;Compare legacy problems with ICD codes only
"RTN","GMPLX",144,0)
 .E  I +NODE0,'$L($G(NODE800)),(GMPSRC["ICD"),(+$G(GMPCODE)>0) D
"RTN","GMPLX",145,0)
 ..;if Exprs match => dup
"RTN","GMPLX",146,0)
 ..I TERM>1&(+NODE1=TERM) S DA=IFN Q
"RTN","GMPLX",147,0)
 ..;if Text matches Expr from old => dup
"RTN","GMPLX",148,0)
 ..D LOOK^LEXA("`"_+NODE1)
"RTN","GMPLX",149,0)
 ..S EXPTXT=$P($G(LEX("LIST",1)),U,2)
"RTN","GMPLX",150,0)
 ..I LEX>1&(TEXT=$$UP^XLFSTR($S(EXPTXT["*":$P(EXPTXT," *"),1:EXPTXT))) S DA=IFN Q
"RTN","GMPLX",151,0)
 ..;if Text matches Prov Narr of old => dup
"RTN","GMPLX",152,0)
 ..S PROVNAR=$S($P(NODE0,U,5)]"":$P(^AUTNPOV($P(NODE0,U,5),0),U),1:"")
"RTN","GMPLX",153,0)
 ..I TEXT=$$UP^XLFSTR($S(PROVNAR["SNOMED":$P(PROVNAR," (SN"),PROVNAR[" *":$P(PROVNAR,"*"),1:PROVNAR)) S DA=IFN Q
"RTN","GMPLX",154,0)
 ..;if prim ICD of new = prim ICD of old => dup
"RTN","GMPLX",155,0)
 ..I PICDOLD'=GMPOTHR,(PICDNEW'=GMPOTHR),(PICDOLD=PICDNEW) S DA=IFN Q
"RTN","GMPLX",156,0)
DUPLX Q DA
"RTN","GMPLX",157,0)
 ;
"RTN","GMPLX",158,0)
DUPLOK(IFN) ; Ask if Dup OK
"RTN","GMPLX",159,0)
 N DIR,X,Y,GMPL0,GMPL1,DATE,PROV S DIR(0)="YA",GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLX",160,0)
 S DIR("A")="Are you sure you want to continue? ",DIR("B")="NO"
"RTN","GMPLX",161,0)
 S DIR("?",1)="Enter YES if you want to duplicate this problem on this patient's list;",DIR("?")="press <return> to re-enter the problem name."
"RTN","GMPLX",162,0)
 W $C(7),!!,">>>  "_$$PROBTEXT(IFN),!?5,"is already an "
"RTN","GMPLX",163,0)
 W $S($P(GMPL0,U,12)="I":"IN",1:"")_"ACTIVE problem on this patient's list!",!
"RTN","GMPLX",164,0)
 S PROV=+$P(GMPL1,U,5) W:PROV !?5,"Provider: "_$P($G(^VA(200,PROV,0)),U)_" ("_$P($$SERVICE^GMPLX1(PROV),U,2)_")"
"RTN","GMPLX",165,0)
 I $P(GMPL0,U,12)="A" W !?8,"Onset: " S DATE=$P(GMPL0,U,13)
"RTN","GMPLX",166,0)
 I $P(GMPL0,U,12)="I" W !?5,"Resolved: " S DATE=$P(GMPL1,U,7)
"RTN","GMPLX",167,0)
 W $S(DATE>0:$$FMTE^XLFDT(DATE),1:"unspecified"),!
"RTN","GMPLX",168,0)
 D ^DIR W !
"RTN","GMPLX",169,0)
 Q +Y
"RTN","GMPLX",170,0)
 ;
"RTN","GMPLX",171,0)
LOCKED() ; Return Lock Msg
"RTN","GMPLX",172,0)
 Q "This problem is currently being edited by another user!"
"RTN","GMPLX",173,0)
 ;
"RTN","GMPLX",174,0)
SURE() ; Ask to Delete
"RTN","GMPLX",175,0)
 ;   Returns 1 if YES, else 0
"RTN","GMPLX",176,0)
 N DIR,X,Y S DIR(0)="YA",DIR("B")="NO"
"RTN","GMPLX",177,0)
 S DIR("?")="Enter YES to remove this value or NO to leave it unchanged."
"RTN","GMPLX",178,0)
 S DIR("A")="Are you sure you want to remove this value? " D ^DIR
"RTN","GMPLX",179,0)
 Q +Y
"RTN","GMPLX",180,0)
 ;
"RTN","GMPLX",181,0)
EXTDT(DATE) ; Format Date as MM/DD/YY
"RTN","GMPLX",182,0)
 N X,MM,DD,YY,YYY S X="",DATE=$P(DATE,".") Q:'DATE ""
"RTN","GMPLX",183,0)
 S MM=+$E(DATE,4,5),DD=+$E(DATE,6,7),YY=$E(DATE,2,3),YYY=$E(DATE,1,3)
"RTN","GMPLX",184,0)
 S:MM X=MM_"/" S:DD X=X_DD_"/" S X=$S($L(X):X_YY,1:1700+YYY)
"RTN","GMPLX",185,0)
 Q X
"RTN","GMPLX",186,0)
 ;
"RTN","GMPLX",187,0)
AUDIT(DATA,OLD) ; Make Entry in Audit File
"RTN","GMPLX",188,0)
 ; DATA = string for 0-node
"RTN","GMPLX",189,0)
 ; OLD  = string for 1-node
"RTN","GMPLX",190,0)
 ;      = 0-node from reform/react problem
"RTN","GMPLX",191,0)
 N DA,DD,DO,DIC,X,Y,DIK,DLAYGO
"RTN","GMPLX",192,0)
 S DIC="^GMPL(125.8,",DIC(0)="L",X=$P(DATA,U),DLAYGO=125.8
"RTN","GMPLX",193,0)
 D FILE^DICN Q:+Y'>0  S DA=+Y,DIK="^GMPL(125.8,"
"RTN","GMPLX",194,0)
 S ^GMPL(125.8,DA,0)=DATA D IX1^DIK
"RTN","GMPLX",195,0)
 S:$L(OLD) ^GMPL(125.8,DA,1)=OLD
"RTN","GMPLX",196,0)
 Q
"RTN","GMPLX",197,0)
 ;
"RTN","GMPLX",198,0)
DTMOD(DA) ; Update Date Modified
"RTN","GMPLX",199,0)
 N DIE,DR
"RTN","GMPLX",200,0)
 S DR=".03///TODAY",DIE="^AUPNPROB("
"RTN","GMPLX",201,0)
 D ^DIE
"RTN","GMPLX",202,0)
 ; broadcast problem change events
"RTN","GMPLX",203,0)
 N GMPIFN,DFN,X
"RTN","GMPLX",204,0)
 S GMPIFN=DA,DFN=+$P($G(^AUPNPROB(DA,0)),U,2)
"RTN","GMPLX",205,0)
 S X=+$O(^ORD(101,"B","GMPL EVENT",0))_";ORD(101," D:X EN1^XQOR
"RTN","GMPLX",206,0)
 Q
"RTN","GMPLX",207,0)
 ;
"RTN","GMPLX",208,0)
MSG() ; ListMan Msg Bar
"RTN","GMPLX",209,0)
 Q "+ Next Screen  - Prev Screen  ?? More actions"
"RTN","GMPLX",210,0)
 ;
"RTN","GMPLX",211,0)
KILL ; Clean-Up Vars
"RTN","GMPLX",212,0)
 K X,Y,DIC,DIE,DR,DA,DUOUT,DTOUT,GMPQUIT,GMPRT,GMPSAVED,GMPIFN,GMPLNO,GMPLNUM,GMPLSEL,GMPREBLD,GMPI,GMPLSLST,GMPLJUMP
"RTN","GMPLX",213,0)
 Q
"RTN","GMPLX",214,0)
 ;
"RTN","GMPLX",215,0)
CODESTS(PROB,ADATE) ;check status of ICD
"RTN","GMPLX",216,0)
 ; Input:
"RTN","GMPLX",217,0)
 ;  PROB  = pointer to the PROBLEM (#9000011) file
"RTN","GMPLX",218,0)
 ;  ADATE = FM date on which to check the status (opt.)
"RTN","GMPLX",219,0)
 ;
"RTN","GMPLX",220,0)
 ; Output:
"RTN","GMPLX",221,0)
 ;  1 = ACTIVE on the date passed or current date
"RTN","GMPLX",222,0)
 ;  0 = INACTIVE on the date passed or current date
"RTN","GMPLX",223,0)
 ;
"RTN","GMPLX",224,0)
 I '$G(ADATE) S ADATE=DT
"RTN","GMPLX",225,0)
 I '$D(^AUPNPROB(PROB,0)) Q 0
"RTN","GMPLX",226,0)
 N GMPL0,GMPL802,GMPLCSYS,GMPLCPTR,GMPLICD S GMPL0=$G(^AUPNPROB(PROB,0)),GMPL802=$G(^(802))
"RTN","GMPLX",227,0)
 S GMPLCPTR=$$CSI^ICDEX(80,+GMPL0),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX(GMPLCPTR,ADATE))
"RTN","GMPLX",228,0)
 S GMPLICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,ADATE,"I"),U,2)
"RTN","GMPLX",229,0)
 Q +$$STATCHK^ICDXCODE(GMPLCPTR,GMPLICD,ADATE)
"RTN","GMPLX",230,0)
EXP2CODE(X,GMPSRC,GMPCODE) ; Resolve SOURCE and CODE from Expression
"RTN","GMPLX",231,0)
 N LEX,SRCCODE,GMI S GMI=0,(GMPSRC,GMPCODE)=""
"RTN","GMPLX",232,0)
 D INFO^LEXA(X,DT)
"RTN","GMPLX",233,0)
 F  S GMI=$O(LEX("SEL","SRC",GMI)) Q:+GMI'>0  D  Q:($G(GMPSRC)]"")
"RTN","GMPLX",234,0)
 . S SRCCODE=$P($G(LEX("SEL","SRC",GMI)),U,1,2)
"RTN","GMPLX",235,0)
 . I $P(SRCCODE,U)["SNOMED CT"!($P(SRCCODE,U)["VHAT")!($P(SRCCODE,U)["ICD") S GMPSRC=$P(SRCCODE,U),GMPCODE=$P(SRCCODE,U,2)
"RTN","GMPLX",236,0)
 Q
"RTN","GMPLX",237,0)
GETDX(CODE,CODESYS,GMPDT) ; Get ICD associated with SCT or VHAT Code
"RTN","GMPLX",238,0)
 N LEX,GMPI,GMPY,GMPMPDEF,GMPIMPDT S GMPDT=$G(GMPDT,$$DT^XLFDT)
"RTN","GMPLX",239,0)
 S GMPY=0,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLX",240,0)
 S GMPMPDEF=$S(GMPDT<GMPIMPDT:"SCT2ICD",1:"SCT210D")
"RTN","GMPLX",241,0)
 I CODESYS["VHAT" S GMPY=$$GETASSN^LEXTRAN1(CODE,"VHAT2ICD",GMPDT) I 1
"RTN","GMPLX",242,0)
 E  S GMPY=$$GETASSN^LEXTRAN1(CODE,GMPMPDEF,GMPDT)
"RTN","GMPLX",243,0)
 I $S(+GMPY'>0:1,+$P(GMPY,U,2)'>0:1,+LEX'>0:1,1:0) S GMPY=$S(GMPDT<GMPIMPDT:"799.9",1:"R69.") G GETDXX
"RTN","GMPLX",244,0)
 S (GMPI,GMPY)=0
"RTN","GMPLX",245,0)
 F  S GMPI=$O(LEX(GMPI)) Q:+GMPI'>0  D
"RTN","GMPLX",246,0)
 .N ICD
"RTN","GMPLX",247,0)
 .S ICD=$O(LEX(GMPI,""))
"RTN","GMPLX",248,0)
 .I ICD]"" S GMPY=$S(GMPY'=0:GMPY_"/",1:"")_ICD
"RTN","GMPLX",249,0)
 I GMPY'["." S GMPY=GMPY_"."
"RTN","GMPLX",250,0)
GETDXX Q GMPY
"RTN","GMPLX",251,0)
PAD(GMPX,GMPL) ; Pads string to specified length
"RTN","GMPLX",252,0)
 N GMPY
"RTN","GMPLX",253,0)
 S GMPY="",$P(GMPY," ",(GMPL-$L(GMPX))+1)=""
"RTN","GMPLX",254,0)
 Q GMPY
"RTN","GMPLY40")
0^2^B38628^n/a
"RTN","GMPLY40",1,0)
GMPLY40 ;ISP/TC - Pre/Post Install Routine for GMPL*2.0*40 ;01/14/16  13:47
"RTN","GMPLY40",2,0)
 ;;2.0;Problem List;**40**;Aug 25, 1994;Build 9
"RTN","GMPLY40",3,0)
 ;
"RTN","GMPLY40",4,0)
POST ; Post-install subroutine
"RTN","GMPLY40",5,0)
 ;
"RTN","GMPLY40",6,0)
 ; Scan Problem file for SCT in Diagnosis field errors
"RTN","GMPLY40",7,0)
 D EN^GMPLCLNP
"RTN","GMPLY40",8,0)
 ; Scan Problem file for incorrect mapping (SCT 428283002, ICD-9 V15.89)
"RTN","GMPLY40",9,0)
 D EN1^GMPLCLNP
"RTN","GMPLY40",10,0)
 Q
"VER")
8.0^22.0
"BLD",9306,6)
^43
**END**
**END**

