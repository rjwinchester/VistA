KIDS Distribution saved on May 05, 2015@11:28:43
GMPL*2.0*45
**KIDS**:GMPL*2.0*45^

**INSTALL NAME**
GMPL*2.0*45
"BLD",9077,0)
GMPL*2.0*45^PROBLEM LIST^0^3150505^y
"BLD",9077,1,0)
^^2^2^3140807^
"BLD",9077,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",9077,1,2,0)
under GMPL*2.0*45.
"BLD",9077,4,0)
^9.64PA^9000011^1
"BLD",9077,4,9000011,0)
9000011
"BLD",9077,4,9000011,2,0)
^9.641^9000011.1111^1
"BLD",9077,4,9000011,2,9000011.1111,0)
NOTE  (sub-file)
"BLD",9077,4,9000011,2,9000011.1111,1,0)
^9.6411^.03^1
"BLD",9077,4,9000011,2,9000011.1111,1,.03,0)
NOTE NARRATIVE
"BLD",9077,4,9000011,222)
y^n^p^^^^n^^n
"BLD",9077,4,9000011,224)

"BLD",9077,4,"APDD",9000011,9000011.1111)

"BLD",9077,4,"APDD",9000011,9000011.1111,.03)

"BLD",9077,4,"B",9000011,9000011)

"BLD",9077,6)
5^
"BLD",9077,6.3)
53
"BLD",9077,"ABPKG")
n
"BLD",9077,"INI")

"BLD",9077,"INID")
^^
"BLD",9077,"INIT")

"BLD",9077,"KRN",0)
^9.67PA^779.2^20
"BLD",9077,"KRN",.4,0)
.4
"BLD",9077,"KRN",.401,0)
.401
"BLD",9077,"KRN",.402,0)
.402
"BLD",9077,"KRN",.403,0)
.403
"BLD",9077,"KRN",.5,0)
.5
"BLD",9077,"KRN",.84,0)
.84
"BLD",9077,"KRN",3.6,0)
3.6
"BLD",9077,"KRN",3.8,0)
3.8
"BLD",9077,"KRN",9.2,0)
9.2
"BLD",9077,"KRN",9.8,0)
9.8
"BLD",9077,"KRN",9.8,"NM",0)
^9.68A^22^9
"BLD",9077,"KRN",9.8,"NM",1,0)
GMPLUTL2^^0^B93300856
"BLD",9077,"KRN",9.8,"NM",6,0)
GMPLEDT3^^0^B31430518
"BLD",9077,"KRN",9.8,"NM",8,0)
GMPLHIST^^0^B22139789
"BLD",9077,"KRN",9.8,"NM",10,0)
GMPLSAVE^^0^B132948390
"BLD",9077,"KRN",9.8,"NM",18,0)
GMPLDISP^^0^B53108852
"BLD",9077,"KRN",9.8,"NM",19,0)
GMPLEDT1^^0^B33842333
"BLD",9077,"KRN",9.8,"NM",20,0)
GMPLEDT4^^0^B30908694
"BLD",9077,"KRN",9.8,"NM",21,0)
GMPLBLDC^^0^B77042279
"BLD",9077,"KRN",9.8,"NM",22,0)
GMPL1^^0^B41592331
"BLD",9077,"KRN",9.8,"NM","B","GMPL1",22)

"BLD",9077,"KRN",9.8,"NM","B","GMPLBLDC",21)

"BLD",9077,"KRN",9.8,"NM","B","GMPLDISP",18)

"BLD",9077,"KRN",9.8,"NM","B","GMPLEDT1",19)

"BLD",9077,"KRN",9.8,"NM","B","GMPLEDT3",6)

"BLD",9077,"KRN",9.8,"NM","B","GMPLEDT4",20)

"BLD",9077,"KRN",9.8,"NM","B","GMPLHIST",8)

"BLD",9077,"KRN",9.8,"NM","B","GMPLSAVE",10)

"BLD",9077,"KRN",9.8,"NM","B","GMPLUTL2",1)

"BLD",9077,"KRN",19,0)
19
"BLD",9077,"KRN",19.1,0)
19.1
"BLD",9077,"KRN",101,0)
101
"BLD",9077,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",9077,"KRN",101,"NM",1,0)
GMPL ANNOTATE^^0
"BLD",9077,"KRN",101,"NM","B","GMPL ANNOTATE",1)

"BLD",9077,"KRN",409.61,0)
409.61
"BLD",9077,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",9077,"KRN",771,0)
771
"BLD",9077,"KRN",779.2,0)
779.2
"BLD",9077,"KRN",870,0)
870
"BLD",9077,"KRN",8989.51,0)
8989.51
"BLD",9077,"KRN",8989.52,0)
8989.52
"BLD",9077,"KRN",8994,0)
8994
"BLD",9077,"KRN","B",.4,.4)

"BLD",9077,"KRN","B",.401,.401)

"BLD",9077,"KRN","B",.402,.402)

"BLD",9077,"KRN","B",.403,.403)

"BLD",9077,"KRN","B",.5,.5)

"BLD",9077,"KRN","B",.84,.84)

"BLD",9077,"KRN","B",3.6,3.6)

"BLD",9077,"KRN","B",3.8,3.8)

"BLD",9077,"KRN","B",9.2,9.2)

"BLD",9077,"KRN","B",9.8,9.8)

"BLD",9077,"KRN","B",19,19)

"BLD",9077,"KRN","B",19.1,19.1)

"BLD",9077,"KRN","B",101,101)

"BLD",9077,"KRN","B",409.61,409.61)

"BLD",9077,"KRN","B",771,771)

"BLD",9077,"KRN","B",779.2,779.2)

"BLD",9077,"KRN","B",870,870)

"BLD",9077,"KRN","B",8989.51,8989.51)

"BLD",9077,"KRN","B",8989.52,8989.52)

"BLD",9077,"KRN","B",8994,8994)

"BLD",9077,"PRE")

"BLD",9077,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9077,"QUES",0)
^9.62^^
"BLD",9077,"REQB",0)
^9.611^3^3
"BLD",9077,"REQB",1,0)
GMPL*2.0*47^2
"BLD",9077,"REQB",2,0)
GMPL*2.0*46^2
"BLD",9077,"REQB",3,0)
LEX*2.0*86^2
"BLD",9077,"REQB","B","GMPL*2.0*46",2)

"BLD",9077,"REQB","B","GMPL*2.0*47",1)

"BLD",9077,"REQB","B","LEX*2.0*86",3)

"FIA",9000011)
PROBLEM
"FIA",9000011,0)
^AUPNPROB(
"FIA",9000011,0,0)
9000011IP
"FIA",9000011,0,1)
y^n^p^^^^n^^n
"FIA",9000011,0,10)

"FIA",9000011,0,11)

"FIA",9000011,0,"RLRO")

"FIA",9000011,0,"VR")
2.0^GMPL
"FIA",9000011,9000011)
1
"FIA",9000011,9000011.1111)
1
"FIA",9000011,9000011.1111,.03)

"KRN",101,2365,-1)
0^1
"KRN",101,2365,0)
GMPL ANNOTATE^Comment on a Problem^^A^^^^^^^^
"KRN",101,2365,1,0)
^^2^2^3140827^
"KRN",101,2365,1,1,0)
This action will append a brief comment(s) to a problem entry, up to
"KRN",101,2365,1,2,0)
200 characters in length.
"KRN",101,2365,20)
D NOTES^GMPL
"KRN",101,2365,24)
I +$G(GMPCOUNT)>0
"KRN",101,2365,99)
56232,37678
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",402,-1)
1^1
"PKG",402,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",402,20,0)
^9.402P^^
"PKG",402,22,0)
^9.49I^1^1
"PKG",402,22,1,0)
2.0^2940825^2941216
"PKG",402,22,1,"PAH",1,0)
45^3150505
"PKG",402,22,1,"PAH",1,1,0)
^^2^2^3150505
"PKG",402,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",402,22,1,"PAH",1,1,2,0)
under GMPL*2.0*45.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","GMPL1")
0^22^B41592331
"RTN","GMPL1",1,0)
GMPL1 ; SLC/MKB/AJB/TC -- Problem List actions ;04/22/15  13:08
"RTN","GMPL1",2,0)
 ;;2.0;Problem List;**3,20,28,43,42,45**;Aug 25, 1994;Build 53
"RTN","GMPL1",3,0)
 ; 10 MAR 2000 - MA - Added to the routine another user prompt
"RTN","GMPL1",4,0)
 ; to backup and refine Lexicon search if ICD code 799.9 or R69.
"RTN","GMPL1",5,0)
ADD ;add new entry to list - Requires GMPDFN
"RTN","GMPL1",6,0)
 N GMPROB,GMPTERM,GMPICD,Y,DUP,GMPIMPDT W !
"RTN","GMPL1",7,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPL1",8,0)
 S GMPROB=$$TEXT^GMPLEDT4("") I GMPROB="^" S GMPQUIT=1 Q
"RTN","GMPL1",9,0)
 I 'GMPARAM("CLU")!('$D(GMPLUSER)&('$D(^XUSEC("GMPL ICD CODE",DUZ)))) S GMPTERM="",GMPICD=$S(DT<GMPIMPDT:"799.9",1:"R69.") G ADD1
"RTN","GMPL1",10,0)
 F  D  Q:$D(GMPQUIT)!(+$G(Y))
"RTN","GMPL1",11,0)
 . D SEARCH^GMPLX(.GMPROB,.Y,"PROBLEM: ","1")
"RTN","GMPL1",12,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPL1",13,0)
 . S DUP=$$DUPL^GMPLX(+GMPDFN,+Y,GMPROB)
"RTN","GMPL1",14,0)
 . I DUP,'$$DUPLOK^GMPLX(DUP) S (Y,GMPROB)=""
"RTN","GMPL1",15,0)
 . I +Y=1 D ICDMSG
"RTN","GMPL1",16,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",17,0)
 S GMPTERM=$S(+$G(Y)>1:Y,1:""),GMPICD=$G(Y(1))
"RTN","GMPL1",18,0)
 S:'$L(GMPICD) GMPICD=$S(DT<GMPIMPDT:"799.9",1:"R69.")
"RTN","GMPL1",19,0)
ADD1 ; set up default values
"RTN","GMPL1",20,0)
 ; -- May enter here with GMPROB=text,GMPICD=code,GMPTERM=#^term
"RTN","GMPL1",21,0)
 ; added for Code Set Versioning (CSV)
"RTN","GMPL1",22,0)
 N I,GMPSTAT,GMPCSREC,GMPCSPTR,GMPCSNME,GMPSCTC,GMPSCTD,GMPTXT,GMPTYP,GMPNUM,GMPQT,GMPSYN
"RTN","GMPL1",23,0)
 S (GMPSCTC,GMPSCTD,GMPTXT,GMPTYP,GMPNUM,GMPQT)=""
"RTN","GMPL1",24,0)
 I GMPICD["/" F I=1:1:$L(GMPICD,"/") D  Q:GMPSTAT
"RTN","GMPL1",25,0)
 . N GMPCODE S GMPCODE=$P(GMPICD,"/",I),GMPSTAT=0
"RTN","GMPL1",26,0)
 . S GMPCSREC=$$CODECS^ICDEX(GMPCODE,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPL1",27,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPCODE,DT) GMPSTAT=1
"RTN","GMPL1",28,0)
 E  D
"RTN","GMPL1",29,0)
 . S GMPSTAT=0,GMPCSREC=$$CODECS^ICDEX(GMPICD,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPL1",30,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPICD,DT) GMPSTAT=1
"RTN","GMPL1",31,0)
 I GMPSTAT W !,GMPROB,!,"has an inactive ICD code.  Please edit before adding." H 3 Q
"RTN","GMPL1",32,0)
 I (GMPROB["(SCT"),(GMPROB[")") D
"RTN","GMPL1",33,0)
 . S GMPSCTC=$$ONE^LEXU(+GMPTERM,DT,"SCT")
"RTN","GMPL1",34,0)
 . S GMPTXT=$$TRIM^XLFSTR($RE($P($RE(GMPROB),"(",2,99)))
"RTN","GMPL1",35,0)
 . S GMPSCTD=$$GETSYN^LEXTRAN1("SCT",GMPSCTC,DT,"GMPSYN",1,1)
"RTN","GMPL1",36,0)
 . I $P(GMPSCTD,U)'=1 S GMPSCTD="" Q
"RTN","GMPL1",37,0)
 . F  S GMPTYP=$O(GMPSYN(GMPTYP)) Q:GMPTYP=""!(GMPQT)  D
"RTN","GMPL1",38,0)
 . . I GMPTYP="S" F  S GMPNUM=$O(GMPSYN(GMPTYP,GMPNUM)) Q:GMPNUM=""!(GMPQT)  D
"RTN","GMPL1",39,0)
 . . . I $P(GMPSYN(GMPTYP,GMPNUM),U)=GMPTXT S GMPSCTD=$P(GMPSYN(GMPTYP,GMPNUM),U,3),GMPQT=1 Q
"RTN","GMPL1",40,0)
 . . Q:GMPQT
"RTN","GMPL1",41,0)
 . . I $P(GMPSYN(GMPTYP),U)=GMPTXT S GMPSCTD=$P(GMPSYN(GMPTYP),U,3),GMPQT=1 Q
"RTN","GMPL1",42,0)
 N OK,GMPI,GMPFLD K GMPLJUMP,GMPSYN
"RTN","GMPL1",43,0)
 S GMPFLD(1.01)=GMPTERM,GMPFLD(.05)=U_GMPROB
"RTN","GMPL1",44,0)
 S GMPFLD(.01)=$P($$ICDDATA^ICDXCODE(GMPCSPTR,$P(GMPICD,"/"),DT,"E"),U)_U_GMPICD
"RTN","GMPL1",45,0)
 S GMPFLD(80202)=$$SAB^ICDEX(GMPCSPTR,DT)_U_$G(GMPCSNME)
"RTN","GMPL1",46,0)
 S:'GMPFLD(.01)!($P(GMPFLD(.01),U)<0) GMPFLD(.01)=$$NOS^GMPLX($P(GMPFLD(80202),U),DT) ; cannot resolve code
"RTN","GMPL1",47,0)
 S (GMPFLD(1.04),GMPFLD(1.05))=$G(GMPROV),GMPFLD(1.03)=DUZ
"RTN","GMPL1",48,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+GMPFLD(1.04)),GMPFLD(1.08)=$G(GMPCLIN)
"RTN","GMPL1",49,0)
 S (GMPFLD(.08),GMPFLD(80201),GMPFLD(1.09))=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPL1",50,0)
 S GMPFLD(.12)="A^ACTIVE",GMPFLD(1.14)="",GMPFLD(10,0)=0
"RTN","GMPL1",51,0)
 S GMPFLD(1.02)=$S('$G(GMPARAM("VER")):"P",$D(GMPLUSER):"P",1:"T")
"RTN","GMPL1",52,0)
 S (GMPFLD(.13),GMPFLD(1.07))="" ; initialize dates
"RTN","GMPL1",53,0)
 S GMPFLD(1.1)=$S('GMPSC:"0^NO",1:""),GMPFLD(1.11)=$S('GMPAGTOR:"0^NO",1:"")
"RTN","GMPL1",54,0)
 S GMPFLD(1.12)=$S('GMPION:"0^NO",1:""),GMPFLD(1.13)=$S('GMPGULF:"0^NO",1:"")
"RTN","GMPL1",55,0)
 S GMPFLD(80001)=GMPSCTC_U_GMPSCTC,GMPFLD(80002)=GMPSCTD_U_GMPSCTD
"RTN","GMPL1",56,0)
ADD2 ; prompt for values
"RTN","GMPL1",57,0)
 D FLDS^GMPLEDT3 ; set GMPFLD("FLD") of editable fields
"RTN","GMPL1",58,0)
 F GMPI=2:1:7 D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)  K GMPLJUMP ; cannot ^-jump here
"RTN","GMPL1",59,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",60,0)
ADD3 ; Ok to save?
"RTN","GMPL1",61,0)
 S OK=$$ACCEPT^GMPLDIS1(.GMPFLD),GMPLJUMP=0 ; ok to save values?
"RTN","GMPL1",62,0)
 I OK="^" W !!?10,"< Nothing Saved !! >",! S GMPQUIT=1 H 1 Q
"RTN","GMPL1",63,0)
 I OK D  Q  ; ck DA for error?
"RTN","GMPL1",64,0)
 . N I W !!,"Saving ..." D NEW^GMPLSAVE
"RTN","GMPL1",65,0)
 . S I=$S(GMPLIST(0)'>0:1,GMPARAM("REV"):$O(GMPLIST(0))-.01,1:GMPLIST(0)+1)
"RTN","GMPL1",66,0)
 . S GMPLIST(I)=DA,GMPLIST("B",DA)=I,GMPLIST(0)=$G(GMPLIST(0))+1
"RTN","GMPL1",67,0)
 . W " done."
"RTN","GMPL1",68,0)
 ; Not ok -- edit values, ask again
"RTN","GMPL1",69,0)
 F GMPI=1:1:GMPFLD("FLD",0) D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)!($D(GMPSAVED))  I $G(GMPLJUMP) S GMPI=GMPLJUMP-1 S GMPLJUMP=0 ; reset GMPI to desired fld
"RTN","GMPL1",70,0)
 Q:$D(DTOUT)  K GMPQUIT,DUOUT G ADD3
"RTN","GMPL1",71,0)
 Q
"RTN","GMPL1",72,0)
 ;
"RTN","GMPL1",73,0)
 ; *********************************************************************
"RTN","GMPL1",74,0)
 ; *  GMPIFN expected for the following calls:
"RTN","GMPL1",75,0)
 ;
"RTN","GMPL1",76,0)
STATUS ; -- inactivate problem
"RTN","GMPL1",77,0)
 N DIE,DA,DR,X,Y,CHNGE,GMPFLD,PROMPT,DEFAULT
"RTN","GMPL1",78,0)
 S GMPFLD(.13)=$P($G(^AUPNPROB(GMPIFN,0)),U,13) ; Onset
"RTN","GMPL1",79,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN) D RESOLVED^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",80,0)
 S PROMPT="COMMENT (<60 char): ",DEFAULT="" D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",81,0)
 W ! I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",82,0)
 S DIE="^AUPNPROB(",DR=".12///I;1.07////"_$P($G(GMPFLD(1.07)),U)
"RTN","GMPL1",83,0)
 S DA=GMPIFN D ^DIE W "."
"RTN","GMPL1",84,0)
 S CHNGE=GMPIFN_"^.12^"_$$HTFM^XLFDT($H)_U_DUZ_"^A^I^^"_+$G(GMPROV)
"RTN","GMPL1",85,0)
 D AUDIT^GMPLX(CHNGE,"") W "." ; audit trail
"RTN","GMPL1",86,0)
 D DTMOD^GMPLX(GMPIFN) W "." ; update Dt Last Mod
"RTN","GMPL1",87,0)
 W "... inactivated!",!
"RTN","GMPL1",88,0)
 H 1 S GMPSAVED=1
"RTN","GMPL1",89,0)
 Q
"RTN","GMPL1",90,0)
 ;
"RTN","GMPL1",91,0)
NEWNOTE ; -- add a new comment
"RTN","GMPL1",92,0)
 N GMPFLD
"RTN","GMPL1",93,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",94,0)
 D NOTE^GMPLEDT1 Q:$D(GMPQUIT)!($D(GMPFLD(10,"NEW"))'>9)
"RTN","GMPL1",95,0)
 D NEWNOTE^GMPLSAVE,DTMOD^GMPLX(GMPIFN)
"RTN","GMPL1",96,0)
 S GMPSAVED=1
"RTN","GMPL1",97,0)
 Q
"RTN","GMPL1",98,0)
 ;
"RTN","GMPL1",99,0)
DELETE ; -- delete a problem
"RTN","GMPL1",100,0)
 N PROMPT,DEFAULT,X,Y,CHNGE,GMPFLD
"RTN","GMPL1",101,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",102,0)
 S PROMPT="REASON FOR REMOVAL: ",DEFAULT=""
"RTN","GMPL1",103,0)
 D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)  W !
"RTN","GMPL1",104,0)
 I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",105,0)
 S CHNGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_"^P^H^Deleted^"_+$G(GMPROV)
"RTN","GMPL1",106,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="H",GMPSAVED=1 W "."
"RTN","GMPL1",107,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",108,0)
 W "... removed!",! H 1
"RTN","GMPL1",109,0)
 Q
"RTN","GMPL1",110,0)
 ;
"RTN","GMPL1",111,0)
VERIFY ; -- verify a transcribed problem, if parameter on
"RTN","GMPL1",112,0)
 N NOW,CHNGE S NOW=$$HTFM^XLFDT($H)
"RTN","GMPL1",113,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN),!
"RTN","GMPL1",114,0)
 I '$$CODESTS^GMPLX(GMPIFN,DT) W "has an inactive ICD code. Edit the problem before verification.",! H 2 Q
"RTN","GMPL1",115,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)'="T" W "does not require verification.",! H 2 Q
"RTN","GMPL1",116,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL1",117,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="P",GMPSAVED=1 W "."
"RTN","GMPL1",118,0)
 S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ W "."
"RTN","GMPL1",119,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",120,0)
 L -^AUPNPROB(GMPIFN,0) W " verified.",!
"RTN","GMPL1",121,0)
 Q
"RTN","GMPL1",122,0)
ICDMSG ; If Lexicon returns ICD code 799.9 or R69.
"RTN","GMPL1",123,0)
 N DIR,DTOUT,DUOUT,GMPLY,GMPROB,GMPCODE,GMPDESC,GMPIMPDT
"RTN","GMPL1",124,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D"),GMPCODE=$S(DT<GMPIMPDT:"799.9",1:"R69. ")
"RTN","GMPL1",125,0)
 S GMPDESC=$S(GMPCODE="799.9":"OTHER UNKNOWN AND UNSPECIFIED CAUSE OF MORBIDITY OR MORTALITY",1:"ILLNESS, UNSPECIFIED")
"RTN","GMPL1",126,0)
 S DIR(0)="YAO"
"RTN","GMPL1",127,0)
 S DIR("A",1)="<< If you PROCEED WITH THIS NON SPECIFIC TERM, an ICD CODE OF"_GMPCODE_" >>"
"RTN","GMPL1",128,0)
 I GMPCODE="799.9" D
"RTN","GMPL1",129,0)
 . S DIR("A",2)="<< "_GMPDESC_"    >>"
"RTN","GMPL1",130,0)
 . S DIR("A",3)="<< will be assigned.  Adding more specificity to your diagnosis may >>"
"RTN","GMPL1",131,0)
 . S DIR("A",4)="<< allow a more accurate ICD code.                                  >>"
"RTN","GMPL1",132,0)
 . S DIR("A",5)=""
"RTN","GMPL1",133,0)
 E  D
"RTN","GMPL1",134,0)
 . S DIR("A",2)="<< "_GMPDESC_" will be assigned.  Adding more specificity  >>"
"RTN","GMPL1",135,0)
 . S DIR("A",3)="<< to your diagnosis may allow a more accurate ICD code.            >>"
"RTN","GMPL1",136,0)
 . S DIR("A",4)=""
"RTN","GMPL1",137,0)
 S DIR("A")="Continue (YES/NO) ",DIR("B")="NO"
"RTN","GMPL1",138,0)
 S DIR("T")=DTIME
"RTN","GMPL1",139,0)
 D ^DIR
"RTN","GMPL1",140,0)
 I $D(DTOUT)!$D(DUOUT) S Y=0
"RTN","GMPL1",141,0)
 I +Y=0 S (GMPLY,GMPROB)=""
"RTN","GMPL1",142,0)
 Q
"RTN","GMPLBLDC")
0^21^B77042279
"RTN","GMPLBLDC",1,0)
GMPLBLDC ; SLC/MKB,TC -- Build Problem Selection Categories ;04/22/15  13:08
"RTN","GMPLBLDC",2,0)
 ;;2.0;Problem List;**3,7,28,36,42,45**;Aug 25, 1994;Build 53
"RTN","GMPLBLDC",3,0)
 ;
"RTN","GMPLBLDC",4,0)
 ; This routine invokes ICR #5699, #5747
"RTN","GMPLBLDC",5,0)
 ;
"RTN","GMPLBLDC",6,0)
EN ; -- main entry point for GMPL SELECTION GROUP BUILD
"RTN","GMPLBLDC",7,0)
 D EN^VALM("GMPL SELECTION GROUP BUILD")
"RTN","GMPLBLDC",8,0)
 Q
"RTN","GMPLBLDC",9,0)
 ;
"RTN","GMPLBLDC",10,0)
HDR ; -- header code
"RTN","GMPLBLDC",11,0)
 N NAME,NUM,DATE S NUM=+^TMP("GMPLST",$J,0)_" problem"_$S(+^TMP("GMPLST",$J,0)'=1:"s",1:"")
"RTN","GMPLBLDC",12,0)
 S DATE="Last Modified: "_$S(+$P(GMPLGRP,U,3):$$FMTE^XLFDT($P(GMPLGRP,U,3)),1:"<new category>")
"RTN","GMPLBLDC",13,0)
 S VALMHDR(1)=DATE_$J(NUM,79-$L(DATE))
"RTN","GMPLBLDC",14,0)
 S NAME=$P(GMPLGRP,U,2),VALMHDR(2)=$J(NAME,$L(NAME)\2+41)
"RTN","GMPLBLDC",15,0)
 Q
"RTN","GMPLBLDC",16,0)
 ;
"RTN","GMPLBLDC",17,0)
INIT ; -- init variables and list array
"RTN","GMPLBLDC",18,0)
 S GMPLGRP=$$GROUP^GMPLBLD2("L") I GMPLGRP="^" S VALMQUIT=1 Q
"RTN","GMPLBLDC",19,0)
 L +^GMPL(125.11,+GMPLGRP,0):1 I '$T D  G INIT
"RTN","GMPLBLDC",20,0)
 . W $C(7),!!,"This category is currently being edited by another user!",!
"RTN","GMPLBLDC",21,0)
 S GMPLMODE="E",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",22,0)
 D GETLIST,BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",23,0)
 Q
"RTN","GMPLBLDC",24,0)
 ;
"RTN","GMPLBLDC",25,0)
GETLIST ; Build ^TMP("GMPLIST",$J,#) of problems
"RTN","GMPLBLDC",26,0)
 N SEQ,IFN,ITEM,PROB,CNT K ^TMP("GMPLIST",$J) S CNT=0
"RTN","GMPLBLDC",27,0)
 W !,"Searching for the problems ..."
"RTN","GMPLBLDC",28,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.12,"B",+GMPLGRP,IFN)) Q:IFN'>0  D
"RTN","GMPLBLDC",29,0)
 . S ITEM=$G(^GMPL(125.12,IFN,0)),SEQ=$P(ITEM,U,2),PROB=$P(ITEM,U,3)
"RTN","GMPLBLDC",30,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(ITEM,U,2,7),CNT=CNT+1 ; seq ^ prob ^ text ^ code ^ snomed ct concept ^ snomed ct designation
"RTN","GMPLBLDC",31,0)
 . S (^TMP("GMPLIST",$J,"PROB",PROB),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN ; Xrefs
"RTN","GMPLBLDC",32,0)
 S ^TMP("GMPLIST",$J,0)=CNT
"RTN","GMPLBLDC",33,0)
 Q
"RTN","GMPLBLDC",34,0)
 ;
"RTN","GMPLBLDC",35,0)
BUILD(LIST,MODE) ; Build ^TMP("GMPLST",$J,) of current items in LIST for display
"RTN","GMPLBLDC",36,0)
 N SEQ,LCNT,NUM,PROB,TEXT,IFN,ITEM,CODE D CLEAN^VALM10
"RTN","GMPLBLDC",37,0)
 I $P($G(^TMP("GMPLIST",$J,0)),U,1)'>0 S ^TMP("GMPLST",$J,1,0)="   ",^TMP("GMPLST",$J,2,0)="No items available.",^TMP("GMPLST",$J,0)="0^2",VALMCNT=2 Q
"RTN","GMPLBLDC",38,0)
 S (LCNT,NUM,SEQ)=0
"RTN","GMPLBLDC",39,0)
 F  S SEQ=$O(^TMP("GMPLIST",$J,"SEQ",SEQ)) Q:SEQ'>0  D
"RTN","GMPLBLDC",40,0)
 . N GMI,GMPLCSYS,GMPLCPTR
"RTN","GMPLBLDC",41,0)
 . S IFN=^TMP("GMPLIST",$J,"SEQ",SEQ),LCNT=LCNT+1,NUM=NUM+1
"RTN","GMPLBLDC",42,0)
 . S PROB=$P(^TMP("GMPLIST",$J,IFN),U,2),TEXT=$P(^TMP("GMPLIST",$J,IFN),U,3),CODE=$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLDC",43,0)
 . S ^TMP("GMPLST",$J,LCNT,0)=$S(MODE="I":$J("<"_SEQ_">",8),1:"        ")_$J(NUM,4)_" "_TEXT
"RTN","GMPLBLDC",44,0)
 . I $L(CODE) D
"RTN","GMPLBLDC",45,0)
 .. S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_" ("_$P($$CODECS^ICDEX($P(CODE,"/"),80,DT),U,2)_" "_CODE_")"
"RTN","GMPLBLDC",46,0)
 .. F GMI=1:1:$L(CODE,"/") D
"RTN","GMPLBLDC",47,0)
 ... N GMPLCPTR S GMPLCPTR=$P($$CODECS^ICDEX($P(CODE,"/",GMI),80,DT),U)
"RTN","GMPLBLDC",48,0)
 ... I $$STATCHK^ICDXCODE(GMPLCPTR,$P(CODE,"/",GMI),DT) Q  ; OK - code is active
"RTN","GMPLBLDC",49,0)
 ... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_"     <INACTIVE CODE>"
"RTN","GMPLBLDC",50,0)
 . D CNTRL^VALM10(LCNT,9,5,IOINHI,IOINORM)
"RTN","GMPLBLDC",51,0)
 . S ^TMP("GMPLST",$J,"B",NUM)=IFN
"RTN","GMPLBLDC",52,0)
 S ^TMP("GMPLST",$J,0)=NUM_U_LCNT,VALMCNT=LCNT
"RTN","GMPLBLDC",53,0)
 Q
"RTN","GMPLBLDC",54,0)
 ;
"RTN","GMPLBLDC",55,0)
HELP ; -- help code
"RTN","GMPLBLDC",56,0)
 N X
"RTN","GMPLBLDC",57,0)
 W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLBLDC",58,0)
 W !?4,"this category you may add new problems or remove an existing"
"RTN","GMPLBLDC",59,0)
 W !?4,"one; you may also change the text or code displayed, or the order"
"RTN","GMPLBLDC",60,0)
 W !?4,"in which each problem is displayed.  Select View w/wo Seq Numbers"
"RTN","GMPLBLDC",61,0)
 W !?4,"to toggle seeing the sequence number in addition to the display"
"RTN","GMPLBLDC",62,0)
 W !?4,"number per problem.  If necessary, the current category may be"
"RTN","GMPLBLDC",63,0)
 W !?4,"deleted; you may change to a different category to continue editing."
"RTN","GMPLBLDC",64,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMPLBLDC",65,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLDC",66,0)
 Q
"RTN","GMPLBLDC",67,0)
 ;
"RTN","GMPLBLDC",68,0)
EXIT ; -- exit code
"RTN","GMPLBLDC",69,0)
 I $D(GMPLSAVE),$$CKSAVE^GMPLBLD2 D
"RTN","GMPLBLDC",70,0)
 . D SAVE^GMPLBLD2
"RTN","GMPLBLDC",71,0)
 . S ^GMPL(125.11,+GMPLGRP,0)=$P(GMPLGRP,U,2)_U_DT
"RTN","GMPLBLDC",72,0)
 L -^GMPL(125.11,+GMPLGRP,0)
"RTN","GMPLBLDC",73,0)
 K GMPLIST,GMPLST,GMPLMODE,GMPLGRP,GMPLSAVE,GMPREBLD,GMPQUIT,RT1,TMPITEM
"RTN","GMPLBLDC",74,0)
 K VALMBCK,VALMCNT,VALMSG,VALMHDR
"RTN","GMPLBLDC",75,0)
 K ^TMP("GMPLIST",$J),^TMP("GMPLST",$J)
"RTN","GMPLBLDC",76,0)
 Q
"RTN","GMPLBLDC",77,0)
 ;
"RTN","GMPLBLDC",78,0)
ADD ; Add new problem(s)
"RTN","GMPLBLDC",79,0)
 N GMPVOCAB,GMPQUIT,GMPREBLD,GMPIMPDT S VALMBCK="" D FULL^VALM1
"RTN","GMPLBLDC",80,0)
 S GMPVOCAB="" ; $$VOCAB^GMPLX1 Q:GMPVOCAB="^"
"RTN","GMPLBLDC",81,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLBLDC",82,0)
 F  D  Q:$D(GMPQUIT)  W !!
"RTN","GMPLBLDC",83,0)
ASKAG . N X,Y,SEQ,CODE,IFN,SCTT,SCTC,SCTD,DUP,TERM,ICD,GMPTYP,GMPNUM,GMPQT,GMPSYN
"RTN","GMPLBLDC",84,0)
 . S (X,Y,SCTT,SCTC,SCTD,GMPTYP,GMPNUM,GMPQT)="" D SEARCH^GMPLX(.X,.Y,"PROBLEM: ","1",GMPVOCAB)
"RTN","GMPLBLDC",85,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPLBLDC",86,0)
 . S DUP=$$DUPL(.Y,X)
"RTN","GMPLBLDC",87,0)
 . I DUP S (Y,GMPROB)="" W !,X,!,"is already on the selection list.  Please enter another search term to add." G ASKAG
"RTN","GMPLBLDC",88,0)
 . S TERM=$S(+$G(Y)>1:Y,1:""),ICD=$G(Y(1))
"RTN","GMPLBLDC",89,0)
 . S:'$L(ICD) ICD=$S(DT<GMPIMPDT:"799.9",1:"R69.")
"RTN","GMPLBLDC",90,0)
 . N I,GMPSTAT,GMPCSREC,GMPCSPTR,GMPCSNME,GMPSCTC,GMPSCTD,GMPTXT
"RTN","GMPLBLDC",91,0)
 . I ICD["/" F I=1:1:$L(ICD,"/") D  Q:GMPSTAT
"RTN","GMPLBLDC",92,0)
 . . N GMPCODE S GMPCODE=$P(ICD,"/",I),GMPSTAT=0
"RTN","GMPLBLDC",93,0)
 . . S GMPCSREC=$$CODECS^ICDEX(GMPCODE,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLBLDC",94,0)
 . . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPCODE,DT) GMPSTAT=1
"RTN","GMPLBLDC",95,0)
 . E  D
"RTN","GMPLBLDC",96,0)
 . . S GMPSTAT=0,GMPCSREC=$$CODECS^ICDEX(ICD,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLBLDC",97,0)
 . . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,ICD,DT) GMPSTAT=1
"RTN","GMPLBLDC",98,0)
 . I GMPSTAT W !,X,!,"has an inactive ICD code.  Please enter another search term to add." G ASKAG
"RTN","GMPLBLDC",99,0)
 . I X["(SCT" D
"RTN","GMPLBLDC",100,0)
 . . S SCTT=$P(X," (SCT ")
"RTN","GMPLBLDC",101,0)
 . . S SCTC=$$ONE^LEXU(+TERM,DT,"SCT")
"RTN","GMPLBLDC",102,0)
 . . S SCTD=$$GETSYN^LEXTRAN1("SCT",SCTC,DT,"GMPSYN",1,1)
"RTN","GMPLBLDC",103,0)
 . . I $P(SCTD,U)'=1 S SCTD="" Q
"RTN","GMPLBLDC",104,0)
 . . F  S GMPTYP=$O(GMPSYN(GMPTYP)) Q:GMPTYP=""!(GMPQT)  D
"RTN","GMPLBLDC",105,0)
 . . . I GMPTYP="S" F  S GMPNUM=$O(GMPSYN(GMPTYP,GMPNUM)) Q:GMPNUM=""!(GMPQT)  D
"RTN","GMPLBLDC",106,0)
 . . . . I $P(GMPSYN(GMPTYP,GMPNUM),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP,GMPNUM),U,3),GMPQT=1 Q
"RTN","GMPLBLDC",107,0)
 . . . Q:GMPQT
"RTN","GMPLBLDC",108,0)
 . . . I $P(GMPSYN(GMPTYP),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP),U,3),GMPQT=1 Q
"RTN","GMPLBLDC",109,0)
 . S X=$$TEXT^GMPLBLD1(X) I X="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",110,0)
 . S CODE=$$CODE^GMPLBLD1($G(SCTC),$G(Y(1))) I CODE']"" S GMPQUIT=1 Q
"RTN","GMPLBLDC",111,0)
 . S RT1="^TMP(""GMPLIST"",$J,""SEQ"",",SEQ=+$$LAST^GMPLBLD2(RT1)+1 ; dflt = next #
"RTN","GMPLBLDC",112,0)
 . S SEQ=$$SEQ^GMPLBLD1(SEQ) I SEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",113,0)
 . S IFN=$$TMPIFN^GMPLBLD1,^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)+1
"RTN","GMPLBLDC",114,0)
 . S ^TMP("GMPLIST",$J,IFN)=SEQ_U_+Y_U_X_U_CODE_U_SCTC_U_SCTD ; seq ^ # ^ text ^ code ^ snomed ct concept ^ snomed ct designation
"RTN","GMPLBLDC",115,0)
 . S (^TMP("GMPLIST",$J,"PROB",+Y),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN,GMPREBLD=1
"RTN","GMPLBLDC",116,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",117,0)
 S VALMBCK="R" S VALMSG=$$MSG^GMPLX K GMPSYN
"RTN","GMPLBLDC",118,0)
 Q
"RTN","GMPLBLDC",119,0)
 ;
"RTN","GMPLBLDC",120,0)
REMOVE ; Remove problem from group
"RTN","GMPLBLDC",121,0)
 N NUM,IFN S VALMBCK=""
"RTN","GMPLBLDC",122,0)
 S NUM=$$SEL1^GMPLBLD1 G:NUM="^" RMQ
"RTN","GMPLBLDC",123,0)
 S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) G:+IFN'>0 RMQ
"RTN","GMPLBLDC",124,0)
 I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem does not exist in this category!" H 2 G RMQ
"RTN","GMPLBLDC",125,0)
 I '$$SURE^GMPLX W !?5,"< Nothing removed! >" H 1 G RMQ
"RTN","GMPLBLDC",126,0)
 D DELETE^GMPLBLD1(IFN) S VALMBCK="R",GMPLSAVE=1
"RTN","GMPLBLDC",127,0)
 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",128,0)
RMQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",129,0)
 Q
"RTN","GMPLBLDC",130,0)
 ;
"RTN","GMPLBLDC",131,0)
EDIT ; Edit problem text and code
"RTN","GMPLBLDC",132,0)
 N NUM,SEL,IFN,PIECE,CODE,PROB,PROBLEM,GMPQUIT,GMPREBLD S VALMBCK="" D FULL^VALM1
"RTN","GMPLBLDC",133,0)
 S SEL=$$SEL^GMPLBLD1 G:SEL="^" EDQ
"RTN","GMPLBLDC",134,0)
 F PIECE=1:1:$L(SEL,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLDC",135,0)
 . S NUM=$P(SEL,",",PIECE) Q:NUM'>0
"RTN","GMPLBLDC",136,0)
 . S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:IFN'>0
"RTN","GMPLBLDC",137,0)
 . I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem #"_NUM_" does not exist in this category!" H 2 Q
"RTN","GMPLBLDC",138,0)
 . W !!,">>>  Problem #"_NUM S PROBLEM=^TMP("GMPLIST",$J,IFN)
"RTN","GMPLBLDC",139,0)
 . W:$P(PROBLEM,U,2)>1 " = "_$G(^LEX(757.01,+$P(PROBLEM,U,2),0)) W ! ; KER
"RTN","GMPLBLDC",140,0)
 . S PROB=$$TEXT^GMPLBLD1($P(PROBLEM,U,3)) I PROB="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",141,0)
 . I PROB="@" D DELETE^GMPLBLD1(IFN) S GMPREBLD=1 Q
"RTN","GMPLBLDC",142,0)
 . S CODE=$$CODE^GMPLBLD1($P(PROBLEM,U,5),$P(PROBLEM,U,4)) I CODE="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",143,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(PROBLEM,U,1,2)_U_PROB_U_CODE_U_$P(PROBLEM,U,5,6),GMPREBLD=1
"RTN","GMPLBLDC",144,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",145,0)
EDQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",146,0)
 Q
"RTN","GMPLBLDC",147,0)
 ;
"RTN","GMPLBLDC",148,0)
DUPL(Y,TEXT) ; Check for Duplicates within problem selection list category
"RTN","GMPLBLDC",149,0)
 N DA,IFN,GMPOTHR,GMPNOW,GMPSRC,GMPCODE,SCTCNEW,ICDNEW,PICDNEW
"RTN","GMPLBLDC",150,0)
 S DA=0
"RTN","GMPLBLDC",151,0)
 I '$D(^TMP("GMPLIST")) G DUPLX
"RTN","GMPLBLDC",152,0)
 S GMPNOW=$E($$NOW^XLFDT,1,7)
"RTN","GMPLBLDC",153,0)
 S GMPOTHR=$S(GMPNOW<($$IMPDATE^LEXU("10D")):"799.9",1:"R69.")
"RTN","GMPLBLDC",154,0)
 D EXP2CODE^GMPLX(+Y,.GMPSRC,.GMPCODE)
"RTN","GMPLBLDC",155,0)
 S SCTCNEW=$S(GMPSRC="SNOMED CT"&($D(GMPCODE)):GMPCODE,1:$P($P(TEXT," (SCT ",2),")"))
"RTN","GMPLBLDC",156,0)
 S ICDNEW=$S(GMPSRC="SNOMED CT":$G(Y(1)),1:GMPCODE),PICDNEW=$P(ICDNEW,"/")
"RTN","GMPLBLDC",157,0)
 S IFN=""
"RTN","GMPLBLDC",158,0)
 F  S IFN=$O(^TMP("GMPLIST",$J,IFN)) Q:IFN=""  D  Q:DA>0
"RTN","GMPLBLDC",159,0)
 .N PICDEXT,ICDEXT,SLST,SCTCEXT,TERMEXT,EXPTXT
"RTN","GMPLBLDC",160,0)
 .S SLST=$G(^TMP("GMPLIST",$J,IFN)),SCTCEXT=$P(SLST,U,5)
"RTN","GMPLBLDC",161,0)
 .S ICDEXT=$P(SLST,U,4),PICDEXT=$P(ICDEXT,"/")
"RTN","GMPLBLDC",162,0)
 .S TERMEXT=$P(SLST,U,2)
"RTN","GMPLBLDC",163,0)
 .;Compare problems with SNOMED CT concept codes & ICD code(s) only
"RTN","GMPLBLDC",164,0)
 .I $L(SCTCEXT),(GMPSRC="SNOMED CT"),($G(SCTCNEW)>0),($L(ICDNEW)) D
"RTN","GMPLBLDC",165,0)
 ..;if SCT concepts & primary + multiple ICD targets match => dup
"RTN","GMPLBLDC",166,0)
 ..I ICDEXT["/",ICDNEW["/" D
"RTN","GMPLBLDC",167,0)
 ...N I,J,SICDEXT S J=0 F I=2:1:$L(ICDEXT,"/") D
"RTN","GMPLBLDC",168,0)
 ....S J=J+1,SICDEXT(J)=$P(ICDEXT,"/",I)
"RTN","GMPLBLDC",169,0)
 ...N K,L,SICDNEW S L=0 F K=2:1:$L(ICDNEW,"/") D
"RTN","GMPLBLDC",170,0)
 ....S L=L+1,SICDNEW(L)=$P(ICDNEW,"/",K)
"RTN","GMPLBLDC",171,0)
 ...N T F T=1:1:L D
"RTN","GMPLBLDC",172,0)
 ....I SCTCEXT=SCTCNEW,(PICDEXT=PICDNEW),SICDEXT(T)=SICDNEW(T) S DA=IFN Q
"RTN","GMPLBLDC",173,0)
 ..;if SCT concept codes match => dup
"RTN","GMPLBLDC",174,0)
 ..E  I ICDNEW=GMPOTHR!(PICDNEW=GMPOTHR) D
"RTN","GMPLBLDC",175,0)
 ...I SCTCEXT=SCTCNEW S DA=IFN Q
"RTN","GMPLBLDC",176,0)
 ..;if SCT concepts & primary ICD diagnosis match => dup
"RTN","GMPLBLDC",177,0)
 ..E  I SCTCEXT=SCTCNEW,(PICDEXT=PICDNEW) S DA=IFN Q
"RTN","GMPLBLDC",178,0)
 .;Compare legacy problems with ICD codes only
"RTN","GMPLBLDC",179,0)
 .E  I $L(ICDEXT),'$L(SCTCEXT),(GMPSRC["ICD"),(+$G(ICDNEW)>0) D
"RTN","GMPLBLDC",180,0)
 ..;if Exprs match => dup
"RTN","GMPLBLDC",181,0)
 ..I +Y>1&(TERMEXT=+Y) S DA=IFN Q
"RTN","GMPLBLDC",182,0)
 ..;if Text matches Expr from old => dup
"RTN","GMPLBLDC",183,0)
 ..D LOOK^LEXA("`"_TERMEXT)
"RTN","GMPLBLDC",184,0)
 ..S EXPTXT=$P($G(LEX("LIST",1)),U,2)
"RTN","GMPLBLDC",185,0)
 ..S TEXT=$$UP^XLFSTR($P(TEXT," (ICD"))
"RTN","GMPLBLDC",186,0)
 ..I LEX>1&(TEXT=$$UP^XLFSTR($S(EXPTXT["*":$P(EXPTXT," *"),1:EXPTXT))) S DA=IFN Q
"RTN","GMPLBLDC",187,0)
 ..;if prim ICD of new = prim ICD of old => dup
"RTN","GMPLBLDC",188,0)
 ..I PICDEXT'=GMPOTHR,(PICDNEW'=GMPOTHR),(PICDEXT=PICDNEW) S DA=IFN Q
"RTN","GMPLBLDC",189,0)
DUPLX Q DA
"RTN","GMPLDISP")
0^18^B53108852
"RTN","GMPLDISP",1,0)
GMPLDISP ; ISL/MKB,JER,TC - Problem List detailed display ;08/26/14  11:57
"RTN","GMPLDISP",2,0)
 ;;2.0;Problem List;**21,26,35,36,42,45**;Aug 25, 1994;Build 53
"RTN","GMPLDISP",3,0)
 ;
"RTN","GMPLDISP",4,0)
 ; External References
"RTN","GMPLDISP",5,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLDISP",6,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLDISP",7,0)
 ;   ICR   5747  $$CSI/SAB/CODECS^ICDEX
"RTN","GMPLDISP",8,0)
 ;   DBIA 10040  ^SC(  file 44
"RTN","GMPLDISP",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLDISP",10,0)
 ;   DBIA 10116  $$SETSTR^VALM1
"RTN","GMPLDISP",11,0)
 ;   DBIA 10117  CLEAN^VALM10
"RTN","GMPLDISP",12,0)
 ;   DBIA 10117  CNTRL^VALM10
"RTN","GMPLDISP",13,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLDISP",14,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLDISP",15,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLDISP",16,0)
 ;
"RTN","GMPLDISP",17,0)
EN ; Init Variables (need GMPLSEL,GMPLNO) and List Array
"RTN","GMPLDISP",18,0)
 G:'$D(GMPLSEL) ERROR G:'$G(GMPLNO) ERROR
"RTN","GMPLDISP",19,0)
 S GMPI=+$G(GMPI)+1 I GMPI>GMPLNO D  Q
"RTN","GMPLDISP",20,0)
 . W !!,"There are no more problems that have been selected to view!",! S VALMBCK="" H 2
"RTN","GMPLDISP",21,0)
 S GMPLNUM=$P(GMPLSEL,",",GMPI) G:GMPLNUM'>0 ERROR
"RTN","GMPLDISP",22,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 ERROR
"RTN","GMPLDISP",23,0)
 W !!,"Retrieving current data for problem #"_GMPLNUM_" ...",!
"RTN","GMPLDISP",24,0)
 ;
"RTN","GMPLDISP",25,0)
PROB ; Display problem GMPIFN
"RTN","GMPLDISP",26,0)
 N LINE,STR,I,J,L,TEXT,NOTE,GMPLDT,GMPL0,GMPL1,GMPL800,GMPL803,X,Y,IDT,FAC,AIFN,SP,LCNT
"RTN","GMPLDISP",27,0)
 N NIFN,SCTC,SCTD,SCTT,PROVNAR,ICDDESC,DESCR,ICD,PNTXT,GMPLCSYS,GMICDLBL,GMPL802,GMPLNTDT,GMPLATHR,GMPLTEXT
"RTN","GMPLDISP",28,0)
 K ^TMP("GMPLCMT",$J)
"RTN","GMPLDISP",29,0)
 G:'$G(GMPIFN) ERROR D CLEAN^VALM10
"RTN","GMPLDISP",30,0)
 S GMPL0=$G(^AUPNPROB(GMPIFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),GMPL803=$G(^(803,0)),LCNT=1,SP=""
"RTN","GMPLDISP",31,0)
 S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),+$P(GMPL1,U,9):$P(GMPL1,U,9),+$P(GMPL0,U,8):$P(GMPL0,U,8),1:DT)
"RTN","GMPLDISP",32,0)
 S GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLDISP",33,0)
 F I=11,12,13,15,16,17,18 S:+$P(GMPL1,U,I) SP=SP_$S(I=11:"AGENT ORANGE",I=12:"RADIATION",I=13:"ENV CONTAMINANTS",I=15:"HEAD/NECK CANCER",I=16:"MIL SEXUAL TRAUMA",I=17:"COMBAT VET",1:"SHAD")_U
"RTN","GMPLDISP",34,0)
 F  Q:$E(SP,$L(SP))'="^"  S SP=$E(SP,1,($L(SP)-1))
"RTN","GMPLDISP",35,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2)  ;ICD=ICD-9/10-CM Code
"RTN","GMPLDISP",36,0)
 S GMICDLBL=$P($$CODECS^ICDEX(ICD,80,GMPLDT),U,2)
"RTN","GMPLDISP",37,0)
 S PROVNAR=$$PROBTEXT^GMPLX(GMPIFN)  ;PROVNAR=Provider Narrative
"RTN","GMPLDISP",38,0)
 S ICDDESC=$$ICDDESC^GMPLUTL2($G(ICD),GMPLDT,GMPLCSYS)  ;ICDDESC=ICD Description
"RTN","GMPLDISP",39,0)
 S SCTC=$P(GMPL800,U),SCTD=$P(GMPL800,U,2)  ;SCTC=SNOMED-CT Concept Code,SCTD=SNOMED-CT Designation Code
"RTN","GMPLDISP",40,0)
 S:(PROVNAR["SCT") PNTXT=$P(PROVNAR," (SCT")
"RTN","GMPLDISP",41,0)
 D WRAP^GMPLX($G(PROVNAR),65,.TEXT)
"RTN","GMPLDISP",42,0)
 I TEXT=1 S GMPDT(LCNT,0)="  Problem: "_TEXT(1)
"RTN","GMPLDISP",43,0)
 E  I TEXT>1 D
"RTN","GMPLDISP",44,0)
 . S GMPDT(LCNT,0)="  Problem: "_TEXT(1)
"RTN","GMPLDISP",45,0)
 . F I=2:1:TEXT S LCNT=LCNT+1,GMPDT(LCNT,0)=$S($L($G(SCTC))!$L($G(SCTD)):"           ",1:"               ")_TEXT(I)
"RTN","GMPLDISP",46,0)
 I $L($G(SCTC)) S SCTT=$P($$SCTTEXT^GMPLUTL2(SCTC,$P(GMPL0,U,8),"SCT"),U)  ;SCTT=SNOMED-CT Preferred Text
"RTN","GMPLDISP",47,0)
 I $L($G(SCTC))!$L($G(SCTD)) D
"RTN","GMPLDISP",48,0)
 . I ($L($G(SCTT))>0)&(PNTXT'=$G(SCTT)) D
"RTN","GMPLDISP",49,0)
 . . D WRAP^GMPLX($G(SCTT),65,.SCTTTXT) S LCNT=LCNT+1,GMPDT(LCNT,0)="SNOMED-CT: "_SCTTTXT(1)
"RTN","GMPLDISP",50,0)
 . . I SCTTTXT>1 F L=2:1:SCTTTXT S LCNT=LCNT+1,GMPDT(LCNT,0)="           "_SCTTTXT(L)
"RTN","GMPLDISP",51,0)
 . I $L($G(ICD)) S LCNT=LCNT+1,GMPDT(LCNT,0)=$S(GMPLCSYS="ICD":" ",1:"")_$G(GMICDLBL)_": "_$G(ICD)_" ["_$G(ICDDESC)_"]"
"RTN","GMPLDISP",52,0)
 E  D
"RTN","GMPLDISP",53,0)
 . D WRAP^GMPLX($G(ICDDESC),65,.DESCR) S LCNT=LCNT+1,GMPDT(LCNT,0)=$G(GMICDLBL)_" TEXT: "_DESCR(1)
"RTN","GMPLDISP",54,0)
 . I DESCR>1 F J=2:1:DESCR S LCNT=LCNT+1,GMPDT(LCNT,0)="               "_DESCR(J)
"RTN","GMPLDISP",55,0)
 I $L($G(GMPL803))>0 D
"RTN","GMPLDISP",56,0)
 . N DA S DA=0 F  S DA=$O(^AUPNPROB(GMPIFN,803,DA)) Q:'+DA  D
"RTN","GMPLDISP",57,0)
 . . N ICDN,ICDNDX,ICDNDT,ICDNCSYS S ICDN=$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U),ICDNDT=$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,3)
"RTN","GMPLDISP",58,0)
 . . S ICDNCSYS=$S($P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,2)="ICD9":"ICD",1:$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,2))
"RTN","GMPLDISP",59,0)
 . . S ICDNDX=$$ICDDESC^GMPLUTL2($G(ICDN),$G(ICDNDT),$G(ICDNCSYS))
"RTN","GMPLDISP",60,0)
 . . S LCNT=LCNT+1,GMPDT(LCNT,0)="         : "_$G(ICDN)_$$PAD^GMPLX(ICDN,6)_" ["_$G(ICDNDX)_"]"
"RTN","GMPLDISP",61,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",62,0)
PR1 ; Onset
"RTN","GMPLDISP",63,0)
 ;   SC Condition
"RTN","GMPLDISP",64,0)
 ;   Status
"RTN","GMPLDISP",65,0)
 ;   Exposure
"RTN","GMPLDISP",66,0)
 ;   Provider
"RTN","GMPLDISP",67,0)
 ;   Service/Clinic
"RTN","GMPLDISP",68,0)
 S LINE="    Onset: "_$S($P(GMPL0,U,13):$$EXTDT^GMPLX($P(GMPL0,U,13)),1:"date unknown"),STR=""
"RTN","GMPLDISP",69,0)
 S:GMPVA STR="SC Condition: "_$S(+$P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"unknown")
"RTN","GMPLDISP",70,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",71,0)
 S X=$P(GMPL0,U,12),LINE="   Status: "_$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLDISP",72,0)
 I X="A",$L($P(GMPL1,U,14)) S LINE=LINE_"/"_$S($P(GMPL1,U,14)="A":"ACUTE",1:"CHRONIC")
"RTN","GMPLDISP",73,0)
 I X="I",$P(GMPL1,U,7) S LINE=LINE_", Resolved "_$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLDISP",74,0)
 S STR="",LCNT=LCNT+1
"RTN","GMPLDISP",75,0)
 S:GMPVA STR="    Exposure: "_$S('$L(SP):"none",1:$P(SP,U))
"RTN","GMPLDISP",76,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",77,0)
 S LINE=" Provider: "_$P($G(^VA(200,+$P(GMPL1,U,5),0)),U),LCNT=LCNT+1,STR=""
"RTN","GMPLDISP",78,0)
 I GMPVA,$L(SP,U)>1 S STR=$P(SP,U,2)
"RTN","GMPLDISP",79,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",80,0)
 I $E(GMPLVIEW("VIEW"))="S" S LINE="  Service: "_$P($G(^DIC(49,+$P(GMPL1,U,6),0)),U)
"RTN","GMPLDISP",81,0)
 E  S LINE="   Clinic: "_$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLDISP",82,0)
 S LCNT=LCNT+1,STR="" I GMPVA,$L(SP,U)>2 S STR=$P(SP,U,3)
"RTN","GMPLDISP",83,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",84,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",85,0)
PR2 ; Recorded
"RTN","GMPLDISP",86,0)
 ;   Entered
"RTN","GMPLDISP",87,0)
 S LINE=" Recorded: "_$S($P(GMPL1,U,9):$$EXTDT^GMPLX($P(GMPL1,U,9)),1:"date unknown")
"RTN","GMPLDISP",88,0)
 S:$P(GMPL1,U,4) LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLDISP",89,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",90,0)
 S LINE="  Entered: "_$$EXTDT^GMPLX($P(GMPL0,U,8))
"RTN","GMPLDISP",91,0)
 S LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U),LCNT=LCNT+1
"RTN","GMPLDISP",92,0)
 S:GMPARAM("VER")&($P(GMPL1,U,2)="T") LINE=LINE_"  <unconfirmed>"
"RTN","GMPLDISP",93,0)
 S GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",94,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",95,0)
PR3 ; Comments
"RTN","GMPLDISP",96,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="Comments:"
"RTN","GMPLDISP",97,0)
 D CNTRL^VALM10(LCNT,1,8,IOUON,IOUOFF)
"RTN","GMPLDISP",98,0)
 ;     By Facility
"RTN","GMPLDISP",99,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(GMPIFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLDISP",100,0)
 . I 'FAC S LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>" G PR4
"RTN","GMPLDISP",101,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(GMPIFN,11,FAC,11,NIFN)) Q:+NIFN'>0  D
"RTN","GMPLDISP",102,0)
 . . S NOTE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)) Q:NOTE=""
"RTN","GMPLDISP",103,0)
 . . S GMPLNTDT=$P(NOTE,U,5),GMPLATHR=$P(NOTE,U,6),GMPLTEXT=$P(NOTE,U,3)
"RTN","GMPLDISP",104,0)
 . . I $L(NOTE) S ^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)=$$EXTDT^GMPLX(GMPLNTDT)_U_$P($G(^VA(200,+GMPLATHR,0)),U)_U_GMPLTEXT
"RTN","GMPLDISP",105,0)
 S (GMPLNTDT,NIFN)=""
"RTN","GMPLDISP",106,0)
 F  S GMPLNTDT=$O(^TMP("GMPLCMT",$J,GMPLNTDT),-1) Q:GMPLNTDT=""  D
"RTN","GMPLDISP",107,0)
 . F  S NIFN=$O(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN),-1) Q:NIFN=""  D
"RTN","GMPLDISP",108,0)
 . . S LINE=$J($P($G(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)),U,1),10)_": "_$P($G(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)),U,3)
"RTN","GMPLDISP",109,0)
 . . S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",110,0)
 . . I $L($G(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN))) S LINE="            "_$P($G(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)),U,2),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",111,0)
 S:'($G(NOTE)) LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>"
"RTN","GMPLDISP",112,0)
 K ^TMP("GMPLCMT",$J)
"RTN","GMPLDISP",113,0)
PR4 ; Audit Trail
"RTN","GMPLDISP",114,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",115,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="History:"
"RTN","GMPLDISP",116,0)
 D CNTRL^VALM10(LCNT,1,7,IOUON,IOUOFF)
"RTN","GMPLDISP",117,0)
 I '$D(^GMPL(125.8,"B",GMPIFN)) S LCNT=LCNT+1,GMPDT(LCNT,0)="   <No changes>" G PRQ
"RTN","GMPLDISP",118,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",GMPIFN,IDT)) Q:IDT'>0  D
"RTN","GMPLDISP",119,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",GMPIFN,IDT,AIFN)) Q:AIFN'>0  D
"RTN","GMPLDISP",120,0)
 . . N FLD,GMPL0 S GMPL0=^GMPL(125.8,AIFN,0),FLD=$P(GMPL0,U,2)
"RTN","GMPLDISP",121,0)
 . . Q:(FLD=80201)!(FLD=80202)!(FLD=80002)
"RTN","GMPLDISP",122,0)
 . . D DT^GMPLHIST
"RTN","GMPLDISP",123,0)
PRQ ; Header Node
"RTN","GMPLDISP",124,0)
 S VALMCNT=LCNT,GMPDT(0)=VALMCNT,VALMSG=$$MSG^GMPLX,VALMBG=1,VALMBCK="R"
"RTN","GMPLDISP",125,0)
 Q
"RTN","GMPLDISP",126,0)
 ;
"RTN","GMPLDISP",127,0)
HDR ; Header Code (uses GMPDFN, GMPIFN)
"RTN","GMPLDISP",128,0)
 N LASTMOD,PAT S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLDISP",129,0)
 S LASTMOD=$S($G(GMPIFN):$P(^AUPNPROB(GMPIFN,0),U,3),1:$E($$HTFM^XLFDT($H),1,12))
"RTN","GMPLDISP",130,0)
 S LASTMOD="Last Updated: "_$$FMTE^XLFDT(LASTMOD)
"RTN","GMPLDISP",131,0)
 S VALMHDR(1)=PAT_$$REPEAT^XLFSTR(" ",(79-$L(PAT)-$L(LASTMOD)))_LASTMOD
"RTN","GMPLDISP",132,0)
 Q
"RTN","GMPLDISP",133,0)
 ;
"RTN","GMPLDISP",134,0)
HELP ; Help Code
"RTN","GMPLDISP",135,0)
 N X W !!?4,"You may view detailed information here on this problem;"
"RTN","GMPLDISP",136,0)
 W !?4,"more data may be available by entering 'Next Screen'."
"RTN","GMPLDISP",137,0)
 W !?4,"If you have selected multiple problems to view, you may"
"RTN","GMPLDISP",138,0)
 W !?4,"enter 'Continue to Next Selected Problem'; to return to"
"RTN","GMPLDISP",139,0)
 W !?4,"the patient's problem list, enter 'Quit to Problem List'."
"RTN","GMPLDISP",140,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLDISP",141,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLDISP",142,0)
 Q
"RTN","GMPLDISP",143,0)
 ;
"RTN","GMPLDISP",144,0)
DEFLT() ; Default Action, using GMPI and GMPLNO
"RTN","GMPLDISP",145,0)
 I GMPI<GMPLNO Q "Continue to Next Selected Problem"
"RTN","GMPLDISP",146,0)
 Q "Quit to Problem List"
"RTN","GMPLDISP",147,0)
 ;
"RTN","GMPLDISP",148,0)
ERROR ; Error Message - drop into EXIT
"RTN","GMPLDISP",149,0)
 W !!,"ERROR -- Cannot continue ... Returning to Problem List.",!
"RTN","GMPLDISP",150,0)
 S VALMBCK="Q" H 1
"RTN","GMPLDISP",151,0)
EXIT ; Exit Code
"RTN","GMPLDISP",152,0)
 K GMPDT Q
"RTN","GMPLEDT1")
0^19^B33842333
"RTN","GMPLEDT1",1,0)
GMPLEDT1 ; SLC/MKB/KER/AJB/TC -- Edit Problem List fields ;08/27/14  07:57
"RTN","GMPLEDT1",2,0)
 ;;2.0;Problem List;**17,20,26,28,35,42,45**;Aug 25, 1994;Build 53
"RTN","GMPLEDT1",3,0)
 ;
"RTN","GMPLEDT1",4,0)
 ; External References
"RTN","GMPLEDT1",5,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLEDT1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT1",7,0)
 ;   DBIA   341  DIS^SDROUT2
"RTN","GMPLEDT1",8,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLEDT1",9,0)
 ;   ICR   5747  $$CODECS^ICDEX
"RTN","GMPLEDT1",10,0)
 ;
"RTN","GMPLEDT1",11,0)
ONSET ; Edit Date of Onset - field .13
"RTN","GMPLEDT1",12,0)
 N X,Y,ENTERED,PROMPT,HELPMSG,DEFAULT
"RTN","GMPLEDT1",13,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(.13))
"RTN","GMPLEDT1",14,0)
 S PROMPT="DATE OF ONSET: ",HELPMSG="Enter the date this problem was first observed, as precisely as known."
"RTN","GMPLEDT1",15,0)
O1 ;   Get Date of Onset
"RTN","GMPLEDT1",16,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",17,0)
 I Y>ENTERED W !!,"Date of Onset cannot be later than the date the problem was entered!",$C(7) G O1
"RTN","GMPLEDT1",18,0)
 I +$P(GMPDFN,U,4),Y>$P(GMPDFN,U,4) W !!,"Date of Onset cannot be later than the date of death!",$C(7) G O1
"RTN","GMPLEDT1",19,0)
 S GMPFLD(.13)=Y S:Y'="" GMPFLD(.13)=GMPFLD(.13)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",20,0)
 Q
"RTN","GMPLEDT1",21,0)
STATUS ; Edit Status - field .12
"RTN","GMPLEDT1",22,0)
 ;   Then Edit Date Resolved - Field 1.07, if inactive
"RTN","GMPLEDT1",23,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT1",24,0)
 S DIR(0)="9000011,.12"
"RTN","GMPLEDT1",25,0)
 S:$L($G(GMPFLD(.12))) DIR("B")=$P(GMPFLD(.12),U,2)
"RTN","GMPLEDT1",26,0)
ST1 ;   Get Status
"RTN","GMPLEDT1",27,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",28,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ST1
"RTN","GMPLEDT1",29,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACTIVE",1:"INACTIVE") S GMPFLD(.12)=Y
"RTN","GMPLEDT1",30,0)
 S:$E(Y)'="I" GMPFLD(1.07)="" S:$E(Y)'="A" GMPFLD(1.14)=""
"RTN","GMPLEDT1",31,0)
 D:$E(GMPFLD(.12))="I" RESOLVED^GMPLEDT4
"RTN","GMPLEDT1",32,0)
 D:$E(GMPFLD(.12))="A" PRIORITY^GMPLEDT4
"RTN","GMPLEDT1",33,0)
 Q
"RTN","GMPLEDT1",34,0)
RECORDED ; Edit Date Recorded - field 1.09
"RTN","GMPLEDT1",35,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ENTERED
"RTN","GMPLEDT1",36,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(1.09))
"RTN","GMPLEDT1",37,0)
 S PROMPT="DATE RECORDED: ",HELPMSG="Enter the date this problem was first recorded, as precisely as known."
"RTN","GMPLEDT1",38,0)
RC1 ;   Get Date
"RTN","GMPLEDT1",39,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",40,0)
 I Y>ENTERED W !!,"Date Recorded cannot be later than the problem was entered!",$C(7) G RC1
"RTN","GMPLEDT1",41,0)
 S GMPFLD(1.09)=Y S:Y'="" GMPFLD(1.09)=GMPFLD(1.09)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",42,0)
 Q
"RTN","GMPLEDT1",43,0)
SC ; Edit Service Connected - field 1.1
"RTN","GMPLEDT1",44,0)
 N DFN,DIR,X,Y,DTOUT
"RTN","GMPLEDT1",45,0)
 ;
"RTN","GMPLEDT1",46,0)
 ;   The following allows changing a problem's SC/NSC to
"RTN","GMPLEDT1",47,0)
 ;   NSC if there is no SC on file for patient and Problem
"RTN","GMPLEDT1",48,0)
 ;   original SC was set to "YES"
"RTN","GMPLEDT1",49,0)
 ;
"RTN","GMPLEDT1",50,0)
 I +$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",51,0)
 . W !!,">>>  Currently known service-connection data for "_$P(GMPDFN,U,2)_":"
"RTN","GMPLEDT1",52,0)
 ELSE  Q:'GMPSC
"RTN","GMPLEDT1",53,0)
 S DFN=+GMPDFN D DIS^SDROUT2
"RTN","GMPLEDT1",54,0)
 I +GMPSC=0,+$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",55,0)
 . S DIR("A")="Patient has no service-connected condition !! "
"RTN","GMPLEDT1",56,0)
 . S DIR("B")="NO"
"RTN","GMPLEDT1",57,0)
 ELSE  D
"RTN","GMPLEDT1",58,0)
 . S DIR("A")="Is this problem related to a service-connected condition? "
"RTN","GMPLEDT1",59,0)
 . S:$L($G(GMPFLD(1.1))) DIR("B")=$P(GMPFLD(1.1),U,2) W !
"RTN","GMPLEDT1",60,0)
 S DIR("?",1)="If this problem is due to a service-connected condition, enter YES;",DIR("?")="press <return> and leave blank if this is unknown.",DIR(0)="YAO"
"RTN","GMPLEDT1",61,0)
SC1 ;   Get Service Connection
"RTN","GMPLEDT1",62,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",63,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G SC1
"RTN","GMPLEDT1",64,0)
 I X="@" G:'$$SURE^GMPLX SC1 S Y=""
"RTN","GMPLEDT1",65,0)
 S GMPFLD(1.1)=Y S:Y'="" GMPFLD(1.1)=GMPFLD(1.1)_U_$S(Y:"YES",1:"NO")
"RTN","GMPLEDT1",66,0)
 Q
"RTN","GMPLEDT1",67,0)
SP ; Edit Exposures/Conditions
"RTN","GMPLEDT1",68,0)
 ;   Agent Orange - field 1.11
"RTN","GMPLEDT1",69,0)
 ;   Ionizing Radiation - field 1.12
"RTN","GMPLEDT1",70,0)
 ;   Persian Gulf/Environmental Contaminants - field 1.13
"RTN","GMPLEDT1",71,0)
 ;   Head and/or Neck Cancer - field 1.15
"RTN","GMPLEDT1",72,0)
 ;   Military Sexual Trauma - field 1.16
"RTN","GMPLEDT1",73,0)
 ;   Combat Vet - field 1.17
"RTN","GMPLEDT1",74,0)
 ;   SHAD - field 1.18
"RTN","GMPLEDT1",75,0)
 G SPEXP^GMPLEDT2
"RTN","GMPLEDT1",76,0)
 Q
"RTN","GMPLEDT1",77,0)
SOURCE ; Edit Service - field 1.06
"RTN","GMPLEDT1",78,0)
 ; or Clinic - field 1.08
"RTN","GMPLEDT1",79,0)
 N DIC,DTOUT,X,Y,HELPMSG,PROMPT,DEFAULT,VIEW S VIEW=$E(GMPLVIEW("VIEW"))
"RTN","GMPLEDT1",80,0)
 S DIC=$S(VIEW="S":"^DIC(49,",1:"^SC("),DIC(0)="EMQ"
"RTN","GMPLEDT1",81,0)
 S DIC("S")="I $P(^(0),U,"_$S(VIEW="S":9,1:3)_")=""C"""
"RTN","GMPLEDT1",82,0)
 I VIEW="S" S PROMPT="SERVICE: ",DEFAULT=$P(GMPFLD(1.06),U,2)
"RTN","GMPLEDT1",83,0)
 E  S PROMPT="CLINIC: ",DEFAULT=$P(GMPFLD(1.08),U,2)
"RTN","GMPLEDT1",84,0)
 S HELPMSG="Enter the clinic"_$S(VIEW="S":"al service",1:"")_" to be associated with this problem."
"RTN","GMPLEDT1",85,0)
S1 ;   Get Service/Clinic
"RTN","GMPLEDT1",86,0)
 W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","GMPLEDT1",87,0)
 R X:DTIME S:'$T X="^",DTOUT=1 S:X="^" GMPQUIT=1 Q:(X="^")!(X="")
"RTN","GMPLEDT1",88,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G S1
"RTN","GMPLEDT1",89,0)
 I X="?" W !!,HELPMSG,! G S1
"RTN","GMPLEDT1",90,0)
 I X["??" D @("LIST"_$S(VIEW="S":"SERV",1:"CLIN")_"^GMPLMGR1") W !,HELPMSG G S1
"RTN","GMPLEDT1",91,0)
 I X="@" G:'$$SURE^GMPLX S1 S Y="" G SQ
"RTN","GMPLEDT1",92,0)
 D ^DIC I Y'>0 W !?5,"Only clinic"_$S(VIEW="S":"al service",1:"")_"s are allowed!",! G S1
"RTN","GMPLEDT1",93,0)
SQ ;   Quit Service/Clinic
"RTN","GMPLEDT1",94,0)
 S:VIEW'="S" GMPFLD(1.08)=Y S:VIEW="S" GMPFLD(1.06)=Y
"RTN","GMPLEDT1",95,0)
 Q
"RTN","GMPLEDT1",96,0)
AUTHOR ; Edit Recording Provider - field 1.04
"RTN","GMPLEDT1",97,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT S PROMPT="RECORDING PROVIDER: "
"RTN","GMPLEDT1",98,0)
 S DEFAULT=$G(GMPFLD(1.04)),HELPMSG="Enter the name of the provider responsible for the recording of this data."
"RTN","GMPLEDT1",99,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",100,0)
 S GMPFLD(1.04)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",101,0)
 Q
"RTN","GMPLEDT1",102,0)
PROV ; Edit Responsible Provider - field 1.05
"RTN","GMPLEDT1",103,0)
 N X,Y,PROMPT,DEFAULT,HELPMSG S DEFAULT=$G(GMPFLD(1.05))
"RTN","GMPLEDT1",104,0)
 S PROMPT="PROVIDER: ",HELPMSG="Enter the name of the local provider treating this problem."
"RTN","GMPLEDT1",105,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",106,0)
 S GMPFLD(1.05)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",107,0)
 Q
"RTN","GMPLEDT1",108,0)
ICD ; Edit ICD Code - field .01
"RTN","GMPLEDT1",109,0)
 N DIC,DIR,X,Y,DTOUT
"RTN","GMPLEDT1",110,0)
ICD0 ;   Prompt for ICD Code
"RTN","GMPLEDT1",111,0)
 K DIR S DIR(0)="FAO^2:6",DIR("A")="ICD CODE: "
"RTN","GMPLEDT1",112,0)
 S:($P($G(GMPFLD(.01)),U,2)="799.9")!($P($G(GMPFLD(.01)),U,2)="R69.") DIR("A")=IORVON_"ICD CODE: "
"RTN","GMPLEDT1",113,0)
 S:+$G(GMPFLD(.01)) DIR("B")=$P(GMPFLD(.01),U,2)
"RTN","GMPLEDT1",114,0)
 S DIR("?")="Enter the ICD code to be associated with this problem"
"RTN","GMPLEDT1",115,0)
ICD1 ;   Get ICD Code
"RTN","GMPLEDT1",116,0)
 D ^DIR W IORVOFF I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",117,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ICD1
"RTN","GMPLEDT1",118,0)
 I X="@" W !!,"ICD Code may not be deleted!",!,$C(7) G ICD1
"RTN","GMPLEDT1",119,0)
 Q:X=""  Q:$P($G(GMPFLD(.01)),U,2)=Y
"RTN","GMPLEDT1",120,0)
 S DIC=80,DIC(0)="EQM" D ^DIC G:Y'>0 ICD0
"RTN","GMPLEDT1",121,0)
 S GMPFLD(.01)=Y
"RTN","GMPLEDT1",122,0)
 Q
"RTN","GMPLEDT1",123,0)
NOTE ; Attach a note to problem - field 11
"RTN","GMPLEDT1",124,0)
 N X,Y,I,DEFAULT,PROMPT,DONE,NXT,NCNT,GMPLCPTR S (I,NCNT,DONE)=0
"RTN","GMPLEDT1",125,0)
 F  D  Q:$D(GMPQUIT)!($G(GMPLJUMP))!DONE
"RTN","GMPLEDT1",126,0)
 . S NXT=$O(GMPFLD(10,"NEW",I)) S:'NXT NXT=I+1
"RTN","GMPLEDT1",127,0)
 . S I=NXT,NCNT=NCNT+1
"RTN","GMPLEDT1",128,0)
 . S PROMPT=$S(NCNT=1:"",1:"ANOTHER ")_"COMMENT"_$S(NCNT=1:" (<200 char): ",1:": "),DEFAULT=$G(GMPFLD(10,"NEW",I))
"RTN","GMPLEDT1",129,0)
 . D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",130,0)
 . I X="@" K GMPFLD(10,"NEW",I) Q
"RTN","GMPLEDT1",131,0)
 . I Y="" S DONE=1 Q
"RTN","GMPLEDT1",132,0)
 . S GMPFLD(10,"NEW",I)=Y
"RTN","GMPLEDT1",133,0)
 Q
"RTN","GMPLEDT1",134,0)
TERM ; Edit Problem - field 1.01
"RTN","GMPLEDT1",135,0)
 G TERM^GMPLEDT4
"RTN","GMPLEDT1",136,0)
 Q
"RTN","GMPLEDT1",137,0)
Q ; No Editing
"RTN","GMPLEDT1",138,0)
 Q
"RTN","GMPLEDT3")
0^6^B31430518
"RTN","GMPLEDT3",1,0)
GMPLEDT3 ; ISL/MKB,KER,JER,TC -- Problem List edit utilities ;08/07/14  13:28
"RTN","GMPLEDT3",2,0)
 ;;2.0;Problem List;**26,35,36,42,45**;Aug 25, 1994;Build 53
"RTN","GMPLEDT3",3,0)
 ;
"RTN","GMPLEDT3",4,0)
 ; External References
"RTN","GMPLEDT3",5,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLEDT3",6,0)
 ;    ICR  5747  $$CODECS^ICDEX
"RTN","GMPLEDT3",7,0)
 ;   DBIA 10026  ^XUSEC("GMPL ICD CODE"
"RTN","GMPLEDT3",8,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMPLEDT3",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT3",10,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLEDT3",11,0)
 ;
"RTN","GMPLEDT3",12,0)
MSG() ; List Manager Message Bar
"RTN","GMPLEDT3",13,0)
 Q "Enter the number of the item(s) you wish to change"
"RTN","GMPLEDT3",14,0)
 ;
"RTN","GMPLEDT3",15,0)
KEYS ; Setup XQORM("KEY") array
"RTN","GMPLEDT3",16,0)
 ;   Numbers ref'd also in IN4^-EDIT, NTES^-EDT4
"RTN","GMPLEDT3",17,0)
 N I,PROTCL,NUM,ICD
"RTN","GMPLEDT3",18,0)
 S ICD=$S($D(^XUSEC("GMPL ICD CODE",DUZ)):1,1:0)
"RTN","GMPLEDT3",19,0)
 S XQORM("KEY","1")=$O(^ORD(101,"B","GMPL EDIT REFORMULATE",0))_"^1"
"RTN","GMPLEDT3",20,0)
 S XQORM("KEY","2")=$O(^ORD(101,"B","GMPL EDIT ONSET",0))_"^1"
"RTN","GMPLEDT3",21,0)
 S XQORM("KEY","3")=$O(^ORD(101,"B","GMPL EDIT STATUS",0))_"^1"
"RTN","GMPLEDT3",22,0)
 S XQORM("KEY","4")=$O(^ORD(101,"B","GMPL EDIT PROVIDER",0))_"^1"
"RTN","GMPLEDT3",23,0)
 S XQORM("KEY","5")=$O(^ORD(101,"B","GMPL EDIT SERVICE",0))_"^1",NUM=5
"RTN","GMPLEDT3",24,0)
 S:ICD XQORM("KEY","6")=$O(^ORD(101,"B","GMPL EDIT ICD",0))_"^1",NUM=6
"RTN","GMPLEDT3",25,0)
 I GMPVA D
"RTN","GMPLEDT3",26,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SC",0))_"^1"
"RTN","GMPLEDT3",27,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SP",0))_"^1"
"RTN","GMPLEDT3",28,0)
 S PROTCL=$O(^ORD(101,"B","GMPL EDIT NOTES",0))_"^1"
"RTN","GMPLEDT3",29,0)
 I GMPFLD(10,0) F I=1:1:GMPFLD(10,0) S NUM=NUM+1,XQORM("KEY",NUM)=PROTCL
"RTN","GMPLEDT3",30,0)
 S XQORM("KEY",NUM+1)=$O(^ORD(101,"B","GMPL EDIT NEW NOTE",0))_"^1"
"RTN","GMPLEDT3",31,0)
 S:$G(GMPARAM("VER"))&$D(GMPLUSER) XQORM("KEY","$")=$O(^ORD(101,"B","GMPL EDIT VERIFY",0))_"^1"
"RTN","GMPLEDT3",32,0)
 S XQORM("KEY","=")=$O(^ORD(101,"B","VALM NEXT SCREEN",0))_"^1"
"RTN","GMPLEDT3",33,0)
 S VALMSG=$$MSG
"RTN","GMPLEDT3",34,0)
 Q
"RTN","GMPLEDT3",35,0)
 ;
"RTN","GMPLEDT3",36,0)
GETFLDS(DA) ; Define GMPFLD(#) and GMPORIG(#) Arrays with Current Values
"RTN","GMPLEDT3",37,0)
 N DIC,DIQ,DR,I,GMPL,CNT,NIFN,FAC,EXT
"RTN","GMPLEDT3",38,0)
 S DIC="^AUPNPROB(",DIQ="GMPL",DIQ(0)="IE"
"RTN","GMPLEDT3",39,0)
 S DR=".01;.03;.05;.08:1.02;1.05:1.18;80001:80005;80201;80202" D EN^DIQ1
"RTN","GMPLEDT3",40,0)
 F I=.01,.03,.05,.08,.12,.13,1.01,1.02,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,80001,80002,80003,80004,80005,80201,80202 D
"RTN","GMPLEDT3",41,0)
 . S GMPORIG(I)=$G(GMPL(9000011,DA,I,"I")),EXT=""
"RTN","GMPLEDT3",42,0)
 . I I=1.01,GMPL(9000011,DA,I,"I")'>1 S GMPORIG(I)="" Q
"RTN","GMPLEDT3",43,0)
 . Q:(GMPORIG(I)="")!(I=1.02)
"RTN","GMPLEDT3",44,0)
 . I "^.01^.05^.12^1.01^1.05^1.06^1.08^1.1^1.14^80001^80002^80003^80004^80005^"[(U_I_U) S EXT=GMPL(9000011,DA,I,"E")
"RTN","GMPLEDT3",45,0)
 . I "^.03^.08^.13^1.07^1.09^80201^"[(U_I_U) S EXT=$$EXTDT^GMPLX(GMPORIG(I))
"RTN","GMPLEDT3",46,0)
 . I "^80202^"[(U_I_U) S EXT=$P($$CODECS^ICDEX($P(GMPORIG(.01),U,2),80,$P(GMPORIG(80201),U)),U,2)
"RTN","GMPLEDT3",47,0)
 . I "^1.11^1.12^1.13^"[(U_I_U) S EXT=$S(I=1.11:"AGENT ORANGE",I=1.12:"RADIATION",1:"ENV CONTAMINANTS")
"RTN","GMPLEDT3",48,0)
 . I "^1.15^1.16^1.17^1.18^"[(U_I_U) S EXT=$S(I=1.15:"HEAD/NECK CANCER",I=1.16:"MIL SEXUAL TRAUMA",I=1.17:"COMBAT VET",1:"SHAD")
"RTN","GMPLEDT3",49,0)
 . S GMPORIG(I)=GMPORIG(I)_U_EXT
"RTN","GMPLEDT3",50,0)
 I $D(^AUPNPROB(DA,803))=10 D
"RTN","GMPLEDT3",51,0)
 . N CODE S CODE=$P(GMPORIG(.01),U,2)
"RTN","GMPLEDT3",52,0)
 . S I=0 F  S I=$O(^AUPNPROB(DA,803,I)) Q:+I'>0  D
"RTN","GMPLEDT3",53,0)
 . . S $P(CODE,"/",(I+1))=$P($G(^AUPNPROB(DA,803,I,0)),U)
"RTN","GMPLEDT3",54,0)
 . S $P(GMPORIG(.01),U,2)=CODE
"RTN","GMPLEDT3",55,0)
 S I=0 F  S I=$O(GMPORIG(I)) Q:I'>0!(I=10)  S GMPFLD(I)=GMPORIG(I)
"RTN","GMPLEDT3",56,0)
 S (CNT,FAC,NIFN,GMPORIG(10,0),GMPFLD(10,0))=0
"RTN","GMPLEDT3",57,0)
 ;S FAC=$O(^AUPNPROB(DA,11,"B",+GMPVAMC,0)) Q:'FAC
"RTN","GMPLEDT3",58,0)
 F  S FAC=$O(^AUPNPROB(DA,11,FAC)) Q:FAC'>0  D
"RTN","GMPLEDT3",59,0)
 . F  S NIFN=$O(^AUPNPROB(DA,11,FAC,11,"B",NIFN)) Q:NIFN'>0  D
"RTN","GMPLEDT3",60,0)
 . . S CNT=CNT+1,GMPORIG(10,CNT)=$G(^AUPNPROB(DA,11,FAC,11,NIFN,0))
"RTN","GMPLEDT3",61,0)
 . . S $P(GMPORIG(10,CNT),U,2)=FAC
"RTN","GMPLEDT3",62,0)
 . . S GMPFLD(10,CNT)=GMPORIG(10,CNT)
"RTN","GMPLEDT3",63,0)
 S (GMPORIG(10,0),GMPFLD(10,0))=CNT
"RTN","GMPLEDT3",64,0)
 S I=80000 F  S I=$O(GMPORIG(I)) Q:I'>0  S GMPFLD(I)=GMPORIG(I)
"RTN","GMPLEDT3",65,0)
 Q
"RTN","GMPLEDT3",66,0)
 ;
"RTN","GMPLEDT3",67,0)
FLDS ; Define GMPFLD("FLD") Array for Editing
"RTN","GMPLEDT3",68,0)
 S (GMPFLD("FLD",2),GMPFLD("FLD",6),GMPFLD("FLD",7))="Q"
"RTN","GMPLEDT3",69,0)
 S GMPFLD("FLD",1)="TERM",GMPFLD("FLD","PROBLEM")=1
"RTN","GMPLEDT3",70,0)
 S:$D(^XUSEC("GMPL ICD CODE",DUZ)) GMPFLD("FLD",2)="ICD",GMPFLD("FLD","ICD CODE")=2
"RTN","GMPLEDT3",71,0)
 S GMPFLD("FLD",3)="NOTE",GMPFLD("FLD","COMMENT")=3
"RTN","GMPLEDT3",72,0)
 S GMPFLD("FLD",4)="ONSET",GMPFLD("FLD","DATE OF ONSET")=4
"RTN","GMPLEDT3",73,0)
 S GMPFLD("FLD",5)="STATUS",GMPFLD("FLD","STATUS")=5
"RTN","GMPLEDT3",74,0)
 S:GMPSC GMPFLD("FLD",6)="SC",GMPFLD("FLD","IS THIS PROBLEM RELATED TO A SERVICE-CONNECTED CONDITION?")=6
"RTN","GMPLEDT3",75,0)
 S:GMPAGTOR GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO AGENT ORANGE EXPOSURE?")=7
"RTN","GMPLEDT3",76,0)
 S:GMPION GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO RADIATION EXPOSURE?")=7
"RTN","GMPLEDT3",77,0)
 S:GMPGULF GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO ENVIRONMENTAL CONTAMINANTS EXPOSURE?")=7
"RTN","GMPLEDT3",78,0)
 S:GMPHNC GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO DIAGNOSED HEAD AND/OR NECK CANCER?")=7
"RTN","GMPLEDT3",79,0)
 S:GMPMST GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED MILITARY SEXUAL TRAUMA?")=7
"RTN","GMPLEDT3",80,0)
 S:GMPCV GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED COMBAT VET?")=7
"RTN","GMPLEDT3",81,0)
 S:GMPSHD GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED SHIPBOARD HAZARD AND DEFENSE?")=7
"RTN","GMPLEDT3",82,0)
 S GMPFLD("FLD",8)="PROV",GMPFLD("FLD","RESPONSIBLE PROVIDER")=8
"RTN","GMPLEDT3",83,0)
 S GMPFLD("FLD",9)="SOURCE"
"RTN","GMPLEDT3",84,0)
 S:$E(GMPLVIEW("VIEW"))="C" GMPFLD("FLD","CLINIC")=9
"RTN","GMPLEDT3",85,0)
 S:$E(GMPLVIEW("VIEW"))'="C" GMPFLD("FLD","SERVICE")=9
"RTN","GMPLEDT3",86,0)
 S GMPFLD("FLD",10)="RECORDED",GMPFLD("FLD","DATE RECORDED")=10
"RTN","GMPLEDT3",87,0)
 S GMPFLD("FLD",11)="AUTHOR",GMPFLD("FLD","RECORDING PROVIDER")=11
"RTN","GMPLEDT3",88,0)
 S GMPFLD("FLD",0)=11
"RTN","GMPLEDT3",89,0)
 Q
"RTN","GMPLEDT3",90,0)
 ;
"RTN","GMPLEDT3",91,0)
JUMP(XFLD) ; Resolve ^- Jump Out of Field Order in Edit
"RTN","GMPLEDT3",92,0)
 N I,MATCH,CNT,PROMPT,DIR,X,Y,DTOUT,DUOUT
"RTN","GMPLEDT3",93,0)
 ;   Passed in as ^XXX
"RTN","GMPLEDT3",94,0)
 S XFLD=$$UP^XLFSTR($P(XFLD,U,2))
"RTN","GMPLEDT3",95,0)
 I (XFLD="")!(XFLD["^") S GMPQUIT=1 Q
"RTN","GMPLEDT3",96,0)
 I '$D(GMPLJUMP) W $C(7),"  ^-jumping not allowed now!" S GMPLJUMP=0 Q
"RTN","GMPLEDT3",97,0)
 ;   Field is Exact
"RTN","GMPLEDT3",98,0)
 I $G(GMPFLD("FLD",XFLD)) S GMPLJUMP=GMPFLD("FLD",XFLD) Q
"RTN","GMPLEDT3",99,0)
 S CNT=0,PROMPT=" "
"RTN","GMPLEDT3",100,0)
 F  S PROMPT=$O(GMPFLD("FLD",PROMPT)) Q:PROMPT=""  D
"RTN","GMPLEDT3",101,0)
 . Q:$E(PROMPT,1,$L(XFLD))'=XFLD
"RTN","GMPLEDT3",102,0)
 . S CNT=CNT+1,MATCH(CNT)=GMPFLD("FLD",PROMPT)_U_PROMPT
"RTN","GMPLEDT3",103,0)
 I CNT=0 W $C(7),"  ??" Q
"RTN","GMPLEDT3",104,0)
 I CNT=1 S PROMPT=$P(MATCH(1),U,2),GMPLJUMP=+MATCH(1) W $E(PROMPT,$L(XFLD)+1,$L(PROMPT)) Q
"RTN","GMPLEDT3",105,0)
 ;   Select which Field to Jump To.
"RTN","GMPLEDT3",106,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","GMPLEDT3",107,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","GMPLEDT3",108,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","GMPLEDT3",109,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","GMPLEDT3",110,0)
 S GMPLJUMP=+MATCH(+Y)
"RTN","GMPLEDT3",111,0)
 Q
"RTN","GMPLEDT3",112,0)
 ;
"RTN","GMPLEDT3",113,0)
CK ; Check whether to Stop Processing
"RTN","GMPLEDT3",114,0)
 ;   Called from Exit Action of GMPL EDIT XXX Protocols
"RTN","GMPLEDT3",115,0)
 S:$D(GMPQUIT) XQORPOP=1 S:'$D(GMPQUIT) GMPREBLD=1 K GMPQUIT
"RTN","GMPLEDT3",116,0)
 I $D(DTOUT)!($G(VALMBCK)="Q") S VALMBCK="Q" Q
"RTN","GMPLEDT3",117,0)
 S VALMBCK="R",VALMSG=$$MSG
"RTN","GMPLEDT3",118,0)
 Q
"RTN","GMPLEDT4")
0^20^B30908694
"RTN","GMPLEDT4",1,0)
GMPLEDT4 ; SLC/MKB/TC -- Problem List Edit actions cont ;04/22/15  13:09
"RTN","GMPLEDT4",2,0)
 ;;2.0;Problem List;**5,43,42,47,45**;Aug 25, 1994;Build 53
"RTN","GMPLEDT4",3,0)
TERM ; edit field 1.01
"RTN","GMPLEDT4",4,0)
 N DTOUT,PROB,TERM,ICD,DUP,Y,GMPLCSYS,GMPL0,GMPL802,GMPIMPDT
"RTN","GMPLEDT4",5,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLEDT4",6,0)
T1 W !,"PROBLEM: "_$P(GMPFLD(.05),U,2)_"//"
"RTN","GMPLEDT4",7,0)
 R PROB:DTIME S:'$T DTOUT=1 I $D(DTOUT)!(PROB="^") S GMPQUIT=1 Q
"RTN","GMPLEDT4",8,0)
 I PROB?1"^".E D JUMP^GMPLEDT3(PROB) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G T1
"RTN","GMPLEDT4",9,0)
 Q:PROB=""  Q:PROB=$P(GMPFLD(.05),U,2)  ; no change
"RTN","GMPLEDT4",10,0)
 I PROB["?" D  G T1
"RTN","GMPLEDT4",11,0)
 . W !!?4,"Enter a description of this problem, up to 80 characters.",!
"RTN","GMPLEDT4",12,0)
 I PROB="@",'+$G(GMPIFN) D  S GMPQUIT=1 Q
"RTN","GMPLEDT4",13,0)
 .W !!?5,$C(7),$C(7),"This problem has not yet been saved."
"RTN","GMPLEDT4",14,0)
 .W !?5,"Enter <Q>uit and it will not be added to the list.",!!
"RTN","GMPLEDT4",15,0)
 .K DIR S DIR("A")="Press RETURN to redisplay the problem text"
"RTN","GMPLEDT4",16,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","GMPLEDT4",17,0)
 I PROB="@" D DELETE^GMPLEDT2 S:VALMBCK="Q" GMPQUIT=1 Q:$D(GMPQUIT)  G T1
"RTN","GMPLEDT4",18,0)
T2 ; new text -- pass to look-up
"RTN","GMPLEDT4",19,0)
 I '$D(GMPLUSER)!($D(GMPLUSER)&('GMPARAM("CLU"))) S GMPFLD(1.01)="",GMPFLD(.05)=U_PROB Q
"RTN","GMPLEDT4",20,0)
 D SEARCH^GMPLX(.PROB,.Y,"PROBLEM: ","1") ; pass to CLU
"RTN","GMPLEDT4",21,0)
 I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPLEDT4",22,0)
 S DUP=$$DUPL^GMPLX(+GMPDFN,+Y,PROB)
"RTN","GMPLEDT4",23,0)
 I DUP,'$$DUPLOK^GMPLX(DUP) S (Y,GMPROB)="" W ! G T1
"RTN","GMPLEDT4",24,0)
 S TERM=$S(+$G(Y)>1:Y,1:""),ICD=$G(Y(1))
"RTN","GMPLEDT4",25,0)
 S:'$L(ICD) ICD=$S(DT<GMPIMPDT:"799.9",1:"R69.")
"RTN","GMPLEDT4",26,0)
 N I,GMPSTAT,GMPCSREC,GMPCSPTR,GMPCSNME,GMPSCTC,GMPSCTD,GMPTXT,GMPTYP,GMPNUM,GMPQT,GMPSYN
"RTN","GMPLEDT4",27,0)
 S (GMPTYP,GMPNUM,GMPQT)=""
"RTN","GMPLEDT4",28,0)
 I ICD["/" F I=1:1:$L(ICD,"/") D  Q:GMPSTAT
"RTN","GMPLEDT4",29,0)
 . N GMPCODE S GMPCODE=$P(ICD,"/",I),GMPSTAT=0
"RTN","GMPLEDT4",30,0)
 . S GMPCSREC=$$CODECS^ICDEX(GMPCODE,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLEDT4",31,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPCODE,DT) GMPSTAT=1
"RTN","GMPLEDT4",32,0)
 E  D
"RTN","GMPLEDT4",33,0)
 . S GMPSTAT=0,GMPCSREC=$$CODECS^ICDEX(ICD,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLEDT4",34,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,ICD,DT) GMPSTAT=1
"RTN","GMPLEDT4",35,0)
 I GMPSTAT W !,PROB,!,"has an inactive ICD code.  Please enter another search term." H 3 Q
"RTN","GMPLEDT4",36,0)
 I (PROB["(SCT"),(PROB[")") D
"RTN","GMPLEDT4",37,0)
 . S GMPSCTC=$$ONE^LEXU(+TERM,DT,"SCT")
"RTN","GMPLEDT4",38,0)
 . S GMPTXT=$$TRIM^XLFSTR($RE($P($RE(PROB),"(",2,99)))
"RTN","GMPLEDT4",39,0)
 . S GMPSCTD=$$GETSYN^LEXTRAN1("SCT",GMPSCTC,DT,"GMPSYN",1,1)
"RTN","GMPLEDT4",40,0)
 . I $P(GMPSCTD,U)'=1 S GMPSCTD="" Q
"RTN","GMPLEDT4",41,0)
 . F  S GMPTYP=$O(GMPSYN(GMPTYP)) Q:GMPTYP=""!(GMPQT)  D
"RTN","GMPLEDT4",42,0)
 . . I GMPTYP="S" F  S GMPNUM=$O(GMPSYN(GMPTYP,GMPNUM)) Q:GMPNUM=""!(GMPQT)  D
"RTN","GMPLEDT4",43,0)
 . . . I $P(GMPSYN(GMPTYP,GMPNUM),U)=GMPTXT S GMPSCTD=$P(GMPSYN(GMPTYP,GMPNUM),U,3),GMPQT=1 Q
"RTN","GMPLEDT4",44,0)
 . . Q:GMPQT
"RTN","GMPLEDT4",45,0)
 . . I $P(GMPSYN(GMPTYP),U)=GMPTXT S GMPSCTD=$P(GMPSYN(GMPTYP),U,3),GMPQT=1 Q
"RTN","GMPLEDT4",46,0)
 S GMPLCSYS=$$SAB^ICDEX(GMPCSPTR,DT)
"RTN","GMPLEDT4",47,0)
 S GMPFLD(1.01)=TERM,GMPFLD(.05)=U_PROB
"RTN","GMPLEDT4",48,0)
 S GMPFLD(.01)=$S($L(ICD):$P($$ICDDATA^ICDXCODE(GMPCSPTR,$P(ICD,"/"),DT,"E"),U)_U_$G(ICD),1:"")
"RTN","GMPLEDT4",49,0)
 S:'GMPFLD(.01)!($P(GMPFLD(.01),U)<0) GMPFLD(.01)=$$NOS^GMPLX(GMPLCSYS,DT)
"RTN","GMPLEDT4",50,0)
 S (GMPFLD(.03),GMPFLD(80201),GMPFLD(1.09))=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPLEDT4",51,0)
 S GMPFLD(80202)=GMPLCSYS_U_$G(GMPCSNME)
"RTN","GMPLEDT4",52,0)
 S GMPFLD(80001)=GMPSCTC_U_GMPSCTC,GMPFLD(80002)=GMPSCTD_U_GMPSCTD
"RTN","GMPLEDT4",53,0)
 K GMPSYN
"RTN","GMPLEDT4",54,0)
 Q
"RTN","GMPLEDT4",55,0)
 ;
"RTN","GMPLEDT4",56,0)
TEXT(DFLT) ; Enter/edit provider narrative text (no lookup)
"RTN","GMPLEDT4",57,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT4",58,0)
 S DIR(0)="FAO^2:80",DIR("A")="PROBLEM: " S:$L(DFLT) DIR("B")=DFLT
"RTN","GMPLEDT4",59,0)
 S DIR("?")="Enter a description of this problem, up to 80 characters."
"RTN","GMPLEDT4",60,0)
 D ^DIR S:$D(DTOUT)!(X="^") Y="^" S:'$L(DFLT)&(X="") Y="^"
"RTN","GMPLEDT4",61,0)
 Q Y
"RTN","GMPLEDT4",62,0)
 ;
"RTN","GMPLEDT4",63,0)
NTES ; Edit existing note, display # in XQORNOD(0)
"RTN","GMPLEDT4",64,0)
 N NUM,NOTE,X,Y,PROMPT,DEFAULT,NT
"RTN","GMPLEDT4",65,0)
 S NT=$S(GMPVA:7,1:5) S:$D(^XUSEC("GMPL ICD CODE",DUZ)) NT=NT+1
"RTN","GMPLEDT4",66,0)
 S NUM=+$P(XQORNOD(0),U,3)-NT Q:NUM'>0
"RTN","GMPLEDT4",67,0)
 S NOTE=GMPFLD(10,NUM),DEFAULT=$P(NOTE,U,3)
"RTN","GMPLEDT4",68,0)
 S PROMPT="NOTE "_$$EXTDT^GMPLX($P(NOTE,U,5))_": "
"RTN","GMPLEDT4",69,0)
 D EDNOTE Q:$D(GMPQUIT)
"RTN","GMPLEDT4",70,0)
 S $P(GMPFLD(10,NUM),U,3)=Y
"RTN","GMPLEDT4",71,0)
 Q
"RTN","GMPLEDT4",72,0)
 ;
"RTN","GMPLEDT4",73,0)
EDNOTE ; Edit note text given PROMPT,DEFAULT (returns X,Y)
"RTN","GMPLEDT4",74,0)
 N DIR,DTOUT S DIR(0)="FAO^1:200",DIR("A")=PROMPT
"RTN","GMPLEDT4",75,0)
 S:$L(DEFAULT) DIR("B")=DEFAULT
"RTN","GMPLEDT4",76,0)
 S DIR("?",1)="Enter any text you wish appended to this problem, up to 200 characters"
"RTN","GMPLEDT4",77,0)
 S DIR("?")="in length.  You may append as many comments to a problem as you wish."
"RTN","GMPLEDT4",78,0)
ED1 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1,Y="" Q
"RTN","GMPLEDT4",79,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ED1
"RTN","GMPLEDT4",80,0)
 Q:Y=DEFAULT  I X="@" D  Q:$D(GMPQUIT)!(Y="")  G ED1
"RTN","GMPLEDT4",81,0)
 . N DIR,X,DTOUT,DUOUT S DIR(0)="YAO",DIR("B")="NO"
"RTN","GMPLEDT4",82,0)
 . S DIR("A")="   Are you sure you want to delete this comment? "
"RTN","GMPLEDT4",83,0)
 . S DIR("?")="   Enter YES to completely remove this comment from this patient's problem."
"RTN","GMPLEDT4",84,0)
 . W $C(7) D ^DIR I $D(DUOUT)!($D(DTOUT)) S GMPQUIT=1,Y="" Q
"RTN","GMPLEDT4",85,0)
 . S:Y Y=""
"RTN","GMPLEDT4",86,0)
 I $L(X)>200 W !!,"Text may not exceed 200 characters!",!,$C(7) S DIR("B")=$E(X,1,200) G ED1
"RTN","GMPLEDT4",87,0)
 S Y=X
"RTN","GMPLEDT4",88,0)
 Q
"RTN","GMPLEDT4",89,0)
 ;
"RTN","GMPLEDT4",90,0)
RESOLVED ; edit field 1.07
"RTN","GMPLEDT4",91,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ONSET S ONSET=+$G(GMPFLD(.13))
"RTN","GMPLEDT4",92,0)
 S DEFAULT=$G(GMPFLD(1.07)),PROMPT="DATE RESOLVED: "
"RTN","GMPLEDT4",93,0)
 S HELPMSG="Enter the date this problem became resolved or inactive, as precisely as known."
"RTN","GMPLEDT4",94,0)
R1 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT4",95,0)
 I Y,ONSET,Y<ONSET W !!,"Date Resolved cannot be prior to the Date of Onset!",$C(7) G R1
"RTN","GMPLEDT4",96,0)
 S GMPFLD(1.07)=Y S:Y'="" GMPFLD(1.07)=GMPFLD(1.07)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT4",97,0)
 Q
"RTN","GMPLEDT4",98,0)
 ;
"RTN","GMPLEDT4",99,0)
PRIORITY ; edit field 1.14
"RTN","GMPLEDT4",100,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT4",101,0)
 S DIR(0)="SAO^A:ACUTE;C:CHRONIC;",DIR("A")="  (A)cute or (C)hronic? "
"RTN","GMPLEDT4",102,0)
 S:$L($G(GMPFLD(1.14))) DIR("B")=$P(GMPFLD(1.14),U,2)
"RTN","GMPLEDT4",103,0)
 S DIR("?",1)="  You may further refine the status of this problem by designating it",DIR("?",2)="  as ACUTE or CHRONIC; problems marked as ACUTE will be flagged on the",DIR("?")="  list display with a '*'."
"RTN","GMPLEDT4",104,0)
PR1 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT4",105,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G PR1
"RTN","GMPLEDT4",106,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACUTE",1:"CHRONIC")
"RTN","GMPLEDT4",107,0)
 S GMPFLD(1.14)=Y
"RTN","GMPLEDT4",108,0)
 Q
"RTN","GMPLHIST")
0^8^B22139789
"RTN","GMPLHIST",1,0)
GMPLHIST ; SLC/MKB/KER/TC -- Problem List Historical data ;02/26/15  09:09
"RTN","GMPLHIST",2,0)
 ;;2.0;Problem List;**7,26,31,35,36,42,46,45**;Aug 25, 1994;Build 53
"RTN","GMPLHIST",3,0)
 ;
"RTN","GMPLHIST",4,0)
 ; External References
"RTN","GMPLHIST",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHIST",6,0)
 ;
"RTN","GMPLHIST",7,0)
DT ; Add historical data (audit trail) to DT list
"RTN","GMPLHIST",8,0)
 ;   Called from ^GMPLDISP, requires AIFN and adds to GMPDT()
"RTN","GMPLHIST",9,0)
 N NODE,DATE,FLD,PROV,OLD,OLDVAL,NEW,NEWVAL,ROOT,CHNGE,GMPLCSYS,PREVAUTH
"RTN","GMPLHIST",10,0)
 S NODE=$G(^GMPL(125.8,AIFN,0)) Q:NODE=""
"RTN","GMPLHIST",11,0)
 S DATE=$$EXTDT^GMPLX($P(NODE,U,3)),FLD=+$P(NODE,U,2),PROV=+$P(NODE,U,8)
"RTN","GMPLHIST",12,0)
 S:'PROV PROV=$P(NODE,U,4)
"RTN","GMPLHIST",13,0)
 S PROV=$S(PROV=".5":"NTRT",1:$P($G(^VA(200,PROV,0)),U))
"RTN","GMPLHIST",14,0)
 S FLD=FLD_U_$$FLDNAME(+FLD)
"RTN","GMPLHIST",15,0)
 S OLD=$P(NODE,U,5),NEW=$P(NODE,U,6),LCNT=LCNT+1
"RTN","GMPLHIST",16,0)
 I +FLD=1101 D  Q
"RTN","GMPLHIST",17,0)
 . N REASON
"RTN","GMPLHIST",18,0)
 . S REASON=" removed by "
"RTN","GMPLHIST",19,0)
 . S:OLD="C" REASON=" changed by "
"RTN","GMPLHIST",20,0)
 . S NODE=$G(^GMPL(125.8,AIFN,1))
"RTN","GMPLHIST",21,0)
 . S PREVAUTH=$P(NODE,U,6)
"RTN","GMPLHIST",22,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": Previous NOTE "_$$EXTDT^GMPLX($P(NODE,U,5))_" from "_$P($G(^VA(200,+PREVAUTH,0)),U)_REASON_PROV_":"
"RTN","GMPLHIST",23,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)="            "_$P(NODE,U,3)
"RTN","GMPLHIST",24,0)
 I +FLD=1.02 D  Q
"RTN","GMPLHIST",25,0)
 . S CHNGE=$S(NEW="H":"removed",OLD="T":"verified",1:"placed back on list")
"RTN","GMPLHIST",26,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": PROBLEM "_CHNGE_" by "_PROV
"RTN","GMPLHIST",27,0)
 S GMPDT(LCNT,0)=$J(DATE,10)_": "_$P(FLD,U,2)_$S(OLD]"":" changed",1:" added")_" by "_PROV,LCNT=LCNT+1
"RTN","GMPLHIST",28,0)
 I +FLD=.01 D  Q
"RTN","GMPLHIST",29,0)
 . N CSYSOLD,CSYSNEW
"RTN","GMPLHIST",30,0)
 . S CSYSOLD=$$CSI^ICDEX(80,OLD),CSYSNEW=$$CSI^ICDEX(80,NEW)
"RTN","GMPLHIST",31,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(CSYSOLD=30:"(ICD-10-CM ",1:"(ICD-9-CM ")_$P($$ICDDATA^ICDXCODE(CSYSOLD,OLD,DT,"I"),U,2)_")"_" to "_$S(CSYSNEW=30:"(ICD-10-CM ",1:"(ICD-9-CM ")_$P($$ICDDATA^ICDXCODE(CSYSNEW,NEW,DT,"I"),U,2)_")"
"RTN","GMPLHIST",32,0)
 I +FLD=.12 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACTIVE",OLD="I":"INACTIVE",1:"UNKNOWN")_" to "_$S(NEW="A":"ACTIVE",NEW="I":"INACTIVE",1:"UNKNOWN") Q
"RTN","GMPLHIST",33,0)
 I (+FLD=.13)!(+FLD=1.07) S GMPDT(LCNT,0)=$J("from ",17)_$$EXTDT^GMPLX(OLD)_" to "_$$EXTDT^GMPLX(NEW) Q
"RTN","GMPLHIST",34,0)
 I +FLD=1.14 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACUTE",OLD="C":"CHRONIC",1:"UNSPECIFIED")_" to "_$S(NEW="A":"ACUTE",NEW="C":"CHRONIC",1:"UNSPECIFIED") Q
"RTN","GMPLHIST",35,0)
 I +FLD=80005 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD=1:"PENDING",OLD=2:"COMPLETED",1:"N/A")_" to "_$S(NEW=1:"PENDING",NEW="2":"COMPLETED",1:"N/A") Q
"RTN","GMPLHIST",36,0)
 I +FLD=302 D  Q
"RTN","GMPLHIST",37,0)
 . I NEW]"" D
"RTN","GMPLHIST",38,0)
 . . I OLD="" S GMPDT(LCNT,0)=$J(" as ",17)_NEW
"RTN","GMPLHIST",39,0)
 . . E  S GMPDT(LCNT,0)=$J("from ",17)_OLD_$$PAD^GMPLX(OLD,6)_" to "_NEW
"RTN","GMPLHIST",40,0)
 . E  S GMPDT(LCNT,0)=$J(OLD_$$PAD^GMPLX(OLD,6),23)_" removed."
"RTN","GMPLHIST",41,0)
 I (+FLD>1.09)&(+FLD<=1.18) S GMPDT(LCNT,0)=$J("from ",17)_$S(+OLD:"YES",OLD=0:"NO",1:"UNKNOWN")_" to "_$S(+NEW:"YES",NEW=0:"NO",1:"UNKNOWN") Q
"RTN","GMPLHIST",42,0)
 I (+FLD=80001)!(+FLD=80002) S GMPDT(LCNT,0)=$J("from ",17)_OLD_" to "_NEW
"RTN","GMPLHIST",43,0)
 I "^.05^1.01^1.04^1.05^1.06^1.08^"[(U_+FLD_U) D
"RTN","GMPLHIST",44,0)
 . S ROOT=$S(+FLD=.05:"AUTNPOV(",+FLD=1.01:"LEX(757.01,",(+FLD=1.04)!(+FLD=1.05):"VA(200,",+FLD=1.06:"DIC(49,",+FLD=1.08:"SC(",1:"") Q:ROOT=""
"RTN","GMPLHIST",45,0)
 . S OLDVAL=$S(OLD="":"",1:$P($G(@(U_ROOT_OLD_",0)")),U))
"RTN","GMPLHIST",46,0)
 . S NEWVAL=$S(NEW="":"",1:$P($G(@(U_ROOT_NEW_",0)")),U))
"RTN","GMPLHIST",47,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(OLDVAL'="":OLDVAL_$$PAD^GMPLX(OLDVAL,6),1:"UNSPECIFIED")
"RTN","GMPLHIST",48,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)=$J("to ",17)_$S(NEWVAL'="":NEWVAL,1:"UNSPECIFIED")
"RTN","GMPLHIST",49,0)
 Q
"RTN","GMPLHIST",50,0)
 ;
"RTN","GMPLHIST",51,0)
FLDNAME(NUM) ; Returns Field Name for Display
"RTN","GMPLHIST",52,0)
 N NAME,NM1,NM2,I,J S J=0,NAME="" D NUM(.NM1),ALP(.NM2) S:+($G(NM1(+NUM)))=+NUM J=+NUM
"RTN","GMPLHIST",53,0)
 S:$L($G(NM2(+J))) NAME=$G(NM2(+J))
"RTN","GMPLHIST",54,0)
 Q NAME
"RTN","GMPLHIST",55,0)
ALP(X) ; Alpha Field Names
"RTN","GMPLHIST",56,0)
 S X(.01)="DIAGNOSIS",X(.02)="PATIENT NAME",X(.03)="DATE LAST MODIFIED",X(.04)="CLASS",X(.05)="PROVIDER NARRATIVE"
"RTN","GMPLHIST",57,0)
 S X(.06)="FACILITY",X(.07)="NUMBER",X(.08)="DATE ENTERED",X(.12)="STATUS",X(.13)="DATE OF ONSET",X(1.01)="PROBLEM",X(1.02)="CONDITION"
"RTN","GMPLHIST",58,0)
 S X(1.03)="ENTERED BY",X(1.04)="RECORDING PROVIDER",X(1.05)="RESPONSIBLE PROVIDER",X(1.06)="SERVICE",X(1.07)="DATE RESOLVED"
"RTN","GMPLHIST",59,0)
 S X(1.08)="CLINIC",X(1.09)="DATE RECORDED",X(1.1)="SERVICE CONNECTED",X(1.11)="AGENT ORANGE EXP",X(1.12)="RADIATION EXP",X(1.13)="ENV CONTAMINANTS EXP"
"RTN","GMPLHIST",60,0)
 S X(1.14)="IMMEDIACY",X(1.15)="HEAD/NECK CANCER",X(1.16)="MIL SEXUAL TRAUMA",X(1.17)="COMBAT VET",X(1.18)="SHAD",X(80001)="SNOMED CT CONCEPT",X(80002)="SNOMED CT DESIGNATION"
"RTN","GMPLHIST",61,0)
 S X(80003)="VHAT CONCEPT",X(80004)="VHAT DESIGNATION",X(80005)="MAP STATUS"
"RTN","GMPLHIST",62,0)
 S X(302)="SECONDARY DIAGNOSIS",X(1101)="NOTE"
"RTN","GMPLHIST",63,0)
 Q
"RTN","GMPLHIST",64,0)
NUM(X) ; Numeric Field Designations
"RTN","GMPLHIST",65,0)
 N FN F FN=.01:.01:.08 S X(+FN)=+FN
"RTN","GMPLHIST",66,0)
 F FN=.12:.01:.13 S X(+FN)=+FN
"RTN","GMPLHIST",67,0)
 F FN=1.01:.01:1.18 S X(+FN)=+FN
"RTN","GMPLHIST",68,0)
 F FN=80001:1:80005 S X(+FN)=+FN
"RTN","GMPLHIST",69,0)
 S X(1101)=1101,X(302)=302
"RTN","GMPLHIST",70,0)
 Q
"RTN","GMPLSAVE")
0^10^B132948390
"RTN","GMPLSAVE",1,0)
GMPLSAVE ; ISL/MKB,KER,JER,TC -- Save Problem List data ;04/22/15  13:09
"RTN","GMPLSAVE",2,0)
 ;;2.0;Problem List;**26,31,35,37,38,36,42,47,45**;Aug 25, 1994;Build 53
"RTN","GMPLSAVE",3,0)
 ;
"RTN","GMPLSAVE",4,0)
 ; External References
"RTN","GMPLSAVE",5,0)
 ;   ICR #5747   $$CSI^ICDEX,$$SAB^ICDEX,$$CODECS^ICDEX
"RTN","GMPLSAVE",6,0)
 ;   ICR #5009   $$GETDES^LEXTRAN1
"RTN","GMPLSAVE",7,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLSAVE",8,0)
 ;   DBIA 10013  ^DIK
"RTN","GMPLSAVE",9,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMPLSAVE",10,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLSAVE",11,0)
 ;
"RTN","GMPLSAVE",12,0)
EN ; Save Changes made to Existing Problem
"RTN","GMPLSAVE",13,0)
 N FLD,NOW,CHNGE,I,NIFN,TEXT,OLDTEXT,FAC,NODE,AUDITED,DR,DA,DIE,DIK,GMPICD,GMPBULL,NEWNTDT,%DT,X,GMPNOW,GMPIMPDT
"RTN","GMPLSAVE",14,0)
 S GMPNOW=$$NOW^XLFDT,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLSAVE",15,0)
 S:'GMPORIG(.01) GMPORIG(.01)=$$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U))
"RTN","GMPLSAVE",16,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U))
"RTN","GMPLSAVE",17,0)
 S GMPICD=$P($G(GMPFLD(.01)),U,2)
"RTN","GMPLSAVE",18,0)
 S:$D(GMPFLD(.01)) GMPFLD(.01)=+GMPFLD(.01)
"RTN","GMPLSAVE",19,0)
 S:$P(GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U)) ;chk for error from ICD
"RTN","GMPLSAVE",20,0)
 S:$G(GMPFLD(80201))']"" GMPFLD(80201)=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPLSAVE",21,0)
 S:$G(GMPFLD(80202))']"" GMPFLD(80202)=$$SAB^ICDEX($$CSI^ICDEX(80,+GMPFLD(.01)),DT)_U_$P($$CODECS^ICDEX($P(GMPICD,"/"),80,DT),U,2)
"RTN","GMPLSAVE",22,0)
 S:'GMPORIG(1.01) GMPORIG(1.01)="1^Unresolved"
"RTN","GMPLSAVE",23,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",24,0)
 I $G(GMPFLD(1.01))["SNOMED CT" D
"RTN","GMPLSAVE",25,0)
 . N SCTS,SCTC,SCTD,SCTT,GMPTYP,GMPNUM,GMPQT,GMPSYN
"RTN","GMPLSAVE",26,0)
 . S (GMPTYP,GMPNUM,GMPQT)=""
"RTN","GMPLSAVE",27,0)
 . S SCTS=GMPFLD(1.01)
"RTN","GMPLSAVE",28,0)
 . S SCTT=$P($P(SCTS," (SNOMED CT "),U,2)
"RTN","GMPLSAVE",29,0)
 . S SCTC=$P($P(SCTS,"SNOMED CT ",2),")"),GMPFLD(80001)=SCTC_U_SCTC
"RTN","GMPLSAVE",30,0)
 . S SCTD=$$GETSYN^LEXTRAN1("SCT",SCTC,DT,"GMPSYN",1,1)
"RTN","GMPLSAVE",31,0)
 . I $P(SCTD,U)'=1 S SCTD="" Q
"RTN","GMPLSAVE",32,0)
 . F  S GMPTYP=$O(GMPSYN(GMPTYP)) Q:GMPTYP=""!(GMPQT)  D
"RTN","GMPLSAVE",33,0)
 . . I GMPTYP="S" F  S GMPNUM=$O(GMPSYN(GMPTYP,GMPNUM)) Q:GMPNUM=""!(GMPQT)  D
"RTN","GMPLSAVE",34,0)
 . . . I $P(GMPSYN(GMPTYP,GMPNUM),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP,GMPNUM),U,3),GMPQT=1 Q
"RTN","GMPLSAVE",35,0)
 . . Q:GMPQT
"RTN","GMPLSAVE",36,0)
 . . I $P(GMPSYN(GMPTYP),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP),U,3),GMPQT=1 Q
"RTN","GMPLSAVE",37,0)
 . S GMPFLD(80002)=SCTD_U_SCTD K GMPSYN
"RTN","GMPLSAVE",38,0)
 . I (+$G(GMPFLD(.01))=+$$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U))) S GMPFLD(80005)="1^PENDING"
"RTN","GMPLSAVE",39,0)
 I $G(GMPFLD(1.01))["VHAT" D
"RTN","GMPLSAVE",40,0)
 . N VHATC,VHATD,VHATS,VHATT
"RTN","GMPLSAVE",41,0)
 . S VHATS=GMPFLD(1.01)
"RTN","GMPLSAVE",42,0)
 . S VHATT=$P($P(VHATS," (VHAT "),U,2)
"RTN","GMPLSAVE",43,0)
 . S VHATC=$P($P(VHATS,"VHAT ",2),")")
"RTN","GMPLSAVE",44,0)
 . S GMPFLD(80003)=VHATC_U_VHATC
"RTN","GMPLSAVE",45,0)
 . S VHATD=$$GETDES^LEXTRAN1("VHAT",VHATT)
"RTN","GMPLSAVE",46,0)
 . I +VHATD=1 S VHATD=$P(VHATD,U,2),GMPFLD(80004)=VHATD_U_VHATD
"RTN","GMPLSAVE",47,0)
 S:'GMPFLD(.05) I=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(I,+GMPFLD(1.01))
"RTN","GMPLSAVE",48,0)
 S NOW=$$HTFM^XLFDT($H),AUDITED=0
"RTN","GMPLSAVE",49,0)
 S DR="1.02////"_$S('$D(GMPLUSER):"T",1:GMPFLD(1.02))
"RTN","GMPLSAVE",50,0)
 I GMPORIG(1.02)="T",GMPFLD(1.02)="P" D
"RTN","GMPLSAVE",51,0)
 . S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ
"RTN","GMPLSAVE",52,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",53,0)
 I $P($G(GMPORIG(.12)),U)="I",$P(GMPFLD(.12),U)="A" D REACTV S AUDITED=1
"RTN","GMPLSAVE",54,0)
 I +$G(GMPORIG(1.01))'=(+GMPFLD(1.01)) D REFORM S AUDITED=1
"RTN","GMPLSAVE",55,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",56,0)
 I (+$G(GMPFLD(.01))'=+$$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U))),($G(GMPROV)=.5) S GMPFLD(80005)="2^COMPLETED"
"RTN","GMPLSAVE",57,0)
 F FLD=.01,.05,.12,.13,1.01,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,80001,80002,80003,80004,80005,80201,80202 D
"RTN","GMPLSAVE",58,0)
 . Q:'$D(GMPFLD(FLD))  Q:$P($G(GMPORIG(FLD)),U)=$P($G(GMPFLD(FLD)),U)
"RTN","GMPLSAVE",59,0)
 . S DR=DR_";"_FLD_"////"_$S($P(GMPFLD(FLD),U)'="":$P(GMPFLD(FLD),U),1:"@")
"RTN","GMPLSAVE",60,0)
 . Q:AUDITED&((FLD=.12)!(FLD=1.01))  S CHNGE=GMPIFN_U_FLD_U_NOW_U_DUZ_U_$P(GMPORIG(FLD),U)_U_$P(GMPFLD(FLD),U)_"^^"_+$G(GMPROV)
"RTN","GMPLSAVE",61,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",62,0)
 S DA=GMPIFN,DIE="^AUPNPROB(" D ^DIE S GMPSAVED=1
"RTN","GMPLSAVE",63,0)
 D COEXPRS(GMPIFN,GMPICD)
"RTN","GMPLSAVE",64,0)
 I (GMPNOW<GMPIMPDT),($P(GMPICD,"/")=$P($$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U)),U,2)),(+$P($G(GMPFLD(80001)),U)>0) D NTRTBULL(.GMPBULL,$P(GMPFLD(1.01),U,2),$P($G(GMPFLD(80001)),U,2),$G(GMPSRCH))
"RTN","GMPLSAVE",65,0)
NOTES ; Save Changes to Notes
"RTN","GMPLSAVE",66,0)
 F I=0:0 S I=$O(GMPORIG(10,I)) Q:I'>0  I GMPORIG(10,I)'=GMPFLD(10,I) D
"RTN","GMPLSAVE",67,0)
 . S NIFN=+GMPFLD(10,I),FAC=$P(GMPFLD(10,I),U,2),TEXT=$P(GMPFLD(10,I),U,3),OLDTEXT=$P(GMPORIG(10,I),U,3),NEWNTDT=$P($G(GMPFLD(10,I)),U,5)
"RTN","GMPLSAVE",68,0)
 . S %DT="X",X=NEWNTDT D ^%DT S NEWNTDT=Y
"RTN","GMPLSAVE",69,0)
 . S NODE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0))
"RTN","GMPLSAVE",70,0)
 . I TEXT'="" S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,3)=TEXT D
"RTN","GMPLSAVE",71,0)
 .. I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",72,0)
 .. I $P($G(GMPORIG(10,I)),U,5)'=NEWNTDT S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,5)=NEWNTDT ;Date note added
"RTN","GMPLSAVE",73,0)
 .. I $P($G(GMPORIG(10,I)),U,6)'=$P($G(GMPFLD(10,I)),U,6) S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,6)=$P($G(GMPFLD(10,I)),U,6) ;Author
"RTN","GMPLSAVE",74,0)
 .. S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^C^^Note Modified^"_+$G(GMPROV)
"RTN","GMPLSAVE",75,0)
 . I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",76,0)
 . I TEXT="" S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^A^^Deleted Note^"_+$G(GMPROV)
"RTN","GMPLSAVE",77,0)
 . D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",78,0)
 . I TEXT="" D
"RTN","GMPLSAVE",79,0)
 .. S DIK="^AUPNPROB("_GMPIFN_",11,"_FAC_",11,"
"RTN","GMPLSAVE",80,0)
 .. S DA(2)=GMPIFN,DA(1)=FAC,DA=NIFN D ^DIK
"RTN","GMPLSAVE",81,0)
 I $D(GMPFLD(10,"NEW"))>9 D NEWNOTE
"RTN","GMPLSAVE",82,0)
EXIT ; Quit Saving Changes
"RTN","GMPLSAVE",83,0)
 D:$G(GMPSAVED) DTMOD^GMPLX(GMPIFN)
"RTN","GMPLSAVE",84,0)
 Q
"RTN","GMPLSAVE",85,0)
 ;
"RTN","GMPLSAVE",86,0)
REFORM ; Audit Entry that has been Reformulated
"RTN","GMPLSAVE",87,0)
 S CHNGE=GMPIFN_"^1.01^"_NOW_U_DUZ_U_+GMPORIG(1.01)_U_+GMPFLD(1.01)_"^Reformulated^"_+$G(GMPROV)
"RTN","GMPLSAVE",88,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",89,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",90,0)
 Q
"RTN","GMPLSAVE",91,0)
 ;
"RTN","GMPLSAVE",92,0)
REACTV ; Audit Entry that has been Reactivated
"RTN","GMPLSAVE",93,0)
 S CHNGE=GMPIFN_"^.12^"_NOW_U_DUZ_"^I^A^Reactivated^"_+$G(GMPROV)
"RTN","GMPLSAVE",94,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",95,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",96,0)
 Q
"RTN","GMPLSAVE",97,0)
 ;
"RTN","GMPLSAVE",98,0)
NEW ; Save Collected Values in new Problem Entry
"RTN","GMPLSAVE",99,0)
 ;   Output   DA (left defined)
"RTN","GMPLSAVE",100,0)
 N DATA,APCDLOOK,APCDALVR,NUM,I,DIK,GMPICD,GMPIFN,X,CSID,CSAB,CSDT,GMPNOW,GMPIMPDT
"RTN","GMPLSAVE",101,0)
 S GMPNOW=$$NOW^XLFDT,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLSAVE",102,0)
 S CSDT=$S($P($G(GMPFLD(80201)),U)]"":$P($G(GMPFLD(80201)),U),1:DT)
"RTN","GMPLSAVE",103,0)
 S CSID=$S(+$G(GMPFLD(.01))>0:$$CSI^ICDEX(80,+$G(GMPFLD(.01))),1:$$CS^ICDEX(80,"E",CSDT))
"RTN","GMPLSAVE",104,0)
 S CSAB=$S($P($G(GMPFLD(80202)),U)]"":$P($G(GMPFLD(80202)),U),1:$$SAB^ICDEX(CSID,CSDT))
"RTN","GMPLSAVE",105,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX(CSAB,CSDT)
"RTN","GMPLSAVE",106,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX(CSAB,CSDT) ;chk for error from ICD
"RTN","GMPLSAVE",107,0)
 S GMPICD=$S($P($G(GMPFLD(.01)),U,2)]"":$P($G(GMPFLD(.01)),U,2),1:$$CODEC^ICDEX(80,$P($G(GMPFLD(.01)),U)))
"RTN","GMPLSAVE",108,0)
 S:$G(GMPFLD(80201))']"" GMPFLD(80201)=CSDT_U_$$EXTDT^GMPLX(CSDT)
"RTN","GMPLSAVE",109,0)
 S:$G(GMPFLD(80202))']"" GMPFLD(80202)=CSAB_U_$P($$CODECS^ICDEX($P(GMPICD,"/"),80,CSDT),U,2)
"RTN","GMPLSAVE",110,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",111,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",112,0)
 S:'GMPFLD(.05) X=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(X,+GMPFLD(1.01))
"RTN","GMPLSAVE",113,0)
 S:$G(GMPFLD(1.09))']"" GMPFLD(1.09)=$$DT^XLFDT
"RTN","GMPLSAVE",114,0)
 I $G(GMPFLD(1.01))["SNOMED CT" D
"RTN","GMPLSAVE",115,0)
 . N SCTC,SCTD,SCTS,SCTT,GMPTYP,GMPNUM,GMPQT,GMPSYN
"RTN","GMPLSAVE",116,0)
 . S (GMPTYP,GMPNUM,GMPQT)=""
"RTN","GMPLSAVE",117,0)
 . S SCTS=GMPFLD(1.01)
"RTN","GMPLSAVE",118,0)
 . S SCTT=$P($P(SCTS," (SNOMED CT "),U,2)
"RTN","GMPLSAVE",119,0)
 . S SCTC=$P($P(SCTS,"SNOMED CT ",2),")")
"RTN","GMPLSAVE",120,0)
 . S GMPFLD(80001)=SCTC_U_SCTC
"RTN","GMPLSAVE",121,0)
 . S SCTD=$$GETSYN^LEXTRAN1("SCT",SCTC,DT,"GMPSYN",1,1)
"RTN","GMPLSAVE",122,0)
 . I $P(SCTD,U)'=1 S SCTD="" Q
"RTN","GMPLSAVE",123,0)
 . F  S GMPTYP=$O(GMPSYN(GMPTYP)) Q:GMPTYP=""!(GMPQT)  D
"RTN","GMPLSAVE",124,0)
 . . I GMPTYP="S" F  S GMPNUM=$O(GMPSYN(GMPTYP,GMPNUM)) Q:GMPNUM=""!(GMPQT)  D
"RTN","GMPLSAVE",125,0)
 . . . I $P(GMPSYN(GMPTYP,GMPNUM),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP,GMPNUM),U,3),GMPQT=1 Q
"RTN","GMPLSAVE",126,0)
 . . Q:GMPQT
"RTN","GMPLSAVE",127,0)
 . . I $P(GMPSYN(GMPTYP),U)=SCTT S SCTD=$P(GMPSYN(GMPTYP),U,3),GMPQT=1 Q
"RTN","GMPLSAVE",128,0)
 . S GMPFLD(80002)=SCTD_U_SCTD K GMPSYN
"RTN","GMPLSAVE",129,0)
 I $G(GMPFLD(1.01))["VHAT" D
"RTN","GMPLSAVE",130,0)
 . N VHATC,VHATD,VHATS,VHATT
"RTN","GMPLSAVE",131,0)
 . S VHATS=GMPFLD(1.01)
"RTN","GMPLSAVE",132,0)
 . S VHATT=$P($P(VHATS," (VHAT "),U,2)
"RTN","GMPLSAVE",133,0)
 . S VHATC=$P($P(VHATS,"VHAT ",2),")")
"RTN","GMPLSAVE",134,0)
 . S GMPFLD(80003)=VHATC_U_VHATC
"RTN","GMPLSAVE",135,0)
 . S VHATD=$$GETDES^LEXTRAN1("VHAT",VHATT)
"RTN","GMPLSAVE",136,0)
 . I +VHATD=1 S VHATD=$P(VHATD,U,2),GMPFLD(80004)=VHATD_U_VHATD
"RTN","GMPLSAVE",137,0)
 S DA=$$NEWPROB(+GMPFLD(.01),+GMPDFN) Q:DA'>0
"RTN","GMPLSAVE",138,0)
 S NUM=$$NEXTNMBR(+GMPDFN,+GMPVAMC),GMPSAVED=1 S:'NUM NUM=""
"RTN","GMPLSAVE",139,0)
 ;   Set Node 0
"RTN","GMPLSAVE",140,0)
 S DATA=^AUPNPROB(DA,0)_U_DT_"^^"_$P(GMPFLD(.05),U)_U_+GMPVAMC_U_+NUM_U_DT_"^^^^"_$P(GMPFLD(.12),U)_U_$P(GMPFLD(.13),U)
"RTN","GMPLSAVE",141,0)
 S ^AUPNPROB(DA,0)=DATA
"RTN","GMPLSAVE",142,0)
 ;   Set Node 1
"RTN","GMPLSAVE",143,0)
 S DATA=$P(GMPFLD(1.01),U) F I=1.02:.01:1.18 S DATA=DATA_U_$S($P($G(GMPFLD(+I)),U)="@":"",1:$P($G(GMPFLD(+I)),U))
"RTN","GMPLSAVE",144,0)
 S ^AUPNPROB(DA,1)=DATA
"RTN","GMPLSAVE",145,0)
 ;   Set Node 800
"RTN","GMPLSAVE",146,0)
 I $S($L($P($G(GMPFLD(80001)),U)):1,$L($P($G(GMPFLD(80003)),U)):1,$L($P($G(GMPFLD(80004)),U)):1,$L($P($G(GMPFLD(80005)),U)):1,1:0) D
"RTN","GMPLSAVE",147,0)
 . I $P($G(GMPFLD(.01)),U)=$P($$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U)),U) S GMPFLD(80005)="1^PENDING"
"RTN","GMPLSAVE",148,0)
 . S DATA=$P($G(GMPFLD(80001)),U)_U_$P($G(GMPFLD(80002)),U)_U_$P($G(GMPFLD(80003)),U)_U_$P($G(GMPFLD(80004)),U)_U_$P($G(GMPFLD(80005)),U)
"RTN","GMPLSAVE",149,0)
 . S ^AUPNPROB(DA,800)=DATA
"RTN","GMPLSAVE",150,0)
 ;   Set Node 801
"RTN","GMPLSAVE",151,0)
 I $S($L($P($G(GMPFLD(80101)),U)):1,$L($P($G(GMPFLD(80102)),U)):1,1:0) D
"RTN","GMPLSAVE",152,0)
 . S DATA=$P($G(GMPFLD(80101)),U)_U_$P($G(GMPFLD(80102)),U)
"RTN","GMPLSAVE",153,0)
 . S ^AUPNPROB(DA,801)=DATA
"RTN","GMPLSAVE",154,0)
 ;   Set Node 802
"RTN","GMPLSAVE",155,0)
 I $S($L($P($G(GMPFLD(80201)),U)):1,$L($P($G(GMPFLD(80202)),U)):1,1:0) D
"RTN","GMPLSAVE",156,0)
 . S DATA=$P($G(GMPFLD(80201)),U)_U_$P($G(GMPFLD(80202)),U)
"RTN","GMPLSAVE",157,0)
 . S ^AUPNPROB(DA,802)=DATA
"RTN","GMPLSAVE",158,0)
 ;   Handle multiple ICDs
"RTN","GMPLSAVE",159,0)
 D COEXPRS(DA,GMPICD)
"RTN","GMPLSAVE",160,0)
 ;   Set X-Refs
"RTN","GMPLSAVE",161,0)
 S DIK="^AUPNPROB(",(APCDLOOK,APCDALVR)=1 D IX1^DIK
"RTN","GMPLSAVE",162,0)
 I $D(GMPFLD(10,"NEW"))>9 S GMPIFN=DA D NEWNOTE
"RTN","GMPLSAVE",163,0)
 I (GMPNOW<GMPIMPDT),($P(GMPICD,"/")=$P($$NOS^GMPLX($P(GMPFLD(80202),U),$P(GMPFLD(80201),U)),U,2)),(+$P($G(GMPFLD(80001)),U)>0) D NTRTBULL(.GMPBULL,$P(GMPFLD(1.01),U,2),$P($G(GMPFLD(80001)),U,2),$G(GMPSRCH))
"RTN","GMPLSAVE",164,0)
 ; broadcast event
"RTN","GMPLSAVE",165,0)
 N DFN S GMPIFN=DA,DFN=+GMPDFN
"RTN","GMPLSAVE",166,0)
 S X=+$O(^ORD(101,"B","GMPL EVENT",0))_";ORD(101," D:X EN1^XQOR
"RTN","GMPLSAVE",167,0)
 Q
"RTN","GMPLSAVE",168,0)
 ;
"RTN","GMPLSAVE",169,0)
NEWPROB(ICD,DFN) ; Creates New Problem Entry in file #9000011
"RTN","GMPLSAVE",170,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLSAVE",171,0)
 L +^AUPNPROB(0):1 I '$T D  Q -1
"RTN","GMPLSAVE",172,0)
 . W !!,"Someone else is currently editing this file."
"RTN","GMPLSAVE",173,0)
 . W !,"Please try again later.",!
"RTN","GMPLSAVE",174,0)
 S HDR=$G(^AUPNPROB(0)) Q:HDR="" -1
"RTN","GMPLSAVE",175,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",176,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(I,0))
"RTN","GMPLSAVE",177,0)
 S DA=I,^AUPNPROB(DA,0)=ICD_U_DFN
"RTN","GMPLSAVE",178,0)
 S ^AUPNPROB("B",ICD,DA)="",^AUPNPROB("AC",DFN,DA)=""
"RTN","GMPLSAVE",179,0)
 S $P(^AUPNPROB(0),U,3,4)=DA_U_(TOTAL+1) L -^AUPNPROB(0)
"RTN","GMPLSAVE",180,0)
 Q DA
"RTN","GMPLSAVE",181,0)
 ;
"RTN","GMPLSAVE",182,0)
NEWNOTE ; Creates New Note Entries for Problem
"RTN","GMPLSAVE",183,0)
 ;   Requires GMPIFN   Pointer to Problem
"RTN","GMPLSAVE",184,0)
 ;            GMPROV   Current Provider
"RTN","GMPLSAVE",185,0)
 ;            GMPVAMC  Facility
"RTN","GMPLSAVE",186,0)
 N HDR,LAST,TOTAL,I,FAC,NIFN
"RTN","GMPLSAVE",187,0)
 L +^AUPNPROB(GMPIFN,11):1 I '$T Q
"RTN","GMPLSAVE",188,0)
 S FAC=+$O(^AUPNPROB(GMPIFN,11,"B",GMPVAMC,0)) I 'FAC D
"RTN","GMPLSAVE",189,0)
 . S:'$D(^AUPNPROB(GMPIFN,11,0)) ^(0)="^9000011.11PA^^"
"RTN","GMPLSAVE",190,0)
 . S HDR=^AUPNPROB(GMPIFN,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",191,0)
 . F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,I,0))
"RTN","GMPLSAVE",192,0)
 . S ^AUPNPROB(GMPIFN,11,I,0)=GMPVAMC,^AUPNPROB(GMPIFN,11,"B",GMPVAMC,I)=""
"RTN","GMPLSAVE",193,0)
 . S FAC=I,$P(^AUPNPROB(GMPIFN,11,0),U,3,4)=FAC_U_(TOTAL+1)
"RTN","GMPLSAVE",194,0)
 I FAC'>0 G NNQ
"RTN","GMPLSAVE",195,0)
NN1 ; Get New Note
"RTN","GMPLSAVE",196,0)
 S:'$D(^AUPNPROB(GMPIFN,11,FAC,11,0)) ^(0)="^9000011.1111IA^^"
"RTN","GMPLSAVE",197,0)
 S HDR=^AUPNPROB(GMPIFN,11,FAC,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",198,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,FAC,11,I,0))
"RTN","GMPLSAVE",199,0)
 S NIFN=I
"RTN","GMPLSAVE",200,0)
 F I=0:0 S I=$O(GMPFLD(10,"NEW",I)) Q:I'>0  D
"RTN","GMPLSAVE",201,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)=NIFN_"^^"_GMPFLD(10,"NEW",I)_"^A^"_DT_U_+$G(GMPROV)
"RTN","GMPLSAVE",202,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,"B",NIFN,NIFN)=""
"RTN","GMPLSAVE",203,0)
 . S TOTAL=TOTAL+1,LAST=NIFN,NIFN=NIFN+1
"RTN","GMPLSAVE",204,0)
 S $P(^AUPNPROB(GMPIFN,11,FAC,11,0),U,3,4)=LAST_U_TOTAL
"RTN","GMPLSAVE",205,0)
NNQ ; Quit Getting New Notes
"RTN","GMPLSAVE",206,0)
 L -^AUPNPROB(GMPIFN,11)
"RTN","GMPLSAVE",207,0)
 Q
"RTN","GMPLSAVE",208,0)
 ;
"RTN","GMPLSAVE",209,0)
NEXTNMBR(DFN,VAMC) ; Returns Next Available Problem Number
"RTN","GMPLSAVE",210,0)
 N I,J,NUM S NUM=1,I="" I '$D(^AUPNPROB("AA",DFN,VAMC)) Q NUM
"RTN","GMPLSAVE",211,0)
 F  S I=$O(^AUPNPROB("AA",DFN,VAMC,I)) Q:I=""  S J=$E(I,2,999),NUM=+J
"RTN","GMPLSAVE",212,0)
 S NUM=NUM+1
"RTN","GMPLSAVE",213,0)
 Q NUM
"RTN","GMPLSAVE",214,0)
NTRTBULL(GMPY,GMPTERM,GMPSCT,GMPSRCH) ; Send NTRT Request bulletin to NTRT mailgroup
"RTN","GMPLSAVE",215,0)
 N GMPSITE,GMPSVC,GMPUSER,GMPWRAP,XMBNM,XMDUZ,XMY,XMB,XMZ S GMPSITE=$$SITE^VASITE
"RTN","GMPLSAVE",216,0)
 I '$L(GMPTERM) S GMPY="0^Empty String - a valid term must be sent." Q
"RTN","GMPLSAVE",217,0)
 I '+$G(DUZ)!'$D(^VA(200,+$G(DUZ))) S GMPY="0^A valid user must be identified." Q
"RTN","GMPLSAVE",218,0)
 I '+$G(GMPSCT) S GMPSCT="N/A"
"RTN","GMPLSAVE",219,0)
 D USERINFO^XUSRB2(.GMPUSER) S GMPSVC=$G(GMPUSER(5))
"RTN","GMPLSAVE",220,0)
 S XMB="GMPL PROBLEM NTRT BULLETIN"
"RTN","GMPLSAVE",221,0)
 S XMDUZ="GMPL PROBLEM NTRT BULLETIN"
"RTN","GMPLSAVE",222,0)
 S XMY("G.PROBLEM LIST NTRT@aadomain.ext")=""
"RTN","GMPLSAVE",223,0)
 S GMPWRAP=$$WRAP^GMPLX1(GMPTERM,53)
"RTN","GMPLSAVE",224,0)
 S XMB(1)=GMPTERM
"RTN","GMPLSAVE",225,0)
 S XMB(2)=GMPSCT
"RTN","GMPLSAVE",226,0)
 S XMB(3)=$$GET1^DIQ(200,DUZ_",",.01)
"RTN","GMPLSAVE",227,0)
 S XMB(4)=$$FMTE^XLFDT($E(($$NOW^XLFDT),1,12),2)
"RTN","GMPLSAVE",228,0)
 S XMB(5)=GMPSVC
"RTN","GMPLSAVE",229,0)
 S XMB(6)=$P(GMPSITE,U,2)_" ("_$P(GMPSITE,U,3)_")"
"RTN","GMPLSAVE",230,0)
 S XMB(7)=$G(GMPSRCH)
"RTN","GMPLSAVE",231,0)
 D ^XMB,KILL^XM S GMPY=1
"RTN","GMPLSAVE",232,0)
 Q
"RTN","GMPLSAVE",233,0)
COEXPRS(GMPDA,GMPICD) ; File multiple ICDs
"RTN","GMPLSAVE",234,0)
 N GMPC,GMPI,GMPN,GMPJ,GMPORIG,NOW,GMPOCNT,GMPNCNT,CODSYS S NOW=$$NOW^XLFDT
"RTN","GMPLSAVE",235,0)
 ; Initialize CODSYS to "ICD" when ICD-10-CM is implemented, new codes will get "10D"
"RTN","GMPLSAVE",236,0)
 S CODSYS=$$SAB^ICDEX(+$$CODECS^ICDEX($P(GMPICD,"/"),80,DT),DT)
"RTN","GMPLSAVE",237,0)
 ; Merge previous entries into local GMPORIG array
"RTN","GMPLSAVE",238,0)
 I $D(^AUPNPROB(GMPDA,803)) M GMPORIG=^AUPNPROB(GMPDA,803)
"RTN","GMPLSAVE",239,0)
 ; If not sparce ICD string, remove previous entries
"RTN","GMPLSAVE",240,0)
 S GMPNCNT=+$P($G(^AUPNPROB(GMPDA,803,0)),U,4)
"RTN","GMPLSAVE",241,0)
 I '$$SPRCICD(GMPICD) D
"RTN","GMPLSAVE",242,0)
 . N GMPLFDA
"RTN","GMPLSAVE",243,0)
 . F GMPJ=1:1:GMPNCNT D
"RTN","GMPLSAVE",244,0)
 . . S GMPLFDA(9000011.803,""_GMPJ_","_GMPDA_",",.01)="@"
"RTN","GMPLSAVE",245,0)
 . . D FILE^DIE("","GMPLFDA")
"RTN","GMPLSAVE",246,0)
 ; Update sub-file
"RTN","GMPLSAVE",247,0)
 S GMPN=$L(GMPICD,"/")-1
"RTN","GMPLSAVE",248,0)
 F GMPI=1:1:GMPN D
"RTN","GMPLSAVE",249,0)
 . N GMPCODE,GMPD30,GMPNOS,GMPFDA,Y,GMPDT S GMPNOS=$$NOS^GMPLX(CODSYS)
"RTN","GMPLSAVE",250,0)
 . S GMPCODE=$P(GMPICD,"/",(GMPI+1)) Q:(GMPCODE="")
"RTN","GMPLSAVE",251,0)
 . S GMPD30=$G(^AUPNPROB(GMPDA,803,GMPI,0))
"RTN","GMPLSAVE",252,0)
 . I (GMPCODE=$P(GMPNOS,U,2)),($P(GMPD30,U)]""),($P(GMPD30,U)'=$P(GMPNOS,U,2)) Q
"RTN","GMPLSAVE",253,0)
 . S Y=DT D DD^%DT S GMPDT=$G(Y)
"RTN","GMPLSAVE",254,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.01)=GMPCODE
"RTN","GMPLSAVE",255,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.02)=CODSYS
"RTN","GMPLSAVE",256,0)
 . S GMPFDA(9000011.803,"+2,"_GMPDA_",",.03)=GMPDT
"RTN","GMPLSAVE",257,0)
 . D UPDATE^DIE("E","GMPFDA")
"RTN","GMPLSAVE",258,0)
 I '$D(GMPORIG) Q
"RTN","GMPLSAVE",259,0)
 S GMPOCNT=+$P($G(GMPORIG(0)),U,4)
"RTN","GMPLSAVE",260,0)
 ; Iterate through GMPORIG and audit changes
"RTN","GMPLSAVE",261,0)
 S GMPI=0 F  S GMPI=$O(GMPORIG(GMPI)) Q:+GMPI'>0  D
"RTN","GMPLSAVE",262,0)
 . N CHANGE,OLD0,NEW0
"RTN","GMPLSAVE",263,0)
 . S OLD0=$G(GMPORIG(GMPI,0)),NEW0=$G(^AUPNPROB(GMPDA,803,GMPI,0))
"RTN","GMPLSAVE",264,0)
 . I $P(NEW0,U)=$P(OLD0,U) Q  ; no substantive change change
"RTN","GMPLSAVE",265,0)
 . I NEW0'="" S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_$P(OLD0,U)_U_$P(NEW0,U)_"^SNOMED CT Concept re-mapped by Enterprise Terminology Service^"_+$G(GMPROV)
"RTN","GMPLSAVE",266,0)
 . E  S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_$P(OLD0,U)_U_"^Deleted Secondary Dx for SNOMED CT Concept^"_+$G(GMPROV)
"RTN","GMPLSAVE",267,0)
 . D AUDIT^GMPLX(CHANGE,OLD0)
"RTN","GMPLSAVE",268,0)
 I GMPNCNT>GMPOCNT D
"RTN","GMPLSAVE",269,0)
 . S GMPI=GMPOCNT
"RTN","GMPLSAVE",270,0)
 . F  S GMPI=$O(^AUPNPROB(GMPDA,803,GMPI)) Q:+GMPI'>0  D
"RTN","GMPLSAVE",271,0)
 . . N NEW0,CHANGE S NEW0=$G(^AUPNPROB(GMPDA,803,GMPI,0))
"RTN","GMPLSAVE",272,0)
 . . S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_U_$P(NEW0,U)_"^Added as Secondary Dx for SNOMED CT Concept^"_+$G(GMPROV)
"RTN","GMPLSAVE",273,0)
 . . D AUDIT^GMPLX(CHANGE,"")
"RTN","GMPLSAVE",274,0)
 Q
"RTN","GMPLSAVE",275,0)
SPRCICD(GMPICD) ; Is ICD string sparce (i.e., called from SDS API w/order > 2)?
"RTN","GMPLSAVE",276,0)
 N GMPI,GMPY S GMPY=0
"RTN","GMPLSAVE",277,0)
 F GMPI=2:1:$L(GMPICD,"/") I $S($P(GMPICD,"/",GMPI)="":1,$P(GMPICD,"/",GMPI)=$P($$NOS^GMPLX,U,2):1,1:0) S GMPY=1
"RTN","GMPLSAVE",278,0)
 Q GMPY
"RTN","GMPLUTL2")
0^1^B93300856
"RTN","GMPLUTL2",1,0)
GMPLUTL2 ; ISL/MKB,KER,JER,TC -- PL Utilities (OE/TIU) ;08/26/14  11:54
"RTN","GMPLUTL2",2,0)
 ;;2.0;Problem List;**10,18,21,26,35,36,42,45**;Aug 25, 1994;Build 53
"RTN","GMPLUTL2",3,0)
 ;
"RTN","GMPLUTL2",4,0)
 ; External References
"RTN","GMPLUTL2",5,0)
 ;   DBIA   348  ^DPT(  file #2
"RTN","GMPLUTL2",6,0)
 ;    ICR  5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL2",7,0)
 ;    ICR  5747  $$SAB^ICDEX,$$CODECS^ICDEX,$$CSI^ICDEX
"RTN","GMPLUTL2",8,0)
 ;   DBIA 10040  ^SC(  file #44
"RTN","GMPLUTL2",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL2",10,0)
 ;   DBIA  2716  $$GETSTAT^DGMSTAPI
"RTN","GMPLUTL2",11,0)
 ;   DBIA  3457  $$GETCUR^DGNTAPI
"RTN","GMPLUTL2",12,0)
 ;   DBIA 10062  7^VADPT
"RTN","GMPLUTL2",13,0)
 ;   DBIA 10062  DEM^VADPT
"RTN","GMPLUTL2",14,0)
 ;   DBIA 10118  EN^VALM
"RTN","GMPLUTL2",15,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLUTL2",16,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLUTL2",17,0)
 ;
"RTN","GMPLUTL2",18,0)
LIST(GMPL,GMPDFN,GMPSTAT,GMPCOMM) ; Returns list of Problems for Patient
"RTN","GMPLUTL2",19,0)
 D LIST^GMPLUTL3
"RTN","GMPLUTL2",20,0)
 Q
"RTN","GMPLUTL2",21,0)
 ;
"RTN","GMPLUTL2",22,0)
DETAIL(IFN,GMPL) ; Returns Detailed Data for Problem
"RTN","GMPLUTL2",23,0)
 ;
"RTN","GMPLUTL2",24,0)
 ; Input   IFN  Pointer to Problem file #9000011
"RTN","GMPLUTL2",25,0)
 ;
"RTN","GMPLUTL2",26,0)
 ; Output  GMPL Array, passed by reference
"RTN","GMPLUTL2",27,0)
 ;         GMPL("DATA NAME") = External Format of Value
"RTN","GMPLUTL2",28,0)
 ;
"RTN","GMPLUTL2",29,0)
 ;         GMPL("DIAGNOSIS")  ICD Code
"RTN","GMPLUTL2",30,0)
 ;         GMPL("ICDD")       ICD Description
"RTN","GMPLUTL2",31,0)
 ;         GMPL("CSYS")       Coding System (#80202) [ex: 10D (ICD-10) & ICD (ICD-9)]
"RTN","GMPLUTL2",32,0)
 ;         GMPL("DTINTEREST") Date of Interest (#80201)
"RTN","GMPLUTL2",33,0)
 ;         GMPL("PATIENT")    Patient Name
"RTN","GMPLUTL2",34,0)
 ;         GMPL("MODIFIED")   Date Last Modified
"RTN","GMPLUTL2",35,0)
 ;         GMPL("NARRATIVE")  Provider Narrative
"RTN","GMPLUTL2",36,0)
 ;         GMPL("ENTERED")    Date Entered ^ Entered by
"RTN","GMPLUTL2",37,0)
 ;         GMPL("STATUS")     Status
"RTN","GMPLUTL2",38,0)
 ;         GMPL("PRIORITY")   Priority Acute/Chronic
"RTN","GMPLUTL2",39,0)
 ;         GMPL("ONSET")      Date of Onset
"RTN","GMPLUTL2",40,0)
 ;         GMPL("PROVIDER")   Responsible Provider
"RTN","GMPLUTL2",41,0)
 ;         GMPL("RECORDED")   Date Recorded ^ Recorded by
"RTN","GMPLUTL2",42,0)
 ;         GMPL("CONDITION")  Patient Condition (#1.02)
"RTN","GMPLUTL2",43,0)
 ;         GMPL("RESOLVED")   Date Resolved (#1.07)
"RTN","GMPLUTL2",44,0)
 ;         GMPL("CLINIC")     Hospital Location
"RTN","GMPLUTL2",45,0)
 ;         GMPL("SERVICE")    Service (#1.06)
"RTN","GMPLUTL2",46,0)
 ;         GMPL("FACILITY")   Facility ID ^ Facility Name (#.06)
"RTN","GMPLUTL2",47,0)
 ;         GMPL("SC")         Service Connected SC/NSC/""
"RTN","GMPLUTL2",48,0)
 ;         GMPL("SCTC")       SNOMED-CT Concept Code
"RTN","GMPLUTL2",49,0)
 ;         GMPL("SCTD")       SNOMED-CT Designation Code
"RTN","GMPLUTL2",50,0)
 ;         GMPL("SCTT")       SNOMED-CT Preferred Text
"RTN","GMPLUTL2",51,0)
 ;         GMPL("VHATC")      VHAT Concept Code
"RTN","GMPLUTL2",52,0)
 ;         GMPL("VHATD")      VHAT Designation Code
"RTN","GMPLUTL2",53,0)
 ;         GMPL("VHATT")      VHAT Preferred Text
"RTN","GMPLUTL2",54,0)
 ;
"RTN","GMPLUTL2",55,0)
 ;         GMPL("ICD9MLTP") = #
"RTN","GMPLUTL2",56,0)
 ;         GMPL("ICD9MLTP",CNT) = ICD-9-CM/ICD-10-CM Code^ICD-9-CM/ICD-10-CM Description^ICD Coding System
"RTN","GMPLUTL2",57,0)
 ;
"RTN","GMPLUTL2",58,0)
 ;         GMPL("EXPOSURE") = #
"RTN","GMPLUTL2",59,0)
 ;         GMPL("EXPOSURE",X)="AGENT ORANGE"
"RTN","GMPLUTL2",60,0)
 ;         GMPL("EXPOSURE",X)="RADIATION"
"RTN","GMPLUTL2",61,0)
 ;         GMPL("EXPOSURE",X)="ENV CONTAMINANTS"
"RTN","GMPLUTL2",62,0)
 ;         GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER"
"RTN","GMPLUTL2",63,0)
 ;         GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA"
"RTN","GMPLUTL2",64,0)
 ;         GMPL("EXPOSURE",X)="COMBAT VET"
"RTN","GMPLUTL2",65,0)
 ;         GMPL("EXPOSURE",X)="SHAD"
"RTN","GMPLUTL2",66,0)
 ;
"RTN","GMPLUTL2",67,0)
 ;         GMPL("COMMENT") = #
"RTN","GMPLUTL2",68,0)
 ;         GMPL("COMMENT",CNT) = Date ^ Author ^ Text of Note
"RTN","GMPLUTL2",69,0)
 ;
"RTN","GMPLUTL2",70,0)
 N GMPL0,GMPL1,GMPL800,GMPL802,GMPL803,GMPLP,X,I,FAC,CNT,NIFN,GMPLNTDT,GMPLATHR,GMPLTEXT Q:'$D(^AUPNPROB(IFN,0))
"RTN","GMPLUTL2",71,0)
 K ^TMP("GMPLCMT",$J)
"RTN","GMPLUTL2",72,0)
 S GMPLP=+($$PTR^GMPLUTL4)
"RTN","GMPLUTL2",73,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),GMPL803=$G(^(803,0))
"RTN","GMPLUTL2",74,0)
 S GMPL("DTINTEREST")=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPL("CSYS")=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPL("DTINTEREST")))
"RTN","GMPLUTL2",75,0)
 S GMPL("DIAGNOSIS")=$P($$ICDDATA^ICDXCODE(GMPL("CSYS"),+GMPL0,GMPL("DTINTEREST"),"I"),U,2)
"RTN","GMPLUTL2",76,0)
 S GMPL("FACILITY")=$$RESOLVE(IFN,".06","IE")
"RTN","GMPLUTL2",77,0)
 S GMPL("ICDD")=$$ICDDESC(GMPL("DIAGNOSIS"),GMPL("DTINTEREST"),GMPL("CSYS"))
"RTN","GMPLUTL2",78,0)
 S GMPL("PATIENT")=$P($G(^DPT(+$P(GMPL0,U,2),0)),U)
"RTN","GMPLUTL2",79,0)
 S GMPL("MODIFIED")=$$EXTDT^GMPLX($P(GMPL0,U,3))
"RTN","GMPLUTL2",80,0)
 S GMPL("NARRATIVE")=$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL2",81,0)
 S GMPL("ENTERED")=$$EXTDT^GMPLX($P(GMPL0,U,8))_U_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U)
"RTN","GMPLUTL2",82,0)
 S X=$P(GMPL0,U,12),GMPL("STATUS")=$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLUTL2",83,0)
 S X=$S(X'="A":"",1:$P(GMPL1,U,14)),GMPL("PRIORITY")=$S(X="A":"ACUTE",X="C":"CHRONIC",1:"")
"RTN","GMPLUTL2",84,0)
 S GMPL("ONSET")=$$EXTDT^GMPLX($P(GMPL0,U,13))
"RTN","GMPLUTL2",85,0)
 S GMPL("CONDITION")=$$RESOLVE(IFN,"1.02","E")
"RTN","GMPLUTL2",86,0)
 S GMPL("PROVIDER")=$P($G(^VA(200,+$P(GMPL1,U,5),0)),U)
"RTN","GMPLUTL2",87,0)
 S GMPL("RECORDED")=$$EXTDT^GMPLX($P(GMPL1,U,9))_U_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLUTL2",88,0)
 S GMPL("RESOLVED")=$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLUTL2",89,0)
 S GMPL("CLINIC")=$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLUTL2",90,0)
 S GMPL("SERVICE")=$$RESOLVE(IFN,1.06,"E")
"RTN","GMPLUTL2",91,0)
 S GMPL("SCTC")=$P(GMPL800,U),GMPL("SCTD")=$P(GMPL800,U,2)
"RTN","GMPLUTL2",92,0)
 I $L($G(GMPL("SCTC"))) S GMPL("SCTT")=$P($$SCTTEXT(GMPL("SCTC"),$P(GMPL0,U,8),"SCT"),U)
"RTN","GMPLUTL2",93,0)
 S GMPL("VHATC")=$P(GMPL800,U,3),GMPL("VHATD")=$P(GMPL800,U,4)
"RTN","GMPLUTL2",94,0)
 I $L($G(GMPL("VHATC"))) S GMPL("VHATT")=$$SCTTEXT(GMPL("VHATC"),$P(GMPL0,U,8),"VHAT")
"RTN","GMPLUTL2",95,0)
 S GMPL("ICD9MLTP")=""
"RTN","GMPLUTL2",96,0)
 I $L($G(GMPL803))>0 D
"RTN","GMPLUTL2",97,0)
 . N DA,ICDDESC S (CNT,DA)=0,GMPL("ICD9MLTP")=0 F  S DA=$O(^AUPNPROB(IFN,803,DA)) Q:'+DA  D
"RTN","GMPLUTL2",98,0)
 . . S X=$G(^AUPNPROB(IFN,803,DA,0)),ICDDESC=$$ICDDESC($P(X,U),$P(X,U,3),$P(X,U,2))
"RTN","GMPLUTL2",99,0)
 . . S CNT=CNT+1,GMPL("ICD9MLTP",CNT)=$P(X,U)_U_$G(ICDDESC)_U_$P(X,U,2)
"RTN","GMPLUTL2",100,0)
 . S GMPL("ICD9MLTP")=CNT
"RTN","GMPLUTL2",101,0)
 S GMPL("SC")=$S($P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"UNKNOWN")
"RTN","GMPLUTL2",102,0)
 S GMPL("EXPOSURE")=0
"RTN","GMPLUTL2",103,0)
 I $P(GMPL1,U,11) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="AGENT ORANGE",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",104,0)
 I $P(GMPL1,U,12) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="RADIATION",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",105,0)
 I $P(GMPL1,U,13) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="ENV CONTAMINANTS",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",106,0)
 I $P(GMPL1,U,15) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",107,0)
 I $P(GMPL1,U,16) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",108,0)
 I $P(GMPL1,U,17) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="COMBAT VET",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",109,0)
 I $P(GMPL1,U,18)&(GMPLP'>0) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="SHAD",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",110,0)
 S (FAC,CNT)=0,GMPL("COMMENT")=0
"RTN","GMPLUTL2",111,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLUTL2",112,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:NIFN'>0  D
"RTN","GMPLUTL2",113,0)
 . . S X=$G(^AUPNPROB(IFN,11,FAC,11,NIFN,0))
"RTN","GMPLUTL2",114,0)
 . . S GMPLNTDT=$P(X,U,5),GMPLATHR=$P(X,U,6),GMPLTEXT=$P(X,U,3)
"RTN","GMPLUTL2",115,0)
 . . I $L(X) S ^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)=$$EXTDT^GMPLX(GMPLNTDT)_U_$P($G(^VA(200,+GMPLATHR,0)),U)_U_GMPLTEXT
"RTN","GMPLUTL2",116,0)
 S (GMPLNTDT,NIFN)=""
"RTN","GMPLUTL2",117,0)
 F  S GMPLNTDT=$O(^TMP("GMPLCMT",$J,GMPLNTDT),-1) Q:GMPLNTDT=""  D
"RTN","GMPLUTL2",118,0)
 . F  S NIFN=$O(^TMP("GMPLCMT",$J,GMPLNTDT,NIFN),-1) Q:NIFN=""  D
"RTN","GMPLUTL2",119,0)
 . . S CNT=CNT+1,GMPL("COMMENT",CNT)=^TMP("GMPLCMT",$J,GMPLNTDT,NIFN)
"RTN","GMPLUTL2",120,0)
 K ^TMP("GMPLCMT",$J)
"RTN","GMPLUTL2",121,0)
 S GMPL("COMMENT")=CNT D AUDIT
"RTN","GMPLUTL2",122,0)
 Q
"RTN","GMPLUTL2",123,0)
 ;
"RTN","GMPLUTL2",124,0)
RESOLVE(IEN,FIELD,FORMAT) ; Call GET1^DIQ to resolve field values
"RTN","GMPLUTL2",125,0)
 ;  Input:    IEN = Record #
"RTN","GMPLUTL2",126,0)
 ;          FIELD = Field # in PROBLEMS file #9000011
"RTN","GMPLUTL2",127,0)
 ;         FORMAT = "I"nternal, "E"xternal, or "IE" -> both
"RTN","GMPLUTL2",128,0)
 ; Output: GMPLY = value as specified by format
"RTN","GMPLUTL2",129,0)
 N GMPLY
"RTN","GMPLUTL2",130,0)
 S IEN=IEN_","
"RTN","GMPLUTL2",131,0)
 S GMPLY=$$GET1^DIQ(9000011,IEN,FIELD,FORMAT)
"RTN","GMPLUTL2",132,0)
 S:FORMAT="IE" GMPLY=GMPLY_U_$$GET1^DIQ(9000011,IEN,FIELD,"E")
"RTN","GMPLUTL2",133,0)
 Q GMPLY
"RTN","GMPLUTL2",134,0)
AUDIT ; 14 Sep 99 - MA - Add audit trail to OE Problem List.
"RTN","GMPLUTL2",135,0)
 ; Called from DETAIL, requires IFN and sets GMPL("AUDIT")
"RTN","GMPLUTL2",136,0)
 N IDT,AIFN,X0,X1,FLD,CNT
"RTN","GMPLUTL2",137,0)
 S CNT=0,GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",138,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",IFN,IDT)) Q:IDT'>0  D
"RTN","GMPLUTL2",139,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",IFN,IDT,AIFN)) Q:AIFN'>0  D
"RTN","GMPLUTL2",140,0)
 .. S X0=$G(^GMPL(125.8,AIFN,0)),X1=$G(^(1)) Q:'$L(X0)
"RTN","GMPLUTL2",141,0)
 .. S FLD=$$FLDNAME(+$P(X0,U,2))
"RTN","GMPLUTL2",142,0)
 .. S CNT=CNT+1
"RTN","GMPLUTL2",143,0)
 .. S GMPL("AUDIT",CNT,0)=$P(X0,U,2)_U_FLD_U_$P(X0,U,3,8)
"RTN","GMPLUTL2",144,0)
 .. ; = pointer#^fld name^date mod^who mod^old^new^reason^prov
"RTN","GMPLUTL2",145,0)
 .. S:$L(X1) GMPL("AUDIT",CNT,1)=X1
"RTN","GMPLUTL2",146,0)
 S GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",147,0)
 Q
"RTN","GMPLUTL2",148,0)
 ;
"RTN","GMPLUTL2",149,0)
FLDNAME(NUM) ; Returns field name for display
"RTN","GMPLUTL2",150,0)
 N NAME,NM1,NM2,I,J S J=0,NAME=""
"RTN","GMPLUTL2",151,0)
 S NM1=".01^.05^.12^.13^1.01^1.02^1.04^1.05^1.06^1.07^1.08^1.09^1.1^1.11^1.12^1.13^1.14^1.15^1.16^1.17^1.18^80001^80002^80003^80004^80005^302^1101"
"RTN","GMPLUTL2",152,0)
 F I=1:1:$L(NM1,U) I +$P(NM1,U,I)=+NUM S J=I Q
"RTN","GMPLUTL2",153,0)
 G:J'>0 FNQ
"RTN","GMPLUTL2",154,0)
 S NM2="DIAGNOSIS^PROVIDER NARRATIVE^STATUS^DATE OF ONSET^PROBLEM^CONDITION^RECORDING PROVIDER^RESPONSIBLE PROVIDER"
"RTN","GMPLUTL2",155,0)
 S NM2=NM2_"^SERVICE^DATE RESOLVED^CLINIC^DATE RECORDED^SERVICE CONNECTED^AGENT ORANGE EXP^RADIATION EXP^ENV CONTAMINANTS EXP"
"RTN","GMPLUTL2",156,0)
 S NM2=NM2_"^IMMEDIACY^HEAD & NECK CANCER^MIL SEX TRAUMA^COMBAT VET^SHIPBOARD HAZARD EXP^SNOMED CT CONCEPT^SNOMED CT DESIGNATION"
"RTN","GMPLUTL2",157,0)
 S NM2=NM2_"^VHAT CONCEPT^VHAT DESIGNATION^SNOMED CT/ICD MAP STATUS^SECONDARY DIAGNOSIS^NOTE"
"RTN","GMPLUTL2",158,0)
 S NAME=$P(NM2,U,J)
"RTN","GMPLUTL2",159,0)
FNQ Q NAME
"RTN","GMPLUTL2",160,0)
 ;
"RTN","GMPLUTL2",161,0)
ADD(DFN,LOC,GMPROV) ; -- Interactive LMgr action to add new problem
"RTN","GMPLUTL2",162,0)
 N X,Y,GMPDFN,GMPVA,GMPVAMC,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",163,0)
 N GMPARAM,GMPLVIEW,GMPLUSER,GMPCLIN,GMPLSLST,GMPQUIT,VALMCC,GMPSAVED
"RTN","GMPLUTL2",164,0)
 Q:'DFN  Q:'LOC  D SETVARS
"RTN","GMPLUTL2",165,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2),VALMCC=0
"RTN","GMPLUTL2",166,0)
 I 'GMPLSLST,GMPCLIN,$D(^GMPL(125,"C",+GMPCLIN)) S GMPLSLST=$O(^(+GMPCLIN,0))
"RTN","GMPLUTL2",167,0)
 I GMPLSLST D  Q
"RTN","GMPLUTL2",168,0)
 . S $P(GMPLSLST,U,2)=$P($G(^GMPL(125,+GMPLSLST,0)),U)
"RTN","GMPLUTL2",169,0)
 . D EN^VALM("GMPL LIST MENU")
"RTN","GMPLUTL2",170,0)
 F  D ADD^GMPL1 Q:$D(GMPQUIT)  K DUOUT,DTOUT,GMPSAVED W !!,">>>  Please enter another problem, or press <return> to exit."
"RTN","GMPLUTL2",171,0)
 Q
"RTN","GMPLUTL2",172,0)
 ;
"RTN","GMPLUTL2",173,0)
SETVARS ; -- Define GMP* variables used in ADD and EDIT
"RTN","GMPLUTL2",174,0)
 N VA,VADM,VAEL,VASV,X
"RTN","GMPLUTL2",175,0)
 Q:'DFN  D DEM^VADPT,7^VADPT
"RTN","GMPLUTL2",176,0)
 S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")_$S(VADM(6):U_+VADM(6),1:"")
"RTN","GMPLUTL2",177,0)
 S AUPNSEX=$P(VADM(5),U),GMPVA=1,GMPSC=VAEL(3),GMPAGTOR=VASV(2),GMPION=VASV(3)
"RTN","GMPLUTL2",178,0)
 S X=$P($G(^DPT(DFN,.322)),U,10),GMPGULF=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",179,0)
 S GMPCV=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) GMPCV=1 ;CV
"RTN","GMPLUTL2",180,0)
 S GMPSHD=+$G(VASV(14,1)) ;SHAD
"RTN","GMPLUTL2",181,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),GMPHNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLUTL2",182,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),GMPMST=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",183,0)
 S GMPLVIEW("VIEW")=$S($P($G(^SC(+$G(LOC),0)),U,3)="C":"C",1:"S")
"RTN","GMPLUTL2",184,0)
 S GMPCLIN="" I $G(LOC),GMPLVIEW("VIEW")="C" S GMPCLIN=+LOC_U_$P(^SC(+LOC,0),U)
"RTN","GMPLUTL2",185,0)
 S X=$$PARAM,GMPARAM("VER")=+$P(X,U,2),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=+$P(X,U,5)
"RTN","GMPLUTL2",186,0)
 S:+GMPROV=DUZ GMPLUSER=1 S GMPVAMC=+$G(DUZ(2)),GMPLIST(0)=0
"RTN","GMPLUTL2",187,0)
 Q
"RTN","GMPLUTL2",188,0)
 ;
"RTN","GMPLUTL2",189,0)
EDIT(DFN,LOC,GMPROV,GMPIFN) ; Interactive LMgr action to edit a problem
"RTN","GMPLUTL2",190,0)
 N GMPARAM,GMPDFN,GMPVA,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",191,0)
 N GMPLVIEW,GMPCLIN,GMPLJUMP,GMPQUIT,GMPLUSER,GMPLVAMC,AUPNSEX
"RTN","GMPLUTL2",192,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPLUTL2",193,0)
 D SETVARS,EN^VALM("GMPL EDIT PROBLEM")
"RTN","GMPLUTL2",194,0)
 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPLUTL2",195,0)
 Q
"RTN","GMPLUTL2",196,0)
 ;
"RTN","GMPLUTL2",197,0)
REMOVE(GMPIFN,GMPROV,TEXT,PLY) ; -- Remove problem GMPIFN
"RTN","GMPLUTL2",198,0)
 N GMPVAMC,CHANGE
"RTN","GMPLUTL2",199,0)
 S GMPVAMC=+$G(DUZ(2)),PLY=-1,PLY(0)=""
"RTN","GMPLUTL2",200,0)
 I '$L($G(^AUPNPROB(GMPIFN,0))) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL2",201,0)
 I '$D(^VA(200,+$G(GMPROV),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL2",202,0)
 I $L($G(TEXT)) S GMPFLD(10,"NEW",1)=TEXT D NEWNOTE^GMPLSAVE
"RTN","GMPLUTL2",203,0)
 S CHANGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_U_$P($G(^AUPNPROB(GMPIFN,1)),U,2)_"^H^Deleted^"_+$G(GMPROV),$P(^AUPNPROB(GMPIFN,1),U,2)="H",PLY=GMPIFN
"RTN","GMPLUTL2",204,0)
 D AUDIT^GMPLX(CHANGE,""),DTMOD^GMPLX(GMPIFN)
"RTN","GMPLUTL2",205,0)
 Q
"RTN","GMPLUTL2",206,0)
 ;
"RTN","GMPLUTL2",207,0)
PARAM() ; -- Returns parameter values from 125.99
"RTN","GMPLUTL2",208,0)
 Q $G(^GMPL(125.99,1,0))
"RTN","GMPLUTL2",209,0)
 ;
"RTN","GMPLUTL2",210,0)
VAF(DFN,SILENT) ; -- print PL VA Form chart copy
"RTN","GMPLUTL2",211,0)
 ;
"RTN","GMPLUTL2",212,0)
 N VA,VADM,VAERR,GMPDFN,GMPVAMC,X,GMPARAM,GMPRT,GMPQUIT,GMPLCURR
"RTN","GMPLUTL2",213,0)
 Q:'$G(DFN)  D DEM^VADPT S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")
"RTN","GMPLUTL2",214,0)
 S GMPVAMC=+$G(DUZ(2)),GMPARAM("QUIET")=1
"RTN","GMPLUTL2",215,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLUTL2",216,0)
 D VAF^GMPLPRNT I '$G(SILENT) D  Q:$G(GMPQUIT)
"RTN","GMPLUTL2",217,0)
 . I GMPRT'>0 W !!,"No problems available." S GMPQUIT=1 Q
"RTN","GMPLUTL2",218,0)
 . D DEVICE^GMPLPRNT Q:$G(GMPQUIT)  D CLEAR^VALM1
"RTN","GMPLUTL2",219,0)
 D PRT^GMPLPRNT
"RTN","GMPLUTL2",220,0)
 Q
"RTN","GMPLUTL2",221,0)
SCTTEXT(GMPLCODE,GMPDT,GMPSYS) ; Get Preferred Text for SCT Code
"RTN","GMPLUTL2",222,0)
 N %DT,GMPY,LEX,LEXY S GMPY="",GMPDT=$G(GMPDT,DT),GMPSYS=$G(GMPSYS,"SCT")
"RTN","GMPLUTL2",223,0)
 S LEXY=$$CODE^LEXTRAN(GMPLCODE,GMPSYS,GMPDT)
"RTN","GMPLUTL2",224,0)
 I '+LEXY G SCTTEXQ
"RTN","GMPLUTL2",225,0)
 S GMPY=$G(LEX("P"))
"RTN","GMPLUTL2",226,0)
SCTTEXQ Q GMPY
"RTN","GMPLUTL2",227,0)
ICDDESC(GMPLCODE,GMPDT,GMPLCSYS) ; Get description for ICD Code
"RTN","GMPLUTL2",228,0)
 N ICDD,GMPY,ICDY S GMPY="",GMPDT=$G(GMPDT,DT)
"RTN","GMPLUTL2",229,0)
 S:'$G(GMPLCSYS) GMPLCSYS=$$SAB^ICDEX($P($$CODECS^ICDEX(GMPLCODE,80,GMPDT),U),GMPDT)
"RTN","GMPLUTL2",230,0)
 S ICDY=$$ICDDESC^ICDXCODE(GMPLCSYS,GMPLCODE,GMPDT,.ICDD)
"RTN","GMPLUTL2",231,0)
 I 'ICDY G ICDDESQ
"RTN","GMPLUTL2",232,0)
 S GMPY=$G(ICDD(1))
"RTN","GMPLUTL2",233,0)
ICDDESQ Q GMPY
"UP",9000011,9000011.1111,-2)
9000011^11
"UP",9000011,9000011.1111,-1)
9000011.11^11
"UP",9000011,9000011.1111,0)
9000011.1111
"VER")
8.0^22.0
"^DD",9000011,9000011.1111,.03,0)
NOTE NARRATIVE^RF^^0;3^K:$L(X)>200!($L(X)<3) X
"^DD",9000011,9000011.1111,.03,3)
Answer must be 3-200 characters in length.
"^DD",9000011,9000011.1111,.03,21,0)
^.001^1^1^3140814^^
"^DD",9000011,9000011.1111,.03,21,1,0)
Additional comments may be entered here to further describe this problem.
"^DD",9000011,9000011.1111,.03,"AUDIT")
n
"^DD",9000011,9000011.1111,.03,"DT")
3140814
**END**
**END**
