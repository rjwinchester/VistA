KIDS Distribution saved on Jun 05, 2014@11:53:06
GMPL*2.0*42
**KIDS**:GMPL*2.0*42^

**INSTALL NAME**
GMPL*2.0*42
"BLD",8827,0)
GMPL*2.0*42^PROBLEM LIST^0^3140605^y
"BLD",8827,1,0)
^^2^2^3120727^
"BLD",8827,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",8827,1,2,0)
under GMPL*2.0*42.
"BLD",8827,4,0)
^9.64PA^9000011^1
"BLD",8827,4,9000011,0)
9000011
"BLD",8827,4,9000011,222)
y^n^f^^^^n^^n
"BLD",8827,4,9000011,224)

"BLD",8827,4,"B",9000011,9000011)

"BLD",8827,6)
5^
"BLD",8827,6.3)
46
"BLD",8827,"ABPKG")
n
"BLD",8827,"INI")
PRE^GMPLY42
"BLD",8827,"INID")
^n^n
"BLD",8827,"INIT")
POST^GMPLY42
"BLD",8827,"KRN",0)
^9.67PA^779.2^20
"BLD",8827,"KRN",.4,0)
.4
"BLD",8827,"KRN",.401,0)
.401
"BLD",8827,"KRN",.402,0)
.402
"BLD",8827,"KRN",.403,0)
.403
"BLD",8827,"KRN",.5,0)
.5
"BLD",8827,"KRN",.84,0)
.84
"BLD",8827,"KRN",3.6,0)
3.6
"BLD",8827,"KRN",3.8,0)
3.8
"BLD",8827,"KRN",9.2,0)
9.2
"BLD",8827,"KRN",9.8,0)
9.8
"BLD",8827,"KRN",9.8,"NM",0)
^9.68A^28^27
"BLD",8827,"KRN",9.8,"NM",1,0)
GMPLUTL2^^0^B87546177
"BLD",8827,"KRN",9.8,"NM",2,0)
GMPLUTL3^^0^B19624792
"BLD",8827,"KRN",9.8,"NM",3,0)
GMPL1^^0^B38061003
"BLD",8827,"KRN",9.8,"NM",4,0)
GMPLBLCK^^0^B57283175
"BLD",8827,"KRN",9.8,"NM",5,0)
GMPLBLD^^0^B40896802
"BLD",8827,"KRN",9.8,"NM",6,0)
GMPLEDT3^^0^B31817969
"BLD",8827,"KRN",9.8,"NM",7,0)
GMPLENFM^^0^B41380995
"BLD",8827,"KRN",9.8,"NM",8,0)
GMPLHIST^^0^B21062644
"BLD",8827,"KRN",9.8,"NM",9,0)
GMPLPRNT^^0^B38258909
"BLD",8827,"KRN",9.8,"NM",10,0)
GMPLSAVE^^0^B110665367
"BLD",8827,"KRN",9.8,"NM",11,0)
GMPLX^^0^B101606054
"BLD",8827,"KRN",9.8,"NM",12,0)
GMPLUTL^^0^B62326591
"BLD",8827,"KRN",9.8,"NM",13,0)
GMPLBLD1^^0^B34803359
"BLD",8827,"KRN",9.8,"NM",14,0)
GMPLBLD2^^0^B52174697
"BLD",8827,"KRN",9.8,"NM",15,0)
GMPLBLD3^^0^B23961246
"BLD",8827,"KRN",9.8,"NM",16,0)
GMPLBLDC^^0^B38822286
"BLD",8827,"KRN",9.8,"NM",17,0)
GMPLCODE^^0^B13729689
"BLD",8827,"KRN",9.8,"NM",18,0)
GMPLDISP^^0^B47156024
"BLD",8827,"KRN",9.8,"NM",19,0)
GMPLEDT1^^0^B33830935
"BLD",8827,"KRN",9.8,"NM",20,0)
GMPLEDT4^^0^B27462939
"BLD",8827,"KRN",9.8,"NM",21,0)
GMPLHS^^0^B23837275
"BLD",8827,"KRN",9.8,"NM",22,0)
GMPLMGR^^0^B28233953
"BLD",8827,"KRN",9.8,"NM",23,0)
GMPLMGR2^^0^B29140181
"BLD",8827,"KRN",9.8,"NM",25,0)
GMPLUTL1^^0^B59613376
"BLD",8827,"KRN",9.8,"NM",26,0)
GMPLX1^^0^B90046918
"BLD",8827,"KRN",9.8,"NM",27,0)
GMPLY42^^0^B2131928
"BLD",8827,"KRN",9.8,"NM",28,0)
GMPL^^0^B26898783
"BLD",8827,"KRN",9.8,"NM","B","GMPL",28)

"BLD",8827,"KRN",9.8,"NM","B","GMPL1",3)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLCK",4)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLD",5)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLD1",13)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLD2",14)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLD3",15)

"BLD",8827,"KRN",9.8,"NM","B","GMPLBLDC",16)

"BLD",8827,"KRN",9.8,"NM","B","GMPLCODE",17)

"BLD",8827,"KRN",9.8,"NM","B","GMPLDISP",18)

"BLD",8827,"KRN",9.8,"NM","B","GMPLEDT1",19)

"BLD",8827,"KRN",9.8,"NM","B","GMPLEDT3",6)

"BLD",8827,"KRN",9.8,"NM","B","GMPLEDT4",20)

"BLD",8827,"KRN",9.8,"NM","B","GMPLENFM",7)

"BLD",8827,"KRN",9.8,"NM","B","GMPLHIST",8)

"BLD",8827,"KRN",9.8,"NM","B","GMPLHS",21)

"BLD",8827,"KRN",9.8,"NM","B","GMPLMGR",22)

"BLD",8827,"KRN",9.8,"NM","B","GMPLMGR2",23)

"BLD",8827,"KRN",9.8,"NM","B","GMPLPRNT",9)

"BLD",8827,"KRN",9.8,"NM","B","GMPLSAVE",10)

"BLD",8827,"KRN",9.8,"NM","B","GMPLUTL",12)

"BLD",8827,"KRN",9.8,"NM","B","GMPLUTL1",25)

"BLD",8827,"KRN",9.8,"NM","B","GMPLUTL2",1)

"BLD",8827,"KRN",9.8,"NM","B","GMPLUTL3",2)

"BLD",8827,"KRN",9.8,"NM","B","GMPLX",11)

"BLD",8827,"KRN",9.8,"NM","B","GMPLX1",26)

"BLD",8827,"KRN",9.8,"NM","B","GMPLY42",27)

"BLD",8827,"KRN",19,0)
19
"BLD",8827,"KRN",19.1,0)
19.1
"BLD",8827,"KRN",101,0)
101
"BLD",8827,"KRN",409.61,0)
409.61
"BLD",8827,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",8827,"KRN",409.61,"NM",1,0)
GMPL DATA ENTRY^^0
"BLD",8827,"KRN",409.61,"NM","B","GMPL DATA ENTRY",1)

"BLD",8827,"KRN",771,0)
771
"BLD",8827,"KRN",779.2,0)
779.2
"BLD",8827,"KRN",870,0)
870
"BLD",8827,"KRN",8989.51,0)
8989.51
"BLD",8827,"KRN",8989.52,0)
8989.52
"BLD",8827,"KRN",8994,0)
8994
"BLD",8827,"KRN","B",.4,.4)

"BLD",8827,"KRN","B",.401,.401)

"BLD",8827,"KRN","B",.402,.402)

"BLD",8827,"KRN","B",.403,.403)

"BLD",8827,"KRN","B",.5,.5)

"BLD",8827,"KRN","B",.84,.84)

"BLD",8827,"KRN","B",3.6,3.6)

"BLD",8827,"KRN","B",3.8,3.8)

"BLD",8827,"KRN","B",9.2,9.2)

"BLD",8827,"KRN","B",9.8,9.8)

"BLD",8827,"KRN","B",19,19)

"BLD",8827,"KRN","B",19.1,19.1)

"BLD",8827,"KRN","B",101,101)

"BLD",8827,"KRN","B",409.61,409.61)

"BLD",8827,"KRN","B",771,771)

"BLD",8827,"KRN","B",779.2,779.2)

"BLD",8827,"KRN","B",870,870)

"BLD",8827,"KRN","B",8989.51,8989.51)

"BLD",8827,"KRN","B",8989.52,8989.52)

"BLD",8827,"KRN","B",8994,8994)

"BLD",8827,"PRE")

"BLD",8827,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8827,"QUES",0)
^9.62^^
"BLD",8827,"REQB",0)
^9.611^7^6
"BLD",8827,"REQB",1,0)
GMPL*2.0*36^2
"BLD",8827,"REQB",2,0)
GMPL*2.0*28^2
"BLD",8827,"REQB",3,0)
LEX*2.0*80^2
"BLD",8827,"REQB",4,0)
ICD*18.0*57^2
"BLD",8827,"REQB",6,0)
GMPL*2.0*44^2
"BLD",8827,"REQB",7,0)
PX*1.0*199^2
"BLD",8827,"REQB","B","GMPL*2.0*28",2)

"BLD",8827,"REQB","B","GMPL*2.0*36",1)

"BLD",8827,"REQB","B","GMPL*2.0*44",6)

"BLD",8827,"REQB","B","ICD*18.0*57",4)

"BLD",8827,"REQB","B","LEX*2.0*80",3)

"BLD",8827,"REQB","B","PX*1.0*199",7)

"FIA",9000011)
PROBLEM
"FIA",9000011,0)
^AUPNPROB(
"FIA",9000011,0,0)
9000011IP
"FIA",9000011,0,1)
y^n^f^^^^n^^n
"FIA",9000011,0,10)

"FIA",9000011,0,11)

"FIA",9000011,0,"RLRO")

"FIA",9000011,0,"VR")
2.0^GMPL
"FIA",9000011,9000011)
0
"FIA",9000011,9000011.11)
0
"FIA",9000011,9000011.1111)
0
"FIA",9000011,9000011.803)
0
"INI")
PRE^GMPLY42
"INIT")
POST^GMPLY42
"IX",9000011,9000011,"ACR01",0)
9000011^ACR01^Clinical Reminders Index for ICD diagnosis code lookup.^MU^^R^IR^I^9000011^^^^^A
"IX",9000011,9000011,"ACR01",.1,0)
^^19^19^3140321
"IX",9000011,9000011,"ACR01",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",9000011,9000011,"ACR01",.1,2,0)
all patients with a particular ICD diagnosis code and one for
"IX",9000011,9000011,"ACR01",.1,3,0)
finding all the ICD diagnosis codes a patient has. The indexes are
"IX",9000011,9000011,"ACR01",.1,4,0)
stored in the Clinical Reminders Index global as:
"IX",9000011,9000011,"ACR01",.1,5,0)
 ^PXRMINDX(9000011,CODESYS,"ISPP",CODE,STATUS,PRIORITY,DFN,DLM,DAS)
"IX",9000011,9000011,"ACR01",.1,6,0)
 ^PXRMINDX(9000011,CODESYS,"PSPI",DFN,STATUS,PRIORITY,CODE,DLM,DAS)
"IX",9000011,9000011,"ACR01",.1,7,0)
respectively.
"IX",9000011,9000011,"ACR01",.1,8,0)
 
"IX",9000011,9000011,"ACR01",.1,9,0)
CODESYS is the standard three-character abbreviation for the coding system.
"IX",9000011,9000011,"ACR01",.1,10,0)
STATUS can be "A" for active or "I" for inactive. PRIORITY
"IX",9000011,9000011,"ACR01",.1,11,0)
can be "A" for acute or "C" for chronic. If PRIORITY is
"IX",9000011,9000011,"ACR01",.1,12,0)
missing, then a "U" will be stored in the Index. For
"IX",9000011,9000011,"ACR01",.1,13,0)
Problems whose PRIORITY is "C", Clinical Reminders uses
"IX",9000011,9000011,"ACR01",.1,14,0)
today's date for the date of the Problem. In all other
"IX",9000011,9000011,"ACR01",.1,15,0)
cases, Clinical Reminders uses DLM, where DLM is the Date
"IX",9000011,9000011,"ACR01",.1,16,0)
Last Modified. When Problems are "removed", then CONDITION
"IX",9000011,9000011,"ACR01",.1,17,0)
is set to "H" for hidden. Hidden Problems are not indexed.
"IX",9000011,9000011,"ACR01",.1,18,0)
For complete details, see the Clinical Reminders Index
"IX",9000011,9000011,"ACR01",.1,19,0)
Technical Guide/Programmer's Manual.
"IX",9000011,9000011,"ACR01",1)
D SPROB01^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACR01",2)
D KPROB01^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACR01",11.1,0)
^.114IA^7^7
"IX",9000011,9000011,"ACR01",11.1,1,0)
1^F^9000011^.01^^1^F
"IX",9000011,9000011,"ACR01",11.1,2,0)
2^F^9000011^.02^^2^F
"IX",9000011,9000011,"ACR01",11.1,3,0)
3^F^9000011^.03^^3^F
"IX",9000011,9000011,"ACR01",11.1,4,0)
4^F^9000011^.12^^4^F
"IX",9000011,9000011,"ACR01",11.1,5,0)
5^F^9000011^1.14
"IX",9000011,9000011,"ACR01",11.1,6,0)
6^F^9000011^1.02
"IX",9000011,9000011,"ACR01",11.1,7,0)
7^F^9000011^80202
"IX",9000011,9000011,"ACRMT",0)
9000011^ACRMT^Clinical Reminders Index for Mapping Targets code lookup.^MU^^R^IR^W^9000011.803^^^^^A
"IX",9000011,9000011,"ACRMT",.1,0)
^^19^19^3140321
"IX",9000011,9000011,"ACRMT",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",9000011,9000011,"ACRMT",.1,2,0)
all patients with a particular Mapping Target code and one for
"IX",9000011,9000011,"ACRMT",.1,3,0)
finding all the Mapping Target codes a patient has. The indexes are
"IX",9000011,9000011,"ACRMT",.1,4,0)
stored in the Clinical Reminders Index global as:
"IX",9000011,9000011,"ACRMT",.1,5,0)
 ^PXRMINDX(9000011,CODESYS,"ISPP",CODE,STATUS,PRIORITY,DFN,DLM,DAS)
"IX",9000011,9000011,"ACRMT",.1,6,0)
 ^PXRMINDX(9000011,CODESYS,"PSPI",DFN,STATUS,PRIORITY,CODE,DLM,DAS)
"IX",9000011,9000011,"ACRMT",.1,7,0)
respectively.
"IX",9000011,9000011,"ACRMT",.1,8,0)
 
"IX",9000011,9000011,"ACRMT",.1,9,0)
CODESYS is the standard three-character abbreviation for the coding system.
"IX",9000011,9000011,"ACRMT",.1,10,0)
STATUS can be "A" for active or "I" for inactive. PRIORITY
"IX",9000011,9000011,"ACRMT",.1,11,0)
can be "A" for acute or "C" for chronic. If PRIORITY is
"IX",9000011,9000011,"ACRMT",.1,12,0)
missing, then a "U" will be stored in the Index. For
"IX",9000011,9000011,"ACRMT",.1,13,0)
Problems whose PRIORITY is "C", Clinical Reminders uses
"IX",9000011,9000011,"ACRMT",.1,14,0)
today's date for the date of the Problem. In all other
"IX",9000011,9000011,"ACRMT",.1,15,0)
cases, Clinical Reminders uses DLM, where DLM is the Date
"IX",9000011,9000011,"ACRMT",.1,16,0)
Last Modified. When Problems are "removed", then CONDITION
"IX",9000011,9000011,"ACRMT",.1,17,0)
is set to "H" for hidden. Hidden Problems are not indexed.
"IX",9000011,9000011,"ACRMT",.1,18,0)
For complete details, see the Clinical Reminders Index
"IX",9000011,9000011,"ACRMT",.1,19,0)
Technical Guide/Programmer's Manual.
"IX",9000011,9000011,"ACRMT",1)
D SPROBMT^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACRMT",2)
D KPROBMT^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACRMT",11.1,0)
^.114IA^2^2
"IX",9000011,9000011,"ACRMT",11.1,1,0)
1^F^9000011.803^.01^^1^F
"IX",9000011,9000011,"ACRMT",11.1,2,0)
2^F^9000011.803^.02^^2^F
"IX",9000011,9000011,"ACRSCT",0)
9000011^ACRSCT^Clinical Reminders Index for SNOMED CT concept code lookup.^MU^^R^IR^I^9000011^^^^^A
"IX",9000011,9000011,"ACRSCT",.1,0)
^^19^19^3140321
"IX",9000011,9000011,"ACRSCT",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",9000011,9000011,"ACRSCT",.1,2,0)
all patients with a particular SNOMED CT code and one for
"IX",9000011,9000011,"ACRSCT",.1,3,0)
finding all the SNOMED CT codes a patient has. The indexes are
"IX",9000011,9000011,"ACRSCT",.1,4,0)
stored in the Clinical Reminders Index global as:
"IX",9000011,9000011,"ACRSCT",.1,5,0)
 ^PXRMINDX(9000011,CODESYS,"ISPP",CODE,STATUS,PRIORITY,DFN,DLM,DAS)
"IX",9000011,9000011,"ACRSCT",.1,6,0)
 ^PXRMINDX(9000011,CODESYS,"PSPI",DFN,STATUS,PRIORITY,CODE,DLM,DAS)
"IX",9000011,9000011,"ACRSCT",.1,7,0)
respectively.
"IX",9000011,9000011,"ACRSCT",.1,8,0)
 
"IX",9000011,9000011,"ACRSCT",.1,9,0)
CODESYS is the standard three-character abbreviation for the coding system.
"IX",9000011,9000011,"ACRSCT",.1,10,0)
STATUS can be "A" for active or "I" for inactive. PRIORITY
"IX",9000011,9000011,"ACRSCT",.1,11,0)
can be "A" for acute or "C" for chronic. If PRIORITY is
"IX",9000011,9000011,"ACRSCT",.1,12,0)
missing, then a "U" will be stored in the Index. For
"IX",9000011,9000011,"ACRSCT",.1,13,0)
Problems whose PRIORITY is "C", Clinical Reminders uses
"IX",9000011,9000011,"ACRSCT",.1,14,0)
today's date for the date of the Problem. In all other
"IX",9000011,9000011,"ACRSCT",.1,15,0)
cases, Clinical Reminders uses DLM, where DLM is the Date
"IX",9000011,9000011,"ACRSCT",.1,16,0)
Last Modified. When Problems are "removed", then CONDITION
"IX",9000011,9000011,"ACRSCT",.1,17,0)
is set to "H" for hidden. Hidden Problems are not indexed.
"IX",9000011,9000011,"ACRSCT",.1,18,0)
For complete details, see the Clinical Reminders Index
"IX",9000011,9000011,"ACRSCT",.1,19,0)
Technical Guide/Programmer's Manual.
"IX",9000011,9000011,"ACRSCT",1)
D SPROBSCT^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACRSCT",2)
D KPROBSCT^GMPLPXRM(.X,.DA)
"IX",9000011,9000011,"ACRSCT",11.1,0)
^.114IA^6^6
"IX",9000011,9000011,"ACRSCT",11.1,1,0)
1^F^9000011^80001^^1^F
"IX",9000011,9000011,"ACRSCT",11.1,2,0)
2^F^9000011^.02^^2^F
"IX",9000011,9000011,"ACRSCT",11.1,3,0)
3^F^9000011^.03^^3^F
"IX",9000011,9000011,"ACRSCT",11.1,4,0)
4^F^9000011^.12^^4^F
"IX",9000011,9000011,"ACRSCT",11.1,5,0)
5^F^9000011^1.14
"IX",9000011,9000011,"ACRSCT",11.1,6,0)
6^F^9000011^1.02
"IX",9000011,9000011,"DM",0)
9000011^DM^Index on Date Entered & Map Status^R^^R^IR^I^9000011^^^^^LS
"IX",9000011,9000011,"DM",.1,0)
^^2^2^3120607^
"IX",9000011,9000011,"DM",.1,1,0)
This REGULAR new-style index on Date Entered and SNOMED CT to ICD Map 
"IX",9000011,9000011,"DM",.1,2,0)
Status will facilitate the Mapping Follow-up Report.
"IX",9000011,9000011,"DM",1)
S ^AUPNPROB("DM",X(1),X(2),DA)=""
"IX",9000011,9000011,"DM",2)
K ^AUPNPROB("DM",X(1),X(2),DA)
"IX",9000011,9000011,"DM",2.5)
K ^AUPNPROB("DM")
"IX",9000011,9000011,"DM",11.1,0)
^.114IA^2^2
"IX",9000011,9000011,"DM",11.1,1,0)
1^F^9000011^.08^^1^F
"IX",9000011,9000011,"DM",11.1,1,3)

"IX",9000011,9000011,"DM",11.1,2,0)
2^F^9000011^80005^^2^F
"IX",9000011,9000011,"DM",11.1,2,3)

"KRN",409.61,42,-1)
0^1
"KRN",409.61,42,0)
GMPL DATA ENTRY^1^^80^5^14^1^1^Problem^GMPL DATA ENTRY^PROBLEM LIST^1
"KRN",409.61,42,1)
GMPL PRINT^GMPL HIDDEN MENU
"KRN",409.61,42,"ARRAY")
 ^TMP("GMPL",$J)
"KRN",409.61,42,"COL",0)
^409.621^7^7
"KRN",409.61,42,"COL",1,0)
NUMBER^1^3
"KRN",409.61,42,"COL",2,0)
STATUS^4^2^
"KRN",409.61,42,"COL",3,0)
PROBLEM^6^39^Problem
"KRN",409.61,42,"COL",4,0)
SERV CONNECTED^55^3^SC
"KRN",409.61,42,"COL",5,0)
RESOLVED^72^8^Resolved
"KRN",409.61,42,"COL",6,0)
ICD^46^8^ICD
"KRN",409.61,42,"COL",7,0)
EXPOSURE^59^12^Exposure
"KRN",409.61,42,"COL","B","EXPOSURE",7)

"KRN",409.61,42,"COL","B","ICD",6)

"KRN",409.61,42,"COL","B","NUMBER",1)

"KRN",409.61,42,"COL","B","PROBLEM",3)

"KRN",409.61,42,"COL","B","RESOLVED",5)

"KRN",409.61,42,"COL","B","SERV CONNECTED",4)

"KRN",409.61,42,"COL","B","STATUS",2)

"KRN",409.61,42,"FNL")
D EXIT^GMPLMGR2
"KRN",409.61,42,"HDR")
D HDR^GMPLMGR
"KRN",409.61,42,"HLP")
D HELP^GMPLMGR2
"KRN",409.61,42,"INIT")
D INIT^GMPLMGR
"MBREQ")
0
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",172,-1)
1^1
"PKG",172,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",172,20,0)
^9.402P^^
"PKG",172,22,0)
^9.49I^1^1
"PKG",172,22,1,0)
2.0^2940825^2941103
"PKG",172,22,1,"PAH",1,0)
42^3140605^123456789163
"PKG",172,22,1,"PAH",1,1,0)
^^2^2^3140605
"PKG",172,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",172,22,1,"PAH",1,1,2,0)
under GMPL*2.0*42.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
27
"RTN","GMPL")
0^28^B26898783
"RTN","GMPL",1,0)
GMPL ; SLC/MKB/AJB -- Problem List Driver ;03/31/14  12:21
"RTN","GMPL",2,0)
 ;;2.0;Problem List;**3,11,28,42**;Aug 25, 1994;Build 46
"RTN","GMPL",3,0)
EN ; -- main entry point for GMPL PROBLEM LIST
"RTN","GMPL",4,0)
 S GMPLUSER=1
"RTN","GMPL",5,0)
 D EN^VALM("GMPL PROBLEM LIST")
"RTN","GMPL",6,0)
 Q
"RTN","GMPL",7,0)
 ;
"RTN","GMPL",8,0)
DE ; -- main entry point for GMPL DATA ENTRY
"RTN","GMPL",9,0)
 K GMPLUSER
"RTN","GMPL",10,0)
 D EN^VALM("GMPL DATA ENTRY")
"RTN","GMPL",11,0)
 Q
"RTN","GMPL",12,0)
 ;
"RTN","GMPL",13,0)
ADD ; -- add a new problem
"RTN","GMPL",14,0)
 S VALMBCK="",GMPCLIN="" K GMPREBLD
"RTN","GMPL",15,0)
 I +$P(GMPDFN,U,4),'$$CKDEAD^GMPLX1($P(GMPDFN,U,4)) G ADDQ
"RTN","GMPL",16,0)
 S:$E(GMPLVIEW("VIEW"))'="S" GMPCLIN=$$CLINIC^GMPLX1("") G:GMPCLIN="^" ADDQ
"RTN","GMPL",17,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2)
"RTN","GMPL",18,0)
 I 'GMPLSLST,GMPCLIN,$D(^GMPL(125,"C",+GMPCLIN)) S GMPLSLST=$O(^(+GMPCLIN,0)) ; if user has no list but clinic does, use clinic list
"RTN","GMPL",19,0)
 I GMPLSLST D  G ADD1
"RTN","GMPL",20,0)
 . S $P(GMPLSLST,U,2)=$P($G(^GMPL(125,+GMPLSLST,0)),U)
"RTN","GMPL",21,0)
 . D EN^VALM("GMPL LIST MENU")
"RTN","GMPL",22,0)
 W @IOF D FULL^VALM1 F  D ADD^GMPL1 Q:$D(GMPQUIT)  S:$D(GMPSAVED) GMPREBLD=1 K DUOUT,DTOUT,GMPSAVED W !!!,">>>  Please enter another problem, or press <return> to exit."
"RTN","GMPL",23,0)
 S VALMBCK="R"
"RTN","GMPL",24,0)
ADD1 I $D(GMPREBLD) D
"RTN","GMPL",25,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",26,0)
 . S VALMBG=$S(GMPARAM("REV"):1,VALMCNT<10:1,1:VALMCNT-9)
"RTN","GMPL",27,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",28,0)
ADDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",29,0)
 Q
"RTN","GMPL",30,0)
 ;
"RTN","GMPL",31,0)
STATUS ; -- inactivate a problem
"RTN","GMPL",32,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 STQ
"RTN","GMPL",33,0)
 I GMPLVIEW("ACT")="I" W $C(7),!!,"Currently displayed problems are already inactive!",! G STQ
"RTN","GMPL",34,0)
 S GMPLSEL=$$SEL^GMPLX("inactivate") G:GMPLSEL="^" STQ
"RTN","GMPL",35,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPL",36,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPL",37,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPL",38,0)
 . I $P(^AUPNPROB(GMPIFN,0),U,12)="I" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"is already inactive!",! H 2 Q
"RTN","GMPL",39,0)
 . I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 Q
"RTN","GMPL",40,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL",41,0)
 . D STATUS^GMPL1 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",42,0)
 I $D(GMPSAVED) D
"RTN","GMPL",43,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",44,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",45,0)
STQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",46,0)
 Q
"RTN","GMPL",47,0)
 ;
"RTN","GMPL",48,0)
NOTES ; -- annotate a problem
"RTN","GMPL",49,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 NTQ
"RTN","GMPL",50,0)
 S GMPLNUM=$$SEL1^GMPLX("add comment(s) to") G:GMPLNUM="^" NTQ
"RTN","GMPL",51,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 NTQ
"RTN","GMPL",52,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 G NTQ
"RTN","GMPL",53,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 G NTQ
"RTN","GMPL",54,0)
 D NEWNOTE^GMPL1 I $D(GMPSAVED) D
"RTN","GMPL",55,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",56,0)
 . D BUILD^GMPLMGR(.GMPLIST)
"RTN","GMPL",57,0)
 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",58,0)
NTQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",59,0)
 Q
"RTN","GMPL",60,0)
 ;
"RTN","GMPL",61,0)
EDIT ; -- edit allowable fields of a problem
"RTN","GMPL",62,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 EDQ
"RTN","GMPL",63,0)
 S GMPLNUM=$$SEL1^GMPLX("edit") G:GMPLNUM="^" EDQ
"RTN","GMPL",64,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 EDQ
"RTN","GMPL",65,0)
 ; Code Set Versioning (CSV)
"RTN","GMPL",66,0)
 ; I '$$CODESTS^GMPLX(GMPIFN,DT) W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has an inactive ICD code.",! H 3 G EDQ
"RTN","GMPL",67,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 G EDQ
"RTN","GMPL",68,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 G EDQ
"RTN","GMPL",69,0)
 D EN^VALM("GMPL EDIT PROBLEM")
"RTN","GMPL",70,0)
 I $D(GMPSAVED) D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR S GMPRINT=1
"RTN","GMPL",71,0)
 S VALMBCK="R" L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",72,0)
EDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",73,0)
 Q
"RTN","GMPL",74,0)
 ;
"RTN","GMPL",75,0)
DELETE ; -- delete a problem
"RTN","GMPL",76,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 DELQ
"RTN","GMPL",77,0)
 S GMPLSEL=$$SEL^GMPLX("remove from the list") G:GMPLSEL="^" DELQ
"RTN","GMPL",78,0)
 S GMPLNO=$L(GMPLSEL,",") G:'$$SUREDEL^GMPLEDT2(GMPLNO-1) DELQ
"RTN","GMPL",79,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPL",80,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPL",81,0)
 . I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has already been removed from this patient's problem list!",! H 2 Q
"RTN","GMPL",82,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL",83,0)
 . D DELETE^GMPL1 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",84,0)
 I $D(GMPSAVED) D
"RTN","GMPL",85,0)
 . S VALMBCK="R",GMPRINT=1 D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",86,0)
DELQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",87,0)
 Q
"RTN","GMPL",88,0)
 ;
"RTN","GMPL",89,0)
VERIFY ; -- verify a problem
"RTN","GMPL",90,0)
 S VALMBCK="" Q:+$G(GMPCOUNT)'>0
"RTN","GMPL",91,0)
 W !!,"Select the problem(s) you wish to verify as correct."
"RTN","GMPL",92,0)
 S GMPLSEL=$$SEL^GMPLX("mark as verified") G:GMPLSEL="^" VERQ
"RTN","GMPL",93,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPL",94,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D
"RTN","GMPL",95,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,GMPLNUM)),U,2)
"RTN","GMPL",96,0)
 . D:GMPIFN VERIFY^GMPL1
"RTN","GMPL",97,0)
 I $D(GMPSAVED) D BUILD^GMPLMGR(.GMPLIST) S VALMBCK="R"
"RTN","GMPL",98,0)
VERQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",99,0)
 Q
"RTN","GMPL",100,0)
 ;
"RTN","GMPL",101,0)
EXPAND ; -- detailed display of a problem
"RTN","GMPL",102,0)
 S VALMBCK="" Q:+$G(GMPCOUNT)'>0
"RTN","GMPL",103,0)
 S GMPLSEL=$$SEL^GMPLX("view") G:GMPLSEL="^" EXPQ
"RTN","GMPL",104,0)
 S GMPLNO=$L(GMPLSEL,",")-1,GMPI=0
"RTN","GMPL",105,0)
 D EN^VALM("GMPL DETAILED DISPLAY")
"RTN","GMPL",106,0)
 S VALMBCK="R"
"RTN","GMPL",107,0)
EXPQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",108,0)
 Q
"RTN","GMPL1")
0^3^B38061003
"RTN","GMPL1",1,0)
GMPL1 ; SLC/MKB/AJB/TC -- Problem List actions ;03/31/14  12:23
"RTN","GMPL1",2,0)
 ;;2.0;Problem List;**3,20,28,43,42**;Aug 25, 1994;Build 46
"RTN","GMPL1",3,0)
 ; 10 MAR 2000 - MA - Added to the routine another user prompt
"RTN","GMPL1",4,0)
 ; to backup and refine Lexicon search if ICD code 799.9 or R69.
"RTN","GMPL1",5,0)
ADD ;add new entry to list - Requires GMPDFN
"RTN","GMPL1",6,0)
 N GMPROB,GMPTERM,GMPICD,Y,DUP,GMPIMPDT W !
"RTN","GMPL1",7,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPL1",8,0)
 S GMPROB=$$TEXT^GMPLEDT4("") I GMPROB="^" S GMPQUIT=1 Q
"RTN","GMPL1",9,0)
 I 'GMPARAM("CLU")!('$D(GMPLUSER)&('$D(^XUSEC("GMPL ICD CODE",DUZ)))) S GMPTERM="",GMPICD=$S(DT<GMPIMPDT:"799.9",1:"R69.") G ADD1
"RTN","GMPL1",10,0)
 F  D  Q:$D(GMPQUIT)!(+$G(Y))
"RTN","GMPL1",11,0)
 . D SEARCH^GMPLX(.GMPROB,.Y,"PROBLEM: ","1")
"RTN","GMPL1",12,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPL1",13,0)
 . S DUP=$$DUPL^GMPLX(+GMPDFN,+Y,GMPROB)
"RTN","GMPL1",14,0)
 . I DUP,'$$DUPLOK^GMPLX(DUP) S (Y,GMPROB)=""
"RTN","GMPL1",15,0)
 . I +Y=1 D ICDMSG
"RTN","GMPL1",16,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",17,0)
 S GMPTERM=$S(+$G(Y)>1:Y,1:""),GMPICD=$G(Y(1))
"RTN","GMPL1",18,0)
 S:'$L(GMPICD) GMPICD=$S(DT<GMPIMPDT:"799.9",1:"R69.")
"RTN","GMPL1",19,0)
ADD1 ; set up default values
"RTN","GMPL1",20,0)
 ; -- May enter here with GMPROB=text,GMPICD=code,GMPTERM=#^term
"RTN","GMPL1",21,0)
 ; added for Code Set Versioning (CSV)
"RTN","GMPL1",22,0)
 N I,GMPSTAT,GMPCSREC,GMPCSPTR,GMPCSNME,GMPSCTC,GMPSCTD,GMPTXT
"RTN","GMPL1",23,0)
 S (GMPSCTC,GMPSCTD,GMPTXT)=""
"RTN","GMPL1",24,0)
 I GMPICD["/" F I=1:1:$L(GMPICD,"/") D  Q:GMPSTAT
"RTN","GMPL1",25,0)
 . N GMPCODE S GMPCODE=$P(GMPICD,"/",I),GMPSTAT=0
"RTN","GMPL1",26,0)
 . S GMPCSREC=$$CODECS^ICDEX(GMPCODE,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPL1",27,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPCODE,DT) GMPSTAT=1
"RTN","GMPL1",28,0)
 E  D
"RTN","GMPL1",29,0)
 . S GMPSTAT=0,GMPCSREC=$$CODECS^ICDEX(GMPICD,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPL1",30,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPICD,DT) GMPSTAT=1
"RTN","GMPL1",31,0)
 I GMPSTAT W !,GMPROB,!,"has an inactive ICD code.  Please edit before adding." H 3 Q
"RTN","GMPL1",32,0)
 I (GMPROB["(SCT"),(GMPROB[")") D
"RTN","GMPL1",33,0)
 . S GMPSCTC=$$ONE^LEXU(+GMPTERM,DT,"SCT")
"RTN","GMPL1",34,0)
 . S GMPTXT=$$TRIM^XLFSTR($RE($P($RE(GMPROB),"(",2,99)))
"RTN","GMPL1",35,0)
 . S GMPSCTD=$$GETDES^LEXTRAN1("SCT",GMPTXT),GMPSCTD=$S(+GMPSCTD=1:$P(GMPSCTD,U,2),1:"")
"RTN","GMPL1",36,0)
 N OK,GMPI,GMPFLD K GMPLJUMP
"RTN","GMPL1",37,0)
 S GMPFLD(1.01)=GMPTERM,GMPFLD(.05)=U_GMPROB
"RTN","GMPL1",38,0)
 S GMPFLD(.01)=$P($$ICDDATA^ICDXCODE(GMPCSPTR,$P(GMPICD,"/"),DT,"E"),U)_U_GMPICD
"RTN","GMPL1",39,0)
 S GMPFLD(80202)=$$SAB^ICDEX(GMPCSPTR,DT)_U_$G(GMPCSNME)
"RTN","GMPL1",40,0)
 S:'GMPFLD(.01)!($P(GMPFLD(.01),U)<0) GMPFLD(.01)=$$NOS^GMPLX($P(GMPFLD(80202),U),DT) ; cannot resolve code
"RTN","GMPL1",41,0)
 S (GMPFLD(1.04),GMPFLD(1.05))=$G(GMPROV),GMPFLD(1.03)=DUZ
"RTN","GMPL1",42,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+GMPFLD(1.04)),GMPFLD(1.08)=$G(GMPCLIN)
"RTN","GMPL1",43,0)
 S (GMPFLD(.08),GMPFLD(80201),GMPFLD(1.09))=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPL1",44,0)
 S GMPFLD(.12)="A^ACTIVE",GMPFLD(1.14)="",GMPFLD(10,0)=0
"RTN","GMPL1",45,0)
 S GMPFLD(1.02)=$S('$G(GMPARAM("VER")):"P",$D(GMPLUSER):"P",1:"T")
"RTN","GMPL1",46,0)
 S (GMPFLD(.13),GMPFLD(1.07))="" ; initialize dates
"RTN","GMPL1",47,0)
 S GMPFLD(1.1)=$S('GMPSC:"0^NO",1:""),GMPFLD(1.11)=$S('GMPAGTOR:"0^NO",1:"")
"RTN","GMPL1",48,0)
 S GMPFLD(1.12)=$S('GMPION:"0^NO",1:""),GMPFLD(1.13)=$S('GMPGULF:"0^NO",1:"")
"RTN","GMPL1",49,0)
 S GMPFLD(80001)=GMPSCTC_U_GMPSCTC,GMPFLD(80002)=GMPSCTD_U_GMPSCTD
"RTN","GMPL1",50,0)
ADD2 ; prompt for values
"RTN","GMPL1",51,0)
 D FLDS^GMPLEDT3 ; set GMPFLD("FLD") of editable fields
"RTN","GMPL1",52,0)
 F GMPI=2:1:7 D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)  K GMPLJUMP ; cannot ^-jump here
"RTN","GMPL1",53,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",54,0)
ADD3 ; Ok to save?
"RTN","GMPL1",55,0)
 S OK=$$ACCEPT^GMPLDIS1(.GMPFLD),GMPLJUMP=0 ; ok to save values?
"RTN","GMPL1",56,0)
 I OK="^" W !!?10,"< Nothing Saved !! >",! S GMPQUIT=1 H 1 Q
"RTN","GMPL1",57,0)
 I OK D  Q  ; ck DA for error?
"RTN","GMPL1",58,0)
 . N I W !!,"Saving ..." D NEW^GMPLSAVE
"RTN","GMPL1",59,0)
 . S I=$S(GMPLIST(0)'>0:1,GMPARAM("REV"):$O(GMPLIST(0))-.01,1:GMPLIST(0)+1)
"RTN","GMPL1",60,0)
 . S GMPLIST(I)=DA,GMPLIST("B",DA)=I,GMPLIST(0)=$G(GMPLIST(0))+1
"RTN","GMPL1",61,0)
 . W " done."
"RTN","GMPL1",62,0)
 ; Not ok -- edit values, ask again
"RTN","GMPL1",63,0)
 F GMPI=1:1:GMPFLD("FLD",0) D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)!($D(GMPSAVED))  I $G(GMPLJUMP) S GMPI=GMPLJUMP-1 S GMPLJUMP=0 ; reset GMPI to desired fld
"RTN","GMPL1",64,0)
 Q:$D(DTOUT)  K GMPQUIT,DUOUT G ADD3
"RTN","GMPL1",65,0)
 Q
"RTN","GMPL1",66,0)
 ;
"RTN","GMPL1",67,0)
 ; *********************************************************************
"RTN","GMPL1",68,0)
 ; *  GMPIFN expected for the following calls:
"RTN","GMPL1",69,0)
 ;
"RTN","GMPL1",70,0)
STATUS ; -- inactivate problem
"RTN","GMPL1",71,0)
 N DIE,DA,DR,X,Y,CHNGE,GMPFLD,PROMPT,DEFAULT
"RTN","GMPL1",72,0)
 S GMPFLD(.13)=$P($G(^AUPNPROB(GMPIFN,0)),U,13) ; Onset
"RTN","GMPL1",73,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN) D RESOLVED^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",74,0)
 S PROMPT="COMMENT (<60 char): ",DEFAULT="" D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",75,0)
 W ! I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",76,0)
 S DIE="^AUPNPROB(",DR=".12///I;1.07////"_$P($G(GMPFLD(1.07)),U)
"RTN","GMPL1",77,0)
 S DA=GMPIFN D ^DIE W "."
"RTN","GMPL1",78,0)
 S CHNGE=GMPIFN_"^.12^"_$$HTFM^XLFDT($H)_U_DUZ_"^A^I^^"_+$G(GMPROV)
"RTN","GMPL1",79,0)
 D AUDIT^GMPLX(CHNGE,"") W "." ; audit trail
"RTN","GMPL1",80,0)
 D DTMOD^GMPLX(GMPIFN) W "." ; update Dt Last Mod
"RTN","GMPL1",81,0)
 W "... inactivated!",!
"RTN","GMPL1",82,0)
 H 1 S GMPSAVED=1
"RTN","GMPL1",83,0)
 Q
"RTN","GMPL1",84,0)
 ;
"RTN","GMPL1",85,0)
NEWNOTE ; -- add a new comment
"RTN","GMPL1",86,0)
 N GMPFLD
"RTN","GMPL1",87,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",88,0)
 D NOTE^GMPLEDT1 Q:$D(GMPQUIT)!($D(GMPFLD(10,"NEW"))'>9)
"RTN","GMPL1",89,0)
 D NEWNOTE^GMPLSAVE,DTMOD^GMPLX(GMPIFN)
"RTN","GMPL1",90,0)
 S GMPSAVED=1
"RTN","GMPL1",91,0)
 Q
"RTN","GMPL1",92,0)
 ;
"RTN","GMPL1",93,0)
DELETE ; -- delete a problem
"RTN","GMPL1",94,0)
 N PROMPT,DEFAULT,X,Y,CHNGE,GMPFLD
"RTN","GMPL1",95,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",96,0)
 S PROMPT="REASON FOR REMOVAL: ",DEFAULT=""
"RTN","GMPL1",97,0)
 D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)  W !
"RTN","GMPL1",98,0)
 I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",99,0)
 S CHNGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_"^P^H^Deleted^"_+$G(GMPROV)
"RTN","GMPL1",100,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="H",GMPSAVED=1 W "."
"RTN","GMPL1",101,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",102,0)
 W "... removed!",! H 1
"RTN","GMPL1",103,0)
 Q
"RTN","GMPL1",104,0)
 ;
"RTN","GMPL1",105,0)
VERIFY ; -- verify a transcribed problem, if parameter on
"RTN","GMPL1",106,0)
 N NOW,CHNGE S NOW=$$HTFM^XLFDT($H)
"RTN","GMPL1",107,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN),!
"RTN","GMPL1",108,0)
 I '$$CODESTS^GMPLX(GMPIFN,DT) W "has an inactive ICD code. Edit the problem before verification.",! H 2 Q
"RTN","GMPL1",109,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)'="T" W "does not require verification.",! H 2 Q
"RTN","GMPL1",110,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL1",111,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="P",GMPSAVED=1 W "."
"RTN","GMPL1",112,0)
 S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ W "."
"RTN","GMPL1",113,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",114,0)
 L -^AUPNPROB(GMPIFN,0) W " verified.",!
"RTN","GMPL1",115,0)
 Q
"RTN","GMPL1",116,0)
ICDMSG ; If Lexicon returns ICD code 799.9 or R69.
"RTN","GMPL1",117,0)
 N DIR,DTOUT,DUOUT,GMPLY,GMPROB,GMPCODE,GMPDESC,GMPIMPDT
"RTN","GMPL1",118,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D"),GMPCODE=$S(DT<GMPIMPDT:"799.9",1:"R69. ")
"RTN","GMPL1",119,0)
 S GMPDESC=$S(GMPCODE="799.9":"OTHER UNKNOWN AND UNSPECIFIED CAUSE OF MORBIDITY OR MORTALITY",1:"ILLNESS, UNSPECIFIED")
"RTN","GMPL1",120,0)
 S DIR(0)="YAO"
"RTN","GMPL1",121,0)
 S DIR("A",1)="<< If you PROCEED WITH THIS NON SPECIFIC TERM, an ICD CODE OF"_GMPCODE_" >>"
"RTN","GMPL1",122,0)
 I GMPCODE="799.9" D
"RTN","GMPL1",123,0)
 . S DIR("A",2)="<< "_GMPDESC_"    >>"
"RTN","GMPL1",124,0)
 . S DIR("A",3)="<< will be assigned.  Adding more specificity to your diagnosis may >>"
"RTN","GMPL1",125,0)
 . S DIR("A",4)="<< allow a more accurate ICD code.                                  >>"
"RTN","GMPL1",126,0)
 . S DIR("A",5)=""
"RTN","GMPL1",127,0)
 E  D
"RTN","GMPL1",128,0)
 . S DIR("A",2)="<< "_GMPDESC_" will be assigned.  Adding more specificity  >>"
"RTN","GMPL1",129,0)
 . S DIR("A",3)="<< to your diagnosis may allow a more accurate ICD code.            >>"
"RTN","GMPL1",130,0)
 . S DIR("A",4)=""
"RTN","GMPL1",131,0)
 S DIR("A")="Continue (YES/NO) ",DIR("B")="NO"
"RTN","GMPL1",132,0)
 S DIR("T")=DTIME
"RTN","GMPL1",133,0)
 D ^DIR
"RTN","GMPL1",134,0)
 I $D(DTOUT)!$D(DUOUT) S Y=0
"RTN","GMPL1",135,0)
 I +Y=0 S (GMPLY,GMPROB)=""
"RTN","GMPL1",136,0)
 Q
"RTN","GMPLBLCK")
0^4^B57283175
"RTN","GMPLBLCK",1,0)
GMPLBLCK ;SLC/JFR/TC - check selection list ICD codes ;04/09/12  11:44
"RTN","GMPLBLCK",2,0)
 ;;2.0;Problem List;**28,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLCK",3,0)
 ;
"RTN","GMPLBLCK",4,0)
 ; This routine invokes IA #5699 & #5747
"RTN","GMPLBLCK",5,0)
 Q
"RTN","GMPLBLCK",6,0)
CSVPEP ;called from protocol GMPL SELECTION LIST CSV EVENT
"RTN","GMPLBLCK",7,0)
 N CAT,LN,LST,LIST,XMSUB,XMTEXT,XMDUZ,XMY
"RTN","GMPLBLCK",8,0)
 D CKLISTS,CKCODES
"RTN","GMPLBLCK",9,0)
 K ^TMP("GMPLMSG",$J)
"RTN","GMPLBLCK",10,0)
 S LN=1
"RTN","GMPLBLCK",11,0)
 I $D(^TMP("GMPLSL",$J,"I")) D
"RTN","GMPLBLCK",12,0)
 . S ^TMP("GMPLMSG",$J,LN)="The following Problem Selection Lists contain one or more problems that",LN=LN+1
"RTN","GMPLBLCK",13,0)
 . S ^TMP("GMPLMSG",$J,LN)="have inactive ICD codes attached to them. Any current users or clinics using",LN=LN+1
"RTN","GMPLBLCK",14,0)
 . S ^TMP("GMPLMSG",$J,LN)="these Selection Lists, will not be able to add the problems with inactive ",LN=LN+1
"RTN","GMPLBLCK",15,0)
 . S ^TMP("GMPLMSG",$J,LN)="codes, until the list and the inactive codes are updated. The list may not be",LN=LN+1
"RTN","GMPLBLCK",16,0)
 . S ^TMP("GMPLMSG",$J,LN)="assigned to any additional users or clinics until updated.",LN=LN+1
"RTN","GMPLBLCK",17,0)
 . S LST=0
"RTN","GMPLBLCK",18,0)
 . F  S LST=$O(^TMP("GMPLSL",$J,"I",LST)) Q:'LST  D
"RTN","GMPLBLCK",19,0)
 .. S ^TMP("GMPLMSG",$J,LN)="   "_^TMP("GMPLSL",$J,"I",LST)
"RTN","GMPLBLCK",20,0)
 .. S LN=LN+1
"RTN","GMPLBLCK",21,0)
 ;
"RTN","GMPLBLCK",22,0)
 I $D(^TMP("GMPLSL",$J,"F")) D  ;no future inact. dates
"RTN","GMPLBLCK",23,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",24,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",25,0)
 . S ^TMP("GMPLMSG",$J,LN)="The following Problem Selection List categories contain problems with ICD",LN=LN+1
"RTN","GMPLBLCK",26,0)
 . S ^TMP("GMPLMSG",$J,LN)="codes that have a future inactivation date. These Categories should be updated",LN=LN+1
"RTN","GMPLBLCK",27,0)
 . S ^TMP("GMPLMSG",$J,LN)="as soon as possible after the inactivation date to reduce the interruption of",LN=LN+1
"RTN","GMPLBLCK",28,0)
 . S ^TMP("GMPLMSG",$J,LN)="use of the selection list(s) by users or clinics.",LN=LN+1
"RTN","GMPLBLCK",29,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",30,0)
 . S CAT=0
"RTN","GMPLBLCK",31,0)
 . F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",32,0)
 .. S ^TMP("GMPLMSG",$J,LN)=" Category name: "_$$GET1^DIQ(125.11,CAT,.01)
"RTN","GMPLBLCK",33,0)
 .. S LN=LN+1
"RTN","GMPLBLCK",34,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",35,0)
 .. S ^TMP("GMPLMSG",$J,LN)="    Problems with ICD codes due to be inactivated:",LN=LN+1
"RTN","GMPLBLCK",36,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",37,0)
 .. N PROB,TXT
"RTN","GMPLBLCK",38,0)
 .. S PROB=0
"RTN","GMPLBLCK",39,0)
 .. F  S PROB=$O(^TMP("GMPLSL",$J,"F",CAT,PROB)) Q:'PROB  D
"RTN","GMPLBLCK",40,0)
 ... S TXT=^TMP("GMPLSL",$J,"F",CAT,PROB)
"RTN","GMPLBLCK",41,0)
 ... S ^TMP("GMPLMSG",$J,LN)="       Problem text: "_$P(TXT,U),LN=LN+1
"RTN","GMPLBLCK",42,0)
 ... S ^TMP("GMPLMSG",$J,LN)="       Display text: "_$P(TXT,U,2),LN=LN+1
"RTN","GMPLBLCK",43,0)
 ... S ^TMP("GMPLMSG",$J,LN)="               Code: "_$P(TXT,U,3),LN=LN+1
"RTN","GMPLBLCK",44,0)
 ... S ^TMP("GMPLMSG",$J,LN)="      Inactive Date: "_$$FMTE^XLFDT($P(TXT,U,4),2),LN=LN+1
"RTN","GMPLBLCK",45,0)
 ... S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",46,0)
 .. I '$D(^TMP("GMPLSL",$J,"F",CAT,"L")) Q  ; category not part of lists
"RTN","GMPLBLCK",47,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",48,0)
 .. S ^TMP("GMPLMSG",$J,LN)="    This Category is part of the following Problem Selection Lists:",LN=LN+1
"RTN","GMPLBLCK",49,0)
 .. S LIST=0
"RTN","GMPLBLCK",50,0)
 .. F  S LIST=$O(^TMP("GMPLSL",$J,"F",CAT,"L",LIST)) Q:'LIST  D
"RTN","GMPLBLCK",51,0)
 ... S ^TMP("GMPLMSG",$J,LN)="     "_^TMP("GMPLSL",$J,"F",CAT,"L",LIST)
"RTN","GMPLBLCK",52,0)
 ... S LN=LN+1
"RTN","GMPLBLCK",53,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",54,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",55,0)
 .. Q
"RTN","GMPLBLCK",56,0)
 I '$D(^TMP("GMPLSL",$J)) D  ; no problems found
"RTN","GMPLBLCK",57,0)
 . S ^TMP("GMPLMSG",$J,LN)="No Problems Selection List corrections/review required"
"RTN","GMPLBLCK",58,0)
 . S LN=LN+1
"RTN","GMPLBLCK",59,0)
 S XMY("G.GMPL CODE SET VERSION UPDATES")=""
"RTN","GMPLBLCK",60,0)
 S XMSUB="Problem Selection List Code Set Version review"
"RTN","GMPLBLCK",61,0)
 S XMDUZ="Code Set Version Install"
"RTN","GMPLBLCK",62,0)
 S XMTEXT="^TMP(""GMPLMSG"",$J,"
"RTN","GMPLBLCK",63,0)
 D ^XMD
"RTN","GMPLBLCK",64,0)
 K ^TMP("GMPLSL",$J),^TMP("GMPLMSG",$J)
"RTN","GMPLBLCK",65,0)
 Q
"RTN","GMPLBLCK",66,0)
 ;
"RTN","GMPLBLCK",67,0)
CSVOPT ; called from option GMPL SELECTION LIST CSV CHECK
"RTN","GMPLBLCK",68,0)
 ;
"RTN","GMPLBLCK",69,0)
 N %ZIS,POP
"RTN","GMPLBLCK",70,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","GMPLBLCK",71,0)
 I $D(IO("Q")) D  D ^%ZISC,HOME^%ZIS Q
"RTN","GMPLBLCK",72,0)
 . N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","GMPLBLCK",73,0)
 . S ZTDESC="Review of GMPL SEL LISTS for CSV"
"RTN","GMPLBLCK",74,0)
 . S ZTRTN="QUEUE^GMPLBLCK",ZTIO=ION,ZTDTH=$H
"RTN","GMPLBLCK",75,0)
 . D ^%ZTLOAD
"RTN","GMPLBLCK",76,0)
 . I '$G(ZTSK) W !,"Unable to task report"
"RTN","GMPLBLCK",77,0)
 . Q
"RTN","GMPLBLCK",78,0)
 ;
"RTN","GMPLBLCK",79,0)
QUEUE ; entry point for tasked report
"RTN","GMPLBLCK",80,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMPLBLCK",81,0)
 U IO
"RTN","GMPLBLCK",82,0)
 N CAT,LN,LST,LIST,PAGE
"RTN","GMPLBLCK",83,0)
 D CKLISTS,CKCODES
"RTN","GMPLBLCK",84,0)
 S PAGE=1 D PAGE(.PAGE)
"RTN","GMPLBLCK",85,0)
 I '$D(^TMP("GMPLSL",$J)) D  ; no problems found
"RTN","GMPLBLCK",86,0)
 . W !,"No Problems Selection List corrections/review required"
"RTN","GMPLBLCK",87,0)
 . I $E(IOST,1,2)="C-" D
"RTN","GMPLBLCK",88,0)
 .. N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLCK",89,0)
 .. S DIR(0)="E" D ^DIR
"RTN","GMPLBLCK",90,0)
 . Q
"RTN","GMPLBLCK",91,0)
 ;
"RTN","GMPLBLCK",92,0)
 I $D(^TMP("GMPLSL",$J,"I")) D  ; some inactive problem codes
"RTN","GMPLBLCK",93,0)
 . W !,"The following Problem Selection List(s) contain one or more problems that"
"RTN","GMPLBLCK",94,0)
 . W !,"have inactive ICD codes attached to them. Any current users or clinics using"
"RTN","GMPLBLCK",95,0)
 . W !,"these Selection Lists, will not be able to add the problems with inactive "
"RTN","GMPLBLCK",96,0)
 . W !,"codes, until the list and the inactive codes are updated. The list may not be"
"RTN","GMPLBLCK",97,0)
 . W !,"assigned to any additional users or clinics until updated.",!
"RTN","GMPLBLCK",98,0)
 . S LST=0
"RTN","GMPLBLCK",99,0)
 . F  S LST=$O(^TMP("GMPLSL",$J,"I",LST)) Q:'LST!(PAGE<1)  D
"RTN","GMPLBLCK",100,0)
 .. I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",101,0)
 .. W !,"   "_^TMP("GMPLSL",$J,"I",LST)
"RTN","GMPLBLCK",102,0)
 ;
"RTN","GMPLBLCK",103,0)
 I $D(^TMP("GMPLSL",$J,"F")) D  ; future inact. dates
"RTN","GMPLBLCK",104,0)
 . D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",105,0)
 . W !,"The following Problem Selection List categories contain problems with ICD"
"RTN","GMPLBLCK",106,0)
 . W !,"codes that have a future inactivation date. These Categories should be updated"
"RTN","GMPLBLCK",107,0)
 . W !,"as soon as possible after the inactivation date to reduce the interruption of"
"RTN","GMPLBLCK",108,0)
 . W !,"use of the selection list(s) by users or clinics.",!
"RTN","GMPLBLCK",109,0)
 . S CAT=0
"RTN","GMPLBLCK",110,0)
 . F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",111,0)
 .. I IOSL-$Y<8 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",112,0)
 .. W !!!," Category name: "_$$GET1^DIQ(125.11,CAT,.01),!
"RTN","GMPLBLCK",113,0)
 .. W !,"    Problems with ICD codes due to be inactivated:",!
"RTN","GMPLBLCK",114,0)
 .. N PROB,TXT
"RTN","GMPLBLCK",115,0)
 .. S PROB=0
"RTN","GMPLBLCK",116,0)
 .. F  S PROB=$O(^TMP("GMPLSL",$J,"F",CAT,PROB)) Q:'PROB!(PAGE<1)  D
"RTN","GMPLBLCK",117,0)
 ... S TXT=^TMP("GMPLSL",$J,"F",CAT,PROB)
"RTN","GMPLBLCK",118,0)
 ... I IOSL-$Y<5 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",119,0)
 ... W !,"       Problem text: "_$P(TXT,U)
"RTN","GMPLBLCK",120,0)
 ... W !,"       Display text: "_$P(TXT,U,2)
"RTN","GMPLBLCK",121,0)
 ... W !,"               Code: "_$P(TXT,U,3)
"RTN","GMPLBLCK",122,0)
 ... W !,"      Inactive Date: "_$P(TXT,U,4),!
"RTN","GMPLBLCK",123,0)
 .. I '$D(^TMP("GMPLSL",$J,"F",CAT,"L")) Q  ; category not part of lists
"RTN","GMPLBLCK",124,0)
 .. I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",125,0)
 .. W !!,"    This Category is part of the following Problem Selection Lists:",!
"RTN","GMPLBLCK",126,0)
 .. S LIST=0
"RTN","GMPLBLCK",127,0)
 .. F  S LIST=$O(^TMP("GMPLSL",$J,"F",CAT,"L",LIST)) Q:'LIST!(PAGE<1)  D
"RTN","GMPLBLCK",128,0)
 ... I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",129,0)
 ... W !,"     "_^TMP("GMPLSL",$J,"F",CAT,"L",LIST)
"RTN","GMPLBLCK",130,0)
 .. Q
"RTN","GMPLBLCK",131,0)
 . Q
"RTN","GMPLBLCK",132,0)
 D:$E(IOST,1,2)'="C-" ^%ZISC
"RTN","GMPLBLCK",133,0)
 D HOME^%ZIS
"RTN","GMPLBLCK",134,0)
 K ^TMP("GMPLSL",$J)
"RTN","GMPLBLCK",135,0)
 Q
"RTN","GMPLBLCK",136,0)
 ;
"RTN","GMPLBLCK",137,0)
CKLISTS ; loop lists and see if any inactive problems
"RTN","GMPLBLCK",138,0)
 ;
"RTN","GMPLBLCK",139,0)
 ; returns ^TMP("GMPLSL",$J,"I"
"RTN","GMPLBLCK",140,0)
 ;
"RTN","GMPLBLCK",141,0)
 K ^TMP("GMPLSL",$J,"I")
"RTN","GMPLBLCK",142,0)
 N LST
"RTN","GMPLBLCK",143,0)
 S LST=0
"RTN","GMPLBLCK",144,0)
 F  S LST=$O(^GMPL(125,LST)) Q:'LST  I '$$VALLIST^GMPLBLD2(LST) D
"RTN","GMPLBLCK",145,0)
 . S ^TMP("GMPLSL",$J,"I",LST)=$P(^GMPL(125,LST,0),U)
"RTN","GMPLBLCK",146,0)
 . Q
"RTN","GMPLBLCK",147,0)
 Q
"RTN","GMPLBLCK",148,0)
 ;
"RTN","GMPLBLCK",149,0)
CKCODES ; check probs on lists for future inactivation dates
"RTN","GMPLBLCK",150,0)
 ;
"RTN","GMPLBLCK",151,0)
 ; returns:
"RTN","GMPLBLCK",152,0)
 ;   ^TMP("GMPLSL",$J,"F",category,problem)
"RTN","GMPLBLCK",153,0)
 ;   ^TMP("GMPLSL",$J,"F",category,"L",list)
"RTN","GMPLBLCK",154,0)
 ;
"RTN","GMPLBLCK",155,0)
 K ^TMP("GMPLSL",$J,"F")
"RTN","GMPLBLCK",156,0)
 N PROB,CAT,LIST
"RTN","GMPLBLCK",157,0)
 S PROB=0
"RTN","GMPLBLCK",158,0)
 F  S PROB=$O(^GMPL(125.12,PROB)) Q:'PROB  I $L($P(^(PROB,0),U,5)) D
"RTN","GMPLBLCK",159,0)
 . N PROB0,PROBTX,APIDATA,PROBCAT,ACTDT,GMPCSPTR
"RTN","GMPLBLCK",160,0)
 . S PROB0=^GMPL(125.12,PROB,0),GMPCSPTR=+$$CODECS^ICDEX($P(PROB0,U,5),80,DT)
"RTN","GMPLBLCK",161,0)
 . I '$$STATCHK^ICDXCODE(GMPCSPTR,$P(PROB0,U,5),DT) Q  ;already inactive
"RTN","GMPLBLCK",162,0)
 . S APIDATA=$$HIST^ICDXCODE(GMPCSPTR,$P(PROB0,U,5),.APIDATA)
"RTN","GMPLBLCK",163,0)
 . S ACTDT=+$O(APIDATA(DT))
"RTN","GMPLBLCK",164,0)
 . Q:'ACTDT  ; no future activity
"RTN","GMPLBLCK",165,0)
 . I $G(APIDATA(ACTDT)) Q  ; no future inactivation = OK
"RTN","GMPLBLCK",166,0)
 . S PROBTX=$$GET1^DIQ(125.12,PROB,2)
"RTN","GMPLBLCK",167,0)
 . S PROBCAT=$P(PROB0,U)
"RTN","GMPLBLCK",168,0)
 . S ^TMP("GMPLSL",$J,"F",PROBCAT,PROB)=PROBTX_U_$P(PROB0,U,4)_U_$P(PROB0,U,5)_U_$$FMTE^XLFDT(ACTDT)
"RTN","GMPLBLCK",169,0)
 . Q
"RTN","GMPLBLCK",170,0)
 ;
"RTN","GMPLBLCK",171,0)
 ; find lists that contain the categories
"RTN","GMPLBLCK",172,0)
 S CAT=0
"RTN","GMPLBLCK",173,0)
 F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",174,0)
 . I '$D(^GMPL(125.1,"G",CAT)) Q  ; category not part of any lists
"RTN","GMPLBLCK",175,0)
 . N LIST S LIST=0
"RTN","GMPLBLCK",176,0)
 . F  S LIST=$O(^GMPL(125.1,"G",CAT,LIST)) Q:'LIST  D
"RTN","GMPLBLCK",177,0)
 .. S ^TMP("GMPLSL",$J,"F",CAT,"L",LIST)=$$GET1^DIQ(125.1,LIST,.01)
"RTN","GMPLBLCK",178,0)
 .. Q
"RTN","GMPLBLCK",179,0)
 . Q
"RTN","GMPLBLCK",180,0)
 Q
"RTN","GMPLBLCK",181,0)
 ;
"RTN","GMPLBLCK",182,0)
PAGE(NUM) ;print header and raise page number
"RTN","GMPLBLCK",183,0)
 Q:'$G(NUM)
"RTN","GMPLBLCK",184,0)
 I NUM'=1,$E(IOST,1,2)="C-" D  Q:'NUM
"RTN","GMPLBLCK",185,0)
 . N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLCK",186,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLCK",187,0)
 . I $D(DTOUT)!($D(DUOUT)) S NUM=0
"RTN","GMPLBLCK",188,0)
 W @IOF
"RTN","GMPLBLCK",189,0)
 W "Code Set Version review of Problem Selection Lists"
"RTN","GMPLBLCK",190,0)
 W ?70,"Page: ",NUM
"RTN","GMPLBLCK",191,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMPLBLCK",192,0)
 S NUM=NUM+1
"RTN","GMPLBLCK",193,0)
 Q
"RTN","GMPLBLD")
0^5^B40896802
"RTN","GMPLBLD",1,0)
GMPLBLD ; SLC/MKB/TC -- Build Problem Selection Lists ;08/21/12  10:01
"RTN","GMPLBLD",2,0)
 ;;2.0;Problem List;**3,28,33,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLD",3,0)
 ;
"RTN","GMPLBLD",4,0)
 ;This routine invokes ICR #5699 & #5747
"RTN","GMPLBLD",5,0)
 ;
"RTN","GMPLBLD",6,0)
EN ; -- main entry point
"RTN","GMPLBLD",7,0)
 D EN^VALM("GMPL SELECTION LIST BUILD")
"RTN","GMPLBLD",8,0)
 Q
"RTN","GMPLBLD",9,0)
 ;
"RTN","GMPLBLD",10,0)
HDR ; -- header code
"RTN","GMPLBLD",11,0)
 N NAME,NUM,DATE
"RTN","GMPLBLD",12,0)
 S NUM=+^TMP("GMPLST",$J,0)_" categor"_$S(+^TMP("GMPLST",$J,0)'=1:"ies",1:"y")
"RTN","GMPLBLD",13,0)
 S DATE="Last Modified: "_$S(+$P(GMPLSLST,U,3):$$FMTE^XLFDT($P(GMPLSLST,U,3)),1:"<new list>")
"RTN","GMPLBLD",14,0)
 S VALMHDR(1)=DATE_$J(NUM,79-$L(DATE))
"RTN","GMPLBLD",15,0)
 S NAME=$P(GMPLSLST,U,2),VALMHDR(2)=$J(NAME,$L(NAME)\2+41)
"RTN","GMPLBLD",16,0)
 Q
"RTN","GMPLBLD",17,0)
 ;
"RTN","GMPLBLD",18,0)
INIT ; -- init variables and list array
"RTN","GMPLBLD",19,0)
 S GMPLSLST=$$LIST^GMPLBLD2("L") I GMPLSLST="^" S VALMQUIT=1 Q
"RTN","GMPLBLD",20,0)
 L +^GMPL(125,+GMPLSLST,0):1 I '$T D  G INIT
"RTN","GMPLBLD",21,0)
 . W $C(7),!!,"This list is currently being edited by another user!",!
"RTN","GMPLBLD",22,0)
 S GMPLMODE="E",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",23,0)
 D GETLIST,BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD",24,0)
 D LENGTH
"RTN","GMPLBLD",25,0)
 Q
"RTN","GMPLBLD",26,0)
 ;
"RTN","GMPLBLD",27,0)
GETLIST ; Build ^TMP("GMPLIST",$J,#)
"RTN","GMPLBLD",28,0)
 N IFN,SEQ,GRP,ITEM,CNT K ^TMP("GMPLIST",$J) S CNT=0
"RTN","GMPLBLD",29,0)
 W !,"Searching for the list ..."
"RTN","GMPLBLD",30,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.1,"B",+GMPLSLST,IFN)) Q:IFN'>0  D
"RTN","GMPLBLD",31,0)
 . S ITEM=$G(^GMPL(125.1,IFN,0)),SEQ=$P(ITEM,U,2),GRP=$P(ITEM,U,3)
"RTN","GMPLBLD",32,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(ITEM,U,2,5),CNT=CNT+1 ; seq ^ group ^ subhdr ^ probs
"RTN","GMPLBLD",33,0)
 . S (^TMP("GMPLIST",$J,"GRP",GRP),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN
"RTN","GMPLBLD",34,0)
 S ^TMP("GMPLIST",$J,0)=CNT
"RTN","GMPLBLD",35,0)
 Q
"RTN","GMPLBLD",36,0)
 ;
"RTN","GMPLBLD",37,0)
BUILD(LIST,MODE) ; Build ^TMP("GMPLST",$J,)
"RTN","GMPLBLD",38,0)
 N SEQ,LCNT,NUM,HDR,GROUP,IFN,ITEM,PSEQ D CLEAN^VALM10
"RTN","GMPLBLD",39,0)
 S:'$D(^TMP("GMPLIST",$J,0)) ^TMP("GMPLIST",$J,0)=0
"RTN","GMPLBLD",40,0)
 I $P($G(^TMP("GMPLIST",$J,0)),U,1)'>0 S ^TMP("GMPLST",$J,1,0)="   ",^TMP("GMPLST",$J,2,0)="No items available.",^TMP("GMPLST",$J,0)="0^2",VALMCNT=2 Q
"RTN","GMPLBLD",41,0)
 S (LCNT,NUM,SEQ)=0
"RTN","GMPLBLD",42,0)
 F  S SEQ=$O(^TMP("GMPLIST",$J,"SEQ",SEQ)) Q:SEQ'>0  D
"RTN","GMPLBLD",43,0)
 . S IFN=^TMP("GMPLIST",$J,"SEQ",SEQ),LCNT=LCNT+1,NUM=NUM+1
"RTN","GMPLBLD",44,0)
 . S GROUP=$P(^TMP("GMPLIST",$J,IFN),U,2),HDR=$P(^TMP("GMPLIST",$J,IFN),U,3)
"RTN","GMPLBLD",45,0)
 . S:'$L(HDR) HDR="<no header>"
"RTN","GMPLBLD",46,0)
 . I LCNT>1,+$P(^TMP("GMPLIST",$J,IFN),U,4),^TMP("GMPLST",$J,LCNT-1,0)'="   " S LCNT=LCNT+1,^TMP("GMPLST",$J,LCNT,0)="   "
"RTN","GMPLBLD",47,0)
 . S ^TMP("GMPLST",$J,LCNT,0)=$S(MODE="I":$J("<"_SEQ_">",8),1:"        ")_$J(NUM,4)_" "_HDR,^TMP("GMPLST",$J,"B",NUM)=IFN
"RTN","GMPLBLD",48,0)
 . D CNTRL^VALM10(LCNT,9,5,IOINHI,IOINORM)
"RTN","GMPLBLD",49,0)
 . Q:'+$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLD",50,0)
 . D CNTRL^VALM10(LCNT,14,$L(HDR),IOUON,IOUOFF)
"RTN","GMPLBLD",51,0)
 . F PSEQ=0:0 S PSEQ=$O(^GMPL(125.12,"C",+GROUP,PSEQ)) Q:PSEQ'>0  D
"RTN","GMPLBLD",52,0)
 .. S IFN=$O(^GMPL(125.12,"C",+GROUP,PSEQ,0)),LCNT=LCNT+1
"RTN","GMPLBLD",53,0)
 .. S ITEM=$G(^GMPL(125.12,IFN,0)),^TMP("GMPLST",$J,LCNT,0)="             "_$P(ITEM,U,4)
"RTN","GMPLBLD",54,0)
 .. I $L($P(ITEM,U,5)) D
"RTN","GMPLBLD",55,0)
 ... N GMI,GMPCSPTR,GMPCSREC,GMPCSNME
"RTN","GMPLBLD",56,0)
 ... S GMPCSREC=$$CODECS^ICDEX($P($P(ITEM,U,5),"/"),80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLBLD",57,0)
 ... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_" ("_GMPCSNME_" "_$P(ITEM,U,5)_")"
"RTN","GMPLBLD",58,0)
 ... F GMI=1:1:$L($P(ITEM,U,5),"/") D
"RTN","GMPLBLD",59,0)
 .... I $$STATCHK^ICDXCODE(GMPCSPTR,$P($P(ITEM,U,5),"/",GMI),DT) Q  ; code is active
"RTN","GMPLBLD",60,0)
 .... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_"    <INACTIVE CODE>"
"RTN","GMPLBLD",61,0)
 . S LCNT=LCNT+1,^TMP("GMPLST",$J,LCNT,0)="   "
"RTN","GMPLBLD",62,0)
 S ^TMP("GMPLST",$J,0)=NUM_U_LCNT,VALMCNT=LCNT
"RTN","GMPLBLD",63,0)
 Q
"RTN","GMPLBLD",64,0)
 ;
"RTN","GMPLBLD",65,0)
HELP ; -- help code
"RTN","GMPLBLD",66,0)
 N X
"RTN","GMPLBLD",67,0)
 W !!?4,"You may take a variety of actions to update this selection list."
"RTN","GMPLBLD",68,0)
 W !?4,"New categories may be added to this list, or an existing one"
"RTN","GMPLBLD",69,0)
 W !?4,"removed; Edit Category will allow you to change the contents of"
"RTN","GMPLBLD",70,0)
 W !?4,"a category, or create a new one that may be added to this list."
"RTN","GMPLBLD",71,0)
 W !?4,"You may also change how each category appears in this list,"
"RTN","GMPLBLD",72,0)
 W !?4,"view each category's sequence number to facilitate resequencing,"
"RTN","GMPLBLD",73,0)
 W !?4,"assign this list to a clinic or user(s), or edit a different list."
"RTN","GMPLBLD",74,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMPLBLD",75,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLD",76,0)
 Q
"RTN","GMPLBLD",77,0)
 ;
"RTN","GMPLBLD",78,0)
EXIT ; -- exit code
"RTN","GMPLBLD",79,0)
 I $D(GMPLSAVE),$$CKSAVE^GMPLBLD2 D
"RTN","GMPLBLD",80,0)
 . D SAVE^GMPLBLD2
"RTN","GMPLBLD",81,0)
 . S ^GMPL(125,+GMPLSLST,0)=$P(GMPLSLST,U,2)_U_DT_U_$P(GMPLSLST,U,4)
"RTN","GMPLBLD",82,0)
 L -^GMPL(125,+GMPLSLST,0)
"RTN","GMPLBLD",83,0)
 K GMPLIST,GMPLST,GMPLMODE,GMPLSLST,GMPLSAVE,GMPREBLD,GMPQUIT,RT,TMPLST
"RTN","GMPLBLD",84,0)
 K ^TMP("GMPLIST",$J),^TMP("GMPLST",$J)
"RTN","GMPLBLD",85,0)
 Q
"RTN","GMPLBLD",86,0)
 ;
"RTN","GMPLBLD",87,0)
ADD ; Add group(s)
"RTN","GMPLBLD",88,0)
 N SEQ,GROUP,HDR,IFN,GMPQUIT,GMPREBLD D FULL^VALM1
"RTN","GMPLBLD",89,0)
 F  D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD",90,0)
 . S GROUP=$$GROUP^GMPLBLD2("") I GROUP="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",91,0)
 . I $D(^TMP("GMPLIST",$J,"GRP",+GROUP)) W !?4,">>>  This category is already part of this list!" Q
"RTN","GMPLBLD",92,0)
 . I '$$VALGRP^GMPLBLD2(+GROUP) D  Q
"RTN","GMPLBLD",93,0)
 .. D FULL^VALM1
"RTN","GMPLBLD",94,0)
 .. W !!,$C(7),"This category contains one or more problems with inactive ICD codes. "
"RTN","GMPLBLD",95,0)
 .. W !,"These codes must be updated before adding the category to a selection list."
"RTN","GMPLBLD",96,0)
 .. N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLD",97,0)
 .. S DIR(0)="E" D ^DIR
"RTN","GMPLBLD",98,0)
 .. S VALMBCK="R"
"RTN","GMPLBLD",99,0)
 . S HDR=$$HDR^GMPLBLD1($P(GROUP,U,2)) I HDR="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",100,0)
 . S RT="^TMP(""GMPLIST"",$J,""SEQ"",",SEQ=+$$LAST^GMPLBLD2(RT)+1
"RTN","GMPLBLD",101,0)
 . S SEQ=$$SEQ^GMPLBLD1(SEQ) I SEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",102,0)
 . S IFN=$$TMPIFN^GMPLBLD1,^TMP("GMPLIST",$J,IFN)=SEQ_U_+GROUP_U_HDR_"^1"
"RTN","GMPLBLD",103,0)
 . S (^TMP("GMPLIST",$J,"GRP",+GROUP),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN,^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)+1,GMPREBLD=1
"RTN","GMPLBLD",104,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLD",105,0)
 S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",106,0)
 Q
"RTN","GMPLBLD",107,0)
 ;
"RTN","GMPLBLD",108,0)
EDIT ; Edit category contents
"RTN","GMPLBLD",109,0)
 N GMPLIST,GMPLST,GMPLMODE,GMPLGRP,GMPLSAVE
"RTN","GMPLBLD",110,0)
 D EN^VALM("GMPL SELECTION GROUP BUILD")
"RTN","GMPLBLD",111,0)
 S GMPLMODE="E"
"RTN","GMPLBLD",112,0)
 D GETLIST,BUILD("TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD",113,0)
 S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",114,0)
 Q
"RTN","GMPLBLD",115,0)
 ;
"RTN","GMPLBLD",116,0)
REMOVE ; Remove group
"RTN","GMPLBLD",117,0)
 N NUM,IFN,SEQ,GRP,DIR,X,Y S VALMBCK=""
"RTN","GMPLBLD",118,0)
 S NUM=$$SEL1^GMPLBLD1 G:NUM="^" RMQ
"RTN","GMPLBLD",119,0)
 S IFN=$G(^TMP("GMPLST",$J,"B",NUM)) G:+IFN'>0 RMQ
"RTN","GMPLBLD",120,0)
 I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Category is not part of this list!" H 2 G RMQ
"RTN","GMPLBLD",121,0)
 S DIR("A")="Are you sure you want to remove '"_$P(^TMP("GMPLIST",$J,IFN),U,3)_"'? "
"RTN","GMPLBLD",122,0)
 S DIR("?")="Enter YES to delete this category from the current list; enter NO to exit."
"RTN","GMPLBLD",123,0)
 S DIR(0)="YA",DIR("B")="NO" D ^DIR
"RTN","GMPLBLD",124,0)
 I 'Y W !?5,"< Nothing removed! >" H 1 G RMQ
"RTN","GMPLBLD",125,0)
 D DELETE^GMPLBLD1(IFN) S VALMBCK="R",GMPLSAVE=1
"RTN","GMPLBLD",126,0)
 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLD",127,0)
RMQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",128,0)
 Q
"RTN","GMPLBLD",129,0)
 ;
"RTN","GMPLBLD",130,0)
LENGTH ;SHORTEN THE ICD9'S DESCRIPTION TO FIT SCREEN
"RTN","GMPLBLD",131,0)
 S LLCNT=0
"RTN","GMPLBLD",132,0)
 F  S LLCNT=$O(^TMP("GMPLST",$J,LLCNT)) Q:LLCNT=""  Q:LLCNT'?1N.N  D
"RTN","GMPLBLD",133,0)
 .; I '$D(^TMP("GMPLST",$J,LLCNT,O)) Q
"RTN","GMPLBLD",134,0)
 . S ICD9VAR=^TMP("GMPLST",$J,LLCNT,0) I $L(ICD9VAR)>50 D
"RTN","GMPLBLD",135,0)
 .. S ICD9VAR=$P(ICD9VAR,"(",1)
"RTN","GMPLBLD",136,0)
 .. S ICD9VAR=$E(ICD9VAR,1,50)_" ("_$P(^TMP("GMPLST",$J,LLCNT,0),"(",2)
"RTN","GMPLBLD",137,0)
 .. S ^TMP("GMPLST",$J,LLCNT,0)=ICD9VAR
"RTN","GMPLBLD",138,0)
 Q
"RTN","GMPLBLD1")
0^13^B34803359
"RTN","GMPLBLD1",1,0)
GMPLBLD1 ; ISL/MKB,JER,TC - Bld PL Selection Lists cont ;11/27/12  08:13
"RTN","GMPLBLD1",2,0)
 ;;2.0;Problem List;**3,28,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLD1",3,0)
 ;
"RTN","GMPLBLD1",4,0)
 ; This routine invokes ICR #5747
"RTN","GMPLBLD1",5,0)
 ;
"RTN","GMPLBLD1",6,0)
SEL() ; Select item(s) from list
"RTN","GMPLBLD1",7,0)
 N DIR,X,Y,MAX,GRP,DTOUT S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",8,0)
 S MAX=$P($G(^TMP("GMPLST",$J,0)),U,1) I MAX'>0 Q "^"
"RTN","GMPLBLD1",9,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select "_$S('GRP:"Category",1:"Problem")_"(s)"
"RTN","GMPLBLD1",10,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLBLD1",11,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLBLD1",12,0)
 S DIR("?")="Enter the "_$S('GRP:"categories",1:"problems")_" you wish to select, as a range or list of numbers"
"RTN","GMPLBLD1",13,0)
 D ^DIR S:$D(DTOUT)!(X="") Y="^"
"RTN","GMPLBLD1",14,0)
 Q Y
"RTN","GMPLBLD1",15,0)
 ;
"RTN","GMPLBLD1",16,0)
SEL1() ; Select item from list
"RTN","GMPLBLD1",17,0)
 N DIR,X,Y,MAX,GRP,DTOUT S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",18,0)
 S MAX=$P($G(^TMP("GMPLST",$J,0)),U,1) I MAX'>0 Q "^"
"RTN","GMPLBLD1",19,0)
 S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select "_$S('GRP:"Category",1:"Problem")
"RTN","GMPLBLD1",20,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLBLD1",21,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLBLD1",22,0)
 S DIR("?")="Enter the "_$S('GRP:"category",1:"problem")_" you wish to select, by number"
"RTN","GMPLBLD1",23,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLBLD1",24,0)
 Q Y
"RTN","GMPLBLD1",25,0)
 ;
"RTN","GMPLBLD1",26,0)
SEQ(NUM) ; Enter/edit seq #, returns new #
"RTN","GMPLBLD1",27,0)
 N DIR,X,Y,GRP,DTOUT S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",28,0)
 S DIR(0)="NA^.01:999.99:2",DIR("A")="SEQUENCE: " S:NUM DIR("B")=NUM
"RTN","GMPLBLD1",29,0)
 S DIR("?",1)="Enter a number indicating the sequence of this item in the "_$S('GRP:"list;",1:"category;")
"RTN","GMPLBLD1",30,0)
 S DIR("?")="up to 2 decimal places may be used, to order these items."
"RTN","GMPLBLD1",31,0)
SQ D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",32,0)
 I X?1"^".E W $C(7),$$NOJUMP G SQ
"RTN","GMPLBLD1",33,0)
 I Y=NUM Q NUM
"RTN","GMPLBLD1",34,0)
 I $D(^TMP("GMPLIST",$J,"SEQ",Y)) D  G SQ
"RTN","GMPLBLD1",35,0)
 . W $C(7),!!,"Sequence number already in use!  Please enter another number."
"RTN","GMPLBLD1",36,0)
 . W !,"Use the 'Change View' option to display the current sequence numbers.",!
"RTN","GMPLBLD1",37,0)
 Q Y
"RTN","GMPLBLD1",38,0)
 ;
"RTN","GMPLBLD1",39,0)
HDR(TEXT) ; Enter/edit group subheader text in list
"RTN","GMPLBLD1",40,0)
 N DIR,X,Y,DTOUT S:$L(TEXT) DIR("B")=TEXT
"RTN","GMPLBLD1",41,0)
 S DIR(0)="FAO^2:30",DIR("A")="HEADER: "
"RTN","GMPLBLD1",42,0)
 S DIR("?")="Enter the text you wish displayed as a header for this category of problems"
"RTN","GMPLBLD1",43,0)
 S:$D(DIR("B")) DIR("?",1)=DIR("?")_";",DIR("?")="enter '@' if no header text is desired."
"RTN","GMPLBLD1",44,0)
H1 D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",45,0)
 I X?1"^".E W $C(7),$$NOJUMP G H1
"RTN","GMPLBLD1",46,0)
 I X="@" Q:$$SURE^GMPLX "" G H1
"RTN","GMPLBLD1",47,0)
 Q Y
"RTN","GMPLBLD1",48,0)
 ;
"RTN","GMPLBLD1",49,0)
TEXT(TEXT) ; Edit problem text
"RTN","GMPLBLD1",50,0)
 N DIR,X,Y,DTOUT S:$L(TEXT) DIR("B")=TEXT
"RTN","GMPLBLD1",51,0)
 S DIR(0)="FAO^2:80",DIR("A")=" DISPLAY TEXT: "
"RTN","GMPLBLD1",52,0)
 S DIR("?")="Enter the text you wish presented here for this problem."
"RTN","GMPLBLD1",53,0)
T1 D ^DIR I $D(DTOUT)!("^"[X) S Y="^" G TQ
"RTN","GMPLBLD1",54,0)
 I X?1"^".E W $C(7),$$NOJUMP G T1
"RTN","GMPLBLD1",55,0)
 I X="@" G:'$$SURE^GMPLX T1 S Y="@" G TQ
"RTN","GMPLBLD1",56,0)
TQ Q Y
"RTN","GMPLBLD1",57,0)
 ;
"RTN","GMPLBLD1",58,0)
CODE(SCTCODE,ICDCODE) ; Confirm problem codes
"RTN","GMPLBLD1",59,0)
 N DIR,X,Y,CODESYS,GMPCSREC,DTOUT
"RTN","GMPLBLD1",60,0)
 S GMPCSREC=$$CODECS^ICDEX(ICDCODE,80,DT),CODESYS=$P(GMPCSREC,U,2)
"RTN","GMPLBLD1",61,0)
 W !!?2,"The following ",$S(SCTCODE]"":"SNOMED CT & ",1:""),CODESYS," Code(s) are associated with the problem",!?2,"you selected:"
"RTN","GMPLBLD1",62,0)
 I SCTCODE]"" W !!?2,"SNOMED CT: ",SCTCODE,?24,CODESYS,": ",ICDCODE,!
"RTN","GMPLBLD1",63,0)
 E  W !!?2,CODESYS,": ",ICDCODE,!
"RTN","GMPLBLD1",64,0)
 S DIR(0)="YA",DIR("A")="  ... Ok? "
"RTN","GMPLBLD1",65,0)
 S DIR("?")="Please indicate ((Y)es or (N)o) whether the problem/code(s) specified are appropriate."
"RTN","GMPLBLD1",66,0)
C1 D ^DIR I $D(DTOUT)!(X="^") S Y="^" G CQ
"RTN","GMPLBLD1",67,0)
 I X?1"^".E W $C(7),$$NOJUMP G C1
"RTN","GMPLBLD1",68,0)
 I X="@" G:'$$SURE^GMPLX C1 S Y=""
"RTN","GMPLBLD1",69,0)
 S:+Y'>0 Y="" S:+Y>0 Y=ICDCODE
"RTN","GMPLBLD1",70,0)
 W !
"RTN","GMPLBLD1",71,0)
CQ Q Y
"RTN","GMPLBLD1",72,0)
 ;
"RTN","GMPLBLD1",73,0)
FLAG(DFLT) ; Edit category flag
"RTN","GMPLBLD1",74,0)
 N DIR,X,Y,DTOUT S DIR(0)="YAO",DIR("B")=$S(+DFLT:"YES",1:"NO")
"RTN","GMPLBLD1",75,0)
 S DIR("A")="SHOW PROBLEMS AUTOMATICALLY? "
"RTN","GMPLBLD1",76,0)
 S DIR("?",1)="Enter YES if you wish the problems contained in this category to be",DIR("?",2)="automatically displayed upon entry to this list; NO will display only the",DIR("?")="category header until the user selects it to view."
"RTN","GMPLBLD1",77,0)
F1 D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",78,0)
 I X?1"^".E W $C(7),$$NOJUMP G F1
"RTN","GMPLBLD1",79,0)
 Q Y
"RTN","GMPLBLD1",80,0)
 ;
"RTN","GMPLBLD1",81,0)
NOJUMP() ; Message
"RTN","GMPLBLD1",82,0)
 Q "   ^-jumping not allowed!"
"RTN","GMPLBLD1",83,0)
 ;
"RTN","GMPLBLD1",84,0)
RETURN() ; End of page prompt
"RTN","GMPLBLD1",85,0)
 N DIR,X,Y
"RTN","GMPLBLD1",86,0)
 S DIR(0)="E" D ^DIR
"RTN","GMPLBLD1",87,0)
 Q +Y
"RTN","GMPLBLD1",88,0)
 ;
"RTN","GMPLBLD1",89,0)
TMPIFN() ; Get temporary IFN ("#N") for ^TMP("GMPLIST",$J,)
"RTN","GMPLBLD1",90,0)
 N I,LAST S (I,LAST)=0
"RTN","GMPLBLD1",91,0)
 F  S I=$O(^TMP("GMPLIST",$J,I)) Q:+I'>0  S:I?1.N1"N" LAST=+I
"RTN","GMPLBLD1",92,0)
 S I=LAST+1,I=$E("0000",1,4-$L(I))_I
"RTN","GMPLBLD1",93,0)
TMPQ Q I_"N"
"RTN","GMPLBLD1",94,0)
 ;
"RTN","GMPLBLD1",95,0)
DELETE(IFN) ; Kill entry in ^TMP("GMPLIST",$J,)
"RTN","GMPLBLD1",96,0)
 N SEQ,ITEM S ^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)-1
"RTN","GMPLBLD1",97,0)
 S SEQ=+^TMP("GMPLIST",$J,IFN),ITEM=$P(^TMP("GMPLIST",$J,IFN),U,2),^TMP("GMPLIST",$J,IFN)="@"
"RTN","GMPLBLD1",98,0)
 K ^TMP("GMPLIST",$J,"SEQ",SEQ),^TMP("GMPLIST",$J,"PROB",ITEM),^TMP("GMPLIST",$J,"GRP",ITEM)
"RTN","GMPLBLD1",99,0)
 K:IFN?1.N1"N" ^TMP("GMPLIST",$J,IFN)
"RTN","GMPLBLD1",100,0)
 Q
"RTN","GMPLBLD1",101,0)
 ;
"RTN","GMPLBLD1",102,0)
RESEQ ; Resequence items
"RTN","GMPLBLD1",103,0)
 N SEL,NUM,SEQ,NSEQ,PIECE,IFN,GMPQUIT S VALMBCK=""
"RTN","GMPLBLD1",104,0)
 S SEL=$$SEL G:SEL="^" RSQ
"RTN","GMPLBLD1",105,0)
 F PIECE=1:1:$L(SEL,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD1",106,0)
 . S NUM=$P(SEL,",",PIECE) Q:NUM'>0
"RTN","GMPLBLD1",107,0)
 . S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:+IFN'>0  S SEQ=$P(^TMP("GMPLIST",$J,IFN),U,1)
"RTN","GMPLBLD1",108,0)
 . W !!,$P(^TMP("GMPLIST",$J,IFN),U,3)
"RTN","GMPLBLD1",109,0)
 . S NSEQ=$$SEQ(SEQ) I NSEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLD1",110,0)
 .I SEQ'=NSEQ S ^TMP("GMPLIST",$J,IFN)=NSEQ_U_$P(^TMP("GMPLIST",$J,IFN),U,2,$L(^TMP("GMPLIST",$J,IFN),U)),^TMP("GMPLIST",$J,"SEQ",NSEQ)=IFN,GMPREBLD=1 K ^TMP("GMPLIST",$J,"SEQ",SEQ)
"RTN","GMPLBLD1",111,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 ; D BUILD in exit action
"RTN","GMPLBLD1",112,0)
RSQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD1",113,0)
 Q
"RTN","GMPLBLD1",114,0)
 ;
"RTN","GMPLBLD1",115,0)
EDIT ; Edit category display
"RTN","GMPLBLD1",116,0)
 N GRPS,NUM,IFN,HDR,FLG,PIECE,GMPQUIT,GMPREBLD S VALMBCK=""
"RTN","GMPLBLD1",117,0)
 S GRPS=$$SEL G:GRPS="^" EDQ
"RTN","GMPLBLD1",118,0)
 F PIECE=1:1:$L(GRPS,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD1",119,0)
 . S NUM=$P(GRPS,",",PIECE) Q:NUM'>0
"RTN","GMPLBLD1",120,0)
 .S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:+IFN'>0
"RTN","GMPLBLD1",121,0)
 . S HDR=$P(^TMP("GMPLIST",$J,IFN),U,3),FLG=$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLD1",122,0)
 . S HDR=$$HDR(HDR) I HDR="^" S GMPQUIT=1 Q
"RTN","GMPLBLD1",123,0)
 . S FLG=$$FLAG(FLG) I FLG="^" S GMPQUIT=1 Q
"RTN","GMPLBLD1",124,0)
 . S $P(^TMP("GMPLIST",$J,IFN),U,3,4)=HDR_U_FLG,GMPREBLD=1
"RTN","GMPLBLD1",125,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD^GMPLBLD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD1",126,0)
EDQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD1",127,0)
 Q
"RTN","GMPLBLD2")
0^14^B52174697
"RTN","GMPLBLD2",1,0)
GMPLBLD2 ; SLC/MKB,JFR,TC -- Bld PL Selection Lists cont ;08/21/12  13:02
"RTN","GMPLBLD2",2,0)
 ;;2.0;Problem List;**3,28,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLD2",3,0)
 ;
"RTN","GMPLBLD2",4,0)
 ; This routine invokes ICR #5699, #5747
"RTN","GMPLBLD2",5,0)
 ;
"RTN","GMPLBLD2",6,0)
NEWGRP ; Change problem groups
"RTN","GMPLBLD2",7,0)
 N NEWGRP D FULL^VALM1
"RTN","GMPLBLD2",8,0)
 I $D(GMPLSAVE),$$CKSAVE D SAVE
"RTN","GMPLBLD2",9,0)
NG1 S NEWGRP=$$GROUP("L") G:+NEWGRP'>0 NGQ G:+NEWGRP=+GMPLGRP NGQ
"RTN","GMPLBLD2",10,0)
 L +^GMPL(125.11,+NEWGRP,0):1 I '$T D  G NG1
"RTN","GMPLBLD2",11,0)
 . W $C(7),!!,"This category is currently being edited by another user!",!
"RTN","GMPLBLD2",12,0)
 L -^GMPL(125.11,+GMPLGRP,0) S GMPLGRP=NEWGRP
"RTN","GMPLBLD2",13,0)
 D GETLIST^GMPLBLDC,BUILD^GMPLBLDC("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR^GMPLBLDC
"RTN","GMPLBLD2",14,0)
NGQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD2",15,0)
 Q
"RTN","GMPLBLD2",16,0)
 ;
"RTN","GMPLBLD2",17,0)
GROUP(L) ; Lookup into Problem Selection Group file #125.11
"RTN","GMPLBLD2",18,0)
 N DIC,X,Y,DLAYGO ; L = "" or "L", if LAYGO is [not] allowed
"RTN","GMPLBLD2",19,0)
 S DIC="^GMPL(125.11,",DIC(0)="AEQMZ"_L,DIC("A")="Select CATEGORY NAME: "
"RTN","GMPLBLD2",20,0)
 S:DIC(0)["L" DLAYGO=125.11
"RTN","GMPLBLD2",21,0)
 D ^DIC S:Y'>0 Y="^" S:Y'="^" Y=+Y_U_Y(0)
"RTN","GMPLBLD2",22,0)
 Q Y
"RTN","GMPLBLD2",23,0)
 ;
"RTN","GMPLBLD2",24,0)
NEWLST ; Change selection lists
"RTN","GMPLBLD2",25,0)
 N NEWLST D FULL^VALM1
"RTN","GMPLBLD2",26,0)
 I $D(GMPLSAVE),$$CKSAVE D SAVE
"RTN","GMPLBLD2",27,0)
NL1 S NEWLST=$$LIST("L") G:+NEWLST'>0 NLQ G:+NEWLST=+GMPLSLST NLQ
"RTN","GMPLBLD2",28,0)
 L +^GMPL(125,+NEWLST,0):1 I '$T D  G NL1
"RTN","GMPLBLD2",29,0)
 . W $C(7),!!,"This list is currently being edited by another user!",!
"RTN","GMPLBLD2",30,0)
 L -^GMPL(125,+GMPLSLST,0) S GMPLSLST=NEWLST
"RTN","GMPLBLD2",31,0)
 D GETLIST^GMPLBLD,BUILD^GMPLBLD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR^GMPLBLD
"RTN","GMPLBLD2",32,0)
NLQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD2",33,0)
 Q
"RTN","GMPLBLD2",34,0)
 ;
"RTN","GMPLBLD2",35,0)
LIST(L) ; Lookup into Problem Selection List file #125
"RTN","GMPLBLD2",36,0)
 N DIC,X,Y,DLAYGO ; L="" or "L" if LAYGO [not] allowed
"RTN","GMPLBLD2",37,0)
 S DIC="^GMPL(125,",DIC(0)="AEQMZ"_L,DIC("A")="Select LIST NAME: "
"RTN","GMPLBLD2",38,0)
 S:DIC(0)["L" DLAYGO=125
"RTN","GMPLBLD2",39,0)
 D ^DIC S:Y'>0 Y="^" S:Y'="^" Y=+Y_U_Y(0)
"RTN","GMPLBLD2",40,0)
 Q Y
"RTN","GMPLBLD2",41,0)
 ;
"RTN","GMPLBLD2",42,0)
LAST(ROOT) ; Returns last subscript
"RTN","GMPLBLD2",43,0)
 N I,J S (I,J)=""
"RTN","GMPLBLD2",44,0)
 F  S I=$O(@(ROOT_"I)")) Q:I=""  S J=I
"RTN","GMPLBLD2",45,0)
 Q J
"RTN","GMPLBLD2",46,0)
 ;
"RTN","GMPLBLD2",47,0)
CKSAVE() ; Save [changes] ??
"RTN","GMPLBLD2",48,0)
 N DIR,X,Y,TEXT S TEXT=$S($D(GMPLGRP):"category",1:"list")
"RTN","GMPLBLD2",49,0)
 S DIR("A")="Save the changes to this "_TEXT_"? ",DIR("B")="YES"
"RTN","GMPLBLD2",50,0)
 S DIR("?",1)="Enter YES to save the changes that have been made to this "_TEXT,DIR("?")="before exiting it; NO will leave this "_TEXT_" unchanged."
"RTN","GMPLBLD2",51,0)
 S DIR(0)="YA" D ^DIR
"RTN","GMPLBLD2",52,0)
 Q +Y
"RTN","GMPLBLD2",53,0)
 ;
"RTN","GMPLBLD2",54,0)
SAVE ; Save changes to group/list
"RTN","GMPLBLD2",55,0)
 N GMPLQT,LABEL,DA
"RTN","GMPLBLD2",56,0)
 S GMPLQT=0
"RTN","GMPLBLD2",57,0)
 I $D(GMPLGRP) D  I GMPLQT Q
"RTN","GMPLBLD2",58,0)
 . N ITM,CODE
"RTN","GMPLBLD2",59,0)
 . S ITM=0
"RTN","GMPLBLD2",60,0)
 . F  S ITM=$O(^TMP("GMPLIST",$J,ITM)) Q:'ITM!(GMPLQT)  D
"RTN","GMPLBLD2",61,0)
 .. N GMI
"RTN","GMPLBLD2",62,0)
 .. S CODE=$P(^TMP("GMPLIST",$J,ITM),U,4) Q:'$L(CODE)
"RTN","GMPLBLD2",63,0)
 .. F GMI=1:1:$L(CODE,"/") D
"RTN","GMPLBLD2",64,0)
 ... N GMPLCPTR S GMPLCPTR=$P($$CODECS^ICDEX($P(CODE,"/",GMI),80,DT),U)
"RTN","GMPLBLD2",65,0)
 ... I '$$STATCHK^ICDXCODE(GMPLCPTR,$P(CODE,"/",GMI),DT) S GMPLQT=1 Q
"RTN","GMPLBLD2",66,0)
 . I 'GMPLQT Q  ;no inactive codes in the category
"RTN","GMPLBLD2",67,0)
 . D FULL^VALM1
"RTN","GMPLBLD2",68,0)
 . W !!,$C(7),"This Group contains problems with inactive ICD codes associated with them."
"RTN","GMPLBLD2",69,0)
 . W !,"The codes must be edited and corrected before the group can be saved."
"RTN","GMPLBLD2",70,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD2",71,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD2",72,0)
 . S VALMBCK="R",GMPLQT=1
"RTN","GMPLBLD2",73,0)
 . Q
"RTN","GMPLBLD2",74,0)
 ;
"RTN","GMPLBLD2",75,0)
 I '$D(GMPLGRP),$D(GMPLSLST) D  I GMPLQT Q
"RTN","GMPLBLD2",76,0)
 . N GRP
"RTN","GMPLBLD2",77,0)
 . S GRP=0
"RTN","GMPLBLD2",78,0)
 . F  S GRP=$O(^TMP("GMPLIST",$J,"GRP",GRP)) Q:'GRP!(GMPLQT)  D
"RTN","GMPLBLD2",79,0)
 .. I $$VALGRP(GRP) Q  ;no inactive codes in the GROUP
"RTN","GMPLBLD2",80,0)
 .. S GMPLQT=1
"RTN","GMPLBLD2",81,0)
 . I 'GMPLQT Q  ; all groups and problems OK
"RTN","GMPLBLD2",82,0)
 . D FULL^VALM1
"RTN","GMPLBLD2",83,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD codes associated with"
"RTN","GMPLBLD2",84,0)
 . W !,"them. The codes must be edited and corrected before the list can be saved."
"RTN","GMPLBLD2",85,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD2",86,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD2",87,0)
 . S VALMBCK="R",GMPLQT=1
"RTN","GMPLBLD2",88,0)
 . Q
"RTN","GMPLBLD2",89,0)
 W !!,"Saving ..."
"RTN","GMPLBLD2",90,0)
 S DA=0,LABEL=$S($D(GMPLGRP):"SAVGRP",1:"SAVLST")
"RTN","GMPLBLD2",91,0)
 F  S DA=$O(^TMP("GMPLIST",$J,DA)) Q:+DA'>0  D @LABEL
"RTN","GMPLBLD2",92,0)
 K GMPLSAVE S:$D(GMPLGRP) GMPSAVED=1
"RTN","GMPLBLD2",93,0)
 S VALMBCK="Q" W " done." H 1
"RTN","GMPLBLD2",94,0)
 Q
"RTN","GMPLBLD2",95,0)
SAVGRP ; Save changes to existing group
"RTN","GMPLBLD2",96,0)
 N DIK,DIE,DR,ITEM,TMPITEM
"RTN","GMPLBLD2",97,0)
 S DIK="^GMPL(125.12,"
"RTN","GMPLBLD2",98,0)
 I +DA'=DA D  Q
"RTN","GMPLBLD2",99,0)
 . Q:"@"[$G(^TMP("GMPLIST",$J,DA))  ; nothing to save
"RTN","GMPLBLD2",100,0)
 . S TMPITEM=^TMP("GMPLIST",$J,DA) D NEW(DIK,+GMPLGRP,TMPITEM)
"RTN","GMPLBLD2",101,0)
 I "@"[$G(^TMP("GMPLIST",$J,DA)) D ^DIK Q
"RTN","GMPLBLD2",102,0)
 S ITEM=$P($G(^GMPL(125.12,DA,0)),U,2,7)
"RTN","GMPLBLD2",103,0)
 I ITEM'=^TMP("GMPLIST",$J,DA) D
"RTN","GMPLBLD2",104,0)
 . S DR="",DIE=DIK
"RTN","GMPLBLD2",105,0)
 . F I=1:1:6 D
"RTN","GMPLBLD2",106,0)
 .. S:$P(^TMP("GMPLIST",$J,DA),U,I)'=$P(ITEM,U,I) DR=DR_";"_I_"////"_$S($P(^TMP("GMPLIST",$J,DA),U,I)="":"@",1:$P(^TMP("GMPLIST",$J,DA),U,I))
"RTN","GMPLBLD2",107,0)
 . S:$E(DR)=";" DR=$E(DR,2,999) D ^DIE
"RTN","GMPLBLD2",108,0)
 Q
"RTN","GMPLBLD2",109,0)
 ;
"RTN","GMPLBLD2",110,0)
SAVLST ; Save changes to existing list
"RTN","GMPLBLD2",111,0)
 N DIK,DIE,DR,ITEM,TMPLST
"RTN","GMPLBLD2",112,0)
 S DIK="^GMPL(125.1,"
"RTN","GMPLBLD2",113,0)
 I +DA'=DA D  Q  ; new link
"RTN","GMPLBLD2",114,0)
 . Q:"@"[$G(^TMP("GMPLIST",$J,DA))  ; nothing to save
"RTN","GMPLBLD2",115,0)
 . S TMPLST=^TMP("GMPLIST",$J,DA) D NEW(DIK,+GMPLSLST,TMPLST)
"RTN","GMPLBLD2",116,0)
 I "@"[$G(^TMP("GMPLIST",$J,DA)) D ^DIK Q
"RTN","GMPLBLD2",117,0)
 S ITEM=$P($G(^GMPL(125.1,DA,0)),U,2,5)
"RTN","GMPLBLD2",118,0)
 I ITEM'=^TMP("GMPLIST",$J,DA) D
"RTN","GMPLBLD2",119,0)
 . S DR="",DIE=DIK
"RTN","GMPLBLD2",120,0)
 . F I=1,2,3,4 D
"RTN","GMPLBLD2",121,0)
 .. S:$P(^TMP("GMPLIST",$J,DA),U,I)'=$P(ITEM,U,I) DR=DR_";"_I_"////"_$S($P(^TMP("GMPLIST",$J,DA),U,I)="":"@",1:$P(^TMP("GMPLIST",$J,DA),U,I))
"RTN","GMPLBLD2",122,0)
 . S:$E(DR)=";" DR=$E(DR,2,999) D ^DIE
"RTN","GMPLBLD2",123,0)
 Q
"RTN","GMPLBLD2",124,0)
 ;
"RTN","GMPLBLD2",125,0)
NEW(DIK,LIST,ITEM) ; Create new entry in Contents file #125.1 or #125.12
"RTN","GMPLBLD2",126,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLBLD2",127,0)
 S HDR=$G(@(DIK_"0)")),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLBLD2",128,0)
 F I=(LAST+1):1 Q:'$D(@(DIK_"I,0)"))
"RTN","GMPLBLD2",129,0)
 S DA=I,@(DIK_"DA,0)")=LIST_U_ITEM
"RTN","GMPLBLD2",130,0)
 S $P(@(DIK_"0)"),U,3,4)=DA_U_(TOTAL+1)
"RTN","GMPLBLD2",131,0)
 D IX1^DIK ; set Xrefs
"RTN","GMPLBLD2",132,0)
 Q
"RTN","GMPLBLD2",133,0)
 ;
"RTN","GMPLBLD2",134,0)
DELETE ; Delete problem group
"RTN","GMPLBLD2",135,0)
 N DIR,X,Y,DA,DIK,IFN S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLD2",136,0)
 I $D(^GMPL(125.1,"G",+GMPLGRP)) W $C(7),!!,">>>  This category belongs to at least one problem selection list!",!,"     CANNOT DELETE" H 2 Q
"RTN","GMPLBLD2",137,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A")="Are you sure you want to delete the entire '"_$P(GMPLGRP,U,2)_"' category? "
"RTN","GMPLBLD2",138,0)
 S DIR("?")="Enter YES to completely remove this category and all its items."
"RTN","GMPLBLD2",139,0)
 D ^DIR Q:'Y
"RTN","GMPLBLD2",140,0)
DEL1 ; Ok, go for it ...
"RTN","GMPLBLD2",141,0)
 W !!,"Deleting category items ..."
"RTN","GMPLBLD2",142,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.12,"B",+GMPLGRP,IFN)) Q:IFN'>0  S DA=IFN,DIK="^GMPL(125.12," D ^DIK W "."
"RTN","GMPLBLD2",143,0)
 S DA=+GMPLGRP,DIK="^GMPL(125.11," D ^DIK W "."
"RTN","GMPLBLD2",144,0)
 L -^GMPL(125.11,+GMPLGRP,0) S GMPLGRP=0 K GMPLSAVE W " <done>"
"RTN","GMPLBLD2",145,0)
 D NEWGRP S:+GMPLGRP'>0 VALMBCK="Q"
"RTN","GMPLBLD2",146,0)
 Q
"RTN","GMPLBLD2",147,0)
 ;
"RTN","GMPLBLD2",148,0)
VALGRP(GMPLCAT) ; check all problems in the category for inactive codes
"RTN","GMPLBLD2",149,0)
 ; Input:
"RTN","GMPLBLD2",150,0)
 ;    GMPLCAT  = ien from file 125.11
"RTN","GMPLBLD2",151,0)
 ;
"RTN","GMPLBLD2",152,0)
 ; Output:
"RTN","GMPLBLD2",153,0)
 ;    1     = category has no problems with inactive codes
"RTN","GMPLBLD2",154,0)
 ;    0     = category has one or more problems with inactive codes
"RTN","GMPLBLD2",155,0)
 ;    O^ERR = category is invalid^error message
"RTN","GMPLBLD2",156,0)
 ;
"RTN","GMPLBLD2",157,0)
 I '$G(GMPLCAT) Q "0^No category selected"
"RTN","GMPLBLD2",158,0)
 N PROB,GMPLVALC
"RTN","GMPLBLD2",159,0)
 S GMPLVALC=1,PROB=0
"RTN","GMPLBLD2",160,0)
 F  S PROB=$O(^GMPL(125.12,"B",GMPLCAT,PROB)) Q:'PROB!('GMPLVALC)  D
"RTN","GMPLBLD2",161,0)
 . N GMPLCOD,GMI
"RTN","GMPLBLD2",162,0)
 . S GMPLCOD=$P(^GMPL(125.12,PROB,0),U,5)
"RTN","GMPLBLD2",163,0)
 . Q:'$L(GMPLCOD)  ; no code there
"RTN","GMPLBLD2",164,0)
 . F GMI=1:1:$L(GMPLCOD,"/") D
"RTN","GMPLBLD2",165,0)
 . . N GMPLCPTR S GMPLCPTR=$P($$CODECS^ICDEX($P(GMPLCOD,"/",GMI),80,DT),U)
"RTN","GMPLBLD2",166,0)
 . . I '$$STATCHK^ICDXCODE(GMPLCPTR,$P(GMPLCOD,"/",GMI),DT) S GMPLVALC=0
"RTN","GMPLBLD2",167,0)
 . Q
"RTN","GMPLBLD2",168,0)
 Q GMPLVALC
"RTN","GMPLBLD2",169,0)
 ;
"RTN","GMPLBLD2",170,0)
VALLIST(LIST) ;check all categories in list for probs w/ inactive codes
"RTN","GMPLBLD2",171,0)
 ; Input:
"RTN","GMPLBLD2",172,0)
 ;   LIST = ien from file 125
"RTN","GMPLBLD2",173,0)
 ;
"RTN","GMPLBLD2",174,0)
 ; Output:
"RTN","GMPLBLD2",175,0)
 ;    1     = list has no problems with inactive codes
"RTN","GMPLBLD2",176,0)
 ;    0     = list has one or more problems with inactive codes
"RTN","GMPLBLD2",177,0)
 ;    O^ERR = list is invalid^error message
"RTN","GMPLBLD2",178,0)
 ;
"RTN","GMPLBLD2",179,0)
 N GMPLIEN,GMPLVAL
"RTN","GMPLBLD2",180,0)
 I '$G(LIST) Q 0
"RTN","GMPLBLD2",181,0)
 S GMPLIEN=0,GMPLVAL=1
"RTN","GMPLBLD2",182,0)
 F  S GMPLIEN=$O(^GMPL(125.1,"B",LIST,GMPLIEN)) Q:'GMPLIEN!('GMPLVAL)  D
"RTN","GMPLBLD2",183,0)
 . N GMPLCAT
"RTN","GMPLBLD2",184,0)
 . S GMPLCAT=$P(^GMPL(125.1,GMPLIEN,0),U,3) I 'GMPLCAT Q
"RTN","GMPLBLD2",185,0)
 . I '$$VALGRP(GMPLCAT) S GMPLVAL=0
"RTN","GMPLBLD2",186,0)
 . Q
"RTN","GMPLBLD2",187,0)
 Q GMPLVAL
"RTN","GMPLBLD2",188,0)
 ;
"RTN","GMPLBLD2",189,0)
ASSIGN ; allow lookup of PROB SEL LIST and assign to users
"RTN","GMPLBLD2",190,0)
 ;
"RTN","GMPLBLD2",191,0)
 N DIC,X,Y,DUOUT,DTOUT,GMPLSLST
"RTN","GMPLBLD2",192,0)
 S DIC="^GMPL(125,",DIC(0)="AEQMZ",DIC("A")="Select LIST NAME: "
"RTN","GMPLBLD2",193,0)
 D ^DIC
"RTN","GMPLBLD2",194,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMPLBLD2",195,0)
 Q:Y<0
"RTN","GMPLBLD2",196,0)
 I '$$VALLIST(+Y) D  G ASSIGN
"RTN","GMPLBLD2",197,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD codes associated with"
"RTN","GMPLBLD2",198,0)
 . W !,"them. The codes must be edited and corrected before the list can be assigned to",!,"users.",!!
"RTN","GMPLBLD2",199,0)
 ;
"RTN","GMPLBLD2",200,0)
 S GMPLSLST=+Y
"RTN","GMPLBLD2",201,0)
 D USERS^GMPLBLD3("1")
"RTN","GMPLBLD2",202,0)
 Q
"RTN","GMPLBLD3")
0^15^B23961246
"RTN","GMPLBLD3",1,0)
GMPLBLD3 ; SLC/MKB,TC -- Bld PL Selection Lists cont ;11/27/12  08:16
"RTN","GMPLBLD3",2,0)
 ;;2.0;Problem List;**28,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLD3",3,0)
 ;
"RTN","GMPLBLD3",4,0)
 ; This routine invokes ICR #5699, #5747
"RTN","GMPLBLD3",5,0)
 ;
"RTN","GMPLBLD3",6,0)
ASSIGN ; Assign list to clinic, users: Expects GMPLSLST
"RTN","GMPLBLD3",7,0)
 N DIE,DA,DR,DTOUT D FULL^VALM1 G:+$G(GMPLSLST)'>0 ASQ
"RTN","GMPLBLD3",8,0)
 I '$$VALLIST^GMPLBLD2(+GMPLSLST) D  G ASQ
"RTN","GMPLBLD3",9,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD codes associated with"
"RTN","GMPLBLD3",10,0)
 . W !,"them. The codes must be edited and corrected before the list can be assigned",!,"to users or clinics."
"RTN","GMPLBLD3",11,0)
 . W !!,"If you have edited the list during this session to correct inactive codes, "
"RTN","GMPLBLD3",12,0)
 . W !,"save the list prior to attempting to assign it."
"RTN","GMPLBLD3",13,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD3",14,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD3",15,0)
 . Q
"RTN","GMPLBLD3",16,0)
 ;
"RTN","GMPLBLD3",17,0)
 W !!,"You may assign this list to a clinic as its default selection list,"
"RTN","GMPLBLD3",18,0)
 W !,"as well as to individual users as a preferred selection list.",!
"RTN","GMPLBLD3",19,0)
 S DA=+GMPLSLST,DR=.03,DIE="^GMPL(125," D ^DIE Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMPLBLD3",20,0)
 D USERS("1") ; assign
"RTN","GMPLBLD3",21,0)
ASQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD3",22,0)
 Q
"RTN","GMPLBLD3",23,0)
 ;
"RTN","GMPLBLD3",24,0)
USERS(ADD) ; -- select user(s) to de-/assign list
"RTN","GMPLBLD3",25,0)
 N DIR,DIC,DIE,DR,DA,X,Y,GMPLUSER,GMPLI
"RTN","GMPLBLD3",26,0)
 Q:+$G(GMPLSLST)'>0  S GMPLUSER=""
"RTN","GMPLBLD3",27,0)
 S DIC="^VA(200,",DIC(0)="EQM",DIC("A")="Select USER: "
"RTN","GMPLBLD3",28,0)
 F  D READ Q:+Y'>0  S GMPLUSER=GMPLUSER_U_+Y,DIC("A")="ANOTHER ONE: "
"RTN","GMPLBLD3",29,0)
 I '$L(GMPLUSER) W !!,"No users selected.",! Q
"RTN","GMPLBLD3",30,0)
 S DIR(0)="YA",DIR("A")="Are you ready? ",DIR("B")="NO"
"RTN","GMPLBLD3",31,0)
 S DIR("?",1)="Enter YES to "_$S(ADD:"assign",1:"remove")_" the "_$P(GMPLSLST,U,2)_" list "_$S(ADD:"to the",1:"from the")
"RTN","GMPLBLD3",32,0)
 S DIR("?")=($L(GMPLUSER,U)-1)_" user(s) selected; enter NO to exit."
"RTN","GMPLBLD3",33,0)
 D ^DIR Q:'Y
"RTN","GMPLBLD3",34,0)
USR W !,$S(ADD:"Assigning ",1:"Removing ")_$P(GMPLSLST,U,2)_" list ..."
"RTN","GMPLBLD3",35,0)
 S DIE="^VA(200,",DR="125.1///"_$S(ADD:"/"_(+GMPLSLST),1:"@")
"RTN","GMPLBLD3",36,0)
 F GMPLI=1:1:$L(GMPLUSER,U) S DA=$P(GMPLUSER,U,GMPLI) I DA D
"RTN","GMPLBLD3",37,0)
 . W !?4,$P($G(^VA(200,DA,0)),U) D ^DIE
"RTN","GMPLBLD3",38,0)
 W !!,"DONE."
"RTN","GMPLBLD3",39,0)
 Q
"RTN","GMPLBLD3",40,0)
 ;
"RTN","GMPLBLD3",41,0)
READ ; prompt for username, respond
"RTN","GMPLBLD3",42,0)
 W !,DIC("A") R X:DTIME I '$T!("^"[X) S Y=-1 Q
"RTN","GMPLBLD3",43,0)
 I X="?" W !!,"Enter the name of the user you wish this list to be "_$S(ADD:"assigned to;",1:"removed from;"),!,"enter '??' to see users currently assigned this list, or '???' to see",!,"all users on this system.",! G READ
"RTN","GMPLBLD3",44,0)
 I X?1"??".E D  G READ
"RTN","GMPLBLD3",45,0)
 . I X="??" S DIC("S")="I $P($G(^(125)),U,2)="_+GMPLSLST W !!,"Users currently assigned "_$P(GMPLSLST,U,2)_" list:"
"RTN","GMPLBLD3",46,0)
 . S D="B",DZ="??" D DQ^DICQ K D,DZ,DIC("S")
"RTN","GMPLBLD3",47,0)
 D ^DIC G:Y'>0 READ
"RTN","GMPLBLD3",48,0)
 Q
"RTN","GMPLBLD3",49,0)
 ;
"RTN","GMPLBLD3",50,0)
DELETE ; Delete Selection List
"RTN","GMPLBLD3",51,0)
 N DIR,DIK,DA,X,Y,VIEW,USER,GMPCOUNT,GMPQUIT,GMPLSLST
"RTN","GMPLBLD3",52,0)
 S GMPCOUNT=0,GMPLSLST=$$LIST^GMPLBLD2("") Q:GMPLSLST="^"
"RTN","GMPLBLD3",53,0)
 W !!,"Checking the New Person file for use of this list ..."
"RTN","GMPLBLD3",54,0)
 F USER=0:0 S USER=$O(^VA(200,USER)) Q:USER'>0  D
"RTN","GMPLBLD3",55,0)
 . S VIEW=$P($G(^VA(200,USER,125)),U,2) Q:'VIEW  Q:VIEW'=+GMPLSLST
"RTN","GMPLBLD3",56,0)
 . S GMPCOUNT=GMPCOUNT+1 W "."
"RTN","GMPLBLD3",57,0)
 I GMPCOUNT W $C(7),!!,GMPCOUNT_" user(s) are currently assigned this list!",!,"CANNOT DELETE",! Q
"RTN","GMPLBLD3",58,0)
 W !,"0 users found."
"RTN","GMPLBLD3",59,0)
DEL1 S DIR(0)="Y",DIR("B")="NO"
"RTN","GMPLBLD3",60,0)
 S DIR("A")="Are you sure you want to delete this list"
"RTN","GMPLBLD3",61,0)
 S DIR("?",1)="Enter YES if you wish to completely remove this list; press <return>",DIR("?")="to leave this list unchanged and exit this option."
"RTN","GMPLBLD3",62,0)
 W $C(7),! D ^DIR Q:'Y
"RTN","GMPLBLD3",63,0)
 W !!,"Deleting "_$P(GMPLSLST,U,2)_" selection list ..."
"RTN","GMPLBLD3",64,0)
 S DIK="^GMPL(125.1,",DA=0 ; list contents
"RTN","GMPLBLD3",65,0)
 F  S DA=$O(^GMPL(125.1,"B",+GMPLSLST,DA)) Q:DA'>0  D ^DIK W "."
"RTN","GMPLBLD3",66,0)
 S DA=+GMPLSLST,DIK="^GMPL(125," D ^DIK W "." ; list
"RTN","GMPLBLD3",67,0)
 W !,"DONE.",!
"RTN","GMPLBLD3",68,0)
 Q
"RTN","GMPLBLD3",69,0)
 ;
"RTN","GMPLBLD3",70,0)
MENU ; -- init variables and list array for GMPL LIST MENU list template
"RTN","GMPLBLD3",71,0)
 ;    Expects GMPLSLST=selection list
"RTN","GMPLBLD3",72,0)
 N GSEQ,PSEQ,GCNT,PCNT,GROUP,HDR,IFN,LCNT,ITEM,TEXT,CODE,GMPLCPTR
"RTN","GMPLBLD3",73,0)
 S (GSEQ,GCNT,LCNT)=0 K ^TMP("GMPLMENU",$J)
"RTN","GMPLBLD3",74,0)
 W !!,"Retrieving list of "_$P(GMPLSLST,U,2)_" problems ..."
"RTN","GMPLBLD3",75,0)
 F  S GSEQ=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ)) Q:GSEQ'>0  D
"RTN","GMPLBLD3",76,0)
 . S IFN=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ,0)) Q:IFN'>0
"RTN","GMPLBLD3",77,0)
 . S ITEM=$G(^GMPL(125.1,IFN,0)),GROUP=$P(ITEM,U,3),HDR=$P(ITEM,U,4,5)
"RTN","GMPLBLD3",78,0)
 . S GCNT=GCNT+1,(PSEQ,PCNT)=0,^TMP("GMPLMENU",$J,GCNT,0)=HDR
"RTN","GMPLBLD3",79,0)
 . F  S PSEQ=$O(^GMPL(125.12,"C",+GROUP,PSEQ)) Q:PSEQ'>0  D
"RTN","GMPLBLD3",80,0)
 . . S IFN=$O(^GMPL(125.12,"C",+GROUP,PSEQ,0)) Q:IFN'>0
"RTN","GMPLBLD3",81,0)
 . . S ITEM=$G(^GMPL(125.12,IFN,0)),TEXT=$P(ITEM,U,4),CODE=$P(ITEM,U,5)
"RTN","GMPLBLD3",82,0)
 . . I $L(CODE) D
"RTN","GMPLBLD3",83,0)
 . . . N GMPLCPTR S GMPLCPTR=$P($$CODECS^ICDEX(CODE,80,DT),U)
"RTN","GMPLBLD3",84,0)
 . . . I '$$STATCHK^ICDXCODE(GMPLCPTR,CODE,DT) Q  ; screen inactive codes
"RTN","GMPLBLD3",85,0)
 . . S PCNT=PCNT+1,^TMP("GMPLMENU",$J,GCNT,PCNT)=$P(ITEM,U,3,5)
"RTN","GMPLBLD3",86,0)
 I '$D(^TMP("GMPLMENU",$J)) W !!,"No items available.  Returning to Problem List ..." H 2 S VALMBCK="Q",VALMQUIT=1 Q
"RTN","GMPLBLD3",87,0)
 D BUILD^GMPLMENU
"RTN","GMPLBLD3",88,0)
 Q
"RTN","GMPLBLDC")
0^16^B38822286
"RTN","GMPLBLDC",1,0)
GMPLBLDC ; SLC/MKB,TC -- Build Problem Selection Categories ;08/21/12  13:05
"RTN","GMPLBLDC",2,0)
 ;;2.0;Problem List;**3,7,28,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLBLDC",3,0)
 ;
"RTN","GMPLBLDC",4,0)
 ; This routine invokes ICR #5699, #5747
"RTN","GMPLBLDC",5,0)
 ;
"RTN","GMPLBLDC",6,0)
EN ; -- main entry point for GMPL SELECTION GROUP BUILD
"RTN","GMPLBLDC",7,0)
 D EN^VALM("GMPL SELECTION GROUP BUILD")
"RTN","GMPLBLDC",8,0)
 Q
"RTN","GMPLBLDC",9,0)
 ;
"RTN","GMPLBLDC",10,0)
HDR ; -- header code
"RTN","GMPLBLDC",11,0)
 N NAME,NUM,DATE S NUM=+^TMP("GMPLST",$J,0)_" problem"_$S(+^TMP("GMPLST",$J,0)'=1:"s",1:"")
"RTN","GMPLBLDC",12,0)
 S DATE="Last Modified: "_$S(+$P(GMPLGRP,U,3):$$FMTE^XLFDT($P(GMPLGRP,U,3)),1:"<new category>")
"RTN","GMPLBLDC",13,0)
 S VALMHDR(1)=DATE_$J(NUM,79-$L(DATE))
"RTN","GMPLBLDC",14,0)
 S NAME=$P(GMPLGRP,U,2),VALMHDR(2)=$J(NAME,$L(NAME)\2+41)
"RTN","GMPLBLDC",15,0)
 Q
"RTN","GMPLBLDC",16,0)
 ;
"RTN","GMPLBLDC",17,0)
INIT ; -- init variables and list array
"RTN","GMPLBLDC",18,0)
 S GMPLGRP=$$GROUP^GMPLBLD2("L") I GMPLGRP="^" S VALMQUIT=1 Q
"RTN","GMPLBLDC",19,0)
 L +^GMPL(125.11,+GMPLGRP,0):1 I '$T D  G INIT
"RTN","GMPLBLDC",20,0)
 . W $C(7),!!,"This category is currently being edited by another user!",!
"RTN","GMPLBLDC",21,0)
 S GMPLMODE="E",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",22,0)
 D GETLIST,BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",23,0)
 Q
"RTN","GMPLBLDC",24,0)
 ;
"RTN","GMPLBLDC",25,0)
GETLIST ; Build ^TMP("GMPLIST",$J,#) of problems
"RTN","GMPLBLDC",26,0)
 N SEQ,IFN,ITEM,PROB,CNT K ^TMP("GMPLIST",$J) S CNT=0
"RTN","GMPLBLDC",27,0)
 W !,"Searching for the problems ..."
"RTN","GMPLBLDC",28,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.12,"B",+GMPLGRP,IFN)) Q:IFN'>0  D
"RTN","GMPLBLDC",29,0)
 . S ITEM=$G(^GMPL(125.12,IFN,0)),SEQ=$P(ITEM,U,2),PROB=$P(ITEM,U,3)
"RTN","GMPLBLDC",30,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(ITEM,U,2,7),CNT=CNT+1 ; seq ^ prob ^ text ^ code ^ snomed ct concept ^ snomed ct designation
"RTN","GMPLBLDC",31,0)
 . S (^TMP("GMPLIST",$J,"PROB",PROB),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN ; Xrefs
"RTN","GMPLBLDC",32,0)
 S ^TMP("GMPLIST",$J,0)=CNT
"RTN","GMPLBLDC",33,0)
 Q
"RTN","GMPLBLDC",34,0)
 ;
"RTN","GMPLBLDC",35,0)
BUILD(LIST,MODE) ; Build ^TMP("GMPLST",$J,) of current items in LIST for display
"RTN","GMPLBLDC",36,0)
 N SEQ,LCNT,NUM,PROB,TEXT,IFN,ITEM,CODE D CLEAN^VALM10
"RTN","GMPLBLDC",37,0)
 I $P($G(^TMP("GMPLIST",$J,0)),U,1)'>0 S ^TMP("GMPLST",$J,1,0)="   ",^TMP("GMPLST",$J,2,0)="No items available.",^TMP("GMPLST",$J,0)="0^2",VALMCNT=2 Q
"RTN","GMPLBLDC",38,0)
 S (LCNT,NUM,SEQ)=0
"RTN","GMPLBLDC",39,0)
 F  S SEQ=$O(^TMP("GMPLIST",$J,"SEQ",SEQ)) Q:SEQ'>0  D
"RTN","GMPLBLDC",40,0)
 . N GMI,GMPLCSYS,GMPLCPTR
"RTN","GMPLBLDC",41,0)
 . S IFN=^TMP("GMPLIST",$J,"SEQ",SEQ),LCNT=LCNT+1,NUM=NUM+1
"RTN","GMPLBLDC",42,0)
 . S PROB=$P(^TMP("GMPLIST",$J,IFN),U,2),TEXT=$P(^TMP("GMPLIST",$J,IFN),U,3),CODE=$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLDC",43,0)
 . S ^TMP("GMPLST",$J,LCNT,0)=$S(MODE="I":$J("<"_SEQ_">",8),1:"        ")_$J(NUM,4)_" "_TEXT
"RTN","GMPLBLDC",44,0)
 . I $L(CODE) D
"RTN","GMPLBLDC",45,0)
 .. S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_" ("_$P($$CODECS^ICDEX($P(CODE,"/"),80,DT),U,2)_" "_CODE_")"
"RTN","GMPLBLDC",46,0)
 .. F GMI=1:1:$L(CODE,"/") D
"RTN","GMPLBLDC",47,0)
 ... N GMPLCPTR S GMPLCPTR=$P($$CODECS^ICDEX($P(CODE,"/",GMI),80,DT),U)
"RTN","GMPLBLDC",48,0)
 ... I $$STATCHK^ICDXCODE(GMPLCPTR,$P(CODE,"/",GMI),DT) Q  ; OK - code is active
"RTN","GMPLBLDC",49,0)
 ... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_"     <INACTIVE CODE>"
"RTN","GMPLBLDC",50,0)
 . D CNTRL^VALM10(LCNT,9,5,IOINHI,IOINORM)
"RTN","GMPLBLDC",51,0)
 . S ^TMP("GMPLST",$J,"B",NUM)=IFN
"RTN","GMPLBLDC",52,0)
 S ^TMP("GMPLST",$J,0)=NUM_U_LCNT,VALMCNT=LCNT
"RTN","GMPLBLDC",53,0)
 Q
"RTN","GMPLBLDC",54,0)
 ;
"RTN","GMPLBLDC",55,0)
HELP ; -- help code
"RTN","GMPLBLDC",56,0)
 N X
"RTN","GMPLBLDC",57,0)
 W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLBLDC",58,0)
 W !?4,"this category you may add new problems or remove an existing"
"RTN","GMPLBLDC",59,0)
 W !?4,"one; you may also change the text or code displayed, or the order"
"RTN","GMPLBLDC",60,0)
 W !?4,"in which each problem is displayed.  Select View w/wo Seq Numbers"
"RTN","GMPLBLDC",61,0)
 W !?4,"to toggle seeing the sequence number in addition to the display"
"RTN","GMPLBLDC",62,0)
 W !?4,"number per problem.  If necessary, the current category may be"
"RTN","GMPLBLDC",63,0)
 W !?4,"deleted; you may change to a different category to continue editing."
"RTN","GMPLBLDC",64,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMPLBLDC",65,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLDC",66,0)
 Q
"RTN","GMPLBLDC",67,0)
 ;
"RTN","GMPLBLDC",68,0)
EXIT ; -- exit code
"RTN","GMPLBLDC",69,0)
 I $D(GMPLSAVE),$$CKSAVE^GMPLBLD2 D
"RTN","GMPLBLDC",70,0)
 . D SAVE^GMPLBLD2
"RTN","GMPLBLDC",71,0)
 . S ^GMPL(125.11,+GMPLGRP,0)=$P(GMPLGRP,U,2)_U_DT
"RTN","GMPLBLDC",72,0)
 L -^GMPL(125.11,+GMPLGRP,0)
"RTN","GMPLBLDC",73,0)
 K GMPLIST,GMPLST,GMPLMODE,GMPLGRP,GMPLSAVE,GMPREBLD,GMPQUIT,RT1,TMPITEM
"RTN","GMPLBLDC",74,0)
 K VALMBCK,VALMCNT,VALMSG,VALMHDR
"RTN","GMPLBLDC",75,0)
 K ^TMP("GMPLIST",$J),^TMP("GMPLST",$J)
"RTN","GMPLBLDC",76,0)
 Q
"RTN","GMPLBLDC",77,0)
 ;
"RTN","GMPLBLDC",78,0)
ADD ; Add new problem(s)
"RTN","GMPLBLDC",79,0)
 N GMPVOCAB,GMPQUIT,GMPREBLD S VALMBCK="" D FULL^VALM1
"RTN","GMPLBLDC",80,0)
 S GMPVOCAB="" ; $$VOCAB^GMPLX1 Q:GMPVOCAB="^"
"RTN","GMPLBLDC",81,0)
 F  D  Q:$D(GMPQUIT)  W !!
"RTN","GMPLBLDC",82,0)
 . N X,Y,SEQ,CODE,IFN,SCTS,SCTT,SCTC,SCTD
"RTN","GMPLBLDC",83,0)
 . S (X,Y,SCTS,SCTT,SCTC,SCTD)="" D SEARCH^GMPLX(.X,.Y,"PROBLEM: ","1",GMPVOCAB)
"RTN","GMPLBLDC",84,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPLBLDC",85,0)
 . I X["(SCT" D
"RTN","GMPLBLDC",86,0)
 . . S SCTS=X
"RTN","GMPLBLDC",87,0)
 . . S SCTT=$P(SCTS," (SCT ")
"RTN","GMPLBLDC",88,0)
 . . S SCTC=$P($P(SCTS,"SCT ",2),")")
"RTN","GMPLBLDC",89,0)
 . . S SCTD=$$GETDES^LEXTRAN1("SCT",SCTT)
"RTN","GMPLBLDC",90,0)
 . . S SCTD=$S(+SCTD=1:$P(SCTD,U,2),1:"")
"RTN","GMPLBLDC",91,0)
 . S X=$$TEXT^GMPLBLD1(X) I X="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",92,0)
 . S CODE=$$CODE^GMPLBLD1($G(SCTC),$G(Y(1))) I CODE']"" S GMPQUIT=1 Q
"RTN","GMPLBLDC",93,0)
 . S RT1="^TMP(""GMPLIST"",$J,""SEQ"",",SEQ=+$$LAST^GMPLBLD2(RT1)+1 ; dflt = next #
"RTN","GMPLBLDC",94,0)
 . S SEQ=$$SEQ^GMPLBLD1(SEQ) I SEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",95,0)
 . S IFN=$$TMPIFN^GMPLBLD1,^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)+1
"RTN","GMPLBLDC",96,0)
 . S ^TMP("GMPLIST",$J,IFN)=SEQ_U_+Y_U_X_U_CODE_U_SCTC_U_SCTD ; seq ^ # ^ text ^ code ^ snomed ct concept ^ snomed ct designation
"RTN","GMPLBLDC",97,0)
 . S (^TMP("GMPLIST",$J,"PROB",+Y),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN,GMPREBLD=1
"RTN","GMPLBLDC",98,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",99,0)
 S VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",100,0)
 Q
"RTN","GMPLBLDC",101,0)
 ;
"RTN","GMPLBLDC",102,0)
REMOVE ; Remove problem from group
"RTN","GMPLBLDC",103,0)
 N NUM,IFN S VALMBCK=""
"RTN","GMPLBLDC",104,0)
 S NUM=$$SEL1^GMPLBLD1 G:NUM="^" RMQ
"RTN","GMPLBLDC",105,0)
 S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) G:+IFN'>0 RMQ
"RTN","GMPLBLDC",106,0)
 I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem does not exist in this category!" H 2 G RMQ
"RTN","GMPLBLDC",107,0)
 I '$$SURE^GMPLX W !?5,"< Nothing removed! >" H 1 G RMQ
"RTN","GMPLBLDC",108,0)
 D DELETE^GMPLBLD1(IFN) S VALMBCK="R",GMPLSAVE=1
"RTN","GMPLBLDC",109,0)
 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",110,0)
RMQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",111,0)
 Q
"RTN","GMPLBLDC",112,0)
 ;
"RTN","GMPLBLDC",113,0)
EDIT ; Edit problem text and code
"RTN","GMPLBLDC",114,0)
 N NUM,SEL,IFN,PIECE,CODE,PROB,PROBLEM,GMPQUIT,GMPREBLD S VALMBCK="" D FULL^VALM1
"RTN","GMPLBLDC",115,0)
 S SEL=$$SEL^GMPLBLD1 G:SEL="^" EDQ
"RTN","GMPLBLDC",116,0)
 F PIECE=1:1:$L(SEL,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLDC",117,0)
 . S NUM=$P(SEL,",",PIECE) Q:NUM'>0
"RTN","GMPLBLDC",118,0)
 . S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:IFN'>0
"RTN","GMPLBLDC",119,0)
 . I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem #"_NUM_" does not exist in this category!" H 2 Q
"RTN","GMPLBLDC",120,0)
 . W !!,">>>  Problem #"_NUM S PROBLEM=^TMP("GMPLIST",$J,IFN)
"RTN","GMPLBLDC",121,0)
 . W:$P(PROBLEM,U,2)>1 " = "_$G(^LEX(757.01,+$P(PROBLEM,U,2),0)) W ! ; KER
"RTN","GMPLBLDC",122,0)
 . S PROB=$$TEXT^GMPLBLD1($P(PROBLEM,U,3)) I PROB="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",123,0)
 . I PROB="@" D DELETE^GMPLBLD1(IFN) S GMPREBLD=1 Q
"RTN","GMPLBLDC",124,0)
 . S CODE=$$CODE^GMPLBLD1($P(PROBLEM,U,5),$P(PROBLEM,U,4)) I CODE="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",125,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(PROBLEM,U,1,2)_U_PROB_U_CODE_U_$P(PROBLEM,U,5,6),GMPREBLD=1
"RTN","GMPLBLDC",126,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",127,0)
EDQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",128,0)
 Q
"RTN","GMPLCODE")
0^17^B13729689
"RTN","GMPLCODE",1,0)
GMPLCODE ; SLC/MKB/AJB/TC -- Problem List ICD Code Utilities ;11/27/12  08:31
"RTN","GMPLCODE",2,0)
 ;;2.0;Problem List;**28,43,42**;Aug 25, 1994;Build 46
"RTN","GMPLCODE",3,0)
EN ; -- main entry point for GMPL CODE LIST
"RTN","GMPLCODE",4,0)
 K GMPLUSER
"RTN","GMPLCODE",5,0)
 D EN^VALM("GMPL CODE LIST")
"RTN","GMPLCODE",6,0)
 Q
"RTN","GMPLCODE",7,0)
 ;
"RTN","GMPLCODE",8,0)
INIT ; -- init variables and list array
"RTN","GMPLCODE",9,0)
 S GMPDFN=$$PAT^GMPLX1 I +GMPDFN'>0 K GMPDFN S VALMQUIT=1 Q
"RTN","GMPLCODE",10,0)
 S GMPVA=$S($G(DUZ("AG"))="V":1,1:0),GMPVAMC=+$G(DUZ(2))
"RTN","GMPLCODE",11,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(+GMPDFN)
"RTN","GMPLCODE",12,0)
 S (GMPLVIEW("ACT"),GMPLVIEW("VIEW"))="",GMPLVIEW("PROV")=0
"RTN","GMPLCODE",13,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLCODE",14,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLCODE",15,0)
 D BUILD^GMPLMGR(.GMPLIST)
"RTN","GMPLCODE",16,0)
 S VALMSG=$$MSG^GMPLX
"RTN","GMPLCODE",17,0)
 Q
"RTN","GMPLCODE",18,0)
 ;
"RTN","GMPLCODE",19,0)
HELP ; -- help code
"RTN","GMPLCODE",20,0)
 N X
"RTN","GMPLCODE",21,0)
 W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLCODE",22,0)
 W !?4,"the ICD Code assigned to a problem, you may choose to search"
"RTN","GMPLCODE",23,0)
 W !?4,"either the ICD Diagnosis file or the Clinical Lexicon for a"
"RTN","GMPLCODE",24,0)
 W !?4,"match; the code of the entry you select will be assigned to the"
"RTN","GMPLCODE",25,0)
 W !?4,"current problem in the list.  If you need more information on a"
"RTN","GMPLCODE",26,0)
 W !?4,"problem, select Detailed Display.  To see a listing of"
"RTN","GMPLCODE",27,0)
 W !?4,"actions that facilitate navigating the list, enter '??'."
"RTN","GMPLCODE",28,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLCODE",29,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLCODE",30,0)
 Q
"RTN","GMPLCODE",31,0)
 ;
"RTN","GMPLCODE",32,0)
EDIT ; -- edit field .01
"RTN","GMPLCODE",33,0)
 N GMPLSEL,GMPLNO,GMPI,GMPIFN,GMPLNUM,GMPSAVED
"RTN","GMPLCODE",34,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLCODE",35,0)
 S GMPLSEL=$$SEL^GMPLX("code") G:GMPLSEL="^" EDQ
"RTN","GMPLCODE",36,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPLCODE",37,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPLCODE",38,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPLCODE",39,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPLCODE",40,0)
 . D ICD(GMPLNUM,GMPIFN) L -^AUPNPROB(GMPIFN,0)
"RTN","GMPLCODE",41,0)
 S:$D(GMPSAVED) VALMBCK="R"
"RTN","GMPLCODE",42,0)
EDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX
"RTN","GMPLCODE",43,0)
 Q
"RTN","GMPLCODE",44,0)
 ;
"RTN","GMPLCODE",45,0)
ICD(NUM,IFN) ; -- search ICD Diagnosis file #80
"RTN","GMPLCODE",46,0)
 N X,Y,DIC,DIR,DTOUT,DUOUT,OLD,NEW,DA,DR,DIE,LCNT,CHNGE,GMPLCSYS,GMPIMPDT,GMPLCPTR,GMPLDINT,GMPN802
"RTN","GMPLCODE",47,0)
 W !,IFN,!
"RTN","GMPLCODE",48,0)
 D FULL^VALM1 S VALMBCK="R" W !!
"RTN","GMPLCODE",49,0)
 S OLD=$G(^AUPNPROB(IFN,0)),GMPN802=$G(^AUPNPROB(IFN,802))
"RTN","GMPLCODE",50,0)
 S GMPLDINT=$S($P(GMPN802,U,1)]"":$P(GMPN802,U,1),1:$P(OLD,U,3)),GMPLCPTR=$$CSI^ICDEX(80,+OLD)
"RTN","GMPLCODE",51,0)
 S GMPLCSYS=$S($P(GMPN802,U,2)]"":$P(GMPN802,U,2),1:$$SAB^ICDEX(GMPLCPTR,GMPLDINT))
"RTN","GMPLCODE",52,0)
 S OLD=+OLD_U_$P($$ICDDATA^ICDXCODE(GMPLCSYS,+OLD,GMPLDINT,"I"),U,2)
"RTN","GMPLCODE",53,0)
 S DIR(0)="PAO^ICD9(:QEM",DIR("A")="Enter ICD CODE or DESCRIPTION: "
"RTN","GMPLCODE",54,0)
 S DIR("A",1)="Problem #"_NUM_": "_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLCODE",55,0)
 S DIR("?")="Enter a new code number or a brief free text description on which to search",DIR("B")=$P(OLD,U,2)
"RTN","GMPLCODE",56,0)
 ; Added for Code Set Versioning (CSV) - screen allows ONLY active codes
"RTN","GMPLCODE",57,0)
 S DIR("S")="I +($$STATCHK^ICDXCODE(GMPLCPTR,$P($$ICDDATA^ICDXCODE(GMPLCSYS,+$G(Y),DT,""I""),U,2),DT))>0"
"RTN","GMPLCODE",58,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S GMPQUIT=1 Q
"RTN","GMPLCODE",59,0)
 I X="@" Q:'$D(DIR("B"))  S:$$SURE^GMPLX Y=$$NOS^GMPLX(GMPLCSYS,GMPLDINT)
"RTN","GMPLCODE",60,0)
 I +Y>0,Y'=OLD D  S GMPSAVED=1
"RTN","GMPLCODE",61,0)
 . S NEW=Y,DIE="^AUPNPROB(",DA=IFN,DR=".01////"_+NEW D ^DIE
"RTN","GMPLCODE",62,0)
 . S CHNGE=IFN_"^.01^"_$$HTFM^XLFDT($H)_U_DUZ_U_+OLD_U_+NEW
"RTN","GMPLCODE",63,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLCODE",64,0)
 . S LCNT=+$G(^TMP("GMPLIDX",$J,NUM))
"RTN","GMPLCODE",65,0)
 . D FLDTEXT^VALM10(LCNT,"ICD",$P(NEW,U,2))
"RTN","GMPLCODE",66,0)
 D BUILD^GMPLMGR(.GMPLIST) S VALMBCK="R"
"RTN","GMPLCODE",67,0)
 Q
"RTN","GMPLDISP")
0^18^B47156024
"RTN","GMPLDISP",1,0)
GMPLDISP ; ISL/MKB,JER,TC - Problem List detailed display ;10/04/12  14:16
"RTN","GMPLDISP",2,0)
 ;;2.0;Problem List;**21,26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLDISP",3,0)
 ;
"RTN","GMPLDISP",4,0)
 ; External References
"RTN","GMPLDISP",5,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLDISP",6,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLDISP",7,0)
 ;   ICR   5747  $$CSI/SAB/CODECS^ICDEX
"RTN","GMPLDISP",8,0)
 ;   DBIA 10040  ^SC(  file 44
"RTN","GMPLDISP",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLDISP",10,0)
 ;   DBIA 10116  $$SETSTR^VALM1
"RTN","GMPLDISP",11,0)
 ;   DBIA 10117  CLEAN^VALM10
"RTN","GMPLDISP",12,0)
 ;   DBIA 10117  CNTRL^VALM10
"RTN","GMPLDISP",13,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLDISP",14,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLDISP",15,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLDISP",16,0)
 ;
"RTN","GMPLDISP",17,0)
EN ; Init Variables (need GMPLSEL,GMPLNO) and List Array
"RTN","GMPLDISP",18,0)
 G:'$D(GMPLSEL) ERROR G:'$G(GMPLNO) ERROR
"RTN","GMPLDISP",19,0)
 S GMPI=+$G(GMPI)+1 I GMPI>GMPLNO D  Q
"RTN","GMPLDISP",20,0)
 . W !!,"There are no more problems that have been selected to view!",! S VALMBCK="" H 2
"RTN","GMPLDISP",21,0)
 S GMPLNUM=$P(GMPLSEL,",",GMPI) G:GMPLNUM'>0 ERROR
"RTN","GMPLDISP",22,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 ERROR
"RTN","GMPLDISP",23,0)
 W !!,"Retrieving current data for problem #"_GMPLNUM_" ...",!
"RTN","GMPLDISP",24,0)
 ;
"RTN","GMPLDISP",25,0)
PROB ; Display problem GMPIFN
"RTN","GMPLDISP",26,0)
 N LINE,STR,I,J,L,TEXT,NOTE,GMPLDT,GMPL0,GMPL1,GMPL800,GMPL803,X,Y,IDT,FAC,AIFN,SP,LCNT
"RTN","GMPLDISP",27,0)
 N NIFN,SCTC,SCTD,SCTT,PROVNAR,ICDDESC,DESCR,ICD,PNTXT,GMPLCSYS,GMICDLBL,GMPL802
"RTN","GMPLDISP",28,0)
 G:'$G(GMPIFN) ERROR D CLEAN^VALM10
"RTN","GMPLDISP",29,0)
 S GMPL0=$G(^AUPNPROB(GMPIFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),GMPL803=$G(^(803,0)),LCNT=1,SP=""
"RTN","GMPLDISP",30,0)
 S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),+$P(GMPL1,U,9):$P(GMPL1,U,9),+$P(GMPL0,U,8):$P(GMPL0,U,8),1:DT)
"RTN","GMPLDISP",31,0)
 S GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLDISP",32,0)
 F I=11,12,13,15,16,17,18 S:+$P(GMPL1,U,I) SP=SP_$S(I=11:"AGENT ORANGE",I=12:"RADIATION",I=13:"ENV CONTAMINANTS",I=15:"HEAD/NECK CANCER",I=16:"MIL SEXUAL TRAUMA",I=17:"COMBAT VET",1:"SHAD")_U
"RTN","GMPLDISP",33,0)
 F  Q:$E(SP,$L(SP))'="^"  S SP=$E(SP,1,($L(SP)-1))
"RTN","GMPLDISP",34,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2)  ;ICD=ICD-9/10-CM Code
"RTN","GMPLDISP",35,0)
 S GMICDLBL=$P($$CODECS^ICDEX(ICD,80,GMPLDT),U,2)
"RTN","GMPLDISP",36,0)
 S PROVNAR=$$PROBTEXT^GMPLX(GMPIFN)  ;PROVNAR=Provider Narrative
"RTN","GMPLDISP",37,0)
 S ICDDESC=$$ICDDESC^GMPLUTL2($G(ICD),GMPLDT,GMPLCSYS)  ;ICDDESC=ICD Description
"RTN","GMPLDISP",38,0)
 S SCTC=$P(GMPL800,U),SCTD=$P(GMPL800,U,2)  ;SCTC=SNOMED-CT Concept Code,SCTD=SNOMED-CT Designation Code
"RTN","GMPLDISP",39,0)
 S:(PROVNAR["SCT") PNTXT=$P(PROVNAR," (SCT")
"RTN","GMPLDISP",40,0)
 D WRAP^GMPLX($G(PROVNAR),65,.TEXT)
"RTN","GMPLDISP",41,0)
 I TEXT=1 S GMPDT(LCNT,0)="  Problem: "_TEXT(1)
"RTN","GMPLDISP",42,0)
 E  I TEXT>1 D
"RTN","GMPLDISP",43,0)
 . S GMPDT(LCNT,0)="  Problem: "_TEXT(1)
"RTN","GMPLDISP",44,0)
 . F I=2:1:TEXT S LCNT=LCNT+1,GMPDT(LCNT,0)=$S($L($G(SCTC))!$L($G(SCTD)):"           ",1:"               ")_TEXT(I)
"RTN","GMPLDISP",45,0)
 I $L($G(SCTC)) S SCTT=$P($$SCTTEXT^GMPLUTL2(SCTC,$P(GMPL0,U,8),"SCT"),U)  ;SCTT=SNOMED-CT Preferred Text
"RTN","GMPLDISP",46,0)
 I $L($G(SCTC))!$L($G(SCTD)) D
"RTN","GMPLDISP",47,0)
 . I ($L($G(SCTT))>0)&(PNTXT'=$G(SCTT)) D
"RTN","GMPLDISP",48,0)
 . . D WRAP^GMPLX($G(SCTT),65,.SCTTTXT) S LCNT=LCNT+1,GMPDT(LCNT,0)="SNOMED-CT: "_SCTTTXT(1)
"RTN","GMPLDISP",49,0)
 . . I SCTTTXT>1 F L=2:1:SCTTTXT S LCNT=LCNT+1,GMPDT(LCNT,0)="           "_SCTTTXT(L)
"RTN","GMPLDISP",50,0)
 . I $L($G(ICD)) S LCNT=LCNT+1,GMPDT(LCNT,0)=$S(GMPLCSYS="ICD":" ",1:"")_$G(GMICDLBL)_": "_$G(ICD)_" ["_$G(ICDDESC)_"]"
"RTN","GMPLDISP",51,0)
 E  D
"RTN","GMPLDISP",52,0)
 . D WRAP^GMPLX($G(ICDDESC),65,.DESCR) S LCNT=LCNT+1,GMPDT(LCNT,0)=$G(GMICDLBL)_" TEXT: "_DESCR(1)
"RTN","GMPLDISP",53,0)
 . I DESCR>1 F J=2:1:DESCR S LCNT=LCNT+1,GMPDT(LCNT,0)="               "_DESCR(J)
"RTN","GMPLDISP",54,0)
 I $L($G(GMPL803))>0 D
"RTN","GMPLDISP",55,0)
 . N DA S DA=0 F  S DA=$O(^AUPNPROB(GMPIFN,803,DA)) Q:'+DA  D
"RTN","GMPLDISP",56,0)
 . . N ICDN,ICDNDX,ICDNDT,ICDNCSYS S ICDN=$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U),ICDNDT=$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,3)
"RTN","GMPLDISP",57,0)
 . . S ICDNCSYS=$S($P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,2)="ICD9":"ICD",1:$P($G(^AUPNPROB(GMPIFN,803,DA,0)),U,2))
"RTN","GMPLDISP",58,0)
 . . S ICDNDX=$$ICDDESC^GMPLUTL2($G(ICDN),$G(ICDNDT),$G(ICDNCSYS))
"RTN","GMPLDISP",59,0)
 . . S LCNT=LCNT+1,GMPDT(LCNT,0)="         : "_$G(ICDN)_$$PAD^GMPLX(ICDN,6)_" ["_$G(ICDNDX)_"]"
"RTN","GMPLDISP",60,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",61,0)
PR1 ; Onset
"RTN","GMPLDISP",62,0)
 ;   SC Condition
"RTN","GMPLDISP",63,0)
 ;   Status
"RTN","GMPLDISP",64,0)
 ;   Exposure
"RTN","GMPLDISP",65,0)
 ;   Provider
"RTN","GMPLDISP",66,0)
 ;   Service/Clinic
"RTN","GMPLDISP",67,0)
 S LINE="    Onset: "_$S($P(GMPL0,U,13):$$EXTDT^GMPLX($P(GMPL0,U,13)),1:"date unknown"),STR=""
"RTN","GMPLDISP",68,0)
 S:GMPVA STR="SC Condition: "_$S(+$P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"unknown")
"RTN","GMPLDISP",69,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",70,0)
 S X=$P(GMPL0,U,12),LINE="   Status: "_$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLDISP",71,0)
 I X="A",$L($P(GMPL1,U,14)) S LINE=LINE_"/"_$S($P(GMPL1,U,14)="A":"ACUTE",1:"CHRONIC")
"RTN","GMPLDISP",72,0)
 I X="I",$P(GMPL1,U,7) S LINE=LINE_", Resolved "_$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLDISP",73,0)
 S STR="",LCNT=LCNT+1
"RTN","GMPLDISP",74,0)
 S:GMPVA STR="    Exposure: "_$S('$L(SP):"none",1:$P(SP,U))
"RTN","GMPLDISP",75,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",76,0)
 S LINE=" Provider: "_$P($G(^VA(200,+$P(GMPL1,U,5),0)),U),LCNT=LCNT+1,STR=""
"RTN","GMPLDISP",77,0)
 I GMPVA,$L(SP,U)>1 S STR=$P(SP,U,2)
"RTN","GMPLDISP",78,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",79,0)
 I $E(GMPLVIEW("VIEW"))="S" S LINE="  Service: "_$P($G(^DIC(49,+$P(GMPL1,U,6),0)),U)
"RTN","GMPLDISP",80,0)
 E  S LINE="   Clinic: "_$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLDISP",81,0)
 S LCNT=LCNT+1,STR="" I GMPVA,$L(SP,U)>2 S STR=$P(SP,U,3)
"RTN","GMPLDISP",82,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",83,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",84,0)
PR2 ; Recorded
"RTN","GMPLDISP",85,0)
 ;   Entered
"RTN","GMPLDISP",86,0)
 S LINE=" Recorded: "_$S($P(GMPL1,U,9):$$EXTDT^GMPLX($P(GMPL1,U,9)),1:"date unknown")
"RTN","GMPLDISP",87,0)
 S:$P(GMPL1,U,4) LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLDISP",88,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",89,0)
 S LINE="  Entered: "_$$EXTDT^GMPLX($P(GMPL0,U,8))
"RTN","GMPLDISP",90,0)
 S LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U),LCNT=LCNT+1
"RTN","GMPLDISP",91,0)
 S:GMPARAM("VER")&($P(GMPL1,U,2)="T") LINE=LINE_"  <unconfirmed>"
"RTN","GMPLDISP",92,0)
 S GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",93,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",94,0)
PR3 ; Comments
"RTN","GMPLDISP",95,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="Comments:"
"RTN","GMPLDISP",96,0)
 D CNTRL^VALM10(LCNT,1,8,IOUON,IOUOFF)
"RTN","GMPLDISP",97,0)
 ;     By Facility
"RTN","GMPLDISP",98,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(GMPIFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLDISP",99,0)
 . I 'FAC S LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>" G PR4
"RTN","GMPLDISP",100,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(GMPIFN,11,FAC,11,NIFN)) Q:+NIFN'>0  D
"RTN","GMPLDISP",101,0)
 . . S NOTE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)) Q:NOTE=""
"RTN","GMPLDISP",102,0)
 . . S LINE=$J($$EXTDT^GMPLX($P(NOTE,U,5)),10)_": "_$P(NOTE,U,3)
"RTN","GMPLDISP",103,0)
 . . S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",104,0)
 . . I $P(NOTE,U,6) S LINE="            "_$P($G(^VA(200,+$P(NOTE,U,6),0)),U),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",105,0)
 S:'($G(NOTE)) LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>"
"RTN","GMPLDISP",106,0)
PR4 ; Audit Trail
"RTN","GMPLDISP",107,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",108,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="History:"
"RTN","GMPLDISP",109,0)
 D CNTRL^VALM10(LCNT,1,7,IOUON,IOUOFF)
"RTN","GMPLDISP",110,0)
 I '$D(^GMPL(125.8,"B",GMPIFN)) S LCNT=LCNT+1,GMPDT(LCNT,0)="   <No changes>" G PRQ
"RTN","GMPLDISP",111,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",GMPIFN,IDT)) Q:IDT'>0  D
"RTN","GMPLDISP",112,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",GMPIFN,IDT,AIFN)) Q:AIFN'>0  D
"RTN","GMPLDISP",113,0)
 . . N FLD,GMPL0 S GMPL0=^GMPL(125.8,AIFN,0),FLD=$P(GMPL0,U,2)
"RTN","GMPLDISP",114,0)
 . . Q:(FLD=80201)!(FLD=80202)!(FLD=80002)
"RTN","GMPLDISP",115,0)
 . . D DT^GMPLHIST
"RTN","GMPLDISP",116,0)
PRQ ; Header Node
"RTN","GMPLDISP",117,0)
 S VALMCNT=LCNT,GMPDT(0)=VALMCNT,VALMSG=$$MSG^GMPLX,VALMBG=1,VALMBCK="R"
"RTN","GMPLDISP",118,0)
 Q
"RTN","GMPLDISP",119,0)
 ;
"RTN","GMPLDISP",120,0)
HDR ; Header Code (uses GMPDFN, GMPIFN)
"RTN","GMPLDISP",121,0)
 N LASTMOD,PAT S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLDISP",122,0)
 S LASTMOD=$S($G(GMPIFN):$P(^AUPNPROB(GMPIFN,0),U,3),1:$E($$HTFM^XLFDT($H),1,12))
"RTN","GMPLDISP",123,0)
 S LASTMOD="Last Updated: "_$$FMTE^XLFDT(LASTMOD)
"RTN","GMPLDISP",124,0)
 S VALMHDR(1)=PAT_$$REPEAT^XLFSTR(" ",(79-$L(PAT)-$L(LASTMOD)))_LASTMOD
"RTN","GMPLDISP",125,0)
 Q
"RTN","GMPLDISP",126,0)
 ;
"RTN","GMPLDISP",127,0)
HELP ; Help Code
"RTN","GMPLDISP",128,0)
 N X W !!?4,"You may view detailed information here on this problem;"
"RTN","GMPLDISP",129,0)
 W !?4,"more data may be available by entering 'Next Screen'."
"RTN","GMPLDISP",130,0)
 W !?4,"If you have selected multiple problems to view, you may"
"RTN","GMPLDISP",131,0)
 W !?4,"enter 'Continue to Next Selected Problem'; to return to"
"RTN","GMPLDISP",132,0)
 W !?4,"the patient's problem list, enter 'Quit to Problem List'."
"RTN","GMPLDISP",133,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLDISP",134,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLDISP",135,0)
 Q
"RTN","GMPLDISP",136,0)
 ;
"RTN","GMPLDISP",137,0)
DEFLT() ; Default Action, using GMPI and GMPLNO
"RTN","GMPLDISP",138,0)
 I GMPI<GMPLNO Q "Continue to Next Selected Problem"
"RTN","GMPLDISP",139,0)
 Q "Quit to Problem List"
"RTN","GMPLDISP",140,0)
 ;
"RTN","GMPLDISP",141,0)
ERROR ; Error Message - drop into EXIT
"RTN","GMPLDISP",142,0)
 W !!,"ERROR -- Cannot continue ... Returning to Problem List.",!
"RTN","GMPLDISP",143,0)
 S VALMBCK="Q" H 1
"RTN","GMPLDISP",144,0)
EXIT ; Exit Code
"RTN","GMPLDISP",145,0)
 K GMPDT Q
"RTN","GMPLEDT1")
0^19^B33830935
"RTN","GMPLEDT1",1,0)
GMPLEDT1 ; SLC/MKB/KER/AJB/TC -- Edit Problem List fields ;03/31/14  12:24
"RTN","GMPLEDT1",2,0)
 ;;2.0;Problem List;**17,20,26,28,35,42**;Aug 25, 1994;Build 46
"RTN","GMPLEDT1",3,0)
 ;
"RTN","GMPLEDT1",4,0)
 ; External References
"RTN","GMPLEDT1",5,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLEDT1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT1",7,0)
 ;   DBIA   341  DIS^SDROUT2
"RTN","GMPLEDT1",8,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLEDT1",9,0)
 ;   ICR   5747  $$CODECS^ICDEX
"RTN","GMPLEDT1",10,0)
 ;
"RTN","GMPLEDT1",11,0)
ONSET ; Edit Date of Onset - field .13
"RTN","GMPLEDT1",12,0)
 N X,Y,ENTERED,PROMPT,HELPMSG,DEFAULT
"RTN","GMPLEDT1",13,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(.13))
"RTN","GMPLEDT1",14,0)
 S PROMPT="DATE OF ONSET: ",HELPMSG="Enter the date this problem was first observed, as precisely as known."
"RTN","GMPLEDT1",15,0)
O1 ;   Get Date of Onset
"RTN","GMPLEDT1",16,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",17,0)
 I Y>ENTERED W !!,"Date of Onset cannot be later than the date the problem was entered!",$C(7) G O1
"RTN","GMPLEDT1",18,0)
 I +$P(GMPDFN,U,4),Y>$P(GMPDFN,U,4) W !!,"Date of Onset cannot be later than the date of death!",$C(7) G O1
"RTN","GMPLEDT1",19,0)
 S GMPFLD(.13)=Y S:Y'="" GMPFLD(.13)=GMPFLD(.13)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",20,0)
 Q
"RTN","GMPLEDT1",21,0)
STATUS ; Edit Status - field .12
"RTN","GMPLEDT1",22,0)
 ;   Then Edit Date Resolved - Field 1.07, if inactive
"RTN","GMPLEDT1",23,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT1",24,0)
 S DIR(0)="9000011,.12"
"RTN","GMPLEDT1",25,0)
 S:$L($G(GMPFLD(.12))) DIR("B")=$P(GMPFLD(.12),U,2)
"RTN","GMPLEDT1",26,0)
ST1 ;   Get Status
"RTN","GMPLEDT1",27,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",28,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ST1
"RTN","GMPLEDT1",29,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACTIVE",1:"INACTIVE") S GMPFLD(.12)=Y
"RTN","GMPLEDT1",30,0)
 S:$E(Y)'="I" GMPFLD(1.07)="" S:$E(Y)'="A" GMPFLD(1.14)=""
"RTN","GMPLEDT1",31,0)
 D:$E(GMPFLD(.12))="I" RESOLVED^GMPLEDT4
"RTN","GMPLEDT1",32,0)
 D:$E(GMPFLD(.12))="A" PRIORITY^GMPLEDT4
"RTN","GMPLEDT1",33,0)
 Q
"RTN","GMPLEDT1",34,0)
RECORDED ; Edit Date Recorded - field 1.09
"RTN","GMPLEDT1",35,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ENTERED
"RTN","GMPLEDT1",36,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(1.09))
"RTN","GMPLEDT1",37,0)
 S PROMPT="DATE RECORDED: ",HELPMSG="Enter the date this problem was first recorded, as precisely as known."
"RTN","GMPLEDT1",38,0)
RC1 ;   Get Date
"RTN","GMPLEDT1",39,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",40,0)
 I Y>ENTERED W !!,"Date Recorded cannot be later than the problem was entered!",$C(7) G RC1
"RTN","GMPLEDT1",41,0)
 S GMPFLD(1.09)=Y S:Y'="" GMPFLD(1.09)=GMPFLD(1.09)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",42,0)
 Q
"RTN","GMPLEDT1",43,0)
SC ; Edit Service Connected - field 1.1
"RTN","GMPLEDT1",44,0)
 N DFN,DIR,X,Y,DTOUT
"RTN","GMPLEDT1",45,0)
 ;
"RTN","GMPLEDT1",46,0)
 ;   The following allows changing a problem's SC/NSC to
"RTN","GMPLEDT1",47,0)
 ;   NSC if there is no SC on file for patient and Problem
"RTN","GMPLEDT1",48,0)
 ;   original SC was set to "YES"
"RTN","GMPLEDT1",49,0)
 ;
"RTN","GMPLEDT1",50,0)
 I +$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",51,0)
 . W !!,">>>  Currently known service-connection data for "_$P(GMPDFN,U,2)_":"
"RTN","GMPLEDT1",52,0)
 ELSE  Q:'GMPSC
"RTN","GMPLEDT1",53,0)
 S DFN=+GMPDFN D DIS^SDROUT2
"RTN","GMPLEDT1",54,0)
 I +GMPSC=0,+$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",55,0)
 . S DIR("A")="Patient has no service-connected condition !! "
"RTN","GMPLEDT1",56,0)
 . S DIR("B")="NO"
"RTN","GMPLEDT1",57,0)
 ELSE  D
"RTN","GMPLEDT1",58,0)
 . S DIR("A")="Is this problem related to a service-connected condition? "
"RTN","GMPLEDT1",59,0)
 . S:$L($G(GMPFLD(1.1))) DIR("B")=$P(GMPFLD(1.1),U,2) W !
"RTN","GMPLEDT1",60,0)
 S DIR("?",1)="If this problem is due to a service-connected condition, enter YES;",DIR("?")="press <return> and leave blank if this is unknown.",DIR(0)="YAO"
"RTN","GMPLEDT1",61,0)
SC1 ;   Get Service Connection
"RTN","GMPLEDT1",62,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",63,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G SC1
"RTN","GMPLEDT1",64,0)
 I X="@" G:'$$SURE^GMPLX SC1 S Y=""
"RTN","GMPLEDT1",65,0)
 S GMPFLD(1.1)=Y S:Y'="" GMPFLD(1.1)=GMPFLD(1.1)_U_$S(Y:"YES",1:"NO")
"RTN","GMPLEDT1",66,0)
 Q
"RTN","GMPLEDT1",67,0)
SP ; Edit Exposures/Conditions
"RTN","GMPLEDT1",68,0)
 ;   Agent Orange - field 1.11
"RTN","GMPLEDT1",69,0)
 ;   Ionizing Radiation - field 1.12
"RTN","GMPLEDT1",70,0)
 ;   Persian Gulf/Environmental Contaminants - field 1.13
"RTN","GMPLEDT1",71,0)
 ;   Head and/or Neck Cancer - field 1.15
"RTN","GMPLEDT1",72,0)
 ;   Military Sexual Trauma - field 1.16
"RTN","GMPLEDT1",73,0)
 ;   Combat Vet - field 1.17
"RTN","GMPLEDT1",74,0)
 ;   SHAD - field 1.18
"RTN","GMPLEDT1",75,0)
 G SPEXP^GMPLEDT2
"RTN","GMPLEDT1",76,0)
 Q
"RTN","GMPLEDT1",77,0)
SOURCE ; Edit Service - field 1.06
"RTN","GMPLEDT1",78,0)
 ; or Clinic - field 1.08
"RTN","GMPLEDT1",79,0)
 N DIC,DTOUT,X,Y,HELPMSG,PROMPT,DEFAULT,VIEW S VIEW=$E(GMPLVIEW("VIEW"))
"RTN","GMPLEDT1",80,0)
 S DIC=$S(VIEW="S":"^DIC(49,",1:"^SC("),DIC(0)="EMQ"
"RTN","GMPLEDT1",81,0)
 S DIC("S")="I $P(^(0),U,"_$S(VIEW="S":9,1:3)_")=""C"""
"RTN","GMPLEDT1",82,0)
 I VIEW="S" S PROMPT="SERVICE: ",DEFAULT=$P(GMPFLD(1.06),U,2)
"RTN","GMPLEDT1",83,0)
 E  S PROMPT="CLINIC: ",DEFAULT=$P(GMPFLD(1.08),U,2)
"RTN","GMPLEDT1",84,0)
 S HELPMSG="Enter the clinic"_$S(VIEW="S":"al service",1:"")_" to be associated with this problem."
"RTN","GMPLEDT1",85,0)
S1 ;   Get Service/Clinic
"RTN","GMPLEDT1",86,0)
 W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","GMPLEDT1",87,0)
 R X:DTIME S:'$T X="^",DTOUT=1 S:X="^" GMPQUIT=1 Q:(X="^")!(X="")
"RTN","GMPLEDT1",88,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G S1
"RTN","GMPLEDT1",89,0)
 I X="?" W !!,HELPMSG,! G S1
"RTN","GMPLEDT1",90,0)
 I X["??" D @("LIST"_$S(VIEW="S":"SERV",1:"CLIN")_"^GMPLMGR1") W !,HELPMSG G S1
"RTN","GMPLEDT1",91,0)
 I X="@" G:'$$SURE^GMPLX S1 S Y="" G SQ
"RTN","GMPLEDT1",92,0)
 D ^DIC I Y'>0 W !?5,"Only clinic"_$S(VIEW="S":"al service",1:"")_"s are allowed!",! G S1
"RTN","GMPLEDT1",93,0)
SQ ;   Quit Service/Clinic
"RTN","GMPLEDT1",94,0)
 S:VIEW'="S" GMPFLD(1.08)=Y S:VIEW="S" GMPFLD(1.06)=Y
"RTN","GMPLEDT1",95,0)
 Q
"RTN","GMPLEDT1",96,0)
AUTHOR ; Edit Recording Provider - field 1.04
"RTN","GMPLEDT1",97,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT S PROMPT="RECORDING PROVIDER: "
"RTN","GMPLEDT1",98,0)
 S DEFAULT=$G(GMPFLD(1.04)),HELPMSG="Enter the name of the provider responsible for the recording of this data."
"RTN","GMPLEDT1",99,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",100,0)
 S GMPFLD(1.04)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",101,0)
 Q
"RTN","GMPLEDT1",102,0)
PROV ; Edit Responsible Provider - field 1.05
"RTN","GMPLEDT1",103,0)
 N X,Y,PROMPT,DEFAULT,HELPMSG S DEFAULT=$G(GMPFLD(1.05))
"RTN","GMPLEDT1",104,0)
 S PROMPT="PROVIDER: ",HELPMSG="Enter the name of the local provider treating this problem."
"RTN","GMPLEDT1",105,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",106,0)
 S GMPFLD(1.05)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",107,0)
 Q
"RTN","GMPLEDT1",108,0)
ICD ; Edit ICD Code - field .01
"RTN","GMPLEDT1",109,0)
 N DIC,DIR,X,Y,DTOUT
"RTN","GMPLEDT1",110,0)
ICD0 ;   Prompt for ICD Code
"RTN","GMPLEDT1",111,0)
 K DIR S DIR(0)="FAO^2:6",DIR("A")="ICD CODE: "
"RTN","GMPLEDT1",112,0)
 S:($P($G(GMPFLD(.01)),U,2)="799.9")!($P($G(GMPFLD(.01)),U,2)="R69.") DIR("A")=IORVON_"ICD CODE: "
"RTN","GMPLEDT1",113,0)
 S:+$G(GMPFLD(.01)) DIR("B")=$P(GMPFLD(.01),U,2)
"RTN","GMPLEDT1",114,0)
 S DIR("?")="Enter the ICD code to be associated with this problem"
"RTN","GMPLEDT1",115,0)
ICD1 ;   Get ICD Code
"RTN","GMPLEDT1",116,0)
 D ^DIR W IORVOFF I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",117,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ICD1
"RTN","GMPLEDT1",118,0)
 I X="@" W !!,"ICD Code may not be deleted!",!,$C(7) G ICD1
"RTN","GMPLEDT1",119,0)
 Q:X=""  Q:$P($G(GMPFLD(.01)),U,2)=Y
"RTN","GMPLEDT1",120,0)
 S DIC=80,DIC(0)="EQM" D ^DIC G:Y'>0 ICD0
"RTN","GMPLEDT1",121,0)
 S GMPFLD(.01)=Y
"RTN","GMPLEDT1",122,0)
 Q
"RTN","GMPLEDT1",123,0)
NOTE ; Attach a note to problem - field 11
"RTN","GMPLEDT1",124,0)
 N X,Y,I,DEFAULT,PROMPT,DONE,NXT,NCNT,GMPLCPTR S (I,NCNT,DONE)=0
"RTN","GMPLEDT1",125,0)
 F  D  Q:$D(GMPQUIT)!($G(GMPLJUMP))!DONE
"RTN","GMPLEDT1",126,0)
 . S NXT=$O(GMPFLD(10,"NEW",I)) S:'NXT NXT=I+1
"RTN","GMPLEDT1",127,0)
 . S I=NXT,NCNT=NCNT+1
"RTN","GMPLEDT1",128,0)
 . S PROMPT=$S(NCNT=1:"",1:"ANOTHER ")_"COMMENT"_$S(NCNT=1:" (<60 char): ",1:": "),DEFAULT=$G(GMPFLD(10,"NEW",I))
"RTN","GMPLEDT1",129,0)
 . D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",130,0)
 . I X="@" K GMPFLD(10,"NEW",I) Q
"RTN","GMPLEDT1",131,0)
 . I Y="" S DONE=1 Q
"RTN","GMPLEDT1",132,0)
 . S GMPFLD(10,"NEW",I)=Y
"RTN","GMPLEDT1",133,0)
 Q
"RTN","GMPLEDT1",134,0)
TERM ; Edit Problem - field 1.01
"RTN","GMPLEDT1",135,0)
 G TERM^GMPLEDT4
"RTN","GMPLEDT1",136,0)
 Q
"RTN","GMPLEDT1",137,0)
Q ; No Editing
"RTN","GMPLEDT1",138,0)
 Q
"RTN","GMPLEDT3")
0^6^B31817969
"RTN","GMPLEDT3",1,0)
GMPLEDT3 ; ISL/MKB,KER,JER,TC -- Problem List edit utilities ;08/21/12  13:55
"RTN","GMPLEDT3",2,0)
 ;;2.0;Problem List;**26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLEDT3",3,0)
 ;
"RTN","GMPLEDT3",4,0)
 ; External References
"RTN","GMPLEDT3",5,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLEDT3",6,0)
 ;    ICR  5747  $$CODECS^ICDEX
"RTN","GMPLEDT3",7,0)
 ;   DBIA 10026  ^XUSEC("GMPL ICD CODE"
"RTN","GMPLEDT3",8,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMPLEDT3",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT3",10,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLEDT3",11,0)
 ;
"RTN","GMPLEDT3",12,0)
MSG() ; List Manager Message Bar
"RTN","GMPLEDT3",13,0)
 Q "Enter the number of the item(s) you wish to change"
"RTN","GMPLEDT3",14,0)
 ;
"RTN","GMPLEDT3",15,0)
KEYS ; Setup XQORM("KEY") array
"RTN","GMPLEDT3",16,0)
 ;   Numbers ref'd also in IN4^-EDIT, NTES^-EDT4
"RTN","GMPLEDT3",17,0)
 N I,PROTCL,NUM,ICD
"RTN","GMPLEDT3",18,0)
 S ICD=$S($D(^XUSEC("GMPL ICD CODE",DUZ)):1,1:0)
"RTN","GMPLEDT3",19,0)
 S XQORM("KEY","1")=$O(^ORD(101,"B","GMPL EDIT REFORMULATE",0))_"^1"
"RTN","GMPLEDT3",20,0)
 S XQORM("KEY","2")=$O(^ORD(101,"B","GMPL EDIT ONSET",0))_"^1"
"RTN","GMPLEDT3",21,0)
 S XQORM("KEY","3")=$O(^ORD(101,"B","GMPL EDIT STATUS",0))_"^1"
"RTN","GMPLEDT3",22,0)
 S XQORM("KEY","4")=$O(^ORD(101,"B","GMPL EDIT PROVIDER",0))_"^1"
"RTN","GMPLEDT3",23,0)
 S XQORM("KEY","5")=$O(^ORD(101,"B","GMPL EDIT SERVICE",0))_"^1",NUM=5
"RTN","GMPLEDT3",24,0)
 S:ICD XQORM("KEY","6")=$O(^ORD(101,"B","GMPL EDIT ICD",0))_"^1",NUM=6
"RTN","GMPLEDT3",25,0)
 I GMPVA D
"RTN","GMPLEDT3",26,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SC",0))_"^1"
"RTN","GMPLEDT3",27,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SP",0))_"^1"
"RTN","GMPLEDT3",28,0)
 S PROTCL=$O(^ORD(101,"B","GMPL EDIT NOTES",0))_"^1"
"RTN","GMPLEDT3",29,0)
 I GMPFLD(10,0) F I=1:1:GMPFLD(10,0) S NUM=NUM+1,XQORM("KEY",NUM)=PROTCL
"RTN","GMPLEDT3",30,0)
 S XQORM("KEY",NUM+1)=$O(^ORD(101,"B","GMPL EDIT NEW NOTE",0))_"^1"
"RTN","GMPLEDT3",31,0)
 S:$G(GMPARAM("VER"))&$D(GMPLUSER) XQORM("KEY","$")=$O(^ORD(101,"B","GMPL EDIT VERIFY",0))_"^1"
"RTN","GMPLEDT3",32,0)
 S XQORM("KEY","=")=$O(^ORD(101,"B","VALM NEXT SCREEN",0))_"^1"
"RTN","GMPLEDT3",33,0)
 S VALMSG=$$MSG
"RTN","GMPLEDT3",34,0)
 Q
"RTN","GMPLEDT3",35,0)
 ;
"RTN","GMPLEDT3",36,0)
GETFLDS(DA) ; Define GMPFLD(#) and GMPORIG(#) Arrays with Current Values
"RTN","GMPLEDT3",37,0)
 N DIC,DIQ,DR,I,GMPL,CNT,NIFN,FAC,EXT
"RTN","GMPLEDT3",38,0)
 S DIC="^AUPNPROB(",DIQ="GMPL",DIQ(0)="IE"
"RTN","GMPLEDT3",39,0)
 S DR=".01;.03;.05;.08:1.02;1.05:1.18;80001:80005;80201;80202" D EN^DIQ1
"RTN","GMPLEDT3",40,0)
 F I=.01,.03,.05,.08,.12,.13,1.01,1.02,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,80001,80002,80003,80004,80005,80201,80202 D
"RTN","GMPLEDT3",41,0)
 . S GMPORIG(I)=$G(GMPL(9000011,DA,I,"I")),EXT=""
"RTN","GMPLEDT3",42,0)
 . I I=1.01,GMPL(9000011,DA,I,"I")'>1 S GMPORIG(I)="" Q
"RTN","GMPLEDT3",43,0)
 . Q:(GMPORIG(I)="")!(I=1.02)
"RTN","GMPLEDT3",44,0)
 . I "^.01^.05^.12^1.01^1.05^1.06^1.08^1.1^1.14^80001^80002^80003^80004^80005^"[(U_I_U) S EXT=GMPL(9000011,DA,I,"E")
"RTN","GMPLEDT3",45,0)
 . I "^.03^.08^.13^1.07^1.09^80201^"[(U_I_U) S EXT=$$EXTDT^GMPLX(GMPORIG(I))
"RTN","GMPLEDT3",46,0)
 . I "^80202^"[(U_I_U) S EXT=$P($$CODECS^ICDEX($P(GMPORIG(.01),U,2),80,$P(GMPORIG(80201),U)),U,2)
"RTN","GMPLEDT3",47,0)
 . I "^1.11^1.12^1.13^"[(U_I_U) S EXT=$S(I=1.11:"AGENT ORANGE",I=1.12:"RADIATION",1:"ENV CONTAMINANTS")
"RTN","GMPLEDT3",48,0)
 . I "^1.15^1.16^1.17^1.18^"[(U_I_U) S EXT=$S(I=1.15:"HEAD/NECK CANCER",I=1.16:"MIL SEXUAL TRAUMA",I=1.17:"COMBAT VET",1:"SHAD")
"RTN","GMPLEDT3",49,0)
 . S GMPORIG(I)=GMPORIG(I)_U_EXT
"RTN","GMPLEDT3",50,0)
 I $D(^AUPNPROB(DA,803))=10 D
"RTN","GMPLEDT3",51,0)
 . N CODE S CODE=$P(GMPORIG(.01),U,2)
"RTN","GMPLEDT3",52,0)
 . S I=0 F  S I=$O(^AUPNPROB(DA,803,I)) Q:+I'>0  D
"RTN","GMPLEDT3",53,0)
 . . S $P(CODE,"/",(I+1))=$P($G(^AUPNPROB(DA,803,I,0)),U)
"RTN","GMPLEDT3",54,0)
 . S $P(GMPORIG(.01),U,2)=CODE
"RTN","GMPLEDT3",55,0)
 S I=0 F  S I=$O(GMPORIG(I)) Q:I'>0!(I=10)  S GMPFLD(I)=GMPORIG(I)
"RTN","GMPLEDT3",56,0)
 S (CNT,GMPORIG(10,0),GMPFLD(10,0))=0
"RTN","GMPLEDT3",57,0)
 S FAC=$O(^AUPNPROB(DA,11,"B",+GMPVAMC,0)) Q:'FAC
"RTN","GMPLEDT3",58,0)
 F NIFN=0:0 S NIFN=$O(^AUPNPROB(DA,11,FAC,11,"B",NIFN)) Q:NIFN'>0  D
"RTN","GMPLEDT3",59,0)
 . I '$D(GMPLMGR),$P($G(^AUPNPROB(DA,11,FAC,11,NIFN,0)),U,6)'=+GMPROV Q
"RTN","GMPLEDT3",60,0)
 . S CNT=CNT+1,GMPORIG(10,CNT)=$G(^AUPNPROB(DA,11,FAC,11,NIFN,0))
"RTN","GMPLEDT3",61,0)
 . S $P(GMPORIG(10,CNT),U,2)=FAC
"RTN","GMPLEDT3",62,0)
 . S GMPFLD(10,CNT)=GMPORIG(10,CNT)
"RTN","GMPLEDT3",63,0)
 S (GMPORIG(10,0),GMPFLD(10,0))=CNT
"RTN","GMPLEDT3",64,0)
 S I=80000 F  S I=$O(GMPORIG(I)) Q:I'>0  S GMPFLD(I)=GMPORIG(I)
"RTN","GMPLEDT3",65,0)
 Q
"RTN","GMPLEDT3",66,0)
 ;
"RTN","GMPLEDT3",67,0)
FLDS ; Define GMPFLD("FLD") Array for Editing
"RTN","GMPLEDT3",68,0)
 S (GMPFLD("FLD",2),GMPFLD("FLD",6),GMPFLD("FLD",7))="Q"
"RTN","GMPLEDT3",69,0)
 S GMPFLD("FLD",1)="TERM",GMPFLD("FLD","PROBLEM")=1
"RTN","GMPLEDT3",70,0)
 S:$D(^XUSEC("GMPL ICD CODE",DUZ)) GMPFLD("FLD",2)="ICD",GMPFLD("FLD","ICD CODE")=2
"RTN","GMPLEDT3",71,0)
 S GMPFLD("FLD",3)="NOTE",GMPFLD("FLD","COMMENT")=3
"RTN","GMPLEDT3",72,0)
 S GMPFLD("FLD",4)="ONSET",GMPFLD("FLD","DATE OF ONSET")=4
"RTN","GMPLEDT3",73,0)
 S GMPFLD("FLD",5)="STATUS",GMPFLD("FLD","STATUS")=5
"RTN","GMPLEDT3",74,0)
 S:GMPSC GMPFLD("FLD",6)="SC",GMPFLD("FLD","IS THIS PROBLEM RELATED TO A SERVICE-CONNECTED CONDITION?")=6
"RTN","GMPLEDT3",75,0)
 S:GMPAGTOR GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO AGENT ORANGE EXPOSURE?")=7
"RTN","GMPLEDT3",76,0)
 S:GMPION GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO RADIATION EXPOSURE?")=7
"RTN","GMPLEDT3",77,0)
 S:GMPGULF GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO ENVIRONMENTAL CONTAMINANTS EXPOSURE?")=7
"RTN","GMPLEDT3",78,0)
 S:GMPHNC GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO DIAGNOSED HEAD AND/OR NECK CANCER?")=7
"RTN","GMPLEDT3",79,0)
 S:GMPMST GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED MILITARY SEXUAL TRAUMA?")=7
"RTN","GMPLEDT3",80,0)
 S:GMPCV GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED COMBAT VET?")=7
"RTN","GMPLEDT3",81,0)
 S:GMPSHD GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED SHIPBOARD HAZARD AND DEFENSE?")=7
"RTN","GMPLEDT3",82,0)
 S GMPFLD("FLD",8)="PROV",GMPFLD("FLD","RESPONSIBLE PROVIDER")=8
"RTN","GMPLEDT3",83,0)
 S GMPFLD("FLD",9)="SOURCE"
"RTN","GMPLEDT3",84,0)
 S:$E(GMPLVIEW("VIEW"))="C" GMPFLD("FLD","CLINIC")=9
"RTN","GMPLEDT3",85,0)
 S:$E(GMPLVIEW("VIEW"))'="C" GMPFLD("FLD","SERVICE")=9
"RTN","GMPLEDT3",86,0)
 S GMPFLD("FLD",10)="RECORDED",GMPFLD("FLD","DATE RECORDED")=10
"RTN","GMPLEDT3",87,0)
 S GMPFLD("FLD",11)="AUTHOR",GMPFLD("FLD","RECORDING PROVIDER")=11
"RTN","GMPLEDT3",88,0)
 S GMPFLD("FLD",0)=11
"RTN","GMPLEDT3",89,0)
 Q
"RTN","GMPLEDT3",90,0)
 ;
"RTN","GMPLEDT3",91,0)
JUMP(XFLD) ; Resolve ^- Jump Out of Field Order in Edit
"RTN","GMPLEDT3",92,0)
 N I,MATCH,CNT,PROMPT,DIR,X,Y,DTOUT,DUOUT
"RTN","GMPLEDT3",93,0)
 ;   Passed in as ^XXX
"RTN","GMPLEDT3",94,0)
 S XFLD=$$UP^XLFSTR($P(XFLD,U,2))
"RTN","GMPLEDT3",95,0)
 I (XFLD="")!(XFLD["^") S GMPQUIT=1 Q
"RTN","GMPLEDT3",96,0)
 I '$D(GMPLJUMP) W $C(7),"  ^-jumping not allowed now!" S GMPLJUMP=0 Q
"RTN","GMPLEDT3",97,0)
 ;   Field is Exact
"RTN","GMPLEDT3",98,0)
 I $G(GMPFLD("FLD",XFLD)) S GMPLJUMP=GMPFLD("FLD",XFLD) Q
"RTN","GMPLEDT3",99,0)
 S CNT=0,PROMPT=" "
"RTN","GMPLEDT3",100,0)
 F  S PROMPT=$O(GMPFLD("FLD",PROMPT)) Q:PROMPT=""  D
"RTN","GMPLEDT3",101,0)
 . Q:$E(PROMPT,1,$L(XFLD))'=XFLD
"RTN","GMPLEDT3",102,0)
 . S CNT=CNT+1,MATCH(CNT)=GMPFLD("FLD",PROMPT)_U_PROMPT
"RTN","GMPLEDT3",103,0)
 I CNT=0 W $C(7),"  ??" Q
"RTN","GMPLEDT3",104,0)
 I CNT=1 S PROMPT=$P(MATCH(1),U,2),GMPLJUMP=+MATCH(1) W $E(PROMPT,$L(XFLD)+1,$L(PROMPT)) Q
"RTN","GMPLEDT3",105,0)
 ;   Select which Field to Jump To.
"RTN","GMPLEDT3",106,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","GMPLEDT3",107,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","GMPLEDT3",108,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","GMPLEDT3",109,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","GMPLEDT3",110,0)
 S GMPLJUMP=+MATCH(+Y)
"RTN","GMPLEDT3",111,0)
 Q
"RTN","GMPLEDT3",112,0)
 ;
"RTN","GMPLEDT3",113,0)
CK ; Check whether to Stop Processing
"RTN","GMPLEDT3",114,0)
 ;   Called from Exit Action of GMPL EDIT XXX Protocols
"RTN","GMPLEDT3",115,0)
 S:$D(GMPQUIT) XQORPOP=1 S:'$D(GMPQUIT) GMPREBLD=1 K GMPQUIT
"RTN","GMPLEDT3",116,0)
 I $D(DTOUT)!($G(VALMBCK)="Q") S VALMBCK="Q" Q
"RTN","GMPLEDT3",117,0)
 S VALMBCK="R",VALMSG=$$MSG
"RTN","GMPLEDT3",118,0)
 Q
"RTN","GMPLEDT4")
0^20^B27462939
"RTN","GMPLEDT4",1,0)
GMPLEDT4 ; SLC/MKB/TC -- Problem List Edit actions cont ;09/12/13  15:09
"RTN","GMPLEDT4",2,0)
 ;;2.0;Problem List;**5,43,42**;Aug 25, 1994;Build 46
"RTN","GMPLEDT4",3,0)
TERM ; edit field 1.01
"RTN","GMPLEDT4",4,0)
 N DTOUT,PROB,TERM,ICD,DUP,Y,GMPLCSYS,GMPL0,GMPL802,GMPIMPDT
"RTN","GMPLEDT4",5,0)
 S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLEDT4",6,0)
T1 W !,"PROBLEM: "_$P(GMPFLD(.05),U,2)_"//"
"RTN","GMPLEDT4",7,0)
 R PROB:DTIME S:'$T DTOUT=1 I $D(DTOUT)!(PROB="^") S GMPQUIT=1 Q
"RTN","GMPLEDT4",8,0)
 I PROB?1"^".E D JUMP^GMPLEDT3(PROB) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G T1
"RTN","GMPLEDT4",9,0)
 Q:PROB=""  Q:PROB=$P(GMPFLD(.05),U,2)  ; no change
"RTN","GMPLEDT4",10,0)
 I PROB["?" D  G T1
"RTN","GMPLEDT4",11,0)
 . W !!?4,"Enter a description of this problem, up to 80 characters.",!
"RTN","GMPLEDT4",12,0)
 I PROB="@",'+$G(GMPIFN) D  S GMPQUIT=1 Q
"RTN","GMPLEDT4",13,0)
 .W !!?5,$C(7),$C(7),"This problem has not yet been saved."
"RTN","GMPLEDT4",14,0)
 .W !?5,"Enter <Q>uit and it will not be added to the list.",!!
"RTN","GMPLEDT4",15,0)
 .K DIR S DIR("A")="Press RETURN to redisplay the problem text"
"RTN","GMPLEDT4",16,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","GMPLEDT4",17,0)
 I PROB="@" D DELETE^GMPLEDT2 S:VALMBCK="Q" GMPQUIT=1 Q:$D(GMPQUIT)  G T1
"RTN","GMPLEDT4",18,0)
T2 ; new text -- pass to look-up
"RTN","GMPLEDT4",19,0)
 I '$D(GMPLUSER)!($D(GMPLUSER)&('GMPARAM("CLU"))) S GMPFLD(1.01)="",GMPFLD(.05)=U_PROB Q
"RTN","GMPLEDT4",20,0)
 D SEARCH^GMPLX(.PROB,.Y,"PROBLEM: ","1") ; pass to CLU
"RTN","GMPLEDT4",21,0)
 I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPLEDT4",22,0)
 S DUP=$$DUPL^GMPLX(+GMPDFN,+Y,PROB)
"RTN","GMPLEDT4",23,0)
 I DUP,'$$DUPLOK^GMPLX(DUP) S (Y,GMPROB)="" W ! G T1
"RTN","GMPLEDT4",24,0)
 S TERM=$S(+$G(Y)>1:Y,1:""),ICD=$G(Y(1))
"RTN","GMPLEDT4",25,0)
 S:'$L(ICD) ICD=$S(DT<GMPIMPDT:"799.9",1:"R69.")
"RTN","GMPLEDT4",26,0)
 N I,GMPSTAT,GMPCSREC,GMPCSPTR,GMPCSNME,GMPSCTC,GMPSCTD,GMPTXT
"RTN","GMPLEDT4",27,0)
 I ICD["/" F I=1:1:$L(ICD,"/") D  Q:GMPSTAT
"RTN","GMPLEDT4",28,0)
 . N GMPCODE S GMPCODE=$P(ICD,"/",I),GMPSTAT=0
"RTN","GMPLEDT4",29,0)
 . S GMPCSREC=$$CODECS^ICDEX(GMPCODE,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLEDT4",30,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,GMPCODE,DT) GMPSTAT=1
"RTN","GMPLEDT4",31,0)
 E  D
"RTN","GMPLEDT4",32,0)
 . S GMPSTAT=0,GMPCSREC=$$CODECS^ICDEX(ICD,80,DT),GMPCSPTR=$P(GMPCSREC,U),GMPCSNME=$P(GMPCSREC,U,2)
"RTN","GMPLEDT4",33,0)
 . S:'+$$STATCHK^ICDXCODE(GMPCSPTR,ICD,DT) GMPSTAT=1
"RTN","GMPLEDT4",34,0)
 I GMPSTAT W !,PROB,!,"has an inactive ICD code.  Please enter another search term." H 3 Q
"RTN","GMPLEDT4",35,0)
 I (PROB["(SCT"),(PROB[")") D
"RTN","GMPLEDT4",36,0)
 . S GMPSCTC=$$ONE^LEXU(+TERM,DT,"SCT")
"RTN","GMPLEDT4",37,0)
 . S GMPTXT=$$TRIM^XLFSTR($RE($P($RE(PROB),"(",2,99)))
"RTN","GMPLEDT4",38,0)
 . S GMPSCTD=$$GETDES^LEXTRAN1("SCT",GMPTXT),GMPSCTD=$S(+GMPSCTD=1:$P(GMPSCTD,U,2),1:"")
"RTN","GMPLEDT4",39,0)
 S GMPLCSYS=$$SAB^ICDEX(GMPCSPTR,DT)
"RTN","GMPLEDT4",40,0)
 S GMPFLD(1.01)=TERM,GMPFLD(.05)=U_PROB
"RTN","GMPLEDT4",41,0)
 S GMPFLD(.01)=$S($L(ICD):$P($$ICDDATA^ICDXCODE(GMPCSPTR,$P(ICD,"/"),DT,"E"),U)_U_$P(ICD,"/"),1:"")
"RTN","GMPLEDT4",42,0)
 S:'GMPFLD(.01)!($P(GMPFLD(.01),U)<0) GMPFLD(.01)=$$NOS^GMPLX(GMPLCSYS,DT)
"RTN","GMPLEDT4",43,0)
 S (GMPFLD(.03),GMPFLD(80201),GMPFLD(1.09))=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPLEDT4",44,0)
 S GMPFLD(80202)=GMPLCSYS_U_$G(GMPCSNME)
"RTN","GMPLEDT4",45,0)
 S GMPFLD(80001)=GMPSCTC_U_GMPSCTC,GMPFLD(80002)=GMPSCTD_U_GMPSCTD
"RTN","GMPLEDT4",46,0)
 Q
"RTN","GMPLEDT4",47,0)
 ;
"RTN","GMPLEDT4",48,0)
TEXT(DFLT) ; Enter/edit provider narrative text (no lookup)
"RTN","GMPLEDT4",49,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT4",50,0)
 S DIR(0)="FAO^2:80",DIR("A")="PROBLEM: " S:$L(DFLT) DIR("B")=DFLT
"RTN","GMPLEDT4",51,0)
 S DIR("?")="Enter a description of this problem, up to 80 characters."
"RTN","GMPLEDT4",52,0)
 D ^DIR S:$D(DTOUT)!(X="^") Y="^" S:'$L(DFLT)&(X="") Y="^"
"RTN","GMPLEDT4",53,0)
 Q Y
"RTN","GMPLEDT4",54,0)
 ;
"RTN","GMPLEDT4",55,0)
NTES ; Edit existing note, display # in XQORNOD(0)
"RTN","GMPLEDT4",56,0)
 N NUM,NOTE,X,Y,PROMPT,DEFAULT,NT
"RTN","GMPLEDT4",57,0)
 S NT=$S(GMPVA:7,1:5) S:$D(^XUSEC("GMPL ICD CODE",DUZ)) NT=NT+1
"RTN","GMPLEDT4",58,0)
 S NUM=+$P(XQORNOD(0),U,3)-NT Q:NUM'>0
"RTN","GMPLEDT4",59,0)
 S NOTE=GMPFLD(10,NUM),DEFAULT=$P(NOTE,U,3)
"RTN","GMPLEDT4",60,0)
 S PROMPT="NOTE "_$$EXTDT^GMPLX($P(NOTE,U,5))_": "
"RTN","GMPLEDT4",61,0)
 D EDNOTE Q:$D(GMPQUIT)
"RTN","GMPLEDT4",62,0)
 S $P(GMPFLD(10,NUM),U,3)=Y
"RTN","GMPLEDT4",63,0)
 Q
"RTN","GMPLEDT4",64,0)
 ;
"RTN","GMPLEDT4",65,0)
EDNOTE ; Edit note text given PROMPT,DEFAULT (returns X,Y)
"RTN","GMPLEDT4",66,0)
 N DIR,DTOUT S DIR(0)="FAO^1:100",DIR("A")=PROMPT
"RTN","GMPLEDT4",67,0)
 S:$L(DEFAULT) DIR("B")=DEFAULT
"RTN","GMPLEDT4",68,0)
 S DIR("?",1)="Enter any text you wish appended to this problem, up to 60 characters"
"RTN","GMPLEDT4",69,0)
 S DIR("?")="in length.  You may append as many comments to a problem as you wish."
"RTN","GMPLEDT4",70,0)
ED1 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1,Y="" Q
"RTN","GMPLEDT4",71,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ED1
"RTN","GMPLEDT4",72,0)
 Q:Y=DEFAULT  I X="@" D  Q:$D(GMPQUIT)!(Y="")  G ED1
"RTN","GMPLEDT4",73,0)
 . N DIR,X,DTOUT,DUOUT S DIR(0)="YAO",DIR("B")="NO"
"RTN","GMPLEDT4",74,0)
 . S DIR("A")="   Are you sure you want to delete this comment? "
"RTN","GMPLEDT4",75,0)
 . S DIR("?")="   Enter YES to completely remove this comment from this patient's problem."
"RTN","GMPLEDT4",76,0)
 . W $C(7) D ^DIR I $D(DUOUT)!($D(DTOUT)) S GMPQUIT=1,Y="" Q
"RTN","GMPLEDT4",77,0)
 . S:Y Y=""
"RTN","GMPLEDT4",78,0)
 I $L(X)>60 W !!,"Text may not exceed 60 characters!",!,$C(7) S DIR("B")=$E(X,1,60) G ED1
"RTN","GMPLEDT4",79,0)
 S Y=X
"RTN","GMPLEDT4",80,0)
 Q
"RTN","GMPLEDT4",81,0)
 ;
"RTN","GMPLEDT4",82,0)
RESOLVED ; edit field 1.07
"RTN","GMPLEDT4",83,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ONSET S ONSET=+$G(GMPFLD(.13))
"RTN","GMPLEDT4",84,0)
 S DEFAULT=$G(GMPFLD(1.07)),PROMPT="DATE RESOLVED: "
"RTN","GMPLEDT4",85,0)
 S HELPMSG="Enter the date this problem became resolved or inactive, as precisely as known."
"RTN","GMPLEDT4",86,0)
R1 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT4",87,0)
 I Y,ONSET,Y<ONSET W !!,"Date Resolved cannot be prior to the Date of Onset!",$C(7) G R1
"RTN","GMPLEDT4",88,0)
 S GMPFLD(1.07)=Y S:Y'="" GMPFLD(1.07)=GMPFLD(1.07)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT4",89,0)
 Q
"RTN","GMPLEDT4",90,0)
 ;
"RTN","GMPLEDT4",91,0)
PRIORITY ; edit field 1.14
"RTN","GMPLEDT4",92,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLEDT4",93,0)
 S DIR(0)="SAO^A:ACUTE;C:CHRONIC;",DIR("A")="  (A)cute or (C)hronic? "
"RTN","GMPLEDT4",94,0)
 S:$L($G(GMPFLD(1.14))) DIR("B")=$P(GMPFLD(1.14),U,2)
"RTN","GMPLEDT4",95,0)
 S DIR("?",1)="  You may further refine the status of this problem by designating it",DIR("?",2)="  as ACUTE or CHRONIC; problems marked as ACUTE will be flagged on the",DIR("?")="  list display with a '*'."
"RTN","GMPLEDT4",96,0)
PR1 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT4",97,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G PR1
"RTN","GMPLEDT4",98,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACUTE",1:"CHRONIC")
"RTN","GMPLEDT4",99,0)
 S GMPFLD(1.14)=Y
"RTN","GMPLEDT4",100,0)
 Q
"RTN","GMPLENFM")
0^7^B41380995
"RTN","GMPLENFM",1,0)
GMPLENFM ; SLC/MKB/KER/TC -- Problem List Enc Form utilities ;06/12/13  09:08
"RTN","GMPLENFM",2,0)
 ;;2.0;Problem List;**3,4,7,26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLENFM",3,0)
 ;
"RTN","GMPLENFM",4,0)
 ; External References
"RTN","GMPLENFM",5,0)
 ;   DBIA  1609  CONFIG^LEXSET
"RTN","GMPLENFM",6,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE, $$STATCHK^ICDXCODE
"RTN","GMPLENFM",7,0)
 ;   ICR   5747  $$CSI/SAB/CODECS^ICDEX
"RTN","GMPLENFM",8,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLENFM",9,0)
 ;
"RTN","GMPLENFM",10,0)
ACTIVE ; List of Active Problems for DFN
"RTN","GMPLENFM",11,0)
 ;   Input variables:
"RTN","GMPLENFM",12,0)
 ;             DFN               Patient ID (Required)
"RTN","GMPLENFM",13,0)
 ;             [GMPINDT]         Date of Interest (Optional - defaults to today)
"RTN","GMPLENFM",14,0)
 ;                                 This is the date to use for evalutation of the
"RTN","GMPLENFM",15,0)
 ;                                 Activation status of ICD-9-CM and SNOMED CT codes
"RTN","GMPLENFM",16,0)
 ;
"RTN","GMPLENFM",17,0)
 ;   Sets Global Array:
"RTN","GMPLENFM",18,0)
 ;   ^TMP("IB",$J,"INTERFACES",DFN,"GMP PATIENT ACTIVE PROBLEMS",#) =
"RTN","GMPLENFM",19,0)
 ;
"RTN","GMPLENFM",20,0)
 ;   Piece 1:  Problem text
"RTN","GMPLENFM",21,0)
 ;         2:  ICD code
"RTN","GMPLENFM",22,0)
 ;         3:  Date of Onset     00/00/00 format
"RTN","GMPLENFM",23,0)
 ;         4:  SC/NSC/""         serv-conn/not sc/unknown
"RTN","GMPLENFM",24,0)
 ;         5:  Y/N/""            serv-conn/not sc/unknown
"RTN","GMPLENFM",25,0)
 ;         6:  A/I/E/H/M/C/S/""  If problem is flagged as:
"RTN","GMPLENFM",26,0)
 ;                               A - Agent Orange
"RTN","GMPLENFM",27,0)
 ;                               I - Ionizing Radiation
"RTN","GMPLENFM",28,0)
 ;                               E - Environmental Contaminants
"RTN","GMPLENFM",29,0)
 ;                               H - Head/Neck Cancer
"RTN","GMPLENFM",30,0)
 ;                               M - Mil Sexual Trauma
"RTN","GMPLENFM",31,0)
 ;                               C - Combat Vet
"RTN","GMPLENFM",32,0)
 ;                               S - SHAD
"RTN","GMPLENFM",33,0)
 ;                                 - None
"RTN","GMPLENFM",34,0)
 ;         7:  Special Exposure  Full text of piece 6
"RTN","GMPLENFM",35,0)
 ;         8:  SNOMED-CT Concept Code
"RTN","GMPLENFM",36,0)
 ;         9:  SNOMED-CT Designation Code
"RTN","GMPLENFM",37,0)
 ;        10:  VHAT Concept VUID
"RTN","GMPLENFM",38,0)
 ;        11:  VHAT Designation VUID
"RTN","GMPLENFM",39,0)
 ;        12:  Code Status (#  -> ICD code inactive, $ -> SNOMED CT inactive,
"RTN","GMPLENFM",40,0)
 ;                          #$ -> Both ICD & SNOMED CT inactive, else "")
"RTN","GMPLENFM",41,0)
 ;        13:  ICD Coding System ("ICD": ICD-9-CM, "10D": ICD-10-CM)
"RTN","GMPLENFM",42,0)
 ;
"RTN","GMPLENFM",43,0)
 N IFN,PROB,CNT,SC,NUM,GMPLIST,GMPARAM,GMPLVIEW,GMPTOTAL
"RTN","GMPLENFM",44,0)
 N GMPDFN,NODE
"RTN","GMPLENFM",45,0)
 Q:$G(DFN)'>0  S GMPDFN=DFN,CNT=0,NODE=$G(^GMPL(125.99,1,0))
"RTN","GMPLENFM",46,0)
 S GMPINDT=$G(GMPINDT,$$DT^XLFDT)
"RTN","GMPLENFM",47,0)
 S GMPARAM("VER")=$P(NODE,U,2),GMPARAM("REV")=$P(NODE,U,5)="R",GMPARAM("QUIET")=1
"RTN","GMPLENFM",48,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLENFM",49,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLENFM",50,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLENFM",51,0)
 . N GMPL0,GMPL1,GMPL800,GMPL802,GMPCSYS,GMPDT,GMPLCPTR,CODESTAT,ICDC,ICDI,SCTC,SCTD,VHATC,VHATD
"RTN","GMPLENFM",52,0)
 . S IFN=GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLENFM",53,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),CODESTAT=""
"RTN","GMPLENFM",54,0)
 . S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCPTR=$$CSI^ICDEX(80,+GMPL0)
"RTN","GMPLENFM",55,0)
 . S GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX(GMPLCPTR,GMPDT))
"RTN","GMPLENFM",56,0)
 . S ICDC=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2)
"RTN","GMPLENFM",57,0)
 . S:ICDC]"" CODESTAT=CODESTAT_$S(+$$STATCHK^ICDXCODE(GMPLCPTR,ICDC,GMPINDT):"",1:"#")
"RTN","GMPLENFM",58,0)
 . S ICDI=0 F  S ICDI=$O(^AUPNPROB(IFN,803,ICDI)) Q:+ICDI'>0  D
"RTN","GMPLENFM",59,0)
 .. N ICDM0,ICDMC,ICDMCSYS,ICDMDT,ICDCSPTR
"RTN","GMPLENFM",60,0)
 .. S ICDM0=$G(^AUPNPROB(IFN,803,ICDI,0)),ICDMC=$P(ICDM0,U)
"RTN","GMPLENFM",61,0)
 .. S ICDMCSYS=$P(ICDM0,U,2),ICDMDT=$P(ICDM0,U,3),ICDCSPTR=+$$CODECS^ICDEX(ICDMC,80,ICDMDT)
"RTN","GMPLENFM",62,0)
 .. S ICDC=ICDC_"/"_ICDMC
"RTN","GMPLENFM",63,0)
 .. I CODESTAT'["#" S CODESTAT=CODESTAT_$S(+$$STATCHK^ICDXCODE(ICDCSPTR,ICDMC,GMPINDT):"",1:"#")
"RTN","GMPLENFM",64,0)
 . S SCTC=$P(GMPL800,U),SCTD=$P(GMPL800,U,2),VHATC=$P(GMPL800,U,3),VHATD=$P(GMPL800,U,4)
"RTN","GMPLENFM",65,0)
 . S CODESTAT=CODESTAT_$S(+$$STATCHK^LEXSRC2(SCTC,GMPINDT,,"SCT"):"",1:"$")
"RTN","GMPLENFM",66,0)
 . S PROB=$$PROBTEXT^GMPLX(IFN),CNT=CNT+1
"RTN","GMPLENFM",67,0)
 . I GMPARAM("VER"),$P(GMPL1,U,2)="T" S PROB="$"_PROB
"RTN","GMPLENFM",68,0)
 . S PROB=PROB_U_ICDC
"RTN","GMPLENFM",69,0)
 . S PROB=PROB_U_$$EXTDT^GMPLX($P(GMPL0,U,13)),SC=$P(GMPL1,U,10)
"RTN","GMPLENFM",70,0)
 . S PROB=PROB_U_$S(+SC:"SC^Y",SC=0:"NSC^N",1:"^")
"RTN","GMPLENFM",71,0)
 . S PROB=PROB_U_$$TXFCTR(GMPL1)_U_SCTC_U_SCTD_U_VHATC_U_VHATD_U_CODESTAT_U_GMPCSYS
"RTN","GMPLENFM",72,0)
 . S ^TMP("IB",$J,"INTERFACES",+$G(DFN),"GMP PATIENT ACTIVE PROBLEMS",CNT)=PROB
"RTN","GMPLENFM",73,0)
 S ^TMP("IB",$J,"INTERFACES",+$G(DFN),"GMP PATIENT ACTIVE PROBLEMS",0)=CNT
"RTN","GMPLENFM",74,0)
 Q
"RTN","GMPLENFM",75,0)
 ;
"RTN","GMPLENFM",76,0)
SELECT ; Select Common Problems
"RTN","GMPLENFM",77,0)
 ;   Sets Global Array:
"RTN","GMPLENFM",78,0)
 ;   ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")
"RTN","GMPLENFM",79,0)
 ;   Piece 1:  Pointer to Clinical Lexicon
"RTN","GMPLENFM",80,0)
 ;         2:  Problem Text
"RTN","GMPLENFM",81,0)
 ;         3:  ICD Code (null if unknown)
"RTN","GMPLENFM",82,0)
 ;
"RTN","GMPLENFM",83,0)
 N X,Y,DIC,PROB D CONFIG^LEXSET("GMPX","PLS")
"RTN","GMPLENFM",84,0)
 K ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")
"RTN","GMPLENFM",85,0)
 S DIC("A")="Select PROBLEM: ",DIC(0)="AEQM",DIC="^LEX(757.01,"
"RTN","GMPLENFM",86,0)
 D ^DIC Q:+Y<0  S PROB=Y I +Y'>1 S PROB=+Y_U_X
"RTN","GMPLENFM",87,0)
 S PROB=PROB_U_$G(Y(1))
"RTN","GMPLENFM",88,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")=PROB
"RTN","GMPLENFM",89,0)
 Q
"RTN","GMPLENFM",90,0)
 ;
"RTN","GMPLENFM",91,0)
DSELECT ; List of Active Problems for DFN
"RTN","GMPLENFM",92,0)
 ;   Input variables:
"RTN","GMPLENFM",93,0)
 ;             DFN               Patient ID (Required)
"RTN","GMPLENFM",94,0)
 ;             [GMPINDT]        Date of Interest (Optional - defaults to today)
"RTN","GMPLENFM",95,0)
 ;                                 This is the date to use for evalutation of the
"RTN","GMPLENFM",96,0)
 ;                                 Activation status of ICD-9-CM and SNOMED CT codes
"RTN","GMPLENFM",97,0)
 ;
"RTN","GMPLENFM",98,0)
 ;   Sets Global Array"
"RTN","GMPLENFM",99,0)
 ;   ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",#) =
"RTN","GMPLENFM",100,0)
 ;
"RTN","GMPLENFM",101,0)
 ;   Piece 1:  Problem IEN
"RTN","GMPLENFM",102,0)
 ;         2:  Problem Text
"RTN","GMPLENFM",103,0)
 ;         3:  ICD code
"RTN","GMPLENFM",104,0)
 ;         4:  Date of Onset     00/00/00 format
"RTN","GMPLENFM",105,0)
 ;         5:  SC/NSC/""         serv-conn/not sc/unknown
"RTN","GMPLENFM",106,0)
 ;         6:  Y/N/""            serv-conn/not sc/unknown
"RTN","GMPLENFM",107,0)
 ;         7:  A/I/E/H/M/C/S/""  If problem is flagged as:
"RTN","GMPLENFM",108,0)
 ;                               A - Agent Orange
"RTN","GMPLENFM",109,0)
 ;                               I - Ionizing Radiation
"RTN","GMPLENFM",110,0)
 ;                               E - Environmental Contaminants
"RTN","GMPLENFM",111,0)
 ;                               H - Head/Neck Cancer
"RTN","GMPLENFM",112,0)
 ;                               M - Mil Sexual Trauma
"RTN","GMPLENFM",113,0)
 ;                               C - Combat Vet
"RTN","GMPLENFM",114,0)
 ;                               S - SHAD
"RTN","GMPLENFM",115,0)
 ;                                 - None
"RTN","GMPLENFM",116,0)
 ;         8:  Special Exposure  Full text of piece 6
"RTN","GMPLENFM",117,0)
 ;         9:  SNOMED-CT Concept Code
"RTN","GMPLENFM",118,0)
 ;        10:  SNOMED-CT Designation Code
"RTN","GMPLENFM",119,0)
 ;        11:  VHAT Concept VUID
"RTN","GMPLENFM",120,0)
 ;        12:  VHAT Designation VUID
"RTN","GMPLENFM",121,0)
 ;        13:  Code Status (#  -> ICD code inactive, $ -> SNOMED CT inactive,
"RTN","GMPLENFM",122,0)
 ;                          #$ -> Both ICD & SNOMED CT inactive, else "")
"RTN","GMPLENFM",123,0)
 ;        14:  ICD coding system ("ICD": ICD-9-CM, "10D": ICD-10-CM)
"RTN","GMPLENFM",124,0)
 ;
"RTN","GMPLENFM",125,0)
 N IFN,PROB,CNT,SC,NUM,GMPLIST,GMPARAM,GMPLVIEW,GMPTOTAL,GMPDFN,NODE
"RTN","GMPLENFM",126,0)
 Q:$G(DFN)'>0  S GMPDFN=DFN,CNT=0,NODE=$G(^GMPL(125.99,1,0))
"RTN","GMPLENFM",127,0)
 S GMPINDT=$G(GMPINDT,$$DT^XLFDT)
"RTN","GMPLENFM",128,0)
 S GMPARAM("VER")=$P(NODE,U,2),GMPARAM("REV")=$P(NODE,U,5)="R",GMPARAM("QUIET")=1
"RTN","GMPLENFM",129,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLENFM",130,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLENFM",131,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLENFM",132,0)
 . N GMPL0,GMPL1,GMPL800,GMPL802,GMPDT,GMPCSYS,GMPLCPTR,CODESTAT,ICDC,ICDI,SCTC,SCTD,VHATC,VHATD
"RTN","GMPLENFM",133,0)
 . S IFN=GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLENFM",134,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),CODESTAT=""
"RTN","GMPLENFM",135,0)
 . S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCPTR=$$CSI^ICDEX(80,+GMPL0)
"RTN","GMPLENFM",136,0)
 . S GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX(GMPLCPTR,GMPDT))
"RTN","GMPLENFM",137,0)
 . S ICDC=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2)
"RTN","GMPLENFM",138,0)
 . S:ICDC]"" CODESTAT=CODESTAT_$S(+$$STATCHK^ICDXCODE(GMPLCPTR,ICDC,GMPINDT):"",1:"#")
"RTN","GMPLENFM",139,0)
 . S ICDI=0 F  S ICDI=$O(^AUPNPROB(IFN,803,ICDI)) Q:+ICDI'>0  D
"RTN","GMPLENFM",140,0)
 .. N ICDM0,ICDMC,ICDMCSYS,ICDMDT,ICDCSPTR
"RTN","GMPLENFM",141,0)
 .. S ICDM0=$G(^AUPNPROB(IFN,803,ICDI,0)),ICDMC=$P(ICDM0,U) Q:ICDMC']""
"RTN","GMPLENFM",142,0)
 .. S ICDMCSYS=$P(ICDM0,U,2),ICDMDT=$P(ICDM0,U,3),ICDCSPTR=+$$CODECS^ICDEX(ICDMC,80,ICDMDT)
"RTN","GMPLENFM",143,0)
 .. S ICDC=ICDC_"/"_ICDMC
"RTN","GMPLENFM",144,0)
 .. I CODESTAT'["#" S CODESTAT=CODESTAT_$S(+$$STATCHK^ICDXCODE(ICDCSPTR,ICDMC,GMPINDT):"",1:"#")
"RTN","GMPLENFM",145,0)
 . S SCTC=$P(GMPL800,U),SCTD=$P(GMPL800,U,2),VHATC=$P(GMPL800,U,3),VHATD=$P(GMPL800,U,4)
"RTN","GMPLENFM",146,0)
 . S:SCTC]"" CODESTAT=CODESTAT_$S(+$$STATCHK^LEXSRC2(SCTC,GMPINDT,,"SCT"):"",1:"$")
"RTN","GMPLENFM",147,0)
 . S PROB=$$PROBTEXT^GMPLX(IFN),CNT=CNT+1
"RTN","GMPLENFM",148,0)
 . I GMPARAM("VER"),$P(GMPL1,U,2)="T" S PROB="$"_PROB
"RTN","GMPLENFM",149,0)
 . S PROB=IFN_U_PROB
"RTN","GMPLENFM",150,0)
 . S PROB=PROB_U_ICDC
"RTN","GMPLENFM",151,0)
 . S PROB=PROB_U_$$EXTDT^GMPLX($P(GMPL0,U,13)),SC=$P(GMPL1,U,10)
"RTN","GMPLENFM",152,0)
 . S PROB=PROB_U_$S(+SC:"SC^Y",SC=0:"NSC^N",1:"^")
"RTN","GMPLENFM",153,0)
 . S PROB=PROB_U_$$TXFCTR(GMPL1)_U_SCTC_U_SCTD_U_VHATC_U_VHATD_U_CODESTAT_U_GMPCSYS
"RTN","GMPLENFM",154,0)
 . S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",CNT)=PROB
"RTN","GMPLENFM",155,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",0)=CNT
"RTN","GMPLENFM",156,0)
 Q
"RTN","GMPLENFM",157,0)
 ;
"RTN","GMPLENFM",158,0)
TXFCTR(GMPL1) ;Determine Treatment Factor, if any
"RTN","GMPLENFM",159,0)
 N NXTTF,TXFACTOR
"RTN","GMPLENFM",160,0)
 S TXFACTOR="^"
"RTN","GMPLENFM",161,0)
 F NXTTF=11,12,13,15,16,17,18 I $P(GMPL1,U,NXTTF) S TXFACTOR=$P("A^Agent Orange;I^Ionizing Radiation;E^Env. Contaminants;;H^Head/Neck Cancer;M^Mil Sexual Trauma;C^Combat Vet;S^SHAD",";",NXTTF-10) Q
"RTN","GMPLENFM",162,0)
 Q TXFACTOR
"RTN","GMPLHIST")
0^8^B21062644
"RTN","GMPLHIST",1,0)
GMPLHIST ; SLC/MKB/KER/TC -- Problem List Historical data ;08/21/12  14:16
"RTN","GMPLHIST",2,0)
 ;;2.0;Problem List;**7,26,31,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLHIST",3,0)
 ;
"RTN","GMPLHIST",4,0)
 ; External References
"RTN","GMPLHIST",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHIST",6,0)
 ;
"RTN","GMPLHIST",7,0)
DT ; Add historical data (audit trail) to DT list
"RTN","GMPLHIST",8,0)
 ;   Called from ^GMPLDISP, requires AIFN and adds to GMPDT()
"RTN","GMPLHIST",9,0)
 N NODE,DATE,FLD,PROV,OLD,NEW,ROOT,CHNGE,GMPLCSYS
"RTN","GMPLHIST",10,0)
 S NODE=$G(^GMPL(125.8,AIFN,0)) Q:NODE=""
"RTN","GMPLHIST",11,0)
 S DATE=$$EXTDT^GMPLX($P(NODE,U,3)),FLD=+$P(NODE,U,2),PROV=+$P(NODE,U,8)
"RTN","GMPLHIST",12,0)
 S:'PROV PROV=$P(NODE,U,4)
"RTN","GMPLHIST",13,0)
 S PROV=$S(PROV=".5":"NTRT",1:$P($G(^VA(200,PROV,0)),U))
"RTN","GMPLHIST",14,0)
 S FLD=FLD_U_$$FLDNAME(+FLD)
"RTN","GMPLHIST",15,0)
 S OLD=$P(NODE,U,5),NEW=$P(NODE,U,6),LCNT=LCNT+1
"RTN","GMPLHIST",16,0)
 I +FLD=1101 D  Q
"RTN","GMPLHIST",17,0)
 . N REASON
"RTN","GMPLHIST",18,0)
 . S REASON=" removed by "
"RTN","GMPLHIST",19,0)
 . S:OLD="C" REASON=" changed by "
"RTN","GMPLHIST",20,0)
 . S NODE=$G(^GMPL(125.8,AIFN,1))
"RTN","GMPLHIST",21,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": NOTE "_$$EXTDT^GMPLX($P(NODE,U,5))_REASON_PROV_":"
"RTN","GMPLHIST",22,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)="            "_$P(NODE,U,3)
"RTN","GMPLHIST",23,0)
 I +FLD=1.02 D  Q
"RTN","GMPLHIST",24,0)
 . S CHNGE=$S(NEW="H":"removed",OLD="T":"verified",1:"placed back on list")
"RTN","GMPLHIST",25,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": PROBLEM "_CHNGE_" by "_PROV
"RTN","GMPLHIST",26,0)
 S GMPDT(LCNT,0)=$J(DATE,10)_": "_$P(FLD,U,2)_$S(OLD]"":" changed",1:" added")_" by "_PROV,LCNT=LCNT+1
"RTN","GMPLHIST",27,0)
 I +FLD=.01 D  Q
"RTN","GMPLHIST",28,0)
 . N CSYSOLD,CSYSNEW
"RTN","GMPLHIST",29,0)
 . S CSYSOLD=$$CSI^ICDEX(80,OLD),CSYSNEW=$$CSI^ICDEX(80,NEW)
"RTN","GMPLHIST",30,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(CSYSOLD=30:"(ICD-10-CM ",1:"(ICD-9-CM ")_$P($$ICDDATA^ICDXCODE(CSYSOLD,OLD,DT,"I"),U,2)_")"_" to "_$S(CSYSNEW=30:"(ICD-10-CM ",1:"(ICD-9-CM ")_$P($$ICDDATA^ICDXCODE(CSYSNEW,NEW,DT,"I"),U,2)_")"
"RTN","GMPLHIST",31,0)
 I +FLD=.12 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACTIVE",OLD="I":"INACTIVE",1:"UNKNOWN")_" to "_$S(NEW="A":"ACTIVE",NEW="I":"INACTIVE",1:"UNKNOWN") Q
"RTN","GMPLHIST",32,0)
 I (+FLD=.13)!(+FLD=1.07) S GMPDT(LCNT,0)=$J("from ",17)_$$EXTDT^GMPLX(OLD)_" to "_$$EXTDT^GMPLX(NEW) Q
"RTN","GMPLHIST",33,0)
 I +FLD=1.14 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACUTE",OLD="C":"CHRONIC",1:"UNSPECIFIED")_" to "_$S(NEW="A":"ACUTE",NEW="C":"CHRONIC",1:"UNSPECIFIED") Q
"RTN","GMPLHIST",34,0)
 I +FLD=80005 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD=1:"PENDING",OLD=2:"COMPLETED",1:"N/A")_" to "_$S(NEW=1:"PENDING",NEW="2":"COMPLETED",1:"N/A") Q
"RTN","GMPLHIST",35,0)
 I +FLD=302 D  Q
"RTN","GMPLHIST",36,0)
 . I NEW]"" D
"RTN","GMPLHIST",37,0)
 . . I OLD="" S GMPDT(LCNT,0)=$J(" as ",17)_NEW
"RTN","GMPLHIST",38,0)
 . . E  S GMPDT(LCNT,0)=$J("from ",17)_OLD_$$PAD^GMPLX(OLD,6)_" to "_NEW
"RTN","GMPLHIST",39,0)
 . E  S GMPDT(LCNT,0)=$J(OLD_$$PAD^GMPLX(OLD,6),23)_" removed."
"RTN","GMPLHIST",40,0)
 I (+FLD>1.09)&(+FLD<=1.18) S GMPDT(LCNT,0)=$J("from ",17)_$S(+OLD:"YES",OLD=0:"NO",1:"UNKNOWN")_" to "_$S(+NEW:"YES",NEW=0:"NO",1:"UNKNOWN") Q
"RTN","GMPLHIST",41,0)
 I (+FLD=80001)!(+FLD=80002) S GMPDT(LCNT,0)=$J("from ",17)_OLD_" to "_NEW
"RTN","GMPLHIST",42,0)
 I "^.05^1.01^1.04^1.05^1.06^1.08^"[(U_+FLD_U) D
"RTN","GMPLHIST",43,0)
 . S ROOT=$S(+FLD=.05:"AUTNPOV(",+FLD=1.01:"LEX(757.01,",(+FLD=1.04)!(+FLD=1.05):"VA(200,",+FLD=1.06:"DIC(49,",+FLD=1.08:"SC(",1:"") Q:ROOT=""
"RTN","GMPLHIST",44,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD:$P(@(U_ROOT_OLD_",0)"),U)_$$PAD^GMPLX($P(@(U_ROOT_OLD_",0)"),U),6),1:"UNSPECIFIED")
"RTN","GMPLHIST",45,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)=$J("to ",17)_$S(NEW:$P(@(U_ROOT_NEW_",0)"),U),1:"UNSPECIFIED")
"RTN","GMPLHIST",46,0)
 Q
"RTN","GMPLHIST",47,0)
 ;
"RTN","GMPLHIST",48,0)
FLDNAME(NUM) ; Returns Field Name for Display
"RTN","GMPLHIST",49,0)
 N NAME,NM1,NM2,I,J S J=0,NAME="" D NUM(.NM1),ALP(.NM2) S:+($G(NM1(+NUM)))=+NUM J=+NUM
"RTN","GMPLHIST",50,0)
 S:$L($G(NM2(+J))) NAME=$G(NM2(+J))
"RTN","GMPLHIST",51,0)
 Q NAME
"RTN","GMPLHIST",52,0)
ALP(X) ; Alpha Field Names
"RTN","GMPLHIST",53,0)
 S X(.01)="DIAGNOSIS",X(.02)="PATIENT NAME",X(.03)="DATE LAST MODIFIED",X(.04)="CLASS",X(.05)="PROVIDER NARRATIVE"
"RTN","GMPLHIST",54,0)
 S X(.06)="FACILITY",X(.07)="NUMBER",X(.08)="DATE ENTERED",X(.12)="STATUS",X(.13)="DATE OF ONSET",X(1.01)="PROBLEM",X(1.02)="CONDITION"
"RTN","GMPLHIST",55,0)
 S X(1.03)="ENTERED BY",X(1.04)="RECORDING PROVIDER",X(1.05)="RESPONSIBLE PROVIDER",X(1.06)="SERVICE",X(1.07)="DATE RESOLVED"
"RTN","GMPLHIST",56,0)
 S X(1.08)="CLINIC",X(1.09)="DATE RECORDED",X(1.1)="SERVICE CONNECTED",X(1.11)="AGENT ORANGE EXP",X(1.12)="RADIATION EXP",X(1.13)="ENV CONTAMINANTS EXP"
"RTN","GMPLHIST",57,0)
 S X(1.14)="IMMEDIACY",X(1.15)="HEAD/NECK CANCER",X(1.16)="MIL SEXUAL TRAUMA",X(1.17)="COMBAT VET",X(1.18)="SHAD",X(80001)="SNOMED CT CONCEPT",X(80002)="SNOMED CT DESIGNATION"
"RTN","GMPLHIST",58,0)
 S X(80003)="VHAT CONCEPT",X(80004)="VHAT DESIGNATION",X(80005)="MAP STATUS"
"RTN","GMPLHIST",59,0)
 S X(302)="SECONDARY DIAGNOSIS",X(1101)="NOTE"
"RTN","GMPLHIST",60,0)
 Q
"RTN","GMPLHIST",61,0)
NUM(X) ; Numeric Field Designations
"RTN","GMPLHIST",62,0)
 N FN F FN=.01:.01:.08 S X(+FN)=+FN
"RTN","GMPLHIST",63,0)
 F FN=.12:.01:.13 S X(+FN)=+FN
"RTN","GMPLHIST",64,0)
 F FN=1.01:.01:1.18 S X(+FN)=+FN
"RTN","GMPLHIST",65,0)
 F FN=80001:1:80005 S X(+FN)=+FN
"RTN","GMPLHIST",66,0)
 S X(1101)=1101,X(302)=302
"RTN","GMPLHIST",67,0)
 Q
"RTN","GMPLHS")
0^21^B23837275
"RTN","GMPLHS",1,0)
GMPLHS ; SLC/MKB/KER/TC - Extract Prob List Health Summary ;11/27/12  09:17
"RTN","GMPLHS",2,0)
 ;;2.0;Problem List;**22,26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLHS",3,0)
 ;
"RTN","GMPLHS",4,0)
 ; External References
"RTN","GMPLHS",5,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLHS",6,0)
 ;    ICR  5747  $$CSI/SAB^ICDEX
"RTN","GMPLHS",7,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHS",8,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMPLHS",9,0)
 ;
"RTN","GMPLHS",10,0)
GETLIST(GMPDFN,STATUS) ; Define List
"RTN","GMPLHS",11,0)
 N GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL K ^TMP("GMPLHS",$J) Q:+GMPDFN'>0
"RTN","GMPLHS",12,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLHS",13,0)
 S GMPLVIEW("ACT")=STATUS,GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLHS",14,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLHS",15,0)
BUILD ; Build list for selected patient
"RTN","GMPLHS",16,0)
 ;   Sets Global Array:
"RTN","GMPLHS",17,0)
 ;   ^TMP("GMPLHS",$J,STATUS,0)
"RTN","GMPLHS",18,0)
 ;
"RTN","GMPLHS",19,0)
 ;   Piece 1:  GMPCNT     # of entries extracted
"RTN","GMPLHS",20,0)
 ;         2:  GMPTOTAL   # of entries that exist
"RTN","GMPLHS",21,0)
 N IFN,GMPCNT,NUM S (NUM,GMPCNT)=0 F  S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLHS",22,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0  D GETPROB(IFN)
"RTN","GMPLHS",23,0)
 I $G(GMPCNT)'>0 K ^TMP("GMPLHS",$J) Q
"RTN","GMPLHS",24,0)
 S ^TMP("GMPLHS",$J,STATUS,0)=GMPCNT_U_GMPTOTAL
"RTN","GMPLHS",25,0)
 Q
"RTN","GMPLHS",26,0)
GETPROB(IFN) ; Get problem data and set it to ^TMP array
"RTN","GMPLHS",27,0)
 ;   Sets Global Arrays:
"RTN","GMPLHS",28,0)
 ;   ^TMP("GMPLHS",$J,CNT,0)
"RTN","GMPLHS",29,0)
 ;   Piece 1:  Pointer to ICD file #80
"RTN","GMPLHS",30,0)
 ;         2:  Internal Date Last Modified
"RTN","GMPLHS",31,0)
 ;         3:  Facility Name
"RTN","GMPLHS",32,0)
 ;         4:  Internal Date Entered
"RTN","GMPLHS",33,0)
 ;         5:  Internal Status (A/I/"")
"RTN","GMPLHS",34,0)
 ;         6:  Internal Date of Onset
"RTN","GMPLHS",35,0)
 ;         7:  Responsible Provider Name
"RTN","GMPLHS",36,0)
 ;         8:  Service Name
"RTN","GMPLHS",37,0)
 ;         9:  Service Abbreviation
"RTN","GMPLHS",38,0)
 ;        10:  Internal Date Resolved
"RTN","GMPLHS",39,0)
 ;        11:  Clinic Name
"RTN","GMPLHS",40,0)
 ;        12:  Internal Date Recorded
"RTN","GMPLHS",41,0)
 ;        13:  Problem Term (from Lexicon)
"RTN","GMPLHS",42,0)
 ;        14:  Exposure String (AO/IR/EC/HNC/MST/CV/SHD)
"RTN","GMPLHS",43,0)
 ;        15:  SNOMED-CT Concept Code
"RTN","GMPLHS",44,0)
 ;        16:  SNOMED-CT Preferred Text
"RTN","GMPLHS",45,0)
 ;        17:  Primary ICD Code
"RTN","GMPLHS",46,0)
 ;        18:  Primary ICD Description
"RTN","GMPLHS",47,0)
 ;        19:  VHAT Concept Code
"RTN","GMPLHS",48,0)
 ;        20:  VHAT Preferred Text
"RTN","GMPLHS",49,0)
 ;        21:  Date of Interest
"RTN","GMPLHS",50,0)
 ;        22:  Coding System
"RTN","GMPLHS",51,0)
 ;
"RTN","GMPLHS",52,0)
 ;   ^TMP("GMPLHS",$J,CNT,#,"ICD9") <-Multiple ICD-9/10-CM codes mapped to a SNOMED-CT concept
"RTN","GMPLHS",53,0)
 ;   Piece 1: Secondary ICD-9/10-CM Code
"RTN","GMPLHS",54,0)
 ;   Piece 2: Secondary ICD-9/10-CM Description
"RTN","GMPLHS",55,0)
 ;
"RTN","GMPLHS",56,0)
 ;   ^TMP("GMPLHS",$J,CNT,"N")
"RTN","GMPLHS",57,0)
 ;   Piece 1:  Provider Narrative
"RTN","GMPLHS",58,0)
 ;
"RTN","GMPLHS",59,0)
 ;   ^TMP("GMPLHS",$J,CNT,"IEN")
"RTN","GMPLHS",60,0)
 ;   Piece 1:  Pointer to Problem file 9000011
"RTN","GMPLHS",61,0)
 ;
"RTN","GMPLHS",62,0)
 N DIC,DIQ,DR,DA,REC,DIAG,LASTMDT,NARR,SITE,ENTDT,STAT,ONSETDT,RPROV,T,VHATC,VHATT,DTINT,CSYS
"RTN","GMPLHS",63,0)
 N SERV,SERVABB,RESDT,CLIN,RECDT,LEXI,LEX,PG,AO,EXP,HNC,MST,CV,SHD,IR,SCS,SCTC,SCTT,ICD,ICDD,GMPL
"RTN","GMPLHS",64,0)
 S DIC=9000011,DA=IFN,DIQ="REC(",DIQ(0)="IE"
"RTN","GMPLHS",65,0)
 S DR=".01;.03;.05;.06;.08;.12;.13;1.01;1.05;1.06;1.07;1.08;1.09;1.11;1.12;1.13;1.15;1.16;1.17;1.18;80001;80003;80201;80202"
"RTN","GMPLHS",66,0)
 D EN^DIQ1
"RTN","GMPLHS",67,0)
 S ICD=REC(9000011,DA,.01,"E")
"RTN","GMPLHS",68,0)
 S DIAG=REC(9000011,DA,.01,"I"),LASTMDT=REC(9000011,DA,.03,"I")
"RTN","GMPLHS",69,0)
 S NARR=REC(9000011,DA,.05,"E"),SITE=REC(9000011,DA,.06,"E")
"RTN","GMPLHS",70,0)
 S ENTDT=REC(9000011,DA,.08,"I"),STAT=REC(9000011,DA,.12,"I")
"RTN","GMPLHS",71,0)
 S ONSETDT=REC(9000011,DA,.13,"I")
"RTN","GMPLHS",72,0)
 S LEXI=REC(9000011,DA,1.01,"I")
"RTN","GMPLHS",73,0)
 S LEX=REC(9000011,DA,1.01,"E")
"RTN","GMPLHS",74,0)
 S RPROV=REC(9000011,DA,1.05,"E")
"RTN","GMPLHS",75,0)
 S SERV=REC(9000011,DA,1.06,"E")
"RTN","GMPLHS",76,0)
 S SERVABB=$$SERV(REC(9000011,DA,1.06,"I"),SERV)
"RTN","GMPLHS",77,0)
 S RESDT=REC(9000011,DA,1.07,"I")
"RTN","GMPLHS",78,0)
 S CLIN=REC(9000011,DA,1.08,"E")
"RTN","GMPLHS",79,0)
 S RECDT=REC(9000011,DA,1.09,"I")
"RTN","GMPLHS",80,0)
 S AO=+REC(9000011,DA,1.11,"I")
"RTN","GMPLHS",81,0)
 S IR=+REC(9000011,DA,1.12,"I")
"RTN","GMPLHS",82,0)
 S PG=+REC(9000011,DA,1.13,"I")
"RTN","GMPLHS",83,0)
 S HNC=+REC(9000011,DA,1.15,"I")
"RTN","GMPLHS",84,0)
 S MST=+REC(9000011,DA,1.16,"I")
"RTN","GMPLHS",85,0)
 S CV=+REC(9000011,DA,1.17,"I")
"RTN","GMPLHS",86,0)
 S SHD=+REC(9000011,DA,1.18,"I")
"RTN","GMPLHS",87,0)
 S SCTC=REC(9000011,DA,80001,"I")
"RTN","GMPLHS",88,0)
 S VHATC=REC(9000011,DA,80003,"I")
"RTN","GMPLHS",89,0)
 S DTINT=$S(+REC(9000011,DA,80201,"I"):REC(9000011,DA,80201,"I"),1:ENTDT)
"RTN","GMPLHS",90,0)
 S CSYS=$S(REC(9000011,DA,80202,"I")]"":REC(9000011,DA,80202,"I"),1:$$SAB^ICDEX($$CSI^ICDEX(80,DIAG),DTINT))
"RTN","GMPLHS",91,0)
 I $L($G(SCTC)) S SCTT=$P($$SCTTEXT^GMPLUTL2($G(SCTC),$G(ENTDT),"SCT"),U)
"RTN","GMPLHS",92,0)
 I $L($G(VHATC)) S VHATT=$$SCTTEXT^GMPLUTL2($G(VHATC),$G(ENTDT),"VHAT")
"RTN","GMPLHS",93,0)
 S ICDD=$$ICDDESC^GMPLUTL2($G(ICD),$G(DTINT),$G(CSYS))
"RTN","GMPLHS",94,0)
 K SCS D SCS^GMPLX1(DA,.SCS) S EXP=$G(SCS(1))
"RTN","GMPLHS",95,0)
 S GMPCNT=+$G(GMPCNT)+1,^TMP("GMPLHS",$J,GMPCNT,0)=DIAG_U_LASTMDT_U_SITE_U_ENTDT_U_STAT_U_ONSETDT_U_RPROV_U_SERV_U_SERVABB_U_RESDT_U_CLIN_U_RECDT_U_LEX_U_EXP_U_SCTC_U_$G(SCTT)_U_$G(ICD)_U_$G(ICDD)_U_VHATC_U_$G(VHATT)_U_DTINT_U_CSYS
"RTN","GMPLHS",96,0)
 S ^TMP("GMPLHS",$J,GMPCNT,"N")=NARR,^TMP("GMPLHS",$J,GMPCNT,"IEN")=IFN
"RTN","GMPLHS",97,0)
 S:+LEXI>0 ^TMP("GMPLHS",$J,GMPCNT,"L")=LEXI_"^"_LEX
"RTN","GMPLHS",98,0)
 D DETAIL^GMPLUTL2(IFN,.GMPL)
"RTN","GMPLHS",99,0)
 I GMPL("ICD9MLTP")'="" F T=1:1:GMPL("ICD9MLTP") D
"RTN","GMPLHS",100,0)
 . S ^TMP("GMPLHS",$J,GMPCNT,0,"ICD9")=GMPL("ICD9MLTP")
"RTN","GMPLHS",101,0)
 . S ^TMP("GMPLHS",$J,GMPCNT,T,"ICD9")=$P($G(GMPL("ICD9MLTP",T)),U)_U_$P($G(GMPL("ICD9MLTP",T)),U,2)
"RTN","GMPLHS",102,0)
 E  S ^TMP("GMPLHS",$J,GMPCNT,0,"ICD9")=""
"RTN","GMPLHS",103,0)
 D GETCOMM(IFN,GMPCNT)
"RTN","GMPLHS",104,0)
 Q
"RTN","GMPLHS",105,0)
GETCOMM(IFN,CNT) ; Get Active Comments for a Note
"RTN","GMPLHS",106,0)
 ;   Sets Global Array:
"RTN","GMPLHS",107,0)
 ;   ^TMP("GMPLHS",$J,CNT,"C",LOCATION,NOTE NMBR,0)
"RTN","GMPLHS",108,0)
 ;
"RTN","GMPLHS",109,0)
 ;   Piece 1:  Note Narrative
"RTN","GMPLHS",110,0)
 ;         2:  Internal Date Note Added
"RTN","GMPLHS",111,0)
 ;         3;  Name of Note's Author
"RTN","GMPLHS",112,0)
 ;
"RTN","GMPLHS",113,0)
 N IFN2,IFN3,LOC,NODE S LOC=0 Q:$D(^AUPNPROB(IFN,11))'>0  S IFN2=0
"RTN","GMPLHS",114,0)
 F  S IFN2=$O(^AUPNPROB(IFN,11,IFN2)) Q:IFN2'>0  D
"RTN","GMPLHS",115,0)
 . Q:$D(^AUPNPROB(IFN,11,IFN2,11))'>0
"RTN","GMPLHS",116,0)
 . S LOC=+$G(^AUPNPROB(IFN,11,IFN2,0)),IFN3=0
"RTN","GMPLHS",117,0)
 . F  S IFN3=$O(^AUPNPROB(IFN,11,IFN2,11,IFN3)) Q:IFN3'>0  D
"RTN","GMPLHS",118,0)
 . . S NODE=$G(^AUPNPROB(IFN,11,IFN2,11,IFN3,0)) Q:$P(NODE,U,4)']""
"RTN","GMPLHS",119,0)
 . . S ^TMP("GMPLHS",$J,CNT,"C",LOC,$P(NODE,U),0)=$P(NODE,U,3)_U_$P(NODE,U,5)_U_$P($G(^VA(200,+$P(NODE,U,6),0)),U)
"RTN","GMPLHS",120,0)
 Q
"RTN","GMPLHS",121,0)
SERV(X,SERV) ; Returns Service Name Abbreviation
"RTN","GMPLHS",122,0)
 N ABBREV S ABBREV=$P($G(^DIC(49,+X,0)),U,2) S:ABBREV="" ABBREV=$E($G(SERV),1,5)
"RTN","GMPLHS",123,0)
 Q ABBREV
"RTN","GMPLMGR")
0^22^B28233953
"RTN","GMPLMGR",1,0)
GMPLMGR ; ISL/MKB,AJB,JER,TC - Problem List VALM Utilities ;08/21/12  14:23
"RTN","GMPLMGR",2,0)
 ;;2.0;Problem List;**21,28,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLMGR",3,0)
 ; 28 Feb 00 - MA added view comments accross Divisions
"RTN","GMPLMGR",4,0)
 ;
"RTN","GMPLMGR",5,0)
 ; External References
"RTN","GMPLMGR",6,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLMGR",7,0)
 ;   ICR   5747  $$CSI/SAB^ICDEX
"RTN","GMPLMGR",8,0)
 ;
"RTN","GMPLMGR",9,0)
INIT ; -- init variables, list array
"RTN","GMPLMGR",10,0)
 S:'$G(GMPDFN) GMPDFN=$$PAT^GMPLX1 I +GMPDFN'>0 K GMPDFN S VALMQUIT=1 Q
"RTN","GMPLMGR",11,0)
 S GMPROV=$$REQPROV^GMPLX1 I +GMPROV'>0 K GMPDFN,GMPROV S VALMQUIT=1 Q
"RTN","GMPLMGR",12,0)
IN1 S GMPVA=$S($G(DUZ("AG"))="V":1,1:0),GMPVAMC=+$G(DUZ(2))
"RTN","GMPLMGR",13,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(+GMPDFN) ;reset
"RTN","GMPLMGR",14,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0
"RTN","GMPLMGR",15,0)
 S GMPLVIEW("VIEW")=$$VIEW^GMPLX1(DUZ)
"RTN","GMPLMGR",16,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLMGR",17,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW),BUILD(.GMPLIST)
"RTN","GMPLMGR",18,0)
 D:$E(GMPLVIEW("VIEW"))="S" CHGCAP^VALM("CLINIC","Service/Provider")
"RTN","GMPLMGR",19,0)
 S VALMSG=$$MSG^GMPLX
"RTN","GMPLMGR",20,0)
 Q
"RTN","GMPLMGR",21,0)
 ;
"RTN","GMPLMGR",22,0)
BUILD(PLIST) ; -- build list array
"RTN","GMPLMGR",23,0)
 N I D CLEAN^VALM10 K ^TMP("GMPLIDX",$J) S (I,GMPCOUNT,VALMCNT)=0
"RTN","GMPLMGR",24,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","GMPLMGR",25,0)
 F  S I=$O(PLIST(I)) Q:I'>0  D:$D(GMPLUSER) BLDPROB(+PLIST(I)) D:'$D(GMPLUSER) BLDPROB^GMPLMGR2(+PLIST(I))
"RTN","GMPLMGR",26,0)
 S ^TMP("GMPL",$J,0)=+$G(GMPCOUNT)_U_+$G(VALMCNT) ; # entries^# lines
"RTN","GMPLMGR",27,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","GMPLMGR",28,0)
 I $G(GMPCOUNT)'>0 S ^TMP("GMPL",$J,1,0)="   ",^TMP("GMPL",$J,2,0)="    No data available meeting criteria."
"RTN","GMPLMGR",29,0)
 Q
"RTN","GMPLMGR",30,0)
BLDPROB(IFN) ; Add problem line
"RTN","GMPLMGR",31,0)
 N GMPL0,GMPL1,GMPL800,GMPL802,GMPDT,GMPCSYS,DATE,TEXT,NAME,LINE,ACTIVE,I,NOTE,FAC,PROBLEM,NIFN,DELETED,ICD,SCTC
"RTN","GMPLMGR",32,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)) Q:'$L(GMPL0)
"RTN","GMPLMGR",33,0)
 S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPDT))
"RTN","GMPLMGR",34,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2),SCTC=$P(GMPL800,U)
"RTN","GMPLMGR",35,0)
 S DELETED=$S($P(GMPL1,U,2)="H":1,1:0) ; flag if prob was deleted
"RTN","GMPLMGR",36,0)
 S ACTIVE=$P(GMPL0,U,12),DATE=$J($$EXTDT^GMPLX($P(GMPL0,U,3)),8)
"RTN","GMPLMGR",37,0)
 S PROBLEM=$S(DELETED:"< DELETED >",1:$$PROBTEXT^GMPLX(IFN))
"RTN","GMPLMGR",38,0)
 I ACTIVE="A",$P(GMPL0,U,13),'DELETED S PROBLEM=PROBLEM_", Onset "_$$EXTDT^GMPLX($P(GMPL0,U,13))
"RTN","GMPLMGR",39,0)
 I ACTIVE="I",$P(GMPL1,U,7),'DELETED S PROBLEM=PROBLEM_", Resolved "_$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLMGR",40,0)
 D WRAP^GMPLX(PROBLEM,39,.TEXT) ; format text to 40 chr
"RTN","GMPLMGR",41,0)
 I $E(GMPLVIEW("VIEW"))="S" S NAME=$$SERV^GMPLX1($P(GMPL1,U,6))_$$NAME^GMPLX1($P(GMPL1,U,5))
"RTN","GMPLMGR",42,0)
 E  S NAME=$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLMGR",43,0)
BLD1 S GMPCOUNT=+$G(GMPCOUNT)+1
"RTN","GMPLMGR",44,0)
 S LINE=$$SETFLD^VALM1(GMPCOUNT,"","NUMBER")
"RTN","GMPLMGR",45,0)
 S:ACTIVE="A" ACTIVE=$S($P(GMPL1,U,14)="A":"*",1:"") ; reset for priority
"RTN","GMPLMGR",46,0)
 S LINE=$$SETFLD^VALM1(ACTIVE,LINE,"STATUS")
"RTN","GMPLMGR",47,0)
 S LINE=$$SETFLD^VALM1(TEXT(1),LINE,"PROBLEM")
"RTN","GMPLMGR",48,0)
 S LINE=$$SETFLD^VALM1(DATE,LINE,"DATE")
"RTN","GMPLMGR",49,0)
 S LINE=$$SETFLD^VALM1(NAME,LINE,"CLINIC"),VALMCNT=+$G(VALMCNT)+1
"RTN","GMPLMGR",50,0)
 S ^TMP("GMPL",$J,VALMCNT,0)=LINE,^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",51,0)
 S ^TMP("GMPLIDX",$J,GMPCOUNT)=VALMCNT_U_IFN
"RTN","GMPLMGR",52,0)
 I GMPARAM("VER"),$P(GMPL1,U,2)="T",'DELETED S LINE=$E(LINE,1,4)_"$"_$E(LINE,6,79),^TMP("GMPL",$J,VALMCNT,0)=LINE D CNTRL^VALM10(VALMCNT,5,1,IOINHI,IOINORM)
"RTN","GMPLMGR",53,0)
 ; added for Code Set Versioning (CSV) - annotates inactive ICD code with #
"RTN","GMPLMGR",54,0)
 I '$$CODESTS^GMPLX(IFN,DT) S LINE=$E(LINE,1,4)_"#"_$E(LINE,6,79),^TMP("GMPL",$J,VALMCNT,0)=LINE D CNTRL^VALM10(VALMCNT,5,1,IOINHI,IOINORM)
"RTN","GMPLMGR",55,0)
 Q:DELETED
"RTN","GMPLMGR",56,0)
BLD2 I TEXT>1 F I=2:1:TEXT D
"RTN","GMPLMGR",57,0)
 . S LINE="",LINE=$$SETFLD^VALM1(TEXT(I),LINE,"PROBLEM")
"RTN","GMPLMGR",58,0)
 . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR",59,0)
 . S ^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",60,0)
 ;Q:'$D(^AUPNPROB(IFN,11,"B",+GMPVAMC))  ; display current user's notes
"RTN","GMPLMGR",61,0)
 ; Routine has been changed to show all Problem List Comments for
"RTN","GMPLMGR",62,0)
 ; Divisions per Clinical Workgroup decision 26 Jan 2000
"RTN","GMPLMGR",63,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLMGR",64,0)
 . F NIFN=0:0  S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:+NIFN'>0  D
"RTN","GMPLMGR",65,0)
 . . S NOTE=$P($G(^AUPNPROB(IFN,11,FAC,11,NIFN,0)),U,3)
"RTN","GMPLMGR",66,0)
 . . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",67,0)
 . . S ^TMP("GMPL",$J,VALMCNT,0)="        "_NOTE
"RTN","GMPLMGR",68,0)
 Q
"RTN","GMPLMGR",69,0)
 ;
"RTN","GMPLMGR",70,0)
HDR ; -- header code
"RTN","GMPLMGR",71,0)
 N HDR,LNM,FNM,PAT,NUM
"RTN","GMPLMGR",72,0)
 S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLMGR",73,0)
 S NUM=GMPCOUNT S:GMPTOTAL>GMPCOUNT NUM=NUM_" of "_GMPTOTAL
"RTN","GMPLMGR",74,0)
 S NUM=NUM_$S(GMPLVIEW("ACT")="A":" active",GMPLVIEW("ACT")="I":" inactive",1:"")_" problems"
"RTN","GMPLMGR",75,0)
 S VALMHDR(1)=PAT_$J(NUM,79-$L(PAT))
"RTN","GMPLMGR",76,0)
 S HDR=$S(GMPLVIEW("ACT")="I":"INACTIVE",GMPLVIEW("ACT")="A":"ACTIVE",1:"ALL")
"RTN","GMPLMGR",77,0)
 I $L(GMPLVIEW("VIEW"))>2 S HDR=HDR_$S($E(GMPLVIEW("VIEW"))="S":" SERVICE",1:" CLINIC") ; screened
"RTN","GMPLMGR",78,0)
 S HDR=HDR_" PROBLEMS"
"RTN","GMPLMGR",79,0)
 S:GMPLVIEW("PROV") LNM=$P($P(GMPLVIEW("PROV"),U,2),","),FNM=$P($P(GMPLVIEW("PROV"),U,2),",",2),HDR=HDR_" BY "_FNM_" "_LNM
"RTN","GMPLMGR",80,0)
 S VALMHDR(2)=$J(HDR,$L(HDR)\2+41)
"RTN","GMPLMGR",81,0)
 Q
"RTN","GMPLMGR",82,0)
 ;
"RTN","GMPLMGR",83,0)
HELP ; -- help code
"RTN","GMPLMGR",84,0)
 N X
"RTN","GMPLMGR",85,0)
 W !!?4,"To update the problem list first select from Add, Remove, Edit,"
"RTN","GMPLMGR",86,0)
 W !?4 W:GMPARAM("VER") "Verify, "
"RTN","GMPLMGR",87,0)
 W "Inactivate, or Comment, then enter the problem number(s)."
"RTN","GMPLMGR",88,0)
 W !?4,"If you need more information on a problem, select Detailed"
"RTN","GMPLMGR",89,0)
 W !?4,"Display; to change whether all or only selected problems for this"
"RTN","GMPLMGR",90,0)
 W !?4,"patient are listed, choose Select View.  Enter ?? to see more"
"RTN","GMPLMGR",91,0)
 W !?4,"actions for facilitating navigation of the list."
"RTN","GMPLMGR",92,0)
 W !?4,"Problem statuses: *-Acute I-Inactive #-Inactive ICD Code"
"RTN","GMPLMGR",93,0)
 W:GMPARAM("VER") " $-Unverified"
"RTN","GMPLMGR",94,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLMGR",95,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLMGR",96,0)
 Q
"RTN","GMPLMGR2")
0^23^B29140181
"RTN","GMPLMGR2",1,0)
GMPLMGR2 ; ISL/MKB,KER,AJB,TC - Problem List VALM Utilities cont ;11/27/12  08:33
"RTN","GMPLMGR2",2,0)
 ;;2.0;Problem List;**26,28,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLMGR2",3,0)
 ;
"RTN","GMPLMGR2",4,0)
 ; External References
"RTN","GMPLMGR2",5,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLMGR2",6,0)
 ;   ICR   5747  $$CSI/SAB^ICDEX
"RTN","GMPLMGR2",7,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLMGR2",8,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLMGR2",9,0)
 ;   DBIA 10116  $$SETFLD^VALM1
"RTN","GMPLMGR2",10,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLMGR2",11,0)
 ;   DBIA 10140  EN^XQORM
"RTN","GMPLMGR2",12,0)
 ;
"RTN","GMPLMGR2",13,0)
BLDPROB(IFN) ; Build Line for Problem in List
"RTN","GMPLMGR2",14,0)
 ;   Input INF   Pointer to Problem file 9000011
"RTN","GMPLMGR2",15,0)
 ;   Expects GMPCOUNT
"RTN","GMPLMGR2",16,0)
 N GMPL0,GMPL1,GMPL800,GMPL802,GMPDT,GMPCSYS,RESOLVED,TEXT,I,LINE,STR,SC,SP,ICD,ONSET,PROBLEM,STATUS,SCTC
"RTN","GMPLMGR2",17,0)
 Q:'$D(GMPCOUNT)  S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)) Q:'$L(GMPL0)
"RTN","GMPLMGR2",18,0)
 S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPDT))
"RTN","GMPLMGR2",19,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2),SCTC=$P(GMPL800,U)
"RTN","GMPLMGR2",20,0)
 S SC=$P(GMPL1,U,10),SP=$P(GMPL1,U,11,13)_"^"_$P(GMPL1,U,15,16),STATUS=$P(GMPL0,U,12)
"RTN","GMPLMGR2",21,0)
 S:$P(GMPL1,U,2)="H" PROBLEM="< DELETED >" I $P(GMPL1,U,2)'="H" D
"RTN","GMPLMGR2",22,0)
 . S PROBLEM=$$PROBTEXT^GMPLX(IFN),ONSET=$P(GMPL0,U,13)
"RTN","GMPLMGR2",23,0)
 . I ONSET S PROBLEM=PROBLEM_", Onset "_$$EXTDT^GMPLX(ONSET)
"RTN","GMPLMGR2",24,0)
 S RESOLVED=$J($$EXTDT^GMPLX($P(GMPL1,U,7)),8)
"RTN","GMPLMGR2",25,0)
 S GMPCOUNT=GMPCOUNT+1
"RTN","GMPLMGR2",26,0)
 D WRAP^GMPLX(PROBLEM,39,.TEXT)
"RTN","GMPLMGR2",27,0)
 S LINE=$$SETFLD^VALM1(GMPCOUNT,"","NUMBER")
"RTN","GMPLMGR2",28,0)
 ; added for Code Set Versioning (CSV) - checks ICD code - # if inactive
"RTN","GMPLMGR2",29,0)
 I '$$CODESTS^GMPLX(IFN,DT) D
"RTN","GMPLMGR2",30,0)
 . I STATUS="A" S LINE=$$SETFLD^VALM1(" #",LINE,"STATUS")
"RTN","GMPLMGR2",31,0)
 . I STATUS="I" S LINE=$$SETFLD^VALM1(STATUS_"#",LINE,"STATUS")
"RTN","GMPLMGR2",32,0)
 E  S:STATUS="I" LINE=$$SETFLD^VALM1(STATUS,LINE,"STATUS")
"RTN","GMPLMGR2",33,0)
 ; S:STATUS="I" LINE=$$SETFLD^VALM1(STATUS,LINE,"STATUS")
"RTN","GMPLMGR2",34,0)
 S LINE=$$SETFLD^VALM1(TEXT(1),LINE,"PROBLEM")
"RTN","GMPLMGR2",35,0)
 S LINE=$$SETFLD^VALM1(ICD,LINE,"ICD")
"RTN","GMPLMGR2",36,0)
 I $L(SC) D
"RTN","GMPLMGR2",37,0)
 . S STR=$S(+SC:"YES",SC=0:"NO",1:"   ")
"RTN","GMPLMGR2",38,0)
 . S LINE=$$SETFLD^VALM1(STR,LINE,"SERV CONNECTED")
"RTN","GMPLMGR2",39,0)
 I $L(SP) D
"RTN","GMPLMGR2",40,0)
 . S STR=$S(+$P(SP,U):"Agent Orange",+$P(SP,U,2):"Radiation",+$P(SP,U,3):"Contaminants",+$P(SP,U,4):"Head/Neck Cancer",+$P(SP,U,5):"Mil Sexual Trauma",1:"")
"RTN","GMPLMGR2",41,0)
 . S LINE=$$SETFLD^VALM1(STR,LINE,"EXPOSURE")
"RTN","GMPLMGR2",42,0)
 S LINE=$$SETFLD^VALM1(RESOLVED,LINE,"RESOLVED")
"RTN","GMPLMGR2",43,0)
 S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR2",44,0)
 S ^TMP("GMPLIDX",$J,GMPCOUNT)=VALMCNT_U_IFN
"RTN","GMPLMGR2",45,0)
 I TEXT>1 F I=2:1:TEXT D
"RTN","GMPLMGR2",46,0)
 . S LINE="",LINE=$$SETFLD^VALM1(TEXT(I),LINE,"PROBLEM")
"RTN","GMPLMGR2",47,0)
 . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR2",48,0)
 Q
"RTN","GMPLMGR2",49,0)
 ;
"RTN","GMPLMGR2",50,0)
HELP ; Help Code
"RTN","GMPLMGR2",51,0)
 N X W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLMGR2",52,0)
 W !?4,"the problem list select from Add, Remove, Edit, Inactivate,"
"RTN","GMPLMGR2",53,0)
 W !?4,"and Enter Comment; you will then be prompted for the problem"
"RTN","GMPLMGR2",54,0)
 W !?4,"number.  To see all of this patient's problems, both active and"
"RTN","GMPLMGR2",55,0)
 W !?4,"inactive, select Show All Problems; select Print to print the"
"RTN","GMPLMGR2",56,0)
 W !?4,"same complete list in a chartable format.  To see a listing of"
"RTN","GMPLMGR2",57,0)
 W !?4,"actions that facilitate navigating the list, enter '??'."
"RTN","GMPLMGR2",58,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLMGR2",59,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLMGR2",60,0)
 Q
"RTN","GMPLMGR2",61,0)
 ;
"RTN","GMPLMGR2",62,0)
EXIT ; Exit Code
"RTN","GMPLMGR2",63,0)
 I GMPARAM("PRT"),$D(GMPRINT) D AUTO
"RTN","GMPLMGR2",64,0)
 K ^TMP("GMPL",$J),^TMP("GMPLIDX",$J)
"RTN","GMPLMGR2",65,0)
 K XQORM("KEY","="),XQORM("XLATE")
"RTN","GMPLMGR2",66,0)
 K GMPDFN,GMPROV,GMPLVIEW,GMPARAM,VALMBCK,VALMHDR,VALMCNT,GMPCOUNT,GMPLUSER,GMPSC,VALMSG,GMPVAMC,GMPLIST,GMPAGTOR,GMPION,GMPGULF,GMPVA,GMPTOTAL,GMPRINT,AUPNSEX,GMPCLIN
"RTN","GMPLMGR2",67,0)
 Q
"RTN","GMPLMGR2",68,0)
 ;
"RTN","GMPLMGR2",69,0)
AUTO ; Print Problem List when Exiting Patient?
"RTN","GMPLMGR2",70,0)
 ;   Called from EXIT,NEWPAT^GMPLMGR1
"RTN","GMPLMGR2",71,0)
 N DIR,X,Y,DUOUT,DTOUT Q:'GMPARAM("PRT")  Q:'$D(GMPRINT)
"RTN","GMPLMGR2",72,0)
 S DIR(0)="YA",DIR("A")="Print a new problem list? ",DIR("B")="YES"
"RTN","GMPLMGR2",73,0)
 S DIR("?",1)="Press <return> to generate a new complete problem list for this patient;",DIR("?")="enter NO to continue without printing."
"RTN","GMPLMGR2",74,0)
 W $C(7),!!,">>>  THIS PATIENT'S PROBLEM LIST HAS CHANGED!"
"RTN","GMPLMGR2",75,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S GMPQUIT=1 Q
"RTN","GMPLMGR2",76,0)
 Q:'Y  D VAF^GMPLPRNT,DEVICE^GMPLPRNT G:$D(GMPQUIT) AUTQ
"RTN","GMPLMGR2",77,0)
 D CLEAR^VALM1,PRT^GMPLPRNT
"RTN","GMPLMGR2",78,0)
AUTQ ; Quit Auto-Print
"RTN","GMPLMGR2",79,0)
 D KILL^GMPLX
"RTN","GMPLMGR2",80,0)
 Q
"RTN","GMPLMGR2",81,0)
 ;
"RTN","GMPLMGR2",82,0)
SHOW ; Show Current View of List
"RTN","GMPLMGR2",83,0)
 N VIEW,NUM,NAME S VIEW=$E(GMPLVIEW("VIEW")),NUM=$L(GMPLVIEW("VIEW"),"/")
"RTN","GMPLMGR2",84,0)
 W !!,"CURRENT VIEW: "_$S(VIEW="S":"Inpatient, ",1:"Outpatient, ")
"RTN","GMPLMGR2",85,0)
 I '((NUM>2)!($L(GMPLVIEW("ACT")))!(GMPLVIEW("PROV"))) W "all problems" Q
"RTN","GMPLMGR2",86,0)
 W $S(GMPLVIEW("ACT")="A":"active",GMPLVIEW("ACT")="I":"inactive",1:"all")_" problems"
"RTN","GMPLMGR2",87,0)
 I NUM>2 W " from "_$S(GMPLVIEW("VIEW")=$$VIEW^GMPLX1(DUZ):"preferred",1:"selected")_$S(VIEW="S":" services",1:" clinics")
"RTN","GMPLMGR2",88,0)
 I GMPLVIEW("PROV") S NAME=$$NAME^GMPLX1(GMPLVIEW("PROV")) W:($X+$L(NAME)+4>80) ! W " by "_NAME
"RTN","GMPLMGR2",89,0)
 Q
"RTN","GMPLMGR2",90,0)
 ;
"RTN","GMPLMGR2",91,0)
ENVIEW ; Entry Action to Display Appropriate View Menu
"RTN","GMPLMGR2",92,0)
 N XQORM,X,Y,GMPLX S GMPLX=0 D SHOW S X="GMPL VIEW "_$S($E(GMPLVIEW("VIEW"))="S":"INPAT",1:"OUTPAT")
"RTN","GMPLMGR2",93,0)
 S XQORM=+$O(^ORD(101,"B",X,0))_";ORD(101,",XQORM(0)="3AD"
"RTN","GMPLMGR2",94,0)
 W !,"You may change your view of this patient's problem list by selecting one or",!,"more of the following attributes to alter:",!
"RTN","GMPLMGR2",95,0)
 D EN^XQORM F  S GMPLX=$O(Y(GMPLX)) Q:GMPLX'>0  X:$D(^ORD(101,+$P(Y(GMPLX),U,2),20)) ^(20)
"RTN","GMPLMGR2",96,0)
 Q
"RTN","GMPLMGR2",97,0)
 ;
"RTN","GMPLMGR2",98,0)
EXVIEW ; Exit Action to Rebuild List w/New View
"RTN","GMPLMGR2",99,0)
 S VALMBCK=$S(VALMCC:"",1:"R") I '$D(GMPQUIT),$G(GMPREBLD) D
"RTN","GMPLMGR2",100,0)
 . S VALMBG=1,VALMBCK="R" D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLMGR2",101,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPLMGR2",102,0)
 K GMPQUIT,GMPREBLD S VALMSG=$$MSG^GMPLX
"RTN","GMPLMGR2",103,0)
 Q
"RTN","GMPLPRNT")
0^9^B38258909
"RTN","GMPLPRNT",1,0)
GMPLPRNT ; SLC/MKB,KER,TC -- Problem List prints/displays ;11/27/12  08:25
"RTN","GMPLPRNT",2,0)
 ;;2.0;Problem List;**1,13,26,41,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLPRNT",3,0)
 ;
"RTN","GMPLPRNT",4,0)
 ; External References
"RTN","GMPLPRNT",5,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLPRNT",6,0)
 ;   ICR   5747  $$CSI/SAB^ICDEX
"RTN","GMPLPRNT",7,0)
 ;   DBIA 10090  ^DIC(4
"RTN","GMPLPRNT",8,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMPLPRNT",9,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMPLPRNT",10,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMPLPRNT",11,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMPLPRNT",12,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLPRNT",13,0)
 ;   DBIA 10061  OERR^VADPT
"RTN","GMPLPRNT",14,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLPRNT",15,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLPRNT",16,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMPLPRNT",17,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLPRNT",18,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMPLPRNT",19,0)
 ;
"RTN","GMPLPRNT",20,0)
EN ; Print/Display (Main)
"RTN","GMPLPRNT",21,0)
 N DIR,X,Y,DTOUT,DUOUT S VALMBCK=$S(VALMCC:"",1:"R") W !
"RTN","GMPLPRNT",22,0)
 I '(($L(GMPLVIEW("ACT")))!(GMPLVIEW("PROV"))!($L(GMPLVIEW("VIEW"),"/")>2)) S Y="A" G EN1
"RTN","GMPLPRNT",23,0)
 S DIR(0)="SAOM^C:CURRENT VIEW;A:ALL PROBLEMS;"
"RTN","GMPLPRNT",24,0)
 S DIR("A")="Print (C)urrently displayed problems only, or include (A)ll problems? "
"RTN","GMPLPRNT",25,0)
 S DIR("?",1)="Enter C to print a copy of your currently displayed view"
"RTN","GMPLPRNT",26,0)
 S DIR("?",2)="of this patient's list; to print a complete list of all"
"RTN","GMPLPRNT",27,0)
 S DIR("?",3)="active and inactive problems, which may be included in"
"RTN","GMPLPRNT",28,0)
 S DIR("?")="the patient's chart, select A."
"RTN","GMPLPRNT",29,0)
 D ^DIR G:$D(DTOUT)!($D(DUOUT))!(Y="") ENQ
"RTN","GMPLPRNT",30,0)
EN1 ;   Print View
"RTN","GMPLPRNT",31,0)
 W ! D @$S(Y="C":"LIST",1:"VAF")
"RTN","GMPLPRNT",32,0)
 I GMPRT'>0 W !!,"No problems found.",!,$C(7) H 1 G ENQ
"RTN","GMPLPRNT",33,0)
 D DEVICE G:$D(GMPQUIT) ENQ
"RTN","GMPLPRNT",34,0)
 D CLEAR^VALM1,PRT S VALMBCK="R"
"RTN","GMPLPRNT",35,0)
ENQ ;   Quit Print/Display
"RTN","GMPLPRNT",36,0)
 D KILL^GMPLX S VALMSG=$$MSG^GMPLX Q
"RTN","GMPLPRNT",37,0)
 ;
"RTN","GMPLPRNT",38,0)
VAF ; Build Chart Copy
"RTN","GMPLPRNT",39,0)
 N TOTAL,VIEW K GMPLCURR S (TOTAL,GMPRT)=0
"RTN","GMPLPRNT",40,0)
 Q:'$D(^AUPNPROB("AC",+GMPDFN))
"RTN","GMPLPRNT",41,0)
 S (VIEW("ACT"),VIEW("VIEW"))="",VIEW("PROV")=0
"RTN","GMPLPRNT",42,0)
 D GETPLIST^GMPLMGR1(.GMPRT,.TOTAL,.VIEW)
"RTN","GMPLPRNT",43,0)
 S GMPRT=TOTAL
"RTN","GMPLPRNT",44,0)
 Q
"RTN","GMPLPRNT",45,0)
 ;
"RTN","GMPLPRNT",46,0)
LIST ; Build Current View
"RTN","GMPLPRNT",47,0)
 S GMPLCURR=1,GMPRT=0 Q:+$G(GMPCOUNT)'>0  N I,IFN
"RTN","GMPLPRNT",48,0)
 W !,"One moment, please ..."
"RTN","GMPLPRNT",49,0)
 F I=0:0 S I=$O(^TMP("GMPLIDX",$J,I)) Q:I'>0  D
"RTN","GMPLPRNT",50,0)
 . S IFN=$P($G(^TMP("GMPLIDX",$J,I)),U,2) Q:IFN'>0
"RTN","GMPLPRNT",51,0)
 . S GMPRT=GMPRT+1,GMPRT(I)=IFN W "."
"RTN","GMPLPRNT",52,0)
 Q
"RTN","GMPLPRNT",53,0)
 ;
"RTN","GMPLPRNT",54,0)
DEVICE ; Get Device
"RTN","GMPLPRNT",55,0)
 S %ZIS="Q",%ZIS("B")="" D ^%ZIS I POP S GMPQUIT=1 G DQ
"RTN","GMPLPRNT",56,0)
 I '$D(GMPLCURR) K GMPRINT
"RTN","GMPLPRNT",57,0)
 I $D(IO("Q")) D
"RTN","GMPLPRNT",58,0)
 . S ZTRTN="PRT^GMPLPRNT",ZTDESC="PROBLEM LIST OF "_$P(GMPDFN,U,2)
"RTN","GMPLPRNT",59,0)
 . S (ZTSAVE("GMPRT"),ZTSAVE("GMPRT("),ZTSAVE("GMPDFN"),ZTSAVE("GMPVAMC"))=""
"RTN","GMPLPRNT",60,0)
 . S:$D(GMPLCURR) ZTSAVE("GMPLCURR")="" S ZTDTH=$H
"RTN","GMPLPRNT",61,0)
 . D ^%ZTLOAD,HOME^%ZIS S:$D(ZTSK) GMPQUIT=1
"RTN","GMPLPRNT",62,0)
DQ ;   Quit Device
"RTN","GMPLPRNT",63,0)
 K IO("Q"),POP,%ZIS,ZTRTN,ZTDESC,ZTSAVE,ZTSK
"RTN","GMPLPRNT",64,0)
 Q
"RTN","GMPLPRNT",65,0)
 ;
"RTN","GMPLPRNT",66,0)
HDR ; Header Code
"RTN","GMPLPRNT",67,0)
 N PAGE S PAGE="Page: "_GMPLPAGE,GMPLPAGE=GMPLPAGE+1
"RTN","GMPLPRNT",68,0)
 W $C(13),$$REPEAT^XLFSTR("-",79),!
"RTN","GMPLPRNT",69,0)
 I IOST?1"P".E W:$D(GMPLCURR) "** NOT for " W "Medical Record" W:$D(GMPLCURR) " **"
"RTN","GMPLPRNT",70,0)
 I IOST'?1"P".E W $P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLPRNT",71,0)
 W ?41,"|  " W:$D(GMPLCURR) "PARTIAL "
"RTN","GMPLPRNT",72,0)
 W "PROBLEM LIST",?(79-$L(PAGE)),PAGE,!
"RTN","GMPLPRNT",73,0)
 W $$REPEAT^XLFSTR("-",79),!
"RTN","GMPLPRNT",74,0)
 W !,"       Date",?63,"Date of   Date"
"RTN","GMPLPRNT",75,0)
 W !,"     Recorded  Problems",?64,"Onset  Resolved"
"RTN","GMPLPRNT",76,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMPLPRNT",77,0)
 Q
"RTN","GMPLPRNT",78,0)
 ;
"RTN","GMPLPRNT",79,0)
FTR ; Footer Code
"RTN","GMPLPRNT",80,0)
 N I,SITE,DFN,VA,VADM,LOC,DATE,FORM
"RTN","GMPLPRNT",81,0)
 F I=1:1:(IOSL-$Y-6) W !
"RTN","GMPLPRNT",82,0)
 S SITE=$$SITE^VASITE,SITE=$P(SITE,U,2)
"RTN","GMPLPRNT",83,0)
 S:SITE'["VAMC" SITE=SITE_" VAMC"
"RTN","GMPLPRNT",84,0)
 S DFN=+GMPDFN D OERR^VADPT
"RTN","GMPLPRNT",85,0)
 S LOC="Pt Loc: "_$S(VAIN(4)]"":$P(VAIN(4),U,2)_"  "_VAIN(5),1:"OUTPATIENT") K VAIN
"RTN","GMPLPRNT",86,0)
 I $L(LOC)>51 S LOC=$E(LOC,1,51),FORM="VAF10-141"
"RTN","GMPLPRNT",87,0)
 E  S FORM="VA FORM 10-1415"
"RTN","GMPLPRNT",88,0)
 W !,$S($D(GMPLFLAG):"$ = Requires verification by provider",1:"")
"RTN","GMPLPRNT",89,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMPLPRNT",90,0)
 W !,$P(GMPDFN,U,2),?(79-$L(SITE)\2),SITE
"RTN","GMPLPRNT",91,0)
 S DATE=$$FMTE^XLFDT($E(($$NOW^XLFDT),1,12),2)
"RTN","GMPLPRNT",92,0)
 S DATE="Printed:"_$P(DATE,"@")_" "_$P(DATE,"@",2)
"RTN","GMPLPRNT",93,0)
 W ?(79-$L(DATE)),DATE
"RTN","GMPLPRNT",94,0)
 W !,VA("PID"),?(79-$L(LOC)\2),LOC,?(79-$L(FORM)),FORM
"RTN","GMPLPRNT",95,0)
 W !,$$REPEAT^XLFSTR("-",79),@IOF
"RTN","GMPLPRNT",96,0)
 Q
"RTN","GMPLPRNT",97,0)
 ;
"RTN","GMPLPRNT",98,0)
RETURN() ; End of page
"RTN","GMPLPRNT",99,0)
 N X,Y,DIR,I F I=1:1:(IOSL-$Y-3) W !
"RTN","GMPLPRNT",100,0)
 S DIR(0)="E" D ^DIR
"RTN","GMPLPRNT",101,0)
 Q +Y
"RTN","GMPLPRNT",102,0)
 ;
"RTN","GMPLPRNT",103,0)
PRT ; Body of Problem List
"RTN","GMPLPRNT",104,0)
 U IO N I,IFN,GMPLPAGE,GMPLFLAG S GMPLPAGE=1 D HDR
"RTN","GMPLPRNT",105,0)
 F I=0:0 S I=$O(GMPRT(I)) Q:I'>0  D  Q:$D(GMPQUIT)
"RTN","GMPLPRNT",106,0)
 . S IFN=GMPRT(I) Q:IFN'>0
"RTN","GMPLPRNT",107,0)
 . D PROB(IFN,I)
"RTN","GMPLPRNT",108,0)
 D FTR:IOST?1"P".E I '$D(GMPQUIT),IOST?1"C".E S I=$$RETURN
"RTN","GMPLPRNT",109,0)
 I $D(ZTQUEUED) S ZTREQ="@" K GMPDFN,GMPLCURR,GMPQUIT,GMPRT
"RTN","GMPLPRNT",110,0)
 D ^%ZISC
"RTN","GMPLPRNT",111,0)
 Q
"RTN","GMPLPRNT",112,0)
 ;
"RTN","GMPLPRNT",113,0)
PROB(DA,NUM) ; Get Problem Text Line
"RTN","GMPLPRNT",114,0)
 N GMPL0,GMPL1,GMPL802,GMPL803,ONSET,DATE,TEXT,NOTES,J,RESOLVED,X,LINES,PROB,SCS,SP,GMPLDT,GMPLCSYS,GMPLILBL
"RTN","GMPLPRNT",115,0)
 S GMPL0=$G(^AUPNPROB(DA,0)),GMPL1=$G(^(1)),GMPL802=$G(^(802)),GMPL803=$G(^(803,0)) Q:GMPL0=""  Q:GMPL1=""
"RTN","GMPLPRNT",116,0)
 S ONSET=$P(GMPL0,U,13),DATE=$P(GMPL1,U,9),RESOLVED=$P(GMPL1,U,7)
"RTN","GMPLPRNT",117,0)
 S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLPRNT",118,0)
 S GMPLILBL=$S(GMPLCSYS="10D":"ICD-10-CM ",1:"ICD-9-CM ")
"RTN","GMPLPRNT",119,0)
 D SCS^GMPLX1(+DA,.SCS) S SP=$G(SCS(3))
"RTN","GMPLPRNT",120,0)
 I 'DATE S DATE=$P(GMPL0,U,8)
"RTN","GMPLPRNT",121,0)
 S PROB=$$PROBTEXT^GMPLX(DA)
"RTN","GMPLPRNT",122,0)
 I PROB[" (SCT"&($L($G(GMPL803))>0) D
"RTN","GMPLPRNT",123,0)
 . S PROB=PROB_" ("_GMPLILBL_$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2)
"RTN","GMPLPRNT",124,0)
 . N IEN S IEN=0 F  S IEN=$O(^AUPNPROB(DA,803,IEN)) Q:'+IEN  D
"RTN","GMPLPRNT",125,0)
 . . S PROB=PROB_"/"_$P($G(^AUPNPROB(DA,803,IEN,0)),U)
"RTN","GMPLPRNT",126,0)
 . S PROB=PROB_")"
"RTN","GMPLPRNT",127,0)
 E  I PROB[" (SCT"&($G(GMPL803)="") S PROB=PROB_" ("_GMPLILBL_$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2)_")"
"RTN","GMPLPRNT",128,0)
 I $P($G(^AUPNPROB(DA,1)),"^",14)="A" S PROB="*"_PROB
"RTN","GMPLPRNT",129,0)
 E  S PROB=" "_PROB
"RTN","GMPLPRNT",130,0)
 D WRAP^GMPLX(PROB,47,.TEXT)
"RTN","GMPLPRNT",131,0)
 D NOTES(DA) S LINES=TEXT+NOTES+1
"RTN","GMPLPRNT",132,0)
 I ($Y+LINES)>(IOSL-7) D  Q:$D(GMPQUIT)
"RTN","GMPLPRNT",133,0)
 . I IOST?1"P".E D FTR,HDR Q
"RTN","GMPLPRNT",134,0)
 . I $$RETURN W @IOF D HDR Q
"RTN","GMPLPRNT",135,0)
 . S GMPQUIT=1
"RTN","GMPLPRNT",136,0)
PR1 ; Write Problem Text Line
"RTN","GMPLPRNT",137,0)
 W !!,$E("   ",1,3-$L(NUM))_NUM_". "_$J($$EXTDT^GMPLX(DATE),8)
"RTN","GMPLPRNT",138,0)
 I $P(GMPL1,U,2)="T",$P($G(^GMPL(125.99,1,0)),U,2) W ?14,"$" S GMPLFLAG=1
"RTN","GMPLPRNT",139,0)
 W ?15,TEXT(1),?62,$J($$EXTDT^GMPLX(ONSET),8)
"RTN","GMPLPRNT",140,0)
 I $P(GMPL0,U,12)="I" W ?71,$S(RESOLVED:$J($$EXTDT^GMPLX(RESOLVED),8),1:"unknown")
"RTN","GMPLPRNT",141,0)
 I TEXT>1 F J=2:1:TEXT W !?15,TEXT(J)
"RTN","GMPLPRNT",142,0)
 Q:'NOTES  S DATE=$P(DATE,".")
"RTN","GMPLPRNT",143,0)
 F J=1:1:NOTES S X=$S(DATE'=$P(NOTES(J),U):$$EXTDT^GMPLX($P(NOTES(J),U)),1:"") W !?5,$J(X,8),?17,$P(NOTES(J),U,2) S DATE=$P(NOTES(J),U)
"RTN","GMPLPRNT",144,0)
 Q
"RTN","GMPLPRNT",145,0)
NOTES(IFN) ; Place Comments in NOTES array
"RTN","GMPLPRNT",146,0)
 N I,NOTE,DATE,TEXT,FAC,NIFN S (NOTES,I)=0
"RTN","GMPLPRNT",147,0)
 Q:'$D(^AUPNPROB(IFN,11))
"RTN","GMPLPRNT",148,0)
 S FAC=$O(^AUPNPROB(IFN,11,"B",+GMPVAMC,0)) Q:FAC'>0
"RTN","GMPLPRNT",149,0)
 F NIFN=0:0 S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,"B",NIFN)) Q:NIFN'>0  D
"RTN","GMPLPRNT",150,0)
 . S NOTE=$G(^AUPNPROB(IFN,11,FAC,11,NIFN,0)) Q:NOTE=""
"RTN","GMPLPRNT",151,0)
 . S DATE=$P(NOTE,U,5),TEXT=$P(NOTE,U,3),I=I+1
"RTN","GMPLPRNT",152,0)
 . S NOTES(I)=$P(DATE,".")_U_TEXT
"RTN","GMPLPRNT",153,0)
 S NOTES=I
"RTN","GMPLPRNT",154,0)
 Q
"RTN","GMPLSAVE")
0^10^B110665367
"RTN","GMPLSAVE",1,0)
GMPLSAVE ; ISL/MKB,KER,JER,TC -- Save Problem List data ;06/05/14  08:42
"RTN","GMPLSAVE",2,0)
 ;;2.0;Problem List;**26,31,35,37,38,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLSAVE",3,0)
 ;
"RTN","GMPLSAVE",4,0)
 ; External References
"RTN","GMPLSAVE",5,0)
 ;   ICR #5747   $$CSI^ICDEX,$$SAB^ICDEX,$$CODECS^ICDEX
"RTN","GMPLSAVE",6,0)
 ;   ICR #5009   $$GETDES^LEXTRAN1
"RTN","GMPLSAVE",7,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLSAVE",8,0)
 ;   DBIA 10013  ^DIK
"RTN","GMPLSAVE",9,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMPLSAVE",10,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLSAVE",11,0)
 ;
"RTN","GMPLSAVE",12,0)
EN ; Save Changes made to Existing Problem
"RTN","GMPLSAVE",13,0)
 N FLD,NOW,CHNGE,I,NIFN,TEXT,OLDTEXT,FAC,NODE,AUDITED,DR,DA,DIE,DIK,GMPICD,GMPBULL
"RTN","GMPLSAVE",14,0)
 S:'GMPORIG(.01) GMPORIG(.01)=$$NOS^GMPLX(+GMPORIG(80202),+GMPORIG(80201))
"RTN","GMPLSAVE",15,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201))
"RTN","GMPLSAVE",16,0)
 S GMPICD=$P($G(GMPFLD(.01)),U,2)
"RTN","GMPLSAVE",17,0)
 S:$D(GMPFLD(.01)) GMPFLD(.01)=+GMPFLD(.01)
"RTN","GMPLSAVE",18,0)
 S:$P(GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201)) ;chk for error from ICD
"RTN","GMPLSAVE",19,0)
 S:$G(GMPFLD(80201))']"" GMPFLD(80201)=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPLSAVE",20,0)
 S:$G(GMPFLD(80202))']"" GMPFLD(80202)=$$SAB^ICDEX($$CSI^ICDEX(80,+GMPFLD(.01)),DT)_U_$P($$CODECS^ICDEX(GMPICD,80,DT),U,2)
"RTN","GMPLSAVE",21,0)
 S:'GMPORIG(1.01) GMPORIG(1.01)="1^Unresolved"
"RTN","GMPLSAVE",22,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",23,0)
 I $G(GMPFLD(1.01))["SNOMED CT" D
"RTN","GMPLSAVE",24,0)
 . N SCTS,SCTC,SCTD,SCTT
"RTN","GMPLSAVE",25,0)
 . S SCTS=GMPFLD(1.01)
"RTN","GMPLSAVE",26,0)
 . S SCTT=$P($P(SCTS," (SNOMED CT "),U,2)
"RTN","GMPLSAVE",27,0)
 . S SCTC=$P($P(SCTS,"SNOMED CT ",2),")"),GMPFLD(80001)=SCTC_U_SCTC
"RTN","GMPLSAVE",28,0)
 . S SCTD=$$GETDES^LEXTRAN1("SCT",SCTT)
"RTN","GMPLSAVE",29,0)
 . I +SCTD=1 S SCTD=$P(SCTD,U,2),GMPFLD(80002)=SCTD_U_SCTD
"RTN","GMPLSAVE",30,0)
 . I (+$G(GMPFLD(.01))=+$$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201))) S GMPFLD(80005)="1^PENDING"
"RTN","GMPLSAVE",31,0)
 I $G(GMPFLD(1.01))["VHAT" D
"RTN","GMPLSAVE",32,0)
 . N VHATC,VHATD,VHATS,VHATT
"RTN","GMPLSAVE",33,0)
 . S VHATS=GMPFLD(1.01)
"RTN","GMPLSAVE",34,0)
 . S VHATT=$P($P(VHATS," (VHAT "),U,2)
"RTN","GMPLSAVE",35,0)
 . S VHATC=$P($P(VHATS,"VHAT ",2),")")
"RTN","GMPLSAVE",36,0)
 . S GMPFLD(80003)=VHATC_U_VHATC
"RTN","GMPLSAVE",37,0)
 . S VHATD=$$GETDES^LEXTRAN1("VHAT",VHATT)
"RTN","GMPLSAVE",38,0)
 . I +VHATD=1 S VHATD=$P(VHATD,U,2),GMPFLD(80004)=VHATD_U_VHATD
"RTN","GMPLSAVE",39,0)
 S:'GMPFLD(.05) I=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(I,+GMPFLD(1.01))
"RTN","GMPLSAVE",40,0)
 S NOW=$$HTFM^XLFDT($H),AUDITED=0
"RTN","GMPLSAVE",41,0)
 S DR="1.02////"_$S('$D(GMPLUSER):"T",1:GMPFLD(1.02))
"RTN","GMPLSAVE",42,0)
 I GMPORIG(1.02)="T",GMPFLD(1.02)="P" D
"RTN","GMPLSAVE",43,0)
 . S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ
"RTN","GMPLSAVE",44,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",45,0)
 I $P($G(GMPORIG(.12)),U)="I",$P(GMPFLD(.12),U)="A" D REACTV S AUDITED=1
"RTN","GMPLSAVE",46,0)
 I +$G(GMPORIG(1.01))'=(+GMPFLD(1.01)) D REFORM S AUDITED=1
"RTN","GMPLSAVE",47,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",48,0)
 I (+$G(GMPFLD(.01))'=+$$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201))),($G(GMPROV)=.5) S GMPFLD(80005)="2^COMPLETED"
"RTN","GMPLSAVE",49,0)
 F FLD=.01,.05,.12,.13,1.01,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,80001,80002,80003,80004,80005,80201,80202 D
"RTN","GMPLSAVE",50,0)
 . Q:'$D(GMPFLD(FLD))  Q:$P($G(GMPORIG(FLD)),U)=$P($G(GMPFLD(FLD)),U)
"RTN","GMPLSAVE",51,0)
 . S DR=DR_";"_FLD_"////"_$S($P(GMPFLD(FLD),U)'="":$P(GMPFLD(FLD),U),1:"@")
"RTN","GMPLSAVE",52,0)
 . Q:AUDITED&((FLD=.12)!(FLD=1.01))  S CHNGE=GMPIFN_U_FLD_U_NOW_U_DUZ_U_$P(GMPORIG(FLD),U)_U_$P(GMPFLD(FLD),U)_"^^"_+$G(GMPROV)
"RTN","GMPLSAVE",53,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",54,0)
 S DA=GMPIFN,DIE="^AUPNPROB(" D ^DIE S GMPSAVED=1
"RTN","GMPLSAVE",55,0)
 D COEXPRS(GMPIFN,GMPICD)
"RTN","GMPLSAVE",56,0)
 I (GMPICD=$P($$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201)),U,2)),(+$P($G(GMPFLD(80001)),U)>0) D NTRTBULL(.GMPBULL,$P(GMPFLD(1.01),U,2),$P($G(GMPFLD(80001)),U,2),$G(GMPSRCH))
"RTN","GMPLSAVE",57,0)
NOTES ; Save Changes to Notes
"RTN","GMPLSAVE",58,0)
 F I=0:0 S I=$O(GMPORIG(10,I)) Q:I'>0  I GMPORIG(10,I)'=GMPFLD(10,I) D
"RTN","GMPLSAVE",59,0)
 . S NIFN=+GMPFLD(10,I),FAC=$P(GMPFLD(10,I),U,2),TEXT=$P(GMPFLD(10,I),U,3),OLDTEXT=$P(GMPORIG(10,I),U,3)
"RTN","GMPLSAVE",60,0)
 . S NODE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0))
"RTN","GMPLSAVE",61,0)
 . I TEXT'="" S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,3)=TEXT D
"RTN","GMPLSAVE",62,0)
 .. I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",63,0)
 .. S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^C^^Note Modified^"_+$G(GMPROV)
"RTN","GMPLSAVE",64,0)
 . I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",65,0)
 . I TEXT="" S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^A^^Deleted Note^"_+$G(GMPROV)
"RTN","GMPLSAVE",66,0)
 . D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",67,0)
 . I TEXT="" D
"RTN","GMPLSAVE",68,0)
 .. S DIK="^AUPNPROB("_GMPIFN_",11,"_FAC_",11,"
"RTN","GMPLSAVE",69,0)
 .. S DA(2)=GMPIFN,DA(1)=FAC,DA=NIFN D ^DIK
"RTN","GMPLSAVE",70,0)
 I $D(GMPFLD(10,"NEW"))>9 D NEWNOTE
"RTN","GMPLSAVE",71,0)
EXIT ; Quit Saving Changes
"RTN","GMPLSAVE",72,0)
 D:$G(GMPSAVED) DTMOD^GMPLX(GMPIFN)
"RTN","GMPLSAVE",73,0)
 Q
"RTN","GMPLSAVE",74,0)
 ;
"RTN","GMPLSAVE",75,0)
REFORM ; Audit Entry that has been Reformulated
"RTN","GMPLSAVE",76,0)
 S CHNGE=GMPIFN_"^1.01^"_NOW_U_DUZ_U_+GMPORIG(1.01)_U_+GMPFLD(1.01)_"^Reformulated^"_+$G(GMPROV)
"RTN","GMPLSAVE",77,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",78,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",79,0)
 Q
"RTN","GMPLSAVE",80,0)
 ;
"RTN","GMPLSAVE",81,0)
REACTV ; Audit Entry that has been Reactivated
"RTN","GMPLSAVE",82,0)
 S CHNGE=GMPIFN_"^.12^"_NOW_U_DUZ_"^I^A^Reactivated^"_+$G(GMPROV)
"RTN","GMPLSAVE",83,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",84,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",85,0)
 Q
"RTN","GMPLSAVE",86,0)
 ;
"RTN","GMPLSAVE",87,0)
NEW ; Save Collected Values in new Problem Entry
"RTN","GMPLSAVE",88,0)
 ;   Output   DA (left defined)
"RTN","GMPLSAVE",89,0)
 N DATA,APCDLOOK,APCDALVR,NUM,I,DIK,GMPICD,GMPIFN,X,CSID,CSAB,CSDT
"RTN","GMPLSAVE",90,0)
 S CSDT=$S($P($G(GMPFLD(80201)),U)]"":$P($G(GMPFLD(80201)),U),1:DT)
"RTN","GMPLSAVE",91,0)
 S CSID=$S(+$G(GMPFLD(.01))>0:$$CSI^ICDEX(80,+$G(GMPFLD(.01))),1:$$CS^ICDEX(80,"E",CSDT))
"RTN","GMPLSAVE",92,0)
 S CSAB=$S($P($G(GMPFLD(80202)),U)]"":$P($G(GMPFLD(80202)),U),1:$$SAB^ICDEX(CSID,CSDT))
"RTN","GMPLSAVE",93,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX(CSAB,CSDT)
"RTN","GMPLSAVE",94,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX(CSAB,CSDT) ;chk for error from ICD
"RTN","GMPLSAVE",95,0)
 S GMPICD=$S($P($G(GMPFLD(.01)),U,2)]"":$P($G(GMPFLD(.01)),U,2),1:$$CODEC^ICDEX(80,$P($G(GMPFLD(.01)),U)))
"RTN","GMPLSAVE",96,0)
 S:$G(GMPFLD(80201))']"" GMPFLD(80201)=CSDT_U_$$EXTDT^GMPLX(CSDT)
"RTN","GMPLSAVE",97,0)
 S:$G(GMPFLD(80202))']"" GMPFLD(80202)=CSAB_U_$P($$CODECS^ICDEX($P(GMPICD,"/"),80,CSDT),U,2)
"RTN","GMPLSAVE",98,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",99,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",100,0)
 S:'GMPFLD(.05) X=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(X,+GMPFLD(1.01))
"RTN","GMPLSAVE",101,0)
 S:$G(GMPFLD(1.09))']"" GMPFLD(1.09)=$$DT^XLFDT
"RTN","GMPLSAVE",102,0)
 I $G(GMPFLD(1.01))["SNOMED CT" D
"RTN","GMPLSAVE",103,0)
 . N SCTC,SCTD,SCTS,SCTT
"RTN","GMPLSAVE",104,0)
 . S SCTS=GMPFLD(1.01)
"RTN","GMPLSAVE",105,0)
 . S SCTT=$P($P(SCTS," (SNOMED CT "),U,2)
"RTN","GMPLSAVE",106,0)
 . S SCTC=$P($P(SCTS,"SNOMED CT ",2),")")
"RTN","GMPLSAVE",107,0)
 . S GMPFLD(80001)=SCTC_U_SCTC
"RTN","GMPLSAVE",108,0)
 . S SCTD=$$GETDES^LEXTRAN1("SCT",SCTT)
"RTN","GMPLSAVE",109,0)
 . I +SCTD=1 S SCTD=$P(SCTD,U,2),GMPFLD(80002)=SCTD_U_SCTD
"RTN","GMPLSAVE",110,0)
 I $G(GMPFLD(1.01))["VHAT" D
"RTN","GMPLSAVE",111,0)
 . N VHATC,VHATD,VHATS,VHATT
"RTN","GMPLSAVE",112,0)
 . S VHATS=GMPFLD(1.01)
"RTN","GMPLSAVE",113,0)
 . S VHATT=$P($P(VHATS," (VHAT "),U,2)
"RTN","GMPLSAVE",114,0)
 . S VHATC=$P($P(VHATS,"VHAT ",2),")")
"RTN","GMPLSAVE",115,0)
 . S GMPFLD(80003)=VHATC_U_VHATC
"RTN","GMPLSAVE",116,0)
 . S VHATD=$$GETDES^LEXTRAN1("VHAT",VHATT)
"RTN","GMPLSAVE",117,0)
 . I +VHATD=1 S VHATD=$P(VHATD,U,2),GMPFLD(80004)=VHATD_U_VHATD
"RTN","GMPLSAVE",118,0)
 S DA=$$NEWPROB(+GMPFLD(.01),+GMPDFN) Q:DA'>0
"RTN","GMPLSAVE",119,0)
 S NUM=$$NEXTNMBR(+GMPDFN,+GMPVAMC),GMPSAVED=1 S:'NUM NUM=""
"RTN","GMPLSAVE",120,0)
 ;   Set Node 0
"RTN","GMPLSAVE",121,0)
 S DATA=^AUPNPROB(DA,0)_U_DT_"^^"_$P(GMPFLD(.05),U)_U_+GMPVAMC_U_+NUM_U_DT_"^^^^"_$P(GMPFLD(.12),U)_U_$P(GMPFLD(.13),U)
"RTN","GMPLSAVE",122,0)
 S ^AUPNPROB(DA,0)=DATA
"RTN","GMPLSAVE",123,0)
 ;   Set Node 1
"RTN","GMPLSAVE",124,0)
 S DATA=$P(GMPFLD(1.01),U) F I=1.02:.01:1.18 S DATA=DATA_U_$S($P($G(GMPFLD(+I)),U)="@":"",1:$P($G(GMPFLD(+I)),U))
"RTN","GMPLSAVE",125,0)
 S ^AUPNPROB(DA,1)=DATA
"RTN","GMPLSAVE",126,0)
 ;   Set Node 800
"RTN","GMPLSAVE",127,0)
 I $S($L($P($G(GMPFLD(80001)),U)):1,$L($P($G(GMPFLD(80003)),U)):1,$L($P($G(GMPFLD(80004)),U)):1,$L($P($G(GMPFLD(80005)),U)):1,1:0) D
"RTN","GMPLSAVE",128,0)
 . I $P($G(GMPFLD(.01)),U)=$P($$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201)),U) S GMPFLD(80005)="1^PENDING"
"RTN","GMPLSAVE",129,0)
 . S DATA=$P($G(GMPFLD(80001)),U)_U_$P($G(GMPFLD(80002)),U)_U_$P($G(GMPFLD(80003)),U)_U_$P($G(GMPFLD(80004)),U)_U_$P($G(GMPFLD(80005)),U)
"RTN","GMPLSAVE",130,0)
 . S ^AUPNPROB(DA,800)=DATA
"RTN","GMPLSAVE",131,0)
 ;   Set Node 801
"RTN","GMPLSAVE",132,0)
 I $S($L($P($G(GMPFLD(80101)),U)):1,$L($P($G(GMPFLD(80102)),U)):1,1:0) D
"RTN","GMPLSAVE",133,0)
 . S DATA=$P($G(GMPFLD(80101)),U)_U_$P($G(GMPFLD(80102)),U)
"RTN","GMPLSAVE",134,0)
 . S ^AUPNPROB(DA,801)=DATA
"RTN","GMPLSAVE",135,0)
 ;   Set Node 802
"RTN","GMPLSAVE",136,0)
 I $S($L($P($G(GMPFLD(80201)),U)):1,$L($P($G(GMPFLD(80202)),U)):1,1:0) D
"RTN","GMPLSAVE",137,0)
 . S DATA=$P($G(GMPFLD(80201)),U)_U_$P($G(GMPFLD(80202)),U)
"RTN","GMPLSAVE",138,0)
 . S ^AUPNPROB(DA,802)=DATA
"RTN","GMPLSAVE",139,0)
 ;   Handle multiple ICDs
"RTN","GMPLSAVE",140,0)
 D COEXPRS(DA,GMPICD)
"RTN","GMPLSAVE",141,0)
 ;   Set X-Refs
"RTN","GMPLSAVE",142,0)
 S DIK="^AUPNPROB(",(APCDLOOK,APCDALVR)=1 D IX1^DIK
"RTN","GMPLSAVE",143,0)
 I $D(GMPFLD(10,"NEW"))>9 S GMPIFN=DA D NEWNOTE
"RTN","GMPLSAVE",144,0)
 I (GMPICD=$P($$NOS^GMPLX(+GMPFLD(80202),+GMPFLD(80201)),U,2)),(+$P($G(GMPFLD(80001)),U)>0) D NTRTBULL(.GMPBULL,$P(GMPFLD(1.01),U,2),$P($G(GMPFLD(80001)),U,2),$G(GMPSRCH))
"RTN","GMPLSAVE",145,0)
 ; broadcast event
"RTN","GMPLSAVE",146,0)
 N DFN S GMPIFN=DA,DFN=+GMPDFN
"RTN","GMPLSAVE",147,0)
 S X=+$O(^ORD(101,"B","GMPL EVENT",0))_";ORD(101," D:X EN1^XQOR
"RTN","GMPLSAVE",148,0)
 Q
"RTN","GMPLSAVE",149,0)
 ;
"RTN","GMPLSAVE",150,0)
NEWPROB(ICD,DFN) ; Creates New Problem Entry in file #9000011
"RTN","GMPLSAVE",151,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLSAVE",152,0)
 L +^AUPNPROB(0):1 I '$T D  Q -1
"RTN","GMPLSAVE",153,0)
 . W !!,"Someone else is currently editing this file."
"RTN","GMPLSAVE",154,0)
 . W !,"Please try again later.",!
"RTN","GMPLSAVE",155,0)
 S HDR=$G(^AUPNPROB(0)) Q:HDR="" -1
"RTN","GMPLSAVE",156,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",157,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(I,0))
"RTN","GMPLSAVE",158,0)
 S DA=I,^AUPNPROB(DA,0)=ICD_U_DFN
"RTN","GMPLSAVE",159,0)
 S ^AUPNPROB("B",ICD,DA)="",^AUPNPROB("AC",DFN,DA)=""
"RTN","GMPLSAVE",160,0)
 S $P(^AUPNPROB(0),U,3,4)=DA_U_(TOTAL+1) L -^AUPNPROB(0)
"RTN","GMPLSAVE",161,0)
 Q DA
"RTN","GMPLSAVE",162,0)
 ;
"RTN","GMPLSAVE",163,0)
NEWNOTE ; Creates New Note Entries for Problem
"RTN","GMPLSAVE",164,0)
 ;   Requires GMPIFN   Pointer to Problem
"RTN","GMPLSAVE",165,0)
 ;            GMPROV   Current Provider
"RTN","GMPLSAVE",166,0)
 ;            GMPVAMC  Facility
"RTN","GMPLSAVE",167,0)
 N HDR,LAST,TOTAL,I,FAC,NIFN
"RTN","GMPLSAVE",168,0)
 L +^AUPNPROB(GMPIFN,11):1 I '$T Q
"RTN","GMPLSAVE",169,0)
 S FAC=+$O(^AUPNPROB(GMPIFN,11,"B",GMPVAMC,0)) I 'FAC D
"RTN","GMPLSAVE",170,0)
 . S:'$D(^AUPNPROB(GMPIFN,11,0)) ^(0)="^9000011.11PA^^"
"RTN","GMPLSAVE",171,0)
 . S HDR=^AUPNPROB(GMPIFN,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",172,0)
 . F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,I,0))
"RTN","GMPLSAVE",173,0)
 . S ^AUPNPROB(GMPIFN,11,I,0)=GMPVAMC,^AUPNPROB(GMPIFN,11,"B",GMPVAMC,I)=""
"RTN","GMPLSAVE",174,0)
 . S FAC=I,$P(^AUPNPROB(GMPIFN,11,0),U,3,4)=FAC_U_(TOTAL+1)
"RTN","GMPLSAVE",175,0)
 I FAC'>0 G NNQ
"RTN","GMPLSAVE",176,0)
NN1 ; Get New Note
"RTN","GMPLSAVE",177,0)
 S:'$D(^AUPNPROB(GMPIFN,11,FAC,11,0)) ^(0)="^9000011.1111IA^^"
"RTN","GMPLSAVE",178,0)
 S HDR=^AUPNPROB(GMPIFN,11,FAC,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",179,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,FAC,11,I,0))
"RTN","GMPLSAVE",180,0)
 S NIFN=I
"RTN","GMPLSAVE",181,0)
 F I=0:0 S I=$O(GMPFLD(10,"NEW",I)) Q:I'>0  D
"RTN","GMPLSAVE",182,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)=NIFN_"^^"_GMPFLD(10,"NEW",I)_"^A^"_DT_U_+$G(GMPROV)
"RTN","GMPLSAVE",183,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,"B",NIFN,NIFN)=""
"RTN","GMPLSAVE",184,0)
 . S TOTAL=TOTAL+1,LAST=NIFN,NIFN=NIFN+1
"RTN","GMPLSAVE",185,0)
 S $P(^AUPNPROB(GMPIFN,11,FAC,11,0),U,3,4)=LAST_U_TOTAL
"RTN","GMPLSAVE",186,0)
NNQ ; Quit Getting New Notes
"RTN","GMPLSAVE",187,0)
 L -^AUPNPROB(GMPIFN,11)
"RTN","GMPLSAVE",188,0)
 Q
"RTN","GMPLSAVE",189,0)
 ;
"RTN","GMPLSAVE",190,0)
NEXTNMBR(DFN,VAMC) ; Returns Next Available Problem Number
"RTN","GMPLSAVE",191,0)
 N I,J,NUM S NUM=1,I="" I '$D(^AUPNPROB("AA",DFN,VAMC)) Q NUM
"RTN","GMPLSAVE",192,0)
 F  S I=$O(^AUPNPROB("AA",DFN,VAMC,I)) Q:I=""  S J=$E(I,2,999),NUM=+J
"RTN","GMPLSAVE",193,0)
 S NUM=NUM+1
"RTN","GMPLSAVE",194,0)
 Q NUM
"RTN","GMPLSAVE",195,0)
NTRTBULL(GMPY,GMPTERM,GMPSCT,GMPSRCH) ; Send NTRT Request bulletin to NTRT mailgroup
"RTN","GMPLSAVE",196,0)
 N GMPSITE,GMPSVC,GMPUSER,GMPWRAP,XMBNM,XMDUZ,XMY,XMB,XMZ S GMPSITE=$$SITE^VASITE
"RTN","GMPLSAVE",197,0)
 I '$L(GMPTERM) S GMPY="0^Empty String - a valid term must be sent." Q
"RTN","GMPLSAVE",198,0)
 I '+$G(DUZ)!'$D(^VA(200,+$G(DUZ))) S GMPY="0^A valid user must be identified." Q
"RTN","GMPLSAVE",199,0)
 I '+$G(GMPSCT) S GMPSCT="N/A"
"RTN","GMPLSAVE",200,0)
 D USERINFO^XUSRB2(.GMPUSER) S GMPSVC=$G(GMPUSER(5))
"RTN","GMPLSAVE",201,0)
 S XMB="GMPL PROBLEM NTRT BULLETIN"
"RTN","GMPLSAVE",202,0)
 S XMDUZ="GMPL PROBLEM NTRT BULLETIN"
"RTN","GMPLSAVE",203,0)
 S XMY("G.PROBLEM LIST NTRT@domain.ext")=""
"RTN","GMPLSAVE",204,0)
 S GMPWRAP=$$WRAP^GMPLX1(GMPTERM,53)
"RTN","GMPLSAVE",205,0)
 S XMB(1)=GMPTERM
"RTN","GMPLSAVE",206,0)
 S XMB(2)=GMPSCT
"RTN","GMPLSAVE",207,0)
 S XMB(3)=$$GET1^DIQ(200,DUZ_",",.01)
"RTN","GMPLSAVE",208,0)
 S XMB(4)=$$FMTE^XLFDT($E(($$NOW^XLFDT),1,12),2)
"RTN","GMPLSAVE",209,0)
 S XMB(5)=GMPSVC
"RTN","GMPLSAVE",210,0)
 S XMB(6)=$P(GMPSITE,U,2)_" ("_$P(GMPSITE,U,3)_")"
"RTN","GMPLSAVE",211,0)
 S XMB(7)=$G(GMPSRCH)
"RTN","GMPLSAVE",212,0)
 D ^XMB,KILL^XM S GMPY=1
"RTN","GMPLSAVE",213,0)
 Q
"RTN","GMPLSAVE",214,0)
COEXPRS(GMPDA,GMPICD) ; File multiple ICDs
"RTN","GMPLSAVE",215,0)
 N GMPC,GMPI,GMPN,GMPORIG,NOW,GMPOCNT,GMPNCNT,CODSYS S NOW=$$NOW^XLFDT
"RTN","GMPLSAVE",216,0)
 ; Initialize CODSYS to "ICD" when ICD-10-CM is implemented, new codes will get "10D"
"RTN","GMPLSAVE",217,0)
 S CODSYS=$$SAB^ICDEX(+$$CODECS^ICDEX($P(GMPICD,"/"),80,DT),DT)
"RTN","GMPLSAVE",218,0)
 ; Merge previous entries into local GMPORIG array
"RTN","GMPLSAVE",219,0)
 I $D(^AUPNPROB(GMPDA,803)) M GMPORIG=^AUPNPROB(GMPDA,803)
"RTN","GMPLSAVE",220,0)
 ; If not sparce ICD string, remove previous entries & initialize sub-file root
"RTN","GMPLSAVE",221,0)
 I '$$SPRCICD(GMPICD) K ^AUPNPROB(GMPDA,803) S ^AUPNPROB(GMPDA,803,0)="^9000011.803PA^^"
"RTN","GMPLSAVE",222,0)
 ; Update sub-file
"RTN","GMPLSAVE",223,0)
 S GMPC=0,GMPN=$L(GMPICD,"/")
"RTN","GMPLSAVE",224,0)
 F GMPI=2:1:GMPN D
"RTN","GMPLSAVE",225,0)
 . N GMPCODE,GMPDA1,GMPD30,GMPNOS S GMPNOS=$$NOS^GMPLX(CODSYS)
"RTN","GMPLSAVE",226,0)
 . S GMPDA1=GMPI-1,GMPC=GMPC+1,GMPCODE=$P(GMPICD,"/",GMPI) Q:(GMPCODE="")
"RTN","GMPLSAVE",227,0)
 . S GMPD30=$G(^AUPNPROB(GMPDA,803,GMPDA1,0))
"RTN","GMPLSAVE",228,0)
 . I (GMPCODE=$P(GMPNOS,U,2)),($P(GMPD30,U)]""),($P(GMPD30,U)'=$P(GMPNOS,U,2)) Q
"RTN","GMPLSAVE",229,0)
 . S ^AUPNPROB(GMPDA,803,GMPDA1,0)=GMPCODE_U_CODSYS_U_DT,^AUPNPROB(GMPDA,803,"B",GMPCODE,GMPDA1)=""
"RTN","GMPLSAVE",230,0)
 . S $P(^AUPNPROB(GMPDA,803,0),U,3,4)=GMPDA1_U_GMPC
"RTN","GMPLSAVE",231,0)
 I '$D(GMPORIG) Q
"RTN","GMPLSAVE",232,0)
 S GMPOCNT=+$P($G(GMPORIG(0)),U,4),GMPNCNT=+$P($G(^AUPNPROB(GMPDA,803,0)),U,4)
"RTN","GMPLSAVE",233,0)
 ; Iterate through GMPORIG and audit changes
"RTN","GMPLSAVE",234,0)
 S GMPI=0 F  S GMPI=$O(GMPORIG(GMPI)) Q:+GMPI'>0  D
"RTN","GMPLSAVE",235,0)
 . N CHANGE,OLD0,NEW0
"RTN","GMPLSAVE",236,0)
 . S OLD0=$G(GMPORIG(GMPI,0)),NEW0=$G(^AUPNPROB(GMPDA,803,GMPI,0))
"RTN","GMPLSAVE",237,0)
 . I $P(NEW0,U)=$P(OLD0,U) Q  ; no substantive change change
"RTN","GMPLSAVE",238,0)
 . I NEW0'="" S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_$P(OLD0,U)_U_$P(NEW0,U)_"^SNOMED CT Concept re-mapped by Enterprise Terminology Service^"_+$G(GMPROV)
"RTN","GMPLSAVE",239,0)
 . E  S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_$P(OLD0,U)_U_"^Deleted Secondary Dx for SNOMED CT Concept^"_+$G(GMPROV)
"RTN","GMPLSAVE",240,0)
 . D AUDIT^GMPLX(CHANGE,OLD0)
"RTN","GMPLSAVE",241,0)
 I GMPNCNT>GMPOCNT D
"RTN","GMPLSAVE",242,0)
 . S GMPI=GMPOCNT
"RTN","GMPLSAVE",243,0)
 . F  S GMPI=$O(^AUPNPROB(GMPDA,803,GMPI)) Q:+GMPI'>0  D
"RTN","GMPLSAVE",244,0)
 . . N NEW0,CHANGE S NEW0=$G(^AUPNPROB(GMPDA,803,GMPI,0))
"RTN","GMPLSAVE",245,0)
 . . S CHANGE=GMPDA_"^302^"_NOW_U_DUZ_U_U_$P(NEW0,U)_"^Added as Secondary Dx for SNOMED CT Concept^"_+$G(GMPROV)
"RTN","GMPLSAVE",246,0)
 . . D AUDIT^GMPLX(CHANGE,"")
"RTN","GMPLSAVE",247,0)
 Q
"RTN","GMPLSAVE",248,0)
SPRCICD(GMPICD) ; Is ICD string sparce (i.e., called from SDS API w/order > 2)?
"RTN","GMPLSAVE",249,0)
 N GMPI,GMPY S GMPY=0
"RTN","GMPLSAVE",250,0)
 F GMPI=2:1:$L(GMPICD,"/") I $S($P(GMPICD,"/",GMPI)="":1,$P(GMPICD,"/",GMPI)=$P($$NOS^GMPLX,U,2):1,1:0) S GMPY=1
"RTN","GMPLSAVE",251,0)
 Q GMPY
"RTN","GMPLUTL")
0^12^B62326591
"RTN","GMPLUTL",1,0)
GMPLUTL ; SLC/MKB/KER/TC -- PL Utilities ;06/05/14  08:45
"RTN","GMPLUTL",2,0)
 ;;2.0;Problem List;**3,6,8,10,16,26,35,39,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLUTL",3,0)
 ;
"RTN","GMPLUTL",4,0)
 ; External References
"RTN","GMPLUTL",5,0)
 ;   DBIA    348  ^DPT(
"RTN","GMPLUTL",6,0)
 ;    ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL",7,0)
 ;   DBIA  10006  ^VA(200
"RTN","GMPLUTL",8,0)
 ;
"RTN","GMPLUTL",9,0)
ACTIVE(GMPDFN,GMPL) ; Returns list of Active Problems for a Patient
"RTN","GMPLUTL",10,0)
 ;
"RTN","GMPLUTL",11,0)
 ;   GMPDFN   Pointer to Patient
"RTN","GMPLUTL",12,0)
 ;   GMPL     Array in which the problems will be
"RTN","GMPLUTL",13,0)
 ;            returned, passed by reference
"RTN","GMPLUTL",14,0)
 ;
"RTN","GMPLUTL",15,0)
 ;   GMPL(#,0)  Problem file (#9000011) IEN
"RTN","GMPLUTL",16,0)
 ;   GMPL(#,1)  Piece 1:  Pointer to Problem (Lexicon file #757.01)
"RTN","GMPLUTL",17,0)
 ;                    2:  Provider Narrative
"RTN","GMPLUTL",18,0)
 ;                 NOTE:  the provider narrative may be different
"RTN","GMPLUTL",19,0)
 ;                        from the Lexicon term in file 757.01
"RTN","GMPLUTL",20,0)
 ;   GMPL(#,2)  Piece 1:  Pointer to ICD Diagnosis (file #80)
"RTN","GMPLUTL",21,0)
 ;                    2:  ICD-9/10 Code
"RTN","GMPLUTL",22,0)
 ;   GMPL(#,3)  Piece 1:  Internal Date of Onset
"RTN","GMPLUTL",23,0)
 ;                    2:  External Date of Onset 00/00/00
"RTN","GMPLUTL",24,0)
 ;   GMPL(#,4)  Piece 1:  Abbreviated Service Connection
"RTN","GMPLUTL",25,0)
 ;                            SC^Service Connected
"RTN","GMPLUTL",26,0)
 ;                            NSC^Not Service Connected
"RTN","GMPLUTL",27,0)
 ;                            null
"RTN","GMPLUTL",28,0)
 ;                    2:  Full text Service Connection
"RTN","GMPLUTL",29,0)
 ;   GMPL(#,5)  Piece 1:  Abbreviated Exposure
"RTN","GMPLUTL",30,0)
 ;                        Full text Exposure
"RTN","GMPLUTL",31,0)
 ;                            AO^Agent Orange
"RTN","GMPLUTL",32,0)
 ;                            IR^Radiation
"RTN","GMPLUTL",33,0)
 ;                            EC^Evn Contaminants
"RTN","GMPLUTL",34,0)
 ;                            HNC^Head/Neck Cancer
"RTN","GMPLUTL",35,0)
 ;                            MST^Mil Sexual Trauma
"RTN","GMPLUTL",36,0)
 ;                            CV^Combat Vet
"RTN","GMPLUTL",37,0)
 ;                            SHD^SHAD
"RTN","GMPLUTL",38,0)
 ;                            null
"RTN","GMPLUTL",39,0)
 ;
"RTN","GMPLUTL",40,0)
 N IFN,CNT,SP,NUM,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL",41,0)
 Q:$G(GMPDFN)'>0  S CNT=0,SP=""
"RTN","GMPLUTL",42,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL",43,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL",44,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL",45,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL",46,0)
 . N I,GMPL0,GMPL1,GMPL802,ICDC,GMPCSYS,GMPDT,ONSET
"RTN","GMPLUTL",47,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL",48,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL802=$G(^(802)),CNT=CNT+1,GMPL(CNT,0)=IFN
"RTN","GMPLUTL",49,0)
 . S GMPDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPDT))
"RTN","GMPLUTL",50,0)
 . S ICDC=$P($$ICDDATA^ICDXCODE(GMPCSYS,+GMPL0,GMPDT,"I"),U,2)
"RTN","GMPLUTL",51,0)
 . S GMPL(CNT,1)=+GMPL1_U_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL",52,0)
 . S GMPL(CNT,2)=+GMPL0_U_ICDC,ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL",53,0)
 . S GMPL(CNT,3)=$S(ONSET:ONSET_U_$$EXTDT^GMPLX(ONSET),1:"")
"RTN","GMPLUTL",54,0)
 . S GMPL(CNT,4)=$S(+$P(GMPL1,U,10):"SC^SERVICE-CONNECTED",$P(GMPL1,U,10)=0:"NSC^NOT SERVICE-CONNECTED",1:"")
"RTN","GMPLUTL",55,0)
 . F I=11,12,13,15,16,17,18 S:$P(GMPL1,U,I) SP=$S(I=11:"A",I=12:"I",I=13:"P",I=15:"H",I=16:"M",I=17:"C",1:"S")
"RTN","GMPLUTL",56,0)
 . S GMPL(CNT,5)=$S(SP="A":"AO^AGENT ORANGE",SP="I":"IR^RADIATION",SP="P":"EC^ENV CONTAMINANTS",SP="H":"HNC^HEAD AND/OR NECK CANCER",SP="M":"MST^MILIARY SEXUAL TRAUMA",SP="C":"CV^COMBAT VET",SP="S":"SHD^SHAD",1:"")
"RTN","GMPLUTL",57,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL",58,0)
 Q
"RTN","GMPLUTL",59,0)
 ;
"RTN","GMPLUTL",60,0)
CREATE(PL,PLY) ; Creates a new problem
"RTN","GMPLUTL",61,0)
 ;
"RTN","GMPLUTL",62,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",63,0)
 ;    Required
"RTN","GMPLUTL",64,0)
 ;      PL("PATIENT")    Pointer to Patient #2
"RTN","GMPLUTL",65,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",66,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",67,0)
 ;    Optional
"RTN","GMPLUTL",68,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",69,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",70,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",71,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",72,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",73,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",74,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",75,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",76,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",77,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",78,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",79,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",80,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",81,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",82,0)
 ;      PL("CV")         Combat Vet        1 = Yes 0 = No
"RTN","GMPLUTL",83,0)
 ;      PL("SHD")        Shipboard Hazard & Defense 1=Yes  0=No
"RTN","GMPLUTL",84,0)
 ;      PL("DX_DATE_OF_INTEREST") For historical encounters (=Today's date) & all other encounters (=encounter date/time)
"RTN","GMPLUTL",85,0)
 ;
"RTN","GMPLUTL",86,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",87,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",88,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",89,0)
 ;
"RTN","GMPLUTL",90,0)
 N GMPI,GMPQUIT,GMPVAMC,GMPVA,GMPFLD,GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",91,0)
 N GMPHNC,GMPMST,GMPCV,GMPSHD,DA,GMPDFN,GMPROV
"RTN","GMPLUTL",92,0)
 K PLY S PLY=-1,PLY(0)=""
"RTN","GMPLUTL",93,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0)
"RTN","GMPLUTL",94,0)
 I '$L($G(PL("NARRATIVE"))) S PLY(0)="Missing problem narrative" Q
"RTN","GMPLUTL",95,0)
 I '$D(^DPT(+$G(PL("PATIENT")),0)) S PLY(0)="Invalid patient" Q
"RTN","GMPLUTL",96,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",97,0)
 S GMPDFN=+PL("PATIENT"),(GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD)=0
"RTN","GMPLUTL",98,0)
 S:'$L($G(PL("DX_DATE_OF_INTEREST"))) PL("DX_DATE_OF_INTEREST")=$$DT^XLFDT
"RTN","GMPLUTL",99,0)
 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",100,0)
 F GMPI="DIAGNOSI","LEXICON","DUPLICAT","LOCATION","STATUS" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",101,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",102,0)
 F GMPI="ONSET","RESOLVED","RECORDED","SC","AO","IR","EC","HNC","MST","CV","SHD" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",103,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",104,0)
CR1 ; Ok to Create
"RTN","GMPLUTL",105,0)
 I $S(PL("LEXICON")=1:1,PL("LEXICON")="":1,$P(PL("LEXICON"),U,2)']"":1,1:0),(PL("NARRATIVE")["SNOMED CT") D FIXLEX(.PL)
"RTN","GMPLUTL",106,0)
 S GMPFLD(.01)=PL("DIAGNOSIS")_U_$S(PL("NARRATIVE")["(ICD-9-CM":$P($P(PL("NARRATIVE"),"ICD-9-CM ",2),")"),1:"")
"RTN","GMPLUTL",107,0)
 S GMPFLD(1.01)=PL("LEXICON")
"RTN","GMPLUTL",108,0)
 S GMPFLD(.05)=U_$E(PL("NARRATIVE"),1,80)
"RTN","GMPLUTL",109,0)
 S (GMPROV,GMPFLD(1.04),GMPFLD(1.05))=+PL("PROVIDER")
"RTN","GMPLUTL",110,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+PL("PROVIDER"))
"RTN","GMPLUTL",111,0)
 S GMPFLD(.13)=PL("ONSET"),GMPFLD(1.09)=PL("RECORDED")
"RTN","GMPLUTL",112,0)
 S GMPFLD(1.02)=$S('$P(^GMPL(125.99,1,0),U,2):"P",$G(GMPLUSER):"P",1:"T")
"RTN","GMPLUTL",113,0)
 S GMPFLD(.12)=PL("STATUS"),GMPFLD(1.14)="",GMPFLD(1.07)=PL("RESOLVED")
"RTN","GMPLUTL",114,0)
 S GMPFLD(10,0)=0,GMPFLD(1.03)=$G(DUZ),GMPFLD(1.08)=PL("LOCATION")
"RTN","GMPLUTL",115,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60)
"RTN","GMPLUTL",116,0)
 S GMPFLD(1.1)=PL("SC"),GMPFLD(1.11)=PL("AO"),GMPFLD(1.12)=PL("IR")
"RTN","GMPLUTL",117,0)
 S GMPFLD(1.13)=PL("EC"),GMPFLD(1.15)=$G(PL("HNC")),GMPFLD(1.16)=$G(PL("MST"))
"RTN","GMPLUTL",118,0)
 S GMPFLD(1.17)=$G(PL("CV")),GMPFLD(1.18)=$G(PL("SHD"))
"RTN","GMPLUTL",119,0)
 S GMPFLD(80201)=$G(PL("DX_DATE_OF_INTEREST"))
"RTN","GMPLUTL",120,0)
 D NEW^GMPLSAVE S PLY=DA
"RTN","GMPLUTL",121,0)
CRQ ; Quit Create
"RTN","GMPLUTL",122,0)
 Q
"RTN","GMPLUTL",123,0)
 ;
"RTN","GMPLUTL",124,0)
FIXLEX(PL) ; Fix Lexicon expression pointer value for SNOMED Concepts
"RTN","GMPLUTL",125,0)
 N SCT,LEXS,ICDS
"RTN","GMPLUTL",126,0)
 S SCT=+$P(PL("NARRATIVE"),"SNOMED CT ",2) I +SCT'>0 Q
"RTN","GMPLUTL",127,0)
 D EN^LEXCODE(SCT) I '$D(LEXS("SCT",1)) Q
"RTN","GMPLUTL",128,0)
 S PL("NARRATIVE")=$P(PL("NARRATIVE")," (")
"RTN","GMPLUTL",129,0)
 S PL("LEXICON")=$P(LEXS("SCT",1),U)_U_PL("NARRATIVE")_" (SNOMED CT "_SCT_")"
"RTN","GMPLUTL",130,0)
 S ICDS=$$GETDX(SCT,$G(PL("DX_DATE_OF_INTEREST")))
"RTN","GMPLUTL",131,0)
 S:($L(ICDS,"/")>1)&(ICDS'=$P($G(PL("DIAGNOSIS")),U,2)) $P(PL("DIAGNOSIS"),U,2)=ICDS
"RTN","GMPLUTL",132,0)
 Q
"RTN","GMPLUTL",133,0)
 ;
"RTN","GMPLUTL",134,0)
GETDX(CODE,GMPDT) ; Get ICD associated with SNOMED CT Code
"RTN","GMPLUTL",135,0)
 N LEX,ORI,ORY,GMPIMPDT,GMPMPDEF S ORY=0,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLUTL",136,0)
 S GMPMPDEF=$S(GMPDT<GMPIMPDT:"SCT2ICD",1:"SCT210D")
"RTN","GMPLUTL",137,0)
 S ORY=$$GETASSN^LEXTRAN1(CODE,GMPMPDEF)
"RTN","GMPLUTL",138,0)
 I $S(+ORY'>0:1,+$P(ORY,U,2)'>0:1,+LEX'>0:1,1:0) S ORY=$S(GMPDT<GMPIMPDT:"799.9",1:"R69.") G GETDXX
"RTN","GMPLUTL",139,0)
 S (ORI,ORY)=0
"RTN","GMPLUTL",140,0)
 F  S ORI=$O(LEX(ORI)) Q:+ORI'>0  D
"RTN","GMPLUTL",141,0)
 . N ICD
"RTN","GMPLUTL",142,0)
 . S ICD=$O(LEX(ORI,""))
"RTN","GMPLUTL",143,0)
 . I ICD]"" S ORY=$S(ORY'=0:ORY_"/",1:"")_ICD
"RTN","GMPLUTL",144,0)
 I ORY'["." S ORY=ORY_"."
"RTN","GMPLUTL",145,0)
GETDXX Q ORY
"RTN","GMPLUTL",146,0)
 ;
"RTN","GMPLUTL",147,0)
UPDATE(PL,PLY) ; Update a Problem/Create if Not Found
"RTN","GMPLUTL",148,0)
 ;
"RTN","GMPLUTL",149,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",150,0)
 ;    Required
"RTN","GMPLUTL",151,0)
 ;      PL("PROBLEM")    Pointer to Problem #9000011
"RTN","GMPLUTL",152,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",153,0)
 ;
"RTN","GMPLUTL",154,0)
 ;    Optional
"RTN","GMPLUTL",155,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",156,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",157,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",158,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",159,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",160,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",161,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",162,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",163,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",164,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",165,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",166,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",167,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",168,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",169,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",170,0)
 ;      PL("CV")         Combat Veteran    1 = Yes 0 = No
"RTN","GMPLUTL",171,0)
 ;      PL("SHD")        SHAD              1 = Yes 0 = No
"RTN","GMPLUTL",172,0)
 ;      PL("SCTC")       SNOMED CT Concept Code
"RTN","GMPLUTL",173,0)
 ;      PL("SCTD")       SNOMED CT Designation Code
"RTN","GMPLUTL",174,0)
 ;      PL("CODEDT")     Date of interest for the primary ICD Diagnosis
"RTN","GMPLUTL",175,0)
 ;      PL("CODESYS")    Coding system of the primary ICD Diagnosis
"RTN","GMPLUTL",176,0)
 ;      PL("DX_DATE_OF_INTEREST") For historical encounters (=Today's date) & all other encounters (=encounter date/time)
"RTN","GMPLUTL",177,0)
 ;
"RTN","GMPLUTL",178,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",179,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",180,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",181,0)
 ;
"RTN","GMPLUTL",182,0)
 N GMPORIG,GMPFLD,FLD,ITEMS,SUB,GMPI,DIFFRENT,GMPIFN,GMPVAMC,GMPVA,GMPROV,GMPQUIT,GMPDFN
"RTN","GMPLUTL",183,0)
 N GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",184,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0),PLY=-1,PLY(0)=""
"RTN","GMPLUTL",185,0)
 S GMPIFN=$G(PL("PROBLEM")) I GMPIFN="" D CREATE(.PL,.PLY) Q
"RTN","GMPLUTL",186,0)
 I '$D(^AUPNPROB(GMPIFN,0)) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",187,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",188,0)
 S GMPROV=+$G(PL("PROVIDER")),GMPDFN=+$P(^AUPNPROB(GMPIFN,0),U,2)
"RTN","GMPLUTL",189,0)
 D GETFLDS^GMPLEDT3(GMPIFN) I '$D(GMPFLD) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",190,0)
 I +$G(PL("PATIENT")),+PL("PATIENT")'=GMPDFN S PLY(0)="Patient does not match for this problem" Q
"RTN","GMPLUTL",191,0)
 I $L($G(PL("RECORDED"))) S PLY(0)="Date Recorded is not editable" Q
"RTN","GMPLUTL",192,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",193,0)
 S:'$L($G(PL("DX_DATE_OF_INTEREST"))) PL("DX_DATE_OF_INTEREST")=$$DT^XLFDT
"RTN","GMPLUTL",194,0)
 I '$L($G(PL("CODESYS"))),$L($G(PL("DIAGNOSIS"))) D
"RTN","GMPLUTL",195,0)
 . S PL("CODESYS")=$$SAB^ICDEX($$CSI^ICDEX(80,+PL("DIAGNOSIS")),PL("DX_DATE_OF_INTEREST"))
"RTN","GMPLUTL",196,0)
 S ITEMS="LEXICON^DIAGNOSIS^LOCATION^STATUS^ONSET^RESOLVED^SC^AO^IR^EC^HNC^MST^CV^SHD",FLD="1.01^.01^1.08^.12^.13^1.07^1.1^1.11^1.12^1.13^1.15^1.16^1.17^1.18"
"RTN","GMPLUTL",197,0)
 F GMPI=1:1 S SUB=$P(ITEMS,U,GMPI) Q:SUB=""  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL",198,0)
 . I '$L($G(PL(SUB))) S PL(SUB)=$P(GMPFLD($P(FLD,U,GMPI)),U) Q
"RTN","GMPLUTL",199,0)
 . I SUB="STATUS",PL(SUB)="@" S GMPQUIT=1,PLY(0)="Cannot delete problem status" Q
"RTN","GMPLUTL",200,0)
 . I PL(SUB)'="@" D @($E(SUB,1,8)_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",201,0)
 . S GMPFLD($P(FLD,U,GMPI))=$S(PL(SUB)="@":"",1:PL(SUB)),DIFFRENT=1
"RTN","GMPLUTL",202,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",203,0)
 I +GMPFLD(1.07),GMPFLD(1.07)<GMPFLD(.13) S PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",204,0)
 I +GMPFLD(1.09),GMPFLD(1.09)<GMPFLD(.13) S PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",205,0)
 S:$L($G(PL("NARRATIVE"))) GMPFLD(.05)=U_PL("NARRATIVE"),DIFFRENT=1
"RTN","GMPLUTL",206,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60),DIFFRENT=1
"RTN","GMPLUTL",207,0)
 D:$D(DIFFRENT) EN^GMPLSAVE S PLY=GMPIFN,PLY(0)=""
"RTN","GMPLUTL",208,0)
 Q
"RTN","GMPLUTL1")
0^25^B59613376
"RTN","GMPLUTL1",1,0)
GMPLUTL1 ; SLC/MKB/KER/TC -- PL Utilities (cont) ;01/15/14  11:13
"RTN","GMPLUTL1",2,0)
 ;;2.0;Problem List;**3,8,7,9,26,35,39,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLUTL1",3,0)
 ;
"RTN","GMPLUTL1",4,0)
 ; External References
"RTN","GMPLUTL1",5,0)
 ;   DBIA   446  ^AUTNPOV(
"RTN","GMPLUTL1",6,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMPLUTL1",7,0)
 ;   DBIA  1571  ^LEX(757.01
"RTN","GMPLUTL1",8,0)
 ;   DBIA 10040  ^SC(
"RTN","GMPLUTL1",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL1",10,0)
 ;   DBIA 10003  ^%DT
"RTN","GMPLUTL1",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLUTL1",12,0)
 ;    ICR  5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL1",13,0)
 ;
"RTN","GMPLUTL1",14,0)
 ; All entry points in this routine expect the
"RTN","GMPLUTL1",15,0)
 ; PL("data item") array from routine ^GMPLUTL.
"RTN","GMPLUTL1",16,0)
 ;
"RTN","GMPLUTL1",17,0)
 ;   Entry     Expected Variable
"RTN","GMPLUTL1",18,0)
 ;   Point     From VADPT^GMPLX1
"RTN","GMPLUTL1",19,0)
 ;    AO           GMPAGTOR
"RTN","GMPLUTL1",20,0)
 ;    IR           GMPION
"RTN","GMPLUTL1",21,0)
 ;    EC           GMPGULF
"RTN","GMPLUTL1",22,0)
 ;    HNC          GMPHNC
"RTN","GMPLUTL1",23,0)
 ;    MST          GMPMST
"RTN","GMPLUTL1",24,0)
 ;    CV           GMPCV
"RTN","GMPLUTL1",25,0)
 ;    SHD          GMPSHD
"RTN","GMPLUTL1",26,0)
 ;
"RTN","GMPLUTL1",27,0)
 Q
"RTN","GMPLUTL1",28,0)
DIAGNOSI ; ICD Diagnosis Pointer
"RTN","GMPLUTL1",29,0)
 N GMPICDSY S GMPICDSY=$S($L($G(PL("CODESYS"))):PL("CODESYS"),1:"DIAG")
"RTN","GMPLUTL1",30,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",31,0)
 Q:$P($$ICDDATA^ICDXCODE(GMPICDSY,+PL("DIAGNOSIS"),PL("DX_DATE_OF_INTEREST"),"I"),U)>0
"RTN","GMPLUTL1",32,0)
 S GMPQUIT=1,PLY(0)="Invalid ICD Diagnosis"
"RTN","GMPLUTL1",33,0)
 Q
"RTN","GMPLUTL1",34,0)
 ;
"RTN","GMPLUTL1",35,0)
LEXICON ; Clinical Lexicon Pointer
"RTN","GMPLUTL1",36,0)
 S:'$L($G(PL("LEXICON"))) PL("LEXICON")=1
"RTN","GMPLUTL1",37,0)
 Q:$D(^LEX(757.01,+PL("LEXICON"),0))
"RTN","GMPLUTL1",38,0)
 S GMPQUIT=1,PLY(0)="Invalid Lexicon term"
"RTN","GMPLUTL1",39,0)
 Q
"RTN","GMPLUTL1",40,0)
DUPLICAT ; Problem Already on the List
"RTN","GMPLUTL1",41,0)
 N DUPL,NODE0,NODE1
"RTN","GMPLUTL1",42,0)
 Q:$P($G(^GMPL(125.99,1,0)),U,6)'=1
"RTN","GMPLUTL1",43,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",44,0)
 I '$D(^AUPNPROB("B",+PL("DIAGNOSIS")))!('$D(^AUPNPROB("AC",GMPDFN))) Q
"RTN","GMPLUTL1",45,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",GMPDFN,IFN)) Q:IFN'>0  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL1",46,0)
 . S (DUPL(1),DUPL(2))=0
"RTN","GMPLUTL1",47,0)
 . S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLUTL1",48,0)
 . I +PL("DIAGNOSIS")=+NODE0 S DUPL(1)=IFN
"RTN","GMPLUTL1",49,0)
 . S:$$UP^XLFSTR(PL("NARRATIVE"))=$$UP^XLFSTR($P(^AUTNPOV($P(NODE0,U,5),0),U)) DUPL(2)=IFN
"RTN","GMPLUTL1",50,0)
 . I DUPL(1)>0&DUPL(2)>0 S GMPQUIT=1,PLY(0)="Duplicate problem"
"RTN","GMPLUTL1",51,0)
 Q
"RTN","GMPLUTL1",52,0)
 ;
"RTN","GMPLUTL1",53,0)
LOCATION ; Hospital Location (Clinic) Pointer
"RTN","GMPLUTL1",54,0)
 S:'$D(PL("LOCATION")) PL("LOCATION")="" Q:'$L(PL("LOCATION"))
"RTN","GMPLUTL1",55,0)
 I $D(^SC(+PL("LOCATION"),0)) S:$P(^(0),U,3)'="C" PL("LOCATION")="" Q
"RTN","GMPLUTL1",56,0)
 S GMPQUIT=1,PLY(0)="Invalid hospital location"
"RTN","GMPLUTL1",57,0)
 Q
"RTN","GMPLUTL1",58,0)
 ;
"RTN","GMPLUTL1",59,0)
PROVIDER ; Responsible Provider
"RTN","GMPLUTL1",60,0)
 S:'$D(PL("PROVIDER")) PL("PROVIDER")=""
"RTN","GMPLUTL1",61,0)
 Q:'$L(PL("PROVIDER"))  Q:$D(^VA(200,+PL("PROVIDER"),0))
"RTN","GMPLUTL1",62,0)
 S GMPQUIT=1,PLY(0)="Invalid provider"
"RTN","GMPLUTL1",63,0)
 Q
"RTN","GMPLUTL1",64,0)
 ;
"RTN","GMPLUTL1",65,0)
STATUS ; Problem Status
"RTN","GMPLUTL1",66,0)
 S:$G(PL("STATUS"))="" PL("STATUS")="A"
"RTN","GMPLUTL1",67,0)
 I "^A^I^a^i^"[(U_PL("STATUS")_U) S PL("STATUS")=$$UP^XLFSTR(PL("STATUS")) Q
"RTN","GMPLUTL1",68,0)
 S GMPQUIT=1,PLY(0)="Invalid problem status"
"RTN","GMPLUTL1",69,0)
 Q
"RTN","GMPLUTL1",70,0)
 ;
"RTN","GMPLUTL1",71,0)
ONSET ; Date of Onset
"RTN","GMPLUTL1",72,0)
 N %DT,Y,X
"RTN","GMPLUTL1",73,0)
 S:'$D(PL("ONSET")) PL("ONSET")="" Q:'$L(PL("ONSET"))
"RTN","GMPLUTL1",74,0)
 S %DT="P",%DT(0)="-NOW",X=PL("ONSET") D ^%DT
"RTN","GMPLUTL1",75,0)
 I Y>0 S PL("ONSET")=Y Q
"RTN","GMPLUTL1",76,0)
 S GMPQUIT=1,PLY(0)="Invalid Date of Onset"
"RTN","GMPLUTL1",77,0)
 Q
"RTN","GMPLUTL1",78,0)
 ;
"RTN","GMPLUTL1",79,0)
RESOLVED ; Date Resolved (Requires STATUS, ONSET)
"RTN","GMPLUTL1",80,0)
 N %DT,Y,X
"RTN","GMPLUTL1",81,0)
 S:'$D(PL("RESOLVED")) PL("RESOLVED")="" Q:'$L(PL("RESOLVED"))
"RTN","GMPLUTL1",82,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RESOLVED") D ^%DT
"RTN","GMPLUTL1",83,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Resolved" Q
"RTN","GMPLUTL1",84,0)
 I PL("STATUS")="A" S GMPQUIT=1,PLY(0)="Active problems cannot have a Date Resolved" Q
"RTN","GMPLUTL1",85,0)
 I Y<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",86,0)
 S PL("RESOLVED")=Y
"RTN","GMPLUTL1",87,0)
 Q
"RTN","GMPLUTL1",88,0)
 ;
"RTN","GMPLUTL1",89,0)
RECORDED ; Date Recorded (Requires ONSET)
"RTN","GMPLUTL1",90,0)
 N %DT,Y,X
"RTN","GMPLUTL1",91,0)
 S:'$D(PL("RECORDED")) PL("RECORDED")="" Q:'$L(PL("RECORDED"))
"RTN","GMPLUTL1",92,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RECORDED") D ^%DT
"RTN","GMPLUTL1",93,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Recorded" Q
"RTN","GMPLUTL1",94,0)
 I PL("RECORDED")<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",95,0)
 S PL("RECORDED")=Y
"RTN","GMPLUTL1",96,0)
 Q
"RTN","GMPLUTL1",97,0)
 ;
"RTN","GMPLUTL1",98,0)
SC ; SC condition flag
"RTN","GMPLUTL1",99,0)
 S:'$D(PL("SC")) PL("SC")=""
"RTN","GMPLUTL1",100,0)
 I "^^1^0^"'[(U_PL("SC")_U) S GMPQUIT=1,PLY(0)="Invalid SC flag" Q
"RTN","GMPLUTL1",101,0)
 I 'GMPSC,+PL("SC") S GMPQUIT=1,PLY(0)="Invalid SC flag"
"RTN","GMPLUTL1",102,0)
 Q
"RTN","GMPLUTL1",103,0)
 ;
"RTN","GMPLUTL1",104,0)
AO ; AO exposure flag (Requires GMPAGTOR)
"RTN","GMPLUTL1",105,0)
 S:'$D(PL("AO")) PL("AO")=""
"RTN","GMPLUTL1",106,0)
 I "^^1^0^"'[(U_PL("AO")_U) S GMPQUIT=1,PLY(0)="Invalid AO flag" Q
"RTN","GMPLUTL1",107,0)
 I 'GMPAGTOR,+PL("AO") S GMPQUIT=1,PLY(0)="Invalid AO flag"
"RTN","GMPLUTL1",108,0)
 Q
"RTN","GMPLUTL1",109,0)
 ;
"RTN","GMPLUTL1",110,0)
IR ; IR exposure flag (Requires GMPION)
"RTN","GMPLUTL1",111,0)
 S:'$D(PL("IR")) PL("IR")=""
"RTN","GMPLUTL1",112,0)
 I "^^1^0^"'[(U_PL("IR")_U) S GMPQUIT=1,PLY(0)="Invalid IR flag" Q
"RTN","GMPLUTL1",113,0)
 I 'GMPION,+PL("IR") S GMPQUIT=1,PLY(0)="Invalid IR flag"
"RTN","GMPLUTL1",114,0)
 Q
"RTN","GMPLUTL1",115,0)
 ;
"RTN","GMPLUTL1",116,0)
EC ; EC exposure flag (Requires GMPGULF)
"RTN","GMPLUTL1",117,0)
 S:'$D(PL("EC")) PL("EC")=""
"RTN","GMPLUTL1",118,0)
 I "^^1^0^"'[(U_PL("EC")_U) S GMPQUIT=1,PLY(0)="Invalid EC flag" Q
"RTN","GMPLUTL1",119,0)
 I 'GMPGULF,+PL("EC") S GMPQUIT=1,PLY(0)="Invalid EC flag"
"RTN","GMPLUTL1",120,0)
 Q
"RTN","GMPLUTL1",121,0)
HNC ; HNC/NTR exposure flag (Requires GMPHNC)
"RTN","GMPLUTL1",122,0)
 S:'$D(PL("HNC")) PL("HNC")=""
"RTN","GMPLUTL1",123,0)
 I "^^1^0^"'[(U_PL("HNC")_U) S GMPQUIT=1,PLY(0)="Invalid HNC flag" Q
"RTN","GMPLUTL1",124,0)
 I 'GMPHNC,+PL("HNC") S GMPQUIT=1,PLY(0)="Invalid HNC flag"
"RTN","GMPLUTL1",125,0)
 Q
"RTN","GMPLUTL1",126,0)
MST ; MST exposure flag (Requires GMPMST)
"RTN","GMPLUTL1",127,0)
 S:'$D(PL("MST")) PL("MST")=""
"RTN","GMPLUTL1",128,0)
 I "^^1^0^"'[(U_PL("MST")_U) S GMPQUIT=1,PLY(0)="Invalid MST flag" Q
"RTN","GMPLUTL1",129,0)
 I 'GMPMST,+PL("MST") S GMPQUIT=1,PLY(0)="Invalid MST flag"
"RTN","GMPLUTL1",130,0)
 Q
"RTN","GMPLUTL1",131,0)
CV ; CV exposure flag (Requires GMPCV)
"RTN","GMPLUTL1",132,0)
 S:'$D(PL("CV")) PL("CV")=""
"RTN","GMPLUTL1",133,0)
 I "^^1^0^"'[(U_PL("CV")_U) S GMPQUIT=1,PLY(0)="Invalid CV flag" Q
"RTN","GMPLUTL1",134,0)
 I 'GMPCV,+PL("CV") S GMPQUIT=1,PLY(0)="Invalid CV flag"
"RTN","GMPLUTL1",135,0)
 Q
"RTN","GMPLUTL1",136,0)
SHD ; SHD exposure flag (Requires GMPSHD)
"RTN","GMPLUTL1",137,0)
 S:'$D(PL("SHD")) PL("SHD")=""
"RTN","GMPLUTL1",138,0)
 I "^^1^0^"'[(U_PL("SHD")_U) S GMPQUIT=1,PLY(0)="Invalid SHD flag" Q
"RTN","GMPLUTL1",139,0)
 I 'GMPSHD,+PL("SHD") S GMPQUIT=1,PLY(0)="Invalid SHD flag"
"RTN","GMPLUTL1",140,0)
 Q
"RTN","GMPLUTL1",141,0)
CENTER(X) ; Center X
"RTN","GMPLUTL1",142,0)
 N SP
"RTN","GMPLUTL1",143,0)
 S $P(SP," ",((IOM-$L(X))\2))=""
"RTN","GMPLUTL1",144,0)
 Q $G(SP)_X
"RTN","GMPLUTL1",145,0)
READ(TYPE,PROMPT,DEFAULT,HELP,SCREEN) ; Calls reader, returns response
"RTN","GMPLUTL1",146,0)
 N DIR,X,Y
"RTN","GMPLUTL1",147,0)
 S DIR(0)=TYPE
"RTN","GMPLUTL1",148,0)
 I $D(SCREEN) S DIR("S")=SCREEN
"RTN","GMPLUTL1",149,0)
 I $G(PROMPT)]"" S DIR("A")=PROMPT
"RTN","GMPLUTL1",150,0)
 I $G(DEFAULT)]"" S DIR("B")=DEFAULT
"RTN","GMPLUTL1",151,0)
 I $D(HELP) S DIR("?")=HELP
"RTN","GMPLUTL1",152,0)
 D ^DIR
"RTN","GMPLUTL1",153,0)
 I $G(X)="@" S Y="@" G READX
"RTN","GMPLUTL1",154,0)
 I Y]"",($L($G(Y),U)'=2) S Y=Y_U_$G(Y(0),Y)
"RTN","GMPLUTL1",155,0)
READX Q Y
"RTN","GMPLUTL1",156,0)
EDATE(PRMPT,STATUS,DFLT) ; Get early date
"RTN","GMPLUTL1",157,0)
 N X,Y,GMPLPRMT,GMPLDFLT
"RTN","GMPLUTL1",158,0)
 I $G(STATUS)=4 S Y=1 Q Y
"RTN","GMPLUTL1",159,0)
 S GMPLPRMT=" Start "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","GMPLUTL1",160,0)
 S GMPLDFLT=$S($L($G(DFLT)):DFLT,1:"T-30")
"RTN","GMPLUTL1",161,0)
 S Y=$$READ("DOA^::AET",GMPLPRMT,GMPLDFLT)
"RTN","GMPLUTL1",162,0)
 Q Y
"RTN","GMPLUTL1",163,0)
LDATE(PRMPT,STATUS,DFLT) ; Get late date
"RTN","GMPLUTL1",164,0)
 N X,Y,GMPLPRMT,GMPLDFLT
"RTN","GMPLUTL1",165,0)
 I $G(STATUS)=4 S Y=9999999 Q Y
"RTN","GMPLUTL1",166,0)
 S GMPLPRMT="Ending "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","GMPLUTL1",167,0)
 S GMPLDFLT=$S($L($G(DFLT)):DFLT,1:"NOW")
"RTN","GMPLUTL1",168,0)
 S Y=$$READ("DOA^::AET",GMPLPRMT,GMPLDFLT)
"RTN","GMPLUTL1",169,0)
 Q Y
"RTN","GMPLUTL1",170,0)
STOP(PROMPT,SCROLL) ; Call DIR at bottom of screen
"RTN","GMPLUTL1",171,0)
 N DIR,X,Y,DTOUT
"RTN","GMPLUTL1",172,0)
 I $E(IOST)'="C" S Y="" G STOPX
"RTN","GMPLUTL1",173,0)
 I +$G(SCROLL),(IOSL>($Y+5)) F  W ! Q:IOSL<($Y+6)
"RTN","GMPLUTL1",174,0)
 S DIR(0)="FO^1:1",DIR("A")=$S($G(PROMPT)]"":PROMPT,1:"Press RETURN to continue or '^' to exit")
"RTN","GMPLUTL1",175,0)
 S DIR("?")="Enter '^' to quit present action or '^^' to quit to menu"
"RTN","GMPLUTL1",176,0)
 D ^DIR I $D(DIRUT),(Y="") K DIRUT
"RTN","GMPLUTL1",177,0)
 S Y=$S(Y="^":0,Y="^^":0,$D(DTOUT):"",Y="":1,1:1_U_Y)
"RTN","GMPLUTL1",178,0)
STOPX Q Y
"RTN","GMPLUTL1",179,0)
DATE(X,FMT) ; Call with X=2910419.01 and FMT=Return Format of date ("MM/DD")
"RTN","GMPLUTL1",180,0)
 N AMTH,MM,CC,DD,YY,GMPLI,GMPLTMP
"RTN","GMPLUTL1",181,0)
 I +X'>0 S $P(GMPLTMP," ",$L($G(FMT))+1)="",FMT=GMPLTMP G QDATE
"RTN","GMPLUTL1",182,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="MM/DD/YY"
"RTN","GMPLUTL1",183,0)
 S MM=$E(X,4,5),DD=$E(X,6,7),YY=$E(X,2,3),CC=17+$E(X)
"RTN","GMPLUTL1",184,0)
 S:FMT["AMTH" AMTH=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+MM)
"RTN","GMPLUTL1",185,0)
 F GMPLI="AMTH","MM","DD","CC","YY" S:FMT[GMPLI FMT=$P(FMT,GMPLI)_@GMPLI_$P(FMT,GMPLI,2)
"RTN","GMPLUTL1",186,0)
 I FMT["HR" S FMT=$$TIME(X,FMT)
"RTN","GMPLUTL1",187,0)
QDATE Q FMT
"RTN","GMPLUTL1",188,0)
TIME(X,FMT) ; Recieves X as 2910419.01 and FMT=Return Format of time (HH:MM:SS).
"RTN","GMPLUTL1",189,0)
 N HR,MIN,SEC,GMPLI
"RTN","GMPLUTL1",190,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="HR:MIN"
"RTN","GMPLUTL1",191,0)
 S X=$P(X,".",2),HR=$E(X,1,2)_$E("00",0,2-$L($E(X,1,2))),MIN=$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),SEC=$E(X,5,6)_$E("00",0,2-$L($E(X,5,6)))
"RTN","GMPLUTL1",192,0)
 F GMPLI="HR","MIN","SEC" S:FMT[GMPLI FMT=$P(FMT,GMPLI)_@GMPLI_$P(FMT,GMPLI,2)
"RTN","GMPLUTL1",193,0)
 Q FMT
"RTN","GMPLUTL1",194,0)
NAME(X,FMT) ; Call with X="LAST,FIRST MI", FMT=Return Format ("LAST, FI")
"RTN","GMPLUTL1",195,0)
 N GMPLLAST,GMPLLI,GMPFIRST,GMPLFI,GMPLMI,GMPLI
"RTN","GMPLUTL1",196,0)
 I X']"" S FMT="" G NAMEX
"RTN","GMPLUTL1",197,0)
 I $S('$D(FMT):1,'$L(FMT):1,1:0) S FMT="LAST,FIRST"
"RTN","GMPLUTL1",198,0)
 S FMT=$$LOW^XLFSTR(FMT)
"RTN","GMPLUTL1",199,0)
 S GMPLLAST=$P(X,","),GMPLLI=$E(GMPLLAST),GMPFIRST=$P(X,",",2)
"RTN","GMPLUTL1",200,0)
 S GMPLFI=$E(GMPFIRST)
"RTN","GMPLUTL1",201,0)
 S GMPLMI=$S($P(GMPFIRST," ",2)'="NMI":$E($P(GMPFIRST," ",2)),1:"")
"RTN","GMPLUTL1",202,0)
 S GMPFIRST=$P(GMPFIRST," ")
"RTN","GMPLUTL1",203,0)
 F GMPLI="last","li","first","fi","mi" I FMT[GMPLI S FMT=$P(FMT,GMPLI)_@("GMPL"_$$UP^XLFSTR(GMPLI))_$P(FMT,GMPLI,2)
"RTN","GMPLUTL1",204,0)
NAMEX Q FMT
"RTN","GMPLUTL1",205,0)
TITLE(X) ; Pads titles
"RTN","GMPLUTL1",206,0)
 ; Recieves:    X=title to be padded
"RTN","GMPLUTL1",207,0)
 N I,TITLE
"RTN","GMPLUTL1",208,0)
 S TITLE="" F I=1:1:$L(X) S TITLE=TITLE_" "_$E(X,I)
"RTN","GMPLUTL1",209,0)
 Q TITLE
"RTN","GMPLUTL1",210,0)
JUSTIFY(X,JUST) ; Justifies Text
"RTN","GMPLUTL1",211,0)
 ; Receives:    X=text to be justified
"RTN","GMPLUTL1",212,0)
 ;           JUST="L" --> left, "C" --> center, "R" --> right,
"RTN","GMPLUTL1",213,0)
 ;                "J" --> justified to WIDTH
"RTN","GMPLUTL1",214,0)
 ;           WIDTH=justification width (when JUST="j"
"RTN","GMPLUTL1",215,0)
 I "Cc"[JUST W ?((80-$L(X))/2),X
"RTN","GMPLUTL1",216,0)
 I "Ll"[JUST W X,!!
"RTN","GMPLUTL1",217,0)
 I "Rr"[JUST W ?(80-$L(X)),X
"RTN","GMPLUTL1",218,0)
 Q
"RTN","GMPLUTL2")
0^1^B87546177
"RTN","GMPLUTL2",1,0)
GMPLUTL2 ; ISL/MKB,KER,JER,TC -- PL Utilities (OE/TIU) ;10/04/12  14:10
"RTN","GMPLUTL2",2,0)
 ;;2.0;Problem List;**10,18,21,26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLUTL2",3,0)
 ;
"RTN","GMPLUTL2",4,0)
 ; External References
"RTN","GMPLUTL2",5,0)
 ;   DBIA   348  ^DPT(  file #2
"RTN","GMPLUTL2",6,0)
 ;    ICR  5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL2",7,0)
 ;    ICR  5747  $$SAB^ICDEX,$$CODECS^ICDEX,$$CSI^ICDEX
"RTN","GMPLUTL2",8,0)
 ;   DBIA 10040  ^SC(  file #44
"RTN","GMPLUTL2",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL2",10,0)
 ;   DBIA  2716  $$GETSTAT^DGMSTAPI
"RTN","GMPLUTL2",11,0)
 ;   DBIA  3457  $$GETCUR^DGNTAPI
"RTN","GMPLUTL2",12,0)
 ;   DBIA 10062  7^VADPT
"RTN","GMPLUTL2",13,0)
 ;   DBIA 10062  DEM^VADPT
"RTN","GMPLUTL2",14,0)
 ;   DBIA 10118  EN^VALM
"RTN","GMPLUTL2",15,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLUTL2",16,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLUTL2",17,0)
 ;
"RTN","GMPLUTL2",18,0)
LIST(GMPL,GMPDFN,GMPSTAT,GMPCOMM) ; Returns list of Problems for Patient
"RTN","GMPLUTL2",19,0)
 D LIST^GMPLUTL3
"RTN","GMPLUTL2",20,0)
 Q
"RTN","GMPLUTL2",21,0)
 ;
"RTN","GMPLUTL2",22,0)
DETAIL(IFN,GMPL) ; Returns Detailed Data for Problem
"RTN","GMPLUTL2",23,0)
 ;
"RTN","GMPLUTL2",24,0)
 ; Input   IFN  Pointer to Problem file #9000011
"RTN","GMPLUTL2",25,0)
 ;
"RTN","GMPLUTL2",26,0)
 ; Output  GMPL Array, passed by reference
"RTN","GMPLUTL2",27,0)
 ;         GMPL("DATA NAME") = External Format of Value
"RTN","GMPLUTL2",28,0)
 ;
"RTN","GMPLUTL2",29,0)
 ;         GMPL("DIAGNOSIS")  ICD Code
"RTN","GMPLUTL2",30,0)
 ;         GMPL("ICDD")       ICD Description
"RTN","GMPLUTL2",31,0)
 ;         GMPL("CSYS")       Coding System (#80202) [ex: 10D (ICD-10) & ICD (ICD-9)]
"RTN","GMPLUTL2",32,0)
 ;         GMPL("DTINTEREST") Date of Interest (#80201)
"RTN","GMPLUTL2",33,0)
 ;         GMPL("PATIENT")    Patient Name
"RTN","GMPLUTL2",34,0)
 ;         GMPL("MODIFIED")   Date Last Modified
"RTN","GMPLUTL2",35,0)
 ;         GMPL("NARRATIVE")  Provider Narrative
"RTN","GMPLUTL2",36,0)
 ;         GMPL("ENTERED")    Date Entered ^ Entered by
"RTN","GMPLUTL2",37,0)
 ;         GMPL("STATUS")     Status
"RTN","GMPLUTL2",38,0)
 ;         GMPL("PRIORITY")   Priority Acute/Chronic
"RTN","GMPLUTL2",39,0)
 ;         GMPL("ONSET")      Date of Onset
"RTN","GMPLUTL2",40,0)
 ;         GMPL("PROVIDER")   Responsible Provider
"RTN","GMPLUTL2",41,0)
 ;         GMPL("RECORDED")   Date Recorded ^ Recorded by
"RTN","GMPLUTL2",42,0)
 ;         GMPL("CONDITION")  Patient Condition (#1.02)
"RTN","GMPLUTL2",43,0)
 ;         GMPL("RESOLVED")   Date Resolved (#1.07)
"RTN","GMPLUTL2",44,0)
 ;         GMPL("CLINIC")     Hospital Location
"RTN","GMPLUTL2",45,0)
 ;         GMPL("SERVICE")    Service (#1.06)
"RTN","GMPLUTL2",46,0)
 ;         GMPL("FACILITY")   Facility ID ^ Facility Name (#.06)
"RTN","GMPLUTL2",47,0)
 ;         GMPL("SC")         Service Connected SC/NSC/""
"RTN","GMPLUTL2",48,0)
 ;         GMPL("SCTC")       SNOMED-CT Concept Code
"RTN","GMPLUTL2",49,0)
 ;         GMPL("SCTD")       SNOMED-CT Designation Code
"RTN","GMPLUTL2",50,0)
 ;         GMPL("SCTT")       SNOMED-CT Preferred Text
"RTN","GMPLUTL2",51,0)
 ;         GMPL("VHATC")      VHAT Concept Code
"RTN","GMPLUTL2",52,0)
 ;         GMPL("VHATD")      VHAT Designation Code
"RTN","GMPLUTL2",53,0)
 ;         GMPL("VHATT")      VHAT Preferred Text
"RTN","GMPLUTL2",54,0)
 ;
"RTN","GMPLUTL2",55,0)
 ;         GMPL("ICD9MLTP") = #
"RTN","GMPLUTL2",56,0)
 ;         GMPL("ICD9MLTP",CNT) = ICD-9-CM/ICD-10-CM Code^ICD-9-CM/ICD-10-CM Description^ICD Coding System
"RTN","GMPLUTL2",57,0)
 ;
"RTN","GMPLUTL2",58,0)
 ;         GMPL("EXPOSURE") = #
"RTN","GMPLUTL2",59,0)
 ;         GMPL("EXPOSURE",X)="AGENT ORANGE"
"RTN","GMPLUTL2",60,0)
 ;         GMPL("EXPOSURE",X)="RADIATION"
"RTN","GMPLUTL2",61,0)
 ;         GMPL("EXPOSURE",X)="ENV CONTAMINANTS"
"RTN","GMPLUTL2",62,0)
 ;         GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER"
"RTN","GMPLUTL2",63,0)
 ;         GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA"
"RTN","GMPLUTL2",64,0)
 ;         GMPL("EXPOSURE",X)="COMBAT VET"
"RTN","GMPLUTL2",65,0)
 ;         GMPL("EXPOSURE",X)="SHAD"
"RTN","GMPLUTL2",66,0)
 ;
"RTN","GMPLUTL2",67,0)
 ;         GMPL("COMMENT") = #
"RTN","GMPLUTL2",68,0)
 ;         GMPL("COMMENT",CNT) = Date ^ Author ^ Text of Note
"RTN","GMPLUTL2",69,0)
 ;
"RTN","GMPLUTL2",70,0)
 N GMPL0,GMPL1,GMPL800,GMPL802,GMPL803,GMPLP,X,I,FAC,CNT,NIFN Q:'$D(^AUPNPROB(IFN,0))
"RTN","GMPLUTL2",71,0)
 S GMPLP=+($$PTR^GMPLUTL4)
"RTN","GMPLUTL2",72,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),GMPL803=$G(^(803,0))
"RTN","GMPLUTL2",73,0)
 S GMPL("DTINTEREST")=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPL("CSYS")=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPL("DTINTEREST")))
"RTN","GMPLUTL2",74,0)
 S GMPL("DIAGNOSIS")=$P($$ICDDATA^ICDXCODE(GMPL("CSYS"),+GMPL0,GMPL("DTINTEREST"),"I"),U,2)
"RTN","GMPLUTL2",75,0)
 S GMPL("FACILITY")=$$RESOLVE(IFN,".06","IE")
"RTN","GMPLUTL2",76,0)
 S GMPL("ICDD")=$$ICDDESC(GMPL("DIAGNOSIS"),GMPL("DTINTEREST"),GMPL("CSYS"))
"RTN","GMPLUTL2",77,0)
 S GMPL("PATIENT")=$P($G(^DPT(+$P(GMPL0,U,2),0)),U)
"RTN","GMPLUTL2",78,0)
 S GMPL("MODIFIED")=$$EXTDT^GMPLX($P(GMPL0,U,3))
"RTN","GMPLUTL2",79,0)
 S GMPL("NARRATIVE")=$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL2",80,0)
 S GMPL("ENTERED")=$$EXTDT^GMPLX($P(GMPL0,U,8))_U_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U)
"RTN","GMPLUTL2",81,0)
 S X=$P(GMPL0,U,12),GMPL("STATUS")=$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLUTL2",82,0)
 S X=$S(X'="A":"",1:$P(GMPL1,U,14)),GMPL("PRIORITY")=$S(X="A":"ACUTE",X="C":"CHRONIC",1:"")
"RTN","GMPLUTL2",83,0)
 S GMPL("ONSET")=$$EXTDT^GMPLX($P(GMPL0,U,13))
"RTN","GMPLUTL2",84,0)
 S GMPL("CONDITION")=$$RESOLVE(IFN,"1.02","E")
"RTN","GMPLUTL2",85,0)
 S GMPL("PROVIDER")=$P($G(^VA(200,+$P(GMPL1,U,5),0)),U)
"RTN","GMPLUTL2",86,0)
 S GMPL("RECORDED")=$$EXTDT^GMPLX($P(GMPL1,U,9))_U_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLUTL2",87,0)
 S GMPL("RESOLVED")=$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLUTL2",88,0)
 S GMPL("CLINIC")=$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLUTL2",89,0)
 S GMPL("SERVICE")=$$RESOLVE(IFN,1.06,"E")
"RTN","GMPLUTL2",90,0)
 S GMPL("SCTC")=$P(GMPL800,U),GMPL("SCTD")=$P(GMPL800,U,2)
"RTN","GMPLUTL2",91,0)
 I $L($G(GMPL("SCTC"))) S GMPL("SCTT")=$P($$SCTTEXT(GMPL("SCTC"),$P(GMPL0,U,8),"SCT"),U)
"RTN","GMPLUTL2",92,0)
 S GMPL("VHATC")=$P(GMPL800,U,3),GMPL("VHATD")=$P(GMPL800,U,4)
"RTN","GMPLUTL2",93,0)
 I $L($G(GMPL("VHATC"))) S GMPL("VHATT")=$$SCTTEXT(GMPL("VHATC"),$P(GMPL0,U,8),"VHAT")
"RTN","GMPLUTL2",94,0)
 S GMPL("ICD9MLTP")=""
"RTN","GMPLUTL2",95,0)
 I $L($G(GMPL803))>0 D
"RTN","GMPLUTL2",96,0)
 . N DA,ICDDESC S (CNT,DA)=0,GMPL("ICD9MLTP")=0 F  S DA=$O(^AUPNPROB(IFN,803,DA)) Q:'+DA  D
"RTN","GMPLUTL2",97,0)
 . . S X=$G(^AUPNPROB(IFN,803,DA,0)),ICDDESC=$$ICDDESC($P(X,U),$P(X,U,3),$P(X,U,2))
"RTN","GMPLUTL2",98,0)
 . . S CNT=CNT+1,GMPL("ICD9MLTP",CNT)=$P(X,U)_U_$G(ICDDESC)_U_$P(X,U,2)
"RTN","GMPLUTL2",99,0)
 . S GMPL("ICD9MLTP")=CNT
"RTN","GMPLUTL2",100,0)
 S GMPL("SC")=$S($P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"UNKNOWN")
"RTN","GMPLUTL2",101,0)
 S GMPL("EXPOSURE")=0
"RTN","GMPLUTL2",102,0)
 I $P(GMPL1,U,11) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="AGENT ORANGE",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",103,0)
 I $P(GMPL1,U,12) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="RADIATION",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",104,0)
 I $P(GMPL1,U,13) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="ENV CONTAMINANTS",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",105,0)
 I $P(GMPL1,U,15) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",106,0)
 I $P(GMPL1,U,16) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",107,0)
 I $P(GMPL1,U,17) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="COMBAT VET",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",108,0)
 I $P(GMPL1,U,18)&(GMPLP'>0) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="SHAD",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",109,0)
 S (FAC,CNT)=0,GMPL("COMMENT")=0
"RTN","GMPLUTL2",110,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLUTL2",111,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:NIFN'>0  D
"RTN","GMPLUTL2",112,0)
 . . S X=$G(^AUPNPROB(IFN,11,FAC,11,NIFN,0))
"RTN","GMPLUTL2",113,0)
 . . S CNT=CNT+1,GMPL("COMMENT",CNT)=$$EXTDT^GMPLX($P(X,U,5))_U_$P($G(^VA(200,+$P(X,U,6),0)),U)_U_$P(X,U,3)
"RTN","GMPLUTL2",114,0)
 S GMPL("COMMENT")=CNT D AUDIT
"RTN","GMPLUTL2",115,0)
 Q
"RTN","GMPLUTL2",116,0)
 ;
"RTN","GMPLUTL2",117,0)
RESOLVE(IEN,FIELD,FORMAT) ; Call GET1^DIQ to resolve field values
"RTN","GMPLUTL2",118,0)
 ;  Input:    IEN = Record #
"RTN","GMPLUTL2",119,0)
 ;          FIELD = Field # in PROBLEMS file #9000011
"RTN","GMPLUTL2",120,0)
 ;         FORMAT = "I"nternal, "E"xternal, or "IE" -> both
"RTN","GMPLUTL2",121,0)
 ; Output: GMPLY = value as specified by format
"RTN","GMPLUTL2",122,0)
 N GMPLY
"RTN","GMPLUTL2",123,0)
 S IEN=IEN_","
"RTN","GMPLUTL2",124,0)
 S GMPLY=$$GET1^DIQ(9000011,IEN,FIELD,FORMAT)
"RTN","GMPLUTL2",125,0)
 S:FORMAT="IE" GMPLY=GMPLY_U_$$GET1^DIQ(9000011,IEN,FIELD,"E")
"RTN","GMPLUTL2",126,0)
 Q GMPLY
"RTN","GMPLUTL2",127,0)
AUDIT ; 14 Sep 99 - MA - Add audit trail to OE Problem List.
"RTN","GMPLUTL2",128,0)
 ; Called from DETAIL, requires IFN and sets GMPL("AUDIT")
"RTN","GMPLUTL2",129,0)
 N IDT,AIFN,X0,X1,FLD,CNT
"RTN","GMPLUTL2",130,0)
 S CNT=0,GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",131,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",IFN,IDT)) Q:IDT'>0  D
"RTN","GMPLUTL2",132,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",IFN,IDT,AIFN)) Q:AIFN'>0  D
"RTN","GMPLUTL2",133,0)
 .. S X0=$G(^GMPL(125.8,AIFN,0)),X1=$G(^(1)) Q:'$L(X0)
"RTN","GMPLUTL2",134,0)
 .. S FLD=$$FLDNAME(+$P(X0,U,2))
"RTN","GMPLUTL2",135,0)
 .. S CNT=CNT+1
"RTN","GMPLUTL2",136,0)
 .. S GMPL("AUDIT",CNT,0)=$P(X0,U,2)_U_FLD_U_$P(X0,U,3,8)
"RTN","GMPLUTL2",137,0)
 .. ; = pointer#^fld name^date mod^who mod^old^new^reason^prov
"RTN","GMPLUTL2",138,0)
 .. S:$L(X1) GMPL("AUDIT",CNT,1)=X1
"RTN","GMPLUTL2",139,0)
 S GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",140,0)
 Q
"RTN","GMPLUTL2",141,0)
 ;
"RTN","GMPLUTL2",142,0)
FLDNAME(NUM) ; Returns field name for display
"RTN","GMPLUTL2",143,0)
 N NAME,NM1,NM2,I,J S J=0,NAME=""
"RTN","GMPLUTL2",144,0)
 S NM1=".01^.05^.12^.13^1.01^1.02^1.04^1.05^1.06^1.07^1.08^1.09^1.1^1.11^1.12^1.13^1.14^1.15^1.16^1.17^1.18^80001^80002^80003^80004^80005^302^1101"
"RTN","GMPLUTL2",145,0)
 F I=1:1:$L(NM1,U) I +$P(NM1,U,I)=+NUM S J=I Q
"RTN","GMPLUTL2",146,0)
 G:J'>0 FNQ
"RTN","GMPLUTL2",147,0)
 S NM2="DIAGNOSIS^PROVIDER NARRATIVE^STATUS^DATE OF ONSET^PROBLEM^CONDITION^RECORDING PROVIDER^RESPONSIBLE PROVIDER"
"RTN","GMPLUTL2",148,0)
 S NM2=NM2_"^SERVICE^DATE RESOLVED^CLINIC^DATE RECORDED^SERVICE CONNECTED^AGENT ORANGE EXP^RADIATION EXP^ENV CONTAMINANTS EXP"
"RTN","GMPLUTL2",149,0)
 S NM2=NM2_"^IMMEDIACY^HEAD & NECK CANCER^MIL SEX TRAUMA^COMBAT VET^SHIPBOARD HAZARD EXP^SNOMED CT CONCEPT^SNOMED CT DESIGNATION"
"RTN","GMPLUTL2",150,0)
 S NM2=NM2_"^VHAT CONCEPT^VHAT DESIGNATION^SNOMED CT/ICD MAP STATUS^SECONDARY DIAGNOSIS^NOTE"
"RTN","GMPLUTL2",151,0)
 S NAME=$P(NM2,U,J)
"RTN","GMPLUTL2",152,0)
FNQ Q NAME
"RTN","GMPLUTL2",153,0)
 ;
"RTN","GMPLUTL2",154,0)
ADD(DFN,LOC,GMPROV) ; -- Interactive LMgr action to add new problem
"RTN","GMPLUTL2",155,0)
 N X,Y,GMPDFN,GMPVA,GMPVAMC,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",156,0)
 N GMPARAM,GMPLVIEW,GMPLUSER,GMPCLIN,GMPLSLST,GMPQUIT,VALMCC,GMPSAVED
"RTN","GMPLUTL2",157,0)
 Q:'DFN  Q:'LOC  D SETVARS
"RTN","GMPLUTL2",158,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2),VALMCC=0
"RTN","GMPLUTL2",159,0)
 I 'GMPLSLST,GMPCLIN,$D(^GMPL(125,"C",+GMPCLIN)) S GMPLSLST=$O(^(+GMPCLIN,0))
"RTN","GMPLUTL2",160,0)
 I GMPLSLST D  Q
"RTN","GMPLUTL2",161,0)
 . S $P(GMPLSLST,U,2)=$P($G(^GMPL(125,+GMPLSLST,0)),U)
"RTN","GMPLUTL2",162,0)
 . D EN^VALM("GMPL LIST MENU")
"RTN","GMPLUTL2",163,0)
 F  D ADD^GMPL1 Q:$D(GMPQUIT)  K DUOUT,DTOUT,GMPSAVED W !!,">>>  Please enter another problem, or press <return> to exit."
"RTN","GMPLUTL2",164,0)
 Q
"RTN","GMPLUTL2",165,0)
 ;
"RTN","GMPLUTL2",166,0)
SETVARS ; -- Define GMP* variables used in ADD and EDIT
"RTN","GMPLUTL2",167,0)
 N VA,VADM,VAEL,VASV,X
"RTN","GMPLUTL2",168,0)
 Q:'DFN  D DEM^VADPT,7^VADPT
"RTN","GMPLUTL2",169,0)
 S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")_$S(VADM(6):U_+VADM(6),1:"")
"RTN","GMPLUTL2",170,0)
 S AUPNSEX=$P(VADM(5),U),GMPVA=1,GMPSC=VAEL(3),GMPAGTOR=VASV(2),GMPION=VASV(3)
"RTN","GMPLUTL2",171,0)
 S X=$P($G(^DPT(DFN,.322)),U,10),GMPGULF=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",172,0)
 S GMPCV=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) GMPCV=1 ;CV
"RTN","GMPLUTL2",173,0)
 S GMPSHD=+$G(VASV(14,1)) ;SHAD
"RTN","GMPLUTL2",174,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),GMPHNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLUTL2",175,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),GMPMST=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",176,0)
 S GMPLVIEW("VIEW")=$S($P($G(^SC(+$G(LOC),0)),U,3)="C":"C",1:"S")
"RTN","GMPLUTL2",177,0)
 S GMPCLIN="" I $G(LOC),GMPLVIEW("VIEW")="C" S GMPCLIN=+LOC_U_$P(^SC(+LOC,0),U)
"RTN","GMPLUTL2",178,0)
 S X=$$PARAM,GMPARAM("VER")=+$P(X,U,2),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=+$P(X,U,5)
"RTN","GMPLUTL2",179,0)
 S:+GMPROV=DUZ GMPLUSER=1 S GMPVAMC=+$G(DUZ(2)),GMPLIST(0)=0
"RTN","GMPLUTL2",180,0)
 Q
"RTN","GMPLUTL2",181,0)
 ;
"RTN","GMPLUTL2",182,0)
EDIT(DFN,LOC,GMPROV,GMPIFN) ; Interactive LMgr action to edit a problem
"RTN","GMPLUTL2",183,0)
 N GMPARAM,GMPDFN,GMPVA,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",184,0)
 N GMPLVIEW,GMPCLIN,GMPLJUMP,GMPQUIT,GMPLUSER,GMPLVAMC,AUPNSEX
"RTN","GMPLUTL2",185,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPLUTL2",186,0)
 D SETVARS,EN^VALM("GMPL EDIT PROBLEM")
"RTN","GMPLUTL2",187,0)
 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPLUTL2",188,0)
 Q
"RTN","GMPLUTL2",189,0)
 ;
"RTN","GMPLUTL2",190,0)
REMOVE(GMPIFN,GMPROV,TEXT,PLY) ; -- Remove problem GMPIFN
"RTN","GMPLUTL2",191,0)
 N GMPVAMC,CHANGE
"RTN","GMPLUTL2",192,0)
 S GMPVAMC=+$G(DUZ(2)),PLY=-1,PLY(0)=""
"RTN","GMPLUTL2",193,0)
 I '$L($G(^AUPNPROB(GMPIFN,0))) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL2",194,0)
 I '$D(^VA(200,+$G(GMPROV),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL2",195,0)
 I $L($G(TEXT)) S GMPFLD(10,"NEW",1)=TEXT D NEWNOTE^GMPLSAVE
"RTN","GMPLUTL2",196,0)
 S CHANGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_U_$P($G(^AUPNPROB(GMPIFN,1)),U,2)_"^H^Deleted^"_+$G(GMPROV),$P(^AUPNPROB(GMPIFN,1),U,2)="H",PLY=GMPIFN
"RTN","GMPLUTL2",197,0)
 D AUDIT^GMPLX(CHANGE,""),DTMOD^GMPLX(GMPIFN)
"RTN","GMPLUTL2",198,0)
 Q
"RTN","GMPLUTL2",199,0)
 ;
"RTN","GMPLUTL2",200,0)
PARAM() ; -- Returns parameter values from 125.99
"RTN","GMPLUTL2",201,0)
 Q $G(^GMPL(125.99,1,0))
"RTN","GMPLUTL2",202,0)
 ;
"RTN","GMPLUTL2",203,0)
VAF(DFN,SILENT) ; -- print PL VA Form chart copy
"RTN","GMPLUTL2",204,0)
 ;
"RTN","GMPLUTL2",205,0)
 N VA,VADM,VAERR,GMPDFN,GMPVAMC,X,GMPARAM,GMPRT,GMPQUIT,GMPLCURR
"RTN","GMPLUTL2",206,0)
 Q:'$G(DFN)  D DEM^VADPT S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")
"RTN","GMPLUTL2",207,0)
 S GMPVAMC=+$G(DUZ(2)),GMPARAM("QUIET")=1
"RTN","GMPLUTL2",208,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLUTL2",209,0)
 D VAF^GMPLPRNT I '$G(SILENT) D  Q:$G(GMPQUIT)
"RTN","GMPLUTL2",210,0)
 . I GMPRT'>0 W !!,"No problems available." S GMPQUIT=1 Q
"RTN","GMPLUTL2",211,0)
 . D DEVICE^GMPLPRNT Q:$G(GMPQUIT)  D CLEAR^VALM1
"RTN","GMPLUTL2",212,0)
 D PRT^GMPLPRNT
"RTN","GMPLUTL2",213,0)
 Q
"RTN","GMPLUTL2",214,0)
SCTTEXT(GMPLCODE,GMPDT,GMPSYS) ; Get Preferred Text for SCT Code
"RTN","GMPLUTL2",215,0)
 N %DT,GMPY,LEX,LEXY S GMPY="",GMPDT=$G(GMPDT,DT),GMPSYS=$G(GMPSYS,"SCT")
"RTN","GMPLUTL2",216,0)
 S LEXY=$$CODE^LEXTRAN(GMPLCODE,GMPSYS,GMPDT)
"RTN","GMPLUTL2",217,0)
 I '+LEXY G SCTTEXQ
"RTN","GMPLUTL2",218,0)
 S GMPY=$G(LEX("P"))
"RTN","GMPLUTL2",219,0)
SCTTEXQ Q GMPY
"RTN","GMPLUTL2",220,0)
ICDDESC(GMPLCODE,GMPDT,GMPLCSYS) ; Get description for ICD Code
"RTN","GMPLUTL2",221,0)
 N ICDD,GMPY,ICDY S GMPY="",GMPDT=$G(GMPDT,DT)
"RTN","GMPLUTL2",222,0)
 S:'$G(GMPLCSYS) GMPLCSYS=$$SAB^ICDEX($P($$CODECS^ICDEX(GMPLCODE,80,GMPDT),U),GMPDT)
"RTN","GMPLUTL2",223,0)
 S ICDY=$$ICDDESC^ICDXCODE(GMPLCSYS,GMPLCODE,GMPDT,.ICDD)
"RTN","GMPLUTL2",224,0)
 I 'ICDY G ICDDESQ
"RTN","GMPLUTL2",225,0)
 S GMPY=$G(ICDD(1))
"RTN","GMPLUTL2",226,0)
ICDDESQ Q GMPY
"RTN","GMPLUTL3")
0^2^B19624792
"RTN","GMPLUTL3",1,0)
GMPLUTL3 ; SLC/JST/JVS/TC -- PL Utilities (CIRN)           ;08/22/12  08:50
"RTN","GMPLUTL3",2,0)
 ;;2.0;Problem List;**14,15,19,25,26,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLUTL3",3,0)
 ;
"RTN","GMPLUTL3",4,0)
 ; External References
"RTN","GMPLUTL3",5,0)
 ;   DBIA  5699  $$ICDDATA^ICDXCODE
"RTN","GMPLUTL3",6,0)
 ;
"RTN","GMPLUTL3",7,0)
 ; This routine is primarily called by CIRN for use
"RTN","GMPLUTL3",8,0)
 ; in HL7 (RGHOPL), and Historical Load (RGHOPLB),
"RTN","GMPLUTL3",9,0)
 ; record creation.
"RTN","GMPLUTL3",10,0)
 ;
"RTN","GMPLUTL3",11,0)
 ; NOTE: This routine DOES NOT NEW the variables
"RTN","GMPLUTL3",12,0)
 ;       that are set below.
"RTN","GMPLUTL3",13,0)
 ;
"RTN","GMPLUTL3",14,0)
CALL0(GMPLZ) ; Call 0 - Get Node 0
"RTN","GMPLUTL3",15,0)
 N GMPLCOND I $P($G(^AUPNPROB(GMPLZ,1)),"^",2)="H" S GMPLCOND="H" D CLEAR Q
"RTN","GMPLUTL3",16,0)
 I '$D(^AUPNPROB(GMPLZ,0)) D CLEAR Q
"RTN","GMPLUTL3",17,0)
 D NODE0
"RTN","GMPLUTL3",18,0)
 Q
"RTN","GMPLUTL3",19,0)
 ;
"RTN","GMPLUTL3",20,0)
CALL1(GMPLZ) ; Call 1 - Get Node 1
"RTN","GMPLUTL3",21,0)
 N GMPLCOND I $P($G(^AUPNPROB(GMPLZ,1)),"^",2)="H" S GMPLCOND="H" D CLEAR Q
"RTN","GMPLUTL3",22,0)
 I '$D(^AUPNPROB(GMPLZ,0)) D CLEAR Q
"RTN","GMPLUTL3",23,0)
 D NODE1
"RTN","GMPLUTL3",24,0)
 Q
"RTN","GMPLUTL3",25,0)
 ;
"RTN","GMPLUTL3",26,0)
CALL2(GMPLZ) ; Call 2 - Get both Node 0 and Node 1
"RTN","GMPLUTL3",27,0)
 I $P($G(^AUPNPROB(GMPLZ,1)),"^",2)="H" S GMPLCOND="H" D CLEAR Q
"RTN","GMPLUTL3",28,0)
 I '$D(^AUPNPROB(GMPLZ,0)) D CLEAR Q
"RTN","GMPLUTL3",29,0)
 D NODE0,NODE1
"RTN","GMPLUTL3",30,0)
 Q
"RTN","GMPLUTL3",31,0)
 ;
"RTN","GMPLUTL3",32,0)
NODE0 ; Set Node 0 data variables
"RTN","GMPLUTL3",33,0)
 N GMPLZ0
"RTN","GMPLUTL3",34,0)
 S GMPLZ0=$G(^AUPNPROB(GMPLZ,0))
"RTN","GMPLUTL3",35,0)
 ;   Diagnosis
"RTN","GMPLUTL3",36,0)
 S GMPLICD=$P(GMPLZ0,U)
"RTN","GMPLUTL3",37,0)
 ;   Patient Name
"RTN","GMPLUTL3",38,0)
 S GMPLPNAM=$P(GMPLZ0,U,2)
"RTN","GMPLUTL3",39,0)
 ;   Date Last Modifed
"RTN","GMPLUTL3",40,0)
 S GMPLDLM=$P(GMPLZ0,U,3)
"RTN","GMPLUTL3",41,0)
 ;   Provider Narrative
"RTN","GMPLUTL3",42,0)
 S GMPLTXT=$P(GMPLZ0,U,5)
"RTN","GMPLUTL3",43,0)
 ;   Status
"RTN","GMPLUTL3",44,0)
 S GMPLSTAT=$P(GMPLZ0,U,12)
"RTN","GMPLUTL3",45,0)
 ;   Date of Onset
"RTN","GMPLUTL3",46,0)
 S GMPLODAT=$P(GMPLZ0,U,13)
"RTN","GMPLUTL3",47,0)
 ;   Date Entered
"RTN","GMPLUTL3",48,0)
 S:'GMPLODAT GMPLODAT=$P(GMPLZ0,U,8)
"RTN","GMPLUTL3",49,0)
 Q
"RTN","GMPLUTL3",50,0)
 ;
"RTN","GMPLUTL3",51,0)
NODE1 ; Set Node 1 data variables
"RTN","GMPLUTL3",52,0)
 N GMPLZ1
"RTN","GMPLUTL3",53,0)
 S GMPLZ1=$G(^AUPNPROB(GMPLZ,1))
"RTN","GMPLUTL3",54,0)
 ;   Problem
"RTN","GMPLUTL3",55,0)
 S GMPLLEX=$P(GMPLZ1,U)
"RTN","GMPLUTL3",56,0)
 ;   Condition
"RTN","GMPLUTL3",57,0)
 S GMPLCOND=$P(GMPLZ1,U,2)
"RTN","GMPLUTL3",58,0)
 ;   Recording Provider
"RTN","GMPLUTL3",59,0)
 S GMPLPRV=$P(GMPLZ1,U,4)
"RTN","GMPLUTL3",60,0)
 ;   Responsible Provider
"RTN","GMPLUTL3",61,0)
 S:'GMPLPRV GMPLPRV=$P(GMPLZ1,U,5)
"RTN","GMPLUTL3",62,0)
 ;   Date Resolved
"RTN","GMPLUTL3",63,0)
 S GMPLXDAT=$P(GMPLZ1,U,7)
"RTN","GMPLUTL3",64,0)
 ;   Priority
"RTN","GMPLUTL3",65,0)
 S GMPLPRIO=$P(GMPLZ1,U,14)
"RTN","GMPLUTL3",66,0)
 Q
"RTN","GMPLUTL3",67,0)
 ;
"RTN","GMPLUTL3",68,0)
CLEAR ; Set Variables Equal to Null
"RTN","GMPLUTL3",69,0)
 S (GMPLZ0,GMPLICD,GMPLPNAM,GMPLDLM,GMPLTXT,GMPLSTAT,GMPLODAT)=""
"RTN","GMPLUTL3",70,0)
 S (GMPLZ1,GMPLLEX,GMPLPRV,GMPLXDAT,GMPLPRIO,GMPLCOND)=""
"RTN","GMPLUTL3",71,0)
 Q
"RTN","GMPLUTL3",72,0)
MOD(DFN) ; Return the Date the Patients Problem List was Last Modified
"RTN","GMPLUTL3",73,0)
 Q +$O(^AUPNPROB("MODIFIED",DFN,0))
"RTN","GMPLUTL3",74,0)
LIST ; Returns list of Problems for Patient
"RTN","GMPLUTL3",75,0)
 ;
"RTN","GMPLUTL3",76,0)
 ;   Input   GMPDFN  Pointer to Patient file #2
"RTN","GMPLUTL3",77,0)
 ;           GMPCOMP Display Comments 1/0
"RTN","GMPLUTL3",78,0)
 ;           GMTSTAT Status A/I/""
"RTN","GMPLUTL3",79,0)
 ;
"RTN","GMPLUTL3",80,0)
 ;   Output  GMPL    Array, passed by reference
"RTN","GMPLUTL3",81,0)
 ;           GMPL(#)
"RTN","GMPLUTL3",82,0)
 ;             Piece 1:  Pointer to Problem #9000011
"RTN","GMPLUTL3",83,0)
 ;                   2:  Status
"RTN","GMPLUTL3",84,0)
 ;                   3:  Provider Narrative
"RTN","GMPLUTL3",85,0)
 ;                   4:  ICD code
"RTN","GMPLUTL3",86,0)
 ;                   5:  Date of Onset
"RTN","GMPLUTL3",87,0)
 ;                   6:  Date Last Modified
"RTN","GMPLUTL3",88,0)
 ;                   7:  Service Connected
"RTN","GMPLUTL3",89,0)
 ;                   8:  Special Exposures
"RTN","GMPLUTL3",90,0)
 ;                   9:  Priority
"RTN","GMPLUTL3",91,0)
 ;                  10:  Transcribed Problem or not
"RTN","GMPLUTL3",92,0)
 ;                  11:  SNOMED-CT Concept code
"RTN","GMPLUTL3",93,0)
 ;                  12:  SNOMED-CT Designation code
"RTN","GMPLUTL3",94,0)
 ;                  13:  ICD Coding System (ex: ICD-10-CM="10D", ICD-9-CM="ICD")
"RTN","GMPLUTL3",95,0)
 ;       GMPL(1,"ICDD")  ICD Description
"RTN","GMPLUTL3",96,0)
 ;           GMPL(#,C#)  Comments
"RTN","GMPLUTL3",97,0)
 ;           GMPL(0)     Number of Problems Returned
"RTN","GMPLUTL3",98,0)
 ;
"RTN","GMPLUTL3",99,0)
 N CNT,NUM,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL3",100,0)
 Q:$G(GMPDFN)'>0  S CNT=0
"RTN","GMPLUTL3",101,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL3",102,0)
 S GMPLVIEW("ACT")=GMPSTAT,GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL3",103,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL3",104,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL3",105,0)
 . N GMPL0,GMPL1,GMPL800,GMPL802,ICD,ICDD,IFN,LASTMOD,ONSET,SC,SCS,SCTC,SCTD,SP,ST,GMPLCSYS,GMPLDT
"RTN","GMPLUTL3",106,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL3",107,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),GMPL800=$G(^(800)),GMPL802=$G(^(802)),CNT=CNT+1
"RTN","GMPLUTL3",108,0)
 . S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLUTL3",109,0)
 . S ICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2),LASTMOD=$P(GMPL0,U,3)
"RTN","GMPLUTL3",110,0)
 . S ST=$P(GMPL0,U,12),ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL3",111,0)
 . S SC=$S(+$P(GMPL1,U,10):"SC",$P(GMPL1,U,10)=0:"NSC",1:"")
"RTN","GMPLUTL3",112,0)
 . D SCS^GMPLX1(IFN,.SCS) S SP=$G(SCS(3))
"RTN","GMPLUTL3",113,0)
 . S SCTC=$P(GMPL800,U),SCTD=$P(GMPL800,U,2)
"RTN","GMPLUTL3",114,0)
 . I +SCTC'>0&(+SCTD'>0) S ICDD=$$ICDDESC^GMPLUTL2(ICD,GMPLDT,GMPLCSYS)
"RTN","GMPLUTL3",115,0)
 . S GMPL(CNT)=IFN_U_ST_U_$$PROBTEXT^GMPLX(IFN)_U_ICD_U_ONSET_U_LASTMOD_U_SC_U_SP_U_$S($P(GMPL1,U,14)="A":"*",1:"")_U_$S('$P($G(^GMPL(125.99,1,0)),U,2):"",$P(GMPL1,U,2)'="T":"",1:"$")_U_SCTC_U_SCTD_U_GMPLCSYS
"RTN","GMPLUTL3",116,0)
 . I $L($G(ICDD)) S GMPL(CNT,"ICDD")=ICDD
"RTN","GMPLUTL3",117,0)
 . I $G(GMPCOMM) D
"RTN","GMPLUTL3",118,0)
 . . N FAC,NIFN,NOTE,NOTECNT
"RTN","GMPLUTL3",119,0)
 . . S NOTECNT=0,FAC=0
"RTN","GMPLUTL3",120,0)
 . . F  S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLUTL3",121,0)
 . . . S NIFN=0
"RTN","GMPLUTL3",122,0)
 . . . F  S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:NIFN'>0  D
"RTN","GMPLUTL3",123,0)
 . . . . S NOTE=$P($G(^AUPNPROB(IFN,11,FAC,11,NIFN,0)),U,3)
"RTN","GMPLUTL3",124,0)
 . . . . S NOTECNT=NOTECNT+1,GMPL(CNT,NOTECNT)=NOTE
"RTN","GMPLUTL3",125,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL3",126,0)
 Q
"RTN","GMPLX")
0^11^B101606054
"RTN","GMPLX",1,0)
GMPLX ; ISL/MKB,AJB,JER,TC -- Problem List Problem Utilities ;07/10/13  13:28
"RTN","GMPLX",2,0)
 ;;2.0;Problem List;**7,23,26,28,27,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLX",3,0)
 ;
"RTN","GMPLX",4,0)
 ; External References
"RTN","GMPLX",5,0)
 ;  DBIA   446 ^AUTNPOV(
"RTN","GMPLX",6,0)
 ;   ICR  5679 $$IMPDATE^LEXU
"RTN","GMPLX",7,0)
 ;   ICR  5699 $$ICDDATA^ICDXCODE,$$STATCHK^ICDXCODE
"RTN","GMPLX",8,0)
 ;   ICR  5747 $$CSI/SAB^ICDEX
"RTN","GMPLX",9,0)
 ;  DBIA 10060 ^VA(200
"RTN","GMPLX",10,0)
 ;  DBIA 10006 ^DIC
"RTN","GMPLX",11,0)
 ;  DBIA 10009 FILE^DICN
"RTN","GMPLX",12,0)
 ;  DBIA 10013 EN^DIK
"RTN","GMPLX",13,0)
 ;  DBIA 10013 IX1^DIK
"RTN","GMPLX",14,0)
 ;  DBIA 10026 ^DIR
"RTN","GMPLX",15,0)
 ;  DBIA  1609 CONFIG^LEXSET
"RTN","GMPLX",16,0)
 ;  DBIA 10103 $$FMTE^XLFDT
"RTN","GMPLX",17,0)
 ;  DBIA 10104 $$UP^XLFSTR
"RTN","GMPLX",18,0)
 ;  DBIA  2742 GMPLX
"RTN","GMPLX",19,0)
 ;
"RTN","GMPLX",20,0)
SEARCH(X,Y,PROMPT,UNRES,VIEW) ; Search Lexicon for Problem X
"RTN","GMPLX",21,0)
 N DIC S:'$L($G(VIEW)) VIEW="PLS" D CONFIG^LEXSET("GMPX",VIEW,DT)
"RTN","GMPLX",22,0)
 S DIC("A")=$S($L($G(PROMPT)):PROMPT,1:"Select PROBLEM: ")
"RTN","GMPLX",23,0)
 S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"A",1:"")_"EQM"
"RTN","GMPLX",24,0)
 S:'$G(UNRES) LEXUN=0 D ^DIC
"RTN","GMPLX",25,0)
 I +Y>1 D
"RTN","GMPLX",26,0)
 .N CODE,SRC
"RTN","GMPLX",27,0)
 .S X=$P(Y,U,2)
"RTN","GMPLX",28,0)
 .D EXP2CODE(+Y,.SRC,.CODE)
"RTN","GMPLX",29,0)
 .I (SRC["SNOMED")!(SRC["VHAT") S (X,$P(Y,U,2))=X_" ("_$S(SRC["SNOMED":"SCT",1:"VHAT")_" "_CODE_")",Y(1)=$$GETDX(CODE,SRC)
"RTN","GMPLX",30,0)
 Q
"RTN","GMPLX",31,0)
 ;
"RTN","GMPLX",32,0)
PROVNARR(X,CL) ; Returns IFN ^ Text of Narrative (#9999999.27)
"RTN","GMPLX",33,0)
 N DIC,Y,DLAYGO,DD,DO,DA S:$L(X)>245 X=$E(X,1,245)
"RTN","GMPLX",34,0)
 S DIC="^AUTNPOV(",DIC(0)="L",DLAYGO=9999999.27,(DA,Y)=0
"RTN","GMPLX",35,0)
 F  S DA=$O(^AUTNPOV("B",$E(X,1,30),DA)) Q:DA'>0  I $P(^AUTNPOV(DA,0),U)=X S Y=DA_U_X Q
"RTN","GMPLX",36,0)
 I '(+Y) K DA,Y D FILE^DICN S:Y'>0 Y=U_X I Y>0,CL>1 S ^AUTNPOV(+Y,757)=CL
"RTN","GMPLX",37,0)
 Q $P(Y,U,1,2)
"RTN","GMPLX",38,0)
 ;
"RTN","GMPLX",39,0)
PROBTEXT(IFN) ; Returns Display Text
"RTN","GMPLX",40,0)
 N X,Y,ICD,SCTC,GMPL0,GMPL800,GMPL802,GMPLEXP,GMPLPOV,GMPLSO,GMPLTXT,GMPLDT,GMPLCSYS,GMPLILBL
"RTN","GMPLX",41,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL800=$G(^(800)),GMPL802=$G(^(802))
"RTN","GMPLX",42,0)
 I '$L(GMPL0) S X="" G PROBTX
"RTN","GMPLX",43,0)
 S GMPLDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+GMPL0),GMPLDT))
"RTN","GMPLX",44,0)
 S GMPLILBL=$S(GMPLCSYS="10D":"ICD-10-CM ",1:"ICD-9-CM ")
"RTN","GMPLX",45,0)
 S ICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,GMPLDT,"I"),U,2),SCTC=$P(GMPL800,U)
"RTN","GMPLX",46,0)
 S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",47,0)
 S GMPLEXP=$$EP(IFN),GMPLSO=$$CS(X),GMPLPOV=$$PT(X,GMPLSO)
"RTN","GMPLX",48,0)
 S GMPLTXT=GMPLPOV S:$L(GMPLEXP) GMPLTXT=GMPLTXT_" ("_GMPLEXP_")"
"RTN","GMPLX",49,0)
 ;S:$L(GMPLSO)&(GMPLSO'["SNOMED") GMPLTXT=GMPLTXT_" "_GMPLSO
"RTN","GMPLX",50,0)
 S:GMPLTXT["*" GMPLTXT=$TR(GMPLTXT,"*","")
"RTN","GMPLX",51,0)
 ;S:$L(GMPLTXT) GMPLTXT=GMPLTXT_" ("_$$HFP^GMPLUTL4_","_$$PTR^GMPLUTL4_")"
"RTN","GMPLX",52,0)
 S:$L(GMPLTXT) GMPLTXT=GMPLTXT_$S($L($G(ICD))&('$L($G(SCTC))):" ("_GMPLILBL_$G(ICD)_")",$L($G(SCTC)):" (SCT "_$G(SCTC)_")",1:"")
"RTN","GMPLX",53,0)
 S:$L(GMPLTXT) X=GMPLTXT
"RTN","GMPLX",54,0)
PROBTX Q X
"RTN","GMPLX",55,0)
PROBNARR(IFN) ; Returns Provider Narrative
"RTN","GMPLX",56,0)
 N X,Y S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",57,0)
 Q X
"RTN","GMPLX",58,0)
CS(X) ; Problem Codes
"RTN","GMPLX",59,0)
 N GMPLSAB,GMPLSO S GMPLSO="" S X=$G(X) Q:X'["(" ""
"RTN","GMPLX",60,0)
 F GMPLSAB="ICD-","CPT-","DSM-","HCPCS","NANDA","NIC","NOC","LOINC","SNOMED","OMAHA","SCT" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",61,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",62,0)
 F GMPLSAB="ACR","AI/RHEUM","CONGRESS","COSTAR","COSTART","CRISP","DODFAC" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",63,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",64,0)
 F GMPLSAB="DORLAND","DXPLAIN","HHCC","MCMASTER","META","MTF","MeSH","RVC","TITLE 38","UMDNS","UWA" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",65,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",66,0)
 Q ""
"RTN","GMPLX",67,0)
EP(X) ; Exposures
"RTN","GMPLX",68,0)
 N GMPLSC S X=+($G(X)) D SCS^GMPLX1(+X,.GMPLSC) S X=$G(GMPLSC(1)) Q X
"RTN","GMPLX",69,0)
PT(X,C) ; Problem Text (only)
"RTN","GMPLX",70,0)
 N GMPLTERM,GMPLSO S GMPLTERM=$G(X),GMPLSO=$G(C)
"RTN","GMPLX",71,0)
 S:$L(GMPLSO)&(GMPLTERM[GMPLSO) GMPLTERM=$P(GMPLTERM,GMPLSO,1) S GMPLTERM=$$TRIM(GMPLTERM)
"RTN","GMPLX",72,0)
 S:$L(GMPLTERM) X=GMPLTERM Q X
"RTN","GMPLX",73,0)
TRIM(X) ; Trim Spaces and "*"
"RTN","GMPLX",74,0)
 S X=$G(X) F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",75,0)
 F  Q:$E(X,$L(X))'="*"  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",76,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",77,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMPLX",78,0)
 Q X
"RTN","GMPLX",79,0)
WRAP(PROB,MAX,TEXT) ; Splits Text into TEXT array
"RTN","GMPLX",80,0)
 N I,J S J=0 K TEXT I $L(PROB)'>MAX S J=J+1,TEXT(J)=PROB G WRQ
"RTN","GMPLX",81,0)
WR0 ;   Loop for Remaining Text
"RTN","GMPLX",82,0)
 S I=$F(PROB," ") I ('I)!(I>(MAX+2)) S J=J+1,TEXT(J)=$E(PROB,1,MAX),PROB=$E(PROB,MAX+1,999)
"RTN","GMPLX",83,0)
 I $L(PROB)>MAX F I=(MAX+1):-1:1 I $E(PROB,I)=" " S J=J+1,TEXT(J)=$E(PROB,1,I-1),PROB=$E(PROB,I+1,999) Q
"RTN","GMPLX",84,0)
 G:$L(PROB)>MAX WR0
"RTN","GMPLX",85,0)
 S:$L(PROB) J=J+1,TEXT(J)=PROB
"RTN","GMPLX",86,0)
WRQ ;   Quit Wrap
"RTN","GMPLX",87,0)
 S TEXT=J
"RTN","GMPLX",88,0)
 Q
"RTN","GMPLX",89,0)
 ;
"RTN","GMPLX",90,0)
NOS(GMPLCSYS,GMPLDT) ; Return PTR ^ 799.9 or PTR ^ R69 ICD code
"RTN","GMPLX",91,0)
 N GMPIMPDT S GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLX",92,0)
 S:'$D(GMPLDT) GMPLDT=DT
"RTN","GMPLX",93,0)
 S:'$D(GMPLCSYS) GMPLCSYS=$S(GMPLDT<GMPIMPDT:"ICD",1:"10D")
"RTN","GMPLX",94,0)
 Q $S(GMPLCSYS="10D":+$$ICDDATA^ICDXCODE(GMPLCSYS,"R69.",GMPLDT,"E")_"^R69.",1:+$$ICDDATA^ICDXCODE(GMPLCSYS,"799.9",GMPLDT,"E")_"^799.9")
"RTN","GMPLX",95,0)
 ;
"RTN","GMPLX",96,0)
SEL(HELP) ; Select List of Problems
"RTN","GMPLX",97,0)
 N X,Y,DIR,MAX,DTOUT S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",98,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select Problem(s)"
"RTN","GMPLX",99,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",100,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",101,0)
 S DIR("?")="Enter the problems you wish to "
"RTN","GMPLX",102,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")_", as a range or list of numbers"
"RTN","GMPLX",103,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",104,0)
 Q Y
"RTN","GMPLX",105,0)
 ;
"RTN","GMPLX",106,0)
SEL1(HELP) ; Select 1 Problem
"RTN","GMPLX",107,0)
 N X,Y,DIR,MAX,DTOUT S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",108,0)
 S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select Problem"
"RTN","GMPLX",109,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",110,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",111,0)
 S DIR("?")="Enter the number of the problem you wish to "
"RTN","GMPLX",112,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")
"RTN","GMPLX",113,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",114,0)
 Q Y
"RTN","GMPLX",115,0)
 ;
"RTN","GMPLX",116,0)
DUPL(DFN,TERM,TEXT) ; Check for Duplicates
"RTN","GMPLX",117,0)
 N DA,IFN,GMPOTHR,GMPNOW S DA=0,TEXT=$$UP^XLFSTR($S(TEXT["SCT":$P(TEXT," (SCT"),1:TEXT))
"RTN","GMPLX",118,0)
 I '$D(^AUPNPROB("AC",DFN)) G DUPLX
"RTN","GMPLX",119,0)
 S GMPNOW=$E($$NOW^XLFDT,1,7)
"RTN","GMPLX",120,0)
 S GMPOTHR=$S(GMPNOW<($$IMPDATE^LEXU("10D")):"799.9",1:"R69.")
"RTN","GMPLX",121,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",DFN,IFN)) Q:IFN'>0  D  Q:DA>0
"RTN","GMPLX",122,0)
 .N PICDOLD,PICDNEW,NODE0,NODE1,NODE800,NODE802,NODE803,SCTD,PROVNAR,EXPTXT,GMPSRC,GMPCODE,GMPLDT,GMPLCSYS
"RTN","GMPLX",123,0)
 .S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)),NODE800=$G(^(800)),NODE802=$G(^(802)),NODE803=$G(^(803,0)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLX",124,0)
 .S GMPLDT=$S(+$P(NODE802,U,1):$P(NODE802,U,1),1:$P(NODE0,U,8)),GMPLCSYS=$S($P(NODE802,U,2)]"":$P(NODE802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,+NODE0),GMPLDT))
"RTN","GMPLX",125,0)
 .S PICDOLD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+NODE0,GMPLDT,"I"),U,2)
"RTN","GMPLX",126,0)
 .D EXP2CODE(TERM,.GMPSRC,.GMPCODE)
"RTN","GMPLX",127,0)
 .S ICDNEW=$S(GMPSRC="SNOMED CT":$$GETDX(GMPCODE,GMPSRC),1:GMPCODE)
"RTN","GMPLX",128,0)
 .S PICDNEW=$P(ICDNEW,"/")
"RTN","GMPLX",129,0)
 .;Compare problems with SNOMED CT concept codes & ICD code(s) only
"RTN","GMPLX",130,0)
 .I +NODE800,(GMPSRC="SNOMED CT"),(+$G(GMPCODE)>0),($L(ICDNEW)) D  Q
"RTN","GMPLX",131,0)
 ..;if SCT concepts & primary + multiple ICD targets match => dup
"RTN","GMPLX",132,0)
 ..I $P(NODE803,U,4)>0,ICDNEW["/" D
"RTN","GMPLX",133,0)
 ...N I,J,SICDNEW S J=0 F I=2:1:$L(ICDNEW,"/") D
"RTN","GMPLX",134,0)
 ....S J=J+1,SICDNEW(J)=$P(ICDNEW,"/",I)
"RTN","GMPLX",135,0)
 ...N T F T=1:1:J D
"RTN","GMPLX",136,0)
 ....N IEN S IEN=0 F  S IEN=$O(^AUPNPROB(IFN,803,IEN)) Q:'+IEN  D
"RTN","GMPLX",137,0)
 .....I +NODE800=GMPCODE,(PICDOLD=PICDNEW),$P($G(^AUPNPROB(IFN,803,IEN,0)),U)=SICDNEW(T) S DA=IFN Q
"RTN","GMPLX",138,0)
 ..;if SCT concept codes match => dup
"RTN","GMPLX",139,0)
 ..E  I ICDNEW=GMPOTHR!(PICDNEW=GMPOTHR) D
"RTN","GMPLX",140,0)
 ...I +NODE800=GMPCODE S DA=IFN Q
"RTN","GMPLX",141,0)
 ..;if SCT concepts & primary ICD diagnosis match => dup
"RTN","GMPLX",142,0)
 ..E  I +NODE800=GMPCODE,(PICDOLD=PICDNEW) S DA=IFN Q
"RTN","GMPLX",143,0)
 .;Compare legacy problems with ICD codes only
"RTN","GMPLX",144,0)
 .E  I +NODE0,'$L($G(NODE800)),(GMPSRC["ICD"),(+$G(GMPCODE)>0) D
"RTN","GMPLX",145,0)
 ..;if Exprs match => dup
"RTN","GMPLX",146,0)
 ..I TERM>1&(+NODE1=TERM) S DA=IFN Q
"RTN","GMPLX",147,0)
 ..;if Text matches Expr from old => dup
"RTN","GMPLX",148,0)
 ..D LOOK^LEXA("`"_+NODE1)
"RTN","GMPLX",149,0)
 ..S EXPTXT=$P($G(LEX("LIST",1)),U,2)
"RTN","GMPLX",150,0)
 ..I LEX>1&(TEXT=$$UP^XLFSTR($S(EXPTXT["*":$P(EXPTXT," *"),1:EXPTXT))) S DA=IFN Q
"RTN","GMPLX",151,0)
 ..;if Text matches Prov Narr of old => dup
"RTN","GMPLX",152,0)
 ..S PROVNAR=$S($P(NODE0,U,5)]"":$P(^AUTNPOV($P(NODE0,U,5),0),U),1:"")
"RTN","GMPLX",153,0)
 ..I TEXT=$$UP^XLFSTR($S(PROVNAR["SNOMED":$P(PROVNAR," (SN"),PROVNAR[" *":$P(PROVNAR,"*"),1:PROVNAR)) S DA=IFN Q
"RTN","GMPLX",154,0)
 ..;if prim ICD of new = prim ICD of old => dup
"RTN","GMPLX",155,0)
 ..I PICDOLD'=GMPOTHR,(PICDNEW'=GMPOTHR),(PICDOLD=PICDNEW) S DA=IFN Q
"RTN","GMPLX",156,0)
DUPLX Q DA
"RTN","GMPLX",157,0)
 ;
"RTN","GMPLX",158,0)
DUPLOK(IFN) ; Ask if Dup OK
"RTN","GMPLX",159,0)
 N DIR,X,Y,GMPL0,GMPL1,DATE,PROV S DIR(0)="YA",GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLX",160,0)
 S DIR("A")="Are you sure you want to continue? ",DIR("B")="NO"
"RTN","GMPLX",161,0)
 S DIR("?",1)="Enter YES if you want to duplicate this problem on this patient's list;",DIR("?")="press <return> to re-enter the problem name."
"RTN","GMPLX",162,0)
 W $C(7),!!,">>>  "_$$PROBTEXT(IFN),!?5,"is already an "
"RTN","GMPLX",163,0)
 W $S($P(GMPL0,U,12)="I":"IN",1:"")_"ACTIVE problem on this patient's list!",!
"RTN","GMPLX",164,0)
 S PROV=+$P(GMPL1,U,5) W:PROV !?5,"Provider: "_$P($G(^VA(200,PROV,0)),U)_" ("_$P($$SERVICE^GMPLX1(PROV),U,2)_")"
"RTN","GMPLX",165,0)
 I $P(GMPL0,U,12)="A" W !?8,"Onset: " S DATE=$P(GMPL0,U,13)
"RTN","GMPLX",166,0)
 I $P(GMPL0,U,12)="I" W !?5,"Resolved: " S DATE=$P(GMPL1,U,7)
"RTN","GMPLX",167,0)
 W $S(DATE>0:$$FMTE^XLFDT(DATE),1:"unspecified"),!
"RTN","GMPLX",168,0)
 D ^DIR W !
"RTN","GMPLX",169,0)
 Q +Y
"RTN","GMPLX",170,0)
 ;
"RTN","GMPLX",171,0)
LOCKED() ; Return Lock Msg
"RTN","GMPLX",172,0)
 Q "This problem is currently being edited by another user!"
"RTN","GMPLX",173,0)
 ;
"RTN","GMPLX",174,0)
SURE() ; Ask to Delete
"RTN","GMPLX",175,0)
 ;   Returns 1 if YES, else 0
"RTN","GMPLX",176,0)
 N DIR,X,Y S DIR(0)="YA",DIR("B")="NO"
"RTN","GMPLX",177,0)
 S DIR("?")="Enter YES to remove this value or NO to leave it unchanged."
"RTN","GMPLX",178,0)
 S DIR("A")="Are you sure you want to remove this value? " D ^DIR
"RTN","GMPLX",179,0)
 Q +Y
"RTN","GMPLX",180,0)
 ;
"RTN","GMPLX",181,0)
EXTDT(DATE) ; Format Date as MM/DD/YY
"RTN","GMPLX",182,0)
 N X,MM,DD,YY,YYY S X="",DATE=$P(DATE,".") Q:'DATE ""
"RTN","GMPLX",183,0)
 S MM=+$E(DATE,4,5),DD=+$E(DATE,6,7),YY=$E(DATE,2,3),YYY=$E(DATE,1,3)
"RTN","GMPLX",184,0)
 S:MM X=MM_"/" S:DD X=X_DD_"/" S X=$S($L(X):X_YY,1:1700+YYY)
"RTN","GMPLX",185,0)
 Q X
"RTN","GMPLX",186,0)
 ;
"RTN","GMPLX",187,0)
AUDIT(DATA,OLD) ; Make Entry in Audit File
"RTN","GMPLX",188,0)
 ; DATA = string for 0-node
"RTN","GMPLX",189,0)
 ; OLD  = string for 1-node
"RTN","GMPLX",190,0)
 ;      = 0-node from reform/react problem
"RTN","GMPLX",191,0)
 N DA,DD,DO,DIC,X,Y,DIK,DLAYGO
"RTN","GMPLX",192,0)
 S DIC="^GMPL(125.8,",DIC(0)="L",X=$P(DATA,U),DLAYGO=125.8
"RTN","GMPLX",193,0)
 D FILE^DICN Q:+Y'>0  S DA=+Y,DIK="^GMPL(125.8,"
"RTN","GMPLX",194,0)
 S ^GMPL(125.8,DA,0)=DATA D IX1^DIK
"RTN","GMPLX",195,0)
 S:$L(OLD) ^GMPL(125.8,DA,1)=OLD
"RTN","GMPLX",196,0)
 Q
"RTN","GMPLX",197,0)
 ;
"RTN","GMPLX",198,0)
DTMOD(DA) ; Update Date Modified
"RTN","GMPLX",199,0)
 N DIE,DR
"RTN","GMPLX",200,0)
 S DR=".03///TODAY",DIE="^AUPNPROB("
"RTN","GMPLX",201,0)
 D ^DIE
"RTN","GMPLX",202,0)
 ; broadcast problem change events
"RTN","GMPLX",203,0)
 N GMPIFN,DFN,X
"RTN","GMPLX",204,0)
 S GMPIFN=DA,DFN=+$P($G(^AUPNPROB(DA,0)),U,2)
"RTN","GMPLX",205,0)
 S X=+$O(^ORD(101,"B","GMPL EVENT",0))_";ORD(101," D:X EN1^XQOR
"RTN","GMPLX",206,0)
 Q
"RTN","GMPLX",207,0)
 ;
"RTN","GMPLX",208,0)
MSG() ; ListMan Msg Bar
"RTN","GMPLX",209,0)
 Q "+ Next Screen  - Prev Screen  ?? More actions"
"RTN","GMPLX",210,0)
 ;
"RTN","GMPLX",211,0)
KILL ; Clean-Up Vars
"RTN","GMPLX",212,0)
 K X,Y,DIC,DIE,DR,DA,DUOUT,DTOUT,GMPQUIT,GMPRT,GMPSAVED,GMPIFN,GMPLNO,GMPLNUM,GMPLSEL,GMPREBLD,GMPI,GMPLSLST,GMPLJUMP
"RTN","GMPLX",213,0)
 Q
"RTN","GMPLX",214,0)
 ;
"RTN","GMPLX",215,0)
CODESTS(PROB,ADATE) ;check status of ICD
"RTN","GMPLX",216,0)
 ; Input:
"RTN","GMPLX",217,0)
 ;  PROB  = pointer to the PROBLEM (#9000011) file
"RTN","GMPLX",218,0)
 ;  ADATE = FM date on which to check the status (opt.)
"RTN","GMPLX",219,0)
 ;
"RTN","GMPLX",220,0)
 ; Output:
"RTN","GMPLX",221,0)
 ;  1 = ACTIVE on the date passed or current date
"RTN","GMPLX",222,0)
 ;  0 = INACTIVE on the date passed or current date
"RTN","GMPLX",223,0)
 ;
"RTN","GMPLX",224,0)
 I '$G(ADATE) S ADATE=DT
"RTN","GMPLX",225,0)
 I '$D(^AUPNPROB(PROB,0)) Q 0
"RTN","GMPLX",226,0)
 N GMPL0,GMPL802,GMPLCSYS,GMPLCPTR,GMPLICD S GMPL0=$G(^AUPNPROB(PROB,0)),GMPL802=$G(^(802))
"RTN","GMPLX",227,0)
 S GMPLCPTR=$$CSI^ICDEX(80,+GMPL0),GMPLCSYS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX(GMPLCPTR,ADATE))
"RTN","GMPLX",228,0)
 S GMPLICD=$P($$ICDDATA^ICDXCODE(GMPLCSYS,+GMPL0,ADATE,"I"),U,2)
"RTN","GMPLX",229,0)
 Q +$$STATCHK^ICDXCODE(GMPLCPTR,GMPLICD,ADATE)
"RTN","GMPLX",230,0)
EXP2CODE(X,GMPSRC,GMPCODE) ; Resolve SOURCE and CODE from Expression
"RTN","GMPLX",231,0)
 N LEX,SRCCODE,GMI S GMI=0,(GMPSRC,GMPCODE)=""
"RTN","GMPLX",232,0)
 D INFO^LEXA(X,DT)
"RTN","GMPLX",233,0)
 F  S GMI=$O(LEX("SEL","SRC",GMI)) Q:+GMI'>0  D  Q:($G(GMPSRC)]"")
"RTN","GMPLX",234,0)
 . S SRCCODE=$P($G(LEX("SEL","SRC",GMI)),U,1,2)
"RTN","GMPLX",235,0)
 . I $P(SRCCODE,U)["SNOMED CT"!($P(SRCCODE,U)["VHAT")!($P(SRCCODE,U)["ICD") S GMPSRC=$P(SRCCODE,U),GMPCODE=$P(SRCCODE,U,2)
"RTN","GMPLX",236,0)
 Q
"RTN","GMPLX",237,0)
GETDX(CODE,CODESYS) ; Get ICD associated with SCT or VHAT Code
"RTN","GMPLX",238,0)
 N LEX,GMPI,GMPY,GMPMPDEF,GMPIMPDT S GMPY=0,GMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","GMPLX",239,0)
 S GMPMPDEF=$S(DT<GMPIMPDT:"SCT2ICD",1:"SCT210D")
"RTN","GMPLX",240,0)
 I CODESYS["VHAT" S GMPY=$$GETASSN^LEXTRAN1(CODE,"VHAT2ICD") I 1
"RTN","GMPLX",241,0)
 E  S GMPY=$$GETASSN^LEXTRAN1(CODE,GMPMPDEF)
"RTN","GMPLX",242,0)
 I $S(+GMPY'>0:1,+$P(GMPY,U,2)'>0:1,+LEX'>0:1,1:0) S GMPY=$S(DT<GMPIMPDT:"799.9",1:"R69.") G GETDXX
"RTN","GMPLX",243,0)
 S (GMPI,GMPY)=0
"RTN","GMPLX",244,0)
 F  S GMPI=$O(LEX(GMPI)) Q:+GMPI'>0  D
"RTN","GMPLX",245,0)
 .N ICD
"RTN","GMPLX",246,0)
 .S ICD=$O(LEX(GMPI,""))
"RTN","GMPLX",247,0)
 .I ICD]"" S GMPY=$S(GMPY'=0:GMPY_"/",1:"")_ICD
"RTN","GMPLX",248,0)
 I GMPY'["." S GMPY=GMPY_"."
"RTN","GMPLX",249,0)
GETDXX Q GMPY
"RTN","GMPLX",250,0)
PAD(GMPX,GMPL) ; Pads string to specified length
"RTN","GMPLX",251,0)
 N GMPY
"RTN","GMPLX",252,0)
 S GMPY="",$P(GMPY," ",(GMPL-$L(GMPX))+1)=""
"RTN","GMPLX",253,0)
 Q GMPY
"RTN","GMPLX1")
0^26^B90046918
"RTN","GMPLX1",1,0)
GMPLX1 ; SLC/MKB/KER/TC - Problem List Person Utilities ;11/27/12  08:28
"RTN","GMPLX1",2,0)
 ;;2.0;Problem List;**3,26,35,36,42**;Aug 25, 1994;Build 46
"RTN","GMPLX1",3,0)
 ;
"RTN","GMPLX1",4,0)
 ; External References
"RTN","GMPLX1",5,0)
 ;   DBIA   348  ^DPT(
"RTN","GMPLX1",6,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLX1",7,0)
 ;   ICR   5747  $$CSI/SAB/CODECS^ICDEX
"RTN","GMPLX1",8,0)
 ;   ICR   5699  $$ICDDATA^ICDXCODE
"RTN","GMPLX1",9,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLX1",10,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLX1",11,0)
 ;   DBIA 10062  7^VADPT
"RTN","GMPLX1",12,0)
 ;   DBIA 10062  DEM^VADPT
"RTN","GMPLX1",13,0)
 ;   DBIA  2716  $$GETSTAT^DGMSTAPI
"RTN","GMPLX1",14,0)
 ;   DBIA  3457  $$GETCUR^DGNTAPI
"RTN","GMPLX1",15,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLX1",16,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLX1",17,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLX1",18,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLX1",19,0)
 ;
"RTN","GMPLX1",20,0)
PAT() ; Select patient -- returns DFN^NAME^BID
"RTN","GMPLX1",21,0)
 N DIC,X,Y,DFN,VADM,VA,PAT,AUPNSEX
"RTN","GMPLX1",22,0)
P1 S DIC="^AUPNPAT(",DIC(0)="AEQM" D ^DIC I +Y<1 Q -1
"RTN","GMPLX1",23,0)
 I $P(Y,U,2)'=$P(^DPT(+Y,0),U) W $C(7),!!,"ERROR -- Please check your Patient Files #2 and #9000001 for inconsistencies.",! G P1
"RTN","GMPLX1",24,0)
 S DFN=+Y,PAT=Y D DEM^VADPT
"RTN","GMPLX1",25,0)
 S PAT=PAT_U_$E($P(PAT,U,2))_VA("BID"),AUPNSEX=$P(VADM(5),U)
"RTN","GMPLX1",26,0)
 I VADM(6) S PAT=PAT_U_+VADM(6) ; date of death
"RTN","GMPLX1",27,0)
 Q PAT
"RTN","GMPLX1",28,0)
 ;
"RTN","GMPLX1",29,0)
VADPT(DFN) ; Get Service/Elig Flags
"RTN","GMPLX1",30,0)
 ;
"RTN","GMPLX1",31,0)
 ; Returns = 1/0/"" if Y/N/unknown
"RTN","GMPLX1",32,0)
 ;   GMPSC     Service Connected
"RTN","GMPLX1",33,0)
 ;   GMPAGTOR  Agent Orange Exposure
"RTN","GMPLX1",34,0)
 ;   GMPION    Ionizing Radiation Exposure
"RTN","GMPLX1",35,0)
 ;   GMPGULF   Persian Gulf Exposure
"RTN","GMPLX1",36,0)
 ;   GMPMST    Military Sexual Trauma
"RTN","GMPLX1",37,0)
 ;   GMPHNC    Head and/or Neck Cancer
"RTN","GMPLX1",38,0)
 ;   GMPCV     Combat Veteran
"RTN","GMPLX1",39,0)
 ;   GMPSHD    Shipboard Hazard and Defense
"RTN","GMPLX1",40,0)
 ;
"RTN","GMPLX1",41,0)
 N VAEL,VASV,VAERR,HNC,X D 7^VADPT S GMPSC=VAEL(3),GMPAGTOR=VASV(2)
"RTN","GMPLX1",42,0)
 S GMPION=VASV(3),X=$P($G(^DPT(DFN,.322)),U,10),GMPGULF=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",43,0)
 S GMPCV=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) GMPCV=1  ;CV
"RTN","GMPLX1",44,0)
 S GMPSHD=+$G(VASV(14,1))  ;SHAD
"RTN","GMPLX1",45,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),GMPMST=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",46,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),GMPHNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLX1",47,0)
 Q
"RTN","GMPLX1",48,0)
SCS(PROB,SC) ; Get Exposure/Conditions Strings
"RTN","GMPLX1",49,0)
 ;
"RTN","GMPLX1",50,0)
 ;   Input     PROB  Pointer to Problem #9000011
"RTN","GMPLX1",51,0)
 ;
"RTN","GMPLX1",52,0)
 ;   Returns   SC Array passed by reference
"RTN","GMPLX1",53,0)
 ;             SC(1)="AO/IR/EC/HNC/MST/CV/SHD"
"RTN","GMPLX1",54,0)
 ;             SC(2)="A/I/E/H/M/C/S"
"RTN","GMPLX1",55,0)
 ;             SC(3)="AIEHMCS"
"RTN","GMPLX1",56,0)
 ;
"RTN","GMPLX1",57,0)
 ;   NOTE:  Military Sexual Trauma (MST) is suppressed
"RTN","GMPLX1",58,0)
 ;          if the current device is a printer.
"RTN","GMPLX1",59,0)
 ;
"RTN","GMPLX1",60,0)
 N ND,DA,FL,AO,IR,EC,HNC,MST,CV,SHD,PTR S DA=+($G(PROB)) Q:+DA=0
"RTN","GMPLX1",61,0)
 S ND=$G(^AUPNPROB(+DA,1)),AO=+($P(ND,"^",11)),IR=+($P(ND,"^",12))
"RTN","GMPLX1",62,0)
 S EC=+($P(ND,"^",13)),HNC=+($P(ND,"^",15)),MST=+($P(ND,"^",16))
"RTN","GMPLX1",63,0)
 S CV=+($P(ND,"^",17)),SHD=+($P(ND,"^",18))
"RTN","GMPLX1",64,0)
 S PTR=$$PTR^GMPLUTL4
"RTN","GMPLX1",65,0)
 I +AO>0 D
"RTN","GMPLX1",66,0)
 . S:$G(SC(1))'["AO" SC(1)=$G(SC(1))_"/AO" S:$G(SC(2))'["A" SC(2)=$G(SC(2))_"/A" S:$G(SC(3))'["A" SC(3)=$G(SC(3))_"A"
"RTN","GMPLX1",67,0)
 I +IR>0 D
"RTN","GMPLX1",68,0)
 . S:$G(SC(1))'["IR" SC(1)=$G(SC(1))_"/IR" S:$G(SC(2))'["I" SC(2)=$G(SC(2))_"/I" S:$G(SC(3))'["I" SC(3)=$G(SC(3))_"I"
"RTN","GMPLX1",69,0)
 I +EC>0 D
"RTN","GMPLX1",70,0)
 . S:$G(SC(1))'["EC" SC(1)=$G(SC(1))_"/EC" S:$G(SC(2))'["E" SC(2)=$G(SC(2))_"/E" S:$G(SC(3))'["E" SC(3)=$G(SC(3))_"E"
"RTN","GMPLX1",71,0)
 I +HNC>0 D
"RTN","GMPLX1",72,0)
 . S:$G(SC(1))'["HNC" SC(1)=$G(SC(1))_"/HNC" S:$G(SC(2))'["H" SC(2)=$G(SC(2))_"/H" S:$G(SC(3))'["H" SC(3)=$G(SC(3))_"H"
"RTN","GMPLX1",73,0)
 I +MST>0 D
"RTN","GMPLX1",74,0)
 . S:$G(SC(1))'["MST" SC(1)=$G(SC(1))_"/MST" S:$G(SC(2))'["M" SC(2)=$G(SC(2))_"/M" S:$G(SC(3))'["M" SC(3)=$G(SC(3))_"M"
"RTN","GMPLX1",75,0)
 I +CV>0 D
"RTN","GMPLX1",76,0)
 . S:$G(SC(1))'["CV" SC(1)=$G(SC(1))_"/CV" S:$G(SC(2))'["C" SC(2)=$G(SC(2))_"/C" S:$G(SC(3))'["C" SC(3)=$G(SC(3))_"C"
"RTN","GMPLX1",77,0)
 I +PTR'>0 D
"RTN","GMPLX1",78,0)
 . I +SHD>0 S:$G(SC(1))'["SHD" SC(1)=$G(SC(1))_"/SHD" S:$G(SC(2))'["D" SC(2)=$G(SC(2))_"/S" S:$G(SC(3))'["S" SC(3)=$G(SC(3))_"S"
"RTN","GMPLX1",79,0)
 S:$D(SC(1)) SC(1)=$$RS(SC(1)) S:$D(SC(2)) SC(2)=$$RS(SC(2))
"RTN","GMPLX1",80,0)
 Q
"RTN","GMPLX1",81,0)
SCCOND(DFN,SC) ; Get Service/Elig Flags (array)
"RTN","GMPLX1",82,0)
 ; Returns local array .SC passed by value
"RTN","GMPLX1",83,0)
 N HNC,VAEL,VASV,VAERR,X D 7^VADPT
"RTN","GMPLX1",84,0)
 S SC("DFN")=$G(DFN),SC("SC")=$P(VAEL(3),"^",1)
"RTN","GMPLX1",85,0)
 S SC("AO")=$P(VASV(2),"^",1)
"RTN","GMPLX1",86,0)
 S SC("IR")=$P(VASV(3),"^",1)
"RTN","GMPLX1",87,0)
 S X=$P($G(^DPT(DFN,.322)),U,10),SC("PG")=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",88,0)
 S SC("CV")=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) SC("CV")=1  ;CV
"RTN","GMPLX1",89,0)
 S SC("SHD")=+$G(VASV(14,1))  ;SHAD
"RTN","GMPLX1",90,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),SC("MST")=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",91,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),SC("HNC")=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLX1",92,0)
 Q
"RTN","GMPLX1",93,0)
 ;
"RTN","GMPLX1",94,0)
CKDEAD(DATE) ; Dead patient ... continue?  Returns 1 if YES, 0 otherwise
"RTN","GMPLX1",95,0)
 N DIR,X,Y S DIR(0)="YA",DIR("B")="NO"
"RTN","GMPLX1",96,0)
 S DIR("A")="Are you sure you want to continue? "
"RTN","GMPLX1",97,0)
 S DIR("?",1)="   Enter YES to continue and add new problem(s) for this patient:",DIR("?")="   press <return> to select another action."
"RTN","GMPLX1",98,0)
 W $C(7),!!,"DATE OF DEATH: "_$$EXTDT^GMPLX(DATE)
"RTN","GMPLX1",99,0)
 D ^DIR
"RTN","GMPLX1",100,0)
 Q +Y
"RTN","GMPLX1",101,0)
 ;
"RTN","GMPLX1",102,0)
REQPROV() ; Returns requesting provider
"RTN","GMPLX1",103,0)
 N DIR,X,Y,DUOUT,DTOUT
"RTN","GMPLX1",104,0)
 I $D(GMPLUSER) S Y=DUZ_U_$P(^VA(200,DUZ,0),U) Q Y
"RTN","GMPLX1",105,0)
 S DIR("?")="Enter the name of the provider responsible for this data."
"RTN","GMPLX1",106,0)
 S DIR(0)="PA^200:AEQM",DIR("A")="Provider: "
"RTN","GMPLX1",107,0)
 S:$G(GMPROV) DIR("B")=$P(GMPROV,U,2) W ! D ^DIR
"RTN","GMPLX1",108,0)
 I $D(DUOUT)!($D(DTOUT))!(+Y'>0) Q -1
"RTN","GMPLX1",109,0)
 Q Y
"RTN","GMPLX1",110,0)
 ;
"RTN","GMPLX1",111,0)
NAME(USER) ; Formats user name into "Lastname,F"
"RTN","GMPLX1",112,0)
 N NAME,LAST,FIRST
"RTN","GMPLX1",113,0)
 S NAME=$P($G(^VA(200,+USER,0)),U) I '$L(NAME) Q ""
"RTN","GMPLX1",114,0)
 S LAST=$P(NAME,","),FIRST=$P(NAME,",",2)
"RTN","GMPLX1",115,0)
 S:$E(FIRST)=" " FIRST=$E(FIRST,2,99)
"RTN","GMPLX1",116,0)
 Q $E(LAST,1,15)_","_$E(FIRST)
"RTN","GMPLX1",117,0)
 ;
"RTN","GMPLX1",118,0)
SERVICE(USER,INCNPC) ; Returns User's service/section from file #49
"RTN","GMPLX1",119,0)
 ; USER - Integer # (User ID - DUZ) of person in question
"RTN","GMPLX1",120,0)
 ; [INCNPC] - Optional Boolean Defaults to 0 (false)
"RTN","GMPLX1",121,0)
 N X S X=+$P($G(^VA(200,USER,5)),U),INCNPC=+$G(INCNPC)
"RTN","GMPLX1",122,0)
 I 'INCNPC,($P($G(^DIC(49,X,0)),U,9)'="C") S X=0
"RTN","GMPLX1",123,0)
 S:X>0 X=X_U_$P($G(^DIC(49,X,0)),U) S:X'>0 X=""
"RTN","GMPLX1",124,0)
 Q X
"RTN","GMPLX1",125,0)
 ;
"RTN","GMPLX1",126,0)
SERV(X) ; Return service name abbreviation
"RTN","GMPLX1",127,0)
 N NODE,ABBREV
"RTN","GMPLX1",128,0)
 S NODE=$G(^DIC(49,+X,0)) I NODE="" Q ""
"RTN","GMPLX1",129,0)
 S ABBREV=$P(NODE,U,2) I ABBREV="" S ABBREV=$E($P(NODE,U),1,4)
"RTN","GMPLX1",130,0)
 Q ABBREV_"/"
"RTN","GMPLX1",131,0)
 ;
"RTN","GMPLX1",132,0)
CLINIC(LAST) ; Returns clinic from file #44
"RTN","GMPLX1",133,0)
 N X,Y,DIC,DIR,DTOUT,DUOUT S Y="" G:$E(GMPLVIEW("VIEW"))="S" CLINQ
"RTN","GMPLX1",134,0)
 S DIR(0)="FAO^1:30",DIR("A")="Clinic: " S:$L(LAST) DIR("B")=$P(LAST,U,2)
"RTN","GMPLX1",135,0)
 S DIR("?")="Enter the clinic to be associated with these problems, if available"
"RTN","GMPLX1",136,0)
 S DIR("??")="^D LISTCLIN^GMPLMGR1 W !,DIR(""?"")_""."""
"RTN","GMPLX1",137,0)
CLIN1 ; Ask Clinic
"RTN","GMPLX1",138,0)
 D ^DIR S:$D(DUOUT)!($D(DTOUT)) Y="^" S:Y="@" Y="" G:("^"[Y) CLINQ
"RTN","GMPLX1",139,0)
 S DIC="^SC(",DIC(0)="EMQ",DIC("S")="I $P(^(0),U,3)=""C"""
"RTN","GMPLX1",140,0)
 D ^DIC I Y'>0 W !?5,"Only clinics are allowed!",! G CLIN1
"RTN","GMPLX1",141,0)
CLINQ ; Quit Asking
"RTN","GMPLX1",142,0)
 Q Y
"RTN","GMPLX1",143,0)
 ;
"RTN","GMPLX1",144,0)
VIEW(USER) ; Returns user's preferred view
"RTN","GMPLX1",145,0)
 N X S X=$P($G(^VA(200,USER,125)),U)
"RTN","GMPLX1",146,0)
 Q X
"RTN","GMPLX1",147,0)
 ;
"RTN","GMPLX1",148,0)
VOCAB() ; Select search vocabulary
"RTN","GMPLX1",149,0)
 N DIR,X,Y S DIR(0)="SAOM^N:NURSING;I:IMMUNOLOGIC;D:DENTAL;S:SOCIAL WORK;P:GENERAL PROBLEM"
"RTN","GMPLX1",150,0)
 S DIR("A")="Select Specialty Subset: ",DIR("B")="GENERAL PROBLEM"
"RTN","GMPLX1",151,0)
 S DIR("?",1)="Because many discipline-specific terms are synonyms to other terms,"
"RTN","GMPLX1",152,0)
 S DIR("?",2)="they are not accessible unless you specify the appropriate subset of the"
"RTN","GMPLX1",153,0)
 S DIR("?",3)="Clinical Lexicon to select from.  Choose from:  Nursing"
"RTN","GMPLX1",154,0)
 S DIR("?",4)=$$REPEAT^XLFSTR(" ",48)_"Immunologic"
"RTN","GMPLX1",155,0)
 S DIR("?",5)=$$REPEAT^XLFSTR(" ",48)_"Dental"
"RTN","GMPLX1",156,0)
 S DIR("?",6)=$$REPEAT^XLFSTR(" ",48)_"Social Work"
"RTN","GMPLX1",157,0)
 S DIR("?")=$$REPEAT^XLFSTR(" ",48)_"General Problem"
"RTN","GMPLX1",158,0)
 D ^DIR S X=$S(Y="N":"NUR",Y="I":"IMM",Y="D":"DEN",Y="S":"SOC",Y="P":"PL1",1:"^")
"RTN","GMPLX1",159,0)
 Q X
"RTN","GMPLX1",160,0)
 ;
"RTN","GMPLX1",161,0)
PARAMS ; Edit pkg parameters in file #125.99
"RTN","GMPLX1",162,0)
 N DIE,DA,DR,OLDVERFY,VERFY,BLANK S BLANK="       "
"RTN","GMPLX1",163,0)
 S OLDVERFY=+$P($G(^GMPL(125.99,1,0)),U,2)
"RTN","GMPLX1",164,0)
 S DIE="^GMPL(125.99,",DA=1,DR="1:2;4:6" D ^DIE
"RTN","GMPLX1",165,0)
 Q:+$P($G(^GMPL(125.99,1,0)),U,2)=OLDVERFY
"RTN","GMPLX1",166,0)
 S DA(1)=$O(^ORD(101,"B","GMPL PROBLEM LIST",0)) Q:'DA(1)
"RTN","GMPLX1",167,0)
 S VERFY=$O(^ORD(101,"B","GMPL VERIFY",0)) W "."
"RTN","GMPLX1",168,0)
 S DA=$O(^ORD(101,DA(1),10,"B",VERFY,0)) Q:'DA
"RTN","GMPLX1",169,0)
 S DR=$S(OLDVERFY:"2///@;6///^S X=BLANK",1:"2////$;6///@") W "."
"RTN","GMPLX1",170,0)
 S DIE="^ORD(101,"_DA(1)_",10,"
"RTN","GMPLX1",171,0)
 D ^DIE W "."
"RTN","GMPLX1",172,0)
 Q
"RTN","GMPLX1",173,0)
RS(X) ; Remove Slashes
"RTN","GMPLX1",174,0)
 S X=$G(X) F  Q:$E(X,1)'="/"  S X=$E(X,2,$L(X))
"RTN","GMPLX1",175,0)
 F  Q:$E(X,$L(X))'="/"  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX1",176,0)
 Q X
"RTN","GMPLX1",177,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings of length LENGTH
"RTN","GMPLX1",178,0)
 N GMPI,GMPJ,LINE,GMPX,GMPX1,GMPX2,GMPY
"RTN","GMPLX1",179,0)
 I $G(TEXT)']"" Q ""
"RTN","GMPLX1",180,0)
 F GMPI=1:1 D  Q:GMPI=$L(TEXT," ")
"RTN","GMPLX1",181,0)
 . S GMPX=$P(TEXT," ",GMPI)
"RTN","GMPLX1",182,0)
 . I $L(GMPX)>LENGTH D
"RTN","GMPLX1",183,0)
 . . S GMPX1=$E(GMPX,1,LENGTH),GMPX2=$E(GMPX,LENGTH+1,$L(GMPX))
"RTN","GMPLX1",184,0)
 . . S $P(TEXT," ",GMPI)=GMPX1_" "_GMPX2
"RTN","GMPLX1",185,0)
 S LINE=1,GMPX(1)=$P(TEXT," ")
"RTN","GMPLX1",186,0)
 F GMPI=2:1 D  Q:GMPI'<$L(TEXT," ")
"RTN","GMPLX1",187,0)
 . S:$L($G(GMPX(LINE))_" "_$P(TEXT," ",GMPI))>LENGTH LINE=LINE+1,GMPY=1
"RTN","GMPLX1",188,0)
 . S GMPX(LINE)=$G(GMPX(LINE))_$S(+$G(GMPY):"",1:" ")_$P(TEXT," ",GMPI),GMPY=0
"RTN","GMPLX1",189,0)
 S GMPJ=0,TEXT="" F GMPI=1:1 S GMPJ=$O(GMPX(GMPJ)) Q:+GMPJ'>0  S TEXT=TEXT_$S(GMPI=1:"",1:"|")_GMPX(GMPJ)
"RTN","GMPLX1",190,0)
 Q TEXT
"RTN","GMPLX1",191,0)
SCTMAP(GMPSCT,GMPICD,GMPORD) ; API for updating ICD Code when mapping changes
"RTN","GMPLX1",192,0)
 ; GMPSCT = SNOMED CT Concept CODE (e.g., 53974002 for Kniest Dysplasia)
"RTN","GMPLX1",193,0)
 ; GMPICD = ICD-9/10-CM CODE (as string literal, so that terminal 0's aren't truncated.
"RTN","GMPLX1",194,0)
 ;          e.g., "756.9" for Musculoskeletal Anom NEC/NOS)
"RTN","GMPLX1",195,0)
 ; GMPORD = Order or sequence (integer) number (starting from 1) to accommodate SNOMED
"RTN","GMPLX1",196,0)
 ;          Concepts with multiple target ICD code mappings (e.g., for Diabetic
"RTN","GMPLX1",197,0)
 ;          Neuropathy (SNOMED CT 230572002 ICD-9-CM 250.60/355.9) the order for
"RTN","GMPLX1",198,0)
 ;          250.60 would be 1, and the order for 355.9 would be 2
"RTN","GMPLX1",199,0)
 ;
"RTN","GMPLX1",200,0)
 N GMPID,GMPCSYS
"RTN","GMPLX1",201,0)
 I '$D(^AUPNPROB("ASCT",GMPSCT)) Q  ; No problems with SNOMED-CT code
"RTN","GMPLX1",202,0)
 S GMPCSYS=$$SAB^ICDEX(+$$CODECS^ICDEX(GMPICD,80,DT),DT)
"RTN","GMPLX1",203,0)
 I +$$ICDDATA^ICDXCODE(GMPCSYS,GMPICD,DT,"E")<0 Q  ;valid ICD code only
"RTN","GMPLX1",204,0)
 S GMPID=0
"RTN","GMPLX1",205,0)
 S GMPORD=$G(GMPORD,1) ; Order defaults to 1
"RTN","GMPLX1",206,0)
 F  S GMPID=$O(^AUPNPROB("ASCT",GMPSCT,GMPID)) Q:+GMPID'>0  D
"RTN","GMPLX1",207,0)
 . N PL,PLY,GMPI,GMPICDS,GMPDX,GMPDXC,GMPDXCS,GMPL0,GMPL802,GMPDXDT
"RTN","GMPLX1",208,0)
 . Q:'$D(^AUPNPROB(GMPID))
"RTN","GMPLX1",209,0)
 . ; acquire lock
"RTN","GMPLX1",210,0)
 . L +^AUPNPROB(GMPID):$G(DILOCKTM,1)
"RTN","GMPLX1",211,0)
 . E  Q
"RTN","GMPLX1",212,0)
 . S GMPICDS=$S(GMPCSYS="ICD":"799.9",1:"R69.")
"RTN","GMPLX1",213,0)
 . S GMPL0=$G(^AUPNPROB(GMPID,0)),GMPL802=$G(^(802)),GMPDX=+GMPL0 ; Current Primary Dx IEN
"RTN","GMPLX1",214,0)
 . S GMPDXDT=$S(+$P(GMPL802,U,1):$P(GMPL802,U,1),1:$P(GMPL0,U,8)) ; Current Primary Dx Date of Interest
"RTN","GMPLX1",215,0)
 . S GMPDXCS=$S($P(GMPL802,U,2)]"":$P(GMPL802,U,2),1:$$SAB^ICDEX($$CSI^ICDEX(80,GMPDX),DT)) ; Current Primary Dx Coding System
"RTN","GMPLX1",216,0)
 . S GMPDXC=$P($$ICDDATA^ICDXCODE(GMPDXCS,GMPDX,DT,"I"),U,2) ; Current Primary Dx Code
"RTN","GMPLX1",217,0)
 . I GMPORD=1 D
"RTN","GMPLX1",218,0)
 . . S GMPDX=+$$ICDDATA^ICDXCODE(GMPCSYS,GMPICD,DT,"E"),GMPDXC=GMPICD
"RTN","GMPLX1",219,0)
 . S $P(GMPICDS,"/",1)=GMPDXC
"RTN","GMPLX1",220,0)
 . S GMPI=0
"RTN","GMPLX1",221,0)
 . ; If additional mapped targets exist, append them to the GMPICDS string
"RTN","GMPLX1",222,0)
 . F  S GMPI=$O(^AUPNPROB(GMPID,803,GMPI)) Q:+GMPI'>0  D
"RTN","GMPLX1",223,0)
 . . N GMPL803,GMPDXCDT,GMPDXCSY S GMPL803=$G(^AUPNPROB(GMPID,803,GMPI,0))
"RTN","GMPLX1",224,0)
 . . S GMPDXC=+GMPL803,GMPDXCSY=$S($P(GMPL803,U,2)["ICD9":"ICD",1:$P(GMPL803,U,2))
"RTN","GMPLX1",225,0)
 . . S GMPDXCDT=$P(GMPL803,U,3)
"RTN","GMPLX1",226,0)
 . . S $P(GMPICDS,"/",(GMPI+1))=$S(GMPDXC]"":GMPDXC,1:$P($$NOS^GMPLX(GMPDXCSY,GMPDXCDT),U,2))
"RTN","GMPLX1",227,0)
 . I GMPORD>1 S $P(GMPICDS,"/",GMPORD)=GMPICD
"RTN","GMPLX1",228,0)
 . ; Replace empty "/"-pieces with 799.9 (ICD-9-CM) or R69 (ICD-10-CM) as appropriate
"RTN","GMPLX1",229,0)
 . F GMPI=1:1:$L(GMPICDS,"/") S:'$L($P(GMPICDS,"/",GMPI)) $P(GMPICDS,"/",GMPI)=$P($$NOS^GMPLX(GMPDXCS,GMPDXDT),U,2)
"RTN","GMPLX1",230,0)
 . S PL("PROBLEM")=GMPID,PL("PROVIDER")=.5 ; user is POSTMASTER (evaluate alternatives)
"RTN","GMPLX1",231,0)
 . S PL("DIAGNOSIS")=GMPDX_U_GMPICDS
"RTN","GMPLX1",232,0)
 . ; if order is 1, only update entries where .01 is 799.9
"RTN","GMPLX1",233,0)
 . I GMPORD=1,(+GMPL0'=+$$NOS^GMPLX(GMPDXCS,GMPDXDT)) L -^AUPNPROB(GMPID) Q
"RTN","GMPLX1",234,0)
 . D UPDATE^GMPLUTL(.PL,.PLY)
"RTN","GMPLX1",235,0)
 . ; release lock
"RTN","GMPLX1",236,0)
 . L -^AUPNPROB(GMPID)
"RTN","GMPLX1",237,0)
 Q
"RTN","GMPLY42")
0^27^B2131928
"RTN","GMPLY42",1,0)
GMPLY42 ;ISL/TC - Post-install for GMPL*2.0*42 ;05/21/14  07:26
"RTN","GMPLY42",2,0)
 ;;2.0;Problem List;**42**;Aug 25,1994;Build 46
"RTN","GMPLY42",3,0)
 ;
"RTN","GMPLY42",4,0)
PRE ; Pre-install subroutine
"RTN","GMPLY42",5,0)
 ;Remove the old data dictionary for the PROBLEM File (#9000011)
"RTN","GMPLY42",6,0)
 N DIU
"RTN","GMPLY42",7,0)
 D BMES^XPDUTL(" Removing old Problem File data dictionary.")
"RTN","GMPLY42",8,0)
 S DIU(0)=""
"RTN","GMPLY42",9,0)
 S DIU=9000011
"RTN","GMPLY42",10,0)
 D EN^DIU2
"RTN","GMPLY42",11,0)
 D MES^XPDUTL(" Data dictionary for file #9000011 removed...")
"RTN","GMPLY42",12,0)
 Q
"RTN","GMPLY42",13,0)
POST ; Post-install subroutine
"RTN","GMPLY42",14,0)
 N GMPLTXT,I,GMPLOPT
"RTN","GMPLY42",15,0)
 S GMPLTXT="This option has been disabled due to the Problem List SNOMED CT implementation."
"RTN","GMPLY42",16,0)
 F I=1:1:4  D
"RTN","GMPLY42",17,0)
 . S GMPLOPT=$S(I=1:"GMPL BUILD ENC FORM LIST",I=2:"GMPL USER LOOK-UP FILTER",I=3:"GMPL USER LOOK-UP DISPLAY",1:"GMPL USER LOOK-UP VOCABULARY")
"RTN","GMPLY42",18,0)
 . D BMES^XPDUTL(" Disabling menu option "_GMPLOPT_".")
"RTN","GMPLY42",19,0)
 . D OUT^XPDMENU(GMPLOPT,GMPLTXT)
"RTN","GMPLY42",20,0)
 . Q
"RTN","GMPLY42",21,0)
 Q
"VER")
8.0^22.0
"^DD",9000011,9000011,0)
FIELD^^80300^39
"^DD",9000011,9000011,0,"DDA")
N
"^DD",9000011,9000011,0,"DT")
3120606
"^DD",9000011,9000011,0,"ID",.02)
W "   ",$S($D(^DPT(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),@("$E("_DIC_"Y,0),0)")
"^DD",9000011,9000011,0,"ID",.06)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(4,+$P(^(0),U,6),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(4,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",9000011,9000011,0,"ID",.07)
W "   ",$P(^(0),U,7)
"^DD",9000011,9000011,0,"IX","AA",9000011,.07)

"^DD",9000011,9000011,0,"IX","AATOO",9000011,.02)

"^DD",9000011,9000011,0,"IX","AATOO2",9000011,.06)

"^DD",9000011,9000011,0,"IX","AC",9000011,.02)

"^DD",9000011,9000011,0,"IX","ACTIVE",9000011,.12)

"^DD",9000011,9000011,0,"IX","ACTIVE1",9000011,.02)

"^DD",9000011,9000011,0,"IX","ASCT",9000011,80001)

"^DD",9000011,9000011,0,"IX","AV1",9000011,.06)

"^DD",9000011,9000011,0,"IX","AV9",9000011,.01)

"^DD",9000011,9000011,0,"IX","B",9000011,.01)

"^DD",9000011,9000011,0,"IX","C",9000011,1.01)

"^DD",9000011,9000011,0,"IX","MODIFIED",9000011,.03)

"^DD",9000011,9000011,0,"NM","PROBLEM")

"^DD",9000011,9000011,0,"PT",125.8,.01)

"^DD",9000011,9000011,0,"PT",8925.9,.02)

"^DD",9000011,9000011,0,"PT",9000010.07,.16)

"^DD",9000011,9000011,0,"SP",.06)

"^DD",9000011,9000011,0,"SP",.07)

"^DD",9000011,9000011,0,"VRPK")
GMPL
"^DD",9000011,9000011,.01,0)
DIAGNOSIS^R*P80'^ICD9(^0;1^S DIC("S")="I 1 Q:$G(DUZ(""AG""))=""V""  I $E(^(0))'=""E"",$P(^(0),U,9)="""" Q:$P(^(0),U,10)=""""  I $P(^(0),U,10)=AUPNSEX" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000011,9000011,.01,1,0)
^.1
"^DD",9000011,9000011,.01,1,1,0)
9000011^B
"^DD",9000011,9000011,.01,1,1,1)
S ^AUPNPROB("B",$E(X,1,30),DA)=""
"^DD",9000011,9000011,.01,1,1,2)
K ^AUPNPROB("B",$E(X,1,30),DA)
"^DD",9000011,9000011,.01,1,2,0)
9000011^AV9^MUMPS
"^DD",9000011,9000011,.01,1,2,1)
S:$D(APCDLOOK) DIC("DR")=""
"^DD",9000011,9000011,.01,1,2,2)
Q
"^DD",9000011,9000011,.01,1,2,"%D",0)
^^2^2^2940110^
"^DD",9000011,9000011,.01,1,2,"%D",1,0)
Controls the behaviour of the input templates used by IHS to populate
"^DD",9000011,9000011,.01,1,2,"%D",2,0)
and maintain this file.
"^DD",9000011,9000011,.01,1,2,"DT")
2940110
"^DD",9000011,9000011,.01,3)
Enter the ICD Code for this problem.
"^DD",9000011,9000011,.01,12)
Cannot be an E code or an inactive code and must be appropriate for the sex of the Patient.
"^DD",9000011,9000011,.01,12.1)
S DIC("S")="I 1 Q:$G(DUZ(""AG""))=""V""  I $E(^(0))'=""E"",$P(^(0),U,9)="""" Q:$P(^(0),U,10)=""""  I $P(^(0),U,10)=AUPNSEX"
"^DD",9000011,9000011,.01,21,0)
^^2^2^2930908^^^^
"^DD",9000011,9000011,.01,21,1,0)
This is the ICD coded diagnosis of the narrative entered describing
"^DD",9000011,9000011,.01,21,2,0)
this problem.
"^DD",9000011,9000011,.01,23,0)
^^5^5^2930908^^
"^DD",9000011,9000011,.01,23,1,0)
The DHCP Problem List application derives its entries from a lookup
"^DD",9000011,9000011,.01,23,2,0)
into the Clinical Lexicon Utility rather than the ICD Diagnosis file.
"^DD",9000011,9000011,.01,23,3,0)
If the term selected from the CLU is not coded to ICD, then code 799.99
"^DD",9000011,9000011,.01,23,4,0)
"Other Unknown or Unspecified Cause, NEC" will be used here in order
"^DD",9000011,9000011,.01,23,5,0)
to be able to create a new entry.  This field may later be edited.
"^DD",9000011,9000011,.01,"DT")
3121130
"^DD",9000011,9000011,.02,0)
PATIENT NAME^RP9000001'I^AUPNPAT(^0;2^Q
"^DD",9000011,9000011,.02,1,0)
^.1
"^DD",9000011,9000011,.02,1,1,0)
9000011^AC
"^DD",9000011,9000011,.02,1,1,1)
S ^AUPNPROB("AC",$E(X,1,30),DA)=""
"^DD",9000011,9000011,.02,1,1,2)
K ^AUPNPROB("AC",$E(X,1,30),DA)
"^DD",9000011,9000011,.02,1,2,0)
9000011^AATOO^MUMPS
"^DD",9000011,9000011,.02,1,2,1)
I $P(^AUPNPROB(DA,0),U,6)]"",$P(^(0),U,7)]"" S X1=$P($P(^(0),U,7),"."),X2=$P($P(^(0),U,7),".",2),^AUPNPROB("AA",X,$P(^(0),U,6)," "_$E("000",1,4-$L(X1)-1)_X1_"."_X2_$E("00",1,3-$L(X2)-1),DA)="" K X1,X2
"^DD",9000011,9000011,.02,1,2,2)
I $P(^AUPNPROB(DA,0),U,6)]"",$P(^(0),U,7)]"" S X1=$P($P(^(0),U,7),"."),X2=$P($P(^(0),U,7),".",2) K ^AUPNPROB("AA",X,$P(^(0),U,6)," "_$E("000",1,4-$L(X1)-1)_X1_"."_X2_$E("00",1,3-$L(X2)-1),DA),X1,X2
"^DD",9000011,9000011,.02,1,2,"%D",0)
^^3^3^2930825^
"^DD",9000011,9000011,.02,1,2,"%D",1,0)
Allows problem retrieval by patient, facility, and problem number (Nmbr);
"^DD",9000011,9000011,.02,1,2,"%D",2,0)
the number is used as a string in " 000.00" format to assure a consistent
"^DD",9000011,9000011,.02,1,2,"%D",3,0)
ordering.
"^DD",9000011,9000011,.02,1,3,0)
9000011^ACTIVE1^MUMPS
"^DD",9000011,9000011,.02,1,3,1)
S:$L($P(^AUPNPROB(DA,0),U,12)) ^AUPNPROB("ACTIVE",X,$P(^(0),U,12),DA)=""
"^DD",9000011,9000011,.02,1,3,2)
K:$L($P(^AUPNPROB(DA,0),U,12)) ^AUPNPROB("ACTIVE",X,$P(^(0),U,12),DA)
"^DD",9000011,9000011,.02,1,3,"%D",0)
^^1^1^2930706^^^
"^DD",9000011,9000011,.02,1,3,"%D",1,0)
Allows problem retrieval by patient and status, in order of entry.
"^DD",9000011,9000011,.02,1,3,"DT")
2930706
"^DD",9000011,9000011,.02,3)
Enter the name of the patient for whom this problem has been observed.
"^DD",9000011,9000011,.02,21,0)
^^1^1^2930908^^^^
"^DD",9000011,9000011,.02,21,1,0)
This is the patient for whom this problem has been observed and recorded.
"^DD",9000011,9000011,.02,"DT")
3121130
"^DD",9000011,9000011,.03,0)
DATE LAST MODIFIED^RD^^0;3^S %DT="EX" D ^%DT S X=Y K:DT<X!(2000000>X) X
"^DD",9000011,9000011,.03,1,0)
^.1
"^DD",9000011,9000011,.03,1,1,0)
9000011^MODIFIED^MUMPS
"^DD",9000011,9000011,.03,1,1,1)
K ^AUPNPROB("MODIFIED",$P(^AUPNPROB(DA,0),"^",2)) D NOW^%DTC S ^AUPNPROB("MODIFIED",$P(^AUPNPROB(DA,0),"^",2),%)=""
"^DD",9000011,9000011,.03,1,1,2)
Q
"^DD",9000011,9000011,.03,1,1,"%D",0)
^^2^2^2990319^^^^
"^DD",9000011,9000011,.03,1,1,"%D",1,0)
This Index will keep track of the last time this Patients problem list was 
"^DD",9000011,9000011,.03,1,1,"%D",2,0)
modified.  ^AUPNPROB("MODIFIED"),PATIENT,DATE
"^DD",9000011,9000011,.03,1,1,"DT")
2990319
"^DD",9000011,9000011,.03,3)
TYPE A DATE BETWEEN 1900 AND TODAY
"^DD",9000011,9000011,.03,10)
018/PRCOND
"^DD",9000011,9000011,.03,12)
VISIT MUST BE FOR CURRENT PATIENT
"^DD",9000011,9000011,.03,12.1)
S DIC("S")="I $P(^(0),U,5)=$P(^AUPNPROB(DA,0),U,2)"
"^DD",9000011,9000011,.03,21,0)
^^1^1^2990318^^^^
"^DD",9000011,9000011,.03,21,1,0)
This is the last date/time this problem was changed.
"^DD",9000011,9000011,.03,"DT")
3121130
"^DD",9000011,9000011,.04,0)
CLASS^S^P:PERSONAL HISTORY;F:FAMILY HISTORY;^0;4^Q
"^DD",9000011,9000011,.04,3)
If this problem is historical, indicate if it is Personal or Family history.
"^DD",9000011,9000011,.04,21,0)
^^2^2^2930726^
"^DD",9000011,9000011,.04,21,1,0)
This flag is used by the IHS Problem List to indicate if this problem
"^DD",9000011,9000011,.04,21,2,0)
is documented for historical purposes.
"^DD",9000011,9000011,.04,23,0)
^^2^2^2930726^
"^DD",9000011,9000011,.04,23,1,0)
VA sites using the DHCP Problem List application will not be prompted
"^DD",9000011,9000011,.04,23,2,0)
for this information.
"^DD",9000011,9000011,.04,"DT")
2871007
"^DD",9000011,9000011,.05,0)
PROVIDER NARRATIVE^R*P9999999.27^AUTNPOV(^0;5^S DIC(0)=$S($D(APCDALVR):"LO",1:"EMQLO") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000011,9000011,.05,3)
Enter a description of this patient's problem.
"^DD",9000011,9000011,.05,12)
OLD LOOKUP
"^DD",9000011,9000011,.05,12.1)
S DIC(0)=$S($D(APCDALVR):"LO",1:"EMQLO")
"^DD",9000011,9000011,.05,21,0)
^^2^2^2930406^^
"^DD",9000011,9000011,.05,21,1,0)
This contains the actual text used by the provider to describe this
"^DD",9000011,9000011,.05,21,2,0)
problem.
"^DD",9000011,9000011,.05,"DT")
2881128
"^DD",9000011,9000011,.06,0)
FACILITY^RP9999999.06'I^AUTTLOC(^0;6^Q
"^DD",9000011,9000011,.06,1,0)
^.1
"^DD",9000011,9000011,.06,1,1,0)
9000011^AV1^MUMPS
"^DD",9000011,9000011,.06,1,1,1)
Q
"^DD",9000011,9000011,.06,1,1,2)
Q
"^DD",9000011,9000011,.06,1,1,"%D",0)
^^1^1^2940110^
"^DD",9000011,9000011,.06,1,1,"%D",1,0)
No longer in use.
"^DD",9000011,9000011,.06,1,1,"DT")
2940110
"^DD",9000011,9000011,.06,1,2,0)
9000011^AATOO2^MUMPS
"^DD",9000011,9000011,.06,1,2,1)
I $P(^AUPNPROB(DA,0),U,2)]"",$P(^(0),U,7)]"" S X1=$P($P(^(0),U,7),"."),X2=$P($P(^(0),U,7),".",2),^AUPNPROB("AA",$P(^(0),U,2),X," "_$E("000",1,4-$L(X1)-1)_X1_"."_X2_$E("00",1,3-$L(X2)-1),DA)="" K X1,X2
"^DD",9000011,9000011,.06,1,2,2)
I $P(^AUPNPROB(DA,0),U,2)]"",$P(^(0),U,7)]"" S X1=$P($P(^(0),U,7),"."),X2=$P($P(^(0),U,7),".",2) K ^AUPNPROB("AA",$P(^(0),U,2),X," "_$E("000",1,4-$L(X1)-1)_X1_"."_X2_$E("00",1,3-$L(X2)-1),DA),X1,X2
"^DD",9000011,9000011,.06,1,2,"%D",0)
^^3^3^2930825^
"^DD",9000011,9000011,.06,1,2,"%D",1,0)
Allows problem retrieval by patient, facility, and problem number (Nmbr);
"^DD",9000011,9000011,.06,1,2,"%D",2,0)
the number is used as a string in " 000.00" format to assure a consistent
"^DD",9000011,9000011,.06,1,2,"%D",3,0)
ordering.
"^DD",9000011,9000011,.06,3)
Enter the location at which this problem was first observed and recorded.
"^DD",9000011,9000011,.06,21,0)
^^2^2^2930908^^^^
"^DD",9000011,9000011,.06,21,1,0)
This is the facility at which this problem was originally observed and
"^DD",9000011,9000011,.06,21,2,0)
documented.
"^DD",9000011,9000011,.06,"DT")
2940110
"^DD",9000011,9000011,.07,0)
NMBR^RNJ6,2X^^0;7^K:+X'=X!(X>999.99)!(X<1)!(X?.E1"."3N.N) X Q:'$D(X)  K:$D(^AUPNPROB("AA",$P(^AUPNPROB(DA,0),U,2),$P(^(0),U,6)," "_$E("000",1,4-$L($P(X,".",1))-1)_$P(X,".",1)_"."_$P(X,".",2)_$E("00",1,3-$L($P(X,".",2))-1))) X
"^DD",9000011,9000011,.07,1,0)
^.1
"^DD",9000011,9000011,.07,1,1,0)
9000011^AA^MUMPS
"^DD",9000011,9000011,.07,1,1,1)
S ^AUPNPROB("AA",$P(^AUPNPROB(DA,0),U,2),$P(^(0),U,6)," "_$E("000",1,4-$L($P(X,".",1))-1)_$P(X,".",1)_"."_$P(X,".",2)_$E("00",1,3-$L($P(X,".",2))-1),DA)=""
"^DD",9000011,9000011,.07,1,1,2)
K ^AUPNPROB("AA",$P(^AUPNPROB(DA,0),U,2),$P(^(0),U,6)," "_$E("000",1,4-$L($P(X,".",1))-1)_$P(X,".",1)_"."_$P(X,".",2)_$E("00",1,3-$L($P(X,".",2))-1),DA)
"^DD",9000011,9000011,.07,1,1,"%D",0)
^^3^3^2930825^
"^DD",9000011,9000011,.07,1,1,"%D",1,0)
Allows problem retrieval by patient, facility, and problem number (Nmbr);
"^DD",9000011,9000011,.07,1,1,"%D",2,0)
the number is used as a string in " 000.00" format to assure a consistent
"^DD",9000011,9000011,.07,1,1,"%D",3,0)
ordering.
"^DD",9000011,9000011,.07,3)
TYPE A NUMBER BETWEEN 1 AND 999.99
"^DD",9000011,9000011,.07,10)
018/PRNUMB
"^DD",9000011,9000011,.07,21,0)
^^4^4^2930726^
"^DD",9000011,9000011,.07,21,1,0)
This is a number which, together with the Patient (#.02) and Facility (#.06)
"^DD",9000011,9000011,.07,21,2,0)
fields, serves as a unique identifier for this problem.  Up to 2 decimal
"^DD",9000011,9000011,.07,21,3,0)
places may be used to indicate that a problem is a result of, or related
"^DD",9000011,9000011,.07,21,4,0)
to, another problem.
"^DD",9000011,9000011,.07,"DT")
2930726
"^DD",9000011,9000011,.08,0)
DATE ENTERED^RDI^^0;8^S %DT="EX" D ^%DT S X=Y K:DT<X!(2000000>X) X
"^DD",9000011,9000011,.08,3)
TYPE A DATE BETWEEN 1900 AND TODAY
"^DD",9000011,9000011,.08,10)
018/PREDAT
"^DD",9000011,9000011,.08,12)
VISIT MUST BE FOR CURRENT PATIENT
"^DD",9000011,9000011,.08,12.1)
S DIC("S")="I $P(^(0),U,5)=$P(^AUPNPROB(DA,0),U,2)"
"^DD",9000011,9000011,.08,21,0)
^^1^1^2940111^^^
"^DD",9000011,9000011,.08,21,1,0)
This is the date this problem was entered into this file.
"^DD",9000011,9000011,.08,"DT")
3120607
"^DD",9000011,9000011,.12,0)
STATUS^RS^A:ACTIVE;I:INACTIVE;^0;12^Q
"^DD",9000011,9000011,.12,1,0)
^.1
"^DD",9000011,9000011,.12,1,1,0)
9000011^ACTIVE^MUMPS
"^DD",9000011,9000011,.12,1,1,1)
S:$P(^AUPNPROB(DA,0),U,2) ^AUPNPROB("ACTIVE",+$P(^(0),U,2),X,DA)=""
"^DD",9000011,9000011,.12,1,1,2)
K ^AUPNPROB("ACTIVE",+$P(^AUPNPROB(DA,0),U,2),X,DA)
"^DD",9000011,9000011,.12,1,1,"%D",0)
^^1^1^2930706^^
"^DD",9000011,9000011,.12,1,1,"%D",1,0)
Allows problem retrieval by patient and status, in order of entry.
"^DD",9000011,9000011,.12,1,1,"DT")
2930706
"^DD",9000011,9000011,.12,3)
Enter the current status of this problem, active or inactive.
"^DD",9000011,9000011,.12,10)
018/PRSTAT
"^DD",9000011,9000011,.12,21,0)
^^3^3^2930406^^
"^DD",9000011,9000011,.12,21,1,0)
This is the current activity status of this problem, whether active or
"^DD",9000011,9000011,.12,21,2,0)
inactive; if more detail is needed, a notation may be filed with this
"^DD",9000011,9000011,.12,21,3,0)
problem.
"^DD",9000011,9000011,.12,"DT")
3121130
"^DD",9000011,9000011,.13,0)
DATE OF ONSET^D^^0;13^S %DT="E" D ^%DT S X=Y K:DT<X!(1800000>X) X
"^DD",9000011,9000011,.13,3)
TYPE A DATE BETWEEN 1880 AND TODAY
"^DD",9000011,9000011,.13,21,0)
^^1^1^2930726^^^^
"^DD",9000011,9000011,.13,21,1,0)
This is the approximate date this problem appeared, as precisely as known.
"^DD",9000011,9000011,.13,"DT")
2930613
"^DD",9000011,9000011,1.01,0)
PROBLEM^P757.01'^LEX(757.01,^1;1^Q
"^DD",9000011,9000011,1.01,1,0)
^.1
"^DD",9000011,9000011,1.01,1,1,0)
9000011^C
"^DD",9000011,9000011,1.01,1,1,1)
S ^AUPNPROB("C",$E(X,1,30),DA)=""
"^DD",9000011,9000011,1.01,1,1,2)
K ^AUPNPROB("C",$E(X,1,30),DA)
"^DD",9000011,9000011,1.01,1,1,"DT")
2930728
"^DD",9000011,9000011,1.01,3)
Enter the problem observed for this patient.
"^DD",9000011,9000011,1.01,21,0)
^^2^2^2930908^^
"^DD",9000011,9000011,1.01,21,1,0)
This field contains the standardized text stored in the Clinical Lexicon
"^DD",9000011,9000011,1.01,21,2,0)
for this problem.
"^DD",9000011,9000011,1.01,"DT")
2930728
"^DD",9000011,9000011,1.02,0)
CONDITION^S^T:TRANSCRIBED;P:PERMANENT;H:HIDDEN;^1;2^Q
"^DD",9000011,9000011,1.02,21,0)
^^3^3^2930908^^^
"^DD",9000011,9000011,1.02,21,1,0)
This reflects the current condition of this entry, whether transcribed
"^DD",9000011,9000011,1.02,21,2,0)
by a clerk from the paper chart, entered or verified by a provider,
"^DD",9000011,9000011,1.02,21,3,0)
or marked as removed from the patient's list.
"^DD",9000011,9000011,1.02,23,0)
^^6^6^2930908^^
"^DD",9000011,9000011,1.02,23,1,0)
This flag is used internally by the DHCP Problem List; entries having
"^DD",9000011,9000011,1.02,23,2,0)
an H in this field have been "deleted" and are maintained for historical
"^DD",9000011,9000011,1.02,23,3,0)
use but are generally ignored.  If the parameter "Verify Transcribed
"^DD",9000011,9000011,1.02,23,4,0)
Entries" is turned on in File #125.99, entries made by a clerk will have
"^DD",9000011,9000011,1.02,23,5,0)
a T here, and a flag will appear on the clinician's display of the list.
"^DD",9000011,9000011,1.02,23,6,0)
P entries have been entered or verified by a provider.
"^DD",9000011,9000011,1.02,"DT")
3121130
"^DD",9000011,9000011,1.03,0)
ENTERED BY^P200'^VA(200,^1;3^Q
"^DD",9000011,9000011,1.03,3)
Enter the name of the current user.
"^DD",9000011,9000011,1.03,21,0)
^^1^1^2930726^
"^DD",9000011,9000011,1.03,21,1,0)
This is the user who actually entered this problem into this file.
"^DD",9000011,9000011,1.03,"DT")
2930726
"^DD",9000011,9000011,1.04,0)
RECORDING PROVIDER^P200'X^VA(200,^1;4^Q
"^DD",9000011,9000011,1.04,3)
Enter the name of the provider who first recorded this data.
"^DD",9000011,9000011,1.04,12.1)
S DIC("S")="I $S('$D(^(""PS"")):1,'$P(^(""PS""),U,4):1,DT')$P(^(""PS""),U,4):1,1:0)&($D(^XUSEC(""PROVIDER"",Y)))"
"^DD",9000011,9000011,1.04,21,0)
^^2^2^2960502^^^
"^DD",9000011,9000011,1.04,21,1,0)
This is the provider who first recorded this problem, either on the
"^DD",9000011,9000011,1.04,21,2,0)
paper chart or online.
"^DD",9000011,9000011,1.04,"DT")
2960502
"^DD",9000011,9000011,1.05,0)
RESPONSIBLE PROVIDER^P200'^VA(200,^1;5^Q
"^DD",9000011,9000011,1.05,3)
Enter the name of the local provider treating this problem.
"^DD",9000011,9000011,1.05,21,0)
^^1^1^2930726^
"^DD",9000011,9000011,1.05,21,1,0)
This is the provider currently responsible for treating this problem.
"^DD",9000011,9000011,1.05,"DT")
2930726
"^DD",9000011,9000011,1.06,0)
SERVICE^P49'^DIC(49,^1;6^Q
"^DD",9000011,9000011,1.06,3)
Enter the service to be associated with this problem.
"^DD",9000011,9000011,1.06,21,0)
^^5^5^2931223^^^
"^DD",9000011,9000011,1.06,21,1,0)
This is the service primarily involved in the treatment of this problem;
"^DD",9000011,9000011,1.06,21,2,0)
the DHCP Problem List defaults this field to the service defined in
"^DD",9000011,9000011,1.06,21,3,0)
File #200 for the Recording Provider of this problem, upon entry of the
"^DD",9000011,9000011,1.06,21,4,0)
problem.  It may later be used to categorize problems for screening and
"^DD",9000011,9000011,1.06,21,5,0)
sorting.
"^DD",9000011,9000011,1.06,"DT")
2930726
"^DD",9000011,9000011,1.07,0)
DATE RESOLVED^D^^1;7^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9000011,9000011,1.07,3)
Enter the date this problem became resolved or inactive, as precisely as known.
"^DD",9000011,9000011,1.07,21,0)
^^2^2^2930726^
"^DD",9000011,9000011,1.07,21,1,0)
This is the date this problem was resolved or inactivated, as precisely
"^DD",9000011,9000011,1.07,21,2,0)
as known.
"^DD",9000011,9000011,1.07,"DT")
2930726
"^DD",9000011,9000011,1.08,0)
CLINIC^*P44'^SC(^1;8^S DIC("S")="I $P(^(0),U,3)=""C""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000011,9000011,1.08,3)
Enter the clinic in which the patient is being seen for this problem.
"^DD",9000011,9000011,1.08,12)
Only clinics are allowed here.
"^DD",9000011,9000011,1.08,12.1)
S DIC("S")="I $P(^(0),U,3)=""C"""
"^DD",9000011,9000011,1.08,21,0)
^^3^3^2931223^
"^DD",9000011,9000011,1.08,21,1,0)
This is the clinic in which this patient is being seen for this problem.
"^DD",9000011,9000011,1.08,21,2,0)
The problem list may be screened based on this value, to change one's
"^DD",9000011,9000011,1.08,21,3,0)
view of the list.
"^DD",9000011,9000011,1.08,"DT")
2940412
"^DD",9000011,9000011,1.09,0)
DATE RECORDED^D^^1;9^S %DT="E" D ^%DT S X=Y K:DT<X!(2000000>X) X
"^DD",9000011,9000011,1.09,3)
Enter the date this problem was first recorded, as precisely as known.
"^DD",9000011,9000011,1.09,21,0)
^^3^3^2940118^
"^DD",9000011,9000011,1.09,21,1,0)
This is the date this problem was originally recorded, either online or
"^DD",9000011,9000011,1.09,21,2,0)
in the paper chart; it may be the same as, or earlier than, the Date
"^DD",9000011,9000011,1.09,21,3,0)
Entered.
"^DD",9000011,9000011,1.09,"DT")
2940111
"^DD",9000011,9000011,1.1,0)
SERVICE CONNECTED^S^1:YES;0:NO;^1;10^Q
"^DD",9000011,9000011,1.1,3)
If this problem is service connected, enter YES here.
"^DD",9000011,9000011,1.1,21,0)
^^2^2^2930726^^^
"^DD",9000011,9000011,1.1,21,1,0)
If the patient has service connection on file in the DHCP Patient file #2,
"^DD",9000011,9000011,1.1,21,2,0)
this problem specifically may be flagged as being service connected.
"^DD",9000011,9000011,1.1,23,0)
^^3^3^2930726^^
"^DD",9000011,9000011,1.1,23,1,0)
This data will be prompted for in the DHCP Problem List only if the
"^DD",9000011,9000011,1.1,23,2,0)
patient is indicated for service connection.  Non-VA sites will not
"^DD",9000011,9000011,1.1,23,3,0)
be prompted for this information.
"^DD",9000011,9000011,1.1,"DT")
2930726
"^DD",9000011,9000011,1.11,0)
AGENT ORANGE EXPOSURE^S^1:YES;0:NO;^1;11^Q
"^DD",9000011,9000011,1.11,3)
Enter YES if this problem is related to exposure to Agent Orange.
"^DD",9000011,9000011,1.11,21,0)
^^2^2^2930726^
"^DD",9000011,9000011,1.11,21,1,0)
If this problem is related to a patient's exposure to Agent Orange,
"^DD",9000011,9000011,1.11,21,2,0)
it may be flagged here.
"^DD",9000011,9000011,1.11,23,0)
^^3^3^2930726^
"^DD",9000011,9000011,1.11,23,1,0)
This data will be prompted for in the DHCP Problem List only if a patient
"^DD",9000011,9000011,1.11,23,2,0)
has Agent Orange exposure indicated.  Non-VA sites will not be prompted
"^DD",9000011,9000011,1.11,23,3,0)
for this information.
"^DD",9000011,9000011,1.11,"DT")
2930726
"^DD",9000011,9000011,1.12,0)
IONIZING RADIATION EXPOSURE^S^1:YES;0:NO;^1;12^Q
"^DD",9000011,9000011,1.12,3)
Enter YES if this problem is related to exposure to ionizing radiation.
"^DD",9000011,9000011,1.12,21,0)
^^2^2^2930726^
"^DD",9000011,9000011,1.12,21,1,0)
If this problem is related to a patient's exposure to ionizing radiation,
"^DD",9000011,9000011,1.12,21,2,0)
it may be flagged here.
"^DD",9000011,9000011,1.12,23,0)
^^3^3^2930726^
"^DD",9000011,9000011,1.12,23,1,0)
This data will be prompted for in the DHCP Problem List only if the patient
"^DD",9000011,9000011,1.12,23,2,0)
has ionizing radiation exposure indicated.  Non-VA sites will not be
"^DD",9000011,9000011,1.12,23,3,0)
prompted for this information.
"^DD",9000011,9000011,1.12,"DT")
2930726
"^DD",9000011,9000011,1.13,0)
PERSIAN GULF EXPOSURE^S^1:YES;0:NO;^1;13^Q
"^DD",9000011,9000011,1.13,3)
Enter YES if this problem is related to a Persian Gulf exposure.
"^DD",9000011,9000011,1.13,21,0)
^^2^2^2930726^
"^DD",9000011,9000011,1.13,21,1,0)
If this problem is related to a patient's service in the Persian Gulf,
"^DD",9000011,9000011,1.13,21,2,0)
it may be flagged here.
"^DD",9000011,9000011,1.13,23,0)
^^2^2^2930726^
"^DD",9000011,9000011,1.13,23,1,0)
This data will be prompted for only if a patient has Persian Gulf service
"^DD",9000011,9000011,1.13,23,2,0)
indicated.  Non-VA sites will not be prompted for this information.
"^DD",9000011,9000011,1.13,"DT")
2930726
"^DD",9000011,9000011,1.14,0)
PRIORITY^S^A:ACUTE;C:CHRONIC;^1;14^Q
"^DD",9000011,9000011,1.14,3)
You may further refine the status of this problem by assigning it a priority.
"^DD",9000011,9000011,1.14,21,0)
^^2^2^2940323^^^
"^DD",9000011,9000011,1.14,21,1,0)
This is a flag to indicate how critical this problem is for this patient;
"^DD",9000011,9000011,1.14,21,2,0)
problems marked as Acute will be flagged on the Problem List display.
"^DD",9000011,9000011,1.14,"DT")
3121130
"^DD",9000011,9000011,1.15,0)
HEAD AND/OR NECK CANCER^S^1:YES;0:NO;^1;15^Q
"^DD",9000011,9000011,1.15,21,0)
^.001^2^2^3020307^^
"^DD",9000011,9000011,1.15,21,1,0)
If this problem is related to the treatment of head and/or neck cancer 
"^DD",9000011,9000011,1.15,21,2,0)
associated with nose or throat radium treatments, it may be flagged here.
"^DD",9000011,9000011,1.15,23,0)
^^2^2^3020307^
"^DD",9000011,9000011,1.15,23,1,0)
This data will be prompted for only if a patient has received nose or throat
"^DD",9000011,9000011,1.15,23,2,0)
radium treatments.
"^DD",9000011,9000011,1.15,"DT")
3020307
"^DD",9000011,9000011,1.16,0)
MILITARY SEXUAL TRAUMA^S^1:YES;0:NO;^1;16^Q
"^DD",9000011,9000011,1.16,21,0)
^.001^2^2^3020307^^
"^DD",9000011,9000011,1.16,21,1,0)
If this problem is related to the treatment of military sexual trauma, it may
"^DD",9000011,9000011,1.16,21,2,0)
be flagged here.
"^DD",9000011,9000011,1.16,23,0)
^^2^2^3020307^
"^DD",9000011,9000011,1.16,23,1,0)
This data will be prompted for only if a patient has been treated for military
"^DD",9000011,9000011,1.16,23,2,0)
sexual trauma.
"^DD",9000011,9000011,1.16,"DT")
3020307
"^DD",9000011,9000011,1.17,0)
COMBAT VETERAN^S^1:YES;0:NO;^1;17^Q
"^DD",9000011,9000011,1.17,3)
If this problem is a result of combat it may be flagged here
"^DD",9000011,9000011,1.17,"DT")
3031125
"^DD",9000011,9000011,1.18,0)
SHIPBOARD HAZARD & DEFENSE^S^1:YES;0:NO;^1;18^Q
"^DD",9000011,9000011,1.18,3)
If this problem is a result of SHAD, it may be flagged here
"^DD",9000011,9000011,1.18,"DT")
3060918
"^DD",9000011,9000011,1101,0)
NOTE FACILITY^9000011.11PA^^11;0
"^DD",9000011,9000011,1101,21,0)
^^1^1^2940208^
"^DD",9000011,9000011,1101,21,1,0)
This is the location at which the notes in this multiple originated.
"^DD",9000011,9000011,80001,0)
SNOMED CT CONCEPT CODE^F^^800;1^K:$L(X)>40!($L(X)<1)!'(X?1.40N) X
"^DD",9000011,9000011,80001,1,0)
^.1
"^DD",9000011,9000011,80001,1,1,0)
9000011^ASCT
"^DD",9000011,9000011,80001,1,1,1)
S ^AUPNPROB("ASCT",$E(X,1,30),DA)=""
"^DD",9000011,9000011,80001,1,1,2)
K ^AUPNPROB("ASCT",$E(X,1,30),DA)
"^DD",9000011,9000011,80001,1,1,3)
** DO NOT DELETE **
"^DD",9000011,9000011,80001,1,1,"%D",0)
^^3^3^3120607^
"^DD",9000011,9000011,80001,1,1,"%D",1,0)
This REGULAR FileMan cross-reference on SNOMED CT Concept will help to
"^DD",9000011,9000011,80001,1,1,"%D",2,0)
automate the updating of problems when SNOMED Concepts are mapped or
"^DD",9000011,9000011,80001,1,1,"%D",3,0)
re-mapped to ICD-9-CM codes.
"^DD",9000011,9000011,80001,1,1,"DT")
3120607
"^DD",9000011,9000011,80001,3)
Answer must be 1-40 numeric characters in length.
"^DD",9000011,9000011,80001,21,0)
^^2^2^3120606^
"^DD",9000011,9000011,80001,21,1,0)
A clinical idea to which a unique ConceptID has been assigned in SNOMED
"^DD",9000011,9000011,80001,21,2,0)
CT. Each Concept is represented by a row in the Concepts Table.
"^DD",9000011,9000011,80001,23,0)
^^2^2^3120606^
"^DD",9000011,9000011,80001,23,1,0)
NOTE: This field is filed programmatically. The user should never be 
"^DD",9000011,9000011,80001,23,2,0)
directly prompted for it.
"^DD",9000011,9000011,80001,"DT")
3120607
"^DD",9000011,9000011,80002,0)
SNOMED CT DESIGNATION CODE^F^^800;2^K:$L(X)>40!($L(X)<1)!'(X?1.40N) X
"^DD",9000011,9000011,80002,3)
Answer must be 1-40 numeric characters in length.
"^DD",9000011,9000011,80002,21,0)
^^9^9^3120606^
"^DD",9000011,9000011,80002,21,1,0)
A single SNOMED Concept may have multiple Designations, where a 
"^DD",9000011,9000011,80002,21,2,0)
Designation may be considered an alternate way of expressing the concept. 
"^DD",9000011,9000011,80002,21,3,0)
Synonyms, lexical variants, abbreviations are all different types of 
"^DD",9000011,9000011,80002,21,4,0)
designations. In many cases, a problem (as reported by the patient) and a 
"^DD",9000011,9000011,80002,21,5,0)
finding indicating a problem will share the same concept and concept code 
"^DD",9000011,9000011,80002,21,6,0)
(e.g., abdominal pain), but will have different designation codes (i.e., 
"^DD",9000011,9000011,80002,21,7,0)
the generic "abdominal pain  and "abdominal pain (finding)  share the 
"^DD",9000011,9000011,80002,21,8,0)
concept code 21522001, but they have the designation codes 36112013 and 
"^DD",9000011,9000011,80002,21,9,0)
750827015 respectively.
"^DD",9000011,9000011,80002,23,0)
^^2^2^3120606^
"^DD",9000011,9000011,80002,23,1,0)
NOTE: This field is filed programmatically. The user should never be 
"^DD",9000011,9000011,80002,23,2,0)
directly prompted for it.
"^DD",9000011,9000011,80002,"DT")
3120606
"^DD",9000011,9000011,80003,0)
VHAT CONCEPT VUID (FUTURE)^F^^800;3^K:$L(X)>20!($L(X)<1)!'(X?1.20N) X
"^DD",9000011,9000011,80003,3)
Answer must be 1-20 characters in length.
"^DD",9000011,9000011,80003,21,0)
^^19^19^3120606^
"^DD",9000011,9000011,80003,21,1,0)
VHA Unique ID (VUID) for the VHAT Concept. A unique meaningless integer
"^DD",9000011,9000011,80003,21,2,0)
assigned to a corresponding concept VHA wide.
"^DD",9000011,9000011,80003,21,3,0)
 
"^DD",9000011,9000011,80003,21,4,0)
This field is being implemented to allow a more rapidly extensible 
"^DD",9000011,9000011,80003,21,5,0)
vocabulary for VA, while international normative standard coding systems 
"^DD",9000011,9000011,80003,21,6,0)
continue to evolve more slowly. The precise definition of the concept 
"^DD",9000011,9000011,80003,21,7,0)
Polytrauma may prove to be a useful example. Although the term has 
"^DD",9000011,9000011,80003,21,8,0)
become common among US Military and VA physicians to describe a seriously 
"^DD",9000011,9000011,80003,21,9,0)
injured (i.e., Injury Severity Score (ISS) >= 16) soldier with multiple 
"^DD",9000011,9000011,80003,21,10,0)
traumatic injuries, it is not yet available as a coded concept in either
"^DD",9000011,9000011,80003,21,11,0)
SNOMED CT, ICD-9-CM, or ICD-10-CM. Allowing the definition and deployment
"^DD",9000011,9000011,80003,21,12,0)
of VHAT Concept/Designation VUID pairs to identify such problems in
"^DD",9000011,9000011,80003,21,13,0)
advance of their acceptance by the international medical community will
"^DD",9000011,9000011,80003,21,14,0)
help to provide coded, computable documentation in a much more timely
"^DD",9000011,9000011,80003,21,15,0)
manner than waiting for inclusion in SNOMED CT or ICD.
"^DD",9000011,9000011,80003,21,16,0)
 
"^DD",9000011,9000011,80003,21,17,0)
When the infrastructure in VA's Enterprise Terminology Server (ETS) & New
"^DD",9000011,9000011,80003,21,18,0)
Term Rapid Turn-around (NTRT) service are ready to deploy VHAT Concepts, 
"^DD",9000011,9000011,80003,21,19,0)
this field will allow us to store patient problems encoded with them.
"^DD",9000011,9000011,80003,23,0)
^^2^2^3120606^
"^DD",9000011,9000011,80003,23,1,0)
NOTE: This field is filed programmatically. The user should never be 
"^DD",9000011,9000011,80003,23,2,0)
directly prompted for it.
"^DD",9000011,9000011,80003,"DT")
3120606
"^DD",9000011,9000011,80004,0)
VHAT DESIGNATION VUID (FUTURE)^F^^800;4^K:$L(X)>20!($L(X)<1)!'(X?1.20N) X
"^DD",9000011,9000011,80004,3)
Answer must be 1-20 numeric characters in length.
"^DD",9000011,9000011,80004,21,0)
^^7^7^3120606^
"^DD",9000011,9000011,80004,21,1,0)
VHA Unique ID (VUID) for the VHAT Designation. A unique meaningless
"^DD",9000011,9000011,80004,21,2,0)
integer assigned to a corresponding designation VHA wide.
"^DD",9000011,9000011,80004,21,3,0)
 
"^DD",9000011,9000011,80004,21,4,0)
VHAT Concept/Designation Code pairs function in a manner identical to 
"^DD",9000011,9000011,80004,21,5,0)
that of SNOMED CT Concept/Designation Codes (i.e., they support the 
"^DD",9000011,9000011,80004,21,6,0)
unique identification of clinical concepts, along with the many 
"^DD",9000011,9000011,80004,21,7,0)
alternative ways in which a given concept may be expressed).
"^DD",9000011,9000011,80004,23,0)
^^2^2^3120606^
"^DD",9000011,9000011,80004,23,1,0)
NOTE: This field is filed programmatically. The user should never be 
"^DD",9000011,9000011,80004,23,2,0)
directly prompted for it.
"^DD",9000011,9000011,80004,"DT")
3120606
"^DD",9000011,9000011,80005,0)
SNOMED CT-TO-ICD MAP STATUS^S^0:N/A;1:PENDING;2:COMPLETED;^800;5^Q
"^DD",9000011,9000011,80005,3)
Set by program to reflect mapping status of a finding
"^DD",9000011,9000011,80005,21,0)
^^6^6^3120606^
"^DD",9000011,9000011,80005,21,1,0)
This Set of Codes type field is set to PENDING when an unmapped Clinical
"^DD",9000011,9000011,80005,21,2,0)
Finding is selected as a patient's problem. It is updated programmatically
"^DD",9000011,9000011,80005,21,3,0)
to COMPLETE when NTRT deploys a new SNOMED CT to ICD mapping for 
"^DD",9000011,9000011,80005,21,4,0)
the problem in question.
"^DD",9000011,9000011,80005,21,5,0)
 
"^DD",9000011,9000011,80005,21,6,0)
NOTE: THIS FIELD SHOULD NEVER BE UPDATED BY AN END USER.
"^DD",9000011,9000011,80005,23,0)
^^4^4^3120606^
"^DD",9000011,9000011,80005,23,1,0)
This Set of Codes type field is set to PENDING when an unmapped Clinical
"^DD",9000011,9000011,80005,23,2,0)
Finding is selected as a patient's problem. It is updated programmatically
"^DD",9000011,9000011,80005,23,3,0)
to COMPLETE when NTRT deploys a new SNOMED CT to ICD mapping for 
"^DD",9000011,9000011,80005,23,4,0)
the problem in question.
"^DD",9000011,9000011,80005,"DT")
3120607
"^DD",9000011,9000011,80101,0)
UNIQUE NEW TERM REQUESTED^S^0:False;1:True;^801;1^Q
"^DD",9000011,9000011,80101,3)
Indicate whether a New Term was requested (NTRT)
"^DD",9000011,9000011,80101,21,0)
^^5^5^3120606^
"^DD",9000011,9000011,80101,21,1,0)
Indicates whether the user requested a new term during the process of 
"^DD",9000011,9000011,80101,21,2,0)
entering a freetext problem. It should only be populated automatically by 
"^DD",9000011,9000011,80101,21,3,0)
program code. 
"^DD",9000011,9000011,80101,21,4,0)
 
"^DD",9000011,9000011,80101,21,5,0)
NOTE: THIS FIELD SHOULD NEVER BE UPDATED BY AN END USER.
"^DD",9000011,9000011,80101,23,0)
^^5^5^3120606^
"^DD",9000011,9000011,80101,23,1,0)
This Boolean field indicates whether the provider requested a new term to 
"^DD",9000011,9000011,80101,23,2,0)
be proposed and considered for inclusion in SNOMED CT. If accepted, the 
"^DD",9000011,9000011,80101,23,3,0)
term will be deployed by the NTRT process. It should only be populated 
"^DD",9000011,9000011,80101,23,4,0)
automatically by program code. The user will never be prompted for a value
"^DD",9000011,9000011,80101,23,5,0)
for this field.
"^DD",9000011,9000011,80101,"DT")
3120606
"^DD",9000011,9000011,80102,0)
UNIQUE TERM REQUEST COMMENT^F^^801;2^K:$L(X)>80!($L(X)<2) X
"^DD",9000011,9000011,80102,3)
Answer must be 2-80 characters in length.
"^DD",9000011,9000011,80102,21,0)
^^3^3^3120606^
"^DD",9000011,9000011,80102,21,1,0)
Please provide clarification of the new term request. For example, if the
"^DD",9000011,9000011,80102,21,2,0)
requested term is an acronym or abbreviation, the comment field 
"^DD",9000011,9000011,80102,21,3,0)
accommodates the fully specified name, etc.
"^DD",9000011,9000011,80102,23,0)
^^4^4^3120606^
"^DD",9000011,9000011,80102,23,1,0)
This freetext field supports the storage of a one-line explanatory 
"^DD",9000011,9000011,80102,23,2,0)
comment, to provide clarification of the new term request. For example, 
"^DD",9000011,9000011,80102,23,3,0)
if the requested term is an acronym or abbreviation, the comment field 
"^DD",9000011,9000011,80102,23,4,0)
accommodates the fully specified name, etc.
"^DD",9000011,9000011,80102,"DT")
3120606
"^DD",9000011,9000011,80201,0)
DATE OF INTEREST^D^^802;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9000011,9000011,80201,3)
(No range limit on date)
"^DD",9000011,9000011,80201,21,0)
^.001^3^3^3121218^^^^
"^DD",9000011,9000011,80201,21,1,0)
This is the date when the DIAGNOSIS (#.01) and CODING SYSTEM (#80202) 
"^DD",9000011,9000011,80201,21,2,0)
fields were filed or modified. This allows proper resolution of the code, 
"^DD",9000011,9000011,80201,21,3,0)
irrespective of code set versions, etc.  
"^DD",9000011,9000011,80201,"DT")
3120724
"^DD",9000011,9000011,80202,0)
CODING SYSTEM^F^^802;2^K:$L(X)>3!($L(X)<3) X
"^DD",9000011,9000011,80202,3)
Answer must be 3 characters in length.
"^DD",9000011,9000011,80202,21,0)
^.001^13^13^3121218^^
"^DD",9000011,9000011,80202,21,1,0)
This identifies the Coding System to which the Code belongs. It 
"^DD",9000011,9000011,80202,21,2,0)
corresponds to the Coding System Abbreviation in the ICD Coding Systems 
"^DD",9000011,9000011,80202,21,3,0)
File, to optimize internal/external API calls for resolving codes, 
"^DD",9000011,9000011,80202,21,4,0)
independent of their code set version, and to facilitate transition from 
"^DD",9000011,9000011,80202,21,5,0)
ICD-9-CM to ICD-10-CM.
"^DD",9000011,9000011,80202,21,6,0)
 
"^DD",9000011,9000011,80202,21,7,0)
Examples include:
"^DD",9000011,9000011,80202,21,8,0)
 
"^DD",9000011,9000011,80202,21,9,0)
CODING SYS 
"^DD",9000011,9000011,80202,21,10,0)
  ABBREV       NOMENCLATURE    ICD FILE
"^DD",9000011,9000011,80202,21,11,0)
---------------------------------------------
"^DD",9000011,9000011,80202,21,12,0)
   10D          ICD-10-CM      ICD Diagnosis
"^DD",9000011,9000011,80202,21,13,0)
   ICD          ICD-9-CM       ICD Diagnosis 
"^DD",9000011,9000011,80202,23,0)
^.001^6^6^3121218^^
"^DD",9000011,9000011,80202,23,1,0)
This field is populated via M code and utilizes incremental/decremental 
"^DD",9000011,9000011,80202,23,2,0)
timed locks to the PROBLEM file #9000011 for new problem entries. The 
"^DD",9000011,9000011,80202,23,3,0)
Coding System Source Abbreviation (SAB) is programmatically filed in 
"^DD",9000011,9000011,80202,23,4,0)
NEW^GMPLSAVE. The Coding System SAB is further validated before storage by
"^DD",9000011,9000011,80202,23,5,0)
utilizing the following ICD API's: $$CSI^ICDEX and $$SAB^ICDEX. This
"^DD",9000011,9000011,80202,23,6,0)
ensures that the correct code version or SAB is getting filed.
"^DD",9000011,9000011,80202,"DT")
3120717
"^DD",9000011,9000011,80300,0)
MAPPING TARGETS^9000011.803A^^803;0
"^DD",9000011,9000011,80300,21,0)
^^5^5^3120606^
"^DD",9000011,9000011,80300,21,1,0)
This multiple includes mapped expressions: complications, comorbidities,
"^DD",9000011,9000011,80300,21,2,0)
and compound diagnoses. e.g., the single SNOMED CT concept Diabetic
"^DD",9000011,9000011,80300,21,3,0)
neuropathy (230572002) is mapped to two ICD-9-CM diagnoses: DIABETES WITH
"^DD",9000011,9000011,80300,21,4,0)
NEUROLOGICAL MANIFESTATIONS, TYPE II OR UNSPECIFIED TYPE, NOT STATED AS
"^DD",9000011,9000011,80300,21,5,0)
UNCONTROLLED (250.60) and POLYNEUROPATHY IN DIABETES (357.2).
"^DD",9000011,9000011.11,0)
NOTE FACILITY SUB-FIELD^^1101^2
"^DD",9000011,9000011.11,0,"DT")
2940110
"^DD",9000011,9000011.11,0,"IX","B",9000011.11,.01)

"^DD",9000011,9000011.11,0,"NM","NOTE FACILITY")

"^DD",9000011,9000011.11,0,"UP")
9000011
"^DD",9000011,9000011.11,.01,0)
NOTE FACILITY^MP9999999.06'^AUTTLOC(^0;1^Q
"^DD",9000011,9000011.11,.01,1,0)
^.1
"^DD",9000011,9000011.11,.01,1,1,0)
9000011.11^B
"^DD",9000011,9000011.11,.01,1,1,1)
S ^AUPNPROB(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9000011,9000011.11,.01,1,1,2)
K ^AUPNPROB(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9000011,9000011.11,.01,3)
Enter the location at which these notes originated.
"^DD",9000011,9000011.11,.01,21,0)
^^1^1^2940110^^
"^DD",9000011,9000011.11,.01,21,1,0)
This is the location at which the notes in this multiple originated.
"^DD",9000011,9000011.11,.01,"AUDIT")
n
"^DD",9000011,9000011.11,.01,"DT")
2930909
"^DD",9000011,9000011.11,1101,0)
NOTE^9000011.1111IA^^11;0
"^DD",9000011,9000011.11,1101,21,0)
^^4^4^2940208^
"^DD",9000011,9000011.11,1101,21,1,0)
Each entry in this multiple is a notation appended to a problem for
"^DD",9000011,9000011.11,1101,21,2,0)
further clarification or information.  Data includes a note number
"^DD",9000011,9000011.11,1101,21,3,0)
and status, the date the note was added, the provider who added it,
"^DD",9000011,9000011.11,1101,21,4,0)
and the actual text of the note.
"^DD",9000011,9000011.1111,0)
NOTE SUB-FIELD^^.06^5
"^DD",9000011,9000011.1111,0,"DT")
2940110
"^DD",9000011,9000011.1111,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",9000011,9000011.1111,0,"IX","AV9",9000011.1111,.01)

"^DD",9000011,9000011.1111,0,"IX","B",9000011.1111,.01)

"^DD",9000011,9000011.1111,0,"NM","NOTE")

"^DD",9000011,9000011.1111,0,"UP")
9000011.11
"^DD",9000011,9000011.1111,.01,0)
NOTE NMBR^RNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9000011,9000011.1111,.01,1,0)
^.1
"^DD",9000011,9000011.1111,.01,1,1,0)
9000011.1111^B
"^DD",9000011,9000011.1111,.01,1,1,1)
S ^AUPNPROB(DA(2),11,DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9000011,9000011.1111,.01,1,1,2)
K ^AUPNPROB(DA(2),11,DA(1),11,"B",$E(X,1,30),DA)
"^DD",9000011,9000011.1111,.01,1,2,0)
9000011.1111^AV9^MUMPS
"^DD",9000011,9000011.1111,.01,1,2,1)
S:$D(APCDLOOK) DIC("DR")=""
"^DD",9000011,9000011.1111,.01,1,2,2)
Q
"^DD",9000011,9000011.1111,.01,1,2,"%D",0)
^^2^2^2940204^^^
"^DD",9000011,9000011.1111,.01,1,2,"%D",1,0)
Controls the behaviour of the input templates used by IHS to populate
"^DD",9000011,9000011.1111,.01,1,2,"%D",2,0)
and maintain this file.
"^DD",9000011,9000011.1111,.01,1,2,"DT")
2940125
"^DD",9000011,9000011.1111,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9000011,9000011.1111,.01,21,0)
^^1^1^2940204^^^^
"^DD",9000011,9000011.1111,.01,21,1,0)
This is the unique note identifier.
"^DD",9000011,9000011.1111,.01,"AUDIT")
n
"^DD",9000011,9000011.1111,.01,"DT")
2940125
"^DD",9000011,9000011.1111,.03,0)
NOTE NARRATIVE^RF^^0;3^K:$L(X)>60!($L(X)<3) X
"^DD",9000011,9000011.1111,.03,3)
Answer must be 3-60 characters in length.
"^DD",9000011,9000011.1111,.03,21,0)
^^1^1^2930726^
"^DD",9000011,9000011.1111,.03,21,1,0)
Additional comments may be entered here to further describe this problem.
"^DD",9000011,9000011.1111,.03,"AUDIT")
n
"^DD",9000011,9000011.1111,.03,"DT")
2930726
"^DD",9000011,9000011.1111,.04,0)
STATUS^RS^A:ACTIVE;^0;4^Q
"^DD",9000011,9000011.1111,.04,3)
If this note is currently ACTIVE, indicate it here.
"^DD",9000011,9000011.1111,.04,21,0)
^^1^1^2930726^
"^DD",9000011,9000011.1111,.04,21,1,0)
This flag indicates if this note is currently active.
"^DD",9000011,9000011.1111,.04,"DT")
2900501
"^DD",9000011,9000011.1111,.05,0)
DATE NOTE ADDED^D^^0;5^S %DT="EX" D ^%DT S X=Y K:DT<X!(1800000>X) X
"^DD",9000011,9000011.1111,.05,3)
TYPE A DATE BETWEEN 1880 AND TODAY
"^DD",9000011,9000011.1111,.05,21,0)
^^1^1^2930726^
"^DD",9000011,9000011.1111,.05,21,1,0)
This is the date this note was entered into this file.
"^DD",9000011,9000011.1111,.05,"DT")
2930726
"^DD",9000011,9000011.1111,.06,0)
AUTHOR^P200'^VA(200,^0;6^Q
"^DD",9000011,9000011.1111,.06,3)
Enter the name of the provider who authored the text of this note.
"^DD",9000011,9000011.1111,.06,21,0)
^^1^1^2930726^
"^DD",9000011,9000011.1111,.06,21,1,0)
This is the provider who authored the text of this note.
"^DD",9000011,9000011.1111,.06,"DT")
2930330
"^DD",9000011,9000011.803,0)
MAPPING TARGETS SUB-FIELD^^.03^3
"^DD",9000011,9000011.803,0,"DT")
3120606
"^DD",9000011,9000011.803,0,"IX","B",9000011.803,.01)

"^DD",9000011,9000011.803,0,"NM","MAPPING TARGETS")

"^DD",9000011,9000011.803,0,"UP")
9000011
"^DD",9000011,9000011.803,.01,0)
CODE^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",9000011,9000011.803,.01,1,0)
^.1
"^DD",9000011,9000011.803,.01,1,1,0)
9000011.803^B
"^DD",9000011,9000011.803,.01,1,1,1)
S ^AUPNPROB(DA(1),803,"B",$E(X,1,30),DA)=""
"^DD",9000011,9000011.803,.01,1,1,2)
K ^AUPNPROB(DA(1),803,"B",$E(X,1,30),DA)
"^DD",9000011,9000011.803,.01,3)
Answer must be 1-30 characters in length.
"^DD",9000011,9000011.803,.01,21,0)
^^2^2^3120606^
"^DD",9000011,9000011.803,.01,21,1,0)
This is the code in the target coding system to which the problem is 
"^DD",9000011,9000011.803,.01,21,2,0)
mapped.
"^DD",9000011,9000011.803,.01,"DT")
3121024
"^DD",9000011,9000011.803,.02,0)
CODING SYSTEM^F^^0;2^K:$L(X)>7!($L(X)<3) X
"^DD",9000011,9000011.803,.02,3)
Answer must be 3-7 characters in length.
"^DD",9000011,9000011.803,.02,21,0)
^^11^11^3120807^
"^DD",9000011,9000011.803,.02,21,1,0)
This identifies the Coding System to which the Code belongs. It 
"^DD",9000011,9000011.803,.02,21,2,0)
corresponds to the Source Abbreviation in the Coding Systems File, to 
"^DD",9000011,9000011.803,.02,21,3,0)
optimize calls to the Lexicon and ICD APIs for resolving codes, 
"^DD",9000011,9000011.803,.02,21,4,0)
independent of their code set version, and to facilitate transition from 
"^DD",9000011,9000011.803,.02,21,5,0)
ICD-9-CM to ICD-10-CM. Examples include:
"^DD",9000011,9000011.803,.02,21,6,0)
 
"^DD",9000011,9000011.803,.02,21,7,0)
SOURCE
"^DD",9000011,9000011.803,.02,21,8,0)
ABBREV   NOMENCLATURE  SOURCE TITLE
"^DD",9000011,9000011.803,.02,21,9,0)
--------------------------------------------------------------------------
"^DD",9000011,9000011.803,.02,21,10,0)
10D      ICD-10-CM     International Classification of Diseases, Diagnosis
"^DD",9000011,9000011.803,.02,21,11,0)
ICD      ICD-9-CM      International Classification of Diseases, Diagnosis
"^DD",9000011,9000011.803,.02,"DT")
3121024
"^DD",9000011,9000011.803,.03,0)
CODE DATE^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",9000011,9000011.803,.03,3)
(No range limit on date)
"^DD",9000011,9000011.803,.03,21,0)
^^2^2^3120606^
"^DD",9000011,9000011.803,.03,21,1,0)
This is the date when the code and coding system were filed. This allows 
"^DD",9000011,9000011.803,.03,21,2,0)
proper resolution of the code, irrespective of code set versions, etc.
"^DD",9000011,9000011.803,.03,"DT")
3120606
"^DIC",9000011,9000011,0)
PROBLEM^9000011IP
"^DIC",9000011,9000011,0,"GL")
^AUPNPROB(
"^DIC",9000011,9000011,"%D",0)
^^8^8^2940511^^^^
"^DIC",9000011,9000011,"%D",1,0)
This file contains patient specific problems entered by the various
"^DIC",9000011,9000011,"%D",2,0)
providers of service.  The PATIENT NAME field (.02) is a backward pointer
"^DIC",9000011,9000011,"%D",3,0)
to the IHS PATIENT file.  This file contains one record for each problem
"^DIC",9000011,9000011,"%D",4,0)
for each patient, therefore, the KEY field (.01) is duplicated.
"^DIC",9000011,9000011,"%D",5,0)
 
"^DIC",9000011,9000011,"%D",6,0)
As of March 17, 1986 the FACILITY must be entered prior to the NUMBER.
"^DIC",9000011,9000011,"%D",7,0)
If the NUMBER is entered without previously entering the FACILITY the
"^DIC",9000011,9000011,"%D",8,0)
"AA" index is created with no FACILITY pointer.
"^DIC",9000011,"B","PROBLEM",9000011)

**END**
**END**
