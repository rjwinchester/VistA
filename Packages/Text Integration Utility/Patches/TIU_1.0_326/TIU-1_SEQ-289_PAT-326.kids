Released TIU*1*326 SEQ #289
Extracted from mail message
**KIDS**:TIU*1.0*326^

**INSTALL NAME**
TIU*1.0*326
"BLD",11175,0)
TIU*1.0*326^TEXT INTEGRATION UTILITIES^0^3190628^y
"BLD",11175,1,0)
^^7^7^3190628^
"BLD",11175,1,1,0)
During analysis of ticket INC5361702, an area of code associated to the 
"BLD",11175,1,2,0)
Alert Tracking module was discovered that needs remediation.  This patch 
"BLD",11175,1,3,0)
will correct this design to not completely rebuild the Alert Tracking 
"BLD",11175,1,4,0)
entry for each multiple Additional Signer that is added but rather make a 
"BLD",11175,1,5,0)
single call to the TIU alert routine for all additional signers that will 
"BLD",11175,1,6,0)
create only one new Alert Tracker record each time one or more additional 
"BLD",11175,1,7,0)
signers are added.
"BLD",11175,4,0)
^9.64PA^^
"BLD",11175,6.3)
1
"BLD",11175,"ABPKG")
n
"BLD",11175,"KRN",0)
^9.67PA^1.5^24
"BLD",11175,"KRN",.4,0)
.4
"BLD",11175,"KRN",.401,0)
.401
"BLD",11175,"KRN",.402,0)
.402
"BLD",11175,"KRN",.403,0)
.403
"BLD",11175,"KRN",.5,0)
.5
"BLD",11175,"KRN",.84,0)
.84
"BLD",11175,"KRN",1.5,0)
1.5
"BLD",11175,"KRN",1.6,0)
1.6
"BLD",11175,"KRN",1.61,0)
1.61
"BLD",11175,"KRN",1.62,0)
1.62
"BLD",11175,"KRN",3.6,0)
3.6
"BLD",11175,"KRN",3.8,0)
3.8
"BLD",11175,"KRN",9.2,0)
9.2
"BLD",11175,"KRN",9.8,0)
9.8
"BLD",11175,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11175,"KRN",9.8,"NM",1,0)
TIULX^^0^B50975960
"BLD",11175,"KRN",9.8,"NM","B","TIULX",1)

"BLD",11175,"KRN",19,0)
19
"BLD",11175,"KRN",19.1,0)
19.1
"BLD",11175,"KRN",101,0)
101
"BLD",11175,"KRN",409.61,0)
409.61
"BLD",11175,"KRN",771,0)
771
"BLD",11175,"KRN",779.2,0)
779.2
"BLD",11175,"KRN",870,0)
870
"BLD",11175,"KRN",8989.51,0)
8989.51
"BLD",11175,"KRN",8989.52,0)
8989.52
"BLD",11175,"KRN",8994,0)
8994
"BLD",11175,"KRN","B",.4,.4)

"BLD",11175,"KRN","B",.401,.401)

"BLD",11175,"KRN","B",.402,.402)

"BLD",11175,"KRN","B",.403,.403)

"BLD",11175,"KRN","B",.5,.5)

"BLD",11175,"KRN","B",.84,.84)

"BLD",11175,"KRN","B",1.5,1.5)

"BLD",11175,"KRN","B",1.6,1.6)

"BLD",11175,"KRN","B",1.61,1.61)

"BLD",11175,"KRN","B",1.62,1.62)

"BLD",11175,"KRN","B",3.6,3.6)

"BLD",11175,"KRN","B",3.8,3.8)

"BLD",11175,"KRN","B",9.2,9.2)

"BLD",11175,"KRN","B",9.8,9.8)

"BLD",11175,"KRN","B",19,19)

"BLD",11175,"KRN","B",19.1,19.1)

"BLD",11175,"KRN","B",101,101)

"BLD",11175,"KRN","B",409.61,409.61)

"BLD",11175,"KRN","B",771,771)

"BLD",11175,"KRN","B",779.2,779.2)

"BLD",11175,"KRN","B",870,870)

"BLD",11175,"KRN","B",8989.51,8989.51)

"BLD",11175,"KRN","B",8989.52,8989.52)

"BLD",11175,"KRN","B",8994,8994)

"BLD",11175,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11175,"QUES",0)
^9.62^^
"BLD",11175,"REQB",0)
^9.611^1^1
"BLD",11175,"REQB",1,0)
TIU*1.0*255^2
"BLD",11175,"REQB","B","TIU*1.0*255",1)

"MBREQ")
0
"PKG",588,-1)
1^1
"PKG",588,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",588,22,0)
^9.49I^1^1
"PKG",588,22,1,0)
1.0^2970620^2971202^1
"PKG",588,22,1,"PAH",1,0)
326^3190628
"PKG",588,22,1,"PAH",1,1,0)
^^7^7^3190628
"PKG",588,22,1,"PAH",1,1,1,0)
During analysis of ticket INC5361702, an area of code associated to the 
"PKG",588,22,1,"PAH",1,1,2,0)
Alert Tracking module was discovered that needs remediation.  This patch 
"PKG",588,22,1,"PAH",1,1,3,0)
will correct this design to not completely rebuild the Alert Tracking 
"PKG",588,22,1,"PAH",1,1,4,0)
entry for each multiple Additional Signer that is added but rather make a 
"PKG",588,22,1,"PAH",1,1,5,0)
single call to the TIU alert routine for all additional signers that will 
"PKG",588,22,1,"PAH",1,1,6,0)
create only one new Alert Tracker record each time one or more additional 
"PKG",588,22,1,"PAH",1,1,7,0)
signers are added.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","TIULX")
0^1^B50975960^B48956159
"RTN","TIULX",1,0)
TIULX ; SLC/JER - Cross-reference library functions ; 10/1/10 2:31pm
"RTN","TIULX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,28,79,100,136,219,255,326**;Jun 20, 1997;Build 1
"RTN","TIULX",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","TIULX",4,0)
 ; File 200 - IA 10060
"RTN","TIULX",5,0)
 ; ^ORD(101 - IA 872
"RTN","TIULX",6,0)
 ; ^DISV    - IA 510
"RTN","TIULX",7,0)
ALOCP(DA) ; Should record be included in daily print queue by location?
"RTN","TIULX",8,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",9,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",10,0)
APTP(DA) ; Should record be included in daily print queue by patient?
"RTN","TIULX",11,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",12,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",13,0)
AAUP(DA) ; Should record be included in daily print queue by author?
"RTN","TIULX",14,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",15,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",16,0)
BELONGS(TIUDA,CLASS) ; Evaluate whether a given document belongs to a
"RTN","TIULX",17,0)
 ;                 particular document class
"RTN","TIULX",18,0)
 N TIUY
"RTN","TIULX",19,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIULX",20,0)
 S TIUY=+$$ISA(+$G(^TIU(8925,+TIUDA,0)),CLASS)
"RTN","TIULX",21,0)
 Q TIUY
"RTN","TIULX",22,0)
ISA(DA,CLASS) ; Evaluate whether a given document type is a member of a
"RTN","TIULX",23,0)
 ;         particular document class
"RTN","TIULX",24,0)
 ; Receives DA = record # in 8925.1, and
"RTN","TIULX",25,0)
 ;       CLASS = record # of class in 8925.1
"RTN","TIULX",26,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",27,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",28,0)
 . I TIUI=CLASS S TIUY=1 Q
"RTN","TIULX",29,0)
 . S TIUY=$$ISA(TIUI,CLASS)
"RTN","TIULX",30,0)
 Q TIUY
"RTN","TIULX",31,0)
ISPN(DA) ; Evaluate whether a given document is a Progress Note
"RTN","TIULX",32,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",33,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",34,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",35,0)
 . I TIUI=3 S TIUY=1 Q
"RTN","TIULX",36,0)
 . S TIUY=$$ISPN(TIUI)
"RTN","TIULX",37,0)
 Q TIUY
"RTN","TIULX",38,0)
ISCWAD(DA) ; Evaluate whether a given title is a CWAD
"RTN","TIULX",39,0)
 ;Is the given title in a CWAD document class?
"RTN","TIULX",40,0)
 ;New for ID notes
"RTN","TIULX",41,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",42,0)
 Q $S($$ISA(DA,25):1,$$ISA(DA,27):1,$$ISA(DA,30):1,$$ISA(DA,31):1,1:0)
"RTN","TIULX",43,0)
ISDS(DA) ; Evaluate whether a given document is a Discharge Summary
"RTN","TIULX",44,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",45,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",46,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",47,0)
 . I TIUI=244 S TIUY=1 Q
"RTN","TIULX",48,0)
 . S TIUY=$$ISDS(TIUI)
"RTN","TIULX",49,0)
 Q TIUY
"RTN","TIULX",50,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIULX",51,0)
 N XFORM
"RTN","TIULX",52,0)
 S FLD=$O(^TIU(8925.1,+RTYPE("TYPE"),"HEAD","D",+FLD,0))
"RTN","TIULX",53,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIULX",54,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE("TYPE"),"HEAD",+FLD,1))
"RTN","TIULX",55,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIULX",56,0)
 X XFORM
"RTN","TIULX",57,0)
TRNSFRMX Q X
"RTN","TIULX",58,0)
MENUS ; Evaluate/enforce user's menu display preference
"RTN","TIULX",59,0)
 N TIUI,TIUPREF S TIUPREF=$$PERSPRF^TIULE(DUZ),TIUI=0
"RTN","TIULX",60,0)
 F  S TIUI=$O(^DISV(DUZ,"VALMMENU",TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",61,0)
 . I $P($G(^ORD(101,+TIUI,0)),U)["TIU" S ^DISV(DUZ,"VALMMENU",TIUI)=$S($P(TIUPREF,U,5)=0:0,1:1)
"RTN","TIULX",62,0)
 Q
"RTN","TIULX",63,0)
XTRASIGN(TIUY,TIUDA) ; Get list of extra signers for a document
"RTN","TIULX",64,0)
 N TIUI,TIUJ,TIUL,DA,DR,DIC,DIQ,TIUXTRA S (TIUI,TIUJ,TIUL)=0
"RTN","TIULX",65,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",66,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",67,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",68,0)
 . S DA=TIUI,DR=".03;.04" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",69,0)
 . I $L($G(TIUXTRA(8925.7,DA,.04))) Q
"RTN","TIULX",70,0)
 . S TIUJ=+$G(TIUJ)+1,TIUL=+$G(TIUL)+1
"RTN","TIULX",71,0)
 . S TIUSGNR=$G(TIUXTRA(8925.7,DA,.03))
"RTN","TIULX",72,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUJ)_")  "_TIUSGNR,$G(TIUX),1,39)
"RTN","TIULX",73,0)
 . S TIUY(TIUL)=DA_U_TIUX
"RTN","TIULX",74,0)
 Q
"RTN","TIULX",75,0)
ASKSIGN(TIUY) ; Identify which Signature to edit
"RTN","TIULX",76,0)
 N I,L,Y
"RTN","TIULX",77,0)
 W !!,"Please Indicate Which Expected Signer to Change:",!
"RTN","TIULX",78,0)
 S (I,L,Y)=0 F  S I=$O(TIUY(I)) Q:+I'>0!+Y  D
"RTN","TIULX",79,0)
 . W:$P(TIUY(I),U)]"" !,$P(TIUY(I),U,2)
"RTN","TIULX",80,0)
 . I I#20=0 S Y=$P($$PICK(1,I,"Select Signer","NO"),U)
"RTN","TIULX",81,0)
 . S L=I
"RTN","TIULX",82,0)
 I L#20,'+Y S Y=$P($$PICK(1,L,"Select Signer","NO"),U)
"RTN","TIULX",83,0)
 I +Y,+$G(TIUY(+Y)) S Y=+$G(TIUY(+Y))
"RTN","TIULX",84,0)
 Q Y
"RTN","TIULX",85,0)
PICK(LOW,HIGH,PROMPT,TYPE) ; List selection
"RTN","TIULX",86,0)
 N X,Y S PROMPT=$G(PROMPT,"Select Item"),TYPE=$G(TYPE,"LO")
"RTN","TIULX",87,0)
 W !
"RTN","TIULX",88,0)
 S Y=$$READ^TIUU(TYPE_U_LOW_":"_HIGH,PROMPT)
"RTN","TIULX",89,0)
 W !
"RTN","TIULX",90,0)
 Q Y
"RTN","TIULX",91,0)
CWAD ; Entry action for CWAD protocol
"RTN","TIULX",92,0)
 N GMRPALG,GMRPCWAD,GMRPDFN,GMRPOPT,GMRPEN,GMRPAGE,GMRPCWAD,GMRPDOB
"RTN","TIULX",93,0)
 N GMRPLOC,GMRPRB,GMRPSSN,GMRPQT
"RTN","TIULX",94,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinay note before displaying alerts.",! H 3 Q
"RTN","TIULX",95,0)
 D FULL^VALM1
"RTN","TIULX",96,0)
 I '+$G(DFN),'+$G(ORVP) D  Q
"RTN","TIULX",97,0)
 . W !!,"No Patient Selected...",!
"RTN","TIULX",98,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIULX",99,0)
 . S VALMBCK="R"
"RTN","TIULX",100,0)
 D PAT^GMRPNOR1 I $D(GMRPQT) S VALMBCK="R" Q
"RTN","TIULX",101,0)
 S Y=GMRPDFN,GMRPOPT=1,GMRPEN=1 W !!,"** Current Patient:  "_$P(Y,U,2)
"RTN","TIULX",102,0)
 D ENPAT^GMRPNCW S VALMBCK="R"
"RTN","TIULX",103,0)
 Q
"RTN","TIULX",104,0)
IDSIGNRS(TIUY,TIUDA,TIULIST) ; Add list of Add'l Signers for a TIU Document
"RTN","TIULX",105,0)
 ; TIULIST(TIUI) [By Ref] = array of users to add/remove as signers
"RTN","TIULX",106,0)
 ; TIUDA                  = IEN in ^TIU(8925,
"RTN","TIULX",107,0)
 N TIUI S TIUI=0
"RTN","TIULX",108,0)
 F  S TIUI=$O(TIULIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",109,0)
 . N DA,DIC,DLAYGO,DIE,DR,X,Y
"RTN","TIULX",110,0)
 . N TIUSIG,TIUSN ;TIU*1.0*255
"RTN","TIULX",111,0)
 . ; if current user is already an additional signer, and current user
"RTN","TIULX",112,0)
 . ; is NOT being removed as an additional signer, then QUIT
"RTN","TIULX",113,0)
 . I +$O(^TIU(8925.7,"AE",TIUDA,+TIULIST(TIUI),0)),($P(TIULIST(TIUI),U,3)'="REMOVE") Q
"RTN","TIULX",114,0)
 . ; if current user is being removed as a cosigner, then remove him
"RTN","TIULX",115,0)
 . ; TIU*255 Quit if attempting to remove someone who already signed
"RTN","TIULX",116,0)
 . ;I $P(TIULIST(TIUI),U,3)="REMOVE" D REMSIGNR(TIUDA,+TIULIST(TIUI)) Q
"RTN","TIULX",117,0)
 . S TIUSIG=$O(^TIU(8925.7,"AE",TIUDA,+TIULIST(TIUI),0)) S:$G(TIUSIG) TIUSN=$P($G(^TIU(8925.7,TIUSIG,0)),"^",4)
"RTN","TIULX",118,0)
 . Q:$G(TIUSN)  I $P(TIULIST(TIUI),U,3)="REMOVE" D REMSIGNR(TIUDA,+TIULIST(TIUI)) Q
"RTN","TIULX",119,0)
 . ; otherwise, add the current user as an additional signer
"RTN","TIULX",120,0)
 . S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.7,DIC(0)="LX" D ^DIC Q:+Y'>0
"RTN","TIULX",121,0)
 . S DIE=DIC,TIUY=$G(TIUY)_$S($G(TIUY)]"":U,1:"")_+TIULIST(TIUI)
"RTN","TIULX",122,0)
 . S DR=".02////"_0_";.03////"_+$G(TIULIST(TIUI))
"RTN","TIULX",123,0)
 . D ^DIE
"RTN","TIULX",124,0)
 . ; TIU*1.0*326 Only call SEND^TIUALRT once instead of for each add. signer 
"RTN","TIULX",125,0)
 . ;D SEND^TIUALRT(TIUDA)
"RTN","TIULX",126,0)
 I $O(TIULIST(0)) D SEND^TIUALRT(TIUDA)
"RTN","TIULX",127,0)
 Q
"RTN","TIULX",128,0)
REMSIGNR(TIUDA,TIUDUZ) ; Remove user from additional signer list
"RTN","TIULX",129,0)
 N DA,DIE,DR,DIDEL
"RTN","TIULX",130,0)
 S DA=+$O(^TIU(8925.7,"AE",TIUDA,TIUDUZ,0)) Q:+DA'>0
"RTN","TIULX",131,0)
 S (DIDEL,DIE)=8925.7,DR=".01///@" D ^DIE
"RTN","TIULX",132,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIULX",133,0)
 Q
"RTN","TIULX",134,0)
GETSIGNR(TIUY,TIUDA) ; RPC to Get list of extra signers for a document
"RTN","TIULX",135,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA,TIUD12,TIUAU,TIUEC S (DA,TIUI)=0
"RTN","TIULX",136,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",137,0)
 F  S DA=$O(^TIU(8925.7,"B",TIUDA,DA)) Q:+DA'>0  D
"RTN","TIULX",138,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",139,0)
 . S DR=".03;.04",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",140,0)
 . I +$G(TIUXTRA(8925.7,DA,.04,"I")) Q
"RTN","TIULX",141,0)
 . S TIUI=+$G(TIUI)+1
"RTN","TIULX",142,0)
 . S TIUY(TIUI)=$G(TIUXTRA(8925.7,DA,.03,"I"))_U_$G(TIUXTRA(8925.7,DA,.03,"E"))
"RTN","TIULX",143,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIULX",144,0)
 S TIUAU=$P(TIUD12,U,4),TIUEC=$P(TIUD12,U,8)
"RTN","TIULX",145,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUAU_U_$$PERSNAME^TIULC1(TIUAU)_U_"AUTHOR"
"RTN","TIULX",146,0)
 I +TIUEC'>0 Q
"RTN","TIULX",147,0)
 I '$$FIND1^DIC(200,"","","`"_+TIUEC) D CLEAN^DILF Q
"RTN","TIULX",148,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUEC_U_$$PERSNAME^TIULC1(TIUEC)_U_"EXPECTED COSIGNER"
"RTN","TIULX",149,0)
 Q
"RTN","TIULX",150,0)
HASDS(DFN,VSTR) ; Does an admission have a Discharge Summary?
"RTN","TIULX",151,0)
 N TITLE,TIUDA S (TIUDA,TITLE)=0
"RTN","TIULX",152,0)
 F  S TITLE=$O(^TIU(8925,"APTLD",DFN,TITLE)) Q:+TITLE'>0  D  Q:+TIUDA>0
"RTN","TIULX",153,0)
 . N STATUS,CONTEXT S TIUDA=0
"RTN","TIULX",154,0)
 . I '+$$ISDS(TITLE) S TIUDA=0_U_0 Q
"RTN","TIULX",155,0)
 . F  S TIUDA=$O(^TIU(8925,"APTLD",DFN,TITLE,VSTR,+TIUDA)) Q:+TIUDA'>0  D  Q:+$P(TIUDA,U,2)
"RTN","TIULX",156,0)
 . . S STATUS=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIULX",157,0)
 . . S CONTEXT=$S(STATUS=0:0,STATUS>13:0,STATUS'>5:2,1:1)
"RTN","TIULX",158,0)
 . . S TIUDA=TIUDA_U_CONTEXT
"RTN","TIULX",159,0)
 I '+TIUDA,($L(TIUDA,U)<2) S TIUDA=TIUDA_U_0
"RTN","TIULX",160,0)
 Q TIUDA
"RTN","TIULX",161,0)
NEEDSIG(TIUY,USER,CLASS)        ; Get list of documents for which USER is an additional signer
"RTN","TIULX",162,0)
 N TIUDA,TIUI,TIUJ S (TIUDA,TIUJ)=0
"RTN","TIULX",163,0)
 S USER=$G(USER,DUZ),CLASS=$G(CLASS,38),TIUY=$NA(^TMP("TIUSIGN",$J))
"RTN","TIULX",164,0)
 K @TIUY ; Clear out return array before query
"RTN","TIULX",165,0)
 F  S TIUDA=$O(^TIU(8925.7,"AES",USER,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULX",166,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925.7,"AES",USER,TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",167,0)
 . . N TIUD0 S TIUD0=$G(^TIU(8925.7,TIUI,0)) Q:+$P(TIUD0,U,4)
"RTN","TIULX",168,0)
 . . Q:'+$$ISA(+$G(^TIU(8925,TIUDA,0)),CLASS)
"RTN","TIULX",169,0)
 . . S TIUJ=+$G(TIUJ)+1,@TIUY@(TIUJ)=TIUDA
"RTN","TIULX",170,0)
 Q
"RTN","TIULX",171,0)
TITLIENS ; Get IENs of DDEF entries that have type Title
"RTN","TIULX",172,0)
 ; in Document Definition file 8925.1
"RTN","TIULX",173,0)
 ;Creates array ^TMP("TIUTLS,$J,TLIEN)=  
"RTN","TIULX",174,0)
 ;Caller must kill ^TMP("TIUTLS",$J) when finished with the global.
"RTN","TIULX",175,0)
 N TIUIDX S TIUIDX=0 K ^TMP("TIUTLS",$J)
"RTN","TIULX",176,0)
 F  S TIUIDX=$O(^TIU(8925.1,"AT","DOC",TIUIDX)) Q:TIUIDX'>0  D
"RTN","TIULX",177,0)
 . S ^TMP("TIUTLS",$J,TIUIDX)=""
"RTN","TIULX",178,0)
 Q
"RTN","TIULX",179,0)
HASDOCMT(DFN) ;Does patient have ANY entries in TIU DOCUMENT file 8925?
"RTN","TIULX",180,0)
 ;Any entries includes original documents, addenda, components
"RTN","TIULX",181,0)
 ;(like S in SOAP notes), "deleted"  documents, retracted documents, etc!
"RTN","TIULX",182,0)
 Q $O(^TIU(8925,"C",+$G(DFN),0))>0
"RTN","TIULX",183,0)
         
"VER")
8.0^22.2
"BLD",11175,6)
^289
**END**
**END**

