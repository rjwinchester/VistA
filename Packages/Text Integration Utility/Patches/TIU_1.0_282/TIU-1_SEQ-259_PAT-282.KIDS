Released TIU*1*282 SEQ #259
Extracted from mail message
**KIDS**:TIU*1.0*282^

**INSTALL NAME**
TIU*1.0*282
"BLD",9494,0)
TIU*1.0*282^TEXT INTEGRATION UTILITIES^0^3131028^y
"BLD",9494,1,0)
^^5^5^3131028^
"BLD",9494,1,1,0)
This patch will resolve the following issues in the Text Integration
"BLD",9494,1,2,0)
Utility package:
"BLD",9494,1,3,0)
 
"BLD",9494,1,4,0)
-Cannot search for documents with multiple keywords
"BLD",9494,1,5,0)
-Error saving TIU Document Parameter name
"BLD",9494,4,0)
^9.64PA^^
"BLD",9494,6.3)
1
"BLD",9494,"KRN",0)
^9.67PA^779.2^20
"BLD",9494,"KRN",.4,0)
.4
"BLD",9494,"KRN",.401,0)
.401
"BLD",9494,"KRN",.402,0)
.402
"BLD",9494,"KRN",.403,0)
.403
"BLD",9494,"KRN",.5,0)
.5
"BLD",9494,"KRN",.84,0)
.84
"BLD",9494,"KRN",3.6,0)
3.6
"BLD",9494,"KRN",3.8,0)
3.8
"BLD",9494,"KRN",9.2,0)
9.2
"BLD",9494,"KRN",9.8,0)
9.8
"BLD",9494,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9494,"KRN",9.8,"NM",1,0)
TIUR^^0^B47288621
"BLD",9494,"KRN",9.8,"NM",2,0)
TIUDPEDT^^0^B4279272
"BLD",9494,"KRN",9.8,"NM","B","TIUDPEDT",2)

"BLD",9494,"KRN",9.8,"NM","B","TIUR",1)

"BLD",9494,"KRN",19,0)
19
"BLD",9494,"KRN",19.1,0)
19.1
"BLD",9494,"KRN",101,0)
101
"BLD",9494,"KRN",409.61,0)
409.61
"BLD",9494,"KRN",771,0)
771
"BLD",9494,"KRN",779.2,0)
779.2
"BLD",9494,"KRN",870,0)
870
"BLD",9494,"KRN",8989.51,0)
8989.51
"BLD",9494,"KRN",8989.52,0)
8989.52
"BLD",9494,"KRN",8994,0)
8994
"BLD",9494,"KRN","B",.4,.4)

"BLD",9494,"KRN","B",.401,.401)

"BLD",9494,"KRN","B",.402,.402)

"BLD",9494,"KRN","B",.403,.403)

"BLD",9494,"KRN","B",.5,.5)

"BLD",9494,"KRN","B",.84,.84)

"BLD",9494,"KRN","B",3.6,3.6)

"BLD",9494,"KRN","B",3.8,3.8)

"BLD",9494,"KRN","B",9.2,9.2)

"BLD",9494,"KRN","B",9.8,9.8)

"BLD",9494,"KRN","B",19,19)

"BLD",9494,"KRN","B",19.1,19.1)

"BLD",9494,"KRN","B",101,101)

"BLD",9494,"KRN","B",409.61,409.61)

"BLD",9494,"KRN","B",771,771)

"BLD",9494,"KRN","B",779.2,779.2)

"BLD",9494,"KRN","B",870,870)

"BLD",9494,"KRN","B",8989.51,8989.51)

"BLD",9494,"KRN","B",8989.52,8989.52)

"BLD",9494,"KRN","B",8994,8994)

"BLD",9494,"QUES",0)
^9.62^^
"BLD",9494,"REQB",0)
^9.611^2^2
"BLD",9494,"REQB",1,0)
TIU*1.0*212^2
"BLD",9494,"REQB",2,0)
TIU*1.0*272^2
"BLD",9494,"REQB","B","TIU*1.0*212",1)

"BLD",9494,"REQB","B","TIU*1.0*272",2)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
282^3131028
"PKG",470,22,1,"PAH",1,1,0)
^^5^5^3131028
"PKG",470,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues in the Text Integration
"PKG",470,22,1,"PAH",1,1,2,0)
Utility package:
"PKG",470,22,1,"PAH",1,1,3,0)
 
"PKG",470,22,1,"PAH",1,1,4,0)
-Cannot search for documents with multiple keywords
"PKG",470,22,1,"PAH",1,1,5,0)
-Error saving TIU Document Parameter name
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUDPEDT")
0^2^B4279272^B4199183
"RTN","TIUDPEDT",1,0)
TIUDPEDT ; SLC/JER - Document Parameter Edit ;2/19/93  16:15
"RTN","TIUDPEDT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**198,206,212,282**;Jun 20, 1997;Build 1
"RTN","TIUDPEDT",3,0)
MAIN ; Controls branching
"RTN","TIUDPEDT",4,0)
 N DIC,DA,DIE,DR,DLAYGO,X,Y,DWPK,TIUFPRIV S TIUFPRIV=1
"RTN","TIUDPEDT",5,0)
 W !,"First edit Institution-wide parameters:",!
"RTN","TIUDPEDT",6,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*198 MODIFIED FROM HERE DOWN
"RTN","TIUDPEDT",7,0)
 S (DIC,DLAYGO)=8925.95,DIC(0)="AEMQLZ",DIC("A")="Select DOCUMENT DEFINITION: "
"RTN","TIUDPEDT",8,0)
 D ^DIC K DLAYGO Q:+Y'>0  S DA=+Y
"RTN","TIUDPEDT",9,0)
 I +$P(Y,U,3)=1 K X,Y,DIC N TIUERR D LOCK Q:$G(TIUERR)  G CONT1
"RTN","TIUDPEDT",10,0)
 N TIUPRMPT,TIUDSPLY S TIUPRMPT=+$P(Y,U,2),TIUDSPLY=$G(Y(0,0))
"RTN","TIUDPEDT",11,0)
 K X,Y,DIC
"RTN","TIUDPEDT",12,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*198;REMOVED .01 FROM INPUT TEMPLATE AND ADDED WARNING MSG.
"RTN","TIUDPEDT",13,0)
 N TIURESP,TIURESP1 S TIURESP=$$READ^TIUU("8925.95,.01:O",,)
"RTN","TIUDPEDT",14,0)
 S TIURESP=$P(TIURESP,U)
"RTN","TIUDPEDT",15,0)
 I $G(TIURESP)="@" S TIURESP=TIURESP_U_TIURESP K DIRUT G CONT
"RTN","TIUDPEDT",16,0)
 I (($D(DIRUT))!(+TIURESP<0)) K DIRUT Q
"RTN","TIUDPEDT",17,0)
CONT ;
"RTN","TIUDPEDT",18,0)
 I $P(TIURESP,U)'=TIUPRMPT D  Q:'+$G(TIURESP1)
"RTN","TIUDPEDT",19,0)
 . S TIURESP1=$$READ^TIUU("Y","You are about to lose the document parameters for "_TIUDSPLY_". Do you wish to continue","NO")
"RTN","TIUDPEDT",20,0)
 N TIUDR
"RTN","TIUDPEDT",21,0)
 S TIUDR=$S($P($G(TIURESP),U)="@":$P($G(TIURESP),U),1:$P($G(^TIU(8925.1,$P(TIURESP,U),0)),U))
"RTN","TIUDPEDT",22,0)
 Q:$L(TIUDR)'>0
"RTN","TIUDPEDT",23,0)
 ;*282 - Prevent filing error
"RTN","TIUDPEDT",24,0)
 S DIE="^TIU(8925.95,",DR=".01///`"_$P($G(TIURESP),U)
"RTN","TIUDPEDT",25,0)
 L +^TIU(8925.95,DA):0 I '$T W !,"Another user is editing this entry" H 1 Q
"RTN","TIUDPEDT",26,0)
 N TIUSAVDA S TIUSAVDA=DA
"RTN","TIUDPEDT",27,0)
 D ^DIE
"RTN","TIUDPEDT",28,0)
 I $P($G(TIURESP),U)="@" S DA=TIUSAVDA G END
"RTN","TIUDPEDT",29,0)
CONT1 ;
"RTN","TIUDPEDT",30,0)
 S DIE=8925.95,DR="[TIU DOCUMENT PARAMETER EDIT]"
"RTN","TIUDPEDT",31,0)
 D ^DIE
"RTN","TIUDPEDT",32,0)
END L -^TIU(8925.95,DA)
"RTN","TIUDPEDT",33,0)
 Q
"RTN","TIUDPEDT",34,0)
LOCK ;
"RTN","TIUDPEDT",35,0)
 L +^TIU(8925.95,DA):0 I '$T W !,"Another user is editing this entry" H 1 S TIUERR=1
"RTN","TIUDPEDT",36,0)
 Q
"RTN","TIUR")
0^1^B47288621^B41230330
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,112,207,224,272,282**;Jun 20, 1997;Build 1
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG,TIUSC207,TIU1DOC
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS ;
"RTN","TIUR",12,0)
 ; Kill status to clear out the variable when "^" is used to backup
"RTN","TIUR",13,0)
 K STATUS S STATUS=$$STAT
"RTN","TIUR",14,0)
 ;VMP/ELR changed status ck from <0 TO <1 to account for entering an *  p224
"RTN","TIUR",15,0)
 I +STATUS<1 S VALMQUIT=1 Q
"RTN","TIUR",16,0)
 S TIUI=0
"RTN","TIUR",17,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR",18,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR",19,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",20,0)
 . Q:'STATIFN
"RTN","TIUR",21,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",22,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR",23,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",24,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",25,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",26,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",27,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",28,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",29,0)
 ; TIU207-If only 1 docytyp and have been to screen prompt then go back another level to avoid loop with next prompt.
"RTN","TIUR",30,0)
 I $G(TIUSC207)=1,$G(TIU1DOC)=1 D  G STATUS
"RTN","TIUR",31,0)
 .S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",32,0)
 S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",33,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",34,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",35,0)
 S TIU1DOC=+$P($G(^TIU(8925.1,+TIUCLASS,10,0)),U,3)
"RTN","TIUR",36,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",37,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",38,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",39,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",40,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",41,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",42,0)
SCREEN ;
"RTN","TIUR",43,0)
 S TIUSC207=1
"RTN","TIUR",44,0)
 N TIUNAME,TIUOVER
"RTN","TIUR",45,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",46,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR",47,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR",48,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",49,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",50,0)
 . S SCREEN="ALL"
"RTN","TIUR",51,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",52,0)
 S TIUOVER=""
"RTN","TIUR",53,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR",.TIUOVER)
"RTN","TIUR",54,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",55,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",56,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",57,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",58,0)
 D CHECKADD
"RTN","TIUR",59,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",60,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",61,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",62,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",63,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",64,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",65,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",66,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",67,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",68,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",69,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",70,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",71,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",72,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",73,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",74,0)
 ;    update video for line to be attached: --
"RTN","TIUR",75,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",76,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",77,0)
 Q
"RTN","TIUR",78,0)
STAT() ; Determine status
"RTN","TIUR",79,0)
 N TIUY
"RTN","TIUR",80,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR",81,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR",82,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR",83,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR",84,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR",85,0)
STATX Q TIUY
"RTN","TIUR",86,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",87,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",88,0)
 S (TIUI,HIT)=0
"RTN","TIUR",89,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",90,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",91,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",92,0)
 Q
"RTN","TIUR",93,0)
 ;
"RTN","TIUR",94,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",95,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",96,0)
 Q
"RTN","TIUR",97,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",98,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",99,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",100,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",101,0)
 Q
"RTN","TIUR",102,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",103,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",104,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",105,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",106,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",107,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",108,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",109,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",110,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",111,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",112,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",113,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",114,0)
 S ^TMP("TIUR",$J,"TITLE OVERRIDE")=$G(TIUOVER)
"RTN","TIUR",115,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",116,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",117,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",118,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",119,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",120,0)
 . I XREF'="ASUB" D
"RTN","TIUR",121,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",122,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",123,0)
 . ;*282 - Search by multiple terms 
"RTN","TIUR",124,0)
 . I XREF="ASUB" D
"RTN","TIUR",125,0)
 . . N TIUSUBJ
"RTN","TIUR",126,0)
 . . S TIUSUBJ=$S($P(SCREEN(TIUK),U,2)[" ":$P($P(SCREEN(TIUK),U,2)," "),1:$P(SCREEN(TIUK),U,2))
"RTN","TIUR",127,0)
 . . S TIUI=$O(^TIU(8925,XREF,TIUSUBJ),-1)
"RTN","TIUR",128,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[TIUSUBJ)  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",129,0)
 . . I $P(SCREEN(TIUK),U,2)[" " D
"RTN","TIUR",130,0)
 . . . N TIUIEN,TIUX,TIUY
"RTN","TIUR",131,0)
 . . . S TIUX=0 F  S TIUX=$O(^TMP("TIUI",$J,TIUX)) Q:TIUX=""  D
"RTN","TIUR",132,0)
 . . . . S TIUY=0 F  S TIUY=$O(^TMP("TIUI",$J,TIUX,TIUY)) Q:TIUY=""  D
"RTN","TIUR",133,0)
 . . . . . S TIUIEN=0 F  S TIUIEN=$O(^TMP("TIUI",$J,TIUX,TIUY,TIUIEN)) Q:TIUIEN=""  I $$UP^XLFSTR(^TIU(8925,TIUIEN,17))'[($P(SCREEN(TIUK),U,2)) K ^TMP("TIUI",$J,TIUX,TIUY,TIUIEN)
"RTN","TIUR",134,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",135,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",136,0)
 Q
"RTN","TIUR",137,0)
 ;
"RTN","TIUR",138,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",139,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",140,0)
 K VALMY
"RTN","TIUR",141,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",142,0)
 Q
"RTN","TIUR",143,0)
 ;
"RTN","TIUR",144,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",145,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",146,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",147,0)
 S TIURBLD=1
"RTN","TIUR",148,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",149,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",150,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",151,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",152,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",153,0)
 S TIUI=1
"RTN","TIUR",154,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",155,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",156,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",157,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",158,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",159,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",160,0)
 ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIUR",161,0)
 S TIUSCRN="ALL"
"RTN","TIUR",162,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",163,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",164,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",165,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",166,0)
 Q
"VER")
8.0^22.0
"BLD",9494,6)
^259
**END**
**END**

