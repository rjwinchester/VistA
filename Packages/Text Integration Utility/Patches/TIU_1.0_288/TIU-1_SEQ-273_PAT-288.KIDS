Released TIU*1*288 SEQ #273
Extracted from mail message
**KIDS**:TIU*1.0*288^

**INSTALL NAME**
TIU*1.0*288
"BLD",9840,0)
TIU*1.0*288^TEXT INTEGRATION UTILITIES^0^3150213^y
"BLD",9840,1,0)
^^4^4^3150213^
"BLD",9840,1,1,0)
This patch will resolve the following issues:
"BLD",9840,1,2,0)
1) Document parameters cannot be deleted.
"BLD",9840,1,3,0)
2) Multiple TIU DOCUMENT PARAMETER records can be created
"BLD",9840,1,4,0)
3) TIU report display more documents types than requested
"BLD",9840,4,0)
^9.64PA^^
"BLD",9840,6.3)
4
"BLD",9840,"ABPKG")
n
"BLD",9840,"KRN",0)
^9.67PA^779.2^20
"BLD",9840,"KRN",.4,0)
.4
"BLD",9840,"KRN",.401,0)
.401
"BLD",9840,"KRN",.402,0)
.402
"BLD",9840,"KRN",.403,0)
.403
"BLD",9840,"KRN",.5,0)
.5
"BLD",9840,"KRN",.84,0)
.84
"BLD",9840,"KRN",3.6,0)
3.6
"BLD",9840,"KRN",3.8,0)
3.8
"BLD",9840,"KRN",9.2,0)
9.2
"BLD",9840,"KRN",9.8,0)
9.8
"BLD",9840,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9840,"KRN",9.8,"NM",1,0)
TIUDPEDT^^0^B4925500
"BLD",9840,"KRN",9.8,"NM",2,0)
TIURM1^^0^B40029751
"BLD",9840,"KRN",9.8,"NM","B","TIUDPEDT",1)

"BLD",9840,"KRN",9.8,"NM","B","TIURM1",2)

"BLD",9840,"KRN",19,0)
19
"BLD",9840,"KRN",19,"NM",0)
^9.68A^^
"BLD",9840,"KRN",19.1,0)
19.1
"BLD",9840,"KRN",101,0)
101
"BLD",9840,"KRN",409.61,0)
409.61
"BLD",9840,"KRN",771,0)
771
"BLD",9840,"KRN",779.2,0)
779.2
"BLD",9840,"KRN",870,0)
870
"BLD",9840,"KRN",8989.51,0)
8989.51
"BLD",9840,"KRN",8989.52,0)
8989.52
"BLD",9840,"KRN",8994,0)
8994
"BLD",9840,"KRN","B",.4,.4)

"BLD",9840,"KRN","B",.401,.401)

"BLD",9840,"KRN","B",.402,.402)

"BLD",9840,"KRN","B",.403,.403)

"BLD",9840,"KRN","B",.5,.5)

"BLD",9840,"KRN","B",.84,.84)

"BLD",9840,"KRN","B",3.6,3.6)

"BLD",9840,"KRN","B",3.8,3.8)

"BLD",9840,"KRN","B",9.2,9.2)

"BLD",9840,"KRN","B",9.8,9.8)

"BLD",9840,"KRN","B",19,19)

"BLD",9840,"KRN","B",19.1,19.1)

"BLD",9840,"KRN","B",101,101)

"BLD",9840,"KRN","B",409.61,409.61)

"BLD",9840,"KRN","B",771,771)

"BLD",9840,"KRN","B",779.2,779.2)

"BLD",9840,"KRN","B",870,870)

"BLD",9840,"KRN","B",8989.51,8989.51)

"BLD",9840,"KRN","B",8989.52,8989.52)

"BLD",9840,"KRN","B",8994,8994)

"BLD",9840,"QDEF")
^^^^NO^^^^^^NO
"BLD",9840,"QUES",0)
^9.62^^
"BLD",9840,"REQB",0)
^9.611^2^2
"BLD",9840,"REQB",1,0)
TIU*1.0*282^2
"BLD",9840,"REQB",2,0)
TIU*1.0*271^2
"BLD",9840,"REQB","B","TIU*1.0*271",2)

"BLD",9840,"REQB","B","TIU*1.0*282",1)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
288^3150213
"PKG",470,22,1,"PAH",1,1,0)
^^4^4^3150213
"PKG",470,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",470,22,1,"PAH",1,1,2,0)
1) Document parameters cannot be deleted.
"PKG",470,22,1,"PAH",1,1,3,0)
2) Multiple TIU DOCUMENT PARAMETER records can be created
"PKG",470,22,1,"PAH",1,1,4,0)
3) TIU report display more documents types than requested
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUDPEDT")
0^1^B4925500^B4279272
"RTN","TIUDPEDT",1,0)
TIUDPEDT ; SLC/JER - Document Parameter Edit ;2/19/93  16:15
"RTN","TIUDPEDT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**198,206,212,282,288**;Jun 20, 1997;Build 4
"RTN","TIUDPEDT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","TIUDPEDT",4,0)
MAIN ; Controls branching
"RTN","TIUDPEDT",5,0)
 N DIC,DA,DIE,DR,DLAYGO,X,Y,DWPK,TIUFPRIV S TIUFPRIV=1
"RTN","TIUDPEDT",6,0)
 W !,"First edit Institution-wide parameters:",!
"RTN","TIUDPEDT",7,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*198 MODIFIED FROM HERE DOWN
"RTN","TIUDPEDT",8,0)
 S (DIC,DLAYGO)=8925.95,DIC(0)="AEMQLZ",DIC("A")="Select DOCUMENT DEFINITION: "
"RTN","TIUDPEDT",9,0)
 D ^DIC K DLAYGO Q:+Y'>0  S DA=+Y
"RTN","TIUDPEDT",10,0)
 I +$P(Y,U,3)=1 K X,Y,DIC N TIUERR D LOCK Q:$G(TIUERR)  G CONT1
"RTN","TIUDPEDT",11,0)
 N TIUPRMPT,TIUDSPLY S TIUPRMPT=+$P(Y,U,2),TIUDSPLY=$G(Y(0,0))
"RTN","TIUDPEDT",12,0)
 K X,Y,DIC
"RTN","TIUDPEDT",13,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*198;REMOVED .01 FROM INPUT TEMPLATE AND ADDED WARNING MSG.
"RTN","TIUDPEDT",14,0)
 ; *288 vmp - Do not allow edit of .01 field
"RTN","TIUDPEDT",15,0)
 N TIURESP,TIURESP1,TIUOK
"RTN","TIUDPEDT",16,0)
 F  S TIURESP=$$READ^TIUU("8925.95,.01:O",,) D  Q:TIUOK
"RTN","TIUDPEDT",17,0)
 . I $P(TIURESP,U)="@"!($G(DIRUT))!($P(TIURESP,U)=TIUPRMPT) S TIUOK=1 Q
"RTN","TIUDPEDT",18,0)
 . S TIUOK=0 W !,"This field cannot be modified."
"RTN","TIUDPEDT",19,0)
 S TIURESP=$P(TIURESP,U)
"RTN","TIUDPEDT",20,0)
 I $G(TIURESP)="@" S TIURESP=TIURESP_U_TIURESP K DIRUT G CONT
"RTN","TIUDPEDT",21,0)
 I (($D(DIRUT))!(+TIURESP<0)) K DIRUT Q
"RTN","TIUDPEDT",22,0)
CONT ;
"RTN","TIUDPEDT",23,0)
 ; *288 Only display this message when attempting to delete
"RTN","TIUDPEDT",24,0)
 I $P(TIURESP,U)="@" D  Q:'+$G(TIURESP1)
"RTN","TIUDPEDT",25,0)
 . S TIURESP1=$$READ^TIUU("Y","You are about to lose the document parameters for "_TIUDSPLY_". Do you wish to continue","NO")
"RTN","TIUDPEDT",26,0)
 N TIUDR
"RTN","TIUDPEDT",27,0)
 ;*288 allow delete
"RTN","TIUDPEDT",28,0)
 S TIUDR=$S($P($G(TIURESP),U)="@":$P($G(TIURESP),U),1:"`"_$P($G(TIURESP),U))
"RTN","TIUDPEDT",29,0)
 Q:$L(TIUDR)'>0
"RTN","TIUDPEDT",30,0)
 ;*282 - Prevent filing error
"RTN","TIUDPEDT",31,0)
 ;*288 Allow delete
"RTN","TIUDPEDT",32,0)
 S DIE="^TIU(8925.95,",DR=".01///"_TIUDR
"RTN","TIUDPEDT",33,0)
 L +^TIU(8925.95,DA):0 I '$T W !,"Another user is editing this entry" H 1 Q
"RTN","TIUDPEDT",34,0)
 N TIUSAVDA S TIUSAVDA=DA
"RTN","TIUDPEDT",35,0)
 D ^DIE
"RTN","TIUDPEDT",36,0)
 I $P($G(TIURESP),U)="@" S DA=TIUSAVDA G END
"RTN","TIUDPEDT",37,0)
CONT1 ;
"RTN","TIUDPEDT",38,0)
 S DIE=8925.95,DR="[TIU DOCUMENT PARAMETER EDIT]"
"RTN","TIUDPEDT",39,0)
 D ^DIE
"RTN","TIUDPEDT",40,0)
END L -^TIU(8925.95,DA)
"RTN","TIUDPEDT",41,0)
 Q
"RTN","TIUDPEDT",42,0)
LOCK ;
"RTN","TIUDPEDT",43,0)
 L +^TIU(8925.95,DA):0 I '$T W !,"Another user is editing this entry" H 1 S TIUERR=1
"RTN","TIUDPEDT",44,0)
 Q
"RTN","TIURM1")
0^2^B40029751^B40265162
"RTN","TIURM1",1,0)
TIURM1 ; SLC/JER - MIS Document Review ; 8/23/12 1:27pm
"RTN","TIURM1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113,271,288**;Jun 20, 1997;Build 4
"RTN","TIURM1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","TIURM1",4,0)
GATHER(TIUPREF,CLASS,STATIFNS,EARLY,LATE,DIVIFNS) ; Find/sort
"RTN","TIURM1",5,0)
 ;records for the list
"RTN","TIURM1",6,0)
 N TIUDA,TIUSFLD,TIUI,TIUQ
"RTN","TIURM1",7,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",8,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",9,0)
 S TIUI=EARLY F  S TIUI=$O(^TIU(8925,"F",TIUI)) Q:+TIUI'>0!(+TIUI>LATE)  D
"RTN","TIURM1",10,0)
 . S TIUDA=0
"RTN","TIURM1",11,0)
 . F  S TIUDA=$O(^TIU(8925,"F",TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURM1",12,0)
 . . ; Consider adding view check here
"RTN","TIURM1",13,0)
 . . I '$$INTYPES(TIUDA) Q
"RTN","TIURM1",14,0)
 . . I '$$INSTATUS(TIUDA,STATIFNS) Q
"RTN","TIURM1",15,0)
 . . I +$G(DIVIFNS("ENTRIES")),'$$ININST(TIUDA,.DIVIFNS) Q
"RTN","TIURM1",16,0)
 . . S TIUQ=$$RESOLVE^TIUR1(TIUDA,TIUSFLD)
"RTN","TIURM1",17,0)
 . . S ^TMP("TIUI",$J,TIUQ,(9999999-TIUI),TIUDA)=""
"RTN","TIURM1",18,0)
 Q
"RTN","TIURM1",19,0)
 ;
"RTN","TIURM1",20,0)
INTYPES(TIUDA) ; Evaluates whether a record is among the selected types
"RTN","TIURM1",21,0)
 N TIUI,TIUTYP,TIUY,TIUPICKS,TIUDTYP
"RTN","TIURM1",22,0)
 ; *288 set selected types into TIUPICKS array
"RTN","TIURM1",23,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0  D
"RTN","TIURM1",24,0)
 . S TIUY=$P(^TMP("TIUTYP",$J,TIUI),U,2)
"RTN","TIURM1",25,0)
 . ;OMIT addendum if it was NOT PICKED
"RTN","TIURM1",26,0)
 . Q:TIUY=81&($P(^TMP("TIUTYP",$J,TIUI),U,4)="NOT PICKED")
"RTN","TIURM1",27,0)
 . S:TIUY TIUPICKS(TIUY)=1
"RTN","TIURM1",28,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUDTYP=0
"RTN","TIURM1",29,0)
 ; look for parent type when addendum is not picked 
"RTN","TIURM1",30,0)
 I '+$G(TIUPICKS(81))&TIUTYP=81 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURM1",31,0)
 S TIUY=$S(TIUDTYP:+$G(TIUPICKS(TIUDTYP)),1:+$G(TIUPICKS(TIUTYP)))
"RTN","TIURM1",32,0)
 Q TIUY
"RTN","TIURM1",33,0)
 ;
"RTN","TIURM1",34,0)
INSTATUS(TIUDA,STATIFNS) ; Evaluates whether a record
"RTN","TIURM1",35,0)
 ;is among the selected statuses
"RTN","TIURM1",36,0)
 N TIUS,TIUSTAT,TIUSTATE,TIUY S TIUY=0
"RTN","TIURM1",37,0)
 S TIUSTATE=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIURM1",38,0)
 S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT!TIUY  D
"RTN","TIURM1",39,0)
 . S TIUS=TIUS+1
"RTN","TIURM1",40,0)
 . I TIUSTAT=TIUSTATE S TIUY=1
"RTN","TIURM1",41,0)
 Q TIUY
"RTN","TIURM1",42,0)
ININST(TIUDA,TIUDI) ; Evaluates whether a TIU DOCUMENT record
"RTN","TIURM1",43,0)
 ; is among the selected divisions
"RTN","TIURM1",44,0)
 ; Input -- TIUDA    TIU DOCUMENT file (#8925) IEN
"RTN","TIURM1",45,0)
 ;       -- TIUDI(   i.e. TIUDI(file #40.8 IEN)=Institution file
"RTN","TIURM1",46,0)
 ;                                           pointer for file #40.8 entry
"RTN","TIURM1",47,0)
 ; Output - TIUY     0= record not in selected division
"RTN","TIURM1",48,0)
 ;                   1= record in selected division
"RTN","TIURM1",49,0)
 N TIUIFP,TIUI,TIUINST,TIUY S TIUY=0
"RTN","TIURM1",50,0)
 S TIUINST=+$P($G(^TIU(8925,+TIUDA,12)),U,12)
"RTN","TIURM1",51,0)
 S TIUI=0 F  S TIUI=$O(TIUDI(TIUI)) Q:'TIUI!TIUY  D
"RTN","TIURM1",52,0)
 . S TIUIFP=$G(TIUDI(TIUI))
"RTN","TIURM1",53,0)
 . I TIUIFP=TIUINST S TIUY=1
"RTN","TIURM1",54,0)
 Q TIUY
"RTN","TIURM1",55,0)
 ;
"RTN","TIURM1",56,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,DIVIFNS) ; Expands list elements for LM Template
"RTN","TIURM1",57,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIURM1",58,0)
 S VALMCNT=0
"RTN","TIURM1",59,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",60,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",61,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1)
"RTN","TIURM1",62,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURM1",63,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURM1",64,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURM1",65,0)
 . . S TIUDA=0
"RTN","TIURM1",66,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",67,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIURM1",68,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURM1",69,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURM1",70,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURM1",71,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURM1",72,0)
 M ^TMP("TIUR",$J,"DIV")=DIVIFNS
"RTN","TIURM1",73,0)
 I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",74,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURM1",75,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURM1",76,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURM1",77,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIURM1",78,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIURM1",79,0)
 ; -- Expand to show kids that fit:
"RTN","TIURM1",80,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURM1",81,0)
 Q
"RTN","TIURM1",82,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURM1",83,0)
 ;List Template list
"RTN","TIURM1",84,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIURM1",85,0)
 S SORTVAL=""
"RTN","TIURM1",86,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIURM1",87,0)
 . S TIUDTM=0
"RTN","TIURM1",88,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURM1",89,0)
 . . S TIUDA=0
"RTN","TIURM1",90,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",91,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURM1",92,0)
 Q
"RTN","TIURM1",93,0)
 ;
"RTN","TIURM1",94,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURM1",95,0)
 N PT,ADT,DDT,AUT,AMD,EDT,LCT,SDT,TIULST4,INSTA,TIUSTN
"RTN","TIURM1",96,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,STATX,TIULI,DOC ;P74 newed DOC
"RTN","TIURM1",97,0)
 N PREFIX,TIUGDATA
"RTN","TIURM1",98,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIURM1",99,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURM1",100,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIURM1",101,0)
 . S TIUCNT=0
"RTN","TIURM1",102,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURM1",103,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURM1",104,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURM1",105,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURM1",106,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIURM1",107,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURM1",108,0)
 S TIULI=$E(PT)
"RTN","TIURM1",109,0)
 S PT=PREFIX_PT
"RTN","TIURM1",110,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURM1",111,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURM1",112,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURM1",113,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURM1",114,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURM1",115,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURM1",116,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURM1",117,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURM1",118,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U,7),"MM/DD/YY")
"RTN","TIURM1",119,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURM1",120,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURM1",121,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURM1",122,0)
 S LCT=$P(TIUD0,U,10)
"RTN","TIURM1",123,0)
 S INSTA=""
"RTN","TIURM1",124,0)
 I +$P(TIUD12,U,12)>0 D
"RTN","TIURM1",125,0)
 . S TIUSTN=$$NS^XUAF4($P(TIUD12,U,12))
"RTN","TIURM1",126,0)
 . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIURM1",127,0)
 S INSTA=$E(INSTA,1,8)
"RTN","TIURM1",128,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURM1",129,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURM1",130,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURM1",131,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURM1",132,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURM1",133,0)
 S TIUREC=$$SETFLD^VALM1(ADT,TIUREC,"ADMISSION DATE")
"RTN","TIURM1",134,0)
 S TIUREC=$$SETFLD^VALM1(DDT,TIUREC,"DISCH DATE")
"RTN","TIURM1",135,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"DICT DATE")
"RTN","TIURM1",136,0)
 S TIUREC=$$SETFLD^VALM1(LCT,TIUREC,"LINE COUNT")
"RTN","TIURM1",137,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURM1",138,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURM1",139,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"ATTENDING")
"RTN","TIURM1",140,0)
 S TIUREC=$$SETFLD^VALM1(INSTA,TIUREC,"DIVISION")
"RTN","TIURM1",141,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURM1",142,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURM1",143,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURM1",144,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)=""
"RTN","TIURM1",145,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURM1",146,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURM1",147,0)
 I +$G(APPEND) D
"RTN","TIURM1",148,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURM1",149,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURMH
"RTN","TIURM1",150,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURM1",151,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURM1",152,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURM1",153,0)
 . S VALMCNT=TIUCNT
"RTN","TIURM1",154,0)
 . I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",155,0)
 Q
"VER")
8.0^22.0
"BLD",9840,6)
^273
**END**
**END**

