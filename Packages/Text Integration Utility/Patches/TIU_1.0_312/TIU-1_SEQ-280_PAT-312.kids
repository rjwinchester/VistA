Released TIU*1*312 SEQ #280
Extracted from mail message
**KIDS**:TIU*1.0*312^

**INSTALL NAME**
TIU*1.0*312
"BLD",10481,0)
TIU*1.0*312^TEXT INTEGRATION UTILITIES^0^3170719^y
"BLD",10481,1,0)
^^2^2^3170719^
"BLD",10481,1,1,0)
This patch will address errors encountered during background HL7 
"BLD",10481,1,2,0)
processing of incoming TIU Progress Notes (HL7 MDM messages)
"BLD",10481,4,0)
^9.64PA^^
"BLD",10481,6.3)
3
"BLD",10481,"ABPKG")
n
"BLD",10481,"KRN",0)
^9.67PA^779.2^20
"BLD",10481,"KRN",.4,0)
.4
"BLD",10481,"KRN",.401,0)
.401
"BLD",10481,"KRN",.402,0)
.402
"BLD",10481,"KRN",.403,0)
.403
"BLD",10481,"KRN",.5,0)
.5
"BLD",10481,"KRN",.84,0)
.84
"BLD",10481,"KRN",3.6,0)
3.6
"BLD",10481,"KRN",3.8,0)
3.8
"BLD",10481,"KRN",9.2,0)
9.2
"BLD",10481,"KRN",9.8,0)
9.8
"BLD",10481,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10481,"KRN",9.8,"NM",1,0)
TIUHL7U2^^0^B24210461
"BLD",10481,"KRN",9.8,"NM","B","TIUHL7U2",1)

"BLD",10481,"KRN",19,0)
19
"BLD",10481,"KRN",19.1,0)
19.1
"BLD",10481,"KRN",101,0)
101
"BLD",10481,"KRN",409.61,0)
409.61
"BLD",10481,"KRN",771,0)
771
"BLD",10481,"KRN",779.2,0)
779.2
"BLD",10481,"KRN",870,0)
870
"BLD",10481,"KRN",8989.51,0)
8989.51
"BLD",10481,"KRN",8989.52,0)
8989.52
"BLD",10481,"KRN",8994,0)
8994
"BLD",10481,"KRN","B",.4,.4)

"BLD",10481,"KRN","B",.401,.401)

"BLD",10481,"KRN","B",.402,.402)

"BLD",10481,"KRN","B",.403,.403)

"BLD",10481,"KRN","B",.5,.5)

"BLD",10481,"KRN","B",.84,.84)

"BLD",10481,"KRN","B",3.6,3.6)

"BLD",10481,"KRN","B",3.8,3.8)

"BLD",10481,"KRN","B",9.2,9.2)

"BLD",10481,"KRN","B",9.8,9.8)

"BLD",10481,"KRN","B",19,19)

"BLD",10481,"KRN","B",19.1,19.1)

"BLD",10481,"KRN","B",101,101)

"BLD",10481,"KRN","B",409.61,409.61)

"BLD",10481,"KRN","B",771,771)

"BLD",10481,"KRN","B",779.2,779.2)

"BLD",10481,"KRN","B",870,870)

"BLD",10481,"KRN","B",8989.51,8989.51)

"BLD",10481,"KRN","B",8989.52,8989.52)

"BLD",10481,"KRN","B",8994,8994)

"BLD",10481,"QUES",0)
^9.62^^
"BLD",10481,"REQB",0)
^9.611^1^1
"BLD",10481,"REQB",1,0)
TIU*1.0*200^2
"BLD",10481,"REQB","B","TIU*1.0*200",1)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
312^3170719
"PKG",470,22,1,"PAH",1,1,0)
^^2^2^3170719
"PKG",470,22,1,"PAH",1,1,1,0)
This patch will address errors encountered during background HL7 
"PKG",470,22,1,"PAH",1,1,2,0)
processing of incoming TIU Progress Notes (HL7 MDM messages)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","TIUHL7U2")
0^1^B24210461^B27485997
"RTN","TIUHL7U2",1,0)
TIUHL7U2 ; SLC/AJB - TIUHL7 Utilities; March 23, 2005 ; 3/20/17 4:58pm
"RTN","TIUHL7U2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**200,312**;Jun 20, 1997;Build 3
"RTN","TIUHL7U2",3,0)
 ; Per VA Directive 6402, this routine should not be modified.
"RTN","TIUHL7U2",4,0)
 Q
"RTN","TIUHL7U2",5,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum
"RTN","TIUHL7U2",6,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUHL7U2",7,0)
 N PTIEN,SUCCESS
"RTN","TIUHL7U2",8,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM",$G(PERSON))
"RTN","TIUHL7U2",9,0)
 I TIUCAN'>0 S TIUDADD=TIUCAN Q
"RTN","TIUHL7U2",10,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUHL7U2",11,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUHL7U2",12,0)
 D ^DIC
"RTN","TIUHL7U2",13,0)
 S TIUDADD=+Y
"RTN","TIUHL7U2",14,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUHL7U2",15,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUHL7U2",16,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUHL7U2",17,0)
 S PTIEN=$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIUHL7U2",18,0)
 D STUFREC^TIUSRVP1(+TIUDADD,.TIUX,PTIEN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUHL7U2",19,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUHL7U2",20,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUHL7U2",21,0)
 D SETXT0^TIUSRVP(+TIUDADD)
"RTN","TIUHL7U2",22,0)
 D FILE^TIUSRVP(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUHL7U2",23,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) S TIUDADD="-1^Could not create addendum." Q
"RTN","TIUHL7U2",24,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUHL7U2",25,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUHL7U2",26,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUHL7U2",27,0)
 Q
"RTN","TIUHL7U2",28,0)
DOCPRM(TIUTYP,TIUDPRM,TIUDA) ; Get Document Parameters, support inheritance
"RTN","TIUHL7U2",29,0)
 N TIUI,TIUDAD
"RTN","TIUHL7U2",30,0)
 S (TIUDPRM(0),TIUDPRM(5))=""
"RTN","TIUHL7U2",31,0)
 I $P($G(^TIU(8925.1,+TIUTYP,0)),U)["ADDENDUM",+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUHL7U2",32,0)
 S TIUI=+$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIUHL7U2",33,0)
 I +TIUI D  Q
"RTN","TIUHL7U2",34,0)
 . S TIUDPRM(0)=$G(^TIU(8925.95,+TIUI,0))
"RTN","TIUHL7U2",35,0)
 . I +$O(^TIU(8925.95,+TIUI,5,0)) D
"RTN","TIUHL7U2",36,0)
 . . N TIUJ S TIUJ=0
"RTN","TIUHL7U2",37,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,5,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUHL7U2",38,0)
 . . . S $P(TIUDPRM(5),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,5,+TIUJ,0))
"RTN","TIUHL7U2",39,0)
 . . S TIUJ=0
"RTN","TIUHL7U2",40,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,4,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUHL7U2",41,0)
 . . . S $P(TIUDPRM(4),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,4,+TIUJ,0))
"RTN","TIUHL7U2",42,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUHL7U2",43,0)
 I +TIUDAD D DOCPRM(TIUDAD,.TIUDPRM)
"RTN","TIUHL7U2",44,0)
 Q
"RTN","TIUHL7U2",45,0)
ES(DA,TIUES,TIUI,TIUESIG) ; ^DIE call for /es/
"RTN","TIUHL7U2",46,0)
 N SIGNER,DR,DIE,ESDT,TIUSTAT,TIUSTNOW,COSIGNER,SVCHIEF,CSREQ,TIUPRINT
"RTN","TIUHL7U2",47,0)
 N CSNEED,TIUTTL,TIUPSIG,TIUDPRM,DAO,TIUSTWAS,TIUSTIS,DAORIG,TIUCHNG
"RTN","TIUHL7U2",48,0)
 S TIUSTWAS=$P($G(^TIU(8925,DA,0)),U,5) S:'+$G(TIUESIG) TIUESIG=DUZ
"RTN","TIUHL7U2",49,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPRM,DA)
"RTN","TIUHL7U2",50,0)
 S TIUSTAT=$P($G(^TIU(8925,+DA,0)),U,5),ESDT=$$NOW^TIULC
"RTN","TIUHL7U2",51,0)
 S SVCHIEF=+$$ISA^USRLM(TIUESIG,"CLINICAL SERVICE CHIEF")
"RTN","TIUHL7U2",52,0)
 S SIGNER=$P(^TIU(8925,+DA,12),U,4),COSIGNER=$P(^(12),U,8),CSREQ=0
"RTN","TIUHL7U2",53,0)
 S CSNEED=+$P($G(^TIU(8925,+DA,15)),U,6)
"RTN","TIUHL7U2",54,0)
 I +CSNEED,(TIUESIG'=COSIGNER),'+$G(SVCHIEF),(TIUSTAT'=6) S CSREQ=1
"RTN","TIUHL7U2",55,0)
 I TIUSTAT=5 D
"RTN","TIUHL7U2",56,0)
 . S DR=".05////"_$S(+CSREQ:6,1:7)_";1501////"_ESDT_";1502////"_+TIUESIG
"RTN","TIUHL7U2",57,0)
 . I '+$G(CSREQ),+CSNEED,$S(TIUESIG=COSIGNER:1,+$G(SVCHIEF):1,1:0) D
"RTN","TIUHL7U2",58,0)
 . . S DR=DR_";1506////0;1507////"_ESDT_";1508////"_+TIUESIG_";1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIUHL7U2",59,0)
 I TIUSTAT=6 S DR=".05////7;1506////0;1507////"_ESDT_";1508////"_+TIUESIG
"RTN","TIUHL7U2",60,0)
 Q:'$D(DR)
"RTN","TIUHL7U2",61,0)
 ;Patch TIU*1.0*312 write removed from next line - W:'$D(XWBOS) "."
"RTN","TIUHL7U2",62,0)
 S DIE=8925 D ^DIE
"RTN","TIUHL7U2",63,0)
 I TIUSTAT=5 S DR="1503///^S X=$P(TIUES,U,2);1504///^S X=$P(TIUES,U,3);1505////E"
"RTN","TIUHL7U2",64,0)
 I TIUSTAT=6 D
"RTN","TIUHL7U2",65,0)
 . N TIUSBY S DR="",TIUSBY=$P($G(^TIU(8925,+DA,15)),U,2)
"RTN","TIUHL7U2",66,0)
 . I +TIUSBY>0 S DR="1503///^S X=$$SIGNAME^TIULS("_TIUSBY_");1504///^S X=$$SIGTITL^TIULS("_TIUSBY_");"
"RTN","TIUHL7U2",67,0)
 . S DR=$G(DR)_"1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIUHL7U2",68,0)
 ;Patch TIU*1.0*312 write removed from next line - W:'$D(XWBOS) "."
"RTN","TIUHL7U2",69,0)
 S DIE=8925 D ^DIE S:'+$G(TIUCHNG) TIUCHNG=1
"RTN","TIUHL7U2",70,0)
 D SEND^TIUALRT(DA),SIGNIRT^TIUDIRT(+DA)
"RTN","TIUHL7U2",71,0)
 S DAORIG=DA
"RTN","TIUHL7U2",72,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUHL7U2",73,0)
 I +$G(CSREQ)'>0 D MAIN^TIUPD(DA,"S") I 1
"RTN","TIUHL7U2",74,0)
 ;If 'Credit Stop Code on Completion' is Yes - *312 clear flag
"RTN","TIUHL7U2",75,0)
 ;Patch TIU*1.0*312 interactive code skipped 
"RTN","TIUHL7U2",76,0)
 I +$P(^TIU(8925,+DA,0),U,11) D REMFLAG^TIUVSIT(+DA)
"RTN","TIUHL7U2",77,0)
 ;PATCH TIU*1.0*312 Skipping the following code. Replaced with the 
"RTN","TIUHL7U2",78,0)
 ;above line of code - this routine is not an interactive routine.
"RTN","TIUHL7U2",79,0)
 ;There should be no reason that this is called by interactive
"RTN","TIUHL7U2",80,0)
 ;processing but I've left the code here commented out just in case.
"RTN","TIUHL7U2",81,0)
 ;FYI: ES^TIUHL7U2 was copied from ES^TIURS when it was developed
"RTN","TIUHL7U2",82,0)
 ;I +$P(^TIU(8925,+DA,0),U,11) D
"RTN","TIUHL7U2",83,0)
 ;. ;If workload does not exist, process using TIU's interview otherwise
"RTN","TIUHL7U2",84,0)
 ;. ;process as an edit using PCE's interview
"RTN","TIUHL7U2",85,0)
 ;. I '$$CHKVST^TIUPXAP2(+DA) D  I 1
"RTN","TIUHL7U2",86,0)
 ;. . N TIUCONT,TIUPRMT
"RTN","TIUHL7U2",87,0)
 ;. . Q:$D(XWBOS)
"RTN","TIUHL7U2",88,0)
 ;. . I $P(+$P(^TIU(8925,+DA,0),U,7),".")>DT D  Q
"RTN","TIUHL7U2",89,0)
 ;. . . W !!
"RTN","TIUHL7U2",90,0)
 ;. . . D QUE^TIUPXAP1
"RTN","TIUHL7U2",91,0)
 ;. . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUHL7U2",92,0)
 ;. . W !!
"RTN","TIUHL7U2",93,0)
 ;. . ;Check if workload should be entered
"RTN","TIUHL7U2",94,0)
 ;. . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D CREDIT^TIUVSIT(DA)
"RTN","TIUHL7U2",95,0)
 ;. E  D
"RTN","TIUHL7U2",96,0)
 ;. . ;Check if workload should be entered
"RTN","TIUHL7U2",97,0)
 ;. . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D EDTENC^TIUPXAP2(DA)
"RTN","TIUHL7U2",98,0)
 ;. D REMFLAG^TIUVSIT(+DA)
"RTN","TIUHL7U2",99,0)
 ;
"RTN","TIUHL7U2",100,0)
 ;If document does not have a visit and docmt is associated with
"RTN","TIUHL7U2",101,0)
 ;an event type visit or call is invoked by broker, check if
"RTN","TIUHL7U2",102,0)
 ;docmt can be linked to an existing visit or try and create a new
"RTN","TIUHL7U2",103,0)
 ;visit. (P179)
"RTN","TIUHL7U2",104,0)
 I $D(^TIU(8925,+DA,0)),$P(^(0),U,3)'>0,($P(^(0),U,13)="E"!($$BROKER^XWBLIB)) D
"RTN","TIUHL7U2",105,0)
 . N D0,DFN,TIU,TIUVSIT
"RTN","TIUHL7U2",106,0)
 . ;Try to link docmt to an existing visit, quit if successful
"RTN","TIUHL7U2",107,0)
 . I $$LNKVST^TIUPXAP3(DA,.TIUVSIT) Q
"RTN","TIUHL7U2",108,0)
 . ;Otherwise set TIU array and DFN to use TIU API which calls PCE
"RTN","TIUHL7U2",109,0)
 . ;to resolve multiple visits or creates a new visit
"RTN","TIUHL7U2",110,0)
 . D GETTIU^TIULD(.TIU,DA)
"RTN","TIUHL7U2",111,0)
 . S DFN=$P($G(^TIU(8925,+DA,0)),U,2)
"RTN","TIUHL7U2",112,0)
 . D QUE^TIUPXAP1
"RTN","TIUHL7U2",113,0)
 ; post-signature action
"RTN","TIUHL7U2",114,0)
 N TIUCONS S TIUCONS=-1
"RTN","TIUHL7U2",115,0)
 D ISCNSLT^TIUCNSLT(.TIUCONS,+$G(^TIU(8925,DA,0)))
"RTN","TIUHL7U2",116,0)
 I TIUCONS S DA=DAORIG
"RTN","TIUHL7U2",117,0)
 S TIUSTIS=$P($G(^TIU(8925,DA,0)),U,5)
"RTN","TIUHL7U2",118,0)
 S TIUTTL=+$G(^TIU(8925,+DA,0)),TIUPSIG=$$POSTSIGN^TIULC1(TIUTTL)
"RTN","TIUHL7U2",119,0)
 I +$L(TIUPSIG),'+$G(CSREQ) X TIUPSIG
"RTN","TIUHL7U2",120,0)
 I TIUCONS,TIUSTIS=7,TIUSTWAS<7,$$HASKIDS^TIUSRVLI(DA) D
"RTN","TIUHL7U2",121,0)
 . N SEQUENCE,TIUKIDS,TIUINT,TIUK
"RTN","TIUHL7U2",122,0)
 . S SEQUENCE="D",TIUKIDS="TIUKIDS",TIUINT=0,TIUK=0
"RTN","TIUHL7U2",123,0)
 . D SETKIDS^TIUSRVLI(TIUKIDS,DA,TIUINT)
"RTN","TIUHL7U2",124,0)
 . F  S TIUK=$O(TIUKIDS(TIUK)) Q:'TIUK  D
"RTN","TIUHL7U2",125,0)
 . . I $P(TIUKIDS(TIUK),U,7)="completed" X TIUPSIG
"RTN","TIUHL7U2",126,0)
 Q
"RTN","TIUHL7U2",127,0)
STRIP(X) ; Strip control characters
"RTN","TIUHL7U2",128,0)
 N I,Y
"RTN","TIUHL7U2",129,0)
 ; First replace TABS w/5 spaces
"RTN","TIUHL7U2",130,0)
 F I=1:1:$L(X) S:$A(X,I)=9 X=$E(X,1,(I-1))_"     "_$E(X,(I+1),$L(X))
"RTN","TIUHL7U2",131,0)
 ; Next, remove control characters
"RTN","TIUHL7U2",132,0)
 S Y="" F I=1:1:$L(X) S:$A(X,I)>31 Y=Y_$E(X,I)
"RTN","TIUHL7U2",133,0)
 Q Y
"VER")
8.0^22.2
"BLD",10481,6)
^280
**END**
**END**

