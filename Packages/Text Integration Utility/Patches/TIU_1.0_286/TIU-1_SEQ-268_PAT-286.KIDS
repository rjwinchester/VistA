Released TIU*1*286 SEQ #268
Extracted from mail message
**KIDS**:TIU*1.0*286^

**INSTALL NAME**
TIU*1.0*286
"BLD",9723,0)
TIU*1.0*286^TEXT INTEGRATION UTILITIES^0^3150414^y
"BLD",9723,1,0)
^^7^7^3150414^
"BLD",9723,1,1,0)
This patch will resolve the following issues:
"BLD",9723,1,2,0)
 
"BLD",9723,1,3,0)
  1) AUTHORIZATION/SUBSCRIPTION UTILITY (ASU) CLINICAL COORDINATOR MANUAL
"BLD",9723,1,4,0)
     documentation changes
"BLD",9723,1,5,0)
  2) Date range search options in TIU will reset the date range
"BLD",9723,1,6,0)
  3) Incorrect Philippines address format
"BLD",9723,1,7,0)
  4) Routine TIUSRVR2 does not contain 211 on the 2nd line
"BLD",9723,4,0)
^9.64PA^^
"BLD",9723,6.3)
10
"BLD",9723,"ABPKG")
n
"BLD",9723,"KRN",0)
^9.67PA^779.2^20
"BLD",9723,"KRN",.4,0)
.4
"BLD",9723,"KRN",.401,0)
.401
"BLD",9723,"KRN",.402,0)
.402
"BLD",9723,"KRN",.403,0)
.403
"BLD",9723,"KRN",.5,0)
.5
"BLD",9723,"KRN",.84,0)
.84
"BLD",9723,"KRN",3.6,0)
3.6
"BLD",9723,"KRN",3.8,0)
3.8
"BLD",9723,"KRN",9.2,0)
9.2
"BLD",9723,"KRN",9.8,0)
9.8
"BLD",9723,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",9723,"KRN",9.8,"NM",2,0)
TIUR^^0^B48162828
"BLD",9723,"KRN",9.8,"NM",3,0)
TIURM^^0^B25100246
"BLD",9723,"KRN",9.8,"NM",4,0)
TIURPTTL^^0^B21170947
"BLD",9723,"KRN",9.8,"NM",5,0)
TIURTITL^^0^B20499577
"BLD",9723,"KRN",9.8,"NM",6,0)
TIUSRVR2^^0^B32093464
"BLD",9723,"KRN",9.8,"NM",7,0)
TIUWRIIS^^0^B43880455
"BLD",9723,"KRN",9.8,"NM","B","TIUR",2)

"BLD",9723,"KRN",9.8,"NM","B","TIURM",3)

"BLD",9723,"KRN",9.8,"NM","B","TIURPTTL",4)

"BLD",9723,"KRN",9.8,"NM","B","TIURTITL",5)

"BLD",9723,"KRN",9.8,"NM","B","TIUSRVR2",6)

"BLD",9723,"KRN",9.8,"NM","B","TIUWRIIS",7)

"BLD",9723,"KRN",19,0)
19
"BLD",9723,"KRN",19.1,0)
19.1
"BLD",9723,"KRN",101,0)
101
"BLD",9723,"KRN",409.61,0)
409.61
"BLD",9723,"KRN",771,0)
771
"BLD",9723,"KRN",779.2,0)
779.2
"BLD",9723,"KRN",870,0)
870
"BLD",9723,"KRN",8989.51,0)
8989.51
"BLD",9723,"KRN",8989.52,0)
8989.52
"BLD",9723,"KRN",8994,0)
8994
"BLD",9723,"KRN","B",.4,.4)

"BLD",9723,"KRN","B",.401,.401)

"BLD",9723,"KRN","B",.402,.402)

"BLD",9723,"KRN","B",.403,.403)

"BLD",9723,"KRN","B",.5,.5)

"BLD",9723,"KRN","B",.84,.84)

"BLD",9723,"KRN","B",3.6,3.6)

"BLD",9723,"KRN","B",3.8,3.8)

"BLD",9723,"KRN","B",9.2,9.2)

"BLD",9723,"KRN","B",9.8,9.8)

"BLD",9723,"KRN","B",19,19)

"BLD",9723,"KRN","B",19.1,19.1)

"BLD",9723,"KRN","B",101,101)

"BLD",9723,"KRN","B",409.61,409.61)

"BLD",9723,"KRN","B",771,771)

"BLD",9723,"KRN","B",779.2,779.2)

"BLD",9723,"KRN","B",870,870)

"BLD",9723,"KRN","B",8989.51,8989.51)

"BLD",9723,"KRN","B",8989.52,8989.52)

"BLD",9723,"KRN","B",8994,8994)

"BLD",9723,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9723,"QUES",0)
^9.62^^
"BLD",9723,"REQB",0)
^9.611^6^3
"BLD",9723,"REQB",4,0)
TIU*1.0*282^2
"BLD",9723,"REQB",5,0)
TIU*1.0*234^2
"BLD",9723,"REQB",6,0)
TIU*1.0*159^2
"BLD",9723,"REQB","B","TIU*1.0*159",6)

"BLD",9723,"REQB","B","TIU*1.0*234",5)

"BLD",9723,"REQB","B","TIU*1.0*282",4)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
286^3150414
"PKG",470,22,1,"PAH",1,1,0)
^^7^7^3150414
"PKG",470,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",470,22,1,"PAH",1,1,2,0)
 
"PKG",470,22,1,"PAH",1,1,3,0)
  1) AUTHORIZATION/SUBSCRIPTION UTILITY (ASU) CLINICAL COORDINATOR MANUAL
"PKG",470,22,1,"PAH",1,1,4,0)
     documentation changes
"PKG",470,22,1,"PAH",1,1,5,0)
  2) Date range search options in TIU will reset the date range
"PKG",470,22,1,"PAH",1,1,6,0)
  3) Incorrect Philippines address format
"PKG",470,22,1,"PAH",1,1,7,0)
  4) Routine TIUSRVR2 does not contain 211 on the 2nd line
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","TIUR")
0^2^B48162828^B47288621
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,112,207,224,272,282,286**;Jun 20, 1997;Build 10
"RTN","TIUR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIUR",4,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",5,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",6,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",7,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG,TIUSC207,TIU1DOC
"RTN","TIUR",8,0)
 K DIROUT
"RTN","TIUR",9,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",10,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",11,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",12,0)
STATUS ;
"RTN","TIUR",13,0)
 ; Kill status to clear out the variable when "^" is used to backup
"RTN","TIUR",14,0)
 K STATUS S STATUS=$$STAT
"RTN","TIUR",15,0)
 ;VMP/ELR changed status ck from <0 TO <1 to account for entering an *  p224
"RTN","TIUR",16,0)
 I +STATUS<1 S VALMQUIT=1 Q
"RTN","TIUR",17,0)
 S TIUI=0
"RTN","TIUR",18,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR",19,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR",20,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",21,0)
 . Q:'STATIFN
"RTN","TIUR",22,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",23,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR",24,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",25,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",26,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",27,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",28,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",29,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",30,0)
 ; TIU207-If only 1 docytyp and have been to screen prompt then go back another level to avoid loop with next prompt.
"RTN","TIUR",31,0)
 I $G(TIUSC207)=1,$G(TIU1DOC)=1 D  G STATUS
"RTN","TIUR",32,0)
 .S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",33,0)
 S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",34,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",35,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",36,0)
 S TIU1DOC=+$P($G(^TIU(8925.1,+TIUCLASS,10,0)),U,3)
"RTN","TIUR",37,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",38,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",39,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",40,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",41,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",42,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",43,0)
SCREEN ;
"RTN","TIUR",44,0)
 S TIUSC207=1
"RTN","TIUR",45,0)
 N TIUNAME,TIUOVER
"RTN","TIUR",46,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",47,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR",48,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR",49,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",50,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",51,0)
 . S SCREEN="ALL"
"RTN","TIUR",52,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",53,0)
 S TIUOVER=""
"RTN","TIUR",54,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR",.TIUOVER)
"RTN","TIUR",55,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",56,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",57,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",58,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",59,0)
 D CHECKADD
"RTN","TIUR",60,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",61,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",62,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",63,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",64,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",65,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",66,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",67,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",68,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",69,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",70,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",71,0)
 ; TIU*1.0*286 djh
"RTN","TIUR",72,0)
 S NOWFLAG=$$FMDIFF^XLFDT($$NOW^XLFDT,TIULDT,2)<60
"RTN","TIUR",73,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",74,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",75,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",76,0)
 ;    update video for line to be attached: --
"RTN","TIUR",77,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",78,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",79,0)
 Q
"RTN","TIUR",80,0)
STAT() ; Determine status
"RTN","TIUR",81,0)
 N TIUY
"RTN","TIUR",82,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR",83,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR",84,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR",85,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR",86,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR",87,0)
STATX Q TIUY
"RTN","TIUR",88,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",89,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",90,0)
 S (TIUI,HIT)=0
"RTN","TIUR",91,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",92,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",93,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",94,0)
 Q
"RTN","TIUR",95,0)
 ;
"RTN","TIUR",96,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",97,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",98,0)
 Q
"RTN","TIUR",99,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",100,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",101,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",102,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",103,0)
 Q
"RTN","TIUR",104,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",105,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",106,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",107,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",108,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",109,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",110,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",111,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",112,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",113,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",114,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",115,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",116,0)
 S ^TMP("TIUR",$J,"TITLE OVERRIDE")=$G(TIUOVER)
"RTN","TIUR",117,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",118,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",119,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",120,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",121,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",122,0)
 . I XREF'="ASUB" D
"RTN","TIUR",123,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",124,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",125,0)
 . ;*282 - Search by multiple terms 
"RTN","TIUR",126,0)
 . I XREF="ASUB" D
"RTN","TIUR",127,0)
 . . N TIUSUBJ
"RTN","TIUR",128,0)
 . . S TIUSUBJ=$S($P(SCREEN(TIUK),U,2)[" ":$P($P(SCREEN(TIUK),U,2)," "),1:$P(SCREEN(TIUK),U,2))
"RTN","TIUR",129,0)
 . . S TIUI=$O(^TIU(8925,XREF,TIUSUBJ),-1)
"RTN","TIUR",130,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[TIUSUBJ)  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",131,0)
 . . I $P(SCREEN(TIUK),U,2)[" " D
"RTN","TIUR",132,0)
 . . . N TIUIEN,TIUX,TIUY
"RTN","TIUR",133,0)
 . . . S TIUX=0 F  S TIUX=$O(^TMP("TIUI",$J,TIUX)) Q:TIUX=""  D
"RTN","TIUR",134,0)
 . . . . S TIUY=0 F  S TIUY=$O(^TMP("TIUI",$J,TIUX,TIUY)) Q:TIUY=""  D
"RTN","TIUR",135,0)
 . . . . . S TIUIEN=0 F  S TIUIEN=$O(^TMP("TIUI",$J,TIUX,TIUY,TIUIEN)) Q:TIUIEN=""  I $$UP^XLFSTR(^TIU(8925,TIUIEN,17))'[($P(SCREEN(TIUK),U,2)) K ^TMP("TIUI",$J,TIUX,TIUY,TIUIEN)
"RTN","TIUR",136,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",137,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",138,0)
 Q
"RTN","TIUR",139,0)
 ;
"RTN","TIUR",140,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",141,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",142,0)
 K VALMY
"RTN","TIUR",143,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",144,0)
 Q
"RTN","TIUR",145,0)
 ;
"RTN","TIUR",146,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",147,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",148,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",149,0)
 S TIURBLD=1
"RTN","TIUR",150,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",151,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",152,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",153,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",154,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",155,0)
 S TIUI=1
"RTN","TIUR",156,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",157,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",158,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",159,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",160,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",161,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",162,0)
 ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIUR",163,0)
 S TIUSCRN="ALL"
"RTN","TIUR",164,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",165,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",166,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",167,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",168,0)
 Q
"RTN","TIURM")
0^3^B25100246^B24432420
"RTN","TIURM",1,0)
TIURM ; SLC/JER - MIS Document Review ;9/24/03
"RTN","TIURM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,216,224,286**;Jun 20, 1997;Build 10
"RTN","TIURM",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIURM",4,0)
 ;12/7/00 split TIURM into TIURM & TIURM1
"RTN","TIURM",5,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURM",6,0)
 N DIRUT,DTOUT,DUOUT,TIUI,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURM",7,0)
 N TIUDPRMT,STATWORD,STATIFN,NOWFLAG,TIUK
"RTN","TIURM",8,0)
 K DIROUT
"RTN","TIURM",9,0)
 D INITRR^TIULRR(0)
"RTN","TIURM",10,0)
DIVISION ; Select Division(s)
"RTN","TIURM",11,0)
 D SELDIV^TIULA
"RTN","TIURM",12,0)
 I SELDIV'>0 S VALMQUIT=1 Q
"RTN","TIURM",13,0)
 I $D(TIUDI) D
"RTN","TIURM",14,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURM",15,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIURM",16,0)
 E  S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURM",17,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT(DUZ)))
"RTN","TIURM",18,0)
 ;VMP/ELR changed status ck from <0 TO <1 to account for entering an *  p224
"RTN","TIURM",19,0)
 I +STATUS<1 S VALMQUIT=1 Q
"RTN","TIURM",20,0)
 S TIUI=0
"RTN","TIURM",21,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURM",22,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURM",23,0)
 . Q:'STATIFN
"RTN","TIURM",24,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURM",25,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURM",26,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURM",27,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURM",28,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURM",29,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURM",30,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURM",31,0)
 N TIUDCL
"RTN","TIURM",32,0)
 ; -- Ask user for docmt types and set ^TMP("TIUTYP",$J):
"RTN","TIURM",33,0)
 D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL)
"RTN","TIURM",34,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",35,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) K @TIUTYP G STATUS
"RTN","TIURM",36,0)
 D CHECKADD
"RTN","TIURM",37,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURM",38,0)
 S TIUDPRMT="Entry"
"RTN","TIURM",39,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT))
"RTN","TIURM",40,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",41,0)
 I TIUEDT'>0 K @TIUTYP G DOCTYPE
"RTN","TIURM",42,0)
LATE S TIULDT=$S($D(TIUQUIK):9999999,1:$$LDATE^TIULA(TIUDPRMT))
"RTN","TIURM",43,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",44,0)
 I TIULDT'>0 G ERLY
"RTN","TIURM",45,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIURM",46,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT) ; P74.  Add late date time whether or not late date is same as early date.
"RTN","TIURM",47,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURM",48,0)
 ; TIU*1.0*286 djh
"RTN","TIURM",49,0)
 S NOWFLAG=$$FMDIFF^XLFDT($$NOW^XLFDT,TIULDT,2)<60
"RTN","TIURM",50,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURM",51,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",52,0)
 ; -- If attaching ID note & changed view,
"RTN","TIURM",53,0)
 ;    update video for line to be attached: --
"RTN","TIURM",54,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURM",55,0)
 K TIUDI,SELDIV
"RTN","TIURM",56,0)
 Q
"RTN","TIURM",57,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIURM",58,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIURM",59,0)
 S (TIUI,HIT)=0
"RTN","TIURM",60,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIURM",61,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIURM",62,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIURM",63,0)
 Q
"RTN","TIURM",64,0)
SWAP(TIUX,TIUY) ; Swap any two variables
"RTN","TIURM",65,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIURM",66,0)
 Q
"RTN","TIURM",67,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIURM",68,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIURM",69,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIURM",70,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIURM",71,0)
 Q
"RTN","TIURM",72,0)
BUILD(TIUCLASS,STATUS,EARLY,LATE,NOWFLAG,TIUDI) ; Build List
"RTN","TIURM",73,0)
 N TIUPREF
"RTN","TIURM",74,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIURM",75,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIURM",76,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURM",77,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURM",78,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURM",79,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURM",80,0)
 S ^TMP("TIUR",$J,"RTN")="TIURM"
"RTN","TIURM",81,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURM",82,0)
 S EARLY=+$G(EARLY,0),LATE=+$G(LATE,3333333)
"RTN","TIURM",83,0)
 D GATHER^TIURM1(TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,.TIUDI)
"RTN","TIURM",84,0)
 D PUTLIST^TIURM1(TIUPREF,TIUCLASS,.STATUS,.TIUDI)
"RTN","TIURM",85,0)
 K ^TMP("TIUI",$J)
"RTN","TIURM",86,0)
 Q
"RTN","TIURM",87,0)
CLEAN ; Clean up your mess!
"RTN","TIURM",88,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURM",89,0)
 K VALMY
"RTN","TIURM",90,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIURM",91,0)
 Q
"RTN","TIURM",92,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURM",93,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURM",94,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURM",95,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURM",96,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURM",97,0)
 Q TIUY
"RTN","TIURM",98,0)
DFLTSTAT(USER) ; Set default STATUS for current user
"RTN","TIURM",99,0)
 N TIUMIS,TIUMD,TIUY,TIUDPRM D DOCPRM^TIULC1(244,.TIUDPRM)
"RTN","TIURM",100,0)
 S TIUMIS=$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")
"RTN","TIURM",101,0)
 I +TIUMIS,+$P($G(TIUDPRM(0)),U,3) S TIUY="UNVERIFIED" G DFLTX
"RTN","TIURM",102,0)
 I $$ISA^USRLM(DUZ,"PROVIDER") S TIUY="COMPLETED" G DFLTX
"RTN","TIURM",103,0)
 S TIUY="COMPLETED"
"RTN","TIURM",104,0)
DFLTX Q TIUY
"RTN","TIURM",105,0)
 ;
"RTN","TIURM",106,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURM",107,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUEDT,TIULDT
"RTN","TIURM",108,0)
 N TIURBLD,TIUI,TIUCLASS,TIUDI,TIUSCRN
"RTN","TIURM",109,0)
 S TIURBLD=1
"RTN","TIURM",110,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURM",111,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURM",112,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURM",113,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURM",114,0)
 S TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURM",115,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURM",116,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURM",117,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURM",118,0)
 M TIUDI=^TMP("TIUR",$J,"DIV")
"RTN","TIURM",119,0)
 ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIURM",120,0)
 S TIUSCRN="ALL"
"RTN","TIURM",121,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",122,0)
 ; Reexpand previously expanded items:
"RTN","TIURM",123,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURM",124,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURM",125,0)
 Q
"RTN","TIURPTTL")
0^4^B21170947^B20534008
"RTN","TIURPTTL",1,0)
TIURPTTL ; SLC/JER - Review Documents by PATIENT & TITLE ;2/26/01
"RTN","TIURPTTL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,286**;Jun 20, 1997;Build 10
"RTN","TIURPTTL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIURPTTL",4,0)
 ; 12/5/00 split rtn w GATHER, PUTLIST, ADDELMNT to new rtn TIURPTT1
"RTN","TIURPTTL",5,0)
 ;
"RTN","TIURPTTL",6,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURPTTL",7,0)
 N DFN,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL,TIUQUIT
"RTN","TIURPTTL",8,0)
 N STATWORD,STATIFN,NOWFLAG
"RTN","TIURPTTL",9,0)
STATUS S STATUS=$$SELSTAT^TIULA(.TIUSTAT,"F","ALL")
"RTN","TIURPTTL",10,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURPTTL",11,0)
 S TIUI=0
"RTN","TIURPTTL",12,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURPTTL",13,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURPTTL",14,0)
 . Q:'STATIFN
"RTN","TIURPTTL",15,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURPTTL",16,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURPTTL",17,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURPTTL",18,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURPTTL",19,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURPTTL",20,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURPTTL",21,0)
PATIENT ; Select Patient
"RTN","TIURPTTL",22,0)
 S DFN=$S(+$G(ORVP):+$G(ORVP),1:+$$PATIENT^TIULA)
"RTN","TIURPTTL",23,0)
 I +DFN'>0 S VALMQUIT=1 Q
"RTN","TIURPTTL",24,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURPTTL",25,0)
 N TIUDCL
"RTN","TIURPTTL",26,0)
 D TITLPICK^TIULA3(.TIUTYP,TIUCLASS)
"RTN","TIURPTTL",27,0)
 I +$D(TIUQUIT) S VALMQUIT=1 Q
"RTN","TIURPTTL",28,0)
 I +$G(TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURPTTL",29,0)
SCREEN ;
"RTN","TIURPTTL",30,0)
 N TIUNAME
"RTN","TIURPTTL",31,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIURPTTL",32,0)
 S SCREEN=1,SCREEN(1)="APT^"_DFN
"RTN","TIURPTTL",33,0)
 D CHECKADD(.TIUTYP)
"RTN","TIURPTTL",34,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURPTTL",35,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$P($$EDATE^TIULA("Reference","",TIUEDFLT),U))
"RTN","TIURPTTL",36,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURPTTL",37,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIURPTTL",38,0)
 S TIULDT=$S($D(TIUQUIK):9999999,1:$P($$LDATE^TIULA("Reference"),U))
"RTN","TIURPTTL",39,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURPTTL",40,0)
 I TIULDT'>0 G ERLY
"RTN","TIURPTTL",41,0)
 I TIUEDT>TIULDT D SWAP^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURPTTL",42,0)
 I $L(TIULDT,".")=1 D EXPRANGE^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURPTTL",43,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURPTTL",44,0)
 ; TIU*1.0*286 djh
"RTN","TIURPTTL",45,0)
 S NOWFLAG=$$FMDIFF^XLFDT($$NOW^XLFDT,TIULDT,2)<60
"RTN","TIURPTTL",46,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURPTTL",47,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.SCREEN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURPTTL",48,0)
 ; -- If changed view while attaching ID note, update video for note: --
"RTN","TIURPTTL",49,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURPTTL",50,0)
 Q
"RTN","TIURPTTL",51,0)
CHECKADD(TYPES) ; Checks whether Addendum is included in the list of types
"RTN","TIURPTTL",52,0)
 N TIUI,HIT S (TIUI,HIT)=0
"RTN","TIURPTTL",53,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(TYPES(TIUI))["ADDENDUM" S HIT=1
"RTN","TIURPTTL",54,0)
 I +HIT'>0 S TYPES(TYPES+1)=+TYPES(TYPES)+1_U_"81^Addendum^NOT PICKED",TYPES=TYPES+1
"RTN","TIURPTTL",55,0)
 Q
"RTN","TIURPTTL",56,0)
BUILD(TIUCLASS,STATUS,TYPES,SCREEN,EARLY,LATE,NOWFLAG) ; Build List
"RTN","TIURPTTL",57,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUQ,TIUIFN,TIUREC
"RTN","TIURPTTL",58,0)
 N XREF,TIUS,TIUPREF
"RTN","TIURPTTL",59,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIURPTTL",60,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J),^TMP("TIUTYP",$J)
"RTN","TIURPTTL",61,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURPTTL",62,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURPTTL",63,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURPTTL",64,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURPTTL",65,0)
 ; Save docmt types in ^TMP("TIUTYP",$J) for rebuild:
"RTN","TIURPTTL",66,0)
 M ^TMP("TIUTYP",$J)=TYPES
"RTN","TIURPTTL",67,0)
 S ^TMP("TIUR",$J,"RTN")="TIURPTTL"
"RTN","TIURPTTL",68,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURPTTL",69,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIURPTTL",70,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIURPTTL",71,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIURPTTL",72,0)
 . I XREF'="ASUB" D
"RTN","TIURPTTL",73,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIURPTTL",74,0)
 . . D GATHER^TIURPTT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURPTTL",75,0)
 . I XREF="ASUB" D
"RTN","TIURPTTL",76,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIURPTTL",77,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIURPTT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURPTTL",78,0)
 D PUTLIST^TIURPTT1(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIURPTTL",79,0)
 Q
"RTN","TIURPTTL",80,0)
CLEAN ; Clean up your mess!
"RTN","TIURPTTL",81,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10
"RTN","TIURPTTL",82,0)
 K VALMY,^TMP("TIUTYP",$J)
"RTN","TIURPTTL",83,0)
 Q
"RTN","TIURPTTL",84,0)
 ;
"RTN","TIURPTTL",85,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURPTTL",86,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIURPTTL",87,0)
 N TIURBLD,TIUI,TIUCLASS,TIUTYP,NOWFLAG
"RTN","TIURPTTL",88,0)
 S TIURBLD=1
"RTN","TIURPTTL",89,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURPTTL",90,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURPTTL",91,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURPTTL",92,0)
 M TIUTYP=^TMP("TIUTYP",$J)
"RTN","TIURPTTL",93,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURPTTL",94,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURPTTL",95,0)
 S TIUI=1
"RTN","TIURPTTL",96,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIURPTTL",97,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIURPTTL",98,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIURPTTL",99,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURPTTL",100,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURPTTL",101,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURPTTL",102,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURPTTL",103,0)
 ; Reexpand previously expanded items:
"RTN","TIURPTTL",104,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURPTTL",105,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURPTTL",106,0)
 Q
"RTN","TIURTITL")
0^5^B20499577^B19866250
"RTN","TIURTITL",1,0)
TIURTITL ; SLC/JER - Review Documents by TITLE ;2/26/01
"RTN","TIURTITL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**58,100,286**;Jun 20, 1997;Build 10
"RTN","TIURTITL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIURTITL",4,0)
 ;12/6/00 split, moving GATHER,PUTLIST,ADDELMNT, etc to new rtn TIURTIT1
"RTN","TIURTITL",5,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURTITL",6,0)
 N TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL,TIUQUIT
"RTN","TIURTITL",7,0)
 N STATWORD,STATIFN,NOWFLAG
"RTN","TIURTITL",8,0)
 D INITRR^TIULRR(0)
"RTN","TIURTITL",9,0)
STATUS S STATUS=$$SELSTAT^TIULA(.TIUSTAT,"F","ALL")
"RTN","TIURTITL",10,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURTITL",11,0)
 S TIUI=0
"RTN","TIURTITL",12,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURTITL",13,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURTITL",14,0)
 . Q:'STATIFN
"RTN","TIURTITL",15,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURTITL",16,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURTITL",17,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURTITL",18,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURTITL",19,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURTITL",20,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURTITL",21,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURTITL",22,0)
 N TIUDCL
"RTN","TIURTITL",23,0)
 D TITLPICK^TIULA3(.TIUTYP,TIUCLASS)
"RTN","TIURTITL",24,0)
 I +$D(TIUQUIT) S VALMQUIT=1 Q
"RTN","TIURTITL",25,0)
 I +$G(TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURTITL",26,0)
SCREEN ;
"RTN","TIURTITL",27,0)
 N TIUNAME
"RTN","TIURTITL",28,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIURTITL",29,0)
 S SCREEN=1,SCREEN(1)="ALL^ANY"
"RTN","TIURTITL",30,0)
 D CHECKADD(.TIUTYP)
"RTN","TIURTITL",31,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURTITL",32,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$P($$EDATE^TIULA("Reference","",TIUEDFLT),U))
"RTN","TIURTITL",33,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURTITL",34,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIURTITL",35,0)
 S TIULDT=$S($D(TIUQUIK):9999999,1:$P($$LDATE^TIULA("Reference"),U))
"RTN","TIURTITL",36,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURTITL",37,0)
 I TIULDT'>0 G ERLY
"RTN","TIURTITL",38,0)
 I TIUEDT>TIULDT D SWAP^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURTITL",39,0)
 I $L(TIULDT,".")=1 D EXPRANGE^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURTITL",40,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURTITL",41,0)
 ; TIU*1.0*286 djh
"RTN","TIURTITL",42,0)
 S NOWFLAG=$$FMDIFF^XLFDT($$NOW^XLFDT,TIULDT,2)<60
"RTN","TIURTITL",43,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURTITL",44,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.SCREEN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURTITL",45,0)
 ; -- If changed view while attaching ID note, update video for note: --
"RTN","TIURTITL",46,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURTITL",47,0)
 Q
"RTN","TIURTITL",48,0)
CHECKADD(TYPES) ; Checks whether Addendum is included in the list of types
"RTN","TIURTITL",49,0)
 N TIUI,HIT S (TIUI,HIT)=0
"RTN","TIURTITL",50,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(TYPES(TIUI))["ADDENDUM" S HIT=1
"RTN","TIURTITL",51,0)
 I +HIT'>0 S TYPES(TYPES+1)=+TYPES(TYPES)+1_U_"81^Addendum^NOT PICKED",TYPES=TYPES+1
"RTN","TIURTITL",52,0)
 Q
"RTN","TIURTITL",53,0)
BUILD(TIUCLASS,STATUS,TYPES,SCREEN,EARLY,LATE,NOWFLAG) ; Build List
"RTN","TIURTITL",54,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUQ,TIUIFN,TIUREC
"RTN","TIURTITL",55,0)
 N XREF,TIUS,TIUPREF
"RTN","TIURTITL",56,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIURTITL",57,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J),^TMP("TIUTYP",$J)
"RTN","TIURTITL",58,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURTITL",59,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURTITL",60,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURTITL",61,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURTITL",62,0)
 ; Save docmt types in ^TMP("TIUTYP",$J) for rebuild:
"RTN","TIURTITL",63,0)
 M ^TMP("TIUTYP",$J)=TYPES
"RTN","TIURTITL",64,0)
 S ^TMP("TIUR",$J,"RTN")="TIURTITL"
"RTN","TIURTITL",65,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURTITL",66,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIURTITL",67,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIURTITL",68,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIURTITL",69,0)
 . I XREF'="ASUB" D
"RTN","TIURTITL",70,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIURTITL",71,0)
 . . D GATHER^TIURTIT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURTITL",72,0)
 . I XREF="ASUB" D
"RTN","TIURTITL",73,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIURTITL",74,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIURTIT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURTITL",75,0)
 D PUTLIST^TIURTIT1(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIURTITL",76,0)
 Q
"RTN","TIURTITL",77,0)
CLEAN ; Clean up your mess!
"RTN","TIURTITL",78,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURTITL",79,0)
 K VALMY,^TMP("TIUTYP",$J)
"RTN","TIURTITL",80,0)
 Q
"RTN","TIURTITL",81,0)
 ;
"RTN","TIURTITL",82,0)
RBLD ; Rebuild list after actions
"RTN","TIURTITL",83,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIURTITL",84,0)
 N TIURBLD,TIUI,TIUCLASS,TIUTYP,NOWFLAG
"RTN","TIURTITL",85,0)
 S TIURBLD=1
"RTN","TIURTITL",86,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURTITL",87,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURTITL",88,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURTITL",89,0)
 M TIUTYP=^TMP("TIUTYP",$J)
"RTN","TIURTITL",90,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURTITL",91,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURTITL",92,0)
 S TIUI=1
"RTN","TIURTITL",93,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIURTITL",94,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIURTITL",95,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIURTITL",96,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURTITL",97,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURTITL",98,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURTITL",99,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURTITL",100,0)
 ; Reexpand previously expanded items:
"RTN","TIURTITL",101,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURTITL",102,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURTITL",103,0)
 Q
"RTN","TIUSRVR2")
0^6^B32093464^B31602592
"RTN","TIUSRVR2",1,0)
TIUSRVR2 ; SLC/JER - RPC for record-wise GET ; 11/23/07
"RTN","TIUSRVR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,109,162,211,222,234,286**;Jun 20, 1997;Build 10
"RTN","TIUSRVR2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIUSRVR2",4,0)
 ; 4/12/01 Moved signature modules to new rtn TIUSRVR3
"RTN","TIUSRVR2",5,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL,ACTION) ; Load ^TMP
"RTN","TIUSRVR2",6,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",7,0)
 ;optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUSRVR2",8,0)
 ;                    loading the whole note after the original entry,
"RTN","TIUSRVR2",9,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUSRVR2",10,0)
 N TIUKID,TIUDADT,TIUI,CANSEE
"RTN","TIUSRVR2",11,0)
 N TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUSRVR2",12,0)
 N TIUGPRNT,TIUGPNM,TIUGPDT,TIUPDATA,TIUHASKD
"RTN","TIUSRVR2",13,0)
 S ACTION=$G(ACTION,"VIEW")
"RTN","TIUSRVR2",14,0)
 ; ---- If user cannot view, say so and quit: ----
"RTN","TIUSRVR2",15,0)
 ;      TIU*1*100
"RTN","TIUSRVR2",16,0)
 S CANSEE=$S(+$$ISCOMP^TIUSRVR1(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,ACTION))
"RTN","TIUSRVR2",17,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRVR2",18,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(CANSEE,U,2)
"RTN","TIUSRVR2",19,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUSRVR2",20,0)
 S TIUI=0
"RTN","TIUSRVR2",21,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR2",22,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRVR2",23,0)
 ; ---- if TIUDA is a COMPONENT, QUIT
"RTN","TIUSRVR2",24,0)
 Q:+$$ISCOMP^TIUSRVR1(TIUDA)
"RTN","TIUSRVR2",25,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUSRVR2",26,0)
 ;         load original document, quit: ----
"RTN","TIUSRVR2",27,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRVR2",28,0)
 . N TIULINE,TIUPARNT S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",29,0)
 . D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",30,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",31,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",32,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",33,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUSRVR2",34,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUSRVR2",35,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUSRVR2",36,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUSRVR2",37,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUSRVR2",38,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUSRVR2",39,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",40,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",41,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",42,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",43,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",44,0)
 . . S TIUGPNM=$$PNAME^TIULC1(+^TIU(8925,TIUGPRNT,0))
"RTN","TIUSRVR2",45,0)
 . . S TIUGPDT=+$G(^TIU(8925,TIUGPRNT,13))
"RTN","TIUSRVR2",46,0)
 . . S TIUGPDT=$$DATE^TIULS(TIUGPDT,"MM/DD/YY")
"RTN","TIUSRVR2",47,0)
 . I 'TIUHASKD,'TIUGPRNT S @TIUARR@(TIUL)=" --- Original Document ---"
"RTN","TIUSRVR2",48,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",49,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",50,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",51,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",52,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",53,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",54,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",55,0)
 . . S @TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR2",56,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",57,0)
 . . S @TIUARR@(TIUL)=TIUGPDT_" "_TIUGPNM
"RTN","TIUSRVR2",58,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",59,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",60,0)
 . . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",61,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUSRVR2",62,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",63,0)
 . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUSRVR2",64,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUSRVR2",65,0)
 S TIUKID=0
"RTN","TIUSRVR2",66,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",67,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",68,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUSRVR2",69,0)
 ;           or comp: ----
"RTN","TIUSRVR2",70,0)
 ; *222 don't display sig info. for FORM LETTERS
"RTN","TIUSRVR2",71,0)
 I '+$$MEMBEROF^TIUPR222(+$G(^TIU(8925,+TIUDA,0)),"FORM LETTERS") D
"RTN","TIUSRVR2",72,0)
 . I '$$ISCOMP^TIUSRVR1(TIUDA) D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",73,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUSRVR2",74,0)
 S TIUKID=0
"RTN","TIUSRVR2",75,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",76,0)
 . ; If acting on an addendum, don't show it again.
"RTN","TIUSRVR2",77,0)
 . I +TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",78,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRVR2",79,0)
 N IDDAD
"RTN","TIUSRVR2",80,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUSRVR2",81,0)
 ; ---- If Browsed Record is an ID Note, & this cycle has
"RTN","TIUSRVR2",82,0)
 ;      just loaded the parent entry, then load ID kids
"RTN","TIUSRVR2",83,0)
 ;      and quit: **100** ----
"RTN","TIUSRVR2",84,0)
 I $P(TIUGDATA,U,2),TIUDA=+TIUGDATA D LOADKIDS(TIUDA,.TIUL,TIUGDATA) Q
"RTN","TIUSRVR2",85,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle hasn't begun
"RTN","TIUSRVR2",86,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUSRVR2",87,0)
 ;      the browsed entry and quit: ----
"RTN","TIUSRVR2",88,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUSRVR2",89,0)
 . S TIUGWHOL=1
"RTN","TIUSRVR2",90,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",92,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",93,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",94,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=" --- Interdisciplinary Note ---"
"RTN","TIUSRVR2",95,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",96,0)
 . D LOADID(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUSRVR2",97,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle has begun
"RTN","TIUSRVR2",98,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUSRVR2",99,0)
 ;      entry of the whole note, then load kids and quit: ----
"RTN","TIUSRVR2",100,0)
 I IDDAD,$G(TIUGWHOL),TIUDA=IDDAD D LOADKIDS(TIUDA,.TIUL,TIUGDATA,TIUGWHOL) K TIUGWHOL
"RTN","TIUSRVR2",101,0)
 Q
"RTN","TIUSRVR2",102,0)
 ;
"RTN","TIUSRVR2",103,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUSRVR2",104,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",105,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUSRVR2",106,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUSRVR2",107,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUSRVR2",108,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUSRVR2",109,0)
 S TIUK=0
"RTN","TIUSRVR2",110,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUSRVR2",111,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUSRVR2",112,0)
 . D LOADID(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRVR2",113,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUSRVR2",114,0)
 Q
"RTN","TIUSRVR2",115,0)
 ;
"RTN","TIUSRVR2",116,0)
LOADID(TIUDA,TIUL,TIUGDATA,TIUWHOL) ; Load ID note for browse
"RTN","TIUSRVR2",117,0)
 N TIUREC,TIU
"RTN","TIUSRVR2",118,0)
 I '$D(^TIU(8925,+TIUDA,0)) Q
"RTN","TIUSRVR2",119,0)
 ; ---- If ID Kid has focus, don't show it again ----
"RTN","TIUSRVR2",120,0)
 ; I TIUDA=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",121,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",122,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR2",123,0)
 D INQUIRE(TIUDA,.TIUREC)
"RTN","TIUSRVR2",124,0)
 ; ---- Load info missing from header since this is ID note entry: ----
"RTN","TIUSRVR2",125,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUSRVR2",126,0)
 D LOADTOP^TIUSRVR1(.TIUREC,TIUDA,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",127,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUSRVR2",128,0)
 D LOADREC(TIUDA,.TIUL,$G(TIUGDATA),$G(TIUWHOL))
"RTN","TIUSRVR2",129,0)
 Q
"RTN","TIUSRVR2",130,0)
 ;
"RTN","TIUSRVR2",131,0)
INQUIRE(TIUDA,TIUREC,TIUCPF) ; Inquire to document TIUDA and set TIUREC
"RTN","TIUSRVR2",132,0)
 N DA,DIC,DIQ,DR
"RTN","TIUSRVR2",133,0)
 S DA=TIUDA,DIC=8925,DIQ="TIUREC("
"RTN","TIUSRVR2",134,0)
 S DR=".01;.02;.05;.09;1201;1202;1208;1209;1301;1307;1501;1502;1505;1506;89261"
"RTN","TIUSRVR2",135,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR2",136,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR2",137,0)
 I $G(TIUCPF) S DR=DR_";70201;70202"
"RTN","TIUSRVR2",138,0)
 D EN^DIQ1
"RTN","TIUSRVR2",139,0)
 Q
"RTN","TIUSRVR2",140,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRVR2",141,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,TIUVIEW
"RTN","TIUSRVR2",142,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",143,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUSRVR2",144,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUSRVR2",145,0)
 S TIUVIEW=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRVR2",146,0)
 I '+TIUVIEW D  Q
"RTN","TIUSRVR2",147,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(TIUVIEW,U,2)
"RTN","TIUSRVR2",148,0)
 S TIUJ=0
"RTN","TIUSRVR2",149,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRVR2",150,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRVR2",151,0)
 D LOADSIG^TIUSRVR3(TIUDADD,.TIUL)
"RTN","TIUSRVR2",152,0)
 Q
"RTN","TIUWRIIS")
0^7^B43880455^B41724372
"RTN","TIUWRIIS",1,0)
TIUWRIIS ;SLC/AJB,AGP - War Related Illness and Injury Study Center ; 08/18/03
"RTN","TIUWRIIS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**159,286**;Jun 20, 1997;Build 10
"RTN","TIUWRIIS",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","TIUWRIIS",4,0)
 ;
"RTN","TIUWRIIS",5,0)
 Q
"RTN","TIUWRIIS",6,0)
ADDRESS(DFN) ;
"RTN","TIUWRIIS",7,0)
 N TIUCNT,TIUI,TIUY,VAPA S TIUI=0
"RTN","TIUWRIIS",8,0)
 N TIUCITY,TIUST,TIUZIP
"RTN","TIUWRIIS",9,0)
 D ADD^VADPT
"RTN","TIUWRIIS",10,0)
 S TIUY=$NA(^TMP("TIUWRIISC",$J))
"RTN","TIUWRIIS",11,0)
 F TIUCNT=1:1:3 D
"RTN","TIUWRIIS",12,0)
 . Q:VAPA(TIUCNT)=""
"RTN","TIUWRIIS",13,0)
 . S TIUI=TIUI+1
"RTN","TIUWRIIS",14,0)
 . S @TIUY@(TIUI,0)=VAPA(TIUCNT) I TIUCNT>1 S @TIUY@(TIUI,0)="             "_@TIUY@(TIUI,0)
"RTN","TIUWRIIS",15,0)
 S TIUCITY="             "_VAPA(4)
"RTN","TIUWRIIS",16,0)
 S TIUST=$$GET1^DIQ(5,+VAPA(5),1)
"RTN","TIUWRIIS",17,0)
 S TIUZIP=VAPA(6)
"RTN","TIUWRIIS",18,0)
 ;286 - Format address for Philippines
"RTN","TIUWRIIS",19,0)
 I +VAPA(25)=167 D
"RTN","TIUWRIIS",20,0)
 . S TIUST=VAPA(23)
"RTN","TIUWRIIS",21,0)
 . S TIUZIP=VAPA(24)
"RTN","TIUWRIIS",22,0)
 S @TIUY@(4,0)=TIUCITY_", "_TIUST_"  "_TIUZIP
"RTN","TIUWRIIS",23,0)
 Q "~@"_$NA(@TIUY)
"RTN","TIUWRIIS",24,0)
LAB2(DFN,TIUTEST,COUNT,TPERIOD,TIUEDT,TIULDT) ; Get Lab Results
"RTN","TIUWRIIS",25,0)
 N CNT,DRANGE,INDATE,LABIEN,NUM,OUTPUT,REGDATE,SEQ,SEQ1,SUB,STRING
"RTN","TIUWRIIS",26,0)
 N TIULOUT,TIUY,TIUTST,TIUX,TMP1,TMP2
"RTN","TIUWRIIS",27,0)
 K ^TMP($J,"TIUWRIIS","LABOUT"),^TMP("LRRR",$J)
"RTN","TIUWRIIS",28,0)
 I $G(TPERIOD)="",$G(TIUEDT)="",$G(TIULDT)="" Q "<Invalid Date or Time Period Entered>"
"RTN","TIUWRIIS",29,0)
 I ($G(TPERIOD)?1"T-"1N.N) D
"RTN","TIUWRIIS",30,0)
 . S TIULDT=$$NOW^XLFDT D DT^DILF("P",TPERIOD,.DRANGE) S TIUEDT=$G(DRANGE)
"RTN","TIUWRIIS",31,0)
 I $G(COUNT)="" S COUNT=1
"RTN","TIUWRIIS",32,0)
 I $G(TIUTEST)="" Q "LAB NAME NOT FOUND"
"RTN","TIUWRIIS",33,0)
 S LABIEN=+$O(^LAB(60,"B",TIUTEST,0))
"RTN","TIUWRIIS",34,0)
 I '+$G(LABIEN) Q "INVALID LAB TEST NAME"
"RTN","TIUWRIIS",35,0)
 D RR^LR7OR1(DFN,"",$G(TIUEDT),$G(TIULDT),"",LABIEN,"",$G(COUNT),"",0)
"RTN","TIUWRIIS",36,0)
 I '$D(^TMP("LRRR",$J)) Q "No Lab Information Found for "_TIUTEST
"RTN","TIUWRIIS",37,0)
 S TIULOUT="^TMP($J,""TIUWRIIS"",""LABOUT"")",CNT=1,@TIULOUT@(CNT,0)="Lab Information for "_TIUTEST
"RTN","TIUWRIIS",38,0)
 S STRING=$$LJ^XLFSTR("Collection Date/Time",25),STRING=STRING_$$LJ^XLFSTR("Specimen",10)
"RTN","TIUWRIIS",39,0)
 S STRING=STRING_$$LJ^XLFSTR("Test",8),STRING=STRING_$$LJ^XLFSTR("Result",12)
"RTN","TIUWRIIS",40,0)
 S STRING=STRING_$$LJ^XLFSTR("Range",10),CNT=CNT+1,@TIULOUT@(CNT,0)=STRING
"RTN","TIUWRIIS",41,0)
 S SUB="" F  S SUB=$O(^TMP("LRRR",$J,DFN,SUB)) Q:SUB=""  D
"RTN","TIUWRIIS",42,0)
 . S INDATE=""  F  S INDATE=$O(^TMP("LRRR",$J,DFN,SUB,INDATE)) Q:+INDATE'>0  D
"RTN","TIUWRIIS",43,0)
 . . S SEQ="" F  S SEQ=$O(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ)) Q:SEQ=""  D
"RTN","TIUWRIIS",44,0)
 . . . I SEQ'="N" D
"RTN","TIUWRIIS",45,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",46,0)
 . . . . S REGDATE=$$FMTE^XLFDT(9999999-INDATE)
"RTN","TIUWRIIS",47,0)
 . . . . S NODE=$G(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ))
"RTN","TIUWRIIS",48,0)
 . . . . S STRING=$$LJ^XLFSTR(REGDATE,25)
"RTN","TIUWRIIS",49,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($$GET1^DIQ(61,$P($G(NODE),U,19)_",",.01),10)
"RTN","TIUWRIIS",50,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,15),8)
"RTN","TIUWRIIS",51,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,2)_" "_$P($G(NODE),U,3)_$P($G(NODE),U,4),12)
"RTN","TIUWRIIS",52,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,5),10)
"RTN","TIUWRIIS",53,0)
 . . . . S @TIULOUT@(CNT,0)=STRING
"RTN","TIUWRIIS",54,0)
 . . . I SEQ="N" S SEQ1="" F  S SEQ1=$O(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ,SEQ1)) Q:+SEQ1'>0  D
"RTN","TIUWRIIS",55,0)
 . . . . S NODE=$G(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ,SEQ1))
"RTN","TIUWRIIS",56,0)
 . . . . I $G(NODE)["[" D
"RTN","TIUWRIIS",57,0)
 . . . . . S NAME=$P($G(NODE),"[",2),NAME=$P($G(NAME),"]",1)
"RTN","TIUWRIIS",58,0)
 . . . . . S NAME=$$GET1^DIQ(200,$G(NAME)_",",.01)
"RTN","TIUWRIIS",59,0)
 . . . . . S TMP1=$P($G(NODE),"["),TMP2=$P($G(NODE),"]",2)
"RTN","TIUWRIIS",60,0)
 . . . . . S NODE=TMP1_" "_NAME_" "_TMP2
"RTN","TIUWRIIS",61,0)
 . . . . S CNT=CNT+1,@TIULOUT@(CNT,0)="Comment: "_NODE
"RTN","TIUWRIIS",62,0)
 K ^TMP("LRRR",$J)
"RTN","TIUWRIIS",63,0)
LABQ Q "~@"_$NA(@TIULOUT)
"RTN","TIUWRIIS",64,0)
PNOK(DFN) ;
"RTN","TIUWRIIS",65,0)
 N CNT,PNOK,VAOA
"RTN","TIUWRIIS",66,0)
 K ^TMP($J,"TIUWRIIS","PNOK")
"RTN","TIUWRIIS",67,0)
 D OAD^VADPT
"RTN","TIUWRIIS",68,0)
 S CNT=1
"RTN","TIUWRIIS",69,0)
 S PNOK="^TMP($J,""TIUWRIIS"",""PNOK"")"
"RTN","TIUWRIIS",70,0)
 I $D(VAOA) D
"RTN","TIUWRIIS",71,0)
 . S @PNOK@(CNT,0)="Primary Next of Kin Information"
"RTN","TIUWRIIS",72,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",73,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(9))'="":$G(VAOA(9)),1:"No Next of Kin Enter")
"RTN","TIUWRIIS",74,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",75,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(10))'="":"Relationship to Patient: "_VAOA(10),1:"Relationship Unknown")
"RTN","TIUWRIIS",76,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",77,0)
 . I $G(VAOA(1))=""&($G(VAOA(2))="")&($G(VAOA(3))="") S @PNOK@(CNT,0)="No Address Information Enter"
"RTN","TIUWRIIS",78,0)
 . E  D
"RTN","TIUWRIIS",79,0)
 . . S @PNOK@(CNT,0)=$G(VAOA(1))
"RTN","TIUWRIIS",80,0)
 . . I $G(VAOA(2))'="" S @PNOK@(CNT,0)=@PNOK@(CNT,0)_" "_VAOA(2)
"RTN","TIUWRIIS",81,0)
 . . I $G(VAOA(3))'="" S CNT=CNT+1 S @PNOK@(CNT,0)=VAOA(3)
"RTN","TIUWRIIS",82,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",83,0)
 . I $G(VAOA(4))'="" S @PNOK@(CNT,0)=$G(VAOA(4))_", "_$P($G(VAOA(5)),U,2)_" "_$G(VAOA(6))
"RTN","TIUWRIIS",84,0)
 . I $G(VAOA(8))'="" S CNT=CNT+1 S @PNOK@(CNT,0)="Home Phone Number: "_VAOA(8)
"RTN","TIUWRIIS",85,0)
 E  Q "No Next Kin Information Found"
"RTN","TIUWRIIS",86,0)
 Q "~@"_$NA(@PNOK)
"RTN","TIUWRIIS",87,0)
 ;
"RTN","TIUWRIIS",88,0)
SNOK(DFN) ;
"RTN","TIUWRIIS",89,0)
 N CNT,VAOA
"RTN","TIUWRIIS",90,0)
 K ^TMP($J,"TIUWRIIS","SNOK")
"RTN","TIUWRIIS",91,0)
 S VAOA("A")=3
"RTN","TIUWRIIS",92,0)
 D OAD^VADPT
"RTN","TIUWRIIS",93,0)
 S CNT=1
"RTN","TIUWRIIS",94,0)
 S PNOK="^TMP($J,""TIUWRIIS"",""SNOK"")"
"RTN","TIUWRIIS",95,0)
 I $D(VAOA) D
"RTN","TIUWRIIS",96,0)
 . S @PNOK@(CNT,0)="Secondary Next of Kin Information"
"RTN","TIUWRIIS",97,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",98,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(9))'="":$G(VAOA(9)),1:"No Next of Kin Enter")
"RTN","TIUWRIIS",99,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",100,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(10))'="":"Relationship to Patient: "_VAOA(10),1:"Relationship Unknown")
"RTN","TIUWRIIS",101,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",102,0)
 . I $G(VAOA(1))=""&($G(VAOA(2))="")&($G(VAOA(3))="") S @PNOK@(CNT,0)="No Address Information Enter"
"RTN","TIUWRIIS",103,0)
 . E  D
"RTN","TIUWRIIS",104,0)
 . . S @PNOK@(CNT,0)=$G(VAOA(1))
"RTN","TIUWRIIS",105,0)
 . . I $G(VAOA(2))'="" S @PNOK@(CNT,0)=@PNOK@(CNT,0)_" "_VAOA(2)
"RTN","TIUWRIIS",106,0)
 . . I $G(VAOA(3))'="" S CNT=CNT+1 S @PNOK@(CNT,0)=VAOA(3)
"RTN","TIUWRIIS",107,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",108,0)
 . I $G(VAOA(4))'="" S @PNOK@(CNT,0)=$G(VAOA(4))_", "_$P($G(VAOA(5)),U,2)_" "_$G(VAOA(6))
"RTN","TIUWRIIS",109,0)
 . I $G(VAOA(8))'="" S CNT=CNT+1 S @PNOK@(CNT,0)="Home Phone Number: "_VAOA(8)
"RTN","TIUWRIIS",110,0)
 E  Q "No Next Kin Information Found"
"RTN","TIUWRIIS",111,0)
 Q "~@"_$NA(@PNOK)
"RTN","TIUWRIIS",112,0)
 ;
"RTN","TIUWRIIS",113,0)
VITALS(DFN,TEST,COUNT,TPERIOD) ; Return vitals for last 24 hours.
"RTN","TIUWRIIS",114,0)
 N %,CNT,DATE,END,GMRVSTR,IEN,INVDATE,NODE,START,TIUVITAL,VITAL,VITALS
"RTN","TIUWRIIS",115,0)
 K ^TMP($J,"TIUWRIIS","VITALS")
"RTN","TIUWRIIS",116,0)
 K ^UTILITY($J,"GMRVD")
"RTN","TIUWRIIS",117,0)
 I ($G(TPERIOD)?1"T-"1N.N) D
"RTN","TIUWRIIS",118,0)
 . D NOW^%DTC S END=%
"RTN","TIUWRIIS",119,0)
 . D DT^DILF("P",TPERIOD,.DRANGE)
"RTN","TIUWRIIS",120,0)
 . S START=$G(DRANGE)_"."_$P(END,".",2)
"RTN","TIUWRIIS",121,0)
 E  I $G(TPERIOD)'="" Q "INVALID DATE TIME PERIOD ENTER"
"RTN","TIUWRIIS",122,0)
 S CNT=1
"RTN","TIUWRIIS",123,0)
 S DATE=0
"RTN","TIUWRIIS",124,0)
 S TIUVITAL="^TMP($J,""TIUWRIIS"",""VITALS"")"
"RTN","TIUWRIIS",125,0)
 S GMRVSTR=$G(TEST)
"RTN","TIUWRIIS",126,0)
 S GMRVSTR(0)=START_U_END_U_COUNT_U_"1"
"RTN","TIUWRIIS",127,0)
 D EN1^GMRVUT0
"RTN","TIUWRIIS",128,0)
 I '$D(^UTILITY($J,"GMRVD")) S @TIUVITAL@(CNT,0)="No Vitals Were Found" Q "~@"_$NA(@TIUVITAL)
"RTN","TIUWRIIS",129,0)
 S INVDATE="" F  S INVDATE=$O(^UTILITY($J,"GMRVD",INVDATE)) Q:+INVDATE=0  D
"RTN","TIUWRIIS",130,0)
 . S VITAL="" F  S VITAL=$O(^UTILITY($J,"GMRVD",INVDATE,VITAL)) Q:VITAL=""  D
"RTN","TIUWRIIS",131,0)
 . .S IEN="" F  S IEN=$O(^UTILITY($J,"GMRVD",INVDATE,VITAL,IEN)) Q:+IEN=0  D
"RTN","TIUWRIIS",132,0)
 . . . S NODE=^UTILITY($J,"GMRVD",INVDATE,VITAL,IEN)
"RTN","TIUWRIIS",133,0)
 . . . I DATE'=INVDATE D  Q
"RTN","TIUWRIIS",134,0)
 . . . . S @TIUVITAL@(CNT,0)="Vitals Enter at: "_$$FMTE^XLFDT(9999999-INVDATE)
"RTN","TIUWRIIS",135,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",136,0)
 . . . . S DATE=INVDATE
"RTN","TIUWRIIS",137,0)
 . . . . S @TIUVITAL@(CNT,0)=VITAL_": "_$P($G(NODE),U,8)
"RTN","TIUWRIIS",138,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",139,0)
 . . . I DATE=INVDATE D
"RTN","TIUWRIIS",140,0)
 . . . . S @TIUVITAL@(CNT,0)=VITAL_": "_$P($G(NODE),U,8)
"RTN","TIUWRIIS",141,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",142,0)
 K ^UTILITY($J,"GMRVD")
"RTN","TIUWRIIS",143,0)
 Q "~@"_$NA(@TIUVITAL)
"RTN","TIUWRIIS",144,0)
PROB(DFN) ; Get total active problem list for a patient
"RTN","TIUWRIIS",145,0)
 N CNT,CNT1,ROOT,NODE,STRING,TIUPOUT
"RTN","TIUWRIIS",146,0)
 K ^TMP($J,"TIUWRIIS","PROB")
"RTN","TIUWRIIS",147,0)
 S TIUPOUT="^TMP($J,""TIUWRIIS"",""PROB"")"
"RTN","TIUWRIIS",148,0)
 S CNT1=1
"RTN","TIUWRIIS",149,0)
 D LIST^GMPLUTL2(.ROOT,+DFN,"A")
"RTN","TIUWRIIS",150,0)
 I '$D(ROOT) Q "No Active Problem Found"
"RTN","TIUWRIIS",151,0)
 S @TIUPOUT@(CNT1,0)=$$LJ^XLFSTR("Code",10)_$$LJ^XLFSTR("Description",63) S CNT1=CNT1+1
"RTN","TIUWRIIS",152,0)
 S CNT=0 F  S CNT=$O(ROOT(CNT)) Q:'CNT  D
"RTN","TIUWRIIS",153,0)
 . S NODE=$G(ROOT(CNT)) Q:$P($G(NODE),U,10)["$"!($P($G(NODE),U,3)="")
"RTN","TIUWRIIS",154,0)
 . S STRING=$$LJ^XLFSTR($P($G(NODE),U,4),10)_$P($G(NODE),U,3)
"RTN","TIUWRIIS",155,0)
 . S @TIUPOUT@(CNT1,0)=STRING
"RTN","TIUWRIIS",156,0)
 . S CNT1=CNT1+1
"RTN","TIUWRIIS",157,0)
 Q "~@"_$NA(@TIUPOUT)
"VER")
8.0^22.0
"BLD",9723,6)
^268
**END**
**END**

