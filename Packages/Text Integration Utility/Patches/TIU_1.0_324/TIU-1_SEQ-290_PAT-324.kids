Released TIU*1*324 SEQ #290
Extracted from mail message
**KIDS**:TIU*1.0*324^

**INSTALL NAME**
TIU*1.0*324
"BLD",11147,0)
TIU*1.0*324^TEXT INTEGRATION UTILITIES^0^3190531^y
"BLD",11147,1,0)
^^1^1^3190430^
"BLD",11147,1,1,0)
TIU TEXT ALERT ISSUES
"BLD",11147,4,0)
^9.64PA^8925.71^1
"BLD",11147,4,8925.71,0)
8925.71
"BLD",11147,4,8925.71,222)
y^y^f^^^^n
"BLD",11147,4,"B",8925.71,8925.71)

"BLD",11147,6)
1^
"BLD",11147,6.3)
4
"BLD",11147,"ABPKG")
n
"BLD",11147,"KRN",0)
^9.67PA^1.5^24
"BLD",11147,"KRN",.4,0)
.4
"BLD",11147,"KRN",.401,0)
.401
"BLD",11147,"KRN",.402,0)
.402
"BLD",11147,"KRN",.402,"NM",0)
^9.68A^^
"BLD",11147,"KRN",.403,0)
.403
"BLD",11147,"KRN",.5,0)
.5
"BLD",11147,"KRN",.84,0)
.84
"BLD",11147,"KRN",1.5,0)
1.5
"BLD",11147,"KRN",1.6,0)
1.6
"BLD",11147,"KRN",1.61,0)
1.61
"BLD",11147,"KRN",1.62,0)
1.62
"BLD",11147,"KRN",3.6,0)
3.6
"BLD",11147,"KRN",3.8,0)
3.8
"BLD",11147,"KRN",9.2,0)
9.2
"BLD",11147,"KRN",9.8,0)
9.8
"BLD",11147,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11147,"KRN",9.8,"NM",1,0)
TIUTIUS^^0^B38570158
"BLD",11147,"KRN",9.8,"NM","B","TIUTIUS",1)

"BLD",11147,"KRN",19,0)
19
"BLD",11147,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",11147,"KRN",19,"NM",1,0)
TIU TEXT EVENT EDIT^^0
"BLD",11147,"KRN",19,"NM","B","TIU TEXT EVENT EDIT",1)

"BLD",11147,"KRN",19.1,0)
19.1
"BLD",11147,"KRN",101,0)
101
"BLD",11147,"KRN",409.61,0)
409.61
"BLD",11147,"KRN",771,0)
771
"BLD",11147,"KRN",779.2,0)
779.2
"BLD",11147,"KRN",870,0)
870
"BLD",11147,"KRN",8989.51,0)
8989.51
"BLD",11147,"KRN",8989.52,0)
8989.52
"BLD",11147,"KRN",8994,0)
8994
"BLD",11147,"KRN","B",.4,.4)

"BLD",11147,"KRN","B",.401,.401)

"BLD",11147,"KRN","B",.402,.402)

"BLD",11147,"KRN","B",.403,.403)

"BLD",11147,"KRN","B",.5,.5)

"BLD",11147,"KRN","B",.84,.84)

"BLD",11147,"KRN","B",1.5,1.5)

"BLD",11147,"KRN","B",1.6,1.6)

"BLD",11147,"KRN","B",1.61,1.61)

"BLD",11147,"KRN","B",1.62,1.62)

"BLD",11147,"KRN","B",3.6,3.6)

"BLD",11147,"KRN","B",3.8,3.8)

"BLD",11147,"KRN","B",9.2,9.2)

"BLD",11147,"KRN","B",9.8,9.8)

"BLD",11147,"KRN","B",19,19)

"BLD",11147,"KRN","B",19.1,19.1)

"BLD",11147,"KRN","B",101,101)

"BLD",11147,"KRN","B",409.61,409.61)

"BLD",11147,"KRN","B",771,771)

"BLD",11147,"KRN","B",779.2,779.2)

"BLD",11147,"KRN","B",870,870)

"BLD",11147,"KRN","B",8989.51,8989.51)

"BLD",11147,"KRN","B",8989.52,8989.52)

"BLD",11147,"KRN","B",8994,8994)

"BLD",11147,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11147,"QUES",0)
^9.62^^
"BLD",11147,"REQB",0)
^9.611^1^1
"BLD",11147,"REQB",1,0)
TIU*1.0*296^2
"BLD",11147,"REQB","B","TIU*1.0*296",1)

"FIA",8925.71)
TIU TEXT EVENTS
"FIA",8925.71,0)
^TIU(8925.71,
"FIA",8925.71,0,0)
8925.71
"FIA",8925.71,0,1)
y^y^f^^^^n
"FIA",8925.71,0,10)

"FIA",8925.71,0,11)

"FIA",8925.71,0,"RLRO")

"FIA",8925.71,0,"VR")
1.0^TIU
"FIA",8925.71,8925.71)
0
"FIA",8925.71,8925.714)
0
"FIA",8925.71,8925.715)
0
"IX",8925.71,8925.71,"AC",0)
8925.71^AC^Trigger search string text based on criteria^MU^^F^IR^I^8925.71^^^^^A
"IX",8925.71,8925.71,"AC",.1,0)
^^1^1^3150612^^^
"IX",8925.71,8925.71,"AC",.1,1,0)
Trigger search string text based on criteria
"IX",8925.71,8925.71,"AC",1)
N AUMTX,FDA S AUMTX=X S:'X2(2) AUMTX=$$LOW^XLFSTR(AUMTX) S:'X2(3) AUMTX=$TR(AUMTX," ","") S FDA(1,8925.71,DA_",",3)=AUMTX D FILE^DIE("","FDA(1)","AUMTERR(1)")
"IX",8925.71,8925.71,"AC",2)
Q
"IX",8925.71,8925.71,"AC",2.5)
Q
"IX",8925.71,8925.71,"AC",11.1,0)
^.114IA^^
"KRN",19,2921723,-1)
0^1
"KRN",19,2921723,0)
TIU TEXT EVENT EDIT^Text Event Edit^^E^^^^^^^^^^1^1
"KRN",19,2921723,1,0)
^19.06^1^1^3190430^^^^
"KRN",19,2921723,1,1,0)
This option edits the TIU TEXT EVENT file for the text event alert.
"KRN",19,2921723,15)
K DIDEL,TIUX
"KRN",19,2921723,20)
S (DLAYGO,DIDEL)=8925.71
"KRN",19,2921723,30)
TIU(8925.71,
"KRN",19,2921723,31)
AELMQ
"KRN",19,2921723,50)
TIU(8925.71,
"KRN",19,2921723,51)
S DIDEL=8925.71;.01;.02;1;S TIUX=X;I TIUX="",$G(^TIU(8925.71,DA,1))="",$G(^(3))]"" S TIUX="@";3///^S X=TIUX;2;2.1;4;5;5.1;S DLAYGO=8925.71
"KRN",19,2921723,52)
DR
"KRN",19,2921723,53)
N
"KRN",19,2921723,"U")
TEXT EVENT EDIT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",588,-1)
1^1
"PKG",588,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",588,22,0)
^9.49I^1^1
"PKG",588,22,1,0)
1.0^2970620^2971202^1
"PKG",588,22,1,"PAH",1,0)
324^3190531^520824660
"PKG",588,22,1,"PAH",1,1,0)
^^1^1^3190531
"PKG",588,22,1,"PAH",1,1,1,0)
TIU TEXT ALERT ISSUES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","TIUTIUS")
0^1^B38570158^B33045323
"RTN","TIUTIUS",1,0)
TIUTIUS ; MILW/JMC - Functions to search TIU documents; May 24, 2006 ; 2/16/16 1:49pm
"RTN","TIUTIUS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**296,324**;JUN 20, 1997;Build 4;Build 13
"RTN","TIUTIUS",3,0)
 ;
"RTN","TIUTIUS",4,0)
 ;
"RTN","TIUTIUS",5,0)
TASK(AUMTDA) ; Task searching of document for specified text
"RTN","TIUTIUS",6,0)
 N AUMTADD,I,ZTDESC,ZTDTH,ZTRTN,ZTIO,ZTSAVE,X,ZTSK
"RTN","TIUTIUS",7,0)
 I $G(AUMTDA)<1 Q
"RTN","TIUTIUS",8,0)
 ;
"RTN","TIUTIUS",9,0)
 ; Check if document is an addendum
"RTN","TIUTIUS",10,0)
 S AUMTADD=+$$ISADDNDM^TIULC1(AUMTDA)
"RTN","TIUTIUS",11,0)
 ;
"RTN","TIUTIUS",12,0)
 ; If original don't check if cosigned and signer different than cosigner - was checked when signed.
"RTN","TIUTIUS",13,0)
 F I=0,15 S X(I)=$G(^TIU(8925,AUMTDA,I))
"RTN","TIUTIUS",14,0)
 I 'AUMTADD,$P(X(15),"^",8),$P(X(15),"^",2),$P(X(15),"^",8)'=$P(X(15),"^",2) Q
"RTN","TIUTIUS",15,0)
 ; If addendum and not complete then don't check.
"RTN","TIUTIUS",16,0)
 I AUMTADD,$P(X(0),"^",5)'=7 Q
"RTN","TIUTIUS",17,0)
 ;
"RTN","TIUTIUS",18,0)
 ; TIU*1.0*324 Pass AUMTADD
"RTN","TIUTIUS",19,0)
 S ZTDTH=$H,ZTIO="",ZTSAVE("AUMTDA")="",ZTSAVE("AUMTADD")=""
"RTN","TIUTIUS",20,0)
 S ZTRTN="DQ^TIUTIUS",ZTDESC="Search TIU document for specified text"
"RTN","TIUTIUS",21,0)
 ; TIU 324 TESTING
"RTN","TIUTIUS",22,0)
 D ^%ZTLOAD
"RTN","TIUTIUS",23,0)
 ; TIU*1.0*324 Call in foreground of it failed to queue
"RTN","TIUTIUS",24,0)
 I '$D(ZTSK) D DQ^TIUTIUS
"RTN","TIUTIUS",25,0)
 Q
"RTN","TIUTIUS",26,0)
 ;
"RTN","TIUTIUS",27,0)
 ;
"RTN","TIUTIUS",28,0)
DQ ; Tasked entry point to search TIU document for specified text 
"RTN","TIUTIUS",29,0)
 ; that should generate an alert to appropriate CPRS team.
"RTN","TIUTIUS",30,0)
 ;
"RTN","TIUTIUS",31,0)
 N AUMTI,AUMTJ,AUMTK,AUMTMSPT,AUMTXT,AUMTVL,AUMTVLS,AUMTXQA,X,X0,X1,Y,AUMTZ,AUMPRT
"RTN","TIUTIUS",32,0)
 ;
"RTN","TIUTIUS",33,0)
 I '$D(^TIU(8925,AUMTDA,0)) Q
"RTN","TIUTIUS",34,0)
 ;
"RTN","TIUTIUS",35,0)
 ; Get visit location
"RTN","TIUTIUS",36,0)
 ; TIU*1.0*324 Get location from parent if an addendum
"RTN","TIUTIUS",37,0)
 I AUMTADD D
"RTN","TIUTIUS",38,0)
 . S AUMTVL=+$P($G(^TIU(8925,AUMTDA,12)),"^",11)
"RTN","TIUTIUS",39,0)
 . I 'AUMTVL D
"RTN","TIUTIUS",40,0)
 . . S AUMPRT=$P(^TIU(8925,AUMTDA,0),U,6)
"RTN","TIUTIUS",41,0)
 . . S AUMTVL=+$P($G(^TIU(8925,AUMPRT,12)),"^",11)
"RTN","TIUTIUS",42,0)
 E  S AUMTVL=+$P($G(^TIU(8925,AUMTDA,12)),"^",11)
"RTN","TIUTIUS",43,0)
 S AUMTVL(0)=$$GET1^DIQ(44,AUMTVL_",",.01)
"RTN","TIUTIUS",44,0)
 ;
"RTN","TIUTIUS",45,0)
 ; Setup array of text events to search in the document.
"RTN","TIUTIUS",46,0)
 S AUMTI=0
"RTN","TIUTIUS",47,0)
 F  S AUMTI=$O(^TIU(8925.71,AUMTI)) Q:'AUMTI  D
"RTN","TIUTIUS",48,0)
 . I '$P(^TIU(8925.71,AUMTI,0),"^",2) Q
"RTN","TIUTIUS",49,0)
 . S X=$G(^TIU(8925.71,AUMTI,3))
"RTN","TIUTIUS",50,0)
 . I X="" Q
"RTN","TIUTIUS",51,0)
 . ; TIU*1.0*324 these parameters no longer used
"RTN","TIUTIUS",52,0)
 . ;S AUMTXT(AUMTI)=$P(^TIU(8925.71,AUMTI,0),"^",3,4)
"RTN","TIUTIUS",53,0)
 . ; TIU*1.0*324 Compare Visit Search String in upper case only
"RTN","TIUTIUS",54,0)
 . S AUMTVLS=$$UPPER^TIULS($P(^TIU(8925.71,AUMTI,0),"^",5))
"RTN","TIUTIUS",55,0)
 . ; TIU*1.0*324 not case sensitive and remove spaces
"RTN","TIUTIUS",56,0)
 . S X=$$LOW^XLFSTR(X),X=$TR(X," ","") S AUMTXT(AUMTI,"T")=X
"RTN","TIUTIUS",57,0)
 . ; visit location or visit location string defined
"RTN","TIUTIUS",58,0)
 . I $O(^TIU(8925.71,AUMTI,5,0))!(AUMTVLS'="") D
"RTN","TIUTIUS",59,0)
 . . I $D(^TIU(8925.71,AUMTI,5,"B",AUMTVL)) S AUMTXT(AUMTI,"VL")="" Q
"RTN","TIUTIUS",60,0)
 . . I AUMTVLS'="",AUMTVL(0)[AUMTVLS S AUMTXT(AUMTI,"VL")="" Q
"RTN","TIUTIUS",61,0)
 . . K AUMTXT(AUMTI)
"RTN","TIUTIUS",62,0)
 ;
"RTN","TIUTIUS",63,0)
 ; TIU*1.0*324 - Removing this logic so all alerts setup are sent even 
"RTN","TIUTIUS",64,0)
 ; for the same search text
"RTN","TIUTIUS",65,0)
 ; Check if same alert text is for two or more events and one of the
"RTN","TIUTIUS",66,0)
 ; events is for this document's visit location then check for specific
"RTN","TIUTIUS",67,0)
 ; location event text and suppress the general event.
"RTN","TIUTIUS",68,0)
 ;S AUMTI=0
"RTN","TIUTIUS",69,0)
 ;F  S AUMTI=$O(AUMTXT(AUMTI)) Q:'AUMTI  D
"RTN","TIUTIUS",70,0)
 ;. I '$D(AUMTXT(AUMTI,"VL")) Q
"RTN","TIUTIUS",71,0)
 ;. S AUMTK=0
"RTN","TIUTIUS",72,0)
 ;. F  S AUMTK=$O(AUMTXT(AUMTK)) Q:'AUMTK  D
"RTN","TIUTIUS",73,0)
 ;. . I AUMTK=AUMTI!($D(AUMTXT(AUMTK,"VL"))) Q
"RTN","TIUTIUS",74,0)
 ;. . I AUMTXT(AUMTK,"T")=AUMTXT(AUMTI,"T") K AUMTXT(AUMTK)
"RTN","TIUTIUS",75,0)
 ;
"RTN","TIUTIUS",76,0)
 ; If no active text events then quit
"RTN","TIUTIUS",77,0)
 I '$D(AUMTXT) Q
"RTN","TIUTIUS",78,0)
 ;
"RTN","TIUTIUS",79,0)
 ; Search the current and preceeding line for matching text, deal with
"RTN","TIUTIUS",80,0)
 ; text that spans two lines.
"RTN","TIUTIUS",81,0)
 ; Skip the event if we've already found a match on a given text event.
"RTN","TIUTIUS",82,0)
 ; TIU*1.0*324 - REWRITE THIS CODE
"RTN","TIUTIUS",83,0)
 ;S AUMTI=0,X1=""
"RTN","TIUTIUS",84,0)
 ;F  S AUMTI=$O(^TIU(8925,AUMTDA,"TEXT",AUMTI)) Q:'AUMTI  D
"RTN","TIUTIUS",85,0)
 ;. S X0=X1,X1=^TIU(8925,AUMTDA,"TEXT",AUMTI,0)
"RTN","TIUTIUS",86,0)
 ;. S X=X0_X1
"RTN","TIUTIUS",87,0)
 ;. S AUMTJ=0
"RTN","TIUTIUS",88,0)
 ;. F  S AUMTJ=$O(AUMTXT(AUMTJ)) Q:AUMTJ=""  I '$D(AUMTXQA(AUMTJ)) D
"RTN","TIUTIUS",89,0)
 ;. . S Y=X
"RTN","TIUTIUS",90,0)
 ;. . S Y=$$LOW^XLFSTR(Y)
"RTN","TIUTIUS",91,0)
 ;. . I '$P(AUMTXT(AUMTJ),"^",2) S Y=$TR(Y," ","")
"RTN","TIUTIUS",92,0)
 ;. . S AUMTZ=0 F  S AUMTZ=$O(AUMTXT(AUMTZ)) Q:AUMTZ=""  S AUMTJ=AUMTZ D
"RTN","TIUTIUS",93,0)
 ;...I $G(Y)'="" S:Y[AUMTXT(AUMTJ,"T") AUMTXQA(AUMTJ)=AUMTJ
"RTN","TIUTIUS",94,0)
 ;
"RTN","TIUTIUS",95,0)
 ; TIU*1.0*324 REPLACEMENT CODE
"RTN","TIUTIUS",96,0)
 S AUMTI=0,X1=""
"RTN","TIUTIUS",97,0)
 F  S AUMTI=$O(^TIU(8925,AUMTDA,"TEXT",AUMTI)) Q:'AUMTI  D
"RTN","TIUTIUS",98,0)
 . S X1=X1_^TIU(8925,AUMTDA,"TEXT",AUMTI,0)
"RTN","TIUTIUS",99,0)
 S X1=$$LOW^XLFSTR(X1)
"RTN","TIUTIUS",100,0)
 ;strip out spaces (should all punctuation be stripped?
"RTN","TIUTIUS",101,0)
 S X1=$TR(X1," ",""),AUMTJ=0
"RTN","TIUTIUS",102,0)
 F  S AUMTJ=$O(AUMTXT(AUMTJ)) Q:AUMTJ=""  D
"RTN","TIUTIUS",103,0)
 . S:X1[AUMTXT(AUMTJ,"T") AUMTXQA(AUMTJ)=AUMTJ
"RTN","TIUTIUS",104,0)
 ; Send any alerts
"RTN","TIUTIUS",105,0)
 S AUMTZ=0 S AUMTZ=$O(AUMTXQA(AUMTZ)) D:AUMTZ'="" SENDXQA
"RTN","TIUTIUS",106,0)
 ;
"RTN","TIUTIUS",107,0)
 K AUMTDA
"RTN","TIUTIUS",108,0)
 Q
"RTN","TIUTIUS",109,0)
 ;
"RTN","TIUTIUS",110,0)
 ;
"RTN","TIUTIUS",111,0)
SENDXQA ; Send Kernel alert to appropriate team or team device 
"RTN","TIUTIUS",112,0)
 ;
"RTN","TIUTIUS",113,0)
 N AUMTHL,AUMTSKIP,AUMTEAM,AUMTI,AUMTJ,AUMTK,AUMTSA
"RTN","TIUTIUS",114,0)
 N DFN,TIU0,TIUPNM,TIUSSN,VA,XQA,XQADATA,XQAID,XQAMSG,XQAROU,XQATEXT
"RTN","TIUTIUS",115,0)
 ;
"RTN","TIUTIUS",116,0)
 S TIU0=$G(^TIU(8925,AUMTDA,0)),DFN=+$P(TIU0,U,2)
"RTN","TIUTIUS",117,0)
 S TIUPNM=$E($$PTNAME^TIULC1(DFN),1,9)
"RTN","TIUTIUS",118,0)
 D PID^VADPT6
"RTN","TIUTIUS",119,0)
 S TIUSSN=$E(TIUPNM,1)_VA("BID")
"RTN","TIUTIUS",120,0)
 ;
"RTN","TIUTIUS",121,0)
 ; Get hospital location for alert message text
"RTN","TIUTIUS",122,0)
 S AUMTHL=+$P($G(^TIU(8925,AUMTDA,12)),"^",5)
"RTN","TIUTIUS",123,0)
 S AUMTHL(0)=$$GET1^DIQ(44,AUMTHL_",",1)
"RTN","TIUTIUS",124,0)
 ;
"RTN","TIUTIUS",125,0)
 ; Send alert to each team's members and other additional recipients.
"RTN","TIUTIUS",126,0)
 S AUMTI=0
"RTN","TIUTIUS",127,0)
 F  S AUMTI=$O(AUMTXQA(AUMTI)) Q:AUMTI=""  D
"RTN","TIUTIUS",128,0)
 . K XQA,XQADATA,XQADFN,XQAID,XQAMSG,XQAROU,XQATEXT
"RTN","TIUTIUS",129,0)
 . S XQAID="TIUADD"_AUMTDA,XQADATA=AUMTDA_"^",XQAROU="ACTADD^TIUALRT"
"RTN","TIUTIUS",130,0)
 . S XQAMSG=TIUPNM_" ("_TIUSSN_"): ("_AUMTHL(0)_") "_$P($G(^TIU(8925.71,AUMTI,2)),"^")
"RTN","TIUTIUS",131,0)
 . S AUMTK=0
"RTN","TIUTIUS",132,0)
 . F  S AUMTK=$O(^TIU(8925.71,AUMTI,4,AUMTK)) Q:'AUMTK  D
"RTN","TIUTIUS",133,0)
 . . K AUMTEAM
"RTN","TIUTIUS",134,0)
 . . S AUMTEAM=+^TIU(8925.71,AUMTI,4,AUMTK,0)
"RTN","TIUTIUS",135,0)
 . . I AUMTEAM>0 D ADDTEAM(AUMTEAM)
"RTN","TIUTIUS",136,0)
 . D ADDRECP
"RTN","TIUTIUS",137,0)
 . I $D(XQA) D SETUP^XQALERT
"RTN","TIUTIUS",138,0)
 ;
"RTN","TIUTIUS",139,0)
 ; Send alert to signer that teams have been notified.
"RTN","TIUTIUS",140,0)
 I $D(AUMTSA) D SENDSA
"RTN","TIUTIUS",141,0)
 Q
"RTN","TIUTIUS",142,0)
 ;
"RTN","TIUTIUS",143,0)
 ;
"RTN","TIUTIUS",144,0)
SENDSA ; Build and sent alerts to signer
"RTN","TIUTIUS",145,0)
 ;
"RTN","TIUTIUS",146,0)
 N AUMTCNT,AUMTDUZ,AUMTI,AUMTMSG
"RTN","TIUTIUS",147,0)
 N XQA,XQADATA,XQADFN,XQAID,XQAMSG,XQAROU,XQATEXT
"RTN","TIUTIUS",148,0)
 ;
"RTN","TIUTIUS",149,0)
 S AUMTDUZ=+$P($G(^TIU(8925,AUMTDA,15)),"^",2)
"RTN","TIUTIUS",150,0)
 I 'AUMTDUZ Q
"RTN","TIUTIUS",151,0)
 S AUMTI=0,AUMTMSG="Alert(s) Sent: "
"RTN","TIUTIUS",152,0)
 F  S AUMTI=$O(AUMTSA(AUMTI)) Q:'AUMTI  S AUMTMSG=AUMTMSG_$P($G(^TIU(8925.71,AUMTI,2)),"^",2)_"," D
"RTN","TIUTIUS",153,0)
 . S XQAID="AUMTIU,"_AUMTDA
"RTN","TIUTIUS",154,0)
 . S XQAMSG=TIUPNM_" ("_TIUSSN_"): "_AUMTMSG
"RTN","TIUTIUS",155,0)
 . S XQA(AUMTDUZ)=""
"RTN","TIUTIUS",156,0)
 . D SETUP^XQALERT
"RTN","TIUTIUS",157,0)
 Q
"RTN","TIUTIUS",158,0)
 ;
"RTN","TIUTIUS",159,0)
 ;
"RTN","TIUTIUS",160,0)
SKIP() ; Check if we should skip alerting this team if they already have been sent an alert.
"RTN","TIUTIUS",161,0)
 ;
"RTN","TIUTIUS",162,0)
 N AUMTJ,AUMTSKIP
"RTN","TIUTIUS",163,0)
 S (AUMTJ,AUMTSKIP)=0
"RTN","TIUTIUS",164,0)
 F  S AUMTJ=$O(AUMTSA(AUMTJ)) Q:'AUMTJ!(AUMTJ>AUMTI)  D
"RTN","TIUTIUS",165,0)
 . I AUMTI'=AUMTJ,$D(AUMTSA(AUMTJ,AUMTEAM)) S AUMTSKIP=1 Q
"RTN","TIUTIUS",166,0)
 Q AUMTSKIP
"RTN","TIUTIUS",167,0)
 ;
"RTN","TIUTIUS",168,0)
 ;
"RTN","TIUTIUS",169,0)
ADDRECP ; Send to additional notification recipients.
"RTN","TIUTIUS",170,0)
 ; If no associate PC provider(3) then check and send to PC provider (1).
"RTN","TIUTIUS",171,0)
 ; If team (6) then check if patient is member of team.
"RTN","TIUTIUS",172,0)
 ; If PCP (7-19) checks for associated PCP in PATIENT file (#2) , fields 695021-695033
"RTN","TIUTIUS",173,0)
 ;
"RTN","TIUTIUS",174,0)
 N AUMTJ,AUMTK,AUMTL,AUMTX
"RTN","TIUTIUS",175,0)
 S (AUMTJ,AUMTK,AUMTL)=0
"RTN","TIUTIUS",176,0)
 F  S AUMTL=$O(^TIU(8925.71,AUMTI,4.5,AUMTL)) Q:'AUMTL  D
"RTN","TIUTIUS",177,0)
 . S AUMTL(0)=^TIU(8925.71,AUMTI,4.5,AUMTL,0)
"RTN","TIUTIUS",178,0)
 . S AUMTK=$P(AUMTL(0),"^")
"RTN","TIUTIUS",179,0)
 . I AUMTK<4 D  Q
"RTN","TIUTIUS",180,0)
 . . S AUMTJ=$$NMPCPR^SCAPMCU2(DFN,DT,AUMTK)
"RTN","TIUTIUS",181,0)
 . . I AUMTK=3,AUMTJ<1 S AUMTJ=$$NMPCPR^SCAPMCU2(DFN,DT,1)
"RTN","TIUTIUS",182,0)
 . . S:AUMTJ>0 XQA($P(AUMTJ,"^"))=""
"RTN","TIUTIUS",183,0)
 . I AUMTK>3,AUMTK<6 D  Q
"RTN","TIUTIUS",184,0)
 . . D ATTPRIM^ORQPTQ3(.AUMTX,DFN)
"RTN","TIUTIUS",185,0)
 . . I $P(AUMTX,";",AUMTK-3) S XQA($P($P(AUMTX,";",AUMTK-3),"^"))=""
"RTN","TIUTIUS",186,0)
 . I AUMTK=6 D CHKTEAM($P(AUMTL(0),"^",2)) Q
"RTN","TIUTIUS",187,0)
 . I AUMTK>6,AUMTK<20 D  Q
"RTN","TIUTIUS",188,0)
 . . S AUMTX=$G(^DPT(DFN,695002))
"RTN","TIUTIUS",189,0)
 . . I $P(AUMTX,"^",AUMTK-6) S XQA($P(AUMTX,"^",AUMTK-6))=""
"RTN","TIUTIUS",190,0)
 Q
"RTN","TIUTIUS",191,0)
 ;
"RTN","TIUTIUS",192,0)
 ;
"RTN","TIUTIUS",193,0)
CHKTEAM(AUMTEAM) ; Check if this patient is linked to this team
"RTN","TIUTIUS",194,0)
 ;
"RTN","TIUTIUS",195,0)
 ; Call with AUMTEAM = ien of team in file 100.21
"RTN","TIUTIUS",196,0)
 ;
"RTN","TIUTIUS",197,0)
 N I
"RTN","TIUTIUS",198,0)
 I '$D(AUMTMSPT) D TMSPT^ORQPTQ1(.AUMTMSPT,DFN)
"RTN","TIUTIUS",199,0)
 S I=0
"RTN","TIUTIUS",200,0)
 F  S I=$O(AUMTMSPT(I)) Q:'I  I $P(AUMTMSPT(I),"^")=AUMTEAM D ADDTEAM(AUMTEAM)
"RTN","TIUTIUS",201,0)
 Q
"RTN","TIUTIUS",202,0)
 ;
"RTN","TIUTIUS",203,0)
 ;
"RTN","TIUTIUS",204,0)
ADDTEAM(AUMTEAM) ; Add members of team to list of recipients
"RTN","TIUTIUS",205,0)
 ;
"RTN","TIUTIUS",206,0)
 ; Call with AUMTEAM = ien of team in file 100.21
"RTN","TIUTIUS",207,0)
 ;
"RTN","TIUTIUS",208,0)
 N AUMTD,AUMTDEV,AUMTJ
"RTN","TIUTIUS",209,0)
 ;I $$SKIP Q
"RTN","TIUTIUS",210,0)
 S AUMTD=$P($$TMDEV^ORB31(AUMTEAM),"^",2)
"RTN","TIUTIUS",211,0)
 I AUMTD'="" S AUMTDEV(AUMTD)="" D REGDEV^ORB31(.AUMTDEV)
"RTN","TIUTIUS",212,0)
 D TEAMPROV^ORQPTQ1(.AUMTEAM,AUMTEAM)
"RTN","TIUTIUS",213,0)
 I '$G(AUMTEAM(1)) Q
"RTN","TIUTIUS",214,0)
 S AUMTSA(AUMTI,AUMTEAM)=""
"RTN","TIUTIUS",215,0)
 S AUMTJ=0
"RTN","TIUTIUS",216,0)
 F  S AUMTJ=$O(AUMTEAM(AUMTJ)) Q:'AUMTJ  S XQA(+AUMTEAM(AUMTJ))=""
"RTN","TIUTIUS",217,0)
 Q
"SEC","^DIC",8925.71,8925.71,0,"AUDIT")
@
"SEC","^DIC",8925.71,8925.71,0,"DD")
@
"SEC","^DIC",8925.71,8925.71,0,"DEL")
@
"SEC","^DIC",8925.71,8925.71,0,"LAYGO")
@
"SEC","^DIC",8925.71,8925.71,0,"RD")
@
"SEC","^DIC",8925.71,8925.71,0,"WR")
@
"VER")
8.0^22.2
"^DD",8925.71,8925.71,0)
FIELD^^5.1^11
"^DD",8925.71,8925.71,0,"DDA")
N
"^DD",8925.71,8925.71,0,"DT")
3190502
"^DD",8925.71,8925.71,0,"IX","B",8925.71,.01)

"^DD",8925.71,8925.71,0,"NM","TIU TEXT EVENTS")

"^DD",8925.71,8925.71,0,"VRPK")
TIU
"^DD",8925.71,8925.71,.01,0)
NAME^RF^^0;1^K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",8925.71,8925.71,.01,1,0)
^.1
"^DD",8925.71,8925.71,.01,1,1,0)
8925.71^B
"^DD",8925.71,8925.71,.01,1,1,1)
S ^TIU(8925.71,"B",$E(X,1,30),DA)=""
"^DD",8925.71,8925.71,.01,1,1,2)
K ^TIU(8925.71,"B",$E(X,1,30),DA)
"^DD",8925.71,8925.71,.01,3)
Answer must be 3-60 characters in length.
"^DD",8925.71,8925.71,.01,21,0)
^^1^1^3150612^
"^DD",8925.71,8925.71,.01,21,1,0)
The name to identify this text search string.
"^DD",8925.71,8925.71,.01,"DT")
3150612
"^DD",8925.71,8925.71,.02,0)
STATUS^RS^0:INACTIVE;1:ACTIVE;^0;2^Q
"^DD",8925.71,8925.71,.02,3)
Enter a 1 to activate this search, or 0 to deactivate.
"^DD",8925.71,8925.71,.02,21,0)
^^1^1^3150612^
"^DD",8925.71,8925.71,.02,21,1,0)
Flag to determine if this entry should be searched in TIU documents.
"^DD",8925.71,8925.71,.02,"DT")
3160226
"^DD",8925.71,8925.71,.03,0)
CASE SENSITIVE^S^0:NO;1:YES;^0;3^Q
"^DD",8925.71,8925.71,.03,3)
Enter a 1 to make this search case sensitive.
"^DD",8925.71,8925.71,.03,21,0)
^^2^2^3190430^
"^DD",8925.71,8925.71,.03,21,1,0)
Indicates if searching for this text is case sensitive.
"^DD",8925.71,8925.71,.03,21,2,0)
This field is no longer used as of patch TIU*1.0*324
"^DD",8925.71,8925.71,.03,23,0)
^^3^3^3190430^
"^DD",8925.71,8925.71,.03,23,1,0)
This field is removed from being prompted for with patch TIU*1.0*324.  
"^DD",8925.71,8925.71,.03,23,2,0)
It's been determined that allowing the search to be case sensitive could 
"^DD",8925.71,8925.71,.03,23,3,0)
cause potential alerts to not be sent based only on the case.
"^DD",8925.71,8925.71,.03,"DT")
3190430
"^DD",8925.71,8925.71,.04,0)
INCLUDE SPACES^S^0:NO;1:YES;^0;4^Q
"^DD",8925.71,8925.71,.04,3)
Enter a 1 to strip the spaces from the text being searched.
"^DD",8925.71,8925.71,.04,21,0)
^^3^3^3190430^
"^DD",8925.71,8925.71,.04,21,1,0)
This field is no longer used as of patch TIU*1.0*324.
"^DD",8925.71,8925.71,.04,21,2,0)
Indicates if spaces should be stripped from text before searching
"^DD",8925.71,8925.71,.04,21,3,0)
for text string.
"^DD",8925.71,8925.71,.04,23,0)
^^4^4^3190430^
"^DD",8925.71,8925.71,.04,23,1,0)
This field is removed from being prompted for with patch TIU*1.0*324.  
"^DD",8925.71,8925.71,.04,23,2,0)
It's been determined that always removing spaces from both the search 
"^DD",8925.71,8925.71,.04,23,3,0)
text as well as the note text will increase the likelyhood of a desired 
"^DD",8925.71,8925.71,.04,23,4,0)
alert not being overlooked.
"^DD",8925.71,8925.71,.04,"DT")
3190430
"^DD",8925.71,8925.71,1,0)
TEXT TO SEARCH^F^^1;1^K:$L(X)>200!($L(X)<3) X
"^DD",8925.71,8925.71,1,3)
Answer must be 3-200 characters in length.
"^DD",8925.71,8925.71,1,21,0)
^^1^1^3150612^
"^DD",8925.71,8925.71,1,21,1,0)
Enter the text string to search for in the document.
"^DD",8925.71,8925.71,1,"DT")
3150612
"^DD",8925.71,8925.71,2,0)
ALERT MESSAGE^F^^2;1^K:$L(X)>60!($L(X)<1) X
"^DD",8925.71,8925.71,2,3)
Answer must be 1-60 characters in length.
"^DD",8925.71,8925.71,2,21,0)
^^1^1^3150612^
"^DD",8925.71,8925.71,2,21,1,0)
Enter the text to be used for the CPRS alert message.
"^DD",8925.71,8925.71,2,"DT")
3150612
"^DD",8925.71,8925.71,2.1,0)
SIGNER ALERT MESSAGE^F^^2;2^K:$L(X)>6!($L(X)<1) X
"^DD",8925.71,8925.71,2.1,3)
Answer must be 1-6 characters in length.
"^DD",8925.71,8925.71,2.1,21,0)
^^2^2^3150612^
"^DD",8925.71,8925.71,2.1,21,1,0)
Enter the text to be used for the CPRS alert to be sent to the signer
"^DD",8925.71,8925.71,2.1,21,2,0)
of the document that informs them of the notifications that have been sent.
"^DD",8925.71,8925.71,2.1,"DT")
3150612
"^DD",8925.71,8925.71,3,0)
SEARCH STRING^F^^3;1^K:$L(X)>200!($L(X)<3) X
"^DD",8925.71,8925.71,3,3)
Answer must be 3-200 characters in length.
"^DD",8925.71,8925.71,3,21,0)
^^2^2^3150702^
"^DD",8925.71,8925.71,3,21,1,0)
This is the text string to search for.  It must match the entry in the
"^DD",8925.71,8925.71,3,21,2,0)
TEXT TO SEARCH field (#1).
"^DD",8925.71,8925.71,3,"DT")
3150612
"^DD",8925.71,8925.71,4,0)
CPRS TEAM^8925.714PA^^4;0
"^DD",8925.71,8925.71,4,21,0)
^^3^3^3160226^
"^DD",8925.71,8925.71,4,21,1,0)
This multiple will contain pointers to the OE/RR LIST (#100.21) file to 
"^DD",8925.71,8925.71,4,21,2,0)
indicate which Provider Teams to be alerted upon matching the search
"^DD",8925.71,8925.71,4,21,3,0)
string to a piece of text in the Progress Note.
"^DD",8925.71,8925.71,5,0)
VISIT LOCATION^8925.715P^^5;0
"^DD",8925.71,8925.71,5,21,0)
^^5^5^3160226^
"^DD",8925.71,8925.71,5,21,1,0)
This multiple stores pointers from the HOSPITAL LOCATION (#44) file to 
"^DD",8925.71,8925.71,5,21,2,0)
limit which locations are to be included in the Progress Note search.  
"^DD",8925.71,8925.71,5,21,3,0)
If a location is entered into this multiple, the search will be limited 
"^DD",8925.71,8925.71,5,21,4,0)
to those notes that match this location.  If this multiple is left empty, 
"^DD",8925.71,8925.71,5,21,5,0)
then all locations will be searched.
"^DD",8925.71,8925.71,5.1,0)
VISIT LOCATION STRING^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",8925.71,8925.71,5.1,3)
Answer must be 1-30 characters in length.
"^DD",8925.71,8925.71,5.1,21,0)
^^2^2^3150612^
"^DD",8925.71,8925.71,5.1,21,1,0)
If the document's visit location is contained in this string then this
"^DD",8925.71,8925.71,5.1,21,2,0)
event will trigger an alert.
"^DD",8925.71,8925.71,5.1,"DT")
3150612
"^DD",8925.71,8925.714,0)
CPRS TEAM SUB-FIELD^^.01^1
"^DD",8925.71,8925.714,0,"DT")
3150612
"^DD",8925.71,8925.714,0,"IX","B",8925.714,.01)

"^DD",8925.71,8925.714,0,"NM","CPRS TEAM")

"^DD",8925.71,8925.714,0,"UP")
8925.71
"^DD",8925.71,8925.714,.01,0)
CPRS TEAM^MP100.21'^OR(100.21,^0;1^Q
"^DD",8925.71,8925.714,.01,1,0)
^.1
"^DD",8925.71,8925.714,.01,1,1,0)
8925.714^B
"^DD",8925.71,8925.714,.01,1,1,1)
S ^TIU(8925.71,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",8925.71,8925.714,.01,1,1,2)
K ^TIU(8925.71,DA(1),4,"B",$E(X,1,30),DA)
"^DD",8925.71,8925.714,.01,3)
Enter the team which should be alerted when matching text is found.
"^DD",8925.71,8925.714,.01,21,0)
^.001^2^2^3150612^^
"^DD",8925.71,8925.714,.01,21,1,0)
CPRS team to be alerted and sent alert for TIU document that contains
"^DD",8925.71,8925.714,.01,21,2,0)
the search text.
"^DD",8925.71,8925.714,.01,"DT")
3150612
"^DD",8925.71,8925.715,0)
VISIT LOCATION SUB-FIELD^^.01^1
"^DD",8925.71,8925.715,0,"DT")
3150612
"^DD",8925.71,8925.715,0,"IX","B",8925.715,.01)

"^DD",8925.71,8925.715,0,"NM","VISIT LOCATION")

"^DD",8925.71,8925.715,0,"UP")
8925.71
"^DD",8925.71,8925.715,.01,0)
VISIT LOCATION^MP44'^SC(^0;1^Q
"^DD",8925.71,8925.715,.01,1,0)
^.1
"^DD",8925.71,8925.715,.01,1,1,0)
8925.715^B
"^DD",8925.71,8925.715,.01,1,1,1)
S ^TIU(8925.71,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",8925.71,8925.715,.01,1,1,2)
K ^TIU(8925.71,DA(1),5,"B",$E(X,1,30),DA)
"^DD",8925.71,8925.715,.01,3)
Enter the related visit location to check for this event.
"^DD",8925.71,8925.715,.01,"DT")
3150612
"^DIC",8925.71,8925.71,0)
TIU TEXT EVENTS^8925.71
"^DIC",8925.71,8925.71,0,"GL")
^TIU(8925.71,
"^DIC",8925.71,8925.71,"%",0)
^1.005^^0
"^DIC",8925.71,8925.71,"%D",0)
^^5^5^3160226^
"^DIC",8925.71,8925.71,"%D",1,0)
The TIU TEXT EVENTS file is used to store data to be used in searching 
"^DIC",8925.71,8925.71,"%D",2,0)
for certain text within Progress Notes in order to alert treating 
"^DIC",8925.71,8925.71,"%D",3,0)
specialty areas of monitored concerns when a patient is seen.  Setting up 
"^DIC",8925.71,8925.71,"%D",4,0)
entries in this file will cause alerts to be sent to providers and 
"^DIC",8925.71,8925.71,"%D",5,0)
services to indicate a possible care opportunity.
"^DIC",8925.71,"B","TIU TEXT EVENTS",8925.71)

"BLD",11147,6)
^290
**END**
**END**

