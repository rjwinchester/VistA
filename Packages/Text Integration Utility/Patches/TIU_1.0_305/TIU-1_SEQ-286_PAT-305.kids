Released TIU*1*305 SEQ #286
Extracted from mail message
**KIDS**:TIU*1.0*305^

**INSTALL NAME**
TIU*1.0*305
"BLD",10196,0)
TIU*1.0*305^TEXT INTEGRATION UTILITIES^0^3181029^y
"BLD",10196,1,0)
^^15^15^3181008^
"BLD",10196,1,1,0)
This build addresses NSR20080310 and NSR20141017 respectively. It 
"BLD",10196,1,2,0)
consists of the following options:
"BLD",10196,1,3,0)
Contingency Downtime Bookmark Progress Notes [TIU DOWNTIME BOOKMARK PN]
"BLD",10196,1,4,0)
Create Post-Signature Alerts [TIUFPC CREATE POST-SIGNATURE]
"BLD",10196,1,5,0)
When this patch is installed at the sites, it will check file #8925.1, 
"BLD",10196,1,6,0)
field #3 (Boilerplate Text), for any existing text and delete it to make 
"BLD",10196,1,7,0)
room for the new text exported with the patch. Sites will be able to see 
"BLD",10196,1,8,0)
the old text in the install file kept by KIDS after installation has been 
"BLD",10196,1,9,0)
completed. The pre-installation routine will check for the mapping of a 
"BLD",10196,1,10,0)
local title to the national title Computer Downtime. If no local title is 
"BLD",10196,1,11,0)
found, the installer of the patch will be alerted to complete the mapping 
"BLD",10196,1,12,0)
of one local title to Computer Downtime before attempting to reinstall 
"BLD",10196,1,13,0)
the patch. Whether or not the site has a local title mapped to the 
"BLD",10196,1,14,0)
national title Computer Downtime, the installation of the patch will
"BLD",10196,1,15,0)
proceed to completion.
"BLD",10196,4,0)
^9.64PA^^
"BLD",10196,6)
1^
"BLD",10196,6.3)
27
"BLD",10196,225000)
1
"BLD",10196,"ABPKG")
n
"BLD",10196,"INI")
PRE^TIU1P305
"BLD",10196,"INID")
^y
"BLD",10196,"INIT")
POST^TIU1P305
"BLD",10196,"KRN",0)
^9.67PA^779.2^20
"BLD",10196,"KRN",.4,0)
.4
"BLD",10196,"KRN",.401,0)
.401
"BLD",10196,"KRN",.402,0)
.402
"BLD",10196,"KRN",.403,0)
.403
"BLD",10196,"KRN",.5,0)
.5
"BLD",10196,"KRN",.84,0)
.84
"BLD",10196,"KRN",3.6,0)
3.6
"BLD",10196,"KRN",3.8,0)
3.8
"BLD",10196,"KRN",9.2,0)
9.2
"BLD",10196,"KRN",9.8,0)
9.8
"BLD",10196,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",10196,"KRN",9.8,"NM",1,0)
TIUPSCA^^0^B18892982
"BLD",10196,"KRN",9.8,"NM",2,0)
TIUPSCS^^0^B68716783
"BLD",10196,"KRN",9.8,"NM",3,0)
TIUDTBPN^^0^B198161933
"BLD",10196,"KRN",9.8,"NM",4,0)
TIUUTL2^^0^B1091999
"BLD",10196,"KRN",9.8,"NM",5,0)
TIUDTBP0^^0^B217205415
"BLD",10196,"KRN",9.8,"NM","B","TIUDTBP0",5)

"BLD",10196,"KRN",9.8,"NM","B","TIUDTBPN",3)

"BLD",10196,"KRN",9.8,"NM","B","TIUPSCA",1)

"BLD",10196,"KRN",9.8,"NM","B","TIUPSCS",2)

"BLD",10196,"KRN",9.8,"NM","B","TIUUTL2",4)

"BLD",10196,"KRN",19,0)
19
"BLD",10196,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",10196,"KRN",19,"NM",1,0)
TIU DOWNTIME BOOKMARK PN^^0
"BLD",10196,"KRN",19,"NM",3,0)
TIUFPC CREATE POST-SIGNATURE^^0
"BLD",10196,"KRN",19,"NM","B","TIU DOWNTIME BOOKMARK PN",1)

"BLD",10196,"KRN",19,"NM","B","TIUFPC CREATE POST-SIGNATURE",3)

"BLD",10196,"KRN",19.1,0)
19.1
"BLD",10196,"KRN",101,0)
101
"BLD",10196,"KRN",409.61,0)
409.61
"BLD",10196,"KRN",771,0)
771
"BLD",10196,"KRN",779.2,0)
779.2
"BLD",10196,"KRN",870,0)
870
"BLD",10196,"KRN",8989.51,0)
8989.51
"BLD",10196,"KRN",8989.52,0)
8989.52
"BLD",10196,"KRN",8994,0)
8994
"BLD",10196,"KRN","B",.4,.4)

"BLD",10196,"KRN","B",.401,.401)

"BLD",10196,"KRN","B",.402,.402)

"BLD",10196,"KRN","B",.403,.403)

"BLD",10196,"KRN","B",.5,.5)

"BLD",10196,"KRN","B",.84,.84)

"BLD",10196,"KRN","B",3.6,3.6)

"BLD",10196,"KRN","B",3.8,3.8)

"BLD",10196,"KRN","B",9.2,9.2)

"BLD",10196,"KRN","B",9.8,9.8)

"BLD",10196,"KRN","B",19,19)

"BLD",10196,"KRN","B",19.1,19.1)

"BLD",10196,"KRN","B",101,101)

"BLD",10196,"KRN","B",409.61,409.61)

"BLD",10196,"KRN","B",771,771)

"BLD",10196,"KRN","B",779.2,779.2)

"BLD",10196,"KRN","B",870,870)

"BLD",10196,"KRN","B",8989.51,8989.51)

"BLD",10196,"KRN","B",8989.52,8989.52)

"BLD",10196,"KRN","B",8994,8994)

"BLD",10196,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10196,"QUES",0)
^9.62^^
"BLD",10196,"REQB",0)
^9.611^4^4
"BLD",10196,"REQB",1,0)
TIU*1.0*112^1
"BLD",10196,"REQB",2,0)
TIU*1.0*182^1
"BLD",10196,"REQB",3,0)
TIU*1.0*250^1
"BLD",10196,"REQB",4,0)
TIU*1.0*259^1
"BLD",10196,"REQB","B","TIU*1.0*112",1)

"BLD",10196,"REQB","B","TIU*1.0*182",2)

"BLD",10196,"REQB","B","TIU*1.0*250",3)

"BLD",10196,"REQB","B","TIU*1.0*259",4)

"INI")
PRE^TIU1P305
"INIT")
POST^TIU1P305
"KRN",19,2921977,-1)
0^3
"KRN",19,2921977,0)
TIUFPC CREATE POST-SIGNATURE^Create Post-Signature Alerts^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,2921977,1,0)
^^4^4^3171106^
"KRN",19,2921977,1,1,0)
This option allows a user to set the POST-SIGNATURE CODE field of a title
"KRN",19,2921977,1,2,0)
in the TIU DOCUMENT DEFINITION file with MUMPS code. At the completion of
"KRN",19,2921977,1,3,0)
a progress note using the selected title, different alerts will be 
"KRN",19,2921977,1,4,0)
generated to designated user(s).
"KRN",19,2921977,25)
EN^TIUPSCS
"KRN",19,2921977,"U")
CREATE POST-SIGNATURE ALERTS
"KRN",19,2921978,-1)
0^1
"KRN",19,2921978,0)
TIU DOWNTIME BOOKMARK PN^Contingency Downtime Bookmark Progress Notes^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,2921978,1,0)
^^5^5^3170706^
"KRN",19,2921978,1,1,0)
This utility is used to add a bookmark to the progress note of each
"KRN",19,2921978,1,2,0)
inpatient's electronic record after a VistA downtime.
"KRN",19,2921978,1,3,0)
 
"KRN",19,2921978,1,4,0)
The user is asked a few questions and then the utility places the note in 
"KRN",19,2921978,1,5,0)
each affected patient's record.
"KRN",19,2921978,25)
START^TIUDTBPN
"KRN",19,2921978,"U")
CONTINGENCY DOWNTIME BOOKMARK 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",588,-1)
1^1
"PKG",588,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",588,20,0)
^9.402P^^
"PKG",588,22,0)
^9.49I^1^1
"PKG",588,22,1,0)
1.0^2970620^2971202^1
"PKG",588,22,1,"PAH",1,0)
305^3181029^520736455
"PKG",588,22,1,"PAH",1,1,0)
^^15^15^3181029
"PKG",588,22,1,"PAH",1,1,1,0)
This build addresses NSR20080310 and NSR20141017 respectively. It 
"PKG",588,22,1,"PAH",1,1,2,0)
consists of the following options:
"PKG",588,22,1,"PAH",1,1,3,0)
Contingency Downtime Bookmark Progress Notes [TIU DOWNTIME BOOKMARK PN]
"PKG",588,22,1,"PAH",1,1,4,0)
Create Post-Signature Alerts [TIUFPC CREATE POST-SIGNATURE]
"PKG",588,22,1,"PAH",1,1,5,0)
When this patch is installed at the sites, it will check file #8925.1, 
"PKG",588,22,1,"PAH",1,1,6,0)
field #3 (Boilerplate Text), for any existing text and delete it to make 
"PKG",588,22,1,"PAH",1,1,7,0)
room for the new text exported with the patch. Sites will be able to see 
"PKG",588,22,1,"PAH",1,1,8,0)
the old text in the install file kept by KIDS after installation has been 
"PKG",588,22,1,"PAH",1,1,9,0)
completed. The pre-installation routine will check for the mapping of a 
"PKG",588,22,1,"PAH",1,1,10,0)
local title to the national title Computer Downtime. If no local title is 
"PKG",588,22,1,"PAH",1,1,11,0)
found, the installer of the patch will be alerted to complete the mapping 
"PKG",588,22,1,"PAH",1,1,12,0)
of one local title to Computer Downtime before attempting to reinstall 
"PKG",588,22,1,"PAH",1,1,13,0)
the patch. Whether or not the site has a local title mapped to the 
"PKG",588,22,1,"PAH",1,1,14,0)
national title Computer Downtime, the installation of the patch will
"PKG",588,22,1,"PAH",1,1,15,0)
proceed to completion.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","TIU1P305")
0^^B18580103^n/a
"RTN","TIU1P305",1,0)
TIU1P305 ;AITC/CR - Post Installation for Patch 305 ;12/18/17 3:58pm
"RTN","TIU1P305",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIU1P305",3,0)
 ;
"RTN","TIU1P305",4,0)
 ; call to: $$ADD^XPDMENU - supported by ICR #1157
"RTN","TIU1P305",5,0)
 ;          $$FIND1^DIC   - supported by ICR #2051
"RTN","TIU1P305",6,0)
 ;          $$GET1^DIQ    - supported by ICR #2056
"RTN","TIU1P305",7,0)
 ;          BMES^XPDUTL   - supported by ICR #10141 (same for MES^XPDUTL)
"RTN","TIU1P305",8,0)
 ;
"RTN","TIU1P305",9,0)
PRE ; clear the multiple field #3 of file #8925.1 in preparation for the text
"RTN","TIU1P305",10,0)
 ; exported by this patch.
"RTN","TIU1P305",11,0)
 K ^TMP("TIU1P305")
"RTN","TIU1P305",12,0)
 D BMES^XPDUTL("Starting Pre-installation operations for patch TIU*1.0*305...")
"RTN","TIU1P305",13,0)
 D BMES^XPDUTL("Preparing to delete the text in the BOILERPLATE TEXT field, please wait...")
"RTN","TIU1P305",14,0)
 N IEN,TIUFILE,TIUFLD,TIUIEN,TIUOLDTL,TIUNAME,TIUTITLE,TIUROOT,WP
"RTN","TIU1P305",15,0)
 ; find any title mapped to the TIU VHA ENTERPRISE STANDARD TITLE "COMPUTER DOWNTIME", #2166, in file #8926.1
"RTN","TIU1P305",16,0)
 S TIUFILE=8925.1,TIUFLD=3,TIUROOT=""  ;TIUFLD is the multiple for the Boilerplate Text
"RTN","TIU1P305",17,0)
 D CHKMAP
"RTN","TIU1P305",18,0)
 S TIUTITLE=$P($G(^TMP("TIU1P305",$J)),U,3)
"RTN","TIU1P305",19,0)
 I TIUTITLE']"" G ERR1
"RTN","TIU1P305",20,0)
 S TIUIEN=$$FIND1^DIC(TIUFILE,,"MX",TIUTITLE)
"RTN","TIU1P305",21,0)
 ; get text stored in the multiple before override
"RTN","TIU1P305",22,0)
 I TIUIEN S TIUOLDTL=$$GET1^DIQ(TIUFILE,TIUIEN_",",TIUFLD,"","WP") ; old text comes out in array WP
"RTN","TIU1P305",23,0)
 I '$D(WP) D  G EXIT1
"RTN","TIU1P305",24,0)
 . D BMES^XPDUTL("There is no text to delete in field #"_TIUFLD_" of file #"_TIUFILE)
"RTN","TIU1P305",25,0)
 ;
"RTN","TIU1P305",26,0)
 D BMES^XPDUTL("Text in the BOILERPLATE TEXT field before deletion:")
"RTN","TIU1P305",27,0)
 D BMES^XPDUTL("===================================================================")
"RTN","TIU1P305",28,0)
 D BMES^XPDUTL(.WP)
"RTN","TIU1P305",29,0)
 D MES^XPDUTL("===================================================================")
"RTN","TIU1P305",30,0)
 I TIUIEN D WP^DIE(TIUFILE,TIUIEN_",",TIUFLD,"K",TIUROOT)
"RTN","TIU1P305",31,0)
PRE1 D BMES^XPDUTL("The text found in the BOILERPLATE TEXT field has been deleted.") D EXIT1
"RTN","TIU1P305",32,0)
 Q
"RTN","TIU1P305",33,0)
 ;
"RTN","TIU1P305",34,0)
POST ; add two new menu options in two menus in TIU
"RTN","TIU1P305",35,0)
 ; [TIU DOWNTIME BOOKMARK PN] and [TIUFPC CREATE POST-SIGNATURE]
"RTN","TIU1P305",36,0)
 ; under [TIU IRM MAINTENANCE MENU] and [TIUF DOCUMENT DEFINITION MGR]
"RTN","TIU1P305",37,0)
 ; respectively
"RTN","TIU1P305",38,0)
 D BMES^XPDUTL("Starting Post-installation operations for patch TIU*1.0*305...")
"RTN","TIU1P305",39,0)
 D ADD1
"RTN","TIU1P305",40,0)
 D ADD2
"RTN","TIU1P305",41,0)
 D EXIT
"RTN","TIU1P305",42,0)
 Q
"RTN","TIU1P305",43,0)
 ;
"RTN","TIU1P305",44,0)
ADD1 ; update "TIU IRM MAINTENANCE MENU"
"RTN","TIU1P305",45,0)
 N TIUOK,TIUSYN
"RTN","TIU1P305",46,0)
 S TIUSYN=13 ; this can be changed later by the site if desired
"RTN","TIU1P305",47,0)
 ; parameter order: menu to update, option to add, synonym
"RTN","TIU1P305",48,0)
 S TIUOK=$$ADD^XPDMENU("TIU IRM MAINTENANCE MENU","TIU DOWNTIME BOOKMARK PN",TIUSYN)
"RTN","TIU1P305",49,0)
 I TIUOK=1 D
"RTN","TIU1P305",50,0)
 . D BMES^XPDUTL("[TIU DOWNTIME BOOKMARK PN] Option is part of [TIU IRM MAINTENANCE MENU]")
"RTN","TIU1P305",51,0)
 E  D  G ERR
"RTN","TIU1P305",52,0)
 . D BMES^XPDUTL("Couldn't add option [TIU DOWNTIME BOOKMARK PN] to [TIU IRM MAINTENANCE MENU]")
"RTN","TIU1P305",53,0)
 Q
"RTN","TIU1P305",54,0)
 ;
"RTN","TIU1P305",55,0)
ADD2 ; update "TIUF DOCUMENT DEFINITION MGR"
"RTN","TIU1P305",56,0)
 N TIUOK,TIUSYN
"RTN","TIU1P305",57,0)
 S TIUSYN=6
"RTN","TIU1P305",58,0)
 ; parameter order: menu to update, option to add, synonym
"RTN","TIU1P305",59,0)
 S TIUOK=$$ADD^XPDMENU("TIUF DOCUMENT DEFINITION MGR","TIUFPC CREATE POST-SIGNATURE",TIUSYN)
"RTN","TIU1P305",60,0)
 I TIUOK=1 D
"RTN","TIU1P305",61,0)
 . D BMES^XPDUTL("[TIUFPC CREATE POST-SIGNATURE] Option is part of [TIUF DOCUMENT DEFINITION MGR]")
"RTN","TIU1P305",62,0)
 E  D  G ERR
"RTN","TIU1P305",63,0)
 . D BMES^XPDUTL("Couldn't add option [TIUFPC CREATE POST-SIGNATURE] to [TIUF DOCUMENT DEFINITION MGR]")
"RTN","TIU1P305",64,0)
 Q
"RTN","TIU1P305",65,0)
 ;
"RTN","TIU1P305",66,0)
ERR ; alert the user if there is an error
"RTN","TIU1P305",67,0)
 D BMES^XPDUTL("Unable to attach the menu option")
"RTN","TIU1P305",68,0)
 Q
"RTN","TIU1P305",69,0)
 ;
"RTN","TIU1P305",70,0)
ERR1 ; alert user if there is an error
"RTN","TIU1P305",71,0)
 D BMES^XPDUTL("Pre-installation check: no local title mapped to title COMPUTER DOWNTIME.")
"RTN","TIU1P305",72,0)
 D MES^XPDUTL("Please resolve this issue by mapping a local title in file #8925.1 to")
"RTN","TIU1P305",73,0)
 D MES^XPDUTL("the TIU VHA ENTERPRISE STANDARD TITLE 'COMPUTER DOWNTIME' in file #8926.1")
"RTN","TIU1P305",74,0)
 D MES^XPDUTL("before running the option 'TIU DOWNTIME BOOKMARK PN'.")
"RTN","TIU1P305",75,0)
 D MES^XPDUTL("Patch installation will continue...")
"RTN","TIU1P305",76,0)
 D EXIT1
"RTN","TIU1P305",77,0)
 Q
"RTN","TIU1P305",78,0)
 ;
"RTN","TIU1P305",79,0)
EXIT ;
"RTN","TIU1P305",80,0)
 D BMES^XPDUTL("Finished Post-installation of patch TIU*1.0*305.")
"RTN","TIU1P305",81,0)
 Q
"RTN","TIU1P305",82,0)
 ;
"RTN","TIU1P305",83,0)
EXIT1 ;
"RTN","TIU1P305",84,0)
 D BMES^XPDUTL("Finished Pre-installation of patch TIU*1.0*305.")
"RTN","TIU1P305",85,0)
 K ^TMP("TIU1P305")
"RTN","TIU1P305",86,0)
 Q
"RTN","TIU1P305",87,0)
 ;
"RTN","TIU1P305",88,0)
CHKMAP ; look for a local title mapped to the TIU VHA ENTERPRISE STANDARD TITLE 'COMPUTER DOWNTIME' (IEN=2166)
"RTN","TIU1P305",89,0)
 ; TIUNAME is the title in file #8925.1 mapped to the record #2166 in file #8926.1
"RTN","TIU1P305",90,0)
 F IEN=0:0 S IEN=$O(^TIU(8925.1,IEN)) Q:'IEN  I $$GET1^DIQ(8925.1,+IEN,1501,"I")=2166 S TIUTITLE=$$GET1^DIQ(8925.1,+IEN,1501,"E"),TIUIEN=+IEN,TIUNAME=$$GET1^DIQ(8925.1,+IEN,.01,"E"),^TMP("TIU1P305",$J)=TIUTITLE_U_IEN_U_TIUNAME
"RTN","TIU1P305",91,0)
 Q
"RTN","TIUDTBP0")
0^5^B217205415^n/a
"RTN","TIUDTBP0",1,0)
TIUDTBP0 ;AITC/CR/SGM - BOOKMARK TIU NOTE AFTER DOWNTIME ;8/20/18 4:02pm
"RTN","TIUDTBP0",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIUDTBP0",3,0)
 ;
"RTN","TIUDTBP0",4,0)
 ;  Last Edited: 09/22/2017 09:46 / Leidos/sgm
"RTN","TIUDTBP0",5,0)
 ;  *** This routine only invoked by routine TIUDTBPN ***
"RTN","TIUDTBP0",6,0)
 ;  Pertinent programmer notes at the end of this routine
"RTN","TIUDTBP0",7,0)
 ;
"RTN","TIUDTBP0",8,0)
 ; ICR Documentation for the TIUDTBP0 and TIUDTBPN routines
"RTN","TIUDTBP0",9,0)
 ; ICR#    TYPE   DESCRIPTION
"RTN","TIUDTBP0",10,0)
 ;-----  -------  -------------------------------------------
"RTN","TIUDTBP0",11,0)
 ;  358  ContSub  File 405, Read access to fields and assoc. indexes
"RTN","TIUDTBP0",12,0)
 ;                  Field #.02, transaction_type = 3^Discharge
"RTN","TIUDTBP0",13,0)
 ;                              Cross_ref: ^DGPM("ATT3",d/t,da)=""
"RTN","TIUDTBP0",14,0)
 ;                Flds: .01,.02,.04,.06,.07,.08,.09,.1,.11,.12,.18,.19
"RTN","TIUDTBP0",15,0)
 ;  664  ContSub  DIVISION^VAUTOMA [TIU a subscriber]
"RTN","TIUDTBP0",16,0)
 ; 1519  Sup      XUTMDEVQ: EN, $$NODEV
"RTN","TIUDTBP0",17,0)
 ; 1557  Sup      $$ESBLOCK^XUSESIG1
"RTN","TIUDTBP0",18,0)
 ; 2051  Sup      $$FIND1^DIC
"RTN","TIUDTBP0",19,0)
 ; 2056  Sup      $$GET1^DIQ
"RTN","TIUDTBP0",20,0)
 ; 2325  ContSub  $$CANDO^USRLA [TIU a subscriber]
"RTN","TIUDTBP0",21,0)
 ; 2343  Sup      ^XUSER: $$ACTIVE, $$NAME, $$LOOKUP
"RTN","TIUDTBP0",22,0)
 ; 3104  Private  File 8930.8, .01 field lookup of name
"RTN","TIUDTBP0",23,0)
 ; 3869  ContSub  GETPLIST^SDAMA202 [TIU a subscriber]
"RTN","TIUDTBP0",24,0)
 ;10006  Sup      ^DIC
"RTN","TIUDTBP0",25,0)
 ;10026  Sup      ^DIR
"RTN","TIUDTBP0",26,0)
 ;10028  Sup      EN^DIWE
"RTN","TIUDTBP0",27,0)
 ;10035  Sup      File 2, multiple fields and their indexes
"RTN","TIUDTBP0",28,0)
 ;                  fields: .01, .105, "ACA" index
"RTN","TIUDTBP0",29,0)
 ;10039  Sup      File 42, Fileman lookup, fields .01, .015, 44
"RTN","TIUDTBP0",30,0)
 ;10040  Sup      File 44, Fileman lookup, fields 2505,2506, "B" index
"RTN","TIUDTBP0",31,0)
 ;10050  Sup      SIG^XUSESIG
"RTN","TIUDTBP0",32,0)
 ;10060  Sup      File 200, all fields accessible by FM
"RTN","TIUDTBP0",33,0)
 ;10061  Sup      IN5^VADPT
"RTN","TIUDTBP0",34,0)
 ;10070  Sup      ^XMD
"RTN","TIUDTBP0",35,0)
 ;10103  Sup      ^XLFDT: $$DOW, $$FMDIFF, $$FMTE, $$NOW
"RTN","TIUDTBP0",36,0)
 ;10104  Sup      ^XLFSTR: $$CJ, $$UP
"RTN","TIUDTBP0",37,0)
 ;10142  Sup      EN^DDIOL
"RTN","TIUDTBP0",38,0)
 ;
"RTN","TIUDTBP0",39,0)
 ;
"RTN","TIUDTBP0",40,0)
 ;=====================================================================
"RTN","TIUDTBP0",41,0)
 ;          DIC Lookup Module
"RTN","TIUDTBP0",42,0)
 ;---------------------------------------------------------------------
"RTN","TIUDTBP0",43,0)
DIC(LIN) ;  extrinsic function
"RTN","TIUDTBP0",44,0)
 ; return -2:timeout, -1:'^'-out,  null/selection
"RTN","TIUDTBP0",45,0)
 ; this calls returns the value of X
"RTN","TIUDTBP0",46,0)
 N I,X,Y,DIC,DTOUT,DUOUT,LAB
"RTN","TIUDTBP0",47,0)
 I LIN=1 D
"RTN","TIUDTBP0",48,0)
 . ;   select note title
"RTN","TIUDTBP0",49,0)
 . D TEXT("T2",1,12)
"RTN","TIUDTBP0",50,0)
 . S DIC=8925.1,DIC(0)="AEMQ"
"RTN","TIUDTBP0",51,0)
 . S DIC("S")="I $$GET1^DIQ(8925.1,+Y,1501)=""COMPUTER DOWNTIME"""
"RTN","TIUDTBP0",52,0)
 . S Y=$$DICALL I Y>0 S TIUD("TITLE")=+Y,TIUD("TITLE",0)=$P(Y,U,2)
"RTN","TIUDTBP0",53,0)
 . S X=(Y>0)
"RTN","TIUDTBP0",54,0)
 . Q
"RTN","TIUDTBP0",55,0)
 I LIN=2 D
"RTN","TIUDTBP0",56,0)
 . ;   select signer/author of note, only active users
"RTN","TIUDTBP0",57,0)
 . ;   with admin closure, author not required to be ASU certified
"RTN","TIUDTBP0",58,0)
 . S DIC("S")="I +$$ACTIVE^XUSER(+Y)"
"RTN","TIUDTBP0",59,0)
 . I TIUD("TYPE")="E" D
"RTN","TIUDTBP0",60,0)
 . . N X,Y,EVENT,STAT,TX
"RTN","TIUDTBP0",61,0)
 . . S STAT=$$FIND1(8925.6,,,"UNSIGNED") Q:STAT<1
"RTN","TIUDTBP0",62,0)
 . . S EVENT=$$FIND1(8930.8,,,"SIGNATURE") Q:STAT<1
"RTN","TIUDTBP0",63,0)
 . . S X=",$$CANDO^USRLA("_TIUD("TITLE")_","_STAT_","_EVENT_",+Y)"
"RTN","TIUDTBP0",64,0)
 . . S DIC("S")=DIC("S")_X
"RTN","TIUDTBP0",65,0)
 . . D TEXT("T15",0,0,0,0,,.TX) M DIC("A")=TX
"RTN","TIUDTBP0",66,0)
 . . Q
"RTN","TIUDTBP0",67,0)
 . S DIC=200,DIC(0)="AEMQ"
"RTN","TIUDTBP0",68,0)
 . S DIC("A")="Who will be the AUTHOR of the note? "
"RTN","TIUDTBP0",69,0)
 . S DIC("B")=$$UP^XLFSTR($$NAME^XUSER(DUZ,"F"))
"RTN","TIUDTBP0",70,0)
 . S Y=$$DICALL I Y>0 S TIUD("SIGN")=+Y,TIUD("SIGN",0)=$P(Y,U,2)
"RTN","TIUDTBP0",71,0)
 . S X=(Y>0)
"RTN","TIUDTBP0",72,0)
 . Q
"RTN","TIUDTBP0",73,0)
 I LIN=3 D
"RTN","TIUDTBP0",74,0)
 . ;  select clinics to get notes
"RTN","TIUDTBP0",75,0)
 . I $G(TIUD("CLSEL"))'=1 S X=1 Q
"RTN","TIUDTBP0",76,0)
 . N INC,TIUDIC
"RTN","TIUDTBP0",77,0)
 . S TIUDIC=44,TIUDIC(0)="QAEM"
"RTN","TIUDTBP0",78,0)
 . S TIUDIC("A")="Select HOSPITAL LOCATION for Outpatient Notes: "
"RTN","TIUDTBP0",79,0)
 . S X=TIUD("TIMS"),Y=TIUD("TIME")
"RTN","TIUDTBP0",80,0)
 . S TIUDIC("S")="I $$DIC31^TIUDTBP0"
"RTN","TIUDTBP0",81,0)
 . ;    this FOR loop will actually get all the selected locations
"RTN","TIUDTBP0",82,0)
 . F INC=1:1 D  Q:Y<1
"RTN","TIUDTBP0",83,0)
 . . K DIC M DIC=TIUDIC
"RTN","TIUDTBP0",84,0)
 . . S Y=$$DICALL Q:Y<1  S TIUD("CLSEL",+Y)=$P(Y,U,2)
"RTN","TIUDTBP0",85,0)
 . . I INC=1 S TIUDIC("A")="Select another HOSPITAL LOCATION: "
"RTN","TIUDTBP0",86,0)
 . . Q
"RTN","TIUDTBP0",87,0)
 . S X=+$O(TIUD("CLSEL",0)) ;   if no clinics selected, abort
"RTN","TIUDTBP0",88,0)
 . Q
"RTN","TIUDTBP0",89,0)
 I LIN=4 D
"RTN","TIUDTBP0",90,0)
 . ;  select mail recipients
"RTN","TIUDTBP0",91,0)
 . N INC,TIUDIC
"RTN","TIUDTBP0",92,0)
 . D TEXT("T4",1,,,3)
"RTN","TIUDTBP0",93,0)
 . S TIUDIC=200,TIUDIC(0)="QAEM"
"RTN","TIUDTBP0",94,0)
 . S X="I $S($D(TIUD(""MAIL"",+Y)):0,DUZ=+Y:0,(Y>0&(Y<1)):1,1:$$ACTIVE^XUSER(+Y))>0"
"RTN","TIUDTBP0",95,0)
 . S TIUDIC("S")=X
"RTN","TIUDTBP0",96,0)
 . S Y=0 F INC=1:1 D  Q:Y<.5
"RTN","TIUDTBP0",97,0)
 . . K DIC M DIC=TIUDIC
"RTN","TIUDTBP0",98,0)
 . . S Y=$$DICALL Q:Y<.5  S TIUD("MAIL",+Y)=$P(Y,U,2)
"RTN","TIUDTBP0",99,0)
 . . I INC=1 S TIUDIC("A")="Select another NEW PERSON NAME: "
"RTN","TIUDTBP0",100,0)
 . . Q
"RTN","TIUDTBP0",101,0)
 . S X=$S(Y<-1:0,1:1) I X S TIUD("MAIL",DUZ)=""
"RTN","TIUDTBP0",102,0)
 . Q
"RTN","TIUDTBP0",103,0)
 Q X
"RTN","TIUDTBP0",104,0)
 ;
"RTN","TIUDTBP0",105,0)
DICALL() ;
"RTN","TIUDTBP0",106,0)
 N X,Y,D0,DA,DTOUT,DUOUT
"RTN","TIUDTBP0",107,0)
 D ^DIC S:$D(DTOUT) Y=-3 S:$D(DUOUT) Y=-2
"RTN","TIUDTBP0",108,0)
 Q Y
"RTN","TIUDTBP0",109,0)
 ;
"RTN","TIUDTBP0",110,0)
DIC31() ;
"RTN","TIUDTBP0",111,0)
 ;  Called from ^DIC("S"), naked is set and Y is ien
"RTN","TIUDTBP0",112,0)
 ;  Expects TIUD("TIMS") & TIUD("TIME")
"RTN","TIUDTBP0",113,0)
 ;  If no date range, default to T @0000 - @2400
"RTN","TIUDTBP0",114,0)
 ;  "I" node is inactive_dt^reactivated_dt
"RTN","TIUDTBP0",115,0)
 ;  Do not allow selection of a clinic more than once
"RTN","TIUDTBP0",116,0)
 ;  Return 1 if clinic is allowed
"RTN","TIUDTBP0",117,0)
 N Z,ED,ST
"RTN","TIUDTBP0",118,0)
 S ST=+$G(TIUD("TIMS")) I 'ST S ST=DT
"RTN","TIUDTBP0",119,0)
 S ED=+$G(TIUD("TIME")) S:ED<ST ED=ST S:ED?7N ED=ED+.25
"RTN","TIUDTBP0",120,0)
 S Z=$G(^("I"))
"RTN","TIUDTBP0",121,0)
 S ST(0)=+Z,ED(0)=+$P(Z,U,2)
"RTN","TIUDTBP0",122,0)
 I $D(TIUD("CLSEL",+Y)) S Z=0 ;  prevent picking twice
"RTN","TIUDTBP0",123,0)
 I 'ST(0) S Z=1
"RTN","TIUDTBP0",124,0)
 I ST(0)>0 D  ;                  has inactive date
"RTN","TIUDTBP0",125,0)
 . I ST(0)'<ED S Z=1 Q  ;        inactive>downtime_end
"RTN","TIUDTBP0",126,0)
 . I 'ED(0),ST(0)'>ST S Z=0 Q  ; inactive =< downtime start, no react
"RTN","TIUDTBP0",127,0)
 . I ED(0),ED(0)'>ST S Z=1 Q  ;  reactivate =< downtime start
"RTN","TIUDTBP0",128,0)
 . S Z=1 ;                    inact>downtime_start,react<downtime_end
"RTN","TIUDTBP0",129,0)
 . Q
"RTN","TIUDTBP0",130,0)
 Q Z
"RTN","TIUDTBP0",131,0)
 ;
"RTN","TIUDTBP0",132,0)
 ;=====================================================================
"RTN","TIUDTBP0",133,0)
 ;          DIR PROMPTER
"RTN","TIUDTBP0",134,0)
 ;=====================================================================
"RTN","TIUDTBP0",135,0)
DIR(LIN) ;  extrinsic function
"RTN","TIUDTBP0",136,0)
 ;  call returns the value of X
"RTN","TIUDTBP0",137,0)
 ;  -3:timeout, -2:'^'-out,  null or value
"RTN","TIUDTBP0",138,0)
 N X,Y,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","TIUDTBP0",139,0)
 I LIN=1 D
"RTN","TIUDTBP0",140,0)
 . S DIR(0)="SOA^S:SCHEDULED;U:UNSCHEDULED"
"RTN","TIUDTBP0",141,0)
 . S DIR("A")="Was the downtime (S)cheduled or (U)nscheduled? "
"RTN","TIUDTBP0",142,0)
 . S X=0,Y=$$DIRCALL I $S(Y'?1U:0,"SU"'[Y:0,1:1) D  S Y=1
"RTN","TIUDTBP0",143,0)
 . . S TIUD("SCH")=Y,TIUD("SCH",0)=$S(Y="S":"A ",1:"An un")_"scheduled"
"RTN","TIUDTBP0",144,0)
 . . Q
"RTN","TIUDTBP0",145,0)
 . S X=(Y=1)
"RTN","TIUDTBP0",146,0)
 . Q
"RTN","TIUDTBP0",147,0)
 I LIN=2 D
"RTN","TIUDTBP0",148,0)
 . S X=$G(TIUD("TIMS"))
"RTN","TIUDTBP0",149,0)
 . S DIR(0)="DOA^:"_$E($$NOW^XLFDT,1,12)_":AEPR"
"RTN","TIUDTBP0",150,0)
 . S DIR("A")="What was the starting time of the outage? "
"RTN","TIUDTBP0",151,0)
 . S X=0,Y=$$DIRCALL
"RTN","TIUDTBP0",152,0)
 . I Y>0 S TIUD("TIMS")=Y,TIUD("TIMS",0)=$$DIRTIM(Y)
"RTN","TIUDTBP0",153,0)
 . S X=(Y>0)
"RTN","TIUDTBP0",154,0)
 . Q
"RTN","TIUDTBP0",155,0)
 I LIN=3 D
"RTN","TIUDTBP0",156,0)
 . N MAX,MIN
"RTN","TIUDTBP0",157,0)
 . S X=$G(TIUD("TIMS")),(MAX,MIN)=""
"RTN","TIUDTBP0",158,0)
 . S MIN=$G(TIUD("TIMS")),MAX=$E($$NOW^XLFDT,1,12)
"RTN","TIUDTBP0",159,0)
 . S DIR(0)="DOA^"_MIN_":"_MAX_":AEPR"
"RTN","TIUDTBP0",160,0)
 . S DIR("A")="What was the ending time of the outage? "
"RTN","TIUDTBP0",161,0)
 . S X=0,Y=$$DIRCALL
"RTN","TIUDTBP0",162,0)
 . I Y>0 S TIUD("TIME")=Y,TIUD("TIME",0)=$$DIRTIM(Y)
"RTN","TIUDTBP0",163,0)
 . S X=(Y>0)
"RTN","TIUDTBP0",164,0)
 . Q
"RTN","TIUDTBP0",165,0)
 I LIN=4 D
"RTN","TIUDTBP0",166,0)
 . S DIR(0)="DOA^::AETP"
"RTN","TIUDTBP0",167,0)
 . S DIR("A")="What shall the Date/Time of the Note be? "
"RTN","TIUDTBP0",168,0)
 . S DIR("B")="NOW"
"RTN","TIUDTBP0",169,0)
 . S Y=$$DIRCALL S:Y>0 Y=$E(Y,1,12)
"RTN","TIUDTBP0",170,0)
 . I Y>0 S TIUD("NOTEDT")=Y,TIUD("NOTEDT",0)=$$FMTE^XLFDT(Y)
"RTN","TIUDTBP0",171,0)
 . S X=(Y>0)
"RTN","TIUDTBP0",172,0)
 . Q
"RTN","TIUDTBP0",173,0)
 I LIN=5 D
"RTN","TIUDTBP0",174,0)
 . N TIUR
"RTN","TIUDTBP0",175,0)
 . D TEXT("T3",,,,0,,.TIUR)
"RTN","TIUDTBP0",176,0)
 . ; Outpatient word added at the request of business owner, 7-11-18, after demo 
"RTN","TIUDTBP0",177,0)
 . S X="SO^A:All Outpatient Clinics;S:Selected Outpatient Clinics;N:No Outpatient Clinics"
"RTN","TIUDTBP0",178,0)
 . S DIR(0)=X
"RTN","TIUDTBP0",179,0)
 . S DIR("A")="File Notes for Outpatient Clinics? [A/S/N]"
"RTN","TIUDTBP0",180,0)
 . S DIR("A",1)="In addition to Inpatients,"  ;added per business owner request 7-11-18
"RTN","TIUDTBP0",181,0)
 . S DIR("?")=TIUR(6)
"RTN","TIUDTBP0",182,0)
 . F I=1:1:5 S DIR("?",I)="   "_TIUR(I)
"RTN","TIUDTBP0",183,0)
 . S Y=$$DIRCALL,X=0
"RTN","TIUDTBP0",184,0)
 . I Y?1U,"ANS"[Y S TIUD("CLSEL")=$S(Y="N":0,Y="S":1,1:2),X=1
"RTN","TIUDTBP0",185,0)
 . Q
"RTN","TIUDTBP0",186,0)
 I LIN=6 D
"RTN","TIUDTBP0",187,0)
 . ;    type of sig, esig or admin close
"RTN","TIUDTBP0",188,0)
 . S TIUD("TYPE")="A",X=1
"RTN","TIUDTBP0",189,0)
 . Q
"RTN","TIUDTBP0",190,0)
 . ;
"RTN","TIUDTBP0",191,0)
 . S DIR(0)=$$DIT(1),DIR("A")=$$DIT(2)
"RTN","TIUDTBP0",192,0)
 . S Y=$$DIRCALL I Y?1U,"AE"[Y S TIUD("TYPE")=Y
"RTN","TIUDTBP0",193,0)
 . S X=$S(Y'?1U:0,1:"AE"[Y)
"RTN","TIUDTBP0",194,0)
 . Q
"RTN","TIUDTBP0",195,0)
 I LIN=7 D
"RTN","TIUDTBP0",196,0)
 . ;    edit text of note?
"RTN","TIUDTBP0",197,0)
 . N I,J,GLX,LN,TX
"RTN","TIUDTBP0",198,0)
 . S GLX=$NA(^TMP("TIUDT",$J)) K @GLX
"RTN","TIUDTBP0",199,0)
 . S @GLX@(1,0)="Date/Time of Note:  "_TIUD("NOTEDT",0)
"RTN","TIUDTBP0",200,0)
 . D TEXT("T7",0,0,0,0,,.TX)
"RTN","TIUDTBP0",201,0)
 . S LN=1 F I=1:1:3 S LN=LN+1,@GLX@(LN,0)=TX(I)
"RTN","TIUDTBP0",202,0)
 . F I=1:1 Q:'$D(TEXT(3,I))  S LN=LN+1,@GLX@(LN,0)=TEXT(3,I,0)
"RTN","TIUDTBP0",203,0)
 . D EN^DDIOL(,GLX) K @GLX
"RTN","TIUDTBP0",204,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to edit the text",DIR("B")="No"
"RTN","TIUDTBP0",205,0)
 . S X=$$DIRCALL
"RTN","TIUDTBP0",206,0)
 . Q
"RTN","TIUDTBP0",207,0)
 I LIN=8 D
"RTN","TIUDTBP0",208,0)
 . S DIR(0)="Y",DIR("B")="No"
"RTN","TIUDTBP0",209,0)
 . S DIR("A")="Do you wish to edit the text further"
"RTN","TIUDTBP0",210,0)
 . S X=$$DIRCALL
"RTN","TIUDTBP0",211,0)
 . Q
"RTN","TIUDTBP0",212,0)
 I LIN=9 D
"RTN","TIUDTBP0",213,0)
 . N TIUX
"RTN","TIUDTBP0",214,0)
 . D TEXT("T14",1,0,1,,,.TIUX)
"RTN","TIUDTBP0",215,0)
 . S DIR(0)="YOA",DIR("B")="Yes"  ; changed default from 'No' to 'Yes', per business owner request, 7-11-18
"RTN","TIUDTBP0",216,0)
 . S DIR("?")="   " M DIR("?")=TIUX
"RTN","TIUDTBP0",217,0)
 . S DIR("A")="Queue the report to Taskman?  "
"RTN","TIUDTBP0",218,0)
 . S X=$$DIRCALL
"RTN","TIUDTBP0",219,0)
 . Q
"RTN","TIUDTBP0",220,0)
 Q X
"RTN","TIUDTBP0",221,0)
 ;
"RTN","TIUDTBP0",222,0)
DIRCALL() ;
"RTN","TIUDTBP0",223,0)
 N X,Y,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","TIUDTBP0",224,0)
 W ! D ^DIR S:$D(DTOUT) Y=-3 S:$D(DUOUT) Y=-2
"RTN","TIUDTBP0",225,0)
 Q Y
"RTN","TIUDTBP0",226,0)
 ;
"RTN","TIUDTBP0",227,0)
DIRTIM(Y) Q $$DOW^XLFDT(Y)_", "_$TR($$FMTE^XLFDT(Y),"@"," ")
"RTN","TIUDTBP0",228,0)
 ;
"RTN","TIUDTBP0",229,0)
DIT(L) ;
"RTN","TIUDTBP0",230,0)
 ;;SA^E:ELECTRONIC SIGNATURE (/es/);A:ADMINSTRATIVE CLOSURE (/ac/)
"RTN","TIUDTBP0",231,0)
 ;;Close notes by (E)lectronic Signature or (A)dministrative Closure? 
"RTN","TIUDTBP0",232,0)
 Q $P($T(DIT+L),";",3,9)
"RTN","TIUDTBP0",233,0)
 ;
"RTN","TIUDTBP0",234,0)
 ;=====================================================================
"RTN","TIUDTBP0",235,0)
 ;          Other Prompts
"RTN","TIUDTBP0",236,0)
 ;=====================================================================
"RTN","TIUDTBP0",237,0)
 ;
"RTN","TIUDTBP0",238,0)
DIVISION() ;
"RTN","TIUDTBP0",239,0)
 ;      if only one inpatient division, don't ask
"RTN","TIUDTBP0",240,0)
 ;      VAUTOMA returns: Y=-1 or Y=1
"RTN","TIUDTBP0",241,0)
 ;                       VAUTD = 0:if divisions selected
"RTN","TIUDTBP0",242,0)
 ;                               1:if selected "ALL" divisions
"RTN","TIUDTBP0",243,0)
 ;      TIUD("DIV")= 0:if multiple divisions selected
"RTN","TIUDTBP0",244,0)
 ;                   1:if there is only one division
"RTN","TIUDTBP0",245,0)
 ;                   2:all divisions
"RTN","TIUDTBP0",246,0)
 ;      TIUD("DIV",ien)=division name, only if TIUD("DIV")=0
"RTN","TIUDTBP0",247,0)
 N I,X,Y,VAUTD
"RTN","TIUDTBP0",248,0)
 I $$CNTDIV^TIUUTL2=1 S TIUD("DIV")=1 Q 1
"RTN","TIUDTBP0",249,0)
 D TEXT("T5",1,,,3) D DIVISION^VAUTOMA
"RTN","TIUDTBP0",250,0)
 I Y<0!('$D(VAUTD)) Q -1
"RTN","TIUDTBP0",251,0)
 S VAUTD=$S(VAUTD>0:2,1:0)
"RTN","TIUDTBP0",252,0)
 M TIUD("DIV")=VAUTD
"RTN","TIUDTBP0",253,0)
 Q 1
"RTN","TIUDTBP0",254,0)
 ;
"RTN","TIUDTBP0",255,0)
FIND1(FILE,IEN,FLG,VAL,IDX,SCR) ;
"RTN","TIUDTBP0",256,0)
 N I,X,Y,DIERR,TIUER
"RTN","TIUDTBP0",257,0)
 S FILE=$G(FILE),IEN=$G(IEN),FLG=$G(FLG),VAL=$G(VAL)
"RTN","TIUDTBP0",258,0)
 I FLG="" S FLG="QX"
"RTN","TIUDTBP0",259,0)
 I 'FILE!'$L(VAL) Q -1
"RTN","TIUDTBP0",260,0)
 S Y=$$FIND1^DIC(FILE,IEN,FLG,VAL,.IDX,.SCR,"TIUER")
"RTN","TIUDTBP0",261,0)
 I $D(DIERR) S Y=-1
"RTN","TIUDTBP0",262,0)
 Q Y
"RTN","TIUDTBP0",263,0)
 ;
"RTN","TIUDTBP0",264,0)
GET1(FILE,IEN,FLD,FLG) ;
"RTN","TIUDTBP0",265,0)
 N I,X,Y,DA,DIC,DIERR,TIUER
"RTN","TIUDTBP0",266,0)
 S FILE=$G(FILE),FLD=$G(FLD),FLG=$G(FLG),IEN=$G(IEN)
"RTN","TIUDTBP0",267,0)
 S:$E(IEN,$L(IEN))'="," IEN=IEN_","
"RTN","TIUDTBP0",268,0)
 I 'FILE!'IEN!'FLD Q ""
"RTN","TIUDTBP0",269,0)
 S X=$$GET1^DIQ(FILE,IEN,FLD,$G(FLG),,"TIUER")
"RTN","TIUDTBP0",270,0)
 I $D(DIERR) S X=""
"RTN","TIUDTBP0",271,0)
 Q X
"RTN","TIUDTBP0",272,0)
 ;
"RTN","TIUDTBP0",273,0)
 ;=====================================================================
"RTN","TIUDTBP0",274,0)
 ;          Programmer Tools for Troubleshooting
"RTN","TIUDTBP0",275,0)
 ;=====================================================================
"RTN","TIUDTBP0",276,0)
TEST ;   programmer testing
"RTN","TIUDTBP0",277,0)
 N EFORM,ERRON,NOKILL S (EFORM,ERRON,NOKILL)=1
"RTN","TIUDTBP0",278,0)
 D START^TIUDTBPN
"RTN","TIUDTBP0",279,0)
 Q
"RTN","TIUDTBP0",280,0)
 ;
"RTN","TIUDTBP0",281,0)
SAVE ;   save local and global variables to ^XTMP
"RTN","TIUDTBP0",282,0)
 N I,X,GL
"RTN","TIUDTBP0",283,0)
 S X=$$FMADD^XLFDT(DT,8)_U_DT_U
"RTN","TIUDTBP0",284,0)
 S GL=$NA(^XTMP("TIUDTBP0")) L +@GL:5 E  Q
"RTN","TIUDTBP0",285,0)
 S I=1+$P($G(@GL@(0)),U,3) S ^(0)=X_I L -@GL
"RTN","TIUDTBP0",286,0)
 S @GL@(I)=$$NOW^XLFDT
"RTN","TIUDTBP0",287,0)
 M @GL@(I,"VAR","TIUD")=TIUD
"RTN","TIUDTBP0",288,0)
 S @GL@(I,"VAR","ZTSK")=$G(ZTSK)
"RTN","TIUDTBP0",289,0)
 S @GL@(I,"VAR","DUZ")=DUZ
"RTN","TIUDTBP0",290,0)
 M @GL@(I,"VAR-G","TMP")=@GLT
"RTN","TIUDTBP0",291,0)
 Q
"RTN","TIUDTBP0",292,0)
 ;
"RTN","TIUDTBP0",293,0)
 ;=====================================================================
"RTN","TIUDTBP0",294,0)
 ;          Generic Text Handler
"RTN","TIUDTBP0",295,0)
 ;=====================================================================
"RTN","TIUDTBP0",296,0)
 ; this program is not expecting the text lines to contain a ';' char.
"RTN","TIUDTBP0",297,0)
 ; if there is formatting codes, they will be in the 3rd ';'-piece.
"RTN","TIUDTBP0",298,0)
 ;
"RTN","TIUDTBP0",299,0)
TEXT(TAG,WR,LF,CLR,PAD,CHR,TIUR) ;
"RTN","TIUDTBP0",300,0)
 ; TAG - line label containing the text
"RTN","TIUDTBP0",301,0)
 ;       all groups of text should end with ' ;;---'
"RTN","TIUDTBP0",302,0)
 ;  WR - Boolean, write or do not write
"RTN","TIUDTBP0",303,0)
 ;  LF - 0:no extra line feeds; 1:leading line feed; 2:trailing feed
"RTN","TIUDTBP0",304,0)
 ; CLR - Boolean, clear screen first
"RTN","TIUDTBP0",305,0)
 ; PAD - number of spaces begin each line with
"RTN","TIUDTBP0",306,0)
 ;       If PAD="" then default to 3.  If PAD=0 then no padding
"RTN","TIUDTBP0",307,0)
 ; CHR - for center justify, character to pad line, default is space
"RTN","TIUDTBP0",308,0)
 ;.TIUR  - return array for text if desired (.TIUR(i)=text)
"RTN","TIUDTBP0",309,0)
 ;
"RTN","TIUDTBP0",310,0)
 N I,J,X,Y,FMT,LEN,SP
"RTN","TIUDTBP0",311,0)
 S TAG=$G(TAG),WR=+$G(WR),LF=+$G(LF),CLR=+$G(CLR)
"RTN","TIUDTBP0",312,0)
 S CHR=$G(CHR) S:CHR="" CHR=" "
"RTN","TIUDTBP0",313,0)
 S PAD=$G(PAD) I PAD'?1.N S PAD=3
"RTN","TIUDTBP0",314,0)
 S LEN=IOM S:'LEN LEN=80
"RTN","TIUDTBP0",315,0)
 S $P(SP," ",LEN)=""
"RTN","TIUDTBP0",316,0)
 S I=0 F J=1:1 S X=$T(@TAG+J) Q:X=" ;;---"  D
"RTN","TIUDTBP0",317,0)
 . S I=I+1,X=$P(X,";",3,99),FMT=""
"RTN","TIUDTBP0",318,0)
 . I X?1U1";".E S FMT=$E(X),X=$P(X,";",2,99)
"RTN","TIUDTBP0",319,0)
 . I FMT="C" S X=$$CJ^XLFSTR(" "_X_" ",LEN,CHR)
"RTN","TIUDTBP0",320,0)
 . I FMT="R" S X=$$RJ^XLFSTR(X,LEN,CHR)
"RTN","TIUDTBP0",321,0)
 . I FMT="",PAD S X=$E(SP,1,PAD)_X
"RTN","TIUDTBP0",322,0)
 . S TIUR(I)=X
"RTN","TIUDTBP0",323,0)
 . I FMT="C" S I=I+1,TIUR(I)=" "
"RTN","TIUDTBP0",324,0)
 . Q
"RTN","TIUDTBP0",325,0)
 I WR W:CLR @IOF W:LF[1 ! F Y=1:1:I W !,TIUR(Y) I I=Y,LF[2 W !
"RTN","TIUDTBP0",326,0)
 Q
"RTN","TIUDTBP0",327,0)
 ;
"RTN","TIUDTBP0",328,0)
T1 ;
"RTN","TIUDTBP0",329,0)
 ;;C;Bookmark Progress Note after a Downtime
"RTN","TIUDTBP0",330,0)
 ;;This is the utility to add a bookmark to the progress note of
"RTN","TIUDTBP0",331,0)
 ;;each patient's electronic record after a VistA downtime.
"RTN","TIUDTBP0",332,0)
 ;;
"RTN","TIUDTBP0",333,0)
 ;;You will be asked a few questions, and then the utility
"RTN","TIUDTBP0",334,0)
 ;;will place the note on the patient's record.
"RTN","TIUDTBP0",335,0)
 ;;
"RTN","TIUDTBP0",336,0)
 ;;---
"RTN","TIUDTBP0",337,0)
T2 ;
"RTN","TIUDTBP0",338,0)
 ;;Select the PROGRESS NOTE TITLE to be used for filing contingency
"RTN","TIUDTBP0",339,0)
 ;;downtime bookmark progress notes.  The selected title must be mapped
"RTN","TIUDTBP0",340,0)
 ;;to the VHA ENTERPRISE STANDARD TITLE of COMPUTER DOWNTIME
"RTN","TIUDTBP0",341,0)
 ;;---
"RTN","TIUDTBP0",342,0)
T3 ;
"RTN","TIUDTBP0",343,0)
 ;;This option will look for all outpatients with visits that occured
"RTN","TIUDTBP0",344,0)
 ;;during the downtime period.  You have the option to select visits
"RTN","TIUDTBP0",345,0)
 ;;from (A)ll clinics or (S)elected clinics or (N)o clinics.
"RTN","TIUDTBP0",346,0)
 ;;If Selected clinics is chosen, then only visits which have been
"RTN","TIUDTBP0",347,0)
 ;;CHECKED OUT will be candidates for filing a downtime note.
"RTN","TIUDTBP0",348,0)
 ;;   
"RTN","TIUDTBP0",349,0)
 ;;---
"RTN","TIUDTBP0",350,0)
T4 ;
"RTN","TIUDTBP0",351,0)
 ;;In addition to yourself, who shall receive email notification
"RTN","TIUDTBP0",352,0)
 ;;of this event?
"RTN","TIUDTBP0",353,0)
 ;;---
"RTN","TIUDTBP0",354,0)
T5 ;
"RTN","TIUDTBP0",355,0)
 ;;Select DIVISION(s) to use when the task selects inpatients to file notes...
"RTN","TIUDTBP0",356,0)
 ;;---
"RTN","TIUDTBP0",357,0)
T61 ;
"RTN","TIUDTBP0",358,0)
 ;;C;Potential Interruption in Electronic Medical Record Keeping  
"RTN","TIUDTBP0",359,0)
 ;;|SU| interruption in access to the electronic medical records
"RTN","TIUDTBP0",360,0)
 ;;occurred for |DUR| between:
"RTN","TIUDTBP0",361,0)
 ;;     |ST| and |END|
"RTN","TIUDTBP0",362,0)
 ;;
"RTN","TIUDTBP0",363,0)
 ;;---
"RTN","TIUDTBP0",364,0)
T62 ;
"RTN","TIUDTBP0",365,0)
 ;;Before, during and after this period of downtime, medical record
"RTN","TIUDTBP0",366,0)
 ;;documentation may have been collected on paper.  Documents such as
"RTN","TIUDTBP0",367,0)
 ;;progress notes, orders, results, medication administration records
"RTN","TIUDTBP0",368,0)
 ;;(MAR) and procedure reports may have been collected, but may not be
"RTN","TIUDTBP0",369,0)
 ;;reflected in the electronic record or they may be scanned into the
"RTN","TIUDTBP0",370,0)
 ;;record at a later date.
"RTN","TIUDTBP0",371,0)
 ;;---
"RTN","TIUDTBP0",372,0)
T7 ;
"RTN","TIUDTBP0",373,0)
 ;;Creating TIU note text, you will have an opportunity to edit the text
"RTN","TIUDTBP0",374,0)
 ;;The progress note will be generated with the following text:
"RTN","TIUDTBP0",375,0)
 ;;  
"RTN","TIUDTBP0",376,0)
 ;;---
"RTN","TIUDTBP0",377,0)
T8 ;
"RTN","TIUDTBP0",378,0)
 ;;     
"RTN","TIUDTBP0",379,0)
 ;;The note(s) will have the following administrative closure (not a signature):
"RTN","TIUDTBP0",380,0)
 ;;---
"RTN","TIUDTBP0",381,0)
T9 ;
"RTN","TIUDTBP0",382,0)
 ;;   
"RTN","TIUDTBP0",383,0)
 ;;The note(s) will be signed with the following electronic signature:
"RTN","TIUDTBP0",384,0)
 ;;---
"RTN","TIUDTBP0",385,0)
T10 ;
"RTN","TIUDTBP0",386,0)
 ;;You will now be asked for an electronic signature to begin this process.
"RTN","TIUDTBP0",387,0)
 ;;If you are the author of the note, your signature will be appended.
"RTN","TIUDTBP0",388,0)
 ;;Otherwise, the AUTHOR/SIGNER will get VistA alerts for each note.
"RTN","TIUDTBP0",389,0)
 ;;---
"RTN","TIUDTBP0",390,0)
T11 ;
"RTN","TIUDTBP0",391,0)
 ;;You will now be asked for an electronic signature to begin this process.
"RTN","TIUDTBP0",392,0)
 ;;This is a security measure to start the background task, but it is not used
"RTN","TIUDTBP0",393,0)
 ;;to sign the notes themselves.  If you are not the AUTHOR, your name will
"RTN","TIUDTBP0",394,0)
 ;;show for the administrative closure, but not as the author of the note.
"RTN","TIUDTBP0",395,0)
 ;;---
"RTN","TIUDTBP0",396,0)
T12 ;
"RTN","TIUDTBP0",397,0)
 ;;You don't have an Electronic Signature Code on file, quitting...
"RTN","TIUDTBP0",398,0)
 ;;---
"RTN","TIUDTBP0",399,0)
T13 ;
"RTN","TIUDTBP0",400,0)
 ;;You have 60 seconds/try and a maximum of 3 attempts to enter a proper code.
"RTN","TIUDTBP0",401,0)
 ;;---
"RTN","TIUDTBP0",402,0)
T14 ;
"RTN","TIUDTBP0",403,0)
 ;;You can choose to queue this report to Taskman or you may run the
"RTN","TIUDTBP0",404,0)
 ;;report to your terminal now.  In either case, a Mailman message will
"RTN","TIUDTBP0",405,0)
 ;;be generated listing the patients who had a downtime note filed to
"RTN","TIUDTBP0",406,0)
 ;;their medical record.
"RTN","TIUDTBP0",407,0)
 ;;
"RTN","TIUDTBP0",408,0)
 ;;If you choose to run this report to your terminal, you will see a
"RTN","TIUDTBP0",409,0)
 ;;display of each patient found showing patient name, location, and
"RTN","TIUDTBP0",410,0)
 ;;filing status of the note.
"RTN","TIUDTBP0",411,0)
 ;;
"RTN","TIUDTBP0",412,0)
 ;;If you do not choose to queue this report, your terminal could be
"RTN","TIUDTBP0",413,0)
 ;;tied up for some time depending upon the inpatient and outpatient
"RTN","TIUDTBP0",414,0)
 ;;volume seen during the downtime.
"RTN","TIUDTBP0",415,0)
 ;;
"RTN","TIUDTBP0",416,0)
 ;;---
"RTN","TIUDTBP0",417,0)
T15 ;
"RTN","TIUDTBP0",418,0)
 ;;The Author/Signer of these TIU notes must be authorized in ASU to
"RTN","TIUDTBP0",419,0)
 ;;sign for this type of TIU Document.
"RTN","TIUDTBP0",420,0)
 ;;  
"RTN","TIUDTBP0",421,0)
 ;;---
"RTN","TIUDTBP0",422,0)
T16 ;
"RTN","TIUDTBP0",423,0)
 ;; Note  |                            |
"RTN","TIUDTBP0",424,0)
 ;; Filed | Location                   | Patient Name
"RTN","TIUDTBP0",425,0)
 ;;-------|----------------------------|-----------------------------------
"RTN","TIUDTBP0",426,0)
 ;;---
"RTN","TIUDTBP0",427,0)
T17 ;
"RTN","TIUDTBP0",428,0)
 ;;Now generating progress notes for inpatients ...
"RTN","TIUDTBP0",429,0)
 ;;Now generating progress notes for discharged patients ...
"RTN","TIUDTBP0",430,0)
 ;;Now generating progress notes for outpatient clinics ...
"RTN","TIUDTBP0",431,0)
 ;;---
"RTN","TIUDTBP0",432,0)
 ;
"RTN","TIUDTBP0",433,0)
 ;=====================================================================
"RTN","TIUDTBP0",434,0)
 ;     PROGRAMMER NOTES
"RTN","TIUDTBP0",435,0)
 ;---------------------------------------------------------------------
"RTN","TIUDTBP0",436,0)
 ;Patch 305 - local, class III code remediated to national class I
"RTN","TIUDTBP0",437,0)
 ; some class III original options left in code but are never executed
"RTN","TIUDTBP0",438,0)
 ; in case in the future the VA decided it wants those original options
"RTN","TIUDTBP0",439,0)
 ;    DIR(6) - always return admin closure
"RTN","TIUDTBP0",440,0)
 ;    Programmer error tools
"RTN","TIUDTBP0",441,0)
 ;      If +ERRON is defined, append output from ^TIUPNAPI call
"RTN","TIUDTBP0",442,0)
 ;      If +NOKILL then do not kill off temp globals upon exit
"RTN","TIUDTBP0",443,0)
 ;      If +EFORM then email has columnar versus delimited format
"RTN","TIUDTBP0",444,0)
 ;
"RTN","TIUDTBP0",445,0)
 ;Description of temporary global structure
"RTN","TIUDTBP0",446,0)
 ;-------------------------------------------------------------------
"RTN","TIUDTBP0",447,0)
 ;                                   DIV=file 4 ien
"RTN","TIUDTBP0",448,0)
 ;     HLN=hospital location name     HL=file 44 ien
"RTN","TIUDTBP0",449,0)
 ;     PNM=patient name              DFN=file 2 ien
"RTN","TIUDTBP0",450,0)
 ;     WNM=ward name                WARD=file 42 ien
"RTN","TIUDTBP0",451,0)
 ;  STATUS = p1[^p2]
"RTN","TIUDTBP0",452,0)
 ;   p1 = Successful;Unsuccessful;Successful/unsigned;Error
"RTN","TIUDTBP0",453,0)
 ;   p2 = [TIU_note extrinsic function return value]
"RTN","TIUDTBP0",454,0)
 ; GLT = $NA(^TMP("TIUDTBPN",$J)
"RTN","TIUDTBP0",455,0)
 ;@GLT@("DSP",TYP,inc)=display line    [Sort TYP = 1,2,3]
"RTN","TIUDTBP0",456,0)
 ;@GLT@("F",2,DFN) = DFN^PNM
"RTN","TIUDTBP0",457,0)
 ;@GLT@("F",42,s3) = WARD^WNM^DIV^HL  {s3 = WARD or WNM}
"RTN","TIUDTBP0",458,0)
 ;@GLT@("F",44,HL) = HL^HLN^DIV
"RTN","TIUDTBP0",459,0)
 ;@GLT@("SORT",1,WARD,PNM,DFN)="" for current inpatients
"RTN","TIUDTBP0",460,0)
 ;@GLT@("SORT",2,PNM,DFN,DATE)="" for discharge patients
"RTN","TIUDTBP0",461,0)
 ;@GLT@("SORT",3,PNM,DFN,DATE)=HL_U_HLN for outpatients
"RTN","TIUDTBP0",462,0)
 ;    List of findings for mail message
"RTN","TIUDTBP0",463,0)
 ;@GLT@("MSG",PNM,DFN,HLN,inc)=STATUS  [class III format  - p1]
"RTN","TIUDTBP0",464,0)
 ;@GLT@("MSG",PNM,DFN,HLN,inc)=STATUS  [remediated format - p1^p2]
"RTN","TIUDTBP0",465,0)
 ;@GLT@("SEND",0) = fm wp header
"RTN","TIUDTBP0",466,0)
 ;@GLT@("SEND",inc,0) = line inc in mail message
"RTN","TIUDTBP0",467,0)
 ;Merge @GLT@("VAR")=TIUD
"RTN","TIUDTBP0",468,0)
 ;
"RTN","TIUDTBP0",469,0)
 ;Notes on Find Patients modules to create a TIU note
"RTN","TIUDTBP0",470,0)
 ;---------------------------------------------------------------------
"RTN","TIUDTBP0",471,0)
 ;GETINP -  get all current inpatients whose admit<downtime_endtime
"RTN","TIUDTBP0",472,0)
 ;   use admit movement xref as possible to admit without a ward
"RTN","TIUDTBP0",473,0)
 ;   division check only done on inpatients
"RTN","TIUDTBP0",474,0)
 ;
"RTN","TIUDTBP0",475,0)
 ;GETINPD:
"RTN","TIUDTBP0",476,0)
 ; Find any inpatients who were discharged during downtime by checking
"RTN","TIUDTBP0",477,0)
 ; discharge movements using FOR loop on discharge movement xref.
"RTN","TIUDTBP0",478,0)
 ;     Downtime_start '< discharge date.time < now
"RTN","TIUDTBP0",479,0)
 ;     ^DGPM("AMV"_TT,Date,Patient,DA)
"RTN","TIUDTBP0",480,0)
 ;
"RTN","TIUDTBP0",481,0)
 ;INPCOM - common code for both current and discharged inpatients
"RTN","TIUDTBP0",482,0)
 ;   Validate non-patient data, get iens, divisions, locations
"RTN","TIUDTBP0",483,0)
 ;   Let IN5^VADPT determine if patient was an inpatient
"RTN","TIUDTBP0",484,0)
 ;     check if patient was an inpatient at appropriate time
"RTN","TIUDTBP0",485,0)
 ;     .VAIP - Both an input and output parameter
"RTN","TIUDTBP0",486,0)
 ;     input: optional, VAIP("D")=<fmdt to find assoc. patient move>
"RTN","TIUDTBP0",487,0)
 ;                                default to the end of downtime
"RTN","TIUDTBP0",488,0)
 ; Output:
"RTN","TIUDTBP0",489,0)
 ;   VAIP(1)    = movement ien
"RTN","TIUDTBP0",490,0)
 ;   VAIP(2)    = trans type (1^admit 2^transfer 3^discharge...)
"RTN","TIUDTBP0",491,0)
 ;   VAIP(5)    = ien^ward_name
"RTN","TIUDTBP0",492,0)
 ;   VAIP(13)   = ien of admission movement
"RTN","TIUDTBP0",493,0)
 ;   VAIP(13,4) = ien^ward_name
"RTN","TIUDTBP0",494,0)
 ;   VAIP(17)   = ien of discharge movement
"RTN","TIUDTBP0",495,0)
 ;   VAIP(17,4) = ien^ward_name
"RTN","TIUDTBP0",496,0)
 ;
"RTN","TIUDTBP0",497,0)
 ;GETOUT - Search for outpatient appts, get latest appt dt only
"RTN","TIUDTBP0",498,0)
 ;  $$SDAPI^SDAMA301 retrieves ALL outpatients with filters applied
"RTN","TIUDTBP0",499,0)
 ;     $$SDAPI returns -1, 0, # of records
"RTN","TIUDTBP0",500,0)
 ;     Returns ^TMP($J,"SDAMA301",dfn,appt)= p1^p2^p3^p4 where
"RTN","TIUDTBP0",501,0)
 ;     p1 = FM appt dt
"RTN","TIUDTBP0",502,0)
 ;     p2 = clinic ien ; clinic name
"RTN","TIUDTBP0",503,0)
 ;     p3 = R;SCHEDULED/KEPT  or  I;INPATIENT  or  NT;NO ACTION TAKEN
"RTN","TIUDTBP0",504,0)
 ;     p4 = dfn ; patient name
"RTN","TIUDTBP0",505,0)
 ;  Move and sort output from $$SDAPI
"RTN","TIUDTBP0",506,0)
 ;  This only generates one note per patient based on location at
"RTN","TIUDTBP0",507,0)
 ;     end of downtime
"RTN","TIUDTBP0",508,0)
 ;  TIU API to create note kills ^TMP($J)
"RTN","TIUDTBPN")
0^3^B198161933^n/a
"RTN","TIUDTBPN",1,0)
TIUDTBPN ;AITC/CR/SGM - BOOKMARK TIU NOTE AFTER DOWNTIME ;8/20/18 3:59pm
"RTN","TIUDTBPN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIUDTBPN",3,0)
 ;
"RTN","TIUDTBPN",4,0)
 ;  Last Edited: 09/22/2017 09:46 / Leidos/sgm
"RTN","TIUDTBPN",5,0)
 ;*****************************************************************
"RTN","TIUDTBPN",6,0)
 ;            CHANGE LOG
"RTN","TIUDTBPN",7,0)
 ;  DATE      PATCH     DESCRIPTION
"RTN","TIUDTBPN",8,0)
 ;--------  ----------  -----------------------------------------
"RTN","TIUDTBPN",9,0)
 ;09/2017               ICR documentatation in ^TIUDTBP0
"RTN","TIUDTBPN",10,0)
 ;                      Description of format of @GLT in ^TIUDTBP0
"RTN","TIUDTBPN",11,0)
 ;09/18/17  305         Class III code remediated to class I
"RTN","TIUDTBPN",12,0)
 ;
"RTN","TIUDTBPN",13,0)
 ;---------------------------------------------------------------------
"RTN","TIUDTBPN",14,0)
 ;                    Option: TIU DOWNTIME BOOKMARK PN
"RTN","TIUDTBPN",15,0)
 ;---------------------------------------------------------------------
"RTN","TIUDTBPN",16,0)
START ;
"RTN","TIUDTBPN",17,0)
 N X,Y,TEXT,TIUD
"RTN","TIUDTBPN",18,0)
 D ENOUT
"RTN","TIUDTBPN",19,0)
 D TEXT("T1",1,0,1,5,"-") ;  display opening header
"RTN","TIUDTBPN",20,0)
 Q:'$$ESIGCK  ;    must have valid esig
"RTN","TIUDTBPN",21,0)
 Q:'$$DIC(1)  ;    TIUD("TITLE")     = ien, TIU("TITLE",0)=name
"RTN","TIUDTBPN",22,0)
 Q:'$$DIR(1)  ;    TIUD("SCH")       = (S/U) / sched vs unsched
"RTN","TIUDTBPN",23,0)
 Q:'$$DIR(2)  ;    TIUD("TIMS")      = fm_dt / downtime start
"RTN","TIUDTBPN",24,0)
 Q:'$$DIR(3)  ;    TIUD("TIME")      = fm_dt / downtime end
"RTN","TIUDTBPN",25,0)
 I TIUD("TIMS")=TIUD("TIME") D  Q
"RTN","TIUDTBPN",26,0)
 . W $C(7),!!,"Can't have the same start and end date/time."
"RTN","TIUDTBPN",27,0)
 Q:'$$DIR(6)  ;    TIUD("TYPE")      = E/A  |type of sig (E/A)
"RTN","TIUDTBPN",28,0)
 Q:'$$DIC(2)  ;    TIUD("SIGN")      = ien,TIUD("SIGN",0)=name/signer
"RTN","TIUDTBPN",29,0)
 Q:'$$DIR(4)  ;    TIUD("NOTEDT")    = date/time of note
"RTN","TIUDTBPN",30,0)
 Q:'$$DIR(5)  ;    TIUD("CLSEL")     = 0:No, 1:Some, 2:All
"RTN","TIUDTBPN",31,0)
 Q:'$$DIC(3)  ;    TIUD("CLSEL",ien) = name
"RTN","TIUDTBPN",32,0)
 Q:'$$DIC(4)  ;    TIUD("MAIL",duz)  = name
"RTN","TIUDTBPN",33,0)
 Q:$$DIVISION<0  ; TIUD("DIV")= 0:if multiple divisions selected
"RTN","TIUDTBPN",34,0)
 ;                                TIUD("DIV",ien)=name
"RTN","TIUDTBPN",35,0)
 ;                              1:if there is only one division
"RTN","TIUDTBPN",36,0)
 ;                              2:all divisions
"RTN","TIUDTBPN",37,0)
 Q:$$CREATE<1  ;   Build the text of the note
"RTN","TIUDTBPN",38,0)
 ;                 Only need full note TEXT at this point
"RTN","TIUDTBPN",39,0)
 K X M X=TEXT(3) K TEXT M TEXT=X
"RTN","TIUDTBPN",40,0)
 ;                 Ask queue/run report now, Y may be <0
"RTN","TIUDTBPN",41,0)
 S Y=$$DIR(9) I Y>-1 D QUEUE:Y,EN:'Y
"RTN","TIUDTBPN",42,0)
 Q
"RTN","TIUDTBPN",43,0)
 ;
"RTN","TIUDTBPN",44,0)
 ;===============================================
"RTN","TIUDTBPN",45,0)
 ;               Taskman Reentry
"RTN","TIUDTBPN",46,0)
 ;-----------------------------------------------
"RTN","TIUDTBPN",47,0)
EN ;
"RTN","TIUDTBPN",48,0)
 N I,X,Y,GLT,HDR,TRM,TIUST
"RTN","TIUDTBPN",49,0)
 D ENOUT
"RTN","TIUDTBPN",50,0)
 S X=$$FMADD^XLFDT(DT,7)_U_DT
"RTN","TIUDTBPN",51,0)
 S GLT=$NA(^TMP("TIUDTBPN",$J)) S @GLT=X
"RTN","TIUDTBPN",52,0)
 M @GLT@("VAR")=TIUD
"RTN","TIUDTBPN",53,0)
 S TRM=($E(IOST)="C")
"RTN","TIUDTBPN",54,0)
 D TEXT("T16",0,0,0,0,,.HDR) ;      header for screen display
"RTN","TIUDTBPN",55,0)
 D TEXT("T17",0,0,0,0,,.TIUST) ;    getting patients message
"RTN","TIUDTBPN",56,0)
 ;      get all current inpatients whose admit<downtime_endtime
"RTN","TIUDTBPN",57,0)
 ;      use admit movement xref as possible to admit without a ward
"RTN","TIUDTBPN",58,0)
 W:TRM !!,TIUST(1),! D GETINP
"RTN","TIUDTBPN",59,0)
 W:TRM !!,TIUST(2),! D GETINPD
"RTN","TIUDTBPN",60,0)
 S X=+TIUD("CLSEL"),Y=+$O(TIUD("CLSEL",0))
"RTN","TIUDTBPN",61,0)
 I X,$S(X=2:1,1:Y) W:TRM !!,TIUST(3),! D GETOUT
"RTN","TIUDTBPN",62,0)
 S TIUD("MAILz")=$$MAIL
"RTN","TIUDTBPN",63,0)
 I $D(ZTQUEUED) S ZTREQ="@" I +$G(ERRON) D SAVE^TIUDTBP0
"RTN","TIUDTBPN",64,0)
 Q:$G(NOKILL)
"RTN","TIUDTBPN",65,0)
 ;
"RTN","TIUDTBPN",66,0)
ENOUT K ^TMP("TIUDTBPN",$J) Q
"RTN","TIUDTBPN",67,0)
 ;
"RTN","TIUDTBPN",68,0)
 ;===============================================
"RTN","TIUDTBPN",69,0)
 ;      Create the Default Text of the Note
"RTN","TIUDTBPN",70,0)
 ;-----------------------------------------------
"RTN","TIUDTBPN",71,0)
CREATE() ;
"RTN","TIUDTBPN",72,0)
 ;  Create the text of the downtime note
"RTN","TIUDTBPN",73,0)
 ;  Use text stored in 8925.1 BOILERPLATE TEXT field
"RTN","TIUDTBPN",74,0)
 ;  If no text there, move canned text into that field
"RTN","TIUDTBPN",75,0)
 ;    TEXT(1,i,0) contains the header, uneditable portion
"RTN","TIUDTBPN",76,0)
 ;    TEXT(2,i,0) contains the body, editable portion
"RTN","TIUDTBPN",77,0)
 ;    Text(3,i,0) contains the entire text of the note
"RTN","TIUDTBPN",78,0)
 ;    TEXT(4,i,0) contains the body, canned text
"RTN","TIUDTBPN",79,0)
 ;
"RTN","TIUDTBPN",80,0)
 N I,J,X,Y,Z,GLN,LN,TMP,TIUDA
"RTN","TIUDTBPN",81,0)
 K TEXT
"RTN","TIUDTBPN",82,0)
 S TIUDA=+TIUD("TITLE")
"RTN","TIUDTBPN",83,0)
 S GLN=$NA(^TIU(8925.1,TIUDA,"DFLT"))
"RTN","TIUDTBPN",84,0)
 W @IOF
"RTN","TIUDTBPN",85,0)
 D CRE1,CRE2,CRE9
"RTN","TIUDTBPN",86,0)
 S Y=$$CRE3 I Y<0 Q Y
"RTN","TIUDTBPN",87,0)
 D CRE4
"RTN","TIUDTBPN",88,0)
 S TIUD("NOW")=$$NOW^XLFDT
"RTN","TIUDTBPN",89,0)
 S TIUD("AUTH")=TIUD("SIGN")
"RTN","TIUDTBPN",90,0)
 S TIUD("ESBY")=$S(TIUD("AUTH")=DUZ:DUZ,1:"")
"RTN","TIUDTBPN",91,0)
 I TIUD("TYPE")="E" D TEXT("T10",1)
"RTN","TIUDTBPN",92,0)
 I TIUD("TYPE")="A" D TEXT("T11",1)
"RTN","TIUDTBPN",93,0)
 I '$$CRE5 Q 0
"RTN","TIUDTBPN",94,0)
 Q 1
"RTN","TIUDTBPN",95,0)
 ;
"RTN","TIUDTBPN",96,0)
CRE1 ;   get header, uneditable
"RTN","TIUDTBPN",97,0)
 N I,X,Z,TMP
"RTN","TIUDTBPN",98,0)
 D TEXT("T61",0,0,0,0,"-",.TMP)
"RTN","TIUDTBPN",99,0)
 F I=1:1 Q:'$D(TMP(I))  S TEXT(1,I,0)=TMP(I)
"RTN","TIUDTBPN",100,0)
 ;   place computed values in header
"RTN","TIUDTBPN",101,0)
 F I=1:1 Q:'$D(TEXT(1,I))  S X=TEXT(1,I,0) D
"RTN","TIUDTBPN",102,0)
 . S Z="|ST|" I X[Z S X=$P(X,Z)_TIUD("TIMS",0)_$P(X,Z,2)
"RTN","TIUDTBPN",103,0)
 . S Z="|END|" I X[Z S X=$P(X,Z)_TIUD("TIME",0)_$P(X,Z,2)
"RTN","TIUDTBPN",104,0)
 . S Z="|SU|" I X[Z S X=$P(X,Z)_TIUD("SCH",0)_$P(X,Z,2)
"RTN","TIUDTBPN",105,0)
 . S Z="|DUR|" I X[Z S X=$P(X,Z)_$$CRE12()_$P(X,Z,2)
"RTN","TIUDTBPN",106,0)
 . S TEXT(1,I,0)=X
"RTN","TIUDTBPN",107,0)
 . Q
"RTN","TIUDTBPN",108,0)
 Q
"RTN","TIUDTBPN",109,0)
 ;
"RTN","TIUDTBPN",110,0)
CRE12() ;
"RTN","TIUDTBPN",111,0)
 N X,Y,DAY,ED,HR,MIN,SEC,ST
"RTN","TIUDTBPN",112,0)
 S ST=TIUD("TIMS"),ED=TIUD("TIME")
"RTN","TIUDTBPN",113,0)
 I '(ST&ED) Q ""
"RTN","TIUDTBPN",114,0)
 S X=$$FMDIFF^XLFDT(ED,ST,3) ;  d hh:mm:ss
"RTN","TIUDTBPN",115,0)
 S DAY=+$P(X," ") S X=$P(X," ",2)
"RTN","TIUDTBPN",116,0)
 S HR=+$P(X,":"),MIN=+$P(X,":",2),SEC=+$P(X,":",3)
"RTN","TIUDTBPN",117,0)
 I SEC>29 S MIN=MIN+1
"RTN","TIUDTBPN",118,0)
 I MIN>59 S HR=HR+(MIN\60),MIN=(MIN#60)
"RTN","TIUDTBPN",119,0)
 I HR>23 S DAY=DAY+(HR\24),HR=(HR#24)
"RTN","TIUDTBPN",120,0)
 S Y="" I DAY S Y=DAY_" day"_$S(DAY=1:"",1:"s") S:DAY>0 Y=Y_" "
"RTN","TIUDTBPN",121,0)
 I HR S Y=Y_HR_" hour"_$S(HR=1:"",1:"s") S:MIN>0 Y=Y_" and "
"RTN","TIUDTBPN",122,0)
 I MIN S Y=Y_MIN_" minute"_$S(MIN=1:"",1:"s")
"RTN","TIUDTBPN",123,0)
 I $E(Y,$L(Y))=" " S Y=$E(Y,1,$L(Y)-1)
"RTN","TIUDTBPN",124,0)
 Q Y
"RTN","TIUDTBPN",125,0)
 ;
"RTN","TIUDTBPN",126,0)
CRE2 ;    get body, editable
"RTN","TIUDTBPN",127,0)
 N I,TMP
"RTN","TIUDTBPN",128,0)
 D TEXT("T62",0,0,0,0,,.TMP)
"RTN","TIUDTBPN",129,0)
 F I=1:1 Q:'$D(TMP(I))  S TEXT(4,I,0)=TMP(I)
"RTN","TIUDTBPN",130,0)
 S TEXT(4,0)=U_U_(I-1)_U_(I-1)_U_DT_U_U
"RTN","TIUDTBPN",131,0)
 M TEXT(2)=TEXT(4) I '$O(@GLN@(0)) M @GLN=TEXT(2)
"RTN","TIUDTBPN",132,0)
 Q
"RTN","TIUDTBPN",133,0)
 ;
"RTN","TIUDTBPN",134,0)
 ;   allow user to edit the text of the note
"RTN","TIUDTBPN",135,0)
CRE3() ;
"RTN","TIUDTBPN",136,0)
 N X,Y,DIC,DIWESUB
"RTN","TIUDTBPN",137,0)
CRE31 ;
"RTN","TIUDTBPN",138,0)
 S Y=$$DIR(7) I Y<1 Q Y
"RTN","TIUDTBPN",139,0)
 S DIC=$TR(GLN,")",","),DIWESUB="Progress Note Text"
"RTN","TIUDTBPN",140,0)
 D EN^DIWE,CRE9
"RTN","TIUDTBPN",141,0)
 S Y=$$DIR(8) I Y=1 G CRE31
"RTN","TIUDTBPN",142,0)
 Q Y
"RTN","TIUDTBPN",143,0)
 ;
"RTN","TIUDTBPN",144,0)
CRE4 ;
"RTN","TIUDTBPN",145,0)
 ;   display if administrative closure
"RTN","TIUDTBPN",146,0)
 I TIUD("TYPE")="A" D
"RTN","TIUDTBPN",147,0)
 . D TEXT("T8",1,,,0)
"RTN","TIUDTBPN",148,0)
 . W !,"Administrative Closure: "_$$FMTE^XLFDT(DT,"2D")
"RTN","TIUDTBPN",149,0)
 . W !,?20,"By: "_$$GET1(200,DUZ,20.2)
"RTN","TIUDTBPN",150,0)
 . W !,?24,$$GET1(200,DUZ,20.3)
"RTN","TIUDTBPN",151,0)
 . Q
"RTN","TIUDTBPN",152,0)
 ;   display if electronic signature
"RTN","TIUDTBPN",153,0)
 I TIUD("TYPE")'="A",TIUD("SIGN")=DUZ D
"RTN","TIUDTBPN",154,0)
 . D TEXT("T9",1,,,0) S X=$$ESBLOCK^XUSESIG1(DUZ)
"RTN","TIUDTBPN",155,0)
 . W !,?35,"/es/ "_$P(X,U)
"RTN","TIUDTBPN",156,0)
 . W !,?40,$P(X,U,3)
"RTN","TIUDTBPN",157,0)
 . Q
"RTN","TIUDTBPN",158,0)
 W !!
"RTN","TIUDTBPN",159,0)
 Q
"RTN","TIUDTBPN",160,0)
 ;
"RTN","TIUDTBPN",161,0)
CRE5() ;      ask for user's electronic signature
"RTN","TIUDTBPN",162,0)
 N X,Y,X1,X2
"RTN","TIUDTBPN",163,0)
 D TEXT("T13",1,1,,0),SIG^XUSESIG
"RTN","TIUDTBPN",164,0)
 Q $L(X1)>0
"RTN","TIUDTBPN",165,0)
 ;
"RTN","TIUDTBPN",166,0)
CRE9 ;
"RTN","TIUDTBPN",167,0)
 ;   rebuild TEXT(2) and TEXT(3)
"RTN","TIUDTBPN",168,0)
 ;   GLN=$NA(^TIU(8925.1,TIUDA,"DFLT"))
"RTN","TIUDTBPN",169,0)
 N I,J,LN
"RTN","TIUDTBPN",170,0)
 I '$O(@GLN@(0)),'$O(TEXT(4,0)) Q
"RTN","TIUDTBPN",171,0)
 I '$O(@GLN@(0)) K @GLN M @GLN=TEXT(4)
"RTN","TIUDTBPN",172,0)
 K TEXT(2),TEXT(3) S LN=0 M TEXT(2)=@GLN
"RTN","TIUDTBPN",173,0)
 F J=1,2 F I=1:1 Q:'$D(TEXT(J,I))  S LN=LN+1,TEXT(3,LN,0)=TEXT(J,I,0)
"RTN","TIUDTBPN",174,0)
 I LN>0 S TEXT(3,0)=U_U_LN_U_LN_U_DT_U_U
"RTN","TIUDTBPN",175,0)
 Q
"RTN","TIUDTBPN",176,0)
 ;
"RTN","TIUDTBPN",177,0)
 ;===============================================
"RTN","TIUDTBPN",178,0)
 ;              Search for Patients
"RTN","TIUDTBPN",179,0)
 ;-----------------------------------------------
"RTN","TIUDTBPN",180,0)
 ;  programmer notes at end of TIUDTBP0 routine for these modules
"RTN","TIUDTBPN",181,0)
 ;
"RTN","TIUDTBPN",182,0)
TOTADD(P) S $P(TOTAL,U,P)=1+$P(TOTAL,U,P) Q
"RTN","TIUDTBPN",183,0)
 ;
"RTN","TIUDTBPN",184,0)
GETINP ;
"RTN","TIUDTBPN",185,0)
 N Z,STOP,TIUDSP,TMP,TOTAL,TYP
"RTN","TIUDTBPN",186,0)
 S TYP=1,TOTAL=0  M TIUDSP=HDR
"RTN","TIUDTBPN",187,0)
 ;   sort current inpatients by ward, then name
"RTN","TIUDTBPN",188,0)
 S TMP=$NA(^DPT("ACA"))
"RTN","TIUDTBPN",189,0)
 F  S TMP=$Q(@TMP) Q:$QS(TMP,1)'="ACA"  D
"RTN","TIUDTBPN",190,0)
 . N X,Y,DFN,PNM,WARD
"RTN","TIUDTBPN",191,0)
 . S DFN=$QS(TMP,3) S X=$$CK2(DFN) Q:'X  S PNM=$P(X,U,2)
"RTN","TIUDTBPN",192,0)
 . S WARD=$G(^DPT(DFN,.1)) S X=$$CK42(WARD) Q:'X  S WARD=$P(X,U,2)
"RTN","TIUDTBPN",193,0)
 . S @GLT@("SORT",TYP,WARD,PNM,DFN)=""
"RTN","TIUDTBPN",194,0)
 . Q
"RTN","TIUDTBPN",195,0)
 S TMP=$NA(@GLT@("SORT",TYP)),STOP=$TR(TMP,")",",")
"RTN","TIUDTBPN",196,0)
 F  S TMP=$Q(@TMP) Q:TMP'[STOP  D
"RTN","TIUDTBPN",197,0)
 . N DATE,DFN,PNM,WARD
"RTN","TIUDTBPN",198,0)
 . S WARD=$QS(TMP,5),PNM=$QS(TMP,6),DFN=$QS(TMP,7)
"RTN","TIUDTBPN",199,0)
 . S DATE=$E($$NOW^XLFDT,1,12)
"RTN","TIUDTBPN",200,0)
 . D INPCOM(DFN,DATE)
"RTN","TIUDTBPN",201,0)
 . Q
"RTN","TIUDTBPN",202,0)
 D DSP(,,,1)
"RTN","TIUDTBPN",203,0)
 Q
"RTN","TIUDTBPN",204,0)
 ; 
"RTN","TIUDTBPN",205,0)
GETINPD ;
"RTN","TIUDTBPN",206,0)
 N X,Y,STOP,TIUDSP,TIUNOW,TMP,TOTAL,TYP
"RTN","TIUDTBPN",207,0)
 S TYP=2,TOTAL=0  M TIUDSP=HDR
"RTN","TIUDTBPN",208,0)
 S X=TIUD("TIME")-.000001
"RTN","TIUDTBPN",209,0)
 S TMP=$NA(^DGPM("AMV3",X,"~~~"))
"RTN","TIUDTBPN",210,0)
 S TIUNOW=$$NOW^XLFDT
"RTN","TIUDTBPN",211,0)
 ;    sort discharged patients by patient name
"RTN","TIUDTBPN",212,0)
 S STOP=0 F  S TMP=$Q(@TMP) D  Q:STOP
"RTN","TIUDTBPN",213,0)
 . N X,Y,DFN,DATE,PNM
"RTN","TIUDTBPN",214,0)
 . I $QS(TMP,1)'="AMV3" S STOP=1 Q
"RTN","TIUDTBPN",215,0)
 . S DATE=$QS(TMP,2)
"RTN","TIUDTBPN",216,0)
 . S DFN=$QS(TMP,3) S X=$$CK2(DFN) Q:'X  S PNM=$P(X,U,2)
"RTN","TIUDTBPN",217,0)
 . S @GLT@("SORT",TYP,PNM,DFN,DATE)=""
"RTN","TIUDTBPN",218,0)
 . Q
"RTN","TIUDTBPN",219,0)
 S TMP=$NA(@GLT@("SORT",TYP)),STOP=$TR(TMP,")",",")
"RTN","TIUDTBPN",220,0)
 F  S TMP=$Q(@TMP) Q:TMP'[STOP  D
"RTN","TIUDTBPN",221,0)
 . N DATE,DFN,PNM
"RTN","TIUDTBPN",222,0)
 . S PNM=$QS(TMP,5),DFN=$QS(TMP,6),DATE=$QS(TMP,7)
"RTN","TIUDTBPN",223,0)
 . I DATE>TIUNOW S STOP=1 Q
"RTN","TIUDTBPN",224,0)
 . D INPCOM(DFN,DATE)
"RTN","TIUDTBPN",225,0)
 . Q
"RTN","TIUDTBPN",226,0)
 D DSP(,,,1)
"RTN","TIUDTBPN",227,0)
 Q
"RTN","TIUDTBPN",228,0)
 ;
"RTN","TIUDTBPN",229,0)
INPCOM(DFN,DATE) ;
"RTN","TIUDTBPN",230,0)
 N I,X,Y,Z,DIV,HL,PNM,STAT,STATX,VAERR,VAIP,WARD,WNM
"RTN","TIUDTBPN",231,0)
 Q:$G(DFN)<1  Q:$G(DATE)<1
"RTN","TIUDTBPN",232,0)
 S X=$$CK2(DFN) S PNM=$P(X,U,2)
"RTN","TIUDTBPN",233,0)
 S Y=TIUD("TIME") I +$G(DATE),DATE<TIUD("TIME") S Y=DATE
"RTN","TIUDTBPN",234,0)
 S VAIP("D")=Y,VAIP("M")=1
"RTN","TIUDTBPN",235,0)
 D IN5^VADPT S:+$G(VAERR) VAIP(1)="" I 'VAIP(1) Q
"RTN","TIUDTBPN",236,0)
 S WARD=+VAIP(5),WNM=$P(VAIP(5),U,2)
"RTN","TIUDTBPN",237,0)
 S X=$$CK42(WARD),DIV=$P(X,U,3),HL=$P(X,U,4)
"RTN","TIUDTBPN",238,0)
 S X=0 S:+HL X=$$CK44(HL) I 'HL!'X D TOTADD(2) Q  ; no hospital loc
"RTN","TIUDTBPN",239,0)
 I 'TIUD("DIV")  Q:'DIV  Q:'$D(TIUD("DIV",DIV))
"RTN","TIUDTBPN",240,0)
 S STAT=$$NEWNOTE(HL) ;        create the patient's downtime note
"RTN","TIUDTBPN",241,0)
 S STATX=$$STATUS(STAT)
"RTN","TIUDTBPN",242,0)
 D TOTADD(1+(STATX<1))
"RTN","TIUDTBPN",243,0)
 D DSP(PNM,WNM,STATX)
"RTN","TIUDTBPN",244,0)
 D TIUTX(STATX,DFN,PNM,WNM)
"RTN","TIUDTBPN",245,0)
 S ^TMP("TIUDTBPN",$J,"DUPECHK",DFN)=""  ;track inpatients with outpatient appts
"RTN","TIUDTBPN",246,0)
 Q
"RTN","TIUDTBPN",247,0)
 ;
"RTN","TIUDTBPN",248,0)
GETOUT ;
"RTN","TIUDTBPN",249,0)
 N X,DFN,STOP,TIUDSP,TMP,TOTAL,TYP
"RTN","TIUDTBPN",250,0)
 S TYP=3,TOTAL=0 M TIUDSP=HDR
"RTN","TIUDTBPN",251,0)
 S X=TIUD("CLSEL") Q:'X  I X=1,'$O(TIUD("CLSEL",0)) Q
"RTN","TIUDTBPN",252,0)
 S TMP=$NA(^TMP($J,"SDAMA301")) K @TMP S STOP=$TR(TMP,")",",")
"RTN","TIUDTBPN",253,0)
 ;
"RTN","TIUDTBPN",254,0)
 N I,Y,TIUIN
"RTN","TIUDTBPN",255,0)
 S TIUIN(1)=TIUD("TIMS")_";"_TIUD("TIME")
"RTN","TIUDTBPN",256,0)
 I $O(TIUD("CLSEL",0)) S TIUIN(2)="TIUD(""CLSEL"","
"RTN","TIUDTBPN",257,0)
 S TIUIN(3)="R;I;NT"
"RTN","TIUDTBPN",258,0)
 S TIUIN("SORT")="P"
"RTN","TIUDTBPN",259,0)
 S TIUIN("FLDS")="1;2;3;4"
"RTN","TIUDTBPN",260,0)
 S X=$$SDAPI^SDAMA301(.TIUIN)
"RTN","TIUDTBPN",261,0)
 ;I $G(ERRON) W !!!,"SDAMA301 return value: "_X,!!!
"RTN","TIUDTBPN",262,0)
 I X<1 D DSP(,,,1) K @TMP Q  ;print zero count when applicable
"RTN","TIUDTBPN",263,0)
 ;    just get the last appt
"RTN","TIUDTBPN",264,0)
 S DFN=0 F  S DFN=$O(@TMP@(DFN)) Q:'DFN  D
"RTN","TIUDTBPN",265,0)
 . N DATE,HL,HLN,PNM
"RTN","TIUDTBPN",266,0)
 . S DATE=$O(@TMP@(DFN," "),-1)
"RTN","TIUDTBPN",267,0)
 . S X=@TMP@(DFN,DATE)
"RTN","TIUDTBPN",268,0)
 . S Y=$P(X,U,2),HL=+Y,HLN=$P(Y,";",2)
"RTN","TIUDTBPN",269,0)
 . S Y=$P(X,U,4),DFN=+Y,PNM=$P(Y,";",2)
"RTN","TIUDTBPN",270,0)
 . S @GLT@("SORT",TYP,PNM,DFN,DATE)=HL_U_HLN
"RTN","TIUDTBPN",271,0)
 . Q
"RTN","TIUDTBPN",272,0)
 S TMP=$NA(@GLT@("SORT",TYP)),STOP=$TR(TMP,")",",")
"RTN","TIUDTBPN",273,0)
 F  S TMP=$Q(@TMP) Q:TMP'[STOP  S X=@TMP D
"RTN","TIUDTBPN",274,0)
 . N DATE,DFN,HL,HLN,PNM,STAT,STATX
"RTN","TIUDTBPN",275,0)
 . S PNM=$QS(TMP,5),DFN=$QS(TMP,6),DATE=$QS(TMP,7)
"RTN","TIUDTBPN",276,0)
 . S HL=$P(X,U),HLN=$P(X,U,2)
"RTN","TIUDTBPN",277,0)
 . ; don't file outpatient note if patient already had an inpatient note
"RTN","TIUDTBPN",278,0)
 . S STAT=-1 I +HL I '$D(^TMP("TIUDTBPN",$J,"DUPECHK",DFN)) S STAT=$$NEWNOTE(HL)
"RTN","TIUDTBPN",279,0)
 . S STATX=$$STATUS(STAT)
"RTN","TIUDTBPN",280,0)
 . D TOTADD(1+(STATX<1))
"RTN","TIUDTBPN",281,0)
 . D DSP(PNM,HLN,STATX)
"RTN","TIUDTBPN",282,0)
 . D TIUTX(STATX,DFN,PNM,HLN)
"RTN","TIUDTBPN",283,0)
 . Q
"RTN","TIUDTBPN",284,0)
 D DSP(,,,1)
"RTN","TIUDTBPN",285,0)
 Q
"RTN","TIUDTBPN",286,0)
 ;
"RTN","TIUDTBPN",287,0)
 ;===============================================
"RTN","TIUDTBPN",288,0)
 ;               Miscellaneous
"RTN","TIUDTBPN",289,0)
 ;-----------------------------------------------
"RTN","TIUDTBPN",290,0)
CK2(DFN) ;
"RTN","TIUDTBPN",291,0)
 ;   return -1 or dfn^name
"RTN","TIUDTBPN",292,0)
 N I,X,Y,NM
"RTN","TIUDTBPN",293,0)
 S DFN=$G(DFN) I (DFN'=+DFN)!(DFN<1) Q 0
"RTN","TIUDTBPN",294,0)
 S X=$G(@GLT@("F",2,DFN)) I $L(X) Q X
"RTN","TIUDTBPN",295,0)
 S NM=$P($G(^DPT(DFN,0)),U) I NM="" Q 0
"RTN","TIUDTBPN",296,0)
 S X=DFN_U_NM
"RTN","TIUDTBPN",297,0)
 S @GLT@("F",2,DFN)=X
"RTN","TIUDTBPN",298,0)
 Q X
"RTN","TIUDTBPN",299,0)
 ;
"RTN","TIUDTBPN",300,0)
CK42(VAL) ;
"RTN","TIUDTBPN",301,0)
 ;   return -1 file_42_ien ^ 42_name ^ division_ien ^ hosp_loc_ien
"RTN","TIUDTBPN",302,0)
 ;   find1 call assures one and only one entry matching name
"RTN","TIUDTBPN",303,0)
 N I,X,Y,DIV,HL,NM
"RTN","TIUDTBPN",304,0)
 I 0[VAL Q 0
"RTN","TIUDTBPN",305,0)
 S X=$G(@GLT@("F",42,VAL)) I $L(X) Q X
"RTN","TIUDTBPN",306,0)
 I VAL=+VAL,VAL<1 Q 0
"RTN","TIUDTBPN",307,0)
 I VAL'=+VAL S VAL=+$$FIND1(42,,,VAL) Q:VAL<1 0
"RTN","TIUDTBPN",308,0)
 S IEN=VAL_","
"RTN","TIUDTBPN",309,0)
 S NM=$$GET1(42,IEN,.01)
"RTN","TIUDTBPN",310,0)
 S DIV=$$GET1(42,IEN,.015,"I")
"RTN","TIUDTBPN",311,0)
 S HL=$$GET1(42,IEN,44,"I")
"RTN","TIUDTBPN",312,0)
 S X=VAL_U_NM_U_DIV_U_HL
"RTN","TIUDTBPN",313,0)
 S @GLT@("F",42,VAL)=X
"RTN","TIUDTBPN",314,0)
 S @GLT@("F",42,NM)=X
"RTN","TIUDTBPN",315,0)
 Q X
"RTN","TIUDTBPN",316,0)
 ;
"RTN","TIUDTBPN",317,0)
CK44(IEN) ;
"RTN","TIUDTBPN",318,0)
 ;   return -1 or file_44_ien ^ 44_name ^ division
"RTN","TIUDTBPN",319,0)
 N I,X,Y,DIV,IENS,NM
"RTN","TIUDTBPN",320,0)
 I (IEN'=+IEN)!(IEN<1) Q 0
"RTN","TIUDTBPN",321,0)
 S X=$G(@GLT@("F",44,IEN)) I $L(X) Q X
"RTN","TIUDTBPN",322,0)
 S IENS=IEN_","
"RTN","TIUDTBPN",323,0)
 S NM=$$GET1(44,IENS,.01) I NM="" Q 0
"RTN","TIUDTBPN",324,0)
 S DIV=$$GET1(44,IENS,3.5,"I")
"RTN","TIUDTBPN",325,0)
 S X=IEN_U_NM_U_DIV
"RTN","TIUDTBPN",326,0)
 S @GLT@("F",44,IEN)=X
"RTN","TIUDTBPN",327,0)
 Q X
"RTN","TIUDTBPN",328,0)
 ;
"RTN","TIUDTBPN",329,0)
DIC(CH) Q $$DIC^TIUDTBP0(CH)
"RTN","TIUDTBPN",330,0)
 ;
"RTN","TIUDTBPN",331,0)
DIR(CH) Q $$DIR^TIUDTBP0(CH)
"RTN","TIUDTBPN",332,0)
 ;
"RTN","TIUDTBPN",333,0)
DIVISION() Q $$DIVISION^TIUDTBP0
"RTN","TIUDTBPN",334,0)
 ;
"RTN","TIUDTBPN",335,0)
DSP(PNM,LNM,STATX,END) ;  screen display
"RTN","TIUDTBPN",336,0)
 ;  update screen 20 lines at a time
"RTN","TIUDTBPN",337,0)
 N I,L,X,Y
"RTN","TIUDTBPN",338,0)
 S PNM=$G(PNM),LNM=$G(LNM),STATX=$G(STATX),END=+$G(END)
"RTN","TIUDTBPN",339,0)
 I END D
"RTN","TIUDTBPN",340,0)
 . N FAIL S FAIL=+$P(TOTAL,U,2)
"RTN","TIUDTBPN",341,0)
 . S X="Notes created: "_(+TOTAL)
"RTN","TIUDTBPN",342,0)
 . S:FAIL X=X_"     Notes failed to be created: "_FAIL
"RTN","TIUDTBPN",343,0)
 . S I=1+$O(TIUDSP("A"),-1),TIUDSP(I)="",TIUDSP(I+1)=X
"RTN","TIUDTBPN",344,0)
 . S L=20
"RTN","TIUDTBPN",345,0)
 . Q
"RTN","TIUDTBPN",346,0)
 I 'END D
"RTN","TIUDTBPN",347,0)
 . S X=$$DSPFMT(PNM,LNM,STATX)
"RTN","TIUDTBPN",348,0)
 . S L=1+$O(TIUDSP("A"),-1) S TIUDSP(L)=X
"RTN","TIUDTBPN",349,0)
 . Q
"RTN","TIUDTBPN",350,0)
 I L>19 D
"RTN","TIUDTBPN",351,0)
 . S L=+$O(@GLT@("DSP",TYP,"A"),-1)
"RTN","TIUDTBPN",352,0)
 . F I=1:1 Q:'$D(TIUDSP(I))  S X=TIUDSP(I) D
"RTN","TIUDTBPN",353,0)
 . . W:TRM !,X S L=L+1,@GLT@("DSP",TYP,L)=X
"RTN","TIUDTBPN",354,0)
 . . Q
"RTN","TIUDTBPN",355,0)
 . K TIUDSP
"RTN","TIUDTBPN",356,0)
 . Q
"RTN","TIUDTBPN",357,0)
 Q
"RTN","TIUDTBPN",358,0)
 ;
"RTN","TIUDTBPN",359,0)
DSPFMT(PNM,LNM,STATX) ;  format display line
"RTN","TIUDTBPN",360,0)
 N X,SP,TIUDA
"RTN","TIUDTBPN",361,0)
 S $P(SP," ",41)=""
"RTN","TIUDTBPN",362,0)
 S PNM=$G(PNM) S:PNM="" PNM="NoName"
"RTN","TIUDTBPN",363,0)
 S LNM=$G(LNM) S:LNM="" LNM="NoLocation"
"RTN","TIUDTBPN",364,0)
 S STATX=$G(STATX)
"RTN","TIUDTBPN",365,0)
 S TIUDA=$P(STATX,";",2)
"RTN","TIUDTBPN",366,0)
 I +STATX=1 S X="   Yes | "
"RTN","TIUDTBPN",367,0)
 I +STATX=2 S X="Unsign | "
"RTN","TIUDTBPN",368,0)
 I +STATX=0 S X="    No | "
"RTN","TIUDTBPN",369,0)
 I +STATX=-1 S X=" Error  | "
"RTN","TIUDTBPN",370,0)
 S X=X_$E(LNM_SP,1,25)_"  | "_PNM
"RTN","TIUDTBPN",371,0)
 I +$G(ERRON),TIUDA>0 S X=X_" ["_TIUDA_"]"
"RTN","TIUDTBPN",372,0)
 Q X
"RTN","TIUDTBPN",373,0)
 ;
"RTN","TIUDTBPN",374,0)
ESIGCK() ;
"RTN","TIUDTBPN",375,0)
 N X,Y S Y=$$GET1(200,DUZ,20.4,"I") I Y="" D TEXT("T12",1,12)
"RTN","TIUDTBPN",376,0)
 Q Y'=""
"RTN","TIUDTBPN",377,0)
 ;
"RTN","TIUDTBPN",378,0)
FIND1(FILE,IEN,FLG,VAL,IDX,SCR) ;
"RTN","TIUDTBPN",379,0)
 Q $$FIND1^TIUDTBP0(.FILE,.IEN,.FLG,.VAL,.IDX,.SCR)
"RTN","TIUDTBPN",380,0)
 ;
"RTN","TIUDTBPN",381,0)
GET1(FILE,IEN,FLD,FLG) ;
"RTN","TIUDTBPN",382,0)
 Q $$GET1^TIUDTBP0(.FILE,.IEN,.FLD,.FLG)
"RTN","TIUDTBPN",383,0)
 ;
"RTN","TIUDTBPN",384,0)
MAIL() ;
"RTN","TIUDTBPN",385,0)
 N I,X,Y,Z,CNT,GLE,GLX,LIN,NEWFORM,STOP,TIU,TMP
"RTN","TIUDTBPN",386,0)
 N XMDUZ,XMSUB,XMTEXT,XMY
"RTN","TIUDTBPN",387,0)
 S NEWFORM=+$G(EFORM)
"RTN","TIUDTBPN",388,0)
 S GLE=$NA(^TMP("XMERR",$J)) K @GLE
"RTN","TIUDTBPN",389,0)
 S XMDUZ=DUZ
"RTN","TIUDTBPN",390,0)
 S XMSUB="Record of Progress Notes for VistA Downtime"
"RTN","TIUDTBPN",391,0)
 S GLX=$NA(@GLT@("SEND")),XMTEXT=$TR(GLX,")",",")
"RTN","TIUDTBPN",392,0)
 M XMY=TIUD("MAIL")
"RTN","TIUDTBPN",393,0)
 I NEWFORM D
"RTN","TIUDTBPN",394,0)
 . D TEXT("T16",0,0,0,0,,.TIU)
"RTN","TIUDTBPN",395,0)
 . F I=1:1 Q:'$D(TIU(I))  S @GLX@(I,0)=TIU(I)
"RTN","TIUDTBPN",396,0)
 . S L=I-1
"RTN","TIUDTBPN",397,0)
 . Q
"RTN","TIUDTBPN",398,0)
 I 'NEWFORM D
"RTN","TIUDTBPN",399,0)
 . S @GLX@(1,0)="PATIENT NAME^WARD LOCATION^STATUS OF NOTE INSERTION"
"RTN","TIUDTBPN",400,0)
 . S @GLX@(2,0)=" "
"RTN","TIUDTBPN",401,0)
 . S L=2
"RTN","TIUDTBPN",402,0)
 . Q
"RTN","TIUDTBPN",403,0)
 S CNT=0
"RTN","TIUDTBPN",404,0)
 S TMP=$NA(@GLT@("MSG")),STOP=$TR(TMP,")",",")
"RTN","TIUDTBPN",405,0)
 F  S TMP=$Q(@TMP) Q:TMP'[STOP  D
"RTN","TIUDTBPN",406,0)
 . N X,DFN,HLN,PNM,STATX
"RTN","TIUDTBPN",407,0)
 . S PNM=$QS(TMP,4),DFN=$QS(TMP,5),HLN=$QS(TMP,6)
"RTN","TIUDTBPN",408,0)
 . S STATX=@TMP
"RTN","TIUDTBPN",409,0)
 . S X=PNM_U_HLN_U_$P(STATX,";",3)
"RTN","TIUDTBPN",410,0)
 . I NEWFORM S X=$$DSPFMT(PNM,HLN,STATX)
"RTN","TIUDTBPN",411,0)
 . S CNT=CNT+1,L=L+1,@GLX@(L,0)=X
"RTN","TIUDTBPN",412,0)
 . Q
"RTN","TIUDTBPN",413,0)
 I TRM,'CNT W !!,"No patients found who had downtime note created.",!
"RTN","TIUDTBPN",414,0)
 N TMAIL S TMAIL=$S('CNT:0,1:-1)
"RTN","TIUDTBPN",415,0)
 I CNT D
"RTN","TIUDTBPN",416,0)
 . N XMERR,XMMG,XMSTRIP,XMYBLOG,XMZ
"RTN","TIUDTBPN",417,0)
 . S @GLX@(0)=U_U_CNT_U_CNT_U_DT_U_U
"RTN","TIUDTBPN",418,0)
 . D ^XMD I TRM D
"RTN","TIUDTBPN",419,0)
 . . W ! S Y=$L($G(XMMG))
"RTN","TIUDTBPN",420,0)
 . . W:'Y !,"Email notification sent in message number "_XMZ_"."
"RTN","TIUDTBPN",421,0)
 . . W:Y !!,"ERROR: mail message not created",!?5,XMMG,!
"RTN","TIUDTBPN",422,0)
 . . Q
"RTN","TIUDTBPN",423,0)
 . S TMAIL=$G(XMZ)_"^Error: "_$G(XMMG)
"RTN","TIUDTBPN",424,0)
 . Q
"RTN","TIUDTBPN",425,0)
 K @GLE
"RTN","TIUDTBPN",426,0)
 Q TMAIL
"RTN","TIUDTBPN",427,0)
 ;
"RTN","TIUDTBPN",428,0)
NEWNOTE(LOC) ;
"RTN","TIUDTBPN",429,0)
 ;   Create New TIU Note
"RTN","TIUDTBPN",430,0)
 ;   loc = file 44 ien / expects DFN to be defined
"RTN","TIUDTBPN",431,0)
 ;   FINDPAT should have set up @GLT@() for all LOCs
"RTN","TIUDTBPN",432,0)
 ;   Extrinsic return value: -1 ; -1^-1 ; TIUDA ; TIUDA^-1
"RTN","TIUDTBPN",433,0)
 ;     Any place where STAT is referenced it will be this value
"RTN","TIUDTBPN",434,0)
 N I,X,Y,GL,LOCNM,STAT,TIUADM
"RTN","TIUDTBPN",435,0)
 N AUTH,ESBY,TITLE,TIUDT,TYPE
"RTN","TIUDTBPN",436,0)
 M X=TEXT N TEXT
"RTN","TIUDTBPN",437,0)
 S GL=$NA(^TMP("TIUP",$J)) K @GL M @GL=X
"RTN","TIUDTBPN",438,0)
 F X="AUTH","ESBY","TITLE","TYPE" S @X=TIUD(X)
"RTN","TIUDTBPN",439,0)
 S TIUDT=TIUD("NOTEDT")
"RTN","TIUDTBPN",440,0)
 I +$G(LOC) D
"RTN","TIUDTBPN",441,0)
 . S LOCNM=$P($$CK44(LOC),U,2)
"RTN","TIUDTBPN",442,0)
 . S I=1+$O(@GL@("A"),-1),@GL@(I,0)=" "
"RTN","TIUDTBPN",443,0)
 . S X="Patient location at the conclusion of the downtime: "_LOCNM
"RTN","TIUDTBPN",444,0)
 . S I=I+1,@GL@(I,0)=X
"RTN","TIUDTBPN",445,0)
 . S $P(@GL@(0),U,3,4)=I_U_I
"RTN","TIUDTBPN",446,0)
 . Q
"RTN","TIUDTBPN",447,0)
 ;  TIUPNAPI is expecting note to be in ^TMP("TIUP",$J,n,0)
"RTN","TIUDTBPN",448,0)
 I TYPE="E" D NEW^TIUPNAPI(.STAT,DFN,AUTH,TIUDT,TITLE,LOC,0,0,ESBY)
"RTN","TIUDTBPN",449,0)
 I TYPE="A" D NEW^TIUPNAPI(.STAT,DFN,AUTH,TIUDT,TITLE,LOC)
"RTN","TIUDTBPN",450,0)
 S X=STAT,$P(X,U,3)=ESBY
"RTN","TIUDTBPN",451,0)
 I STAT>0,TYPE="A" D ADMNCLOS^TIUSRVPT(.TIUADM,+STAT,"M")
"RTN","TIUDTBPN",452,0)
 K @GL
"RTN","TIUDTBPN",453,0)
 Q STAT
"RTN","TIUDTBPN",454,0)
 ;
"RTN","TIUDTBPN",455,0)
QUEUE ;
"RTN","TIUDTBPN",456,0)
 N X,Y,DESC,OTH,RTN,VAR,ZTSK
"RTN","TIUDTBPN",457,0)
 S RTN="EN^TIUDTBPN"
"RTN","TIUDTBPN",458,0)
 S DESC="TIU Contingency Downtime Bookmark Progress Notes"
"RTN","TIUDTBPN",459,0)
 S VAR="TIUD(;TEXT("
"RTN","TIUDTBPN",460,0)
 S:$D(EFORM) VAR=VAR_";EFORM" S:$D(ERRON) VAR=VAR_";ERRON"
"RTN","TIUDTBPN",461,0)
 S OTH("ZTDTH")=$H
"RTN","TIUDTBPN",462,0)
 S ZTSK=$$NODEV^XUTMDEVQ(RTN,DESC,VAR,.OTH,1)
"RTN","TIUDTBPN",463,0)
 Q
"RTN","TIUDTBPN",464,0)
 ;
"RTN","TIUDTBPN",465,0)
STATUS(TIUDA) ;
"RTN","TIUDTBPN",466,0)
 ;   TIUDA can be ien, -1, ien^-1, -1^-1
"RTN","TIUDTBPN",467,0)
 ;   Return:  -1/0/1/2 ; note_ien or -1 ; format text
"RTN","TIUDTBPN",468,0)
 N Y,TIUDA,TXT
"RTN","TIUDTBPN",469,0)
 S STAT=$G(STAT),TIUDA=+STAT
"RTN","TIUDTBPN",470,0)
 I STAT'["-1" S TXT="Successful",Y=1
"RTN","TIUDTBPN",471,0)
 I '$D(TXT),TIUDA=-1 S TXT="Unsuccessful",Y=0
"RTN","TIUDTBPN",472,0)
 I '$D(TXT),TIUDA>0,STAT["-1" S TXT="Successful/unsigned",Y=2
"RTN","TIUDTBPN",473,0)
 I '$D(TXT) S TXT="Error",Y=-1
"RTN","TIUDTBPN",474,0)
 S:$G(ERRON) TXT=TXT_" ["_STAT_"]"
"RTN","TIUDTBPN",475,0)
 Q Y_";"_TIUDA_";"_TXT
"RTN","TIUDTBPN",476,0)
 ;
"RTN","TIUDTBPN",477,0)
TEXT(TAG,WR,LF,CLR,PAD,CHR,TIUR) ;     Generic Text Handler
"RTN","TIUDTBPN",478,0)
 ; TAG - line label containing the text
"RTN","TIUDTBPN",479,0)
 ;       all groups of text should end with ' ;;---'
"RTN","TIUDTBPN",480,0)
 ;  WR - Boolean, write or do not write
"RTN","TIUDTBPN",481,0)
 ;  LF - 0:no extra line feeds; 1:leading line feed; 2:trailing feed
"RTN","TIUDTBPN",482,0)
 ; CLR - Boolean, clear screen first
"RTN","TIUDTBPN",483,0)
 ; PAD - number of spaces begin each line with
"RTN","TIUDTBPN",484,0)
 ;       If PAD="" then default to 3.  If PAD=0 then no padding
"RTN","TIUDTBPN",485,0)
 ; CHR - for center justify, character to pad line, default is space
"RTN","TIUDTBPN",486,0)
 S TAG=$G(TAG),WR=+$G(WR),LF=+$G(LF),CLR=+$G(CLR)
"RTN","TIUDTBPN",487,0)
 S CHR=$G(CHR) S:CHR="" CHR=" "
"RTN","TIUDTBPN",488,0)
 S PAD=$G(PAD) I PAD'?1.N S PAD=3
"RTN","TIUDTBPN",489,0)
 D TEXT^TIUDTBP0(TAG,WR,LF,CLR,PAD,CHR,.TIUR)
"RTN","TIUDTBPN",490,0)
 Q
"RTN","TIUDTBPN",491,0)
 ;
"RTN","TIUDTBPN",492,0)
TIUTX(STATX,DFN,PNM,LNM) ;  text for mail message
"RTN","TIUDTBPN",493,0)
 ;    statx =  -1/0/1/2 ; note_ien or -1 ; format text
"RTN","TIUDTBPN",494,0)
 N I,X
"RTN","TIUDTBPN",495,0)
 Q:'$G(DFN)  Q:'$L($G(PNM))  Q:'$L($G(LNM))
"RTN","TIUDTBPN",496,0)
 S I=1+$O(@GLT@("MSG",PNM,DFN,LNM,"A"),-1)
"RTN","TIUDTBPN",497,0)
 S @GLT@("MSG",PNM,DFN,LNM,I)=$G(STATX)
"RTN","TIUDTBPN",498,0)
 Q
"RTN","TIUPSCA")
0^1^B18892982^n/a
"RTN","TIUPSCA",1,0)
TIUPSCA ;BPOIFO/EL/CR - TIU DOCUMENT POST SIGNATURE ALERTS ;12/18/17 3:59pm
"RTN","TIUPSCA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIUPSCA",3,0)
 ;
"RTN","TIUPSCA",4,0)
 ; External Reference DBIA#:
"RTN","TIUPSCA",5,0)
 ; -------------------------
"RTN","TIUPSCA",6,0)
 ; #1252  - Reference to OUTPTPR^SDUTL3 (Supported)
"RTN","TIUPSCA",7,0)
 ; #2056  - Reference to GET1^DIQ (supported)
"RTN","TIUPSCA",8,0)
 ; #2263  - Reference to GET^XPAR (Supported)
"RTN","TIUPSCA",9,0)
 ; #6811  - Reference to file #100.21 (Private)
"RTN","TIUPSCA",10,0)
 ; #10035 - Reference to file #2  (Supported)
"RTN","TIUPSCA",11,0)
 ; #10061 - Reference to KVA^VADPT (Supported)
"RTN","TIUPSCA",12,0)
 ; #10103 - Reference to FMTE^XLFDT (Supported)
"RTN","TIUPSCA",13,0)
 ; #10103 - Reference to NOW^XLFDT (Supported)
"RTN","TIUPSCA",14,0)
 ; #10081 - Reference to SETUP1^XQALERT (Supported)
"RTN","TIUPSCA",15,0)
 ;
"RTN","TIUPSCA",16,0)
 ; This routine expects the following variables to be defined in the 
"RTN","TIUPSCA",17,0)
 ; local symbol table:
"RTN","TIUPSCA",18,0)
 ; TIUTTL  - IEN of the just-signed TIU DOCUMENT DEFINITION 
"RTN","TIUPSCA",19,0)
 ;           as found in file #8925.1
"RTN","TIUPSCA",20,0)
 ; DA      - IEN of the just-signed TIU DOCUMENT as found in file #8925
"RTN","TIUPSCA",21,0)
 ; DFN     - IEN of the PATIENT associated with the just-signed
"RTN","TIUPSCA",22,0)
 ;           TIU DOCUMENT as found in file #2
"RTN","TIUPSCA",23,0)
 ; TIUXQA  - TIUXQA in TIUPSCS  (mail group recipient)
"RTN","TIUPSCA",24,0)
 ; TIUSPEC - TIUSPEC in TIUPSCS (API for alert)
"RTN","TIUPSCA",25,0)
 ; TIUDEV  - TIUDEV in TIUPSCS (DEVICE to send alert to) 
"RTN","TIUPSCA",26,0)
 ;
"RTN","TIUPSCA",27,0)
 ;
"RTN","TIUPSCA",28,0)
AUTOPRT ; generate note to location based chart copy printer
"RTN","TIUPSCA",29,0)
 N TIUTIU,TIUTOFP
"RTN","TIUPSCA",30,0)
 S (TIUTIU,TIUTOFP)=""
"RTN","TIUPSCA",31,0)
 S TIUTIU=$S($G(TIU12)]"":TIU12,$G(TIUD12)]"":TIUD12,1:"")
"RTN","TIUPSCA",32,0)
 Q:'+TIUTIU
"RTN","TIUPSCA",33,0)
 ; get external name of printer below
"RTN","TIUPSCA",34,0)
 S TIUTOFP=$$GET^XPAR($P(TIUTIU,U,5)_";SC(","ORPF CHART COPY PRINT DEVICE",,"E")
"RTN","TIUPSCA",35,0)
 ;I +TIUTOFP S TIUTOFP=$P(^%ZIS(1,TIUTOFP,0),U)
"RTN","TIUPSCA",36,0)
 Q:TIUTOFP']""
"RTN","TIUPSCA",37,0)
 D RPC^TIUPD(.TIU,DA,TIUTOFP,2)
"RTN","TIUPSCA",38,0)
 Q
"RTN","TIUPSCA",39,0)
 ;
"RTN","TIUPSCA",40,0)
CLEAN ;
"RTN","TIUPSCA",41,0)
 K XQA
"RTN","TIUPSCA",42,0)
 Q
"RTN","TIUPSCA",43,0)
 ;
"RTN","TIUPSCA",44,0)
DEVP ;
"RTN","TIUPSCA",45,0)
 W !,TIUMSG
"RTN","TIUPSCA",46,0)
 Q
"RTN","TIUPSCA",47,0)
 ;
"RTN","TIUPSCA",48,0)
EN(TIUXQA,TIUSPEC,TIUDEV) ;
"RTN","TIUPSCA",49,0)
 N TIU,TIUDEVG,TIUDFN,TIUFOUR,TIUGO,TIUGRP,TIULOC,TIUMSG
"RTN","TIUPSCA",50,0)
 N TIUPTNM,TIUTDEV,TIUTEAM,TIUTIEN,TIUTITL,TIUUSER,VAIN
"RTN","TIUPSCA",51,0)
 N TIUPCP,TIUATT,TIUEND,TIULINE,TIULNUM,TIUPLUS
"RTN","TIUPSCA",52,0)
 N X,XQADATA,XQAID,XQAMSG,XQAROU
"RTN","TIUPSCA",53,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","TIUPSCA",54,0)
 S (TIU,TIUDEVG,TIUDFN,TIUEND,TIUFOUR,TIUGO,TIUGRP,TIULOC,TIUMSG)=""
"RTN","TIUPSCA",55,0)
 S (TIUPTNM,TIUTDEV,TIUTEAM,TIUTIEN,TIUTITL,TIUUSER,VAIN)=""
"RTN","TIUPSCA",56,0)
 S (X,XQADATA,XQAID,XQAMSG,XQAROU)=""
"RTN","TIUPSCA",57,0)
 S (ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE)=""
"RTN","TIUPSCA",58,0)
 ;
"RTN","TIUPSCA",59,0)
 S (DFN,TIUDFN)=$$GET1^DIQ(8925,DA,.02,"I") ; don't count on existing DFN
"RTN","TIUPSCA",60,0)
 D RECIP
"RTN","TIUPSCA",61,0)
 ;
"RTN","TIUPSCA",62,0)
 S TIUTITL=$$GET1^DIQ(8925.1,TIUTTL,.01)
"RTN","TIUPSCA",63,0)
 ;
"RTN","TIUPSCA",64,0)
 S TIUPTNM=$$GET1^DIQ(2,TIUDFN,.01)
"RTN","TIUPSCA",65,0)
 S TIUFOUR=" ("_$E(TIUPTNM)_$E($$GET1^DIQ(2,TIUDFN,.09),6,9)_") "
"RTN","TIUPSCA",66,0)
 S TIULOC=$$LOC D KVA^VADPT
"RTN","TIUPSCA",67,0)
 S XQAID="TIUADD"_+DA,XQADATA=DA_U
"RTN","TIUPSCA",68,0)
 S XQAROU="ACT^TIUALRT"
"RTN","TIUPSCA",69,0)
 S TIUGO=1
"RTN","TIUPSCA",70,0)
 I $G(TIUSPEC)]"" I $L($T(@TIUSPEC)) D @TIUSPEC
"RTN","TIUPSCA",71,0)
 ; get the primary care provider for the patient, if assigned
"RTN","TIUPSCA",72,0)
 I $G(TIUSPEC)="PCP" D
"RTN","TIUPSCA",73,0)
 . S TIUPCP=$P($$OUTPTPR^SDUTL3(DFN,DT,1),U,1) ; get PCP's DUZ
"RTN","TIUPSCA",74,0)
 . I TIUPCP S XQA(TIUPCP)=""
"RTN","TIUPSCA",75,0)
 ;
"RTN","TIUPSCA",76,0)
 I '$D(XQA) S XQA(DUZ)="" ; default so that the alert can still be sent
"RTN","TIUPSCA",77,0)
 S XQAMSG=TIUPTNM_TIUFOUR_TIULOC_" ("_$$FMTE^XLFDT($$NOW^XLFDT,"2D")
"RTN","TIUPSCA",78,0)
 S XQAMSG=XQAMSG_"): "_TIUTITL_$S($G(TIUEND)]"":" "_TIUEND_".",1:" signed.")
"RTN","TIUPSCA",79,0)
 I $G(TIUDEV)]"" D
"RTN","TIUPSCA",80,0)
 . S TIU=""
"RTN","TIUPSCA",81,0)
 . D RPC^TIUPD(.TIU,DA,TIUDEV,2)
"RTN","TIUPSCA",82,0)
 S TIUMSG=XQAMSG
"RTN","TIUPSCA",83,0)
 I $G(TIUGO)=1 S X=$$SETUP1^XQALERT ; I 'XQALERR W !,"Alert Error: ",XQALERR
"RTN","TIUPSCA",84,0)
 I $G(TIUDEVG)=1 S ZTSAVE("TIUMSG")="" D ^%ZTLOAD
"RTN","TIUPSCA",85,0)
 D CLEAN
"RTN","TIUPSCA",86,0)
 Q
"RTN","TIUPSCA",87,0)
 ;
"RTN","TIUPSCA",88,0)
GETRTN(TIUARY) ; compile array of SUBROUTINE for TIU Document Definition Code
"RTN","TIUPSCA",89,0)
 N I,X
"RTN","TIUPSCA",90,0)
 S (I,X)="",(I,TIUARY)=0
"RTN","TIUPSCA",91,0)
 F I=1:1 D  Q:$G(I)="STOP"
"RTN","TIUPSCA",92,0)
 . S X=$P($T(RTNLST+I),";;",2)
"RTN","TIUPSCA",93,0)
 . I $G(X)="" S I="STOP" Q
"RTN","TIUPSCA",94,0)
 . S TIUARY=I,TIUARY(I)=$E(X,1,70)
"RTN","TIUPSCA",95,0)
 Q TIUARY
"RTN","TIUPSCA",96,0)
 ;
"RTN","TIUPSCA",97,0)
LOC() ; WARD Location: Int^Ext (nn^LOC)
"RTN","TIUPSCA",98,0)
 D INP^VADPT
"RTN","TIUPSCA",99,0)
 Q $S(VAIN(4)]"":"["_$P(VAIN(4),U,2)_"]",1:"")
"RTN","TIUPSCA",100,0)
 ;
"RTN","TIUPSCA",101,0)
RECIP ; determine alert recipients
"RTN","TIUPSCA",102,0)
 ; the patient IEN is kept by TIUDFN, title ien is TIUTTL
"RTN","TIUPSCA",103,0)
 I TIUXQA=+TIUXQA S XQA(TIUXQA)="" ; individual user
"RTN","TIUPSCA",104,0)
 I TIUXQA["G." S XQA(TIUXQA)="" ; mail group
"RTN","TIUPSCA",105,0)
 ;
"RTN","TIUPSCA",106,0)
 I TIUXQA["T." D  ; TEAM LIST
"RTN","TIUPSCA",107,0)
 . S TIUTEAM=$P(TIUXQA,".",2),TIUTIEN=$O(^OR(100.21,"B",TIUTEAM,0)) Q:'+TIUTIEN
"RTN","TIUPSCA",108,0)
 . ; ** EL **
"RTN","TIUPSCA",109,0)
 . S TIUUSER=0
"RTN","TIUPSCA",110,0)
 . F  S TIUUSER=$O(^OR(100.21,TIUTIEN,1,TIUUSER)) Q:'+TIUUSER  D  ;OE/RR team members
"RTN","TIUPSCA",111,0)
 .. S XQA(TIUUSER)=""
"RTN","TIUPSCA",112,0)
 . ; ** EL **
"RTN","TIUPSCA",113,0)
 . S TIUTDEV=$$GET1^DIQ(100.21,TIUTIEN,1.5,"I") I +TIUTDEV D  ; OE/RR team device
"RTN","TIUPSCA",114,0)
 .. S ZTIO="`"_TIUTDEV,ZTDTH=$$NOW^XLFDT
"RTN","TIUPSCA",115,0)
 .. S ZTDESC="TIU Document Post-Signature Alert",ZTRTN="DEVP^TIUPSCA"
"RTN","TIUPSCA",116,0)
 .. S TIUDEVG=1
"RTN","TIUPSCA",117,0)
 Q
"RTN","TIUPSCA",118,0)
 ;
"RTN","TIUPSCA",119,0)
RTNLST ; SUBROUTINE listing as ";;API-Description (upto 70 chars)"
"RTN","TIUPSCA",120,0)
 ;;N/A-No Conditional Alert is needed
"RTN","TIUPSCA",121,0)
 ;;PCP-Include patient's Primary Care Provider from PCMM as a recipient
"RTN","TIUPSCA",122,0)
 ;;AUTOPRT-Generate message to chart copy printer at encounter location
"RTN","TIUPSCA",123,0)
 ;
"RTN","TIUPSCA",124,0)
 Q
"RTN","TIUPSCS")
0^2^B68716783^n/a
"RTN","TIUPSCS",1,0)
TIUPSCS ;BPOIFO/EL/CR - TIU DOCUMENT POST-SIGNATURE ALERT SETUP ;10/29/17 8:15am
"RTN","TIUPSCS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIUPSCS",3,0)
 ;
"RTN","TIUPSCS",4,0)
 ; External Reference DBIA#:
"RTN","TIUPSCS",5,0)
 ; -------------------------
"RTN","TIUPSCS",6,0)
 ; #2056  - $$GET1^DIQ call (Supported)
"RTN","TIUPSCS",7,0)
 ; #6811  - Reference to file #100.21 (Private)
"RTN","TIUPSCS",8,0)
 ; #10006 - DIC call (Supported)
"RTN","TIUPSCS",9,0)
 ; #10026 - DIR call (Supported) 
"RTN","TIUPSCS",10,0)
 ; #10060 - Reference to file 200 (Supported)
"RTN","TIUPSCS",11,0)
 ; #10111 - Reference to file 3.8 (Supported)
"RTN","TIUPSCS",12,0)
 Q
"RTN","TIUPSCS",13,0)
 ;
"RTN","TIUPSCS",14,0)
BUILD ;
"RTN","TIUPSCS",15,0)
 ; allow a CAC to setup the title for post-signature alerts - a controlled situation
"RTN","TIUPSCS",16,0)
 S ^TIU(8925.1,TIUIEN,4.9)=TIUDR
"RTN","TIUPSCS",17,0)
 W !!,"The Post-Signature code for '"_$$GET1^DIQ(TIUFLE,TIUIEN,.01)_"' has been updated as follows..."
"RTN","TIUPSCS",18,0)
 W !,"POST-SIGNATURE CODE: "_$$GET1^DIQ(TIUFLE,TIUIEN,4.9)
"RTN","TIUPSCS",19,0)
 Q
"RTN","TIUPSCS",20,0)
 ;
"RTN","TIUPSCS",21,0)
CONFIRM ;
"RTN","TIUPSCS",22,0)
 S (TIUDR,Y)=""
"RTN","TIUPSCS",23,0)
 I TIUXQA=+TIUXQA S TIUDR="D EN^TIUPSCA("_TIUXQA_","""_$G(TIUSPEC)_""","""_$G(TIUDEV)_""")"
"RTN","TIUPSCS",24,0)
 E  S TIUDR="D EN^TIUPSCA("""_TIUXQA_""","""_$G(TIUSPEC)_""","""_$G(TIUDEV)_""")"
"RTN","TIUPSCS",25,0)
 W !!,"The Post-Signature code for '"_TIUNAME_"' will be set as follows..."
"RTN","TIUPSCS",26,0)
 W !,"POST-SIGNATURE CODE: "_TIUDR,!
"RTN","TIUPSCS",27,0)
 S DIR("T")=TIUWAIT
"RTN","TIUPSCS",28,0)
 S DIR(0)="Y"
"RTN","TIUPSCS",29,0)
 S DIR("A")="Do you want to update Post-Signature Code into '"_TIUNAME_"'"
"RTN","TIUPSCS",30,0)
 S DIR("B")="NO"
"RTN","TIUPSCS",31,0)
 D ^DIR K DIR
"RTN","TIUPSCS",32,0)
 I $D(DIRUT)!'$G(Y) D  S TIUGO=0 Q
"RTN","TIUPSCS",33,0)
 . W !!,"No action has been taken!!"
"RTN","TIUPSCS",34,0)
 Q
"RTN","TIUPSCS",35,0)
 ;
"RTN","TIUPSCS",36,0)
DEL ; use to clean up an existing setup
"RTN","TIUPSCS",37,0)
 S DIR("T")=TIUWAIT
"RTN","TIUPSCS",38,0)
 S DIR(0)="Y"
"RTN","TIUPSCS",39,0)
 S DIR("A")="Do you want to delete Post-Signature Code from '"_TIUNAME_"'"
"RTN","TIUPSCS",40,0)
 S DIR("B")="NO"
"RTN","TIUPSCS",41,0)
 D ^DIR K DIR
"RTN","TIUPSCS",42,0)
 I $D(DIRUT)!'$G(Y) D  S TIUGO=0 Q
"RTN","TIUPSCS",43,0)
 . W !!,"No action has been taken!!"
"RTN","TIUPSCS",44,0)
 ; allow a CAC to delete a setup when needed - a controlled situation
"RTN","TIUPSCS",45,0)
 S ^TIU(8925.1,TIUIEN,4.9)=""
"RTN","TIUPSCS",46,0)
 W !,"... Deleted ..."
"RTN","TIUPSCS",47,0)
 H 1
"RTN","TIUPSCS",48,0)
 Q
"RTN","TIUPSCS",49,0)
 ;
"RTN","TIUPSCS",50,0)
DEVICE ;
"RTN","TIUPSCS",51,0)
 W !
"RTN","TIUPSCS",52,0)
 S (TIUDEV,Y)=""
"RTN","TIUPSCS",53,0)
 S DIC=3.5,DIC(0)="AEMQ",DIC("A")="DEVICE NAME (Optional) for Paper Alert: "
"RTN","TIUPSCS",54,0)
 D ^DIC K DIC
"RTN","TIUPSCS",55,0)
 I $D(DUOUT)!$D(DTOUT) D  S TIUGO=0 G DEVQ
"RTN","TIUPSCS",56,0)
 . W !!,"ABORT DEVICE - No action is taken."
"RTN","TIUPSCS",57,0)
 I $G(Y)>0 S TIUDEV=$P(Y,U,2)
"RTN","TIUPSCS",58,0)
DEVQ ;
"RTN","TIUPSCS",59,0)
 Q
"RTN","TIUPSCS",60,0)
 ;
"RTN","TIUPSCS",61,0)
EN ; entry point for the option [TIUFPC CREATE POST-SIGNATURE] 
"RTN","TIUPSCS",62,0)
 N DA,DIROUT,DIRUT,DR,DTOUT,DUOUT
"RTN","TIUPSCS",63,0)
 N H1,H2,I,J,STOP,TIUDEV,TIUFILE,TIUFLD,TIUFLE,TIUGO,TIUIE,TIUIEN
"RTN","TIUPSCS",64,0)
 N TIUNAME,TIUPREV,TIURTN,TIUSPEC,TIUST,TIUWAIT,TIUWHO,TIUXQA
"RTN","TIUPSCS",65,0)
 N X,Y,Z,Z1,Z2,ZZ,ZZIEN
"RTN","TIUPSCS",66,0)
 ;
"RTN","TIUPSCS",67,0)
 S TIUWAIT=30
"RTN","TIUPSCS",68,0)
 I $G(DTIME)'="" S TIUWAIT=DTIME
"RTN","TIUPSCS",69,0)
 S TIUFLE=8925.1
"RTN","TIUPSCS",70,0)
 S STOP=0,TIUGO=1
"RTN","TIUPSCS",71,0)
 I '$D(U) S U="^"
"RTN","TIUPSCS",72,0)
 ;
"RTN","TIUPSCS",73,0)
EN10 ;
"RTN","TIUPSCS",74,0)
 I $G(STOP)=1 Q
"RTN","TIUPSCS",75,0)
 D INTRO
"RTN","TIUPSCS",76,0)
 W ! D GETTITLE Q:$G(STOP)=1  I $G(TIUGO)=0 D STOP G EN10
"RTN","TIUPSCS",77,0)
 W ! D WHO I $G(TIUGO)=0 D STOP G EN10
"RTN","TIUPSCS",78,0)
 W ! D SUBROUT I $G(TIUGO)=0 D STOP G EN10
"RTN","TIUPSCS",79,0)
 W ! D DEVICE I $G(TIUGO)=0 D STOP G EN10
"RTN","TIUPSCS",80,0)
 W ! D CONFIRM I $G(TIUGO)=0 D STOP G EN10
"RTN","TIUPSCS",81,0)
 W ! D BUILD D STOP
"RTN","TIUPSCS",82,0)
 G EN10
"RTN","TIUPSCS",83,0)
 ;
"RTN","TIUPSCS",84,0)
GETFLD(TIUFLE,TIUIEN,TIUFLD,TIUIE) ; Get field value
"RTN","TIUPSCS",85,0)
 K ZZ S (Z,ZZIEN)=""
"RTN","TIUPSCS",86,0)
 S ZZIEN=TIUIEN_","
"RTN","TIUPSCS",87,0)
 D GETS^DIQ(TIUFLE,ZZIEN,TIUFLD,TIUIE,"ZZ")
"RTN","TIUPSCS",88,0)
 S Z=$G(ZZ(TIUFLE,ZZIEN,TIUFLD,TIUIE))
"RTN","TIUPSCS",89,0)
 Q $G(Z)
"RTN","TIUPSCS",90,0)
 ;
"RTN","TIUPSCS",91,0)
GETTITLE ;
"RTN","TIUPSCS",92,0)
 S (TIUIEN,TIUNAME,Y)=""
"RTN","TIUPSCS",93,0)
 S TIUGO=1
"RTN","TIUPSCS",94,0)
 S DIC=TIUFLE,DIC(0)="AEMQ"
"RTN","TIUPSCS",95,0)
 D ^DIC K DIC
"RTN","TIUPSCS",96,0)
 I $G(Y)'>0!$D(DTOUT)!$D(DUOUT) S TIUGO=0,STOP=1 Q
"RTN","TIUPSCS",97,0)
 S TIUIEN=+$G(Y),TIUNAME=$P(Y,U,2)
"RTN","TIUPSCS",98,0)
 ; lock the title to be updated, the lock is released at the end the setup at tag STOP
"RTN","TIUPSCS",99,0)
 L +^TIU(TIUFLE,TIUIEN):1 E  W !!,"Someone else is editing this record, try again later.",! S STOP=1 Q 
"RTN","TIUPSCS",100,0)
 ; Check Class
"RTN","TIUPSCS",101,0)
 S (TIUFLD,TIUIE,Z)=""
"RTN","TIUPSCS",102,0)
 S TIUGO=1
"RTN","TIUPSCS",103,0)
 S TIUFLD=.13,TIUIE="I"
"RTN","TIUPSCS",104,0)
 S Z=$$GETFLD(TIUFLE,TIUIEN,TIUFLD,TIUIE)
"RTN","TIUPSCS",105,0)
 I +$G(Z)>0 D  S TIUGO=0 Q
"RTN","TIUPSCS",106,0)
 . W !!,"NATIONAL STANDARD Document Type cannot be edited."
"RTN","TIUPSCS",107,0)
 S TIUFLD=.04,TIUIE="I"
"RTN","TIUPSCS",108,0)
 S Z=$$GETFLD(TIUFLE,TIUIEN,TIUFLD,TIUIE)
"RTN","TIUPSCS",109,0)
 I $G(Z)'="DOC" D  S TIUGO=0 Q
"RTN","TIUPSCS",110,0)
 . W !!,"Only Document Title is allowed to be edited."
"RTN","TIUPSCS",111,0)
 ;
"RTN","TIUPSCS",112,0)
 ; Check Inherit
"RTN","TIUPSCS",113,0)
 S (TIUPREV)=""
"RTN","TIUPSCS",114,0)
 S TIUGO=1
"RTN","TIUPSCS",115,0)
 S TIUPREV=$$POSTSIGN^TIULC1(TIUIEN)
"RTN","TIUPSCS",116,0)
 I $G(TIUPREV)="" G STATUS
"RTN","TIUPSCS",117,0)
 ; once the title has been set up for the post-sig alert, get the closing ')'
"RTN","TIUPSCS",118,0)
 ; at the end of the parameters list
"RTN","TIUPSCS",119,0)
 I $E(TIUPREV,$L(TIUPREV))'=")" D  S TIUGO=0 Q
"RTN","TIUPSCS",120,0)
 .  W !!,"This application cannot alter more than one alert call at a time."
"RTN","TIUPSCS",121,0)
 .  W !,"It is --> ",TIUPREV
"RTN","TIUPSCS",122,0)
 I $P(TIUPREV,"(")="D EN^TIUPSCA" D  G STATUS
"RTN","TIUPSCS",123,0)
 .  W !!,"The POST-SIGNATURE Code in '"_TIUNAME_"' was created by this option."
"RTN","TIUPSCS",124,0)
 .  W !,"It is --> ",TIUPREV
"RTN","TIUPSCS",125,0)
 .  S DIR("A")="Do you want to change the Code? (YES or NO)"
"RTN","TIUPSCS",126,0)
 .  S DIR("T")=TIUWAIT
"RTN","TIUPSCS",127,0)
 .  S DIR(0)="Y"
"RTN","TIUPSCS",128,0)
 .  S DIR("B")="NO"
"RTN","TIUPSCS",129,0)
 .  W ! D ^DIR K DIR
"RTN","TIUPSCS",130,0)
 .  I $D(DIRUT)!($D(DTOUT))!('$G(Y)) S TIUGO=0
"RTN","TIUPSCS",131,0)
 I $G(TIUPREV)]"" D  S TIUGO=0 G STATUS
"RTN","TIUPSCS",132,0)
 . W !!,"The POST-SIGNATURE Code in '"_TIUNAME_"' was already set by another option."
"RTN","TIUPSCS",133,0)
 . W !,"It is --> ",TIUPREV
"RTN","TIUPSCS",134,0)
 . W !,"This Post-Signature Code cannot be altered in this option."
"RTN","TIUPSCS",135,0)
 . W !,"To change the code, please contact your local IT Support Programmer."
"RTN","TIUPSCS",136,0)
 . W !,"'Document Definitions (Manager) / Edit Document' option can be used."
"RTN","TIUPSCS",137,0)
 ;
"RTN","TIUPSCS",138,0)
STATUS ; Check
"RTN","TIUPSCS",139,0)
 I TIUGO=0 Q
"RTN","TIUPSCS",140,0)
 S (TIUFLD,TIUIE,TIUST,Y,Z)=""
"RTN","TIUPSCS",141,0)
 S TIUFLD=.07,TIUIE="I"
"RTN","TIUPSCS",142,0)
 S Z=$$GETFLD(TIUFLE,TIUIEN,TIUFLD,TIUIE),TIUST=$G(Z)
"RTN","TIUPSCS",143,0)
 I $G(Z)=11 Q
"RTN","TIUPSCS",144,0)
 S TIUIE="E",Z=$$GETFLD(TIUFLE,TIUIEN,TIUFLD,TIUIE),TIUST=$G(Z)
"RTN","TIUPSCS",145,0)
 W !!,"The STATUS of this Document Definition Title is '"_TIUST_"'."
"RTN","TIUPSCS",146,0)
 S DIR("A")="Do you want to continue with this title: '"_TIUNAME_"'"
"RTN","TIUPSCS",147,0)
 S DIR("T")=TIUWAIT
"RTN","TIUPSCS",148,0)
 S DIR(0)="Y"
"RTN","TIUPSCS",149,0)
 S DIR("B")="NO"
"RTN","TIUPSCS",150,0)
 W ! D ^DIR K DIR
"RTN","TIUPSCS",151,0)
 I $D(DIRUT)!('$G(Y)) S TIUGO=0 Q
"RTN","TIUPSCS",152,0)
 Q
"RTN","TIUPSCS",153,0)
 ;
"RTN","TIUPSCS",154,0)
INTRO ;
"RTN","TIUPSCS",155,0)
 W @IOF
"RTN","TIUPSCS",156,0)
 W !,"This option will setup 'Post-Signature Code Alerts' for PROGRESS NOTES."
"RTN","TIUPSCS",157,0)
 W !,"Please select a choice of RECIPIENTS, and a choice of ROUTINE,"
"RTN","TIUPSCS",158,0)
 W !,"and DEVICE (optional) to receive a printed alert upon note signature."
"RTN","TIUPSCS",159,0)
 W !!,"If both RECIPIENTS and ROUTINE are N/A, a choice of"
"RTN","TIUPSCS",160,0)
 W !,"DELETION or CANCELLATION for the Code Alert setting will be provided.",!!
"RTN","TIUPSCS",161,0)
 S (DA,DIC,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT)=""
"RTN","TIUPSCS",162,0)
 S (H1,H2,I,J,STOP,TIUDEV,TIUFILE,TIUFLD,TIUGO,TIUIE,TIUIEN)=""
"RTN","TIUPSCS",163,0)
 S (TIUNAME,TIUPREV,TIURTN,TIUSPEC,TIUST,TIUWHO,TIUXQA)=""
"RTN","TIUPSCS",164,0)
 S (X,Y,Z,Z1,Z2,ZZ,ZZIEN)=""
"RTN","TIUPSCS",165,0)
 ;
"RTN","TIUPSCS",166,0)
HD ; Header for Enter Post-Signature Code
"RTN","TIUPSCS",167,0)
 S STOP=0,TIUGO=1
"RTN","TIUPSCS",168,0)
 S (H1,H2,I)=""
"RTN","TIUPSCS",169,0)
 S H1="Enter Post-Signature Code for Alert"
"RTN","TIUPSCS",170,0)
 F I=1:1:$L(H1) S H2=H2_"="
"RTN","TIUPSCS",171,0)
 I $G(IOM)="" S IOM=76
"RTN","TIUPSCS",172,0)
 S X=(IOM-$L(H1))/2
"RTN","TIUPSCS",173,0)
 W ! F I=1:1:X W " "
"RTN","TIUPSCS",174,0)
 W H1,! F I=1:1:X W " "
"RTN","TIUPSCS",175,0)
 W H2
"RTN","TIUPSCS",176,0)
 Q
"RTN","TIUPSCS",177,0)
 ;
"RTN","TIUPSCS",178,0)
STOP ; Check Continue
"RTN","TIUPSCS",179,0)
 S X="",STOP=0
"RTN","TIUPSCS",180,0)
 S X="Enter <RETURN> for another TIU Document Definition Name or "
"RTN","TIUPSCS",181,0)
 S X=X_"'^' to exit: "
"RTN","TIUPSCS",182,0)
 W !!,X R Y:TIUWAIT S:'$T Y=U
"RTN","TIUPSCS",183,0)
 I $G(Y)=U S STOP=1,TIUGO=0
"RTN","TIUPSCS",184,0)
 L -^TIU(TIUFLE,TIUIEN)
"RTN","TIUPSCS",185,0)
 Q
"RTN","TIUPSCS",186,0)
 ;
"RTN","TIUPSCS",187,0)
SUBROUT ;
"RTN","TIUPSCS",188,0)
 K TIUARY,TIURTN
"RTN","TIUPSCS",189,0)
 S (I,J,TIUARY,TIURTN,TIUSPEC,Y,Z,Z1,Z2)=""
"RTN","TIUPSCS",190,0)
 S DIR("T")=TIUWAIT
"RTN","TIUPSCS",191,0)
 S DIR("A")="Choose an alert ROUTINE from the above listing"
"RTN","TIUPSCS",192,0)
 S TIUARY=$$GETRTN^TIUPSCA(.TIUARY)
"RTN","TIUPSCS",193,0)
 F I=1:1 Q:$G(TIUARY(I))=""  D  S DIR("A",I)=I_") "_TIURTN(I)
"RTN","TIUPSCS",194,0)
 . S Z="",Z=TIUARY(I)
"RTN","TIUPSCS",195,0)
 . S (J,Z1,Z2)=""
"RTN","TIUPSCS",196,0)
 . S Z1=$P(Z,"-"),Z2=$P(Z,"-",2) F J=1:1:9-$L(Z1) ; S Z1=Z1_" "
"RTN","TIUPSCS",197,0)
 . S TIURTN(I)=Z1_"- "_Z2
"RTN","TIUPSCS",198,0)
 S DIR("A",I)="",J=I-1
"RTN","TIUPSCS",199,0)
 S DIR(0)="NO^1:"_J
"RTN","TIUPSCS",200,0)
 D ^DIR K DIR
"RTN","TIUPSCS",201,0)
 I $D(DIRUT) D  S TIUGO=0 G SUBQ
"RTN","TIUPSCS",202,0)
 . W !!,"ABORT alert ROUTINE - No action is taken."
"RTN","TIUPSCS",203,0)
 I $G(Y)="" W !!,"This is a required response. OR Enter '^' to exit",! H 1 G SUBROUT
"RTN","TIUPSCS",204,0)
 I $G(Y)=1 S TIUSPEC=""
"RTN","TIUPSCS",205,0)
 E  S Z=$G(TIUARY(Y)),TIUSPEC=$P(Z,"-")
"RTN","TIUPSCS",206,0)
 I $G(TIUXQA)="",$G(TIUSPEC)="",$G(TIUPREV)="" D  S TIUGO=0 G SUBQ
"RTN","TIUPSCS",207,0)
 . W !!,"Without RECIPIENT and ROUTINE, alert code setting is cancelled." H 1
"RTN","TIUPSCS",208,0)
 I $G(TIUXQA)="",$G(TIUSPEC)="",$G(TIUPREV)'="" D  G SUBQ
"RTN","TIUPSCS",209,0)
 . S DIR("A")="W/O RECIPIENT and ROUTINE, ALERT CODE will be deleted? (YES or NO)"
"RTN","TIUPSCS",210,0)
 . S DIR("T")=TIUWAIT
"RTN","TIUPSCS",211,0)
 . S DIR(0)="Y"
"RTN","TIUPSCS",212,0)
 . S DIR("B")="NO"
"RTN","TIUPSCS",213,0)
 . W ! D ^DIR K DIR
"RTN","TIUPSCS",214,0)
 . I $D(DIRUT)!'$G(Y) D  S TIUGO=0 Q
"RTN","TIUPSCS",215,0)
 . .  W !!,"No action has been taken!!" S TIUGO=0
"RTN","TIUPSCS",216,0)
 . S TIUGO=0 D DEL Q
"RTN","TIUPSCS",217,0)
SUBQ Q
"RTN","TIUPSCS",218,0)
 ;
"RTN","TIUPSCS",219,0)
WHO ; Select Alert Recipient
"RTN","TIUPSCS",220,0)
 S (TIUWHO,Y)=""
"RTN","TIUPSCS",221,0)
 S DIR(0)="S^N:N/A;I:INDIVIDUAL USER;G:MAILGROUP;T:TEAM LIST (OE/RR with Queued Alert)"
"RTN","TIUPSCS",222,0)
 S DIR("A")="Choose RECIPIENTS to receive the alert (N/I/G/T) or '^' to exit"
"RTN","TIUPSCS",223,0)
 D ^DIR K DIR
"RTN","TIUPSCS",224,0)
 I $D(DTOUT)!($D(DUOUT)) S TIUGO=0 Q  ;G STOP
"RTN","TIUPSCS",225,0)
 S TIUWHO=$G(Y)
"RTN","TIUPSCS",226,0)
 ; XQA set up
"RTN","TIUPSCS",227,0)
 S (TIUFILE,TIUXQA,Y)=""
"RTN","TIUPSCS",228,0)
 S TIUFILE=$S(TIUWHO="I":200,TIUWHO="G":3.8,TIUWHO="T":100.21,1:"")
"RTN","TIUPSCS",229,0)
 S DIC=TIUFILE
"RTN","TIUPSCS",230,0)
 S DIC(0)="AEMQ"
"RTN","TIUPSCS",231,0)
 D ^DIC K DIC
"RTN","TIUPSCS",232,0)
 I $G(Y)'>0 S TIUXQA=""
"RTN","TIUPSCS",233,0)
 E  S TIUXQA=$S(TIUWHO="I":+Y,1:TIUWHO_"."_$$GET1^DIQ(TIUFILE,+Y,.01))
"RTN","TIUPSCS",234,0)
 Q
"RTN","TIUUTL2")
0^4^B1091999^n/a
"RTN","TIUUTL2",1,0)
TIUUTL2 ;AITC/CR - UTILITY FOR INPT MULTIDIVISONAL ROUTINES ;10/18/17 9:29am
"RTN","TIUUTL2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**305**;JUN 20, 1997;Build 27
"RTN","TIUUTL2",3,0)
 ;
"RTN","TIUUTL2",4,0)
 ; Reference to ^DIC(42 - supported by ICR #10039
"RTN","TIUUTL2",5,0)
 ;
"RTN","TIUUTL2",6,0)
CNTDIV()   ;COUNT THE NUMBER OF DIVISIONS PRESENT FOR WARD LOCATIONS
"RTN","TIUUTL2",7,0)
 N TIUWARD,TIUDIV,TIUDIVCT,TIUDIVARR
"RTN","TIUUTL2",8,0)
 S TIUWARD=0 F  S TIUWARD=$O(^DIC(42,TIUWARD)) Q:'+TIUWARD  D
"RTN","TIUUTL2",9,0)
 . Q:$P($G(^DIC(42,TIUWARD,"OOS",1,0)),U)'=""  ; skip over inactive wards
"RTN","TIUUTL2",10,0)
 . S TIUDIV=$P($G(^DIC(42,TIUWARD,0)),U,11)
"RTN","TIUUTL2",11,0)
 . I +TIUDIV S TIUDIVARR(TIUDIV)=""
"RTN","TIUUTL2",12,0)
 S (TIUDIV,TIUDIVCT)=0 F  S TIUDIV=$O(TIUDIVARR(TIUDIV)) Q:'+TIUDIV  D
"RTN","TIUUTL2",13,0)
 . S TIUDIVCT=TIUDIVCT+1
"RTN","TIUUTL2",14,0)
 Q TIUDIVCT
"VER")
8.0^22.2
"BLD",10196,6)
^286
**END**
**END**

