KIDS Distribution saved on Sep 08, 2015@09:19:12
TIU*1.0*268
**KIDS**:TIU*1.0*268^

**INSTALL NAME**
TIU*1.0*268
"BLD",8459,0)
TIU*1.0*268^TEXT INTEGRATION UTILITIES^0^3150908^y
"BLD",8459,1,0)
^^2^2^3150908^^^^
"BLD",8459,1,1,0)
This patch corrects an issue with the honoring of the ALLOW
"BLD",8459,1,2,0)
CHART PRINT OUTSIDE MAS parameter.
"BLD",8459,4,0)
^9.64PA^^0
"BLD",8459,6)
14^
"BLD",8459,6.3)
60
"BLD",8459,"INID")
^
"BLD",8459,"INIT")

"BLD",8459,"KRN",0)
^9.67PA^779.2^20
"BLD",8459,"KRN",.4,0)
.4
"BLD",8459,"KRN",.401,0)
.401
"BLD",8459,"KRN",.402,0)
.402
"BLD",8459,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",8459,"KRN",.403,0)
.403
"BLD",8459,"KRN",.5,0)
.5
"BLD",8459,"KRN",.84,0)
.84
"BLD",8459,"KRN",3.6,0)
3.6
"BLD",8459,"KRN",3.8,0)
3.8
"BLD",8459,"KRN",9.2,0)
9.2
"BLD",8459,"KRN",9.8,0)
9.8
"BLD",8459,"KRN",9.8,"NM",0)
^9.68A^12^3
"BLD",8459,"KRN",9.8,"NM",8,0)
TIUSRVA^^0^B28966297
"BLD",8459,"KRN",9.8,"NM",11,0)
TIUSRVLO^^0^B87272122
"BLD",8459,"KRN",9.8,"NM",12,0)
TIUSRVLP^^0^B3762560
"BLD",8459,"KRN",9.8,"NM","B","TIUSRVA",8)

"BLD",8459,"KRN",9.8,"NM","B","TIUSRVLO",11)

"BLD",8459,"KRN",9.8,"NM","B","TIUSRVLP",12)

"BLD",8459,"KRN",19,0)
19
"BLD",8459,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8459,"KRN",19.1,0)
19.1
"BLD",8459,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8459,"KRN",101,0)
101
"BLD",8459,"KRN",409.61,0)
409.61
"BLD",8459,"KRN",771,0)
771
"BLD",8459,"KRN",779.2,0)
779.2
"BLD",8459,"KRN",870,0)
870
"BLD",8459,"KRN",8989.51,0)
8989.51
"BLD",8459,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",8459,"KRN",8989.52,0)
8989.52
"BLD",8459,"KRN",8994,0)
8994
"BLD",8459,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",8459,"KRN",8994,"NM",1,0)
TIU CAN PRINT WORK/CHART COPY^^0
"BLD",8459,"KRN",8994,"NM","B","TIU CAN PRINT WORK/CHART COPY",1)

"BLD",8459,"KRN","B",.4,.4)

"BLD",8459,"KRN","B",.401,.401)

"BLD",8459,"KRN","B",.402,.402)

"BLD",8459,"KRN","B",.403,.403)

"BLD",8459,"KRN","B",.5,.5)

"BLD",8459,"KRN","B",.84,.84)

"BLD",8459,"KRN","B",3.6,3.6)

"BLD",8459,"KRN","B",3.8,3.8)

"BLD",8459,"KRN","B",9.2,9.2)

"BLD",8459,"KRN","B",9.8,9.8)

"BLD",8459,"KRN","B",19,19)

"BLD",8459,"KRN","B",19.1,19.1)

"BLD",8459,"KRN","B",101,101)

"BLD",8459,"KRN","B",409.61,409.61)

"BLD",8459,"KRN","B",771,771)

"BLD",8459,"KRN","B",779.2,779.2)

"BLD",8459,"KRN","B",870,870)

"BLD",8459,"KRN","B",8989.51,8989.51)

"BLD",8459,"KRN","B",8989.52,8989.52)

"BLD",8459,"KRN","B",8994,8994)

"BLD",8459,"QDEF")
^^^^NO^^^^^^NO
"BLD",8459,"QUES",0)
^9.62^^
"BLD",8459,"REQB",0)
^9.611^2^2
"BLD",8459,"REQB",1,0)
TIU*1.0*239^2
"BLD",8459,"REQB",2,0)
TIU*1.0*211^2
"BLD",8459,"REQB","B","TIU*1.0*211",2)

"BLD",8459,"REQB","B","TIU*1.0*239",1)

"KRN",8994,3008,-1)
0^1
"KRN",8994,3008,0)
TIU CAN PRINT WORK/CHART COPY^WORKCHRT^TIUSRVA^1^S
"KRN",8994,3008,1,0)
^8994.01^7^7^3121025^^
"KRN",8994,3008,1,1,0)
This RPC evaluates whether a user can print a Document, and if so, 
"KRN",8994,3008,1,2,0)
whether the user can print only a Work Copy or may print EITHER a Work 
"KRN",8994,3008,1,3,0)
Copy or a Chart Copy.
"KRN",8994,3008,1,4,0)
Authorization to print is determined by ASU Business Rules, and what type 
"KRN",8994,3008,1,5,0)
of copy by TIU Document Parameter ALLOW CHART PRINT OUTSIDE MAS. A user is
"KRN",8994,3008,1,6,0)
"in MAS" if they are a member of ASU User Class MEDICAL INFORMATION
"KRN",8994,3008,1,7,0)
SECTION.
"KRN",8994,3008,2,0)
^8994.02A^1^1
"KRN",8994,3008,2,1,0)
TIUDA^1^^1
"KRN",8994,3008,2,1,1,0)
^^1^1^3121025^
"KRN",8994,3008,2,1,1,1,0)
This is the record number (IEN) of the document in file 8925.
"KRN",8994,3008,2,"B","TIUDA",1)

"KRN",8994,3008,3,0)
^8994.03^3^3^3121025^^
"KRN",8994,3008,3,1,0)
TIUY = 0^Can't Message:  User can't print EITHER copy. (Fails Bus Rules)
"KRN",8994,3008,3,2,0)
TIUY = 1: User may print a Work Copy only.
"KRN",8994,3008,3,3,0)
TIUY = 2: User may print either a Work Copy or a Chart Copy.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^2970620^2970815^11712
"PKG",516,22,1,"PAH",1,0)
268^3150908^2
"PKG",516,22,1,"PAH",1,1,0)
^^2^2^3150908
"PKG",516,22,1,"PAH",1,1,1,0)
This patch corrects an issue with the honoring of the ALLOW
"PKG",516,22,1,"PAH",1,1,2,0)
CHART PRINT OUTSIDE MAS parameter.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUSRVA")
0^8^B28966297
"RTN","TIUSRVA",1,0)
TIUSRVA ; SLC/JER,AJB - API's for Authorization ;07/30/14  09:46 [12/4/14 4:01pm]
"RTN","TIUSRVA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,47,80,100,116,152,160,178,175,157,236,234,239,268**;Jun 20, 1997;Build 60
"RTN","TIUSRVA",3,0)
 ;
"RTN","TIUSRVA",4,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","TIUSRVA",5,0)
 ;   DBIA 10141  PATCH^XPDUTL
"RTN","TIUSRVA",6,0)
 ;   DBIA  2052  FIELD^DID
"RTN","TIUSRVA",7,0)
 ;
"RTN","TIUSRVA",8,0)
 ; External reference to File ^AUPNVSIT supported by IA 3580
"RTN","TIUSRVA",9,0)
 ; $$ISA^USRLM supported by IA 1544
"RTN","TIUSRVA",10,0)
REQCOS(TIUY,TIUTYP,TIUDA,TIUSER,TIUDT) ; Evaluate cosignature requirement
"RTN","TIUSRVA",11,0)
 ; Initialize return value
"RTN","TIUSRVA",12,0)
 N TIUDPRM
"RTN","TIUSRVA",13,0)
 S TIUY=0
"RTN","TIUSRVA",14,0)
 I +$G(TIUTYP)'>0,'+$G(TIUDA) Q
"RTN","TIUSRVA",15,0)
 I +$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$G(TIUDA),0))
"RTN","TIUSRVA",16,0)
 S:'+$G(TIUSER) TIUSER=+$G(DUZ)
"RTN","TIUSRVA",17,0)
 ; VMP/RJT --- *239  - Make sure only date is being passed into REQCOSIG and not date/time
"RTN","TIUSRVA",18,0)
 S TIUY=+$$REQCOSIG^TIULP(TIUTYP,+$G(TIUDA),+$G(TIUSER),$P(+$G(TIUDT),"."))
"RTN","TIUSRVA",19,0)
 Q
"RTN","TIUSRVA",20,0)
URGENCY(TIUY) ; -- retrieve set values from dd for discharge summary urgency
"RTN","TIUSRVA",21,0)
 N TIUDD,TIUI,TIUX
"RTN","TIUSRVA",22,0)
 D FIELD^DID(8925,.09,"","POINTER","TIUDD")
"RTN","TIUSRVA",23,0)
 F TIUI=1:1 S TIUX=$P(TIUDD("POINTER"),";",TIUI) Q:TIUX=""   S TIUY(TIUI)=$TR(TIUX,":","^")
"RTN","TIUSRVA",24,0)
 Q
"RTN","TIUSRVA",25,0)
CANDO(TIUY,TIUDA,TIUACT) ; Boolean function to evaluate privilege
"RTN","TIUSRVA",26,0)
 N TIUPOP,TIUDPRM S TIUPOP=0
"RTN","TIUSRVA",27,0)
 ; **152** prevent editing completed [uncosigned] documents.
"RTN","TIUSRVA",28,0)
 I $P($G(^TIU(8925,TIUDA,0)),U,5)>5,(TIUACT="EDIT RECORD") S TIUY="0^ You may not edit uncosigned or completed documents" Q
"RTN","TIUSRVA",29,0)
 I $S(TIUACT["SIGN":1,TIUACT="EDIT RECORD":1,TIUACT="DELETE RECORD":1,1:0) D  Q:+TIUPOP=1
"RTN","TIUSRVA",30,0)
 . L +^TIU(8925,+TIUDA):1
"RTN","TIUSRVA",31,0)
 . E  S TIUY="0^ Another session is editing this entry.",TIUPOP=1
"RTN","TIUSRVA",32,0)
 . L -^TIU(8925,+TIUDA)
"RTN","TIUSRVA",33,0)
 ;VMP/ELR *239 -- CHANGED TIUACT["SIGN" TO TIUACT["SIGNAT" - WAS EXECUTING LINE FOR INDENTIFYING SIGNERS
"RTN","TIUSRVA",34,0)
  I TIUACT["SIGNAT",+$$NEEDCS(TIUDA) S TIUY="0^ You must name a cosigner before signing this document." Q
"RTN","TIUSRVA",35,0)
 S TIUY=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVA",36,0)
 Q
"RTN","TIUSRVA",37,0)
NEEDCS(TIUDA) ; Does user need a cosigner?
"RTN","TIUSRVA",38,0)
 N TIUD0,TIUD12,TIUY,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",39,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUSRVA",40,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8),XTRASGNR=0
"RTN","TIUSRVA",41,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",42,0)
 ;VMP/DJH *268 no cosigner needed if surrogate for additional signer
"RTN","TIUSRVA",43,0)
 I '+XTRASGNR S XTRASGNR=$$ASURG^TIUADSIG(TIUDA)
"RTN","TIUSRVA",44,0)
 I +XTRASGNR S TIUY=0
"RTN","TIUSRVA",45,0)
 E  I +$$REQCOSIG^TIULP(+TIUD0,TIUDA,DUZ),(+$P(TIUD12,U,8)'>0) S TIUY=1
"RTN","TIUSRVA",46,0)
 Q +$G(TIUY)
"RTN","TIUSRVA",47,0)
USRINACT(TIUY,TIUDA) ; Is user inactive?
"RTN","TIUSRVA",48,0)
 S TIUY=+$$GET1^DIQ(200,TIUDA_",",7,"I")
"RTN","TIUSRVA",49,0)
 Q
"RTN","TIUSRVA",50,0)
AUTHSIGN(TIUY,TIUDA,TIUUSR) ; Has Author signed?
"RTN","TIUSRVA",51,0)
 ; if TIUY =
"RTN","TIUSRVA",52,0)
 ; 0 = Author has NOT signed & TIUUSR = Expected Cosigner
"RTN","TIUSRVA",53,0)
 ; 1 = Author HAS signed or TIUUSR '= Expected Cosigner
"RTN","TIUSRVA",54,0)
 ;
"RTN","TIUSRVA",55,0)
 N TIUD12,TIUD15
"RTN","TIUSRVA",56,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD15=$G(^(15))
"RTN","TIUSRVA",57,0)
 S TIUY=1
"RTN","TIUSRVA",58,0)
 D:$P(TIUD12,U,8)=TIUUSR  Q
"RTN","TIUSRVA",59,0)
 . S:$P(TIUD12,U,2)'=$P(TIUD15,U,2) TIUY=0
"RTN","TIUSRVA",60,0)
 Q
"RTN","TIUSRVA",61,0)
TIUVISIT(TIUY,DOCTYP,DFN,VISIT) ;  Check for a 1 time only doc
"RTN","TIUSRVA",62,0)
 ;  TIUY    =    return value
"RTN","TIUSRVA",63,0)
 ;          = 0 if can add more than one or none already exist
"RTN","TIUSRVA",64,0)
 ;          = 1 if cannot add more than one and one already exists
"RTN","TIUSRVA",65,0)
 ;  DOCTYP  =    Pointer to ^TUI(8925.1,   TIU DOCUMENT DEFINITION
"RTN","TIUSRVA",66,0)
 ;  DFN     =    Patient IEN
"RTN","TIUSRVA",67,0)
 ;  VISIT   =    Visit String "LOC;VDATE;VTYP"
"RTN","TIUSRVA",68,0)
 I $$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",69,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",70,0)
 . N TIUDPRM,TIUTEST
"RTN","TIUSRVA",71,0)
 . D DOCPRM^TIULC1(DOCTYP,.TIUDPRM)
"RTN","TIUSRVA",72,0)
 . S TIUY=$S($P(TIUDPRM(0),U,10)="":1,1:$P(TIUDPRM(0),U,10))
"RTN","TIUSRVA",73,0)
 . I TIUY=1 S TIUY=0 Q
"RTN","TIUSRVA",74,0)
 . I $L(VISIT,";")=3 D
"RTN","TIUSRVA",75,0)
 . . S TIUTEST=$$EXIST^TIUEDI3(DFN,DOCTYP,VISIT)
"RTN","TIUSRVA",76,0)
 . . I TIUTEST S TIUY=1
"RTN","TIUSRVA",77,0)
 . . I 'TIUTEST S TIUY=0
"RTN","TIUSRVA",78,0)
 I '$$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",79,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",80,0)
 . N TIUX3
"RTN","TIUSRVA",81,0)
 . S TIUX3=+$O(^TIU(8925.95,"B",DOCTYP,""))
"RTN","TIUSRVA",82,0)
 . S TIUY=$P($G(^TIU(8925.95,TIUX3,0)),U,10) S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",83,0)
 . Q:'TIUY
"RTN","TIUSRVA",84,0)
 . S VISIT=((9999999-$P(VISIT,"."))_"."_$P(VISIT,".",2))
"RTN","TIUSRVA",85,0)
 . S VISIT=+$O(^AUPNVSIT("AA",DFN,VISIT,""))
"RTN","TIUSRVA",86,0)
 . S TIUY=$S($D(^TIU(8925,"AV",DFN,DOCTYP,VISIT)):0,1:1)
"RTN","TIUSRVA",87,0)
 . S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",88,0)
 Q
"RTN","TIUSRVA",89,0)
WHATACT(TIUY,TIUDA) ; Evaluate/return whether signature or cosignature
"RTN","TIUSRVA",90,0)
 N TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",91,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVA",92,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVA",93,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",94,0)
 I '$G(XTRASGNR) S XTRASGNR=$$ASURG^TIUADSIG(TIUDA)
"RTN","TIUSRVA",95,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVA",96,0)
 S TIUY=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVA",97,0)
 Q
"RTN","TIUSRVA",98,0)
CANCHCOS(TIUY,TIUDA) ; Evaluate/return whether user can change cosigner
"RTN","TIUSRVA",99,0)
 S TIUY=$$MAYCHNG^TIURA1(TIUDA)
"RTN","TIUSRVA",100,0)
 Q
"RTN","TIUSRVA",101,0)
NEEDJUST(TIUY,TIUDA) ; Is justification required for deletion?
"RTN","TIUSRVA",102,0)
 N TIUD0 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUY=0
"RTN","TIUSRVA",103,0)
 I +$P(TIUD0,U,5)'<6 S TIUY=1
"RTN","TIUSRVA",104,0)
 Q
"RTN","TIUSRVA",105,0)
GETTITLE(TIUY,TIUDA) ; Get the title from a TIU Document Record
"RTN","TIUSRVA",106,0)
 S TIUY=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVA",107,0)
 Q
"RTN","TIUSRVA",108,0)
CANATTCH(TIUY,TIUDA) ; Can this document be attached as an ID Child
"RTN","TIUSRVA",109,0)
 N TITLEDA,PARENTDA
"RTN","TIUSRVA",110,0)
 S TITLEDA=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVA",111,0)
 I TITLEDA'>0 S TIUY="0^Document #"_TIUDA_" does not exist." Q
"RTN","TIUSRVA",112,0)
 S PARENTDA=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVA",113,0)
 S TIUY=$$POSSPRNT^TIULP(TITLEDA)
"RTN","TIUSRVA",114,0)
 I +TIUY S TIUY="-1"_U_$P(TIUY,U,2) Q
"RTN","TIUSRVA",115,0)
 I +$$ISCWAD^TIULX(TITLEDA) D  Q
"RTN","TIUSRVA",116,0)
 . S TIUY="0^ CWAD Documents may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",117,0)
 I +$$ISA^TIULX(TITLEDA,+$$CLASS^TIUCNSLT) D  Q
"RTN","TIUSRVA",118,0)
 . S TIUY="0^ Consult Results may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",119,0)
 S TIUY=$$CANDO^TIULP(TIUDA,"ATTACH TO ID NOTE")
"RTN","TIUSRVA",120,0)
 I PARENTDA D  ; action must be "detach"
"RTN","TIUSRVA",121,0)
 . I 'TIUY S TIUY="0^ You may not detach this note from an interdisciplinary note." Q
"RTN","TIUSRVA",122,0)
 . S TIUY=$$CANDO^TIULP(PARENTDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",123,0)
 . I 'TIUY S TIUY="0^ You may not detach this note from its interdisciplinary note."
"RTN","TIUSRVA",124,0)
 Q
"RTN","TIUSRVA",125,0)
CANRCV(TIUY,TIUDA) ; Can this document receive an ID Child?
"RTN","TIUSRVA",126,0)
 S TIUY=$$CANDO^TIULP(TIUDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",127,0)
 Q
"RTN","TIUSRVA",128,0)
WORKCHRT(TIUY,TIUDA) ; RPC: Can user print Work or Chart copy of document
"RTN","TIUSRVA",129,0)
 ; TIUDA=IEN of docmt
"RTN","TIUSRVA",130,0)
 ;Returns TIUY:
"RTN","TIUSRVA",131,0)
 ;TIUY = 0^message Can't print at all (fails bus rules)
"RTN","TIUSRVA",132,0)
 ;TIUY = 1 Can print work copy only
"RTN","TIUSRVA",133,0)
 ;TIUY = 2 Can print work or chart copy (Param=1 or user is MAS)
"RTN","TIUSRVA",134,0)
 N CANPRNT,TIUDTYP,TIUDPRM
"RTN","TIUSRVA",135,0)
 S CANPRNT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIUSRVA",136,0)
 I 'CANPRNT S TIUY=CANPRNT Q
"RTN","TIUSRVA",137,0)
 S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVA",138,0)
 D DOCPRM^TIULC1(TIUDTYP,.TIUDPRM,TIUDA)
"RTN","TIUSRVA",139,0)
 I +$P(TIUDPRM(0),U,9) S TIUY=2 Q
"RTN","TIUSRVA",140,0)
 I +$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION") S TIUY=2 Q
"RTN","TIUSRVA",141,0)
 S TIUY=1
"RTN","TIUSRVA",142,0)
 Q
"RTN","TIUSRVLO")
0^11^B87272122
"RTN","TIUSRVLO",1,0)
TIUSRVLO ; SLC/JER - Server fns - lists for CPRS ;11/20/14  11:03
"RTN","TIUSRVLO",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,15,19,63,108,122,181,194,211,268**;Jun 20, 1997;Build 60
"RTN","TIUSRVLO",3,0)
 ;
"RTN","TIUSRVLO",4,0)
 ;
"RTN","TIUSRVLO",5,0)
 ;
"RTN","TIUSRVLO",6,0)
NOTES(TIUY,DFN,EARLY,LATE,PERSON,SEQUENCE) ; Get notes
"RTN","TIUSRVLO",7,0)
 N TIUPREF,TIUOCC S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVLO",8,0)
 S TIUOCC=$P(TIUPREF,U,10),PERSON=$S(+$G(PERSON):+$G(PERSON),1:+$G(DUZ))
"RTN","TIUSRVLO",9,0)
 S SEQUENCE=$S($G(SEQUENCE)]"":$G(SEQUENCE),1:"D")
"RTN","TIUSRVLO",10,0)
 D CONTEXT(.TIUY,3,1,DFN,$G(EARLY),$G(LATE),PERSON,TIUOCC,SEQUENCE)
"RTN","TIUSRVLO",11,0)
 Q
"RTN","TIUSRVLO",12,0)
SUMMARY(TIUY,DFN,EARLY,LATE) ; Get Summaries
"RTN","TIUSRVLO",13,0)
 N TIUPREF,TIUOCC S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVLO",14,0)
 S TIUOCC=$P(TIUPREF,U,10),PERSON=$S(+$G(PERSON):+$G(PERSON),1:+$G(DUZ))
"RTN","TIUSRVLO",15,0)
 S SEQUENCE=$S($G(SEQUENCE)]"":$G(SEQUENCE),1:"D")
"RTN","TIUSRVLO",16,0)
 D CONTEXT(.TIUY,244,1,DFN,$G(EARLY),$G(LATE),PERSON,TIUOCC,SEQUENCE)
"RTN","TIUSRVLO",17,0)
 Q
"RTN","TIUSRVLO",18,0)
CONTEXT(TIUY,CLASS,CONTEXT,DFN,EARLY,LATE,PERSON,OCCLIM,SEQUENCE,SHOWADD,INCUND) ; main
"RTN","TIUSRVLO",19,0)
 ; --- Call with:  TIUY     - RETURN ARRAY pass by reference
"RTN","TIUSRVLO",20,0)
 ;                 CLASS    - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUSRVLO",21,0)
 ;                 CONTEXT  - 1=All Signed (by PT),
"RTN","TIUSRVLO",22,0)
 ;                          - 2="Unsigned (by PT&(AUTHOR!TANSCRIBER))
"RTN","TIUSRVLO",23,0)
 ;                          - 3="Uncosigned (by PT&EXPECTED COSIGNER
"RTN","TIUSRVLO",24,0)
 ;                          - 4="Signed notes (by PT&selected author)
"RTN","TIUSRVLO",25,0)
 ;                          - 5="Signed notes (by PT&date range)
"RTN","TIUSRVLO",26,0)
 ;                 DFN      - Pointer to Patient (#2)
"RTN","TIUSRVLO",27,0)
 ;                [EARLY]   - FM date/time to begin search
"RTN","TIUSRVLO",28,0)
 ;                [LATE]    - FM date/time to end search
"RTN","TIUSRVLO",29,0)
 ;                [PERSON]  - Pointer to file 200 (DUZ if not passed)
"RTN","TIUSRVLO",30,0)
 ;                [OCCLIM]  - Occurrence Limit (optional)
"RTN","TIUSRVLO",31,0)
 ;                [SEQUENCE]- "A"=ascending (Regular date/time)
"RTN","TIUSRVLO",32,0)
 ;                          - "D"=descending (Reverse date/time) (dflt)
"RTN","TIUSRVLO",33,0)
 ;                [INCUND]  - Boolean: include undictated & untranscribed
"RTN","TIUSRVLO",34,0)
 S TIUY=$NA(^TMP("TIUR",$J))
"RTN","TIUSRVLO",35,0)
 K @TIUY
"RTN","TIUSRVLO",36,0)
 I $G(CONTEXT)'>0 Q
"RTN","TIUSRVLO",37,0)
 I $G(CLASS)'>0 Q
"RTN","TIUSRVLO",38,0)
 I $G(CONTEXT)=1 D STRT1^AWCMCPR1 ; TIU*1.0*181
"RTN","TIUSRVLO",39,0)
 S:+$G(EARLY)'>0!(+$G(CONTEXT)=1) EARLY=0
"RTN","TIUSRVLO",40,0)
 S:+$G(LATE)'>0!(+$G(CONTEXT)=1) LATE=5000000
"RTN","TIUSRVLO",41,0)
 I EARLY>LATE D SWAP(.EARLY,.LATE)
"RTN","TIUSRVLO",42,0)
 I $L(LATE,".")=1 D EXPRANGE(.EARLY,.LATE)
"RTN","TIUSRVLO",43,0)
 S:+$G(PERSON)'>0 PERSON=DUZ
"RTN","TIUSRVLO",44,0)
 S:$G(SEQUENCE)']"" SEQUENCE="D"
"RTN","TIUSRVLO",45,0)
 S:+$G(OCCLIM)'>0 OCCLIM=9999999
"RTN","TIUSRVLO",46,0)
 S DFN=+$G(DFN)
"RTN","TIUSRVLO",47,0)
 S EARLY=9999999-EARLY,LATE=9999999-LATE ; CHANGE TO REVERSE DATES
"RTN","TIUSRVLO",48,0)
 ;
"RTN","TIUSRVLO",49,0)
 I CONTEXT=1!(CONTEXT=5) D  G CTXQ
"RTN","TIUSRVLO",50,0)
 . D ACLPT(.TIUY,CLASS,DFN,LATE,EARLY,OCCLIM,SEQUENCE)
"RTN","TIUSRVLO",51,0)
 ;
"RTN","TIUSRVLO",52,0)
 I CONTEXT=2 D  G CTXQ
"RTN","TIUSRVLO",53,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",54,0)
 . . D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,$G(INCUND))
"RTN","TIUSRVLO",55,0)
 . F  S DFN=$O(^TIU(8925,"ACLAU",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,$G(INCUND))
"RTN","TIUSRVLO",56,0)
 ;
"RTN","TIUSRVLO",57,0)
 I CONTEXT=3 D  G CTXQ
"RTN","TIUSRVLO",58,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",59,0)
 . . D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",60,0)
 . F  S DFN=$O(^TIU(8925,"ACLEC",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",61,0)
 ;
"RTN","TIUSRVLO",62,0)
 I CONTEXT=4 D  G CTXQ
"RTN","TIUSRVLO",63,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLO",64,0)
 . . ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 REMOVED EXECUTION OF ACLSB & ADDED APTCL
"RTN","TIUSRVLO",65,0)
 . . ;D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",66,0)
 . . D APTCL^TIUSRVLP(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",67,0)
 . F  S DFN=$O(^TIU(8925,"APTCL",DFN)) Q:DFN'>0  D APTCL^TIUSRVLP(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE)
"RTN","TIUSRVLO",68,0)
 ;
"RTN","TIUSRVLO",69,0)
CTXQ K @TIUY@("INDX")
"RTN","TIUSRVLO",70,0)
 I $D(AWCSTRT) D END^AWCMCPR1 ; TIU*1.0*181
"RTN","TIUSRVLO",71,0)
 Q
"RTN","TIUSRVLO",72,0)
 ;
"RTN","TIUSRVLO",73,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUSRVLO",74,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUSRVLO",75,0)
 Q
"RTN","TIUSRVLO",76,0)
 ;
"RTN","TIUSRVLO",77,0)
EXPRANGE(TIUX,TIUY) ; Expand range when same for early & late
"RTN","TIUSRVLO",78,0)
 I TIUX=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUSRVLO",79,0)
 E  S TIUY=TIUY_"."_2359
"RTN","TIUSRVLO",80,0)
 Q
"RTN","TIUSRVLO",81,0)
 ;
"RTN","TIUSRVLO",82,0)
ACLPT(TIUY,CLASS,DFN,TIME1,TIME2,OCCLIM,SEQUENCE) ; Signed, by patient
"RTN","TIUSRVLO",83,0)
 N DATTIM,DA,ROOT,TIUI,TIUJ,TIUP
"RTN","TIUSRVLO",84,0)
 S ROOT=$NA(^TIU(8925,"ACLPT",CLASS,DFN)),TIUJ=0
"RTN","TIUSRVLO",85,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",86,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:$S(+DATTIM'>0:1,+DATTIM>TIME2:1,+$G(TIUJ)'<OCCLIM:1,1:0)  D
"RTN","TIUSRVLO",87,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",88,0)
 . . ;Added first condition to following line for interdisciplinary notes - need addenda
"RTN","TIUSRVLO",89,0)
 . . I +$G(SHOWADD)=0,(+$G(^TIU(8925,+DA,0))=81) Q
"RTN","TIUSRVLO",90,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",91,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",92,0)
 . . ; Selectively filter DELETED or RETRACTED records
"RTN","TIUSRVLO",93,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",94,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",95,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",96,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVLO",97,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",98,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",99,0)
 . . S TIUP=+$$HASDAD^TIUSRVLI(DA) I TIUP D  D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",100,0)
 . . . N TIUPT
"RTN","TIUSRVLO",101,0)
 . . . S TIUPT=$P($G(^TIU(8925,+DA,0)),"^",6)
"RTN","TIUSRVLO",102,0)
 . . . I TIUPT]"",'$D(^TIU(8925,"DAD",TIUPT,DA)) S ^TIU(8925,"DAD",TIUPT,DA)=""
"RTN","TIUSRVLO",103,0)
 . . . I TIUPT="" S TIUPT=$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",104,0)
 . . . I '$D(^TIU(8925,TIUPT,0)) S $P(@TIUY@(TIUI),"^",16)=1,$P(@TIUY@(TIUI),"^",14)=1 Q
"RTN","TIUSRVLO",105,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",106,0)
 Q
"RTN","TIUSRVLO",107,0)
 ;
"RTN","TIUSRVLO",108,0)
ACLAU(TIUY,CLASS,AUTHOR,DFN,TIME1,TIME2,SEQUENCE,INCUND) ; Unsigned
"RTN","TIUSRVLO",109,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",110,0)
 S ROOT=$NA(^TIU(8925,"ACLAU",CLASS,AUTHOR,DFN))
"RTN","TIUSRVLO",111,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",112,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",113,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",114,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",115,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>6 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",116,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",117,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",118,0)
 . . ; Selectively filter DELETED or RETRACTED records
"RTN","TIUSRVLO",119,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",120,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",121,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",122,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",123,0)
 . . S TIUP=+$$HASDAD^TIUSRVLI(DA) I TIUP D  D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",124,0)
 . . . N TIUPT
"RTN","TIUSRVLO",125,0)
 . . . S TIUPT=$P($G(^TIU(8925,+DA,0)),"^",6)
"RTN","TIUSRVLO",126,0)
 . . . I TIUPT]"",'$D(^TIU(8925,"DAD",TIUPT,DA)) S ^TIU(8925,"DAD",TIUPT,DA)=""
"RTN","TIUSRVLO",127,0)
 . . . I TIUPT="" S TIUPT=$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",128,0)
 . . . I '$D(^TIU(8925,TIUPT,0)) S $P(@TIUY@(TIUI),"^",16)=1,$P(@TIUY@(TIUI),"^",14)=2 Q
"RTN","TIUSRVLO",129,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",130,0)
 I +$G(INCUND) D GETUND^TIUSRVLI(.TIUY,CLASS,DFN,TIME1,TIME2,.TIUI,SEQUENCE)
"RTN","TIUSRVLO",131,0)
 Q
"RTN","TIUSRVLO",132,0)
 ;
"RTN","TIUSRVLO",133,0)
ACLEC(TIUY,CLASS,EXCOSIGN,DFN,TIME1,TIME2,SEQUENCE) ; Uncosigned
"RTN","TIUSRVLO",134,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",135,0)
 S ROOT=$NA(^TIU(8925,"ACLEC",CLASS,EXCOSIGN,DFN))
"RTN","TIUSRVLO",136,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",137,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",138,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",139,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",140,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",141,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",142,0)
 . . ; Selectively filter DELETED or RETRACTED records
"RTN","TIUSRVLO",143,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",144,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",145,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",146,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",147,0)
 . . S TIUP=+$$HASDAD^TIUSRVLI(DA) I TIUP D  D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",148,0)
 . . . N TIUPT
"RTN","TIUSRVLO",149,0)
 . . . S TIUPT=$P($G(^TIU(8925,+DA,0)),"^",6)
"RTN","TIUSRVLO",150,0)
 . . . I TIUPT]"",'$D(^TIU(8925,"DAD",TIUPT,DA)) S ^TIU(8925,"DAD",TIUPT,DA)=""
"RTN","TIUSRVLO",151,0)
 . . . I TIUPT="" S TIUPT=$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",152,0)
 . . . I '$D(^TIU(8925,TIUPT,0)) S $P(@TIUY@(TIUI),"^",16)=1,$P(@TIUY@(TIUI),"^",14)=3 Q
"RTN","TIUSRVLO",153,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",154,0)
 Q
"RTN","TIUSRVLO",155,0)
 ;
"RTN","TIUSRVLO",156,0)
ACLSB(TIUY,CLASS,SIGNEDBY,DFN,TIME1,TIME2,SEQUENCE) ; Signed, by author
"RTN","TIUSRVLO",157,0)
 N DATTIM,DA,ROOT,TIUI
"RTN","TIUSRVLO",158,0)
 S ROOT=$NA(^TIU(8925,"ACLSB",CLASS,SIGNEDBY,DFN))
"RTN","TIUSRVLO",159,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLO",160,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLO",161,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLO",162,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLO",163,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLO",164,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLO",165,0)
 . . ; Selectively filter DELETED or RETRACTED records
"RTN","TIUSRVLO",166,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLO",167,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE(DA)
"RTN","TIUSRVLO",168,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLO",169,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLO",170,0)
 . . I +$$HASDAD^TIUSRVLI(DA) D
"RTN","TIUSRVLO",171,0)
 . . . S TIUP=+$$HASDAD^TIUSRVLI(DA) I TIUP D  D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",172,0)
 . . . N TIUPT
"RTN","TIUSRVLO",173,0)
 . . . S TIUPT=$P($G(^TIU(8925,+DA,0)),"^",6)
"RTN","TIUSRVLO",174,0)
 . . . I TIUPT]"",'$D(^TIU(8925,"DAD",TIUPT,DA)) S ^TIU(8925,"DAD",TIUPT,DA)=""
"RTN","TIUSRVLO",175,0)
 . . . I TIUPT="" S TIUPT=$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",176,0)
 . . . I '$D(^TIU(8925,TIUPT,0)) S $P(@TIUY@(TIUI),"^",16)=1,$P(@TIUY@(TIUI),"^",14)=1 Q
"RTN","TIUSRVLO",177,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLO",178,0)
 Q
"RTN","TIUSRVLO",179,0)
 ;
"RTN","TIUSRVLO",180,0)
RESOLVE(DA) ; Resolve to external data
"RTN","TIUSRVLO",181,0)
 N DOC,LOC,PT,AUT,EDT,TIUPT,TIULST4,TIUREC,TIUR0,TIUR12,TIUR13,TIUR14
"RTN","TIUSRVLO",182,0)
 N TIUR17,STATUS,EDTCNT,LOCTYP,TIUADT,TIUDDT,PREFIX,IDPARENT,IDSORT
"RTN","TIUSRVLO",183,0)
 S PREFIX=""
"RTN","TIUSRVLO",184,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUSRVLO",185,0)
 S TIUR13=$G(^TIU(8925,+DA,13)),TIUR14=$G(^(14)),TIUR17=$G(^(17))
"RTN","TIUSRVLO",186,0)
 S IDPARENT=+$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLO",187,0)
 S TIUPT=$G(^DPT(+$P(TIUR0,U,2),0))
"RTN","TIUSRVLO",188,0)
 S DOC=$$UPPER^ORU($$PNAME^TIULC1(+TIUR0))
"RTN","TIUSRVLO",189,0)
 S DOC=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUSRVLO",190,0)
 I +$G(^TIU(8925.1,+DA,15)) D
"RTN","TIUSRVLO",191,0)
 . N TIUD15 S TIUD15=$G(^TIU(8925.1,+DA,15))
"RTN","TIUSRVLO",192,0)
 . S DOC=DOC_";"_$P($G(^TIU(8926.1,+TIUD15,0)),U)
"RTN","TIUSRVLO",193,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUR0,U,6),0)))
"RTN","TIUSRVLO",194,0)
 ; If IDNotes (TIU*1.0*100) installed, use $$PREFIX^TIULA2 to evaluate
"RTN","TIUSRVLO",195,0)
 ; which prefix to use:
"RTN","TIUSRVLO",196,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUSRVLO",197,0)
 ; - omit in newer TreeView versions
"RTN","TIUSRVLO",198,0)
 I $L($T(PREFIX^TIULA2)) D  I 1
"RTN","TIUSRVLO",199,0)
 . S PREFIX=$$PREFIX^TIULA2(DA,1)  ; 1=include ID Child indicator
"RTN","TIUSRVLO",200,0)
 . I PREFIX["<" S IDSORT=$$IDSORT(DA)
"RTN","TIUSRVLO",201,0)
 . I +$G(SHOWADD)=0 S DOC=PREFIX_DOC
"RTN","TIUSRVLO",202,0)
 ; otherwise, only show addendum indicator (+)
"RTN","TIUSRVLO",203,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUSRVLO",204,0)
 ; - omit in newer TreeView versions
"RTN","TIUSRVLO",205,0)
 E  D
"RTN","TIUSRVLO",206,0)
 . I +$$HASADDEN^TIULC1(DA) S PREFIX="+ "
"RTN","TIUSRVLO",207,0)
 . I +$G(SHOWADD)=0,(+$$HASADDEN^TIULC1(DA)) S DOC=PREFIX_DOC
"RTN","TIUSRVLO",208,0)
 I +$$URGENCY^TIURM(+DA)=1 S DOC=$S(DOC["+":"*",1:"* ")_DOC
"RTN","TIUSRVLO",209,0)
 S STATUS=$$LOWER^TIULS($P($G(^TIU(8925.6,+$P(TIUR0,U,5),0)),U))
"RTN","TIUSRVLO",210,0)
 S LOC=$G(^SC(+$P(TIUR12,U,5),0)),LOCTYP=$P(LOC,U,3),LOC=$P(LOC,U)
"RTN","TIUSRVLO",211,0)
 S TIUADT=$S(LOCTYP="W":"Adm: ",1:"Visit: ")_$$DATE^TIULS($P(TIUR0,U,7),"MM/DD/YY")
"RTN","TIUSRVLO",212,0)
 S TIUDDT=$S(+$P(TIUR0,U,8):"Dis: ",1:"")_$$DATE^TIULS($P(TIUR0,U,8),"MM/DD/YY")
"RTN","TIUSRVLO",213,0)
 I +$G(SHOWADD)>0 S TIUADT=TIUADT_";"_$P(TIUR0,U,7),TIUDDT=TIUDDT_";"_$P(TIUR0,U,8)
"RTN","TIUSRVLO",214,0)
 S PT=$$NAME^TIULS($P(TIUPT,U),"LAST, FIRST MI")
"RTN","TIUSRVLO",215,0)
 S TIULST4=$E($P(TIUPT,U,9),6,9)
"RTN","TIUSRVLO",216,0)
 S TIULST4="("_$E(PT)_TIULST4_")"
"RTN","TIUSRVLO",217,0)
 S AUT=+$P(TIUR12,U,2)
"RTN","TIUSRVLO",218,0)
 S AUT=AUT_";"_$$SIGNAME^TIULS(+$P(TIUR12,U,2))_";"_$$GET1^DIQ(200,AUT,.01)
"RTN","TIUSRVLO",219,0)
 S EDT=+TIUR13,EDTCNT=+$G(EDTCNT)+1
"RTN","TIUSRVLO",220,0)
 S TIUREC=DOC_U_EDT_U_PT_" "_TIULST4_U_AUT_U_LOC_U_STATUS_U_TIUADT_U_TIUDDT_U_$P(TIUR14,U,5)_U_$$IMGCNT(DA)_U
"RTN","TIUSRVLO",221,0)
 S TIUREC=TIUREC_$S($L(TIUR17):$E(TIUR17,1,(255-$L(TIUREC)))_U,1:U)
"RTN","TIUSRVLO",222,0)
 S TIUREC=TIUREC_$P(PREFIX," ")_U
"RTN","TIUSRVLO",223,0)
 S TIUREC=TIUREC_$S(+TIUR0=81:+$P(TIUR0,U,6),+IDPARENT:IDPARENT,+$G(CONTEXT):CONTEXT,1:1)_U_$G(IDSORT)
"RTN","TIUSRVLO",224,0)
 Q $G(TIUREC)
"RTN","TIUSRVLO",225,0)
IMGCNT(TIUDA) ; Get the number of images associated with a document
"RTN","TIUSRVLO",226,0)
 N IMGDA,TIUI S (IMGDA,TIUI)=0
"RTN","TIUSRVLO",227,0)
 F  S IMGDA=$O(^TIU(8925.91,"ADI",TIUDA,IMGDA)) Q:+IMGDA'>0  D
"RTN","TIUSRVLO",228,0)
 . S TIUI=TIUI+1
"RTN","TIUSRVLO",229,0)
 Q TIUI
"RTN","TIUSRVLO",230,0)
IDSORT(TIUDA) ; Get ID Sort indicator when appropriate
"RTN","TIUSRVLO",231,0)
 N TIUDPRM
"RTN","TIUSRVLO",232,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+TIUDA,0)),.TIUDPRM)
"RTN","TIUSRVLO",233,0)
 Q +$P(TIUDPRM(0),U,18)
"RTN","TIUSRVLP")
0^12^B3762560
"RTN","TIUSRVLP",1,0)
TIUSRVLP ;BAY PINES/ELR - Server fns - Cont of TIUSRVLO ;20-NOV-2001 08:51:07
"RTN","TIUSRVLP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**194,268**;Jun 20, 1997;Build 60
"RTN","TIUSRVLP",3,0)
 ;
"RTN","TIUSRVLP",4,0)
 ;
"RTN","TIUSRVLP",5,0)
 ;
"RTN","TIUSRVLP",6,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*194 FORCED TO BREAK UP TIUSRVLO DUE TO SIZE
"RTN","TIUSRVLP",7,0)
APTCL(TIUY,CLASS,TIUAUTH,DFN,TIME1,TIME2,SEQUENCE) ; Signed, by author
"RTN","TIUSRVLP",8,0)
 N DATTIM,DA,ROOT,TIUI,TIUS12,TIUS15
"RTN","TIUSRVLP",9,0)
 S ROOT=$NA(^TIU(8925,"APTCL",DFN,CLASS))
"RTN","TIUSRVLP",10,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLP",11,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLP",12,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLP",13,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DA) Q
"RTN","TIUSRVLP",14,0)
 . . S TIUI=$S(SEQUENCE="D":+$G(TIUI)+1,1:+$G(TIUI)-1)
"RTN","TIUSRVLP",15,0)
 . . Q:+$D(@TIUY@("INDX",DA))
"RTN","TIUSRVLP",16,0)
 . . ; Selectively filter DELETED or RETRACTED records 
"RTN","TIUSRVLP",17,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>13,'+$$CANDO^TIULP(DA,"VIEW",DUZ) Q
"RTN","TIUSRVLP",18,0)
 . . S TIUS12=$G(^TIU(8925,DA,12))
"RTN","TIUSRVLP",19,0)
 . . Q:+$P(TIUS12,U,2)'=TIUAUTH         ;See if this is the authors note
"RTN","TIUSRVLP",20,0)
 . . S TIUS15=$G(^TIU(8925,DA,15))
"RTN","TIUSRVLP",21,0)
 . . Q:+$P(TIUS15,U,2)'>0                 ;See if signed
"RTN","TIUSRVLP",22,0)
 . . S @TIUY@(TIUI)=DA_U_$$RESOLVE^TIUSRVLO(DA)
"RTN","TIUSRVLP",23,0)
 . . S @TIUY@("INDX",DA,TIUI)=""
"RTN","TIUSRVLP",24,0)
 . . Q:+$G(SHOWADD)=0
"RTN","TIUSRVLP",25,0)
 . . S TIUP=+$$HASDAD^TIUSRVLI(DA) I TIUP D  D SETDAD^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLP",26,0)
 . . . N TIUPT
"RTN","TIUSRVLP",27,0)
 . . . S TIUPT=$P($G(^TIU(8925,+DA,0)),"^",6)
"RTN","TIUSRVLP",28,0)
 . . . I TIUPT]"",'$D(^TIU(8925,"DAD",TIUPT,DA)) S ^TIU(8925,"DAD",TIUPT,DA)=""
"RTN","TIUSRVLP",29,0)
 . . . I TIUPT="" S TIUPT=$G(^TIU(8925,+DA,21))
"RTN","TIUSRVLP",30,0)
 . . . I '$D(^TIU(8925,TIUPT,0)) S $P(@TIUY@(TIUI),"^",16)=1,$P(@TIUY@(TIUI),"^",14)=4 Q
"RTN","TIUSRVLP",31,0)
 . . I +$$HASKIDS^TIUSRVLI(DA) D SETKIDS^TIUSRVLI(.TIUY,DA,.TIUI)
"RTN","TIUSRVLP",32,0)
 Q
"VER")
8.0^22.0
**END**
**END**
