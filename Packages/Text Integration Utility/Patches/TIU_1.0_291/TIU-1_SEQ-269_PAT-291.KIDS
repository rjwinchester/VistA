Released TIU*1*291 SEQ #269
Extracted from mail message
**KIDS**:TIU*1.0*291^

**INSTALL NAME**
TIU*1.0*291
"BLD",9173,0)
TIU*1.0*291^TEXT INTEGRATION UTILITIES^0^3151103^y
"BLD",9173,1,0)
^^1^1^3151027^^^
"BLD",9173,1,1,0)
This patch implements the CWAD AUTO-DEMOTION functionality.
"BLD",9173,4,0)
^9.64PA^^
"BLD",9173,6)
1^
"BLD",9173,6.3)
5
"BLD",9173,"KRN",0)
^9.67PA^779.2^20
"BLD",9173,"KRN",.4,0)
.4
"BLD",9173,"KRN",.401,0)
.401
"BLD",9173,"KRN",.402,0)
.402
"BLD",9173,"KRN",.403,0)
.403
"BLD",9173,"KRN",.5,0)
.5
"BLD",9173,"KRN",.84,0)
.84
"BLD",9173,"KRN",3.6,0)
3.6
"BLD",9173,"KRN",3.8,0)
3.8
"BLD",9173,"KRN",9.2,0)
9.2
"BLD",9173,"KRN",9.8,0)
9.8
"BLD",9173,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9173,"KRN",9.8,"NM",1,0)
TIUCWD^^0^B2873731
"BLD",9173,"KRN",9.8,"NM",2,0)
TIUCWDUT^^0^B10012924
"BLD",9173,"KRN",9.8,"NM","B","TIUCWD",1)

"BLD",9173,"KRN",9.8,"NM","B","TIUCWDUT",2)

"BLD",9173,"KRN",19,0)
19
"BLD",9173,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",9173,"KRN",19,"NM",2,0)
TIU MAIN MENU MGR^^2
"BLD",9173,"KRN",19,"NM",3,0)
TIU CWAD AUTO-DEMOTION^^0
"BLD",9173,"KRN",19,"NM","B","TIU CWAD AUTO-DEMOTION",3)

"BLD",9173,"KRN",19,"NM","B","TIU MAIN MENU MGR",2)

"BLD",9173,"KRN",19.1,0)
19.1
"BLD",9173,"KRN",101,0)
101
"BLD",9173,"KRN",409.61,0)
409.61
"BLD",9173,"KRN",771,0)
771
"BLD",9173,"KRN",779.2,0)
779.2
"BLD",9173,"KRN",870,0)
870
"BLD",9173,"KRN",8989.51,0)
8989.51
"BLD",9173,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9173,"KRN",8989.51,"NM",1,0)
TIU CWAD EXCLUDED TITLES^^0
"BLD",9173,"KRN",8989.51,"NM","B","TIU CWAD EXCLUDED TITLES",1)

"BLD",9173,"KRN",8989.52,0)
8989.52
"BLD",9173,"KRN",8994,0)
8994
"BLD",9173,"KRN","B",.4,.4)

"BLD",9173,"KRN","B",.401,.401)

"BLD",9173,"KRN","B",.402,.402)

"BLD",9173,"KRN","B",.403,.403)

"BLD",9173,"KRN","B",.5,.5)

"BLD",9173,"KRN","B",.84,.84)

"BLD",9173,"KRN","B",3.6,3.6)

"BLD",9173,"KRN","B",3.8,3.8)

"BLD",9173,"KRN","B",9.2,9.2)

"BLD",9173,"KRN","B",9.8,9.8)

"BLD",9173,"KRN","B",19,19)

"BLD",9173,"KRN","B",19.1,19.1)

"BLD",9173,"KRN","B",101,101)

"BLD",9173,"KRN","B",409.61,409.61)

"BLD",9173,"KRN","B",771,771)

"BLD",9173,"KRN","B",779.2,779.2)

"BLD",9173,"KRN","B",870,870)

"BLD",9173,"KRN","B",8989.51,8989.51)

"BLD",9173,"KRN","B",8989.52,8989.52)

"BLD",9173,"KRN","B",8994,8994)

"BLD",9173,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",9173,"QUES",0)
^9.62^^
"BLD",9173,"REQB",0)
^9.611^^
"KRN",19,10368,-1)
2^2
"KRN",19,10368,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^10000000180^^^^^^y^516^^1^^^1
"KRN",19,10368,10,0)
^19.01IP^25^25
"KRN",19,10368,10,25,0)
14379^17^17
"KRN",19,10368,10,25,"^")
TIU CWAD AUTO-DEMOTION
"KRN",19,10368,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,14379,-1)
0^3
"KRN",19,14379,0)
TIU CWAD AUTO-DEMOTION^CWAD/Postings Auto-Demotion Setup^^R^^^^^^^^TEXT INTEGRATION UTILITIES^^
"KRN",19,14379,1,0)
^19.06^1^1^3150113^^^
"KRN",19,14379,1,1,0)
This option is used to setup CWAD Auto-Demotion.
"KRN",19,14379,20)

"KRN",19,14379,25)
EN^TIUCWDUT
"KRN",19,14379,"U")
CWAD/POSTINGS AUTO-DEMOTION SE
"KRN",8989.5,22035,0)
516;DIC(9.4,^TIU CWAD EXCLUDED TITLES^2
"KRN",8989.5,22035,1)
ADVANCE DIRECTIVE DISCUSSION
"KRN",8989.5,22036,0)
516;DIC(9.4,^TIU CWAD EXCLUDED TITLES^3
"KRN",8989.5,22036,1)
RESCINDED ADVANCE DIRECTIVE
"KRN",8989.5,22037,0)
516;DIC(9.4,^TIU CWAD EXCLUDED TITLES^1
"KRN",8989.5,22037,1)
ADVANCE DIRECTIVE
"KRN",8989.51,839,-1)
0^1
"KRN",8989.51,839,0)
TIU CWAD EXCLUDED TITLES^CWAD AUTO-DEMOTION EXCLUDED TITLES^1^^TITLE TO EXCLUDE FROM AUTO-DEMOTION
"KRN",8989.51,839,1)
P^8926.1^This is a VHA Enterprise Standard title to exclude from auto-demotion.
"KRN",8989.51,839,2)

"KRN",8989.51,839,3)

"KRN",8989.51,839,6)
N^1:100:0^Enter a new instance for this parameter.
"KRN",8989.51,839,8)

"KRN",8989.51,839,20,0)
^8989.512^3^3^3151027^^^^
"KRN",8989.51,839,20,1,0)
THIS PARAMETER IS USED TO EXCLUDE CWAD NOTE TITLES, WHICH ARE MAPPED TO
"KRN",8989.51,839,20,2,0)
THE SELECTED VHA ENTERPRISE STANDARD TITLES, FROM THE AUTO-DEMOTION
"KRN",8989.51,839,20,3,0)
FUNCTIONALITY.
"KRN",8989.51,839,30,0)
^8989.513I^1^1
"KRN",8989.51,839,30,1,0)
1^9.4
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^2970620^2970815^11712
"PKG",516,22,1,"PAH",1,0)
291^3151103^2
"PKG",516,22,1,"PAH",1,1,0)
^^1^1^3151103
"PKG",516,22,1,"PAH",1,1,1,0)
This patch implements the CWAD AUTO-DEMOTION functionality.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUCWD")
0^1^B2873731^n/a
"RTN","TIUCWD",1,0)
TIUCWD ;SLC/TDP - TIU CWAD POSTING AUTO-DEMOTION ;01/13/15  12:19
"RTN","TIUCWD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**291**;Jun 20, 1997;Build 5
"RTN","TIUCWD",3,0)
 ;
"RTN","TIUCWD",4,0)
SILENT(TIUFROM,TIUTO) ;
"RTN","TIUCWD",5,0)
 I +$G(TIUDA)&('+$G(DFN)) D  ;TO GET DFN BASED ON TIUDA IF NOT PRESENT
"RTN","TIUCWD",6,0)
 . S DFN=+$P($G(^TIU(8925,TIUDA,0)),"^",2)
"RTN","TIUCWD",7,0)
 Q:'$G(DFN)
"RTN","TIUCWD",8,0)
 N TIUNDT,TIUNIEN,TIUCLIK
"RTN","TIUCWD",9,0)
 Q:$G(^TIU(8925.1,+TIUFROM,0))']""
"RTN","TIUCWD",10,0)
 Q:$G(^TIU(8925.1,+TIUTO,0))']""
"RTN","TIUCWD",11,0)
 S (TIUNDT,TIUCLIK)=0 F  S TIUNDT=$O(^TIU(8925,"APT",DFN,TIUFROM,7,TIUNDT)) Q:'+TIUNDT  D
"RTN","TIUCWD",12,0)
 . S TIUNIEN=0 F  S TIUNIEN=$O(^TIU(8925,"APT",DFN,TIUFROM,7,TIUNDT,TIUNIEN)) Q:'+TIUNIEN  D
"RTN","TIUCWD",13,0)
 .. S TIUCLIK=TIUCLIK+1  Q:(TIUCLIK'>1)  ;LEAVE THE MOST RECENT NOTE
"RTN","TIUCWD",14,0)
 .. D DEMOTE(TIUNIEN,TIUTO)
"RTN","TIUCWD",15,0)
 Q
"RTN","TIUCWD",16,0)
DEMOTE(TIUDA,TIUTO) ;
"RTN","TIUCWD",17,0)
 N DIE,DR,CHKSUM,LOCKTM
"RTN","TIUCWD",18,0)
 S LOCKTM=$S(+DILOCKTM>1:DILOCKTM,1:1)
"RTN","TIUCWD",19,0)
 L +^TIU(8925,TIUDA,0):LOCKTM
"RTN","TIUCWD",20,0)
 E  D  Q
"RTN","TIUCWD",21,0)
 . W:$E(IOST,1,2)="C-" !,"Unable to obtain lock for entry "_TIUDA
"RTN","TIUCWD",22,0)
 S DIE=8925,DA=TIUDA
"RTN","TIUCWD",23,0)
 S DR=".01////^S X="_TIUTO_";.04////^S X="_$$DOCCLASS^TIULC1(TIUTO)
"RTN","TIUCWD",24,0)
 D ^DIE
"RTN","TIUCWD",25,0)
 S CHKSUM=+$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")")
"RTN","TIUCWD",26,0)
 D AUDIT^TIUEDI1(TIUDA,CHKSUM,CHKSUM)
"RTN","TIUCWD",27,0)
 L -^TIU(8925,TIUDA,0)
"RTN","TIUCWD",28,0)
 W:$E(IOST,1,2)="C-" !,"Entry demoted from posting status "_TIUDA
"RTN","TIUCWD",29,0)
 Q
"RTN","TIUCWDUT")
0^2^B10012924^n/a
"RTN","TIUCWDUT",1,0)
TIUCWDUT ;SLC/TDP - CWAD POSTINGS AUTO-DEMOTION UTILITY ;10/27/15  15:11
"RTN","TIUCWDUT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**291**;Jun 20, 1997;Build 5
"RTN","TIUCWDUT",3,0)
 Q
"RTN","TIUCWDUT",4,0)
EN ;
"RTN","TIUCWDUT",5,0)
 W @IOF
"RTN","TIUCWDUT",6,0)
 N TIUCWAD,TIUNON,TIUNOGO,STRING,POSTTL,RESTRICT
"RTN","TIUCWDUT",7,0)
 ;I DUZ(0)'["@" D  Q
"RTN","TIUCWDUT",8,0)
 ;. W !,"Because of TIU file #8925.1 security, programmer access with '@' is required for this option to work."
"RTN","TIUCWDUT",9,0)
 D GETSCRN(.POSTTL,.RESTRICT)
"RTN","TIUCWDUT",10,0)
 S TIUCWAD=$$GETCWAD(.POSTTL) Q:TIUCWAD'>0  W !
"RTN","TIUCWDUT",11,0)
 S TIUNOGO=$$INHERIT(TIUCWAD) I TIUNOGO W !,"Okay.  Nothing will be changed." Q
"RTN","TIUCWDUT",12,0)
 S TIUNON=$$GETNON(.POSTTL,.RESTRICT) Q:TIUNON'>0
"RTN","TIUCWDUT",13,0)
 K POSTTL,RESTRICT
"RTN","TIUCWDUT",14,0)
 S STRING="D SILENT^TIUCWD("_TIUCWAD_","_TIUNON_")"
"RTN","TIUCWDUT",15,0)
 ;D CHECK Q:PREVPOST]""
"RTN","TIUCWDUT",16,0)
 D FILE(TIUCWAD,STRING)
"RTN","TIUCWDUT",17,0)
 W !!,"Done.  Post-Signature code has been set (or reset) as follows..."
"RTN","TIUCWDUT",18,0)
 W !,"TITLE: "_$$GET1^DIQ(8925.1,TIUCWAD,.01)
"RTN","TIUCWDUT",19,0)
 W !,"POST-SIGNATURE ACTION: "_$$GET1^DIQ(8925.1,TIUCWAD,4.9)
"RTN","TIUCWDUT",20,0)
 Q
"RTN","TIUCWDUT",21,0)
GETSCRN(POSTTL,RESTRICT) ;Set-up arrays used in ^DIC call screen
"RTN","TIUCWDUT",22,0)
 N CWD,CWDEXC,CWDIEN,POSTDC,POSTLETT,QUIT,VHATITLE,X
"RTN","TIUCWDUT",23,0)
 D GETLST^XPAR(.CWD,"PKG","TIU CWAD EXCLUDED TITLES","I")
"RTN","TIUCWDUT",24,0)
 S X=""
"RTN","TIUCWDUT",25,0)
 I $D(CWD) D
"RTN","TIUCWDUT",26,0)
 . F  S X=$O(CWD(X)) Q:X=""  D
"RTN","TIUCWDUT",27,0)
 .. S CWDIEN=+$G(CWD(X))
"RTN","TIUCWDUT",28,0)
 .. I CWDIEN>0 D
"RTN","TIUCWDUT",29,0)
 ... S CWDEXC(CWDIEN)=""
"RTN","TIUCWDUT",30,0)
 . K CWD
"RTN","TIUCWDUT",31,0)
 F POSTLETT="C","W","A","D" S POSTDC=$O(^TIU(8925.1,"APOST",POSTLETT,0)) I +POSTDC S POSTDC(POSTDC)=""
"RTN","TIUCWDUT",32,0)
 S POSTDC=0
"RTN","TIUCWDUT",33,0)
 F  S POSTDC=$O(POSTDC(POSTDC)) Q:'+POSTDC  D
"RTN","TIUCWDUT",34,0)
 . S POSTTL=0
"RTN","TIUCWDUT",35,0)
 . F  S POSTTL=+$O(^TIU(8925.1,POSTDC,10,"B",POSTTL)) Q:'+POSTTL  D
"RTN","TIUCWDUT",36,0)
 .. S VHATITLE=+$P($G(^TIU(8925.1,POSTTL,15)),U,1)
"RTN","TIUCWDUT",37,0)
 .. S QUIT=0
"RTN","TIUCWDUT",38,0)
 .. I $D(CWDEXC(VHATITLE)) S RESTRICT(POSTTL)="",QUIT=1
"RTN","TIUCWDUT",39,0)
 .. I QUIT=0 S POSTTL(POSTTL)=""
"RTN","TIUCWDUT",40,0)
 Q
"RTN","TIUCWDUT",41,0)
GETCWAD(POSTTL) ;Select CWAD type documents
"RTN","TIUCWDUT",42,0)
 N DIC,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","TIUCWDUT",43,0)
 S DIC=8925.1,DIC(0)="AEMQ",DIC("A")="Select a CWAD/Postings TITLE for auto-demotion: "
"RTN","TIUCWDUT",44,0)
 S DIC("S")="I $D(POSTTL(Y))"
"RTN","TIUCWDUT",45,0)
 D ^DIC
"RTN","TIUCWDUT",46,0)
 Q +Y
"RTN","TIUCWDUT",47,0)
GETNON(POSTTL,RESTRICT) ;Select non-CWAD type documents
"RTN","TIUCWDUT",48,0)
 N DIC,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","TIUCWDUT",49,0)
 S DIC=8925.1,DIC(0)="AEMQ",DIC("A")="Select a NON-Posting TITLE as the demotion target: "
"RTN","TIUCWDUT",50,0)
 S DIC("S")="I ($P($G(^TIU(8925.1,Y,0)),U,4)=""DOC"")&('$D(POSTTL(Y))&('$D(RESTRICT(Y))))"
"RTN","TIUCWDUT",51,0)
 D ^DIC
"RTN","TIUCWDUT",52,0)
 Q +Y
"RTN","TIUCWDUT",53,0)
CHECK ;This subroutine is being orphaned as of 8-28-09
"RTN","TIUCWDUT",54,0)
 ;S PREVPOST=$$POSTSIGN^TIULC1(TIUCWAD)
"RTN","TIUCWDUT",55,0)
 ;I PREVPOST]"" D
"RTN","TIUCWDUT",56,0)
 ;. W !,"The selected CWAD/Postings title already has a TIU POST-SIGNATURE ACTION,"
"RTN","TIUCWDUT",57,0)
 ;. W !,"possibly by inheritance."
"RTN","TIUCWDUT",58,0)
 ;. W !!,"It is --> ",PREVPOST
"RTN","TIUCWDUT",59,0)
 ;. W !,"You will have to set the code manually through programmer-access FileMan."
"RTN","TIUCWDUT",60,0)
 ;Q
"RTN","TIUCWDUT",61,0)
INHERIT(TIUCWAD) ;Previous Post-Signature Action
"RTN","TIUCWDUT",62,0)
 ;Returns a 1 to indicate No-Go, meaning do not proceed
"RTN","TIUCWDUT",63,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,PREVPOST,X,Y
"RTN","TIUCWDUT",64,0)
 S Y=0
"RTN","TIUCWDUT",65,0)
 S PREVPOST=$$POSTSIGN^TIULC1(TIUCWAD)
"RTN","TIUCWDUT",66,0)
 Q:PREVPOST']"" 0
"RTN","TIUCWDUT",67,0)
 W !,"The selected CWAD/Postings title already has a TIU POST-SIGNATURE ACTION,"
"RTN","TIUCWDUT",68,0)
 W !,"possibly by inheritance."
"RTN","TIUCWDUT",69,0)
 W !!,"It is --> ",PREVPOST
"RTN","TIUCWDUT",70,0)
 W !!,"Do you wish to CONTINUE (and thus OVERWRITE) the Post-Signature Action?"
"RTN","TIUCWDUT",71,0)
 W !,"You can also choose to exit, which will make no changes.",!
"RTN","TIUCWDUT",72,0)
 S DIR(0)="YA",DIR("A")="Continue/overwrite? (Y/N): "
"RTN","TIUCWDUT",73,0)
 D ^DIR
"RTN","TIUCWDUT",74,0)
 Q $S(+Y'=1:1,1:0)
"RTN","TIUCWDUT",75,0)
FILE(TIUCWAD,STRING) ;Saves new Post-Signature Action
"RTN","TIUCWDUT",76,0)
 ;Changing to a direct file save to get past file protections.
"RTN","TIUCWDUT",77,0)
 ;N DA,DIDEL,DIE,DR,DTOUT,BKPDUZ0
"RTN","TIUCWDUT",78,0)
 ;S DIE=8925.1,DA=TIUCWAD,DR="4.9///^S X=STRING" D ^DIE
"RTN","TIUCWDUT",79,0)
 S ^TIU(8925.1,TIUCWAD,4.9)=STRING
"RTN","TIUCWDUT",80,0)
 Q
"VER")
8.0^22.0
"BLD",9173,6)
^269
**END**
**END**

