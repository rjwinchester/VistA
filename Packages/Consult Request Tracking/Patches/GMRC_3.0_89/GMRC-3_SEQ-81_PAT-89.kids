Released GMRC*3*89 SEQ #81
Extracted from mail message
**KIDS**:GMRC*3.0*89^

**INSTALL NAME**
GMRC*3.0*89
"BLD",10052,0)
GMRC*3.0*89^CONSULT/REQUEST TRACKING^0^3171127^y
"BLD",10052,1,0)
^^4^4^3170202^^
"BLD",10052,1,1,0)
The Consult Closure Tool allows users to track consults, associated 
"BLD",10052,1,2,0)
follow-up appointments, and associated progress notes.  Consults may be 
"BLD",10052,1,3,0)
closed interactively.  A consult/note report may be printed.  A CPRS team 
"BLD",10052,1,4,0)
may be updated.
"BLD",10052,4,0)
^9.64PA^123.033^2
"BLD",10052,4,123.033,0)
123.033
"BLD",10052,4,123.033,222)
y^y^f^^^^n
"BLD",10052,4,123.5,0)
123.5
"BLD",10052,4,123.5,2,0)
^9.641^123.5^1
"BLD",10052,4,123.5,2,123.5,0)
REQUEST SERVICES  (File-top level)
"BLD",10052,4,123.5,2,123.5,1,0)
^9.6411^689^1
"BLD",10052,4,123.5,2,123.5,1,689,0)
SECONDARY PRINTER
"BLD",10052,4,123.5,222)
y^y^p^^^^n^^n
"BLD",10052,4,123.5,224)

"BLD",10052,4,"APDD",123.5,123.5)

"BLD",10052,4,"APDD",123.5,123.5,689)

"BLD",10052,4,"B",123.033,123.033)

"BLD",10052,4,"B",123.5,123.5)

"BLD",10052,6.3)
62
"BLD",10052,"ABPKG")
n
"BLD",10052,"KRN",0)
^9.67PA^779.2^20
"BLD",10052,"KRN",.4,0)
.4
"BLD",10052,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",10052,"KRN",.4,"NM",1,0)
GMRC CONSULT MAPPING INQIRE    FILE #123.033^123.033^0
"BLD",10052,"KRN",.4,"NM","B","GMRC CONSULT MAPPING INQIRE    FILE #123.033",1)

"BLD",10052,"KRN",.401,0)
.401
"BLD",10052,"KRN",.401,"NM",0)
^9.68A^^
"BLD",10052,"KRN",.402,0)
.402
"BLD",10052,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",10052,"KRN",.402,"NM",1,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",10052,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",1)

"BLD",10052,"KRN",.403,0)
.403
"BLD",10052,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",10052,"KRN",.403,"NM",1,0)
GMRC MAIN    FILE #123.033^123.033^0
"BLD",10052,"KRN",.403,"NM","B","GMRC MAIN    FILE #123.033",1)

"BLD",10052,"KRN",.5,0)
.5
"BLD",10052,"KRN",.84,0)
.84
"BLD",10052,"KRN",3.6,0)
3.6
"BLD",10052,"KRN",3.8,0)
3.8
"BLD",10052,"KRN",9.2,0)
9.2
"BLD",10052,"KRN",9.8,0)
9.8
"BLD",10052,"KRN",9.8,"NM",0)
^9.68A^10^9
"BLD",10052,"KRN",9.8,"NM",1,0)
GMRCCA^^0^B44932985
"BLD",10052,"KRN",9.8,"NM",2,0)
GMRCCB^^0^B82765732
"BLD",10052,"KRN",9.8,"NM",3,0)
GMRCCC^^0^B65555262
"BLD",10052,"KRN",9.8,"NM",4,0)
GMRCCD^^0^B84857854
"BLD",10052,"KRN",9.8,"NM",5,0)
GMRCCY^^0^B68601290
"BLD",10052,"KRN",9.8,"NM",6,0)
GMRCCX^^0^B8358463
"BLD",10052,"KRN",9.8,"NM",8,0)
GMRCUTL1^^0^B14006176
"BLD",10052,"KRN",9.8,"NM",9,0)
GMRCP5D^^0^B75434506
"BLD",10052,"KRN",9.8,"NM",10,0)
GMRCUTL2^^0^B1531525
"BLD",10052,"KRN",9.8,"NM","B","GMRCCA",1)

"BLD",10052,"KRN",9.8,"NM","B","GMRCCB",2)

"BLD",10052,"KRN",9.8,"NM","B","GMRCCC",3)

"BLD",10052,"KRN",9.8,"NM","B","GMRCCD",4)

"BLD",10052,"KRN",9.8,"NM","B","GMRCCX",6)

"BLD",10052,"KRN",9.8,"NM","B","GMRCCY",5)

"BLD",10052,"KRN",9.8,"NM","B","GMRCP5D",9)

"BLD",10052,"KRN",9.8,"NM","B","GMRCUTL1",8)

"BLD",10052,"KRN",9.8,"NM","B","GMRCUTL2",10)

"BLD",10052,"KRN",19,0)
19
"BLD",10052,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",10052,"KRN",19,"NM",1,0)
GMRC CONSULT CLOSURE TOOL^^0
"BLD",10052,"KRN",19,"NM",2,0)
GMRC MGR^^2
"BLD",10052,"KRN",19,"NM",3,0)
GMRC CONSULT CLOSE TOOL EDT^^0
"BLD",10052,"KRN",19,"NM",4,0)
GMRC CONSULT CLOSE TOOL INQ^^0
"BLD",10052,"KRN",19,"NM",5,0)
GMRC CONSULT CLOSE TOOL RUN^^0
"BLD",10052,"KRN",19,"NM","B","GMRC CONSULT CLOSE TOOL EDT",3)

"BLD",10052,"KRN",19,"NM","B","GMRC CONSULT CLOSE TOOL INQ",4)

"BLD",10052,"KRN",19,"NM","B","GMRC CONSULT CLOSE TOOL RUN",5)

"BLD",10052,"KRN",19,"NM","B","GMRC CONSULT CLOSURE TOOL",1)

"BLD",10052,"KRN",19,"NM","B","GMRC MGR",2)

"BLD",10052,"KRN",19.1,0)
19.1
"BLD",10052,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",10052,"KRN",101,0)
101
"BLD",10052,"KRN",101,"NM",0)
^9.68A^^
"BLD",10052,"KRN",409.61,0)
409.61
"BLD",10052,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",10052,"KRN",771,0)
771
"BLD",10052,"KRN",771,"NM",0)
^9.68A^^
"BLD",10052,"KRN",779.2,0)
779.2
"BLD",10052,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",10052,"KRN",870,0)
870
"BLD",10052,"KRN",870,"NM",0)
^9.68A^^
"BLD",10052,"KRN",8989.51,0)
8989.51
"BLD",10052,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",10052,"KRN",8989.52,0)
8989.52
"BLD",10052,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",10052,"KRN",8994,0)
8994
"BLD",10052,"KRN",8994,"NM",0)
^9.68A^^
"BLD",10052,"KRN","B",.4,.4)

"BLD",10052,"KRN","B",.401,.401)

"BLD",10052,"KRN","B",.402,.402)

"BLD",10052,"KRN","B",.403,.403)

"BLD",10052,"KRN","B",.5,.5)

"BLD",10052,"KRN","B",.84,.84)

"BLD",10052,"KRN","B",3.6,3.6)

"BLD",10052,"KRN","B",3.8,3.8)

"BLD",10052,"KRN","B",9.2,9.2)

"BLD",10052,"KRN","B",9.8,9.8)

"BLD",10052,"KRN","B",19,19)

"BLD",10052,"KRN","B",19.1,19.1)

"BLD",10052,"KRN","B",101,101)

"BLD",10052,"KRN","B",409.61,409.61)

"BLD",10052,"KRN","B",771,771)

"BLD",10052,"KRN","B",779.2,779.2)

"BLD",10052,"KRN","B",870,870)

"BLD",10052,"KRN","B",8989.51,8989.51)

"BLD",10052,"KRN","B",8989.52,8989.52)

"BLD",10052,"KRN","B",8994,8994)

"BLD",10052,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10052,"QUES",0)
^9.62^^
"BLD",10052,"REQB",0)
^9.611^2^2
"BLD",10052,"REQB",1,0)
GMRC*3.0*28^1
"BLD",10052,"REQB",2,0)
GMRC*3.0*82^1
"BLD",10052,"REQB","B","GMRC*3.0*28",1)

"BLD",10052,"REQB","B","GMRC*3.0*82",2)

"FIA",123.033)
GMRC CONSULT MAPPING
"FIA",123.033,0)
^GMR(123.033,
"FIA",123.033,0,0)
123.033
"FIA",123.033,0,1)
y^y^f^^^^n
"FIA",123.033,0,10)

"FIA",123.033,0,11)

"FIA",123.033,0,"RLRO")

"FIA",123.033,0,"VR")
3.0^GMRC
"FIA",123.033,123.033)
0
"FIA",123.033,123.0331)
0
"FIA",123.033,123.0332)
0
"FIA",123.033,123.0333)
0
"FIA",123.033,123.0334)
0
"FIA",123.033,123.0335)
0
"FIA",123.033,123.0336)
0
"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5I
"FIA",123.5,0,1)
y^y^p^^^^n^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,689)

"KRN",.4,5728,-1)
0^1
"KRN",.4,5728,0)
GMRC CONSULT MAPPING INQIRE^3170111.1119^^123.033^^^3170216
"KRN",.4,5728,"F",1)

"KRN",.4,5728,"F",2)
S DIP(2)=$S($D(^GMR(123.033,D0,0)):^(0),1:"") S X="Config Name: ",DIP(1)=$G(X) S X=$P(DIP(2),U,1),Y=X,X=DIP(1),X=X_Y W X K DIP;C1;X;Z;""Config Name: "_(#.01)"~
"KRN",.4,5728,"F",3)
S DIP(2)=$S($D(^GMR(123.033,D0,0)):^(0),1:"") S X="Days Cons->Appt: ",DIP(1)=$G(X) S X=$P(DIP(2),U,4),Y=X,X=DIP(1),X=X_Y W X K DIP;C48;X;Z;""Days Cons->Appt: "_(#.04)"~
"KRN",.4,5728,"F",4)
"Inactive:";C72;X~
"KRN",.4,5728,"F",5)
S DIP(2)=$S($D(^GMR(123.033,D0,0)):^(0),1:"") S X="CPRS Team:   ",DIP(1)=$G(X) S X=$P($G(^OR(100.21,+$P(DIP(2),U,3),0)),U),Y=X,X=DIP(1),X=X_Y W X K DIP;C1;X;Z;""CPRS Team:   "_(#.03)"~
"KRN",.4,5728,"F",6)
S DIP(2)=$S($D(^GMR(123.033,D0,0)):^(0),1:"") S X="Days Appt->Note: ",DIP(1)=$G(X) S X=$P(DIP(2),U,5),Y=X,X=DIP(1),X=X_Y W X K DIP;C48;X;Z;""Days Appt->Note: "_(#.05)"~
"KRN",.4,5728,"F",7)
.02;C75;X~"Consult Services:";S1;C1;X~1000,.01;C3;X~"Consult Procedures:";S1;C1;X~2000,.01;C3;X~"Consult Order Items:";S1;C1;X~3000,.01;C3;X~
"KRN",.4,5728,"F",8)
"Consult Clinical Procedures:";S1;C1;X~4000,.01;C3;X~"Stop Code: ";S1;C1;X~.06;C12;X~"Clinics:";S1;C1;X~5000,.01;C3;X~"Note Titles:";S1;C1;X~
"KRN",.4,5728,"F",9)
6000,.01;C3;X~
"KRN",.4,5728,"H")
Consult Closure Tool Configuration
"KRN",.4,5728,"HLANG")
1
"KRN",.4,5728,"SUB")
1
"KRN",.402,1919,-1)
0^1
"KRN",.402,1919,0)
GMRC SETUP REQUEST SERVICE^3171101.1647^^123.5^^^3171103
"KRN",.402,1919,"DIAB",6,0,123.5,3)
PRINT NAME;"ABBREVIATED PRINT NAME (Optional)~"
"KRN",.402,1919,"DR",1,123.5)
I '$D(GMRCSAFE) D EN^DDIOL("Editing of this file should only be done via the Setup Request Services option.") S Y="";
"KRN",.402,1919,"DR",1,123.5,1)
I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL("Service is configured to receive inter-facility consults from another facility.","","!!");
"KRN",.402,1919,"DR",1,123.5,2)
I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL("Editing of the SERVICE NAME may disrupt inter-facility consult operations.","","!");D EN^DDIOL(" ") I $G(GMRCSAFE) S Y=123.01;
"KRN",.402,1919,"DR",1,123.5,3)
S:$P(^GMR(123.5,DA,0),U)="SUICIDE HOTLINE"!($P(^GMR(123.5,DA,0),U)="CARE COORDINATION HOME TELEHEALTH SCREENING") Y="@1";.01;@1;123.01///^S X="CONSULTS";I $G(GMRCSAFE) S Y=1.1;1.11ABBREVIATED PRINT NAME (Optional)~~;11;1.1;
"KRN",.402,1919,"DR",1,123.5,4)
123.03///^S X="GMRCACTM SERVICE ACTION MENU";2;123.09;689;1.04;1.05;125;I $G(GMRCSAFE) S Y=123.08;1.01;1.02;124;1.03;D EN^DDIOL(" ");D EN^DDIOL("Inter-facility information");I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL(" ") S Y=134;
"KRN",.402,1919,"DR",1,123.5,5)
132;133;I +$G(^GMR(123.5,DA,"IFC")) D EN^DDIOL(" ") S Y=123.08;134;D EN^DDIOL(" ");123.08;123.1;123.2;.08;123.3;123.31;123.35;123.33;123.34;.07;D EN^DDIOL(" ");123.5;1.06;.06;10;
"KRN",.402,1919,"DR",1,123.5,6)
S:$P(^GMR(123.5,DA,0),U)="ALL SERVICES"!($P(^GMR(123.5,DA,0),U)="SUICIDE HOTLINE") Y=0;150;
"KRN",.402,1919,"DR",2,123.51)
.01;2;
"KRN",.402,1919,"DR",2,123.5134)
.01;
"KRN",.402,1919,"DR",2,123.52)
.01;
"KRN",.402,1919,"DR",2,123.53)
.01;
"KRN",.402,1919,"DR",2,123.54)
.01;1;2;
"KRN",.402,1919,"DR",2,123.55)
.01;
"KRN",.402,1919,"DR",2,123.555)
.01;.02;
"KRN",.402,1919,"DR",2,123.57)
.01;
"KRN",.402,1919,"DR",2,123.58)
.01;.02;
"KRN",.402,1919,"DR",2,123.59)
.01;
"KRN",.403,156,-1)
0^1
"KRN",.403,156,0)
GMRC MAIN^@^@^^3170209^^^123.033^0^0^1
"KRN",.403,156,11)
N X S X="IOUOFF;IOUON" D ENDR^%ZISS
"KRN",.403,156,12)
K IOUOFF,IOUON
"KRN",.403,156,14)
D POSTSAVE^GMRCCA(DA)
"KRN",.403,156,20)

"KRN",.403,156,40,0)
^.4031I^1^1
"KRN",.403,156,40,1,0)
1^^1,1
"KRN",.403,156,40,1,1)
Page 1
"KRN",.403,156,40,1,40,0)
^.4032IP^^-8
"KRN",.403,156,40,1,40,582,0)
GMRC BASIC^1^1,1^e
"KRN",.403,156,40,1,40,583,0)
GMRC CONS SERV^2^7,1^e
"KRN",.403,156,40,1,40,583,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,584,0)
GMRC CONS PROC^3^7,40^e
"KRN",.403,156,40,1,40,584,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,585,0)
GMRC CLIN^7^15,1^e
"KRN",.403,156,40,1,40,585,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,586,0)
GMRC NOTE^8^15,40^e
"KRN",.403,156,40,1,40,586,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,587,0)
GMRC CONS PROT^4^11,1^e
"KRN",.403,156,40,1,40,587,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,588,0)
GMRC CONS CLPR^5^11,40^e
"KRN",.403,156,40,1,40,588,2)
3^B^n^0^^0
"KRN",.403,156,40,1,40,589,0)
GMRC STOP^6^14,12^e
"KRN",.404,582,0)
GMRC BASIC^123.033
"KRN",.404,582,40,0)
^.4044I^13^13
"KRN",.404,582,40,1,0)
3^Config Name^3
"KRN",.404,582,40,1,1)
.01
"KRN",.404,582,40,1,2)
3,15^30^3,2
"KRN",.404,582,40,2,0)
4^CPRS Team^3
"KRN",.404,582,40,2,1)
.03
"KRN",.404,582,40,2,2)
4,15^30^4,2
"KRN",.404,582,40,3,0)
7^Inactive^3
"KRN",.404,582,40,3,1)
.02
"KRN",.404,582,40,3,2)
4,74^3^3,71
"KRN",.404,582,40,3,3)
NO
"KRN",.404,582,40,4,0)
5^!M^3
"KRN",.404,582,40,4,.1)
S Y=$G(IOUON)_"Days Cons->Appt"_$G(IOUOFF)_":"
"KRN",.404,582,40,4,1)
.04
"KRN",.404,582,40,4,2)
3,65^4^3,48^1
"KRN",.404,582,40,4,4)
0
"KRN",.404,582,40,5,0)
6^!M^3
"KRN",.404,582,40,5,.1)
S Y=$G(IOUON)_"Days Appt->Note"_$G(IOUOFF)_":"
"KRN",.404,582,40,5,1)
.05
"KRN",.404,582,40,5,2)
4,65^4^4,48^1
"KRN",.404,582,40,5,4)
0
"KRN",.404,582,40,6,0)
1^!M^1
"KRN",.404,582,40,6,.1)
S Y=" ***************** Consult Closure Tool Configuration Editor *****************"
"KRN",.404,582,40,6,2)
^^1,1
"KRN",.404,582,40,7,0)
12^!M^1
"KRN",.404,582,40,7,.1)
S Y=$G(IOUON)_"Clinics"_$G(IOUOFF)_":"
"KRN",.404,582,40,7,2)
^^14,2
"KRN",.404,582,40,8,0)
16^!M^1
"KRN",.404,582,40,8,.1)
S Y=$G(IOUON)_"Note Titles"_$G(IOUOFF)_":"
"KRN",.404,582,40,8,2)
^^14,42
"KRN",.404,582,40,9,0)
8^!M^1
"KRN",.404,582,40,9,.1)
S Y=$G(IOUON)_"Consults - Service"_$G(IOUOFF)_":"
"KRN",.404,582,40,9,2)
^^6,2
"KRN",.404,582,40,10,0)
9^!M^1
"KRN",.404,582,40,10,.1)
S Y=$G(IOUON)_"Consults - Procedure"_$G(IOUOFF)_":"
"KRN",.404,582,40,10,2)
^^6,42
"KRN",.404,582,40,11,0)
10^!M^1
"KRN",.404,582,40,11,.1)
S Y=$G(IOUON)_"Consults - Order Item"_$G(IOUOFF)_":"
"KRN",.404,582,40,11,2)
^^10,2
"KRN",.404,582,40,12,0)
11^!M^1
"KRN",.404,582,40,12,.1)
S Y=$G(IOUON)_"Consults - Clinical Procedure"_$G(IOUOFF)_":"
"KRN",.404,582,40,12,2)
^^10,42
"KRN",.404,582,40,13,0)
2^!M^1
"KRN",.404,582,40,13,.1)
S Y=$TR($J("",IOM-1)," ","-")
"KRN",.404,582,40,13,2)
^^2,1
"KRN",.404,583,0)
GMRC CONS SERV^123.0331
"KRN",.404,583,40,0)
^.4044I^1^1
"KRN",.404,583,40,1,0)
1^^3
"KRN",.404,583,40,1,1)
.01
"KRN",.404,583,40,1,2)
1,2^38
"KRN",.404,583,40,1,4)
^^^^1^0
"KRN",.404,584,0)
GMRC CONS PROC^123.0332
"KRN",.404,584,40,0)
^.4044I^1^1
"KRN",.404,584,40,1,0)
1^^3
"KRN",.404,584,40,1,1)
.01
"KRN",.404,584,40,1,2)
1,3^38
"KRN",.404,584,40,1,4)
^^^^1^0
"KRN",.404,585,0)
GMRC CLIN^123.0335
"KRN",.404,585,40,0)
^.4044I^1^1
"KRN",.404,585,40,1,0)
1^^3
"KRN",.404,585,40,1,1)
.01
"KRN",.404,585,40,1,2)
1,2^38
"KRN",.404,586,0)
GMRC NOTE^123.0336
"KRN",.404,586,40,0)
^.4044I^1^1
"KRN",.404,586,40,1,0)
1^^3
"KRN",.404,586,40,1,1)
.01
"KRN",.404,586,40,1,2)
1,3^38
"KRN",.404,587,0)
GMRC CONS PROT^123.0333
"KRN",.404,587,40,0)
^.4044I^1^1
"KRN",.404,587,40,1,0)
1^^3
"KRN",.404,587,40,1,1)
.01
"KRN",.404,587,40,1,2)
1,2^38
"KRN",.404,588,0)
GMRC CONS CLPR^123.0334
"KRN",.404,588,40,0)
^.4044I^1^1
"KRN",.404,588,40,1,0)
1^^3
"KRN",.404,588,40,1,1)
.01
"KRN",.404,588,40,1,2)
1,3^38
"KRN",.404,589,0)
GMRC STOP^123.033
"KRN",.404,589,40,0)
^.4044I^3^3
"KRN",.404,589,40,1,0)
1^- and/or -^1
"KRN",.404,589,40,1,2)
^^1,1
"KRN",.404,589,40,2,0)
2^!M^1
"KRN",.404,589,40,2,.1)
S Y=$G(IOUON)_"Stop Code"_$G(IOUOFF)_":"
"KRN",.404,589,40,2,2)
^^1,13
"KRN",.404,589,40,3,0)
3^^3
"KRN",.404,589,40,3,1)
.06
"KRN",.404,589,40,3,2)
1,24^3
"KRN",19,2913582,-1)
2^2
"KRN",19,2913582,0)
GMRC MGR^Consult Management^^M^568^^^^^^^406
"KRN",19,2913582,10,0)
^19.01IP^23^18
"KRN",19,2913582,10,23,0)
2921938^CCT
"KRN",19,2913582,10,23,"^")
GMRC CONSULT CLOSURE TOOL
"KRN",19,2913582,"U")
CONSULT MANAGEMENT
"KRN",19,2921902,-1)
0^3
"KRN",19,2921902,0)
GMRC CONSULT CLOSE TOOL EDT^Consult Closure Tool Edit Configuration^^C^^^^^^^^CONSULT/REQUEST TRACKING^^1^1
"KRN",19,2921902,1,0)
^19.06^3^3^3171122^^^^
"KRN",19,2921902,1,1,0)
This option is used by the Consult Closure Tool to create and manage
"KRN",19,2921902,1,2,0)
configuration file entries that associate consults, clinics, and note
"KRN",19,2921902,1,3,0)
titles.
"KRN",19,2921902,15)
K DLAYGO,DIDEL
"KRN",19,2921902,20)
S (DLAYGO,DIDEL)=123.033
"KRN",19,2921902,30)
GMR(123.033,
"KRN",19,2921902,31)
AELMNQZ
"KRN",19,2921902,32)
Select CONSULT CONFIGURATION: 
"KRN",19,2921902,33)

"KRN",19,2921902,40)
[GMRC MAIN]
"KRN",19,2921902,41)
GMR(123.033,
"KRN",19,2921902,43)
1
"KRN",19,2921902,99.1)
63252,31452
"KRN",19,2921902,662000)
^^^^^^1
"KRN",19,2921902,"U")
CONSULT CLOSURE TOOL EDIT CONF
"KRN",19,2921903,-1)
0^4
"KRN",19,2921903,0)
GMRC CONSULT CLOSE TOOL INQ^Consult Closure Tool Inquire Configuration^^I^^^^^^^^CONSULT/REQUEST TRACKING^
"KRN",19,2921903,1,0)
^19.06^2^2^3170209^^^^
"KRN",19,2921903,1,1,0)
This option is used by the Consult Closure Tool to examine configuration
"KRN",19,2921903,1,2,0)
file entries that associate consults, clinics, and note titles.
"KRN",19,2921903,30)
GMR(123.033,
"KRN",19,2921903,31)
AEMNQZ
"KRN",19,2921903,32)
Select CONSULT CONFIGURATION: 
"KRN",19,2921903,63)
[GMRC CONSULT MAPPING INQIRE]
"KRN",19,2921903,67)
Consult Closure Tool Configuration
"KRN",19,2921903,70)

"KRN",19,2921903,80)
GMR(123.033,
"KRN",19,2921903,83)
N
"KRN",19,2921903,99.1)
63259,36251
"KRN",19,2921903,"U")
CONSULT CLOSURE TOOL INQUIRE C
"KRN",19,2921904,-1)
0^5
"KRN",19,2921904,0)
GMRC CONSULT CLOSE TOOL RUN^Consult Closure Tool Run Configuration^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,2921904,1,0)
^19.06^2^2^3170209^^^^
"KRN",19,2921904,1,1,0)
This option is used by the Consult Closure Tool to print the tracking
"KRN",19,2921904,1,2,0)
report, build team lists, and to close consults.
"KRN",19,2921904,25)
EN^GMRCCA
"KRN",19,2921904,99.1)
63271,29147
"KRN",19,2921904,"U")
CONSULT CLOSURE TOOL RUN CONFI
"KRN",19,2921938,-1)
0^1
"KRN",19,2921938,0)
GMRC CONSULT CLOSURE TOOL^Menu for Closure Tools^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,2921938,1,0)
^19.06^1^1^3170209^^
"KRN",19,2921938,1,1,0)
The menu is used to call three consult closure tool options.
"KRN",19,2921938,10,0)
^19.01IP^3^3
"KRN",19,2921938,10,1,0)
2921902^EDT
"KRN",19,2921938,10,1,"^")
GMRC CONSULT CLOSE TOOL EDT
"KRN",19,2921938,10,2,0)
2921903^INQ
"KRN",19,2921938,10,2,"^")
GMRC CONSULT CLOSE TOOL INQ
"KRN",19,2921938,10,3,0)
2921904^RUN
"KRN",19,2921938,10,3,"^")
GMRC CONSULT CLOSE TOOL RUN
"KRN",19,2921938,99)
64323,53695
"KRN",19,2921938,"U")
MENU FOR CLOSURE TOOLS
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",406,-1)
1^1
"PKG",406,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",406,20,0)
^9.402P^^
"PKG",406,22,0)
^9.49I^1^1
"PKG",406,22,1,0)
3.0^2980101^2981113^1
"PKG",406,22,1,"PAH",1,0)
89^3171127
"PKG",406,22,1,"PAH",1,1,0)
^^4^4^3171127
"PKG",406,22,1,"PAH",1,1,1,0)
The Consult Closure Tool allows users to track consults, associated 
"PKG",406,22,1,"PAH",1,1,2,0)
follow-up appointments, and associated progress notes.  Consults may be 
"PKG",406,22,1,"PAH",1,1,3,0)
closed interactively.  A consult/note report may be printed.  A CPRS team 
"PKG",406,22,1,"PAH",1,1,4,0)
may be updated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","GMRCCA")
0^1^B44932985^n/a
"RTN","GMRCCA",1,0)
GMRCCA ;SFVAMC/DAD - Consult Closure Tool: Report Prompting ;01/20/17 15:19
"RTN","GMRCCA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCA",3,0)
 ;Consult Closure Tool
"RTN","GMRCCA",4,0)
 ; IA#    Usage      Component
"RTN","GMRCCA",5,0)
 ; ---------------------------
"RTN","GMRCCA",6,0)
 ;  4836  Private    ^DIC(40.7
"RTN","GMRCCA",7,0)
 ;   510  Controlled ^DISV(
"RTN","GMRCCA",8,0)
 ;  1519  Supported  EN^XUTMDEVQ
"RTN","GMRCCA",9,0)
 ;  2056  Supported  $$GET1^DIQ
"RTN","GMRCCA",10,0)
 ;  2608  Supported  $$TEST^DDBRT
"RTN","GMRCCA",11,0)
 ; 10024  Supported  WAIT^DICD
"RTN","GMRCCA",12,0)
 ; 10026  Supported  ^DIR
"RTN","GMRCCA",13,0)
 ; 10063  Supported  ^%ZTLOAD
"RTN","GMRCCA",14,0)
 ; 10103  Supported  $$DT^XLFDT
"RTN","GMRCCA",15,0)
 ; 10104  Supported  $$TRIM^XLFSTR
"RTN","GMRCCA",16,0)
 ; 10150  Supported  HLP^DDSUTL
"RTN","GMRCCA",17,0)
 ; 
"RTN","GMRCCA",18,0)
EN ;
"RTN","GMRCCA",19,0)
 ; *** Interactive entry point
"RTN","GMRCCA",20,0)
 N GM0CFG,GMAPPT,GMDLIM,GMHEAD,GMAUTO,GMNOTE,GMOKAY
"RTN","GMRCCA",21,0)
 N GMOPUT,GMTBEG,GMTEAM,GMTEXT,GMTEND,GMXLAT
"RTN","GMRCCA",22,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCCA",23,0)
 N X,Y,ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTKIL
"RTN","GMRCCA",24,0)
 N ZTPRI,ZTRTN,ZTSAVE,ZTSK,ZTSYNC,ZTUCI
"RTN","GMRCCA",25,0)
 S GMAUTO=0 ; 0-disable/1-enable consult auto update (***DO NOT ENABLE***)
"RTN","GMRCCA",26,0)
 ;
"RTN","GMRCCA",27,0)
 ;
"RTN","GMRCCA",28,0)
 K DIR
"RTN","GMRCCA",29,0)
 S DIR(0)="POAr^123.033:AEMNQZ"
"RTN","GMRCCA",30,0)
 S DIR("A")="Select CONSULT CONFIGURATION: "
"RTN","GMRCCA",31,0)
 S GM0CFG=$G(^DISV(DUZ,$$GLOBROOT^GMRCCD(123.033)))
"RTN","GMRCCA",32,0)
 I $$CHKCFG(+GM0CFG,1)>0 D
"RTN","GMRCCA",33,0)
 . S DIR("B")=$$GET1^DIQ(123.033,+GM0CFG,.01)
"RTN","GMRCCA",34,0)
 . Q
"RTN","GMRCCA",35,0)
 S DIR("S")="I $$CHKCFG^GMRCCA(+Y,1)>0"
"RTN","GMRCCA",36,0)
 W ! D ^DIR S GM0CFG=+$G(Y)
"RTN","GMRCCA",37,0)
 I $$DIREXIT>0 G EXIT
"RTN","GMRCCA",38,0)
 ;
"RTN","GMRCCA",39,0)
 S GMHEAD="Select a consult date range"
"RTN","GMRCCA",40,0)
 D LASTMNTH^GMRCCY($$DT^XLFDT,.GMTBEG,.GMTEND)
"RTN","GMRCCA",41,0)
 W ! I $$EN^GMRCCY(.GMTBEG,.GMTEND,GMHEAD,"U")'>0 G EXIT
"RTN","GMRCCA",42,0)
 ;
"RTN","GMRCCA",43,0)
 K DIR
"RTN","GMRCCA",44,0)
 S DIR(0)="SOA^1:Seen in clinic;0:Not seen in clinic;"
"RTN","GMRCCA",45,0)
 S DIR("A",1)="Select an appointment status for the report"
"RTN","GMRCCA",46,0)
 S DIR("A",2)=" "
"RTN","GMRCCA",47,0)
 S DIR("A",3)="  1 - Seen in clinic"
"RTN","GMRCCA",48,0)
 S DIR("A",4)="  0 - Not seen in clinic"
"RTN","GMRCCA",49,0)
 S DIR("A",5)=" "
"RTN","GMRCCA",50,0)
 S DIR("A")="Select APPOINTMENT STATUS: "
"RTN","GMRCCA",51,0)
 S DIR("B")=1
"RTN","GMRCCA",52,0)
 W ! D ^DIR S GMAPPT=+$G(Y)
"RTN","GMRCCA",53,0)
 I $$DIREXIT>0 G EXIT
"RTN","GMRCCA",54,0)
 ;
"RTN","GMRCCA",55,0)
 K DIR
"RTN","GMRCCA",56,0)
 S DIR(0)="SOA^1:Has a note;0:Does not have a note;"
"RTN","GMRCCA",57,0)
 S DIR("A",1)="Select a note status for the report"
"RTN","GMRCCA",58,0)
 S DIR("A",2)=" "
"RTN","GMRCCA",59,0)
 S DIR("A",3)="  1 - Has a note"
"RTN","GMRCCA",60,0)
 S DIR("A",4)="  0 - Does not have a note"
"RTN","GMRCCA",61,0)
 S DIR("A",5)=" "
"RTN","GMRCCA",62,0)
 S DIR("A")="Select NOTE STATUS: "
"RTN","GMRCCA",63,0)
 S DIR("B")=1
"RTN","GMRCCA",64,0)
 W ! D ^DIR S GMNOTE=+$G(Y)
"RTN","GMRCCA",65,0)
 I $$DIREXIT>0 G EXIT
"RTN","GMRCCA",66,0)
 ;
"RTN","GMRCCA",67,0)
 S GMOPUT=0,GMXLAT=""
"RTN","GMRCCA",68,0)
 I GMNOTE>0 D  G:$$DIREXIT>0 EXIT
"RTN","GMRCCA",69,0)
 . K DIR
"RTN","GMRCCA",70,0)
 . S DIR(0)="YAO"
"RTN","GMRCCA",71,0)
 . S DIR("A")="Interactive consult update: "
"RTN","GMRCCA",72,0)
 . S DIR("B")="Yes"
"RTN","GMRCCA",73,0)
 . W ! D ^DIR S GMOPUT=+$G(Y)
"RTN","GMRCCA",74,0)
 . S GMXLAT="1^I"
"RTN","GMRCCA",75,0)
 . I GMOPUT>0 I $$TEST^DDBRT'>0 D
"RTN","GMRCCA",76,0)
 .. K GMTEXT
"RTN","GMRCCA",77,0)
 .. S GMTEXT(1)="*** The VA FileMan browser is not supported by your terminal type  ***"
"RTN","GMRCCA",78,0)
 .. S GMTEXT(2)="*** You cannot use the interactive consult update on this terminal ***"
"RTN","GMRCCA",79,0)
 .. S GMTEXT="*** You may print the consult report and/or update the CPRS team   ***"
"RTN","GMRCCA",80,0)
 .. D HANGMSG^GMRCCD(.GMTEXT,3,1)
"RTN","GMRCCA",81,0)
 .. S GMOPUT=0,GMXLAT=""
"RTN","GMRCCA",82,0)
 .. Q
"RTN","GMRCCA",83,0)
 . Q
"RTN","GMRCCA",84,0)
 ;
"RTN","GMRCCA",85,0)
 I GMOPUT'>0 D  G:$$DIREXIT>0 EXIT
"RTN","GMRCCA",86,0)
 . S GMTEAM=$$ISTM^GMRCCD(GM0CFG)
"RTN","GMRCCA",87,0)
 . K DIR
"RTN","GMRCCA",88,0)
 . S DIR(0)="LOA^1:1:0"
"RTN","GMRCCA",89,0)
 . S DIR("A")="Select OUTPUT TYPE: "
"RTN","GMRCCA",90,0)
 . S DIR("A",1)="Select the output type for the report"
"RTN","GMRCCA",91,0)
 . S DIR("A",2)=" "
"RTN","GMRCCA",92,0)
 . S DIR("A",3)="  1 - Print report"
"RTN","GMRCCA",93,0)
 . S DIR("B")="1"
"RTN","GMRCCA",94,0)
 . S GMXLAT="1^P"
"RTN","GMRCCA",95,0)
 . I GMTEAM>0 D
"RTN","GMRCCA",96,0)
 .. S DIR(0)="LOA^1:2:0"
"RTN","GMRCCA",97,0)
 .. S DIR("A",4)="  2 - Team update"
"RTN","GMRCCA",98,0)
 .. S DIR("B")="1,2"
"RTN","GMRCCA",99,0)
 .. S GMXLAT="12^PT"
"RTN","GMRCCA",100,0)
 .. Q
"RTN","GMRCCA",101,0)
 . I (GMAUTO>0)&(GMNOTE>0) D
"RTN","GMRCCA",102,0)
 .. S DIR(0)="LOA^1:2:0"
"RTN","GMRCCA",103,0)
 .. S DIR("A",4)="  2 - Consult update"
"RTN","GMRCCA",104,0)
 .. S DIR("B")="1,2"
"RTN","GMRCCA",105,0)
 .. S GMXLAT="12^PC"
"RTN","GMRCCA",106,0)
 .. Q
"RTN","GMRCCA",107,0)
 . I (GMAUTO>0)&(GMTEAM>0)&(GMNOTE>0) D
"RTN","GMRCCA",108,0)
 .. S DIR(0)="LOA^1:3:0"
"RTN","GMRCCA",109,0)
 .. S DIR("A",4)="  2 - Team update"
"RTN","GMRCCA",110,0)
 .. S DIR("A",5)="  3 - Consult update"
"RTN","GMRCCA",111,0)
 .. S DIR("B")="1-3"
"RTN","GMRCCA",112,0)
 .. S GMXLAT="123^PTC"
"RTN","GMRCCA",113,0)
 .. Q
"RTN","GMRCCA",114,0)
 . S DIR("A",1+$O(DIR("A",1E25),-1))=" "
"RTN","GMRCCA",115,0)
 . W ! D ^DIR S GMOPUT=$G(Y)
"RTN","GMRCCA",116,0)
 . Q
"RTN","GMRCCA",117,0)
 S GMOPUT=$$TRIM^XLFSTR(GMOPUT,"LR",",")
"RTN","GMRCCA",118,0)
 S GMOPUT=$TR(GMOPUT,$P(GMXLAT,U,1),$P(GMXLAT,U,2))
"RTN","GMRCCA",119,0)
 ;
"RTN","GMRCCA",120,0)
 I GMOPUT["P" D  G:$$DIREXIT>0 EXIT
"RTN","GMRCCA",121,0)
 . K DIR
"RTN","GMRCCA",122,0)
 . S DIR(0)="YOA"
"RTN","GMRCCA",123,0)
 . S DIR("A")="Delimited output: "
"RTN","GMRCCA",124,0)
 . S DIR("B")="No"
"RTN","GMRCCA",125,0)
 . W ! D ^DIR S GMDLIM=+$G(Y)
"RTN","GMRCCA",126,0)
 . Q
"RTN","GMRCCA",127,0)
 E  D
"RTN","GMRCCA",128,0)
 . S GMDLIM=0
"RTN","GMRCCA",129,0)
 . Q
"RTN","GMRCCA",130,0)
 ;
"RTN","GMRCCA",131,0)
 W !
"RTN","GMRCCA",132,0)
 S ZTRTN="TASK^GMRCCA("_GMTBEG_","_GMTEND_","
"RTN","GMRCCA",133,0)
 S ZTRTN=ZTRTN_GM0CFG_","_GMAPPT_","_GMNOTE_","""
"RTN","GMRCCA",134,0)
 S ZTRTN=ZTRTN_GMOPUT_""","_GMDLIM_")"
"RTN","GMRCCA",135,0)
 S ZTDESC="Consult Closure Tool"
"RTN","GMRCCA",136,0)
 I GMOPUT["P" D
"RTN","GMRCCA",137,0)
 . W !,"This report requires a 132 column output device"
"RTN","GMRCCA",138,0)
 . D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE,"MQ",1)
"RTN","GMRCCA",139,0)
 . Q
"RTN","GMRCCA",140,0)
 E  D
"RTN","GMRCCA",141,0)
 . I GMOPUT["I" D
"RTN","GMRCCA",142,0)
 .. W !,"Searching for patient consults / appointments / notes",!
"RTN","GMRCCA",143,0)
 .. D WAIT^DICD
"RTN","GMRCCA",144,0)
 .. D @ZTRTN
"RTN","GMRCCA",145,0)
 .. Q
"RTN","GMRCCA",146,0)
 . E  D
"RTN","GMRCCA",147,0)
 .. S ZTIO=""
"RTN","GMRCCA",148,0)
 .. D ^%ZTLOAD
"RTN","GMRCCA",149,0)
 .. Q
"RTN","GMRCCA",150,0)
 . Q
"RTN","GMRCCA",151,0)
 I $G(ZTSK)>0 W !,"Task #",ZTSK
"RTN","GMRCCA",152,0)
 ;
"RTN","GMRCCA",153,0)
EXIT ;
"RTN","GMRCCA",154,0)
 ; *** Common exit point
"RTN","GMRCCA",155,0)
 Q
"RTN","GMRCCA",156,0)
 ;
"RTN","GMRCCA",157,0)
TASK(GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMOPUT,GMDLIM) ;
"RTN","GMRCCA",158,0)
 ; *** TaskMan entry point
"RTN","GMRCCA",159,0)
 N GMROOT
"RTN","GMRCCA",160,0)
 S GMROOT=$NA(^TMP($T(+0),$J))
"RTN","GMRCCA",161,0)
 K @GMROOT
"RTN","GMRCCA",162,0)
 D GETDATA^GMRCCB(GMROOT,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMOPUT,GMDLIM)
"RTN","GMRCCA",163,0)
 I GMOPUT["C" D
"RTN","GMRCCA",164,0)
 . D CONSUPDT^GMRCCC(GMROOT)
"RTN","GMRCCA",165,0)
 . Q
"RTN","GMRCCA",166,0)
 I GMOPUT["T" D
"RTN","GMRCCA",167,0)
 . D MAKETEAM^GMRCCC(GMROOT,GM0CFG)
"RTN","GMRCCA",168,0)
 . Q
"RTN","GMRCCA",169,0)
 I GMOPUT["P" D
"RTN","GMRCCA",170,0)
 . D PRNTDATA^GMRCCC(GMROOT,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM)
"RTN","GMRCCA",171,0)
 . Q
"RTN","GMRCCA",172,0)
 I GMOPUT["I" D
"RTN","GMRCCA",173,0)
 . D INTERACT^GMRCCD(GMROOT)
"RTN","GMRCCA",174,0)
 . Q
"RTN","GMRCCA",175,0)
 K @GMROOT
"RTN","GMRCCA",176,0)
 Q
"RTN","GMRCCA",177,0)
 ;
"RTN","GMRCCA",178,0)
CHKCFG(GM0CFG,GMINAC) ;
"RTN","GMRCCA",179,0)
 ; *** Screen for valid consult configuration
"RTN","GMRCCA",180,0)
 ; GMDATA("XXX")=1 says XXX field is not populated
"RTN","GMRCCA",181,0)
 N GMDATA,GMOKAY
"RTN","GMRCCA",182,0)
 S GMOKAY=1
"RTN","GMRCCA",183,0)
 I (GMINAC>0)&($$GET1^DIQ(123.033,GM0CFG,.02,"I")>0) S GMOKAY=0
"RTN","GMRCCA",184,0)
 I $$GET1^DIQ(123.033,GM0CFG,.04)'>0 S GMOKAY=0
"RTN","GMRCCA",185,0)
 I $$GET1^DIQ(123.033,GM0CFG,.05)'>0 S GMOKAY=0
"RTN","GMRCCA",186,0)
 S GMDATA("STOP")=($$GET1^DIQ(123.033,GM0CFG,.06,"I")'>0)
"RTN","GMRCCA",187,0)
 F GMDATA="CLIN","CLPR","CONP","CONS","NOTE","PROT" D
"RTN","GMRCCA",188,0)
 . S GMDATA(GMDATA)=($O(^GMR(123.033,GM0CFG,GMDATA,0))'>0)
"RTN","GMRCCA",189,0)
 . Q
"RTN","GMRCCA",190,0)
 I (GMDATA("CLPR"))&(GMDATA("CONP"))&(GMDATA("CONS"))&(GMDATA("PROT")) S GMOKAY=0
"RTN","GMRCCA",191,0)
 I (GMDATA("CLIN"))&(GMDATA("STOP")) S GMOKAY=0
"RTN","GMRCCA",192,0)
 I GMDATA("NOTE") S GMOKAY=0
"RTN","GMRCCA",193,0)
 Q GMOKAY
"RTN","GMRCCA",194,0)
 ;
"RTN","GMRCCA",195,0)
DIREXIT() ;
"RTN","GMRCCA",196,0)
 ; *** DIR exit status
"RTN","GMRCCA",197,0)
 Q $D(DIROUT)!$D(DIRUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMRCCA",198,0)
 ;
"RTN","GMRCCA",199,0)
POSTSAVE(GM0CFG) ;
"RTN","GMRCCA",200,0)
 ; *** Post-save code for config editor
"RTN","GMRCCA",201,0)
 N GMTEXT
"RTN","GMRCCA",202,0)
 I $$CHKCFG(+GM0CFG,0)'>0 D
"RTN","GMRCCA",203,0)
 . S GMTEXT(1)="* * * The consult configuration is incomplete, required data is missing. * * *"
"RTN","GMRCCA",204,0)
 . S GMTEXT(2)="* * * You must enter a Config Name, Days Cons->Appt, Days Appt->Note,    * * *"
"RTN","GMRCCA",205,0)
 . S GMTEXT(3)="* * * at least one type of Consult (Service, Procedure, etc.), at least  * * *"
"RTN","GMRCCA",206,0)
 . S GMTEXT(4)="* * * one Clinic and/or a Stop Code, and at least one Note Title.        * * *"
"RTN","GMRCCA",207,0)
 . S GMTEXT(5)="$$EOP"
"RTN","GMRCCA",208,0)
 . D HLP^DDSUTL(.GMTEXT)
"RTN","GMRCCA",209,0)
 . Q
"RTN","GMRCCA",210,0)
 Q
"RTN","GMRCCB")
0^2^B82765732^n/a
"RTN","GMRCCB",1,0)
GMRCCB ;SFVAMC/DAD - Consult Closure Tool: Data Gathering ;01/20/17 15:19
"RTN","GMRCCB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCB",3,0)
 ;Consult Closure Tool
"RTN","GMRCCB",4,0)
 ;
"RTN","GMRCCB",5,0)
 ; IA#    Usage             Component
"RTN","GMRCCB",6,0)
 ; ---------------------------
"RTN","GMRCCB",7,0)
 ;  2699  Private           ^TIU(8925,D0,0  
"RTN","GMRCCB",8,0)
 ;  6742  Controlled Sub    ^TIU(8925,"ADCPT"
"RTN","GMRCCB",9,0)
 ;  2054  Supported         $$OREF^DILF
"RTN","GMRCCB",10,0)
 ;  2056  Supported         $$GET1^DIQ
"RTN","GMRCCB",11,0)
 ;  4433  Supported         $$SDAPI^SDAMA301
"RTN","GMRCCB",12,0)
 ;  4837  Private           ^GMR(123,"E"
"RTN","GMRCCB",13,0)
 ; 10103  Supported         $$FMADD^XLFDT
"RTN","GMRCCB",14,0)
 ; 10103  Supported         $$NOW^XLFDT
"RTN","GMRCCB",15,0)
 ; 10105  Supported         $$MIN^XLFMTH
"RTN","GMRCCB",16,0)
 ;
"RTN","GMRCCB",17,0)
GETDATA(GMROOT,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMOPUT,GMDLIM) ;
"RTN","GMRCCB",18,0)
 ; *** Get consults
"RTN","GMRCCB",19,0)
 N GM0CON,GM0DFN,GMCLPR,GMPROC,GMPROT,GMSERV,GMTCON
"RTN","GMRCCB",20,0)
 D CLINLIST^GMRCCD(GMROOT,GM0CFG)
"RTN","GMRCCB",21,0)
 S GMTCON=GMTBEG-.0000001
"RTN","GMRCCB",22,0)
 F  S GMTCON=$O(^GMR(123,"E",GMTCON)) Q:(GMTCON'>0)!(GMTCON>(GMTEND+.24))  D
"RTN","GMRCCB",23,0)
 . S GM0CON=0
"RTN","GMRCCB",24,0)
 . F  S GM0CON=$O(^GMR(123,"E",GMTCON,GM0CON)) Q:GM0CON'>0  D
"RTN","GMRCCB",25,0)
 .. I $$CONSCHEK(GM0CON,.GMSERV,.GMPROC,.GMPROT,.GMCLPR) D
"RTN","GMRCCB",26,0)
 ... S GM0DFN=$$GET1^DIQ(123,GM0CON,.02,"I")
"RTN","GMRCCB",27,0)
 ... I GM0DFN>0 D
"RTN","GMRCCB",28,0)
 .... D APPTCHEK(GMROOT,GM0CFG,GM0DFN,GM0CON,GMTCON,GMAPPT,GMNOTE,GMOPUT)
"RTN","GMRCCB",29,0)
 .... Q
"RTN","GMRCCB",30,0)
 ... Q
"RTN","GMRCCB",31,0)
 .. Q
"RTN","GMRCCB",32,0)
 . Q
"RTN","GMRCCB",33,0)
 Q
"RTN","GMRCCB",34,0)
 ;
"RTN","GMRCCB",35,0)
CONSCHEK(GM0CON,GMSERV,GMPROC,GMPROT,GMCLPR) ;
"RTN","GMRCCB",36,0)
 ; *** Consult active & part of config?
"RTN","GMRCCB",37,0)
 N GMFILE,GMGLOB
"RTN","GMRCCB",38,0)
 I $$CONSOKAY^GMRCCD(GM0CON)>0 D
"RTN","GMRCCB",39,0)
 . F GMFILE=101,123.3 D
"RTN","GMRCCB",40,0)
 .. S GMGLOB(GMFILE)=$$GLOBROOT^GMRCCD(GMFILE,";")
"RTN","GMRCCB",41,0)
 .. Q
"RTN","GMRCCB",42,0)
 . S GMSERV=$$GET1^DIQ(123,GM0CON,1,"I")
"RTN","GMRCCB",43,0)
 . S GMCLPR=$$GET1^DIQ(123,GM0CON,1.01,"I")
"RTN","GMRCCB",44,0)
 . S (GMPROC,GMPROT)=$$GET1^DIQ(123,GM0CON,4,"I")
"RTN","GMRCCB",45,0)
 . S GMPROC=$S(GMPROC[GMGLOB(123.3):GMPROC,1:"")
"RTN","GMRCCB",46,0)
 . S GMPROT=$S(GMPROT[GMGLOB(101):GMPROT,1:"")
"RTN","GMRCCB",47,0)
 . S GMCLPR(0)=''$D(^GMR(123.033,GM0CFG,"CLPR","B",+GMCLPR))
"RTN","GMRCCB",48,0)
 . S GMSERV(0)=''$D(^GMR(123.033,GM0CFG,"CONS","B",+GMSERV))
"RTN","GMRCCB",49,0)
 . S GMPROC(0)=''$D(^GMR(123.033,GM0CFG,"CONP","B",+GMPROC))
"RTN","GMRCCB",50,0)
 . S GMPROT(0)=''$D(^GMR(123.033,GM0CFG,"PROT","B",+GMPROT))
"RTN","GMRCCB",51,0)
 . S GMSERV=$S(GMSERV(0):$$GET1^DIQ(123,GM0CON,1),1:"")
"RTN","GMRCCB",52,0)
 . S GMCLPR=$S(GMCLPR(0):$$GET1^DIQ(123,GM0CON,1.01),1:"")
"RTN","GMRCCB",53,0)
 . S GMPROC=$S(GMPROC(0):$$GET1^DIQ(123,GM0CON,4),1:"")
"RTN","GMRCCB",54,0)
 . S GMPROT=$S(GMPROT(0):$$GET1^DIQ(123,GM0CON,4),1:"")
"RTN","GMRCCB",55,0)
 . Q
"RTN","GMRCCB",56,0)
 E  D
"RTN","GMRCCB",57,0)
 . S (GMSERV,GMPROC,GMPROT,GMCLPR)=""
"RTN","GMRCCB",58,0)
 . S (GMSERV(0),GMPROC(0),GMPROT(0),GMCLPR(0))=0
"RTN","GMRCCB",59,0)
 . Q
"RTN","GMRCCB",60,0)
 Q (GMSERV(0)!GMPROC(0)!GMPROT(0)!GMCLPR(0))
"RTN","GMRCCB",61,0)
 ;
"RTN","GMRCCB",62,0)
APPTCHEK(GMROOT,GM0CFG,GM0DFN,GM0CON,GMTCON,GMAPPT,GMNOTE,GMOPUT) ;
"RTN","GMRCCB",63,0)
 ; *** Check for appts
"RTN","GMRCCB",64,0)
 N GMTAPT
"RTN","GMRCCB",65,0)
 S GMTAPT=$$APPTLIST(GMROOT,GM0CFG,GM0DFN,GMTCON,GMAPPT)
"RTN","GMRCCB",66,0)
 ; Only seen Pts
"RTN","GMRCCB",67,0)
 I GMAPPT>0 D
"RTN","GMRCCB",68,0)
 . ; Pt has been seen
"RTN","GMRCCB",69,0)
 . I GMTAPT>0 D
"RTN","GMRCCB",70,0)
 .. D NOTECHEK(GMROOT,GM0CFG,GM0DFN,GM0CON,GMTCON,GMTAPT,GMNOTE,GMOPUT)
"RTN","GMRCCB",71,0)
 .. Q
"RTN","GMRCCB",72,0)
 . Q
"RTN","GMRCCB",73,0)
 ; Only unseen Pts
"RTN","GMRCCB",74,0)
 E  D
"RTN","GMRCCB",75,0)
 . ; Pt has NOT been seen
"RTN","GMRCCB",76,0)
 . I (GMTAPT'>0)!($$UNSEEN^GMRCCD($P(GMTAPT,U,4))>0) D
"RTN","GMRCCB",77,0)
 .. D NOTECHEK(GMROOT,GM0CFG,GM0DFN,GM0CON,GMTCON,GMTAPT,GMNOTE,GMOPUT)
"RTN","GMRCCB",78,0)
 .. Q
"RTN","GMRCCB",79,0)
 . Q
"RTN","GMRCCB",80,0)
 Q
"RTN","GMRCCB",81,0)
 ;
"RTN","GMRCCB",82,0)
NOTECHEK(GMROOT,GM0CFG,GM0DFN,GM0CON,GMTCON,GMTAPT,GMNOTE,GMOPUT) ;
"RTN","GMRCCB",83,0)
 ; *** Check for notes
"RTN","GMRCCB",84,0)
 N GMTNOT
"RTN","GMRCCB",85,0)
 K @GMROOT@("NOTE-LIST")
"RTN","GMRCCB",86,0)
 S GMTNOT=$$NOTELIST(GMROOT,GM0CFG,GM0DFN,+GMTAPT,+GMTCON,GMOPUT)
"RTN","GMRCCB",87,0)
 ; Only Pts with notes
"RTN","GMRCCB",88,0)
 I GMNOTE>0 D
"RTN","GMRCCB",89,0)
 . ; Pt has note
"RTN","GMRCCB",90,0)
 . I GMTNOT>0 D
"RTN","GMRCCB",91,0)
 .. D SETDATA(GMROOT,GM0DFN,GM0CON,GMTAPT,GMTNOT,GMOPUT)
"RTN","GMRCCB",92,0)
 .. Q
"RTN","GMRCCB",93,0)
 . Q
"RTN","GMRCCB",94,0)
 ; Only Pts without notes
"RTN","GMRCCB",95,0)
 E  D
"RTN","GMRCCB",96,0)
 . ; Pt does NOT have note
"RTN","GMRCCB",97,0)
 . I GMTNOT'>0 D
"RTN","GMRCCB",98,0)
 .. I $O(@GMROOT@("NOTE-LIST",0))'>0 S @GMROOT@("NOTE-LIST",1)="^^*NO NOTE*" ; GMRCC*2.1*1
"RTN","GMRCCB",99,0)
 .. D SETDATA(GMROOT,GM0DFN,GM0CON,GMTAPT,GMTNOT,GMOPUT)
"RTN","GMRCCB",100,0)
 .. Q
"RTN","GMRCCB",101,0)
 . Q
"RTN","GMRCCB",102,0)
 K @GMROOT@("NOTE-LIST")
"RTN","GMRCCB",103,0)
 Q
"RTN","GMRCCB",104,0)
 ;
"RTN","GMRCCB",105,0)
APPTLIST(GMROOT,GM0CFG,GM0DFN,GMTCON,GMAPPT) ;
"RTN","GMRCCB",106,0)
 ; *** Get Pt's appts
"RTN","GMRCCB",107,0)
 ; $$APPTLIST() = ApptDate ^ ClinIEN ^ ClinName ^ ApptStatInt ^ ApptStatExt
"RTN","GMRCCB",108,0)
 N GMCLIN,GMDATA,GMDATE,GMDAYS,GMFRST,GMLAST
"RTN","GMRCCB",109,0)
 N GMLIST,GMSDAM,GMSTAT,GMTAPT,GMVSIT
"RTN","GMRCCB",110,0)
 S GMDAYS=$$GET1^DIQ(123.033,GM0CFG,.04)
"RTN","GMRCCB",111,0)
 S GMLAST=$$FMADD^XLFDT(GMTCON,GMDAYS,0,0,0)
"RTN","GMRCCB",112,0)
 S GMLAST=$$MIN^XLFMTH(GMLAST,$$NOW^XLFDT)
"RTN","GMRCCB",113,0)
 S GMSDAM("FLDS")="1;2;3"
"RTN","GMRCCB",114,0)
 S GMSDAM("SORT")="P"
"RTN","GMRCCB",115,0)
 S GMSDAM(1)=GMTCON_";"_GMLAST
"RTN","GMRCCB",116,0)
 S GMSDAM(2)=$$OREF^DILF($NA(@GMROOT@("XREF-CLIN")))
"RTN","GMRCCB",117,0)
 S GMSDAM(4)=GM0DFN
"RTN","GMRCCB",118,0)
 S GMLIST=$NA(^TMP($J,"SDAMA301"))
"RTN","GMRCCB",119,0)
 K @GMLIST
"RTN","GMRCCB",120,0)
 S GMVSIT=""
"RTN","GMRCCB",121,0)
 I $$SDAPI^SDAMA301(.GMSDAM)'=-1 D
"RTN","GMRCCB",122,0)
 . S GMTAPT=0,GMFRST=""
"RTN","GMRCCB",123,0)
 . F  S GMTAPT=$O(@GMLIST@(GM0DFN,GMTAPT)) Q:(GMTAPT'>0)!(GMVSIT>0)  D
"RTN","GMRCCB",124,0)
 .. S GMDATA=$G(@GMLIST@(GM0DFN,GMTAPT))
"RTN","GMRCCB",125,0)
 .. S GMCLIN=$P($P(GMDATA,U,2),";",1)
"RTN","GMRCCB",126,0)
 .. S GMSTAT=$P($P(GMDATA,U,3),";",1)
"RTN","GMRCCB",127,0)
 .. I (GMTAPT>0)&(GMCLIN>0) D
"RTN","GMRCCB",128,0)
 ... ; Appt already used?
"RTN","GMRCCB",129,0)
 ... I '$D(@GMROOT@("XREF-APPT",GM0DFN,+GMCLIN,GMTAPT)) D
"RTN","GMRCCB",130,0)
 .... ; Save first cancelled/no-show appt
"RTN","GMRCCB",131,0)
 .... I (GMFRST="")&($$UNSEEN^GMRCCD(GMSTAT)>0) S GMFRST=GMDATA
"RTN","GMRCCB",132,0)
 .... ; Appt kept?
"RTN","GMRCCB",133,0)
 .... I $$SEEN^GMRCCD(GMSTAT)>0 D
"RTN","GMRCCB",134,0)
 ..... ; Mark appt used
"RTN","GMRCCB",135,0)
 ..... S @GMROOT@("XREF-APPT",GM0DFN,+GMCLIN,+GMTAPT)=""
"RTN","GMRCCB",136,0)
 ..... S GMVSIT=GMDATA
"RTN","GMRCCB",137,0)
 ..... Q
"RTN","GMRCCB",138,0)
 .... Q
"RTN","GMRCCB",139,0)
 ... Q
"RTN","GMRCCB",140,0)
 .. Q
"RTN","GMRCCB",141,0)
 . ; (No kept appt found) & (cancelled/no-show appt found)
"RTN","GMRCCB",142,0)
 . I (GMVSIT'>0)&(GMFRST]"")&(GMAPPT'>0) D
"RTN","GMRCCB",143,0)
 .. S GMTAPT=$P(GMFRST,U,1)
"RTN","GMRCCB",144,0)
 .. S GMCLIN=$P(GMFRST,U,2)
"RTN","GMRCCB",145,0)
 .. ; Mark appt used
"RTN","GMRCCB",146,0)
 .. S @GMROOT@("XREF-APPT",GM0DFN,+GMCLIN,+GMTAPT)=""
"RTN","GMRCCB",147,0)
 .. S GMVSIT=GMFRST
"RTN","GMRCCB",148,0)
 .. Q
"RTN","GMRCCB",149,0)
 . Q
"RTN","GMRCCB",150,0)
 K @GMLIST
"RTN","GMRCCB",151,0)
 S GMDATE=$P(GMVSIT,U,1)
"RTN","GMRCCB",152,0)
 S GMCLIN("I")=$P($P(GMVSIT,U,2),";",1)
"RTN","GMRCCB",153,0)
 S GMCLIN("E")=$P($P(GMVSIT,U,2),";",2)
"RTN","GMRCCB",154,0)
 S GMSTAT("I")=$P($P(GMVSIT,U,3),";",1)
"RTN","GMRCCB",155,0)
 S GMSTAT("E")=$P($P(GMVSIT,U,3),";",2)
"RTN","GMRCCB",156,0)
 S GMVSIT=GMDATE_U_GMCLIN("I")_U_GMCLIN("E")_U
"RTN","GMRCCB",157,0)
 S GMVSIT=GMVSIT_GMSTAT("I")_U_GMSTAT("E")
"RTN","GMRCCB",158,0)
 Q GMVSIT
"RTN","GMRCCB",159,0)
 ;
"RTN","GMRCCB",160,0)
NOTELIST(GMROOT,GM0CFG,GM0DFN,GMTAPT,GMTCON,GMOPUT) ;
"RTN","GMRCCB",161,0)
 ; *** Get Pt's notes
"RTN","GMRCCB",162,0)
 ; $$NOTELIST() = RefDate ^ TitleIEN ^ TitleName ^ NoteIEN
"RTN","GMRCCB",163,0)
 N GM0NOT,GMCLAS,GMDATA,GMDATE,GMDAYS,GMINDX
"RTN","GMRCCB",164,0)
 N GMTFIN,GMSTAT,GMTITL,GMTNOT,GM0TTL
"RTN","GMRCCB",165,0)
 S GMDATE=$S(GMTAPT>0:GMTAPT,1:GMTCON)
"RTN","GMRCCB",166,0)
 S GMDAYS=$$GET1^DIQ(123.033,GM0CFG,$S(GMTAPT>0:.05,1:.04))
"RTN","GMRCCB",167,0)
 S GMTFIN=9999999-$$FMADD^XLFDT(GMDATE\1,GMDAYS,0,0,0)
"RTN","GMRCCB",168,0)
 D NOTESTAT^GMRCCD(.GMSTAT)
"RTN","GMRCCB",169,0)
 S (GMCLAS,GMTITL)=0
"RTN","GMRCCB",170,0)
 F  S GMCLAS=$O(^TIU(8925,"ADCPT",GM0DFN,GMCLAS)) Q:$$NOTEQUIT(GMCLAS,GMTITL,GMOPUT)  D
"RTN","GMRCCB",171,0)
 . S GMSTAT=0
"RTN","GMRCCB",172,0)
 . F  S GMSTAT=$O(GMSTAT(GMSTAT)) Q:$$NOTEQUIT(GMSTAT,GMTITL,GMOPUT)  D
"RTN","GMRCCB",173,0)
 .. S GMTNOT=9999999-(GMDATE\1)
"RTN","GMRCCB",174,0)
 .. F  S GMTNOT=$O(^TIU(8925,"ADCPT",GM0DFN,GMCLAS,GMSTAT,GMTNOT),-1) Q:$$NOTEQUIT(GMTNOT,GMTITL,GMOPUT)!(GMTNOT<GMTFIN)  D
"RTN","GMRCCB",175,0)
 ... S GM0NOT=0
"RTN","GMRCCB",176,0)
 ... F  S GM0NOT=$O(^TIU(8925,"ADCPT",GM0DFN,GMCLAS,GMSTAT,GMTNOT,GM0NOT)) Q:$$NOTEQUIT(GM0NOT,GMTITL,GMOPUT)  D
"RTN","GMRCCB",177,0)
 .... ; Note part of config?
"RTN","GMRCCB",178,0)
 .... S GM0TTL=$$GET1^DIQ(8925,GM0NOT,.01,"I")
"RTN","GMRCCB",179,0)
 .... I $D(^GMR(123.033,GM0CFG,"NOTE","B",+GM0TTL)) D
"RTN","GMRCCB",180,0)
 ..... S GMDATA=$$GET1^DIQ(8925,GM0NOT,1301,"I")
"RTN","GMRCCB",181,0)
 ..... S GMDATA=GMDATA_U_$$GET1^DIQ(8925,GM0NOT,.01,"I")
"RTN","GMRCCB",182,0)
 ..... S GMDATA=GMDATA_U_$$GET1^DIQ(8925,GM0NOT,.01)
"RTN","GMRCCB",183,0)
 ..... S GMDATA=GMDATA_U_GM0NOT
"RTN","GMRCCB",184,0)
 ..... I ((GMOPUT["I")!(GMOPUT["P"))&(GMOPUT'["C") D
"RTN","GMRCCB",185,0)
 ...... S GMINDX=1+$O(@GMROOT@("NOTE-LIST",1E25),-1)
"RTN","GMRCCB",186,0)
 ...... S @GMROOT@("NOTE-LIST",GMINDX)=GMDATA
"RTN","GMRCCB",187,0)
 ...... Q
"RTN","GMRCCB",188,0)
 ..... ; Note already used?
"RTN","GMRCCB",189,0)
 ..... I '$D(@GMROOT@("XREF-NOTE",GM0DFN,GM0NOT)) D
"RTN","GMRCCB",190,0)
 ...... ; Mark note used
"RTN","GMRCCB",191,0)
 ...... S @GMROOT@("XREF-NOTE",GM0DFN,GM0NOT)=""
"RTN","GMRCCB",192,0)
 ...... S GMTITL=GMDATA
"RTN","GMRCCB",193,0)
 ...... Q
"RTN","GMRCCB",194,0)
 ..... Q
"RTN","GMRCCB",195,0)
 .... Q
"RTN","GMRCCB",196,0)
 ... Q
"RTN","GMRCCB",197,0)
 .. Q
"RTN","GMRCCB",198,0)
 . Q
"RTN","GMRCCB",199,0)
 Q GMTITL
"RTN","GMRCCB",200,0)
 ;
"RTN","GMRCCB",201,0)
NOTEQUIT(GMORDR,GMTITL,GMOPUT) ;
"RTN","GMRCCB",202,0)
 ; *** Stop note search?
"RTN","GMRCCB",203,0)
 Q $S(GMORDR'>0:1,GMOPUT["I":0,1:''GMTITL)
"RTN","GMRCCB",204,0)
 ;
"RTN","GMRCCB",205,0)
SETDATA(GMROOT,GM0DFN,GM0CON,GMADAT,GMNDAT,GMOPUT) ;
"RTN","GMRCCB",206,0)
 ; *** Save report data
"RTN","GMRCCB",207,0)
 N GMCLIN,GMCLPR,GMCNAM,GMDATA,GMINDX,GMNAME
"RTN","GMRCCB",208,0)
 N GMNOTE,GMPROC,GMPROT,GMSERV,GMSSN,GMSTAT
"RTN","GMRCCB",209,0)
 N GMTAPT,GMTCON,GMTNOT
"RTN","GMRCCB",210,0)
 S GMTCON=$$GET1^DIQ(123,GM0CON,3,"I")
"RTN","GMRCCB",211,0)
 S GMCNAM="*NO CONSULT*"
"RTN","GMRCCB",212,0)
 I $$CONSCHEK(GM0CON,.GMSERV,.GMPROC,.GMPROT,.GMCLPR) D
"RTN","GMRCCB",213,0)
 . I GMCLPR(0) S GMCNAM=GMCLPR
"RTN","GMRCCB",214,0)
 . I GMPROT(0) S GMCNAM=GMPROT
"RTN","GMRCCB",215,0)
 . I GMPROC(0) S GMCNAM=GMPROC
"RTN","GMRCCB",216,0)
 . I GMSERV(0) S GMCNAM=GMSERV
"RTN","GMRCCB",217,0)
 . Q
"RTN","GMRCCB",218,0)
 S GMCNAM=GMCNAM_U_(+GM0CON)
"RTN","GMRCCB",219,0)
 ;
"RTN","GMRCCB",220,0)
 S GMNAME=$$GET1^DIQ(2,GM0DFN,.01)
"RTN","GMRCCB",221,0)
 S GMNAME=$S(GMNAME]"":GMNAME,1:"*NO PATIENT*")
"RTN","GMRCCB",222,0)
 S GMNAME=GMNAME_U_(+GM0DFN)
"RTN","GMRCCB",223,0)
 S GMSSN=$$GET1^DIQ(2,GM0DFN,.09)
"RTN","GMRCCB",224,0)
 ;
"RTN","GMRCCB",225,0)
 S GMCLIN=$P(GMADAT,U,3)
"RTN","GMRCCB",226,0)
 S GMCLIN=$S(GMCLIN]"":GMCLIN,1:"*NO CLINIC*")
"RTN","GMRCCB",227,0)
 S GMCLIN=GMCLIN_U_(+$P(GMADAT,U,2))
"RTN","GMRCCB",228,0)
 S GMTAPT=$P(GMADAT,U,1)
"RTN","GMRCCB",229,0)
 S GMSTAT("I")=$P(GMADAT,U,4)
"RTN","GMRCCB",230,0)
 S GMSTAT("E")=$P(GMADAT,U,5)
"RTN","GMRCCB",231,0)
 ;
"RTN","GMRCCB",232,0)
 S GMNOTE=$P(GMNDAT,U,3)
"RTN","GMRCCB",233,0)
 S GMNOTE=$S(GMNOTE]"":GMNOTE,1:"*NO NOTE*")
"RTN","GMRCCB",234,0)
 S GMNOTE=GMNOTE_U_(+$P(GMNDAT,U,2))_U_(+$P(GMNDAT,U,4))
"RTN","GMRCCB",235,0)
 S GMTNOT=$P(GMNDAT,U,1)
"RTN","GMRCCB",236,0)
 ;
"RTN","GMRCCB",237,0)
 S GMDATA=GMSSN_U_GMTCON_U_GMTAPT_U
"RTN","GMRCCB",238,0)
 S GMDATA=GMDATA_GMSTAT("I")_U_GMSTAT("E")_U
"RTN","GMRCCB",239,0)
 S GMDATA=GMDATA_GMTNOT_U_GM0CON_U_(+$P(GMNDAT,U,4))_U
"RTN","GMRCCB",240,0)
 S GMDATA=GMDATA_"0"_U_""
"RTN","GMRCCB",241,0)
 ;
"RTN","GMRCCB",242,0)
 ; Data = SSN ^ ConsultDate ^ ApptDate ^ ApptStatusInt ^ ApptStatusExt ^
"RTN","GMRCCB",243,0)
 ;        NoteDate ^ ConsultIEN ^ NoteIEN ^ ConsultUpdated ^ ConsultUpdateMsg
"RTN","GMRCCB",244,0)
 ;
"RTN","GMRCCB",245,0)
 I ((GMOPUT["I")!(GMOPUT["P"))&(GMOPUT'["C") D
"RTN","GMRCCB",246,0)
 . S GMINDX=0
"RTN","GMRCCB",247,0)
 . F  S GMINDX=$O(@GMROOT@("NOTE-LIST",GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCB",248,0)
 .. S GMNOTE=$G(@GMROOT@("NOTE-LIST",GMINDX))
"RTN","GMRCCB",249,0)
 .. S $P(GMDATA,U,6)=$P(GMNOTE,U,1)
"RTN","GMRCCB",250,0)
 .. S $P(GMDATA,U,8)=$P(GMNOTE,U,4)
"RTN","GMRCCB",251,0)
 .. S GMNOTE=$P(GMNOTE,U,3)_U_$P(GMNOTE,U,2)_U_$P(GMNOTE,U,4)
"RTN","GMRCCB",252,0)
 .. I GMOPUT["I" D
"RTN","GMRCCB",253,0)
 ... ; Root("DATA", PtName ^ PtIEN, Consult ^ ConsultIEN,
"RTN","GMRCCB",254,0)
 ... ;      Title ^ TitleIEN ^ NoteIEN) = Data
"RTN","GMRCCB",255,0)
 ... S @GMROOT@("DATA",GMNAME,GMCNAM,GMNOTE)=GMDATA
"RTN","GMRCCB",256,0)
 ... Q
"RTN","GMRCCB",257,0)
 .. E  D
"RTN","GMRCCB",258,0)
 ... ; Root("DATA", Consult ^ ConsultIEN, Clin ^ ClinIEN,
"RTN","GMRCCB",259,0)
 ... ;      PtName ^ PtIEN, Title ^ TitleIEN ^ NoteIEN) = Data
"RTN","GMRCCB",260,0)
 ... S @GMROOT@("DATA",GMCNAM,GMCLIN,GMNAME,GMNOTE)=GMDATA
"RTN","GMRCCB",261,0)
 ... Q
"RTN","GMRCCB",262,0)
 .. Q
"RTN","GMRCCB",263,0)
 . Q
"RTN","GMRCCB",264,0)
 E  D
"RTN","GMRCCB",265,0)
 . ; Root("DATA", Consult ^ ConsultIEN, Clin ^ ClinIEN,
"RTN","GMRCCB",266,0)
 . ;      Title ^ TitleIEN ^ NoteIEN, PtName ^ PtIEN) = Data
"RTN","GMRCCB",267,0)
 . S @GMROOT@("DATA",GMCNAM,GMCLIN,GMNOTE,GMNAME)=GMDATA
"RTN","GMRCCB",268,0)
 . Q
"RTN","GMRCCB",269,0)
 S @GMROOT@("XREF-DFN",GM0DFN)=""
"RTN","GMRCCB",270,0)
 Q
"RTN","GMRCCC")
0^3^B65555262^n/a
"RTN","GMRCCC",1,0)
GMRCCC ;SFVAMC/DAD - Consult Closure Tool: Output Data ;01/20/17 15:19
"RTN","GMRCCC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCC",3,0)
 ;Consult Closure Tool
"RTN","GMRCCC",4,0)
 ;
"RTN","GMRCCC",5,0)
 ; IA#    Usage      Component
"RTN","GMRCCC",6,0)
 ; ---------------------------
"RTN","GMRCCC",7,0)
 ;  2699  Private    ^TIU(8925,D0,0
"RTN","GMRCCC",8,0)
 ;  3005  Controlled ^OR(100.21
"RTN","GMRCCC",9,0)
 ;  2051  Supported  $$FIND1^DIC
"RTN","GMRCCC",10,0)
 ;  2051  Supported  LIST^DIC
"RTN","GMRCCC",11,0)
 ;  2053  Supported  UPDATE^DIE
"RTN","GMRCCC",12,0)
 ;  2054  Supported  CLEAN^DILF
"RTN","GMRCCC",13,0)
 ;  2056  Supported  $$GET1^DIQ
"RTN","GMRCCC",14,0)
 ;  2980  Controlled $$SFILE^GMRCGUIB
"RTN","GMRCCC",15,0)
 ;  3473  Private    GET^GMRCTIU
"RTN","GMRCCC",16,0)
 ; 10026  Supported  ^DIR
"RTN","GMRCCC",17,0)
 ; 10081  Supported  SETUP^XQALERT
"RTN","GMRCCC",18,0)
 ; 10089  Supported  ^%ZISC
"RTN","GMRCCC",19,0)
 ; 10103  Supported  $$DT^XLFDT
"RTN","GMRCCC",20,0)
 ; 10103  Supported  $$FMTE^XLFDT
"RTN","GMRCCC",21,0)
 ; 10103  Supported  $$NOW^XLFDT
"RTN","GMRCCC",22,0)
 ;
"RTN","GMRCCC",23,0)
PRNTDATA(GMROOT,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM) ;
"RTN","GMRCCC",24,0)
 ; *** Print the data
"RTN","GMRCCC",25,0)
 N GMCLIN,GMCONS,GMEXIT,GMNAME,GMPAGE,GMTITL
"RTN","GMRCCC",26,0)
 U IO
"RTN","GMRCCC",27,0)
 S (GMEXIT,GMPAGE)=0
"RTN","GMRCCC",28,0)
 D HEADER(.GMPAGE,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM)
"RTN","GMRCCC",29,0)
 S GMCONS=""
"RTN","GMRCCC",30,0)
 I $O(@GMROOT@("DATA",GMCONS))="" D
"RTN","GMRCCC",31,0)
 . D WRITE("!!","*** No data found ***",21,GMDLIM)
"RTN","GMRCCC",32,0)
 . Q
"RTN","GMRCCC",33,0)
 F  S GMCONS=$O(@GMROOT@("DATA",GMCONS)) Q:GMCONS=""!GMEXIT  D
"RTN","GMRCCC",34,0)
 . S GMCLIN=""
"RTN","GMRCCC",35,0)
 . F  S GMCLIN=$O(@GMROOT@("DATA",GMCONS,GMCLIN)) Q:GMCLIN=""!GMEXIT  D
"RTN","GMRCCC",36,0)
 .. S GMNAME=""
"RTN","GMRCCC",37,0)
 .. F  S GMNAME=$O(@GMROOT@("DATA",GMCONS,GMCLIN,GMNAME)) Q:GMNAME=""!GMEXIT  D
"RTN","GMRCCC",38,0)
 ... S GMTITL=""
"RTN","GMRCCC",39,0)
 ... F  S GMTITL=$O(@GMROOT@("DATA",GMCONS,GMCLIN,GMNAME,GMTITL)) Q:GMTITL=""!GMEXIT  D
"RTN","GMRCCC",40,0)
 .... D PRINT(GMROOT,GMCONS,GMCLIN,GMTITL,GMNAME,GMDLIM)
"RTN","GMRCCC",41,0)
 .... D PAUSE(.GMEXIT,.GMPAGE,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM)
"RTN","GMRCCC",42,0)
 .... Q
"RTN","GMRCCC",43,0)
 ... Q
"RTN","GMRCCC",44,0)
 .. Q
"RTN","GMRCCC",45,0)
 . Q
"RTN","GMRCCC",46,0)
 D ^%ZISC
"RTN","GMRCCC",47,0)
 Q
"RTN","GMRCCC",48,0)
 ;
"RTN","GMRCCC",49,0)
PRINT(GMROOT,GMCONS,GMCLIN,GMTITL,GMNAME,GMDLIM) ;
"RTN","GMRCCC",50,0)
 ; *** Print one record
"RTN","GMRCCC",51,0)
 ; Array("DATA", Consult^IEN, Clinic^IEN, Note^IEN, Patient^IEN) = 
"RTN","GMRCCC",52,0)
 ;   SSN ^ ConsultDate ^ ApptDate ^ ApptStatusInt ^ ApptStatusExt ^ NoteDate
"RTN","GMRCCC",53,0)
 N GMDATA
"RTN","GMRCCC",54,0)
 S GMDATA=$G(@GMROOT@("DATA",GMCONS,GMCLIN,GMNAME,GMTITL))
"RTN","GMRCCC",55,0)
 D WRITE("!!",$P(GMNAME,U,1),30,GMDLIM) ; Pt Name
"RTN","GMRCCC",56,0)
 D WRITE("?34",$P(GMDATA,U,1),10,GMDLIM) ; SSN
"RTN","GMRCCC",57,0)
 D WRITE("?48",$P(GMCONS,U,1),63,GMDLIM) ; Consult Title
"RTN","GMRCCC",58,0)
 D WRITE("?115",$$DATE($P(GMDATA,U,2),"2MZ"),14,GMDLIM) ; Consult Date
"RTN","GMRCCC",59,0)
 D WRITE("!",$P(GMCLIN,U,1),30,GMDLIM) ; Appt Clinic
"RTN","GMRCCC",60,0)
 D WRITE("?34",$$DATE($P(GMDATA,U,3),"2MZ"),14,GMDLIM) ; Appt Date
"RTN","GMRCCC",61,0)
 D WRITE("?65",$P(GMDATA,U,5),33,GMDLIM) ; Appt Status
"RTN","GMRCCC",62,0)
 D WRITE("!",$P(GMTITL,U,1),60,GMDLIM) ; Note Title
"RTN","GMRCCC",63,0)
 D WRITE("?65",$$DATE($P(GMDATA,U,6),"2MZ"),14,GMDLIM) ; Note Date
"RTN","GMRCCC",64,0)
 D WRITE("?115",$$BOOL($P(GMDATA,U,9)),3,GMDLIM) ; Consult Updated
"RTN","GMRCCC",65,0)
 W:GMDLIM>0 !
"RTN","GMRCCC",66,0)
 Q
"RTN","GMRCCC",67,0)
 ;
"RTN","GMRCCC",68,0)
DATE(GMDATE,GMFORM) ;
"RTN","GMRCCC",69,0)
 ; *** Format dates
"RTN","GMRCCC",70,0)
 Q $S(GMDATE>0:$$FMTE^XLFDT(GMDATE,GMFORM),1:"")
"RTN","GMRCCC",71,0)
 ;
"RTN","GMRCCC",72,0)
BOOL(GMBOOL) ;
"RTN","GMRCCC",73,0)
 ; *** Format boolean
"RTN","GMRCCC",74,0)
 Q $S(''GMBOOL:"Yes",1:"No")
"RTN","GMRCCC",75,0)
 ;
"RTN","GMRCCC",76,0)
PAUSE(GMEXIT,GMPAGE,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM) ;
"RTN","GMRCCC",77,0)
 ; *** Pause at end of page
"RTN","GMRCCC",78,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","GMRCCC",79,0)
 I (GMDLIM'>0)&($Y>(IOSL-5)) D
"RTN","GMRCCC",80,0)
 . I $E(IOST,1,2)="C-" K DIR S DIR(0)="E" D ^DIR S GMEXIT='$G(Y)
"RTN","GMRCCC",81,0)
 . I GMEXIT'>0 D HEADER(.GMPAGE,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM)
"RTN","GMRCCC",82,0)
 . Q
"RTN","GMRCCC",83,0)
 Q
"RTN","GMRCCC",84,0)
 ;
"RTN","GMRCCC",85,0)
HEADER(GMPAGE,GMTBEG,GMTEND,GM0CFG,GMAPPT,GMNOTE,GMDLIM) ;
"RTN","GMRCCC",86,0)
 ; *** Page header
"RTN","GMRCCC",87,0)
 S GMPAGE=GMPAGE+1
"RTN","GMRCCC",88,0)
 I (GMDLIM'>0)&(($E(IOST,1,2)="C-")!(GMPAGE>1)) W @IOF
"RTN","GMRCCC",89,0)
 D CENTER("Consult Closure Tool",GMDLIM)
"RTN","GMRCCC",90,0)
 I GMDLIM'>0 D WRITE("?115",$$DATE($$DT^XLFDT,"2DZ"),8,GMDLIM)
"RTN","GMRCCC",91,0)
 D CENTER("Consults from "_$$DATE(GMTBEG,"2DZ")_" to "_$$DATE(GMTEND,"2DZ"),GMDLIM)
"RTN","GMRCCC",92,0)
 I GMDLIM'>0 D WRITE("?115","Page: "_GMPAGE,9,GMDLIM)
"RTN","GMRCCC",93,0)
 D CENTER("Consult configuration: "_$$GET1^DIQ(123.033,GM0CFG,.01),GMDLIM)
"RTN","GMRCCC",94,0)
 D CENTER("Appointment status: "_$S(GMAPPT>0:"Seen",1:"Not seen")_" in clinic",GMDLIM)
"RTN","GMRCCC",95,0)
 D CENTER("Note status: "_$S(GMNOTE>0:"Has",1:"Does not have")_" a note",GMDLIM)
"RTN","GMRCCC",96,0)
 D WRITE("!!","Patient Name",12,GMDLIM)
"RTN","GMRCCC",97,0)
 D WRITE("?34","SSN",3,GMDLIM)
"RTN","GMRCCC",98,0)
 D WRITE("?48","Consult Title",13,GMDLIM)
"RTN","GMRCCC",99,0)
 D WRITE("?115","Consult Date",12,GMDLIM)
"RTN","GMRCCC",100,0)
 D WRITE("!","Appt Clinic",11,GMDLIM)
"RTN","GMRCCC",101,0)
 D WRITE("?34","Appt Date",9,GMDLIM)
"RTN","GMRCCC",102,0)
 D WRITE("?65","Appt Status",11,GMDLIM)
"RTN","GMRCCC",103,0)
 D WRITE("!","Note Title",10,GMDLIM)
"RTN","GMRCCC",104,0)
 D WRITE("?65","Note Date",9,GMDLIM)
"RTN","GMRCCC",105,0)
 D WRITE("?115","Consult Updated",15,GMDLIM)
"RTN","GMRCCC",106,0)
 I GMDLIM'>0 D WRITE("!",$TR($J("",IOM)," ","-"),IOM,GMDLIM)
"RTN","GMRCCC",107,0)
 W:GMDLIM>0 !
"RTN","GMRCCC",108,0)
 Q
"RTN","GMRCCC",109,0)
 ;
"RTN","GMRCCC",110,0)
WRITE(GMFMT,GMDATA,GMLEN,GMDLIM) ;
"RTN","GMRCCC",111,0)
 ; *** Output the data
"RTN","GMRCCC",112,0)
 W:(GMDLIM'>0)&(GMLEN>0) @GMFMT
"RTN","GMRCCC",113,0)
 W $S(GMDLIM'>0:$E(GMDATA,1,GMLEN),1:GMDATA)
"RTN","GMRCCC",114,0)
 W:GMDLIM>0 U
"RTN","GMRCCC",115,0)
 Q
"RTN","GMRCCC",116,0)
 ;
"RTN","GMRCCC",117,0)
CENTER(GMDATA,GMDLIM) ;
"RTN","GMRCCC",118,0)
 ; *** Center data
"RTN","GMRCCC",119,0)
 D WRITE("!?"_(IOM-$L(GMDATA)\2),GMDATA,$L(GMDATA),GMDLIM)
"RTN","GMRCCC",120,0)
 W:GMDLIM>0 !
"RTN","GMRCCC",121,0)
 Q
"RTN","GMRCCC",122,0)
 ;
"RTN","GMRCCC",123,0)
MAKETEAM(GMROOT,GM0CFG) ;
"RTN","GMRCCC",124,0)
 ; *** Update the CPRS team
"RTN","GMRCCC",125,0)
 N GM0DFN,GM0TM,GM1TM,GMDPT,GMIENS,GMINDX,GMLIST
"RTN","GMRCCC",126,0)
 ; Is there a team associated with the selected configuration?
"RTN","GMRCCC",127,0)
 I $$ISTM^GMRCCD(GM0CFG)>0 D
"RTN","GMRCCC",128,0)
 . S GM0TM=$$GET1^DIQ(123.033,GM0CFG,.03,"I")
"RTN","GMRCCC",129,0)
 . S GMLIST=$NA(^TMP("DILIST",$J))
"RTN","GMRCCC",130,0)
 . K @GMLIST,@GMROOT@("TEAM-FDA")
"RTN","GMRCCC",131,0)
 . S GMDPT=$$GLOBROOT^GMRCCD(2,";")
"RTN","GMRCCC",132,0)
 . ; Get current list of patients in team
"RTN","GMRCCC",133,0)
 . D LIST^DIC(100.2101,","_GM0TM_",")
"RTN","GMRCCC",134,0)
 . D CLEAN^DILF
"RTN","GMRCCC",135,0)
 . S GMINDX=0
"RTN","GMRCCC",136,0)
 . ; Make FDA array to delete current patients from team
"RTN","GMRCCC",137,0)
 . F  S GMINDX=$O(@GMLIST@(2,GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCC",138,0)
 .. S GM1TM=$G(@GMLIST@(2,GMINDX))
"RTN","GMRCCC",139,0)
 .. S GMIENS=GM1TM_","_GM0TM_","
"RTN","GMRCCC",140,0)
 .. I GM1TM>0 S @GMROOT@("TEAM-FDA",100.2101,GMIENS,.01)="@"
"RTN","GMRCCC",141,0)
 .. Q
"RTN","GMRCCC",142,0)
 . K @GMLIST
"RTN","GMRCCC",143,0)
 . ; Delete current patients from team
"RTN","GMRCCC",144,0)
 . I $D(@GMROOT@("TEAM-FDA")) D
"RTN","GMRCCC",145,0)
 .. D UPDATE^DIE("",$NA(@GMROOT@("TEAM-FDA")))
"RTN","GMRCCC",146,0)
 .. D CLEAN^DILF
"RTN","GMRCCC",147,0)
 .. Q
"RTN","GMRCCC",148,0)
 . K @GMROOT@("TEAM-FDA")
"RTN","GMRCCC",149,0)
 . S GM0DFN=0
"RTN","GMRCCC",150,0)
 . ; Make FDA array to add new patients to team
"RTN","GMRCCC",151,0)
 . F  S GM0DFN=$O(@GMROOT@("XREF-DFN",GM0DFN)) Q:GM0DFN'>0  D
"RTN","GMRCCC",152,0)
 .. S GMIENS="+"_GM0DFN_","_GM0TM_","
"RTN","GMRCCC",153,0)
 .. S @GMROOT@("TEAM-FDA",100.2101,GMIENS,.01)=GM0DFN_GMDPT
"RTN","GMRCCC",154,0)
 .. Q
"RTN","GMRCCC",155,0)
 . ; Add new patients to team
"RTN","GMRCCC",156,0)
 . I $D(@GMROOT@("TEAM-FDA")) D
"RTN","GMRCCC",157,0)
 .. D UPDATE^DIE("",$NA(@GMROOT@("TEAM-FDA")))
"RTN","GMRCCC",158,0)
 .. D CLEAN^DILF
"RTN","GMRCCC",159,0)
 .. Q
"RTN","GMRCCC",160,0)
 . K @GMROOT@("TEAM-FDA")
"RTN","GMRCCC",161,0)
 . D TEAMALRT(GM0CFG)
"RTN","GMRCCC",162,0)
 . Q
"RTN","GMRCCC",163,0)
 Q
"RTN","GMRCCC",164,0)
 ;
"RTN","GMRCCC",165,0)
TEAMALRT(GM0CFG) ;
"RTN","GMRCCC",166,0)
 ; *** Alert users when team is updated
"RTN","GMRCCC",167,0)
 N GM0DUZ,GM0TM,GMINDX,GMLIST,XQA,XQAARCH,XQADATA
"RTN","GMRCCC",168,0)
 N XQAFLG,XQAID,XQAMSG,XQAOPT,XQAROU,XQASUPV,XQASURO
"RTN","GMRCCC",169,0)
 S GM0TM=$$GET1^DIQ(123.033,GM0CFG,.03,"I")
"RTN","GMRCCC",170,0)
 S GMLIST=$NA(^TMP("DILIST",$J))
"RTN","GMRCCC",171,0)
 K @GMLIST
"RTN","GMRCCC",172,0)
 D LIST^DIC(100.212,","_GM0TM_",")
"RTN","GMRCCC",173,0)
 D CLEAN^DILF
"RTN","GMRCCC",174,0)
 S GMINDX=0
"RTN","GMRCCC",175,0)
 F  S GMINDX=$O(@GMLIST@(2,GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCC",176,0)
 . S GM0DUZ=$G(@GMLIST@(2,GMINDX))
"RTN","GMRCCC",177,0)
 . I GM0DUZ>0 S XQA(GM0DUZ)=""
"RTN","GMRCCC",178,0)
 . Q
"RTN","GMRCCC",179,0)
 K @GMLIST
"RTN","GMRCCC",180,0)
 S GM0DUZ=$$GET1^DIQ(100.21,GM0TM,1.6,"I")
"RTN","GMRCCC",181,0)
 I GM0DUZ>0 S XQA(GM0DUZ)=""
"RTN","GMRCCC",182,0)
 S XQA(DUZ)=""
"RTN","GMRCCC",183,0)
 S XQAMSG="Consult Closure Tool has updated '"
"RTN","GMRCCC",184,0)
 S XQAMSG=XQAMSG_$$GET1^DIQ(123.033,GM0CFG,.03)_"' team"
"RTN","GMRCCC",185,0)
 S XQAID=$T(+0)_";"_DUZ_";"_$$NOW^XLFDT
"RTN","GMRCCC",186,0)
 D SETUP^XQALERT
"RTN","GMRCCC",187,0)
 Q
"RTN","GMRCCC",188,0)
 ;
"RTN","GMRCCC",189,0)
CONSUPDT(GMROOT) ;
"RTN","GMRCCC",190,0)
 ; *** Update the consults non-interactively
"RTN","GMRCCC",191,0)
 N GM0CON,GM0NOT,GMCLIN,GMCONS,GMDATA
"RTN","GMRCCC",192,0)
 N GMMSG,GMNAME,GMTITL,GMUPDT
"RTN","GMRCCC",193,0)
 S GMCONS=""
"RTN","GMRCCC",194,0)
 F  S GMCONS=$O(@GMROOT@("DATA",GMCONS)) Q:GMCONS=""  D
"RTN","GMRCCC",195,0)
 . S GMCLIN=""
"RTN","GMRCCC",196,0)
 . F  S GMCLIN=$O(@GMROOT@("DATA",GMCONS,GMCLIN)) Q:GMCLIN=""  D
"RTN","GMRCCC",197,0)
 .. S GMTITL=""
"RTN","GMRCCC",198,0)
 .. F  S GMTITL=$O(@GMROOT@("DATA",GMCONS,GMCLIN,GMTITL)) Q:GMTITL=""  D
"RTN","GMRCCC",199,0)
 ... S GMNAME=""
"RTN","GMRCCC",200,0)
 ... F  S GMNAME=$O(@GMROOT@("DATA",GMCONS,GMCLIN,GMTITL,GMNAME)) Q:GMNAME=""  D
"RTN","GMRCCC",201,0)
 .... S GMDATA=$G(@GMROOT@("DATA",GMCONS,GMCLIN,GMTITL,GMNAME))
"RTN","GMRCCC",202,0)
 .... S GM0CON=$P(GMDATA,U,7)
"RTN","GMRCCC",203,0)
 .... S GM0NOT=$P(GMDATA,U,8)
"RTN","GMRCCC",204,0)
 .... I (GM0CON>0)&(GM0NOT>0) D
"RTN","GMRCCC",205,0)
 ..... S GMUPDT=$$CONUPDT(GM0CON,GM0NOT,.GMMSG)
"RTN","GMRCCC",206,0)
 ..... S $P(GMDATA,U,9,10)=GMUPDT_U_$G(GMMSG)
"RTN","GMRCCC",207,0)
 ..... S @GMROOT@("DATA",GMCONS,GMCLIN,GMTITL,GMNAME)=GMDATA
"RTN","GMRCCC",208,0)
 ..... Q
"RTN","GMRCCC",209,0)
 .... Q
"RTN","GMRCCC",210,0)
 ... Q
"RTN","GMRCCC",211,0)
 .. Q
"RTN","GMRCCC",212,0)
 . Q
"RTN","GMRCCC",213,0)
 Q
"RTN","GMRCCC",214,0)
 ;
"RTN","GMRCCC",215,0)
CONUPDT(GM0CON,GM0NOT,GMMSG) ;
"RTN","GMRCCC",216,0)
 ; *** Update a consult
"RTN","GMRCCC",217,0)
 N GMALRT,GMAUTH,GMDUZ,GMFIND,GMNOW
"RTN","GMRCCC",218,0)
 N GMOKAY,GMSTAT,GMTO,GMRCADUZ K GMMSG
"RTN","GMRCCC",219,0)
 ; Get note status, compute consult status
"RTN","GMRCCC",220,0)
 D NOTESTAT^GMRCCD(.GMSTAT)
"RTN","GMRCCC",221,0)
 S GMAUTH=$$GET1^DIQ(8925,GM0NOT,1202,"I")
"RTN","GMRCCC",222,0)
 S GMSTAT=$$GET1^DIQ(8925,GM0NOT,.05,"I")
"RTN","GMRCCC",223,0)
 I $D(GMSTAT(+GMSTAT))#2>0 S GMSTAT="COMPLETED"
"RTN","GMRCCC",224,0)
 E  S GMSTAT="INCOMPLETE"
"RTN","GMRCCC",225,0)
 ; Update a consult with a TIU note
"RTN","GMRCCC",226,0)
 D GET^GMRCTIU(GM0CON,GM0NOT,GMSTAT,GMAUTH)
"RTN","GMRCCC",227,0)
 ; Get recipients of consult notification
"RTN","GMRCCC",228,0)
 D EN^GMRCT($$GET1^DIQ(123,GM0CON,1,"I"))
"RTN","GMRCCC",229,0)
 S (GMTO,GMDUZ)=""
"RTN","GMRCCC",230,0)
 F  S GMDUZ=$O(GMRCADUZ(GMDUZ)) Q:GMDUZ'>0  D
"RTN","GMRCCC",231,0)
 . S GMTO=GMTO_GMDUZ_$S($O(GMRCADUZ(GMDUZ))>0:";",1:"")
"RTN","GMRCCC",232,0)
 . Q
"RTN","GMRCCC",233,0)
 S GMALRT=$S(GMSTAT="COMPLETED":0,1:1)
"RTN","GMRCCC",234,0)
 S GMFIND="U"
"RTN","GMRCCC",235,0)
 S GMNOW=$$NOW^XLFDT
"RTN","GMRCCC",236,0)
 S GMMSG(1)="Administrative closure performed"
"RTN","GMRCCC",237,0)
 S GMMSG(2)="by the Consult Closure Tool."
"RTN","GMRCCC",238,0)
 S GMSTAT=$$FIND1^DIC(123.1,"","X","COMPLETE/UPDATE","B")
"RTN","GMRCCC",239,0)
 ; Administrative completion of a consult
"RTN","GMRCCC",240,0)
 S GMOKAY=$$SFILE^GMRCGUIB(GM0CON,GMSTAT,GMFIND,GMAUTH,DUZ,.GMMSG,GMALRT,GMTO,GMNOW)
"RTN","GMRCCC",241,0)
 K GMMSG S GMMSG=$P(GMOKAY,U,2)
"RTN","GMRCCC",242,0)
 Q '$P(GMOKAY,U,1)
"RTN","GMRCCD")
0^4^B84857854^n/a
"RTN","GMRCCD",1,0)
GMRCCD ;SFVAMC/DAD - Consult Closure Tool: Interactive Consult Update ;01/20/17 15:19
"RTN","GMRCCD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCD",3,0)
 ;Consult Closure Tool
"RTN","GMRCCD",4,0)
 ;
"RTN","GMRCCD",5,0)
 ; IA#    Usage      Component
"RTN","GMRCCD",6,0)
 ; ---------------------------   
"RTN","GMRCCD",7,0)
 ;  4836  Private    $$GET1^DIQ(123.033,GM0CFG,.06,"I")
"RTN","GMRCCD",8,0)
 ;  3005  Controlled $$GET1^DIQ(123.033,GM0CFG,".03:1","I")
"RTN","GMRCCD",9,0)
 ; 10040  Supported  $$GET1^DIQ(123.033,GM0CFG,.06
"RTN","GMRCCD",10,0)
 ;  4072  Controlled $$FIND1^DIC(8925.6
"RTN","GMRCCD",11,0)
 ;  2051  Supported  $$FIND1^DIC
"RTN","GMRCCD",12,0)
 ;  2051  Supported  LIST^DIC
"RTN","GMRCCD",13,0)
 ;  2052  Supported  $$GET1^DID
"RTN","GMRCCD",14,0)
 ;  2054  Supported  CLEAN^DILF
"RTN","GMRCCD",15,0)
 ;  2056  Supported  $$GET1^DIQ
"RTN","GMRCCD",16,0)
 ;  2607  Supported  DOCLIST^DDBR
"RTN","GMRCCD",17,0)
 ;  2832  Controlled RPC^TIUSRV
"RTN","GMRCCD",18,0)
 ;  2925  Controlled DT^GMRCSLM2
"RTN","GMRCCD",19,0)
 ; 10026  Supported  ^DIR
"RTN","GMRCCD",20,0)
 ; 10086  Supported  HOME^%ZIS
"RTN","GMRCCD",21,0)
 ; 10096  Supported  ^%ZOSF(
"RTN","GMRCCD",22,0)
 ;
"RTN","GMRCCD",23,0)
INTERACT(GMROOT) ;
"RTN","GMRCCD",24,0)
 ; *** Interactive consult update
"RTN","GMRCCD",25,0)
 N GM0CON,GM0NOT,GMCCNT,GMCONS,GMCRPT,GMDOCS
"RTN","GMRCCD",26,0)
 N GMEXIT,GMINDX,GMNAME,GMNCNT,GMNOTE,GMNRPT
"RTN","GMRCCD",27,0)
 N GMNTXT,GMPCNT,GMTEXT,GMTITL,GMRCOER,GMRCQUT
"RTN","GMRCCD",28,0)
 D HOME^%ZIS
"RTN","GMRCCD",29,0)
 S GMDOCS=$NA(@GMROOT@("DOCS-LIST"))
"RTN","GMRCCD",30,0)
 S GMNRPT=$NA(@GMROOT@("NOTE-TEXT"))
"RTN","GMRCCD",31,0)
 S GMCRPT=$NA(^TMP("GMRCR",$J,"DT"))
"RTN","GMRCCD",32,0)
 S GMNOTE=$NA(^TMP("TIUAUDIT",$J))
"RTN","GMRCCD",33,0)
 D COUNT(GMROOT,.GMPCNT,.GMCCNT,.GMNCNT)
"RTN","GMRCCD",34,0)
 S GMPCNT(0)=GMPCNT
"RTN","GMRCCD",35,0)
 S GMCCNT(0)=GMCCNT
"RTN","GMRCCD",36,0)
 S GMNCNT(0)=GMNCNT
"RTN","GMRCCD",37,0)
 K GMTEXT
"RTN","GMRCCD",38,0)
 S GMTEXT(1)="The Consult Closure Tool has identified"
"RTN","GMRCCD",39,0)
 S GMTEXT(2)="  Patients: "_$J(GMPCNT,4)
"RTN","GMRCCD",40,0)
 S GMTEXT(3)="  Consults: "_$J(GMCCNT,4)
"RTN","GMRCCD",41,0)
 S GMTEXT(4)="  Notes:    "_$J(GMNCNT,4)
"RTN","GMRCCD",42,0)
 S GMTEXT(5)="that meet your selected criteria."
"RTN","GMRCCD",43,0)
 S GMTEXT(6)=""
"RTN","GMRCCD",44,0)
 S GMTEXT="Enter RETURN to continue: "
"RTN","GMRCCD",45,0)
 D HANGMSG(.GMTEXT,$G(DTIME,900),1)
"RTN","GMRCCD",46,0)
 S GMNAME="",(GMEXIT,GMPCNT,GMCCNT,GMNCNT)=0
"RTN","GMRCCD",47,0)
 I $O(@GMROOT@("DATA",GMNAME))="" D
"RTN","GMRCCD",48,0)
 . K GMTEXT S GMTEXT="*** No data found ***"
"RTN","GMRCCD",49,0)
 . D HANGMSG(.GMTEXT,0,1)
"RTN","GMRCCD",50,0)
 . Q
"RTN","GMRCCD",51,0)
 F  S GMNAME=$O(@GMROOT@("DATA",GMNAME)) Q:(GMNAME="")!(GMEXIT>0)  D
"RTN","GMRCCD",52,0)
 . S GMPCNT=GMPCNT+1
"RTN","GMRCCD",53,0)
 . S GMCONS=""
"RTN","GMRCCD",54,0)
 . F  S GMCONS=$O(@GMROOT@("DATA",GMNAME,GMCONS)) Q:(GMCONS="")!(GMEXIT>0)  D
"RTN","GMRCCD",55,0)
 .. S GMCCNT=GMCCNT+1
"RTN","GMRCCD",56,0)
 .. K @GMCRPT,@GMDOCS,@GMNRPT
"RTN","GMRCCD",57,0)
 .. ; Get consult text
"RTN","GMRCCD",58,0)
 .. S GM0CON=$P(GMCONS,U,2)
"RTN","GMRCCD",59,0)
 .. S GMRCOER=2
"RTN","GMRCCD",60,0)
 .. K GMRCQUT
"RTN","GMRCCD",61,0)
 .. D DT^GMRCSLM2(GM0CON)
"RTN","GMRCCD",62,0)
 .. I $G(GMRCQUT)'>0 D
"RTN","GMRCCD",63,0)
 ... S GMTITL="",GMINDX=0
"RTN","GMRCCD",64,0)
 ... F  S GMTITL=$O(@GMROOT@("DATA",GMNAME,GMCONS,GMTITL)) Q:(GMTITL="")!(GMEXIT>0)  D
"RTN","GMRCCD",65,0)
 .... S GMNCNT=GMNCNT+1
"RTN","GMRCCD",66,0)
 .... S GM0NOT=$P(GMTITL,U,3)
"RTN","GMRCCD",67,0)
 .... ; Build browser doc list
"RTN","GMRCCD",68,0)
 .... I (GM0CON>0)&(GM0NOT>0) D
"RTN","GMRCCD",69,0)
 ..... S GMINDX=GMINDX+1
"RTN","GMRCCD",70,0)
 ..... ; Add consult to doc list
"RTN","GMRCCD",71,0)
 ..... S GMTEXT="Consult Narrative"
"RTN","GMRCCD",72,0)
 ..... S GMTEXT=GMTEXT_" ("_GMCCNT_" of "_GMCCNT(0)_")"
"RTN","GMRCCD",73,0)
 ..... S @GMDOCS@(GMTEXT)=GMCRPT
"RTN","GMRCCD",74,0)
 ..... ; Get progress note text
"RTN","GMRCCD",75,0)
 ..... K @GMNOTE
"RTN","GMRCCD",76,0)
 ..... D RPC^TIUSRV(.GMNOTE,GM0NOT)
"RTN","GMRCCD",77,0)
 ..... S GMNTXT=$NA(@GMNRPT@(GM0NOT))
"RTN","GMRCCD",78,0)
 ..... M @GMNTXT=@GMNOTE
"RTN","GMRCCD",79,0)
 ..... K @GMNOTE
"RTN","GMRCCD",80,0)
 ..... ; Add progress note to doc list
"RTN","GMRCCD",81,0)
 ..... S GMTEXT="Note "_$TR($J(GMINDX,2)," ","0")
"RTN","GMRCCD",82,0)
 ..... S GMTEXT=GMTEXT_": "_$P(GMTITL,U,1)
"RTN","GMRCCD",83,0)
 ..... S @GMDOCS@(GMTEXT)=GMNTXT
"RTN","GMRCCD",84,0)
 ..... Q
"RTN","GMRCCD",85,0)
 .... Q
"RTN","GMRCCD",86,0)
 ... D SHOWPICK(GMDOCS,GM0CON,.GMEXIT)
"RTN","GMRCCD",87,0)
 ... Q
"RTN","GMRCCD",88,0)
 .. K @GMCRPT,@GMDOCS,@GMNRPT
"RTN","GMRCCD",89,0)
 .. Q
"RTN","GMRCCD",90,0)
 . Q
"RTN","GMRCCD",91,0)
 I GMEXIT'>0 D
"RTN","GMRCCD",92,0)
 . K GMTEXT S GMTEXT="*** Done ***"
"RTN","GMRCCD",93,0)
 . D HANGMSG(.GMTEXT,0,0)
"RTN","GMRCCD",94,0)
 . Q
"RTN","GMRCCD",95,0)
 Q
"RTN","GMRCCD",96,0)
 ;
"RTN","GMRCCD",97,0)
SHOWPICK(GMROOT,GM0CON,GMEXIT) ;
"RTN","GMRCCD",98,0)
 ; *** Show consult & progress notes
"RTN","GMRCCD",99,0)
 ; *** Pick progress note to close consult
"RTN","GMRCCD",100,0)
 I $O(@GMROOT@(""))]"" F  D  Q:GMEXIT'="?"
"RTN","GMRCCD",101,0)
 . D SHOWNOTE(GMROOT,GM0CON)
"RTN","GMRCCD",102,0)
 . D PICKNOTE(GMROOT,GM0CON,.GMEXIT)
"RTN","GMRCCD",103,0)
 . Q
"RTN","GMRCCD",104,0)
 Q
"RTN","GMRCCD",105,0)
 ;
"RTN","GMRCCD",106,0)
SHOWNOTE(GMROOT,GM0CON) ;
"RTN","GMRCCD",107,0)
 ; *** Show consult & progress notes to user
"RTN","GMRCCD",108,0)
 N GMLINE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","GMRCCD",109,0)
 D HEADER(GM0CON,.GMLINE)
"RTN","GMRCCD",110,0)
 D FOOTER(IOSL-2)
"RTN","GMRCCD",111,0)
 D DOCLIST^DDBR(GMROOT,"R",GMLINE+2,IOSL-2)
"RTN","GMRCCD",112,0)
 Q
"RTN","GMRCCD",113,0)
 ;
"RTN","GMRCCD",114,0)
PICKNOTE(GMROOT,GM0CON,GMEXIT) ;
"RTN","GMRCCD",115,0)
 ; *** Pick progress note to close consult
"RTN","GMRCCD",116,0)
 N GM0NOT,GMBELL,GMGLOB,GMINDX,GMMAXX
"RTN","GMRCCD",117,0)
 N GMMSGS,GMTEXT,GMTIME,GMTITL
"RTN","GMRCCD",118,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","GMRCCD",119,0)
 ; Build reader doc list
"RTN","GMRCCD",120,0)
 S DIR("A")="Select NOTE TO CLOSE CONSULT: "
"RTN","GMRCCD",121,0)
 S DIR("A",1)="Select the note to close the consult"
"RTN","GMRCCD",122,0)
 S DIR("A",2)=" "
"RTN","GMRCCD",123,0)
 S DIR("A",3)="  0 - Do not close the consult"
"RTN","GMRCCD",124,0)
 S GMTITL="Note 00: ",GMINDX=0
"RTN","GMRCCD",125,0)
 F  S GMTITL=$O(@GMROOT@(GMTITL)) Q:GMTITL=""  D
"RTN","GMRCCD",126,0)
 . ; The doc list data is a closed global root specifying
"RTN","GMRCCD",127,0)
 . ; the location of the progress note text block.  The last
"RTN","GMRCCD",128,0)
 . ; subscript of data root is the IEN of the progress note.
"RTN","GMRCCD",129,0)
 . ; @GMROOT@(DocumentTitle) = ArrayName(...,ProgressNoteIEN)
"RTN","GMRCCD",130,0)
 . S GMGLOB=$G(@GMROOT@(GMTITL))
"RTN","GMRCCD",131,0)
 . S GM0NOT=$QS(GMGLOB,$QL(GMGLOB))
"RTN","GMRCCD",132,0)
 . I GM0NOT>0 D
"RTN","GMRCCD",133,0)
 .. S GMINDX=GMINDX+1
"RTN","GMRCCD",134,0)
 .. S DIR("A",3+GMINDX)=$J(GMINDX,3)_" - "_GMTITL
"RTN","GMRCCD",135,0)
 .. ; IndexNumber to ProgressNoteIEN^NoteTitle mapping array
"RTN","GMRCCD",136,0)
 .. S GM0NOT(GMINDX)=GM0NOT_U_GMTITL
"RTN","GMRCCD",137,0)
 .. Q
"RTN","GMRCCD",138,0)
 . Q
"RTN","GMRCCD",139,0)
 S GMMAXX=GMINDX+1
"RTN","GMRCCD",140,0)
 S DIR("A",3+GMINDX+1)=$J(GMMAXX,3)_" - Redisplay the consult/progress note(s)"
"RTN","GMRCCD",141,0)
 S DIR("A",3+GMINDX+2)="  ^ - Exit the Consult Closure Tool"
"RTN","GMRCCD",142,0)
 S DIR("A",3+GMINDX+3)=" "
"RTN","GMRCCD",143,0)
 S DIR("B")=GMMAXX
"RTN","GMRCCD",144,0)
 S DIR(0)="NOA^0:"_GMMAXX_":0^K:X'?1.N X"
"RTN","GMRCCD",145,0)
 S DIR("?")="^D HEADER^GMRCCD(GM0CON)"
"RTN","GMRCCD",146,0)
 ; Display consult closure prompt screen
"RTN","GMRCCD",147,0)
 D HEADER(GM0CON)
"RTN","GMRCCD",148,0)
 W ! D ^DIR S GMINDX=+$G(Y)
"RTN","GMRCCD",149,0)
 S GMEXIT=$S($$DIREXIT^GMRCCA>0:1,GMINDX=GMMAXX:"?",1:0)
"RTN","GMRCCD",150,0)
 K GMTEXT S GMTIME=3,GMBELL=0
"RTN","GMRCCD",151,0)
 I GMEXIT=0 D
"RTN","GMRCCD",152,0)
 . S GM0NOT=+$P($G(GM0NOT(GMINDX)),U,1)
"RTN","GMRCCD",153,0)
 . I (GM0CON>0)&(GM0NOT>0) D
"RTN","GMRCCD",154,0)
 .. ; Attempt to close consult
"RTN","GMRCCD",155,0)
 .. I $$CONUPDT^GMRCCC(GM0CON,GM0NOT,.GMMSGS)>0 D
"RTN","GMRCCD",156,0)
 ... S GMTEXT(1)="*** The consult has been closed ***"
"RTN","GMRCCD",157,0)
 ... S GMTEXT="Selection: "_$P(GM0NOT(GMINDX),U,2)
"RTN","GMRCCD",158,0)
 ... Q
"RTN","GMRCCD",159,0)
 .. E  D
"RTN","GMRCCD",160,0)
 ... S GMTIME=$G(DTIME,900),GMBELL=1
"RTN","GMRCCD",161,0)
 ... S GMTEXT(1)="*** The consult has NOT been closed ***"
"RTN","GMRCCD",162,0)
 ... S GMTEXT(2)="Reason: "_$S($G(GMMSGS)]"":GMMSGS,1:"Unknown!")
"RTN","GMRCCD",163,0)
 ... S GMTEXT(3)="Selection: "_$P(GM0NOT(GMINDX),U,2)
"RTN","GMRCCD",164,0)
 ... S GMTEXT(4)=""
"RTN","GMRCCD",165,0)
 ... S GMTEXT="Enter RETURN to continue: "
"RTN","GMRCCD",166,0)
 ... Q
"RTN","GMRCCD",167,0)
 .. Q
"RTN","GMRCCD",168,0)
 . E  D
"RTN","GMRCCD",169,0)
 .. S GMTEXT="*** No action taken on the consult ***"
"RTN","GMRCCD",170,0)
 .. Q
"RTN","GMRCCD",171,0)
 . Q
"RTN","GMRCCD",172,0)
 E  D
"RTN","GMRCCD",173,0)
 . I GMEXIT>0 D
"RTN","GMRCCD",174,0)
 .. S GMTIME=0
"RTN","GMRCCD",175,0)
 .. S GMTEXT="*** Exiting the Consult Closure Tool ***"
"RTN","GMRCCD",176,0)
 .. Q
"RTN","GMRCCD",177,0)
 . Q
"RTN","GMRCCD",178,0)
 D HANGMSG(.GMTEXT,GMTIME,GMBELL)
"RTN","GMRCCD",179,0)
 Q
"RTN","GMRCCD",180,0)
 ;
"RTN","GMRCCD",181,0)
HEADER(GM0CON,GMLINE) ;
"RTN","GMRCCD",182,0)
 ; *** Pt name header
"RTN","GMRCCD",183,0)
 W @IOF,"Consult closure for patient: "
"RTN","GMRCCD",184,0)
 W $$GET1^DIQ(123,GM0CON,.02)
"RTN","GMRCCD",185,0)
 W " (",$$GET1^DIQ(123,GM0CON,".02:.0905"),") "
"RTN","GMRCCD",186,0)
 W $$DATE^GMRCCC($$GET1^DIQ(123,GM0CON,".02:.03","I"),"5DZ")
"RTN","GMRCCD",187,0)
 W !,$$GET1^DIQ(123,GM0CON,1)
"RTN","GMRCCD",188,0)
 W " (",$$GET1^DIQ(123,GM0CON,"8:.1"),") "
"RTN","GMRCCD",189,0)
 W $$DATE^GMRCCC($$GET1^DIQ(123,GM0CON,3,"I"),"5DZ")
"RTN","GMRCCD",190,0)
 S GMLINE=$Y
"RTN","GMRCCD",191,0)
 Q
"RTN","GMRCCD",192,0)
 ;
"RTN","GMRCCD",193,0)
FOOTER(GMLINE) ;
"RTN","GMRCCD",194,0)
 ; *** Page footer instructions
"RTN","GMRCCD",195,0)
 F  Q:$Y'<(GMLINE-1)  W !
"RTN","GMRCCD",196,0)
 W !,"Use <PF1>S to Switch between views of the consult and progress note(s)"
"RTN","GMRCCD",197,0)
 W !,"Use R to Return to the previously viewed consult or progress note(s)"
"RTN","GMRCCD",198,0)
 Q
"RTN","GMRCCD",199,0)
 ;
"RTN","GMRCCD",200,0)
HANGMSG(GMTEXT,GMTIME,GMBELL) ;
"RTN","GMRCCD",201,0)
 ; *** Hang a message on the screen for a time
"RTN","GMRCCD",202,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","GMRCCD",203,0)
 I $G(GMTEXT)]"" D
"RTN","GMRCCD",204,0)
 . I $G(GMBELL)>0 S GMTEXT=GMTEXT_$C(7)
"RTN","GMRCCD",205,0)
 . S DIR(0)="EA"
"RTN","GMRCCD",206,0)
 . M DIR("A")=GMTEXT
"RTN","GMRCCD",207,0)
 . S (DIR("?"),DIR("??"))=""
"RTN","GMRCCD",208,0)
 . S DIR("T")=+$G(GMTIME)
"RTN","GMRCCD",209,0)
 . D TYPEAHED(0)
"RTN","GMRCCD",210,0)
 . W ! D ^DIR
"RTN","GMRCCD",211,0)
 . D TYPEAHED(1)
"RTN","GMRCCD",212,0)
 . Q
"RTN","GMRCCD",213,0)
 Q
"RTN","GMRCCD",214,0)
 ;
"RTN","GMRCCD",215,0)
TYPEAHED(GMBOOL) ;
"RTN","GMRCCD",216,0)
 ; *** Enable/Disable type-ahead
"RTN","GMRCCD",217,0)
 N GMKRNL,GMUSER
"RTN","GMRCCD",218,0)
 I GMBOOL>0 D
"RTN","GMRCCD",219,0)
 . S GMUSER=$TR($$GET1^DIQ(200,DUZ,200.09,"I"),"YN","10")
"RTN","GMRCCD",220,0)
 . S GMKRNL=$TR($$GET1^DIQ(8989.3,1,209,"I"),"YN","10")
"RTN","GMRCCD",221,0)
 . I $S(GMUSER?1N:GMUSER,1:GMKRNL)>0 X ^%ZOSF("TYPE-AHEAD")
"RTN","GMRCCD",222,0)
 . Q
"RTN","GMRCCD",223,0)
 E  D
"RTN","GMRCCD",224,0)
 . X ^%ZOSF("NO-TYPE-AHEAD")
"RTN","GMRCCD",225,0)
 . Q
"RTN","GMRCCD",226,0)
 Q
"RTN","GMRCCD",227,0)
 ;
"RTN","GMRCCD",228,0)
COUNT(GMROOT,GMPCNT,GMCCNT,GMNCNT) ;
"RTN","GMRCCD",229,0)
 ; *** Count patients / consults / notes
"RTN","GMRCCD",230,0)
 N GMCONS,GMNAME,GMTITL,GMUCON,GMUNAM,GMUTTL
"RTN","GMRCCD",231,0)
 S GMUNAM=$NA(@GMROOT@("UNIQUE-NAME"))
"RTN","GMRCCD",232,0)
 S GMUCON=$NA(@GMROOT@("UNIQUE-CONS"))
"RTN","GMRCCD",233,0)
 S GMUTTL=$NA(@GMROOT@("UNIQUE-TITL"))
"RTN","GMRCCD",234,0)
 K @GMUNAM,@GMUCON,@GMUTTL
"RTN","GMRCCD",235,0)
 S (GMPCNT,GMCCNT,GMNCNT)=0
"RTN","GMRCCD",236,0)
 S GMNAME=""
"RTN","GMRCCD",237,0)
 F  S GMNAME=$O(@GMROOT@("DATA",GMNAME)) Q:GMNAME=""  D
"RTN","GMRCCD",238,0)
 . I $D(@GMUNAM@(GMNAME))#2'>0 S GMPCNT=GMPCNT+1
"RTN","GMRCCD",239,0)
 . S @GMUNAM@(GMNAME)=""
"RTN","GMRCCD",240,0)
 . S GMCONS=""
"RTN","GMRCCD",241,0)
 . F  S GMCONS=$O(@GMROOT@("DATA",GMNAME,GMCONS)) Q:GMCONS=""  D
"RTN","GMRCCD",242,0)
 .. I $D(@GMUCON@(GMCONS))#2'>0 S GMCCNT=GMCCNT+1
"RTN","GMRCCD",243,0)
 .. S @GMUCON@(GMCONS)=""
"RTN","GMRCCD",244,0)
 .. S GMTITL=""
"RTN","GMRCCD",245,0)
 .. F  S GMTITL=$O(@GMROOT@("DATA",GMNAME,GMCONS,GMTITL)) Q:GMTITL=""  D
"RTN","GMRCCD",246,0)
 ... I $D(@GMUTTL@(GMTITL))#2'>0 S GMNCNT=GMNCNT+1
"RTN","GMRCCD",247,0)
 ... S @GMUTTL@(GMTITL)=""
"RTN","GMRCCD",248,0)
 ... Q
"RTN","GMRCCD",249,0)
 .. Q
"RTN","GMRCCD",250,0)
 . Q
"RTN","GMRCCD",251,0)
 K @GMUNAM,@GMUCON,@GMUTTL
"RTN","GMRCCD",252,0)
 Q
"RTN","GMRCCD",253,0)
 ;
"RTN","GMRCCD",254,0)
CLINLIST(GMROOT,GM0CFG) ;
"RTN","GMRCCD",255,0)
 ; *** Get list of clinics
"RTN","GMRCCD",256,0)
 N GM0CLN,GM0STP,GMINDX,GMLIST,GMSCRN
"RTN","GMRCCD",257,0)
 S GM0CLN=0
"RTN","GMRCCD",258,0)
 F  S GM0CLN=$O(^GMR(123.033,GM0CFG,"CLIN","B",GM0CLN)) Q:GM0CLN'>0  D
"RTN","GMRCCD",259,0)
 . S @GMROOT@("XREF-CLIN",GM0CLN)=""
"RTN","GMRCCD",260,0)
 . Q
"RTN","GMRCCD",261,0)
 S GM0STP=$$GET1^DIQ(123.033,GM0CFG,.06,"I")
"RTN","GMRCCD",262,0)
 I GM0STP>0 D
"RTN","GMRCCD",263,0)
 . S GMLIST=$NA(^TMP("DILIST",$J))
"RTN","GMRCCD",264,0)
 . K @GMLIST
"RTN","GMRCCD",265,0)
 . S GMSCRN="I $P(^(0),U,7)="_GM0STP
"RTN","GMRCCD",266,0)
 . D LIST^DIC(44,"","@","Q","*","",GM0STP,"AST",GMSCRN)
"RTN","GMRCCD",267,0)
 . D CLEAN^DILF
"RTN","GMRCCD",268,0)
 . S GMINDX=0
"RTN","GMRCCD",269,0)
 . F  S GMINDX=$O(@GMLIST@(2,GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCD",270,0)
 .. S GM0CLN=$G(@GMLIST@(2,GMINDX))
"RTN","GMRCCD",271,0)
 .. I GM0CLN>0 S @GMROOT@("XREF-CLIN",GM0CLN)=""
"RTN","GMRCCD",272,0)
 .. Q
"RTN","GMRCCD",273,0)
 . K @GMLIST
"RTN","GMRCCD",274,0)
 . Q
"RTN","GMRCCD",275,0)
 Q
"RTN","GMRCCD",276,0)
 ;
"RTN","GMRCCD",277,0)
CONSOKAY(GM0CON) ;
"RTN","GMRCCD",278,0)
 ; *** Consult status okay?
"RTN","GMRCCD",279,0)
 Q $S("^c^dc^x^"[(U_$$GET1^DIQ(123,GM0CON,"8:.1")_U):0,1:1)
"RTN","GMRCCD",280,0)
 ;
"RTN","GMRCCD",281,0)
NOTESTAT(GMSTAT) ;
"RTN","GMRCCD",282,0)
 ; *** Get list of note statuses
"RTN","GMRCCD",283,0)
 N GM0STA,GMINDX
"RTN","GMRCCD",284,0)
 K GMSTAT
"RTN","GMRCCD",285,0)
 F GMINDX="AMENDED","COMPLETED" D
"RTN","GMRCCD",286,0)
 . S GM0STA=$$FIND1^DIC(8925.6,"","X",GMINDX,"B")
"RTN","GMRCCD",287,0)
 . I GM0STA>0 S GMSTAT(GM0STA)=GM0STA_U_GMINDX
"RTN","GMRCCD",288,0)
 . Q
"RTN","GMRCCD",289,0)
 Q
"RTN","GMRCCD",290,0)
 ;
"RTN","GMRCCD",291,0)
ISTM(GM0CFG) ;
"RTN","GMRCCD",292,0)
 ; *** Manual patient team associated with configuration?
"RTN","GMRCCD",293,0)
 Q ($$GET1^DIQ(123.033,GM0CFG,".03:1","I")="TM")
"RTN","GMRCCD",294,0)
 ;
"RTN","GMRCCD",295,0)
GLOBROOT(GMFILE,GMTRAN) ;
"RTN","GMRCCD",296,0)
 ; *** Get file's global root
"RTN","GMRCCD",297,0)
 N GMROOT
"RTN","GMRCCD",298,0)
 S GMROOT=$$GET1^DID(GMFILE,"","","GLOBAL NAME")
"RTN","GMRCCD",299,0)
 Q $S($D(GMTRAN)#2>0:$TR(GMROOT,U,GMTRAN),1:GMROOT)
"RTN","GMRCCD",300,0)
 ;
"RTN","GMRCCD",301,0)
SEEN(GMSTAT) ;
"RTN","GMRCCD",302,0)
 ; *** Pt was seen in clinic?
"RTN","GMRCCD",303,0)
 Q ("^I^NT^R^"[(U_GMSTAT_U))
"RTN","GMRCCD",304,0)
 ;
"RTN","GMRCCD",305,0)
UNSEEN(GMSTAT) ;
"RTN","GMRCCD",306,0)
 ; *** Pt was not seen in clinic?
"RTN","GMRCCD",307,0)
 Q ("^CC^CCR^CP^CPR^NS^NSR^"[(U_GMSTAT_U))
"RTN","GMRCCX")
0^6^B8358463^n/a
"RTN","GMRCCX",1,0)
GMRCCX ;SFVAMC/DAD - Consult Closure Tool: Config File Utilities ;01/20/17 15:19
"RTN","GMRCCX",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCX",3,0)
 ;Consult Closure Tool
"RTN","GMRCCX",4,0)
 ;
"RTN","GMRCCX",5,0)
 ; IA#   Usage      Component
"RTN","GMRCCX",6,0)
 ; --------------------------
"RTN","GMRCCX",7,0)
 ; 1058  Private    MDEL^DDSUTL
"RTN","GMRCCX",8,0)
 ; 1058  Private    MLOAD^DDSUTL
"RTN","GMRCCX",9,0)
 ; 2051  Supported  LIST^DIC
"RTN","GMRCCX",10,0)
 ; 2052  Supported  $$GET1^DID
"RTN","GMRCCX",11,0)
 ; 2053  Supported  UPDATE^DIE
"RTN","GMRCCX",12,0)
 ; 2054  Supported  CLEAN^DILF
"RTN","GMRCCX",13,0)
 ;
"RTN","GMRCCX",14,0)
LOOKUP(GMX,GM0,GMFILE) ;
"RTN","GMRCCX",15,0)
 ; *** Process additions/deletions [-]XXX*
"RTN","GMRCCX",16,0)
 ; Called from the pre-lookup transform nodes
"RTN","GMRCCX",17,0)
 ; ^DD(123.0331 -> 123.0336,.01,7.5)
"RTN","GMRCCX",18,0)
 N GMFDA,GMIEN,GMLST,D0,D1,DA,DIC,DIERR
"RTN","GMRCCX",19,0)
 N DIHELP,DIMSG,DUOUT,DIRUT,DIROUT,DO,DTOUT,X,Y
"RTN","GMRCCX",20,0)
 I ($G(GMX)?1.E1"*"),($G(GM0)>0) D
"RTN","GMRCCX",21,0)
 . S GMLST=$NA(^TMP("DILIST",$J))
"RTN","GMRCCX",22,0)
 . S GMFDA=$NA(^TMP("GMCTR-FDA",$J))
"RTN","GMRCCX",23,0)
 . S GMIEN=$NA(^TMP("GMCTR-IEN",$J))
"RTN","GMRCCX",24,0)
 . K @GMLST,@GMFDA,@GMIEN
"RTN","GMRCCX",25,0)
 . I $E(GMX)="-" D
"RTN","GMRCCX",26,0)
 .. D DEL(.GMX,GM0,GMFILE)
"RTN","GMRCCX",27,0)
 .. Q
"RTN","GMRCCX",28,0)
 . E  D
"RTN","GMRCCX",29,0)
 .. D ADD(.GMX,GM0,GMFILE)
"RTN","GMRCCX",30,0)
 .. Q
"RTN","GMRCCX",31,0)
 . K @GMLST,@GMFDA,@GMIEN
"RTN","GMRCCX",32,0)
 . Q
"RTN","GMRCCX",33,0)
 Q
"RTN","GMRCCX",34,0)
 ;
"RTN","GMRCCX",35,0)
ADD(GMX,GM0,GMFILE) ;
"RTN","GMRCCX",36,0)
 ; *** Process additions XXX* (Copy/Mod of LOOKE^XPDET)
"RTN","GMRCCX",37,0)
 N GMDATA,GMIENS,GMINDX,GMPOIN,GMSCRN
"RTN","GMRCCX",38,0)
 S GMPOIN=$$GET1^DID(GMFILE,.01,"","SPECIFIER")
"RTN","GMRCCX",39,0)
 S GMPOIN=$TR(GMPOIN,$TR(GMPOIN,"0123456789."))
"RTN","GMRCCX",40,0)
 S GMSCRN=$$DICS(GMFILE)
"RTN","GMRCCX",41,0)
 S GMX=$P(GMX,"*",1)
"RTN","GMRCCX",42,0)
 D LIST^DIC(GMPOIN,"","","","*","",GMX,"",GMSCRN)
"RTN","GMRCCX",43,0)
 I $G(@GMLST@(0))>0 D
"RTN","GMRCCX",44,0)
 . S GMINDX=0
"RTN","GMRCCX",45,0)
 . F  S GMINDX=$O(@GMLST@(2,GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCX",46,0)
 .. S GMDATA=$G(@GMLST@(2,GMINDX))
"RTN","GMRCCX",47,0)
 .. I GMDATA>0 D
"RTN","GMRCCX",48,0)
 ... S GMIENS="?+"_GMINDX_","_GM0_","
"RTN","GMRCCX",49,0)
 ... S @GMFDA@(GMFILE,GMIENS,.01)=GMDATA
"RTN","GMRCCX",50,0)
 ... S @GMIEN@(GMINDX)=GMDATA
"RTN","GMRCCX",51,0)
 ... Q
"RTN","GMRCCX",52,0)
 .. Q
"RTN","GMRCCX",53,0)
 . I $D(@GMFDA) D
"RTN","GMRCCX",54,0)
 .. D UPDATE^DIE("",GMFDA,GMIEN)
"RTN","GMRCCX",55,0)
 .. I '$D(DIERR),$D(DDS),$D(@GMIEN) D MLOAD^DDSUTL(GMIEN)
"RTN","GMRCCX",56,0)
 .. D CLEAN^DILF
"RTN","GMRCCX",57,0)
 .. Q
"RTN","GMRCCX",58,0)
 . S GMX=""
"RTN","GMRCCX",59,0)
 . Q
"RTN","GMRCCX",60,0)
 E  D
"RTN","GMRCCX",61,0)
 . K GMX
"RTN","GMRCCX",62,0)
 . Q
"RTN","GMRCCX",63,0)
 Q
"RTN","GMRCCX",64,0)
 ;
"RTN","GMRCCX",65,0)
DEL(GMX,GM0,GMFILE) ;
"RTN","GMRCCX",66,0)
 ; *** Process deletions -XXX* (Copy/Mod of DEL^XPDET)
"RTN","GMRCCX",67,0)
 N GM1,GMIENS,GMINDX
"RTN","GMRCCX",68,0)
 S GMX=$P(GMX,"*",1),GMX=$E(GMX,2,$L(GMX)-1)
"RTN","GMRCCX",69,0)
 D LIST^DIC(GMFILE,","_GM0_",","","","*","",GMX)
"RTN","GMRCCX",70,0)
 I $G(@GMLST@(0))>0 D
"RTN","GMRCCX",71,0)
 . S GMINDX=0
"RTN","GMRCCX",72,0)
 . F  S GMINDX=$O(@GMLST@(2,GMINDX)) Q:GMINDX'>0  D
"RTN","GMRCCX",73,0)
 .. S GM1=$G(@GMLST@(2,GMINDX))
"RTN","GMRCCX",74,0)
 .. I GM1>0 D
"RTN","GMRCCX",75,0)
 ... S GMIENS=GM1_","_GM0_","
"RTN","GMRCCX",76,0)
 ... S @GMFDA@(GMFILE,GMIENS,.01)="@"
"RTN","GMRCCX",77,0)
 ... Q
"RTN","GMRCCX",78,0)
 .. Q
"RTN","GMRCCX",79,0)
 . I $D(@GMFDA) D
"RTN","GMRCCX",80,0)
 .. D UPDATE^DIE("",GMFDA)
"RTN","GMRCCX",81,0)
 .. I '$D(DIERR),$D(DDS) D MDEL^DDSUTL($NA(@GMLST@(2)))
"RTN","GMRCCX",82,0)
 .. D CLEAN^DILF
"RTN","GMRCCX",83,0)
 .. Q
"RTN","GMRCCX",84,0)
 . S GMX=""
"RTN","GMRCCX",85,0)
 . Q
"RTN","GMRCCX",86,0)
 E  D
"RTN","GMRCCX",87,0)
 . K GMX
"RTN","GMRCCX",88,0)
 . Q
"RTN","GMRCCX",89,0)
 Q
"RTN","GMRCCX",90,0)
 ;
"RTN","GMRCCX",91,0)
DICS(GMFILE) ;
"RTN","GMRCCX",92,0)
 ; *** DIC("S") data screens
"RTN","GMRCCX",93,0)
 ; Called from ADD^GMRCCX and
"RTN","GMRCCX",94,0)
 ; ^DD(123.0331 -> 123.0336,.01,0 & 12.1)
"RTN","GMRCCX",95,0)
 N GMSCRN
"RTN","GMRCCX",96,0)
 ; Disabled consult services are not selectable
"RTN","GMRCCX",97,0)
 S GMSCRN(123.0331)="I $P(^(0),U,2)'=9"
"RTN","GMRCCX",98,0)
 ; Inactive consult procedures are not selectable
"RTN","GMRCCX",99,0)
 S GMSCRN(123.0332)="I $P(^(0),U,2)'>0"
"RTN","GMRCCX",100,0)
 ; Only consult order items are selectable
"RTN","GMRCCX",101,0)
 S GMSCRN(123.0333)="I ($P(^(0),U,3)="""")&(^(0)?1""GMRC""1(1""R"",1""T"").E)"
"RTN","GMRCCX",102,0)
 ; Only active clinical procedures are selectable
"RTN","GMRCCX",103,0)
 S GMSCRN(123.0334)="I $P(^(0),U,9)=1"
"RTN","GMRCCX",104,0)
 ; Only clinics are selectable
"RTN","GMRCCX",105,0)
 S GMSCRN(123.0335)="I $P(^(0),U,3)=""C"""
"RTN","GMRCCX",106,0)
 ; Only titles are selectable
"RTN","GMRCCX",107,0)
 S GMSCRN(123.0336)="I $P(^(0),U,4)=""DOC"""
"RTN","GMRCCX",108,0)
 Q $G(GMSCRN(+$G(GMFILE)),"I 1")
"RTN","GMRCCX",109,0)
 ;
"RTN","GMRCCY")
0^5^B68601290^n/a
"RTN","GMRCCY",1,0)
GMRCCY ;SFVAMC/DAD - Consult Closure Tool: Date Range Selector ;01/20/17 15:19
"RTN","GMRCCY",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCCY",3,0)
 ;Consult Closure Tool
"RTN","GMRCCY",4,0)
 ;
"RTN","GMRCCY",5,0)
 ; IA#    Usage      Component
"RTN","GMRCCY",6,0)
 ; ---------------------------
"RTN","GMRCCY",7,0)
 ; 10003  Supported  ^%DT        
"RTN","GMRCCY",8,0)
 ; 10103  Supported  $$FMTE^XLFDT
"RTN","GMRCCY",9,0)
 ; 10103  Supported  $$SCH^XLFDT 
"RTN","GMRCCY",10,0)
 ; 10104  Supported  $$UP^XLFSTR 
"RTN","GMRCCY",11,0)
 ;
"RTN","GMRCCY",12,0)
EN(GMTBEG,GMTEND,GMHEAD,GMRANG) ; *** Entry Point
"RTN","GMRCCY",13,0)
 ; Input
"RTN","GMRCCY",14,0)
 ;  GMTBEG = Begin date - Default (FM Int) [Req, Pass by ref]
"RTN","GMRCCY",15,0)
 ;  GMTEND = End   date - Default (FM Int) [Req, Pass by ref]
"RTN","GMRCCY",16,0)
 ;  GMHEAD = Header line [Opt, Pass by value]
"RTN","GMRCCY",17,0)
 ;  GMRANG = Date range type [Opt, Pass by value]
"RTN","GMRCCY",18,0)
 ;             M,M!,Q,Q!,S,S!,Y,Y!,F,F!,U,U!  ("!" forces selection)
"RTN","GMRCCY",19,0)
 ; Output
"RTN","GMRCCY",20,0)
 ;  $$EN()   = 1 - Okay   OR   0 - Exit
"RTN","GMRCCY",21,0)
 ;  GMTBEG = Begin date [If $$EN()=1 FM Int Date, Else ""]
"RTN","GMRCCY",22,0)
 ;  GMTEND = End   date [If $$EN()=1 FM Int Date, Else ""]
"RTN","GMRCCY",23,0)
 ;
"RTN","GMRCCY",24,0)
 ; Example
"RTN","GMRCCY",25,0)
 ;  IF $$EN^GMDATE(.GMTBEG,.GMTEND,GMHEAD,GMRANG)'>0 QUIT
"RTN","GMRCCY",26,0)
 ;
"RTN","GMRCCY",27,0)
 N GM,GMDATA,GMDFLT,GMDONE,GMFRAM,GMQUIT,GMWHEN,X,Y
"RTN","GMRCCY",28,0)
 S (GMFRAM,GMFRAM(0))=""
"RTN","GMRCCY",29,0)
 F GM=1:1 S GMDATA=$P($T(FRAMDAT+GM),";;",2) Q:GMDATA=U  D
"RTN","GMRCCY",30,0)
 . S GMFRAM=GMFRAM_U_$$UP^XLFSTR(GMDATA)
"RTN","GMRCCY",31,0)
 . S GMFRAM(0)=GMFRAM(0)_GMDATA_$S(GM<6:",  ",1:"")
"RTN","GMRCCY",32,0)
 . Q
"RTN","GMRCCY",33,0)
 F  D  Q:GMQUIT!GMDONE
"RTN","GMRCCY",34,0)
 . S (GMQUIT,GMDONE)=0
"RTN","GMRCCY",35,0)
 . S GMTBEG=$S($G(GMTBEG)\1?7N:GMTBEG\1,1:"")
"RTN","GMRCCY",36,0)
 . S GMTEND=$S($G(GMTEND)\1?7N:GMTEND\1,1:"")
"RTN","GMRCCY",37,0)
 . S GMDFLT=$$UP^XLFSTR($G(GMRANG))_U_GMTBEG_U_GMTEND
"RTN","GMRCCY",38,0)
 . I $G(GMHEAD)]"" W !,GMHEAD
"RTN","GMRCCY",39,0)
 . W !,GMFRAM(0)
"RTN","GMRCCY",40,0)
 . W !,"Select date range: "
"RTN","GMRCCY",41,0)
 . W $S($TR($P(GMDFLT,U),"!")]"":$TR($P(GMDFLT,U),"!")_"// ",1:"")
"RTN","GMRCCY",42,0)
 . S GMWHEN=""
"RTN","GMRCCY",43,0)
 . I $P(GMDFLT,U)'["!" R GMWHEN:DTIME S:'$T GMWHEN=U
"RTN","GMRCCY",44,0)
 . I GMWHEN="" S GMWHEN=$TR($P(GMDFLT,U),"!") W GMWHEN
"RTN","GMRCCY",45,0)
 . I (GMWHEN="")!($E(GMWHEN)=U) S GMQUIT=1 Q
"RTN","GMRCCY",46,0)
 . S GMWHEN=$$UP^XLFSTR(GMWHEN)
"RTN","GMRCCY",47,0)
 . I $F(GMFRAM,U_GMWHEN)'>0 D  Q
"RTN","GMRCCY",48,0)
 .. D BELL(GMWHEN)
"RTN","GMRCCY",49,0)
 .. I $P(GMDFLT,U)["!" S GMQUIT=1 Q
"RTN","GMRCCY",50,0)
 .. W !!?5,"Enter the first few letters of "
"RTN","GMRCCY",51,0)
 .. W "one of the choices listed below.",!
"RTN","GMRCCY",52,0)
 .. Q
"RTN","GMRCCY",53,0)
 . W $P($P(GMFRAM,U_GMWHEN,2),U)
"RTN","GMRCCY",54,0)
 . S GMWHEN=$E(GMWHEN)
"RTN","GMRCCY",55,0)
 . S GMQUIT=$$ASKDATE(GMWHEN,GMDFLT,.GMTBEG,.GMTEND)
"RTN","GMRCCY",56,0)
 . I GMQUIT D
"RTN","GMRCCY",57,0)
 .. S GMQUIT=$S($P(GMDFLT,U)'["!":0,1:GMQUIT)
"RTN","GMRCCY",58,0)
 .. I GMQUIT'>0 W !
"RTN","GMRCCY",59,0)
 .. Q
"RTN","GMRCCY",60,0)
 . E  D
"RTN","GMRCCY",61,0)
 .. S GMDONE=1
"RTN","GMRCCY",62,0)
 .. Q
"RTN","GMRCCY",63,0)
 . Q
"RTN","GMRCCY",64,0)
 S GMQUIT='$G(GMQUIT)
"RTN","GMRCCY",65,0)
 I GMQUIT>0 D
"RTN","GMRCCY",66,0)
 . W !!,"Range selected: "
"RTN","GMRCCY",67,0)
 . W $$FMTE^XLFDT(GMTBEG,"5Z")," to ",$$FMTE^XLFDT(GMTEND,"5Z")
"RTN","GMRCCY",68,0)
 . Q
"RTN","GMRCCY",69,0)
 E  D
"RTN","GMRCCY",70,0)
 . S (GMTBEG,GMTEND)=""
"RTN","GMRCCY",71,0)
 . Q
"RTN","GMRCCY",72,0)
 Q GMQUIT
"RTN","GMRCCY",73,0)
 ;
"RTN","GMRCCY",74,0)
FRAMDAT ;; TimeFrameName
"RTN","GMRCCY",75,0)
 ;;Monthly
"RTN","GMRCCY",76,0)
 ;;Quarterly
"RTN","GMRCCY",77,0)
 ;;Semi-Annually
"RTN","GMRCCY",78,0)
 ;;Yearly
"RTN","GMRCCY",79,0)
 ;;Fiscal Yearly
"RTN","GMRCCY",80,0)
 ;;User Selectable
"RTN","GMRCCY",81,0)
 ;;^
"RTN","GMRCCY",82,0)
 ;
"RTN","GMRCCY",83,0)
ASKDATE(GMWHEN,GMDFLT,GMTBEG,GMTEND) ; *** Prompt for date range
"RTN","GMRCCY",84,0)
 N GMQUIT
"RTN","GMRCCY",85,0)
 S GMQUIT=1
"RTN","GMRCCY",86,0)
 I GMWHEN="M" D
"RTN","GMRCCY",87,0)
 . S GMQUIT=$$MONTH(GMWHEN,GMDFLT,.GMTBEG,.GMTEND)
"RTN","GMRCCY",88,0)
 . Q
"RTN","GMRCCY",89,0)
 I (GMWHEN="Q")!(GMWHEN="S") D
"RTN","GMRCCY",90,0)
 . S GMQUIT=$$QUART(GMWHEN,GMDFLT,.GMTBEG,.GMTEND)
"RTN","GMRCCY",91,0)
 . Q
"RTN","GMRCCY",92,0)
 I (GMWHEN="F")!(GMWHEN="Y") D
"RTN","GMRCCY",93,0)
 . S GMQUIT=$$YEAR(GMWHEN,GMDFLT,.GMTBEG,.GMTEND)
"RTN","GMRCCY",94,0)
 . Q
"RTN","GMRCCY",95,0)
 I GMWHEN="U" D
"RTN","GMRCCY",96,0)
 . S GMQUIT=$$USERSEL(GMWHEN,GMDFLT,.GMTBEG,.GMTEND)
"RTN","GMRCCY",97,0)
 . Q
"RTN","GMRCCY",98,0)
 Q GMQUIT
"RTN","GMRCCY",99,0)
 ;
"RTN","GMRCCY",100,0)
MONTH(GMWHEN,GMDFLT,GMTBEG,GMTEND) ; *** Monthly
"RTN","GMRCCY",101,0)
 N %DT,GM,GMDATA,GMDONE,GMEND,GMEOM,GMMNYR,GMMOE,GMQUIT,GMYEAR,X,Y
"RTN","GMRCCY",102,0)
 F GM=1:1 S GMDATA=$P($T(MONTHDAT+GM),";;",2) Q:GMDATA=U  D
"RTN","GMRCCY",103,0)
 . S GMEOM($P(GMDATA,U))=$P(GMDATA,U,2,3)
"RTN","GMRCCY",104,0)
 . Q
"RTN","GMRCCY",105,0)
 S (GMQUIT,GMDONE)=0
"RTN","GMRCCY",106,0)
 F  D  Q:(GMQUIT>0)!(GMDONE>0)
"RTN","GMRCCY",107,0)
 . K %DT
"RTN","GMRCCY",108,0)
 . S %DT="AE"
"RTN","GMRCCY",109,0)
 . S %DT("A")="Enter Month and Year: "
"RTN","GMRCCY",110,0)
 . I $P(GMDFLT,U,2)]"" D
"RTN","GMRCCY",111,0)
 .. S GMMNYR=$P(GMDFLT,U,2)
"RTN","GMRCCY",112,0)
 .. S %DT("B")=$E(GMMNYR,4,5)_"/"_(1700+$E(GMMNYR,1,3))
"RTN","GMRCCY",113,0)
 .. Q
"RTN","GMRCCY",114,0)
 . W ! D ^%DT S GMEND=+$G(Y)
"RTN","GMRCCY",115,0)
 . I GMEND'>0 S GMQUIT=1 Q
"RTN","GMRCCY",116,0)
 . I ('+$E(GMEND,4,5))!(+$E(GMEND,6,7)) D  Q
"RTN","GMRCCY",117,0)
 .. D BELL("")
"RTN","GMRCCY",118,0)
 .. W !!,"Please enter a month and year"
"RTN","GMRCCY",119,0)
 .. W $S(+$E(GMEND,6,7):" only",1:"")
"RTN","GMRCCY",120,0)
 .. Q
"RTN","GMRCCY",121,0)
 . S GMMOE=$E(GMEND,4,5)
"RTN","GMRCCY",122,0)
 . S GMTEND=$E(GMEND,1,5)_$P(GMEOM(GMMOE),U)
"RTN","GMRCCY",123,0)
 . I $E(GMTEND,4,5)="02" D
"RTN","GMRCCY",124,0)
 .. S GMYEAR=1700+$E(GMTEND,1,3)
"RTN","GMRCCY",125,0)
 .. S GMTEND=GMTEND+((GMYEAR#4=0)&((GMYEAR#100)!(GMYEAR#400=0)))
"RTN","GMRCCY",126,0)
 .. Q
"RTN","GMRCCY",127,0)
 . S GMTBEG=$E(GMTEND,1,5)_"01"
"RTN","GMRCCY",128,0)
 . S GMDONE=1
"RTN","GMRCCY",129,0)
 . Q
"RTN","GMRCCY",130,0)
 Q GMQUIT
"RTN","GMRCCY",131,0)
 ;
"RTN","GMRCCY",132,0)
MONTHDAT ;; MonthNumber ^ DaysInMonth ^ MonthName
"RTN","GMRCCY",133,0)
 ;;01^31^JANUARY
"RTN","GMRCCY",134,0)
 ;;02^28^FEBRUARY
"RTN","GMRCCY",135,0)
 ;;03^31^MARCH
"RTN","GMRCCY",136,0)
 ;;04^30^APRIL
"RTN","GMRCCY",137,0)
 ;;05^31^MAY
"RTN","GMRCCY",138,0)
 ;;06^30^JUNE
"RTN","GMRCCY",139,0)
 ;;07^31^JULY
"RTN","GMRCCY",140,0)
 ;;08^31^AUGUST
"RTN","GMRCCY",141,0)
 ;;09^30^SEPTEMBER
"RTN","GMRCCY",142,0)
 ;;10^31^OCTOBER
"RTN","GMRCCY",143,0)
 ;;11^30^NOVEMBER
"RTN","GMRCCY",144,0)
 ;;12^31^DECEMBER
"RTN","GMRCCY",145,0)
 ;;^
"RTN","GMRCCY",146,0)
 ;
"RTN","GMRCCY",147,0)
QUART(GMWHEN,GMDFLT,GMTBEG,GMTEND) ; *** Quarterly & Semi-Annually
"RTN","GMRCCY",148,0)
 N %DT,GM,GMDATA,GMDONE,GMMNDY,GMQU,GMQUIT,GMQUYR,GMSBEG,GMSEMI,GMYR,GMQART
"RTN","GMRCCY",149,0)
 N GMQBEG,GMQEND,GMQQUA,X,Y
"RTN","GMRCCY",150,0)
 S GMSEMI=$S(GMWHEN="S":1,1:0)
"RTN","GMRCCY",151,0)
 F GM=1:1 S GMDATA=$P($T(QUARTDAT+GM),";;",2) Q:GMDATA=U  D
"RTN","GMRCCY",152,0)
 . S GMQQUA(GM)=$P(GMDATA,U)
"RTN","GMRCCY",153,0)
 . S GMQBEG(GM)="000"_$P(GMDATA,U,2)
"RTN","GMRCCY",154,0)
 . S GMSBEG(GM)="000"_$P(GMDATA,U,3)
"RTN","GMRCCY",155,0)
 . S GMQEND(GM)="000"_$P(GMDATA,U,4)
"RTN","GMRCCY",156,0)
 . Q
"RTN","GMRCCY",157,0)
 S GMQUYR=""
"RTN","GMRCCY",158,0)
 I $P(GMDFLT,U,2)]"" D
"RTN","GMRCCY",159,0)
 . S GMMNDY=$E($P(GMDFLT,U,2),4,7)
"RTN","GMRCCY",160,0)
 . I (GMMNDY'<GMQBEG(1))&(GMMNDY'>GMQEND(1)) S GMQU=1
"RTN","GMRCCY",161,0)
 . I (GMMNDY'<GMQBEG(2))&(GMMNDY'>GMQEND(2)) S GMQU=2
"RTN","GMRCCY",162,0)
 . I (GMMNDY'<GMQBEG(3))&(GMMNDY'>GMQEND(3)) S GMQU=3
"RTN","GMRCCY",163,0)
 . I (GMMNDY'<GMQBEG(4))&(GMMNDY'>GMQEND(4)) S GMQU=4
"RTN","GMRCCY",164,0)
 . S GMQUYR=$S(GMQU>0:GMQU_"/"_(1700+$E($P(GMDFLT,U,2),1,3)+(GMQU=1)),1:"")
"RTN","GMRCCY",165,0)
 . Q
"RTN","GMRCCY",166,0)
 S (GMQUIT,GMDONE)=0
"RTN","GMRCCY",167,0)
 F  D  Q:(GMQUIT>0)!(GMDONE>0)
"RTN","GMRCCY",168,0)
 . I GMSEMI>0 D
"RTN","GMRCCY",169,0)
 .. W !!,"Enter Quarter Period and FY you "
"RTN","GMRCCY",170,0)
 .. W "wish Semi-Annual range to end with"
"RTN","GMRCCY",171,0)
 .. Q
"RTN","GMRCCY",172,0)
 . W !
"RTN","GMRCCY",173,0)
 . W !,"Enter Quarter and Year: ",$S(GMQUYR]"":GMQUYR_"// ",1:"")
"RTN","GMRCCY",174,0)
 . R GMQART:DTIME S:'$T GMQART=U
"RTN","GMRCCY",175,0)
 . I GMQART="" S GMQART=GMQUYR
"RTN","GMRCCY",176,0)
 . I (GMQART=U)!(GMQART="") S GMQUIT=1 Q
"RTN","GMRCCY",177,0)
 . I (GMQART'?1N1P2N)&(GMQART'?1N1P4N) D  Q
"RTN","GMRCCY",178,0)
 .. D BELL(GMQART)
"RTN","GMRCCY",179,0)
 .. W !!,"Enter Quarter Period in this format: "
"RTN","GMRCCY",180,0)
 .. W "2nd quarter 1988 would be 2-88, 2/88, 2 88"
"RTN","GMRCCY",181,0)
 .. Q
"RTN","GMRCCY",182,0)
 . I ($E(GMQART)>4)!($E(GMQART)<1) D  Q
"RTN","GMRCCY",183,0)
 .. D BELL("")
"RTN","GMRCCY",184,0)
 .. W !!,"Enter Quarter 1 to 4 only"
"RTN","GMRCCY",185,0)
 .. Q
"RTN","GMRCCY",186,0)
 . S GMQU=$E(GMQART)
"RTN","GMRCCY",187,0)
 . S GMYR=$E(GMQART,3,6)
"RTN","GMRCCY",188,0)
 . K %DT S X=GMYR D ^%DT S GMYR=$E(Y,1,3)
"RTN","GMRCCY",189,0)
 . F GM=1:1:4 D
"RTN","GMRCCY",190,0)
 .. S GMQBEG(GM)=$S(GM=1:GMYR-1,1:GMYR)_$E(GMQBEG(GM),4,7)
"RTN","GMRCCY",191,0)
 .. S GMSBEG(GM)=$S(GM'>2:GMYR-1,1:GMYR)_$E(GMSBEG(GM),4,7)
"RTN","GMRCCY",192,0)
 .. S GMQEND(GM)=$S(GM=1:GMYR-1,1:GMYR)_$E(GMQEND(GM),4,7)
"RTN","GMRCCY",193,0)
 .. Q
"RTN","GMRCCY",194,0)
 . S GMTEND=GMQEND(GMQU)
"RTN","GMRCCY",195,0)
 . S GMTBEG=$S(GMSEMI:GMSBEG(GMQU),1:GMQBEG(GMQU))
"RTN","GMRCCY",196,0)
 . S GMDONE=1
"RTN","GMRCCY",197,0)
 . Q
"RTN","GMRCCY",198,0)
 Q GMQUIT
"RTN","GMRCCY",199,0)
 ;
"RTN","GMRCCY",200,0)
QUARTDAT ;;Name ^ QuarterStart ^ SemiStart ^ QuarterEnd
"RTN","GMRCCY",201,0)
 ;;FIRST^1001^0701^1231
"RTN","GMRCCY",202,0)
 ;;SECOND^0101^1001^0331
"RTN","GMRCCY",203,0)
 ;;THIRD^0401^0101^0630
"RTN","GMRCCY",204,0)
 ;;FOURTH^0701^0401^0930
"RTN","GMRCCY",205,0)
 ;;^
"RTN","GMRCCY",206,0)
 ;
"RTN","GMRCCY",207,0)
YEAR(GMWHEN,GMDFLT,GMTBEG,GMTEND) ; *** Yearly & Fiscal Yearly
"RTN","GMRCCY",208,0)
 N %DT,GMDONE,GMFY,GMQUIT,GMYEAR,GMYR,X,Y
"RTN","GMRCCY",209,0)
 S GMFY=$S(GMWHEN="F":1,1:0)
"RTN","GMRCCY",210,0)
 S (GMQUIT,GMDONE)=0
"RTN","GMRCCY",211,0)
 F  D  Q:(GMQUIT>0)!(GMDONE>0)
"RTN","GMRCCY",212,0)
 . W !!,"Enter ",$S(GMFY:"FISCAL ",1:""),"YEAR: "
"RTN","GMRCCY",213,0)
 . S GMYEAR=$S($P(GMDFLT,U,2)]"":1700+$E($P(GMDFLT,U,2),1,3),1:"")
"RTN","GMRCCY",214,0)
 . W $S(GMYEAR]"":GMYEAR_"// ",1:"")
"RTN","GMRCCY",215,0)
 . R GMYR:DTIME S:'$T GMYR=U
"RTN","GMRCCY",216,0)
 . I GMYR="" S GMYR=GMYEAR
"RTN","GMRCCY",217,0)
 . I (GMYR=U)!(GMYR="") S GMQUIT=1 Q
"RTN","GMRCCY",218,0)
 . I (GMYR'?2N)&(GMYR'?4N) D  Q
"RTN","GMRCCY",219,0)
 .. D BELL(GMYR)
"RTN","GMRCCY",220,0)
 .. W !!,"Enter a 2 or 4 digit ",$S(GMFY:"fiscal ",1:""),"year"
"RTN","GMRCCY",221,0)
 .. Q
"RTN","GMRCCY",222,0)
 . K %DT S X=GMYR D ^%DT S GMYR=$E(Y,1,3)
"RTN","GMRCCY",223,0)
 . I GMFY D
"RTN","GMRCCY",224,0)
 .. S GMTBEG=GMYR-1_"1001"
"RTN","GMRCCY",225,0)
 .. S GMTEND=GMYR_"0930"
"RTN","GMRCCY",226,0)
 .. Q
"RTN","GMRCCY",227,0)
 . E  D
"RTN","GMRCCY",228,0)
 .. S GMTBEG=GMYR_"0101"
"RTN","GMRCCY",229,0)
 .. S GMTEND=GMYR_"1231"
"RTN","GMRCCY",230,0)
 .. Q
"RTN","GMRCCY",231,0)
 . S GMDONE=1
"RTN","GMRCCY",232,0)
 . Q
"RTN","GMRCCY",233,0)
 Q GMQUIT
"RTN","GMRCCY",234,0)
 ;
"RTN","GMRCCY",235,0)
USERSEL(GMWHEN,GMDFLT,GMTBEG,GMTEND) ; *** User Selectable
"RTN","GMRCCY",236,0)
 N %DT,GMBEG,GMEND,GMQUIT,X,Y
"RTN","GMRCCY",237,0)
 S GMQUIT=0
"RTN","GMRCCY",238,0)
 W !!,"Enter beginning and ending dates for the desired time period:",!
"RTN","GMRCCY",239,0)
 K %DT
"RTN","GMRCCY",240,0)
 S %DT="AEX"
"RTN","GMRCCY",241,0)
 S %DT("A")="Beginning Date: "
"RTN","GMRCCY",242,0)
 I $P(GMDFLT,U,2)]"" S %DT("B")=$$FMTE^XLFDT($P(GMDFLT,U,2),"5Z")
"RTN","GMRCCY",243,0)
 D ^%DT S GMBEG=+$G(Y)
"RTN","GMRCCY",244,0)
 I GMBEG>0 D
"RTN","GMRCCY",245,0)
 . K %DT
"RTN","GMRCCY",246,0)
 . S %DT="AEX"
"RTN","GMRCCY",247,0)
 . S %DT(0)=GMBEG
"RTN","GMRCCY",248,0)
 . S %DT("A")="Ending Date:    "
"RTN","GMRCCY",249,0)
 . I $P(GMDFLT,U,3)]"",$P(GMDFLT,U,3)'<GMBEG D
"RTN","GMRCCY",250,0)
 .. S %DT("B")=$$FMTE^XLFDT($P(GMDFLT,U,3),"5Z")
"RTN","GMRCCY",251,0)
 .. Q
"RTN","GMRCCY",252,0)
 . E  D
"RTN","GMRCCY",253,0)
 .. S %DT("B")=$$FMTE^XLFDT(GMBEG,"5Z")
"RTN","GMRCCY",254,0)
 .. Q
"RTN","GMRCCY",255,0)
 . D ^%DT S GMEND=+$G(Y)
"RTN","GMRCCY",256,0)
 . I GMEND>0 D
"RTN","GMRCCY",257,0)
 .. S GMTBEG=GMBEG
"RTN","GMRCCY",258,0)
 .. S GMTEND=GMEND
"RTN","GMRCCY",259,0)
 .. Q
"RTN","GMRCCY",260,0)
 . E  D
"RTN","GMRCCY",261,0)
 .. S GMQUIT=1
"RTN","GMRCCY",262,0)
 .. Q
"RTN","GMRCCY",263,0)
 . Q
"RTN","GMRCCY",264,0)
 E  D
"RTN","GMRCCY",265,0)
 . S GMQUIT=1
"RTN","GMRCCY",266,0)
 . Q
"RTN","GMRCCY",267,0)
 Q GMQUIT
"RTN","GMRCCY",268,0)
 ;
"RTN","GMRCCY",269,0)
BELL(X) ; *** Write ?? <Beep>
"RTN","GMRCCY",270,0)
 I $E(X)'="?" W " ??",$C(7)
"RTN","GMRCCY",271,0)
 Q
"RTN","GMRCCY",272,0)
 ;
"RTN","GMRCCY",273,0)
LASTMNTH(GMDATE,GMTBEG,GMTEND) ; *** Compute last month date range
"RTN","GMRCCY",274,0)
 N GMMN,GMYR
"RTN","GMRCCY",275,0)
 S GMYR=1700+$E(GMDATE,1,3)
"RTN","GMRCCY",276,0)
 S GMMN=$E(GMDATE,4,5)
"RTN","GMRCCY",277,0)
 I (GMMN'<1)&(GMMN'>12) D
"RTN","GMRCCY",278,0)
 . S GMMN=GMMN-1
"RTN","GMRCCY",279,0)
 . I GMMN=0 S GMMN=12,GMYR=GMYR-1
"RTN","GMRCCY",280,0)
 . I $L(GMMN)=1 S GMMN="0"_GMMN
"RTN","GMRCCY",281,0)
 . S GMTBEG=(GMYR-1700)_GMMN_"01"
"RTN","GMRCCY",282,0)
 . S GMTEND=$$SCH^XLFDT("1M(1)",GMTBEG)\1
"RTN","GMRCCY",283,0)
 . Q
"RTN","GMRCCY",284,0)
 E  D
"RTN","GMRCCY",285,0)
 . S (GMTBEG,GMTEND)=""
"RTN","GMRCCY",286,0)
 . Q
"RTN","GMRCCY",287,0)
 Q
"RTN","GMRCP5D")
0^9^B75434506^B71343010
"RTN","GMRCP5D",1,0)
GMRCP5D ;SLC/DCM,RJS,JFR,WAT,DEH - Print Consult form 513 (Gather Data - Addendums, Headers, Service reports and Comments) ;01/20/17 15:19
"RTN","GMRCP5D",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15,22,29,35,38,61,65,66,82,89**;Dec 27, 1997;Build 62
"RTN","GMRCP5D",3,0)
 ;Waiver #301965 submitted 2014.02.02,pending as of 2015.05.05/JDT
"RTN","GMRCP5D",4,0)
 ; MILW/RH/JDT 9/09 HDR+26,+27 concantenated age to DOB
"RTN","GMRCP5D",5,0)
 ; MILW/JDT HDR+41 add cell phone to header
"RTN","GMRCP5D",6,0)
 ; WLE added Cell phone and age to SF513
"RTN","GMRCP5D",7,0)
 ;This routine invokes the following ICR(s):
"RTN","GMRCP5D",8,0)
 ;2056 $$GET1^DIQ, 2541 $$KSP^XUPARAM, 10103 $$FMTE^XLFDT, 10104 $$UP^XLFSTR, 10061 VADPT API
"RTN","GMRCP5D",9,0)
 ;10040 ^SC(, 4156 $$CVEDT^DGCV
"RTN","GMRCP5D",10,0)
 ;
"RTN","GMRCP5D",11,0)
FORMAT(GMRCIFN,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",12,0)
 ;
"RTN","GMRCP5D",13,0)
 I $L($P(GMRCRD,U,15)) D
"RTN","GMRCP5D",14,0)
 .I $O(^TMP("GMRCR",$J,"MCAR",0)) D
"RTN","GMRCP5D",15,0)
 ..N GMRCSVC
"RTN","GMRCP5D",16,0)
 ..S GMRCSVC=$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1)
"RTN","GMRCP5D",17,0)
 ..S:$L(GMRCSVC) GMRCSVC=GMRCSVC_" "
"RTN","GMRCP5D",18,0)
 ..;
"RTN","GMRCP5D",19,0)
 ..; Medicine Results?
"RTN","GMRCP5D",20,0)
 ..S GMRCR0=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",21,0)
 ...D SUB("H","SREP",GMRCR0,$$CENTER(GMRCSVC_"Service Report #"_GMRCR0_" continued."))
"RTN","GMRCP5D",22,0)
 ...D SUB("H","SREP",GMRCR0," ")
"RTN","GMRCP5D",23,0)
 ...D BLD("SREP",GMRCR0,1,0,$$CENTER("Medicine Package Report"))
"RTN","GMRCP5D",24,0)
 ...D BLD("SREP",GMRCR0,1,0,"")
"RTN","GMRCP5D",25,0)
 ...N LN
"RTN","GMRCP5D",26,0)
 ...S LN=0 F  S LN=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN)) Q:'LN  D
"RTN","GMRCP5D",27,0)
 ....D BLD("SREP",GMRCR0,1,0,$G(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN,0)))
"RTN","GMRCP5D",28,0)
 ;
"RTN","GMRCP5D",29,0)
 ; Build Processing Activities
"RTN","GMRCP5D",30,0)
 S GMRCR0=0 F  S GMRCR0=$O(^GMR(123,GMRCIFN,40,GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",31,0)
 .N GMRCR1,GMRC400,CMT,USER,GMRCDT,RPRV,GMRC402,GMRCISIT
"RTN","GMRCP5D",32,0)
 .S GMRCR1=+$O(^GMR(123,GMRCIFN,40,GMRCR0,0)) Q:GMRCR1'=1
"RTN","GMRCP5D",33,0)
 .S GMRC400=$G(^GMR(123,GMRCIFN,40,GMRCR0,0))
"RTN","GMRCP5D",34,0)
 .S GMRC402=$G(^GMR(123,GMRCIFN,40,GMRCR0,2))
"RTN","GMRCP5D",35,0)
 .S CMT=$$PRCMT^GMRCP5B(+$P(GMRC400,U,2)) Q:'$L(CMT)
"RTN","GMRCP5D",36,0)
 .S GMRCDT=$P(GMRC400,U,3) S:'GMRCDT GMRCDT=$P(GMRC400,U,1)
"RTN","GMRCP5D",37,0)
 .S GMRCDT=$$EXDT(GMRCDT)_" "_$P(GMRC402,U,3)
"RTN","GMRCP5D",38,0)
 .;Following lines modified in patch *38
"RTN","GMRCP5D",39,0)
 .;I $P(^GMR(123,GMRCIFN,0),U,23) D  ;commented out
"RTN","GMRCP5D",40,0)
 .;.S GMRCISIT=$$GET1^DIQ(4,$P(^GMR(123,GMRCIFN,0),U,23),.01)  ;commented out
"RTN","GMRCP5D",41,0)
 .;.S GMRCISIT="Entered at: "_GMRCISIT  ;commented out
"RTN","GMRCP5D",42,0)
 .I $L(GMRC402) D  ;ADDED
"RTN","GMRCP5D",43,0)
 ..S GMRCISIT=$$GET1^DIQ(123,GMRCIFN,.07)  ;ADDED
"RTN","GMRCP5D",44,0)
 .I '$D(GMRCISIT) D  ;ADDED
"RTN","GMRCP5D",45,0)
 ..S GMRCISIT=$$KSP^XUPARAM("INST")  ;ADDED
"RTN","GMRCP5D",46,0)
 ..I GMRCISIT'="" S GMRCISIT=$$GET1^DIQ(4,GMRCISIT,.01)  ;ADDED
"RTN","GMRCP5D",47,0)
 ..I GMRCISIT="" S GMRCISIT=$$GET1^DIQ(123,GMRCIFN,.05)  ;ADDED
"RTN","GMRCP5D",48,0)
 .S GMRCISIT="Entered at: "_GMRCISIT  ;ADDED
"RTN","GMRCP5D",49,0)
 .;End of modifications for patch *38
"RTN","GMRCP5D",50,0)
 .S RPRV=$$GET1^DIQ(200,+$P(GMRC400,U,4),.01)
"RTN","GMRCP5D",51,0)
 .I '$L(RPRV) S RPRV=$P(GMRC402,U,2)
"RTN","GMRCP5D",52,0)
 .S:($L(RPRV)) RPRV="Responsible Person: "_RPRV
"RTN","GMRCP5D",53,0)
 .S USER=$$GET1^DIQ(200,+$P(GMRC400,U,5),.01)
"RTN","GMRCP5D",54,0)
 .I '$L(USER) S USER=$P(GMRC402,U)
"RTN","GMRCP5D",55,0)
 .S USER="Entered by: "_USER_" - "_GMRCDT
"RTN","GMRCP5D",56,0)
 .D SUB("H","COM",GMRCR0,CMT_" Comment ("_USER_") continued.")
"RTN","GMRCP5D",57,0)
 .D SUB("H","COM",GMRCR0," ")
"RTN","GMRCP5D",58,0)
 .D BLD("COM",GMRCR0,1,0,"")
"RTN","GMRCP5D",59,0)
 .D BLD("COM",GMRCR0,1,0,$$CENTER("("_CMT_" Comment)"))
"RTN","GMRCP5D",60,0)
 .I $P(GMRC400,U,2)=17!($P(GMRC400,U,2)=25) D
"RTN","GMRCP5D",61,0)
 .. N FWDLN,FWDRS
"RTN","GMRCP5D",62,0)
 .. S FWDLN="Forwarded from: "
"RTN","GMRCP5D",63,0)
 .. S FWDRS=$P($G(^GMR(123,GMRCIFN,40,GMRCR0,3)),U)
"RTN","GMRCP5D",64,0)
 .. I $L(FWDRS) S FWDLN=FWDLN_FWDRS
"RTN","GMRCP5D",65,0)
 .. I '$L(FWDRS) S FWDLN=FWDLN_$$GET1^DIQ(123.5,+$P(GMRC400,U,6),.01)
"RTN","GMRCP5D",66,0)
 .. D BLD("COM",GMRCR0,1,5,FWDLN)
"RTN","GMRCP5D",67,0)
 .D BLD("COM",GMRCR0,1,5,USER)
"RTN","GMRCP5D",68,0)
 .D:($L(RPRV)) BLD("COM",GMRCR0,1,5,RPRV)
"RTN","GMRCP5D",69,0)
 .D:($L($G(GMRCISIT))) BLD("COM",GMRCR0,1,5,GMRCISIT)
"RTN","GMRCP5D",70,0)
 .;
"RTN","GMRCP5D",71,0)
 .N GMRCR2 S GMRCR2=0
"RTN","GMRCP5D",72,0)
 .F  S GMRCR2=$O(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2)) Q:'GMRCR2  D
"RTN","GMRCP5D",73,0)
 ..D BLD("COM",GMRCR0,1,0,$G(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2,0)))
"RTN","GMRCP5D",74,0)
 ;
"RTN","GMRCP5D",75,0)
 Q
"RTN","GMRCP5D",76,0)
 ;
"RTN","GMRCP5D",77,0)
ADDEND(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",78,0)
 ;
"RTN","GMRCP5D",79,0)
 N GMRCADD,GMRCNDX,GMRCR1,GMRCV,TEXT,GMRCX
"RTN","GMRCP5D",80,0)
 ;
"RTN","GMRCP5D",81,0)
 S GMRCADD=0 F  S GMRCADD=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD)) Q:'GMRCADD  D
"RTN","GMRCP5D",82,0)
 .N GMRCSGNM,GMRCNMDT,GMRCTIT,GMRCMODE,GMRCCSDT,GMRCCTIT,GMRCCSGM
"RTN","GMRCP5D",83,0)
 .;
"RTN","GMRCP5D",84,0)
 .F GMRCV="GMRCSGNM","GMRCNMDT","GMRCTIT","GMRCMODE" D
"RTN","GMRCP5D",85,0)
 ..S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",86,0)
 .;
"RTN","GMRCP5D",87,0)
 . F GMRCV="GMRCCSDT","GMRCCTIT","GMRCCSGM","GMRCCSIG" D
"RTN","GMRCP5D",88,0)
 .. S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",89,0)
 .S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5D",90,0)
 .I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5D",91,0)
 .I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" continued.")
"RTN","GMRCP5D",92,0)
 .D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5D",93,0)
 .I $L($G(GMRCSGNM)) D
"RTN","GMRCP5D",94,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",95,0)
 ..I (GMRCMODE="electronic") S GMRCX=" Addendum Signature: "_GMRCSGNM_" /es/ "_$$EXDT($G(GMRCNMDT))
"RTN","GMRCP5D",96,0)
 ..I '(GMRCMODE="electronic") S GMRCX=" Addendum Author: "_GMRCSGNM S:$L($G(GMRCNMDT)) GMRCX=GMRCX_" Last edited: "_$$EXDT(GMRCNMDT)
"RTN","GMRCP5D",97,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",98,0)
 ..D:$L($G(GMRCTIT)) SUB("F","RES",GMRCNDX,"                     "_GMRCTIT)
"RTN","GMRCP5D",99,0)
 .I $L($G(GMRCCSDT)) D
"RTN","GMRCP5D",100,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",101,0)
 ..I (GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",102,0)
 ..I '(GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /chart/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",103,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",104,0)
 ..D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                       "_GMRCCTIT)
"RTN","GMRCP5D",105,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",106,0)
 .I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5D",107,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0))
"RTN","GMRCP5D",108,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",109,0)
 .S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5D",110,0)
 ..D BLD("RES",GMRCNDX,1,0,$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1,0)))
"RTN","GMRCP5D",111,0)
 Q
"RTN","GMRCP5D",112,0)
 ;
"RTN","GMRCP5D",113,0)
HDR ; Header code for form 513
"RTN","GMRCP5D",114,0)
 ;GMRCPEL   ext fmt Primary Eligibiity Code
"RTN","GMRCP5D",115,0)
 ;GMRCELIG  ext fmt of Patient Type defined @ FORMAT^GMRCP5A
"RTN","GMRCP5D",116,0)
 ;CVELIG    marker to indicate if pt has active preference for Combat Veteran Eligibility status
"RTN","GMRCP5D",117,0)
 ;get and format eligibility info
"RTN","GMRCP5D",118,0)
 N VAEL,VAPA,GMRCPEL,SUB,GMRCFROM
"RTN","GMRCP5D",119,0)
 N CVELIG ;WAT
"RTN","GMRCP5D",120,0)
 D ELIG^VADPT
"RTN","GMRCP5D",121,0)
 D ADD^VADPT
"RTN","GMRCP5D",122,0)
 N VASV,OEFOIF D SVC^VADPT S:(VASV(11)>0)!(VASV(12)>0)!(VASV(13)>0) OEFOIF="OEF/OIF" ;WAT 66
"RTN","GMRCP5D",123,0)
 S GMRCPEL=$P(VAEL(1),U,2)
"RTN","GMRCP5D",124,0)
 I $L($G(GMRCELIG))  D
"RTN","GMRCP5D",125,0)
 .;if TYPE is Active Duty and VETERAN Y/N? is No, then call the pt Active Duty
"RTN","GMRCP5D",126,0)
 .S:$P(VAEL(6),U,1)=5&(VAEL(4)=0) GMRCELIG=$P(VAEL(6),U,2)
"RTN","GMRCP5D",127,0)
 F SUB=0,1 D
"RTN","GMRCP5D",128,0)
 .N GMRCFLN
"RTN","GMRCP5D",129,0)
 .S GMRCFLN=$P($G(^DPT(GMRCDFN,0)),U,1)
"RTN","GMRCP5D",130,0)
 .S CVELIG=$$CVEDT^DGCV(GMRCDFN) S:$P($G(CVELIG),U,3) CVELIG="CV ELIGIBLE" ;WAT
"RTN","GMRCP5D",131,0)
 .D BLD("HDR",SUB,1,0,GMRCDVL)
"RTN","GMRCP5D",132,0)
 .D BLD("HDR",SUB,1,6,"MEDICAL RECORD")
"RTN","GMRCP5D",133,0)
 .D BLD("HDR",SUB,0,39,"|")
"RTN","GMRCP5D",134,0)
 .D BLD("HDR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5D",135,0)
 .D BLD("HDR",SUB,1,0,GMRCDVL)
"RTN","GMRCP5D",136,0)
 .D BLD("HDR",SUB,1,0,GMRCFLN)
"RTN","GMRCP5D",137,0)
 .D BLD("HDR",SUB,0,45,GMRCPEL)
"RTN","GMRCP5D",138,0)
 .D BLD("HDR",SUB,1,0,"XXX-XX-"_$P(GMRCSN,"-",3))
"RTN","GMRCP5D",139,0)
 .D BLD("HDR",SUB,0,16,$$EXDT(GMRCDOB)_" (Age: "_GMRCAGE_")") ;89 add age
"RTN","GMRCP5D",140,0)
 .D BLD("HDR",SUB,0,45,GMRCELIG)
"RTN","GMRCP5D",141,0)
 .D:$G(CVELIG)["CV" BLD("HDR",SUB,1,45,CVELIG)
"RTN","GMRCP5D",142,0)
 .D:$G(OEFOIF)="OEF/OIF" BLD("HDR",SUB,1,45,OEFOIF) ;WAT 66
"RTN","GMRCP5D",143,0)
 ;
"RTN","GMRCP5D",144,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5D",145,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX))
"RTN","GMRCP5D",146,0)
 .D BLD("HDR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5D",147,0)
 .;I GMRCX=1 D BLD("HDR",0,0,51,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5D",148,0)
 ;
"RTN","GMRCP5D",149,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5D",150,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5D",151,0)
 ;
"RTN","GMRCP5D",152,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_" Phone: "_VAPA(8) ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5D",153,0)
 I $L($P($G(^DPT(GMRCDFN,.13)),U,4)) S GMRCX=GMRCX_" Cell: "_$P($G(^DPT(GMRCDFN,.13)),U,4) ;89 add cell phone.
"RTN","GMRCP5D",154,0)
 ;
"RTN","GMRCP5D",155,0)
 D BLD("HDR",0,1,0,GMRCX)
"RTN","GMRCP5D",156,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",157,0)
 D BLD("HDR",0,1,0,"Consult Request: "_$$CONSRQ(GMRCIFN))
"RTN","GMRCP5D",158,0)
 D BLD("HDR",0,1,55,"|Consult No.: "_GMRCIFN)
"RTN","GMRCP5D",159,0)
 ;
"RTN","GMRCP5D",160,0)
 D BLD("HDR",1,1,0,GMRCEQL)
"RTN","GMRCP5D",161,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",162,0)
 ;
"RTN","GMRCP5D",163,0)
 I $G(CMT) D BLD("HDR",0,1,27,"("_$$PRCMT^GMRCP5B(CMT)_")") Q
"RTN","GMRCP5D",164,0)
 ;
"RTN","GMRCP5D",165,0)
 S GMRCFROM=$P($G(^SC(+$P(GMRCRD,U,6),0)),U,1)
"RTN","GMRCP5D",166,0)
 ;
"RTN","GMRCP5D",167,0)
 I '$L(GMRCFROM) D
"RTN","GMRCP5D",168,0)
 .N VAIN
"RTN","GMRCP5D",169,0)
 .D INP^VADPT
"RTN","GMRCP5D",170,0)
 .S GMRCFROM=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5D",171,0)
 .I $L($G(VAIN(5))) S GMRCFROM=GMRCFROM_" (Rm/Bd: "_$G(VAIN(5))_" )"
"RTN","GMRCP5D",172,0)
 ;No location, IFC - consulting site
"RTN","GMRCP5D",173,0)
 I '$L(GMRCFROM),$P(GMRCRD,U,23),$P($G(GMRCRD(12)),U,5)="F" D
"RTN","GMRCP5D",174,0)
 .I $P(GMRCRD,U,21) S GMRCFROM=$$GET1^DIQ(4,$P(GMRCRD,U,21),.01)
"RTN","GMRCP5D",175,0)
 .E  S GMRCFROM=$$GET1^DIQ(4,$P(GMRCRD,U,23),.01)
"RTN","GMRCP5D",176,0)
 ;
"RTN","GMRCP5D",177,0)
 D BLD("HDR",0,1,0,"To: "_$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",178,0)
 D BLD("HDR",0,1,5,"From: "_GMRCFROM)
"RTN","GMRCP5D",179,0)
 D BLD("HDR",0,0,49,"|Requested: "_$$EXDT($P(GMRCRD,U,7)))
"RTN","GMRCP5D",180,0)
 ;
"RTN","GMRCP5D",181,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",182,0)
 D BLD("HDR",0,1,0,"Requesting Facility: "_$E(GMRCFAC,1,22))
"RTN","GMRCP5D",183,0)
 I $P(GMRCRD,U,11) D BLD("HDR",0,0,45,"|ATTENTION: "_$E($$GET1^DIQ(200,+$P(GMRCRD,U,11),.01),1,21))
"RTN","GMRCP5D",184,0)
 I $P(GMRCRD,U,23) D
"RTN","GMRCP5D",185,0)
 . D BLD("HDR",0,1,0,"Remote Consult No.: "_GMRCINO)
"RTN","GMRCP5D",186,0)
 . D BLD("HDR",0,1,0,"Role: "_GMRCIRL)
"RTN","GMRCP5D",187,0)
 D BLD("HDR",0,1,0,GMRCEQL)
"RTN","GMRCP5D",188,0)
 ;
"RTN","GMRCP5D",189,0)
 D KVAR^VADPT ;WAT 66
"RTN","GMRCP5D",190,0)
 Q
"RTN","GMRCP5D",191,0)
 ;
"RTN","GMRCP5D",192,0)
CENTER(X) ;
"RTN","GMRCP5D",193,0)
 ;
"RTN","GMRCP5D",194,0)
 N TEXT,COL
"RTN","GMRCP5D",195,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5D",196,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5D",197,0)
 Q TEXT
"RTN","GMRCP5D",198,0)
 ;
"RTN","GMRCP5D",199,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5D",200,0)
 ;
"RTN","GMRCP5D",201,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5D",202,0)
 N LINECNT
"RTN","GMRCP5D",203,0)
 ;
"RTN","GMRCP5D",204,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5D",205,0)
 ;
"RTN","GMRCP5D",206,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5D",207,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5D",208,0)
 ;
"RTN","GMRCP5D",209,0)
 S GMRCLAST=SUB
"RTN","GMRCP5D",210,0)
 Q
"RTN","GMRCP5D",211,0)
 ;
"RTN","GMRCP5D",212,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5D",213,0)
 ;
"RTN","GMRCP5D",214,0)
 N NEXT
"RTN","GMRCP5D",215,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5D",216,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5D",217,0)
 Q
"RTN","GMRCP5D",218,0)
 ;
"RTN","GMRCP5D",219,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5D",220,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5D",221,0)
 ;
"RTN","GMRCP5D",222,0)
CONSRQ(IFN) ;
"RTN","GMRCP5D",223,0)
 ;
"RTN","GMRCP5D",224,0)
 N PTR,LINK,REF,GMRCRQ
"RTN","GMRCP5D",225,0)
 I +$P(^GMR(123,+IFN,0),U,8) D
"RTN","GMRCP5D",226,0)
 . S GMRCRQ=$P(^GMR(123,+IFN,0),U,8)
"RTN","GMRCP5D",227,0)
 . S GMRCRQ=$$GET1^DIQ(123.3,+GMRCRQ,.01)
"RTN","GMRCP5D",228,0)
 . I '$L(GMRCRQ) S GMRCRQ="Procedure"
"RTN","GMRCP5D",229,0)
 I $L($G(GMRCRQ)) Q GMRCRQ
"RTN","GMRCP5D",230,0)
 I $L($G(^GMR(123,IFN,1.11))) D
"RTN","GMRCP5D",231,0)
 . N SERV,TYPE
"RTN","GMRCP5D",232,0)
 . S SERV=$$UP^XLFSTR($$GET1^DIQ(123.5,$P(^GMR(123,IFN,0),U,5),.01))
"RTN","GMRCP5D",233,0)
 . S TYPE=$$UP^XLFSTR(^GMR(123,IFN,1.11)) I TYPE'=SERV D
"RTN","GMRCP5D",234,0)
 . I TYPE'=SERV S GMRCRQ=$E(^GMR(123,IFN,1.11),1,36)
"RTN","GMRCP5D",235,0)
 Q:$L($G(GMRCRQ)) GMRCRQ Q "Consult"
"RTN","GMRCP5D",236,0)
 ;
"RTN","GMRCP5D",237,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5D",238,0)
 ;
"RTN","GMRCP5D",239,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5D",240,0)
 Q:'$L(X) ""
"RTN","GMRCP5D",241,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5D",242,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5D",243,0)
 ;
"RTN","GMRCUTL1")
0^8^B14006176^B13626178
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM,JFR,MA - General Utilities ;04/27/2017  15:23
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15,21,17,28,89**;DEC 27, 1997;Build 62
"RTN","GMRCUTL1",3,0)
 ; Added call to GMRCUTL2 for secondary printer
"RTN","GMRCUTL1",4,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCUTL1",5,0)
 ; Patch #21 added variable GMRCAUDT and moved line tag PRNTAUDT
"RTN","GMRCUTL1",6,0)
 ; to GMRCP5A.
"RTN","GMRCUTL1",7,0)
 ;
"RTN","GMRCUTL1",8,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",9,0)
 K GMRCQUT
"RTN","GMRCUTL1",10,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",11,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",12,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",13,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",14,0)
 Q
"RTN","GMRCUTL1",15,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",16,0)
 D PRNT^GMRCUTL2(SRVCIFN,GMRCO)  ;89 call for secondary copy
"RTN","GMRCUTL1",17,0)
 N ORVP,GMRCDEV,GMRCQUED,IOP,%ZIS,POP,ZTDTH,ZTDESC,ZTIO,ZTRTN,ZTSK,GMRCAUDT
"RTN","GMRCUTL1",18,0)
 I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL1",19,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",20,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",21,0)
 S %ZIS="N" D ^%ZIS I POP S %ZIS=0 D HOME^%ZIS Q
"RTN","GMRCUTL1",22,0)
 S GMRCDEV=ION,GMRCQUED=1,GMRCAUDT=1
"RTN","GMRCUTL1",23,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0,"_(GMRCAUDT)_")"
"RTN","GMRCUTL1",24,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL1",25,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL1",26,0)
 D ^%ZTLOAD
"RTN","GMRCUTL1",27,0)
 S %ZIS=0 D HOME^%ZIS
"RTN","GMRCUTL1",28,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",29,0)
 Q
"RTN","GMRCUTL1",30,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",31,0)
 Q
"RTN","GMRCUTL1",32,0)
PROVDX(OI) ;return PROV DX prompting info from 123.5
"RTN","GMRCUTL1",33,0)
 ;    Input:
"RTN","GMRCUTL1",34,0)
 ;       OI = ref to file 123.5("#;99CON") or file 123.3 (#;99PRC)
"RTN","GMRCUTL1",35,0)
 ;
"RTN","GMRCUTL1",36,0)
 ;    Returns:  string  A^B
"RTN","GMRCUTL1",37,0)
 ;       A = O (optional), R (required) or S (suppress)
"RTN","GMRCUTL1",38,0)
 ;       B = F (free-text) or L (lexicon)
"RTN","GMRCUTL1",39,0)
 ;
"RTN","GMRCUTL1",40,0)
 N GMRCFIL
"RTN","GMRCUTL1",41,0)
 Q:'+$G(OI) "^"
"RTN","GMRCUTL1",42,0)
 S GMRCFIL=$S(OI["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",43,0)
 Q:'$D(^GMR(GMRCFIL,+OI)) "^"
"RTN","GMRCUTL1",44,0)
 N STRING,NODE
"RTN","GMRCUTL1",45,0)
 I GMRCFIL=123.3 S NODE=$P(^GMR(123.3,+OI,0),U,7,8)
"RTN","GMRCUTL1",46,0)
 I GMRCFIL=123.5 S NODE=$P($G(^GMR(123.5,+OI,1)),U,1,2)
"RTN","GMRCUTL1",47,0)
 I NODE="" Q "O^F" ;values not set
"RTN","GMRCUTL1",48,0)
 S $P(STRING,U)=$S($L($P(NODE,U)):$P(NODE,U),1:"O")
"RTN","GMRCUTL1",49,0)
 S $P(STRING,U,2)=$S($L($P(NODE,U,2)):$P(NODE,U,2),1:"F")
"RTN","GMRCUTL1",50,0)
 Q STRING
"RTN","GMRCUTL1",51,0)
ORIFN(GMRC123) ;return ORIFN associated with give record in ^GMR(123,
"RTN","GMRCUTL1",52,0)
 ; GMRC123 = ien of consult record in file 123
"RTN","GMRCUTL1",53,0)
 Q $P($G(^GMR(123,GMRC123,0)),U,3)
"RTN","GMRCUTL1",54,0)
GETDT(PROMPT,DEFAULT) ;prompt and return FM date
"RTN","GMRCUTL1",55,0)
 ;Input:
"RTN","GMRCUTL1",56,0)
 ;  PROMPT  = text of prompt - DIR("A")          (optional)
"RTN","GMRCUTL1",57,0)
 ;  DEFAULT = default date to prompt - DIR("B")  (optional)
"RTN","GMRCUTL1",58,0)
 ; 
"RTN","GMRCUTL1",59,0)
 ;Output:
"RTN","GMRCUTL1",60,0)
 ; FM date/time if successfully answered, "^" if exit or timeout
"RTN","GMRCUTL1",61,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,X,Y
"RTN","GMRCUTL1",62,0)
 S DIR(0)="DA^::EPT"
"RTN","GMRCUTL1",63,0)
 S DIR("?")="Enter the date/time the activity took place."
"RTN","GMRCUTL1",64,0)
 S DIR("A")=$S($D(PROMPT):PROMPT_" ",1:"Actual Date/Time of Activity: ")
"RTN","GMRCUTL1",65,0)
 S DIR("B")=$S($D(DEFAULT):DEFAULT,1:"NOW")
"RTN","GMRCUTL1",66,0)
 D ^DIR
"RTN","GMRCUTL1",67,0)
 I $D(DUOUT)!($D(DTOUT)) S Y="^"
"RTN","GMRCUTL1",68,0)
 Q Y
"RTN","GMRCUTL1",69,0)
 ;
"RTN","GMRCUTL1",70,0)
DCPRNT(IEN,USER) ;reprint SF-513 on DC?
"RTN","GMRCUTL1",71,0)
 N SERV,REPR
"RTN","GMRCUTL1",72,0)
 S SERV=$P(^GMR(123,IEN,0),U,5) I 'SERV Q 0
"RTN","GMRCUTL1",73,0)
 S REPR=$P($G(^GMR(123.5,SERV,1)),U,5)
"RTN","GMRCUTL1",74,0)
 I 'REPR Q 1
"RTN","GMRCUTL1",75,0)
 I REPR=2 Q 0
"RTN","GMRCUTL1",76,0)
 I REPR=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCUTL1",77,0)
 Q 0
"RTN","GMRCUTL1",78,0)
 ;
"RTN","GMRCUTL1",79,0)
PREREQ(GMRCARR,GMRCSRV,GMRCDFN,UNRESOLV) ; return service pre-requisite
"RTN","GMRCUTL1",80,0)
 ; pre-requisite stored in 125 nodes in file 123.5 or 123.3
"RTN","GMRCUTL1",81,0)
 ; GMRCARR = array to return containing pre-requisite
"RTN","GMRCUTL1",82,0)
 ; GMRCSRV = ref to file 123.5 (ien;99CON) or 123.3 (ien;99PRC)
"RTN","GMRCUTL1",83,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCUTL1",84,0)
 ; UNRESOLV = 1 or 0 ; if UNRESOLV=1 GMRCARR will be returned unresolved
"RTN","GMRCUTL1",85,0)
 Q:'+GMRCSRV
"RTN","GMRCUTL1",86,0)
 N GMRCFIL
"RTN","GMRCUTL1",87,0)
 S GMRCFIL=$S(GMRCSRV["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",88,0)
 Q:'$D(^GMR(GMRCFIL,+GMRCSRV,125))
"RTN","GMRCUTL1",89,0)
 I '$D(GMRCDFN)!($G(UNRESOLV)) D  Q
"RTN","GMRCUTL1",90,0)
 . M @GMRCARR=^GMR(GMRCFIL,+GMRCSRV,125)
"RTN","GMRCUTL1",91,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(GMRCFIL,+GMRCSRV,125)))
"RTN","GMRCUTL1",92,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",93,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",94,0)
 Q
"RTN","GMRCUTL1",95,0)
 ;
"RTN","GMRCUTL1",96,0)
LOCKREC(GMRCDA) ;attempt to lock a consult record using order or record
"RTN","GMRCUTL1",97,0)
 ; Input:
"RTN","GMRCUTL1",98,0)
 ;   GMRCDA  = ien of consult record from file 123
"RTN","GMRCUTL1",99,0)
 ;
"RTN","GMRCUTL1",100,0)
 ; Output: 
"RTN","GMRCUTL1",101,0)
 ;     1 or 0^reason can't be locked  
"RTN","GMRCUTL1",102,0)
 ;          1 = successfully locked
"RTN","GMRCUTL1",103,0)
 ;          0 = couldn't be locked
"RTN","GMRCUTL1",104,0)
 N GMRCORD,GMRCMSG
"RTN","GMRCUTL1",105,0)
 S GMRCORD=$P($G(^GMR(123,GMRCDA,0)),U,3)
"RTN","GMRCUTL1",106,0)
 I $G(GMRCORD) D  ;an order associated
"RTN","GMRCUTL1",107,0)
 . S GMRCMSG=$$LOCK1^ORX2(GMRCORD)
"RTN","GMRCUTL1",108,0)
 . ; GMRCMSG=1 if locked  or 0 if couldn't be locked
"RTN","GMRCUTL1",109,0)
 I $L($G(GMRCMSG)) Q GMRCMSG
"RTN","GMRCUTL1",110,0)
 ; no order = Inter-facility Consult so lock consult record
"RTN","GMRCUTL1",111,0)
 L +^GMR(123,GMRCDA):5
"RTN","GMRCUTL1",112,0)
 I '$T Q "0^Another user is editing this record" ; couldn't lock it
"RTN","GMRCUTL1",113,0)
 Q 1
"RTN","GMRCUTL1",114,0)
 ;
"RTN","GMRCUTL1",115,0)
UNLKREC(GMRCDA) ;unlock a consult record
"RTN","GMRCUTL1",116,0)
 ; Input:
"RTN","GMRCUTL1",117,0)
 ;   GMRCDA  = ien of consult record from file 123
"RTN","GMRCUTL1",118,0)
 ;
"RTN","GMRCUTL1",119,0)
 N GMRCORD
"RTN","GMRCUTL1",120,0)
 S GMRCORD=$P($G(^GMR(123,GMRCDA,0)),U,3)
"RTN","GMRCUTL1",121,0)
 I $G(GMRCORD) D  Q
"RTN","GMRCUTL1",122,0)
 . D UNLK1^ORX2(GMRCORD)
"RTN","GMRCUTL1",123,0)
 L -^GMR(123,GMRCDA)
"RTN","GMRCUTL1",124,0)
 Q
"RTN","GMRCUTL2")
0^10^B1531525^n/a
"RTN","GMRCUTL2",1,0)
GMRCUTL2 ;SLC/DCM,JFR,MA - General Utilities ;04/27/2017  15:19
"RTN","GMRCUTL2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**89**;DEC 27, 1997;Build 62
"RTN","GMRCUTL2",3,0)
 ;Consult Closure Tool
"RTN","GMRCUTL2",4,0)
 ;
"RTN","GMRCUTL2",5,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCUTL2",6,0)
 ;
"RTN","GMRCUTL2",7,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 secondary printer 
"RTN","GMRCUTL2",8,0)
 N ORVP,GMRCDEV,GMRCQUED,IOP,%ZIS,POP,ZTDTH,ZTDESC,ZTIO,ZTRTN,ZTSK,GMRCA
"RTN","GMRCUTL2",9,0)
UDT I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL2",10,0)
 Q:'$D(^GMR(123.5,SRVCIFN,3))  Q:'$P(^GMR(123.5,SRVCIFN,3),"^")
"RTN","GMRCUTL2",11,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,3),"^")
"RTN","GMRCUTL2",12,0)
 S %ZIS="N" D ^%ZIS I POP S %ZIS=0 D HOME^%ZIS Q
"RTN","GMRCUTL2",13,0)
 S GMRCDEV=ION,GMRCQUED=1,GMRCAUDT=1
"RTN","GMRCUTL2",14,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0,"_(GMRCAUDT)_")"
"RTN","GMRCUTL2",15,0)
 S ZTDESC="PRINT SECOND COPY OF CONSULT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL2",16,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL2",17,0)
 D ^%ZTLOAD
"RTN","GMRCUTL2",18,0)
 S %ZIS=0 D HOME^%ZIS
"RTN","GMRCUTL2",19,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL2",20,0)
 Q
"SEC","^DIC",123.033,123.033,0,"AUDIT")
@
"SEC","^DIC",123.033,123.033,0,"DD")
@
"SEC","^DIC",123.033,123.033,0,"DEL")
@
"SEC","^DIC",123.033,123.033,0,"LAYGO")
@
"SEC","^DIC",123.033,123.033,0,"RD")
@
"SEC","^DIC",123.033,123.033,0,"WR")
@
"VER")
8.0^22.2
"^DD",123.033,123.033,0)
FIELD^^6000^12
"^DD",123.033,123.033,0,"DT")
3170201
"^DD",123.033,123.033,0,"IX","B",123.033,.01)

"^DD",123.033,123.033,0,"NM","GMRC CONSULT MAPPING")

"^DD",123.033,123.033,.01,0)
NAME^RFJ30^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",123.033,123.033,.01,1,0)
^.1
"^DD",123.033,123.033,.01,1,1,0)
123.033^B
"^DD",123.033,123.033,.01,1,1,1)
S ^GMR(123.033,"B",$E(X,1,30),DA)=""
"^DD",123.033,123.033,.01,1,1,2)
K ^GMR(123.033,"B",$E(X,1,30),DA)
"^DD",123.033,123.033,.01,3)
Answer must be 3-30 characters in length.
"^DD",123.033,123.033,.01,21,0)
^.001^1^1^3170201^^^
"^DD",123.033,123.033,.01,21,1,0)
Any descriptive free-text name.
"^DD",123.033,123.033,.01,"DT")
3170201
"^DD",123.033,123.033,.02,0)
INACTIVE^S^0:NO;1:YES;^0;2^Q
"^DD",123.033,123.033,.02,3)
Enter Y[es] to inactivate this configuration.
"^DD",123.033,123.033,.02,21,0)
^.001^2^2^3170201^^
"^DD",123.033,123.033,.02,21,1,0)
Inactive configurations are not selectable in the report option, but will 
"^DD",123.033,123.033,.02,21,2,0)
remain selectable in the edit option.
"^DD",123.033,123.033,.02,"DT")
3170201
"^DD",123.033,123.033,.03,0)
CPRS TEAM^*P100.21'^OR(100.21,^0;3^S DIC("S")="I $P(^(0),U,2)=""TM""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.033,.03,3)
Select a CPRS team.
"^DD",123.033,123.033,.03,12)
Only manual patient list teams are selectable.
"^DD",123.033,123.033,.03,12.1)
S DIC("S")="I $P(^(0),U,2)=""TM"""
"^DD",123.033,123.033,.03,21,0)
^.001^4^4^3170220^^^
"^DD",123.033,123.033,.03,21,1,0)
If a CPRS team is associated with the configuration, the team will be 
"^DD",123.033,123.033,.03,21,2,0)
populated with the patients identified by the report.  Any pre-existing 
"^DD",123.033,123.033,.03,21,3,0)
patients in the team will be replaced.  Only manual patient teams are
"^DD",123.033,123.033,.03,21,4,0)
selectable.
"^DD",123.033,123.033,.03,"DT")
3060511
"^DD",123.033,123.033,.04,0)
DAYS CONS->APPT^NJ4,0^^0;4^K:+X'=X!(X>1836)!(X<0)!(X?.E1"."1N.N) X
"^DD",123.033,123.033,.04,3)
Enter a number between 0 and 1836, 0 decimal digits.
"^DD",123.033,123.033,.04,21,0)
^.001^1^1^3170201^^^^
"^DD",123.033,123.033,.04,21,1,0)
The maximum number of days between the consult and the appointment.
"^DD",123.033,123.033,.04,"DT")
3170201
"^DD",123.033,123.033,.05,0)
DAYS APPT->NOTE^NJ4,0^^0;5^K:+X'=X!(X>1836)!(X<0)!(X?.E1"."1N.N) X
"^DD",123.033,123.033,.05,3)
Enter a number between 0 and 1836, 0 decimal digits.
"^DD",123.033,123.033,.05,21,0)
^.001^1^1^3170201^^^^
"^DD",123.033,123.033,.05,21,1,0)
The maximum number of days between the appointment and the note.
"^DD",123.033,123.033,.05,"DT")
3170201
"^DD",123.033,123.033,.06,0)
STOP CODE^*P40.7'O^DIC(40.7,^0;6^S DIC("S")="N % S %=$P(^(0),U,3) I (%'>0)!(%>$$DT^XLFDT)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.033,.06,2)
S Y(0)=Y S Y=$$GET1^DIQ(40.7,+Y,1)
"^DD",123.033,123.033,.06,2.1)
S Y=$$GET1^DIQ(40.7,+Y,1)
"^DD",123.033,123.033,.06,3)
Enter a stop code associated with the consult(s).
"^DD",123.033,123.033,.06,12)
Only active clinic stops are selectable.
"^DD",123.033,123.033,.06,12.1)
S DIC("S")="N % S %=$P(^(0),U,3) I (%'>0)!(%>$$DT^XLFDT)"
"^DD",123.033,123.033,.06,21,0)
^.001^1^1^3170220^^^^
"^DD",123.033,123.033,.06,21,1,0)
This is a stop code associated with the consult(s).
"^DD",123.033,123.033,.06,"DT")
3170201
"^DD",123.033,123.033,1000,0)
CONSULTS SERVICE^123.0331P^^CONS;0
"^DD",123.033,123.033,1000,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.033,1000,21,1,0)
Consult services for the request.
"^DD",123.033,123.033,2000,0)
CONSULTS PROCEDURE^123.0332P^^CONP;0
"^DD",123.033,123.033,2000,21,0)
^.001^1^1^3170220^^^
"^DD",123.033,123.033,2000,21,1,0)
Consult procedures that the configuration will look for.
"^DD",123.033,123.033,3000,0)
CONSULTS ORDER ITEM^123.0333P^^PROT;0
"^DD",123.033,123.033,3000,21,0)
^.001^1^1^3170220^^^
"^DD",123.033,123.033,3000,21,1,0)
Consult order items for this request.
"^DD",123.033,123.033,4000,0)
CONSULTS CLIN PROC^123.0334P^^CLPR;0
"^DD",123.033,123.033,4000,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.033,4000,21,1,0)
Consult clinical procedures for this request.
"^DD",123.033,123.033,5000,0)
CLINICS^123.0335P^^CLIN;0
"^DD",123.033,123.033,5000,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.033,5000,21,1,0)
Clinics associated with the consult(s).
"^DD",123.033,123.033,6000,0)
NOTE TITLES^123.0336P^^NOTE;0
"^DD",123.033,123.033,6000,21,0)
^.001^1^1^3170220^^^^
"^DD",123.033,123.033,6000,21,1,0)
Note title associated with the consult(s) / clinic(s).
"^DD",123.033,123.0331,0)
CONSULTS SERVICE SUB-FIELD^^.01^1
"^DD",123.033,123.0331,0,"DT")
3170201
"^DD",123.033,123.0331,0,"IX","B",123.0331,.01)

"^DD",123.033,123.0331,0,"NM","CONSULTS SERVICE")

"^DD",123.033,123.0331,0,"UP")
123.033
"^DD",123.033,123.0331,.01,0)
CONSULTS SERVICE^M*P123.5'^GMR(123.5,^0;1^S DIC("S")=$$DICS^GMRCCX(123.0331) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0331,.01,1,0)
^.1
"^DD",123.033,123.0331,.01,1,1,0)
123.0331^B
"^DD",123.033,123.0331,.01,1,1,1)
S ^GMR(123.033,DA(1),"CONS","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0331,.01,1,1,2)
K ^GMR(123.033,DA(1),"CONS","B",$E(X,1,30),DA)
"^DD",123.033,123.0331,.01,3)
Enter a consult service.
"^DD",123.033,123.0331,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0331)
"^DD",123.033,123.0331,.01,12)
Disabled consult services are not selectable.
"^DD",123.033,123.0331,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0331)
"^DD",123.033,123.0331,.01,21,0)
^.001^1^1^3170220^^^
"^DD",123.033,123.0331,.01,21,1,0)
This is the consult service for the request.
"^DD",123.033,123.0331,.01,"DT")
3170201
"^DD",123.033,123.0332,0)
CONSULTS PROCEDURE SUB-FIELD^^.01^1
"^DD",123.033,123.0332,0,"DT")
3170201
"^DD",123.033,123.0332,0,"IX","B",123.0332,.01)

"^DD",123.033,123.0332,0,"NM","CONSULTS PROCEDURE")

"^DD",123.033,123.0332,0,"UP")
123.033
"^DD",123.033,123.0332,.01,0)
CONSULTS PROCEDURE^M*P123.3'^GMR(123.3,^0;1^S DIC("S")=$$DICS^GMRCCX(123.0332) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0332,.01,1,0)
^.1
"^DD",123.033,123.0332,.01,1,1,0)
123.0332^B
"^DD",123.033,123.0332,.01,1,1,1)
S ^GMR(123.033,DA(1),"CONP","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0332,.01,1,1,2)
K ^GMR(123.033,DA(1),"CONP","B",$E(X,1,30),DA)
"^DD",123.033,123.0332,.01,3)
Enter a consult procedure.
"^DD",123.033,123.0332,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0332)
"^DD",123.033,123.0332,.01,12)
Inactive consult procedures are not selectable.
"^DD",123.033,123.0332,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0332)
"^DD",123.033,123.0332,.01,21,0)
^.001^1^1^3170220^^^
"^DD",123.033,123.0332,.01,21,1,0)
This is the consult procedure that the configuration will look for.
"^DD",123.033,123.0332,.01,"DT")
3170201
"^DD",123.033,123.0333,0)
CONSULTS ORDER ITEM SUB-FIELD^^.01^1
"^DD",123.033,123.0333,0,"DT")
3170201
"^DD",123.033,123.0333,0,"IX","B",123.0333,.01)

"^DD",123.033,123.0333,0,"NM","CONSULTS ORDER ITEM")

"^DD",123.033,123.0333,0,"UP")
123.033
"^DD",123.033,123.0333,.01,0)
CONSULTS ORDER ITEM^M*P101'^ORD(101,^0;1^S DIC("S")=$$DICS^GMRCCX(123.0333) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0333,.01,1,0)
^.1
"^DD",123.033,123.0333,.01,1,1,0)
123.0333^B
"^DD",123.033,123.0333,.01,1,1,1)
S ^GMR(123.033,DA(1),"PROT","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0333,.01,1,1,2)
K ^GMR(123.033,DA(1),"PROT","B",$E(X,1,30),DA)
"^DD",123.033,123.0333,.01,3)
Enter a consult order item.
"^DD",123.033,123.0333,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0333)
"^DD",123.033,123.0333,.01,12)
Only consult order items are selectable.
"^DD",123.033,123.0333,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0333)
"^DD",123.033,123.0333,.01,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.0333,.01,21,1,0)
Consult order item.
"^DD",123.033,123.0333,.01,"DT")
3170201
"^DD",123.033,123.0334,0)
CONSULTS CLIN PROC SUB-FIELD^^.01^1
"^DD",123.033,123.0334,0,"DT")
3170201
"^DD",123.033,123.0334,0,"IX","B",123.0334,.01)

"^DD",123.033,123.0334,0,"NM","CONSULTS CLIN PROC")

"^DD",123.033,123.0334,0,"UP")
123.033
"^DD",123.033,123.0334,.01,0)
CONSULTS CLIN PROC^M*P702.01'^MDS(702.01,^0;1^S DIC("S")=$$DICS^GMRCCX(123.0334) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0334,.01,1,0)
^.1
"^DD",123.033,123.0334,.01,1,1,0)
123.0334^B
"^DD",123.033,123.0334,.01,1,1,1)
S ^GMR(123.033,DA(1),"CLPR","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0334,.01,1,1,2)
K ^GMR(123.033,DA(1),"CLPR","B",$E(X,1,30),DA)
"^DD",123.033,123.0334,.01,3)
Enter a consult clinical procedure.
"^DD",123.033,123.0334,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0334)
"^DD",123.033,123.0334,.01,12)
Only active clinical procedures are selectable.
"^DD",123.033,123.0334,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0334)
"^DD",123.033,123.0334,.01,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.0334,.01,21,1,0)
This is the consult clinical procedure.
"^DD",123.033,123.0334,.01,"DT")
3170201
"^DD",123.033,123.0335,0)
CLINICS SUB-FIELD^^.01^1
"^DD",123.033,123.0335,0,"DT")
3170201
"^DD",123.033,123.0335,0,"IX","B",123.0335,.01)

"^DD",123.033,123.0335,0,"NM","CLINICS")

"^DD",123.033,123.0335,0,"UP")
123.033
"^DD",123.033,123.0335,.01,0)
CLINICS^M*P44'^SC(^0;1^S DIC("S")=$$DICS^GMRCCX(123.0335) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0335,.01,1,0)
^.1
"^DD",123.033,123.0335,.01,1,1,0)
123.0335^B
"^DD",123.033,123.0335,.01,1,1,1)
S ^GMR(123.033,DA(1),"CLIN","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0335,.01,1,1,2)
K ^GMR(123.033,DA(1),"CLIN","B",$E(X,1,30),DA)
"^DD",123.033,123.0335,.01,3)
Enter a clinic associated with the consult(s).
"^DD",123.033,123.0335,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0335)
"^DD",123.033,123.0335,.01,12)
Only clinics are selectable.
"^DD",123.033,123.0335,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0335)
"^DD",123.033,123.0335,.01,21,0)
^.001^1^1^3170220^^
"^DD",123.033,123.0335,.01,21,1,0)
Clinic associated with the consult(s).
"^DD",123.033,123.0335,.01,"DT")
3170201
"^DD",123.033,123.0336,0)
NOTE TITLES SUB-FIELD^^.01^1
"^DD",123.033,123.0336,0,"DT")
3170201
"^DD",123.033,123.0336,0,"IX","B",123.0336,.01)

"^DD",123.033,123.0336,0,"NM","NOTE TITLES")

"^DD",123.033,123.0336,0,"UP")
123.033
"^DD",123.033,123.0336,.01,0)
NOTE TITLES^M*P8925.1'^TIU(8925.1,^0;1^S DIC("S")=$$DICS^GMRCCX(123.0336) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.033,123.0336,.01,1,0)
^.1
"^DD",123.033,123.0336,.01,1,1,0)
123.0336^B
"^DD",123.033,123.0336,.01,1,1,1)
S ^GMR(123.033,DA(1),"NOTE","B",$E(X,1,30),DA)=""
"^DD",123.033,123.0336,.01,1,1,2)
K ^GMR(123.033,DA(1),"NOTE","B",$E(X,1,30),DA)
"^DD",123.033,123.0336,.01,3)
Enter a note title associated with the consult(s) / clinic(s).
"^DD",123.033,123.0336,.01,7.5)
D LOOKUP^GMRCCX(.X,$G(D0,$G(Y(1))),123.0336)
"^DD",123.033,123.0336,.01,12)
Only titles are selectable.
"^DD",123.033,123.0336,.01,12.1)
S DIC("S")=$$DICS^GMRCCX(123.0336)
"^DD",123.033,123.0336,.01,21,0)
^.001^1^1^3170220^^^
"^DD",123.033,123.0336,.01,21,1,0)
Note title associated with the consult(s) / clinic(s).
"^DD",123.033,123.0336,.01,"DT")
3170201
"^DD",123.5,123.5,689,0)
SECONDARY PRINTER^P3.5'^%ZIS(1,^3;1^Q
"^DD",123.5,123.5,689,3)
Enter the secondary printer for FORM 513.
"^DD",123.5,123.5,689,21,0)
^.001^2^2^3170124^^
"^DD",123.5,123.5,689,21,1,0)
This is a second printer that the service can use to print the form 513 
"^DD",123.5,123.5,689,21,2,0)
when desired.
"^DD",123.5,123.5,689,"DT")
3170124
"^DIC",123.033,123.033,0)
GMRC CONSULT MAPPING^123.033
"^DIC",123.033,123.033,0,"GL")
^GMR(123.033,
"^DIC",123.033,123.033,"%D",0)
^1.001^2^2^3170209^^
"^DIC",123.033,123.033,"%D",1,0)
This file is used by the Consult Closure Tool to associate consults,
"^DIC",123.033,123.033,"%D",2,0)
clinics, and note titles.
"^DIC",123.033,"B","GMRC CONSULT MAPPING",123.033)

"BLD",10052,6)
^81
**END**
**END**

