Released GMRC*3*90 SEQ #78
Extracted from mail message
**KIDS**:GMRC*3.0*90^

**INSTALL NAME**
GMRC*3.0*90
"BLD",10316,0)
GMRC*3.0*90^CONSULT/REQUEST TRACKING^0^3170810^y
"BLD",10316,1,0)
^^2^2^3170810^
"BLD",10316,1,1,0)
Added a call to Health Management Platform (HMP) API to initiate an 
"BLD",10316,1,2,0)
unsolicited sync action to send a comment as it is added to the consult.
"BLD",10316,4,0)
^9.64PA^^
"BLD",10316,6)
^72
"BLD",10316,6.3)
7
"BLD",10316,"ABPKG")
n
"BLD",10316,"INI")

"BLD",10316,"INID")
^n^n
"BLD",10316,"INIT")

"BLD",10316,"KRN",0)
^9.67PA^779.2^20
"BLD",10316,"KRN",.4,0)
.4
"BLD",10316,"KRN",.401,0)
.401
"BLD",10316,"KRN",.402,0)
.402
"BLD",10316,"KRN",.403,0)
.403
"BLD",10316,"KRN",.5,0)
.5
"BLD",10316,"KRN",.84,0)
.84
"BLD",10316,"KRN",3.6,0)
3.6
"BLD",10316,"KRN",3.8,0)
3.8
"BLD",10316,"KRN",9.2,0)
9.2
"BLD",10316,"KRN",9.8,0)
9.8
"BLD",10316,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10316,"KRN",9.8,"NM",1,0)
GMRCGUIB^^0^B53899117
"BLD",10316,"KRN",9.8,"NM","B","GMRCGUIB",1)

"BLD",10316,"KRN",19,0)
19
"BLD",10316,"KRN",19.1,0)
19.1
"BLD",10316,"KRN",101,0)
101
"BLD",10316,"KRN",409.61,0)
409.61
"BLD",10316,"KRN",771,0)
771
"BLD",10316,"KRN",779.2,0)
779.2
"BLD",10316,"KRN",870,0)
870
"BLD",10316,"KRN",8989.51,0)
8989.51
"BLD",10316,"KRN",8989.52,0)
8989.52
"BLD",10316,"KRN",8994,0)
8994
"BLD",10316,"KRN","B",.4,.4)

"BLD",10316,"KRN","B",.401,.401)

"BLD",10316,"KRN","B",.402,.402)

"BLD",10316,"KRN","B",.403,.403)

"BLD",10316,"KRN","B",.5,.5)

"BLD",10316,"KRN","B",.84,.84)

"BLD",10316,"KRN","B",3.6,3.6)

"BLD",10316,"KRN","B",3.8,3.8)

"BLD",10316,"KRN","B",9.2,9.2)

"BLD",10316,"KRN","B",9.8,9.8)

"BLD",10316,"KRN","B",19,19)

"BLD",10316,"KRN","B",19.1,19.1)

"BLD",10316,"KRN","B",101,101)

"BLD",10316,"KRN","B",409.61,409.61)

"BLD",10316,"KRN","B",771,771)

"BLD",10316,"KRN","B",779.2,779.2)

"BLD",10316,"KRN","B",870,870)

"BLD",10316,"KRN","B",8989.51,8989.51)

"BLD",10316,"KRN","B",8989.52,8989.52)

"BLD",10316,"KRN","B",8994,8994)

"BLD",10316,"QUES",0)
^9.62^^
"BLD",10316,"REQB",0)
^9.611^3^3
"BLD",10316,"REQB",1,0)
GMRC*3.0*73^1
"BLD",10316,"REQB",2,0)
GMRC*3.0*75^1
"BLD",10316,"REQB",3,0)
GMRC*3.0*86^1
"BLD",10316,"REQB","B","GMRC*3.0*73",1)

"BLD",10316,"REQB","B","GMRC*3.0*75",2)

"BLD",10316,"REQB","B","GMRC*3.0*86",3)

"MBREQ")
0
"PKG",329,-1)
1^1
"PKG",329,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",329,22,0)
^9.49I^1^1
"PKG",329,22,1,0)
3.0^2980101^2990521^432
"PKG",329,22,1,"PAH",1,0)
90^3170810^100904
"PKG",329,22,1,"PAH",1,1,0)
^^2^2^3170810
"PKG",329,22,1,"PAH",1,1,1,0)
Added a call to Health Management Platform (HMP) API to initiate an 
"PKG",329,22,1,"PAH",1,1,2,0)
unsolicited sync action to send a comment as it is added to the consult.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRCGUIB")
0^1^B53899117^B52185635
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA/AFS,PB - GUI actions for consults ;7/10/17
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20,17,22,29,30,35,45,53,55,64,46,75,86,90**;DEC 27, 1997;Build 7
"RTN","GMRCGUIB",3,0)
 ;
"RTN","GMRCGUIB",4,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",5,0)
 ; This routine invokes IA #6755 - DE6745 - PB Apr 12, 2017
"RTN","GMRCGUIB",6,0)
 ;
"RTN","GMRCGUIB",7,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",8,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",9,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",10,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",11,0)
 Q DA
"RTN","GMRCGUIB",12,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",13,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",14,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",15,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",16,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",17,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",18,0)
 K LN,L
"RTN","GMRCGUIB",19,0)
 Q
"RTN","GMRCGUIB",20,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",21,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",22,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",23,0)
 I $P($G(^GMR(123,+GMRCO,0)),"^",11)=$G(GMRCPA) S GMRCPA=""
"RTN","GMRCGUIB",24,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF);7////^S X=$G(GMRCPA)"
"RTN","GMRCGUIB",25,0)
 D ^DIE
"RTN","GMRCGUIB",26,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",27,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",28,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",29,0)
 D:$D(^GMR(123,+GMRCO,0)) AG123S1^GMRCXR(+GMRCO)  ;alb/sat 86 - update AG xref
"RTN","GMRCGUIB",30,0)
 ;
"RTN","GMRCGUIB",31,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCGUIB",32,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCGUIB",33,0)
 ;
"RTN","GMRCGUIB",34,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",35,0)
 Q
"RTN","GMRCGUIB",36,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult 
"RTN","GMRCGUIB",37,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",38,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",39,0)
 ; GMRCADUZ = array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",40,0)
 ; GMRCWHO = IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",41,0)
 ; GMRCWHN = date time of activity in FM format
"RTN","GMRCGUIB",42,0)
 ;
"RTN","GMRCGUIB",43,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN,GMRCTM,GMRCRP,GMRCUPD
"RTN","GMRCGUIB",44,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",45,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",46,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",47,0)
 ;if a Non VA Care consult, notify HCP of the comment
"RTN","GMRCGUIB",48,0)
 I $$FEE^GMRCHL7H($$GET1^DIQ(123,+GMRCO,1,"I")) D COMMENT^GMRCHL7H(+GMRCO)
"RTN","GMRCGUIB",49,0)
 D  ;update LAST ACTION field even though no status change
"RTN","GMRCGUIB",50,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCGUIB",51,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCGUIB",52,0)
 . D STATUS^GMRCP
"RTN","GMRCGUIB",53,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",54,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",55,0)
 D POST^HMPEVNT(GMRCDFN,"consult",GMRCO,"") ; DE6745 PB - Added to make a call to HMP to sync the patient comments
"RTN","GMRCGUIB",56,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIB",57,0)
 . S GMRCORTX="Comment Added to remote consult "
"RTN","GMRCGUIB",58,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIB",59,0)
 S GMRCRP=+$P(^GMR(123,GMRCO,0),U,14)
"RTN","GMRCGUIB",60,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",61,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCGUIB",62,0)
 . S GMRCTM=1
"RTN","GMRCGUIB",63,0)
 I GMRCUPD>1,GMRCRP'=DUZ D  ; alert ord. prov if update users takes action
"RTN","GMRCGUIB",64,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",65,0)
 I '$G(GMRCTM),GMRCUPD<2 D  ;alert both if not ord. prov or update user
"RTN","GMRCGUIB",66,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",67,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,$G(GMRCTM))
"RTN","GMRCGUIB",68,0)
 Q
"RTN","GMRCGUIB",69,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",70,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",71,0)
 ;Input variables:
"RTN","GMRCGUIB",72,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",73,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",74,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",75,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",76,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",77,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",78,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",79,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",80,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",81,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",82,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",83,0)
 ;
"RTN","GMRCGUIB",84,0)
 ;Output:
"RTN","GMRCGUIB",85,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred
"RTN","GMRCGUIB",86,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",87,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",88,0)
 ;
"RTN","GMRCGUIB",89,0)
 N GMRCERR,GMRCERMS,GMRCTM
"RTN","GMRCGUIB",90,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",91,0)
 S GMRCERR=0,GMRCTM=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",92,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",93,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",94,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",95,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",96,0)
 ;Insure comment array contains text for Complete action.
"RTN","GMRCGUIB",97,0)
 I GMRCA=10 D  I GMRCERR=1 S GMRCERMS="Comment field must contain a text value!" Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",98,0)
 . S GMRCERR=1
"RTN","GMRCGUIB",99,0)
 . I '$D(GMRCOM) Q
"RTN","GMRCGUIB",100,0)
 . N GMRCOM1 S GMRCOM1=""
"RTN","GMRCGUIB",101,0)
 . F  S GMRCOM1=$O(GMRCOM(GMRCOM1)) Q:(GMRCOM1=""!(GMRCERR=0))  D
"RTN","GMRCGUIB",102,0)
 .. I $TR($G(GMRCOM(GMRCOM1))," ","")'="" S GMRCERR=0 Q
"RTN","GMRCGUIB",103,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",104,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",105,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",106,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCGUIB",107,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",108,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14),$P($G(^GMR(123,+GMRCO,0)),U,14)'=DUZ S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",109,0)
 .Q
"RTN","GMRCGUIB",110,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",111,0)
 .N I
"RTN","GMRCGUIB",112,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",113,0)
 .Q
"RTN","GMRCGUIB",114,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",115,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",116,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14),$P($G(^GMR(123,+GMRCO,0)),U,14)'=DUZ S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",117,0)
 .S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",118,0)
 .I +GMRCUPD<2 S GMRCTM=1
"RTN","GMRCGUIB",119,0)
 .I +GMRCUPD>1,+$P($G(^GMR(123,+GMRCO,0)),U,14)=DUZ S GMRCTM=1
"RTN","GMRCGUIB",120,0)
 .Q
"RTN","GMRCGUIB",121,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",122,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",123,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",124,0)
 .N DA
"RTN","GMRCGUIB",125,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",126,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",127,0)
 .Q
"RTN","GMRCGUIB",128,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",129,0)
 ;
"RTN","GMRCGUIB",130,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,GMRCTM)
"RTN","GMRCGUIB",131,0)
 ;
"RTN","GMRCGUIB",132,0)
 I $S(GMRCA=10:1,(GMRCA=4&($P(^GMR(123,GMRCO,0),U,12)=2)):1,1:0) D
"RTN","GMRCGUIB",133,0)
 . D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",134,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",135,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",136,0)
 ;
"RTN","GMRCGUIB",137,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",138,0)
 ; Input variables:
"RTN","GMRCGUIB",139,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",140,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",141,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",142,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",143,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",144,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",145,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",146,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",147,0)
 ;
"RTN","GMRCGUIB",148,0)
 ;Output:
"RTN","GMRCGUIB",149,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",150,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",151,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",152,0)
        ;
"RTN","GMRCGUIB",153,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",154,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",155,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",156,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",157,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",158,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",159,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",160,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",161,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",162,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",163,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",164,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",165,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",166,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",167,0)
 D  ;send alerts
"RTN","GMRCGUIB",168,0)
 . N GMRCUPD,GMRCTM,TXT
"RTN","GMRCGUIB",169,0)
 . S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",170,0)
 . S GMRCTM=0
"RTN","GMRCGUIB",171,0)
 . I $P(^GMR(123,+GMRCO,0),U,14),$P(^GMR(123,+GMRCO,0),U,14)'=DUZ S GMRCADUZ($P(^(0),U,14))=""
"RTN","GMRCGUIB",172,0)
 . S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",173,0)
 . I +GMRCUPD<2 S GMRCTM=1
"RTN","GMRCGUIB",174,0)
 . I +GMRCUPD>1,+$P($G(^GMR(123,+GMRCO,0)),U,14)=DUZ S GMRCTM=1
"RTN","GMRCGUIB",175,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,GMRCTM)
"RTN","GMRCGUIB",176,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",177,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",178,0)
DOCLIST(GMRCAR,GMRCDA,GMRCMED)  ;return list of linked results
"RTN","GMRCGUIB",179,0)
 ; Input:
"RTN","GMRCGUIB",180,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",181,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",182,0)
 ;  GMRCMED- 1 = include med results; 0 = only TIU docs
"RTN","GMRCGUIB",183,0)
 ;
"RTN","GMRCGUIB",184,0)
 ; Output:
"RTN","GMRCGUIB",185,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",186,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",187,0)
 ;       GMRCAR(50,1)="ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCGUIB",188,0)
 ;       GMRCAR(50,2)="ien;global ref,"
"RTN","GMRCGUIB",189,0)
 ;
"RTN","GMRCGUIB",190,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",191,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",192,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",193,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",194,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCGUIB",195,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCGUIB",196,0)
 . I RES["MCAR" D
"RTN","GMRCGUIB",197,0)
 .. N ARR,STR
"RTN","GMRCGUIB",198,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCGUIB",199,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCGUIB",200,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCGUIB",201,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCGUIB",202,0)
 . S CNT=CNT+1
"RTN","GMRCGUIB",203,0)
 Q
"VER")
8.0^22.2
"BLD",10316,6)
^78
**END**
**END**

