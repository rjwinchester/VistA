Released GMRC*3*83 SEQ #75
Extracted from mail message
**KIDS**:GMRC*3.0*83^

**INSTALL NAME**
GMRC*3.0*83
"BLD",9293,0)
GMRC*3.0*83^CONSULT/REQUEST TRACKING^0^3160115^y
"BLD",9293,1,0)
^^2^2^3151209^
"BLD",9293,1,1,0)
Implement the NEW style AG cross-reference in the REQUEST/CONSULTATION 
"BLD",9293,1,2,0)
file 123 for all entries that do not have an appointment scheduled.
"BLD",9293,4,0)
^9.64PA^^
"BLD",9293,6.3)
11
"BLD",9293,"INIT")
POST^GMRCXR
"BLD",9293,"KRN",0)
^9.67PA^779.2^20
"BLD",9293,"KRN",.4,0)
.4
"BLD",9293,"KRN",.401,0)
.401
"BLD",9293,"KRN",.402,0)
.402
"BLD",9293,"KRN",.403,0)
.403
"BLD",9293,"KRN",.5,0)
.5
"BLD",9293,"KRN",.84,0)
.84
"BLD",9293,"KRN",3.6,0)
3.6
"BLD",9293,"KRN",3.8,0)
3.8
"BLD",9293,"KRN",9.2,0)
9.2
"BLD",9293,"KRN",9.8,0)
9.8
"BLD",9293,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9293,"KRN",9.8,"NM",1,0)
GMRCXR^^0^B34169214
"BLD",9293,"KRN",9.8,"NM","B","GMRCXR",1)

"BLD",9293,"KRN",19,0)
19
"BLD",9293,"KRN",19.1,0)
19.1
"BLD",9293,"KRN",101,0)
101
"BLD",9293,"KRN",409.61,0)
409.61
"BLD",9293,"KRN",771,0)
771
"BLD",9293,"KRN",779.2,0)
779.2
"BLD",9293,"KRN",870,0)
870
"BLD",9293,"KRN",8989.51,0)
8989.51
"BLD",9293,"KRN",8989.52,0)
8989.52
"BLD",9293,"KRN",8994,0)
8994
"BLD",9293,"KRN","B",.4,.4)

"BLD",9293,"KRN","B",.401,.401)

"BLD",9293,"KRN","B",.402,.402)

"BLD",9293,"KRN","B",.403,.403)

"BLD",9293,"KRN","B",.5,.5)

"BLD",9293,"KRN","B",.84,.84)

"BLD",9293,"KRN","B",3.6,3.6)

"BLD",9293,"KRN","B",3.8,3.8)

"BLD",9293,"KRN","B",9.2,9.2)

"BLD",9293,"KRN","B",9.8,9.8)

"BLD",9293,"KRN","B",19,19)

"BLD",9293,"KRN","B",19.1,19.1)

"BLD",9293,"KRN","B",101,101)

"BLD",9293,"KRN","B",409.61,409.61)

"BLD",9293,"KRN","B",771,771)

"BLD",9293,"KRN","B",779.2,779.2)

"BLD",9293,"KRN","B",870,870)

"BLD",9293,"KRN","B",8989.51,8989.51)

"BLD",9293,"KRN","B",8989.52,8989.52)

"BLD",9293,"KRN","B",8994,8994)

"BLD",9293,"QUES",0)
^9.62^^
"INIT")
POST^GMRCXR
"MBREQ")
0
"PKG",44,-1)
1^1
"PKG",44,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
3.0^^2981119^66481
"PKG",44,22,1,"PAH",1,0)
83^3160115
"PKG",44,22,1,"PAH",1,1,0)
^^2^2^3160115
"PKG",44,22,1,"PAH",1,1,1,0)
Implement the NEW style AG cross-reference in the REQUEST/CONSULTATION 
"PKG",44,22,1,"PAH",1,1,2,0)
file 123 for all entries that do not have an appointment scheduled.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRCXR")
0^1^B34169214^n/a
"RTN","GMRCXR",1,0)
GMRCXR ; ALB/SAT - GMR DD UTILITY ;JAN 15, 2016
"RTN","GMRCXR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**83**;Dec 27, 1997;Build 11
"RTN","GMRCXR",3,0)
 ;DD support for VISTA SCHEDULING ENHANCEMENT SD*5.3*627
"RTN","GMRCXR",4,0)
 ;Reference is made to ICR #6184
"RTN","GMRCXR",5,0)
 ;
"RTN","GMRCXR",6,0)
 Q
"RTN","GMRCXR",7,0)
AG123S1(GMRCDA1,X) ;build AG xref ;called by 'Set Logic' and 'Kill Logic' of the New Style AG cross reference #336 in file 123
"RTN","GMRCXR",8,0)
 ;GMRCDA1  = DA(1) IEN pointer to REQUEST/CONSULTATION file 123
"RTN","GMRCXR",9,0)
 ;X        = DATE OF REQUEST in FM format from field 3 of top level of file 123
"RTN","GMRCXR",10,0)
 N CHK
"RTN","GMRCXR",11,0)
 S X=$G(X,0)
"RTN","GMRCXR",12,0)
 S CHK=$$REQCHK(GMRCDA1)
"RTN","GMRCXR",13,0)
 S:CHK=0 ^GMR(123,"AG",X,GMRCDA1)=""
"RTN","GMRCXR",14,0)
 K:+CHK ^GMR(123,"AG",X,GMRCDA1)
"RTN","GMRCXR",15,0)
 Q
"RTN","GMRCXR",16,0)
 ;
"RTN","GMRCXR",17,0)
REQCHK(GMRCID) ;check activities to determine if the REQUEST/CONSULTATION entry is still active and not scheduled
"RTN","GMRCXR",18,0)
 N GMRCCAN,GMRCCANF,GMRCDC,GMRCDONE,GMRCES,GMRCESF,GMRCNOD,GMRCPDC,GMRC40,GMRCACT,GMRCRPA,GMRCSCH,GMRCSCHF,GMRCSER,GMRCST,GMRCSTF
"RTN","GMRCXR",19,0)
 N GMRCCS,GMRCPA
"RTN","GMRCXR",20,0)
 S GMRCPA=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","GMRCXR",21,0)
 S GMRCPDC=$O(^ORD(100.01,"B","DISCONTINUED",0))
"RTN","GMRCXR",22,0)
 S GMRCCS=$$GET1^DIQ(123,GMRCID_",",8,"I")
"RTN","GMRCXR",23,0)
 Q:GMRCCS=GMRCPDC 1   ;don't return this entry if CPRS STATUS is DISCONTINUED
"RTN","GMRCXR",24,0)
 Q:$$GET1^DIQ(123,GMRCID_",",8,"I")=GMRCPDC 1   ;don't include this entry if CPRS STATUS is DISCONTINUED
"RTN","GMRCXR",25,0)
 S GMRCSCH=$$GETIEN("SCHEDULED")
"RTN","GMRCXR",26,0)
 S GMRCST=$$GETIEN("STATUS CHANGE")
"RTN","GMRCXR",27,0)
 S GMRCCAN=$$GETIEN("CANCELLED")
"RTN","GMRCXR",28,0)
 S GMRCDONE=$$GETIEN("COMPLETE/UPDATE")
"RTN","GMRCXR",29,0)
 S GMRCDC=$$GETIEN("DISCONTINUED")
"RTN","GMRCXR",30,0)
 S GMRCES=$$GETIEN("EDIT/RESUBMITTED")
"RTN","GMRCXR",31,0)
 S GMRCNOD=$G(^GMR(123,GMRCID,0))
"RTN","GMRCXR",32,0)
 S GMRCSER=$P(GMRCNOD,U,5)
"RTN","GMRCXR",33,0)
 S DFN=$P(GMRCNOD,U,2)
"RTN","GMRCXR",34,0)
 S (GMRCCANF,GMRCESF,GMRCSCHF,GMRCSTF)=0
"RTN","GMRCXR",35,0)
 ;GMRCESF - if 1 we have determined this request should be returned (return 0)
"RTN","GMRCXR",36,0)
 S GMRCRPA=9999999 F  S GMRCRPA=$O(^GMR(123,GMRCID,40,GMRCRPA),-1) Q:GMRCRPA'>0  D  Q:GMRCCANF=1  Q:GMRCSCHF=1  Q:GMRCESF=1
"RTN","GMRCXR",37,0)
 .S GMRC40=$G(^GMR(123,GMRCID,40,GMRCRPA,0))
"RTN","GMRCXR",38,0)
 .S GMRCACT=$P(GMRC40,U,2)   ;ACTIVITY field 1
"RTN","GMRCXR",39,0)
 .I GMRCACT'=GMRCSCH,GMRCACT'=GMRCST,GMRCACT'=GMRCCAN,GMRCACT'=GMRCDONE,GMRCACT'=GMRCDC,GMRCACT'=GMRCES Q  ;only watch the ones we need
"RTN","GMRCXR",40,0)
 .I GMRCACT=GMRCCAN!(GMRCACT=GMRCDONE)!(GMRCACT=GMRCDC) S GMRCCANF=1 Q    ;skip completed consults/mgh
"RTN","GMRCXR",41,0)
 .I GMRCACT=GMRCES S GMRCESF=1 Q
"RTN","GMRCXR",42,0)
 .I GMRCACT=GMRCSCH,GMRCSTF=1 S GMRCESF=1 Q
"RTN","GMRCXR",43,0)
 .I GMRCACT=GMRCSCH,GMRCSTF'=1,$$SCHED(DFN,$P(GMRC40,U,3),GMRCSER) S GMRCSCHF=1 Q
"RTN","GMRCXR",44,0)
 .;I GMRCACT=GMRCST,$$FINDTXT(GMRCID,GMRCRPA) S GMRCSTF=1
"RTN","GMRCXR",45,0)
 .I GMRCACT=GMRCST,GMRCCS=GMRCPA S GMRCSTF=1
"RTN","GMRCXR",46,0)
 Q:GMRCSCHF GMRCSCHF
"RTN","GMRCXR",47,0)
 Q:GMRCCANF GMRCCANF
"RTN","GMRCXR",48,0)
 Q:GMRCESF 0
"RTN","GMRCXR",49,0)
 Q 0
"RTN","GMRCXR",50,0)
 ;
"RTN","GMRCXR",51,0)
GETIEN(GMRCNM) ;get ID from REQUEST ACTION TYPES file 123.1
"RTN","GMRCXR",52,0)
 N Y
"RTN","GMRCXR",53,0)
 S Y=$O(^GMR(123.1,"B",GMRCNM,0))
"RTN","GMRCXR",54,0)
 Q Y
"RTN","GMRCXR",55,0)
 ;
"RTN","GMRCXR",56,0)
SCHED(DFN,GMRCDT,GMRCSVC) ;look for appointment with stop code matching one in REQUEST SERVICES
"RTN","GMRCXR",57,0)
 ;INPUT:
"RTN","GMRCXR",58,0)
 ; DFN     - patient ID pointer to PATIENT file
"RTN","GMRCXR",59,0)
 ; GMRCDT - actual activity date in FM format
"RTN","GMRCXR",60,0)
 ; GMRCSVC  - request services ID pointer to REQUEST SERVICES file 123.5
"RTN","GMRCXR",61,0)
 ;RETURN:
"RTN","GMRCXR",62,0)
 ; 0 = no appointment found with matching stop code
"RTN","GMRCXR",63,0)
 ; 1 = appointment found with matching stop code
"RTN","GMRCXR",64,0)
 ;Q 1   ;do not check for match for now
"RTN","GMRCXR",65,0)
 N GMRCAPI,GMRCARR,GMRCI,GMRCJ,GMRCRET,GMRCSTP,GMRCSTPL
"RTN","GMRCXR",66,0)
 S GMRCRET=0
"RTN","GMRCXR",67,0)
 S GMRCSVC=$G(GMRCSVC)
"RTN","GMRCXR",68,0)
 Q:GMRCSVC="" 0
"RTN","GMRCXR",69,0)
 S GMRCDT=$P($G(GMRCDT),".",1)
"RTN","GMRCXR",70,0)
 I GMRCDT'?7N S GMRCDT=1000103
"RTN","GMRCXR",71,0)
 S GMRCI=0 F  S GMRCI=$O(^GMR(123.5,GMRCSVC,688,GMRCI)) Q:GMRCI'>0  D
"RTN","GMRCXR",72,0)
 .S GMRCSTPL(+$P($G(^GMR(123.5,GMRCSVC,688,GMRCI,0)),U,1))=""
"RTN","GMRCXR",73,0)
 K ^TMP($J,"SDAMA301"),GMRCARR
"RTN","GMRCXR",74,0)
 S GMRCARR(1)=$P($$FMADD^XLFDT(GMRCDT,-1),".",1)_";"   ;go back 1 day and look forward for appt with matching stop code
"RTN","GMRCXR",75,0)
 S GMRCARR(4)=DFN
"RTN","GMRCXR",76,0)
 S GMRCARR("FLDS")="2;13"
"RTN","GMRCXR",77,0)
 S GMRCAPI=$$SDAPI^SDAMA301(.GMRCARR)
"RTN","GMRCXR",78,0)
 ;GMRCI - pointer to file 44; GMRCJ - appt date/time
"RTN","GMRCXR",79,0)
 S GMRCI=0 F  S GMRCI=$O(^TMP($J,"SDAMA301",DFN,GMRCI)) Q:GMRCI'>0  D  Q:+GMRCRET
"RTN","GMRCXR",80,0)
 .S GMRCJ=0 F  S GMRCJ=$O(^TMP($J,"SDAMA301",DFN,GMRCI,GMRCJ)) Q:GMRCJ'>0  D  Q:+GMRCRET
"RTN","GMRCXR",81,0)
 ..S GMRCSTP=+$P($G(^TMP($J,"SDAMA301",DFN,GMRCI,GMRCJ)),U,13)
"RTN","GMRCXR",82,0)
 ..S:$D(GMRCSTPL(+GMRCSTP)) GMRCRET=1
"RTN","GMRCXR",83,0)
 K ^TMP($J,"SDAMA301"),GMRCARR
"RTN","GMRCXR",84,0)
 Q GMRCRET
"RTN","GMRCXR",85,0)
 ;
"RTN","GMRCXR",86,0)
FINDTXT(GMRCID,GMRCRPA,GMRCTXT) ;find text in word processing field
"RTN","GMRCXR",87,0)
 ;INPUT:
"RTN","GMRCXR",88,0)
 ; GMRCID - Pointer to REQUEST/CONSULTATION file
"RTN","GMRCXR",89,0)
 ; GMRCRPA - Pointer to REQUEST PROCESSING ACTIVITY in REQUEST/CONSULTATION file
"RTN","GMRCXR",90,0)
 ; GMRCTXT - (optional) text to search for; defaults to "CANCELLED BY THE PATIENT"
"RTN","GMRCXR",91,0)
 ;RETURN:
"RTN","GMRCXR",92,0)
 ; 1=Text Fount; 0=Not Found
"RTN","GMRCXR",93,0)
 N GMRCI,GMRCPREV,GMRCRET,GMRCTHIS
"RTN","GMRCXR",94,0)
 S (GMRCTHIS,GMRCPREV)=""
"RTN","GMRCXR",95,0)
 S GMRCRET=0
"RTN","GMRCXR",96,0)
 S:$G(GMRCTXT)="" GMRCTXT="CANCELLED BY"
"RTN","GMRCXR",97,0)
 S GMRCI=0 F  S GMRCI=$O(^GMR(123,GMRCID,40,GMRCRPA,1,GMRCI)) Q:GMRCI=""  D  Q:GMRCRET=1
"RTN","GMRCXR",98,0)
 .S GMRCTHIS=$S($E(GMRCPREV,$L(GMRCPREV))="-":"",1:" ")_$G(^GMR(123,GMRCID,40,GMRCRPA,1,GMRCI,0))
"RTN","GMRCXR",99,0)
 .I $$UP^XLFSTR(GMRCPREV_GMRCTHIS)[GMRCTXT S GMRCRET=1
"RTN","GMRCXR",100,0)
 .S GMRCPREV=GMRCTHIS  ;keep 'this' line for next iteration in case the phrase wraps around onto 2 lines
"RTN","GMRCXR",101,0)
 Q GMRCRET
"RTN","GMRCXR",102,0)
 ;
"RTN","GMRCXR",103,0)
POST ;post install for GMRC*3*83
"RTN","GMRCXR",104,0)
 D XREF
"RTN","GMRCXR",105,0)
 Q
"RTN","GMRCXR",106,0)
XREF  ;create and build NEW style AG for all REQUEST/CONSULTATION entries in file 123
"RTN","GMRCXR",107,0)
 N GMRCXR,GMRCRES,GMRCOUT
"RTN","GMRCXR",108,0)
 S GMRCXR("FILE")=123
"RTN","GMRCXR",109,0)
 S GMRCXR("NAME")="AG"
"RTN","GMRCXR",110,0)
 S GMRCXR("SHORT DESCR")="Index of active REQUEST/CONSULTs with no appointment scheduled."
"RTN","GMRCXR",111,0)
 S GMRCXR("TYPE")="M"
"RTN","GMRCXR",112,0)
 S GMRCXR("EXECUTION")="F"
"RTN","GMRCXR",113,0)
 S GMRCXR("ACTIVITY")="IR"
"RTN","GMRCXR",114,0)
 S GMRCXR("ROOT TYPE")="W"
"RTN","GMRCXR",115,0)
 S GMRCXR("ROOT FILE")=123.02
"RTN","GMRCXR",116,0)
 S GMRCXR("USE")="S"
"RTN","GMRCXR",117,0)
 S GMRCXR("DESCR",1)="This cross reference contains entries of the REQUEST/CONSULTATION file"
"RTN","GMRCXR",118,0)
 S GMRCXR("DESCR",2)="that do not have an appointment scheduled."
"RTN","GMRCXR",119,0)
 S GMRCXR("DESCR",3)="This is determined based on the content and order of the entries in"
"RTN","GMRCXR",120,0)
 S GMRCXR("DESCR",4)="the REQUEST PROCESSING ACTIVITY multiple field 40.  This cross"
"RTN","GMRCXR",121,0)
 S GMRCXR("DESCR",5)="reference will be updated with any update to the ACTIVITY field under"
"RTN","GMRCXR",122,0)
 S GMRCXR("DESCR",6)="the REQUEST PROCESSING ACTIVITY multiple and that update will be"
"RTN","GMRCXR",123,0)
 S GMRCXR("DESCR",7)="determined based on all REQUEST PROCESSING ACTIVITY entries."
"RTN","GMRCXR",124,0)
 S GMRCXR("DESCR",8)="This cross reference was added in GMRC*3.0*83."
"RTN","GMRCXR",125,0)
 S GMRCXR("SET")="D AG123S1^GMRCXR(DA(1),X)"
"RTN","GMRCXR",126,0)
 S GMRCXR("KILL")="D AG123S1^GMRCXR(DA(1),X)"
"RTN","GMRCXR",127,0)
 S GMRCXR("WHOLE KILL")="K ^GMR(123,""AG"")"
"RTN","GMRCXR",128,0)
 S GMRCXR("VAL",1)="S X=+$P($G(^GMR(123,DA(1),0)),U,7)"
"RTN","GMRCXR",129,0)
 S GMRCXR("VAL",1,"TYP")="C"
"RTN","GMRCXR",130,0)
 S GMRCXR("VAL",1,"SUBSCRIPT")=1
"RTN","GMRCXR",131,0)
 S GMRCXR("VAL",1,"COLLATION")="F"
"RTN","GMRCXR",132,0)
 D CREIXN^DDMOD(.GMRCXR,"S",.GMRCRES,"GMRCOUT")
"RTN","GMRCXR",133,0)
 Q
"VER")
8.0^22.0
"BLD",9293,6)
^75
**END**
**END**

