Released GMRC*3*114 SEQ #95
Extracted from mail message
**KIDS**:GMRC*3.0*114^

**INSTALL NAME**
GMRC*3.0*114
"BLD",10830,0)
GMRC*3.0*114^CONSULT/REQUEST TRACKING^0^3181108^y
"BLD",10830,1,0)
^^2^2^3181108^^
"BLD",10830,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",10830,1,2,0)
under GMRC*3.0*114.
"BLD",10830,4,0)
^9.64PA^^
"BLD",10830,6.3)
2
"BLD",10830,"KRN",0)
^9.67PA^779.2^20
"BLD",10830,"KRN",.4,0)
.4
"BLD",10830,"KRN",.401,0)
.401
"BLD",10830,"KRN",.402,0)
.402
"BLD",10830,"KRN",.403,0)
.403
"BLD",10830,"KRN",.5,0)
.5
"BLD",10830,"KRN",.84,0)
.84
"BLD",10830,"KRN",3.6,0)
3.6
"BLD",10830,"KRN",3.8,0)
3.8
"BLD",10830,"KRN",9.2,0)
9.2
"BLD",10830,"KRN",9.8,0)
9.8
"BLD",10830,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10830,"KRN",9.8,"NM",1,0)
GMRCGUIA^^0^B65169406
"BLD",10830,"KRN",9.8,"NM","B","GMRCGUIA",1)

"BLD",10830,"KRN",19,0)
19
"BLD",10830,"KRN",19.1,0)
19.1
"BLD",10830,"KRN",101,0)
101
"BLD",10830,"KRN",409.61,0)
409.61
"BLD",10830,"KRN",771,0)
771
"BLD",10830,"KRN",779.2,0)
779.2
"BLD",10830,"KRN",870,0)
870
"BLD",10830,"KRN",8989.51,0)
8989.51
"BLD",10830,"KRN",8989.52,0)
8989.52
"BLD",10830,"KRN",8994,0)
8994
"BLD",10830,"KRN","B",.4,.4)

"BLD",10830,"KRN","B",.401,.401)

"BLD",10830,"KRN","B",.402,.402)

"BLD",10830,"KRN","B",.403,.403)

"BLD",10830,"KRN","B",.5,.5)

"BLD",10830,"KRN","B",.84,.84)

"BLD",10830,"KRN","B",3.6,3.6)

"BLD",10830,"KRN","B",3.8,3.8)

"BLD",10830,"KRN","B",9.2,9.2)

"BLD",10830,"KRN","B",9.8,9.8)

"BLD",10830,"KRN","B",19,19)

"BLD",10830,"KRN","B",19.1,19.1)

"BLD",10830,"KRN","B",101,101)

"BLD",10830,"KRN","B",409.61,409.61)

"BLD",10830,"KRN","B",771,771)

"BLD",10830,"KRN","B",779.2,779.2)

"BLD",10830,"KRN","B",870,870)

"BLD",10830,"KRN","B",8989.51,8989.51)

"BLD",10830,"KRN","B",8989.52,8989.52)

"BLD",10830,"KRN","B",8994,8994)

"BLD",10830,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10830,"QUES",0)
^9.62^^
"BLD",10830,"REQB",0)
^9.611^1^1
"BLD",10830,"REQB",1,0)
GMRC*3.0*64^2
"BLD",10830,"REQB","B","GMRC*3.0*64",1)

"MBREQ")
0
"PKG",406,-1)
1^1
"PKG",406,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",406,22,0)
^9.49I^1^1
"PKG",406,22,1,0)
3.0^2980101^2981113^1
"PKG",406,22,1,"PAH",1,0)
114^3181108
"PKG",406,22,1,"PAH",1,1,0)
^^2^2^3181108
"PKG",406,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",406,22,1,"PAH",1,1,2,0)
under GMRC*3.0*114.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRCGUIA")
0^1^B65169406^B63812781
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM,JFR - File Consult actions from GUI ;7/8/03 07:36
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15,22,35,64,114**;DEC 27, 1997;Build 2
"RTN","GMRCGUIA",3,0)
 ;
"RTN","GMRCGUIA",4,0)
 ; This routine invokes IA #2638,#2926
"RTN","GMRCGUIA",5,0)
 ;
"RTN","GMRCGUIA",6,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",7,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",8,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",9,0)
 ;    an array
"RTN","GMRCGUIA",10,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",11,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",12,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",13,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",14,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",15,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",16,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",17,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",18,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",19,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",20,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",21,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",22,0)
 N DIC,DLAYGO,Y,DIE,GMRCADUZ,X,GMRCO,DR
"RTN","GMRCGUIA",23,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",24,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",25,0)
 L +^GMR(123,GMRCO):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","GMRCGUIA",26,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",27,0)
 D ^DIE
"RTN","GMRCGUIA",28,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",29,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",30,0)
 I $O(GMRCRFQ(0)) D REASON^GMRCGUIB(GMRCO,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",31,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYPE,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",32,0)
 D EXIT
"RTN","GMRCGUIA",33,0)
 Q
"RTN","GMRCGUIA",34,0)
 ;
"RTN","GMRCGUIA",35,0)
RC(GMRCO,GMRCORNP,GMRCAD,GMRCMT,GMRCDUZ) ;Receive consult into service
"RTN","GMRCGUIA",36,0)
 ;
"RTN","GMRCGUIA",37,0)
 ;Input variables:
"RTN","GMRCGUIA",38,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",39,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult 
"RTN","GMRCGUIA",40,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'.
"RTN","GMRCGUIA",41,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIA",42,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIA",43,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIA",44,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIA",45,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'
"RTN","GMRCGUIA",46,0)
 ;
"RTN","GMRCGUIA",47,0)
 ;Output:
"RTN","GMRCGUIA",48,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",49,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",50,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",51,0)
 ;
"RTN","GMRCGUIA",52,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIA",53,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",54,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",55,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIA",56,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",57,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",58,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",59,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIA",60,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIA",61,0)
 . S DA=$$SETDA^GMRCGUIB
"RTN","GMRCGUIA",62,0)
 . D SETCOM^GMRCGUIB(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIA",63,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",64,0)
 D EXIT
"RTN","GMRCGUIA",65,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",66,0)
 ;
"RTN","GMRCGUIA",67,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",68,0)
 ;
"RTN","GMRCGUIA",69,0)
 ;Input variables:
"RTN","GMRCGUIA",70,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",71,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",72,0)
 ;GMRCAD - FM date/time of actual activity.
"RTN","GMRCGUIA",73,0)
 ;GMRCACTM - set to "DY" if 'CANCELLED'(old DENY)
"RTN","GMRCGUIA",74,0)
 ;           set to "DC" if consult is Discontinued 
"RTN","GMRCGUIA",75,0)
 ;GMRCOM - Comment array containing explanation of action
"RTN","GMRCGUIA",76,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",77,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",78,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",79,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",80,0)
 ;  Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",81,0)
 ;
"RTN","GMRCGUIA",82,0)
 ;Output:
"RTN","GMRCGUIA",83,0)
 ;GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",84,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",85,0)
 ; returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",86,0)
 ;
"RTN","GMRCGUIA",87,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS,GMRCERR,GMRCERMS,GMRCADUZ,GMRCTRLC
"RTN","GMRCGUIA",88,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",89,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",90,0)
 K GMRCQUT
"RTN","GMRCGUIA",91,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",92,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",93,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",94,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",95,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",96,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",98,0)
 S GMRCA=$S(GMRCACTM="DC":6,1:19),GMRCSTS=$S(GMRCA=6:1,1:13)
"RTN","GMRCGUIA",99,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",100,0)
 I GMRCACTM="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D PRNT^GMRCUTL1("",GMRCO)
"RTN","GMRCGUIA",101,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",102,0)
 S GMRCOM(0)=DA
"RTN","GMRCGUIA",103,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",1:"OC")
"RTN","GMRCGUIA",104,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIA",105,0)
 S GMRCORTX=$S(GMRCACTM="DY":"Cancelled",1:"Discontinued")_" consult "
"RTN","GMRCGUIA",106,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIA",107,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCGUIA",108,0)
 I GMRCACTM="DC" D
"RTN","GMRCGUIA",109,0)
 . S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ) ;NOTIFY SERVICE ON DC ?
"RTN","GMRCGUIA",110,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),$P(^(0),"^",14)'=DUZ D
"RTN","GMRCGUIA",111,0)
 . S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCGUIA",112,0)
 ;send notification
"RTN","GMRCGUIA",113,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCGUIA",114,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCGUIA",115,0)
 D EXIT
"RTN","GMRCGUIA",116,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",117,0)
 ;
"RTN","GMRCGUIA",118,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCAD) ;FWD consult
"RTN","GMRCGUIA",119,0)
 ;to another service
"RTN","GMRCGUIA",120,0)
 ;
"RTN","GMRCGUIA",121,0)
 ;Input variables:
"RTN","GMRCGUIA",122,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIA",123,0)
 ;GMRCSS=service being forwarded to; ptr to REQUEST SERVICES (#123.5)
"RTN","GMRCGUIA",124,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIA",125,0)
 ;GMRCATTN=NEW PERSON to whose attention action should be directed
"RTN","GMRCGUIA",126,0)
 ;GMRCURGI=urgency from PROTOCOL(#101) file
"RTN","GMRCGUIA",127,0)
 ;GMRCOM=Comment array containing explanation of action
"RTN","GMRCGUIA",128,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",129,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",130,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",131,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",132,0)
 ;GMRCAD=FM date/time of actual activity
"RTN","GMRCGUIA",133,0)
 ;
"RTN","GMRCGUIA",134,0)
 ;Output:
"RTN","GMRCGUIA",135,0)
 ;  GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",136,0)
 ;  GMRCERMS - Error message or null
"RTN","GMRCGUIA",137,0)
 ;     returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",138,0)
 ;
"RTN","GMRCGUIA",139,0)
 N DR,GMRCDUZ,GMRCNOW,GMRCFF,GMRCFR,GMRCADUZ,GMRCURG,GMRCPA,GMRCSEQ,GMRCDOC
"RTN","GMRCGUIA",140,0)
 N GMRCERR,GMRCERMS,GMRCIROL,GMRCINM,GMRCIROU,GMRD
"RTN","GMRCGUIA",141,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",142,0)
 I $P(^GMR(123,+GMRCO,0),U,12)=9 S GMRCERR=1,GMRCERMS="Invalid action. This consult has partial results."
"RTN","GMRCGUIA",143,0)
 S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,50,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCERR)
"RTN","GMRCGUIA",144,0)
 . I $P($G(^GMR(123,+GMRCO,50,GMRCSEQ,0)),";",2)="TIU(8925," S GMRCDOC=$P(^GMR(123,+GMRCO,50,GMRCSEQ,0),";",1)
"RTN","GMRCGUIA",145,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCGUIA",146,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5 D
"RTN","GMRCGUIA",147,0)
 . . S GMRCERMS="Invalid Action. This consult has an unsigned note.",GMRCERR=1
"RTN","GMRCGUIA",148,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6 D
"RTN","GMRCGUIA",149,0)
 . . S GMRCERMS="Invalid Action. This consult has an uncosigned note.",GMRCERR=1
"RTN","GMRCGUIA",150,0)
 S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,40,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCERR)
"RTN","GMRCGUIA",151,0)
 . I $P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",2)="TIU(8925," S GMRCDOC=$P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",1)
"RTN","GMRCGUIA",152,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCGUIA",153,0)
 . S GMRD=$P($G(^TIU(8925,GMRCDOC,14)),U,5)
"RTN","GMRCGUIA",154,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5,(GMRD["GMR"&(+GMRD=GMRCO)) D
"RTN","GMRCGUIA",155,0)
 . . S GMRCERMS="Invalid Action. This consult has an unsigned note.",GMRCERR=1
"RTN","GMRCGUIA",156,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6,(GMRD["GMR"&(+GMRD=GMRCO)) D
"RTN","GMRCGUIA",157,0)
 . . S GMRCERMS="Invalid Action. This consult has an uncosigned note.",GMRCERR=1
"RTN","GMRCGUIA",158,0)
 I GMRCERR=1 D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",159,0)
 S DFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCGUIA",160,0)
 S GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",161,0)
 S:'$G(GMRCAD) GMRCAD=GMRCNOW  ;Actual FM date/time consult was FWD'd 
"RTN","GMRCGUIA",162,0)
 S:'$G(GMRCURGI) GMRCURGI=$P(^GMR(123,GMRCO,0),U,9)
"RTN","GMRCGUIA",163,0)
 S GMRCA=17,GMRCSTS=5
"RTN","GMRCGUIA",164,0)
 S GMRCFF=$P($G(^GMR(123.5,+GMRCSS,123)),U,9) ;printed to new serv
"RTN","GMRCGUIA",165,0)
 S GMRCFR=$P($G(^GMR(123,+GMRCO,0)),"^",5) ;Get current service
"RTN","GMRCGUIA",166,0)
 S GMRCPA=$P($G(^GMR(123,+GMRCO,0)),"^",11) ;get current attention 
"RTN","GMRCGUIA",167,0)
 S DIE="^GMR(123,",DA=GMRCO,DR=""
"RTN","GMRCGUIA",168,0)
 I $D(^GMR(123.5,+GMRCSS,"IFC")) D  ; if fwd to IFC serv, get extra flds
"RTN","GMRCGUIA",169,0)
 . S GMRCIROU=$P(^GMR(123.5,+GMRCSS,"IFC"),U) Q:GMRCIROU=""  ;no rout fac
"RTN","GMRCGUIA",170,0)
 . S GMRCINM=$P(^GMR(123.5,+GMRCSS,"IFC"),U,2) Q:GMRCINM=""  ;no serv nm
"RTN","GMRCGUIA",171,0)
 . S GMRCA=25,GMRCIROL="P"
"RTN","GMRCGUIA",172,0)
 . S DR=".07////^S X=GMRCIROU;.125////^S X=GMRCIROL;.131///^S X=GMRCINM;"
"RTN","GMRCGUIA",173,0)
 S DR=DR_"1////^S X=$G(GMRCSS);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=$G(GMRCA);.1///@"_$S($L($G(GMRCATTN)):";7////^S X=GMRCATTN",1:";7///@")
"RTN","GMRCGUIA",174,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",175,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",176,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",177,0)
 S GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCGUIA",178,0)
 D DEM^GMRCU ;sets GMRCRB and other variables
"RTN","GMRCGUIA",179,0)
 D TYPE^GMRCAFRD ;sets GMRCTYPE
"RTN","GMRCGUIA",180,0)
 D FRMSG^GMRCAFRD ;create XX HL7 message for OE/RR and send alert 
"RTN","GMRCGUIA",181,0)
 D EXIT
"RTN","GMRCGUIA",182,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",183,0)
 ;
"RTN","GMRCGUIA",184,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",185,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",186,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"MCAR", or ^TMP("GMRCR",$J,"RES", i.e., S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",187,0)
 Q:'$G(GMRCO)
"RTN","GMRCGUIA",188,0)
 K @TMPGLOB
"RTN","GMRCGUIA",189,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCGUIA",190,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",191,0)
 S GMRCRTFL=$S('+GMRCSR&('GMRCTUFN):1,1:0)
"RTN","GMRCGUIA",192,0)
 ;
"RTN","GMRCGUIA",193,0)
 D GETRSLT^GMRCART(TMPGLOB)
"RTN","GMRCGUIA",194,0)
 ;
"RTN","GMRCGUIA",195,0)
 D EXIT
"RTN","GMRCGUIA",196,0)
 Q
"RTN","GMRCGUIA",197,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",198,0)
 K GMRCA,GMRCDVL,GMRCSR,GMRCRTFL,GMRCFL,GMRCORNP,GMRCQUT,GMRCSTS,GMRCTUFN
"RTN","GMRCGUIA",199,0)
 K GMRCRTFL,GMRCADUZ,GMRCORTX
"RTN","GMRCGUIA",200,0)
 Q
"VER")
8.0^22.2
"BLD",10830,6)
^95
**END**
**END**

