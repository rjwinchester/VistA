KIDS Distribution saved on Oct 14, 2015@14:49:45
GMRC*3.0*81
**KIDS**:GMRC*3.0*81^

**INSTALL NAME**
GMRC*3.0*81
"BLD",9224,0)
GMRC*3.0*81^CONSULT/REQUEST TRACKING^0^3151014^y
"BLD",9224,1,0)
^^2^2^3141218^
"BLD",9224,1,1,0)
Handles the GMRC portion of changing EARLIEST DATE in 123 to CLINICIALLY 
"BLD",9224,1,2,0)
INDICATED DATE.
"BLD",9224,4,0)
^9.64PA^123^1
"BLD",9224,4,123,0)
123
"BLD",9224,4,123,2,0)
^9.641^123^1
"BLD",9224,4,123,2,123,0)
REQUEST/CONSULTATION  (File-top level)
"BLD",9224,4,123,2,123,1,0)
^9.6411^17^1
"BLD",9224,4,123,2,123,1,17,0)
CLINICALLY INDICATED DATE
"BLD",9224,4,123,222)
y^n^p^^^^n^^n
"BLD",9224,4,123,224)

"BLD",9224,4,"APDD",123,123)

"BLD",9224,4,"APDD",123,123,17)

"BLD",9224,4,"B",123,123)

"BLD",9224,6.3)
6
"BLD",9224,"ABPKG")
n
"BLD",9224,"INI")

"BLD",9224,"INID")
^^
"BLD",9224,"KRN",0)
^9.67PA^779.2^20
"BLD",9224,"KRN",.4,0)
.4
"BLD",9224,"KRN",.401,0)
.401
"BLD",9224,"KRN",.402,0)
.402
"BLD",9224,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9224,"KRN",.402,"NM",1,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",9224,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",1)

"BLD",9224,"KRN",.403,0)
.403
"BLD",9224,"KRN",.5,0)
.5
"BLD",9224,"KRN",.84,0)
.84
"BLD",9224,"KRN",3.6,0)
3.6
"BLD",9224,"KRN",3.8,0)
3.8
"BLD",9224,"KRN",9.2,0)
9.2
"BLD",9224,"KRN",9.8,0)
9.8
"BLD",9224,"KRN",9.8,"NM",0)
^9.68A^13^11
"BLD",9224,"KRN",9.8,"NM",1,0)
GMRCEDT1^^0^B69352507
"BLD",9224,"KRN",9.8,"NM",2,0)
GMRCEDT3^^0^B21946009
"BLD",9224,"KRN",9.8,"NM",3,0)
GMRCEDT4^^0^B85509564
"BLD",9224,"KRN",9.8,"NM",4,0)
GMRCGUIC^^0^B68545414
"BLD",9224,"KRN",9.8,"NM",5,0)
GMRCGUIU^^0^B30326787
"BLD",9224,"KRN",9.8,"NM",6,0)
GMRCHL7^^0^B31393339
"BLD",9224,"KRN",9.8,"NM",7,0)
GMRCHL7A^^0^B31527698
"BLD",9224,"KRN",9.8,"NM",10,0)
GMRCP5B^^0^B43503817
"BLD",9224,"KRN",9.8,"NM",11,0)
GMRCSLM2^^0^B92923527
"BLD",9224,"KRN",9.8,"NM",12,0)
GMRCSTL7^^0^B108615335
"BLD",9224,"KRN",9.8,"NM",13,0)
GMRCSTL8^^0^B111506461
"BLD",9224,"KRN",9.8,"NM","B","GMRCEDT1",1)

"BLD",9224,"KRN",9.8,"NM","B","GMRCEDT3",2)

"BLD",9224,"KRN",9.8,"NM","B","GMRCEDT4",3)

"BLD",9224,"KRN",9.8,"NM","B","GMRCGUIC",4)

"BLD",9224,"KRN",9.8,"NM","B","GMRCGUIU",5)

"BLD",9224,"KRN",9.8,"NM","B","GMRCHL7",6)

"BLD",9224,"KRN",9.8,"NM","B","GMRCHL7A",7)

"BLD",9224,"KRN",9.8,"NM","B","GMRCP5B",10)

"BLD",9224,"KRN",9.8,"NM","B","GMRCSLM2",11)

"BLD",9224,"KRN",9.8,"NM","B","GMRCSTL7",12)

"BLD",9224,"KRN",9.8,"NM","B","GMRCSTL8",13)

"BLD",9224,"KRN",19,0)
19
"BLD",9224,"KRN",19,"NM",0)
^9.68A^^
"BLD",9224,"KRN",19.1,0)
19.1
"BLD",9224,"KRN",101,0)
101
"BLD",9224,"KRN",409.61,0)
409.61
"BLD",9224,"KRN",771,0)
771
"BLD",9224,"KRN",779.2,0)
779.2
"BLD",9224,"KRN",870,0)
870
"BLD",9224,"KRN",8989.51,0)
8989.51
"BLD",9224,"KRN",8989.52,0)
8989.52
"BLD",9224,"KRN",8994,0)
8994
"BLD",9224,"KRN","B",.4,.4)

"BLD",9224,"KRN","B",.401,.401)

"BLD",9224,"KRN","B",.402,.402)

"BLD",9224,"KRN","B",.403,.403)

"BLD",9224,"KRN","B",.5,.5)

"BLD",9224,"KRN","B",.84,.84)

"BLD",9224,"KRN","B",3.6,3.6)

"BLD",9224,"KRN","B",3.8,3.8)

"BLD",9224,"KRN","B",9.2,9.2)

"BLD",9224,"KRN","B",9.8,9.8)

"BLD",9224,"KRN","B",19,19)

"BLD",9224,"KRN","B",19.1,19.1)

"BLD",9224,"KRN","B",101,101)

"BLD",9224,"KRN","B",409.61,409.61)

"BLD",9224,"KRN","B",771,771)

"BLD",9224,"KRN","B",779.2,779.2)

"BLD",9224,"KRN","B",870,870)

"BLD",9224,"KRN","B",8989.51,8989.51)

"BLD",9224,"KRN","B",8989.52,8989.52)

"BLD",9224,"KRN","B",8994,8994)

"BLD",9224,"QUES",0)
^9.62^^
"BLD",9224,"REQB",0)
^9.611^6^5
"BLD",9224,"REQB",2,0)
GMRC*3.0*76^2
"BLD",9224,"REQB",3,0)
GMRC*3.0*73^2
"BLD",9224,"REQB",4,0)
GMRC*3.0*66^2
"BLD",9224,"REQB",5,0)
OR*3.0*350^2
"BLD",9224,"REQB",6,0)
GMRC*3.0*85^2
"BLD",9224,"REQB","B","GMRC*3.0*66",4)

"BLD",9224,"REQB","B","GMRC*3.0*73",3)

"BLD",9224,"REQB","B","GMRC*3.0*76",2)

"BLD",9224,"REQB","B","GMRC*3.0*85",6)

"BLD",9224,"REQB","B","OR*3.0*350",5)

"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^n^p^^^^n^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,17)

"KRN",.402,1350,-1)
0^1
"KRN",.402,1350,0)
GMRC SETUP REQUEST SERVICE^3150225.0609^^123.5^^^3151014
"KRN",.402,1350,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.5134,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.54,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.57,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.58,0)
ALL
"KRN",.402,1350,"DIAB",1,1,123.59,0)
ALL
"KRN",.402,1350,"DIAB",6,0,123.5,3)
PRINT NAME;"ABBREVIATED PRINT NAME (Optional)~"
"KRN",.402,1350,"DR",1,123.5)
I '$D(GMRCSAFE) D EN^DDIOL("Editing of this file should only be done via the Setup Request Services option.") S Y="";
"KRN",.402,1350,"DR",1,123.5,1)
I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL("Service is configured to receive inter-facility consults from another facility.","","!!");
"KRN",.402,1350,"DR",1,123.5,2)
I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL("Editing of the SERVICE NAME may disrupt inter-facility consult operations.","","!");D EN^DDIOL(" ") I $G(GMRCSAFE) S Y=123.01;
"KRN",.402,1350,"DR",1,123.5,3)
S:$P(^GMR(123.5,DA,0),U)="SUICIDE HOTLINE"!($P(^GMR(123.5,DA,0),U)="CARE COORDINATION HOME TELEHEALTH SCREENING") Y="@1";.01;@1;123.01///^S X="CONSULTS";I $G(GMRCSAFE) S Y=1.1;1.11ABBREVIATED PRINT NAME (Optional)~~;11;1.1;
"KRN",.402,1350,"DR",1,123.5,4)
123.03///^S X="GMRCACTM SERVICE ACTION MENU";2;123.09;1.04;1.05;125;I $G(GMRCSAFE) S Y=123.08;1.01;1.02;124;1.03;D EN^DDIOL(" ");D EN^DDIOL("Inter-facility information");I $O(^GMR(123.5,DA,"IFCS",0)) D EN^DDIOL(" ") S Y=134;132;
"KRN",.402,1350,"DR",1,123.5,5)
133;I +$G(^GMR(123.5,DA,"IFC")) D EN^DDIOL(" ") S Y=123.08;134;D EN^DDIOL(" ");123.08;123.1;123.2;.08;123.3;123.31;123.35;123.33;123.34;.07;D EN^DDIOL(" ");123.5;1.06;.06;10;
"KRN",.402,1350,"DR",1,123.5,6)
S:$P(^GMR(123.5,DA,0),U)="ALL SERVICES"!($P(^GMR(123.5,DA,0),U)="SUICIDE HOTLINE") Y=0;150;
"KRN",.402,1350,"DR",2,123.51)
.01:2
"KRN",.402,1350,"DR",2,123.5134)
.01
"KRN",.402,1350,"DR",2,123.52)
.01
"KRN",.402,1350,"DR",2,123.53)
.01
"KRN",.402,1350,"DR",2,123.54)
.01:2
"KRN",.402,1350,"DR",2,123.55)
.01;
"KRN",.402,1350,"DR",2,123.555)
.01:.02
"KRN",.402,1350,"DR",2,123.57)
.01
"KRN",.402,1350,"DR",2,123.58)
.01:.02
"KRN",.402,1350,"DR",2,123.59)
.01
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",294,-1)
1^1
"PKG",294,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",294,20,0)
^9.402P^^
"PKG",294,22,0)
^9.49I^1^1
"PKG",294,22,1,0)
3.0^2980101^2980917^11712
"PKG",294,22,1,"PAH",1,0)
81^3151014^10000000199
"PKG",294,22,1,"PAH",1,1,0)
^^2^2^3151014
"PKG",294,22,1,"PAH",1,1,1,0)
Handles the GMRC portion of changing EARLIEST DATE in 123 to CLINICIALLY 
"PKG",294,22,1,"PAH",1,1,2,0)
INDICATED DATE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","GMRCEDT1")
0^1^B69352507
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM,JFR - EDIT A CONSULT AND RE-SEND AS NEW ;10/14/15  11:53
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33,47,66,73,85,81**;DEC 27, 1997;Build 6
"RTN","GMRCEDT1",3,0)
 ;
"RTN","GMRCEDT1",4,0)
 ; This routine invokes IA #2638 (^ORD(100.01,), #5699 (ICDXCODE), #10117 (VALM10)
"RTN","GMRCEDT1",5,0)
 ;                         #10103 (XLFDT), #10104 (XLFSTR), #10060 (access ^VA(200)), #2056 (GET1^DIQ)
"RTN","GMRCEDT1",6,0)
 ;
"RTN","GMRCEDT1",7,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",8,0)
 ;GMRCSS=To Service   GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",9,0)
 ;GMRCURG=Urgency     GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",10,0)
 ;GMRCATN=Attention   GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",11,0)
 ;GMRCPNM=Patient Name  GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",12,0)
 ;GMRCERDT=Clinically Indicated Date
"RTN","GMRCEDT1",13,0)
 ;GMRCPROS=Prosthetics Service y/n
"RTN","GMRCEDT1",14,0)
 ;GMRCCPTR=pointer to coding systems file
"RTN","GMRCEDT1",15,0)
 ;GMRCCSYS=provisional diagnosis code sys    GMRCCODE=provisional diagnosis code
"RTN","GMRCEDT1",16,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCINO,GMRCDIAG,LN,GMRCRESP,GMRCERDT,GMRCPROS,IDX,GMRCDATE,GMRCCSYS,GMRCCODE
"RTN","GMRCEDT1",17,0)
 N GMRCLBL,BUFFER,REPEAT
"RTN","GMRCEDT1",18,0)
 S REPEAT=24
"RTN","GMRCEDT1",19,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",20,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",12)) S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CURRENT STATUS: (Not Editable): "_$P(^ORD(100.01,$P(^(0),"^",12),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",21,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",22,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",23,0)
 ..N GMRCPERS,GMRCTX
"RTN","GMRCEDT1",24,0)
 ..I '$D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",25,0)
 ...S GMRCPERS=+$P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),"^",5)
"RTN","GMRCEDT1",26,0)
 ...S GMRCPERS=$$GET1^DIQ(200,GMRCPERS,.01)
"RTN","GMRCEDT1",27,0)
 ..I $D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",28,0)
 ...I $P(^GMR(123,+GMRCO,12),U,5)="P" D
"RTN","GMRCEDT1",29,0)
 ....S GMRCPERS=$P($G(^GMR(123,+GMRCO,40,GMRCDD,2)),U,1)
"RTN","GMRCEDT1",30,0)
 ...I $P(^GMR(123,+GMRCO,12),U,5)="F" D
"RTN","GMRCEDT1",31,0)
 ....S GMRCPERS=$P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),U,5)
"RTN","GMRCEDT1",32,0)
 ....S GMRCPERS=$$GET1^DIQ(200,GMRCPERS,.01)
"RTN","GMRCEDT1",33,0)
 ..S GMRCTX="  CANCELLED BY (Not Editable): "_GMRCPERS
"RTN","GMRCEDT1",34,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=GMRCTX,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",35,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED COMMENT (Not Editable):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",36,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",37,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",38,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",$P(^(0),"-",79)=""
"RTN","GMRCEDT1",39,0)
 ..S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",40,0)
 ..Q
"RTN","GMRCEDT1",41,0)
 .Q
"RTN","GMRCEDT1",42,0)
 S GMRCSS=$S($D(GMRCEDT(1)):GMRCEDT(1),1:$P(^GMR(123,+GMRCO,0),"^",5)_U_$P(^GMR(123.5,$P(^GMR(123,+GMRCO,0),"^",5),0),U))
"RTN","GMRCEDT1",43,0)
 S GMRCPROC=$S($D(GMRCED(1)):GMRCED(1),1:$P(^GMR(123,+GMRCO,0),"^",8)_U_$$GET1^DIQ(123.3,+$P(^GMR(123,+GMRCO,0),"^",8),.01))
"RTN","GMRCEDT1",44,0)
 I $D(GMRCED(2)) S GMRCINO=GMRCED(2)
"RTN","GMRCEDT1",45,0)
 I '$D(GMRCINO) S GMRCINO=$P(^GMR(123,+GMRCO,0),U,18)_U_$S($P(^(0),U,18)="I":"Inpatient",1:"Outpatient")
"RTN","GMRCEDT1",46,0)
 S GMRCURG=$S($D(GMRCED(3)):GMRCED(3),1:$P(^GMR(123,+GMRCO,0),"^",9)_U_$$GET1^DIQ(101,+$P(^(0),"^",9),1))
"RTN","GMRCEDT1",47,0)
 S GMRCPL=$S($D(GMRCED(4)):GMRCED(4),1:$P(^GMR(123,+GMRCO,0),"^",10)_U_$$GET1^DIQ(101,+$P(^(0),U,10),1))
"RTN","GMRCEDT1",48,0)
 S GMRCPROS=$G(^GMR(123.5,$P(GMRCSS,U),"INT")) I $G(GMRCPROS)="" D
"RTN","GMRCEDT1",49,0)
 .S GMRCERDT=$S($D(GMRCED(5)):GMRCED(5),1:$P(^GMR(123,+GMRCO,0),"^",24)_U_$$FMTE^XLFDT($P(^GMR(123,GMRCO,0),U,24)))
"RTN","GMRCEDT1",50,0)
 S GMRCATN=$S($D(GMRCED(6)):GMRCED(6),1:$P(^GMR(123,+GMRCO,0),"^",11)_U_$$GET1^DIQ(200,+$P(^(0),U,11),.01))
"RTN","GMRCEDT1",51,0)
 I '$D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",52,0)
 . I $D(GMRCED(7)),$L($P(GMRCED(7),U,2)) D  Q
"RTN","GMRCEDT1",53,0)
 .. S GMRCDIAG=$P(GMRCED(7),U)_" ("_$P(GMRCED(7),U,2)_")"
"RTN","GMRCEDT1",54,0)
 . S GMRCDIAG=$S($D(GMRCED(7)):GMRCED(7),1:$G(^GMR(123,+GMRCO,30)))
"RTN","GMRCEDT1",55,0)
 I $D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",56,0)
 . S GMRCCODE=$P($G(^GMR(123,+GMRCO,30.1)),"^",1)
"RTN","GMRCEDT1",57,0)
 . S GMRCCSYS=$P($G(^GMR(123,+GMRCO,30.1)),"^",3)
"RTN","GMRCEDT1",58,0)
 . S:$G(GMRCCSYS)="ICD" GMRCLBL="(ICD-9-CM "_$G(GMRCCODE)_")"
"RTN","GMRCEDT1",59,0)
 . S:$G(GMRCCSYS)="10D" GMRCLBL="(ICD-10-CM "_$G(GMRCCODE)_")"
"RTN","GMRCEDT1",60,0)
 . I $D(GMRCED(7)),$L(GMRCED(7)) D  Q
"RTN","GMRCEDT1",61,0)
 .. S GMRCDIAG=$P(GMRCED(7),U)
"RTN","GMRCEDT1",62,0)
 .. S GMRCCODE=$P(GMRCED(7),U,2)
"RTN","GMRCEDT1",63,0)
 .. S GMRCCSYS=$$CODECS^ICDEX($G(GMRCCODE),80) ;WAT/85 use dx code to get coding system
"RTN","GMRCEDT1",64,0)
 .. S GMRCLBL="" ;just in case coding system is null
"RTN","GMRCEDT1",65,0)
 .. S:GMRCCSYS="ICD" GMRCLBL="(ICD-9-CM "_GMRCCODE_")"
"RTN","GMRCEDT1",66,0)
 .. S:GMRCCSYS="10D" GMRCLBL="(ICD-10-CM "_GMRCCODE_")"
"RTN","GMRCEDT1",67,0)
 .. S GMRCDIAG=$G(GMRCDIAG)_$G(GMRCLBL)
"RTN","GMRCEDT1",68,0)
 . S GMRCDIAG=$G(^GMR(123,+GMRCO,30))_$G(GMRCLBL)
"RTN","GMRCEDT1",69,0)
 S GMRCREQ=$S(+$P(^GMR(123,+GMRCO,0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCEDT1",70,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="SENDING PROVIDER (Not Editable): "_$S($P($G(^GMR(123,+GMRCO,12)),U,6):$P(^GMR(123,+GMRCO,12),U,6),$P(^GMR(123,+GMRCO,0),"^",14):$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",14),.01),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",71,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="REQUEST TYPE (Not Editable): "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",72,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR("-",79),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",73,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  TO SERVICE (Not Editable): "_$P(GMRCSS,U,2) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",74,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=" ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",75,0)
 S IDX=1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" PROCEDURE: "_$P(GMRCPROC,U,2)
"RTN","GMRCEDT1",76,0)
 D:+GMRCPROC RVRS(GMRCLNO,$D(GMRCED(IDX))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",77,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" Performed as INPT OR OUTPT: "_$P(GMRCINO,U,2) D RVRS(GMRCLNO,$D(GMRCED(2))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",78,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" URGENCY: "_$P(GMRCURG,U,2) D RVRS(GMRCLNO,$D(GMRCED(3))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",79,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" PLACE OF CONSULTATION: "_$P(GMRCPL,U,2) D RVRS(GMRCLNO,$D(GMRCED(4))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",80,0)
 I $G(GMRCPROS)="" S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" CLINICALLY INDICATED DATE: "_$P(GMRCERDT,U,2) D RVRS(GMRCLNO,$D(GMRCED(5))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",81,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" ATTENTION (CONSULTANT): "_$P(GMRCATN,U,2) D RVRS(GMRCLNO,$D(GMRCED(6))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",82,0)
 I $L($G(GMRCDIAG))<55 S:$G(FLG)="" ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" PROVISIONAL DIAGNOSIS: "_GMRCDIAG D RVRS(GMRCLNO,$D(GMRCED(7))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1
"RTN","GMRCEDT1",83,0)
 I $L($G(GMRCDIAG))>54 D
"RTN","GMRCEDT1",84,0)
 .N PIECE,FLG S FLG=0
"RTN","GMRCEDT1",85,0)
 .F  S PIECE=$L(GMRCDIAG) Q:PIECE<54  D
"RTN","GMRCEDT1",86,0)
 .. N SEG,I S I=2
"RTN","GMRCEDT1",87,0)
 .. F  S SEG=$P(GMRCDIAG," ",1,I) Q:$L(SEG)>=54!($L(SEG," ")<I)  S I=I+1
"RTN","GMRCEDT1",88,0)
 .. I $L(SEG)=$L(GMRCDIAG) S SEG=$E(GMRCDIAG,1,54) ;means GMRCDIAG doesn't contain spaces, e.g. v55,250.00,414.00,etc.
"RTN","GMRCEDT1",89,0)
 .. S BUFFER=SEG
"RTN","GMRCEDT1",90,0)
 .. S:SEG[" " SEG=$P(GMRCDIAG," ",1,(I-1)) I $L(SEG)=0 S SEG=$E(BUFFER,1,54) ;$P only good when SEG contains a space, otherwise grab a SEG from BUFFER
"RTN","GMRCEDT1",91,0)
 .. D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",92,0)
 .. S:FLG=0 ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" PROVISIONAL DIAGNOSIS: "_SEG D RVRS(GMRCLNO,$D(GMRCED(7)))
"RTN","GMRCEDT1",93,0)
 .. I FLG=1&($F(GMRCDIAG," ")'=2) S REPEAT=25
"RTN","GMRCEDT1",94,0)
 .. S:FLG=1 ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR(" ",REPEAT)_SEG
"RTN","GMRCEDT1",95,0)
 .. S FLG=1,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",96,0)
 .. S GMRCDIAG=$E(GMRCDIAG,$L(SEG)+1,999)
"RTN","GMRCEDT1",97,0)
 . I $F(GMRCD," ")'=2 S REPEAT=25
"RTN","GMRCEDT1",98,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR(" ",REPEAT)_GMRCDIAG
"RTN","GMRCEDT1",99,0)
 . S IDX=IDX+1,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",100,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" REASON FOR REQUEST:" D RVRS(GMRCLNO,$D(^TMP("GMRCED",$J,20))) S GMRCLNO=GMRCLNO+1,IDX=IDX+1 D
"RTN","GMRCEDT1",101,0)
 . I $D(^TMP("GMRCED",$J,20)) D  Q
"RTN","GMRCEDT1",102,0)
 .. N ND S ND=0
"RTN","GMRCEDT1",103,0)
 .. F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT1",104,0)
 ... D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",105,0)
 ... S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT1",106,0)
 ... S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",107,0)
 . N ND S ND=0
"RTN","GMRCEDT1",108,0)
 . F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  D
"RTN","GMRCEDT1",109,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0)
"RTN","GMRCEDT1",110,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",111,0)
 .Q
"RTN","GMRCEDT1",112,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)=IDX_" COMMENT(S): (Add Only)" D RVRS(GMRCLNO) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",113,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT1",114,0)
 . D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",115,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  New Comment:",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",116,0)
 . N ND S ND=0 F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT1",117,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT1",118,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",119,0)
 N GMRCEDCT
"RTN","GMRCEDT1",120,0)
 S GMRCD=0,GMRCEDCT=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",121,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCT=GMRCEDCT+1,GMRCEDCM(GMRCEDCT)=GMRCDD D
"RTN","GMRCEDT1",122,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="ADDED COMMENT (Not Editable) Entered: "_$P($$FMTE^XLFDT($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",1)),"@",1)
"RTN","GMRCEDT1",123,0)
 ..S GMRCRESP=$S($L($P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),"^",5)):$$GET1^DIQ(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5),.01),$L($P($G(^GMR(123,+GMRCO,40,GMRCDD,2)),"^",1)):$P(^GMR(123,+GMRCO,40,GMRCDD,2),"^",1),1:"UNKNOWN")
"RTN","GMRCEDT1",124,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_GMRCRESP,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",125,0)
 ..;S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_$S($L($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4),0),"^",1),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",126,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",127,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",128,0)
 ..Q
"RTN","GMRCEDT1",129,0)
 .Q
"RTN","GMRCEDT1",130,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=""
"RTN","GMRCEDT1",131,0)
 K FLG
"RTN","GMRCEDT1",132,0)
 Q
"RTN","GMRCEDT1",133,0)
RVRS(LINE,EDITED) ;reverse video for fields that can be edited
"RTN","GMRCEDT1",134,0)
 I '$G(EDITED) D CNTRL^VALM10(LINE,1,1,IORVON,IORVOFF) Q
"RTN","GMRCEDT1",135,0)
 D CNTRL^VALM10(LINE,1,1,IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","GMRCEDT1",136,0)
 Q
"RTN","GMRCEDT3")
0^2^B21946009
"RTN","GMRCEDT3",1,0)
GMRCEDT3 ;SLC/DCM,JFR - file edit/resubmit ;12/10/14  14:42
"RTN","GMRCEDT3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,15,22,66,73,81**;DEC 27, 1997;Build 6
"RTN","GMRCEDT3",3,0)
 ;
"RTN","GMRCEDT3",4,0)
 ;IRCS in use: #2053 (DIE), #2056 (GET1^DIQ), #10103 (XLFDT), #10104 (XLFSTR)
"RTN","GMRCEDT3",5,0)
 ;
"RTN","GMRCEDT3",6,0)
EN(GMRCDA) ;File tracking Data from array
"RTN","GMRCEDT3",7,0)
 W:'$D(GMRCGUIF) !,"Filing Tracking Data..."
"RTN","GMRCEDT3",8,0)
 N GMRCOUNT,GMRC40DA
"RTN","GMRCEDT3",9,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCEDT3",10,0)
 S DIE="^GMR(123,",DA=GMRCDA,DR="8////^S X=5" D ^DIE K DIE,DA,DR
"RTN","GMRCEDT3",11,0)
 I '$D(^GMR(123,GMRCDA,40,0)) S ^GMR(123,GMRCDA,40,0)="123.02^^"
"RTN","GMRCEDT3",12,0)
 S DA=$S(+$P(^GMR(123,GMRCDA,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCEDT3",13,0)
 S GMRC40DA=DA
"RTN","GMRCEDT3",14,0)
 S $P(^GMR(123,GMRCDA,40,0),"^",3,4)=DA_"^"_DA D
"RTN","GMRCEDT3",15,0)
 .S ^GMR(123,GMRCDA,40,DA,0)=GMRCDT_"^"_$O(^GMR(123.1,"B","EDIT/RESUBMITTED",0))_"^"_GMRCDT_"^"_DUZ_"^"_DUZ D
"RTN","GMRCEDT3",16,0)
 .S ^GMR(123,GMRCDA,40,DA,1,0)="^^^^"_GMRCDT_"^" D
"RTN","GMRCEDT3",17,0)
 ..S GMRCOUNT=1,GMRCND=0,^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$$REPEAT^XLFSTR("-",21)_" PREVIOUS VALUES OF EDITED FIELDS  "_$$REPEAT^XLFSTR("-",21),GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",18,0)
 ..I '$D(GMRCFLD) S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="No Fields Were Edited Before Resubmission",GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",19,0)
 ..F  S GMRCND=$O(GMRCFLD(GMRCND)) Q:GMRCND=""  D  S GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",20,0)
 ...I GMRCND=.1 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="DISPLAY TEXT OF ITEM ORDERED: "_$P(GMRCFLD(GMRCND),"^",1),GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",21,0)
 ...I GMRCND=1 D  S GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",22,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="To Service: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value")
"RTN","GMRCEDT3",23,0)
 ....Q
"RTN","GMRCEDT3",24,0)
 ...I GMRCND=4 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Procedure: "_$$GET1^DIQ(123.3,+GMRCFLD(4),.01) Q
"RTN","GMRCEDT3",25,0)
 ...I GMRCND=14 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Performed as Inpt or Outpt: "_$S($L($P(GMRCFLD(GMRCND),"^")):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",26,0)
 ...I $S(GMRCND=5:1,GMRCND=6:1,GMRCND=13:1,1:0) D  Q
"RTN","GMRCEDT3",27,0)
 ....N CAPTION S CAPTION=$S(GMRCND=5:"Urgency: ",GMRCND=6:"Place of Consultation: ",1:"Type of Request: ")
"RTN","GMRCEDT3",28,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=CAPTION_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value")
"RTN","GMRCEDT3",29,0)
 ...I GMRCND=7 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Attention: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",30,0)
 ...I GMRCND=17 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Clinically Indicated Date: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") ;wat/66/81
"RTN","GMRCEDT3",31,0)
 ...I GMRCND=20 N GMRCND1 S GMRCND1=0,GMRCOUNT=GMRCOUNT+1 D  Q
"RTN","GMRCEDT3",32,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Reason for Request: "
"RTN","GMRCEDT3",33,0)
 ....S GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",34,0)
 ....F  S GMRCND1=$O(@GMRCFLD(20)@(GMRCND1)) Q:GMRCND1=""  S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=@GMRCFLD(20)@(GMRCND1,0),GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",35,0)
 ...I GMRCND=30 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Provisional Diagnosis: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",36,0)
 ...I GMRCND=30.1 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Provisional Diagnosis Code: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",37,0)
 ...I GMRCND=30.2 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Provisional Diagnosis Date: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",38,0)
 ...I GMRCND=30.3 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Provisional Diagnosis System: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",39,0)
 ...I GMRCND=40 S ^GMR(123,+GMRCDA,40,DA,1,GMRCOUNT,0)=$P(GMRCFLD(GMRCND),"^",1) Q
"RTN","GMRCEDT3",40,0)
 ...Q
"RTN","GMRCEDT3",41,0)
 ..Q
"RTN","GMRCEDT3",42,0)
 .S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$$REPEAT^XLFSTR("-",75),GMRCOUNT=GMRCOUNT-1,^GMR(123,+GMRCDA,40,"B",GMRCDT,DA)=""
"RTN","GMRCEDT3",43,0)
 .S $P(^GMR(123,GMRCDA,40,DA,1,0),"^",3)=GMRCOUNT-1,$P(^(0),"^",4)=GMRCOUNT-1,^GMR(123,+GMRCDA,40,"B",GMRCDT,DA)=""
"RTN","GMRCEDT3",44,0)
 .Q
"RTN","GMRCEDT3",45,0)
 K GMRCIND,GMRCND
"RTN","GMRCEDT3",46,0)
 Q GMRC40DA
"RTN","GMRCEDT3",47,0)
 ;
"RTN","GMRCEDT3",48,0)
ADDCM(GMRCO) ;set up to add comment when none exists or to add a new comment
"RTN","GMRCEDT3",49,0)
 ;returns DA for the entry it sets up
"RTN","GMRCEDT3",50,0)
 N X
"RTN","GMRCEDT3",51,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^" S X=$S($P(^GMR(123,GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCEDT3",52,0)
 S $P(^GMR(123,GMRCO,40,0),"^",3,4)=X_"^"_X
"RTN","GMRCEDT3",53,0)
 Q X
"RTN","GMRCEDT3",54,0)
 ;
"RTN","GMRCEDT3",55,0)
AUDIT0(DA,GMRCDA) ;Add the necessary tracking information to word processing fields
"RTN","GMRCEDT3",56,0)
 N DIE,DR
"RTN","GMRCEDT3",57,0)
 S DIE="^GMR(123,"_GMRCDA_",40,",DA(1)=GMRCDA,DR=".01////^S X=$$NOW^XLFDT;1////^S X=GMRCA;2////^S X=$$NOW^XLFDT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCEDT3",58,0)
 D ^DIE
"RTN","GMRCEDT3",59,0)
 Q
"RTN","GMRCEDT4")
0^3^B85509564
"RTN","GMRCEDT4",1,0)
GMRCEDT4 ;SLC/DCM,JFR - UTILITIES FOR EDITING FIELDS ;10/14/15  11:51
"RTN","GMRCEDT4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33,66,73,85,81**;DEC 27, 1997;Build 6
"RTN","GMRCEDT4",3,0)
 ;
"RTN","GMRCEDT4",4,0)
 ; This routine invokes IA #5747 (ICDEX), #872 (ORD(101)), #10142 (DDIOL), #10006 (DIC)
"RTN","GMRCEDT4",5,0)
 ;                         #2051 (FIND1^DIC), #2056 (GET1^DIQ), #10026 (DIR), #10028 (DIWE), #5679 (LEXU)
"RTN","GMRCEDT4",6,0)
 ;                         #1572 (LEX(757.01), #1609 (CONFIG^LEXSET), #10103 (XLFDT), #10104 (XLFSTR), #10140 (XQORM)
"RTN","GMRCEDT4",7,0)
 ;
"RTN","GMRCEDT4",8,0)
 Q
"RTN","GMRCEDT4",9,0)
EDITFLD(GMRCO)    ;edit field in file 123.
"RTN","GMRCEDT4",10,0)
 ;GMRCO=IEN of consult record in file 123
"RTN","GMRCEDT4",11,0)
 N DIR,X,Y,GMRCSS,GMRCPROC,GMRCPROC,GMRCURG,GMRCPL,GMRCREND,GMRCY,GMRCX
"RTN","GMRCEDT4",12,0)
 N GMRCMSG,GMRCTAG
"RTN","GMRCEDT4",13,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT4",14,0)
 .S GMRCMSG="This consult is no longer editable." D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",15,0)
 S GMRCMSG=$$EDRESOK^GMRCEDT2(GMRCO)
"RTN","GMRCEDT4",16,0)
 I '+GMRCMSG D EXAC^GMRCADC($P(GMRCMSG,U,2)) Q
"RTN","GMRCEDT4",17,0)
 ;patch 85 removed call to $$PDOK(GMRCO)
"RTN","GMRCEDT4",18,0)
 S DIR(0)="LAO^1:9",DIR("A")="Select the fields to edit: "
"RTN","GMRCEDT4",19,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCEDT4",20,0)
 I $P(Y,",")<1 Q
"RTN","GMRCEDT4",21,0)
 S GMRCY=Y
"RTN","GMRCEDT4",22,0)
 F GMRCX=1:1:9 S GMRCTAG=$P(GMRCY,",",GMRCX) Q:'GMRCTAG  D
"RTN","GMRCEDT4",23,0)
 . D SETUP
"RTN","GMRCEDT4",24,0)
 . D @GMRCTAG
"RTN","GMRCEDT4",25,0)
 . K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCEDT4",26,0)
 . D EN^GMRCEDT1(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT4",27,0)
 Q
"RTN","GMRCEDT4",28,0)
SETUP   ;get info needed for edit (save global reads)
"RTN","GMRCEDT4",29,0)
 S:$D(GMRCEDT(1)) GMRCSS=GMRCEDT(1)
"RTN","GMRCEDT4",30,0)
 I '$D(GMRCSS) S GMRCSS=$P(^GMR(123,+GMRCO,0),U,5),GMRCSS=GMRCSS_U_$P(^GMR(123.5,GMRCSS,0),U)
"RTN","GMRCEDT4",31,0)
 S:$D(GMRCED(1)) GMRCPROC=GMRCED(1)
"RTN","GMRCEDT4",32,0)
 I '$D(GMRCPROC) S GMRCPROC=+$P(^GMR(123,+GMRCO,0),U,8),GMRCPROC=GMRCPROC_U_$$GET1^DIQ(123.3,+GMRCPROC,.01)
"RTN","GMRCEDT4",33,0)
 S:$D(GMRCED(2)) GMRCREND=GMRCED(2)
"RTN","GMRCEDT4",34,0)
 I '$D(GMRCREND) S GMRCREND=$P(^GMR(123,GMRCO,0),U,18),GMRCREND=GMRCREND_U_$S(GMRCREND="I":"In",1:"Out")_"patient"
"RTN","GMRCEDT4",35,0)
 S:$D(GMRCED(3)) GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",36,0)
 I '$D(GMRCURG) S GMRCURG=$P(^GMR(123,+GMRCO,0),U,9),GMRCURG=GMRCURG_U_$$GET1^DIQ(101,+GMRCURG,1)
"RTN","GMRCEDT4",37,0)
 S:$D(GMRCED(4)) GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",38,0)
 I '$D(GMRCPL) S GMRCPL=$P(^GMR(123,+GMRCO,0),U,10),GMRCPL=GMRCPL_U_$$GET1^DIQ(101,+GMRCPL,1)
"RTN","GMRCEDT4",39,0)
 Q
"RTN","GMRCEDT4",40,0)
01       ;edit TO SERVICE
"RTN","GMRCEDT4",41,0)
 N I,PROCSERV,DIR,X,Y
"RTN","GMRCEDT4",42,0)
 I $G(GMRCPROC) D  Q:'PROCSERV
"RTN","GMRCEDT4",43,0)
 . N I S I=0,PROCSERV=0 F  S I=$O(^GMR(123.3,+GMRCPROC,2,"B",I)) Q:'I  D
"RTN","GMRCEDT4",44,0)
 .. S PROCSERV(I)="",PROCSERV=PROCSERV+1
"RTN","GMRCEDT4",45,0)
 . I PROCSERV=1 W !,"Only one SERVICE can perform this procedure.",!
"RTN","GMRCEDT4",46,0)
 S DIR(0)="PA^123.5:EMQ"
"RTN","GMRCEDT4",47,0)
 I $G(PROCSERV) D
"RTN","GMRCEDT4",48,0)
 . I $D(PROCSERV(+GMRCSS)) Q
"RTN","GMRCEDT4",49,0)
 . S DIR("B")=$$GET1^DIQ(123.5,$O(PROCSERV(0)),.01)
"RTN","GMRCEDT4",50,0)
 I '$D(DIR("B")) S DIR("B")=$P(GMRCSS,U,2)
"RTN","GMRCEDT4",51,0)
 S DIR("A")="Select the Service to perform this request: "
"RTN","GMRCEDT4",52,0)
 S DIR("S")="I $P(^(0),U,2)<1" ;naked reference for ^GMR(123.5
"RTN","GMRCEDT4",53,0)
 I +$G(GMRCPROC) S DIR("S")=DIR("S")_",$D(PROCSERV(+Y))"
"RTN","GMRCEDT4",54,0)
 S DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCEDT4",55,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",56,0)
 I Y<1!(+Y=+GMRCSS) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",57,0)
 S GMRCEDT(1)=Y,GMRCSS=Y
"RTN","GMRCEDT4",58,0)
 Q
"RTN","GMRCEDT4",59,0)
1 ;edit Procedure
"RTN","GMRCEDT4",60,0)
 W !,$C(7),"The procedure associated with a request may not be changed."
"RTN","GMRCEDT4",61,0)
 W !,"Place a new request if a different procedure is desired"
"RTN","GMRCEDT4",62,0)
 H 2
"RTN","GMRCEDT4",63,0)
 Q
"RTN","GMRCEDT4",64,0)
2       ;edit service rendered
"RTN","GMRCEDT4",65,0)
 N DIR,X,Y,GMRCURSV,GMRCPLSV,GMRCED4,GMRCED5,RENDED
"RTN","GMRCEDT4",66,0)
 S DIR(0)="S:A^I:Inpatient;O:Outpatient",DIR("B")=$P(GMRCREND,U,2)
"RTN","GMRCEDT4",67,0)
 S DIR("A")="Service to be performed Inpatient or Outpatient: "
"RTN","GMRCEDT4",68,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",69,0)
 I Y'=$P(GMRCREND,U) S RENDED=Y_U_Y(0)
"RTN","GMRCEDT4",70,0)
 I '$D(RENDED) Q
"RTN","GMRCEDT4",71,0)
 I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",72,0)
 . N GMRCREND,CHGIO S GMRCREND=RENDED
"RTN","GMRCEDT4",73,0)
 . W $C(7),!!,"The urgency of this request is no longer valid.",!
"RTN","GMRCEDT4",74,0)
 . S GMRCURSV=GMRCURG S:$D(GMRCED(3)) GMRCED3=GMRCED(3)
"RTN","GMRCEDT4",75,0)
 . S CHGREND="" D 3
"RTN","GMRCEDT4",76,0)
 . I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  Q
"RTN","GMRCEDT4",77,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",78,0)
 .. K RENDED S GMRCURG=GMRCURSV S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",79,0)
 I '$$VALIDPL(GMRCPL,RENDED) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",80,0)
 . N GMRCREND,CHGREND S GMRCREND=RENDED
"RTN","GMRCEDT4",81,0)
 . W $C(7),!!,"The Place of Consultation is no longer valid.",!
"RTN","GMRCEDT4",82,0)
 . S GMRCPLSV=GMRCPL S:$D(GMRCED(4)) GMRCED4=GMRCED(4) S CHGREND="" D 4
"RTN","GMRCEDT4",83,0)
 . I '$$VALIDPL(GMRCPL,RENDED) D  Q
"RTN","GMRCEDT4",84,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",85,0)
 .. K RENDED S GMRCPL=GMRCPLSV S:$D(GMRCED4) GMRCED(4)=GMRCED4
"RTN","GMRCEDT4",86,0)
 .. S:$D(GMRCURSV) GMRCURG=GMRCURSV
"RTN","GMRCEDT4",87,0)
 .. S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",88,0)
 S (GMRCREND,GMRCED(2))=RENDED
"RTN","GMRCEDT4",89,0)
 Q
"RTN","GMRCEDT4",90,0)
3 ;edit urgency
"RTN","GMRCEDT4",91,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",92,0)
 I $P(GMRCREND,U)="O" S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM - OUTPATIENT")
"RTN","GMRCEDT4",93,0)
 I '$D(Y) D  ;inpatient
"RTN","GMRCEDT4",94,0)
 .I '$G(GMRCPROC) S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM CSLT - INPATIENT") Q
"RTN","GMRCEDT4",95,0)
 .S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM REQ - INPATIENT")
"RTN","GMRCEDT4",96,0)
 I 'Y W !,$C(7),"Unable to change urgency." Q
"RTN","GMRCEDT4",97,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: "
"RTN","GMRCEDT4",98,0)
 S XQORM("^^NO")=0
"RTN","GMRCEDT4",99,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCURG),U,2)
"RTN","GMRCEDT4",100,0)
 D EN^XQORM
"RTN","GMRCEDT4",101,0)
 Q:Y'>0
"RTN","GMRCEDT4",102,0)
 I $P(Y(1),U,2)'=+GMRCURG D
"RTN","GMRCEDT4",103,0)
 . S GMRCED(3)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",104,0)
 Q
"RTN","GMRCEDT4",105,0)
4 ;edit place of CSLT
"RTN","GMRCEDT4",106,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",107,0)
 S Y=$$FIND1^DIC(101,,"QX","GMRCPLACEM - "_$$UP^XLFSTR($P(GMRCREND,U,2))) Q:'Y
"RTN","GMRCEDT4",108,0)
 S XQORM=Y_";ORD(101,"
"RTN","GMRCEDT4",109,0)
 S XQORM(0)="1AR\",XQORM("A")="Place of Consultation: ",XQORM("NO^^")=""
"RTN","GMRCEDT4",110,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCPL),U,2)
"RTN","GMRCEDT4",111,0)
 D EN^XQORM
"RTN","GMRCEDT4",112,0)
 Q:Y'>0
"RTN","GMRCEDT4",113,0)
 I $P(Y(1),U,2)'=+GMRCPL D
"RTN","GMRCEDT4",114,0)
 . S GMRCED(4)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",115,0)
 Q
"RTN","GMRCEDT4",116,0)
5 ;edit Clinically Ind. Date wat/66/81
"RTN","GMRCEDT4",117,0)
 N X,Y,DIR
"RTN","GMRCEDT4",118,0)
 S DIR(0)="D^^K:Y<DT X",DIR("A")="Clinically Indicated Date: " ;S DIR(0)="D^DT:GMRCFTDT:EX"
"RTN","GMRCEDT4",119,0)
 S DIR("?")="Enter a date greater than or equal to TODAY"
"RTN","GMRCEDT4",120,0)
 S DIR("B")=$$FMTE^XLFDT(DT)
"RTN","GMRCEDT4",121,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",122,0)
 S GMRCED(5)=Y_U_Y(0)
"RTN","GMRCEDT4",123,0)
 Q
"RTN","GMRCEDT4",124,0)
6 ;edit ATTN person
"RTN","GMRCEDT4",125,0)
 N X,Y,DIR
"RTN","GMRCEDT4",126,0)
 S DIR(0)="PAO^200:EQM",DIR("A")="Select ATTENTION person: "
"RTN","GMRCEDT4",127,0)
 S DIR("B")=$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),U,11),.01)
"RTN","GMRCEDT4",128,0)
 S:$D(GMRCED(6)) DIR("B")=$P($G(GMRCED(6)),U,2)
"RTN","GMRCEDT4",129,0)
 K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",130,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",131,0)
 I $G(DIR("B"))=$P(Y,U,2) Q
"RTN","GMRCEDT4",132,0)
 S GMRCED(6)=$S(Y=-1:"",1:Y)
"RTN","GMRCEDT4",133,0)
 I GMRCED(6)="" W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",134,0)
 Q
"RTN","GMRCEDT4",135,0)
7 ;edit prov. DX
"RTN","GMRCEDT4",136,0)
 N X,Y,DIC,DIR,PRMPT
"RTN","GMRCEDT4",137,0)
 S PRMPT=$$PROVDX^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCEDT4",138,0)
 I $P(PRMPT,U,2)="F" D
"RTN","GMRCEDT4",139,0)
 . S DIR(0)="FA^2:245",DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",140,0)
 . I $P(PRMPT,U)'="R" S $P(DIR(0),U)="FAO"
"RTN","GMRCEDT4",141,0)
 . S:$D(GMRCED(7)) DIR("B")=$P(GMRCED(7),U)
"RTN","GMRCEDT4",142,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT4",143,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",144,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))  Q:Y=$G(DIR("B"))
"RTN","GMRCEDT4",145,0)
 . I '$L(Y) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",146,0)
 . S GMRCED(7)=Y
"RTN","GMRCEDT4",147,0)
 I $P(PRMPT,U,2)="L" D
"RTN","GMRCEDT4",148,0)
 . N DIR,X,Y,DTOUT,DUOUT,VAL
"RTN","GMRCEDT4",149,0)
 . I $D(GMRCED(7)) D
"RTN","GMRCEDT4",150,0)
 .. I '$L($P(GMRCED(7),U,2)) S DIR("B")=$P(GMRCED(7),U) Q
"RTN","GMRCEDT4",151,0)
 .. S DIR("B")=$P(GMRCED(7),U)_" ("_$P(GMRCED(7),U,2)_")"
"RTN","GMRCEDT4",152,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,GMRCO,30))
"RTN","GMRCEDT4",153,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",154,0)
 . S DIR("?")="Enter a code or term for the provisional diagnosis."
"RTN","GMRCEDT4",155,0)
 . S DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",156,0)
 . S DIR(0)="FA"_$S($P(PRMPT,U)'="R":"O",1:"")_"^1:245"
"RTN","GMRCEDT4",157,0)
 . D ^DIR
"RTN","GMRCEDT4",158,0)
 . I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",159,0)
 . I '$L(Y) W !,?5,"<DELETED>",! S GMRCED(7)="" Q
"RTN","GMRCEDT4",160,0)
 . I Y=$G(DIR("B")) Q
"RTN","GMRCEDT4",161,0)
 . I $E(Y,1)=" " W !,"Leading space not allowed, no change." Q
"RTN","GMRCEDT4",162,0)
 . S VAL=$$LEXLKUP(Y)
"RTN","GMRCEDT4",163,0)
 . I '$L(VAL),$P(PRMPT,U)="R" W !,"Prov. DX required. No change." Q
"RTN","GMRCEDT4",164,0)
 . I VAL=$G(^GMR(123,GMRCO,30)) W !,"No change." Q
"RTN","GMRCEDT4",165,0)
 . I ($P(VAL,U)_" ("_$P(VAL,U,2)_")")=$G(^GMR(123,GMRCO,30)) D  Q
"RTN","GMRCEDT4",166,0)
 .. W !,"No change."
"RTN","GMRCEDT4",167,0)
 . I '$L(VAL) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",168,0)
 . S GMRCED(7)=VAL
"RTN","GMRCEDT4",169,0)
 Q
"RTN","GMRCEDT4",170,0)
 ;
"RTN","GMRCEDT4",171,0)
LEXLKUP(GMRCX)  ; run input through the Lexicon
"RTN","GMRCEDT4",172,0)
 ;
"RTN","GMRCEDT4",173,0)
 N DIC,X,Y,DUOUT,DTOUT,GMRCSYS
"RTN","GMRCEDT4",174,0)
 S GMRCSYS="ICD" I DT>=$$IMPDATE^LEXU("10D") S GMRCSYS="10D"
"RTN","GMRCEDT4",175,0)
 D CONFIG^LEXSET(GMRCSYS,GMRCSYS,DT)
"RTN","GMRCEDT4",176,0)
 S DIC="^LEX(757.01,",DIC(0)="EQM",DIC("B")=GMRCX,X=GMRCX
"RTN","GMRCEDT4",177,0)
 D ^DIC
"RTN","GMRCEDT4",178,0)
 I $D(DTOUT)!($D(DUOUT))!($G(Y)<1) Q ""
"RTN","GMRCEDT4",179,0)
 Q $P(Y,U,2)_U_$S(GMRCSYS="ICD":$G(Y(1)),1:$G(Y(30)))
"RTN","GMRCEDT4",180,0)
 ;
"RTN","GMRCEDT4",181,0)
8 ;edit Reason for Request
"RTN","GMRCEDT4",182,0)
 N DIC,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",183,0)
 I $D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCEDSV",$J,20)=^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",184,0)
 I '$D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCED",$J,20)=^GMR(123,+GMRCO,20)
"RTN","GMRCEDT4",185,0)
 S DIC="^TMP(""GMRCED"",$J,20,",DIWESUB="Reason for Request"
"RTN","GMRCEDT4",186,0)
 W !,"Editing Reason for Request:",!
"RTN","GMRCEDT4",187,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",188,0)
 I '$$DIFFRFR($D(^TMP("GMRCEDSV",$J,20))) D  Q
"RTN","GMRCEDT4",189,0)
 . I $D(^TMP("GMRCEDSV",$J,20)) K ^TMP("GMRCEDSV",$J,20) Q
"RTN","GMRCEDT4",190,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",191,0)
 K ^TMP("GMRCEDSV",$J,20)
"RTN","GMRCEDT4",192,0)
 I '$D(^TMP("GMRCED",$J,20))!('$O(^TMP("GMRCED",$J,20,0))) D
"RTN","GMRCEDT4",193,0)
 . N GMRCMSG
"RTN","GMRCEDT4",194,0)
 . S GMRCMSG="Unable to delete Reason for Request (REQUIRED)"
"RTN","GMRCEDT4",195,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",196,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",197,0)
 Q
"RTN","GMRCEDT4",198,0)
9 ;add comment
"RTN","GMRCEDT4",199,0)
 N DIC,DIWEPSE,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",200,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT4",201,0)
 . W !,"An unsaved comment exists. You may edit this comment.",!
"RTN","GMRCEDT4",202,0)
 . S DIWEPSE=1
"RTN","GMRCEDT4",203,0)
 S DIC="^TMP(""GMRCED"",$J,40,",DIWESUB="New Comment"
"RTN","GMRCEDT4",204,0)
 W !,"Adding new comment:",!
"RTN","GMRCEDT4",205,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",206,0)
 I '$O(^TMP("GMRCED",$J,40,0)) K ^TMP("GMRCED",$J,40)
"RTN","GMRCEDT4",207,0)
 Q
"RTN","GMRCEDT4",208,0)
DIFFRFR(SAVED) ;edited reason for req same as original?
"RTN","GMRCEDT4",209,0)
 N I,DIFF
"RTN","GMRCEDT4",210,0)
 I SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^TMP("GMRCEDSV",$J,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",211,0)
 I 'SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^GMR(123,+GMRCO,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",212,0)
 I SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",213,0)
 . I ^TMP("GMRCED",$J,20,I,0)=$G(^TMP("GMRCEDSV",$J,20,I,0)) Q
"RTN","GMRCEDT4",214,0)
 . S DIFF=1
"RTN","GMRCEDT4",215,0)
 . Q
"RTN","GMRCEDT4",216,0)
 I 'SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",217,0)
 . I ^TMP("GMRCED",$J,20,I,0)'=$G(^GMR(123,+GMRCO,20,I,0)) S DIFF=1
"RTN","GMRCEDT4",218,0)
 . Q
"RTN","GMRCEDT4",219,0)
 Q $G(DIFF)
"RTN","GMRCEDT4",220,0)
VALIDPL(PL,REND) ; place still valid?
"RTN","GMRCEDT4",221,0)
 N PLMENU
"RTN","GMRCEDT4",222,0)
 S PLMENU=$S($P(REND,U)="I":"IN",1:"OUT")
"RTN","GMRCEDT4",223,0)
 S PLMENU="GMRCPLACEM - "_PLMENU_"PATIENT"
"RTN","GMRCEDT4",224,0)
 S PLMENU=$$FIND1^DIC(101,,"QX",PLMENU) Q:PLMENU'>1 0
"RTN","GMRCEDT4",225,0)
 Q $D(^ORD(101,PLMENU,10,"B",+PL))
"RTN","GMRCEDT4",226,0)
VALIDUR(URG,REND,PROC) ;urgency still valid?
"RTN","GMRCEDT4",227,0)
 N URMENU
"RTN","GMRCEDT4",228,0)
 I $P(REND,U)="I" D
"RTN","GMRCEDT4",229,0)
 .I 'PROC S URMENU="GMRCURGENCYM CSLT - INPATIENT" Q
"RTN","GMRCEDT4",230,0)
 .S URMENU="GMRCURGENCYM REQ - INPATIENT" Q
"RTN","GMRCEDT4",231,0)
 I '$D(URMENU) S URMENU="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCEDT4",232,0)
 S URMENU=$$FIND1^DIC(101,,"QX",URMENU) Q:URMENU<0 0
"RTN","GMRCEDT4",233,0)
 Q $D(^ORD(101,URMENU,10,"B",+URG))
"RTN","GMRCEDT4",234,0)
 Q
"RTN","GMRCEDT4",235,0)
NOCHG() ;no changes made
"RTN","GMRCEDT4",236,0)
 Q "No Changes made!"
"RTN","GMRCEDT4",237,0)
PDOK(GMRCDA) ;check validity of Prov. DX code for active status
"RTN","GMRCEDT4",238,0)
 ;WAT - as of patch 85 this code no longer called. Leaving here in case biz needs change.
"RTN","GMRCEDT4",239,0)
 N MSG,GMRCCPTR,GMRCCSYS,GMRCCODE
"RTN","GMRCEDT4",240,0)
 I '$L($G(^GMR(123,GMRCDA,30.1))) Q 1
"RTN","GMRCEDT4",241,0)
 S GMRCCODE=$P($G(^GMR(123,+GMRCO,30.1)),"^",1)
"RTN","GMRCEDT4",242,0)
 S GMRCCSYS=$P($G(^GMR(123,+GMRCO,30.1)),"^",3)
"RTN","GMRCEDT4",243,0)
 S GMRCCPTR=$S(GMRCCSYS="ICD":1,1:30)
"RTN","GMRCEDT4",244,0)
 I +$$STATCHK^ICDEX(GMRCCODE,DT,GMRCCPTR) Q 1 ;code still active
"RTN","GMRCEDT4",245,0)
 S MSG="The provisional DX code must be edited before this request"
"RTN","GMRCEDT4",246,0)
 S MSG=MSG_" may be resubmitted."
"RTN","GMRCEDT4",247,0)
 D EN^DDIOL(MSG,,"!!")
"RTN","GMRCEDT4",248,0)
 Q 0
"RTN","GMRCGUIC")
0^4^B68545414
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR - GUI actions for editing consults; 3/13/03 12:21 ;10/14/15  11:59
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,20,15,22,33,66,73,85,81**;DEC 27, 1997;Build 6
"RTN","GMRCGUIC",3,0)
 ;
"RTN","GMRCGUIC",4,0)
 ; This routine invokes IA #2698 (ORD(101.42)), #872(ORD(101)), #2713 (ORB3F1), #2051 (FIND1^DIC)
"RTN","GMRCGUIC",5,0)
 ;                         #2053 (DIE), #2056 (GET1^DIQ), #2690 (ORB3FUP1), #5679 (LEXU), #10103 (XLFDT), #10104 (XLFSTR), #5747 (ICDEX)
"RTN","GMRCGUIC",6,0)
 ;
"RTN","GMRCGUIC",7,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",8,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",9,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",10,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",11,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",12,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",13,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",14,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",15,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",16,0)
 Q
"RTN","GMRCGUIC",17,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",18,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",19,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",20,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",21,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",22,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",23,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",24,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",25,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",26,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",27,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",28,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",29,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",30,0)
 ;GMRCERDT=Clinically Indicated Date WAT/66/81
"RTN","GMRCGUIC",31,0)
 ;GMRCCSYS=coding system for provsional dx GMRCDXDT=Date of provisional dx   GMRCLABL=label applied to dx code for display purposes e.g. "ICD-9-CM"
"RTN","GMRCGUIC",32,0)
 ;
"RTN","GMRCGUIC",33,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",34,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT
"RTN","GMRCGUIC",35,0)
 N GMRCION,GMRCDIAG,GMRCDXCD,GMRCACTN,GMRCERDT,GMRCCSYS,GMRCDXDT,GMRCLABL,CODINTXT
"RTN","GMRCGUIC",36,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",37,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",38,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",39,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",40,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",41,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",42,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",43,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" Q  ;S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q ;ignore procedure, can't be changed currently
"RTN","GMRCGUIC",44,0)
 .; ..S GMRCPROC=$P(GMRCMSG,"^",2) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",45,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",46,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",47,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",48,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",49,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",50,0)
 ..Q
"RTN","GMRCGUIC",51,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",11),.01),1:"")_"^7" Q
"RTN","GMRCGUIC",52,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S($P(^GMR(123,+GMRCO,0),"^",17)="P":"Procedure",1:"Consult")_"^13" Q
"RTN","GMRCGUIC",53,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",54,0)
 .I $P(GMRCMSG,"^",1)="GMRCERDT" S GMRCERDT=$P(GMRCMSG,"^",2),GMRCFLD(17)=$S(+$P(^GMR(123,+GMRCO,0),"^",24)>0:$$FMTE^XLFDT($P(^GMR(123,+GMRCO,0),"^",24)),1:"")_"^17" Q
"RTN","GMRCGUIC",55,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" D  Q
"RTN","GMRCGUIC",56,0)
 ..S GMRCDIAG=$P(GMRCMSG,"^",2)
"RTN","GMRCGUIC",57,0)
 ..S GMRCFLD(30)=$G(^GMR(123,+GMRCO,30))_"^30"
"RTN","GMRCGUIC",58,0)
 ..I $P(GMRCFLD(30),U)="" S $P(GMRCFLD(30),U)="No Previous Value"
"RTN","GMRCGUIC",59,0)
 ..I $L($P(GMRCMSG,U,3)) D
"RTN","GMRCGUIC",60,0)
 ...S GMRCDXCD=$P(GMRCMSG,"^",3)
"RTN","GMRCGUIC",61,0)
 ...S GMRCCSYS=$$CODECS^ICDEX($G(GMRCDXCD),80) S GMRCCSYS=$S($P(GMRCCSYS,U)=1:"ICD",$P(GMRCCSYS,U)=30:"10D",1:"")
"RTN","GMRCGUIC",62,0)
 ...S GMRCLABL=$P($G(^GMR(123,+GMRCO,30.1)),U,3)
"RTN","GMRCGUIC",63,0)
 ...S GMRCLABL=$S($G(GMRCLABL)="ICD":"ICD-9-CM",$G(GMRCLABL)="10D":"ICD-10-CM",1:"")
"RTN","GMRCGUIC",64,0)
 ...S GMRCFLD(30.1)=$P($G(^GMR(123,+GMRCO,30.1)),U)_"("_$G(GMRCLABL)_")"_"^30.1"
"RTN","GMRCGUIC",65,0)
 ...S GMRCDXDT=$P($G(^GMR(123,+GMRCO,30.1)),U,2)
"RTN","GMRCGUIC",66,0)
 ...S:$G(GMRCDXDT)="" GMRCFLD(30.2)="No Previous Value"_"^30.2"
"RTN","GMRCGUIC",67,0)
 ...S:DT>+$G(GMRCDXDT) GMRCFLD(30.2)=$$FMTE^XLFDT(GMRCDXDT,"D")_"^30.2"
"RTN","GMRCGUIC",68,0)
 ...I GMRCCSYS'=$P($G(^GMR(123,+GMRCO,30.1)),U,3) S GMRCFLD(30.3)=$S($P($G(^GMR(123,+GMRCO,30.1)),U,3)="ICD":"ICD-9-CM",$P($G(^GMR(123,+GMRCO,30.1)),U,3)="10D":"ICD-10-CM",1:"")_"^30.3"
"RTN","GMRCGUIC",69,0)
 ..I $G(GMRCDXCD)'="" S CODINTXT="("_GMRCDXCD_")" D
"RTN","GMRCGUIC",70,0)
 ... I GMRCDIAG[CODINTXT S GMRCDIAG=$E(GMRCDIAG,0,($L(GMRCDIAG)-$L(CODINTXT))) S GMRCDIAG=$$TRIM^XLFSTR(GMRCDIAG,"R")
"RTN","GMRCGUIC",71,0)
 .Q
"RTN","GMRCGUIC",72,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",73,0)
 S GMRCACTN=$$EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",74,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCERDT),$G(GMRCDIAG),$G(GMRCDXCD)) I $L(DR) D
"RTN","GMRCGUIC",75,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",76,0)
 .L +^GMR(123,GMRCO):$S($G(DILOCKTM)>0:DILOCKTM,1:5) ;WAT/66 added timeout
"RTN","GMRCGUIC",77,0)
 .D ^DIE
"RTN","GMRCGUIC",78,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",79,0)
 .D ^DIE
"RTN","GMRCGUIC",80,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",81,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",82,0)
 .Q
"RTN","GMRCGUIC",83,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX^RESUBMIT",VISIT="",RMBED=""
"RTN","GMRCGUIC",84,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,$G(DUZ),VISIT,.GMRCOM)
"RTN","GMRCGUIC",85,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",86,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",87,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",88,0)
 S GMRCFL=1
"RTN","GMRCGUIC",89,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",90,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",91,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",92,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",93,0)
 . N GMRCCORY
"RTN","GMRCGUIC",94,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",95,0)
 I $P($G(^GMR(123,+GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIC",96,0)
 . D TRIGR^GMRCIEVT(GMRCO,GMRCACTN)
"RTN","GMRCGUIC",97,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",98,0)
 Q
"RTN","GMRCGUIC",99,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",100,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",101,0)
 K @GLOBAL
"RTN","GMRCGUIC",102,0)
 N ND,GMRCSX,TYPE,NDX,GMRCCPTR,GMRCCSYS,GMRCCODE,CODINTXT
"RTN","GMRCGUIC",103,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",104,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",105,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:'$L(GMRC(0))
"RTN","GMRCGUIC",106,0)
 S GMRCSS=$P(GMRC(0),"^",5),GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCGUIC",107,0)
 S GMRCURG=$P(GMRC(0),"^",9),GMRCPL=$P(GMRC(0),"^",10)
"RTN","GMRCGUIC",108,0)
 S GMRCATN=$P(GMRC(0),"^",11),GMRCINO=$P(GMRC(0),"^",18)
"RTN","GMRCGUIC",109,0)
 S GMRCREQ=$P(GMRC(0),"^",17),GMRCERDT=$P(GMRC(0),"^",24)
"RTN","GMRCGUIC",110,0)
 S GMRCDIAG=$G(^GMR(123,+GMRCO,30)) I $L($G(^(30.1))) D
"RTN","GMRCGUIC",111,0)
 . S GMRCCODE=$P($G(^GMR(123,+GMRCO,30.1)),"^",1)
"RTN","GMRCGUIC",112,0)
 . S GMRCCSYS=$P($G(^GMR(123,+GMRCO,30.1)),"^",3)
"RTN","GMRCGUIC",113,0)
 . S GMRCCPTR=$S(GMRCCSYS="ICD":1,1:30)
"RTN","GMRCGUIC",114,0)
 . I $G(GMRCCODE)'="" D  ;users expect to see prov dx text and dx code in edit/resubmit dialog
"RTN","GMRCGUIC",115,0)
 .. S CODINTXT=" ("_GMRCCODE_")"
"RTN","GMRCGUIC",116,0)
 .. Q:GMRCDIAG[CODINTXT
"RTN","GMRCGUIC",117,0)
 .. S GMRCDIAG=GMRCDIAG_CODINTXT
"RTN","GMRCGUIC",118,0)
 . S GMRCDIAG=GMRCDIAG_U_$G(GMRCCODE)
"RTN","GMRCGUIC",119,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),U,14):$$GET1^DIQ(200,+$P(^(0),U,14),.01),1:"")
"RTN","GMRCGUIC",120,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",121,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",122,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",123,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",124,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",125,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(123.3,+GMRCPROC,.01))
"RTN","GMRCGUIC",126,0)
 .S GMRCSY=$$FIND1^DIC(101.43,,"QX",+GMRCPROC_";99PRC","ID")
"RTN","GMRCGUIC",127,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",128,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX,ND=ND+1
"RTN","GMRCGUIC",129,0)
 ..Q
"RTN","GMRCGUIC",130,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",131,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",132,0)
 I $L(GMRCREQ) D  I '$L(GMRCREQ) S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",133,0)
 . S GMRCSX=$S(GMRCREQ="P":"PROCEDURE",1:"CONSULT")
"RTN","GMRCGUIC",134,0)
 . S @GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ
"RTN","GMRCGUIC",135,0)
 . S GMRCSX=""
"RTN","GMRCGUIC",136,0)
 S ND=ND+1
"RTN","GMRCGUIC",137,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",138,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",139,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",140,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",141,0)
 .Q
"RTN","GMRCGUIC",142,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",143,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",144,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",145,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",146,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",147,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",148,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",149,0)
 .Q
"RTN","GMRCGUIC",150,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",151,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",152,0)
 I +GMRCATN S GMRCSX=$$GET1^DIQ(200,GMRCATN,.01),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",153,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",154,0)
 S @GLOBAL@(ND,0)="~CLINICALLY",ND=ND+1 ;WAT/66
"RTN","GMRCGUIC",155,0)
 I GMRCERDT S @GLOBAL@(ND,0)="d"_"^"_GMRCERDT,ND=ND+1 ;WAT66
"RTN","GMRCGUIC",156,0)
 E  S @GLOBAL@(ND,0)="d^" ;WAT
"RTN","GMRCGUIC",157,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",158,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",159,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",160,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",161,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",162,0)
 .Q
"RTN","GMRCGUIC",163,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",164,0)
 ;Get reason for request
"RTN","GMRCGUIC",165,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",166,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",167,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",168,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",169,0)
 D SENDCOMT^GMRCGUIU(GMRCO,.ND)
"RTN","GMRCGUIC",170,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",171,0)
 Q
"RTN","GMRCGUIU")
0^5^B30326787
"RTN","GMRCGUIU",1,0)
GMRCGUIU ;SLC/DCM,JFR - Utilities for CPRS GUI ;02/26/15  10:37
"RTN","GMRCGUIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15,17,22,66,73,81**;DEC 27, 1997;Build 6
"RTN","GMRCGUIU",3,0)
 ;
"RTN","GMRCGUIU",4,0)
 ; This routine invokes IA #2757(EN^MCARPS2), #3042 (SINGLE^MCAPI), #3171 (START^ORWRP)
"RTN","GMRCGUIU",5,0)
 ;                         #(GET1^DIQ), #3280 (MEDLKUP^MCARUTL3), #10103 (XLFDT)
"RTN","GMRCGUIU",6,0)
 ;
"RTN","GMRCGUIU",7,0)
GUIC ;Kill variables from GMRCGUIC
"RTN","GMRCGUIU",8,0)
 K GMRC(0),GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCDIAG,GMRCDT,GMRCED,GMRCEDCM
"RTN","GMRCGUIU",9,0)
 K GMRCFL,GMRCFLD,GMRCION,GMRCLNO,GMRCNATO,GMRCNT,GMRCORTX,GMRCPL
"RTN","GMRCGUIU",10,0)
 K GMRCPROC,GMRCRQT,GMRCS38,GMRCSS,GMRCSVC,GMRCTRLC,GMRCTYPE,GMRCURG
"RTN","GMRCGUIU",11,0)
 K GMRCX,LN,GMRCADUZ,ORDG,RMBED,VISIT
"RTN","GMRCGUIU",12,0)
 K GMRCITM,GMRCMSG,GMRCND1,GMRCNOD,GMRCPROV,GMRCOUNT,GMRCGUIF,GMRCREQ
"RTN","GMRCGUIU",13,0)
 K GMRCSS,GMRCPROC,GMRCURG,GMRCURGY,GMRCPL,GMRCATN,GMRCINO,GMRCREQ
"RTN","GMRCGUIU",14,0)
 K GMRCDIAG,GMRCDXCD,GMRCPROV,ND,NDX
"RTN","GMRCGUIU",15,0)
 K XQAKILL,^TMP("GMRCFLD20",$J)
"RTN","GMRCGUIU",16,0)
 Q
"RTN","GMRCGUIU",17,0)
SETDA(GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT,GMRCION,GMRCERDT,GMRCDIAG,GMRCDXCD)  ;Set DA in ^GMR(123,GMRCO,40
"RTN","GMRCGUIU",18,0)
 N X
"RTN","GMRCGUIU",19,0)
 S X=""
"RTN","GMRCGUIU",20,0)
 I +GMRCSS S X="1////^S X=+GMRCSS;.1///@;"
"RTN","GMRCGUIU",21,0)
 I +GMRCPROC S X=X_"4////^S X=GMRCPROC;.1///@;"
"RTN","GMRCGUIU",22,0)
 I +GMRCURG S X=X_"5////^S X=GMRCURG;"
"RTN","GMRCGUIU",23,0)
 I +GMRCPL S X=X_"6////^S X=GMRCPL;"
"RTN","GMRCGUIU",24,0)
 I +GMRCATN S X=X_"7////^S X=GMRCATN;"
"RTN","GMRCGUIU",25,0)
 I $G(GMRCATN)="@" S X=X_"7///@;"
"RTN","GMRCGUIU",26,0)
 I $L(GMRCION) S X=X_"14///^S X=GMRCION;"
"RTN","GMRCGUIU",27,0)
 I +GMRCERDT S X=X_"17///^S X=GMRCERDT;"
"RTN","GMRCGUIU",28,0)
 I $L(GMRCDIAG) D
"RTN","GMRCGUIU",29,0)
 . I GMRCDIAG="@" S X=X_"30///@;30.1///@;30.2///@;30.3///@;" Q
"RTN","GMRCGUIU",30,0)
 . S X=X_"30////^S X=GMRCDIAG;"
"RTN","GMRCGUIU",31,0)
 I $L(GMRCDXCD) D
"RTN","GMRCGUIU",32,0)
 .S X=X_"30.1////^S X=GMRCDXCD;30.2////^S X=DT;30.3////^S X=GMRCCSYS;"
"RTN","GMRCGUIU",33,0)
 I $L(X) S X=$E(X,1,$L(X)-1)
"RTN","GMRCGUIU",34,0)
 Q X
"RTN","GMRCGUIU",35,0)
 ;
"RTN","GMRCGUIU",36,0)
COMMENT(GMRCO,MSG,ND,GMRCDA)    ;File comments from GUI edits
"RTN","GMRCGUIU",37,0)
 N Y,GMRCND
"RTN","GMRCGUIU",38,0)
 S GMRCDA=$$ADDCM^GMRCEDT3(GMRCO),GMRCA=20
"RTN","GMRCGUIU",39,0)
 D AUDIT0^GMRCEDT3(GMRCDA,GMRCO)
"RTN","GMRCGUIU",40,0)
 S Y=$$FMTE^XLFDT(DT,"1D"),GMRCFLD(40)="COMMENT ADDED: "_Y_"^"_GMRCDA
"RTN","GMRCGUIU",41,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,40,GMRCDA,1,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIU",42,0)
 S ^GMR(123,GMRCO,40,GMRCDA,1,0)="^^"_(GMRCNT-1)_"^"_(GMRCNT-1)_"^"_GMRCDT_"^"
"RTN","GMRCGUIU",43,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIU",44,0)
 . D TRIGR^GMRCIEVT(GMRCO,GMRCDA)
"RTN","GMRCGUIU",45,0)
 Q
"RTN","GMRCGUIU",46,0)
 ;
"RTN","GMRCGUIU",47,0)
SENDCOMT(GMRCO,ND1)     ;Get comments   ;wat/66 replaced ^VA(200 with $$GET1^DIQ
"RTN","GMRCGUIU",48,0)
 N NDX,NDY,CMTDT,SENDR,TYPE
"RTN","GMRCGUIU",49,0)
 S NDX=0,CMTDT="",SENDR=""
"RTN","GMRCGUIU",50,0)
 S NDX=0 F  S NDX=$O(^GMR(123,GMRCO,40,NDX)) Q:NDX?1A.E!(NDX="")  S TYPE=$P(^GMR(123,GMRCO,40,NDX,0),"^",2) I $S(TYPE=19:1,TYPE=20:1,1:0) S TYPE(TYPE,NDX)=""
"RTN","GMRCGUIU",51,0)
 I $O(TYPE(19,0)) S @GLOBAL@(ND1,0)="~DENY COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",52,0)
 .S NDX=0 F  S NDX=$O(TYPE(19,NDX)) Q:NDX=""   D
"RTN","GMRCGUIU",53,0)
 ..S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$$GET1^DIQ(200,$P(^(0),"^",4),.01),1:"Missing Data")
"RTN","GMRCGUIU",54,0)
 ..S @GLOBAL@(ND1,0)="t"_"CANCELLED: "_CMTDT_" BY: "_SENDR,ND1=ND1+1,NDY=0
"RTN","GMRCGUIU",55,0)
 ..S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND1,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",56,0)
 ..S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",57,0)
 ..Q
"RTN","GMRCGUIU",58,0)
 .Q
"RTN","GMRCGUIU",59,0)
 S NDX=0 F  S NDX=$O(TYPE(20,NDX)) Q:NDX=""  S @GLOBAL@(ND1,0)="~ADDED COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",60,0)
 .S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$$GET1^DIQ(200,$P(^(0),"^",4),.01),1:"UNKNOWN")
"RTN","GMRCGUIU",61,0)
 .S @GLOBAL@(ND1,0)="t"_"COMMENT on "_CMTDT_" BY: "_SENDR,ND1=ND1+1
"RTN","GMRCGUIU",62,0)
 .S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",63,0)
 .S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",64,0)
 .Q
"RTN","GMRCGUIU",65,0)
 Q
"RTN","GMRCGUIU",66,0)
GETMED(GMRCIFN,GMRCRES) ;return available med results for proc request
"RTN","GMRCGUIU",67,0)
 ; input:
"RTN","GMRCGUIU",68,0)
 ;    GMRCIFN - ien from file 123
"RTN","GMRCGUIU",69,0)
 ;    GMRCRES - variable passed in by reference used for output
"RTN","GMRCGUIU",70,0)
 ; output:
"RTN","GMRCGUIU",71,0)
 ;     GMRCRES(x) = result_name^date^summary^result_ref
"RTN","GMRCGUIU",72,0)
 ;      example:
"RTN","GMRCGUIU",73,0)
 ;       GMRCRES(1)="19;MCAR(691.5,^EKG^JUN 30,1999@15:52^ABNORMAL"
"RTN","GMRCGUIU",74,0)
 N CNT,ROOT,PROC,S5,DFN,I
"RTN","GMRCGUIU",75,0)
 N MCARCODE,MCARDT,MCESKEY,MCKEYCAR,MCFILE
"RTN","GMRCGUIU",76,0)
 S PROC=+$P($G(^GMR(123,GMRCIFN,0)),U,8)
"RTN","GMRCGUIU",77,0)
 I 'PROC Q  ;no procedure there
"RTN","GMRCGUIU",78,0)
 S ROOT=$$GET1^DIQ(697.2,+$P(^GMR(123.3,PROC,0),U,5),1)
"RTN","GMRCGUIU",79,0)
 I '$L(ROOT) Q  ;proc not set up for med resulting
"RTN","GMRCGUIU",80,0)
 S S5=ROOT D EN^MCARPS2(+$P(^GMR(123,GMRCIFN,0),U,2))
"RTN","GMRCGUIU",81,0)
 I '$D(^TMP("OR",$J,"MCAR","OT")) Q  ;no results available
"RTN","GMRCGUIU",82,0)
 S CNT=0,I=0
"RTN","GMRCGUIU",83,0)
 F  S CNT=$O(^TMP("OR",$J,"MCAR","OT",CNT)) Q:'CNT  D
"RTN","GMRCGUIU",84,0)
 . N DATA S DATA=^TMP("OR",$J,"MCAR","OT",CNT)
"RTN","GMRCGUIU",85,0)
 . Q:$D(^GMR(123,"R",$P(DATA,U,2)_";"_ROOT_","))
"RTN","GMRCGUIU",86,0)
 . Q:$$SCRNDRFT^GMRCMED($P(DATA,U,2),$P(ROOT,"(",2))  ;screen draft rpts
"RTN","GMRCGUIU",87,0)
 . S I=I+1
"RTN","GMRCGUIU",88,0)
 . S GMRCRES(I)=$P(DATA,U,2)_";"_ROOT_","_U_$P(DATA,U)_U_$P(DATA,U,6,7)
"RTN","GMRCGUIU",89,0)
 . Q
"RTN","GMRCGUIU",90,0)
 K MCARCODE,MCARDT,MCESKEY,MCKEYCAR,MCFILE
"RTN","GMRCGUIU",91,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","GMRCGUIU",92,0)
 Q
"RTN","GMRCGUIU",93,0)
GETRES(GMRCO,GMRCAR) ;return array of associated med rslts
"RTN","GMRCGUIU",94,0)
 ; DBIA #: ?
"RTN","GMRCGUIU",95,0)
 ; Input:
"RTN","GMRCGUIU",96,0)
 ;   GMRCO - ien from file 123
"RTN","GMRCGUIU",97,0)
 ;   GMRCAR - variable passed by ref to return array in
"RTN","GMRCGUIU",98,0)
 ; Output:
"RTN","GMRCGUIU",99,0)
 ;   GMRCAR(x)=result_ref^result_name^date^impression
"RTN","GMRCGUIU",100,0)
 ;    Example:
"RTN","GMRCGUIU",101,0)
 ;      GMRCAR(1)="19;MCAR(691.5,^EKG^JUN 30,1999@15:52^ABNORMAL"
"RTN","GMRCGUIU",102,0)
 N RES,CNT,DATA
"RTN","GMRCGUIU",103,0)
 S RES=0,CNT=1
"RTN","GMRCGUIU",104,0)
 F  S RES=$O(^GMR(123,GMRCO,50,RES)) Q:'RES  D
"RTN","GMRCGUIU",105,0)
 . N GMRCMCR,GMRCMCAR,RES0
"RTN","GMRCGUIU",106,0)
 . S RES0=$G(^GMR(123,GMRCO,50,RES,0))
"RTN","GMRCGUIU",107,0)
 . I RES0'["MCAR" Q
"RTN","GMRCGUIU",108,0)
 . S GMRCMCR=$$SINGLE^MCAPI(RES0)
"RTN","GMRCGUIU",109,0)
 . Q:'$L(GMRCMCR)
"RTN","GMRCGUIU",110,0)
 . D MEDLKUP^MCARUTL3(.GMRCMCAR,+$P(RES0,"MCAR(",2),+RES0)
"RTN","GMRCGUIU",111,0)
 . S GMRCAR(CNT)=^GMR(123,GMRCO,50,RES,0)_U
"RTN","GMRCGUIU",112,0)
 . S GMRCAR(CNT)=GMRCAR(CNT)_$P(GMRCMCR,U)_U_$P(GMRCMCR,U,6,7)
"RTN","GMRCGUIU",113,0)
 . I $P(GMRCMCAR,U,10) S GMRCAR(CNT)=GMRCAR(CNT)_"^1"
"RTN","GMRCGUIU",114,0)
 . S CNT=CNT+1
"RTN","GMRCGUIU",115,0)
 . Q
"RTN","GMRCGUIU",116,0)
 Q
"RTN","GMRCGUIU",117,0)
DISPMED(GMRCRES,GMRCAR) ; display a med result
"RTN","GMRCGUIU",118,0)
 ; Input:
"RTN","GMRCGUIU",119,0)
 ;  GMRCRES - med result var ptr  (e.g. "19;MCAR(691.5")
"RTN","GMRCGUIU",120,0)
 ;  GMRCAR  - array to return output from medicine API
"RTN","GMRCGUIU",121,0)
 ; Output:
"RTN","GMRCGUIU",122,0)
 ;  GMRCAR
"RTN","GMRCGUIU",123,0)
 ;    - var passed by ref or as global ref to return text of
"RTN","GMRCGUIU",124,0)
 ;      medicine pkg report
"RTN","GMRCGUIU",125,0)
 ;    Example:  GMRCAR(1)="      PROCEDURE DATE/TIME: 06/30/99 15:52"
"RTN","GMRCGUIU",126,0)
 ;              GMRCAR(2)="        CONFIDENTIAL ECG REPORT"
"RTN","GMRCGUIU",127,0)
 ;              GMRCAR(3...)=
"RTN","GMRCGUIU",128,0)
 D START^ORWRP(80,"EN^MCAPI(GMRCRES,1)")
"RTN","GMRCGUIU",129,0)
 I '$D(^TMP("ORDATA",$J,1)) D  Q
"RTN","GMRCGUIU",130,0)
 . I $D(GMRCAR) S @GMRCAR@(1)="Unable to locate result." Q
"RTN","GMRCGUIU",131,0)
 . I '$D(GMRCAR) S GMRCAR(1)="Unable to locate result."
"RTN","GMRCGUIU",132,0)
 I $D(GMRCAR) M @GMRCAR=^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",133,0)
 I '$D(GMRCAR) M GMRCAR=^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",134,0)
 K ^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",135,0)
 Q
"RTN","GMRCGUIU",136,0)
CANDOMED(GMRCIEN,USER) ;can person associate med results?
"RTN","GMRCGUIU",137,0)
 ; GMRCIEN - ien from file 123
"RTN","GMRCGUIU",138,0)
 N PROC
"RTN","GMRCGUIU",139,0)
 I '$D(^GMR(123,GMRCIEN,0)) Q 0  ;bad record
"RTN","GMRCGUIU",140,0)
 S PROC=+$P(^GMR(123,GMRCIEN,0),U,8) I 'PROC Q 0  ;no procedure
"RTN","GMRCGUIU",141,0)
 I +$G(^GMR(123,GMRCIEN,1)) Q 0  ;med rslts not allowed on CP
"RTN","GMRCGUIU",142,0)
 I '+$P(^GMR(123.3,PROC,0),U,5) Q 0  ;proc not set up
"RTN","GMRCGUIU",143,0)
 Q 1
"RTN","GMRCHL7")
0^6^B31393339
"RTN","GMRCHL7",1,0)
GMRCHL7 ;SLC/DCM,JFR - CONSULTS-->CPRS HL7 MESSAGING ;12/10/14  14:18
"RTN","GMRCHL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,19,29,66,81**;DEC 27, 1997;Build 6
"RTN","GMRCHL7",3,0)
 ;
"RTN","GMRCHL7",4,0)
 ; This routine invokes IA #872(File 101 ^ORD), #2638(^ORD(100.01,)), #2698(^ORD(101.42,), #10103(XLFDT), #10101(XQOR)
"RTN","GMRCHL7",5,0)
 ;
"RTN","GMRCHL7",6,0)
 ;;Format the HL-7 Message header
"RTN","GMRCHL7",7,0)
 Q
"RTN","GMRCHL7",8,0)
INIT S HLQ=""""""
"RTN","GMRCHL7",9,0)
 S SEP1="|",SEP2="^",SEP3="~",SEP4="\",SEP5="&"
"RTN","GMRCHL7",10,0)
 Q
"RTN","GMRCHL7",11,0)
MSH(X) ;Format MSH segment of HL-7 message.
"RTN","GMRCHL7",12,0)
 ;FROM=GMRC CONSULTS - the sending application
"RTN","GMRCHL7",13,0)
 N X
"RTN","GMRCHL7",14,0)
 I '$D(HLQ) D INIT
"RTN","GMRCHL7",15,0)
 S X="MSH|^~\&|CONSULTS|"_$S(+$G(DUZ(2)):DUZ(2),1:$$SITE^VASITE())_"|||||ORM"
"RTN","GMRCHL7",16,0)
 Q X
"RTN","GMRCHL7",17,0)
PID(GMRCIEN) ;Format the HL-7 PID segment
"RTN","GMRCHL7",18,0)
 ;GMRCIEN=IEN of consult from File 123
"RTN","GMRCHL7",19,0)
 N X
"RTN","GMRCHL7",20,0)
 S GMRCDPT=$P(^GMR(123,GMRCIEN,0),"^",2)
"RTN","GMRCHL7",21,0)
 S GMRCPTN=$P($G(^DPT(GMRCDPT,0)),"^")
"RTN","GMRCHL7",22,0)
 S X="PID|||"_+GMRCDPT_"||"_GMRCPTN
"RTN","GMRCHL7",23,0)
 K GMRCDPT,GMRCPTN
"RTN","GMRCHL7",24,0)
 Q X
"RTN","GMRCHL7",25,0)
PV1(GMRCIEN,RMBED,VISIT) ;Format the HL-7 PV1 segment
"RTN","GMRCHL7",26,0)
 N GMRCSTS,SEP1,X,Y
"RTN","GMRCHL7",27,0)
 S HOSPLOC=$P(^GMR(123,GMRCIEN,0),"^",4)
"RTN","GMRCHL7",28,0)
 S VISIT=$$HL7DT(VISIT),GMRCSTS=$S($P(^GMR(123,GMRCIEN,0),"^",18)]"":$P(^(0),"^",18),HOSPLOC]"":"I",1:"O")
"RTN","GMRCHL7",29,0)
 S X="PV1"_"||"_GMRCSTS_"|"_$S(HOSPLOC]"":HOSPLOC,1:"")_"^"_$S(RMBED]"":RMBED,1:"")_"|"_$S(VISIT]"":VISIT,1:"")
"RTN","GMRCHL7",30,0)
 K Y,HOSPLOC,VISIT,GMRCSTS
"RTN","GMRCHL7",31,0)
 Q X
"RTN","GMRCHL7",32,0)
NTE(NTE,ND) ;Format the HL-7 NTE segment
"RTN","GMRCHL7",33,0)
 Q:'$D(NTE)  Q:'$O(NTE(0))
"RTN","GMRCHL7",34,0)
 S GMRCND=1,GMRCND1=0 D
"RTN","GMRCHL7",35,0)
 .S GMRCND1=$O(NTE(GMRCND1)),@(MSG_"("_ND_")")=NTE(GMRCND1)
"RTN","GMRCHL7",36,0)
 .F  S GMRCND1=$O(NTE(GMRCND1)) Q:GMRCND1=""  I NTE(GMRCND1)]"" S @(MSG_"("_ND_","_GMRCND_")")=NTE(GMRCND1),GMRCND=GMRCND+1
"RTN","GMRCHL7",37,0)
 .Q
"RTN","GMRCHL7",38,0)
 Q
"RTN","GMRCHL7",39,0)
EN(PATID,GMRCIEN,GMRCRTYP,RMBED,ORCTRL,GMRCPLCR,VISIT,GMRCOM,GRPUPD,ACTDT) ;;Main entry point
"RTN","GMRCHL7",40,0)
 ;PATID=DFN - Patients internal entry number from ^DPT(
"RTN","GMRCHL7",41,0)
 ;GMRCIEN=IEN of consult, from File 123
"RTN","GMRCHL7",42,0)
 ;RMBED=Hospital Room/Bed if patient is hospitalized
"RTN","GMRCHL7",43,0)
 ;ORCTRL=Code from HL-7 table 119 (Appendix A) Order Control Codes
"RTN","GMRCHL7",44,0)
 ;VISIT=Visit as a DATE/TIME in Fileman Format.
"RTN","GMRCHL7",45,0)
 ;GMRCPROV=Provider - IEN from file 200
"RTN","GMRCHL7",46,0)
 ;GMRCRTYP=consult type: GMRC REQUEST or GMRC CONSULT
"RTN","GMRCHL7",47,0)
 ;GMRCPLCR=who is entering the order ; usually passed as DUZ for new order, "" for existing order
"RTN","GMRCHL7",48,0)
 ;GMRCOM=comment array flag: 1 if there is comment array, 0 otherwise
"RTN","GMRCHL7",49,0)
 ;GMRCOM(0)=DA of where comment is located: ^GMR(123,IEN,40,DA,
"RTN","GMRCHL7",50,0)
 ;GRPUPD = group update of consults - sends nature as MAINTENANCE
"RTN","GMRCHL7",51,0)
 ;ACTDT = date/time of activity if sent
"RTN","GMRCHL7",52,0)
 Q:'$L(ORCTRL)
"RTN","GMRCHL7",53,0)
 K GMRCMSS
"RTN","GMRCHL7",54,0)
 N MSG,MSH,PID,PV1,ORC,NTE,OBR,OBX,ZSV,GMRCA,GMRCURGI,GMRCPLI
"RTN","GMRCHL7",55,0)
 N GMRCPR,GMRCSS,GMRCTYPE,ORCPLCR
"RTN","GMRCHL7",56,0)
 S MSH="",MSH=$$MSH(MSH)
"RTN","GMRCHL7",57,0)
 S PID=$$PID(GMRCIEN)
"RTN","GMRCHL7",58,0)
 I ORCTRL'="Z@" S PV1=$$PV1(GMRCIEN,RMBED,VISIT)
"RTN","GMRCHL7",59,0)
 D ORC(GMRCIEN,ORCTRL,GMRCPLCR,$G(GRPUPD),$G(ACTDT))
"RTN","GMRCHL7",60,0)
 S ORCTRL=$P(ORCTRL,U)
"RTN","GMRCHL7",61,0)
 I ORCTRL="Z@" S ORC=$P(ORC,SEP1,1,4)
"RTN","GMRCHL7",62,0)
 D:ORCTRL'="Z@" OBR^GMRCHL72(GMRCIEN,$G(GMRCAUTH),$G(ACTDT))
"RTN","GMRCHL7",63,0)
 ;GMRCAUTH=principle results interpreter
"RTN","GMRCHL7",64,0)
 D ZSV(GMRCIEN)
"RTN","GMRCHL7",65,0)
 I $S(ORCTRL="SN":1,ORCTRL="RE":1,ORCTRL="XX":1,1:0) D OBX^GMRCHL72(GMRCIEN)
"RTN","GMRCHL7",66,0)
 I $S(ORCTRL="OC":1,ORCTRL="OD":1,ORCTRL="XX":1,ORCTRL="SC":1,1:0),$G(GMRCOM(0)) D NTE^GMRCHL72(GMRCIEN,.GMRCOM,ORCTRL)
"RTN","GMRCHL7",67,0)
 D BLD(MSH,PID,$G(PV1),$G(ORC),$G(OBR),$G(ZSV),.OBX,.NTE,ORCTRL)
"RTN","GMRCHL7",68,0)
 ;M GMRCMSS=GMRCMSG ;HL-7 message debugging aid - remove from final version
"RTN","GMRCHL7",69,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7",70,0)
 K GMRCND,GMRCND1,GMRCMSG,GMRCNOD,GMRCORFN,GMRCPLI,GMRCPRI,HL7DT,HLQ,J,ND,ND1,ND2,NOTIFY,OBXND,OBXNO,ORCACT,ORCDT,ORURG,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7",71,0)
 Q
"RTN","GMRCHL7",72,0)
BLD(MSH,PID,PV1,ORC,OBR,ZSV,OBX,NTE,CTRLCD) ;Build the HL-7 message global to pass to OR
"RTN","GMRCHL7",73,0)
 S MSG="GMRCMSG",ND=1
"RTN","GMRCHL7",74,0)
 K @(MSG)
"RTN","GMRCHL7",75,0)
 F J="MSH","PID","PV1" I $G(@J)]"" S @(MSG_"("_ND_")")=@J,ND=ND+1
"RTN","GMRCHL7",76,0)
 I ORC]"" S @(MSG_"("_ND_")")=ORC,ND=ND+1
"RTN","GMRCHL7",77,0)
 I $D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",78,0)
 I OBR]"" S @(MSG_"("_ND_")")=OBR,ND=ND+1
"RTN","GMRCHL7",79,0)
 I $L($G(ZSV)) S @(MSG_"("_ND_")")=ZSV,ND=ND+1
"RTN","GMRCHL7",80,0)
 I $O(OBX("")) S OBXND=0 D
"RTN","GMRCHL7",81,0)
 .F  S OBXND=$O(OBX(OBXND)) Q:OBXND=""  D
"RTN","GMRCHL7",82,0)
 .. S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",83,0)
 .. S GMRCND1=0 F  S GMRCND1=$O(OBX(OBXND,GMRCND1)) Q:GMRCND1=""  D
"RTN","GMRCHL7",84,0)
 ... S @(MSG_"("_ND_","_GMRCND1_")")=OBX(OBXND,GMRCND1)
"RTN","GMRCHL7",85,0)
        .. S ND=ND+1
"RTN","GMRCHL7",86,0)
 .Q
"RTN","GMRCHL7",87,0)
 ;I CTRLCD'="XX",$D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",88,0)
 Q
"RTN","GMRCHL7",89,0)
HL7DT(DATE) ;Convert Fileman Date to HL-7 Date
"RTN","GMRCHL7",90,0)
 I 'DATE Q ""
"RTN","GMRCHL7",91,0)
 Q $$FMTHL7^XLFDT(DATE) ; use standard function
"RTN","GMRCHL7",92,0)
 N X
"RTN","GMRCHL7",93,0)
 S X="" I DATE S X=17000000+$P(DATE,".",1)_$P(DATE,".",2)
"RTN","GMRCHL7",94,0)
 Q X
"RTN","GMRCHL7",95,0)
FMDATE(DATE) ;Convert HL-7 formatted date to a Fileman formatted date
"RTN","GMRCHL7",96,0)
 I 'DATE Q ""
"RTN","GMRCHL7",97,0)
 Q $$HL7TFM^XLFDT(DATE) ; use standard function
"RTN","GMRCHL7",98,0)
 N X
"RTN","GMRCHL7",99,0)
ORC(GMRCIEN,GMRCTRL,ORCPLCR,MAINT,GMRCDT) ;Build ORC segment of HL-7 msg
"RTN","GMRCHL7",100,0)
 ;GMRCTRL=Order Control Code (table 119)
"RTN","GMRCHL7",101,0)
 ;GMRCIEN=File 123 IEN
"RTN","GMRCHL7",102,0)
 ;ORPLCR=GMRCPLCR - the person entering the order
"RTN","GMRCHL7",103,0)
 ;MAINT=1 - group update of requests
"RTN","GMRCHL7",104,0)
 ;GMRCDT=date/time of activity, GMRCERDT=clinically indicated date wat/81
"RTN","GMRCHL7",105,0)
 N GMRCURG,ORCACT,ORCDT,ORCPRV,ORCDT,ORIEN,ORCSTS,STS,ORCNATR,QUANT,REAS,GMRCERDT
"RTN","GMRCHL7",106,0)
 S REAS=$P(GMRCTRL,U,2),GMRCTRL=$P(GMRCTRL,U)
"RTN","GMRCHL7",107,0)
 S ORCDT=$P(^GMR(123,GMRCIEN,0),"^",7),ORCPRV=$P(^GMR(123,GMRCIEN,0),"^",14),ORURG=$P(^(0),"^",9),ORURG=$S(ORURG]"":$P(^ORD(101,ORURG,0),"^",1),1:"") S:ORURG]"" ORURG=$P(ORURG," - ",2)
"RTN","GMRCHL7",108,0)
 S ORURG=$S(ORURG="EMERGENCY":"STAT",ORURG="NOW":"STAT",ORURG="OUTPATIENT":"ROUTINE",1:ORURG)
"RTN","GMRCHL7",109,0)
 S:ORURG="" GMRCURG="" I ORURG]"" S GMRCURG=$O(^ORD(101.42,"B",ORURG,0)),GMRCURG=$S(+GMRCURG:$P(^ORD(101.42,GMRCURG,0),"^",2),1:"")
"RTN","GMRCHL7",110,0)
 S GMRCERDT=$P(^GMR(123,GMRCIEN,0),"^",24),GMRCERDT=$$HL7DT($G(GMRCERDT)) ;WAT/66
"RTN","GMRCHL7",111,0)
 S ORCDT=$$HL7DT(ORCDT)
"RTN","GMRCHL7",112,0)
 I '$G(GMRCDT) S GMRCDT=$$NOW^XLFDT
"RTN","GMRCHL7",113,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12)
"RTN","GMRCHL7",114,0)
 S ORCACT=$P($G(^ORD(100.01,+STS,0)),U,1) S:'$L(ORCACT) ORCACT="NO STATUS"
"RTN","GMRCHL7",115,0)
 S ORIEN=$P(^GMR(123,GMRCIEN,0),"^",3)
"RTN","GMRCHL7",116,0)
 S ORCSTS=$S(STS=1:"DC",STS=2:"CM",STS=5:"IP",STS=6:"SC",STS=9:"A",STS=12:"RP",STS=13:"CA",STS=8:"ZC",1:"IP")
"RTN","GMRCHL7",117,0)
 S ORCNATR=""
"RTN","GMRCHL7",118,0)
 I GMRCTRL="XX" S ORCNATR="S^SERVICE CORRECTION^99ORN^^"_REAS_"^"
"RTN","GMRCHL7",119,0)
 I $G(MAINT) S ORCNATR="M^MAINTENANCE^99ORN^^^"
"RTN","GMRCHL7",120,0)
 S QUANT=$S(GMRCURG]"":"^^^"_$G(GMRCERDT)_"^^"_GMRCURG,1:"") ;wat/66
"RTN","GMRCHL7",121,0)
 S GMRCDT=$$HL7DT(GMRCDT)
"RTN","GMRCHL7",122,0)
 S ORC="ORC|"_GMRCTRL_"|"_$S(ORIEN]"":ORIEN_";1^OR",1:"")_"|"
"RTN","GMRCHL7",123,0)
 S ORC=ORC_GMRCIEN_";GMRC^"_"GMRC"_"||"_ORCSTS_"||"_QUANT_"||"
"RTN","GMRCHL7",124,0)
 S ORC=ORC_GMRCDT_"|"_ORCPLCR_"||"_ORCPRV_"|||"_ORCDT_"|"_ORCNATR
"RTN","GMRCHL7",125,0)
 Q
"RTN","GMRCHL7",126,0)
ZSV(GMRCO) ;build ZSV segment for at least forward
"RTN","GMRCHL7",127,0)
 N SERV,SERVNM,CTYPE
"RTN","GMRCHL7",128,0)
 S SERV=$P($G(^GMR(123,GMRCO,0)),U,5)
"RTN","GMRCHL7",129,0)
 I 'SERV Q
"RTN","GMRCHL7",130,0)
 S SERVNM=$P($G(^GMR(123.5,SERV,0)),U)
"RTN","GMRCHL7",131,0)
 S CTYPE=$G(^GMR(123,GMRCO,1.11))
"RTN","GMRCHL7",132,0)
 I CTYPE=SERVNM S CTYPE=""
"RTN","GMRCHL7",133,0)
 I $P(^GMR(123,GMRCO,0),U,8) S CTYPE=""
"RTN","GMRCHL7",134,0)
 S ZSV="ZSV|^^^"_SERV_U_SERVNM_"^99CON|"_CTYPE
"RTN","GMRCHL7",135,0)
 Q
"RTN","GMRCHL7A")
0^7^B31527698
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM,MA - Receive HL-7 Message from OERR ;12/10/14  14:18
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,21,22,33,68,66,73,81**;DEC 27, 1997;Build 6
"RTN","GMRCHL7A",3,0)
 ;
"RTN","GMRCHL7A",4,0)
 ;ICRs
"RTN","GMRCHL7A",5,0)
 ;;GLOBALS/FILES  #872(FILE 101 ^ORD(101))
"RTN","GMRCHL7A",6,0)
 ;;ROUTINES  #2053(DIE)
"RTN","GMRCHL7A",7,0)
 ;
"RTN","GMRCHL7A",8,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",9,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",10,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",11,0)
 Q X
"RTN","GMRCHL7A",12,0)
 ;
"RTN","GMRCHL7A",13,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",14,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",15,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",16,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",17,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",18,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",19,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",20,0)
 ;GMRCERDT=clinically indicated date
"RTN","GMRCHL7A",21,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",22,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",23,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",24,0)
 S GMRCERDT=$P($P(GMRCORC,SEP1,8),SEP2,4),GMRCERDT=$$FMDATE^GMRCHL7($G(GMRCERDT)) ;WAT/66
"RTN","GMRCHL7A",25,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",26,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",27,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",28,0)
 Q
"RTN","GMRCHL7A",29,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",30,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",31,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",32,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",33,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",34,0)
 ;GMRCPRI=procedure from file ^ORD(101,
"RTN","GMRCHL7A",35,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",36,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",37,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",38,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",39,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",40,0)
 S GMRCTYPE=$S(GMRCPR="99PRC":"P",1:"C")
"RTN","GMRCHL7A",41,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",42,0)
 I GMRCPR="99PRC" D
"RTN","GMRCHL7A",43,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",44,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";GMR(123.3,",1:"")
"RTN","GMRCHL7A",45,0)
 . Q
"RTN","GMRCHL7A",46,0)
 ;
"RTN","GMRCHL7A",47,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",48,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",49,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",50,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",51,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",52,0)
 Q
"RTN","GMRCHL7A",53,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",54,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",55,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",56,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",57,0)
 Q
"RTN","GMRCHL7A",58,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",59,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",60,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",61,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",62,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",63,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",64,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",65,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",66,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",67,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",68,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",69,0)
 .Q
"RTN","GMRCHL7A",70,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",71,0)
 . I GMRCVTYP="TX" D  Q
"RTN","GMRCHL7A",72,0)
 .. S GMRCPRDG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",73,0)
 .. S GMRCPRDG=$TR(GMRCPRDG,$C(9,10,13)," ") Q
"RTN","GMRCHL7A",74,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",75,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",76,0)
 .. S GMRCPRDG=$TR($P(PRDXSEG,"^",2),$C(9,10,13),"") ;_"("_$P(PRDXSEG,"^")_")" WAT/73 no longer appending (code number) to end of diagnosis text
"RTN","GMRCHL7A",77,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",78,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",79,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",80,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",81,0)
 .Q
"RTN","GMRCHL7A",82,0)
 K LN
"RTN","GMRCHL7A",83,0)
 Q
"RTN","GMRCHL7A",84,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",85,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",86,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",87,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",88,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",89,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",90,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT,GMRCPRCD
"RTN","GMRCHL7A",91,0)
 N GMRCREJ,GMRCRECV,GMRCERDT
"RTN","GMRCHL7A",92,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",93,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4)
"RTN","GMRCHL7A",94,0)
 .S GMRCMTP=$P(GMRCMSG,SEP1,9),GMRCRECV=$P(GMRCMSG,SEP1,5)
"RTN","GMRCHL7A",95,0)
 .Q
"RTN","GMRCHL7A",96,0)
 I $G(GMRCRECV)'="CONSULTS" Q  ;not intended for Consults
"RTN","GMRCHL7A",97,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",98,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",99,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",100,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",101,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",102,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",103,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",104,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",105,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",106,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q
"RTN","GMRCHL7A",107,0)
 .Q
"RTN","GMRCHL7A",108,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",109,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",110,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",111,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B(.GMRCREJ) D
"RTN","GMRCHL7A",112,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",113,0)
 . D REJECT^GMRCHL7U(.MSG,$G(GMRCREJ))
"RTN","GMRCHL7A",114,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",115,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",116,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",117,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",118,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",119,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",120,0)
 Q
"RTN","GMRCHL7A",121,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123,
"RTN","GMRCHL7A",122,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",123,0)
 L +^GMR(123,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:5) D ^DIE L -^GMR(123,DA) ;wat/66 add lock timeout
"RTN","GMRCHL7A",124,0)
 K DIE,DR
"RTN","GMRCHL7A",125,0)
 Q
"RTN","GMRCP5B")
0^10^B43503817
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;12/10/14  14:16
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15,24,23,22,29,65,66,73,81**;Dec 27, 1997;Build 6
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 ; Patch #23 add "SERVICE RENDERED AS:" to SF513
"RTN","GMRCP5B",5,0)
 ;ICRs
"RTN","GMRCP5B",6,0)
 ;GLOBALS/FILES
"RTN","GMRCP5B",7,0)
 ;;#872 PROTOCOL ^ORD(101)  #2849 PROTOCOL  #10035 PATIENT FILE  #10040 HOSPITAL LOCATION(^SC)  #10060 NEW PERSON
"RTN","GMRCP5B",8,0)
 ;ROUTINES/APIs
"RTN","GMRCP5B",9,0)
 ;;#1252  SDUTL3  #2056 $$GET1^DIQ  #4156 REGISTRATION, COMBAT VETERAN STATUS  #10003 %DT  #10061 VADPT  #10103 FMTE^XLFDT  #10112 VASITE
"RTN","GMRCP5B",10,0)
 Q
"RTN","GMRCP5B",11,0)
 ;
"RTN","GMRCP5B",12,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",13,0)
 ;
"RTN","GMRCP5B",14,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",15,0)
 ;
"RTN","GMRCP5B",16,0)
REQUEST ;
"RTN","GMRCP5B",17,0)
 N GMRCX
"RTN","GMRCP5B",18,0)
 ;
"RTN","GMRCP5B",19,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",20,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",21,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Current Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",22,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",23,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",24,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"    Current Primary Care Team: "_GMRCX)
"RTN","GMRCP5B",25,0)
 ;
"RTN","GMRCP5B",26,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",27,0)
 ;
"RTN","GMRCP5B",28,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",29,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",30,0)
 ;
"RTN","GMRCP5B",31,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",32,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",33,0)
 E  D
"RTN","GMRCP5B",34,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",35,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",36,0)
 ;
"RTN","GMRCP5B",37,0)
 Q
"RTN","GMRCP5B",38,0)
PDIAG ;
"RTN","GMRCP5B",39,0)
 ;
"RTN","GMRCP5B",40,0)
 ;WAT GMRC 73
"RTN","GMRCP5B",41,0)
 N GMRCD,GMRCCODE,GMRCDA,GMRCSYS,CODINTXT
"RTN","GMRCP5B",42,0)
 S GMRCD="",GMRCCODE="",GMRCSYS=""
"RTN","GMRCP5B",43,0)
 S GMRCD=$G(^GMR(123,GMRCIFN,30)) ;free txt prov diag
"RTN","GMRCP5B",44,0)
 S GMRCCODE=$G(^GMR(123,GMRCIFN,30.1)) ;ICD code^prov diag date^coding system
"RTN","GMRCP5B",45,0)
 S CODINTXT="("_GMRCCODE_")"
"RTN","GMRCP5B",46,0)
 I $L(GMRCCODE)>0 D
"RTN","GMRCP5B",47,0)
 .S GMRCSYS=$P(GMRCCODE,U,3) S GMRCSYS=$S(GMRCSYS="ICD":"ICD-9-CM",GMRCSYS="10D":"ICD-10-CM",1:"") ;coding system
"RTN","GMRCP5B",48,0)
 .S GMRCCODE=$P(GMRCCODE,U) ;actual code
"RTN","GMRCP5B",49,0)
 .S GMRCSYS="("_GMRCSYS_" "_$G(GMRCCODE)_")"
"RTN","GMRCP5B",50,0)
 I GMRCD[$G(CODINTXT) D
"RTN","GMRCP5B",51,0)
 .S GMRCD=$E(GMRCD,0,($L(GMRCD)-$L(CODINTXT)))
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_GMRCD_$G(GMRCSYS))
"RTN","GMRCP5B",54,0)
 ;/GMRC 73
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 S (GMRCQSTR,GMRCPGR,GMRCIPH,GMRCQSTT)=""
"RTN","GMRCP5B",58,0)
 ;
"RTN","GMRCP5B",59,0)
 I $S('$P(GMRCRD,U,23):1,$P(GMRCRD(12),U,5)="P":1,1:0) D
"RTN","GMRCP5B",60,0)
 .S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",61,0)
 .S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",62,0)
 .S GMRCPGR=$$GET1^DIQ(200,+$G(GMRCQSTR),.137) S:'$L(GMRCPGR) GMRCPGR=$$GET1^DIQ(200,+$G(GMRCQSTR),.138)
"RTN","GMRCP5B",63,0)
 .S GMRCIPH=$$GET1^DIQ(200,$G(GMRCQSTR),.132)
"RTN","GMRCP5B",64,0)
 .;
"RTN","GMRCP5B",65,0)
 .S GMRCQSTT=$$GET1^DIQ(200,+$G(GMRCQSTR),20.3)
"RTN","GMRCP5B",66,0)
 .S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+$G(GMRCQSTR),8)
"RTN","GMRCP5B",67,0)
 .S GMRCQSTR=$$GET1^DIQ(200,+$G(GMRCQSTR),.01)
"RTN","GMRCP5B",68,0)
 ;
"RTN","GMRCP5B",69,0)
 I $P(GMRCRD,U,23),$P(GMRCRD(12),U,5)="F" D
"RTN","GMRCP5B",70,0)
 .S GMRCQSTR=$P(GMRCRD(12),U,6)
"RTN","GMRCP5B",71,0)
 .S GMRCIPH=$P(GMRCRD(13),U,2)
"RTN","GMRCP5B",72,0)
 .S GMRCPGR=$P(GMRCRD(13),U,3)
"RTN","GMRCP5B",73,0)
 ;
"RTN","GMRCP5B",74,0)
 S GMRCIPH="(Phone: "_GMRCIPH_")"
"RTN","GMRCP5B",75,0)
 S GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",76,0)
 ;
"RTN","GMRCP5B",77,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: ")
"RTN","GMRCP5B",78,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",79,0)
 D BLD("PDIAG",1,0,58,"|URGENCY:")
"RTN","GMRCP5B",80,0)
 ;
"RTN","GMRCP5B",81,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",82,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",83,0)
 D BLD("PDIAG",1,0,58,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",84,0)
 ;
"RTN","GMRCP5B",85,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",86,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",87,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",88,0)
 .D BLD("PDIAG",1,0,58,"|")
"RTN","GMRCP5B",89,0)
 D BLD("PDIAG",1,1,0,GMRCPGR)
"RTN","GMRCP5B",90,0)
 D BLD("PDIAG",1,0,35,"|SERVICE RENDERED AS:")
"RTN","GMRCP5B",91,0)
 D BLD("PDIAG",1,0,58,"|CLINICALLY IND. DATE:") ;WAT/66/81
"RTN","GMRCP5B",92,0)
 D BLD("PDIAG",1,0,58,"|")
"RTN","GMRCP5B",93,0)
 S GMRCINOU=$S($P(GMRCRD,U,18)="O":"Outpatient",1:"Inpatient")
"RTN","GMRCP5B",94,0)
 I $D(GMRCIPH)>0 D
"RTN","GMRCP5B",95,0)
 .D BLD("PDIAG",1,1,0,GMRCIPH)
"RTN","GMRCP5B",96,0)
 .D BLD("PDIAG",1,0,35,"|"_GMRCINOU)
"RTN","GMRCP5B",97,0)
 E  D
"RTN","GMRCP5B",98,0)
 .D BLD("PDIAG",1,1,35,"|"_GMRCINOU)
"RTN","GMRCP5B",99,0)
 D BLD("PDIAG",1,0,58,"|")
"RTN","GMRCP5B",100,0)
 D BLD("PDIAG",1,0,58,"|"_$$FMTE^XLFDT($P(GMRCRD,U,24),1)) ;WAT/66/81
"RTN","GMRCP5B",101,0)
 K GMRCINOU
"RTN","GMRCP5B",102,0)
 ;***************************************************************
"RTN","GMRCP5B",103,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",104,0)
 ;
"RTN","GMRCP5B",105,0)
 Q
"RTN","GMRCP5B",106,0)
 ;
"RTN","GMRCP5B",107,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",108,0)
 ;
"RTN","GMRCP5B",109,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,VAIN,VAPA,VAERR
"RTN","GMRCP5B",110,0)
 ;
"RTN","GMRCP5B",111,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",112,0)
 ;
"RTN","GMRCP5B",113,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",114,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",115,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",116,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",117,0)
 ;No location, IFC - consulting site
"RTN","GMRCP5B",118,0)
 I '$L(GMRCLOC),$P(GMRCRD,U,23),$P($G(GMRCRD(12)),U,5)="F" D
"RTN","GMRCP5B",119,0)
 .I $P(GMRCRD,U,21) S GMRCLOC=$$GET1^DIQ(4,$P(GMRCRD,U,21),.01)
"RTN","GMRCP5B",120,0)
 .E  S GMRCLOC=$$GET1^DIQ(4,$P(GMRCRD,U,23),.01)
"RTN","GMRCP5B",121,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",122,0)
 ;
"RTN","GMRCP5B",123,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",124,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",125,0)
 ;
"RTN","GMRCP5B",126,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",127,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",128,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",129,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",130,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",131,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",132,0)
 E  D
"RTN","GMRCP5B",133,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",134,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",135,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",136,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",137,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",138,0)
 ;
"RTN","GMRCP5B",139,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",140,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",141,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",142,0)
 ;
"RTN","GMRCP5B",143,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",144,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",145,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",146,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",147,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",148,0)
 ;
"RTN","GMRCP5B",149,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",150,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",151,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",152,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",153,0)
 ;
"RTN","GMRCP5B",154,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",155,0)
 ;
"RTN","GMRCP5B",156,0)
 F SUB=0,1 D
"RTN","GMRCP5B",157,0)
 .I SUB D BLD("FTR",SUB,1,33,"Page ","GMRCPG,38"_" FIRST ONE") I 1
"RTN","GMRCP5B",158,0)
 .E  I '$G(GMRCGUI) D BLD("FTR",SUB,1,33,"Page ","GMRCPG,38"_" SECOND ONE")
"RTN","GMRCP5B",159,0)
 I $G(GMRCPG)=0 D BLD("FTR",0,1,51,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",160,0)
 Q
"RTN","GMRCP5B",161,0)
 ;
"RTN","GMRCP5B",162,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",163,0)
 ;
"RTN","GMRCP5B",164,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",165,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",166,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",167,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",168,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",169,0)
 ;
"RTN","GMRCP5B",170,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",171,0)
 ;
"RTN","GMRCP5B",172,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",173,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",174,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",175,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5B",176,0)
 ;
"RTN","GMRCP5B",177,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",178,0)
 ;
"RTN","GMRCP5B",179,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",180,0)
 ;
"RTN","GMRCP5B",181,0)
 ;
"RTN","GMRCP5B",182,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",183,0)
 ;
"RTN","GMRCP5B",184,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",185,0)
 N LINECNT
"RTN","GMRCP5B",186,0)
 ;
"RTN","GMRCP5B",187,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",188,0)
 ;
"RTN","GMRCP5B",189,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",190,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",191,0)
 ;
"RTN","GMRCP5B",192,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",193,0)
 Q
"RTN","GMRCP5B",194,0)
 ;
"RTN","GMRCP5B",195,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",196,0)
 ;
"RTN","GMRCP5B",197,0)
 N NEXT
"RTN","GMRCP5B",198,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",199,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",200,0)
 Q
"RTN","GMRCP5B",201,0)
 ;
"RTN","GMRCP5B",202,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",203,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",204,0)
 ;
"RTN","GMRCSLM2")
0^11^B92923527
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM,WAT - LM Detailed  display and printing ;12/10/14  14:15
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,18,15,17,23,22,65,66,73,81**;DEC 27,1997;Build 6
"RTN","GMRCSLM2",3,0)
 ;
"RTN","GMRCSLM2",4,0)
 ;ICRs
"RTN","GMRCSLM2",5,0)
 ;GLOBALS/FILES
"RTN","GMRCSLM2",6,0)
 ;#872 ^ORD(101  #875 ORDER STATUS file point(100.01)  #2638 ORDER STATUS file access  #2849 ORDERS file  #10060 NEW PERSON (file 200)  #10040 HOSPITAL LOCATION (^SC)
"RTN","GMRCSLM2",7,0)
 ;#10090 INSTITUTION
"RTN","GMRCSLM2",8,0)
 ;ROUTINES
"RTN","GMRCSLM2",9,0)
 ;#2467 $$OI^ORX8  #2056 $$GET1^DIQ   #10104 XLFSTR   #4156 $$CVEDT^DGCV   #10117  ^VALM10   #4807 RDIS^DGRPDB
"RTN","GMRCSLM2",10,0)
 ;
"RTN","GMRCSLM2",11,0)
DT(GMRCO,GMRCIERR) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",12,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",13,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",14,0)
 ;;Pass in variable GMRCOER=2 if calling from the GUI, GMRCOER=1 if call is from CPRS consults tab
"RTN","GMRCSLM2",15,0)
 ;;Pass in variable GMRCOER=0 (or as <UNDEFINED>) if call is from consults routines
"RTN","GMRCSLM2",16,0)
 K GMRCQUT
"RTN","GMRCSLM2",17,0)
 N DFN,GMRCD,GMRCDA,ORIFN,GMRCSF S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",18,0)
 I $S('GMRCO:1,'$D(^GMR(123,+GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",19,0)
 .S GMRCMSG="The consult entry selected for the Detailed Display is unknown." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",20,0)
 .Q
"RTN","GMRCSLM2",21,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",22,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",23,0)
 S X="SDUTL3" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",24,0)
 .N PR S PR=$$OUTPTPR^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Provider:   "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 .S PR=$$OUTPTTM^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Team:       "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",26,0)
 .Q
"RTN","GMRCSLM2",27,0)
 N VAIN,VAEL,CVELIG
"RTN","GMRCSLM2",28,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Pat. Status:   "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",29,0)
 I $D(VAIN(4)),$L($P(VAIN(4),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 D ELIG^VADPT
"RTN","GMRCSLM2",31,0)
 S:$L($P(VAEL(1),"^",2)) ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Primary Eligibility:"_$E(TAB,1,3)_$P(VAEL(1),"^",2)_$S(VAEL(8)']"":" (NOT VERIFIED)",1:"("_$P(VAEL(8),"^",2)_")"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 ;wat 66
"RTN","GMRCSLM2",33,0)
 I $L($P(VAEL(6),U,2))  D
"RTN","GMRCSLM2",34,0)
 .;if TYPE is Active Duty and VETERAN Y/N? is No, then call the pt Active Duty
"RTN","GMRCSLM2",35,0)
 .I $P(VAEL(6),U,1)=5&(VAEL(4)=0) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Patient Type:"_$E(TAB,1,10)_$P(VAEL(6),U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",36,0)
 .E  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Patient Type:"_$E(TAB,1,10)_$P(VAEL(6),U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",37,0)
 ;//wat 66
"RTN","GMRCSLM2",38,0)
 S CVELIG=$$CVEDT^DGCV(DFN) S:$P($G(CVELIG),U,3) ^TMP("GMRCR",$J,"DT",GMRCCT,0)="CV Eligible:"_$E(TAB,1,11)_"YES",GMRCCT=GMRCCT+1 ;WAT
"RTN","GMRCSLM2",39,0)
 ;wat 66
"RTN","GMRCSLM2",40,0)
 N VASV,OIFOEF S OIFOEF="NO" D SVC^VADPT S:(VASV(11)>0)!(VASV(12)>0)!(VASV(13)>0) OIFOEF="YES"
"RTN","GMRCSLM2",41,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="OEF/OIF: "_$E(TAB,1,14)_$G(OIFOEF),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",42,0)
 ; GET SC RATINGS AND %
"RTN","GMRCSLM2",43,0)
 N INC,COND S INC=0
"RTN","GMRCSLM2",44,0)
 I $P(VAEL(3),U)=1  D
"RTN","GMRCSLM2",45,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",46,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service Connection/Rated Disabilities",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",47,0)
 .I '$P(VAEL(3),U,2) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="SC Percent:"_$E(TAB,1,12)_"DATA NOT FOUND",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",48,0)
 .E  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="SC Percent:"_$E(TAB,1,12)_$P(VAEL(3),U,2)_"%",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",49,0)
 .D RDIS^DGRPDB(DFN,.GMRCRDIS) I $D(GMRCRDIS(1))  D
"RTN","GMRCSLM2",50,0)
 ..F  S INC=$O(GMRCRDIS(INC)) Q:INC=""  D
"RTN","GMRCSLM2",51,0)
 ...S COND=$$GET1^DIQ(31,$P(GMRCRDIS(INC),U),.01)
"RTN","GMRCSLM2",52,0)
 ...S:$G(INC)=1 ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Rated Disabilities:"_$E(TAB,1,4)_$G(COND)_"  ("_$P(GMRCRDIS(INC),U,2)_"%)",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",53,0)
 ...S:$G(INC)>1 ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$E(TAB,1,23)_$G(COND)_"  ("_$P(GMRCRDIS(INC),U,2)_"%)",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",54,0)
 .I '$D(GMRCRDIS)  D
"RTN","GMRCSLM2",55,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Rated Disabilities:"_$E(TAB,1,4)_"NONE STATED",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",56,0)
 ;//wat 66
"RTN","GMRCSLM2",57,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",58,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Order Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",59,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",60,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Attention:"_$E(TAB,1,13)_$$GET1^DIQ(200,$P($G(GMRCO(0)),"^",11),.01),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",61,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",62,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Requesting Provider: "_$E(TAB,1,2)_$S($P(GMRCO(0),"^",14)]"":$$GET1^DIQ(200,$P($G(GMRCO(0)),"^",14),.01),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",63,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",64,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",65,0)
 .Q
"RTN","GMRCSLM2",66,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,17)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",67,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,15)_$S($L($P(GMRCO(0),"^",9)):$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",68,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Clinically Ind. Date:"_$E(TAB,1,2)_$$FMTE^XLFDT($P($G(GMRCO(0)),"^",24),1),GMRCCT=GMRCCT+1 ;WAT/66/81
"RTN","GMRCSLM2",69,0)
 S X="ORX8" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",70,0)
 .N GMRCOITM S GMRCOITM=$$OI^ORX8(ORIFN)
"RTN","GMRCSLM2",71,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Orderable Item:"_$E(TAB,1,8)_$P(GMRCOITM,U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",72,0)
 .Q
"RTN","GMRCSLM2",73,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^GMR(123.3,+GMRCPRNM,0)),"^"),1:"Consult Request")
"RTN","GMRCSLM2",74,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",75,0)
 .N GMRCLN
"RTN","GMRCSLM2",76,0)
 .S GMRCTYPE=$S($P(GMRCO(0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCSLM2",77,0)
 .S GMRCLN=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC
"RTN","GMRCSLM2",78,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCLN
"RTN","GMRCSLM2",79,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",80,0)
 .I $G(^GMR(123,+GMRCO,1)) D
"RTN","GMRCSLM2",81,0)
 .. S GMRCLN=""
"RTN","GMRCSLM2",82,0)
 .. S GMRCLN="Clinical Procedure:"_$E(TAB,1,4)
"RTN","GMRCSLM2",83,0)
 .. S GMRCLN=GMRCLN_$$GET1^DIQ(123,+GMRCO,1.01,"E")
"RTN","GMRCSLM2",84,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCLN
"RTN","GMRCSLM2",85,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",86,0)
 .Q
"RTN","GMRCSLM2",87,0)
 D PROVDIAG(+GMRCO)
"RTN","GMRCSLM2",88,0)
 I $D(^GMR(123,+GMRCO,20,0)) D
"RTN","GMRCSLM2",89,0)
 .I $O(^GMR(123,+GMRCO,20,0)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Reason For Request:",GMRCCT=GMRCCT+1 D  Q
"RTN","GMRCSLM2",90,0)
 .. S LN=0
"RTN","GMRCSLM2",91,0)
 .. F  S LN=$O(^GMR(123,+GMRCO,20,LN)) Q:LN=""  D
"RTN","GMRCSLM2",92,0)
 ... S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,20,LN,0)
"RTN","GMRCSLM2",93,0)
 ... I $G(GMRCIERR) D
"RTN","GMRCSLM2",94,0)
 .... N TXT S TXT=^TMP("GMRCR",$J,"DT",GMRCCT,0)_"..."
"RTN","GMRCSLM2",95,0)
 .... S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=TXT
"RTN","GMRCSLM2",96,0)
 .... S LN=9999 ;quit with just one line
"RTN","GMRCSLM2",97,0)
 ... S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",98,0)
 .. Q
"RTN","GMRCSLM2",99,0)
 . Q
"RTN","GMRCSLM2",100,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",101,0)
 ; get inter-facility consult info
"RTN","GMRCSLM2",102,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Inter-facility Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",103,0)
 I '$P(GMRCO(0),"^",23) D
"RTN","GMRCSLM2",104,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="This is not an inter-facility consult request.",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",105,0)
 E  D
"RTN","GMRCSLM2",106,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$$REPEAT^XLFSTR("-",27)
"RTN","GMRCSLM2",107,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",108,0)
 . N GMRCOP
"RTN","GMRCSLM2",109,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Remote Facility:"_$E(TAB,1,6)_$$GET1^DIQ(4,+$P(GMRCO(0),"^",23),.01),GMRCCT=GMRCCT+1 ;WAT/73
"RTN","GMRCSLM2",110,0)
 . S GMRCO(12)=$G(^GMR(123,+GMRCO,12))
"RTN","GMRCSLM2",111,0)
 . I $L($P(GMRCO(12),U,6)) D
"RTN","GMRCSLM2",112,0)
 .. S GMRCOP=$P(GMRCO(12),U,6)
"RTN","GMRCSLM2",113,0)
 . I '$D(GMRCOP) S GMRCOP=$$GET1^DIQ(200,+$P(GMRCO(0),U,14),.01)
"RTN","GMRCSLM2",114,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ordering Provider:"_$E(TAB,1,5)_GMRCOP,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",115,0)
 . S GMRCO(13)=$G(^GMR(123,+GMRCO,13)) I $L($P(GMRCO(13),U,2,3))>1 D
"RTN","GMRCSLM2",116,0)
 .. N LINE
"RTN","GMRCSLM2",117,0)
 .. S LINE=$P(GMRCO(13),U,2) I $L(LINE) S LINE=LINE_$E(TAB,1,5) D
"RTN","GMRCSLM2",118,0)
 ... S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ordering Provider phone: "_LINE
"RTN","GMRCSLM2",119,0)
 ... S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",120,0)
 .. S LINE=$P(GMRCO(13),U,3) I $L(LINE) S LINE=LINE_$E(TAB,1,5) D
"RTN","GMRCSLM2",121,0)
 ... S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ordering Provider pager: "_LINE
"RTN","GMRCSLM2",122,0)
 ... S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",123,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Remote Consult #"_$E(TAB)_$P(GMRCO(0),"^",22),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",124,0)
 . I $L($P(GMRCO(13),U)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Remote Service name: "_$E(TAB)_$P(GMRCO(13),U),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",125,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Role: "_$E(TAB,1,10)_$S($P(GMRCO(12),U,5)="P":"Requesting facility",1:"Consulting facility"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",126,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",127,0)
 ;get status, last action, and significant findings
"RTN","GMRCSLM2",128,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",129,0)
 S GMRCA=$P(^GMR(123,+GMRCO,0),"^",13),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Last Action:"_$E(TAB,1,11)_$S(+GMRCA:$P($G(^GMR(123.1,GMRCA,0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",130,0)
 I $L($P(GMRCO(0),"^",19)) D
"RTN","GMRCSLM2",131,0)
 .S GMRCSF=$P(GMRCO(0),"^",19)
"RTN","GMRCSLM2",132,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings:  "_$S(GMRCSF="Y":"YES",GMRCSF="N":"NO",1:"Unknown")
"RTN","GMRCSLM2",133,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",134,0)
 .Q
"RTN","GMRCSLM2",135,0)
 I $G(GMRCIERR) Q  ;don't need results or activities on IFC errors
"RTN","GMRCSLM2",136,0)
 D ACTLOG^GMRCSLM4(+GMRCO)
"RTN","GMRCSLM2",137,0)
 ; any inter-facility results?
"RTN","GMRCSLM2",138,0)
 I $P(GMRCO(0),"^",23) D
"RTN","GMRCSLM2",139,0)
 . N GMRCIFRS,X S GMRCIFRS=0,X=""
"RTN","GMRCSLM2",140,0)
 . F  S X=$O(^GMR(123,GMRCO,51,"B",X)) Q:X=""  S GMRCIFRS=GMRCIFRS+1
"RTN","GMRCSLM2",141,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",142,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Inter-facility Results: "_$S(GMRCIFRS>0:"Results are available via Display Results action.",1:"No results available for this consult request."),GMRCCT=GMRCCT+2
"RTN","GMRCSLM2",143,0)
 ;get local results
"RTN","GMRCSLM2",144,0)
 D GETRSLT^GMRCART($NA(^TMP("GMRCRT",$J)),1)
"RTN","GMRCSLM2",145,0)
 N NXT S NXT=0
"RTN","GMRCSLM2",146,0)
 F  S NXT=$O(^TMP("GMRCRT",$J,NXT)) Q:'NXT  D
"RTN","GMRCSLM2",147,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$G(^TMP("GMRCRT",$J,NXT,0))
"RTN","GMRCSLM2",148,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",149,0)
 . Q
"RTN","GMRCSLM2",150,0)
 K ^TMP("GMRCRT",$J)
"RTN","GMRCSLM2",151,0)
 I $S('$D(GMRCOER):1,'GMRCOER:1,1:0),$D(VALMAR) D CLEAN^VALM10
"RTN","GMRCSLM2",152,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",153,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRCD,GMRCDVDL,GMRCO,GMRCAR,GMRCRB,GMRCLA,GMRCSR,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",154,0)
 I $D(GMRCOER),'GMRCOER D:$D(VALMEVL) KILL^VALM10() D:$D(VALMAR) CLEAN^VALM10
"RTN","GMRCSLM2",155,0)
 Q
"RTN","GMRCSLM2",156,0)
PROVDIAG(GMRCDA) ;test all prov diags
"RTN","GMRCSLM2",157,0)
 N GMRCD,GMRCCODE,PIECE,FLG,CODINTXT,BUFFER,REPEAT
"RTN","GMRCSLM2",158,0)
 S FLG=0
"RTN","GMRCSLM2",159,0)
 S REPEAT=22 ;spaces to repeat for formatting
"RTN","GMRCSLM2",160,0)
 S GMRCD=$G(^GMR(123,GMRCDA,30))
"RTN","GMRCSLM2",161,0)
 S GMRCCODE=$G(^GMR(123,GMRCDA,30.1)),CODINTXT="("_$P(GMRCCODE,U)_")"
"RTN","GMRCSLM2",162,0)
 ;icd-9 consults stored code in diagnosis text, icd-10 does not. Strip code from text and append to end for display
"RTN","GMRCSLM2",163,0)
 ;desired coding system and code display format (ICD-9-CM 123.45) or (ICD-10-CM S06.4X0S)
"RTN","GMRCSLM2",164,0)
 I GMRCD[$G(CODINTXT) D
"RTN","GMRCSLM2",165,0)
 .S GMRCD=$E(GMRCD,0,($L(GMRCD)-$L(CODINTXT)))
"RTN","GMRCSLM2",166,0)
 I $L($P(GMRCCODE,U))>0 D
"RTN","GMRCSLM2",167,0)
 .I $P(GMRCCODE,U,3)="ICD" S GMRCD=GMRCD_"(ICD-9-CM "_$P(GMRCCODE,U)_")"
"RTN","GMRCSLM2",168,0)
 .I $P(GMRCCODE,U,3)="10D" S GMRCD=GMRCD_"(ICD-10-CM "_$P(GMRCCODE,U)_")"
"RTN","GMRCSLM2",169,0)
 I $L($G(GMRCD))>54 D
"RTN","GMRCSLM2",170,0)
 .F  S PIECE=$L(GMRCD) Q:PIECE<54  D  ;$L of GMRCD will change below, so hold original length in PIECE
"RTN","GMRCSLM2",171,0)
 .. N SEG,I S I=2
"RTN","GMRCSLM2",172,0)
 .. F  S SEG=$P(GMRCD," ",1,I) Q:$L(SEG)>=54!($L(SEG," ")<I)  S I=I+1
"RTN","GMRCSLM2",173,0)
 .. I $L(SEG)=$L(GMRCD) S SEG=$E(GMRCD,1,54) ;means GMRCD doesn't contain spaces, e.g. v55,250.00,414.00,etc.
"RTN","GMRCSLM2",174,0)
 .. S BUFFER=SEG
"RTN","GMRCSLM2",175,0)
 .. S:SEG[" " SEG=$P(GMRCD," ",1,(I-1)) I $L(SEG)=0 S SEG=$E(BUFFER,1,54) ;$P only good when SEG contains a space, otherwise grab a SEG from BUFFER
"RTN","GMRCSLM2",176,0)
 .. S:FLG=0 ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_SEG
"RTN","GMRCSLM2",177,0)
 .. I FLG=1&($F(GMRCD," ")'=2) S REPEAT=23
"RTN","GMRCSLM2",178,0)
 .. S:FLG=1 ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$$REPEAT^XLFSTR(" ",REPEAT)_SEG
"RTN","GMRCSLM2",179,0)
 .. S FLG=1,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",180,0)
 .. S GMRCD=$E(GMRCD,$L(SEG)+1,999)
"RTN","GMRCSLM2",181,0)
 . I $F(GMRCD," ")'=2 S REPEAT=23
"RTN","GMRCSLM2",182,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$$REPEAT^XLFSTR(" ",REPEAT)_GMRCD
"RTN","GMRCSLM2",183,0)
 . S GMRCCT=GMRCCT+1,GMRCD=""
"RTN","GMRCSLM2",184,0)
 I $G(GMRCD)'="" D
"RTN","GMRCSLM2",185,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD
"RTN","GMRCSLM2",186,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",187,0)
 Q
"RTN","GMRCSTL7")
0^12^B108615335
"RTN","GMRCSTL7",1,0)
GMRCSTL7 ;SLC/JFR/WAT - DRIVER FOR CSLT PER MONITOR ;12/10/14  14:25
"RTN","GMRCSTL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41,60,76,81**;DEC 27, 1997;Build 6
"RTN","GMRCSTL7",3,0)
 ;
"RTN","GMRCSTL7",4,0)
 ;This routine invokes ICRs
"RTN","GMRCSTL7",5,0)
 ;1519(XUTMDEVQ,10103(XLFDT),10104(XLFSTR),3744(VADPT),10089(%ZISC),10026(DIR)
"RTN","GMRCSTL7",6,0)
 Q
"RTN","GMRCSTL7",7,0)
 ;
"RTN","GMRCSTL7",8,0)
EN ; start here
"RTN","GMRCSTL7",9,0)
 K GMRCQUT
"RTN","GMRCSTL7",10,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCTMP,GMRCDG,GMRCSVC,GMRCSVNM,GMRCDT1
"RTN","GMRCSTL7",11,0)
 N GMRCDT2,GMRCFMT,GMRCGRP,VALMBCK,GMRCSAVE
"RTN","GMRCSTL7",12,0)
 N GMRC30ST,GMRC30SP
"RTN","GMRCSTL7",13,0)
 D CAVEATS
"RTN","GMRCSTL7",14,0)
 ;Ask for service
"RTN","GMRCSTL7",15,0)
 S DIR(0)="P^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTL7",16,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTL7",17,0)
 D ^DIR
"RTN","GMRCSTL7",18,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",19,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTL7",20,0)
  ;Ask for current FY
"RTN","GMRCSTL7",21,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCFY
"RTN","GMRCSTL7",22,0)
 S DIR(0)="F^4:4^K:(X-1700)>($E(DT,1,3)+1) X"
"RTN","GMRCSTL7",23,0)
 S DIR("A")="Current Fiscal Year (i.e. 2008)"
"RTN","GMRCSTL7",24,0)
 S DIR("A",1)="Ensure you are providing fiscal year, NOT calendar year."
"RTN","GMRCSTL7",25,0)
 D ^DIR
"RTN","GMRCSTL7",26,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",27,0)
 S GMRCFY=X
"RTN","GMRCSTL7",28,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCQTR,GMRCYR
"RTN","GMRCSTL7",29,0)
 S DIR(0)="N^1:4"
"RTN","GMRCSTL7",30,0)
 S DIR("A")="Enter a number 1 - 4"
"RTN","GMRCSTL7",31,0)
 S DIR("A",1)="For which quarter are you running the report: first, second, third or fourth?"
"RTN","GMRCSTL7",32,0)
 D ^DIR
"RTN","GMRCSTL7",33,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",34,0)
 S GMRCQTR=X
"RTN","GMRCSTL7",35,0)
 ;if first quarter
"RTN","GMRCSTL7",36,0)
 I $G(GMRCQTR)=1 D
"RTN","GMRCSTL7",37,0)
 .;use FY-1 to set year part of date range to the previous calendar year
"RTN","GMRCSTL7",38,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCYR=$G(GMRCYR)-1,GMRCDT1=$E($G(GMRCYR),1,3)_"1001" S GMRCDT2=$G(GMRCYR)_"1231"
"RTN","GMRCSTL7",39,0)
 I $G(GMRCQTR)=2 D
"RTN","GMRCSTL7",40,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0101" S GMRCDT2=$G(GMRCYR)_"0331"
"RTN","GMRCSTL7",41,0)
 I $G(GMRCQTR)=3 D
"RTN","GMRCSTL7",42,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0401" S GMRCDT2=$G(GMRCYR)_"0630"
"RTN","GMRCSTL7",43,0)
 I $G(GMRCQTR)=4 D
"RTN","GMRCSTL7",44,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0701" S GMRCDT2=$G(GMRCYR)_"0930"
"RTN","GMRCSTL7",45,0)
 S GMRC30ST=$$FMADD^XLFDT(GMRCDT1,-30),GMRC30SP=$$FMADD^XLFDT(GMRCDT2,-30)
"RTN","GMRCSTL7",46,0)
 ; what type of report
"RTN","GMRCSTL7",47,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X
"RTN","GMRCSTL7",48,0)
 S DIR(0)="S:O^S:Summary;D:Delimited",DIR("A")="What type of report"
"RTN","GMRCSTL7",49,0)
 D ^DIR
"RTN","GMRCSTL7",50,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",51,0)
 S GMRCFMT=$S(Y="S":"CP",1:"DEL")
"RTN","GMRCSTL7",52,0)
 ;
"RTN","GMRCSTL7",53,0)
 W @IOF
"RTN","GMRCSTL7",54,0)
 S GMRCSAVE("GMRCFMT")=""
"RTN","GMRCSTL7",55,0)
 S GMRCSAVE("GMRCDG")=""
"RTN","GMRCSTL7",56,0)
 S GMRCSAVE("GMRCDT1")=""
"RTN","GMRCSTL7",57,0)
 S GMRCSAVE("GMRCDT2")=""
"RTN","GMRCSTL7",58,0)
 S GMRCSAVE("GMRC30ST")=""
"RTN","GMRCSTL7",59,0)
 S GMRCSAVE("GMRC30SP")=""
"RTN","GMRCSTL7",60,0)
 S GMRCSAVE("GMRCSVNM")=""
"RTN","GMRCSTL7",61,0)
 S GMRCSAVE("GMRCFY")=""
"RTN","GMRCSTL7",62,0)
 S GMRCSAVE("GMRCQTR")=""
"RTN","GMRCSTL7",63,0)
 ;
"RTN","GMRCSTL7",64,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X S DIR(0)="FO",DIR("A")="ENTER ""?"" FOR MORE HELP OR RETURN TO CONTINUE"
"RTN","GMRCSTL7",65,0)
 S DIR("A",1)="MARGIN WIDTH IS BEST AT 256"
"RTN","GMRCSTL7",66,0)
 S DIR("?")="^D MARGHLP^GMRCSTL7"
"RTN","GMRCSTL7",67,0)
 D:GMRCFMT="DEL" ^DIR
"RTN","GMRCSTL7",68,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) D EXIT Q
"RTN","GMRCSTL7",69,0)
 D EN^XUTMDEVQ("PRNTQ^GMRCSTL7","CONSULT PERFORMANCE MONITOR",.GMRCSAVE)
"RTN","GMRCSTL7",70,0)
 ;
"RTN","GMRCSTL7",71,0)
 D EXIT
"RTN","GMRCSTL7",72,0)
 ;
"RTN","GMRCSTL7",73,0)
 Q
"RTN","GMRCSTL7",74,0)
MARGHLP ;help text to set margins
"RTN","GMRCSTL7",75,0)
 W !,"Specify a device with optional parameters in the format"
"RTN","GMRCSTL7",76,0)
 W !,?8,"Device Name;Right Margin;Page Length"
"RTN","GMRCSTL7",77,0)
 W !,?21,"or"
"RTN","GMRCSTL7",78,0)
 W !,?5,"Device Name;Subtype;Right Margin;Page Length"
"RTN","GMRCSTL7",79,0)
 W !!,"Or in the new format"
"RTN","GMRCSTL7",80,0)
 W !,?14,"Device Name;/settings"
"RTN","GMRCSTL7",81,0)
 W !,?21,"or"
"RTN","GMRCSTL7",82,0)
 W !,?10,"Device Name;Subtype;/settings"
"RTN","GMRCSTL7",83,0)
 W !,"For example"
"RTN","GMRCSTL7",84,0)
 W !,?17,"HOME;80;999"
"RTN","GMRCSTL7",85,0)
 W !,?21,"or"
"RTN","GMRCSTL7",86,0)
 W !,?13,"HOME;C-VT320;/M80L999"
"RTN","GMRCSTL7",87,0)
 Q
"RTN","GMRCSTL7",88,0)
 ;
"RTN","GMRCSTL7",89,0)
ENOR(RETURN,GMRCSVC,GMRC30ST,GMRC30SP,GMRCSTAT,GMRCST2,GMRCARRN) ;Entry point
"RTN","GMRCSTL7",90,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTL7",91,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTL7",92,0)
 ;GMRC30ST:  30 days prior to quarter start date
"RTN","GMRCSTL7",93,0)
 ;GMRC30SP:  30 days prior to quarter end date
"RTN","GMRCSTL7",94,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTL7",95,0)
 ;GMRCARRN: Format of report becomes ^TMP array element
"RTN","GMRCSTL7",96,0)
 ;          "CP": Summary Report; "DEL": Delimited Report
"RTN","GMRCSTL7",97,0)
 ;
"RTN","GMRCSTL7",98,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTL7",99,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTL7",100,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTL7",101,0)
 ;            1  grouper only
"RTN","GMRCSTL7",102,0)
 ;            2  tracking only
"RTN","GMRCSTL7",103,0)
 ;            9  disabled
"RTN","GMRCSTL7",104,0)
 ;
"RTN","GMRCSTL7",105,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTL7",106,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTL7",107,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTL7",108,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTL7",109,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTL7",110,0)
 ;Build service array
"RTN","GMRCSTL7",111,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTL7",112,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",113,0)
 ;Get external form of date range
"RTN","GMRCSTL7",114,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTL7",115,0)
 ;
"RTN","GMRCSTL7",116,0)
 N GMRCDA,INDEX,STATUS,STATUS2,LOOP,GROUPER
"RTN","GMRCSTL7",117,0)
 N GMRCSVCG,GMRCPT,GMRCSVCP,GRP,PIECE,TYPE
"RTN","GMRCSTL7",118,0)
 ;
"RTN","GMRCSTL7",119,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCT",$J)
"RTN","GMRCSTL7",120,0)
 ;
"RTN","GMRCSTL7",121,0)
 S GROUPER=0
"RTN","GMRCSTL7",122,0)
 S GROUPER(0)=0
"RTN","GMRCSTL7",123,0)
 I GMRCARRN="DEL" D
"RTN","GMRCSTL7",124,0)
 . N STR
"RTN","GMRCSTL7",125,0)
 . S STR="Svc;30DayRng;60DayRng;CmpIn30;Cmp31-60;B4Qtr;PndB4Qtr;%Cmp30;%Cmp60;%UnRsB4Qtr;IS30Rng;IS60Rng;ISCmp30;ISCmp31-60;ISB4Qtr;ISPndB4Qtr;%ISCmp30;%ISCmp60;%ISUnRsB4Qtr;"
"RTN","GMRCSTL7",126,0)
 . S STR=STR_"IR30Rng;IR60Rng;IRCmp30;IRCmp31-60;IRB4Qtr;IRPndB4Qtr;%IRCmp30;%IRCmp60;%IRUnRsB4Qtr"
"RTN","GMRCSTL7",127,0)
 . S ^TMP("GMRCR",$J,GMRCARRN,1,0)=STR
"RTN","GMRCSTL7",128,0)
 S INDEX=""
"RTN","GMRCSTL7",129,0)
 ;Loop on Service
"RTN","GMRCSTL7",130,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTL7",131,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTL7",132,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTL7",133,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTL7",134,0)
 .N SUBIDX
"RTN","GMRCSTL7",135,0)
 .;pieces for tmp arrays, 1 to 6 are local, 7 to 12 are IFC placer, 13 to 18 are IFC filler
"RTN","GMRCSTL7",136,0)
 .;;total for 30 day start/end^total for 60 day start/end^results n 30 days^results n 60 days^total before quarter^total pending before quarter
"RTN","GMRCSTL7",137,0)
 .S ^TMP("GMRCT",$J,1,GMRCSVC,"DATA")="0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","GMRCSTL7",138,0)
 .S ^TMP("GMRCT",$J,2,GMRCSVC,"DATA")="0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","GMRCSTL7",139,0)
 .;Check if starting a new Grouper
"RTN","GMRCSTL7",140,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTL7",141,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTL7",142,0)
 ..I GROUPER(GROUPER)=GMRCSVCG D
"RTN","GMRCSTL7",143,0)
 ... I GMRCARRN="CP" D
"RTN","GMRCSTL7",144,0)
 ....D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",145,0)
 ...I GMRCARRN="DEL" D
"RTN","GMRCSTL7",146,0)
 ....D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",147,0)
 ..;pop grouper from stack
"RTN","GMRCSTL7",148,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTL7",149,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTL7",150,0)
 ..;push new grouper on stack
"RTN","GMRCSTL7",151,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTL7",152,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTL7",153,0)
 .;Loop for one status at a time
"RTN","GMRCSTL7",154,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTL7",155,0)
 ..D ONESTAT^GMRCSTL8(GMRCARRN,INDEX,STATUS,GMRC30ST,GMRC30SP,"30")
"RTN","GMRCSTL7",156,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTL7",157,0)
 ..D ONESTAT^GMRCSTL8(GMRCARRN,INDEX,STATUS,$$FMADD^XLFDT(GMRC30ST,-30),$$FMADD^XLFDT(GMRC30SP,-30),"60")
"RTN","GMRCSTL7",158,0)
 .S GMRCDT1=$$FMADD^XLFDT(GMRC30ST,30) ;add 30 days back to set date back to start of FY quarter.
"RTN","GMRCSTL7",159,0)
 .F LOOP=1:1:$L(GMRCST2,",") S STATUS2=$P(GMRCST2,",",LOOP) D
"RTN","GMRCSTL7",160,0)
 ..D ONESTAT2^GMRCSTL8(GMRCARRN,INDEX,STATUS2,$$FMADD^XLFDT(GMRCDT1,-60))
"RTN","GMRCSTL7",161,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTL7",162,0)
 ..F PIECE=1:1:18 D
"RTN","GMRCSTL7",163,0)
 ...S $P(^TMP("GMRCT",$J,2,GROUPER(GRP),"DATA"),U,PIECE)=$P(^TMP("GMRCT",$J,2,GROUPER(GRP),"DATA"),U,PIECE)+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,PIECE)
"RTN","GMRCSTL7",164,0)
 .;
"RTN","GMRCSTL7",165,0)
 .;Print the totals for this service that are >0
"RTN","GMRCSTL7",166,0)
 .I GMRCARRN="CP" D
"RTN","GMRCSTL7",167,0)
 ..D PRTTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",168,0)
 .I GMRCARRN="DEL" D
"RTN","GMRCSTL7",169,0)
 ..D DELTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",170,0)
 .Q
"RTN","GMRCSTL7",171,0)
 ;
"RTN","GMRCSTL7",172,0)
 ;Done, so now list the group totals for the top group
"RTN","GMRCSTL7",173,0)
 ;F GROUPER=GROUPER:-1:1 D  ; left for looking at all totals in future
"RTN","GMRCSTL7",174,0)
 I $G(GROUPER) S GROUPER=1 D
"RTN","GMRCSTL7",175,0)
 .I GMRCARRN="CP" D
"RTN","GMRCSTL7",176,0)
 ..D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",177,0)
 .I GMRCARRN="DEL" D
"RTN","GMRCSTL7",178,0)
 ..D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",179,0)
 Q
"RTN","GMRCSTL7",180,0)
PRNTQ   ;Build report and print it
"RTN","GMRCSTL7",181,0)
 ;
"RTN","GMRCSTL7",182,0)
 N GMRCPG,GMRCTMP,IDX,GMRCQUT,TEMP
"RTN","GMRCSTL7",183,0)
 S GMRCPG=1
"RTN","GMRCSTL7",184,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",185,0)
 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",186,0)
 S TEMP=$S($G(GMRCQTR)=4:"4",$G(GMRCQTR)=3:"3",$G(GMRCQTR)=2:"2",1:"1")_"Q"_"FY"_$E($G(GMRCFY),3,4)
"RTN","GMRCSTL7",187,0)
 S TEMP="Consult/Request Performance Monitor - "_TEMP
"RTN","GMRCSTL7",188,0)
 W $J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",189,0)
 S TEMP="Fiscal Quarter Dates: "_$$FMTE^XLFDT(GMRCDT1)_" - "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSTL7",190,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",191,0)
 S TEMP="30 Days Before Start/End: "_$$FMTE^XLFDT(GMRC30ST)_" - "_$$FMTE^XLFDT(GMRC30SP)
"RTN","GMRCSTL7",192,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",193,0)
 S TEMP="60 Days Before Start/End: "_$$FMTE^XLFDT($$FMADD^XLFDT(GMRC30ST,-30))_" - "_$$FMTE^XLFDT($$FMADD^XLFDT(GMRC30SP,-30))
"RTN","GMRCSTL7",194,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTL7",195,0)
 I '$D(IO("Q")) D WAIT^DICD W !!
"RTN","GMRCSTL7",196,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) D  G EXIT
"RTN","GMRCSTL7",197,0)
 .W !!,"No records to print"
"RTN","GMRCSTL7",198,0)
 D ENOR^GMRCSTL7(.GMRCTMP,GMRCDG,GMRC30ST,GMRC30SP,"2,5,6,8,9","1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,99",GMRCFMT)
"RTN","GMRCSTL7",199,0)
 I '$D(^TMP("GMRCR",$J,GMRCFMT)) D
"RTN","GMRCSTL7",200,0)
 .W !!,"No records to print",!
"RTN","GMRCSTL7",201,0)
 S IDX=""
"RTN","GMRCSTL7",202,0)
 F  S IDX=$O(^TMP("GMRCR",$J,GMRCFMT,IDX)) Q:'IDX!($G(GMRCQUT))  D
"RTN","GMRCSTL7",203,0)
 .I IOSL-$Y<3 D
"RTN","GMRCSTL7",204,0)
 ..I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",205,0)
 ...N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",206,0)
 ...I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",207,0)
 ..Q:$G(GMRCQUT)
"RTN","GMRCSTL7",208,0)
 ..D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",209,0)
 .Q:$G(GMRCQUT)
"RTN","GMRCSTL7",210,0)
 .W ^TMP("GMRCR",$J,GMRCFMT,IDX,0),!
"RTN","GMRCSTL7",211,0)
 D:$D(^TMP("GMRCR",$J,GMRCFMT)) CAVEATS
"RTN","GMRCSTL7",212,0)
 I GMRCFMT="CP",'$G(GMRCQUT) D
"RTN","GMRCSTL7",213,0)
 .Q:$O(^TMP("GMRCT",$J,0,""))=""
"RTN","GMRCSTL7",214,0)
 .I IOSL-$Y<6 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",215,0)
 .W !!!,$$REPEAT^XLFSTR("-",IOM-5)
"RTN","GMRCSTL7",216,0)
 .W !,"Consult services not meeting the criteria of this report for",!,"the specified date range:",!
"RTN","GMRCSTL7",217,0)
 .S IDX=""
"RTN","GMRCSTL7",218,0)
 .F  S IDX=$O(^TMP("GMRCT",$J,0,IDX)) Q:IDX=""!($G(GMRCQUT))  D
"RTN","GMRCSTL7",219,0)
 ..I IOSL-$Y<3 D
"RTN","GMRCSTL7",220,0)
 ...I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",221,0)
 ....N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",222,0)
 ....I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",223,0)
 ...Q:$G(GMRCQUT)
"RTN","GMRCSTL7",224,0)
 ...D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",225,0)
 ..Q:$G(GMRCQUT)
"RTN","GMRCSTL7",226,0)
 ..W ?4,IDX,!
"RTN","GMRCSTL7",227,0)
 D ^%ZISC
"RTN","GMRCSTL7",228,0)
 D EXIT
"RTN","GMRCSTL7",229,0)
 Q
"RTN","GMRCSTL7",230,0)
 ;
"RTN","GMRCSTL7",231,0)
HEAD(PAGE) ; print header for CPM
"RTN","GMRCSTL7",232,0)
 W @IOF
"RTN","GMRCSTL7",233,0)
 I PAGE>1 D
"RTN","GMRCSTL7",234,0)
 .S TEMP=$S($G(GMRCQTR)=4:"4",$G(GMRCQTR)=3:"3",$G(GMRCQTR)=2:"2",1:"1")_"Q"_"FY"_$E($G(GMRCFY),3,4)
"RTN","GMRCSTL7",235,0)
 .S TEMP="Consult/Request Performance Monitor - "_TEMP
"RTN","GMRCSTL7",236,0)
 .W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTL7",237,0)
 W !,$J("Run Date: "_$$HTE^XLFDT($H),0),$J("Page: "_PAGE,48)
"RTN","GMRCSTL7",238,0)
 W !,$$REPEAT^XLFSTR("-",IOM-2),!!
"RTN","GMRCSTL7",239,0)
 Q
"RTN","GMRCSTL7",240,0)
 ;
"RTN","GMRCSTL7",241,0)
CAVEATS ; brief explanatory text
"RTN","GMRCSTL7",242,0)
 W !!,"Resubmitted requests are evaluated based on the original Date of Request."
"RTN","GMRCSTL7",243,0)
 W !!,"The following are excluded from this report:"
"RTN","GMRCSTL7",244,0)
 W !," -Requests sent to test patients."
"RTN","GMRCSTL7",245,0)
 W !," -Requests not marked as Outpatient in the REQUEST/CONSULTATION file."
"RTN","GMRCSTL7",246,0)
 W !," -Services flagged as part of the interface between Consults/Request Tracking"
"RTN","GMRCSTL7",247,0)
 W !,?2,"and Prosthetics."
"RTN","GMRCSTL7",248,0)
 W !," -Administrative requests flagged via the Administrative fields in the"
"RTN","GMRCSTL7",249,0)
 W !,?2,"REQUEST SERVICES and REQUEST/CONSULTATION files. This is not retroactive"
"RTN","GMRCSTL7",250,0)
 W !,?2,"and only applies to services/requests leveraging the Administrative-flagging"
"RTN","GMRCSTL7",251,0)
 W !,?2,"capability included in GMRC*3.0*60."
"RTN","GMRCSTL7",252,0)
 W !," -The report utilizes the CLINICALLY INDICATED DATE field from the "
"RTN","GMRCSTL7",253,0)
 W !,?2,"REQUEST/CONSULTATION file to determine request totals for a given date"
"RTN","GMRCSTL7",254,0)
 W !,?2,"range.  This is true even for requests that have been re-submitted using"
"RTN","GMRCSTL7",255,0)
 W !,?2,"the Edit/Resubmit functionality.",!!
"RTN","GMRCSTL7",256,0)
 Q
"RTN","GMRCSTL7",257,0)
 ;
"RTN","GMRCSTL7",258,0)
EXIT F ARR="GMRCR","GMRCS","GMRCSLIST","GMRCT" K ^TMP(ARR,$J)
"RTN","GMRCSTL7",259,0)
 K ARR
"RTN","GMRCSTL7",260,0)
 Q
"RTN","GMRCSTL7",261,0)
 ;
"RTN","GMRCSTL8")
0^13^B111506461
"RTN","GMRCSTL8",1,0)
GMRCSTL8 ;SLC/JFR/WAT - Totals format for CPM ;12/10/14  14:17
"RTN","GMRCSTL8",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41,60,66,81**;DEC 27, 1997;Build 6
"RTN","GMRCSTL8",3,0)
 ; This routine invokes ICRs
"RTN","GMRCSTL8",4,0)
 ; 875 (file 100.01), 2638 (file 100.01),10104 (XLFSTR),10103 (XLFDT),3744 (VADPT)
"RTN","GMRCSTL8",5,0)
 ;
"RTN","GMRCSTL8",6,0)
 ; portions copied from GMRCSTL1 & GMRCSTL2
"RTN","GMRCSTL8",7,0)
 ;patch 66 - CHKRNG updated location referenced for Clinically Indicated Date (formerly Earliest Appropriate Date) field; this was changed during v28 development.
"RTN","GMRCSTL8",8,0)
 Q  ; can't start here
"RTN","GMRCSTL8",9,0)
PRTTOT(GEN,INDEX,NAME,ARRN) ; totals for printed report
"RTN","GMRCSTL8",10,0)
 N QUIT S QUIT=0 D NOACTVT Q:QUIT=1
"RTN","GMRCSTL8",11,0)
 N GMRCPCT,LAYOUT,FRMT,ROWTEXT,CALC1,CALC2,CALC3,ROWTXT
"RTN","GMRCSTL8",12,0)
 N COUNT,SVCUSG
"RTN","GMRCSTL8",13,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1)
"RTN","GMRCSTL8",14,0)
 I GEN=2 D
"RTN","GMRCSTL8",15,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=""
"RTN","GMRCSTL8",16,0)
 .S SVCUSG=$P(^GMR(123.5,INDEX,0),U,2) I $G(SVCUSG) S NAME=NAME_$S(SVCUSG=1:" <grouper only>",SVCUSG=2:"   <disabled>",1:"")
"RTN","GMRCSTL8",17,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="     GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTL8",18,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=$J("WITHIN     IFC     IFC",75)
"RTN","GMRCSTL8",19,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=$J("FACILITY   SENT    REC'D",77)
"RTN","GMRCSTL8",20,0)
 I GEN=1 D
"RTN","GMRCSTL8",21,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=" "
"RTN","GMRCSTL8",22,0)
 .I $P(^GMR(123.5,INDEX,0),U,2)=9 S NAME=NAME_"   <disabled>"
"RTN","GMRCSTL8",23,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="SERVICE: "_NAME
"RTN","GMRCSTL8",24,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=$J("WITHIN     IFC      IFC",76)
"RTN","GMRCSTL8",25,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=$J("FACILITY   SENT     REC'D",78)
"RTN","GMRCSTL8",26,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U),8)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,7),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,13),9)
"RTN","GMRCSTL8",27,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests in 30 Days Before Start/End of Qtr:"_ROWTXT
"RTN","GMRCSTL8",28,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,2),8)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,8),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,14),9)
"RTN","GMRCSTL8",29,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests in 60 Days Before Start/End of Qtr:"_ROWTXT
"RTN","GMRCSTL8",30,0)
 I GEN=2 D
"RTN","GMRCSTL8",31,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U),8)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,7),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,13),9)
"RTN","GMRCSTL8",32,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests in 30 Days Before Start/End of Qtr:"_ROWTXT
"RTN","GMRCSTL8",33,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,2),8)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,8),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,14),9)
"RTN","GMRCSTL8",34,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests in 60 Days Before Start/End of Qtr:"_ROWTXT
"RTN","GMRCSTL8",35,0)
 I GEN=1!(GEN=2) D
"RTN","GMRCSTL8",36,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,3),12)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,9),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,15),9)
"RTN","GMRCSTL8",37,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="Complete with Results in 30 Days of Request:"_ROWTXT
"RTN","GMRCSTL8",38,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,4),12)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,10),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,16),9)
"RTN","GMRCSTL8",39,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="Complete with Results 31-60 Days of Request:"_ROWTXT
"RTN","GMRCSTL8",40,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,5),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,11),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,17),9)
"RTN","GMRCSTL8",41,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests Created 60 Days Before Qtr Start:"_ROWTXT
"RTN","GMRCSTL8",42,0)
 .S ROWTXT=$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,6),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,12),10)_$J($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,18),9)
"RTN","GMRCSTL8",43,0)
 .S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)="All Requests Pending 60 Days Before Qtr Start:"_ROWTXT
"RTN","GMRCSTL8",44,0)
 .;% complete in 30 days of request
"RTN","GMRCSTL8",45,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U)>0 S CALC1=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,3)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U))*100,2,2)_"%"
"RTN","GMRCSTL8",46,0)
 .S ROWTXT=$S($G(CALC1)="":$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC1))_CALC1)
"RTN","GMRCSTL8",47,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,7)>0 S CALC2=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,9)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,7))*100,2,2)_"%"
"RTN","GMRCSTL8",48,0)
 .S ROWTXT=ROWTXT_$S('$D(CALC2):$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC2))_CALC2)
"RTN","GMRCSTL8",49,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,13)>0 S CALC3=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,15)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,13))*100,2,2)_"%"
"RTN","GMRCSTL8",50,0)
 .S ROWTXT=ROWTXT_$S($G(CALC3)="":$$REPEAT^XLFSTR(" ",9-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",9-$L(CALC3))_CALC3)
"RTN","GMRCSTL8",51,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL8",52,0)
 .S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percent Complete w/Results in 30 Days of Request: "_ROWTXT
"RTN","GMRCSTL8",53,0)
 .;% complete in 60 days of request
"RTN","GMRCSTL8",54,0)
 .K CALC1,CALC2,CALC3
"RTN","GMRCSTL8",55,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,2)>0 S CALC1=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,4)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,2))*100,2,2)_"%"
"RTN","GMRCSTL8",56,0)
 .S ROWTXT=$S($G(CALC1)="":$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC1))_CALC1)
"RTN","GMRCSTL8",57,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,8)>0 S CALC2=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,10)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,8))*100,2,2)_"%"
"RTN","GMRCSTL8",58,0)
 .S ROWTXT=ROWTXT_$S('$D(CALC2):$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC2))_CALC2)
"RTN","GMRCSTL8",59,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,14)>0 S CALC3=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,16)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,14))*100,2,2)_"%"
"RTN","GMRCSTL8",60,0)
 .S ROWTXT=ROWTXT_$S($G(CALC3)="":$$REPEAT^XLFSTR(" ",9-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",9-$L(CALC3))_CALC3)
"RTN","GMRCSTL8",61,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL8",62,0)
 .S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percent Complete w/Results 31-60 Days of Request: "_ROWTXT
"RTN","GMRCSTL8",63,0)
 .;% pending before quarter start
"RTN","GMRCSTL8",64,0)
 .K CALC1,CALC2,CALC3
"RTN","GMRCSTL8",65,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,5)>0 S CALC1=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,6)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,5))*100,2,2)_"%"
"RTN","GMRCSTL8",66,0)
 .S ROWTXT=$S($G(CALC1)="":$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC1))_CALC1)
"RTN","GMRCSTL8",67,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,11)>0 S CALC2=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,12)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,11))*100,2,2)_"%"
"RTN","GMRCSTL8",68,0)
 .S ROWTXT=ROWTXT_$S('$D(CALC2):$$REPEAT^XLFSTR(" ",10-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",10-$L(CALC2))_CALC2)
"RTN","GMRCSTL8",69,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,17)>0 S CALC3=$J(($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,18)/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,17))*100,2,2)_"%"
"RTN","GMRCSTL8",70,0)
 .S ROWTXT=ROWTXT_$S($G(CALC3)="":$$REPEAT^XLFSTR(" ",9-$L("N / A"))_"N / A",1:$$REPEAT^XLFSTR(" ",9-$L(CALC3))_CALC3)
"RTN","GMRCSTL8",71,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL8",72,0)
 .S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percent Still Pending Created Before Qtr Start:   "_ROWTXT
"RTN","GMRCSTL8",73,0)
 Q
"RTN","GMRCSTL8",74,0)
DELTOT(GEN,INDEX,NAME,ARRN) ; format for delimited
"RTN","GMRCSTL8",75,0)
 N QUIT S QUIT=0 D NOACTVT Q:QUIT=1
"RTN","GMRCSTL8",76,0)
 N STRING,COUNT,PIECE,INCR,SVCUSG
"RTN","GMRCSTL8",77,0)
 S SVCUSG=$P(^GMR(123.5,INDEX,0),U,2) I $G(SVCUSG) S NAME=NAME_$S(SVCUSG=1:" <grouper only>",SVCUSG=2:" <disabled>",1:"")
"RTN","GMRCSTL8",78,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1),STRING=$S(GEN=2:"GROUPER: ",1:"")_NAME_";"
"RTN","GMRCSTL8",79,0)
 F PIECE=1:1:18 D
"RTN","GMRCSTL8",80,0)
 .S STRING=STRING_$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,PIECE)_";"
"RTN","GMRCSTL8",81,0)
 .I PIECE=6!(PIECE=12)!(PIECE=18) D
"RTN","GMRCSTL8",82,0)
 ..S INCR=$S(PIECE=6:0,PIECE=12:6,1:12)
"RTN","GMRCSTL8",83,0)
 ..;percents
"RTN","GMRCSTL8",84,0)
 ..I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(1+INCR))=0 S STRING=STRING_"N/A;"
"RTN","GMRCSTL8",85,0)
 ..E  S GMRCPCT=($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(3+INCR))/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(1+INCR)))*100,STRING=STRING_$J(GMRCPCT,0,2)_";"
"RTN","GMRCSTL8",86,0)
 ..I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(2+INCR))=0 S STRING=STRING_"N/A;"
"RTN","GMRCSTL8",87,0)
 ..E  S GMRCPCT=($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(4+INCR))/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(2+INCR)))*100,STRING=STRING_$J(GMRCPCT,0,2)_";"
"RTN","GMRCSTL8",88,0)
 ..I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(5+INCR))=0 S STRING=STRING_"N/A;"
"RTN","GMRCSTL8",89,0)
 ..E  S GMRCPCT=($P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(6+INCR))/$P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,(5+INCR)))*100,STRING=STRING_$J(GMRCPCT,0,2)_";"
"RTN","GMRCSTL8",90,0)
 S COUNT=COUNT+1,^TMP("GMRCR",$J,ARRN,COUNT,0)=STRING
"RTN","GMRCSTL8",91,0)
 Q
"RTN","GMRCSTL8",92,0)
NOACTVT ;services with no activity for the reporting period
"RTN","GMRCSTL8",93,0)
 N CONT,PIECE S CONT=1
"RTN","GMRCSTL8",94,0)
 I GEN=1&($P(^GMR(123.5,INDEX,0),U,2)=1) S QUIT=1 Q  ;;don't add to list if service is a grouper only...
"RTN","GMRCSTL8",95,0)
 F PIECE=1:1:18 D  Q:CONT=0
"RTN","GMRCSTL8",96,0)
 .I $P(^TMP("GMRCT",$J,GEN,INDEX,"DATA"),U,PIECE)>0 S CONT=0 Q
"RTN","GMRCSTL8",97,0)
 S:CONT=1 ^TMP("GMRCT",$J,0,NAME)="",QUIT=1
"RTN","GMRCSTL8",98,0)
 Q
"RTN","GMRCSTL8",99,0)
ONESTAT(ARRN,SVCN,STAT,DT1,DT2,STR) ;Process one status
"RTN","GMRCSTL8",100,0)
 ;Input -- ARRN  "CP"  - to be printed  or "DEL" - in delimited format
"RTN","GMRCSTL8",101,0)
 ;SVCN = node in ^TMP("GMRCLIST,$J..STAT = status being worked on..DT1 = starting date..DT2 = ending date
"RTN","GMRCSTL8",102,0)
 ;STR = string value used to store 30/60 day results in correct piece of ^tmp arrays
"RTN","GMRCSTL8",103,0)
 ;Output - None
"RTN","GMRCSTL8",104,0)
 N GMRCPT,GMRCXDT,TEMP,GMRCSVC,GMRCSVCG,GMRCSVCP,GMRCQT,FLG,TYPE
"RTN","GMRCSTL8",105,0)
 S GMRCSVC=$P(^TMP("GMRCSLIST",$J,SVCN),"^",1)
"RTN","GMRCSTL8",106,0)
 S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,SVCN),"^",2)
"RTN","GMRCSTL8",107,0)
 S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,SVCN),"^",3)
"RTN","GMRCSTL8",108,0)
 S GMRCXDT=9999999-DT2-.6  ;start searching the global at a date a fraction newer than DT2 (the end date for this search)
"RTN","GMRCSTL8",109,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT)) Q:GMRCXDT=""!(GMRCXDT>(9999999-DT1))  D
"RTN","GMRCSTL8",110,0)
 .S GMRCPT=0
"RTN","GMRCSTL8",111,0)
 .;Loop for one consult at a time
"RTN","GMRCSTL8",112,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTL8",113,0)
 ..S FLG=0 D EXCLUDE Q:$G(FLG)=1
"RTN","GMRCSTL8",114,0)
 ..S TYPE="" D REQTYPE
"RTN","GMRCSTL8",115,0)
 ..I TYPE="LOCAL" D  ;set totals for 30 and 60 day range
"RTN","GMRCSTL8",116,0)
 ...S:STR="30" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U)+1
"RTN","GMRCSTL8",117,0)
 ...S:STR="60" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,2)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,2)+1
"RTN","GMRCSTL8",118,0)
 ...I STAT=2 D
"RTN","GMRCSTL8",119,0)
 ....Q:'$O(^GMR(123,+$G(GMRCPT),50,0))  ;Q if no results
"RTN","GMRCSTL8",120,0)
 ....D CHKRNG
"RTN","GMRCSTL8",121,0)
 ..I TYPE="IFCP" D
"RTN","GMRCSTL8",122,0)
 ...S:STR="30" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,7)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,7)+1
"RTN","GMRCSTL8",123,0)
 ...S:STR="60" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,8)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,8)+1
"RTN","GMRCSTL8",124,0)
 ...D:STAT=2 CHKRNG
"RTN","GMRCSTL8",125,0)
 ..I TYPE="IFCF" D
"RTN","GMRCSTL8",126,0)
 ...S:STR="30" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,13)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,13)+1
"RTN","GMRCSTL8",127,0)
 ...S:STR="60" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,14)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,14)+1
"RTN","GMRCSTL8",128,0)
 ...D:STAT=2 CHKRNG
"RTN","GMRCSTL8",129,0)
 Q
"RTN","GMRCSTL8",130,0)
 ;
"RTN","GMRCSTL8",131,0)
ONESTAT2(ARRN,SVCN,STAT,DT1) ;all statuses, all requests, before quarter start
"RTN","GMRCSTL8",132,0)
 ;Input -- ARRN  "CP"  - to be printed or "DEL" - in delimited format
"RTN","GMRCSTL8",133,0)
 ;SVCN = node in ^TMP("GMRCLIST,$J..STAT = status being worked on..DT1 = 60 days before starting date of current quarter
"RTN","GMRCSTL8",134,0)
 ;Output -- None
"RTN","GMRCSTL8",135,0)
 N GMRCPT,GMRCXDT,TEMP,GMRCSVC,GMRCSVCG,GMRCSVCP,FLG,TYPE
"RTN","GMRCSTL8",136,0)
 S GMRCSVC=$P(^TMP("GMRCSLIST",$J,SVCN),"^",1)
"RTN","GMRCSTL8",137,0)
 S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,SVCN),"^",2)
"RTN","GMRCSTL8",138,0)
 S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,SVCN),"^",3)
"RTN","GMRCSTL8",139,0)
 S GMRCXDT=""
"RTN","GMRCSTL8",140,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT)) Q:GMRCXDT=""  D
"RTN","GMRCSTL8",141,0)
 .S GMRCPT=0
"RTN","GMRCSTL8",142,0)
 .;Loop for one consult at a time
"RTN","GMRCSTL8",143,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTL8",144,0)
 ..Q:GMRCXDT<(9999999-DT1-.6)  ;
"RTN","GMRCSTL8",145,0)
 ..S FLG=0 D EXCLUDE Q:$G(FLG)=1
"RTN","GMRCSTL8",146,0)
 ..S TYPE="" D REQTYPE
"RTN","GMRCSTL8",147,0)
 ..I TYPE="LOCAL" D
"RTN","GMRCSTL8",148,0)
 ...S $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,5)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,5)+1
"RTN","GMRCSTL8",149,0)
 ...; get unresolved requests for the period
"RTN","GMRCSTL8",150,0)
 ...S:",3,4,5,6,8,9,11,99,"[(","_STAT_",") $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,6)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,6)+1
"RTN","GMRCSTL8",151,0)
 ..I TYPE="IFCP" D
"RTN","GMRCSTL8",152,0)
 ...S $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,11)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,11)+1
"RTN","GMRCSTL8",153,0)
 ...S:",3,4,5,6,8,9,11,99,"[(","_STAT_",") $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,12)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,12)+1
"RTN","GMRCSTL8",154,0)
 ..I TYPE="IFCF" D
"RTN","GMRCSTL8",155,0)
 ...S $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,17)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,17)+1
"RTN","GMRCSTL8",156,0)
 ...S:",3,4,5,6,8,9,11,99,"[(","_STAT_",") $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,18)=$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,18)+1
"RTN","GMRCSTL8",157,0)
 Q
"RTN","GMRCSTL8",158,0)
REQTYPE  ;If the request is being requested and performed locally, this field will be blank; Placer done elsewhere, Filler done locally
"RTN","GMRCSTL8",159,0)
 I $P(^GMR(123,$G(GMRCPT),0),U,23)="" S TYPE="LOCAL" Q
"RTN","GMRCSTL8",160,0)
 I $P(^GMR(123,$G(GMRCPT),0),U,23)'=""&($P($G(^GMR(123,GMRCPT,12)),U,5)="P") S TYPE="IFCP" Q
"RTN","GMRCSTL8",161,0)
 I $P(^GMR(123,$G(GMRCPT),0),U,23)'=""&($P($G(^GMR(123,GMRCPT,12)),U,5)="F") S TYPE="IFCF" Q
"RTN","GMRCSTL8",162,0)
 Q
"RTN","GMRCSTL8",163,0)
EXCLUDE ;exclude these request types from the count
"RTN","GMRCSTL8",164,0)
 N PROS
"RTN","GMRCSTL8",165,0)
 ; Check for bad "AE" x-ref
"RTN","GMRCSTL8",166,0)
 I '$D(^GMR(123,GMRCPT,0)) D  S FLG=1 Q
"RTN","GMRCSTL8",167,0)
 .K ^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)
"RTN","GMRCSTL8",168,0)
 I $$TESTPAT^VADPT(+$P(^GMR(123,GMRCPT,0),U,2)) S FLG=1 Q  ; exclude test pats
"RTN","GMRCSTL8",169,0)
 D  I $G(PROS) S FLG=1 Q
"RTN","GMRCSTL8",170,0)
 .N SVC S SVC=$P(^GMR(123,GMRCPT,0),U,5)
"RTN","GMRCSTL8",171,0)
 .I +$G(^GMR(123.5,SVC,"INT")) S PROS=1 ; exclude PROS consults
"RTN","GMRCSTL8",172,0)
 I $P($G(^GMR(123,GMRCPT,0)),U,18)'="O" S FLG=1 Q  ; only getting outpat
"RTN","GMRCSTL8",173,0)
 I $G(^GMR(123,GMRCPT,70))["Y" S FLG=1 Q  ; exclude admin requests
"RTN","GMRCSTL8",174,0)
 Q
"RTN","GMRCSTL8",175,0)
CHKRNG ;check if request is complete within 30/60 days of Desired Date or Date of Request
"RTN","GMRCSTL8",176,0)
 N DTOR,DTCMPL S DTOR="",DTCMPL=""
"RTN","GMRCSTL8",177,0)
 Q:'$O(^GMR(123,+$G(GMRCPT),50,0))&('$O(^GMR(123,+$G(GMRCPT),51,0)))
"RTN","GMRCSTL8",178,0)
 I $P(^GMR(123,+$G(GMRCPT),0),U,24)>0 S DTOR=$P(^GMR(123,+$G(GMRCPT),0),U,24) ;check for desired date CPRS GUI v28
"RTN","GMRCSTL8",179,0)
 S:$G(DTOR)="" DTOR=$P(^GMR(123,+$G(GMRCPT),0),U,7)
"RTN","GMRCSTL8",180,0)
 ; if request is completed and has results, was it completed within 30 or 60 days of the Date of Request, field 3 in 123 [0;7]
"RTN","GMRCSTL8",181,0)
 ;order through activity multiple (40) and find the entry for completed 40, [0:2] - value of 10 is complete/update
"RTN","GMRCSTL8",182,0)
 N CHK S CHK=0
"RTN","GMRCSTL8",183,0)
 F  S CHK=$O(^GMR(123,+$G(GMRCPT),40,CHK)) Q:CHK="B"  D
"RTN","GMRCSTL8",184,0)
 .;get the date/time of completion 40, [0;3]
"RTN","GMRCSTL8",185,0)
 .I $D(^GMR(123,+$G(GMRCPT),40,CHK,0)) S:($P(^GMR(123,GMRCPT,40,CHK,0),U,2)=10) DTCMPL=$P(^GMR(123,GMRCPT,40,CHK,0),U,3)
"RTN","GMRCSTL8",186,0)
 I $G(DTCMPL) D
"RTN","GMRCSTL8",187,0)
 .I (STR="30")&(DTCMPL<=$$FMADD^XLFDT(DTOR,30)) D
"RTN","GMRCSTL8",188,0)
 ..S:TYPE="LOCAL" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,3)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,3)+1
"RTN","GMRCSTL8",189,0)
 ..S:TYPE="IFCP" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,9)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,9)+1
"RTN","GMRCSTL8",190,0)
 ..S:TYPE="IFCF" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,15)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,15)+1
"RTN","GMRCSTL8",191,0)
 .I STR'="30"&(DTCMPL<=$$FMADD^XLFDT(DTOR,60))&(DTCMPL>$$FMADD^XLFDT(DTOR,30)) D
"RTN","GMRCSTL8",192,0)
 ..S:TYPE="LOCAL" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,4)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,4)+1
"RTN","GMRCSTL8",193,0)
 ..S:TYPE="IFCP" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,10)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,10)+1
"RTN","GMRCSTL8",194,0)
 ..S:TYPE="IFCF" $P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,16)=+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,16)+1
"RTN","GMRCSTL8",195,0)
 Q
"VER")
8.0^22.0
"^DD",123,123,17,0)
CLINICALLY INDICATED DATE^D^^0;24^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",123,123,17,3)
Enter the clinically indicated date for consultation.
"^DD",123,123,17,21,0)
^^9^9^3150225^^
"^DD",123,123,17,21,1,0)
The Clinically Indicated Date (CID) is entered by a provider ordering a 
"^DD",123,123,17,21,2,0)
consult and should be the date by which it is clinically appropriate to 
"^DD",123,123,17,21,3,0)
complete the consult. This date is used by the Consults Performance
"^DD",123,123,17,21,4,0)
Monitor Report to help determine the wait times for specialty care.
"^DD",123,123,17,21,5,0)
 
"^DD",123,123,17,21,6,0)
This field was formerly named EARLIEST DATE, and was commonly referred to
"^DD",123,123,17,21,7,0)
as "Earliest Appropriate Date".  It was introduced with GMRC*3.0*66 as
"^DD",123,123,17,21,8,0)
part of CPRS GUI v28 (OR*3*280). The new name was introduced via
"^DD",123,123,17,21,9,0)
GMRC*3.0*81 as part of CPRS GUI v30.B (OR*3*350).
"^DD",123,123,17,"DT")
3150225
**END**
**END**
