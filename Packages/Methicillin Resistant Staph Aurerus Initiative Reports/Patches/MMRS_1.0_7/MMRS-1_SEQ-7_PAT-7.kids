Released MMRS*1*7 SEQ #7
Extracted from mail message
**KIDS**:MMRS*1.0*7^

**INSTALL NAME**
MMRS*1.0*7
"BLD",10588,0)
MMRS*1.0*7^MDRO INITIATIVE REPORTS^0^3181022^y
"BLD",10588,1,0)
^^1^1^3181022^
"BLD",10588,1,1,0)
Refer to the National Patch Module.
"BLD",10588,4,0)
^9.64PA^^
"BLD",10588,6.3)
1
"BLD",10588,"ABPKG")
n
"BLD",10588,"KRN",0)
^9.67PA^1.61^23
"BLD",10588,"KRN",.4,0)
.4
"BLD",10588,"KRN",.401,0)
.401
"BLD",10588,"KRN",.402,0)
.402
"BLD",10588,"KRN",.403,0)
.403
"BLD",10588,"KRN",.5,0)
.5
"BLD",10588,"KRN",.84,0)
.84
"BLD",10588,"KRN",1.6,0)
1.6
"BLD",10588,"KRN",1.61,0)
1.61
"BLD",10588,"KRN",1.62,0)
1.62
"BLD",10588,"KRN",3.6,0)
3.6
"BLD",10588,"KRN",3.8,0)
3.8
"BLD",10588,"KRN",9.2,0)
9.2
"BLD",10588,"KRN",9.8,0)
9.8
"BLD",10588,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10588,"KRN",9.8,"NM",1,0)
MMRSIPC^^0^B108454756
"BLD",10588,"KRN",9.8,"NM","B","MMRSIPC",1)

"BLD",10588,"KRN",19,0)
19
"BLD",10588,"KRN",19.1,0)
19.1
"BLD",10588,"KRN",101,0)
101
"BLD",10588,"KRN",409.61,0)
409.61
"BLD",10588,"KRN",771,0)
771
"BLD",10588,"KRN",779.2,0)
779.2
"BLD",10588,"KRN",870,0)
870
"BLD",10588,"KRN",8989.51,0)
8989.51
"BLD",10588,"KRN",8989.52,0)
8989.52
"BLD",10588,"KRN",8994,0)
8994
"BLD",10588,"KRN","B",.4,.4)

"BLD",10588,"KRN","B",.401,.401)

"BLD",10588,"KRN","B",.402,.402)

"BLD",10588,"KRN","B",.403,.403)

"BLD",10588,"KRN","B",.5,.5)

"BLD",10588,"KRN","B",.84,.84)

"BLD",10588,"KRN","B",1.6,1.6)

"BLD",10588,"KRN","B",1.61,1.61)

"BLD",10588,"KRN","B",1.62,1.62)

"BLD",10588,"KRN","B",3.6,3.6)

"BLD",10588,"KRN","B",3.8,3.8)

"BLD",10588,"KRN","B",9.2,9.2)

"BLD",10588,"KRN","B",9.8,9.8)

"BLD",10588,"KRN","B",19,19)

"BLD",10588,"KRN","B",19.1,19.1)

"BLD",10588,"KRN","B",101,101)

"BLD",10588,"KRN","B",409.61,409.61)

"BLD",10588,"KRN","B",771,771)

"BLD",10588,"KRN","B",779.2,779.2)

"BLD",10588,"KRN","B",870,870)

"BLD",10588,"KRN","B",8989.51,8989.51)

"BLD",10588,"KRN","B",8989.52,8989.52)

"BLD",10588,"KRN","B",8994,8994)

"BLD",10588,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10588,"QUES",0)
^9.62^^
"BLD",10588,"REQB",0)
^9.611^1^1
"BLD",10588,"REQB",1,0)
MMRS*1.0*5^2
"BLD",10588,"REQB","B","MMRS*1.0*5",1)

"MBREQ")
0
"PKG",566,-1)
1^1
"PKG",566,0)
MDRO INITIATIVE REPORTS^MMRS^MRSA PREVENTION INITIATIVE
"PKG",566,22,0)
^9.49I^1^1
"PKG",566,22,1,0)
1.0^3091030^3100210^10000000180
"PKG",566,22,1,"PAH",1,0)
7^3181022
"PKG",566,22,1,"PAH",1,1,0)
^^1^1^3181022
"PKG",566,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MMRSIPC")
0^1^B108454756^B103279928
"RTN","MMRSIPC",1,0)
MMRSIPC ;MIA/LMT - Print MRSA IPEC Report ;Oct 18, 2018@15:12
"RTN","MMRSIPC",2,0)
 ;;1.0;MRSA PROGRAM TOOLS;**3,5,7**;Mar 22, 2009;Build 1
"RTN","MMRSIPC",3,0)
 ;
"RTN","MMRSIPC",4,0)
 ;This is the main routine to print the MRSA IPEC Report.
"RTN","MMRSIPC",5,0)
 ;This routine uses functions contained in MMRSIPC2, MMRSIPC3, and MMRSIPC4.
"RTN","MMRSIPC",6,0)
MAIN ;
"RTN","MMRSIPC",7,0)
 N NUMDIV,MMRSDIV,MMRSLOC,EXTFLG,STRTDT,ENDDT,PRTSUM,BYADM
"RTN","MMRSIPC",8,0)
 D CHECK
"RTN","MMRSIPC",9,0)
 D CHECK2
"RTN","MMRSIPC",10,0)
 I $D(EXTFLG) W ! H 2 Q
"RTN","MMRSIPC",11,0)
 W !
"RTN","MMRSIPC",12,0)
 S MMRSDIV=$$GETDIV Q:$D(EXTFLG)!(MMRSDIV="")
"RTN","MMRSIPC",13,0)
 D CHECK3
"RTN","MMRSIPC",14,0)
 I $D(EXTFLG) W ! H 2 Q
"RTN","MMRSIPC",15,0)
 D PROMPT Q:$D(EXTFLG)
"RTN","MMRSIPC",16,0)
 D ASKDVC Q:$D(EXTFLG)
"RTN","MMRSIPC",17,0)
 K MMRSSUM
"RTN","MMRSIPC",18,0)
 Q
"RTN","MMRSIPC",19,0)
CHECK ;Check if parameters are setup
"RTN","MMRSIPC",20,0)
 N NUMDIV,MMRSDIV
"RTN","MMRSIPC",21,0)
 S NUMDIV=0
"RTN","MMRSIPC",22,0)
 S MMRSDIV=0 F  S MMRSDIV=$O(^MMRS(104,MMRSDIV)) Q:'MMRSDIV  I $D(^MMRS(104,MMRSDIV,0)) S NUMDIV=NUMDIV+1
"RTN","MMRSIPC",23,0)
 I NUMDIV=0 D
"RTN","MMRSIPC",24,0)
 .W !!,"   >>> Make sure a division has been setup using option:"
"RTN","MMRSIPC",25,0)
 .W !,"          'MRSA Tools Parameter Setup (Main)'"
"RTN","MMRSIPC",26,0)
 .S EXTFLG=1
"RTN","MMRSIPC",27,0)
 Q
"RTN","MMRSIPC",28,0)
CHECK2 ;Check if lab tests and etiologies are setup
"RTN","MMRSIPC",29,0)
 N TSTSTP,MRSAETIO,MRSASTAP,ORG,ETIONAME,MMRSET,MMRSI
"RTN","MMRSIPC",30,0)
 S TSTSTP=0
"RTN","MMRSIPC",31,0)
 I $D(^LAB(60,"B","MRSA SURVL NARES DNA"))!($D(^LAB(60,"B","MRSA SURVL NARES AGAR"))) S TSTSTP=1
"RTN","MMRSIPC",32,0)
 I $O(^LAB(60,"B","MRSA SURVL NARES DNA"))["MRSA SURVL NARES DNA" S TSTSTP=1
"RTN","MMRSIPC",33,0)
 I $O(^LAB(60,"B","MRSA SURVL NARES AGAR"))["MRSA SURVL NARES AGAR" S TSTSTP=1
"RTN","MMRSIPC",34,0)
 I 'TSTSTP D
"RTN","MMRSIPC",35,0)
 .S EXTFLG=1
"RTN","MMRSIPC",36,0)
 .W !!,"   >>> Make sure the MRSA CH-subscripted tests have been setup according"
"RTN","MMRSIPC",37,0)
 .W !,"       to the National Guidelines. Laboratory needs to setup at least"
"RTN","MMRSIPC",38,0)
 .W !,"       one of these lab tests in the system before generating reports:"
"RTN","MMRSIPC",39,0)
 .W !,"          1. 'MRSA SURVL NARES DNA'"
"RTN","MMRSIPC",40,0)
 .W !,"          2. 'MRSA SURVL NARES AGAR'"
"RTN","MMRSIPC",41,0)
 S MRSAETIO=0
"RTN","MMRSIPC",42,0)
 ;S MRSASTAP="STAPHYLOCOCCUS AUREUS METH" F  S MRSASTAP=$O(^LAB(61.2,"B",MRSASTAP)) Q:MRSASTAP=""!(MRSASTAP]"STAPHYLOCOCCUS AUREUSZ")  D
"RTN","MMRSIPC",43,0)
 ;.S ORG=0 F  S ORG=$O(^LAB(61.2,"B",MRSASTAP,ORG)) Q:'ORG  D
"RTN","MMRSIPC",44,0)
 ;..S ETIONAME=$P($G(^LAB(61.2,ORG,0)),U,1)
"RTN","MMRSIPC",45,0)
 ;..I ETIONAME["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT (MRSA)" S MRSAETIO=ORG
"RTN","MMRSIPC",46,0)
 D FIND^DIC(61.2,,".01E;@","PM","STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT",,"B",,,"MMRSET")
"RTN","MMRSIPC",47,0)
 S MMRSI="" F  S MMRSI=$O(MMRSET("DILIST",MMRSI)) Q:MMRSI=""  I +MMRSI>0  D
"RTN","MMRSIPC",48,0)
 .S ETIONAME=$P($G(MMRSET("DILIST",MMRSI,0)),U,2)
"RTN","MMRSIPC",49,0)
 .S ORG=$P($G(MMRSET("DILIST",MMRSI,0)),U,1)
"RTN","MMRSIPC",50,0)
 .I ETIONAME["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT" S MRSAETIO=ORG
"RTN","MMRSIPC",51,0)
 I 'MRSAETIO D
"RTN","MMRSIPC",52,0)
 .S EXTFLG=1
"RTN","MMRSIPC",53,0)
 .W !!,"   >>> Make sure the Etiology has been setup according "
"RTN","MMRSIPC",54,0)
 .W !,"       to the National Guidelines. The following etiology "
"RTN","MMRSIPC",55,0)
 .W !,"       must be added to the Etiology Field file (#61.2):"
"RTN","MMRSIPC",56,0)
 .W !,"          'STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT (MRSA)' "
"RTN","MMRSIPC",57,0)
 Q
"RTN","MMRSIPC",58,0)
CHECK3 ;Check if Ward Mappings have been setup for this division
"RTN","MMRSIPC",59,0)
 N NUMLOC,MMRSLOC
"RTN","MMRSIPC",60,0)
 S NUMLOC=0
"RTN","MMRSIPC",61,0)
 S MMRSLOC=0 F  S MMRSLOC=$O(^MMRS(104.3,MMRSLOC)) Q:'MMRSLOC  I $P($G(^MMRS(104.3,MMRSLOC,0)),U,2)=MMRSDIV S NUMLOC=NUMLOC+1
"RTN","MMRSIPC",62,0)
 I NUMLOC=0 W !!,"   >>> Make sure the Ward Mappings for each Geographical Unit has been setup.",!! S EXTFLG=1
"RTN","MMRSIPC",63,0)
 Q
"RTN","MMRSIPC",64,0)
MAIN2 ; Entry for queuing
"RTN","MMRSIPC",65,0)
 N ODOBS
"RTN","MMRSIPC",66,0)
 D CLEAN ;Kill Temp Global
"RTN","MMRSIPC",67,0)
 D GETPARAM ; Load parameters in temp global
"RTN","MMRSIPC",68,0)
 D GETMOVE^MMRSIPC2 ;Get movements and store in temp global
"RTN","MMRSIPC",69,0)
 D GETLABS^MMRSIPC3 ;Get swabbing rates and MRSA history and store in temp global
"RTN","MMRSIPC",70,0)
 I 'BYADM D PATDAYS ;Get patient days of care
"RTN","MMRSIPC",71,0)
 D PRINT^MMRSIPC4 ;Print report
"RTN","MMRSIPC",72,0)
 D CLEAN ;Kill Temp Global
"RTN","MMRSIPC",73,0)
 Q
"RTN","MMRSIPC",74,0)
CLEAN ;
"RTN","MMRSIPC",75,0)
 K ^TMP($J,"MMRSIPC")
"RTN","MMRSIPC",76,0)
 Q
"RTN","MMRSIPC",77,0)
GETDIV() ;Prompt user to select Division
"RTN","MMRSIPC",78,0)
 N MMRSDIV,COUNT,DIV,DIC,Y,DLAYGO,X,DTOUT,DUOUT
"RTN","MMRSIPC",79,0)
 S MMRSDIV=""
"RTN","MMRSIPC",80,0)
 S COUNT=0,DIV=0 F  S DIV=$O(^MMRS(104,DIV)) Q:'DIV  S COUNT=COUNT+1
"RTN","MMRSIPC",81,0)
 I COUNT=1 S MMRSDIV=$O(^MMRS(104,0)) Q MMRSDIV
"RTN","MMRSIPC",82,0)
 S DIC="^DG(40.8,"
"RTN","MMRSIPC",83,0)
 S DIC(0)="AEMQ"
"RTN","MMRSIPC",84,0)
 S DIC("A")="Select the Division: "
"RTN","MMRSIPC",85,0)
 S DIC("S")="I $D(^MMRS(104,""B"",Y))"
"RTN","MMRSIPC",86,0)
 D ^DIC K DIC
"RTN","MMRSIPC",87,0)
 I $D(DTOUT)!($D(DUOUT))!(Y=-1) S EXTFLG=1 Q ""
"RTN","MMRSIPC",88,0)
 S MMRSDIV=+Y
"RTN","MMRSIPC",89,0)
 S MMRSDIV=$O(^MMRS(104,"B",MMRSDIV,0))
"RTN","MMRSIPC",90,0)
 Q MMRSDIV
"RTN","MMRSIPC",91,0)
PROMPT ;Prompts user for start date, end date, locations, and if user wants to only print the Summary Report.
"RTN","MMRSIPC",92,0)
 ;Prompt if should run report by Admission or Discharge
"RTN","MMRSIPC",93,0)
 N DIR,DIRUT,PRMPTTXT,Y
"RTN","MMRSIPC",94,0)
 S DIR(0)="S^A:Admission Report;D:Discharge/Transmission Report"
"RTN","MMRSIPC",95,0)
 S DIR("A")="Run (A)dmission Or (D)ischarge/Transmission Report"
"RTN","MMRSIPC",96,0)
 D ^DIR K DIR
"RTN","MMRSIPC",97,0)
 I $D(DIRUT) S EXTFLG=1 Q
"RTN","MMRSIPC",98,0)
 I Y="A" S BYADM=1,PRMPTTXT="ward admission"
"RTN","MMRSIPC",99,0)
 I Y="D" S BYADM=0,PRMPTTXT="ward discharge"
"RTN","MMRSIPC",100,0)
DATE ;Prompts user for date range
"RTN","MMRSIPC",101,0)
 N %DT,X
"RTN","MMRSIPC",102,0)
 K Y
"RTN","MMRSIPC",103,0)
 W ! S %DT="AEPX",%DT("A")="Begin with "_PRMPTTXT_" date: " D ^%DT
"RTN","MMRSIPC",104,0)
 I Y<0 S EXTFLG=1 Q
"RTN","MMRSIPC",105,0)
 S STRTDT=Y
"RTN","MMRSIPC",106,0)
 S %DT("A")="End with "_PRMPTTXT_" date: " D ^%DT
"RTN","MMRSIPC",107,0)
 I Y<0 S EXTFLG=1 Q
"RTN","MMRSIPC",108,0)
 S ENDDT=Y
"RTN","MMRSIPC",109,0)
 I '$P(ENDDT,".",2) S ENDDT=Y+.24
"RTN","MMRSIPC",110,0)
 I ENDDT<STRTDT W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","MMRSIPC",111,0)
LOC ;Prompts user for locations
"RTN","MMRSIPC",112,0)
 W !
"RTN","MMRSIPC",113,0)
 S DIR(0)="YA",DIR("A")="Do you want to select all locations? ",DIR("B")="NO"
"RTN","MMRSIPC",114,0)
 D ^DIR K DIR
"RTN","MMRSIPC",115,0)
 I $D(DIRUT) S EXTFLG=1 Q
"RTN","MMRSIPC",116,0)
 I Y=1 D  G SUMRPT
"RTN","MMRSIPC",117,0)
 .S Y=0 F  S Y=$O(^MMRS(104.3,Y)) Q:'Y  I $P($G(^MMRS(104.3,Y,0)),U,2)=MMRSDIV S MMRSLOC(Y)=""
"RTN","MMRSIPC",118,0)
 ;PROMPT FOR WARDS
"RTN","MMRSIPC",119,0)
 N DIC,DLAYGO,DTOUT,DUOUT
"RTN","MMRSIPC",120,0)
 W !
"RTN","MMRSIPC",121,0)
 S DIC("A")="Select Geographical Location: "
"RTN","MMRSIPC",122,0)
 S DIC("S")="I $P($G(^MMRS(104.3,Y,0)),U,2)="_MMRSDIV
"RTN","MMRSIPC",123,0)
 S DIC="^MMRS(104.3,",DIC(0)="QEAM" D ^DIC
"RTN","MMRSIPC",124,0)
 I (Y=-1)!($D(DTOUT))!($D(DUOUT)) S EXTFLG=1 Q
"RTN","MMRSIPC",125,0)
 S MMRSLOC(+Y)=""
"RTN","MMRSIPC",126,0)
 S DIC("A")="Select another Geographical Location: " F  D ^DIC Q:Y=-1  S MMRSLOC(+Y)=""
"RTN","MMRSIPC",127,0)
 K DIC
"RTN","MMRSIPC",128,0)
 I ($D(DTOUT))!($D(DUOUT)) S EXTFLG=1 Q
"RTN","MMRSIPC",129,0)
SUMRPT ;Prompt user if should only run the summary report.
"RTN","MMRSIPC",130,0)
 I $G(MMRSSUM) S PRTSUM=1 Q  ; IF OPTION IS ONLY FOR SUMMARY REPORT...
"RTN","MMRSIPC",131,0)
 W !
"RTN","MMRSIPC",132,0)
 S DIR(0)="Y"
"RTN","MMRSIPC",133,0)
 S DIR("A")="Do you want to only print the summary report"
"RTN","MMRSIPC",134,0)
 S DIR("B")="NO"
"RTN","MMRSIPC",135,0)
 D ^DIR K DIR
"RTN","MMRSIPC",136,0)
 I $D(DIRUT) S EXTFLG=1 Q
"RTN","MMRSIPC",137,0)
 S PRTSUM=Y
"RTN","MMRSIPC",138,0)
 Q
"RTN","MMRSIPC",139,0)
ASKDVC ;Prompts user for device of output (allows queuing)
"RTN","MMRSIPC",140,0)
 N MMRSVAR,ZTSK
"RTN","MMRSIPC",141,0)
 W !! W:'PRTSUM !,"This report is designed for a 176 column format (landscape).",!
"RTN","MMRSIPC",142,0)
 S MMRSVAR("STRTDT")="",MMRSVAR("ENDDT")="",MMRSVAR("MMRSLOC(")=""
"RTN","MMRSIPC",143,0)
 S MMRSVAR("PRTSUM")="",MMRSVAR("BYADM")="",MMRSVAR("MMRSDIV")=""
"RTN","MMRSIPC",144,0)
 D EN^XUTMDEVQ("MAIN2^MMRSIPC","PRINT MRSA IPEC REPORT",.MMRSVAR,"QM",1)
"RTN","MMRSIPC",145,0)
 W:$D(ZTSK) !,"Report Queued to Print ("_ZTSK_").",!
"RTN","MMRSIPC",146,0)
 Q
"RTN","MMRSIPC",147,0)
GETPARAM ;(MDRO) ; Loads lab search/extract parameters from file 104.1
"RTN","MMRSIPC",148,0)
 N MRSAMDRO,TSTNM,TST,MDRO,TEST,IEN,TIEN,ITOP,TOP,ETOP,IBACT,BACT,EBACT
"RTN","MMRSIPC",149,0)
 N ETIOL,ETIOLOGY,ANTI,ANTIM,INC,MRSASTAP,ETIONAME,MMRSI,MMRSET,ORG
"RTN","MMRSIPC",150,0)
 S MRSAMDRO=$O(^MMRS(104.2,"B","MRSA",0))
"RTN","MMRSIPC",151,0)
 S INC=0
"RTN","MMRSIPC",152,0)
 S TSTNM="MRSA SURVL NARES DN"
"RTN","MMRSIPC",153,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL NARES DNA~zzz")  D
"RTN","MMRSIPC",154,0)
 .I TSTNM'["MRSA SURVL NARES DNA" Q
"RTN","MMRSIPC",155,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",156,0)
 ..S INC=INC+1
"RTN","MMRSIPC",157,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SCREEN",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",158,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",159,0)
 ..S INC=INC+1
"RTN","MMRSIPC",160,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SCREEN",TST_"_"_INC,0)="5^DETECTED"
"RTN","MMRSIPC",161,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="5^DETECTED"
"RTN","MMRSIPC",162,0)
 S TSTNM="MRSA SURVL NARES AGA"
"RTN","MMRSIPC",163,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL NARES AGAR~zzz")  D
"RTN","MMRSIPC",164,0)
 .I TSTNM'["MRSA SURVL NARES AGAR" Q
"RTN","MMRSIPC",165,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",166,0)
 ..S INC=INC+1
"RTN","MMRSIPC",167,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SCREEN",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",168,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",169,0)
 S TSTNM="MRSA SURVL OTHER DN"
"RTN","MMRSIPC",170,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL OTHER DNA~zzz")  D
"RTN","MMRSIPC",171,0)
 .I TSTNM'["MRSA SURVL OTHER DNA" Q
"RTN","MMRSIPC",172,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",173,0)
 ..S INC=INC+1
"RTN","MMRSIPC",174,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SURV",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",175,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",176,0)
 ..S INC=INC+1
"RTN","MMRSIPC",177,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SURV",TST_"_"_INC,0)="5^DETECTED"
"RTN","MMRSIPC",178,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="5^DETECTED"
"RTN","MMRSIPC",179,0)
 S TSTNM="MRSA SURVL OTHER AGA"
"RTN","MMRSIPC",180,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL OTHER AGAR~zzz")  D
"RTN","MMRSIPC",181,0)
 .I TSTNM'["MRSA SURVL OTHER AGAR" Q
"RTN","MMRSIPC",182,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",183,0)
 ..S INC=INC+1
"RTN","MMRSIPC",184,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SURV",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",185,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",186,0)
 S IEN="" F  S IEN=$O(^MMRS(104.1,"D",MMRSDIV,IEN)) Q:'IEN  D
"RTN","MMRSIPC",187,0)
 .S MDRO=$P($G(^MMRS(104.1,IEN,0)),U,1)
"RTN","MMRSIPC",188,0)
 .Q:'MDRO
"RTN","MMRSIPC",189,0)
 .S TIEN=0 F  S TIEN=$O(^MMRS(104.1,IEN,3,TIEN)) Q:'TIEN  D
"RTN","MMRSIPC",190,0)
 ..S TEST=$P($G(^MMRS(104.1,IEN,3,TIEN,0)),U,1)
"RTN","MMRSIPC",191,0)
 ..Q:'TEST
"RTN","MMRSIPC",192,0)
 ..S INC=INC+1
"RTN","MMRSIPC",193,0)
 ..S ^TMP($J,"MMRSIPC","T",MDRO,TEST_"_"_INC,0)=$P($G(^MMRS(104.1,IEN,3,TIEN,0)),U,2,3)
"RTN","MMRSIPC",194,0)
 .;S ITOP=0 F  S ITOP=$O(^MMRS(104.1,IEN,1,ITOP)) Q:'ITOP  D
"RTN","MMRSIPC",195,0)
 .;.S TOP=$G(^MMRS(104.1,IEN,1,ITOP,0))
"RTN","MMRSIPC",196,0)
 .;.I TOP S ^TMP($J,"MMRSIPC","TOP",MDRO,"INC_TOP",TOP)=""
"RTN","MMRSIPC",197,0)
 .;S ETOP=0 F  S ETOP=$O(^MMRS(104.1,IEN,2,ETOP)) Q:'ETOP  D
"RTN","MMRSIPC",198,0)
 .;.S TOP=$G(^MMRS(104.1,IEN,2,ETOP,0))
"RTN","MMRSIPC",199,0)
 .;.I TOP S ^TMP($J,"MMRSIPC","TOP",MDRO,"EXC_TOP",TOP)=""
"RTN","MMRSIPC",200,0)
 .S IBACT=0 F  S IBACT=$O(^MMRS(104.1,IEN,4,IBACT)) Q:'IBACT  D
"RTN","MMRSIPC",201,0)
 ..S BACT=$G(^MMRS(104.1,IEN,4,IBACT,0))
"RTN","MMRSIPC",202,0)
 ..I BACT'="" S ^TMP($J,"MMRSIPC","BACT",MDRO,"INC_REMARK",IBACT)=BACT
"RTN","MMRSIPC",203,0)
 .S EBACT=0 F  S EBACT=$O(^MMRS(104.1,IEN,5,EBACT)) Q:'EBACT  D
"RTN","MMRSIPC",204,0)
 ..S BACT=$G(^MMRS(104.1,IEN,5,EBACT,0))
"RTN","MMRSIPC",205,0)
 ..I BACT'="" S ^TMP($J,"MMRSIPC","BACT",MDRO,"EXC_REMARK",EBACT)=BACT
"RTN","MMRSIPC",206,0)
 .S ETIOL=0 F  S ETIOL=$O(^MMRS(104.1,IEN,6,ETIOL)) Q:'ETIOL  D
"RTN","MMRSIPC",207,0)
 ..S ETIOLOGY=$G(^MMRS(104.1,IEN,6,ETIOL,0))
"RTN","MMRSIPC",208,0)
 ..Q:'ETIOLOGY
"RTN","MMRSIPC",209,0)
 ..S ^TMP($J,"MMRSIPC","ETIOL",MDRO,+ETIOLOGY)=""
"RTN","MMRSIPC",210,0)
 ..S ANTI=0 F  S ANTI=$O(^MMRS(104.1,IEN,6,ETIOL,1,ANTI)) Q:'ANTI  D
"RTN","MMRSIPC",211,0)
 ...S ANTIM=$P($G(^MMRS(104.1,IEN,6,ETIOL,1,ANTI,0)),U)
"RTN","MMRSIPC",212,0)
 ...I ANTIM S ^TMP($J,"MMRSIPC","ETIOL",MDRO,ETIOLOGY,ANTI)=$G(^MMRS(104.1,IEN,6,ETIOL,1,ANTI,0))
"RTN","MMRSIPC",213,0)
 D FIND^DIC(61.2,,".01E;@","PM","STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT",,"B",,,"MMRSET")
"RTN","MMRSIPC",214,0)
 S MMRSI="" F  S MMRSI=$O(MMRSET("DILIST",MMRSI)) Q:MMRSI=""  I +MMRSI>0  D
"RTN","MMRSIPC",215,0)
 .S ETIONAME=$P($G(MMRSET("DILIST",MMRSI,0)),U,2)
"RTN","MMRSIPC",216,0)
 .S ORG=$P($G(MMRSET("DILIST",MMRSI,0)),U,1)
"RTN","MMRSIPC",217,0)
 .I ETIONAME'["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT" Q
"RTN","MMRSIPC",218,0)
 .K ^TMP($J,"MMRSIPC","ETIOL",MRSAMDRO,ORG)
"RTN","MMRSIPC",219,0)
 .S ^TMP($J,"MMRSIPC","ETIOL","MRSA_CULTURE",ORG)=""
"RTN","MMRSIPC",220,0)
 .S ^TMP($J,"MMRSIPC","ETIOL",MRSAMDRO,ORG)=""
"RTN","MMRSIPC",221,0)
 Q
"RTN","MMRSIPC",222,0)
PATDAYS ;Gets 'PATIENT DAYS OF CARE'.
"RTN","MMRSIPC",223,0)
 N TTLRSLT,SDT,EDT,LOC,RSLT,WLOC,WARD,PATDAYS,LOCNAME
"RTN","MMRSIPC",224,0)
 S TTLRSLT=0
"RTN","MMRSIPC",225,0)
 S SDT=$P(STRTDT,".")
"RTN","MMRSIPC",226,0)
 S EDT=$P(ENDDT,".")
"RTN","MMRSIPC",227,0)
 S LOC=0 F  S LOC=$O(MMRSLOC(LOC)) Q:'LOC  D
"RTN","MMRSIPC",228,0)
 .S RSLT=0
"RTN","MMRSIPC",229,0)
 .S WLOC=0 F  S WLOC=$O(^MMRS(104.3,LOC,1,WLOC)) Q:'WLOC  D
"RTN","MMRSIPC",230,0)
 ..S WARD=$P($G(^MMRS(104.3,LOC,1,WLOC,0)),U,1) I 'WARD Q
"RTN","MMRSIPC",231,0)
 ..S PATDAYS=$$GETPATDY(WARD,SDT,EDT)
"RTN","MMRSIPC",232,0)
 ..;bdoc are calculated by  patients on ward @ midnight
"RTN","MMRSIPC",233,0)
 ..;+ oneday admissions (patients admitted and discharged on same day).
"RTN","MMRSIPC",234,0)
 ..;in order not to double-count oneday obs patient admitted to acute care
"RTN","MMRSIPC",235,0)
 ..;on same day, adjus obs count.
"RTN","MMRSIPC",236,0)
 ..I $G(ODOBS(WARD)) S PATDAYS=PATDAYS-ODOBS(WARD)
"RTN","MMRSIPC",237,0)
 ..S RSLT=RSLT+PATDAYS,TTLRSLT=TTLRSLT+PATDAYS
"RTN","MMRSIPC",238,0)
 ..S LOCNAME=$P($G(^MMRS(104.3,LOC,0)),U)
"RTN","MMRSIPC",239,0)
 ..S $P(^TMP($J,"MMRSIPC","DSUM",LOCNAME),U,1)=RSLT
"RTN","MMRSIPC",240,0)
 S $P(^TMP($J,"MMRSIPC","DSUM"),U,1)=TTLRSLT
"RTN","MMRSIPC",241,0)
 Q
"RTN","MMRSIPC",242,0)
GETPATDY(WARD,SDT,EDT) ;Helper function for PATDAYS() - Gets Patient Days of care for specific ward
"RTN","MMRSIPC",243,0)
 N CENSUS,SCUMPD,ECUMPD
"RTN","MMRSIPC",244,0)
 I SDT>EDT Q 0
"RTN","MMRSIPC",245,0)
 I SDT<($$FY(EDT)_"1001") Q ($$GETPATDY(WARD,SDT,($$FY(EDT)_"0930"))+$$GETPATDY(WARD,($$FY(EDT)_"1001"),EDT))
"RTN","MMRSIPC",246,0)
 S CENSUS=$O(^DG(41.9,"B",WARD,0)) I 'CENSUS Q 0
"RTN","MMRSIPC",247,0)
 S SDT=$$FMADD^XLFDT(SDT,-1,0,0,0)
"RTN","MMRSIPC",248,0)
 S SCUMPD=$P($G(^DG(41.9,CENSUS,"C",SDT,0)),U,3)
"RTN","MMRSIPC",249,0)
 I EDT=$$DT^XLFDT S EDT=$$FMADD^XLFDT(EDT,-1,0,0,0)
"RTN","MMRSIPC",250,0)
 S ECUMPD=$P($G(^DG(41.9,CENSUS,"C",EDT,0)),U,3)
"RTN","MMRSIPC",251,0)
 I $E(SDT,4,7)="0930" S SCUMPD=0 ; IF LAST DAY OF FY
"RTN","MMRSIPC",252,0)
 Q ECUMPD-SCUMPD
"RTN","MMRSIPC",253,0)
FY(DATE) ;Helper function for GETPATDY - Gets fiscal year for the specified date
"RTN","MMRSIPC",254,0)
 I $E(DATE,4,7)>("1000"),$E(DATE,4,7)<("1232") Q $E(DATE,1,3)
"RTN","MMRSIPC",255,0)
 Q ($E(DATE,1,3)-1)
"VER")
8.0^22.2
"BLD",10588,6)
^7
**END**
**END**

