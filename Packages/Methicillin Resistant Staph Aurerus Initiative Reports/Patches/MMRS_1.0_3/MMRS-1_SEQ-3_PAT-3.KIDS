Released MMRS*1*3 SEQ #3
Extracted from mail message
**KIDS**:MMRS*1.0*3^

**INSTALL NAME**
MMRS*1.0*3
"BLD",9579,0)
MMRS*1.0*3^MRSA INITIATIVE REPORTS^0^3140123^y
"BLD",9579,1,0)
^^7^7^3140117^^^
"BLD",9579,1,1,0)
1) TICKET 604438
"BLD",9579,1,2,0)
 
"BLD",9579,1,3,0)
The patch modifies the MRSA Program Tools (MRSA-PT) Isolation Report 
"BLD",9579,1,4,0)
(MMRS REPORTS MENU) to list any patient with any of the mapped 
"BLD",9579,1,5,0)
etiologies/sensitivities.  Prior to installation, the report only lists
"BLD",9579,1,6,0)
patients for one (1) mapped etiology/sensitivity.  The patch modifies two 
"BLD",9579,1,7,0)
(2) routines in the MRSA-PT application.
"BLD",9579,4,0)
^9.64PA^^
"BLD",9579,6.3)
4
"BLD",9579,"ABPKG")
n
"BLD",9579,"KRN",0)
^9.67PA^779.2^20
"BLD",9579,"KRN",.4,0)
.4
"BLD",9579,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9579,"KRN",.401,0)
.401
"BLD",9579,"KRN",.402,0)
.402
"BLD",9579,"KRN",.403,0)
.403
"BLD",9579,"KRN",.5,0)
.5
"BLD",9579,"KRN",.84,0)
.84
"BLD",9579,"KRN",3.6,0)
3.6
"BLD",9579,"KRN",3.8,0)
3.8
"BLD",9579,"KRN",9.2,0)
9.2
"BLD",9579,"KRN",9.8,0)
9.8
"BLD",9579,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9579,"KRN",9.8,"NM",1,0)
MMRSIPC^^0^B96291150
"BLD",9579,"KRN",9.8,"NM",2,0)
MMRSIPC3^^0^B107510366
"BLD",9579,"KRN",9.8,"NM","B","MMRSIPC",1)

"BLD",9579,"KRN",9.8,"NM","B","MMRSIPC3",2)

"BLD",9579,"KRN",19,0)
19
"BLD",9579,"KRN",19.1,0)
19.1
"BLD",9579,"KRN",101,0)
101
"BLD",9579,"KRN",409.61,0)
409.61
"BLD",9579,"KRN",771,0)
771
"BLD",9579,"KRN",779.2,0)
779.2
"BLD",9579,"KRN",870,0)
870
"BLD",9579,"KRN",8989.51,0)
8989.51
"BLD",9579,"KRN",8989.52,0)
8989.52
"BLD",9579,"KRN",8994,0)
8994
"BLD",9579,"KRN","B",.4,.4)

"BLD",9579,"KRN","B",.401,.401)

"BLD",9579,"KRN","B",.402,.402)

"BLD",9579,"KRN","B",.403,.403)

"BLD",9579,"KRN","B",.5,.5)

"BLD",9579,"KRN","B",.84,.84)

"BLD",9579,"KRN","B",3.6,3.6)

"BLD",9579,"KRN","B",3.8,3.8)

"BLD",9579,"KRN","B",9.2,9.2)

"BLD",9579,"KRN","B",9.8,9.8)

"BLD",9579,"KRN","B",19,19)

"BLD",9579,"KRN","B",19.1,19.1)

"BLD",9579,"KRN","B",101,101)

"BLD",9579,"KRN","B",409.61,409.61)

"BLD",9579,"KRN","B",771,771)

"BLD",9579,"KRN","B",779.2,779.2)

"BLD",9579,"KRN","B",870,870)

"BLD",9579,"KRN","B",8989.51,8989.51)

"BLD",9579,"KRN","B",8989.52,8989.52)

"BLD",9579,"KRN","B",8994,8994)

"BLD",9579,"QUES",0)
^9.62^^
"BLD",9579,"REQB",0)
^9.611^1^1
"BLD",9579,"REQB",1,0)
MMRS*1.0*1^2
"BLD",9579,"REQB","B","MMRS*1.0*1",1)

"MBREQ")
0
"PKG",585,-1)
1^1
"PKG",585,0)
MRSA INITIATIVE REPORTS^MMRS^MRSA PREVENTION INITIATIVE
"PKG",585,20,0)
^9.402P^^
"PKG",585,22,0)
^9.49I^1^1
"PKG",585,22,1,0)
1.0^3091030^3101019^66481
"PKG",585,22,1,"PAH",1,0)
3^3140123
"PKG",585,22,1,"PAH",1,1,0)
^^7^7^3140123
"PKG",585,22,1,"PAH",1,1,1,0)
1) TICKET 604438
"PKG",585,22,1,"PAH",1,1,2,0)
 
"PKG",585,22,1,"PAH",1,1,3,0)
The patch modifies the MRSA Program Tools (MRSA-PT) Isolation Report 
"PKG",585,22,1,"PAH",1,1,4,0)
(MMRS REPORTS MENU) to list any patient with any of the mapped 
"PKG",585,22,1,"PAH",1,1,5,0)
etiologies/sensitivities.  Prior to installation, the report only lists
"PKG",585,22,1,"PAH",1,1,6,0)
patients for one (1) mapped etiology/sensitivity.  The patch modifies two 
"PKG",585,22,1,"PAH",1,1,7,0)
(2) routines in the MRSA-PT application.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MMRSIPC")
0^1^B96291150^B96473573
"RTN","MMRSIPC",1,0)
MMRSIPC ;MIA/LMT - Print MRSA IPEC Report ; 1/21/14 3:31pm
"RTN","MMRSIPC",2,0)
 ;;1.0;MRSA PROGRAM TOOLS;**3**;Mar 22, 2009;Build 4
"RTN","MMRSIPC",3,0)
 ;
"RTN","MMRSIPC",4,0)
 ;This is the main routine to print the MRSA IPEC Report. 
"RTN","MMRSIPC",5,0)
 ;This routine uses functions contained in MMRSIPC2, MMRSIPC3, and MMRSIPC4.
"RTN","MMRSIPC",6,0)
MAIN ;
"RTN","MMRSIPC",7,0)
 N NUMDIV,MMRSDIV,MMRSLOC,EXTFLG,STRTDT,ENDDT,PRTSUM,BYADM
"RTN","MMRSIPC",8,0)
 D CHECK
"RTN","MMRSIPC",9,0)
 D CHECK2
"RTN","MMRSIPC",10,0)
 I $D(EXTFLG) W ! H 2 Q
"RTN","MMRSIPC",11,0)
 W !
"RTN","MMRSIPC",12,0)
 S MMRSDIV=$$GETDIV Q:$D(EXTFLG)!(MMRSDIV="")
"RTN","MMRSIPC",13,0)
 D CHECK3
"RTN","MMRSIPC",14,0)
 I $D(EXTFLG) W ! H 2 Q
"RTN","MMRSIPC",15,0)
 D PROMPT Q:$D(EXTFLG)
"RTN","MMRSIPC",16,0)
 D ASKDVC Q:$D(EXTFLG)
"RTN","MMRSIPC",17,0)
 K MMRSSUM
"RTN","MMRSIPC",18,0)
 Q
"RTN","MMRSIPC",19,0)
CHECK ;Check if parameters are setup
"RTN","MMRSIPC",20,0)
 N NUMDIV,MMRSDIV
"RTN","MMRSIPC",21,0)
 S NUMDIV=0
"RTN","MMRSIPC",22,0)
 S MMRSDIV=0 F  S MMRSDIV=$O(^MMRS(104,MMRSDIV)) Q:'MMRSDIV  I $D(^MMRS(104,MMRSDIV,0)) S NUMDIV=NUMDIV+1
"RTN","MMRSIPC",23,0)
 I NUMDIV=0 D
"RTN","MMRSIPC",24,0)
 .W !!,"   >>> Make sure a division has been setup using option:"
"RTN","MMRSIPC",25,0)
 .W !,"          'MRSA Tools Parameter Setup (Main)'"
"RTN","MMRSIPC",26,0)
 .S EXTFLG=1
"RTN","MMRSIPC",27,0)
 Q
"RTN","MMRSIPC",28,0)
CHECK2 ;Check if lab tests and etiologies are setup
"RTN","MMRSIPC",29,0)
 N TSTSTP,MRSAETIO,MRSASTAP,ORG,ETIONAME,MMRSET,MMRSI
"RTN","MMRSIPC",30,0)
 S TSTSTP=0
"RTN","MMRSIPC",31,0)
 I $D(^LAB(60,"B","MRSA SURVL NARES DNA"))!($D(^LAB(60,"B","MRSA SURVL NARES AGAR"))) S TSTSTP=1
"RTN","MMRSIPC",32,0)
 I $O(^LAB(60,"B","MRSA SURVL NARES DNA"))["MRSA SURVL NARES DNA" S TSTSTP=1
"RTN","MMRSIPC",33,0)
 I $O(^LAB(60,"B","MRSA SURVL NARES AGAR"))["MRSA SURVL NARES AGAR" S TSTSTP=1
"RTN","MMRSIPC",34,0)
 I 'TSTSTP D
"RTN","MMRSIPC",35,0)
 .S EXTFLG=1
"RTN","MMRSIPC",36,0)
 .W !!,"   >>> Make sure the MRSA CH-subscripted tests have been setup according"
"RTN","MMRSIPC",37,0)
 .W !,"       to the National Guidelines. Laboratory needs to setup at least"
"RTN","MMRSIPC",38,0)
 .W !,"       one of these lab tests in the system before generating reports:"
"RTN","MMRSIPC",39,0)
 .W !,"          1. 'MRSA SURVL NARES DNA'"
"RTN","MMRSIPC",40,0)
 .W !,"          2. 'MRSA SURVL NARES AGAR'"
"RTN","MMRSIPC",41,0)
 S MRSAETIO=0
"RTN","MMRSIPC",42,0)
 ;S MRSASTAP="STAPHYLOCOCCUS AUREUS METH" F  S MRSASTAP=$O(^LAB(61.2,"B",MRSASTAP)) Q:MRSASTAP=""!(MRSASTAP]"STAPHYLOCOCCUS AUREUSZ")  D
"RTN","MMRSIPC",43,0)
 ;.S ORG=0 F  S ORG=$O(^LAB(61.2,"B",MRSASTAP,ORG)) Q:'ORG  D
"RTN","MMRSIPC",44,0)
 ;..S ETIONAME=$P($G(^LAB(61.2,ORG,0)),U,1)
"RTN","MMRSIPC",45,0)
 ;..I ETIONAME["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT (MRSA)" S MRSAETIO=ORG
"RTN","MMRSIPC",46,0)
 D FIND^DIC(61.2,,".01E;@","PM","STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT",,"B",,,"MMRSET")
"RTN","MMRSIPC",47,0)
 S MMRSI="" F  S MMRSI=$O(MMRSET("DILIST",MMRSI)) Q:MMRSI=""  I +MMRSI>0  D
"RTN","MMRSIPC",48,0)
 .S ETIONAME=$P($G(MMRSET("DILIST",MMRSI,0)),U,2)
"RTN","MMRSIPC",49,0)
 .S ORG=$P($G(MMRSET("DILIST",MMRSI,0)),U,1)
"RTN","MMRSIPC",50,0)
 .I ETIONAME["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT" S MRSAETIO=ORG
"RTN","MMRSIPC",51,0)
 I 'MRSAETIO D
"RTN","MMRSIPC",52,0)
 .S EXTFLG=1
"RTN","MMRSIPC",53,0)
 .W !!,"   >>> Make sure the Etiology has been setup according "
"RTN","MMRSIPC",54,0)
 .W !,"       to the National Guidelines. The following etiology "
"RTN","MMRSIPC",55,0)
 .W !,"       must be added to the Etiology Field file (#61.2):"
"RTN","MMRSIPC",56,0)
 .W !,"          'STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT (MRSA)' "
"RTN","MMRSIPC",57,0)
 Q
"RTN","MMRSIPC",58,0)
CHECK3 ;Check if Ward Mappings have been setup for this division
"RTN","MMRSIPC",59,0)
 N NUMLOC,MMRSLOC
"RTN","MMRSIPC",60,0)
 S NUMLOC=0
"RTN","MMRSIPC",61,0)
 S MMRSLOC=0 F  S MMRSLOC=$O(^MMRS(104.3,MMRSLOC)) Q:'MMRSLOC  I $P($G(^MMRS(104.3,MMRSLOC,0)),U,2)=MMRSDIV S NUMLOC=NUMLOC+1
"RTN","MMRSIPC",62,0)
 I NUMLOC=0 W !!,"   >>> Make sure the Ward Mappings for each Geographical Unit has been setup.",!! S EXTFLG=1
"RTN","MMRSIPC",63,0)
 Q
"RTN","MMRSIPC",64,0)
MAIN2 ; Entry for queuing
"RTN","MMRSIPC",65,0)
 D CLEAN ;Kill Temp Global
"RTN","MMRSIPC",66,0)
 D GETPARAM ; Load parameters in temp global
"RTN","MMRSIPC",67,0)
 D GETMOVE^MMRSIPC2 ;Get movements and store in temp global
"RTN","MMRSIPC",68,0)
 D GETLABS^MMRSIPC3 ;Get swabbing rates and MRSA history and store in temp global
"RTN","MMRSIPC",69,0)
 I 'BYADM D PATDAYS ;Get patient days of care
"RTN","MMRSIPC",70,0)
 D PRINT^MMRSIPC4 ;Print report
"RTN","MMRSIPC",71,0)
 D CLEAN ;Kill Temp Global
"RTN","MMRSIPC",72,0)
 Q
"RTN","MMRSIPC",73,0)
CLEAN ;
"RTN","MMRSIPC",74,0)
 K ^TMP($J,"MMRSIPC")
"RTN","MMRSIPC",75,0)
 Q
"RTN","MMRSIPC",76,0)
GETDIV() ;Prompt user to select Division
"RTN","MMRSIPC",77,0)
 N MMRSDIV,COUNT,DIV,DIC,Y,DLAYGO,X,DTOUT,DUOUT
"RTN","MMRSIPC",78,0)
 S MMRSDIV=""
"RTN","MMRSIPC",79,0)
 S COUNT=0,DIV=0 F  S DIV=$O(^MMRS(104,DIV)) Q:'DIV  S COUNT=COUNT+1
"RTN","MMRSIPC",80,0)
 I COUNT=1 S MMRSDIV=$O(^MMRS(104,0)) Q MMRSDIV
"RTN","MMRSIPC",81,0)
 S DIC="^DG(40.8,"
"RTN","MMRSIPC",82,0)
 S DIC(0)="AEMQ"
"RTN","MMRSIPC",83,0)
 S DIC("A")="Select the Division: "
"RTN","MMRSIPC",84,0)
 S DIC("S")="I $D(^MMRS(104,""B"",Y))"
"RTN","MMRSIPC",85,0)
 D ^DIC K DIC
"RTN","MMRSIPC",86,0)
 I $D(DTOUT)!($D(DUOUT))!(Y=-1) S EXTFLG=1 Q ""
"RTN","MMRSIPC",87,0)
 S MMRSDIV=+Y
"RTN","MMRSIPC",88,0)
 S MMRSDIV=$O(^MMRS(104,"B",MMRSDIV,0))
"RTN","MMRSIPC",89,0)
 Q MMRSDIV
"RTN","MMRSIPC",90,0)
PROMPT ;Prompts user for start date, end date, locations, and if user wants to only print the Summary Report.
"RTN","MMRSIPC",91,0)
 ;Prompt if should run report by Admission or Discharge
"RTN","MMRSIPC",92,0)
 N DIR,DIRUT,PRMPTTXT,Y
"RTN","MMRSIPC",93,0)
 S DIR(0)="S^A:Admission Report;D:Discharge/Transmission Report"
"RTN","MMRSIPC",94,0)
 S DIR("A")="Run (A)dmission Or (D)ischarge/Transmission Report"
"RTN","MMRSIPC",95,0)
 D ^DIR K DIR
"RTN","MMRSIPC",96,0)
 I $D(DIRUT) S EXTFLG=1 Q 
"RTN","MMRSIPC",97,0)
 I Y="A" S BYADM=1,PRMPTTXT="ward admission"
"RTN","MMRSIPC",98,0)
 I Y="D" S BYADM=0,PRMPTTXT="ward discharge"
"RTN","MMRSIPC",99,0)
DATE ;Prompts user for date range
"RTN","MMRSIPC",100,0)
 N %DT,X
"RTN","MMRSIPC",101,0)
 K Y
"RTN","MMRSIPC",102,0)
 W ! S %DT="AEPX",%DT("A")="Begin with "_PRMPTTXT_" date: " D ^%DT
"RTN","MMRSIPC",103,0)
 I Y<0 S EXTFLG=1 Q
"RTN","MMRSIPC",104,0)
 S STRTDT=Y
"RTN","MMRSIPC",105,0)
 S %DT("A")="End with "_PRMPTTXT_" date: " D ^%DT
"RTN","MMRSIPC",106,0)
 I Y<0 S EXTFLG=1 Q
"RTN","MMRSIPC",107,0)
 S ENDDT=Y
"RTN","MMRSIPC",108,0)
 I '$P(ENDDT,".",2) S ENDDT=Y+.24
"RTN","MMRSIPC",109,0)
 I ENDDT<STRTDT W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","MMRSIPC",110,0)
LOC ;Prompts user for locations
"RTN","MMRSIPC",111,0)
 W !
"RTN","MMRSIPC",112,0)
 S DIR(0)="YA",DIR("A")="Do you want to select all locations? ",DIR("B")="NO"
"RTN","MMRSIPC",113,0)
 D ^DIR K DIR
"RTN","MMRSIPC",114,0)
 I $D(DIRUT) S EXTFLG=1 Q
"RTN","MMRSIPC",115,0)
 I Y=1 D  G SUMRPT
"RTN","MMRSIPC",116,0)
 .S Y=0 F  S Y=$O(^MMRS(104.3,Y)) Q:'Y  I $P($G(^MMRS(104.3,Y,0)),U,2)=MMRSDIV S MMRSLOC(Y)=""
"RTN","MMRSIPC",117,0)
 ;PROMPT FOR WARDS
"RTN","MMRSIPC",118,0)
 N DIC,DLAYGO,DTOUT,DUOUT
"RTN","MMRSIPC",119,0)
 W !
"RTN","MMRSIPC",120,0)
 S DIC("A")="Select Geographical Location: "
"RTN","MMRSIPC",121,0)
 S DIC("S")="I $P($G(^MMRS(104.3,Y,0)),U,2)="_MMRSDIV
"RTN","MMRSIPC",122,0)
 S DIC="^MMRS(104.3,",DIC(0)="QEAM" D ^DIC
"RTN","MMRSIPC",123,0)
 I (Y=-1)!($D(DTOUT))!($D(DUOUT)) S EXTFLG=1 Q
"RTN","MMRSIPC",124,0)
 S MMRSLOC(+Y)=""
"RTN","MMRSIPC",125,0)
 S DIC("A")="Select another Geographical Location: " F  D ^DIC Q:Y=-1  S MMRSLOC(+Y)=""
"RTN","MMRSIPC",126,0)
 K DIC
"RTN","MMRSIPC",127,0)
 I ($D(DTOUT))!($D(DUOUT)) S EXTFLG=1 Q
"RTN","MMRSIPC",128,0)
SUMRPT ;Prompt user if should only run the summary report.
"RTN","MMRSIPC",129,0)
 I $G(MMRSSUM) S PRTSUM=1 Q  ; IF OPTION IS ONLY FOR SUMMARY REPORT...
"RTN","MMRSIPC",130,0)
 W !
"RTN","MMRSIPC",131,0)
 S DIR(0)="Y"
"RTN","MMRSIPC",132,0)
 S DIR("A")="Do you want to only print the summary report"
"RTN","MMRSIPC",133,0)
 S DIR("B")="NO"
"RTN","MMRSIPC",134,0)
 D ^DIR K DIR
"RTN","MMRSIPC",135,0)
 I $D(DIRUT) S EXTFLG=1 Q
"RTN","MMRSIPC",136,0)
 S PRTSUM=Y
"RTN","MMRSIPC",137,0)
 Q
"RTN","MMRSIPC",138,0)
ASKDVC ;Prompts user for device of output (allows queuing)
"RTN","MMRSIPC",139,0)
 N MMRSVAR,ZTSK
"RTN","MMRSIPC",140,0)
 W !! W:'PRTSUM !,"This report is designed for a 176 column format (landscape).",!
"RTN","MMRSIPC",141,0)
 S MMRSVAR("STRTDT")="",MMRSVAR("ENDDT")="",MMRSVAR("MMRSLOC(")=""
"RTN","MMRSIPC",142,0)
 S MMRSVAR("PRTSUM")="",MMRSVAR("BYADM")="",MMRSVAR("MMRSDIV")=""
"RTN","MMRSIPC",143,0)
 D EN^XUTMDEVQ("MAIN2^MMRSIPC","PRINT MRSA IPEC REPORT",.MMRSVAR,"QM",1)
"RTN","MMRSIPC",144,0)
 W:$D(ZTSK) !,"Report Queued to Print ("_ZTSK_").",!
"RTN","MMRSIPC",145,0)
 Q
"RTN","MMRSIPC",146,0)
GETPARAM ;(MDRO) ; Loads lab search/extract parameters from file 104.1
"RTN","MMRSIPC",147,0)
 N MRSAMDRO,TSTNM,TST,MDRO,TEST,IEN,TIEN,ITOP,TOP,ETOP,IBACT,BACT,EBACT
"RTN","MMRSIPC",148,0)
 N ETIOL,ETIOLOGY,ANTI,ANTIM,INC,MRSASTAP,ETIONAME,MMRSI,MMRSET,ORG
"RTN","MMRSIPC",149,0)
 S MRSAMDRO=$O(^MMRS(104.2,"B","MRSA",0))
"RTN","MMRSIPC",150,0)
 S INC=0
"RTN","MMRSIPC",151,0)
 S TSTNM="MRSA SURVL NARES DN"
"RTN","MMRSIPC",152,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL NARES DNA~zzz")  D
"RTN","MMRSIPC",153,0)
 .I TSTNM'["MRSA SURVL NARES DNA" Q
"RTN","MMRSIPC",154,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",155,0)
 ..S INC=INC+1
"RTN","MMRSIPC",156,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SCREEN",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",157,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",158,0)
 S TSTNM="MRSA SURVL NARES AGA"
"RTN","MMRSIPC",159,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL NARES AGAR~zzz")  D
"RTN","MMRSIPC",160,0)
 .I TSTNM'["MRSA SURVL NARES AGAR" Q
"RTN","MMRSIPC",161,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",162,0)
 ..S INC=INC+1
"RTN","MMRSIPC",163,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SCREEN",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",164,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",165,0)
 S TSTNM="MRSA SURVL OTHER DN"
"RTN","MMRSIPC",166,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL OTHER DNA~zzz")  D
"RTN","MMRSIPC",167,0)
 .I TSTNM'["MRSA SURVL OTHER DNA" Q
"RTN","MMRSIPC",168,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",169,0)
 ..S INC=INC+1
"RTN","MMRSIPC",170,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SURV",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",171,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",172,0)
 S TSTNM="MRSA SURVL OTHER AGA"
"RTN","MMRSIPC",173,0)
 F  S TSTNM=$O(^LAB(60,"B",TSTNM)) Q:TSTNM=""!(TSTNM]"MRSA SURVL OTHER AGAR~zzz")  D
"RTN","MMRSIPC",174,0)
 .I TSTNM'["MRSA SURVL OTHER AGAR" Q
"RTN","MMRSIPC",175,0)
 .S TST=0 F  S TST=$O(^LAB(60,"B",TSTNM,TST)) Q:'TST  D
"RTN","MMRSIPC",176,0)
 ..S INC=INC+1
"RTN","MMRSIPC",177,0)
 ..S ^TMP($J,"MMRSIPC","T","MRSA_SURV",TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",178,0)
 ..S ^TMP($J,"MMRSIPC","T",MRSAMDRO,TST_"_"_INC,0)="2^POS"
"RTN","MMRSIPC",179,0)
 S IEN="" F  S IEN=$O(^MMRS(104.1,"D",MMRSDIV,IEN)) Q:'IEN  D
"RTN","MMRSIPC",180,0)
 .S MDRO=$P($G(^MMRS(104.1,IEN,0)),U,1)
"RTN","MMRSIPC",181,0)
 .Q:'MDRO
"RTN","MMRSIPC",182,0)
 .S TIEN=0 F  S TIEN=$O(^MMRS(104.1,IEN,3,TIEN)) Q:'TIEN  D
"RTN","MMRSIPC",183,0)
 ..S TEST=$P($G(^MMRS(104.1,IEN,3,TIEN,0)),U,1)
"RTN","MMRSIPC",184,0)
 ..Q:'TEST
"RTN","MMRSIPC",185,0)
 ..S INC=INC+1
"RTN","MMRSIPC",186,0)
 ..S ^TMP($J,"MMRSIPC","T",MDRO,TEST_"_"_INC,0)=$P($G(^MMRS(104.1,IEN,3,TIEN,0)),U,2,3)
"RTN","MMRSIPC",187,0)
 .;S ITOP=0 F  S ITOP=$O(^MMRS(104.1,IEN,1,ITOP)) Q:'ITOP  D
"RTN","MMRSIPC",188,0)
 .;.S TOP=$G(^MMRS(104.1,IEN,1,ITOP,0))
"RTN","MMRSIPC",189,0)
 .;.I TOP S ^TMP($J,"MMRSIPC","TOP",MDRO,"INC_TOP",TOP)=""
"RTN","MMRSIPC",190,0)
 .;S ETOP=0 F  S ETOP=$O(^MMRS(104.1,IEN,2,ETOP)) Q:'ETOP  D
"RTN","MMRSIPC",191,0)
 .;.S TOP=$G(^MMRS(104.1,IEN,2,ETOP,0))
"RTN","MMRSIPC",192,0)
 .;.I TOP S ^TMP($J,"MMRSIPC","TOP",MDRO,"EXC_TOP",TOP)=""
"RTN","MMRSIPC",193,0)
 .S IBACT=0 F  S IBACT=$O(^MMRS(104.1,IEN,4,IBACT)) Q:'IBACT  D
"RTN","MMRSIPC",194,0)
 ..S BACT=$G(^MMRS(104.1,IEN,4,IBACT,0))
"RTN","MMRSIPC",195,0)
 ..I BACT'="" S ^TMP($J,"MMRSIPC","BACT",MDRO,"INC_REMARK",IBACT)=BACT
"RTN","MMRSIPC",196,0)
 .S EBACT=0 F  S EBACT=$O(^MMRS(104.1,IEN,5,EBACT)) Q:'EBACT  D
"RTN","MMRSIPC",197,0)
 ..S BACT=$G(^MMRS(104.1,IEN,5,EBACT,0))
"RTN","MMRSIPC",198,0)
 ..I BACT'="" S ^TMP($J,"MMRSIPC","BACT",MDRO,"EXC_REMARK",EBACT)=BACT
"RTN","MMRSIPC",199,0)
 .S ETIOL=0 F  S ETIOL=$O(^MMRS(104.1,IEN,6,ETIOL)) Q:'ETIOL  D
"RTN","MMRSIPC",200,0)
 ..S ETIOLOGY=$G(^MMRS(104.1,IEN,6,ETIOL,0))
"RTN","MMRSIPC",201,0)
 ..Q:'ETIOLOGY
"RTN","MMRSIPC",202,0)
 ..S ^TMP($J,"MMRSIPC","ETIOL",MDRO,+ETIOLOGY)=""
"RTN","MMRSIPC",203,0)
 ..S ANTI=0 F  S ANTI=$O(^MMRS(104.1,IEN,6,ETIOL,1,ANTI)) Q:'ANTI  D
"RTN","MMRSIPC",204,0)
 ...S ANTIM=$P($G(^MMRS(104.1,IEN,6,ETIOL,1,ANTI,0)),U)
"RTN","MMRSIPC",205,0)
 ...I ANTIM S ^TMP($J,"MMRSIPC","ETIOL",MDRO,ETIOLOGY,ANTI)=$G(^MMRS(104.1,IEN,6,ETIOL,1,ANTI,0))
"RTN","MMRSIPC",206,0)
 D FIND^DIC(61.2,,".01E;@","PM","STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT",,"B",,,"MMRSET")
"RTN","MMRSIPC",207,0)
 S MMRSI="" F  S MMRSI=$O(MMRSET("DILIST",MMRSI)) Q:MMRSI=""  I +MMRSI>0  D
"RTN","MMRSIPC",208,0)
 .S ETIONAME=$P($G(MMRSET("DILIST",MMRSI,0)),U,2)
"RTN","MMRSIPC",209,0)
 .S ORG=$P($G(MMRSET("DILIST",MMRSI,0)),U,1)
"RTN","MMRSIPC",210,0)
 .I ETIONAME'["STAPHYLOCOCCUS AUREUS METHICILLIN RESISTANT" Q
"RTN","MMRSIPC",211,0)
 .K ^TMP($J,"MMRSIPC","ETIOL",MRSAMDRO,ORG)
"RTN","MMRSIPC",212,0)
 .S ^TMP($J,"MMRSIPC","ETIOL","MRSA_CULTURE",ORG)=""
"RTN","MMRSIPC",213,0)
 .S ^TMP($J,"MMRSIPC","ETIOL",MRSAMDRO,ORG)=""
"RTN","MMRSIPC",214,0)
 Q
"RTN","MMRSIPC",215,0)
PATDAYS ;Gets 'PATIENT DAYS OF CARE'.
"RTN","MMRSIPC",216,0)
 N TTLRSLT,SDT,EDT,LOC,RSLT,WLOC,WARD,PATDAYS,LOCNAME
"RTN","MMRSIPC",217,0)
 S TTLRSLT=0
"RTN","MMRSIPC",218,0)
 S SDT=$P(STRTDT,".")
"RTN","MMRSIPC",219,0)
 S EDT=$P(ENDDT,".")
"RTN","MMRSIPC",220,0)
 S LOC=0 F  S LOC=$O(MMRSLOC(LOC)) Q:'LOC  D
"RTN","MMRSIPC",221,0)
 .S RSLT=0
"RTN","MMRSIPC",222,0)
 .S WLOC=0 F  S WLOC=$O(^MMRS(104.3,LOC,1,WLOC)) Q:'WLOC  D
"RTN","MMRSIPC",223,0)
 ..S WARD=$P($G(^MMRS(104.3,LOC,1,WLOC,0)),U,1) I 'WARD Q
"RTN","MMRSIPC",224,0)
 ..S PATDAYS=$$GETPATDY(WARD,SDT,EDT)
"RTN","MMRSIPC",225,0)
 ..S RSLT=RSLT+PATDAYS,TTLRSLT=TTLRSLT+PATDAYS
"RTN","MMRSIPC",226,0)
 ..S LOCNAME=$P($G(^MMRS(104.3,LOC,0)),U)
"RTN","MMRSIPC",227,0)
 ..S $P(^TMP($J,"MMRSIPC","DSUM",LOCNAME),U,1)=RSLT
"RTN","MMRSIPC",228,0)
 S $P(^TMP($J,"MMRSIPC","DSUM"),U,1)=TTLRSLT
"RTN","MMRSIPC",229,0)
 Q
"RTN","MMRSIPC",230,0)
GETPATDY(WARD,SDT,EDT) ;Helper function for PATDAYS() - Gets Patient Days of care for specific ward
"RTN","MMRSIPC",231,0)
 N CENSUS,SCUMPD,ECUMPD
"RTN","MMRSIPC",232,0)
 I SDT>EDT Q 0
"RTN","MMRSIPC",233,0)
 I SDT<($$FY(EDT)_"1001") Q ($$GETPATDY(WARD,SDT,($$FY(EDT)_"0930"))+$$GETPATDY(WARD,($$FY(EDT)_"1001"),EDT))
"RTN","MMRSIPC",234,0)
 S CENSUS=$O(^DG(41.9,"B",WARD,0)) I 'CENSUS Q 0
"RTN","MMRSIPC",235,0)
 S SDT=$$FMADD^XLFDT(SDT,-1,0,0,0)
"RTN","MMRSIPC",236,0)
 S SCUMPD=$P($G(^DG(41.9,CENSUS,"C",SDT,0)),U,3)
"RTN","MMRSIPC",237,0)
 I EDT=$$DT^XLFDT S EDT=$$FMADD^XLFDT(EDT,-1,0,0,0)
"RTN","MMRSIPC",238,0)
 S ECUMPD=$P($G(^DG(41.9,CENSUS,"C",EDT,0)),U,3)
"RTN","MMRSIPC",239,0)
 I $E(SDT,4,7)="0930" S SCUMPD=0 ; IF LAST DAY OF FY
"RTN","MMRSIPC",240,0)
 Q ECUMPD-SCUMPD
"RTN","MMRSIPC",241,0)
FY(DATE) ;Helper function for GETPATDY - Gets fiscal year for the specified date
"RTN","MMRSIPC",242,0)
 I $E(DATE,4,7)>("1000"),$E(DATE,4,7)<("1232") Q $E(DATE,1,3)
"RTN","MMRSIPC",243,0)
 Q ($E(DATE,1,3)-1)
"RTN","MMRSIPC3")
0^2^B107510366^B106251374
"RTN","MMRSIPC3",1,0)
MMRSIPC3 ;MIA/LMT - Print MRSA Report Cont. (Contains functions to collect patient labs and swabbing rate) ; 1/23/14 11:07am
"RTN","MMRSIPC3",2,0)
 ;;1.0;MRSA PROGRAM TOOLS;**1,3**;Mar 22, 2009;Build 4
"RTN","MMRSIPC3",3,0)
 ;
"RTN","MMRSIPC3",4,0)
GETLABS ;Gets all lab data for the report.
"RTN","MMRSIPC3",5,0)
 N MRSAMDRO,LOC,INDT,DFN,OUTDT,NARES24,NARES48,SURV48,CULT48,MRSA365,CULT365,KNOWMRSA,KNOWCULT,NARES24A,NARES48ASURV48A,NARES48A
"RTN","MMRSIPC3",6,0)
 N MRSAFR,MRSATO,MRSA365A,CULT365A,SURV48A,NARES24D,NARES48D,SURV48D,MRSACPRD,TRANS
"RTN","MMRSIPC3",7,0)
 S MRSAMDRO=$O(^MMRS(104.2,"B","MRSA",0))
"RTN","MMRSIPC3",8,0)
 S ^TMP($J,"MMRSIPC","DSUM")="0^0^0^0^0^0^0^0^0"
"RTN","MMRSIPC3",9,0)
 S LOC="" F  S LOC=$O(^TMP($J,"MMRSIPC","D",LOC)) Q:LOC=""  D
"RTN","MMRSIPC3",10,0)
 .S ^TMP($J,"MMRSIPC","DSUM",LOC)="0^0^0^0^0^0^0^0^0"
"RTN","MMRSIPC3",11,0)
 .S INDT=0 F  S INDT=$O(^TMP($J,"MMRSIPC","D",LOC,INDT)) Q:'INDT  D
"RTN","MMRSIPC3",12,0)
 ..S DFN=0 F  S DFN=$O(^TMP($J,"MMRSIPC","D",LOC,INDT,DFN)) Q:'DFN  D
"RTN","MMRSIPC3",13,0)
 ...S OUTDT=0 F  S OUTDT=$O(^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT)) Q:OUTDT=""  D
"RTN","MMRSIPC3",14,0)
 ....I BYADM D
"RTN","MMRSIPC3",15,0)
 .....S NARES24=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(INDT,0,-24),$$FMADD^XLFDT(INDT,0,24),"CD"),U,1)
"RTN","MMRSIPC3",16,0)
 .....S NARES48=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",17,0)
 .....S SURV48=$P($$GETLAB(DFN,"MRSA_SURV",$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",18,0)
 .....I NARES48'["POS",SURV48["POS" S NARES48=SURV48
"RTN","MMRSIPC3",19,0)
 .....S CULT48=$P($$GETLAB(DFN,"MRSA_CULTURE",$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD"),U,2) ;$$GETMCULT(DFN,$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD")
"RTN","MMRSIPC3",20,0)
 .....S MRSA365=$P($$GETLAB(DFN,MRSAMDRO,$$FMADD^XLFDT(INDT,-365),INDT,"CD"),U,2)
"RTN","MMRSIPC3",21,0)
 .....I $P($G(^MMRS(104,MMRSDIV,0)),U,4)=0 D
"RTN","MMRSIPC3",22,0)
 ......S KNOWMRSA=$P($$GETLAB(DFN,MRSAMDRO,$$FMADD^XLFDT(INDT,-365),INDT,"RAD"),U,2)
"RTN","MMRSIPC3",23,0)
 .....S ^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT)=^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT)_U_NARES24_U_NARES48_U_CULT48_U_MRSA365
"RTN","MMRSIPC3",24,0)
 ....I 'BYADM D
"RTN","MMRSIPC3",25,0)
 .....S NARES24A=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(INDT,0,-24),$$FMADD^XLFDT(INDT,0,24),"CD"),U,1)
"RTN","MMRSIPC3",26,0)
 .....S NARES48A=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",27,0)
 .....S SURV48A=$P($$GETLAB(DFN,"MRSA_SURV",$$FMADD^XLFDT(INDT,0,-48),$$FMADD^XLFDT(INDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",28,0)
 .....I NARES48A'["POS",SURV48A["POS" S NARES48A=SURV48A
"RTN","MMRSIPC3",29,0)
 .....S MRSAFR=(INDT-10000) I STRTDT>INDT S MRSAFR=(STRTDT-10000) ;(ADM - 1 year) or  (START DT - 1 year) - whichever is later
"RTN","MMRSIPC3",30,0)
 .....S MRSATO=$$FMADD^XLFDT(INDT,0,48,0,0) I STRTDT>MRSATO S MRSATO=STRTDT ;(ADM + 48 HRS) OR (START DT) - WHICHEVER IS GREATER
"RTN","MMRSIPC3",31,0)
 .....S MRSA365A=$P($$GETLAB(DFN,MRSAMDRO,MRSAFR,MRSATO,"CD"),U,2)
"RTN","MMRSIPC3",32,0)
 .....S (NARES24D,NARES48D,SURV48D)=""
"RTN","MMRSIPC3",33,0)
 .....I OUTDT D
"RTN","MMRSIPC3",34,0)
 ......S NARES24D=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(OUTDT,0,-24),$$FMADD^XLFDT(OUTDT,0,24),"CD"),U,1)
"RTN","MMRSIPC3",35,0)
 ......S NARES48D=$P($$GETLAB(DFN,"MRSA_SCREEN",$$FMADD^XLFDT(OUTDT,0,-48),$$FMADD^XLFDT(OUTDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",36,0)
 ......S SURV48D=$P($$GETLAB(DFN,"MRSA_SURV",$$FMADD^XLFDT(OUTDT,0,-48),$$FMADD^XLFDT(OUTDT,0,48),"CD"),U,2)
"RTN","MMRSIPC3",37,0)
 ......I NARES48D'["POS",SURV48D["POS" S NARES48D=SURV48D
"RTN","MMRSIPC3",38,0)
 .....S MRSAFR=$$FMADD^XLFDT(INDT,0,48,0,0) I STRTDT>MRSAFR S MRSAFR=STRTDT ;(ADM + 48 HRS) OR (START DT) - WHICHEVER IS LATER
"RTN","MMRSIPC3",39,0)
 .....S MRSATO=ENDDT I +OUTDT S MRSATO=$$FMADD^XLFDT(OUTDT,0,48,0,0) ;(DIS + 48 HRS) OR (END DT) - WHICHEVER IS EARLIER
"RTN","MMRSIPC3",40,0)
 .....S MRSACPRD=$P($$GETLAB(DFN,MRSAMDRO,MRSAFR,MRSATO,"CD"),U,2)
"RTN","MMRSIPC3",41,0)
 .....I $P($G(^MMRS(104,MMRSDIV,0)),U,5)=0,OUTDT D
"RTN","MMRSIPC3",42,0)
 ......S KNOWMRSA=$P($$GETLAB(DFN,MRSAMDRO,$$FMADD^XLFDT(OUTDT,-365),OUTDT,"RAD"),U,2)
"RTN","MMRSIPC3",43,0)
 .....S TRANS=""
"RTN","MMRSIPC3",44,0)
 .....I NARES48A'["POS",MRSA365A'["POS",(($G(NARES48D)["POS")!(MRSACPRD["POS")) S TRANS="T"
"RTN","MMRSIPC3",45,0)
 .....S ^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT)=^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT)_U_NARES24A_U_NARES48A_U_MRSA365A_U_$G(NARES24D)_U_$G(NARES48D)_U_MRSACPRD_U_TRANS
"RTN","MMRSIPC3",46,0)
 ....D PREV ;Calculate prevalence measures
"RTN","MMRSIPC3",47,0)
 Q
"RTN","MMRSIPC3",48,0)
PREV ;Calculate prevalence measures (summary report)
"RTN","MMRSIPC3",49,0)
 N LOCSUM,SUM,DATA,IND
"RTN","MMRSIPC3",50,0)
 S LOCSUM=$G(^TMP($J,"MMRSIPC","DSUM",LOC))
"RTN","MMRSIPC3",51,0)
 S SUM=$G(^TMP($J,"MMRSIPC","DSUM"))
"RTN","MMRSIPC3",52,0)
 S DATA=$G(^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT))
"RTN","MMRSIPC3",53,0)
 I BYADM D
"RTN","MMRSIPC3",54,0)
 .I $P(DATA,U,5)=1 D
"RTN","MMRSIPC3",55,0)
 ..S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,1)=$P(LOCSUM,U,1)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,1)=$P(SUM,U,1)+1
"RTN","MMRSIPC3",56,0)
 ..I NARES24["Y" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,2)=$P(LOCSUM,U,2)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,2)=$P(SUM,U,2)+1
"RTN","MMRSIPC3",57,0)
 ..I (NARES48["POS"!(MRSA365["POS")),CULT48'["POS" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,3)=$P(LOCSUM,U,3)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,3)=$P(SUM,U,3)+1
"RTN","MMRSIPC3",58,0)
 ..I CULT48["POS" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,4)=$P(LOCSUM,U,4)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,4)=$P(SUM,U,4)+1
"RTN","MMRSIPC3",59,0)
 .S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,5)=$P(LOCSUM,U,5)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,5)=$P(SUM,U,5)+1
"RTN","MMRSIPC3",60,0)
 .S IND=0
"RTN","MMRSIPC3",61,0)
 .I $P($G(^MMRS(104,MMRSDIV,0)),U,2)=1,$P($G(^MMRS(104,MMRSDIV,0)),U,4)=1 S IND=1
"RTN","MMRSIPC3",62,0)
 .I $P($G(^MMRS(104,MMRSDIV,0)),U,2)=1,$P($G(^MMRS(104,MMRSDIV,0)),U,4)=0,($P(DATA,U,5)=1!(KNOWMRSA'["POS")) S IND=1
"RTN","MMRSIPC3",63,0)
 .I $P($G(^MMRS(104,MMRSDIV,0)),U,2)=0,$P(DATA,U,5)=1 S IND=1
"RTN","MMRSIPC3",64,0)
 .S $P(^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT),U,13)=IND ;MIA/LMT - Add if patient was indicated ;3/16/10
"RTN","MMRSIPC3",65,0)
 .I IND D
"RTN","MMRSIPC3",66,0)
 ..S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,6)=$P(LOCSUM,U,6)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,6)=$P(SUM,U,6)+1
"RTN","MMRSIPC3",67,0)
 ..I NARES24["Y" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,7)=$P(LOCSUM,U,7)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,7)=$P(SUM,U,7)+1
"RTN","MMRSIPC3",68,0)
 .I (NARES48["POS"!(MRSA365["POS")),CULT48'["POS" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,8)=$P(LOCSUM,U,8)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,8)=$P(SUM,U,8)+1
"RTN","MMRSIPC3",69,0)
 .I CULT48["POS" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,9)=$P(LOCSUM,U,9)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,9)=$P(SUM,U,9)+1
"RTN","MMRSIPC3",70,0)
 I 'BYADM D
"RTN","MMRSIPC3",71,0)
 .I $P(DATA,U,8)=3!($P(DATA,U,8)=2) D
"RTN","MMRSIPC3",72,0)
 ..S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,2)=$P(LOCSUM,U,2)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,2)=$P(SUM,U,2)+1
"RTN","MMRSIPC3",73,0)
 ..S IND=0
"RTN","MMRSIPC3",74,0)
 ..I $P($G(^MMRS(104,MMRSDIV,0)),U,3)=1,$P($G(^MMRS(104,MMRSDIV,0)),U,5)=1 S IND=1
"RTN","MMRSIPC3",75,0)
 ..I $P($G(^MMRS(104,MMRSDIV,0)),U,3)=1,$P($G(^MMRS(104,MMRSDIV,0)),U,5)=0,KNOWMRSA'["POS" S IND=1
"RTN","MMRSIPC3",76,0)
 ..I $P($G(^MMRS(104,MMRSDIV,0)),U,3)=0,$P($G(^MMRS(104,MMRSDIV,0)),U,5)=0,$P(DATA,U,8)=3,KNOWMRSA'["POS" S IND=1
"RTN","MMRSIPC3",77,0)
 ..I $P($G(^MMRS(104,MMRSDIV,0)),U,3)=0,$P($G(^MMRS(104,MMRSDIV,0)),U,5)=1,$P(DATA,U,8)=3 S IND=1
"RTN","MMRSIPC3",78,0)
 ..S $P(^TMP($J,"MMRSIPC","D",LOC,INDT,DFN,OUTDT),U,16)=IND ;MIA/LMT - Add if patient was indicated ;3/16/10
"RTN","MMRSIPC3",79,0)
 ..I IND=1 D
"RTN","MMRSIPC3",80,0)
 ...S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,3)=$P(LOCSUM,U,3)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,3)=$P(SUM,U,3)+1
"RTN","MMRSIPC3",81,0)
 ...I NARES24D["Y" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,4)=$P(LOCSUM,U,4)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,4)=$P(SUM,U,4)+1
"RTN","MMRSIPC3",82,0)
 .I TRANS="T" S $P(^TMP($J,"MMRSIPC","DSUM",LOC),U,5)=$P(LOCSUM,U,5)+1,$P(^TMP($J,"MMRSIPC","DSUM"),U,5)=$P(SUM,U,5)+1
"RTN","MMRSIPC3",83,0)
 Q
"RTN","MMRSIPC3",84,0)
GETLAB(DFN,LRMDRO,LRSTART,LREND,LRDTTYP) ;RETURN YES/NO^RESULT
"RTN","MMRSIPC3",85,0)
 N LRRSLT,LRTST,TMPRSLT
"RTN","MMRSIPC3",86,0)
 S LRRSLT="^"
"RTN","MMRSIPC3",87,0)
 I $G(DFN)=""!($G(LRMDRO)="")!($G(LRSTART)="")!($G(LREND)="") Q LRRSLT
"RTN","MMRSIPC3",88,0)
 ;GET CH RSLTS
"RTN","MMRSIPC3",89,0)
 S LRTST=0 F  S LRTST=$O(^TMP($J,"MMRSIPC","T",LRMDRO,LRTST)) Q:'LRTST  D
"RTN","MMRSIPC3",90,0)
 .S TMPRSLT=$$GETCH(DFN,LRMDRO,LRTST,LRSTART,LREND,LRDTTYP)
"RTN","MMRSIPC3",91,0)
 .I $P(LRRSLT,U)'="Y" S LRRSLT=TMPRSLT
"RTN","MMRSIPC3",92,0)
 .I $P(TMPRSLT,U,2)["POS",(($P(LRRSLT,"^",2)="")!($P($P(LRRSLT,"^",2),";",3)>$P($P(TMPRSLT,"^",2),";",3))) D
"RTN","MMRSIPC3",93,0)
 ..S LRRSLT=TMPRSLT
"RTN","MMRSIPC3",94,0)
 ;GET MI RSLTS
"RTN","MMRSIPC3",95,0)
 S TMPRSLT=$$GETMI(DFN,LRMDRO,LRSTART,LREND,LRDTTYP)
"RTN","MMRSIPC3",96,0)
 I $P(LRRSLT,U)'="Y" S LRRSLT=TMPRSLT
"RTN","MMRSIPC3",97,0)
 I $P(TMPRSLT,U,2)["POS",(($P(LRRSLT,"^",2)="")!($P($P(LRRSLT,"^",2),";",3)>$P($P(TMPRSLT,"^",2),";",3))) D
"RTN","MMRSIPC3",98,0)
 .S LRRSLT=TMPRSLT
"RTN","MMRSIPC3",99,0)
 Q LRRSLT
"RTN","MMRSIPC3",100,0)
GETCH(DFN,LRMDRO,LRTST,LRSTART,LREND,LRDTTYP) ;RETURN YES^RESULT
"RTN","MMRSIPC3",101,0)
 N LRRSLT,LRDFN,LRDATE,LRRADEND,DAS,LRIDT,LRSITE,TSTRSLT,LRRAD
"RTN","MMRSIPC3",102,0)
 S LRRSLT="^"
"RTN","MMRSIPC3",103,0)
 S LRDFN=$$LRDFN^LR7OR1(DFN)
"RTN","MMRSIPC3",104,0)
 Q:'LRDFN LRRSLT
"RTN","MMRSIPC3",105,0)
 S LRDATE=LRSTART-.0000001
"RTN","MMRSIPC3",106,0)
 I LRDTTYP="RAD" S LRDATE=0,LRRADEND=LREND,LREND=9999999
"RTN","MMRSIPC3",107,0)
 F  S LRDATE=$O(^PXRMINDX(63,"PI",DFN,+LRTST,LRDATE)) Q:'LRDATE!(LRDATE>LREND)  D
"RTN","MMRSIPC3",108,0)
 .S DAS=0 F  S DAS=$O(^PXRMINDX(63,"PI",DFN,+LRTST,LRDATE,DAS)) Q:'DAS  D
"RTN","MMRSIPC3",109,0)
 ..S LRIDT=$P(DAS,";",3)
"RTN","MMRSIPC3",110,0)
 ..I LRDTTYP="RAD" S LRRAD=$P($G(^LR(LRDFN,"CH",LRIDT,0)),U,3) I LRRAD<LRSTART!(LRRAD>LRRADEND) Q
"RTN","MMRSIPC3",111,0)
 ..Q:$P($G(^LR(LRDFN,"CH",LRIDT,0)),U,3)=""
"RTN","MMRSIPC3",112,0)
 ..S LRSITE=$P($G(^LR(LRDFN,"CH",LRIDT,0)),U,5)
"RTN","MMRSIPC3",113,0)
 ..;Q:$$SCRNTOP(LRSITE,LRMDRO)
"RTN","MMRSIPC3",114,0)
 ..;I $D(^LR(LRDFN,"CH",LRIDT,0)),$P(^LR(LRDFN,"CH",LRIDT,0),U,3) D
"RTN","MMRSIPC3",115,0)
 ..S $P(LRRSLT,"^",1)="Y"
"RTN","MMRSIPC3",116,0)
 ..S TSTRSLT=$$CHRSLT(LRDFN,LRIDT,LRMDRO,LRTST)
"RTN","MMRSIPC3",117,0)
 ..I TSTRSLT["POS",(($P(LRRSLT,"^",2)="")!($P($P(LRRSLT,"^",2),";",3)>LRIDT)) D
"RTN","MMRSIPC3",118,0)
 ...S $P(LRRSLT,"^",2)=(TSTRSLT_";"_LRDFN_";"_LRIDT_";CH")
"RTN","MMRSIPC3",119,0)
 Q LRRSLT
"RTN","MMRSIPC3",120,0)
GETMI(DFN,LRMDRO,LRSTART,LREND,LRDTTYP) ;RETURN YES^RESULT
"RTN","MMRSIPC3",121,0)
 N LRRSLT,LRDFN,LRDATE,LRRADEND,DAS,LRIDT,LRSITE,TSTRSLT,LRRAD,LRIEND
"RTN","MMRSIPC3",122,0)
 S LRRSLT="^"
"RTN","MMRSIPC3",123,0)
 I '$D(^TMP($J,"MMRSIPC","BACT",LRMDRO,"INC_REMARK")),'$D(^TMP($J,"MMRSIPC","ETIOL",LRMDRO)) Q LRRSLT
"RTN","MMRSIPC3",124,0)
 S LRDFN=$$LRDFN^LR7OR1(DFN)
"RTN","MMRSIPC3",125,0)
 Q:'LRDFN LRRSLT
"RTN","MMRSIPC3",126,0)
 S LRIDT=(9999999-LREND)-.0000001
"RTN","MMRSIPC3",127,0)
 S LRIEND=9999999-LRSTART
"RTN","MMRSIPC3",128,0)
 I LRDTTYP="RAD" S LRIDT=0,LRIEND=99999999
"RTN","MMRSIPC3",129,0)
 F  S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:'LRIDT!(LRIDT>LRIEND)  D
"RTN","MMRSIPC3",130,0)
 .I LRDTTYP="RAD" S LRRAD=$P($G(^LR(LRDFN,"MI",LRIDT,0)),U,3) I LRRAD<LRSTART!(LRRAD>LREND) Q
"RTN","MMRSIPC3",131,0)
 .;Q:$P($G(^LR(LRDFN,"MI",LRIDT,1)),U,2)'="F"
"RTN","MMRSIPC3",132,0)
 .S LRSITE=$P($G(^LR(LRDFN,"MI",LRIDT,0)),U,5)
"RTN","MMRSIPC3",133,0)
 .;Q:$$SCRNTOP(LRSITE,LRMDRO)
"RTN","MMRSIPC3",134,0)
 .;I $D(^LR(LRDFN,"MI",LRIDT,0)),$P(^LR(LRDFN,"MI",LRIDT,1),U) D
"RTN","MMRSIPC3",135,0)
 .S $P(LRRSLT,"^",1)="Y"
"RTN","MMRSIPC3",136,0)
 .S TSTRSLT=$$MIRSLT(LRDFN,LRIDT,LRMDRO)
"RTN","MMRSIPC3",137,0)
 .I TSTRSLT["POS",(($P(LRRSLT,"^",2)="")!($P($P(LRRSLT,"^",2),";",3)>LRIDT)) D
"RTN","MMRSIPC3",138,0)
 ..S $P(LRRSLT,"^",2)=(TSTRSLT_";"_LRDFN_";"_LRIDT_";MI")
"RTN","MMRSIPC3",139,0)
 Q LRRSLT
"RTN","MMRSIPC3",140,0)
CHRSLT(LRDFN,LRIDT,LRMDRO,LRTST) ;RETURNS 'POS' OR NULL STRING (IF NOT POSITIVE)
"RTN","MMRSIPC3",141,0)
 N RESULT,LRLOC,LRND,LRPC,LRRES,LRIND,LRINDVAL,LRSPEC,LRLOW,LRHIG
"RTN","MMRSIPC3",142,0)
 S RESULT=""
"RTN","MMRSIPC3",143,0)
 S LRLOC=$P($G(^LAB(60,+LRTST,0)),U,5)
"RTN","MMRSIPC3",144,0)
 S LRND=$P(LRLOC,";",2) Q:+LRND'>0 RESULT
"RTN","MMRSIPC3",145,0)
 S LRPC=$P(LRLOC,";",3) Q:+LRPC'>0 RESULT
"RTN","MMRSIPC3",146,0)
 S LRRES=$P($G(^LR(LRDFN,"CH",LRIDT,LRND)),U,LRPC) Q:LRRES="" RESULT
"RTN","MMRSIPC3",147,0)
 S LRIND=$P($G(^TMP($J,"MMRSIPC","T",LRMDRO,LRTST,0)),U,1)
"RTN","MMRSIPC3",148,0)
 S LRINDVAL=$P($G(^TMP($J,"MMRSIPC","T",LRMDRO,LRTST,0)),U,2)
"RTN","MMRSIPC3",149,0)
 Q:LRIND="" RESULT
"RTN","MMRSIPC3",150,0)
 I LRIND=1 D  Q RESULT
"RTN","MMRSIPC3",151,0)
 .Q:'LRRES
"RTN","MMRSIPC3",152,0)
 .S LRSPEC=$P($G(^LR(LRDFN,"CH",LRIDT,0)),U,5) Q:LRSPEC=""
"RTN","MMRSIPC3",153,0)
 .Q:'$D(^LAB(60,LRTST,1,LRSPEC,0))
"RTN","MMRSIPC3",154,0)
 .S LRLOW=$P(^LAB(60,LRTST,1,LRSPEC,0),U,2),LRHIG=$P(^LAB(60,LRTST,1,LRSPEC,0),U,3)
"RTN","MMRSIPC3",155,0)
 .Q:'LRLOW!('LRHIG)
"RTN","MMRSIPC3",156,0)
 .I LRRES<LRLOW!(LRRES>LRHIG) S RESULT="POS" Q
"RTN","MMRSIPC3",157,0)
 I LRINDVAL="" Q RESULT
"RTN","MMRSIPC3",158,0)
 S LRRES=$$UP^XLFSTR(LRRES),LRINDVAL=$$UP^XLFSTR(LRINDVAL)
"RTN","MMRSIPC3",159,0)
 I LRIND=2,(LRRES[LRINDVAL) Q "POS"
"RTN","MMRSIPC3",160,0)
 I LRIND=3,(LRRES>LRINDVAL) Q "POS"
"RTN","MMRSIPC3",161,0)
 I LRIND=4,(LRRES<LRINDVAL) Q "POS"
"RTN","MMRSIPC3",162,0)
 I LRIND=5,(LRRES=LRINDVAL) Q "POS"
"RTN","MMRSIPC3",163,0)
 Q RESULT
"RTN","MMRSIPC3",164,0)
MIRSLT(LRDFN,LRIDT,LRMDRO) ;RETURNS 'POS' OR NULL STRING (IF NOT POSITIVE)
"RTN","MMRSIPC3",165,0)
 N RESULT,LRETND,LRETI,LRANTI,LRANTIND,LRANTINV,LRAND,LRRES,BACTRPT,RPTRMRK,LRANTIEN
"RTN","MMRSIPC3",166,0)
 S RESULT=""
"RTN","MMRSIPC3",167,0)
 ;Check Etiology
"RTN","MMRSIPC3",168,0)
 I $D(^TMP($J,"MMRSIPC","ETIOL",LRMDRO)) D  Q:RESULT="POS" RESULT
"RTN","MMRSIPC3",169,0)
 .S LRETND=0 F  S LRETND=$O(^LR(LRDFN,"MI",LRIDT,3,LRETND)) Q:'LRETND!(RESULT="POS")  D
"RTN","MMRSIPC3",170,0)
 ..S LRETI=$P($G(^LR(LRDFN,"MI",LRIDT,3,LRETND,0)),U)
"RTN","MMRSIPC3",171,0)
 ..Q:+LRETI'>0
"RTN","MMRSIPC3",172,0)
 ..I ('$O(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI,0))) D  Q
"RTN","MMRSIPC3",173,0)
 ...I $D(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI)) S RESULT="POS"
"RTN","MMRSIPC3",174,0)
 ..S LRANTI=0 F  S LRANTI=$O(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI,LRANTI)) Q:'LRANTI  D
"RTN","MMRSIPC3",175,0)
 ...S LRANTIEN=$P(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI,LRANTI),U,1)
"RTN","MMRSIPC3",176,0)
 ...S LRANTIND=$P(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI,LRANTI),U,2)
"RTN","MMRSIPC3",177,0)
 ...S LRANTINV=$P(^TMP($J,"MMRSIPC","ETIOL",LRMDRO,LRETI,LRANTI),U,3)
"RTN","MMRSIPC3",178,0)
 ...;S LRAND=$P($G(^LAB(62.06,LRANTI,0)),U,2) Q:LRAND=""
"RTN","MMRSIPC3",179,0)
 ...S LRAND=$$ABDN^LRPXAPIU(LRANTIEN) Q:'LRAND
"RTN","MMRSIPC3",180,0)
 ...Q:$P($G(^LR(LRDFN,"MI",LRIDT,3,LRETND,LRAND)),U,2)=""
"RTN","MMRSIPC3",181,0)
 ...Q:$$UP^XLFSTR($E($P($G(^LR(LRDFN,"MI",LRIDT,3,LRETND,LRAND)),U,2),1,1))="S"
"RTN","MMRSIPC3",182,0)
 ...I LRANTIND=""!(LRANTINV="") Q
"RTN","MMRSIPC3",183,0)
 ...;S LRRES=$$UP^XLFSTR($E($P($G(^LR(LRDFN,"MI",LRIDT,3,LRETND,LRAND)),U,2),1,1))
"RTN","MMRSIPC3",184,0)
 ...S LRRES=$$UP^XLFSTR($P($G(^LR(LRDFN,"MI",LRIDT,3,LRETND,LRAND)),U,2))
"RTN","MMRSIPC3",185,0)
 ...S LRANTINV=$$UP^XLFSTR(LRANTINV)
"RTN","MMRSIPC3",186,0)
 ...S LRANTIND=$$UP^XLFSTR(LRANTIND)
"RTN","MMRSIPC3",187,0)
 ...I LRANTIND=1,(LRRES[LRANTINV) S RESULT="POS" Q
"RTN","MMRSIPC3",188,0)
 ...I LRANTIND=2,(LRRES>LRANTINV) S RESULT="POS" Q
"RTN","MMRSIPC3",189,0)
 ...I LRANTIND=3,(LRRES<LRANTINV) S RESULT="POS" Q
"RTN","MMRSIPC3",190,0)
 ...I LRANTIND=4,(LRRES=LRANTINV) S RESULT="POS" Q
"RTN","MMRSIPC3",191,0)
 Q:RESULT="POS" "POS"
"RTN","MMRSIPC3",192,0)
 ;Check Bacteriology Report Remarks
"RTN","MMRSIPC3",193,0)
 I '$D(^TMP($J,"MMRSIPC","BACT",LRMDRO,"INC_REMARK")) Q RESULT
"RTN","MMRSIPC3",194,0)
 S BACTRPT=0 F  S BACTRPT=$O(^LR(LRDFN,"MI",LRIDT,4,BACTRPT)) Q:'BACTRPT!(RESULT="POS")  D
"RTN","MMRSIPC3",195,0)
 .S RPTRMRK=$P($G(^LR(LRDFN,"MI",LRIDT,4,BACTRPT,0)),U,1)
"RTN","MMRSIPC3",196,0)
 .Q:RPTRMRK=""
"RTN","MMRSIPC3",197,0)
 .I $$BACTRPT(LRMDRO,"INC_REMARK",RPTRMRK)&('$$BACTRPT(LRMDRO,"EXC_REMARK",RPTRMRK)) S RESULT="POS"
"RTN","MMRSIPC3",198,0)
 Q RESULT
"RTN","MMRSIPC3",199,0)
SCRNTOP(LRSITE,LRMDRO) ;CHECK TO SEE IF SCREEN ON SITE
"RTN","MMRSIPC3",200,0)
 Q:+LRSITE'>0 0
"RTN","MMRSIPC3",201,0)
 I $D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"INC_TOP"))&$D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"EXC_TOP")) Q 0
"RTN","MMRSIPC3",202,0)
 I '$D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"INC_TOP"))&'$D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"EXC_TOP")) Q 0
"RTN","MMRSIPC3",203,0)
 I ($D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"INC_TOP")))&($D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"INC_TOP",LRSITE))) Q 0
"RTN","MMRSIPC3",204,0)
 I ($D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"EXC_TOP")))&('$D(^TMP($J,"MMRSIPC","TOP",LRMDRO,"EXC_TOP",LRSITE))) Q 0
"RTN","MMRSIPC3",205,0)
 Q 1
"RTN","MMRSIPC3",206,0)
BACTRPT(LRMDRO,RPTTYPE,RPTRMRK) ;Is this comment contained in the parameters
"RTN","MMRSIPC3",207,0)
 N RESULT,MMRSI,LRINDVAL
"RTN","MMRSIPC3",208,0)
 S RESULT=0
"RTN","MMRSIPC3",209,0)
 S MMRSI=0 F  S MMRSI=$O(^TMP($J,"MMRSIPC","BACT",LRMDRO,RPTTYPE,MMRSI)) Q:'MMRSI!(RESULT=1)  D
"RTN","MMRSIPC3",210,0)
 .S LRINDVAL=$G(^TMP($J,"MMRSIPC","BACT",LRMDRO,RPTTYPE,MMRSI))
"RTN","MMRSIPC3",211,0)
 .I ($$UP^XLFSTR(RPTRMRK))[($$UP^XLFSTR(LRINDVAL)) S RESULT=1
"RTN","MMRSIPC3",212,0)
 Q RESULT
"VER")
8.0^22.0
"BLD",9579,6)
^3
**END**
**END**

