EMERGENCY Released IB*2*566 SEQ #514
Extracted from mail message
**KIDS**:IB*2.0*566^

**INSTALL NAME**
IB*2.0*566
"BLD",9742,0)
IB*2.0*566^INTEGRATED BILLING^0^3160511^y
"BLD",9742,1,0)
^^3^3^3160511^
"BLD",9742,1,1,0)
The patch contains the fix for the patch IB*2.0*528. It is replacing 
"BLD",9742,1,2,0)
references to the old security key IBCNE IIV AUTO MATCH with IBCNE EIV
"BLD",9742,1,3,0)
MAINTENANCE in two routines IBCNEAMC and IBCNEUT6.
"BLD",9742,4,0)
^9.64PA^^
"BLD",9742,6.3)
1
"BLD",9742,"KRN",0)
^9.67PA^779.2^20
"BLD",9742,"KRN",.4,0)
.4
"BLD",9742,"KRN",.401,0)
.401
"BLD",9742,"KRN",.402,0)
.402
"BLD",9742,"KRN",.403,0)
.403
"BLD",9742,"KRN",.5,0)
.5
"BLD",9742,"KRN",.84,0)
.84
"BLD",9742,"KRN",3.6,0)
3.6
"BLD",9742,"KRN",3.8,0)
3.8
"BLD",9742,"KRN",9.2,0)
9.2
"BLD",9742,"KRN",9.8,0)
9.8
"BLD",9742,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9742,"KRN",9.8,"NM",1,0)
IBCNEAMC^^0^B32179785
"BLD",9742,"KRN",9.8,"NM",2,0)
IBCNEUT6^^0^B28635048
"BLD",9742,"KRN",9.8,"NM","B","IBCNEAMC",1)

"BLD",9742,"KRN",9.8,"NM","B","IBCNEUT6",2)

"BLD",9742,"KRN",19,0)
19
"BLD",9742,"KRN",19.1,0)
19.1
"BLD",9742,"KRN",101,0)
101
"BLD",9742,"KRN",409.61,0)
409.61
"BLD",9742,"KRN",771,0)
771
"BLD",9742,"KRN",779.2,0)
779.2
"BLD",9742,"KRN",870,0)
870
"BLD",9742,"KRN",8989.51,0)
8989.51
"BLD",9742,"KRN",8989.52,0)
8989.52
"BLD",9742,"KRN",8994,0)
8994
"BLD",9742,"KRN","B",.4,.4)

"BLD",9742,"KRN","B",.401,.401)

"BLD",9742,"KRN","B",.402,.402)

"BLD",9742,"KRN","B",.403,.403)

"BLD",9742,"KRN","B",.5,.5)

"BLD",9742,"KRN","B",.84,.84)

"BLD",9742,"KRN","B",3.6,3.6)

"BLD",9742,"KRN","B",3.8,3.8)

"BLD",9742,"KRN","B",9.2,9.2)

"BLD",9742,"KRN","B",9.8,9.8)

"BLD",9742,"KRN","B",19,19)

"BLD",9742,"KRN","B",19.1,19.1)

"BLD",9742,"KRN","B",101,101)

"BLD",9742,"KRN","B",409.61,409.61)

"BLD",9742,"KRN","B",771,771)

"BLD",9742,"KRN","B",779.2,779.2)

"BLD",9742,"KRN","B",870,870)

"BLD",9742,"KRN","B",8989.51,8989.51)

"BLD",9742,"KRN","B",8989.52,8989.52)

"BLD",9742,"KRN","B",8994,8994)

"BLD",9742,"QUES",0)
^9.62^^
"BLD",9742,"REQB",0)
^9.611^2^1
"BLD",9742,"REQB",2,0)
IB*2.0*528^1
"BLD",9742,"REQB","B","IB*2.0*528",2)

"MBREQ")
0
"PKG",49,-1)
1^1
"PKG",49,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",49,20,0)
^9.402P^1^1
"PKG",49,20,1,0)
2^^IBAXDR
"PKG",49,20,1,1)

"PKG",49,20,"B",2,1)

"PKG",49,22,0)
^9.49I^1^1
"PKG",49,22,1,0)
2.0^2940321^2960627
"PKG",49,22,1,"PAH",1,0)
566^3160511
"PKG",49,22,1,"PAH",1,1,0)
^^3^3^3160511
"PKG",49,22,1,"PAH",1,1,1,0)
The patch contains the fix for the patch IB*2.0*528. It is replacing 
"PKG",49,22,1,"PAH",1,1,2,0)
references to the old security key IBCNE IIV AUTO MATCH with IBCNE EIV
"PKG",49,22,1,"PAH",1,1,3,0)
MAINTENANCE in two routines IBCNEAMC and IBCNEUT6.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBCNEAMC")
0^1^B32179785^B32146789
"RTN","IBCNEAMC",1,0)
IBCNEAMC ;DAOU/ESG - IIV AUTO MATCH BUFFER LISTING ;11-JUN-2002
"RTN","IBCNEAMC",2,0)
 ;;2.0;INTEGRATED BILLING;**184,252,566**;21-MAR-94;Build 1
"RTN","IBCNEAMC",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","IBCNEAMC",4,0)
 ;
"RTN","IBCNEAMC",5,0)
EN ; -- main entry point for IBCNE AUTO MATCH BUFFER LIST
"RTN","IBCNEAMC",6,0)
 NEW IBCNENIL,COL,CTRLCOL,FINISH,POP,VALMBCK,X,%DT
"RTN","IBCNEAMC",7,0)
 D EN^VALM("IBCNE AUTO MATCH BUFFER LIST")
"RTN","IBCNEAMC",8,0)
 Q
"RTN","IBCNEAMC",9,0)
 ;
"RTN","IBCNEAMC",10,0)
HDR ; -- header code
"RTN","IBCNEAMC",11,0)
 S VALMHDR(1)="These are Insurance Company names from the Insurance Buffer file that do not"
"RTN","IBCNEAMC",12,0)
 S VALMHDR(2)="exist in the Insurance Company file (either as Names or as Synonyms).  They"
"RTN","IBCNEAMC",13,0)
 S VALMHDR(3)="also do not exist or pattern match with any entry in the Auto Match file."
"RTN","IBCNEAMC",14,0)
 Q
"RTN","IBCNEAMC",15,0)
 ;
"RTN","IBCNEAMC",16,0)
INIT ; -- init variables and list array
"RTN","IBCNEAMC",17,0)
 NEW ENTDATE,IBBUFDA,BUFFNAME
"RTN","IBCNEAMC",18,0)
 KILL ^TMP($J,"IBCNEAMC")
"RTN","IBCNEAMC",19,0)
 S IBCNENIL=0        ; initialize the no data flag
"RTN","IBCNEAMC",20,0)
 S ENTDATE=0
"RTN","IBCNEAMC",21,0)
 F  S ENTDATE=$O(^IBA(355.33,"AEST","E",ENTDATE)) Q:'ENTDATE  S IBBUFDA=0 F  S IBBUFDA=$O(^IBA(355.33,"AEST","E",ENTDATE,IBBUFDA)) Q:'IBBUFDA  D
"RTN","IBCNEAMC",22,0)
 . S BUFFNAME=$$TRIM($P($G(^IBA(355.33,IBBUFDA,20)),U,1))
"RTN","IBCNEAMC",23,0)
 . I BUFFNAME="" Q                       ; no name in buffer file
"RTN","IBCNEAMC",24,0)
 . I $D(^DIC(36,"B",BUFFNAME)) Q         ; insurance company name
"RTN","IBCNEAMC",25,0)
 . I $D(^DIC(36,"C",BUFFNAME)) Q         ; insurance company synonym
"RTN","IBCNEAMC",26,0)
 . I $$AMLOOK^IBCNEUT1(BUFFNAME) Q       ; Auto Match file lookup
"RTN","IBCNEAMC",27,0)
 . S ^TMP($J,"IBCNEAMC",2,BUFFNAME)=""   ; name not found so add it
"RTN","IBCNEAMC",28,0)
 . Q
"RTN","IBCNEAMC",29,0)
 ; Now build the ListMan array for display
"RTN","IBCNEAMC",30,0)
 S BUFFNAME="",VALMCNT=0
"RTN","IBCNEAMC",31,0)
 F  S BUFFNAME=$O(^TMP($J,"IBCNEAMC",2,BUFFNAME)) Q:BUFFNAME=""  D
"RTN","IBCNEAMC",32,0)
 . S VALMCNT=VALMCNT+1
"RTN","IBCNEAMC",33,0)
 . S ^TMP($J,"IBCNEAMC",1,VALMCNT,0)=$J(VALMCNT,4)_"  "_BUFFNAME
"RTN","IBCNEAMC",34,0)
 . S ^TMP($J,"IBCNEAMC",3,VALMCNT)=BUFFNAME
"RTN","IBCNEAMC",35,0)
 . Q
"RTN","IBCNEAMC",36,0)
 ;
"RTN","IBCNEAMC",37,0)
 ; Check to see if there's no data
"RTN","IBCNEAMC",38,0)
 I 'VALMCNT D
"RTN","IBCNEAMC",39,0)
 . S IBCNENIL=1     ; no data flag is true
"RTN","IBCNEAMC",40,0)
 . S ^TMP($J,"IBCNEAMC",1,1,0)=""
"RTN","IBCNEAMC",41,0)
 . S ^TMP($J,"IBCNEAMC",1,2,0)=""
"RTN","IBCNEAMC",42,0)
 . S ^TMP($J,"IBCNEAMC",1,3,0)="     There is no data to display."
"RTN","IBCNEAMC",43,0)
 . S VALMCNT=3
"RTN","IBCNEAMC",44,0)
 . Q
"RTN","IBCNEAMC",45,0)
INITX ;
"RTN","IBCNEAMC",46,0)
 Q
"RTN","IBCNEAMC",47,0)
 ;
"RTN","IBCNEAMC",48,0)
 ; For speed reasons, code taken from TRIM^XLFSTR
"RTN","IBCNEAMC",49,0)
TRIM(X,SIDE,CHAR) ; Trim chars from left/right of string
"RTN","IBCNEAMC",50,0)
 NEW LEFT,RIGHT
"RTN","IBCNEAMC",51,0)
 I X="" Q X
"RTN","IBCNEAMC",52,0)
 S SIDE=$G(SIDE,"LR"),CHAR=$G(CHAR," "),LEFT=1,RIGHT=$L(X)
"RTN","IBCNEAMC",53,0)
 I X=CHAR Q ""
"RTN","IBCNEAMC",54,0)
 I SIDE["R" F RIGHT=$L(X):-1:1 Q:$E(X,RIGHT)'=CHAR
"RTN","IBCNEAMC",55,0)
 I SIDE["L" F LEFT=1:1:$L(X) Q:$E(X,LEFT)'=CHAR
"RTN","IBCNEAMC",56,0)
 Q $E(X,LEFT,RIGHT)
"RTN","IBCNEAMC",57,0)
 ;
"RTN","IBCNEAMC",58,0)
 ;
"RTN","IBCNEAMC",59,0)
HELP ; -- help code
"RTN","IBCNEAMC",60,0)
 D FULL^VALM1
"RTN","IBCNEAMC",61,0)
 W !!," There are three main actions you may take on this screen."
"RTN","IBCNEAMC",62,0)
 W !," You may select an action by typing in the first character of the action."
"RTN","IBCNEAMC",63,0)
 W !!,"   Select Entry"
"RTN","IBCNEAMC",64,0)
 W !,"     You choose a single insurance company name from the list."
"RTN","IBCNEAMC",65,0)
 W !,"     This name becomes the default Auto Match value for a new"
"RTN","IBCNEAMC",66,0)
 W !,"     Auto Match entry.  You may then associate this Auto Match value"
"RTN","IBCNEAMC",67,0)
 W !,"     with a valid insurance company name."
"RTN","IBCNEAMC",68,0)
 W !!,"   Auto Match Enter/Edit"
"RTN","IBCNEAMC",69,0)
 W !,"     This action will take you to the Enter/Edit Auto Match Entries"
"RTN","IBCNEAMC",70,0)
 W !,"     option.  You may add, edit, or delete multiple Auto Match"
"RTN","IBCNEAMC",71,0)
 W !,"     entries in this option."
"RTN","IBCNEAMC",72,0)
 W !!,"   Exit"
"RTN","IBCNEAMC",73,0)
 W !,"     Exit out of this option."
"RTN","IBCNEAMC",74,0)
 D PAUSE^VALM1
"RTN","IBCNEAMC",75,0)
 S VALMBCK="R"
"RTN","IBCNEAMC",76,0)
HELPX ;
"RTN","IBCNEAMC",77,0)
 Q
"RTN","IBCNEAMC",78,0)
 ;
"RTN","IBCNEAMC",79,0)
 ;
"RTN","IBCNEAMC",80,0)
EXIT ; -- exit code
"RTN","IBCNEAMC",81,0)
 KILL ^TMP($J,"IBCNEAMC")
"RTN","IBCNEAMC",82,0)
 Q
"RTN","IBCNEAMC",83,0)
 ;
"RTN","IBCNEAMC",84,0)
 ;
"RTN","IBCNEAMC",85,0)
SELECT ; -- select an entry from the list
"RTN","IBCNEAMC",86,0)
 NEW STOP,AMIEN,NEWENTRY,BUFFNAME,INSNM
"RTN","IBCNEAMC",87,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEAMC",88,0)
 D FULL^VALM1
"RTN","IBCNEAMC",89,0)
 ;
"RTN","IBCNEAMC",90,0)
 ; Check for Auto Match security key before allowing selection
"RTN","IBCNEAMC",91,0)
 I '$$KCHK^XUSRB("IBCNE EIV MAINTENANCE") D  G SELECTX
"RTN","IBCNEAMC",92,0)
 . W !!?5,"You don't hold the proper security key to access this function."
"RTN","IBCNEAMC",93,0)
 . W !?5,"The necessary key is IBCNE EIV MAINTENANCE.  Please see your manager."
"RTN","IBCNEAMC",94,0)
 . D PAUSE^VALM1
"RTN","IBCNEAMC",95,0)
 . Q
"RTN","IBCNEAMC",96,0)
 ;
"RTN","IBCNEAMC",97,0)
 ; Make sure there is something there
"RTN","IBCNEAMC",98,0)
 I IBCNENIL D  G SELECTX
"RTN","IBCNEAMC",99,0)
 . W !!?5,"There are no entries in the list."
"RTN","IBCNEAMC",100,0)
 . D PAUSE^VALM1
"RTN","IBCNEAMC",101,0)
 . Q
"RTN","IBCNEAMC",102,0)
 ;
"RTN","IBCNEAMC",103,0)
 S DIR(0)="NO^1:"_VALMCNT_":0"
"RTN","IBCNEAMC",104,0)
 S DIR("A")="Select Entry"
"RTN","IBCNEAMC",105,0)
 S DIR("?",1)=" Please enter the line number corresponding to the insurance company name."
"RTN","IBCNEAMC",106,0)
 S DIR("?",2)=" The valid range of line numbers is displayed in the prompt."
"RTN","IBCNEAMC",107,0)
 S DIR("?",3)=" "
"RTN","IBCNEAMC",108,0)
 S DIR("?",4)=" The insurance company name you select will be used as the default response for"
"RTN","IBCNEAMC",109,0)
 S DIR("?",5)=" a new Auto Match entry.  You may either accept this entry as is or you may"
"RTN","IBCNEAMC",110,0)
 S DIR("?")=" modify it by changing the spelling or by adding wildcard characters."
"RTN","IBCNEAMC",111,0)
 D ^DIR K DIR
"RTN","IBCNEAMC",112,0)
 I 'Y G SELECTX
"RTN","IBCNEAMC",113,0)
 S BUFFNAME=$G(^TMP($J,"IBCNEAMC",3,Y))
"RTN","IBCNEAMC",114,0)
 I BUFFNAME="" W ! G SELECTX
"RTN","IBCNEAMC",115,0)
 W "  ",BUFFNAME,!
"RTN","IBCNEAMC",116,0)
 ;
"RTN","IBCNEAMC",117,0)
 D LOOKUP I STOP G SELECTX ;Prompt user for Insurance Co.
"RTN","IBCNEAMC",118,0)
 I $D(^IBCN(365.11,"B",BUFFNAME)) D  G SELECTX ; has entry been added?
"RTN","IBCNEAMC",119,0)
 . W !!,BUFFNAME," has already been added to the Auto Match file."
"RTN","IBCNEAMC",120,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNEAMC",121,0)
 . D INIT ; refresh listing
"RTN","IBCNEAMC",122,0)
 D AMADD^IBCNEUT6(INSNM,BUFFNAME)
"RTN","IBCNEAMC",123,0)
 D INIT
"RTN","IBCNEAMC",124,0)
SELECTX ;
"RTN","IBCNEAMC",125,0)
 S VALMBCK="R"
"RTN","IBCNEAMC",126,0)
 Q
"RTN","IBCNEAMC",127,0)
 ;
"RTN","IBCNEAMC",128,0)
LOOKUP ; Prompt for associated Insurance Company
"RTN","IBCNEAMC",129,0)
 S STOP=0
"RTN","IBCNEAMC",130,0)
 S DIC=36,DIC(0)="AEMVZ"
"RTN","IBCNEAMC",131,0)
 D ^DIC
"RTN","IBCNEAMC",132,0)
 I Y<1!$D(DTOUT)!$D(DUOUT) S STOP=1 G LOOKX
"RTN","IBCNEAMC",133,0)
 S INSNM=$P(Y(0),U)
"RTN","IBCNEAMC",134,0)
LOOKX Q
"RTN","IBCNEAMC",135,0)
 ;
"RTN","IBCNEAMC",136,0)
LINK ; -- link to the Auto Match Enter/Edit option
"RTN","IBCNEAMC",137,0)
 D FULL^VALM1
"RTN","IBCNEAMC",138,0)
 ;
"RTN","IBCNEAMC",139,0)
 ; Check for Auto Match security key before allowing selection
"RTN","IBCNEAMC",140,0)
 I '$$KCHK^XUSRB("IBCNE EIV MAINTENANCE") D  G LINKX
"RTN","IBCNEAMC",141,0)
 . W !!?5,"You don't hold the proper security key to access this function."
"RTN","IBCNEAMC",142,0)
 . W !?5,"The necessary key is IBCNE EIV MAINTENANCE.  Please see your manager."
"RTN","IBCNEAMC",143,0)
 . D PAUSE^VALM1
"RTN","IBCNEAMC",144,0)
 . Q
"RTN","IBCNEAMC",145,0)
 ;
"RTN","IBCNEAMC",146,0)
 D ENTER^IBCNEAME
"RTN","IBCNEAMC",147,0)
LINKX ;
"RTN","IBCNEAMC",148,0)
 D INIT S VALMBCK="R"
"RTN","IBCNEAMC",149,0)
 Q
"RTN","IBCNEAMC",150,0)
 ;
"RTN","IBCNEUT6")
0^2^B28635048^B28657707
"RTN","IBCNEUT6",1,0)
IBCNEUT6 ;DAOU/ESG - IIV MISC. UTILITIES ;14-AUG-2002
"RTN","IBCNEUT6",2,0)
 ;;2.0;INTEGRATED BILLING;**184,252,271,566**;21-MAR-94;Build 1
"RTN","IBCNEUT6",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","IBCNEUT6",4,0)
 ;
"RTN","IBCNEUT6",5,0)
 ; Can't be called from the top
"RTN","IBCNEUT6",6,0)
 Q
"RTN","IBCNEUT6",7,0)
 ;
"RTN","IBCNEUT6",8,0)
AMCHECK ; This procedure will examine the insurance company names in the 
"RTN","IBCNEUT6",9,0)
 ; Auto Match file (#365.11) to make sure there is still at least
"RTN","IBCNEUT6",10,0)
 ; one active insurance company with that name.  If there isn't,
"RTN","IBCNEUT6",11,0)
 ; then the Auto Match entries for that insurance company name
"RTN","IBCNEUT6",12,0)
 ; will be deleted.
"RTN","IBCNEUT6",13,0)
 ;
"RTN","IBCNEUT6",14,0)
 NEW NAME,INSIEN,FOUNDACT,DA,DIK,DIC,X,Y,%
"RTN","IBCNEUT6",15,0)
 S NAME=""
"RTN","IBCNEUT6",16,0)
 F  S NAME=$O(^IBCN(365.11,"C",NAME)) Q:NAME=""  D
"RTN","IBCNEUT6",17,0)
 . ;
"RTN","IBCNEUT6",18,0)
 . ; For this Auto Match ins co name, see if there is an active ins co
"RTN","IBCNEUT6",19,0)
 . S INSIEN=0,FOUNDACT=0
"RTN","IBCNEUT6",20,0)
 . F  S INSIEN=$O(^DIC(36,"B",NAME,INSIEN)) Q:'INSIEN  I $$ACTIVE^IBCNEUT4(INSIEN) S FOUNDACT=1 Q
"RTN","IBCNEUT6",21,0)
 . ;
"RTN","IBCNEUT6",22,0)
 . ; If an active ins co was found, then we're OK so quit
"RTN","IBCNEUT6",23,0)
 . I FOUNDACT Q
"RTN","IBCNEUT6",24,0)
 . ;
"RTN","IBCNEUT6",25,0)
 . ; Otherwise, we need to delete all Auto Match entries for this name
"RTN","IBCNEUT6",26,0)
 . S DA=0,DIK="^IBCN(365.11,"
"RTN","IBCNEUT6",27,0)
 . F  S DA=$O(^IBCN(365.11,"C",NAME,DA)) Q:'DA  D ^DIK
"RTN","IBCNEUT6",28,0)
 . Q
"RTN","IBCNEUT6",29,0)
AMCHKX ;
"RTN","IBCNEUT6",30,0)
 Q
"RTN","IBCNEUT6",31,0)
 ;
"RTN","IBCNEUT6",32,0)
 ;
"RTN","IBCNEUT6",33,0)
AMADD(INSNAME,IBCNEXT1) ; Conditionally add an Auto Match entry based on user input
"RTN","IBCNEUT6",34,0)
 ; Input Parameters:
"RTN","IBCNEUT6",35,0)
 ;    INSNAME is a valid, active insurance company name
"RTN","IBCNEUT6",36,0)
 ;   IBCNEXT1 is the existing entry in the ins co name field in the
"RTN","IBCNEUT6",37,0)
 ;            buffer.  This may be used as the Auto Match value for
"RTN","IBCNEUT6",38,0)
 ;            a new auto match entry.
"RTN","IBCNEUT6",39,0)
 ;
"RTN","IBCNEUT6",40,0)
 NEW AMDATA,AMIEN,AMERROR
"RTN","IBCNEUT6",41,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEUT6",42,0)
 NEW D,D0,D1,DA,DB,DC,DDH,DE,DG,DH,DI,DIC,DIE,DIEL,DIFLD,DIG,DIH
"RTN","IBCNEUT6",43,0)
 NEW DIK,DILN,DIPA,DISYS,DIV,DK,DL,DM,DN,DOV,DP,DQ,DR,DU,DV,DZ
"RTN","IBCNEUT6",44,0)
 ;
"RTN","IBCNEUT6",45,0)
 ; First, check security key to see if user is allowed to do this
"RTN","IBCNEUT6",46,0)
 I '$$KCHK^XUSRB("IBCNE EIV MAINTENANCE") G AMADDX
"RTN","IBCNEUT6",47,0)
 ;
"RTN","IBCNEUT6",48,0)
 S IBCNEXT1=$$UP^XLFSTR(IBCNEXT1)               ; all uppercase
"RTN","IBCNEUT6",49,0)
 S IBCNEXT1=$$TRIM^XLFSTR(IBCNEXT1)             ; lead/trail spaces
"RTN","IBCNEUT6",50,0)
 I IBCNEXT1="" G AMADDX                         ; must exist
"RTN","IBCNEUT6",51,0)
 I $L(IBCNEXT1)>30!($L(IBCNEXT1)<3) G AMADDX    ; too long or too short
"RTN","IBCNEUT6",52,0)
 I IBCNEXT1=INSNAME G AMADDX                    ; cannot equal the name
"RTN","IBCNEUT6",53,0)
 I $D(^IBCN(365.11,"B",IBCNEXT1)) G AMADDX      ; already in Auto Match
"RTN","IBCNEUT6",54,0)
 I $D(^DIC(36,"B",IBCNEXT1)) G AMADDX           ; already an ins co name
"RTN","IBCNEUT6",55,0)
 I $D(^DIC(36,"C",IBCNEXT1)) G AMADDX           ; already a synonym
"RTN","IBCNEUT6",56,0)
 I IBCNEXT1["*" G AMADDX                        ; no wildcards allowed
"RTN","IBCNEUT6",57,0)
 ;
"RTN","IBCNEUT6",58,0)
 S DIR(0)="YO"
"RTN","IBCNEUT6",59,0)
 S DIR("A",1)=" "
"RTN","IBCNEUT6",60,0)
 S DIR("A",2)="Do you want to add an Auto Match entry that associates"
"RTN","IBCNEUT6",61,0)
 S DIR("A")=IBCNEXT1_" with "_INSNAME
"RTN","IBCNEUT6",62,0)
 S DIR("B")="No"
"RTN","IBCNEUT6",63,0)
 S DIR("?",1)="      The Auto Match Value is "_IBCNEXT1_"."
"RTN","IBCNEUT6",64,0)
 S DIR("?",2)="The Insurance Company Name is "_INSNAME_"."
"RTN","IBCNEUT6",65,0)
 S DIR("?",3)=" "
"RTN","IBCNEUT6",66,0)
 S DIR("?",4)="Please enter NO if you do not want to associate these two values together"
"RTN","IBCNEUT6",67,0)
 S DIR("?",5)="in the Auto Match file."
"RTN","IBCNEUT6",68,0)
 S DIR("?",6)=" "
"RTN","IBCNEUT6",69,0)
 S DIR("?",7)="Please enter YES if you do want to create an Auto Match entry for these"
"RTN","IBCNEUT6",70,0)
 S DIR("?",8)="two values.  If you enter YES, then you will have the chance to modify"
"RTN","IBCNEUT6",71,0)
 S DIR("?")="the Auto Match Value."
"RTN","IBCNEUT6",72,0)
 D ^DIR K DIR
"RTN","IBCNEUT6",73,0)
 D EN^DDIOL(,,"!!")
"RTN","IBCNEUT6",74,0)
 ;
"RTN","IBCNEUT6",75,0)
 ; If user didn't say Yes, then we exit
"RTN","IBCNEUT6",76,0)
 I 'Y G AMADDX
"RTN","IBCNEUT6",77,0)
 ; To allow for edits to the .01 field and not the .02 field,
"RTN","IBCNEUT6",78,0)
 ; Add this new entry first and then edit only the .01 field.
"RTN","IBCNEUT6",79,0)
 S AMDATA(365.11,"+1,",.01)=IBCNEXT1
"RTN","IBCNEUT6",80,0)
 S AMDATA(365.11,"+1,",.02)=INSNAME
"RTN","IBCNEUT6",81,0)
 S AMDATA(365.11,"+1,",.03)=$$NOW^XLFDT
"RTN","IBCNEUT6",82,0)
 S AMDATA(365.11,"+1,",.04)=DUZ
"RTN","IBCNEUT6",83,0)
 S AMDATA(365.11,"+1,",.05)=$$NOW^XLFDT
"RTN","IBCNEUT6",84,0)
 S AMDATA(365.11,"+1,",.06)=DUZ
"RTN","IBCNEUT6",85,0)
 S AMDATA(365.11,"+1,",.07)=IBCNEXT1
"RTN","IBCNEUT6",86,0)
 S AMDATA(365.11,"+1,",.08)=INSNAME
"RTN","IBCNEUT6",87,0)
 D UPDATE^DIE("","AMDATA","AMIEN","AMERROR")
"RTN","IBCNEUT6",88,0)
 ;
"RTN","IBCNEUT6",89,0)
 I $D(AMERROR) G AMADDX       ; FileMan error so get out
"RTN","IBCNEUT6",90,0)
 S AMIEN=+$G(AMIEN(1))        ; internal entry number created
"RTN","IBCNEUT6",91,0)
 I 'AMIEN G AMADDX            ; if IEN not there get out
"RTN","IBCNEUT6",92,0)
 ;
"RTN","IBCNEUT6",93,0)
 ; Here we have to edit the entry to allow for the opportunity to 
"RTN","IBCNEUT6",94,0)
 ; change something
"RTN","IBCNEUT6",95,0)
 S DIE=365.11,DA=AMIEN,DR=".01;.05////"_$$NOW^XLFDT_";.06////"_DUZ
"RTN","IBCNEUT6",96,0)
 D ^DIE
"RTN","IBCNEUT6",97,0)
 ;
"RTN","IBCNEUT6",98,0)
 ; Display the confirmation message to the user
"RTN","IBCNEUT6",99,0)
 S AMDATA=$G(^IBCN(365.11,AMIEN,0))
"RTN","IBCNEUT6",100,0)
 I AMDATA'="" D EN^DDIOL($P(AMDATA,U,1)_" is now associated with "_$P(AMDATA,U,2)_".",,"!!?3")
"RTN","IBCNEUT6",101,0)
 D EN^DDIOL(,,"!!")
"RTN","IBCNEUT6",102,0)
AMADDX ;
"RTN","IBCNEUT6",103,0)
 Q
"RTN","IBCNEUT6",104,0)
 ;
"RTN","IBCNEUT6",105,0)
PYRFLTR() ;
"RTN","IBCNEUT6",106,0)
 ; Function to assist with filtering items in custom payer
"RTN","IBCNEUT6",107,0)
 ; lookups for most popular list.  This logic is used in the
"RTN","IBCNEUT6",108,0)
 ; DIC("S") definition for the lookup
"RTN","IBCNEUT6",109,0)
 ;
"RTN","IBCNEUT6",110,0)
 NEW IBDATA,IBPIEN,IBPNM,IBAIEN,IBADATA,OK
"RTN","IBCNEUT6",111,0)
 ;
"RTN","IBCNEUT6",112,0)
 S OK=1
"RTN","IBCNEUT6",113,0)
 ;
"RTN","IBCNEUT6",114,0)
 S IBDATA=^(0)   ; Naked reference from DIC call
"RTN","IBCNEUT6",115,0)
 S IBPIEN=$G(Y) I IBPIEN="" S OK=0 G XPFLTR
"RTN","IBCNEUT6",116,0)
 ;
"RTN","IBCNEUT6",117,0)
 ; Set Payer Name and IEN
"RTN","IBCNEUT6",118,0)
 S IBPNM=$P(IBDATA,U,1) I IBPNM="" S OK=0 G XPFLTR
"RTN","IBCNEUT6",119,0)
 ;
"RTN","IBCNEUT6",120,0)
 ; Set Payer Application IEN (365.13)
"RTN","IBCNEUT6",121,0)
 ;  Quit if IIV not defined for payer
"RTN","IBCNEUT6",122,0)
 S IBAIEN=$$PYRAPP^IBCNEUT5("IIV",IBPIEN) I IBAIEN="" S OK=0 G XPFLTR
"RTN","IBCNEUT6",123,0)
 ;
"RTN","IBCNEUT6",124,0)
 ; Get IIV application specific data
"RTN","IBCNEUT6",125,0)
 S IBADATA=$G(^IBE(365.12,IBPIEN,1,IBAIEN,0)) I IBADATA="" S OK=0 G XPFLTR
"RTN","IBCNEUT6",126,0)
 ;
"RTN","IBCNEUT6",127,0)
 ; Filter if Deactivated
"RTN","IBCNEUT6",128,0)
 I +$P(IBADATA,U,11) S OK=0 G XPFLTR
"RTN","IBCNEUT6",129,0)
 ;
"RTN","IBCNEUT6",130,0)
 ; Filter if ID Inq Req ID and SSN is not ID
"RTN","IBCNEUT6",131,0)
 I +$P(IBADATA,U,8),'$P(IBADATA,U,9) S OK=0 G XPFLTR
"RTN","IBCNEUT6",132,0)
 ;
"RTN","IBCNEUT6",133,0)
 ; Filter if already in the list
"RTN","IBCNEUT6",134,0)
 I $D(^TMP($J,"IBJPI3-IENS",IBPIEN)) S OK=0 G XPFLTR
"RTN","IBCNEUT6",135,0)
 ;
"RTN","IBCNEUT6",136,0)
XPFLTR Q OK
"RTN","IBCNEUT6",137,0)
 ;
"RTN","IBCNEUT6",138,0)
DSPLINE() ;
"RTN","IBCNEUT6",139,0)
 ; Format display text for custom Most Pop. payer lookup
"RTN","IBCNEUT6",140,0)
 ;
"RTN","IBCNEUT6",141,0)
 N ITEMDATA,DISPSTR,IBAIEN,IBADATA,PYRIEN,PADLEN
"RTN","IBCNEUT6",142,0)
 ;
"RTN","IBCNEUT6",143,0)
 ; Initialize the data for the item to be displayed
"RTN","IBCNEUT6",144,0)
 ; Naked reference is referencing the DIC data
"RTN","IBCNEUT6",145,0)
 S ITEMDATA=^(0)
"RTN","IBCNEUT6",146,0)
 ;
"RTN","IBCNEUT6",147,0)
 ; Initialize Display string
"RTN","IBCNEUT6",148,0)
 S DISPSTR=""
"RTN","IBCNEUT6",149,0)
 ;
"RTN","IBCNEUT6",150,0)
 ; Payer IEN is passed from DIC as Y
"RTN","IBCNEUT6",151,0)
 S PYRIEN=+$G(Y) I 'PYRIEN G EXDSP
"RTN","IBCNEUT6",152,0)
 ;
"RTN","IBCNEUT6",153,0)
 ; Set Payer Application IEN (365.13)
"RTN","IBCNEUT6",154,0)
 S IBAIEN=$$PYRAPP^IBCNEUT5("IIV",PYRIEN) I IBAIEN="" G EXDSP
"RTN","IBCNEUT6",155,0)
 ;
"RTN","IBCNEUT6",156,0)
 ; Get IIV Application specific data
"RTN","IBCNEUT6",157,0)
 S IBADATA=$G(^IBE(365.12,PYRIEN,1,IBAIEN,0)) I IBADATA="" G EXDSP
"RTN","IBCNEUT6",158,0)
 ;
"RTN","IBCNEUT6",159,0)
 ; Pad start of display data, adjusting for payer name length
"RTN","IBCNEUT6",160,0)
 S PADLEN=$L($E($P($G(ITEMDATA),U),1,30))
"RTN","IBCNEUT6",161,0)
 S DISPSTR=DISPSTR_$$FO^IBCNEUT1("",31-PADLEN,"L")
"RTN","IBCNEUT6",162,0)
 ;
"RTN","IBCNEUT6",163,0)
 ; Add National and Local active flags
"RTN","IBCNEUT6",164,0)
 S DISPSTR=DISPSTR_"  National: "_$$FO^IBCNEUT1($S('$P(IBADATA,U,2):"Inactive",1:"Active"),8)
"RTN","IBCNEUT6",165,0)
 S DISPSTR=DISPSTR_"  Local: "_$$FO^IBCNEUT1($S('$P(IBADATA,U,3):"Inactive",1:"Active"),8)
"RTN","IBCNEUT6",166,0)
EXDSP ;
"RTN","IBCNEUT6",167,0)
 Q DISPSTR
"RTN","IBCNEUT6",168,0)
 ;
"VER")
8.0^22.0
"BLD",9742,6)
^514
**END**
**END**

