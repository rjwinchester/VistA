Released IB*2*489 SEQ #476
Extracted from mail message
**KIDS**:IB*2.0*489^

**INSTALL NAME**
IB*2.0*489
"BLD",9220,0)
IB*2.0*489^INTEGRATED BILLING^0^3140224^y
"BLD",9220,1,0)
^^5^5^3130207^
"BLD",9220,1,1,0)
This patch addresses two issues. This first issue is about duplicate 
"BLD",9220,1,2,0)
encounters for the outpatient care added to the Claims Tracking when the
"BLD",9220,1,3,0)
'REPORTS ADD TO CLAIMS TRACKING' site parameter set to 'YES'. The second 
"BLD",9220,1,4,0)
issue is the line items which are not listed under the appropriate 
"BLD",9220,1,5,0)
heading in the [IBJ THIRD PARTY JOINT INQUIRY] option.
"BLD",9220,4,0)
^9.64PA^^0
"BLD",9220,6)
^425
"BLD",9220,6.3)
31
"BLD",9220,"ABPKG")
n
"BLD",9220,"INIT")

"BLD",9220,"KRN",0)
^9.67PA^779.2^20
"BLD",9220,"KRN",.4,0)
.4
"BLD",9220,"KRN",.401,0)
.401
"BLD",9220,"KRN",.402,0)
.402
"BLD",9220,"KRN",.403,0)
.403
"BLD",9220,"KRN",.5,0)
.5
"BLD",9220,"KRN",.84,0)
.84
"BLD",9220,"KRN",3.6,0)
3.6
"BLD",9220,"KRN",3.8,0)
3.8
"BLD",9220,"KRN",9.2,0)
9.2
"BLD",9220,"KRN",9.8,0)
9.8
"BLD",9220,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9220,"KRN",9.8,"NM",1,0)
IBTRKR4^^0^B17535096
"BLD",9220,"KRN",9.8,"NM",2,0)
IBCECSA5^^0^B62841003
"BLD",9220,"KRN",9.8,"NM","B","IBCECSA5",2)

"BLD",9220,"KRN",9.8,"NM","B","IBTRKR4",1)

"BLD",9220,"KRN",19,0)
19
"BLD",9220,"KRN",19,"NM",0)
^9.68A^^
"BLD",9220,"KRN",19.1,0)
19.1
"BLD",9220,"KRN",101,0)
101
"BLD",9220,"KRN",409.61,0)
409.61
"BLD",9220,"KRN",771,0)
771
"BLD",9220,"KRN",779.2,0)
779.2
"BLD",9220,"KRN",870,0)
870
"BLD",9220,"KRN",8989.51,0)
8989.51
"BLD",9220,"KRN",8989.52,0)
8989.52
"BLD",9220,"KRN",8994,0)
8994
"BLD",9220,"KRN","B",.4,.4)

"BLD",9220,"KRN","B",.401,.401)

"BLD",9220,"KRN","B",.402,.402)

"BLD",9220,"KRN","B",.403,.403)

"BLD",9220,"KRN","B",.5,.5)

"BLD",9220,"KRN","B",.84,.84)

"BLD",9220,"KRN","B",3.6,3.6)

"BLD",9220,"KRN","B",3.8,3.8)

"BLD",9220,"KRN","B",9.2,9.2)

"BLD",9220,"KRN","B",9.8,9.8)

"BLD",9220,"KRN","B",19,19)

"BLD",9220,"KRN","B",19.1,19.1)

"BLD",9220,"KRN","B",101,101)

"BLD",9220,"KRN","B",409.61,409.61)

"BLD",9220,"KRN","B",771,771)

"BLD",9220,"KRN","B",779.2,779.2)

"BLD",9220,"KRN","B",870,870)

"BLD",9220,"KRN","B",8989.51,8989.51)

"BLD",9220,"KRN","B",8989.52,8989.52)

"BLD",9220,"KRN","B",8994,8994)

"BLD",9220,"QDEF")
^^^^^^^^^^YES
"BLD",9220,"QUES",0)
^9.62^^
"BLD",9220,"REQB",0)
^9.611^2^2
"BLD",9220,"REQB",1,0)
IB*2.0*312^2
"BLD",9220,"REQB",2,0)
IB*2.0*349^2
"BLD",9220,"REQB","B","IB*2.0*312",1)

"BLD",9220,"REQB","B","IB*2.0*349",2)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
489^3140224
"PKG",200,22,1,"PAH",1,1,0)
^^5^5^3140224
"PKG",200,22,1,"PAH",1,1,1,0)
This patch addresses two issues. This first issue is about duplicate 
"PKG",200,22,1,"PAH",1,1,2,0)
encounters for the outpatient care added to the Claims Tracking when the
"PKG",200,22,1,"PAH",1,1,3,0)
'REPORTS ADD TO CLAIMS TRACKING' site parameter set to 'YES'. The second 
"PKG",200,22,1,"PAH",1,1,4,0)
issue is the line items which are not listed under the appropriate 
"PKG",200,22,1,"PAH",1,1,5,0)
heading in the [IBJ THIRD PARTY JOINT INQUIRY] option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBCECSA5")
0^2^B62841003^B62746487
"RTN","IBCECSA5",1,0)
IBCECSA5 ;ALB/CXW - VIEW EOB SCREEN ;01-OCT-1999
"RTN","IBCECSA5",2,0)
 ;;2.0;INTEGRATED BILLING;**137,135,263,280,155,349,489**;21-MAR-1994;Build 31
"RTN","IBCECSA5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECSA5",4,0)
 ;
"RTN","IBCECSA5",5,0)
EN ; -- main entry point for VIEW EOB
"RTN","IBCECSA5",6,0)
 N VALMCNT,VALMBG,VALMHDR
"RTN","IBCECSA5",7,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBCECSA5",8,0)
 D EN^VALM("IBCEM VIEW EOB")
"RTN","IBCECSA5",9,0)
 Q
"RTN","IBCECSA5",10,0)
 ;
"RTN","IBCECSA5",11,0)
INIT ; -- init variables and list array
"RTN","IBCECSA5",12,0)
 I '$G(IBIFN) S VALMQUIT="" G INITQ    ; bill# is required
"RTN","IBCECSA5",13,0)
 D HDR^IBCEOB2                         ; build the VALMHDR array
"RTN","IBCECSA5",14,0)
 K IBCNT,IBONE,^TMP("IBCECSD",$J)      ; kill vars and scratch global
"RTN","IBCECSA5",15,0)
 ;
"RTN","IBCECSA5",16,0)
 ; 8/13/03 - If variable IBEOBIFN is set, then this is the 361.1 ien
"RTN","IBCECSA5",17,0)
 ;           that the user selected from a list.  Build the detail.
"RTN","IBCECSA5",18,0)
 I $G(IBEOBIFN) S IBCNT=IBEOBIFN,IBONE=1 D BLD^IBCECSA6 G INITQ
"RTN","IBCECSA5",19,0)
 ;
"RTN","IBCECSA5",20,0)
 D BLD^IBCEOB2   ; build ^TMP("IBCEOB",$J) containing MRA/EOB lister
"RTN","IBCECSA5",21,0)
 S IBONE=0
"RTN","IBCECSA5",22,0)
 M ^TMP("IBCECSD",$J)=^TMP("IBCEOB",$J)
"RTN","IBCECSA5",23,0)
 ;
"RTN","IBCECSA5",24,0)
 ; 4/7/03 - If only 1 EOB record found for this bill, then set the
"RTN","IBCECSA5",25,0)
 ;          IBCNT variable, the IBONE one-time flag, and build the
"RTN","IBCECSA5",26,0)
 ;          detail sections of this list.
"RTN","IBCECSA5",27,0)
 I $G(VALMCNT)=1 S IBCNT=$P($G(^TMP("IBCECSD",$J,1)),U,2),IBONE=1 I IBCNT D BLD^IBCECSA6
"RTN","IBCECSA5",28,0)
 ;
"RTN","IBCECSA5",29,0)
INITQ Q
"RTN","IBCECSA5",30,0)
 ;
"RTN","IBCECSA5",31,0)
HELP ; -- help code
"RTN","IBCECSA5",32,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCECSA5",33,0)
 Q
"RTN","IBCECSA5",34,0)
 ;
"RTN","IBCECSA5",35,0)
EXIT ; -- exit code
"RTN","IBCECSA5",36,0)
 K ^TMP("IBCECSD",$J)
"RTN","IBCECSA5",37,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBCECSA5",38,0)
 Q
"RTN","IBCECSA5",39,0)
MIN ;
"RTN","IBCECSA5",40,0)
 N IBREC1,IBRM1,IBRM2,IBRM3,IBRM4,IBRM5,IBRL,IBTYPE,IBT,IBTX,IBD
"RTN","IBCECSA5",41,0)
 ; flag for inpatient mra
"RTN","IBCECSA5",42,0)
 S IBTYPE=$S($G(IBSRC):1,$$INPAT^IBCEF(+IBREC):1,1:0)
"RTN","IBCECSA5",43,0)
 ;
"RTN","IBCECSA5",44,0)
 S IB=$$SETSTR^VALM1("MEDICARE INFORMATION:","",1,50)
"RTN","IBCECSA5",45,0)
 D SET(IB)
"RTN","IBCECSA5",46,0)
 I '$G(IBSRC) D
"RTN","IBCECSA5",47,0)
 . D CNTRL^VALM10(VALMCNT,1,21,IORVON,IORVOFF)
"RTN","IBCECSA5",48,0)
 . S ^TMP("IBCECSD",$J,"X",5)=VALMCNT
"RTN","IBCECSA5",49,0)
 I $G(IBSRC),'$D(^IBM(361.1,IBCNT,4)) Q
"RTN","IBCECSA5",50,0)
 I '$G(IBSRC),'$$INPAT^IBCEF(+IBREC) Q
"RTN","IBCECSA5",51,0)
 D SET(" INPATIENT:")
"RTN","IBCECSA5",52,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,4)),(IB,IBRL)=""
"RTN","IBCECSA5",53,0)
 ;
"RTN","IBCECSA5",54,0)
 F IBT=2:1 S IBTX=$P($T(MINDAT+IBT),";",3) Q:IBTX=""  D
"RTN","IBCECSA5",55,0)
 . S IBD=$P(IBREC1,"^",+IBTX)
"RTN","IBCECSA5",56,0)
 . I $L($P(IBTX,"^",4)) X $P(IBTX,"^",4) E  N IBFULL S IBFULL=1
"RTN","IBCECSA5",57,0)
 . I $S(IBFULL:1,1:IBD) D
"RTN","IBCECSA5",58,0)
 .. I $L($P(IBTX,"^",4)) X $P(IBTX,"^",4) I  Q
"RTN","IBCECSA5",59,0)
 .. X "S IBD="_$S($L($P(IBTX,"^",3)):$P(IBTX,"^",3),1:"$$A10(IBD)")
"RTN","IBCECSA5",60,0)
 .. S IB=$$SETSTR^VALM1($P(IBTX,"^",2)_IBD,IB,$S('IBRL:4,1:37),$S('IBRL:41,1:38))
"RTN","IBCECSA5",61,0)
 .. S IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA5",62,0)
 .. I 'IBRL D SET(IB,IBRL) S IB=""
"RTN","IBCECSA5",63,0)
 ;
"RTN","IBCECSA5",64,0)
 D:IBRL'="" SET(IB)
"RTN","IBCECSA5",65,0)
 D REMARK
"RTN","IBCECSA5",66,0)
 Q
"RTN","IBCECSA5",67,0)
 ;
"RTN","IBCECSA5",68,0)
MINDAT ; data for MIN tag
"RTN","IBCECSA5",69,0)
 ; format:  piece^label^special format code^special decision for disp
"RTN","IBCECSA5",70,0)
 ;;1^Cov Days/Visit Ct  : ^$$RJ(+IBD)^I $G(IBSRC)
"RTN","IBCECSA5",71,0)
 ;;3^Claim DRG Amt      : 
"RTN","IBCECSA5",72,0)
 ;;2^Lifetm Psych Dy Ct : ^$$RJ(IBD)
"RTN","IBCECSA5",73,0)
 ;;5^Disprop Share Amt  : ^^I IBTYPE
"RTN","IBCECSA5",74,0)
 ;;4^Cap Exception Amt  : 
"RTN","IBCECSA5",75,0)
 ;;7^PPS Capital Amt    : ^^I IBTYPE
"RTN","IBCECSA5",76,0)
 ;;6^MSP Pass Thru Amt  : 
"RTN","IBCECSA5",77,0)
 ;;9^PPS Cap HSP-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",78,0)
 ;;8^PPS Cap FSP-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",79,0)
 ;;11^Old Capital Amt    : ^^I IBTYPE
"RTN","IBCECSA5",80,0)
 ;;10^PPS Cap DSH-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",81,0)
 ;;13^PPS Op Hos DRG Amt : 
"RTN","IBCECSA5",82,0)
 ;;12^PPS Capital IME Amt: ^^I IBTYPE
"RTN","IBCECSA5",83,0)
 ;;15^PPS Op Fed DRG Amt : ^^I IBTYPE
"RTN","IBCECSA5",84,0)
 ;;14^Cost Report Day Ct : ^$$RJ(IBD)^I IBTYPE
"RTN","IBCECSA5",85,0)
 ;;17^Indirect Teach Amt : ^^I IBTYPE
"RTN","IBCECSA5",86,0)
 ;;16^PPS Cap Outlier Amt: ^^I IBTYPE
"RTN","IBCECSA5",87,0)
 ;;18^Non-Pay Prof Comp  : ^$$RJ(IBD)
"RTN","IBCECSA5",88,0)
 ;;19^Non-Covered Days Ct: ^$$RJ(+IBD)^I IBTYPE
"RTN","IBCECSA5",89,0)
 ;;
"RTN","IBCECSA5",90,0)
 ;
"RTN","IBCECSA5",91,0)
REMARK ; set up remarks and line level details
"RTN","IBCECSA5",92,0)
 N IBREC1,IBP,IBT,IBX,RCODE,RDESC,REXIST
"RTN","IBCECSA5",93,0)
 Q:$G(IBREM)  S IBREM=1
"RTN","IBCECSA5",94,0)
 D SET(" ")
"RTN","IBCECSA5",95,0)
 D SET(" Claim Level Remark Information")
"RTN","IBCECSA5",96,0)
 D SET("   Code     Description")
"RTN","IBCECSA5",97,0)
 I '$G(IBSRC) D
"RTN","IBCECSA5",98,0)
 . D CNTRL^VALM10(VALMCNT,4,4,IOUON,IOUOFF)
"RTN","IBCECSA5",99,0)
 . D CNTRL^VALM10(VALMCNT,13,11,IOUON,IOUOFF)
"RTN","IBCECSA5",100,0)
 . Q
"RTN","IBCECSA5",101,0)
 ;
"RTN","IBCECSA5",102,0)
 S IBREC1=$P($G(^IBM(361.1,IBCNT,3)),U,3,7)
"RTN","IBCECSA5",103,0)
 I $P(IBREC1,U,1)="" S IBREC1=$P($G(^IBM(361.1,IBCNT,5)),U,1,5)
"RTN","IBCECSA5",104,0)
 S REXIST=0
"RTN","IBCECSA5",105,0)
 ;
"RTN","IBCECSA5",106,0)
 F IBP=1:1:5 D
"RTN","IBCECSA5",107,0)
 . S RCODE=$P(IBREC1,U,IBP)
"RTN","IBCECSA5",108,0)
 . S RDESC=$G(^IBM(361.1,IBCNT,"RM"_IBP))
"RTN","IBCECSA5",109,0)
 . I RCODE="",RDESC="" Q
"RTN","IBCECSA5",110,0)
 . S REXIST=1
"RTN","IBCECSA5",111,0)
 . K IBT
"RTN","IBCECSA5",112,0)
 . S IBT(IBP)=RDESC
"RTN","IBCECSA5",113,0)
 . D TXT1(.IBT,0,60)
"RTN","IBCECSA5",114,0)
 . D SET("   "_$$LJ^XLFSTR(RCODE,6)_"-  "_$G(IBT(1)))
"RTN","IBCECSA5",115,0)
 . S IBX=1
"RTN","IBCECSA5",116,0)
 . F  S IBX=$O(IBT(IBX)) Q:'IBX  D SET($J("",12)_IBT(IBX))
"RTN","IBCECSA5",117,0)
 . Q
"RTN","IBCECSA5",118,0)
 ;
"RTN","IBCECSA5",119,0)
 I 'REXIST D SET("   No claim level remarks on file")
"RTN","IBCECSA5",120,0)
 D SET(" ")
"RTN","IBCECSA5",121,0)
 Q:$G(IBSRC)  ; MRA Only
"RTN","IBCECSA5",122,0)
 ;
"RTN","IBCECSA5",123,0)
MRALLA S IB=$$SETSTR^VALM1("LINE LEVEL ADJUSTMENTS:","",1,50)
"RTN","IBCECSA5",124,0)
 D SET(IB)
"RTN","IBCECSA5",125,0)
 I '$G(IBSRC) D
"RTN","IBCECSA5",126,0)
 . D CNTRL^VALM10(VALMCNT,1,23,IORVON,IORVOFF)
"RTN","IBCECSA5",127,0)
 . S ^TMP("IBCECSD",$J,"X",7)=VALMCNT
"RTN","IBCECSA5",128,0)
 I '$D(^IBM(361.1,IBCNT,15,0)) D SET("NONE") Q  ; only if there is info
"RTN","IBCECSA5",129,0)
 ;
"RTN","IBCECSA5",130,0)
 ; look up all billed data
"RTN","IBCECSA5",131,0)
 N IBZDATA,IBFORM,IBX2,IBX3,IBREC2,IBREC3,IBTX,IBT,IBRC,IBZ,IBTXL
"RTN","IBCECSA5",132,0)
 S IBFORM=0                             ; cms-1500
"RTN","IBCECSA5",133,0)
 I $$FT^IBCEF(+IBREC)=3 S IBFORM=1      ; UB-04
"RTN","IBCECSA5",134,0)
 D F^IBCEF("N-"_$S(IBFORM:"UB-04",1:"HCFA 1500")_" SERVICE LINE (EDI)","IBZDATA",,+IBREC)
"RTN","IBCECSA5",135,0)
 ;
"RTN","IBCECSA5",136,0)
 S IBX=0 F  S IBX=$O(^IBM(361.1,IBCNT,15,IBX)) Q:IBX<1  S IBREC1=^IBM(361.1,IBCNT,15,IBX,0) D
"RTN","IBCECSA5",137,0)
 . NEW RVL
"RTN","IBCECSA5",138,0)
 . D SET("  #   SV DT   REVCD  PROC  MOD  UNITS  BILLED  DEDUCT  COINS    ALLOW     PYMT")
"RTN","IBCECSA5",139,0)
 . S RVL=+$P(IBREC1,U,12)       ; referenced Vista line#
"RTN","IBCECSA5",140,0)
 . I 'RVL S RVL=IBX             ; use the EOB line# if not there
"RTN","IBCECSA5",141,0)
 . S IBT=$$RJ($P(IBREC1,"^"),3) ;             line number
"RTN","IBCECSA5",142,0)
 . S IBT=IBT_" "_$$RJ($$DAT1^IBOUTL($P($P(IBREC1,"^",16),".")),8) ; service date
"RTN","IBCECSA5",143,0)
 . S IBT=IBT_" "_$$RJ($$EXTERNAL^DILFD(361.115,.1,"",$P(IBREC1,"^",10)),6) ;                                                revcd
"RTN","IBCECSA5",144,0)
 . S IBT=IBT_" "_$$RJ($P(IBREC1,"^",4),5) ;   procedure
"RTN","IBCECSA5",145,0)
 . S IBT=IBT_" "_$$RJ($P($G(^IBM(361.1,IBCNT,15,IBX,2,1,0)),"^"),3)_$S($D(^IBM(361.1,IBCNT,15,IBX,2,2,0)):"+",1:" ") ;      modifiers
"RTN","IBCECSA5",146,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",11),"",0),5) ; units
"RTN","IBCECSA5",147,0)
 . S IBT=IBT_" "_$$RJ($FN($S(IBFORM:$P($G(IBZDATA(RVL)),"^",5),1:$P($G(IBZDATA(RVL)),"^",8)*$P($G(IBZDATA(RVL)),"^",9)),"",2),8) ;    billed
"RTN","IBCECSA5",148,0)
 . S IBT=IBT_" "_$$RJ($FN($P($G(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,+$O(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,"B",1,0)),0)),"^",2),"",2),7) ;  deduct
"RTN","IBCECSA5",149,0)
 . S IBT=IBT_" "_$$RJ($FN($P($G(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,+$O(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,"B",2,0)),0)),"^",2),"",2),6) ;   coins
"RTN","IBCECSA5",150,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",13),"",2),8) ; allow
"RTN","IBCECSA5",151,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",3),"",2),8) ;  payment
"RTN","IBCECSA5",152,0)
 . D SET(IBT)
"RTN","IBCECSA5",153,0)
 . S IBX2=0 F  S IBX2=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2)) Q:IBX2<1  D
"RTN","IBCECSA5",154,0)
 .. S IBREC2=^IBM(361.1,IBCNT,15,IBX,1,IBX2,0),IBX3=0
"RTN","IBCECSA5",155,0)
 .. F  S IBX3=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2,1,IBX3)) Q:IBX3<1  D
"RTN","IBCECSA5",156,0)
 ... S IBREC3=^IBM(361.1,IBCNT,15,IBX,1,IBX2,1,IBX3,0)
"RTN","IBCECSA5",157,0)
 ... ; line level adjustments; don't display kludges (esg 10/23/03)
"RTN","IBCECSA5",158,0)
 ... I $P(IBREC2,U,1)="PR",$P(IBREC3,U,1)="AAA" Q
"RTN","IBCECSA5",159,0)
 ... I $P(IBREC2,U,1)="OA",$P(IBREC3,U,1)="AB3" Q
"RTN","IBCECSA5",160,0)
 ... I $P(IBREC2,U,1)="LQ" Q
"RTN","IBCECSA5",161,0)
 ... S IBTX(1)="ADJ: "_$P(IBREC2,"^")_"  "_$P(IBREC3,"^")_"  "_$P(IBREC3,"^",4) D TXT1(.IBTX,0,79) S IBT=0 F  S IBT=$O(IBTX(IBT)) Q:IBT<1  D SET(IBTX(IBT))
"RTN","IBCECSA5",162,0)
 ... K IBTX
"RTN","IBCECSA5",163,0)
 ... D SET("ADJ AMT: "_$FN($P(IBREC3,"^",2),"",2))
"RTN","IBCECSA5",164,0)
 . S IBRC=0
"RTN","IBCECSA5",165,0)
 . F  S IBRC=$O(^IBM(361.1,IBCNT,15,IBX,4,IBRC)) Q:'IBRC  S IBREC2=$G(^(IBRC,0)) I IBREC2 K IBTX,IBZ S IBTX(1)="  -REMARK CODE("_+IBREC2_"): ",IBTXL=$L(IBTX(1)) D
"RTN","IBCECSA5",166,0)
 .. S IBTX(1)=IBTX(1)_$P(IBREC2,U,2)_"  "_$P(IBREC2,U,3)
"RTN","IBCECSA5",167,0)
 .. I $L(IBTX(1))>79 D
"RTN","IBCECSA5",168,0)
 ... D TXT1(.IBTX,0,79) D SET(IBTX(1)) M IBZ=IBTX K IBTX S IBTX(1)="",IBT=1 F  S IBT=$O(IBZ(IBT)) Q:'IBT  S IBTX(1)=IBTX(1)_IBZ(IBT)_" "
"RTN","IBCECSA5",169,0)
 .. E  D
"RTN","IBCECSA5",170,0)
 ... S IBTXL=0
"RTN","IBCECSA5",171,0)
 .. D TXT1(.IBTX,IBTXL,79) S IBT=0 F  S IBT=$O(IBTX(IBT)) Q:IBT<1  D SET(IBTX(IBT))
"RTN","IBCECSA5",172,0)
 . D SET(" ")
"RTN","IBCECSA5",173,0)
 D SET(" ")
"RTN","IBCECSA5",174,0)
 Q
"RTN","IBCECSA5",175,0)
 ;
"RTN","IBCECSA5",176,0)
TXT(IBRM,IBLN,IBXY) ;display text over 79 chars
"RTN","IBCECSA5",177,0)
 ;IBRM - text, IBLN - length, IBXY - position
"RTN","IBCECSA5",178,0)
 S IBRM=$E(IBRM,IBLN+1,999)
"RTN","IBCECSA5",179,0)
REP I $E(IBRM,1,IBLN)'="" S IB=$$SETSTR^VALM1($E(IBRM,1,IBLN),"",IBXY,IBLN) D SET(IB) S IBRM=$E(IBRM,IBLN+1,999) G REP
"RTN","IBCECSA5",180,0)
 Q
"RTN","IBCECSA5",181,0)
 ;
"RTN","IBCECSA5",182,0)
SET(IB,IBSAV) ;
"RTN","IBCECSA5",183,0)
 I '$G(IBSAV) D SET^IBCECSA6($G(IBSRC),IB,CNT,IBCNT)
"RTN","IBCECSA5",184,0)
 Q
"RTN","IBCECSA5",185,0)
 ;
"RTN","IBCECSA5",186,0)
A10(X) ;
"RTN","IBCECSA5",187,0)
 Q $$A10^IBCECSA6(X)
"RTN","IBCECSA5",188,0)
 ;
"RTN","IBCECSA5",189,0)
A7(X) ; returns a dollar amount right justified to 7 characters
"RTN","IBCECSA5",190,0)
 Q $$RJ($FN(X,"",2),7)
"RTN","IBCECSA5",191,0)
 ;
"RTN","IBCECSA5",192,0)
TXT1(IBT,DIWL,DIWR) ; sets up text for over 79 chars
"RTN","IBCECSA5",193,0)
 ; IBT - pass by ref, array of text to be formatted back in array
"RTN","IBCECSA5",194,0)
 ; DIWL - left margin, DIWR = right margin
"RTN","IBCECSA5",195,0)
 N IBX,X,DIWF,IBS K ^UTILITY($J,"W")
"RTN","IBCECSA5",196,0)
 S DIWF="|I"_DIWL
"RTN","IBCECSA5",197,0)
 S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  S X=IBT(IBX) D ^DIWP
"RTN","IBCECSA5",198,0)
 K IBT F  S IBX=$O(^UTILITY($J,"W",DIWL,IBX)) Q:IBX<1  S IBT(IBX)=^UTILITY($J,"W",DIWL,IBX,0)
"RTN","IBCECSA5",199,0)
 K ^UTILITY($J,"W")
"RTN","IBCECSA5",200,0)
 Q
"RTN","IBCECSA5",201,0)
 ;
"RTN","IBCECSA5",202,0)
RJ(X,Y) ; right just, default is 10
"RTN","IBCECSA5",203,0)
 Q $$RJ^XLFSTR(X,$G(Y,10)," ")
"RTN","IBCECSA5",204,0)
 ;
"RTN","IBTRKR4")
0^1^B17535096^B13921705
"RTN","IBTRKR4",1,0)
IBTRKR4 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK OUTPATIENT ENCOUNTERS ; 13-AUG-93
"RTN","IBTRKR4",2,0)
 ;;2.0;INTEGRATED BILLING;**91,142,292,312,489**;21-MAR-94;Build 31
"RTN","IBTRKR4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBTRKR4",4,0)
 ;
"RTN","IBTRKR4",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR4",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR4",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,$S($E(DT,6,7)=10:-730,1:-20))-.1
"RTN","IBTRKR4",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-2)-.9
"RTN","IBTRKR4",9,0)
 D EN1
"RTN","IBTRKR4",10,0)
 Q
"RTN","IBTRKR4",11,0)
 ;
"RTN","IBTRKR4",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR4",13,0)
 N IBSWINFO S IBSWINFO=$$SWSTAT^IBBAPI()                     ;IB*2.0*312
"RTN","IBTRKR4",14,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK
"RTN","IBTRKR4",15,0)
 S IBTALK=1
"RTN","IBTRKR4",16,0)
 I '$P($G(^IBE(350.9,1,6)),"^",3) W !!,"I'm sorry, Tracking of Outpatient Encounters is currently turned off." G ENQ
"RTN","IBTRKR4",17,0)
 W !!!,"Select the Date Range of Opt. Encounters to Add to Claims Tracking.",!
"RTN","IBTRKR4",18,0)
 D DATE^IBOUTL
"RTN","IBTRKR4",19,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR4",20,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR4",21,0)
 ; Do NOT PROCESS on VistA if Start or End>=Switch Eff Dt    ;CCR-930
"RTN","IBTRKR4",22,0)
 ; -- check selected dates                                   ;IB*2.0*312
"RTN","IBTRKR4",23,0)
 I +IBSWINFO,((IBTSBDT+1)>$P(IBSWINFO,"^",2))!((IBTSEDT+1)>$P(IBSWINFO,"^",2)) D  G EN
"RTN","IBTRKR4",24,0)
   .W !!,"The Begin OR End Date CANNOT be on or after"
"RTN","IBTRKR4",25,0)
   .W !,"the PFSS Effective Date: ",$$FMTE^XLFDT($P(IBSWINFO,"^",2))
"RTN","IBTRKR4",26,0)
 ;
"RTN","IBTRKR4",27,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR4",28,0)
 ; start date can't be before parameters
"RTN","IBTRKR4",29,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR4",30,0)
 ; -- end date into future
"RTN","IBTRKR4",31,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-1) W !!,"I'll automatically change the end date to 1 day prior to the date queued to run."
"RTN","IBTRKR4",32,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR4",33,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR4",34,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR4",ZTSAVE("IB*")="",ZTDESC="IB - Add Opt Encounters to Claims Tracking"
"RTN","IBTRKR4",35,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR4",36,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR4",37,0)
 D HOME^%ZIS
"RTN","IBTRKR4",38,0)
 Q
"RTN","IBTRKR4",39,0)
 ;
"RTN","IBTRKR4",40,0)
EN1 ; -- add outpatient encounters to claims tracking file
"RTN","IBTRKR4",41,0)
 L +^IBTRKR4:$S($G(DILOCKTM)>600:DILOCKTM,1:600) I '$T G FLKMG
"RTN","IBTRKR4",42,0)
 N I,J,X,Y,IBTRKR,IBDT,DFN,IBOETA,IBCNT,IBCNT1,IBCNT2
"RTN","IBTRKR4",43,0)
 ;
"RTN","IBTRKR4",44,0)
 ; -- check parameters
"RTN","IBTRKR4",45,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR4",46,0)
 G:'$P(IBTRKR,"^",3) EN1Q ; quit if opt tracking off
"RTN","IBTRKR4",47,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR4",48,0)
 ;
"RTN","IBTRKR4",49,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR4",50,0)
 ;I IBTSEDT>DT S IBTSEDT=DT
"RTN","IBTRKR4",51,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-1) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-1))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-1)
"RTN","IBTRKR4",52,0)
 ;
"RTN","IBTRKR4",53,0)
 S IBOETYP=$O(^IBE(356.6,"AC",2,0)) ;event type pointer for opt encounters
"RTN","IBTRKR4",54,0)
 ;
"RTN","IBTRKR4",55,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR4",56,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR4",57,0)
 ;
"RTN","IBTRKR4",58,0)
 N IBVAL,IBCBK,IBFILTER
"RTN","IBTRKR4",59,0)
 S IBVAL("BDT")=IBTSBDT,IBVAL("EDT")=IBTSEDT+.9
"RTN","IBTRKR4",60,0)
 ; Only parent encounters, status is checked out, check out date exists,
"RTN","IBTRKR4",61,0)
 ;   not already in CT, not already an entry for the same encounter
"RTN","IBTRKR4",62,0)
 S IBFILTER=""
"RTN","IBTRKR4",63,0)
 ;S IBCBK="S IBCNT=IBCNT+1 I '$P(Y0,U,6),$P(Y0,U,12)=2,$P(Y0,U,7),'$O(^IBT(356,""AENC"",+$P(Y0,U,2),Y,0)),'$O(^IBT(356,""APTY"",+$P(Y0,U,2),IBOETYP,+Y0,0)) S IBDT=+Y0,IBOE=Y D OPCHK^IBTRKR41"
"RTN","IBTRKR4",64,0)
 S IBCBK="S IBCNT=IBCNT+1 I '$P(Y0,U,6),$P(Y0,U,12)=2,$P(Y0,U,7),'$O(^IBT(356,""AENC"",+$P(Y0,U,2),Y,0)),$S($D(^IBE(356.6,""ACODE"",2,IBOETYP)):1,1:'$O(^IBT(356,""APTY"",+$P(Y0,U,2),IBOETYP,+Y0,0))) S IBDT=+Y0,IBOE=Y D OPCHK^IBTRKR41"
"RTN","IBTRKR4",65,0)
 D SCAN^IBSDU("DATE/TIME",.IBVAL,IBFILTER,IBCBK,1) ;Scan,then close query
"RTN","IBTRKR4",66,0)
MSG ;
"RTN","IBTRKR4",67,0)
 I $G(IBTALK) D BULL^IBTRKR41
"RTN","IBTRKR4",68,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR4",69,0)
 L -^IBTRKR4
"RTN","IBTRKR4",70,0)
 Q
"RTN","IBTRKR4",71,0)
 ;
"RTN","IBTRKR4",72,0)
FLKMG ; send a message for interaction if lock failed
"RTN","IBTRKR4",73,0)
 I '$G(IBTALK) G FLKMGQ
"RTN","IBTRKR4",74,0)
 S XMSUB="Outpatient Encounters added to Claims Tracking Complete"
"RTN","IBTRKR4",75,0)
 S IBT(1)="The process to automatically add Opt Encounters is currently locked by another user. Try again later."
"RTN","IBTRKR4",76,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBTRKR4",77,0)
 K XMY S XMN=0
"RTN","IBTRKR4",78,0)
 S XMY(DUZ)=""
"RTN","IBTRKR4",79,0)
 D ^XMD
"RTN","IBTRKR4",80,0)
 K X,Y,IBI,IBT,IBGRP,XMDUZ,XMTEXT,XMY,XMSUB
"RTN","IBTRKR4",81,0)
FLKMGQ I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR4",82,0)
 Q
"RTN","IBTRKR4",83,0)
 ;
"VER")
8.0^22.0
"BLD",9220,6)
^476
**END**
**END**

