Released MBAA*1*1 SEQ #1
Extracted from mail message
**KIDS**:MBAA*1.0*1^

**INSTALL NAME**
MBAA*1.0*1
"BLD",9755,0)
MBAA*1.0*1^MOBILE SCHEDULING APPLICATIONS^0^3160825^y
"BLD",9755,1,0)
^^1^1^3141020^
"BLD",9755,1,1,0)
Scheduling Calendar View initial build.
"BLD",9755,4,0)
^9.64PA^^
"BLD",9755,6)
21^
"BLD",9755,6.3)
85
"BLD",9755,"INID")
^n
"BLD",9755,"INIT")

"BLD",9755,"KRN",0)
^9.67PA^779.2^20
"BLD",9755,"KRN",.4,0)
.4
"BLD",9755,"KRN",.401,0)
.401
"BLD",9755,"KRN",.402,0)
.402
"BLD",9755,"KRN",.403,0)
.403
"BLD",9755,"KRN",.5,0)
.5
"BLD",9755,"KRN",.84,0)
.84
"BLD",9755,"KRN",3.6,0)
3.6
"BLD",9755,"KRN",3.8,0)
3.8
"BLD",9755,"KRN",9.2,0)
9.2
"BLD",9755,"KRN",9.8,0)
9.8
"BLD",9755,"KRN",9.8,"NM",0)
^9.68A^24^23
"BLD",9755,"KRN",9.8,"NM",1,0)
MBAAAPI1^^0^B12399401
"BLD",9755,"KRN",9.8,"NM",2,0)
MBAAAPIE^^0^B22483643
"BLD",9755,"KRN",9.8,"NM",3,0)
MBAADAL1^^0^B585387
"BLD",9755,"KRN",9.8,"NM",4,0)
MBAAMAP1^^0^B37295947
"BLD",9755,"KRN",9.8,"NM",5,0)
MBAAMAP2^^0^B71740579
"BLD",9755,"KRN",9.8,"NM",6,0)
MBAAMAP3^^0^B15125035
"BLD",9755,"KRN",9.8,"NM",7,0)
MBAAMAP4^^0^B15516986
"BLD",9755,"KRN",9.8,"NM",8,0)
MBAAMAPI^^0^B1705181
"BLD",9755,"KRN",9.8,"NM",9,0)
MBAAMDA1^^0^B66171145
"BLD",9755,"KRN",9.8,"NM",10,0)
MBAAMDA2^^0^B17922124
"BLD",9755,"KRN",9.8,"NM",11,0)
MBAAMDA3^^0^B10404049
"BLD",9755,"KRN",9.8,"NM",12,0)
MBAAMDA4^^0^B4043284
"BLD",9755,"KRN",9.8,"NM",13,0)
MBAAMDAL^^0^B8935806
"BLD",9755,"KRN",9.8,"NM",14,0)
MBAAMRP1^^0^B3062007
"BLD",9755,"KRN",9.8,"NM",15,0)
MBAAMRP2^^0^B2288454
"BLD",9755,"KRN",9.8,"NM",16,0)
MBAAMRPC^^0^B230431
"BLD",9755,"KRN",9.8,"NM",18,0)
MBAARPC1^^0^B58612031
"BLD",9755,"KRN",9.8,"NM",19,0)
MBAARPC2^^0^B78656995
"BLD",9755,"KRN",9.8,"NM",20,0)
MBAARPC3^^0^B3456217
"BLD",9755,"KRN",9.8,"NM",21,0)
MBAARPCL^^0^B175476210
"BLD",9755,"KRN",9.8,"NM",22,0)
MBAAWLAP^^0^B8952366
"BLD",9755,"KRN",9.8,"NM",23,0)
MBAALEXT^^0^B454239
"BLD",9755,"KRN",9.8,"NM",24,0)
MBAAWLDA^^0^B38800212
"BLD",9755,"KRN",9.8,"NM","B","MBAAAPI1",1)

"BLD",9755,"KRN",9.8,"NM","B","MBAAAPIE",2)

"BLD",9755,"KRN",9.8,"NM","B","MBAADAL1",3)

"BLD",9755,"KRN",9.8,"NM","B","MBAALEXT",23)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMAP1",4)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMAP2",5)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMAP3",6)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMAP4",7)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMAPI",8)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMDA1",9)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMDA2",10)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMDA3",11)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMDA4",12)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMDAL",13)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMRP1",14)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMRP2",15)

"BLD",9755,"KRN",9.8,"NM","B","MBAAMRPC",16)

"BLD",9755,"KRN",9.8,"NM","B","MBAARPC1",18)

"BLD",9755,"KRN",9.8,"NM","B","MBAARPC2",19)

"BLD",9755,"KRN",9.8,"NM","B","MBAARPC3",20)

"BLD",9755,"KRN",9.8,"NM","B","MBAARPCL",21)

"BLD",9755,"KRN",9.8,"NM","B","MBAAWLAP",22)

"BLD",9755,"KRN",9.8,"NM","B","MBAAWLDA",24)

"BLD",9755,"KRN",19,0)
19
"BLD",9755,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",9755,"KRN",19,"NM",1,0)
MBAA SCHEDULING CALENDAR VIEW^^0^
"BLD",9755,"KRN",19,"NM","B","MBAA SCHEDULING CALENDAR VIEW",1)

"BLD",9755,"KRN",19.1,0)
19.1
"BLD",9755,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9755,"KRN",101,0)
101
"BLD",9755,"KRN",409.61,0)
409.61
"BLD",9755,"KRN",771,0)
771
"BLD",9755,"KRN",779.2,0)
779.2
"BLD",9755,"KRN",870,0)
870
"BLD",9755,"KRN",8989.51,0)
8989.51
"BLD",9755,"KRN",8989.52,0)
8989.52
"BLD",9755,"KRN",8994,0)
8994
"BLD",9755,"KRN",8994,"NM",0)
^9.68A^31^12
"BLD",9755,"KRN",8994,"NM",2,0)
MBAA APPOINTMENT MAKE^^0
"BLD",9755,"KRN",8994,"NM",3,0)
MBAA CANCEL APPOINTMENT^^0
"BLD",9755,"KRN",8994,"NM",10,0)
MBAA PATIENT PENDING APPT^^0
"BLD",9755,"KRN",8994,"NM",19,0)
MBAA GET CLINIC AVAILABILITY^^0
"BLD",9755,"KRN",8994,"NM",20,0)
MBAA LIST CANCELLATION REASONS^^0
"BLD",9755,"KRN",8994,"NM",21,0)
MBAA VERIFY CLINIC ACCESS^^0
"BLD",9755,"KRN",8994,"NM",22,0)
MBAA APPOINTMENT LIST BY NAME^^0
"BLD",9755,"KRN",8994,"NM",27,0)
MBAA PROVIDERS BY CLINIC^^0
"BLD",9755,"KRN",8994,"NM",28,0)
MBAA REMOVE FROM EWL^^0
"BLD",9755,"KRN",8994,"NM",29,0)
MBAA WAIT LIST BY DFN^^0
"BLD",9755,"KRN",8994,"NM",30,0)
MBAA FACILITY WAIT LIST^^0
"BLD",9755,"KRN",8994,"NM",31,0)
MBAA GET CLINIC DETAILS^^0
"BLD",9755,"KRN",8994,"NM","B","MBAA APPOINTMENT LIST BY NAME",22)

"BLD",9755,"KRN",8994,"NM","B","MBAA APPOINTMENT MAKE",2)

"BLD",9755,"KRN",8994,"NM","B","MBAA CANCEL APPOINTMENT",3)

"BLD",9755,"KRN",8994,"NM","B","MBAA FACILITY WAIT LIST",30)

"BLD",9755,"KRN",8994,"NM","B","MBAA GET CLINIC AVAILABILITY",19)

"BLD",9755,"KRN",8994,"NM","B","MBAA GET CLINIC DETAILS",31)

"BLD",9755,"KRN",8994,"NM","B","MBAA LIST CANCELLATION REASONS",20)

"BLD",9755,"KRN",8994,"NM","B","MBAA PATIENT PENDING APPT",10)

"BLD",9755,"KRN",8994,"NM","B","MBAA PROVIDERS BY CLINIC",27)

"BLD",9755,"KRN",8994,"NM","B","MBAA REMOVE FROM EWL",28)

"BLD",9755,"KRN",8994,"NM","B","MBAA VERIFY CLINIC ACCESS",21)

"BLD",9755,"KRN",8994,"NM","B","MBAA WAIT LIST BY DFN",29)

"BLD",9755,"KRN","B",.4,.4)

"BLD",9755,"KRN","B",.401,.401)

"BLD",9755,"KRN","B",.402,.402)

"BLD",9755,"KRN","B",.403,.403)

"BLD",9755,"KRN","B",.5,.5)

"BLD",9755,"KRN","B",.84,.84)

"BLD",9755,"KRN","B",3.6,3.6)

"BLD",9755,"KRN","B",3.8,3.8)

"BLD",9755,"KRN","B",9.2,9.2)

"BLD",9755,"KRN","B",9.8,9.8)

"BLD",9755,"KRN","B",19,19)

"BLD",9755,"KRN","B",19.1,19.1)

"BLD",9755,"KRN","B",101,101)

"BLD",9755,"KRN","B",409.61,409.61)

"BLD",9755,"KRN","B",771,771)

"BLD",9755,"KRN","B",779.2,779.2)

"BLD",9755,"KRN","B",870,870)

"BLD",9755,"KRN","B",8989.51,8989.51)

"BLD",9755,"KRN","B",8989.52,8989.52)

"BLD",9755,"KRN","B",8994,8994)

"BLD",9755,"QUES",0)
^9.62^^
"BLD",9755,"REQB",0)
^9.611^^
"KRN",19,2921683,-1)
0^1
"KRN",19,2921683,0)
MBAA SCHEDULING CALENDAR VIEW^MBAA SCHEDULING CALENDAR VIEW^^B^^^^^^^^
"KRN",19,2921683,1,0)
^19.06^2^2^3150623^^
"KRN",19,2921683,1,1,0)
This option is required by the Kernel Broker to give access to the RPCs 
"KRN",19,2921683,1,2,0)
used by the MBAA Scheduling Calendar View Mobile App.
"KRN",19,2921683,99.1)
64093,47256
"KRN",19,2921683,"RPC",0)
^19.05P^21^20
"KRN",19,2921683,"RPC",1,0)
MBAA APPOINTMENT MAKE
"KRN",19,2921683,"RPC",2,0)
MBAA CANCEL APPOINTMENT
"KRN",19,2921683,"RPC",4,0)
MBAA FACILITY WAIT LIST
"KRN",19,2921683,"RPC",7,0)
MBAA PATIENT PENDING APPT
"KRN",19,2921683,"RPC",10,0)
MBAA REMOVE FROM EWL
"KRN",19,2921683,"RPC",13,0)
MBAA WAIT LIST BY DFN
"KRN",19,2921683,"RPC",14,0)
MBAA APPOINTMENT LIST BY NAME
"KRN",19,2921683,"RPC",15,0)
MBAA GET CLINIC AVAILABILITY
"KRN",19,2921683,"RPC",16,0)
MBAA LIST CANCELLATION REASONS
"KRN",19,2921683,"RPC",17,0)
MBAA VERIFY CLINIC ACCESS
"KRN",19,2921683,"RPC",19,0)
MBAA PROVIDERS BY CLINIC
"KRN",19,2921683,"RPC",21,0)
MBAA GET CLINIC DETAILS
"KRN",19,2921683,"U")
MBAA SCHEDULING CALENDAR VIEW
"KRN",8994,3583,-1)
0^22
"KRN",8994,3583,0)
MBAA APPOINTMENT LIST BY NAME^LSTAPPT^MBAAMRP2^2^S^^^^1^^1
"KRN",8994,3583,1,0)
^8994.01^2^2^3140522^^^
"KRN",8994,3583,1,1,0)
Returns a list of appointment types based on the input parameters from 
"KRN",8994,3583,1,2,0)
the Appointment Types file (#409.1).
"KRN",8994,3583,2,0)
^8994.02A^3^3
"KRN",8994,3583,2,1,0)
SEARCH^1^200^0^1
"KRN",8994,3583,2,1,1,0)
^8994.021^2^2^3140522^^
"KRN",8994,3583,2,1,1,1,0)
The partial match restrictions used for the search. This parameter limits 
"KRN",8994,3583,2,1,1,2,0)
the search to those entries that match the partial match restrictions. 
"KRN",8994,3583,2,2,0)
START^1^200^0^2
"KRN",8994,3583,2,2,1,0)
^8994.021^2^2^3140522^^
"KRN",8994,3583,2,2,1,1,0)
The index entry(s) from which to begin the list. For example, a value of 
"KRN",8994,3583,2,2,1,2,0)
"XQ" would result in a list that starts with the first entry after "XQ".
"KRN",8994,3583,2,3,0)
NUMBER^1^200^0^3
"KRN",8994,3583,2,3,1,0)
^8994.021^1^1^3140522^^^
"KRN",8994,3583,2,3,1,1,0)
This is the number of entries to return.
"KRN",8994,3583,2,"B","NUMBER",3)

"KRN",8994,3583,2,"B","SEARCH",1)

"KRN",8994,3583,2,"B","START",2)

"KRN",8994,3583,2,"PARAMSEQ",1,1)

"KRN",8994,3583,2,"PARAMSEQ",2,2)

"KRN",8994,3583,2,"PARAMSEQ",3,3)

"KRN",8994,3583,3,0)
^8994.03^10^10^3140522^^^
"KRN",8994,3583,3,1,0)
Returns an array with the subscripts below:
"KRN",8994,3583,3,2,0)
ARRAY(0)=The number of entries found^the number of entries requested^any 
"KRN",8994,3583,3,3,0)
more flag?^results flags (any more flag? is zero if there aren't any more 
"KRN",8994,3583,3,4,0)
entries, if there are more entries than returned, this is set to one.)
"KRN",8994,3583,3,5,0)
ARRAY(RECORD NUMBER)="" - This is a separator between records, this node 
"KRN",8994,3583,3,6,0)
is always null.
"KRN",8994,3583,3,7,0)
ARRAY(RECORD NUMBER,"ID")=IEN of the entry on the "NAME" node below.
"KRN",8994,3583,3,8,0)
ARRAY(RECORD NUMBER,"NAME")=Text Name of the entry.
"KRN",8994,3583,3,9,0)
 
"KRN",8994,3583,3,10,0)
RECORD NUMBER increments by one for each additional record.
"KRN",8994,3584,-1)
0^19
"KRN",8994,3584,0)
MBAA GET CLINIC AVAILABILITY^SLOTS^MBAAMRP1^2^S^^^^1^^1
"KRN",8994,3584,1,0)
^^1^1^3140325^
"KRN",8994,3584,1,1,0)
Returns the available slots for a clinic.
"KRN",8994,3584,2,0)
^8994.02A^1^1
"KRN",8994,3584,2,1,0)
CLINIC^1^200^1^1
"KRN",8994,3584,2,1,1,0)
^^1^1^3140325^
"KRN",8994,3584,2,1,1,1,0)
The Clinic ID/IEN from the Hospital Location file (#44) for the Clinic.
"KRN",8994,3584,2,"B","CLINIC",1)

"KRN",8994,3584,2,"PARAMSEQ",1,1)

"KRN",8994,3584,3,0)
^^1^1^3140325^
"KRN",8994,3584,3,1,0)
Returns an array with the Clinics Appointment Schedule.
"KRN",8994,3585,-1)
0^21
"KRN",8994,3585,0)
MBAA VERIFY CLINIC ACCESS^CLNRGHT^MBAAMRP1^2^S^^^^1^^1
"KRN",8994,3585,1,0)
^8994.01^1^1^3140325^^
"KRN",8994,3585,1,1,0)
Checks to see if the logon user has access to a clinic.
"KRN",8994,3585,2,0)
^8994.02A^1^1
"KRN",8994,3585,2,1,0)
CLN^1^200^1^1
"KRN",8994,3585,2,1,1,0)
^8994.021^1^1^3140325^^^
"KRN",8994,3585,2,1,1,1,0)
CLINIC IFN
"KRN",8994,3585,2,"B","CLN",1)

"KRN",8994,3585,2,"PARAMSEQ",1,1)

"KRN",8994,3585,3,0)
^^2^2^3140325^
"KRN",8994,3585,3,1,0)
Returns NULL if the user has access, otherwise returns 1 if the user 
"KRN",8994,3585,3,2,0)
doesn't have access to the clinic.
"KRN",8994,3586,-1)
0^20
"KRN",8994,3586,0)
MBAA LIST CANCELLATION REASONS^LSTCRSNS^MBAAMRP1^2^S^^^^1^^1
"KRN",8994,3586,1,0)
^8994.01^2^2^3140623^^
"KRN",8994,3586,1,1,0)
Returns the list of cancellation reasons from the CANCELLATION REASONS 
"KRN",8994,3586,1,2,0)
file ($409.2).
"KRN",8994,3586,2,0)
^8994.02A^3^3
"KRN",8994,3586,2,1,0)
SEARCH^1^200^0^1
"KRN",8994,3586,2,1,1,0)
^^8^8^3140623^
"KRN",8994,3586,2,1,1,1,0)
Partial match restriction. For example, a Search value of "AB" would 
"KRN",8994,3586,2,1,1,2,0)
restrict the list to just those entries that start with the letters "AB".
"KRN",8994,3586,2,1,1,3,0)
 
"KRN",8994,3586,2,1,1,4,0)
This parameter is required UNLESS the NUMBER parameter is provided. If 
"KRN",8994,3586,2,1,1,5,0)
the NUMBER parameter is > 0, this parameter is not required. 
"KRN",8994,3586,2,1,1,6,0)
 
"KRN",8994,3586,2,1,1,7,0)
If the user wants to list all Cancellation Reasons, let the Search 
"KRN",8994,3586,2,1,1,8,0)
parameter null and set the Number parameter to high value.
"KRN",8994,3586,2,2,0)
START^1^200^0^2
"KRN",8994,3586,2,2,1,0)
^^2^2^3140623^
"KRN",8994,3586,2,2,1,1,0)
The entry point to start searching from. If this value is set to "M", the 
"KRN",8994,3586,2,2,1,2,0)
search would start with any entries starting with the letter "M".
"KRN",8994,3586,2,3,0)
NUMBER^1^200^1^3
"KRN",8994,3586,2,3,1,0)
^8994.021^2^2^3140623^^
"KRN",8994,3586,2,3,1,1,0)
The maximum number of records to return. If this parameter is null, then 
"KRN",8994,3586,2,3,1,2,0)
the SEARCH parameter must be defined. 
"KRN",8994,3586,2,"B","NUMBER",3)

"KRN",8994,3586,2,"B","SEARCH",1)

"KRN",8994,3586,2,"B","START",2)

"KRN",8994,3586,2,"PARAMSEQ",1,1)

"KRN",8994,3586,2,"PARAMSEQ",2,2)

"KRN",8994,3586,2,"PARAMSEQ",3,3)

"KRN",8994,3586,3,0)
^8994.03^8^8^3140623^^^^
"KRN",8994,3586,3,1,0)
Returns an array where each node of the array has the IEN of the 
"KRN",8994,3586,3,2,0)
cancellation reason in CANCELLATION REASON file (#409.2) and the free 
"KRN",8994,3586,3,3,0)
text name for the cancellation reason separated by the carat "^".
"KRN",8994,3586,3,4,0)
 
"KRN",8994,3586,3,5,0)
Example:
"KRN",8994,3586,3,6,0)
ARRAY(1)=1^WEATHER
"KRN",8994,3586,3,7,0)
ARRAY(2)=2^INPATIENT STATUS
"KRN",8994,3586,3,8,0)
ARRAY(3)=3^PATIENT DEATH
"KRN",8994,3587,-1)
0^2
"KRN",8994,3587,0)
MBAA APPOINTMENT MAKE^MAKE^MBAAMRP2^2^S^^^^1^^1
"KRN",8994,3587,2,0)
^8994.02A^16^16
"KRN",8994,3587,2,1,0)
DFN^1^200^1^1
"KRN",8994,3587,2,2,0)
CLINIC^1^200^1^2
"KRN",8994,3587,2,2,1,0)
^^1^1^3120718^
"KRN",8994,3587,2,2,1,1,0)
CLINIC IEN
"KRN",8994,3587,2,3,0)
APPDATE^1^200^1^3
"KRN",8994,3587,2,3,1,0)
^^1^1^3120718^
"KRN",8994,3587,2,3,1,1,0)
Appointment Date
"KRN",8994,3587,2,4,0)
TYPE^1^200^1^4
"KRN",8994,3587,2,4,1,0)
^8994.021^1^1^3150217^^
"KRN",8994,3587,2,4,1,1,0)
PURPOSE OF VISIT
"KRN",8994,3587,2,5,0)
LEN^1^200^1^5
"KRN",8994,3587,2,5,1,0)
^^1^1^3120718^
"KRN",8994,3587,2,5,1,1,0)
APPOINTMENT LENGTH
"KRN",8994,3587,2,6,0)
LVL^1^10^0^15
"KRN",8994,3587,2,6,1,0)
^^4^4^3150217^
"KRN",8994,3587,2,6,1,1,0)
Flag that determines if an appointment can be made for a patient that 
"KRN",8994,3587,2,6,1,2,0)
already has an appointment scheduled for the same day as the current 
"KRN",8994,3587,2,6,1,3,0)
appointment request. Setting this parameter to 1 allows multiple 
"KRN",8994,3587,2,6,1,4,0)
appointments for the patient on the same day.
"KRN",8994,3587,2,7,0)
DESDT^1^200^0^16
"KRN",8994,3587,2,7,1,0)
^8994.021^1^1^3150217^^^
"KRN",8994,3587,2,7,1,1,0)
This is the patient's desired date/time for an appointment.
"KRN",8994,3587,2,8,0)
STYP^1^999^0^5
"KRN",8994,3587,2,8,1,0)
^^2^2^3150217^
"KRN",8994,3587,2,8,1,1,0)
This is the appointment type sub-category. It is a pointer to the Sharing 
"KRN",8994,3587,2,8,1,2,0)
Agreement Sub-Category file (#35.2).
"KRN",8994,3587,2,9,0)
SRT^1^999^0^7
"KRN",8994,3587,2,9,1,0)
^^8^8^3150217^
"KRN",8994,3587,2,9,1,1,0)
This is the Scheduling Request Type. This is a set of codes:
"KRN",8994,3587,2,9,1,2,0)
N = Next Available Appt
"KRN",8994,3587,2,9,1,3,0)
C = Other than Next Available (Clinician Requested)
"KRN",8994,3587,2,9,1,4,0)
P = Other than Next Available (Patient Requested)
"KRN",8994,3587,2,9,1,5,0)
W = Walkin Appointment
"KRN",8994,3587,2,9,1,6,0)
M = Multiple Appointment Booking
"KRN",8994,3587,2,9,1,7,0)
A = Auto Rebook
"KRN",8994,3587,2,9,1,8,0)
O = Other than Next Available Appointment
"KRN",8994,3587,2,10,0)
OTHR^1^150^0^8
"KRN",8994,3587,2,10,1,0)
^8994.021^2^2^3150217^^
"KRN",8994,3587,2,10,1,1,0)
This is a free text field with a maximum of 150 characters. This is also 
"KRN",8994,3587,2,10,1,2,0)
known as the Booking Notes on the expanded view of the appointment.
"KRN",8994,3587,2,11,0)
CIO^1^200^0^9
"KRN",8994,3587,2,11,1,0)
^^1^1^3150217^
"KRN",8994,3587,2,11,1,1,0)
Code for Check In. Value can be null or CI.
"KRN",8994,3587,2,12,0)
LAB^1^200^0^10
"KRN",8994,3587,2,12,1,0)
^^2^2^3150217^
"KRN",8994,3587,2,12,1,1,0)
If the patient needs to have labs before the appointment, this field is 
"KRN",8994,3587,2,12,1,2,0)
set to the labl appointment date/time.
"KRN",8994,3587,2,13,0)
XRAY^1^200^0^11
"KRN",8994,3587,2,13,1,0)
^^2^2^3150217^
"KRN",8994,3587,2,13,1,1,0)
If the patient needs X-Rays before the appointment, this will be the 
"KRN",8994,3587,2,13,1,2,0)
date/time for the X-Ray appointment.
"KRN",8994,3587,2,14,0)
EKG^1^200^0^12
"KRN",8994,3587,2,14,1,0)
^^2^2^3150217^
"KRN",8994,3587,2,14,1,1,0)
If the patient needs to have an EKG before  the appointment, this will be 
"KRN",8994,3587,2,14,1,2,0)
the appointment date/time for the EKG.
"KRN",8994,3587,2,15,0)
RQXRAY^1^200^0^13
"KRN",8994,3587,2,15,1,0)
^^3^3^3150217^
"KRN",8994,3587,2,15,1,1,0)
If the provider is requesting prior X-Rays be sent to the clinic prior to 
"KRN",8994,3587,2,15,1,2,0)
the appointment, this will be set to Y for Yes. Otherwise, it will be 
"KRN",8994,3587,2,15,1,3,0)
null.
"KRN",8994,3587,2,16,0)
CON^1^200^0^14
"KRN",8994,3587,2,16,1,0)
^^2^2^3150217^
"KRN",8994,3587,2,16,1,1,0)
If the appointment is being made in response to a consult request, this 
"KRN",8994,3587,2,16,1,2,0)
parameter is set to the internal entry number for the consult request.
"KRN",8994,3587,2,"B","APPDATE",3)

"KRN",8994,3587,2,"B","CIO",11)

"KRN",8994,3587,2,"B","CLINIC",2)

"KRN",8994,3587,2,"B","CON",16)

"KRN",8994,3587,2,"B","DESDT",7)

"KRN",8994,3587,2,"B","DESIRED DATE OF APPT",7)

"KRN",8994,3587,2,"B","DFN",1)

"KRN",8994,3587,2,"B","EKG",14)

"KRN",8994,3587,2,"B","LAB",12)

"KRN",8994,3587,2,"B","LEN",5)

"KRN",8994,3587,2,"B","LVL",6)

"KRN",8994,3587,2,"B","OTHR",10)

"KRN",8994,3587,2,"B","RQXRAY",15)

"KRN",8994,3587,2,"B","SRT",9)

"KRN",8994,3587,2,"B","STYP",8)

"KRN",8994,3587,2,"B","TYPE",4)

"KRN",8994,3587,2,"B","XRAY",13)

"KRN",8994,3587,2,"PARAMSEQ",1,1)

"KRN",8994,3587,2,"PARAMSEQ",2,2)

"KRN",8994,3587,2,"PARAMSEQ",3,3)

"KRN",8994,3587,2,"PARAMSEQ",4,4)

"KRN",8994,3587,2,"PARAMSEQ",5,5)

"KRN",8994,3587,2,"PARAMSEQ",5,8)

"KRN",8994,3587,2,"PARAMSEQ",6,6)

"KRN",8994,3587,2,"PARAMSEQ",7,7)

"KRN",8994,3587,2,"PARAMSEQ",7,9)

"KRN",8994,3587,2,"PARAMSEQ",8,10)

"KRN",8994,3587,2,"PARAMSEQ",9,11)

"KRN",8994,3587,2,"PARAMSEQ",10,12)

"KRN",8994,3587,2,"PARAMSEQ",11,13)

"KRN",8994,3587,2,"PARAMSEQ",12,14)

"KRN",8994,3587,2,"PARAMSEQ",13,15)

"KRN",8994,3587,2,"PARAMSEQ",14,16)

"KRN",8994,3587,2,"PARAMSEQ",15,6)

"KRN",8994,3587,2,"PARAMSEQ",16,7)

"KRN",8994,3595,-1)
0^10
"KRN",8994,3595,0)
MBAA PATIENT PENDING APPT^GETPEND^MBAARPC1^2^^^^^^^1
"KRN",8994,3595,1,0)
^8994.01^1^1^3130828^
"KRN",8994,3595,1,1,0)
this RPC will return data about pending appointments for a patient.
"KRN",8994,3595,2,0)
^8994.02A^2^2
"KRN",8994,3595,2,1,0)
DFN^1^^1^1
"KRN",8994,3595,2,1,1,0)
^^1^1^3130828^
"KRN",8994,3595,2,1,1,1,0)
The patient DFN.
"KRN",8994,3595,2,2,0)
DATE^1^^1^2
"KRN",8994,3595,2,2,1,0)
^^1^1^3130828^
"KRN",8994,3595,2,2,1,1,0)
The starting date in FileMan format to begin the search for appointments.
"KRN",8994,3595,2,"B","DATE",2)

"KRN",8994,3595,2,"B","DFN",1)

"KRN",8994,3595,2,"PARAMSEQ",1,1)

"KRN",8994,3595,2,"PARAMSEQ",2,2)

"KRN",8994,3595,3,0)
^^13^13^3130828^
"KRN",8994,3595,3,1,0)
Returns an array with the following subscripts:
"KRN",8994,3595,3,2,0)
 
"KRN",8994,3595,3,3,0)
RETURN(CNT,"COLLATERAL VISIT")
"KRN",8994,3595,3,4,0)
RETURN(CNT,"APPOINTMENT TYPE")
"KRN",8994,3595,3,5,0)
RETURN(CNT,"LAB")
"KRN",8994,3595,3,6,0)
RETURN(CNT,"XRAY")
"KRN",8994,3595,3,7,0)
RETURN(CNT,"EKG")
"KRN",8994,3595,3,8,0)
RETURN(CNT,"CLINIC")
"KRN",8994,3595,3,9,0)
RETURN(CNT,"LENGTH OF APP'T")
"KRN",8994,3595,3,10,0)
RETURN(CNT,"CONSULT LINK")
"KRN",8994,3595,3,11,0)
RETURN(CNT,"OTHER")
"KRN",8994,3595,3,12,0)
 
"KRN",8994,3595,3,13,0)
CNT is the date/time of the appointment. 
"KRN",8994,3597,-1)
0^3
"KRN",8994,3597,0)
MBAA CANCEL APPOINTMENT^CANCEL^MBAARPC2^1^^^^^^^1
"KRN",8994,3597,1,0)
^8994.01^1^1^3130924^
"KRN",8994,3597,1,1,0)
Allows cancel of an appointment
"KRN",8994,3597,2,0)
^8994.02A^6^6
"KRN",8994,3597,2,1,0)
DFN^1^200^1^1
"KRN",8994,3597,2,1,1,0)
^^1^1^3130924^
"KRN",8994,3597,2,1,1,1,0)
Patient DFN
"KRN",8994,3597,2,2,0)
CLINC^1^200^1^2
"KRN",8994,3597,2,2,1,0)
^^1^1^3130924^
"KRN",8994,3597,2,2,1,1,0)
IEN for the clinic in the Hospital Location (#44) file.
"KRN",8994,3597,2,3,0)
DATE^1^200^1^3
"KRN",8994,3597,2,3,1,0)
^^1^1^3130924^
"KRN",8994,3597,2,3,1,1,0)
The date and time of the appointment to be canceled. 
"KRN",8994,3597,2,4,0)
TYPE^1^200^1^4
"KRN",8994,3597,2,5,0)
REASON^1^200^1^5
"KRN",8994,3597,2,5,1,0)
^^1^1^3130924^
"KRN",8994,3597,2,5,1,1,0)
The cancel reason from the Cancel Reason file.
"KRN",8994,3597,2,6,0)
REMARKS^1^200^0^6
"KRN",8994,3597,2,6,1,0)
^^1^1^3130924^
"KRN",8994,3597,2,6,1,1,0)
And free text comments or remarks.
"KRN",8994,3597,2,"B","CLINC",2)

"KRN",8994,3597,2,"B","DATE",3)

"KRN",8994,3597,2,"B","DFN",1)

"KRN",8994,3597,2,"B","REASON",5)

"KRN",8994,3597,2,"B","REMARKS",6)

"KRN",8994,3597,2,"B","TYPE",4)

"KRN",8994,3597,2,"PARAMSEQ",1,1)

"KRN",8994,3597,2,"PARAMSEQ",2,2)

"KRN",8994,3597,2,"PARAMSEQ",3,3)

"KRN",8994,3597,2,"PARAMSEQ",4,4)

"KRN",8994,3597,2,"PARAMSEQ",5,5)

"KRN",8994,3597,2,"PARAMSEQ",6,6)

"KRN",8994,3597,3,0)
^^4^4^3130924^
"KRN",8994,3597,3,1,0)
Returns an array where 
"KRN",8994,3597,3,2,0)
 
"KRN",8994,3597,3,3,0)
RETURN(0)="0^Failure Reason"
"KRN",8994,3597,3,4,0)
RETURN(0)=1 for success.
"KRN",8994,3602,-1)
0^27
"KRN",8994,3602,0)
MBAA PROVIDERS BY CLINIC^GETPROV^MBAARPC3^2^^^^^^^1
"KRN",8994,3602,1,0)
^^4^4^3140820^
"KRN",8994,3602,1,1,0)
This RPC takes input of the clinic id, IEN from the Hospital Location 
"KRN",8994,3602,1,2,0)
file (#44), and returns the list of providers assigned to that clinic. 
"KRN",8994,3602,1,3,0)
The return data is the provider name and IEN for the provider from the 
"KRN",8994,3602,1,4,0)
New Person file (#200).
"KRN",8994,3602,2,0)
^8994.02A^1^1
"KRN",8994,3602,2,1,0)
CLINIC ID^1^200^1^1
"KRN",8994,3602,2,1,1,0)
^^1^1^3140820^
"KRN",8994,3602,2,1,1,1,0)
The IEN for the Clinic in the Hospital Location File (#44).
"KRN",8994,3602,2,"B","CLINIC ID",1)

"KRN",8994,3602,2,"PARAMSEQ",1,1)

"KRN",8994,3602,3,0)
^^3^3^3140820^
"KRN",8994,3602,3,1,0)
Returns an array where each node has the provider IEN from the New Person 
"KRN",8994,3602,3,2,0)
file (#200) and the provider name. Data elements are separated by the 
"KRN",8994,3602,3,3,0)
carat (^) character.
"KRN",8994,3755,-1)
0^31
"KRN",8994,3755,0)
MBAA GET CLINIC DETAILS^GETCLN^MBAAMRP1^2^S^^^^1^^1
"KRN",8994,3755,1,0)
^^2^2^3150623^
"KRN",8994,3755,1,1,0)
This RPC returns clinic details needed for scheduling appointments into a 
"KRN",8994,3755,1,2,0)
clinic.
"KRN",8994,3755,2,0)
^8994.02A^1^1
"KRN",8994,3755,2,1,0)
CLINIC^1^200^1^1
"KRN",8994,3755,2,1,1,0)
^^1^1^3150623^
"KRN",8994,3755,2,1,1,1,0)
This the IEN for the Clinic in the Hospital Location File (#44).
"KRN",8994,3755,2,"B","CLINIC",1)

"KRN",8994,3755,2,"PARAMSEQ",1,1)

"KRN",8994,3755,3,0)
^^32^32^3150623^
"KRN",8994,3755,3,1,0)
Returns and array in the format below:
"KRN",8994,3755,3,2,0)
 
"KRN",8994,3755,3,3,0)
 LST(1)="RESULT(44,""23,"",.01,""E"")=GENERAL MEDICINE"
"KRN",8994,3755,3,4,0)
 LST(2)="RESULT(44,""23,"",.01,""I"")=GENERAL MEDICINE"
"KRN",8994,3755,3,5,0)
 LST(3)="RESULT(44,""23,"",1,""E"")=GM"
"KRN",8994,3755,3,6,0)
 LST(4)="RESULT(44,""23,"",1,""I"")=GM"
"KRN",8994,3755,3,7,0)
 LST(5)="RESULT(44,""23,"",2,""E"")=CLINIC"
"KRN",8994,3755,3,8,0)
 LST(6)="RESULT(44,""23,"",2,""I"")=C"
"KRN",8994,3755,3,9,0)
 LST(7)="RESULT(44,""23,"",7,""E"")="
"KRN",8994,3755,3,10,0)
 LST(8)="RESULT(44,""23,"",7,""I"")="
"KRN",8994,3755,3,11,0)
 LST(9)="RESULT(44,""23,"",8,""E"")=GENERAL INTERNAL MEDICINE"
"KRN",8994,3755,3,12,0)
 LST(10)="RESULT(44,""23,"",8,""I"")=141"
"KRN",8994,3755,3,13,0)
 LST(11)="RESULT(44,""23,"",9,""E"")=MEDICINE"
"KRN",8994,3755,3,14,0)
 LST(12)="RESULT(44,""23,"",9,""I"")=M"
"KRN",8994,3755,3,15,0)
 LST(13)="RESULT(44,""23,"",9.5,""E"")=GENERAL MEDICINE"
"KRN",8994,3755,3,16,0)
 LST(14)="RESULT(44,""23,"",9.5,""I"")=9"
"KRN",8994,3755,3,17,0)
 LST(15)="RESULT(44,""23,"",10,""E"")="
"KRN",8994,3755,3,18,0)
 LST(16)="RESULT(44,""23,"",10,""I"")="
"KRN",8994,3755,3,19,0)
 LST(17)="RESULT(44,""23,"",24,""E"")="
"KRN",8994,3755,3,20,0)
 LST(18)="RESULT(44,""23,"",24,""I"")="
"KRN",8994,3755,3,21,0)
 LST(19)="RESULT(44,""23,"",1912,""E"")=15"
"KRN",8994,3755,3,22,0)
 LST(20)="RESULT(44,""23,"",1912,""I"")=15"
"KRN",8994,3755,3,23,0)
 LST(21)="RESULT(44,""23,"",1914,""E"")=8"
"KRN",8994,3755,3,24,0)
 LST(22)="RESULT(44,""23,"",1914,""I"")=8"
"KRN",8994,3755,3,25,0)
 LST(23)="RESULT(44,""23,"",1917,""E"")=15-MIN "
"KRN",8994,3755,3,26,0)
 LST(24)="RESULT(44,""23,"",1917,""I"")=4"
"KRN",8994,3755,3,27,0)
 LST(25)="RESULT(44,""23,"",1918,""E"")=0"
"KRN",8994,3755,3,28,0)
 LST(26)="RESULT(44,""23,"",1918,""I"")=0"
"KRN",8994,3755,3,29,0)
 LST(27)="RESULT(44,""23,"",2500,""E"")="
"KRN",8994,3755,3,30,0)
 LST(28)="RESULT(44,""23,"",2500,""I"")="
"KRN",8994,3755,3,31,0)
 LST(29)="RESULT(44,""23,"",2503,""E"")=FAMILY PRACTICE"
"KRN",8994,3755,3,32,0)
 LST(30)="RESULT(44,""23,"",2503,""I"")=532"
"KRN",8994,4033,-1)
0^29
"KRN",8994,4033,0)
MBAA WAIT LIST BY DFN^EWL^MBAARPCL^2^^^^^^^1
"KRN",8994,4033,1,0)
^8994.01^1^1^3130726^^
"KRN",8994,4033,1,1,0)
Returns the EWL for a patient.
"KRN",8994,4033,2,0)
^8994.02A^1^1
"KRN",8994,4033,2,1,0)
DFN^1^32000^1^1
"KRN",8994,4033,2,1,1,0)
^8994.021^1^1^3130726^^
"KRN",8994,4033,2,1,1,1,0)
Patient's DFN
"KRN",8994,4033,2,"B","DFN",1)

"KRN",8994,4033,2,"PARAMSEQ",1,1)

"KRN",8994,4033,3,0)
^8994.03^1^1^3130726^^
"KRN",8994,4033,3,1,0)
Array of EWL data for the patient
"KRN",8994,4034,-1)
0^30
"KRN",8994,4034,0)
MBAA FACILITY WAIT LIST^FACEWL^MBAARPCL^2^^^^^^^1
"KRN",8994,4034,1,0)
^8994.01^3^3^3130822^^
"KRN",8994,4034,1,1,0)
This RPC will return the full Facility Electronic Wait List.
"KRN",8994,4034,1,2,0)
 
"KRN",8994,4034,1,3,0)
No input parameters are needed. 
"KRN",8994,4034,3,0)
^8994.03^8^8^3130822^^
"KRN",8994,4034,3,1,0)
 Outputs if successful - patient is on the EWL:
"KRN",8994,4034,3,2,0)
 Results(0)=DFN^DSS STOP CODE^LAST UPDATED^PATIENT LAST NAME^PATIENT 
"KRN",8994,4034,3,3,0)
SSN^CLINIC NAME^ORIGINATING DATE^DESIRED DATE OF APPOINTMENT^DAYS ON 
"KRN",8994,4034,3,4,0)
EWL^DATE REMOVED FROM EWL^PATIENT ZIP CODE^SERVICE CONNECTED 
"KRN",8994,4034,3,5,0)
PERCENT^ENROLLEE STATUS^PRIORITY
"KRN",8994,4034,3,6,0)
 
"KRN",8994,4034,3,7,0)
If no patients are not on the EWL, returns
"KRN",8994,4034,3,8,0)
RESULTS(0)="1^EWL is empty."
"KRN",8994,4035,-1)
0^28
"KRN",8994,4035,0)
MBAA REMOVE FROM EWL^UPDTEWL^MBAARPC1^2^^^^^^^1
"KRN",8994,4035,1,0)
^8994.01^1^1^3131009^^^^
"KRN",8994,4035,1,1,0)
This RPC removes a patient from the EWL.
"KRN",8994,4035,2,0)
^8994.02A^4^4
"KRN",8994,4035,2,1,0)
DFN^1^200^1^1
"KRN",8994,4035,2,1,1,0)
^^1^1^3131008^
"KRN",8994,4035,2,1,1,1,0)
Patient DFN.
"KRN",8994,4035,2,2,0)
SDWLIEN^1^200^1^2
"KRN",8994,4035,2,2,1,0)
^8994.021^1^1^3131008^^^
"KRN",8994,4035,2,2,1,1,0)
The IEN for the record in SD WAIT LIST File (#409.3).
"KRN",8994,4035,2,3,0)
SDWLDATA^2^240^0^4
"KRN",8994,4035,2,3,1,0)
^^18^18^3131009^
"KRN",8994,4035,2,3,1,1,0)
List of data elements:
"KRN",8994,4035,2,3,1,2,0)
 SDWLDATA(1)=SCHEDULED DATE OF APPT
"KRN",8994,4035,2,3,1,3,0)
 SDWLDATA(2)=PTR TO APPT CLINIC (CLINIC WHERE APPT MADE)
"KRN",8994,4035,2,3,1,4,0)
 SDWLDATA(15)=APPOINTMENT INSTITUTION (PTR to Institution File.)
"KRN",8994,4035,2,3,1,5,0)
 SDWLDATA(13)=APPT STOP CODE (PTR to file 40.7)
"KRN",8994,4035,2,3,1,6,0)
 SDWLDATA(14)=APPT CREDIT STOP CODE (PTR to file 40.7)
"KRN",8994,4035,2,3,1,7,0)
 SDWLDATA(16)=APPT STATION NUMBER (Free Text) MUST BE AN IEN FROM DIC(4
"KRN",8994,4035,2,3,1,8,0)
    but is not a ptr field)
"KRN",8994,4035,2,3,1,9,0)
 SDWLDATA(3)=APPT STATUS (Set of codes: 
"KRN",8994,4035,2,3,1,10,0)
     'R' FOR Scheduled/Kept 
"KRN",8994,4035,2,3,1,11,0)
     'I' FOR Inpatient
"KRN",8994,4035,2,3,1,12,0)
     'NS' FOR No-Show
"KRN",8994,4035,2,3,1,13,0)
     'NSR' FOR No_Show, Rescheduled 
"KRN",8994,4035,2,3,1,14,0)
     'CP' FOR Canceled by Patient 
"KRN",8994,4035,2,3,1,15,0)
     'CPR' FOR Canceled by Patient, Rescheduled
"KRN",8994,4035,2,3,1,16,0)
     'CC' FOR Canceled by Clinic; 
"KRN",8994,4035,2,3,1,17,0)
     'CCR' FOR Canceled by Clinic, Rescheduled
"KRN",8994,4035,2,3,1,18,0)
     'NT' FOR No Action Taken )
"KRN",8994,4035,2,4,0)
SDWLDISP^1^200^1^3
"KRN",8994,4035,2,4,1,0)
^^9^9^3131009^
"KRN",8994,4035,2,4,1,1,0)
The disposition of the entry.
"KRN",8994,4035,2,4,1,2,0)
 
"KRN",8994,4035,2,4,1,3,0)
D:DEATH
"KRN",8994,4035,2,4,1,4,0)
NC:REMOVED/NON-VA CARE
"KRN",8994,4035,2,4,1,5,0)
SA:REMOVED/SCHEDULED-ASSIGNED
"KRN",8994,4035,2,4,1,6,0)
CC:REMOVED/VA CONTRACT CARE 
"KRN",8994,4035,2,4,1,7,0)
NN:REMOVED/NO LONGER NECESSARY
"KRN",8994,4035,2,4,1,8,0)
ER:ENTERED IN ERROR
"KRN",8994,4035,2,4,1,9,0)
CL:CLINIC CHANGE
"KRN",8994,4035,2,"B","DFN",1)

"KRN",8994,4035,2,"B","SDWLDATA",3)

"KRN",8994,4035,2,"B","SDWLDISP",4)

"KRN",8994,4035,2,"B","SDWLIEN",2)

"KRN",8994,4035,2,"PARAMSEQ",1,1)

"KRN",8994,4035,2,"PARAMSEQ",2,2)

"KRN",8994,4035,2,"PARAMSEQ",3,4)

"KRN",8994,4035,2,"PARAMSEQ",4,3)

"KRN",8994,4035,3,0)
^^7^7^3131009^
"KRN",8994,4035,3,1,0)
Returns:
"KRN",8994,4035,3,2,0)
 
"KRN",8994,4035,3,3,0)
RESULTS(0)=1 - Successful
"KRN",8994,4035,3,4,0)
RESULTS(0)="0^DFN is required"
"KRN",8994,4035,3,5,0)
RESULTS(0)="0^SDWLIEN is required"
"KRN",8994,4035,3,6,0)
RESULTS(0)="0^Patient not on EWL"
"KRN",8994,4035,3,7,0)
RESULTS(0)="0^Dispostion is missing."
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",656,-1)
1^1
"PKG",656,0)
MOBILE SCHEDULING APPLICATIONS^MBAA^Mobile Application for Scheduling Calendar View
"PKG",656,20,0)
^9.402P^^
"PKG",656,22,0)
^9.49I^1^1
"PKG",656,22,1,0)
1.0^3160601^3160601^520736418
"PKG",656,22,1,"PAH",1,0)
1^3160825^520736418
"PKG",656,22,1,"PAH",1,1,0)
^^1^1^3160825
"PKG",656,22,1,"PAH",1,1,1,0)
Scheduling Calendar View initial build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
23
"RTN","MBAAAPI1")
0^1^B12399401^n/a
"RTN","MBAAAPI1",1,0)
MBAAAPI1 ;OIT-PD/VSL - SCHEDULING CONSULT API ;02/10/2016
"RTN","MBAAAPI1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 10, 2016;Build 85
"RTN","MBAAAPI1",3,0)
 ;
"RTN","MBAAAPI1",4,0)
 ;Associated ICRs
"RTN","MBAAAPI1",5,0)
 ;  ICR#
"RTN","MBAAAPI1",6,0)
 ;
"RTN","MBAAAPI1",7,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAAPI1",8,0)
 ;GETAPCNS(RETURN,DFN,STPCOD) ; Get active/pending consult requests
"RTN","MBAAAPI1",9,0)
 ;N LST,FLDS,SVS,LST,TT,X1,X2
"RTN","MBAAAPI1",10,0)
 ;S RETURN=0
"RTN","MBAAAPI1",11,0)
 ;S FLDS(.01)="DATE",FLDS(.02)="PATIENT",FLDS(.04)="CLINIC",FLDS(.1)="TEXT"
"RTN","MBAAAPI1",12,0)
 ;S FLDS(8)="STATUS",FLDS(1)="SERVICE",FLDS(10)="SENDER",FLDS(13)="TYPE"
"RTN","MBAAAPI1",13,0)
 ;I STPCOD="" Q 0
"RTN","MBAAAPI1",14,0)
 ;D GETCONSR^MBAADAL1(.LST,.DFN,.FLDS)
"RTN","MBAAAPI1",15,0)
 ;N A,CPRSTAT,DTENTR,DTLMT,NOS,NOSHOW
"RTN","MBAAAPI1",16,0)
 ;K TMP S NOSHOW="no-show",X1=DT,X2=-365 D C^%DTC S DTLMT=X
"RTN","MBAAAPI1",17,0)
 ;S A=":"
"RTN","MBAAAPI1",18,0)
 ;F  S A=$O(LST(A),-1) Q:'+A  D
"RTN","MBAAAPI1",19,0)
 ;. D GETRQSV^MBAADAL1(.SVS,STPCOD,+LST(A,1)) Q:'+SVS("DILIST",0)
"RTN","MBAAAPI1",20,0)
 ;. S DTENTR=$P(LST(A,.01),U) I DTENTR<DTLMT Q
"RTN","MBAAAPI1",21,0)
 ;. S CPRSTAT=$P(LST(A,8),U) Q:$S(CPRSTAT=5!(CPRSTAT=6)!(CPRSTAT=8)!(CPRSTAT=13):0,1:1)
"RTN","MBAAAPI1",22,0)
 ;. S PTIEN=$P(LST(A,.02),U)
"RTN","MBAAAPI1",23,0)
 ;. I CPRSTAT=8 S STOP=0 D  Q:STOP
"RTN","MBAAAPI1",24,0)
 ;. . I $$CONSLNKD^MBAADAL1(A) S STOP=1 Q
"RTN","MBAAAPI1",25,0)
 ;. . S NOS=$O(LST(A,40,":"),-1) I '+NOS S STOP=1 Q
"RTN","MBAAAPI1",26,0)
 ;. . S X2=LST(A,40,NOS,.01),X1=DT D ^%DTC I X'=""&(X>180) S STOP=1 Q
"RTN","MBAAAPI1",27,0)
 ;. . D SCHED(PTIEN,STPCOD,.SHOW) I 'SHOW S STOP=1 Q
"RTN","MBAAAPI1",28,0)
 ;. . ;CPRSTAT 13 is a cancel
"RTN","MBAAAPI1",29,0)
 ;. I CPRSTAT=13 S NOS=$O(LST(A,40,":"),-1) Q:'+NOS  D
"RTN","MBAAAPI1",30,0)
 ;. . S NOS=$O(LST(A,40,NOS),-1) I '+NOS S STOP=1 Q
"RTN","MBAAAPI1",31,0)
 ;. . S X2=$P(LST(A,40,NOS,.01),U),X1=DT D ^%DTC I X'=""&(X>180) S STOP=1 Q
"RTN","MBAAAPI1",32,0)
 ;. . S COMMENT=$G(LST(A,40,NOS,5,1)) I COMMENT'[NOSHOW S STOP=1 Q
"RTN","MBAAAPI1",33,0)
 ;. M TT(A)=LST(A) D BLDCONS(.TT,.RETURN,.FLDS)
"RTN","MBAAAPI1",34,0)
 ;S RETURN=1
"RTN","MBAAAPI1",35,0)
 ;Q 1
"RTN","MBAAAPI1",36,0)
 ;
"RTN","MBAAAPI1",37,0)
 ;SCHED(PTIEN,STPCOD,SHOW) ;===CONSULT IS SCHEDULE NOW CHECK IF IT HAS APPOINTMENT BY STOP CODE.
"RTN","MBAAAPI1",38,0)
 ;N APT,APTS,SD,STOP,CLNC,CLN,STOPCOD
"RTN","MBAAAPI1",39,0)
 ;S %DT="ST",X="T-1" D ^%DT
"RTN","MBAAAPI1",40,0)
 ;S SD=Y,SD(0)=1,STOP=0,APT="",SHOW=1
"RTN","MBAAAPI1",41,0)
 ;D GETAPTS^MBAAMDA2(.APTS,PTIEN,.SD)
"RTN","MBAAAPI1",42,0)
 ;F  S APT=$O(APTS("APT",APT)) Q:'+APT!(STOP)  D
"RTN","MBAAAPI1",43,0)
 ;. S CLNC=$P(APTS("APT",APT,"CLINIC"),U)
"RTN","MBAAAPI1",44,0)
 ;. Q:CLNC=""
"RTN","MBAAAPI1",45,0)
 ;. D GETCLN^MBAAMDA1(.CLN,CLNC,1)
"RTN","MBAAAPI1",46,0)
 ;. S STOPCOD=$G(CLN(8)) Q:STOPCOD=""
"RTN","MBAAAPI1",47,0)
 ;. I STOPCOD'=STPCOD S SHOW=1 Q
"RTN","MBAAAPI1",48,0)
 ;. D GETCAPT^MBAAMDA4(.CAPT,PTIEN,APT)
"RTN","MBAAAPI1",49,0)
 ;. I $D(CAPT) S SHOW=0,STOP=1
"RTN","MBAAAPI1",50,0)
 ;Q
"RTN","MBAAAPI1",51,0)
 ;
"RTN","MBAAAPI1",52,0)
 ;BLDCONS(CIN,COUT,FLDS) ; Build consult list
"RTN","MBAAAPI1",53,0)
 ;N FLD,NO
"RTN","MBAAAPI1",54,0)
 ;N IN S IN=0
"RTN","MBAAAPI1",55,0)
 ;F  S IN=$O(CIN(IN)) Q:'IN  D
"RTN","MBAAAPI1",56,0)
 ;. F FLD=0:0 S FLD=$O(FLDS(FLD)) Q:'FLD  S COUT(IN,FLDS(FLD))=CIN(IN,FLD)
"RTN","MBAAAPI1",57,0)
 ;. F NO=0:0 S NO=$O(CIN(IN,40,NO)) Q:'NO  D
"RTN","MBAAAPI1",58,0)
 ;. . S COUT(IN,"ACT",NO,"DATE")=CIN(IN,40,NO,.01)
"RTN","MBAAAPI1",59,0)
 ;Q
"RTN","MBAAAPI1",60,0)
 ;
"RTN","MBAAAPI1",61,0)
CANCEL(RETURN,CONS,SC,SD,IFN,RMK,WHO,ADM,AUTO,CNDIE,CNDA) ; appt was cancelled then mark consult as edit/resubmit, add comment. Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAAPI1",62,0)
 N CAPT,CNS,CLN,BY,CONSULT,SDPATNT,COMMENT,USER
"RTN","MBAAAPI1",63,0)
 S:$D(CONS) CONSULT=CONS
"RTN","MBAAAPI1",64,0)
 S RETURN=0
"RTN","MBAAAPI1",65,0)
 D GETCAPT^MBAAMDA1(.CAPT,SC,SD,IFN,"I")
"RTN","MBAAAPI1",66,0)
 I '$D(CONS) S CONSULT=$G(CAPT(688,"I"))
"RTN","MBAAAPI1",67,0)
 Q:'+CONSULT 0
"RTN","MBAAAPI1",68,0)
 S SDPATNT=$G(CAPT(.01,"I"))
"RTN","MBAAAPI1",69,0)
 D GETCONS^MBAADAL1(.CNS,CONSULT,"IE")
"RTN","MBAAAPI1",70,0)
 S CPRSSTAT=$G(CNS(8,"E")) I CPRSSTAT'="" Q:CPRSSTAT'="SCHEDULED"
"RTN","MBAAAPI1",71,0)
 S SNDPRV=$G(CNS(10,"I"))
"RTN","MBAAAPI1",72,0)
 S USER=$G(CNS(10,"E")),Y=SD
"RTN","MBAAAPI1",73,0)
 D DD^%DT S APPT=$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_$P(Y,"@",2)
"RTN","MBAAAPI1",74,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1,1)
"RTN","MBAAAPI1",75,0)
 S BY=$S($D(WHO):$S(WHO["P":" by the Patient.",WHO["C":" by the Clinic.",1:"."),$D(ADM):" for administrative purposes.",1:", whole clinic.")
"RTN","MBAAAPI1",76,0)
 S COMMENT(1)=$P(CLN(.01),U)_" Appt. on "_APPT_" was cancelled"_BY
"RTN","MBAAAPI1",77,0)
 S:$D(RMK) COMMENT(2)="Remarks: "_RMK
"RTN","MBAAAPI1",78,0)
 ;Code removed from initial release of SCV. will be included in next release of SCV.
"RTN","MBAAAPI1",79,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CONSULT,6,3,SNDPRV,"","",.COMMENT)  ;ICR#: 4854 updates the status of a consult
"RTN","MBAAAPI1",80,0)
 S CNDIE="^GMR(123,"_CONS_",40,",CNDA=+$G(COMMENT(0))
"RTN","MBAAAPI1",81,0)
 S AUTO(SC,SD,SDPATNT)=CONS
"RTN","MBAAAPI1",82,0)
 N FLDS S FLDS(688)="@"
"RTN","MBAAAPI1",83,0)
 D UPDCAPT^MBAAMDA4(.FLDS,SC,SD,IFN)
"RTN","MBAAAPI1",84,0)
 ;Code removed from initial release of SCV. will be included in next release of SCV.
"RTN","MBAAAPI1",85,0)
 ;D STATUS^GMRCGUIS(.FLDS,SC,SD,IFN)  ;ICR#: 4854 updates the status of a consult
"RTN","MBAAAPI1",86,0)
 K APPT,CPRSSTAT,SNDPRV,COMMENT,Y,USER
"RTN","MBAAAPI1",87,0)
 S RETURN=1
"RTN","MBAAAPI1",88,0)
 Q 1
"RTN","MBAAAPI1",89,0)
 ;
"RTN","MBAAAPI1",90,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAAPI1",91,0)
 ;AUTOREB(RETURN,SC,SD,LNK,CIFN) ; Auto rebook
"RTN","MBAAAPI1",92,0)
 ;N FLDS,Y,TME,CLN,CNS,SNDPRV,CSCHDT,COMMENT,ER
"RTN","MBAAAPI1",93,0)
 ;N FLDS S FLDS(688)=LNK
"RTN","MBAAAPI1",94,0)
 ;S RETURN=0
"RTN","MBAAAPI1",95,0)
 ;D UPDCAPT^MBAAMDA4(.FLDS,SC,SD,CIFN)
"RTN","MBAAAPI1",96,0)
 ;S Y=SD D DD^%DT S TME=$P(Y,"@",2)
"RTN","MBAAAPI1",97,0)
 ;D GETCLN^MBAAMDA1(.CLN,SC,1,1)
"RTN","MBAAAPI1",98,0)
 ;S COMMENT(1)=$P(CLN(.01),U)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME_" (Auto Rebooked)."
"RTN","MBAAAPI1",99,0)
 ;S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","MBAAAPI1",100,0)
 ;D GETCONS^MBAADAL1(.CNS,LNK,"IE")
"RTN","MBAAAPI1",101,0)
 ;S SNDPRV=$G(CNS(10,"I"))
"RTN","MBAAAPI1",102,0)
 ;D SCH^SDQQCN2(.ER,LNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","MBAAAPI1",103,0)
 ;S RETURN=1
"RTN","MBAAAPI1",104,0)
 ;Q 1
"RTN","MBAAAPI1",105,0)
 ;
"RTN","MBAAAPI1",106,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAAPI1",107,0)
 ;NOSHOW(RETURN,SC,SD,DFN,CONS,CN,AUTO,NSDIE,NSDA) ;
"RTN","MBAAAPI1",108,0)
 ;Appt. was a NoShow, then mark Consult as Edit/Resubmit, add comment using silent call to notify user.
"RTN","MBAAAPI1",109,0)
 ;Variables NSDIE and NSDA used in calling routine for NoShow letter printed comment in consult.
"RTN","MBAAAPI1",110,0)
 ;N CNS,CLN,SRV,CPRSSTAT,SNDPRV,NOSHOW,CSPRT,USER,APPT,COMMENT
"RTN","MBAAAPI1",111,0)
 ;S RETURN=0
"RTN","MBAAAPI1",112,0)
 ;D GETCONS^MBAADAL1(.CNS,CONS,"IE")
"RTN","MBAAAPI1",113,0)
 ;S CPRSSTAT=$G(CNS(8,"E")),SNDPRV=$G(CNS(10,"I"))
"RTN","MBAAAPI1",114,0)
 ;S NOSHOW="no-show",AUTO(SC,SD,DFN)=CONS
"RTN","MBAAAPI1",115,0)
 ;I CPRSSTAT'="" Q:CPRSSTAT'="SCHEDULED" 0
"RTN","MBAAAPI1",116,0)
 ;D GETRQSV1^MBAADAL1(.SRV,$G(CNS(1,"I")),"123.09","IE")
"RTN","MBAAAPI1",117,0)
 ;S:SRV(123.09,"E")'="" CSPRT=$G(SRV(123.09,"E"))
"RTN","MBAAAPI1",118,0)
 ;S USER=$G(CNS(10,"E")),Y=SD
"RTN","MBAAAPI1",119,0)
 ;D DD^%DT S APPT=$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_$P(Y,"@",2)
"RTN","MBAAAPI1",120,0)
 ;D GETCLN^MBAAMDA1(.CLN,SC,1,1)
"RTN","MBAAAPI1",121,0)
 ;S COMMENT(1)=$P(CLN(.01),U)_" Appt. on "_APPT_" was a "_NOSHOW_"." ;no-show is a key word used by a search do not change
"RTN","MBAAAPI1",122,0)
 ;N SDERR S SDERR=$$STATUS^GMRCGUIS(CONS,6,3,SNDPRV,"","",.COMMENT)
"RTN","MBAAAPI1",123,0)
 ;S NSDIE="^GMR(123,"_CONS_",40,",NSDA=+$G(COMMENT(0))
"RTN","MBAAAPI1",124,0)
 ;N FLDS S FLDS(688)="@"
"RTN","MBAAAPI1",125,0)
 ;D UPDCAPT^MBAAMDA4(.FLDS,SC,SD,CN)
"RTN","MBAAAPI1",126,0)
 ;I $D(CSPRT) D EN^GMRCP5(CONS,"C",CSPRT)
"RTN","MBAAAPI1",127,0)
 ;S RETURN=1
"RTN","MBAAAPI1",128,0)
 ;Q 1
"RTN","MBAAAPI1",129,0)
 ;
"RTN","MBAAAPI1",130,0)
EDITCS(RETURN,CONS,SD,RMK,CLNC) ;Mark consult as scheduled Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAAPI1",131,0)
 N CSCHDT,SNDPRV,TME,X,Y,COMMENT,ER,CNS
"RTN","MBAAAPI1",132,0)
 S RETURN=0
"RTN","MBAAAPI1",133,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y K %DT
"RTN","MBAAAPI1",134,0)
 D GETCONS^MBAADAL1(.CNS,CONS,"IE")
"RTN","MBAAAPI1",135,0)
 S SNDPRV=$G(CNS(10,"I")),Y=SD
"RTN","MBAAAPI1",136,0)
 D DD^%DT S TME=$P($P(Y,"@",2),":",1,2)
"RTN","MBAAAPI1",137,0)
 S COMMENT(1)=$P(CLNC,U,2)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME
"RTN","MBAAAPI1",138,0)
 S COMMENT(2)=RMK
"RTN","MBAAAPI1",139,0)
 D SCH^SDQQCN2(.ER,CONS,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT  ;ICR#: 6050 MBAA SDQQCN2 API
"RTN","MBAAAPI1",140,0)
 S RETURN=1
"RTN","MBAAAPI1",141,0)
 Q 1
"RTN","MBAAAPI1",142,0)
 ;
"RTN","MBAAAPIE")
0^2^B22483643^n/a
"RTN","MBAAAPIE",1,0)
MBAAAPIE ;OIT-PD/CBR - Scheduling Error provider ;02/10/2016
"RTN","MBAAAPIE",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAAPIE",3,0)
 ;
"RTN","MBAAAPIE",4,0)
ERRX(RETURN,ERRNO,TEXT,LVL) ; adds error to RETURN Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAAPIE",5,0)
 N ERRTXT,IND,ST,STR,TXT,I
"RTN","MBAAAPIE",6,0)
 Q:'$D(RETURN)
"RTN","MBAAAPIE",7,0)
 Q:'$D(ERRNO)
"RTN","MBAAAPIE",8,0)
 S:$G(LVL)="" LVL=1
"RTN","MBAAAPIE",9,0)
 S TEXT=$G(TEXT)
"RTN","MBAAAPIE",10,0)
 F I=0:1 Q:$O(RETURN(I))=""!('+$O(RETURN(I)))
"RTN","MBAAAPIE",11,0)
 I I=0,$D(RETURN(0)) S I=I+1
"RTN","MBAAAPIE",12,0)
 E  S:I>0 I=I+1
"RTN","MBAAAPIE",13,0)
 S ERRTXT=$P($T(@ERRNO),";;",2)
"RTN","MBAAAPIE",14,0)
 S IND=1,TXT=1,STR=""
"RTN","MBAAAPIE",15,0)
 F  Q:IND=0  D
"RTN","MBAAAPIE",16,0)
 . S ST=$P(ERRTXT,"^",IND)
"RTN","MBAAAPIE",17,0)
 . I ST=""&(IND>1) S IND=0 Q
"RTN","MBAAAPIE",18,0)
 . I ST["$TXT" D  S:$D(TEXT(TXT)) STR=STR_TEXT(TXT),TXT=TXT+1
"RTN","MBAAAPIE",19,0)
 . E  S STR=STR_ST
"RTN","MBAAAPIE",20,0)
 . S IND=IND+1
"RTN","MBAAAPIE",21,0)
 S RETURN(I)=ERRNO_U_STR_U_LVL
"RTN","MBAAAPIE",22,0)
 Q
"RTN","MBAAAPIE",23,0)
 ;
"RTN","MBAAAPIE",24,0)
ERRTXT(RETURN) ; MBAA RPC: used by multiple MBAA RPCS
"RTN","MBAAAPIE",25,0)
 Q $P($G(RETURN(0)),U,2)
"RTN","MBAAAPIE",26,0)
 ; 
"RTN","MBAAAPIE",27,0)
ERRTABLE ; Error table
"RTN","MBAAAPIE",28,0)
INVPARAM ;;Invalid parameter value - ^$TXT1^.
"RTN","MBAAAPIE",29,0)
CLNINV ;;Invalid Clinic.
"RTN","MBAAAPIE",30,0)
CLNNFND ;;Clinic not found.
"RTN","MBAAAPIE",31,0)
CLNNDFN ;;Clinic not define or has no zero node.
"RTN","MBAAAPIE",32,0)
CLNSCIN ;;Invalid Clinic Stop Code ^$TXT1^.
"RTN","MBAAAPIE",33,0)
CLNSCRD ;;Clinic's Stop Code ^$TXT1^ cannot be used. Restriction date is ^$TXT2^ ^$TXT3^.
"RTN","MBAAAPIE",34,0)
CLNSCPS ;;Clinic's Stop Code ^$TXT1^ cannot be ^$TXT2^.
"RTN","MBAAAPIE",35,0)
CLNSCNR ;;Clinic's Stop Code ^$TXT1^ has no restriction type ^$TXT2^.
"RTN","MBAAAPIE",36,0)
CLNURGT ;;Access to ^$TXT1^ is prohibited!^$TXT2^Only users with a special code may access this clinic.
"RTN","MBAAAPIE",37,0)
CLNNOSL ;;No 'SL' node defined - cannot proceed with this clinic.
"RTN","MBAAAPIE",38,0)
PATDIED ;;PATIENT HAS DIED.
"RTN","MBAAAPIE",39,0)
PATNFND ;;Patient not found.
"RTN","MBAAAPIE",40,0)
PATSENS ;;Do you want to continue processing this patient record
"RTN","MBAAAPIE",41,0)
NOAVSLO ;;No available slots found on the same day in all the selected clinics for this date range
"RTN","MBAAAPIE",42,0)
APTCRGT ;;Appt. in ^$TXT1^ NOT CANCELLED^$TXT2^Access to this clinic is restricted to only privileged users!
"RTN","MBAAAPIE",43,0)
APTCCHO ;;>>> Appointment has a check out date and cannot be cancelled.
"RTN","MBAAAPIE",44,0)
APTCAND ;;Appointment already cancelled
"RTN","MBAAAPIE",45,0)
APTCNPE ;;You cannot cancel this appointment.
"RTN","MBAAAPIE",46,0)
APTCIPE ;;You cannot check in this appointment.
"RTN","MBAAAPIE",47,0)
APTCITS ;;It is too soon to check in this appointment.
"RTN","MBAAAPIE",48,0)
APTPPAB ;;That date is prior to the patient's date of birth.
"RTN","MBAAAPIE",49,0)
APTPCLA ;;That date is prior to the clinic's availability date.
"RTN","MBAAAPIE",50,0)
APTCLUV ;;There is no availability for this date/time.
"RTN","MBAAAPIE",51,0)
APTEXCD ;;EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!
"RTN","MBAAAPIE",52,0)
APTSHOL ;;^$TXT1^??
"RTN","MBAAAPIE",53,0)
APTPAHA ;;PATIENT ALREADY HAS APPOINTMENT ^$TXT1^ THEN.
"RTN","MBAAAPIE",54,0)
APTPAHU ;;o  Patient already has an appt on ^$TXT1^
"RTN","MBAAAPIE",55,0)
APTPHSD ;;PATIENT ALREADY HAS APPOINTMENT ON THE SAME DAY ^$TXT1^
"RTN","MBAAAPIE",56,0)
APTPPCP ;;THIS TIME WAS PREVIOUSLY CANCELLED BY THE PATIENT
"RTN","MBAAAPIE",57,0)
APTOVBK ;;OVERBOOK!
"RTN","MBAAAPIE",58,0)
APTOVOS ;;THAT TIME IS NOT WITHIN SCHEDULED PERIOD!
"RTN","MBAAAPIE",59,0)
APTOAPD ;;ONLY ^$TXT1^ OVERBOOK^$TXT2^ PER DAY!!
"RTN","MBAAAPIE",60,0)
APTCBCP ;;CAN'T BOOK WITHIN A CANCELLED TIME PERIOD
"RTN","MBAAAPIE",61,0)
APTNOST ;;NO OPEN SLOTS THEN
"RTN","MBAAAPIE",62,0)
APTEXOB ;;WILL EXCEED MAXIMUM ALLOWABLE OVERBOOKS,
"RTN","MBAAAPIE",63,0)
APTLOCK ;;Another user is editing this record.  Trying again.
"RTN","MBAAAPIE",64,0)
APTCINV ;;*** Note: Clinic is scheduled to be inactivated on ^$TXT1^$TXT2^
"RTN","MBAAAPIE",65,0)
APTNSCE ;;You cannot execute no-show processing for this appointment.
"RTN","MBAAAPIE",66,0)
APTNSTS ;;It is too soon to no-show this appointment.
"RTN","MBAAAPIE",67,0)
APTNSAL ;;ALREADY RECORDED AS NO-SHOW... WANT TO ERASE
"RTN","MBAAAPIE",68,0)
APTNSAR ;;THIS APPOINTMENT ALREADY A NO-SHOW AND REBOOKED... ARE YOU SURE YOU WANT TO ERASE
"RTN","MBAAAPIE",69,0)
APTNSIA ;;Inpatient Appointments cannot reflect No-Show status!
"RTN","MBAAAPIE",70,0)
PATDARD ;;PATIENT ALREADY DISCHARGED FROM '^$TXT1^' CLINIC
"RTN","MBAAAPIE",71,0)
PATDNEN ;;>>> Patient not enrolled in '^$TXT1^' clinic.
"RTN","MBAAAPIE",72,0)
PATDHFA ;;PATIENT HAS FUTURE APPOINTMENTS, MUST BE CANCELLED PRIOR TO DISCHARGE !!
"RTN","MBAAAPIE",73,0)
APTDCOD ;;>>> The appointment must have a check out date/time to delete.
"RTN","MBAAAPIE",74,0)
APTDCOO ;;>>> Editing and deleting old encounters not allowed.
"RTN","MBAAAPIE",75,0)
APTCOCE ;;>>> You cannot check out this appointment.
"RTN","MBAAAPIE",76,0)
APTCOTS ;;>>> It is too soon to check out this appointment.
"RTN","MBAAAPIE",77,0)
APTCOCN ;;>>> You cannot check out this appointment.
"RTN","MBAAAPIE",78,0)
APTCOAC ;;Appointment already checked out
"RTN","MBAAAPIE",79,0)
APTCONW ;;Appointment new encounter
"RTN","MBAAAPIE",80,0)
APTCOSU ;;You must have the 'SD SUPERVISOR' key to delete an appointment check out.
"RTN","MBAAAPIE",81,0)
APTWHEN ;;WHEN??
"RTN","MBAADAL1")
0^3^B585387^n/a
"RTN","MBAADAL1",1,0)
MBAADAL1 ;OIT-PD/CBR - CONSULT DAL ;02/10/2016
"RTN","MBAADAL1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAADAL1",3,0)
 ;Associated ICRs
"RTN","MBAADAL1",4,0)
 ;  ICR#
"RTN","MBAADAL1",5,0)
 ;  6052 GMR(123
"RTN","MBAADAL1",6,0)
 ;
"RTN","MBAADAL1",7,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAADAL1",8,0)
 ;GETCONSR(RETURN,DFN,FLDS) ; Get consult requests
"RTN","MBAADAL1",9,0)
 ; N FILE,FIELDS,RET,SCR,LST,SFLS,DL,IN
"RTN","MBAADAL1",10,0)
 ; S FILE=123,FIELDS=".01IE;.02IE;.04IE;.1;8IE;1IE"
"RTN","MBAADAL1",11,0)
 ; S SCR="I $P(^(0),U,2)=$G(DFN)"
"RTN","MBAADAL1",12,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",,,,"F",.SCR,"","LST","ERR")
"RTN","MBAADAL1",13,0)
 ; S IN="",DL="DILIST"
"RTN","MBAADAL1",14,0)
 ; S SFLS("40")="",SFLS("40","N")="COMM",SFLS("40","F")="123.02"
"RTN","MBAADAL1",15,0)
 ; F  S IN=$O(LST(DL,2,IN)) Q:IN=""  D
"RTN","MBAADAL1",16,0)
 ; . N CR
"RTN","MBAADAL1",17,0)
 ; . D GETREC^MBAAMDAL(.CR,LST(DL,2,IN),123,.FLDS,.SFLS,1,1)
"RTN","MBAADAL1",18,0)
 ; . M RETURN(LST(DL,2,IN))=CR
"RTN","MBAADAL1",19,0)
 ; Q
"RTN","MBAADAL1",20,0)
 ;
"RTN","MBAADAL1",21,0)
 ;GETRQSV(RETURN,STPCOD,SRV) ; Get request service
"RTN","MBAADAL1",22,0)
 ; N SCR,ERR
"RTN","MBAADAL1",23,0)
 ; S SCR="I $D(^GMR(123.5,""AB1"","_STPCOD_","_SRV_"))"
"RTN","MBAADAL1",24,0)
 ; D LIST^DIC(123.5,"","","",,,,"AB1",.SCR,"","RETURN","ERR")
"RTN","MBAADAL1",25,0)
 ; Q
"RTN","MBAADAL1",26,0)
 ; ;
"RTN","MBAADAL1",27,0)
 ;GETRQSV1(RETURN,SRV,FLDS,FLAG) ; Get request service by IFN
"RTN","MBAADAL1",28,0)
 ; N DA,DIQ,DIC,DR,GMR
"RTN","MBAADAL1",29,0)
 ; S DIQ="GMR(",DIC="^GMR(123.5,",DIQ(0)=$G(FLAG)
"RTN","MBAADAL1",30,0)
 ; S DA=SRV,DR=FLDS
"RTN","MBAADAL1",31,0)
 ; D EN^DIQ1
"RTN","MBAADAL1",32,0)
 ; M RETURN=GMR(123.5,SRV)
"RTN","MBAADAL1",33,0)
 ; Q
"RTN","MBAADAL1",34,0)
 ;
"RTN","MBAADAL1",35,0)
GETCONS(RETURN,CONS,FLAG) ; Get consult Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAADAL1",36,0)
 N DA,DIQ,DIC,DR,GMR
"RTN","MBAADAL1",37,0)
 S DIQ="GMR(",DIC="^GMR(123,",DIQ(0)=$G(FLAG)  ;ICR#: 6052 GMR(123
"RTN","MBAADAL1",38,0)
 S DA=CONS,DR=".001:70"
"RTN","MBAADAL1",39,0)
 D EN^DIQ1
"RTN","MBAADAL1",40,0)
 M RETURN=GMR(123,CONS)
"RTN","MBAADAL1",41,0)
 Q
"RTN","MBAADAL1",42,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAADAL1",43,0)
 ;CONSLNKD(CONS) ; Return 1 if consult is already linked
"RTN","MBAADAL1",44,0)
 ; Q:'$D(CONS) 0
"RTN","MBAADAL1",45,0)
 ; Q $D(^SC("AWAS1",CONS))
"RTN","MBAADAL1",46,0)
 ; ;
"RTN","MBAALEXT")
0^23^B454239^n/a
"RTN","MBAALEXT",1,0)
MBAALEXT ;OIT-PD/CBR - WAIT LIST API - EXTERNAL FUNCTIONS ;02/13/2015
"RTN","MBAALEXT",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAALEXT",3,0)
 ;
"RTN","MBAALEXT",4,0)
PATDET(RETURN,DFN) ;RETURN PATIENT DETAILS MBAA RPC: MBAA EWL NEW
"RTN","MBAALEXT",5,0)
 Q:'+$G(DFN) 0
"RTN","MBAALEXT",6,0)
 N REC,ERT
"RTN","MBAALEXT",7,0)
 K RETURN
"RTN","MBAALEXT",8,0)
 D GETS^DIQ(2,DFN,".01;.351","IE","REC","ERT")
"RTN","MBAALEXT",9,0)
 S RETURN("NAME")=REC(2,DFN_",",.01,"I")_"^"_REC(2,DFN_",",.01,"E")
"RTN","MBAALEXT",10,0)
 S RETURN("DOD")=REC(2,DFN_",",.351,"I")_"^"_REC(2,DFN_",",.351,"E")
"RTN","MBAALEXT",11,0)
 Q 1
"RTN","MBAALEXT",12,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAALEXT",13,0)
 ;INSTFMST(STN) ;RETURNS INSTITUTION NAME FROM STATION NUMBER
"RTN","MBAALEXT",14,0)
 ; N INSTIEN
"RTN","MBAALEXT",15,0)
 ; S INSTIEN=$$FIND1^DIC(4,"","X",STN,"D")
"RTN","MBAALEXT",16,0)
 ; Q $$GET1^DIQ(4,INSTIEN,60)
"RTN","MBAALEXT",17,0)
 ; ;
"RTN","MBAALEXT",18,0)
 ;SELPAT() ;SELECT PATIENT
"RTN","MBAALEXT",19,0)
 ; N DIC,X,Y
"RTN","MBAALEXT",20,0)
 ; S DIC=2
"RTN","MBAALEXT",21,0)
 ; S DIC(0)="AEMQZ"
"RTN","MBAALEXT",22,0)
 ; D ^DIC
"RTN","MBAALEXT",23,0)
 ; Q $S($D(DTOUT):-1,$D(DUOUT):-1,(Y<0):-1,1:+Y)
"RTN","MBAALEXT",24,0)
 ; ;
"RTN","MBAAMAP1")
0^4^B37295947^n/a
"RTN","MBAAMAP1",1,0)
MBAAMAP1 ;OIT-PD/VSL - APPOINTMENT API ;02/10/2016
"RTN","MBAAMAP1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAMAP1",3,0)
 ;
"RTN","MBAAMAP1",4,0)
 ;Associated ICRs
"RTN","MBAAMAP1",5,0)
 ;  ICR#
"RTN","MBAAMAP1",6,0)
 ;  10104 XLFSTR
"RTN","MBAAMAP1",7,0)
 ;  10103 XLFDT
"RTN","MBAAMAP1",8,0)
 ;
"RTN","MBAAMAP1",9,0)
 ;code removed below is scheduled for a future release of MBAA
"RTN","MBAAMAP1",10,0)
CLNCK(RETURN,CLN) ;Check clinic for valid stop code restriction. Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP1",11,0)
 ;  INPUT:   CLN   = IEN of Clinic
"RTN","MBAAMAP1",12,0)
 ;
"RTN","MBAAMAP1",13,0)
 ;  OUTPUT:  1 if no error or 0^error message
"RTN","MBAAMAP1",14,0)
 N PSC,SSC,ND0,VAL,FLDS
"RTN","MBAAMAP1",15,0)
 S RETURN=0
"RTN","MBAAMAP1",16,0)
 I CLN="" D ERRX^MBAAAPIE(.RETURN,"CLNINV") Q 0
"RTN","MBAAMAP1",17,0)
 D GETCLN^MBAAMDA1(.FLDS,CLN,1,0,0)
"RTN","MBAAMAP1",18,0)
 I '$D(FLDS) D ERRX^MBAAAPIE(.RETURN,"CLNNDFN") Q 0
"RTN","MBAAMAP1",19,0)
 I $G(FLDS(2))'="C" Q 1     ;not a Clinic
"RTN","MBAAMAP1",20,0)
 S %=$$SCREST(.RETURN,FLDS(8),"P")
"RTN","MBAAMAP1",21,0)
 Q:'% %  Q:FLDS(2503)="" 1
"RTN","MBAAMAP1",22,0)
 S %=$$SCREST(.RETURN,FLDS(2503),"S")
"RTN","MBAAMAP1",23,0)
 S RETURN=%
"RTN","MBAAMAP1",24,0)
 Q RETURN
"RTN","MBAAMAP1",25,0)
 ;
"RTN","MBAAMAP1",26,0)
SCREST(RETURN,SCIEN,TYP) ;check stop code restriction in file 40.7 for a clinic. MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP1",27,0)
 ;  INPUT:   SCIEN = IEN of Stop Code
"RTN","MBAAMAP1",28,0)
 ;           TYP   = Stop Code Type, Primary (P) or Secondary (S)
"RTN","MBAAMAP1",29,0)
 ;           DIS   = Message Display, 1 - Display or 0 No Display
"RTN","MBAAMAP1",30,0)
 ;
"RTN","MBAAMAP1",31,0)
 ;  OUTPUT:  1 if no error, or 0^error message
"RTN","MBAAMAP1",32,0)
 ;          
"RTN","MBAAMAP1",33,0)
 N SCN,RTY,CTY,RDT,STR,STYP,FLDS,TEXT
"RTN","MBAAMAP1",34,0)
 S STYP="("_$S(TYP="P":"Prim",1:"Second")_"ary)"
"RTN","MBAAMAP1",35,0)
 S RETURN=0
"RTN","MBAAMAP1",36,0)
 I +SCIEN<1 S TEXT(1)=STYP D ERRX^MBAAAPIE(.RETURN,"CLNSCIN",.TEXT) Q 0
"RTN","MBAAMAP1",37,0)
 S CTY=$S(TYP="P":"^P^E^",1:"^S^E^")
"RTN","MBAAMAP1",38,0)
 D GETCSC^MBAAMDA1(.FLDS,SCIEN)
"RTN","MBAAMAP1",39,0)
 S RTY=$G(FLDS(5)),RDT=$G(FLDS(6))
"RTN","MBAAMAP1",40,0)
 I RTY="" D  Q 0
"RTN","MBAAMAP1",41,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=STYP
"RTN","MBAAMAP1",42,0)
 . D ERRX^MBAAAPIE(.RETURN,"CLNSCNR",.TEXT)
"RTN","MBAAMAP1",43,0)
 I CTY'[("^"_RTY_"^") D  Q 0
"RTN","MBAAMAP1",44,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=$S(TYP="P":"Prim",1:"Second")_"ary"
"RTN","MBAAMAP1",45,0)
 . D ERRX^MBAAAPIE(.RETURN,"CLNSCPS",.TEXT)
"RTN","MBAAMAP1",46,0)
 I RDT>DT D  Q 0
"RTN","MBAAMAP1",47,0)
 . S TEXT(1)=$G(FLDS(1)),TEXT(2)=$$FMTE^XLFDT(RDT,"1F"),TEXT(3)=STYP  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP1",48,0)
 . D ERRX^MBAAAPIE(.RETURN,"CLNSCRD",.TEXT)
"RTN","MBAAMAP1",49,0)
 S RETURN=1
"RTN","MBAAMAP1",50,0)
 Q 1
"RTN","MBAAMAP1",51,0)
 ; ;
"RTN","MBAAMAP1",52,0)
GETCLN(RETURN,CLN) ; Get Clinic data MBAA RPC: MBAA PATIENT PENDING APPT
"RTN","MBAAMAP1",53,0)
 ;  INPUT:   CLN = IEN of Clinic
"RTN","MBAAMAP1",54,0)
 N DATA
"RTN","MBAAMAP1",55,0)
 S RETURN=0
"RTN","MBAAMAP1",56,0)
 D GETCLN^MBAAMDA1(.DATA,CLN,1,1,1)
"RTN","MBAAMAP1",57,0)
 I '$D(DATA) D ERRX^MBAAAPIE(.RETURN,"CLNNFND") Q 0
"RTN","MBAAMAP1",58,0)
 M RETURN=DATA
"RTN","MBAAMAP1",59,0)
 S RETURN=1
"RTN","MBAAMAP1",60,0)
 Q 1
"RTN","MBAAMAP1",61,0)
 ;
"RTN","MBAAMAP1",62,0)
 ;LSTCLNS(RETURN,SEARCH,START,NUMBER) ; Return clinics filtered by name.
"RTN","MBAAMAP1",63,0)
 ; N LST
"RTN","MBAAMAP1",64,0)
 ; D LSTCLNS^MBAAMDA1(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","MBAAMAP1",65,0)
 ; D BLDLST^MBAAMAPI(.RETURN,.LST)
"RTN","MBAAMAP1",66,0)
 ; Q 1
"RTN","MBAAMAP1",67,0)
 ; ;
"RTN","MBAAMAP1",68,0)
CLNRGHT(RETURN,CLN) ; Verifies (DUZ) user access to Clinic Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMAP1",69,0)
 N DATA,TXT
"RTN","MBAAMAP1",70,0)
 S RETURN=0
"RTN","MBAAMAP1",71,0)
 D GETCLN^MBAAMDA1(.DATA,CLN,1)
"RTN","MBAAMAP1",72,0)
 I DATA(2500)="Y"  D  Q RETURN
"RTN","MBAAMAP1",73,0)
 . I $D(DATA(2501,DUZ,.01))>0 S RETURN=1 Q
"RTN","MBAAMAP1",74,0)
 . E  D
"RTN","MBAAMAP1",75,0)
 . . S RETURN=0 S TXT(1)=DATA(.01),TXT(2)=$C(10)
"RTN","MBAAMAP1",76,0)
 . . D ERRX^MBAAAPIE(.RETURN,"CLNURGT",.TXT)
"RTN","MBAAMAP1",77,0)
 . . S RETURN("CLN")=DATA(.01)
"RTN","MBAAMAP1",78,0)
 E  S RETURN=1 Q 1
"RTN","MBAAMAP1",79,0)
 ;
"RTN","MBAAMAP1",80,0)
 ;CLNVSC(RETURN,SC) ; Verifies clinic stop code validation
"RTN","MBAAMAP1",81,0)
 ; N DATA
"RTN","MBAAMAP1",82,0)
 ; S RETURN=0
"RTN","MBAAMAP1",83,0)
 ; D GETCSC^MBAAMDA1(.DATA,+SC)
"RTN","MBAAMAP1",84,0)
 ; I $S('$D(DATA):1,'DATA(2):0,1:$G(DATA(2))'>DT) D  Q RETURN
"RTN","MBAAMAP1",85,0)
 ; . S TEXT(1)=+SC
"RTN","MBAAMAP1",86,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"CLNSCIN",.TEXT)
"RTN","MBAAMAP1",87,0)
 ; . S RETURN=0
"RTN","MBAAMAP1",88,0)
 ; S RETURN=1
"RTN","MBAAMAP1",89,0)
 ; Q RETURN
"RTN","MBAAMAP1",90,0)
 ;
"RTN","MBAAMAP1",91,0)
GETSCAP(RETURN,SC,DFN,SD) ; Get clinic appointment Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMAP1",92,0)
 N NOD0,CO
"RTN","MBAAMAP1",93,0)
 I '$D(DFN)!(+$G(DFN)'>0) S RETURN=0,TXT(1)="DFN" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP1",94,0)
 I '$D(SC)!(+$G(SC)'>0) S RETURN=0,TXT(1)="SC" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP1",95,0)
 I '$D(SD)!(+$G(SD)'>0) S RETURN=0,TXT(1)="SD" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP1",96,0)
 D GETSCAP^MBAAMDA1(.RETURN,+SC,+DFN,+SD)
"RTN","MBAAMAP1",97,0)
 I $D(RETURN) D
"RTN","MBAAMAP1",98,0)
 . S NOD0=RETURN(0),CO=$G(RETURN("C"))
"RTN","MBAAMAP1",99,0)
 . S RETURN("IFN")=RETURN
"RTN","MBAAMAP1",100,0)
 . S RETURN("USER")=$P(NOD0,U,6)
"RTN","MBAAMAP1",101,0)
 . S RETURN("DATE")=$P(NOD0,U,7)
"RTN","MBAAMAP1",102,0)
 . S RETURN("CHECKOUT")=$P(CO,U,3)
"RTN","MBAAMAP1",103,0)
 . S RETURN("CHECKIN")=$P(CO,U,1)
"RTN","MBAAMAP1",104,0)
 . S RETURN("LENGTH")=$P(NOD0,U,2)
"RTN","MBAAMAP1",105,0)
 . S RETURN("CONSULT")=$P(NOD0,U,11)
"RTN","MBAAMAP1",106,0)
 Q 1
"RTN","MBAAMAP1",107,0)
 ;
"RTN","MBAAMAP1",108,0)
SLOTS(RETURN,SC) ; Get available slots MBAA RPC: MBAA GET CLINIC AVAILABILITY
"RTN","MBAAMAP1",109,0)
 D SLOTS^MBAAMDA2(.RETURN,SC)
"RTN","MBAAMAP1",110,0)
 S RETURN=1
"RTN","MBAAMAP1",111,0)
 Q 1
"RTN","MBAAMAP1",112,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP1",113,0)
 ;SCEXST(RETURN,CSC) ; Get Stop Cod Exception status
"RTN","MBAAMAP1",114,0)
 ; N RET,LAST
"RTN","MBAAMAP1",115,0)
 ; D SCEXST^MBAAMDA2(.RET,CSC)
"RTN","MBAAMAP1",116,0)
 ; S RETURN=RET
"RTN","MBAAMAP1",117,0)
 ; I RET>0 S LAST=99999999999,LAST=$O(RET("EFFECTIVE DATE",LAST),-1) D
"RTN","MBAAMAP1",118,0)
 ; . M RETURN=RET("EFFECTIVE DATE",LAST)
"RTN","MBAAMAP1",119,0)
 ; Q RETURN
"RTN","MBAAMAP1",120,0)
 ; ;
"RTN","MBAAMAP1",121,0)
LSTAPPT(RETURN,SEARCH,START,NUMBER) ; Lists appointment types MBAA RPC: MBAA APPOINTMENT LIST BY NAME
"RTN","MBAAMAP1",122,0)
 N RET,DL,IN
"RTN","MBAAMAP1",123,0)
 S:'$D(START) START="" S:'$D(SEARCH) SEARCH=""
"RTN","MBAAMAP1",124,0)
 S:'$G(NUMBER) NUMBER=""
"RTN","MBAAMAP1",125,0)
 S RETURN=0
"RTN","MBAAMAP1",126,0)
 D LSTAPPT^MBAAMDA2(.RET,$$UP^XLFSTR(SEARCH),.START,NUMBER)  ;ICR#: 10104 XLFSTR
"RTN","MBAAMAP1",127,0)
 S RETURN(0)=RET("DILIST",0)
"RTN","MBAAMAP1",128,0)
 S DL="DILIST"
"RTN","MBAAMAP1",129,0)
 F IN=1:1:$P(RETURN(0),U,1) D
"RTN","MBAAMAP1",130,0)
 . S RETURN(IN)=""
"RTN","MBAAMAP1",131,0)
 . S RETURN(IN,"ID")=RET(DL,2,IN)
"RTN","MBAAMAP1",132,0)
 . S RETURN(IN,"NAME")=RET(DL,"ID",IN,".01")
"RTN","MBAAMAP1",133,0)
 S RETURN=1
"RTN","MBAAMAP1",134,0)
 Q 1
"RTN","MBAAMAP1",135,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP1",136,0)
 ;GETAPPT(RETURN,TYPE) ; Returns Appointment Type detail
"RTN","MBAAMAP1",137,0)
 ; D GETAPPT^MBAAMDA2(.RETURN,TYPE,1,1,1)
"RTN","MBAAMAP1",138,0)
 ; S RETURN=1
"RTN","MBAAMAP1",139,0)
 ; Q 1
"RTN","MBAAMAP1",140,0)
 ; ;
"RTN","MBAAMAP1",141,0)
 ;GETELIG(RETURN,ELIG) ; Returns Eligibility Code detail 
"RTN","MBAAMAP1",142,0)
 ; D GETELIG^MBAAMDA2(.RETURN,ELIG,1,1,1)
"RTN","MBAAMAP1",143,0)
 ; S RETURN=1
"RTN","MBAAMAP1",144,0)
 ; Q 1
"RTN","MBAAMAP1",145,0)
 ; ;
"RTN","MBAAMAP1",146,0)
 ;GETPEND(RETURN,DFN,DT) ; Get pending appointments
"RTN","MBAAMAP1",147,0)
 ; N CNT,SCAP,APP,CLN,%
"RTN","MBAAMAP1",148,0)
 ; S CNT=""
"RTN","MBAAMAP1",149,0)
 ; D GETPEND^MBAAMDA2(.APP,DFN,DT)
"RTN","MBAAMAP1",150,0)
 ; F  S CNT=$O(APP(CNT)) Q:CNT=""  D
"RTN","MBAAMAP1",151,0)
 ; . S RETURN(CNT,"COLLATERAL VISIT")=APP(CNT,13)
"RTN","MBAAMAP1",152,0)
 ; . S RETURN(CNT,"APPOINTMENT TYPE")=$$APTYNAME^MBAAMDA2(APP(CNT,9.5))
"RTN","MBAAMAP1",153,0)
 ; . S RETURN(CNT,"LAB")=APP(CNT,2)
"RTN","MBAAMAP1",154,0)
 ; . S RETURN(CNT,"XRAY")=APP(CNT,3)
"RTN","MBAAMAP1",155,0)
 ; . S RETURN(CNT,"EKG")=APP(CNT,4)
"RTN","MBAAMAP1",156,0)
 ; . S %=$$GETCLN^MBAAMAP1(.CLN,APP(CNT,.01))
"RTN","MBAAMAP1",157,0)
 ; . S RETURN(CNT,"CLINIC")=$P(CLN("NAME"),U,2)
"RTN","MBAAMAP1",158,0)
 ; . S %=$$GETSCAP^MBAAMAP1(.SCAP,APP(CNT,.01),DFN,CNT)
"RTN","MBAAMAP1",159,0)
 ; . S RETURN(CNT,"LENGTH OF APP'T")=$G(SCAP("LENGTH"))
"RTN","MBAAMAP1",160,0)
 ; . S RETURN(CNT,"CONSULT LINK")=$G(SCAP("CONSULT"))
"RTN","MBAAMAP1",161,0)
 ; S RETURN=($D(RETURN)>0)
"RTN","MBAAMAP1",162,0)
 ; Q 1
"RTN","MBAAMAP1",163,0)
 ; ;
"RTN","MBAAMAP1",164,0)
 ;GETAPTS(RETURN,DFN,SD) ; Get patient appointments
"RTN","MBAAMAP1",165,0)
 ; S DFN=+DFN
"RTN","MBAAMAP1",166,0)
 ; D GETAPTS^MBAAMDA2(.RETURN,+DFN,.SD)
"RTN","MBAAMAP1",167,0)
 ; S RETURN=($D(RETURN)>0)
"RTN","MBAAMAP1",168,0)
 ; Q 1
"RTN","MBAAMAP1",169,0)
 ; ;
"RTN","MBAAMAP1",170,0)
LSTCRSNS(RETURN,SEARCH,START,NUMBER) ; MBAA RPC: MBAA LIST CANCELLATION REASONS
"RTN","MBAAMAP1",171,0)
 N LST
"RTN","MBAAMAP1",172,0)
 M LST=RETURN
"RTN","MBAAMAP1",173,0)
 D LSTCRSNS^MBAAMDA2(.LST,$$UP^XLFSTR($G(SEARCH)),.START,$G(NUMBER))
"RTN","MBAAMAP1",174,0)
 D BLDLST^MBAAMAPI(.RETURN,.LST)
"RTN","MBAAMAP1",175,0)
 Q RETURN
"RTN","MBAAMAP1",176,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP1",177,0)
 ;FRSTAVBL(RETURN,SC) ; Get first available date
"RTN","MBAAMAP1",178,0)
 ; D FRSTAVBL^MBAAMDA2(.RETURN,SC)
"RTN","MBAAMAP1",179,0)
 ; Q 1
"RTN","MBAAMAP1",180,0)
 ; ;
"RTN","MBAAMAP1",181,0)
 ;linetag LSTCAPTS is removed, it is not needed until the next enhancement of MBAA
"RTN","MBAAMAP1",182,0)
 ;LSTCAPTS(RETURN,SC,SDBEG,SDEND,STAT) ; Returns clinic appointments filtered by date and status
"RTN","MBAAMAP1",183,0)
 ;N APTS,CNT,IND,FAPTS,GROUPS
"RTN","MBAAMAP1",184,0)
 ;S CNT=0,IND=0
"RTN","MBAAMAP1",185,0)
 ;S RETURN=0
"RTN","MBAAMAP1",186,0)
 ;D GROUP^SDAM($P(STAT,U),.GROUPS)
"RTN","MBAAMAP1",187,0)
 ;D LSTCAPTS^MBAAMDA1(.APTS,SC,.SDBEG,.SDEND)
"RTN","MBAAMAP1",188,0)
 ;D BLDAPTS(.RETURN,.APTS,SC,,.GROUPS)
"RTN","MBAAMAP1",189,0)
 ;S RETURN=1
"RTN","MBAAMAP1",190,0)
 ;Q 1
"RTN","MBAAMAP1",191,0)
 ;
"RTN","MBAAMAP1",192,0)
 ;linetag LSTPAPTS is removed, this functionality is not needed until a future enhancement of MBAA
"RTN","MBAAMAP1",193,0)
 ;LSTPAPTS(RETURN,DFN,SDBEG,SDEND,STAT) ; Returns patient appointments filtered by date and status
"RTN","MBAAMAP1",194,0)
 ;N APTS,CNT,IND,FAPTS,GROUPS
"RTN","MBAAMAP1",195,0)
 ;S CNT=0,IND=0
"RTN","MBAAMAP1",196,0)
 ;S RETURN=0
"RTN","MBAAMAP1",197,0)
 ;D GROUP^SDAM($P(STAT,U),.GROUPS)
"RTN","MBAAMAP1",198,0)
 ;D LSTPAPTS^MBAAMDA1(.APTS,DFN,.SDBEG,.SDEND)
"RTN","MBAAMAP1",199,0)
 ;D BLDAPTS(.RETURN,.APTS,,DFN,.GROUPS)
"RTN","MBAAMAP1",200,0)
 ;S RETURN=1
"RTN","MBAAMAP1",201,0)
 ;Q 1
"RTN","MBAAMAP1",202,0)
 ;
"RTN","MBAAMAP1",203,0)
 ;linetag BLDAPTS is removed, it is not needed until the next enhancement of MBAA
"RTN","MBAAMAP1",204,0)
 ;BLDAPTS(RETURN,APTS,SSC,SDFN,GROUPS) ; Build appointment list
"RTN","MBAAMAP1",205,0)
 ;N IND,DFN,SC,VA,VADM,CDATA,SDATA,SDDA,SDSTAT,CAPT,PAPT
"RTN","MBAAMAP1",206,0)
 ;F IND=0:0 S IND=$O(APTS(IND)) Q:IND=""  D
"RTN","MBAAMAP1",207,0)
 ;. S SDATA=APTS(IND,"SDATA")
"RTN","MBAAMAP1",208,0)
 ;. Q:'$G(SDFN)&($P(SDATA,U,2)["C")
"RTN","MBAAMAP1",209,0)
 ;. S DFN=$S('$G(SDFN):+APTS(IND,"CDATA"),1:SDFN)
"RTN","MBAAMAP1",210,0)
 ;. S SD=APTS(IND,"SD")
"RTN","MBAAMAP1",211,0)
 ;. S SC=$S('$G(SSC):APTS(IND,"SC"),1:SSC)
"RTN","MBAAMAP1",212,0)
 ;. S SDDA=APTS(IND,"SDDA")
"RTN","MBAAMAP1",213,0)
 ;. S CDATA=$G(APTS(IND,"CDATA"))
"RTN","MBAAMAP1",214,0)
 ;. S SDSTAT=$$STATUS^SDAM1(DFN,SD,SC,SDATA,$S($D(SDDA):SDDA,1:""))
"RTN","MBAAMAP1",215,0)
 ;. Q:'$$CHK^SDAM1(,,,,.GROUPS,SDSTAT)
"RTN","MBAAMAP1",216,0)
 ;. Q:$G(SSC)&(($P(CDATA,U,9)="C")!($P(SDATA,U,2)["C")&($G(SC)))
"RTN","MBAAMAP1",217,0)
 ;. S CNT=CNT+1
"RTN","MBAAMAP1",218,0)
 ;. D 2^VADPT
"RTN","MBAAMAP1",219,0)
 ;. S RETURN(CNT,"BID")=VA("BID")
"RTN","MBAAMAP1",220,0)
 ;. S RETURN(CNT,"NAME")=VADM(1)
"RTN","MBAAMAP1",221,0)
 ;. D GETPAPT^MBAAMDA4(.PAPT,DFN,SD)
"RTN","MBAAMAP1",222,0)
 ;. S RETURN(CNT,"GAF")=$$GAFREQ(DFN,SC,$P(SDATA,U,11))
"RTN","MBAAMAP1",223,0)
 ;. S RETURN(CNT,"SD")=SD
"RTN","MBAAMAP1",224,0)
 ;. S RETURN(CNT,"STAT")=SDSTAT
"RTN","MBAAMAP1",225,0)
 ;. S RETURN(CNT,"STATI")=PAPT(3,"I")
"RTN","MBAAMAP1",226,0)
 ;. S RETURN(CNT,"OE")=PAPT(21,"I")
"RTN","MBAAMAP1",227,0)
 ;. S RETURN(CNT,"DFN")=DFN
"RTN","MBAAMAP1",228,0)
 ;. S RETURN(CNT,"LAB")=$P(SDATA,U,3)
"RTN","MBAAMAP1",229,0)
 ;. S RETURN(CNT,"XRAY")=$P(SDATA,U,4)
"RTN","MBAAMAP1",230,0)
 ;. S RETURN(CNT,"EKG")=$P(SDATA,U,5)
"RTN","MBAAMAP1",231,0)
 ;. S RETURN(CNT,"SC")=SC
"RTN","MBAAMAP1",232,0)
 ;. D GETCAPT^MBAAMDA4(.CAPT,DFN,SD)
"RTN","MBAAMAP1",233,0)
 ;. S RETURN(CNT,"LEN")=CAPT(1)
"RTN","MBAAMAP1",234,0)
 ;. S RETURN(CNT,"CLINIC")=PAPT(.01,"E")
"RTN","MBAAMAP1",235,0)
 ;. S RETURN(CNT,"SDDA")=APTS(IND,"SDDA")
"RTN","MBAAMAP1",236,0)
 ;. S:$G(APTS(IND,"CONS"))>0 RETURN(CNT,"CSTAT")=$$CNSSTAT^MBAAMEXT(APTS(IND,"CONS"))
"RTN","MBAAMAP1",237,0)
 ;Q
"RTN","MBAAMAP1",238,0)
 ;
"RTN","MBAAMAP1",239,0)
 ;GAFREQ(DFN,SC,CVSIT) ;
"RTN","MBAAMAP1",240,0)
 ; N SDELIG,SDGAF,SDGAFST
"RTN","MBAAMAP1",241,0)
 ; S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","MBAAMAP1",242,0)
 ; I $$MHCLIN^SDUTL2(SC),'($$COLLAT^SDUTL2(SDELIG)!$G(CVSIT)) D  Q SDGAFST
"RTN","MBAAMAP1",243,0)
 ; . S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^") Q
"RTN","MBAAMAP1",244,0)
 ; Q 0
"RTN","MBAAMAP1",245,0)
 ; ;
"RTN","MBAAMAP1",246,0)
 ;GETCSC(RETURN,SC) ; Get clinic stop code
"RTN","MBAAMAP1",247,0)
 ; N CLN
"RTN","MBAAMAP1",248,0)
 ; D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP1",249,0)
 ; D GETCSC^MBAAMDA1(.RETURN,$G(CLN(8)))
"RTN","MBAAMAP1",250,0)
 ; S RETURN=1
"RTN","MBAAMAP1",251,0)
 ; Q 1
"RTN","MBAAMAP1",252,0)
 ; ;
"RTN","MBAAMAP1",253,0)
CPAIR(RETURN,SC) ;Validate primary stop code, get credit pair MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP1",254,0)
 ;Input: SC=HOSPITAL LOCATION record IFN
"RTN","MBAAMAP1",255,0)
 ;Input: RETURN=variable to return clinic credit pair (pass by reference)
"RTN","MBAAMAP1",256,0)
 ;Output: 1=success, 0=invalid primary stop code
"RTN","MBAAMAP1",257,0)
 N SDSSC
"RTN","MBAAMAP1",258,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP1",259,0)
 D GETCSC^MBAAMDA1(.CS,CLN(8))
"RTN","MBAAMAP1",260,0)
 S RETURN=$G(CS(1)),RETURN=$S(RETURN<100:0,RETURN>999:0,1:RETURN)
"RTN","MBAAMAP1",261,0)
 Q:RETURN'>0 0
"RTN","MBAAMAP1",262,0)
 K CS D GETCSC^MBAAMDA1(.CS,CLN(2503))
"RTN","MBAAMAP1",263,0)
 S SDSSC=$G(CS(1)),RETURN=RETURN_$S(SDSSC<100:"000",SDSSC>999:"000",1:SDSSC)
"RTN","MBAAMAP1",264,0)
 Q 1
"RTN","MBAAMAP1",265,0)
 ;
"RTN","MBAAMAP1",266,0)
PTFU(RETURN,DFN,SC)    ;Determine if this is a follow-up (return to clinic within 24 months) Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP1",267,0)
 ;Input: DFN=patient ifn
"RTN","MBAAMAP1",268,0)
 ;Input: SC=clinic ifn
"RTN","MBAAMAP1",269,0)
 ;Output: '1' if seen within 24 months, '0' otherwise
"RTN","MBAAMAP1",270,0)
 ;
"RTN","MBAAMAP1",271,0)
 Q:'DFN!'SC 0  ;variable check
"RTN","MBAAMAP1",272,0)
 S RETURN=1
"RTN","MBAAMAP1",273,0)
 N SDBDT,SDT,SDX,SDY,SDZ,SDCP,SDCP1,SC0,SDENC,SDCT,LST,ENC,FLDS
"RTN","MBAAMAP1",274,0)
 ;set up variables
"RTN","MBAAMAP1",275,0)
 S SDBDT=(DT-20000)+.24,SDT=DT_.999999,SDY=0
"RTN","MBAAMAP1",276,0)
 S SDX=$$CPAIR(.SDCP,SC)  ;get credit pair for this clinic
"RTN","MBAAMAP1",277,0)
 ;Iterate through encounters
"RTN","MBAAMAP1",278,0)
 D LSTAENC^MBAAMDA1(.LST,DFN)
"RTN","MBAAMAP1",279,0)
 S FLDS(.04)="CLINIC",FLDS(.06)="PARENT"
"RTN","MBAAMAP1",280,0)
 D BLDLST^MBAAMAPI(.ENC,.LST,.FLDS)
"RTN","MBAAMAP1",281,0)
 F  S SDT=$O(ENC(SDT),-1) Q:'SDT!SDY  D
"RTN","MBAAMAP1",282,0)
 . Q:ENC(SDT,"PARENT")]""  ;parent encounters only
"RTN","MBAAMAP1",283,0)
 . Q:ENC(SDT,"NAME")<SDBDT
"RTN","MBAAMAP1",284,0)
 . S SDX=$$CPAIR(.SDCP1,ENC(SDT,"CLINIC"))  ;get credit pair for encounter
"RTN","MBAAMAP1",285,0)
 . S SDY=SDCP=SDCP1  ;compare credit pairs
"RTN","MBAAMAP1",286,0)
 . Q
"RTN","MBAAMAP1",287,0)
 Q SDY
"RTN","MBAAMAP1",288,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP1",289,0)
 ;HASPEND(RETURN,DFN,DT) ; Check if patient has panding appointments
"RTN","MBAAMAP1",290,0)
 ; D HASPEND^MBAAMDA2(.RETURN,DFN,DT)
"RTN","MBAAMAP1",291,0)
 ; Q 1
"RTN","MBAAMAP1",292,0)
 ; ;
"RTN","MBAAMAP1",293,0)
 ;LSTSRT(RETURN) ;List scheduling request types
"RTN","MBAAMAP1",294,0)
 ; K RETURN
"RTN","MBAAMAP1",295,0)
 ; S RETURN=1
"RTN","MBAAMAP1",296,0)
 ; D LSTSCOD^MBAAMDAL(2.98,25,.RETURN)
"RTN","MBAAMAP1",297,0)
 ; Q 1
"RTN","MBAAMAP1",298,0)
 ; ;
"RTN","MBAAMAP1",299,0)
 ;LSTAPPST(RETURN) ;List appointment statuses
"RTN","MBAAMAP1",300,0)
 ; K RETURN
"RTN","MBAAMAP1",301,0)
 ; S RETURN=1
"RTN","MBAAMAP1",302,0)
 ; D LSTSCOD^MBAAMDAL(2.98,3,.RETURN)
"RTN","MBAAMAP1",303,0)
 ; Q 1
"RTN","MBAAMAP1",304,0)
 ; ;
"RTN","MBAAMAP1",305,0)
 ;LSTHLTP(RETURN) ;List hospital location types
"RTN","MBAAMAP1",306,0)
 ; K RETURN
"RTN","MBAAMAP1",307,0)
 ; S RETURN=1
"RTN","MBAAMAP1",308,0)
 ; D LSTSCOD^MBAAMDAL(44,2,.RETURN)
"RTN","MBAAMAP1",309,0)
 ; Q 1
"RTN","MBAAMAP1",310,0)
 ;
"RTN","MBAAMAP2")
0^5^B71740579^n/a
"RTN","MBAAMAP2",1,0)
MBAAMAP2 ;OIT-PD/VSL - APPOINTMENT API ;02/10/2016
"RTN","MBAAMAP2",2,0)
 ;;1.0;Scheduling Calendar View;**1**;May 5, 2015;Build 85
"RTN","MBAAMAP2",3,0)
 ;
"RTN","MBAAMAP2",4,0)
 ;Associated ICRs
"RTN","MBAAMAP2",5,0)
 ;  ICR#
"RTN","MBAAMAP2",6,0)
 ;  5838 SDAMEVT
"RTN","MBAAMAP2",7,0)
 ;  6048 SDAMEVT
"RTN","MBAAMAP2",8,0)
 ;  6054 MBAA USE OF SDAM2 API get inpatient data
"RTN","MBAAMAP2",9,0)
 ;  6049 MBAA SDMANA API USE
"RTN","MBAAMAP2",10,0)
 ;  5838 SDAMEVT
"RTN","MBAAMAP2",11,0)
 ;
"RTN","MBAAMAP2",12,0)
CHKAPP(RETURN,SC,DFN,SD,LEN,LVL) ; Check make appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",13,0)
 N PAT,CLN,VAL,PATT,HOL,TXT,X1,X2,APT,CAPT,FRSTA,SDEDT,SDSOH,%
"RTN","MBAAMAP2",14,0)
 K RETURN
"RTN","MBAAMAP2",15,0)
 S RETURN=1
"RTN","MBAAMAP2",16,0)
 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",17,0)
 D GETPAT^MBAAMDA3(.PAT,DFN,1) ; get patient data
"RTN","MBAAMAP2",18,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1) ; get clinic data
"RTN","MBAAMAP2",19,0)
 ;check patient, stop code and inactive
"RTN","MBAAMAP2",20,0)
 S %=$$CHKAPTU(.RETURN,SC,DFN,SD,.CLN,.PAT) Q:RETURN=0 0
"RTN","MBAAMAP2",21,0)
 ;check user permissions
"RTN","MBAAMAP2",22,0)
 S VAL=$$CLNRGHT^MBAAMAP1(.RETURN,SC) Q:VAL=0 VAL
"RTN","MBAAMAP2",23,0)
 S %=$$SETST^MBAAMAP4(.RETURN,SC,SD) Q:RETURN=0 0
"RTN","MBAAMAP2",24,0)
 ;verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","MBAAMAP2",25,0)
 D GETPATT^MBAAMDA1(.PATT,SC,SD) I $G(PATT(0))'["[" S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCLUV") Q 0
"RTN","MBAAMAP2",26,0)
 ;check if schedule on holiday is permited
"RTN","MBAAMAP2",27,0)
 D GETHOL^MBAAMDA1(.HOL,$P(SD,"."))
"RTN","MBAAMAP2",28,0)
 S SDSOH=$S('$D(CLN(1918.5)):0,CLN(1918.5)']"":0,1:1)
"RTN","MBAAMAP2",29,0)
 I $D(HOL(0)),'SDSOH S TXT(1)=$P(HOL(0),U,2) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTSHOL",.TXT) Q 0
"RTN","MBAAMAP2",30,0)
 ;check if exceed max days for future appointment
"RTN","MBAAMAP2",31,0)
 S X1=DT,SDEDT=$G(CLN(2002))
"RTN","MBAAMAP2",32,0)
 S:SDEDT'>0 SDEDT=365
"RTN","MBAAMAP2",33,0)
 S X2=SDEDT D C^%DTC S SDEDT=X
"RTN","MBAAMAP2",34,0)
 I $P(SD,".")'<SDEDT S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTEXCD") Q 0
"RTN","MBAAMAP2",35,0)
 ;check if patient has an active appointment on the same time
"RTN","MBAAMAP2",36,0)
 D GETAPTS^MBAAMDA2(.APT,DFN,SD)
"RTN","MBAAMAP2",37,0)
 I $D(APT),APT("APT",SD,"STATUS")'["C"  D
"RTN","MBAAMAP2",38,0)
 . S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD) Q:'$D(CAPT)
"RTN","MBAAMAP2",39,0)
 . S TXT(1)="("_CAPT("LENGTH")_" MINUTES)"
"RTN","MBAAMAP2",40,0)
 . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPAHA",.TXT,2)
"RTN","MBAAMAP2",41,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",42,0)
 ;check if patient has an active appointment on the same day
"RTN","MBAAMAP2",43,0)
 I LVL>2 D
"RTN","MBAAMAP2",44,0)
 . K APT N IDX S IDX=""
"RTN","MBAAMAP2",45,0)
 . D GETDAPTS^MBAAMDA2(.APT,DFN,$P(SD,"."))
"RTN","MBAAMAP2",46,0)
 . F  S IDX=$O(APT(IDX)) Q:IDX=""  I APT(IDX,2)'["C"  D  Q
"RTN","MBAAMAP2",47,0)
 . . K TXT S TXT(1)="(AT "_$E(IDX_0,9,10)_":"_$E(IDX_"000",11,12)_")"
"RTN","MBAAMAP2",48,0)
 . . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPHSD",.TXT,3)
"RTN","MBAAMAP2",49,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",50,0)
 ;check if patient has an canceled appointment on the same time
"RTN","MBAAMAP2",51,0)
 I LVL'<2 D
"RTN","MBAAMAP2",52,0)
 . K APT
"RTN","MBAAMAP2",53,0)
 . D GETAPTS^MBAAMDA2(.APT,DFN,SD)
"RTN","MBAAMAP2",54,0)
 . I $D(APT),APT("APT",SD,"STATUS")["P" D 
"RTN","MBAAMAP2",55,0)
 . . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPPCP",,2)
"RTN","MBAAMAP2",56,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",57,0)
 ;check if date is prior to patient birth date
"RTN","MBAAMAP2",58,0)
 I $P(SD,".",1)<$P(PAT(.03),U,1) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPPAB") Q RETURN
"RTN","MBAAMAP2",59,0)
 ;check if date is prior to clinic availability
"RTN","MBAAMAP2",60,0)
 S FRSTA=$$GETFSTA^MBAAMDA1(SC) I FRSTA,$P(SD,".",1)<FRSTA S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPCLA") Q 0
"RTN","MBAAMAP2",61,0)
 ;check overbook
"RTN","MBAAMAP2",62,0)
 S %=$$CHKOVB(.RETURN,.CLN,SC,SD,LEN,LVL) Q:RETURN=0 RETURN
"RTN","MBAAMAP2",63,0)
 S RETURN=1
"RTN","MBAAMAP2",64,0)
 Q RETURN
"RTN","MBAAMAP2",65,0)
 ;
"RTN","MBAAMAP2",66,0)
CHKOVB(RETURN,CLN,SC,SD,LEN,LVL) ; Check overbook Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",67,0)
 N TXT,ACC,SM,MAXOB,OBNO,PP,KEYS
"RTN","MBAAMAP2",68,0)
 S RETURN=1 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",69,0)
 S SM=$$DECAVA(.CLN,SC,SD,LEN,.PP)
"RTN","MBAAMAP2",70,0)
 Q:'SM 0
"RTN","MBAAMAP2",71,0)
 S KEYS("SDOB")="",KEYS("SDMOB")=""
"RTN","MBAAMAP2",72,0)
 D GETXUS^MBAAMDA3(.ACC,.KEYS,DUZ)
"RTN","MBAAMAP2",73,0)
 I '$D(ACC("SDOB")) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTNOST") Q 0
"RTN","MBAAMAP2",74,0)
 S MAXOB=CLN(1918)
"RTN","MBAAMAP2",75,0)
 S OBNO=$$GETOBNO(SC,SD)
"RTN","MBAAMAP2",76,0)
 S TXT(1)=MAXOB,TXT(2)=$S(OBNO>1:"S",1:"")
"RTN","MBAAMAP2",77,0)
 I OBNO>MAXOB,'$D(ACC("SDMOB")) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOAPD",.TXT) Q 0
"RTN","MBAAMAP2",78,0)
 I OBNO>MAXOB,LVL>1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTEXOB",,2) Q 0
"RTN","MBAAMAP2",79,0)
 I SM=6,LVL>1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOVBK",,2) Q 0
"RTN","MBAAMAP2",80,0)
 I SM=7 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOVOS",,2) Q 0
"RTN","MBAAMAP2",81,0)
 I SM=1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCBCP") Q 0
"RTN","MBAAMAP2",82,0)
 Q RETURN
"RTN","MBAAMAP2",83,0)
 ;
"RTN","MBAAMAP2",84,0)
GETOBNO(SC,SD) ; Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",85,0)
 N IND,CNT,APTS
"RTN","MBAAMAP2",86,0)
 S IND="",CNT=0
"RTN","MBAAMAP2",87,0)
 D GETDAYA^MBAAMDA1(.APTS,SC,SD)
"RTN","MBAAMAP2",88,0)
 F  S IND=$O(APTS(IND)) Q:IND=""  S:APTS(IND,"OB")>0 CNT=CNT+1
"RTN","MBAAMAP2",89,0)
 Q CNT
"RTN","MBAAMAP2",90,0)
 ;
"RTN","MBAAMAP2",91,0)
CHKAPTU(RETURN,SC,DFN,SD,CLN,PAT,UNS) ; Check make unscheduled appointment MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",92,0)
 N PAPT,CLN,TXT
"RTN","MBAAMAP2",93,0)
 D:'$D(PAT) GETPAT^MBAAMDA3(.PAT,DFN,1) ; get patient data
"RTN","MBAAMAP2",94,0)
 D:'$D(CLN) GETCLN^MBAAMDA1(.CLN,SC,1) ; get clinic data
"RTN","MBAAMAP2",95,0)
 ;check if patient already has appointment
"RTN","MBAAMAP2",96,0)
 S PAPT(.01)="" D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP2",97,0)
 S TXT(1)=$$FTIME^VALM1(SD)  ;ICR#: 10116 VALM1
"RTN","MBAAMAP2",98,0)
 I PAPT(.01)>0,$D(UNS) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPAHU",.TXT) Q RETURN
"RTN","MBAAMAP2",99,0)
 ;check if patient is dead
"RTN","MBAAMAP2",100,0)
 I +$G(PAT(.351))>0 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"PATDIED") Q RETURN
"RTN","MBAAMAP2",101,0)
 ;check if clinic is valid (stop code)
"RTN","MBAAMAP2",102,0)
 S VAL=$$CLNCK^MBAAMAP1(.RETURN,SC) Q:VAL=0 VAL
"RTN","MBAAMAP2",103,0)
 ;check inactive clinic period
"RTN","MBAAMAP2",104,0)
 I CLN(2505),$P(SD,".")'<CLN(2505),$S('CLN(2506):1,CLN(2506)>$P(SD,".")!('CLN(2506)):1,1:0) D  Q 0
"RTN","MBAAMAP2",105,0)
 . S TXT(1)=$$DTS^MBAAMAPI(CLN(2505))
"RTN","MBAAMAP2",106,0)
 . S:CLN(2506) TXT(2)=" and reactivated on "_$$DTS^MBAAMAPI(CLN(2506))
"RTN","MBAAMAP2",107,0)
 . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCINV",.TXT)
"RTN","MBAAMAP2",108,0)
 Q 1
"RTN","MBAAMAP2",109,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP2",110,0)
 ;MAKEUS(RETURN,DFN,SC,SD,TYP,STYP) ; Make unscheduled appointment
"RTN","MBAAMAP2",111,0)
 ; N SCAP,STAT,CHKIN,%
"RTN","MBAAMAP2",112,0)
 ; S RETURN=0
"RTN","MBAAMAP2",113,0)
 ; S %=$$CHKAPTU(.RETURN,SC,DFN,SD,,,1) Q:RETURN=0 0
"RTN","MBAAMAP2",114,0)
 ; S STAT=$$INP^SDAM2(DFN,SD)
"RTN","MBAAMAP2",115,0)
 ; D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP2",116,0)
 ; D MAKE^MBAAMDA3(DFN,SD,SC,TYP,.STYP,STAT,4,DUZ,DT,"W",0)
"RTN","MBAAMAP2",117,0)
 ; D MAKE^MBAAMDA1(SC,SD,DFN,CLN(1912),,DUZ)
"RTN","MBAAMAP2",118,0)
 ; S %=$$LOCKST^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",119,0)
 ; S SM=$$DECAVA(.CLN,SC,SD,CLN(1912),.S)
"RTN","MBAAMAP2",120,0)
 ; D SETST^MBAAMDA1(SC,SD,S)
"RTN","MBAAMAP2",121,0)
 ; D UNLCKST^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",122,0)
 ; S %=$$GETSCAP^MBAAMAP1(.SCAP,SC,DFN,SD)
"RTN","MBAAMAP2",123,0)
 ; D MAKE^SDAMEVT(DFN,SD,SC,SCAP("IFN"))
"RTN","MBAAMAP2",124,0)
 ; Q 1
"RTN","MBAAMAP2",125,0)
 ; ;
"RTN","MBAAMAP2",126,0)
MAKE(RETURN,DFN,SC,SD,TYPE,STYP,LEN,SRT,OTHR,CIO,LAB,XRAY,EKG,RQXRAY,CONS,LVL,DESDT) ; Make appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",127,0)
 N %
"RTN","MBAAMAP2",128,0)
 ;IF WE NEED TO CHECK FOR DEPARTMENT OF DEFENSE PUT IN THE CODE TO DO THE TASKS BELOW
"RTN","MBAAMAP2",129,0)
 ;I DUZ="" THEN SET DUZ FOR DEPARTMENT OF DEFENSE 
"RTN","MBAAMAP2",130,0)
 ;S REC=$O(^VA(200,"B","DEPARTMENT OF DEFENSE,USER",""))
"RTN","MBAAMAP2",131,0)
 ;I REC'>0 SEND ERROR MESSAGE THAT THE DEPARTMENT OF DEFENSE,USER DOESN'T EXIST ON THE SYSTEM
"RTN","MBAAMAP2",132,0)
 ;I REC>0 S DUZ=REC D CLNRGHT^MBAAMRP1(.RETURN,SC) I RETURN(0)=1 S RETURN="0^RESTRICED CLINIC, USER NOT ALLOWED TO BOOK APPTS IN THIS CLINIC" Q
"RTN","MBAAMAP2",133,0)
 ;CALL VERIFY CLINIC ACCESS
"RTN","MBAAMAP2",134,0)
 ;Q:IF NOT ACCESS 
"RTN","MBAAMAP2",135,0)
 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",136,0)
 S RETURN=1
"RTN","MBAAMAP2",137,0)
 F I="SC","DFN","SD","LEN" I '$D(@I) S RETURN=0,TXT(1)=I D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP2",138,0)
 I RETURN=0 Q 0
"RTN","MBAAMAP2",139,0)
 S %=$$CHKAPP(.RETURN,SC,DFN,SD,LEN,LVL)
"RTN","MBAAMAP2",140,0)
 I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN(0)
"RTN","MBAAMAP2",141,0)
 I RETURN=0,$P(RETURN(0),U)="PATDIED" Q RETURN(0)
"RTN","MBAAMAP2",142,0)
 I RETURN=0,$P(RETURN(0),U)="APTPAHA" D
"RTN","MBAAMAP2",143,0)
 . S %=$$CANCEL(.RETURN,DFN,SC,SD,"C",13,"")
"RTN","MBAAMAP2",144,0)
 E  Q:'$G(RETURN)&('$G(LVL)) 0
"RTN","MBAAMAP2",145,0)
 N CLN,S,SM,SDY,SCAP,SRT0
"RTN","MBAAMAP2",146,0)
 S %=$$LOCKST^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",147,0)
 S %=$$LOCKS^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",148,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP2",149,0)
 S SM=$$DECAVA(.CLN,SC,SD,+LEN,.S)
"RTN","MBAAMAP2",150,0)
 D SETST^MBAAMDA1(SC,SD,S)
"RTN","MBAAMAP2",151,0)
 D MAKE^MBAAMDA1(SC,SD,DFN,+LEN,SM,DUZ,$G(OTHR),.RQXRAY)
"RTN","MBAAMAP2",152,0)
 D UNLCKS^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",153,0)
 D UNLCKST^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",154,0)
 S STAT=$$INP^SDAM2(DFN,SD)  ;ICR#: 6054 MBAA USE OF SDAM2 API get inpatient data
"RTN","MBAAMAP2",155,0)
 S:SD<DT SRT="W"
"RTN","MBAAMAP2",156,0)
 S SRT0=$$NAVA^SDMANA(SC,SD,.SRT)  ;ICR#: 6049 MBAA SDMANA API USE
"RTN","MBAAMAP2",157,0)
 D MAKE^MBAAMDA3(DFN,SD,SC,.TYPE,.STYP,STAT,3,DUZ,DT,SRT,SRT0,.LAB,.XRAY,.EKG,$G(DESDT))
"RTN","MBAAMAP2",158,0)
 ;N DATA S DATA(27)=DT,DATA(28)=$$PTFU^MBAAMAP1(,DFN,SC)
"RTN","MBAAMAP2",159,0)
 ;D UPDPAPT^MBAAMDA4(.DATA,DFN,SD)
"RTN","MBAAMAP2",160,0)
 S %=$$GETSCAP^MBAAMAP1(.SCAP,SC,DFN,SD)
"RTN","MBAAMAP2",161,0)
 I $G(CONS)>0 S DATA(688)=CONS
"RTN","MBAAMAP2",162,0)
 D UPDCAPT^MBAAMDA4(.DATA,SC,SD,$G(SCAP("IFN")))
"RTN","MBAAMAP2",163,0)
 S:$G(CONS)>0 %=$$EDITCS^MBAAAPI1(.RETURN,CONS,SD,.OTHR,$G(CLN("NAME"))) ;SD/478
"RTN","MBAAMAP2",164,0)
 D MAKE^SDAMEVT(DFN,SD,SC,$G(SCAP("IFN")),2) ;ICR#: 6048 SDAMEVT
"RTN","MBAAMAP2",165,0)
 I $D(CIO),CIO="CI" S %=$$CHECKIN^MBAAMAP2(.CHKIN,DFN,SD,SC,SD)
"RTN","MBAAMAP2",166,0)
 K CHKIN,DATA,STAT
"RTN","MBAAMAP2",167,0)
 Q 1
"RTN","MBAAMAP2",168,0)
 ;
"RTN","MBAAMAP2",169,0)
DECAVA(CLN,SC,SD,LEN,PATT) ; Decrease availability Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",170,0)
 N AV,S,SB,X,Y,I,SS,ST,STR,STARTDAY,HSI,SI,SDDIF,SM,CAN,SDNOT
"RTN","MBAAMAP2",171,0)
 S SM=0,CAN=0
"RTN","MBAAMAP2",172,0)
 D GETPATT^MBAAMDA1(.AV,SC,SD)
"RTN","MBAAMAP2",173,0)
 S S=$G(AV(0)),SB=CLN(1914)
"RTN","MBAAMAP2",174,0)
 S STARTDAY=$S($L(SB):SB,1:8),SB=STARTDAY-1/100
"RTN","MBAAMAP2",175,0)
 S X=CLN(1917),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4)
"RTN","MBAAMAP2",176,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2)
"RTN","MBAAMAP2",177,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=LEN*HSI/60*SDDIF+ST+ST
"RTN","MBAAMAP2",178,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!(CLN(1917)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","MBAAMAP2",179,0)
 I ST+ST>$L(S),$L(S)<80 S S=S_" "
"RTN","MBAAMAP2",180,0)
 S SDNOT=1   ;SD*5.3*490 naked Do added below
"RTN","MBAAMAP2",181,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) S:S["CAN"!(ST="X"&($D(AV(1)))) CAN=1 Q:CAN  S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","MBAAMAP2",182,0)
 .Q:ST'=""
"RTN","MBAAMAP2",183,0)
 .Q:+LEN'>CLN(1912)
"RTN","MBAAMAP2",184,0)
 .S ST="   "
"RTN","MBAAMAP2",185,0)
 .Q
"RTN","MBAAMAP2",186,0)
 S PATT=S
"RTN","MBAAMAP2",187,0)
 Q:CAN CAN
"RTN","MBAAMAP2",188,0)
 Q SM
"RTN","MBAAMAP2",189,0)
 ;
"RTN","MBAAMAP2",190,0)
CANCEL(RETURN,DFN,SC,SD,TYP,RSN,RMK) ; Cancel appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",191,0)
 N CDATE,CDT,ERR,ODT,OIFN,OUSR,%
"RTN","MBAAMAP2",192,0)
 S RETURN=0
"RTN","MBAAMAP2",193,0)
 S %=$$CHKCAN^MBAAMAP3(.RETURN,DFN,SC,SD) Q:RETURN=0 0
"RTN","MBAAMAP2",194,0)
 S CDATE=$$NOW^XLFDT  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP2",195,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",196,0)
 S CIFN=CAPT("IFN")
"RTN","MBAAMAP2",197,0)
 S OUSR=CAPT("USER"),ODT=CAPT("DATE")
"RTN","MBAAMAP2",198,0)
 N SDATA,SDCPHDL
"RTN","MBAAMAP2",199,0)
 S SDCPHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",200,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCPHDL) ;ICR#: 5835 SDAMEVT
"RTN","MBAAMAP2",201,0)
 S CDT=$$NOW^XLFDT()  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP2",202,0)
 D CANCEL^MBAAMDA3(.ERR,DFN,SD,TYP,RSN,RMK,$E(CDT,1,12),DUZ,OUSR,ODT)
"RTN","MBAAMAP2",203,0)
 S OIFN=$$COVERB^MBAAMDA1(SC,SD,CIFN)
"RTN","MBAAMAP2",204,0)
 S %=$$CANCEL^MBAAAPI1(RETURN,CAPT("CONSULT"),SC,SD,CIFN,RMK,TYP)
"RTN","MBAAMAP2",205,0)
 D CANCEL^MBAAMDA1(SC,SD,DFN,CIFN)
"RTN","MBAAMAP2",206,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,0,SDCPHDL) ;ICR#: 6048 MBAA SDAMEVT API CALLS
"RTN","MBAAMAP2",207,0)
 S RETURN=1 K CIFN
"RTN","MBAAMAP2",208,0)
 Q RETURN
"RTN","MBAAMAP2",209,0)
 ;
"RTN","MBAAMAP2",210,0)
CHECKIN(RETURN,DFN,SD,SC,CIDT) ; Check in appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",211,0)
 N CAPT,CI,%
"RTN","MBAAMAP2",212,0)
 S CI=DT
"RTN","MBAAMAP2",213,0)
 S:$D(CIDT) CI=CIDT
"RTN","MBAAMAP2",214,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",215,0)
 I $G(CAPT(0))="" D ERRX^MBAAAPIE(.RETURN,"APTWHEN") Q 0
"RTN","MBAAMAP2",216,0)
 S CIFN=$G(CAPT("IFN"))
"RTN","MBAAMAP2",217,0)
 I 'CIFN D ERRX^MBAAAPIE(.RETURN,"APTWHEN") Q 0
"RTN","MBAAMAP2",218,0)
 N SDATA,SDCIHDL,X
"RTN","MBAAMAP2",219,0)
 S SDATA=CIFN_U_DFN_U_SD_U_SC,SDCIHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5835 SDAMEVT
"RTN","MBAAMAP2",220,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",221,0)
 S %=$$CHKCIN^MBAAMAP3(.RETURN,DFN,SD,+SDATA("BEFORE","STATUS")) Q:'% 0
"RTN","MBAAMAP2",222,0)
 S CD(302)=DUZ,CD(309)=CI
"RTN","MBAAMAP2",223,0)
 D UPDCAPT^MBAAMDA4(.CD,SC,SD,CAPT("IFN"))
"RTN","MBAAMAP2",224,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",225,0)
 M RETURN=SDATA
"RTN","MBAAMAP2",226,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","MBAAMAP2",227,0)
 . D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode  ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",228,0)
 K CD,CIFN
"RTN","MBAAMAP2",229,0)
 Q 1
"RTN","MBAAMAP2",230,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP2",231,0)
 ;Linetag NOSHOW is not needed until the next enhancement of MBAA
"RTN","MBAAMAP2",232,0)
 ;NOSHOW(RETURN,DFN,SC,SD,LVL) ; No-show appointment
"RTN","MBAAMAP2",233,0)
 ;N APT0,STATUS,APTSTAT,AUTO,CNSTLNK,NSDA,NSDIE,%
"RTN","MBAAMAP2",234,0)
 ;S:'$D(LVL) LVL=7
"RTN","MBAAMAP2",235,0)
 ;S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP2",236,0)
 ;S APTSTAT=$P(APT0,U,2)
"RTN","MBAAMAP2",237,0)
 ;S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP2",238,0)
 ;S RETURN=0
"RTN","MBAAMAP2",239,0)
 ;S %=$$CHKNS^MBAAMAP3(.RETURN,APT0,+STATUS,LVL)
"RTN","MBAAMAP2",240,0)
 ;I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN
"RTN","MBAAMAP2",241,0)
 ;N FDA,CIFN,CAPT
"RTN","MBAAMAP2",242,0)
 ;S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",243,0)
 ;S CIFN=CAPT("IFN")
"RTN","MBAAMAP2",244,0)
 ;S CNSTLNK=$G(CAPT("CONSULT"))
"RTN","MBAAMAP2",245,0)
 ;S RETURN("BEFORE")=STATUS
"RTN","MBAAMAP2",246,0)
 ;N SDNSHDL S SDNSHDL=$$HANDLE^SDAMEVT(1)
"RTN","MBAAMAP2",247,0)
 ;D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDNSHDL)
"RTN","MBAAMAP2",248,0)
 ;I APTSTAT=""!(APTSTAT="NT") D
"RTN","MBAAMAP2",249,0)
 ;. S FDA(3)="N",FDA(14)=DUZ,FDA(15)=$$NOW^XLFDT()
"RTN","MBAAMAP2",250,0)
 ;E  D
"RTN","MBAAMAP2",251,0)
 ;. S FDA(3)="@",FDA(14)="@",FDA(15)="@"
"RTN","MBAAMAP2",252,0)
 ;D UPDPAPT^MBAAMDA4(.FDA,DFN,SD)
"RTN","MBAAMAP2",253,0)
 ;D NOSHOW^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,2,SDNSHDL)
"RTN","MBAAMAP2",254,0)
 ;S:+$G(CNSTLNK) %=$$NOSHOW^MBAAAPI1(.RETURN,SC,SD,DFN,CNSTLNK,CIFN)
"RTN","MBAAMAP2",255,0)
 ;S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP2",256,0)
 ;S APTSTAT=$P(APT0,U,2)
"RTN","MBAAMAP2",257,0)
 ;S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP2",258,0)
 ;S RETURN("AFTER")=STATUS
"RTN","MBAAMAP2",259,0)
 ;Q 1
"RTN","MBAAMAP2",260,0)
 ;
"RTN","MBAAMAP3")
0^6^B15125035^n/a
"RTN","MBAAMAP3",1,0)
MBAAMAP3 ;OIT-PD/VSL - APPOINTMENT API ;02/10/2016
"RTN","MBAAMAP3",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMAP3",3,0)
 ;
"RTN","MBAAMAP3",4,0)
 ;Associated ICRs
"RTN","MBAAMAP3",5,0)
 ; ICR#
"RTN","MBAAMAP3",6,0)
 ;
"RTN","MBAAMAP3",7,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP3",8,0)
 ;LSTPATS(RETURN,SEARCH,START,NUMBER) ; Get patients by name
"RTN","MBAAMAP3",9,0)
 ;N RET,DL,IN,DG
"RTN","MBAAMAP3",10,0)
 ;S:'$D(START) START="" S:'$D(SEARCH) SEARCH=""
"RTN","MBAAMAP3",11,0)
 ;S:'$G(NUMBER) NUMBER=""
"RTN","MBAAMAP3",12,0)
 ;S RETURN=0
"RTN","MBAAMAP3",13,0)
 ;D GETPATS^MBAAMDA3(.RET,$$UP^XLFSTR(SEARCH),.START,NUMBER)
"RTN","MBAAMAP3",14,0)
 ;S RETURN(0)=RET("DILIST",0)
"RTN","MBAAMAP3",15,0)
 ;S DL="DILIST"
"RTN","MBAAMAP3",16,0)
 ;F IN=1:1:$P(RETURN(0),U,1) D
"RTN","MBAAMAP3",17,0)
 ;. D SENS^DGSEC4(.DG,RET(DL,2,IN),DUZ)
"RTN","MBAAMAP3",18,0)
 ;. S RETURN(IN)=""
"RTN","MBAAMAP3",19,0)
 ;. S RETURN(IN,"ID")=RET(DL,2,IN)
"RTN","MBAAMAP3",20,0)
 ;. S RETURN(IN,"NAME")=RET(DL,"ID",IN,".01")
"RTN","MBAAMAP3",21,0)
 ;. S RETURN(IN,"BIRTHDATE")=$S(DG(1)=2:"*SENSITIVE*",1:RET(DL,"ID",IN,".03"))
"RTN","MBAAMAP3",22,0)
 ;. S RETURN(IN,"SSN")=$S(DG(1)=2:"*SENSITIVE*",1:RET(DL,"ID",IN,".09"))
"RTN","MBAAMAP3",23,0)
 ;. S RETURN(IN,"TYPE")=RET(DL,"ID",IN,"391")
"RTN","MBAAMAP3",24,0)
 ;. S RETURN(IN,"VETERAN")=RET(DL,"ID",IN,"1901")
"RTN","MBAAMAP3",25,0)
 ;S RETURN=1
"RTN","MBAAMAP3",26,0)
 ;Q 1
"RTN","MBAAMAP3",27,0)
 ;
"RTN","MBAAMAP3",28,0)
 ;GETPAT(RETURN,PATIENT,LVL) ; Get a patient
"RTN","MBAAMAP3",29,0)
 ; N TEXT
"RTN","MBAAMAP3",30,0)
 ; S RETURN=0 S:'$G(LVL) LVL=7
"RTN","MBAAMAP3",31,0)
 ; I '$G(PATIENT) S TEXT(1)="PATIENT" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TEXT) Q 0
"RTN","MBAAMAP3",32,0)
 ; I LVL>1 D SENS^DGSEC4(.DG,PATIENT,DUZ) D ERRX^MBAAAPIE(.RETURN,"PATSENS",.TEXT) Q 0
"RTN","MBAAMAP3",33,0)
 ; D GETPAT^MBAAMDA3(.RETURN,PATIENT,1,1,1)
"RTN","MBAAMAP3",34,0)
 ; S RETURN=1
"RTN","MBAAMAP3",35,0)
 ; Q RETURN
"RTN","MBAAMAP3",36,0)
 ; ;
"RTN","MBAAMAP3",37,0)
 ;LSTETNS(RETURN,SEARCH,START,NUMBER) ; Get ethnicities
"RTN","MBAAMAP3",38,0)
 ; N LST
"RTN","MBAAMAP3",39,0)
 ; D LSTETNS^MBAAMDA3(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","MBAAMAP3",40,0)
 ; D BLDLST^MBAAMAPI(.RETURN,.LST)
"RTN","MBAAMAP3",41,0)
 ; Q RETURN
"RTN","MBAAMAP3",42,0)
 ; ;
"RTN","MBAAMAP3",43,0)
 ;SETETN(RETURN,PAT,ETN) ; Set patient ethnicity.
"RTN","MBAAMAP3",44,0)
 ; D SETETN^MBAAMDA3(PAT,$P(ETN,U,1))
"RTN","MBAAMAP3",45,0)
 ; S RETURN=1
"RTN","MBAAMAP3",46,0)
 ; Q 1
"RTN","MBAAMAP3",47,0)
 ; ;
"RTN","MBAAMAP3",48,0)
 ;LSTRACES(RETURN,SEARCH,START,NUMBER) ; Get races
"RTN","MBAAMAP3",49,0)
 ; N LST
"RTN","MBAAMAP3",50,0)
 ; D LSTRACES^MBAAMDA3(.LST,$G(SEARCH),.START,$G(NUMBER))
"RTN","MBAAMAP3",51,0)
 ; D BLDLST^MBAAMAPI(.RETURN,.LST)
"RTN","MBAAMAP3",52,0)
 ; Q RETURN
"RTN","MBAAMAP3",53,0)
 ; ;
"RTN","MBAAMAP3",54,0)
 ;SETRACE(RETURN,PAT,RACE) ; Set patient race.
"RTN","MBAAMAP3",55,0)
 ; D ADDRACE^MBAAMDA3(PAT,+RACE)
"RTN","MBAAMAP3",56,0)
 ; S RETURN=1
"RTN","MBAAMAP3",57,0)
 ; Q 1
"RTN","MBAAMAP3",58,0)
 ; ;
"RTN","MBAAMAP3",59,0)
 ;GETPRES(RETURN,PAT) ; Get patient races
"RTN","MBAAMAP3",60,0)
 ; N LST,IND,CNT
"RTN","MBAAMAP3",61,0)
 ; K RETURN
"RTN","MBAAMAP3",62,0)
 ; D GETPRES^MBAAMDA3(.LST,PAT)
"RTN","MBAAMAP3",63,0)
 ; S IND=0,CNT=0
"RTN","MBAAMAP3",64,0)
 ; S RETURN(0)=0
"RTN","MBAAMAP3",65,0)
 ; F  S IND=$O(LST(2,IND)) Q:IND=""  D
"RTN","MBAAMAP3",66,0)
 ; . S CNT=CNT+1
"RTN","MBAAMAP3",67,0)
 ; . S RETURN(CNT)="",RETURN(CNT,"ID")=IND
"RTN","MBAAMAP3",68,0)
 ; . S RETURN(CNT,"NAME")=LST(2,IND,.01)
"RTN","MBAAMAP3",69,0)
 ; . S RETURN(0)=CNT_"^*^0^"
"RTN","MBAAMAP3",70,0)
 ; S RETURN=1
"RTN","MBAAMAP3",71,0)
 ; Q 1
"RTN","MBAAMAP3",72,0)
 ; ;
"RTN","MBAAMAP3",73,0)
 ;Code at linetag CHKDISCH is removed until the next version/enhancment of MBAA
"RTN","MBAAMAP3",74,0)
 ;CHKDISCH(RETURN,ENS,DFN,OENS) ; Check discharge
"RTN","MBAAMAP3",75,0)
 ;N SC,TXT,IND,APTS,ERR,APT
"RTN","MBAAMAP3",76,0)
 ;S RETURN=0,ERR=0
"RTN","MBAAMAP3",77,0)
 ;S SC=$O(ENS(""))
"RTN","MBAAMAP3",78,0)
 ;S TXT(1)=ENS(SC,"NAME")
"RTN","MBAAMAP3",79,0)
 ;I OENS(SC,"STATUS")]"" D ERRX^MBAAAPIE(.RETURN,"PATDARD",.TXT) Q RETURN
"RTN","MBAAMAP3",80,0)
 ;I '$D(OENS(SC,"EN")) D ERRX^MBAAAPIE(.RETURN,"PATDNEN",.TXT) Q RETURN
"RTN","MBAAMAP3",81,0)
 ;F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""!(ERR>0)  D
"RTN","MBAAMAP3",82,0)
 ;. Q:$D(ENS(SC,"EN",IND,"DISCHARGE"))&(ENS(SC,"EN",IND,"DISCHARGE")=OENS(SC,"EN",IND,"DISCHARGE"))
"RTN","MBAAMAP3",83,0)
 ;. D LSTPAPTS^MBAAMDA1(.APTS,DFN,ENS(SC,"EN",IND,"DISCHARGE"),9999999)
"RTN","MBAAMAP3",84,0)
 ;. F APT=0:0 S APT=$O(APTS(APT)) Q:APT=""!(ERR>0)  D
"RTN","MBAAMAP3",85,0)
 ;. . I APTS(APT,"SC")=SC,$P(APTS(APT,"SDATA"),U,2)'["C",$P(APTS(APT,"SDATA"),U,2)'["N" S ERR=1
"RTN","MBAAMAP3",86,0)
 ;I ERR D ERRX^MBAAAPIE(.RETURN,"PATDHFA") Q RETURN
"RTN","MBAAMAP3",87,0)
 ;S RETURN=1
"RTN","MBAAMAP3",88,0)
 ;Q RETURN
"RTN","MBAAMAP3",89,0)
 ;
"RTN","MBAAMAP3",90,0)
 ;DISCH(RETURN,ENS,DFN) ; Discharge from clinic
"RTN","MBAAMAP3",91,0)
 ;N OENS,IND,SC,NENS
"RTN","MBAAMAP3",92,0)
 ;S RETURN=0
"RTN","MBAAMAP3",93,0)
 ;S SC=$O(ENS(""))
"RTN","MBAAMAP3",94,0)
 ;S %=$$GETPENRL(.OENS,DFN,SC)
"RTN","MBAAMAP3",95,0)
 ;S %=$$CHKDISCH(.RETURN,.ENS,DFN,.OENS)
"RTN","MBAAMAP3",96,0)
 ;Q:RETURN=0 0
"RTN","MBAAMAP3",97,0)
 ;F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""  D
"RTN","MBAAMAP3",98,0)
 ;. S:ENS(SC,"EN",IND,"DISCHARGE")'=OENS(SC,"EN",IND,"DISCHARGE") NENS(SC,"EN",IND,"DISCHARGE")=ENS(SC,"EN",IND,"DISCHARGE")
"RTN","MBAAMAP3",99,0)
 ;. S:ENS(SC,"EN",IND,"REASON")'=OENS(SC,"EN",IND,"REASON") NENS(SC,"EN",IND,"REASON")=$E(ENS(SC,"EN",IND,"REASON"),1,80)
"RTN","MBAAMAP3",100,0)
 ;S NENS(SC,"IEN")=ENS(SC,"IEN")
"RTN","MBAAMAP3",101,0)
 ;D BEFORE^SCMCEV3(DFN)
"RTN","MBAAMAP3",102,0)
 ;D UPDENRL^MBAAMDA3(.NENS,DFN)
"RTN","MBAAMAP3",103,0)
 ;D AFTER^SCMCEV3(DFN)
"RTN","MBAAMAP3",104,0)
 ;D INVOKE^SCMCEV3(DFN)
"RTN","MBAAMAP3",105,0)
 ;S RETURN=1
"RTN","MBAAMAP3",106,0)
 ;Q 1
"RTN","MBAAMAP3",107,0)
 ;
"RTN","MBAAMAP3",108,0)
 ;GETPENRL(RETURN,DFN,SC,STAT) ; Get patient enrollments filtered by status
"RTN","MBAAMAP3",109,0)
 ; N ENS,EN,IND,CLN,SSC
"RTN","MBAAMAP3",110,0)
 ; D GETCENRL^MBAAMDA3(.ENS,DFN,$G(SC))
"RTN","MBAAMAP3",111,0)
 ; F SSC=0:0 S SSC=$O(ENS(SSC)) Q:SSC=""  D
"RTN","MBAAMAP3",112,0)
 ; . Q:$G(STAT)>0&($P(ENS(SSC,0),U,3)]"")
"RTN","MBAAMAP3",113,0)
 ; . S RETURN(SSC,"STATUS")=$P(ENS(SSC,0),U,3)
"RTN","MBAAMAP3",114,0)
 ; . S RETURN(SSC,"IEN")=$P(ENS(SSC,0),U,1)
"RTN","MBAAMAP3",115,0)
 ; . D GETCLN^MBAAMDA1(.CLN,SSC)
"RTN","MBAAMAP3",116,0)
 ; . S RETURN(SSC,"NAME")=CLN(.01)
"RTN","MBAAMAP3",117,0)
 ; . F IND=0:0 S IND=$O(ENS(SSC,IND)) Q:IND=""  D
"RTN","MBAAMAP3",118,0)
 ; . . S EN=ENS(SSC,IND)
"RTN","MBAAMAP3",119,0)
 ; . . S RETURN(SSC,"EN",IND,"ENROLLMENT")=$P(EN,U,1)
"RTN","MBAAMAP3",120,0)
 ; . . S RETURN(SSC,"EN",IND,"OA")=$P(EN,U,2)
"RTN","MBAAMAP3",121,0)
 ; . . S RETURN(SSC,"EN",IND,"DISCHARGE")=$P(EN,U,3)
"RTN","MBAAMAP3",122,0)
 ; . . S RETURN(SSC,"EN",IND,"REASON")=$P(EN,U,4)
"RTN","MBAAMAP3",123,0)
 ; . . S RETURN(SSC,"EN",IND,"REVIEW")=$P(EN,U,5)
"RTN","MBAAMAP3",124,0)
 ; I $G(SC)>0 D
"RTN","MBAAMAP3",125,0)
 ; . Q:$D(RETURN(SC))
"RTN","MBAAMAP3",126,0)
 ; . D GETCLN^MBAAMDA1(.CLN,SC)
"RTN","MBAAMAP3",127,0)
 ; . S RETURN(SC,"NAME")=CLN(.01)
"RTN","MBAAMAP3",128,0)
 ; Q 1
"RTN","MBAAMAP3",129,0)
 ;
"RTN","MBAAMAP3",130,0)
CHKCIN(RETURN,DFN,SD,STATUS) ; Check in check MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP3",131,0)
 N DT
"RTN","MBAAMAP3",132,0)
 S RETURN=0
"RTN","MBAAMAP3",133,0)
 S %=$$CHKSPCI(.RETURN,DFN,SD,STATUS) Q:'% 0
"RTN","MBAAMAP3",134,0)
 S DT=$$NOW^XLFDT  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP3",135,0)
 I $P(SD,".")>DT D ERRX^MBAAAPIE(.RETURN,"APTCITS") Q 0
"RTN","MBAAMAP3",136,0)
 Q 1
"RTN","MBAAMAP3",137,0)
 ;
"RTN","MBAAMAP3",138,0)
CHKSPCI(RETURN,DFN,SD,STATUS) ; Check if status permit check in MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP3",139,0)
 N IND,STAT,STATS
"RTN","MBAAMAP3",140,0)
 S RETURN=0
"RTN","MBAAMAP3",141,0)
 D LSTCIST1^MBAAMDA2(.STAT)
"RTN","MBAAMAP3",142,0)
 D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAAMAP3",143,0)
 S IND=0
"RTN","MBAAMAP3",144,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAAMAP3",145,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAAMAP3",146,0)
 I 'RETURN D ERRX^MBAAAPIE(.RETURN,"APTCIPE")
"RTN","MBAAMAP3",147,0)
 Q RETURN
"RTN","MBAAMAP3",148,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP3",149,0)
 ;CHKNS(RETURN,APT0,STATUS,LVL) ; Check no-show
"RTN","MBAAMAP3",150,0)
 ; N STAT
"RTN","MBAAMAP3",151,0)
 ; S RETURN=1
"RTN","MBAAMAP3",152,0)
 ; S %=$$CHKSPNS(.RETURN,+STATUS) Q:'% 0
"RTN","MBAAMAP3",153,0)
 ; S STAT=$P(APT0,U,2)
"RTN","MBAAMAP3",154,0)
 ; I STAT="I" S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTNSIA") Q RETURN
"RTN","MBAAMAP3",155,0)
 ; I LVL>1,STAT["A" S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTNSAR",,2) Q RETURN
"RTN","MBAAMAP3",156,0)
 ; I LVL>1,STAT]"",STAT'["A" S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTNSAL",,2) Q RETURN
"RTN","MBAAMAP3",157,0)
 ; Q RETURN
"RTN","MBAAMAP3",158,0)
 ; ;
"RTN","MBAAMAP3",159,0)
 ;CHKSPNS(RETURN,STATUS) ; Check if status of appt permits no-show
"RTN","MBAAMAP3",160,0)
 ; N IND,STAT,STATS
"RTN","MBAAMAP3",161,0)
 ; S RETURN=0
"RTN","MBAAMAP3",162,0)
 ; D LSTNSTA1^MBAAMDA2(.STAT)
"RTN","MBAAMAP3",163,0)
 ; D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAAMAP3",164,0)
 ; S IND=0
"RTN","MBAAMAP3",165,0)
 ; F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAAMAP3",166,0)
 ; . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAAMAP3",167,0)
 ; I 'RETURN D ERRX^MBAAAPIE(.RETURN,"APTNSCE")
"RTN","MBAAMAP3",168,0)
 ; Q RETURN
"RTN","MBAAMAP3",169,0)
 ; ;
"RTN","MBAAMAP3",170,0)
CHKCAN(RETURN,DFN,SC,SD) ; Verify cancel Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP3",171,0)
 N APT,RET,%
"RTN","MBAAMAP3",172,0)
 S RETURN=0
"RTN","MBAAMAP3",173,0)
 D GETAPTS^MBAAMDA2(.APT,DFN,.SD)
"RTN","MBAAMAP3",174,0)
 I APT("APT",SD,"STATUS")["C" D  Q RETURN
"RTN","MBAAMAP3",175,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCAND")
"RTN","MBAAMAP3",176,0)
 I $$ISAPTCO^MBAAMAP4(,DFN,SD) D  Q RETURN
"RTN","MBAAMAP3",177,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCCHO")
"RTN","MBAAMAP3",178,0)
 S %=$$CLNRGHT^MBAAMAP1(.RET,+SC)
"RTN","MBAAMAP3",179,0)
 I RET=0 D  Q RETURN
"RTN","MBAAMAP3",180,0)
 . S TXT(1)=RET("CLN"),TXT(2)=$C(10)
"RTN","MBAAMAP3",181,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCRGT",.TXT)
"RTN","MBAAMAP3",182,0)
 I '$$CHKSPC(.STAT,DFN,SD) D  Q RETURN
"RTN","MBAAMAP3",183,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCNPE",.TXT)
"RTN","MBAAMAP3",184,0)
 S RETURN=1
"RTN","MBAAMAP3",185,0)
 Q RETURN
"RTN","MBAAMAP3",186,0)
 ;
"RTN","MBAAMAP3",187,0)
CHKSPC(RETURN,DFN,SD) ; Check if status permit cancelation Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP3",188,0)
 N APT0,STATUS,IND,STAT,STATS
"RTN","MBAAMAP3",189,0)
 S RETURN=0
"RTN","MBAAMAP3",190,0)
 S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP3",191,0)
 ;T13 Change to use SDAMA301 API
"RTN","MBAAMAP3",192,0)
 D STATUS^MBAARPC1(.RESULTS,DFN,SD,+APT0) S STATUS=+$G(RESULTS) ;K RESULTS 
"RTN","MBAAMAP3",193,0)
 ;S STATUS=+$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0)) ;ICR#: 2851 MBAA ACCESS TO SDAM1 API get appointment status
"RTN","MBAAMAP3",194,0)
 D LSTCSTA1^MBAAMDA2(.STAT)
"RTN","MBAAMAP3",195,0)
 D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAAMAP3",196,0)
 S IND=0
"RTN","MBAAMAP3",197,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAAMAP3",198,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAAMAP3",199,0)
 Q RETURN
"RTN","MBAAMAP3",200,0)
 ;
"RTN","MBAAMAP4")
0^7^B15516986^n/a
"RTN","MBAAMAP4",1,0)
MBAAMAP4 ;OIT-PD/VSL - APPOINTMENT API ;02/10/2016
"RTN","MBAAMAP4",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMAP4",3,0)
 ;
"RTN","MBAAMAP4",4,0)
 ;Associated ICRs
"RTN","MBAAMAP4",5,0)
 ; ICR#
"RTN","MBAAMAP4",6,0)
 ; 
"RTN","MBAAMAP4",7,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP4",8,0)
 ;CHECKO(RETURN,DFN,SD,SC) ; Check out
"RTN","MBAAMAP4",9,0)
 ;N CAPT,OE,APT0,CD,%
"RTN","MBAAMAP4",10,0)
 ;S RETURN=0
"RTN","MBAAMAP4",11,0)
 ;S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP4",12,0)
 ;I '$D(CAPT) D ERRX^MBAAAPIE(.RETURN,"APTCOCN") Q 0
"RTN","MBAAMAP4",13,0)
 ;S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP4",14,0)
 ;S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP4",15,0)
 ;K % S %=$$CHKCO(.RETURN,DFN,SD,+STATUS)
"RTN","MBAAMAP4",16,0)
 ;Q:'RETURN 0
"RTN","MBAAMAP4",17,0)
 ;I '$$NEW^SDPCE(SD) D ERRX^MBAAAPIE(.RETURN,"APTCONW",,2)
"RTN","MBAAMAP4",18,0)
 ;S CD(304)=DUZ,CD(303)=$E($$NOW^XLFDT(),1,12)
"RTN","MBAAMAP4",19,0)
 ;D UPDCAPT^MBAAMDA4(.CD,SC,SD,CAPT("IFN"))
"RTN","MBAAMAP4",20,0)
 ;S RETURN("SDOE")=$$GETAPT(DFN,SD,SC)
"RTN","MBAAMAP4",21,0)
 ;S RETURN("COD")=CAPT("CHECKOUT")
"RTN","MBAAMAP4",22,0)
 ;S OE(.04)="",OE(.05)=""
"RTN","MBAAMAP4",23,0)
 ;D GETOE^MBAAMDA4(.OE,RETURN("SDOE"))
"RTN","MBAAMAP4",24,0)
 ;S RETURN("LOCATION")=OE(.04)
"RTN","MBAAMAP4",25,0)
 ;S RETURN("VISIT")=OE(.05)
"RTN","MBAAMAP4",26,0)
 ;S RETURN("COVISIT")=$P(APT0,U,11)
"RTN","MBAAMAP4",27,0)
 ;I "^2^8^12^"[("^"_+STATUS_"^"),$P(STATUS,";",3)["CHECKED OUT" D
"RTN","MBAAMAP4",28,0)
 ;. S RETURN("CO")=1 S RETURN=0
"RTN","MBAAMAP4",29,0)
 ;. D ERRX^MBAAAPIE(.RETURN,"APTCOAC",,2)
"RTN","MBAAMAP4",30,0)
 ;Q 1
"RTN","MBAAMAP4",31,0)
 ;
"RTN","MBAAMAP4",32,0)
 ;GETAPT(DFN,SDT,SDCL,SDVIEN) ;Look-up Outpatient Encounter IEN for Appt
"RTN","MBAAMAP4",33,0)
 ; Input  -- DFN      Patient file IEN
"RTN","MBAAMAP4",34,0)
 ;           SDT      Appointment Date/Time
"RTN","MBAAMAP4",35,0)
 ;           SDCL     Hospital Location file IEN for Appt
"RTN","MBAAMAP4",36,0)
 ;           SDVIEN   Visit file pointer [optional]
"RTN","MBAAMAP4",37,0)
 ; Output -- Outpatient Encounter file IEN
"RTN","MBAAMAP4",38,0)
 ;N PAPT
"RTN","MBAAMAP4",39,0)
 ;S PAPT(21)=""
"RTN","MBAAMAP4",40,0)
 ;D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP4",41,0)
 ;I 'PAPT(21) D APPT^SDVSIT(DFN,SDT,SDCL,$G(SDVIEN)) D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP4",42,0)
 ;I PAPT(21) D VIEN^SDVSIT2(PAPT(21),$G(SDVIEN))
"RTN","MBAAMAP4",43,0)
 ;Q +$G(PAPT(21))
"RTN","MBAAMAP4",44,0)
 ;
"RTN","MBAAMAP4",45,0)
 ;CHKCO(RETURN,DFN,SD,STATUS) ; Check in check out
"RTN","MBAAMAP4",46,0)
 ;S RETURN=0
"RTN","MBAAMAP4",47,0)
 ;I '$D(STATUS) D
"RTN","MBAAMAP4",48,0)
 ;. S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP4",49,0)
 ;. S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP4",50,0)
 ;S %=$$CHKSPCO(.RETURN,DFN,SD,+STATUS) Q:'% 0
"RTN","MBAAMAP4",51,0)
 ;S DT=$$NOW^XLFDT
"RTN","MBAAMAP4",52,0)
 ;I $P(SD,".")>DT D ERRX^MBAAAPIE(.RETURN,"APTCOTS") Q 0
"RTN","MBAAMAP4",53,0)
 ;Q 1
"RTN","MBAAMAP4",54,0)
 ;
"RTN","MBAAMAP4",55,0)
 ;CHKSPCO(RETURN,DFN,SD,STATUS) ; Check if status permit check in
"RTN","MBAAMAP4",56,0)
 ;N IND,STAT,STATS
"RTN","MBAAMAP4",57,0)
 ;S RETURN=0
"RTN","MBAAMAP4",58,0)
 ;D LSTCOST1^MBAAMDA2(.STAT)
"RTN","MBAAMAP4",59,0)
 ;D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAAMAP4",60,0)
 ;S IND=0
"RTN","MBAAMAP4",61,0)
 ;F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAAMAP4",62,0)
 ;. I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAAMAP4",63,0)
 ;I 'RETURN D ERRX^MBAAAPIE(.RETURN,"APTCOCE")
"RTN","MBAAMAP4",64,0)
 ;Q RETURN
"RTN","MBAAMAP4",65,0)
 ;
"RTN","MBAAMAP4",66,0)
 ;CHKDCO(RETURN,DFN,SD) ; Check delete check out
"RTN","MBAAMAP4",67,0)
 ;N PAPT,CAPT,OE,SDATA,SDELHDL,X,%
"RTN","MBAAMAP4",68,0)
 ;S PAPT(21)="",PAPT(.01)=""
"RTN","MBAAMAP4",69,0)
 ;S OE(.01)="",OE(.04)="",OE(.05)="",OE(.08)="",OE(.09)="",OE(.06)=""
"RTN","MBAAMAP4",70,0)
 ;D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP4",71,0)
 ;S %=$$GETSCAP^MBAAMAP1(.CAPT,PAPT(.01),DFN,SD)
"RTN","MBAAMAP4",72,0)
 ;D GETOE^MBAAMDA4(.OE,PAPT(21))
"RTN","MBAAMAP4",73,0)
 ;S RETURN=0
"RTN","MBAAMAP4",74,0)
 ;I 'PAPT(21)!('CAPT("CHECKOUT")) D ERRX^MBAAAPIE(.RETURN,"APTDCOD") Q 0
"RTN","MBAAMAP4",75,0)
 ;I '$$NEW^SDPCE(OE(.01)) D ERRX^MBAAAPIE(.RETURN,"APTDCOO") Q 0
"RTN","MBAAMAP4",76,0)
 ;S RETURN=1
"RTN","MBAAMAP4",77,0)
 ;Q 1
"RTN","MBAAMAP4",78,0)
 ;
"RTN","MBAAMAP4",79,0)
 ;DELCOPC(RETURN,SDOE,SDELHDL,SDELSRC) ; Delete check out (PCE)
"RTN","MBAAMAP4",80,0)
 ;N SC,OE,SDDA,SDEVTF,X
"RTN","MBAAMAP4",81,0)
 ;D SETCO(.SDOE,.DFN,.SD,.OE,.SC,.SDDA)
"RTN","MBAAMAP4",82,0)
 ;I $G(SDELSRC)'="PCE" S X=$$DELVFILE^PXAPI("ALL",OE(.05),"","","")
"RTN","MBAAMAP4",83,0)
 ;I '$$NEW^SDPCE(SD) D ERRX^MBAAAPIE(.RETURN,"APTDCOO") Q 0
"RTN","MBAAMAP4",84,0)
 ;I '$G(SDELHDL) N SDATA,SDELHDL S SDEVTF=1 D EVT^SDCOU1(SDOE,"BEFORE",.SDELHDL,.SDATA)
"RTN","MBAAMAP4",85,0)
 ;S %=$$DELCOL(.RETURN,DFN,SD,SC,SDDA,SDOE,.OE)
"RTN","MBAAMAP4",86,0)
 ;I $G(SDEVTF) D EVT^SDCOU1(SDOE,"AFTER",.SDELHDL,.SDATA)
"RTN","MBAAMAP4",87,0)
 ;S RETURN=1
"RTN","MBAAMAP4",88,0)
 ;Q 1
"RTN","MBAAMAP4",89,0)
 ;
"RTN","MBAAMAP4",90,0)
 ;DELCO(RETURN,DFN,SD) ;Delete check-out (SD) silent version
"RTN","MBAAMAP4",91,0)
 ;N TXT
"RTN","MBAAMAP4",92,0)
 ;K RETURN
"RTN","MBAAMAP4",93,0)
 ;S RETURN=0
"RTN","MBAAMAP4",94,0)
 ;I +$G(DFN)'>0 S TXT(1)="DFN" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT) Q 0
"RTN","MBAAMAP4",95,0)
 ;I +$G(SD)'>0 S TXT(1)="SD" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT) Q 0
"RTN","MBAAMAP4",96,0)
 ;Q $$DELCOSD(.RETURN,DFN,SD)
"RTN","MBAAMAP4",97,0)
 ;
"RTN","MBAAMAP4",98,0)
 ;DELCOSD(RETURN,DFN,SD,ECHO) ; Delete check out (SD)
"RTN","MBAAMAP4",99,0)
 ;N %
"RTN","MBAAMAP4",100,0)
 ;S %=$$CHKDCO(.RETURN,DFN,SD)
"RTN","MBAAMAP4",101,0)
 ;I RETURN=0 Q 0
"RTN","MBAAMAP4",102,0)
 ;N SDOE,SC,OE,SDDA,X
"RTN","MBAAMAP4",103,0)
 ;D SETCO(.SDOE,.DFN,.SD,.OE,.SC,.SDDA)
"RTN","MBAAMAP4",104,0)
 ;I '$$NEW^SDPCE(SD) D ERRX^MBAAAPIE(.RETURN,"APTDCOO") Q 0
"RTN","MBAAMAP4",105,0)
 ;S SDELHDL=$$HANDLE^SDAMEVT(1)
"RTN","MBAAMAP4",106,0)
 ;S X=$$DELVFILE^PXAPI("ALL",OE(.05),"","","",.ECHO)
"RTN","MBAAMAP4",107,0)
 ;S %=$$DELCOL(.RETURN,DFN,SD,SC,SDDA,SDOE,.OE)
"RTN","MBAAMAP4",108,0)
 ;S SDOE=$$GETAPT(DFN,SD,SC)
"RTN","MBAAMAP4",109,0)
 ;S RETURN("OE")=SDOE
"RTN","MBAAMAP4",110,0)
 ;Q 1
"RTN","MBAAMAP4",111,0)
 ;
"RTN","MBAAMAP4",112,0)
 ;SETCO(SDOE,DFN,SD,OE,SC,SDDA) ; Set Check out params
"RTN","MBAAMAP4",113,0)
 ;N PAPT,CAPT,%
"RTN","MBAAMAP4",114,0)
 ;I '$D(SDOE) D
"RTN","MBAAMAP4",115,0)
 ;. S PAPT(21)="",PAPT(.01)=""
"RTN","MBAAMAP4",116,0)
 ;. D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP4",117,0)
 ;. S SDOE=PAPT(21),SC=PAPT(.01)
"RTN","MBAAMAP4",118,0)
 ;S OE(.01)="",OE(.02)="",OE(.04)="",OE(.05)="",OE(.08)="",OE(.09)="",OE(.06)=""
"RTN","MBAAMAP4",119,0)
 ;D GETOE^MBAAMDA4(.OE,SDOE)
"RTN","MBAAMAP4",120,0)
 ;S DFN=OE(.02),SD=OE(.01),SC=OE(.04)
"RTN","MBAAMAP4",121,0)
 ;S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP4",122,0)
 ;S SDDA=CAPT("IFN")
"RTN","MBAAMAP4",123,0)
 ;Q
"RTN","MBAAMAP4",124,0)
 ;
"RTN","MBAAMAP4",125,0)
 ;DELCOL(RETURN,DFN,SD,SC,SDDA,SDOE,OE) ; Delete check out
"RTN","MBAAMAP4",126,0)
 ;N SDATA,SDELHDL,SDORG,VSIT
"RTN","MBAAMAP4",127,0)
 ;S SDORG=OE(.08),VSIT=OE(.05)
"RTN","MBAAMAP4",128,0)
 ;I "^1^2^3^"[("^"_SDORG_"^") D DELCHLD(SDOE)
"RTN","MBAAMAP4",129,0)
 ;N PDATA
"RTN","MBAAMAP4",130,0)
 ;I SDORG=1 D
"RTN","MBAAMAP4",131,0)
 ;. S PDATA(21)="@"
"RTN","MBAAMAP4",132,0)
 ;. N CDATA S CDATA(303)="@"
"RTN","MBAAMAP4",133,0)
 ;. D UPDCAPT^MBAAMDA4(.CDATA,SC,SD,SDDA)
"RTN","MBAAMAP4",134,0)
 ;I SDORG=3 D
"RTN","MBAAMAP4",135,0)
 ;. S PDATA(18)="@"
"RTN","MBAAMAP4",136,0)
 ;D UPDPAPT^MBAAMDA4(.PDATA,DFN,SD)
"RTN","MBAAMAP4",137,0)
 ;D DELCLS^MBAAMDA4(SDOE)
"RTN","MBAAMAP4",138,0)
 ;D DELOE(SDOE,.OE)
"RTN","MBAAMAP4",139,0)
 ; -- call pce to make sure its data is gone
"RTN","MBAAMAP4",140,0)
 ;D DEAD^PXUTLSTP(VSIT)
"RTN","MBAAMAP4",141,0)
 ;Q 1
"RTN","MBAAMAP4",142,0)
 ;
"RTN","MBAAMAP4",143,0)
 ;DELOE(SDOE,OE) ; Delete Outpatient Encounter
"RTN","MBAAMAP4",144,0)
 ;I '$D(OE) D
"RTN","MBAAMAP4",145,0)
 ;. S OE(.05)="",OE(.01)="",OE(.08)=""
"RTN","MBAAMAP4",146,0)
 ;. D GETOE^MBAAMDA4(.OE,SDOE)
"RTN","MBAAMAP4",147,0)
 ;I '$$NEW^SDPCE(OE(.01)) Q
"RTN","MBAAMAP4",148,0)
 ;D DELOE^MBAAMDA4(SDOE)
"RTN","MBAAMAP4",149,0)
 ;S X=$$KILL^VSITKIL(OE(.05))
"RTN","MBAAMAP4",150,0)
 ;Q
"RTN","MBAAMAP4",151,0)
 ;
"RTN","MBAAMAP4",152,0)
 ;DELCHLD(SDOEP) ;Delete Children
"RTN","MBAAMAP4",153,0)
 ;N SDOEC,CHLD
"RTN","MBAAMAP4",154,0)
 ;S SDOEC=0
"RTN","MBAAMAP4",155,0)
 ;D GETCHLD^MBAAMDA4(.CHLD,SDOEP)
"RTN","MBAAMAP4",156,0)
 ;F  S SDOEC=$O(CHLD(SDOEC)) Q:'SDOEC  D
"RTN","MBAAMAP4",157,0)
 ;. D DELOE(SDOEC)
"RTN","MBAAMAP4",158,0)
 ;Q
"RTN","MBAAMAP4",159,0)
 ;
"RTN","MBAAMAP4",160,0)
 ;LSTDAYAP(RETURN,DFN) ; List all day active appointment
"RTN","MBAAMAP4",161,0)
 ; N DAP,PAP,CAP,PFLDS,CFLDS,AP,FLD,NM,PNMS,CNMS,TXT
"RTN","MBAAMAP4",162,0)
 ; I '$D(DT) S DT=$P($$NOW^XLFDT(),".")
"RTN","MBAAMAP4",163,0)
 ; I '$D(DFN)!(+$G(DFN)'>0) S RETURN=0,TXT(1)="DFN" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP4",164,0)
 ; S PFLDS=".01;3",CFLDS=".01;222;333"
"RTN","MBAAMAP4",165,0)
 ; S PNMS="CLINIC;STATUS",CNMS="PATIENT;CIFN;IFN"
"RTN","MBAAMAP4",166,0)
 ; D GETDAPTS^MBAAMDA2(.DAP,+DFN,$P(DT,"."))
"RTN","MBAAMAP4",167,0)
 ; S AP=0
"RTN","MBAAMAP4",168,0)
 ; F  S AP=$O(DAP(AP)) Q:AP=""  D
"RTN","MBAAMAP4",169,0)
 ; . I DAP(AP,2)["C"!(DAP(AP,2)["N")!(DAP(AP,2)="NT") Q
"RTN","MBAAMAP4",170,0)
 ; . D GETPAPT^MBAAMDA4(.PAP,+DFN,AP,PFLDS)
"RTN","MBAAMAP4",171,0)
 ; . F FLD=0:0 S FLD=$O(PAP(FLD)) Q:'FLD  D
"RTN","MBAAMAP4",172,0)
 ; . . S NM=$$FLDNAME^MBAAMUTL(PFLDS,PNMS,FLD)
"RTN","MBAAMAP4",173,0)
 ; . . S RETURN(AP,NM)=PAP(FLD,"I")_U_PAP(FLD,"E")
"RTN","MBAAMAP4",174,0)
 ; . D GETCAPT^MBAAMDA4(.CAP,+DFN,AP,CFLDS)
"RTN","MBAAMAP4",175,0)
 ; . F FLD=0:0 S FLD=$O(CAP(FLD)) Q:'FLD  D
"RTN","MBAAMAP4",176,0)
 ; . . S NM=$$FLDNAME^MBAAMUTL(CFLDS,CNMS,FLD)
"RTN","MBAAMAP4",177,0)
 ; . . S RETURN(AP,"C",NM)=CAP(FLD)
"RTN","MBAAMAP4",178,0)
 ; Q 1
"RTN","MBAAMAP4",179,0)
 ; ;
"RTN","MBAAMAP4",180,0)
 ;GETPAPT(RETURN,DFN,SD) ; Get patient appointment
"RTN","MBAAMAP4",181,0)
 ; N IND,NAME,FLDS,NAMES,APT
"RTN","MBAAMAP4",182,0)
 ; S FLDS=".01;3;5;6;7;9;12;13;14;15;16;9.5;17;19;20;21;25;26;27;28"
"RTN","MBAAMAP4",183,0)
 ; S NAMES="CLINIC;STATUS;LABDT;XRAYDT;EKGDT;PURPOSE;ARBK;CVISIT;NOSHOWBY;NOSHOWDT;"
"RTN","MBAAMAP4",184,0)
 ; S NAMES=NAMES_"CREASON;TYPE;CREMARKS;ENTRY;MADEDT;OE;RTYPE;NEXTA;DDATE;FVISIT"
"RTN","MBAAMAP4",185,0)
 ; D GETPAPT^MBAAMDA4(.APT,DFN,SD)
"RTN","MBAAMAP4",186,0)
 ; F IND=0:0 S IND=$O(APT(IND)) Q:IND=""  D
"RTN","MBAAMAP4",187,0)
 ; . S NAME=$$FLDNAME^MBAAMUTL(FLDS,NAMES,IND)
"RTN","MBAAMAP4",188,0)
 ; . S RETURN(NAME)=APT(IND,"E")
"RTN","MBAAMAP4",189,0)
 ; . S RETURN(NAME,"I")=APT(IND,"I")
"RTN","MBAAMAP4",190,0)
 ; S RETURN=1
"RTN","MBAAMAP4",191,0)
 ; Q 1
"RTN","MBAAMAP4",192,0)
 ; ;
"RTN","MBAAMAP4",193,0)
 ;GETCAPT(RETURN,DFN,SD) ; Get clinic appointment
"RTN","MBAAMAP4",194,0)
 ; N IND,NAME,FLDS,NAMES,CAPT
"RTN","MBAAMAP4",195,0)
 ; S FLDS=".01;1;3;7;8;9;30;309;302;303;304;306;222;333"
"RTN","MBAAMAP4",196,0)
 ; S NAMES="PATIENT;LENGTH;OTHER;ENTRY;MADEDT;OVERBOOK;EVISIT;CIDT;"
"RTN","MBAAMAP4",197,0)
 ; S NAMES=NAMES_"CIUSER;CODT;COUSER;COENTER;222;333"
"RTN","MBAAMAP4",198,0)
 ; D GETCAPT^MBAAMDA4(.CAPT,DFN,SD)
"RTN","MBAAMAP4",199,0)
 ; F IND=0:0 S IND=$O(CAPT(IND)) Q:IND=""  D
"RTN","MBAAMAP4",200,0)
 ; . S NAME=$$FLDNAME^MBAAMUTL(FLDS,NAMES,IND) Q:NAME=""
"RTN","MBAAMAP4",201,0)
 ; . S RETURN(NAME)=CAPT(IND)
"RTN","MBAAMAP4",202,0)
 ; S RETURN("STATUS")=$$STATUS^SDAM1(DFN,SD,CAPT(222),CAPT(333))
"RTN","MBAAMAP4",203,0)
 ; S RETURN=1
"RTN","MBAAMAP4",204,0)
 ; Q 1
"RTN","MBAAMAP4",205,0)
 ; ;
"RTN","MBAAMAP4",206,0)
 ;GETOE(RETURN,SDOE) ; Get outpatient encounter
"RTN","MBAAMAP4",207,0)
 ; K RETURN
"RTN","MBAAMAP4",208,0)
 ; S RETURN(.07)="",RETURN(.08)="",RETURN(.01)="",RETURN(.02)=""
"RTN","MBAAMAP4",209,0)
 ; S RETURN(.03)="",RETURN(.04)="",RETURN(.05)=""
"RTN","MBAAMAP4",210,0)
 ; D GETOE^MBAAMDA4(.RETURN,SDOE)
"RTN","MBAAMAP4",211,0)
 ; Q:'$D(RETURN) 0
"RTN","MBAAMAP4",212,0)
 ; S RETURN("DATE")=RETURN(.01)
"RTN","MBAAMAP4",213,0)
 ; S RETURN("PATIENT")=RETURN(.02)
"RTN","MBAAMAP4",214,0)
 ; S RETURN("SCODE")=RETURN(.03)
"RTN","MBAAMAP4",215,0)
 ; S RETURN("CLINIC")=RETURN(.04)
"RTN","MBAAMAP4",216,0)
 ; S RETURN("VISIT")=RETURN(.05)
"RTN","MBAAMAP4",217,0)
 ; Q 1
"RTN","MBAAMAP4",218,0)
 ;
"RTN","MBAAMAP4",219,0)
 ;GETPAT(RETURN,DFN) ; Get patient
"RTN","MBAAMAP4",220,0)
 ;N IND,NAME,FLDS,NAMES,PAT
"RTN","MBAAMAP4",221,0)
 ;S RETURN=0
"RTN","MBAAMAP4",222,0)
 ;S FLDS=".01;.02;.03;.05;.08;.361;.323;.131;.111;.134;.112;.135;.1173;.1112;"
"RTN","MBAAMAP4",223,0)
 ;S FLDS=FLDS_".114;.115;.1172;.1171;.133;.32103;.525;.32102;.3213;.32115;.322013"
"RTN","MBAAMAP4",224,0)
 ;S NAMES="PATIENT;SEX;BIRTH;MSTATUS;RELIG;PELIG;PSERV;PHONE;ADD1;"
"RTN","MBAAMAP4",225,0)
 ;S NAMES=NAMES_"CELL;ADD2;PAGER;COUNTRY;ZIP;CITY;STATE;PCODE;PROVINCE;"
"RTN","MBAAMAP4",226,0)
 ;S NAMES=NAMES_"EMAIL;EXPOI;POWSTAT;AGENTO;AGENTOL;PROJ;SASIA"
"RTN","MBAAMAP4",227,0)
 ;D GETPAT^MBAAMDA4(.PAT,DFN)
"RTN","MBAAMAP4",228,0)
 ;F IND=0:0 S IND=$O(PAT(IND)) Q:IND=""  D
"RTN","MBAAMAP4",229,0)
 ;. S NAME=$$FLDNAME^MBAAMUTL(FLDS,NAMES,IND) Q:NAME=""
"RTN","MBAAMAP4",230,0)
 ;. S RETURN(NAME)=PAT(IND,"E")
"RTN","MBAAMAP4",231,0)
 ;. S RETURN(NAME,"I")=PAT(IND,"I")
"RTN","MBAAMAP4",232,0)
 ;S RETURN=1
"RTN","MBAAMAP4",233,0)
 ;Q 1
"RTN","MBAAMAP4",234,0)
 ;
"RTN","MBAAMAP4",235,0)
 ;GETCHLD(RETURN,SDOE) ; Get children encounters
"RTN","MBAAMAP4",236,0)
 ; D GETCHLD^MBAAMDA4(.RETURN,SDOE)
"RTN","MBAAMAP4",237,0)
 ; S RETURN=1
"RTN","MBAAMAP4",238,0)
 ; Q 1
"RTN","MBAAMAP4",239,0)
 ; 
"RTN","MBAAMAP4",240,0)
DOW(SD) ;  Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP4",241,0)
 N Y
"RTN","MBAAMAP4",242,0)
 S %=$E(SD,1,3),Y=$E(SD,4,5),Y=Y>2&'(%#4)+$E("144025036146",Y)
"RTN","MBAAMAP4",243,0)
 F %=%:-1:281 S Y=%#4=1+1+Y
"RTN","MBAAMAP4",244,0)
 S Y=$E(SD,6,7)+Y#7
"RTN","MBAAMAP4",245,0)
 Q Y
"RTN","MBAAMAP4",246,0)
 ;
"RTN","MBAAMAP4",247,0)
SETST(RETURN,SC,SD) ; Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP4",248,0)
 N SDD,ST,PATT,CLN,DATA,SI,DOW
"RTN","MBAAMAP4",249,0)
 S SDD=$P(SD,".",1)
"RTN","MBAAMAP4",250,0)
 S ST=$$GETDST^MBAAMDA1(SC,SDD)
"RTN","MBAAMAP4",251,0)
 S RETURN=0
"RTN","MBAAMAP4",252,0)
 I $G(ST)']"" D  Q:RETURN=0 0
"RTN","MBAAMAP4",253,0)
 . S DOW=$$DOW(SD)
"RTN","MBAAMAP4",254,0)
 . D GETDPATT^MBAAMDA1(.PATT,SC,SDD,DOW)
"RTN","MBAAMAP4",255,0)
 . I PATT("IEN")'>0!($G(PATT("PAT"))="") D ERRX^MBAAAPIE(.RETURN,"APTWHEN") Q
"RTN","MBAAMAP4",256,0)
 . S ST=PATT("PAT")
"RTN","MBAAMAP4",257,0)
 . S CLN(1917)=""
"RTN","MBAAMAP4",258,0)
 . D GETCLNX^MBAAMDA1(.CLN,SC)
"RTN","MBAAMAP4",259,0)
 . S SI=CLN(1917),SI=$S(SI="":4,SI<3:4,SI:SI,1:4)
"RTN","MBAAMAP4",260,0)
 . S ST=$E($P($T(DAY),U,DOW+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_ST
"RTN","MBAAMAP4",261,0)
 . S DATA(.01)=SDD,DATA(1)=ST
"RTN","MBAAMAP4",262,0)
 . D ADDPATT^MBAAMDA1(.DATA,SC,SDD)
"RTN","MBAAMAP4",263,0)
 . S RETURN=1
"RTN","MBAAMAP4",264,0)
 S RETURN=1
"RTN","MBAAMAP4",265,0)
 Q 1
"RTN","MBAAMAP4",266,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","MBAAMAP4",267,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP4",268,0)
 ;CANDELCO(RETURN) ; Check if user can delete check out data
"RTN","MBAAMAP4",269,0)
 ; N KEYS,SUP K RETURN
"RTN","MBAAMAP4",270,0)
 ; S KEYS("SD SUPERVISOR")=""
"RTN","MBAAMAP4",271,0)
 ; D GETXUS^MBAAMDA3(.SUP,.KEYS,DUZ)
"RTN","MBAAMAP4",272,0)
 ; I '$D(SUP("SD SUPERVISOR")) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCOSU") Q 0
"RTN","MBAAMAP4",273,0)
 ; S RETURN=1
"RTN","MBAAMAP4",274,0)
 ; Q 1
"RTN","MBAAMAP4",275,0)
 ;
"RTN","MBAAMAP4",276,0)
 ;DELCODT(RETURN,SDOE) ;Delete Check Out Process Completion Date
"RTN","MBAAMAP4",277,0)
 ; D DELCODT^MBAAMDA4(.RETURN,SDOE)
"RTN","MBAAMAP4",278,0)
 ; S RETURN=1
"RTN","MBAAMAP4",279,0)
 ; Q 1
"RTN","MBAAMAP4",280,0)
 ;
"RTN","MBAAMAP4",281,0)
 ;ADDTSTS(RETURN,DFN,SD,LAB,XRAY,EKG) ; Append tests to pending appointment
"RTN","MBAAMAP4",282,0)
 ; N DATA,ERR
"RTN","MBAAMAP4",283,0)
 ; K RETURN
"RTN","MBAAMAP4",284,0)
 ; S %=$$ISOECO^MBAAMAP4(.ERR,DFN,SD,"add")
"RTN","MBAAMAP4",285,0)
 ; I ERR=1 M RETURN=ERR S RETURN=0 Q 0
"RTN","MBAAMAP4",286,0)
 ; S:$D(LAB) DATA(5)=LAB
"RTN","MBAAMAP4",287,0)
 ; S:$D(XRAY) DATA(6)=XRAY
"RTN","MBAAMAP4",288,0)
 ; S:$D(EKG) DATA(7)=EKG
"RTN","MBAAMAP4",289,0)
 ; D UPDPAPT^MBAAMDA4(.DATA,DFN,SD)
"RTN","MBAAMAP4",290,0)
 ; S RETURN=1
"RTN","MBAAMAP4",291,0)
 ; Q 1
"RTN","MBAAMAP4",292,0)
 ;
"RTN","MBAAMAP4",293,0)
 ;DELTSTS(RETURN,DFN,SD,LAB,XRAY,EKG) ; Delete tests from pending appointment
"RTN","MBAAMAP4",294,0)
 ; N DATA,ERR
"RTN","MBAAMAP4",295,0)
 ; K RETURN
"RTN","MBAAMAP4",296,0)
 ; S %=$$ISOECO^MBAAMAP4(.ERR,DFN,SD,"delete")
"RTN","MBAAMAP4",297,0)
 ; I ERR=1 M RETURN=ERR S RETURN=0 Q 0
"RTN","MBAAMAP4",298,0)
 ; S:$D(LAB) DATA(5)="@"
"RTN","MBAAMAP4",299,0)
 ; S:$D(XRAY) DATA(6)="@"
"RTN","MBAAMAP4",300,0)
 ; S:$D(EKG) DATA(7)="@"
"RTN","MBAAMAP4",301,0)
 ; D UPDPAPT^MBAAMDA4(.DATA,DFN,SD)
"RTN","MBAAMAP4",302,0)
 ; S RETURN=1
"RTN","MBAAMAP4",303,0)
 ; Q 1
"RTN","MBAAMAP4",304,0)
 ;
"RTN","MBAAMAP4",305,0)
ISAPTCO(RETURN,DFN,SD) ; Is appointment checked out? Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMAP4",306,0)
 N APT,FLDS
"RTN","MBAAMAP4",307,0)
 S FLDS="303"
"RTN","MBAAMAP4",308,0)
 D GETCAPT^MBAAMDA4(.APT,+DFN,+SD,.FLDS,"I")
"RTN","MBAAMAP4",309,0)
 S RETURN=1
"RTN","MBAAMAP4",310,0)
 Q $G(APT(303,"I"))>0
"RTN","MBAAMAP4",311,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP4",312,0)
 ;ISOECO(RETURN,DFN,SD,OP) ; Is outpatient encounter checked out?
"RTN","MBAAMAP4",313,0)
 ;N OE,APT,FLDS,PARAM
"RTN","MBAAMAP4",314,0)
 ;S RETURN=0,DFN=+DFN,PARAM(1)=OP
"RTN","MBAAMAP4",315,0)
 ;S OE(.12)="",FLDS="21"
"RTN","MBAAMAP4",316,0)
 ;D GETPAPT^MBAAMDA4(.APT,+DFN,+SD,.FLDS)
"RTN","MBAAMAP4",317,0)
 ;I $G(APT(21,"I"))="" Q 1
"RTN","MBAAMAP4",318,0)
 ;D GETOE^MBAAMDA4(.OE,APT(21,"I"))
"RTN","MBAAMAP4",319,0)
 ;I OE(.12)=2 D BLD^DIALOG(480000.03,.OP,,"RETURN","FS") S RETURN=1
"RTN","MBAAMAP4",320,0)
 ;Q 1
"RTN","MBAAMAP4",321,0)
 ;
"RTN","MBAAMAP4",322,0)
GETHOL(RETURN,SD) ; Get holiday MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP4",323,0)
 D GETHOL^MBAAMDA1(.RETURN,SD)
"RTN","MBAAMAP4",324,0)
 Q 1
"RTN","MBAAMAPI")
0^8^B1705181^n/a
"RTN","MBAAMAPI",1,0)
MBAAMAPI ;OIT-PD/VSL - APPOINTMENT API UTILS ;02/10/2016
"RTN","MBAAMAPI",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAMAPI",3,0)
 ;
"RTN","MBAAMAPI",4,0)
 ;Associated ICRs
"RTN","MBAAMAPI",5,0)
 ; ICR#
"RTN","MBAAMAPI",6,0)
 ; 10103 XLFDT
"RTN","MBAAMAPI",7,0)
 ;
"RTN","MBAAMAPI",8,0)
BLDLST(RETURN,LST,FLDS) ; Build simple list.  MBAA RPC: MBAA CANCEL APPOINTMENT, MBAA LIST CANCELLATION REASONS, MBAA APPOINTMENT MAKE
"RTN","MBAAMAPI",9,0)
 N DL,IN,FLD
"RTN","MBAAMAPI",10,0)
 S RETURN=0
"RTN","MBAAMAPI",11,0)
 Q:'$D(LST)
"RTN","MBAAMAPI",12,0)
 S RETURN(0)=LST("DILIST",0)
"RTN","MBAAMAPI",13,0)
 S DL="DILIST"
"RTN","MBAAMAPI",14,0)
 F IN=1:1:$P(RETURN(0),U,1) D
"RTN","MBAAMAPI",15,0)
 . S RETURN(IN)=""
"RTN","MBAAMAPI",16,0)
 . S RETURN(IN,"ID")=LST(DL,2,IN)
"RTN","MBAAMAPI",17,0)
 . I $O(LST(DL,"ID",IN,".01",""))'="" D
"RTN","MBAAMAPI",18,0)
 . . S RETURN(IN,"NAME")=$G(LST(DL,"ID",IN,".01","I"))_"^"_LST(DL,"ID",IN,".01","E")
"RTN","MBAAMAPI",19,0)
 . E  S RETURN(IN,"NAME")=LST(DL,"ID",IN,".01")
"RTN","MBAAMAPI",20,0)
 . I $D(FLDS) D
"RTN","MBAAMAPI",21,0)
 . . F FLD=0:0 S FLD=$O(FLDS(FLD)) Q:FLD=""  D
"RTN","MBAAMAPI",22,0)
 . . . I $O(LST(DL,"ID",IN,FLD,""))'="" D
"RTN","MBAAMAPI",23,0)
 . . . . S RETURN(IN,FLDS(FLD))=$G(LST(DL,"ID",IN,FLD,"I"))_"^"_LST(DL,"ID",IN,FLD,"E")
"RTN","MBAAMAPI",24,0)
 . . . E  S RETURN(IN,FLDS(FLD))=LST(DL,"ID",IN,FLD)
"RTN","MBAAMAPI",25,0)
 S RETURN=1
"RTN","MBAAMAPI",26,0)
 Q
"RTN","MBAAMAPI",27,0)
 ;
"RTN","MBAAMAPI",28,0)
DTS(SD) ; Return formated date (07/16/2012) Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAPI",29,0)
 Q $TR($$FMTE^XLFDT(SD,"5DF")," ","0")  ;ICR#: 10103 XLFDT
"RTN","MBAAMAPI",30,0)
 ;
"RTN","MBAAMDA1")
0^9^B66171145^n/a
"RTN","MBAAMDA1",1,0)
MBAAMDA1 ;OIT-PD/CBR - APPOINTMENT API ;02/10/2016
"RTN","MBAAMDA1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMDA1",3,0)
 ;
"RTN","MBAAMDA1",4,0)
 ;Associated ICRs
"RTN","MBAAMDA1",5,0)
 ;  ICR#
"RTN","MBAAMDA1",6,0)
 ;  10038 HOLIDAY FILE
"RTN","MBAAMDA1",7,0)
 ;  6044 SC(
"RTN","MBAAMDA1",8,0)
 ;  10103 XLFDT
"RTN","MBAAMDA1",9,0)
 ;
"RTN","MBAAMDA1",10,0)
GETCLN(RETURN,CLN,INT,EXT,REZ) ; Get clinic detail Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT, MBAA PATIENT PENDING APPT
"RTN","MBAAMDA1",11,0)
 N FILE,SFILES,FLDS
"RTN","MBAAMDA1",12,0)
 S FILE=44
"RTN","MBAAMDA1",13,0)
 S FLDS("*")=""
"RTN","MBAAMDA1",14,0)
 S SFILES("2501")="",SFILES("2501","N")="PRIVILEGED USER",SFILES("2501","F")="44.04"
"RTN","MBAAMDA1",15,0)
 S SFILES("1910")="",SFILES("1910","N")="SI",SFILES("1910","F")="44.03"
"RTN","MBAAMDA1",16,0)
 S ROUT=1
"RTN","MBAAMDA1",17,0)
 D GETREC^MBAAMDAL(.RETURN,CLN,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","MBAAMDA1",18,0)
 Q
"RTN","MBAAMDA1",19,0)
 ;
"RTN","MBAAMDA1",20,0)
GETCLNX(RETURN,SC) ; Get clinic detailx Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",21,0)
 N IND
"RTN","MBAAMDA1",22,0)
 F IND=0:0 S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","MBAAMDA1",23,0)
 . S RETURN(IND)=$$GET1^DIQ(44,SC_",",IND,"I")
"RTN","MBAAMDA1",24,0)
 S RETURN=1
"RTN","MBAAMDA1",25,0)
 Q
"RTN","MBAAMDA1",26,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA1",27,0)
 ;LSTCLNS(RETURN,SEARCH,START,NUMBER) ; Return clinics filtered by name.
"RTN","MBAAMDA1",28,0)
 ; N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA1",29,0)
 ; S FILE="44",FIELDS="@;.01"
"RTN","MBAAMDA1",30,0)
 ; S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA1",31,0)
 ; S SCR="I $P(^(0),U,3)=""C"",'$G(^(""OOS""))"
"RTN","MBAAMDA1",32,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","MBAAMDA1",33,0)
 ; Q
"RTN","MBAAMDA1",34,0)
 ; ;
"RTN","MBAAMDA1",35,0)
GETCSC(FLDS,CSC) ; Get Clinic Stop Code MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",36,0)
 N FLD,C
"RTN","MBAAMDA1",37,0)
 D GETS^DIQ(40.7,CSC,"*","I","C")
"RTN","MBAAMDA1",38,0)
 S FLD=""
"RTN","MBAAMDA1",39,0)
 F  S FLD=$O(C(40.7,""_CSC_",",FLD)) Q:FLD=""  D
"RTN","MBAAMDA1",40,0)
 . S FLDS(FLD)=C(40.7,""_CSC_",",FLD,"I")
"RTN","MBAAMDA1",41,0)
 Q
"RTN","MBAAMDA1",42,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA1",43,0)
 ;CLNURGHT(CLN,USR,DATA) ; Return user right
"RTN","MBAAMDA1",44,0)
 ; S DATA=$G(^SC(CLN,"SDPRIV",USR,0))
"RTN","MBAAMDA1",45,0)
 ; Q
"RTN","MBAAMDA1",46,0)
 ;
"RTN","MBAAMDA1",47,0)
 ;LSTTMPL(RETURN,CLN) ; List defined day template
"RTN","MBAAMDA1",48,0)
 ; N FILE,SFILES,FLDS
"RTN","MBAAMDA1",49,0)
 ; S FILE=44
"RTN","MBAAMDA1",50,0)
 ; S SFILES("1922")="",SFILES("1922","N")="SUNDAY TEMPLATE",SFILES("1922","F")="44.06"
"RTN","MBAAMDA1",51,0)
 ; S SFILES("1923")="",SFILES("1923","N")="MONDAY TEMPLATE",SFILES("1923","F")="44.07"
"RTN","MBAAMDA1",52,0)
 ; S SFILES("1924")="",SFILES("1924","N")="TUESDAY TEMPLATE",SFILES("1924","F")="44.08"
"RTN","MBAAMDA1",53,0)
 ; S SFILES("1925")="",SFILES("1925","N")="WEDNESDAY TEMPLATE",SFILES("1925","F")="44.09"
"RTN","MBAAMDA1",54,0)
 ; S SFILES("1926")="",SFILES("1926","N")="THURSDAY TEMPLATE",SFILES("1926","F")="44.08"
"RTN","MBAAMDA1",55,0)
 ; S SFILES("1927")="",SFILES("1927","N")="FRIDAY TEMPLATE",SFILES("1927","F")="44.09"
"RTN","MBAAMDA1",56,0)
 ; S SFILES("1928")="",SFILES("1928","N")="SATURDAY TEMPLATE",SFILES("1928","F")="44.0001"
"RTN","MBAAMDA1",57,0)
 ; D GETREC^MBAAMDAL(.RETURN,CLN,FILE,.FLDS,.SFILES)
"RTN","MBAAMDA1",58,0)
 ; Q
"RTN","MBAAMDA1",59,0)
 ;
"RTN","MBAAMDA1",60,0)
 ;NXTAV(CLN,SD) ; Get next available day.
"RTN","MBAAMDA1",61,0)
 ; Q $O(^SC(CLN,"ST",SD))
"RTN","MBAAMDA1",62,0)
 ; ;
"RTN","MBAAMDA1",63,0)
GETHOL(RETURN,SDATE) ; Get holiday. Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",64,0)
 S RETURN=0
"RTN","MBAAMDA1",65,0)
 ;S:$D(^HOLIDAY(SDATE)) RETURN(0)=$G(^HOLIDAY(SDATE,0))
"RTN","MBAAMDA1",66,0)
 N X,X1
"RTN","MBAAMDA1",67,0)
 S X=$$GET1^DIQ(40.5,SDATE,.01,"I")  ;ICR#: 10038 HOLIDAY FILE
"RTN","MBAAMDA1",68,0)
 S X1=$$GET1^DIQ(40.5,SDATE,2,"I")  ;ICR#: 10038 HOLIDAY FILE
"RTN","MBAAMDA1",69,0)
 I $G(X)'="" S RETURN(0)=X_"^"_X1
"RTN","MBAAMDA1",70,0)
 K X,X1
"RTN","MBAAMDA1",71,0)
 S RETURN=1
"RTN","MBAAMDA1",72,0)
 Q
"RTN","MBAAMDA1",73,0)
 ;
"RTN","MBAAMDA1",74,0)
 ;GETPATT(RETURN,SC,SD) ; Get date pattern Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",75,0)
GETPATT(RETURN,SC,SD) ; Get date pattern Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",76,0)
 S RETURN=0
"RTN","MBAAMDA1",77,0)
 ;T13 change to use FM reads
"RTN","MBAAMDA1",78,0)
 N X S IENS=$P(SD,".")_","_SC_",",X=$$GET1^DIQ(44.005,IENS,1),RETURN(0)=$G(X)
"RTN","MBAAMDA1",79,0)
 ;S:$D(^SC(SC,"ST",$P(SD,"."),1)) RETURN(0)=^SC(SC,"ST",$P(SD,"."),1)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",80,0)
 ;N X S IENS=$P(SD,".")_","_SC_",",X=$$GET1^DIQ(44.005,IENS,"CAN"),RETURN(0)=$G(X)
"RTN","MBAAMDA1",81,0)
 ;T13 the line below is removed as this node is not defined in the DD.
"RTN","MBAAMDA1",82,0)
 ;S:$D(^SC(SC,"ST",$P(SD,"."),"CAN")) RETURN(1)=^SC(SC,"ST",$P(SD,"."),"CAN")  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",83,0)
 S RETURN=1
"RTN","MBAAMDA1",84,0)
 Q
"RTN","MBAAMDA1",85,0)
 ;
"RTN","MBAAMDA1",86,0)
GETSCAP(RETURN,SC,DFN,SD) ; Get clinic appointment Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT, MBAA PATIENT PENDING APPT
"RTN","MBAAMDA1",87,0)
 N ZL,CO
"RTN","MBAAMDA1",88,0)
 I $D(^SC(SC,"S",SD))  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",89,0)
 . S ZL=0
"RTN","MBAAMDA1",90,0)
 . F  S ZL=$O(^SC(SC,"S",SD,1,ZL)) Q:'ZL  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",91,0)
 . . I '$D(^SC(SC,"S",SD,1,ZL,0)) Q  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",92,0)
 . . S IENS=$G(ZL)_","_$G(SD)_","_$G(SC)_",",FLDS=".01;1;2;3;4;7;8;10;310;30;9;688"
"RTN","MBAAMDA1",93,0)
 . . N LEN,XRAY,OTHER,WARD,CLERK,DTMADE,XRAYRST,APTCAN,ELIG,OB,ARRAY,ERR,CON1
"RTN","MBAAMDA1",94,0)
 . . N ARRAY,ERR D GETS^DIQ(44.003,IENS,FLDS,"IE","ARRAY","ERR")
"RTN","MBAAMDA1",95,0)
 . . I $G(ARRAY(44.003,IENS,.01,"I"))'=DFN Q
"RTN","MBAAMDA1",96,0)
 . . S LEN=$G(ARRAY(44.003,IENS,1,"I")),XRAY=$G(ARRAY(44.003,IENS,2,"I")),OTHER=$G(ARRAY(44.003,IENS,3,"I"))
"RTN","MBAAMDA1",97,0)
 . . S WARD=$G(ARRAY(44.003,IENS,4,"I")),CLERK=$G(ARRAY(44.003,IENS,7,"I")),DTMADE=$G(ARRAY(44.003,IENS,8,"I")),OB=$G(ARRAY(44.003,IENS,9,"I"))
"RTN","MBAAMDA1",98,0)
 . . S XRAYRST=$G(ARRAY(44.003,IENS,10,"I")),APTCAN=$G(ARRAY(44.003,IENS,310,"I")),ELIG=$G(ARRAY(44.003,IENS,30,"I")),CON1=$G(ARRAY(44.003,IENS,688,"I"))
"RTN","MBAAMDA1",99,0)
 . . ;N CON1 S CON1=$$GET1^DIQ(44,IENS,688)
"RTN","MBAAMDA1",100,0)
 . . S RETURN(0)=$G(DFN)_U_$G(LEN)_U_$G(XRAY)_U_$G(OTHER)_U_$G(WARD)_U_$G(CLERK)_U_$G(DTMADE)_U_$G(XRAYRST)_U_$G(APTCAN)_U_$G(ELIG)_U_$G(CON1)
"RTN","MBAAMDA1",101,0)
 . . S:$G(OB)'="" RETURN("OB")=$G(OB)
"RTN","MBAAMDA1",102,0)
 . . S RETURN=ZL
"RTN","MBAAMDA1",103,0)
 . Q
"RTN","MBAAMDA1",104,0)
 Q
"RTN","MBAAMDA1",105,0)
 ;
"RTN","MBAAMDA1",106,0)
GETCAPT(RETURN,SC,SD,IFN,FLAG) ; Get clinic appointment by IFN Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA1",107,0)
 N CAPT
"RTN","MBAAMDA1",108,0)
 S DIQ="CAPT(",DIC="^SC(SC,""S"",SD,1,",DIQ(0)=$G(FLAG)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",109,0)
 S DA=IFN,DR=".01;1;3;7;8;9;30;309;302;303;304;306;688"
"RTN","MBAAMDA1",110,0)
 D EN^DIQ1
"RTN","MBAAMDA1",111,0)
 M RETURN=CAPT(44.003,IFN)
"RTN","MBAAMDA1",112,0)
 S RETURN(222)=SC
"RTN","MBAAMDA1",113,0)
 S RETURN(333)=IFN
"RTN","MBAAMDA1",114,0)
 Q
"RTN","MBAAMDA1",115,0)
 ;
"RTN","MBAAMDA1",116,0)
LOCKST(SC,SD) ; Lock availability node Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",117,0)
 L +^SC(SC,"ST",$P(SD,"."),1):5 Q:'$T 0  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",118,0)
 Q 1
"RTN","MBAAMDA1",119,0)
 ;
"RTN","MBAAMDA1",120,0)
UNLCKST(SC,SD) ; Lock availability node  Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",121,0)
 L -^SC(SC,"ST",$P(SD,"."),1)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",122,0)
 Q
"RTN","MBAAMDA1",123,0)
 ;
"RTN","MBAAMDA1",124,0)
LOCKS(SC,SD) ; Lock clinic date node Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",125,0)
 L +^SC(SC,"S",$P(SD,"."),1):5 Q:'$T 0  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",126,0)
 Q 1
"RTN","MBAAMDA1",127,0)
 ;
"RTN","MBAAMDA1",128,0)
UNLCKS(SC,SD) ; Unlock clinic date node Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",129,0)
 L -^SC(SC,"S",$P(SD,"."),1)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",130,0)
 Q
"RTN","MBAAMDA1",131,0)
 ;
"RTN","MBAAMDA1",132,0)
SETST(SC,SD,S) ; Set availability Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",133,0)
 ;S ^SC(SC,"ST",$P(SD,".",1),1)=S  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",134,0)
 ;T13 CHANGE
"RTN","MBAAMDA1",135,0)
 N ERR,FDA,IENS
"RTN","MBAAMDA1",136,0)
 S IENS=$P(SD,".")_","_SC_","
"RTN","MBAAMDA1",137,0)
 ;S IENS(2)=$P(SD,".")
"RTN","MBAAMDA1",138,0)
 ;S FDA(44.005,IENS,.01)=$P(SD,".")
"RTN","MBAAMDA1",139,0)
 S FDA(44.005,IENS,1)=$G(S)
"RTN","MBAAMDA1",140,0)
 D FILE^DIE("","FDA","ERR")
"RTN","MBAAMDA1",141,0)
 Q
"RTN","MBAAMDA1",142,0)
 ;
"RTN","MBAAMDA1",143,0)
 ;MAKE(SC,SD,DFN,LEN,SM,USR,OTHR,RQXRAY) ; Make clinic appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",144,0)
MAKE(SC,SD,DFN,LEN,SM,USR,OTHR,RQXRAY)  ; Make clinic appointment Called by the RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",145,0)
 N ERR,FDA,IENS
"RTN","MBAAMDA1",146,0)
 S IENS="+2,"_SC_","
"RTN","MBAAMDA1",147,0)
 S IENS(2)=+SD
"RTN","MBAAMDA1",148,0)
 S FDA(44.001,IENS,.01)=+SD
"RTN","MBAAMDA1",149,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","MBAAMDA1",150,0)
 S SD=$G(IENS(2))
"RTN","MBAAMDA1",151,0)
 K FDA,IENS
"RTN","MBAAMDA1",152,0)
 S IENS="+1,"_+SD_","_SC_","
"RTN","MBAAMDA1",153,0)
 S FDA(44.003,IENS,.01)=DFN
"RTN","MBAAMDA1",154,0)
 S FDA(44.003,IENS,1)=LEN
"RTN","MBAAMDA1",155,0)
 S FDA(44.003,IENS,3)=$G(OTHR)
"RTN","MBAAMDA1",156,0)
 S FDA(44.003,IENS,7)=USR
"RTN","MBAAMDA1",157,0)
 S FDA(44.003,IENS,8)=$P($$NOW^XLFDT,".")  ;ICR#: 10103 XLFDT
"RTN","MBAAMDA1",158,0)
 S:$G(SM) FDA(44.003,IENS,9)="O"
"RTN","MBAAMDA1",159,0)
 ;T13 change
"RTN","MBAAMDA1",160,0)
 ;I $D(RQXRAY),RQXRAY>0 S ^SC("ARAD",SC,SD,DFN)=""  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",161,0)
 I $D(RQXRAY),RQXRAY>0 S FDA(44.003,IENS,10)="Y"  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",162,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","MBAAMDA1",163,0)
 Q
"RTN","MBAAMDA1",164,0)
 ;
"RTN","MBAAMDA1",165,0)
CANCEL(SC,SD,DFN,CIFN) ; Kill clinic appointment Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA1",166,0)
 ;S SDNODE=^SC(SC,"S",SD,1,CIFN,0)
"RTN","MBAAMDA1",167,0)
 N HSI,SB,SDDIF,SI,SL,SS,ST,STARTDAY,STR
"RTN","MBAAMDA1",168,0)
 S SC1=SC
"RTN","MBAAMDA1",169,0)
 S ^SC("ARAD",SC,SD,DFN)="N"  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",170,0)
 ;S TLNK=$P($G(^SC(SC,"S",SD,1,CIFN,"CONS")),U)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",171,0)
 K ^SC(SC,"S",SD,1,CIFN)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",172,0)
 K:$O(^SC(SC,"S",SD,0))'>0 ^SC(SC,"S",SD,0)  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",173,0)
 ;T13 CHANGE
"RTN","MBAAMDA1",174,0)
 ;K:TLNK'="" ^SC("AWAS1",TLNK),TLNK  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",175,0)
 Q:'$D(^SC(SC,"ST",SD\1,1))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",176,0)
 ;T13 Change
"RTN","MBAAMDA1",177,0)
 N XL1,IENS
"RTN","MBAAMDA1",178,0)
 S IENS=SC_"," D GETS^DIQ(44,IENS,"1914;1917","I","XL1") S SL=$G(XL1(44,IENS,1917,"I")),X=$G(XL1(44,IENS,1914,"I"))
"RTN","MBAAMDA1",179,0)
 S SL=$$GET1^DIQ(44,SC,1917,"I"),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",180,0)
 ;S SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",181,0)
 N IENS
"RTN","MBAAMDA1",182,0)
 S IENS=$P(SD,".")_","_SC_",",S=$$GET1^DIQ(44.005,IENS,1),Y=SD#1-SB*100,ST=Y#1*SI\.6+(Y\1*SI),SS=SL*HSI/60
"RTN","MBAAMDA1",183,0)
 ;S S=^SC(SC,"ST",SD\1,1),Y=SD#1-SB*100,ST=Y#1*SI\.6+(Y\1*SI),SS=SL*HSI/60  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",184,0)
 I Y'<1 F I=ST+ST:SDDIF S Y=$E(STR,$F(STR,$E(S,I+1))) Q:Y=""  S S=$E(S,1,I)_Y_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","MBAAMDA1",185,0)
 ;Code below changed to correct the naked global reference
"RTN","MBAAMDA1",186,0)
 ;S ^(1)=S
"RTN","MBAAMDA1",187,0)
 ;S ^SC(SC,"ST",SD\1,1)=S  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",188,0)
 ;T13 CHANGE
"RTN","MBAAMDA1",189,0)
 S SC=SC1 K SC1
"RTN","MBAAMDA1",190,0)
 D SETST(SC,SD,S)
"RTN","MBAAMDA1",191,0)
 Q
"RTN","MBAAMDA1",192,0)
 ;
"RTN","MBAAMDA1",193,0)
COVERB(SC,SD,IFN) ; Kill first overbook appointment Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA1",194,0)
 I $D(^SC(SC,"S",SD,1,IFN,"OB")) Q 0  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",195,0)
 N X,OIFN
"RTN","MBAAMDA1",196,0)
 S X=IFN,OIFN=0
"RTN","MBAAMDA1",197,0)
 F  S X=$O(^SC(SC,"S",SD,1,X)) Q:X=""!(OIFN>0)  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",198,0)
 . I $D(^SC(SC,"S",SD,1,X,"OB")) K ^SC(SC,"S",SD,1,X,"OB") S OIFN=X  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",199,0)
 Q OIFN
"RTN","MBAAMDA1",200,0)
 ;
"RTN","MBAAMDA1",201,0)
GETFSTA(SC) ; Get first available day. Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",202,0)
 N I
"RTN","MBAAMDA1",203,0)
 S I=0
"RTN","MBAAMDA1",204,0)
 Q $O(^SC(SC,"T",I))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",205,0)
 ;
"RTN","MBAAMDA1",206,0)
GETDAYA(RETURN,SC,SD) ; Get all day appointments Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",207,0)
 N IND,I,D
"RTN","MBAAMDA1",208,0)
 S I=$P(SD,".",1)
"RTN","MBAAMDA1",209,0)
 F D=I-.01:0 S D=$O(^SC(SC,"S",D)) Q:$P(D,".",1)-I  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",210,0)
 . S %=0
"RTN","MBAAMDA1",211,0)
 . F  S %=$O(^SC(SC,"S",D,1,%)) Q:%'>0  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",212,0)
 . . Q:'$D(^SC(SC,"S",D,1,%,0))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",213,0)
 . . ; next two lines changed to correct the naked global reference
"RTN","MBAAMDA1",214,0)
 . . ;S RETURN(%,"STATUS")=$P(^(0),U,9)
"RTN","MBAAMDA1",215,0)
 . . ;S RETURN(%,"OB")=$D(^("OB"))
"RTN","MBAAMDA1",216,0)
 . . ;T13 Change
"RTN","MBAAMDA1",217,0)
 . . S DIQ="CAPT(",DIC="^SC(SC,""S"",D,1,",DA=%,DR="310;9" D EN^DIQ1
"RTN","MBAAMDA1",218,0)
 . . S %=DA
"RTN","MBAAMDA1",219,0)
 . . S RETURN(%,"STATUS")=$G(CAPT(44.003,%,310))
"RTN","MBAAMDA1",220,0)
 . . S RETURN(%,"OB")=$G(CAPT(44.003,%,9))
"RTN","MBAAMDA1",221,0)
 . . K DIQ,DA,DR,DIC,CAPT
"RTN","MBAAMDA1",222,0)
 . . I $G(I)="" S I=$P(SD,".",1)
"RTN","MBAAMDA1",223,0)
 . . ;S RETURN(%,"STATUS")=$P(^SC(SC,"S",D,1,%,0),U,9)
"RTN","MBAAMDA1",224,0)
 . . ;S RETURN(%,"OB")=$D(^SC(SC,"S",D,1,%,"OB"))
"RTN","MBAAMDA1",225,0)
 Q
"RTN","MBAAMDA1",226,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA1",227,0)
 ;LSTCAPTS(RETURN,SC,SDBEG,SDEND) ; 
"RTN","MBAAMDA1",228,0)
 ; N SDT,SDDA,CNT,APT,SDATA,CNSTLNK
"RTN","MBAAMDA1",229,0)
 ; S CNT=0 S:'$D(SDBEG) SDBEG=1 S:'$D(SDEND) SDEND=99999999
"RTN","MBAAMDA1",230,0)
 ; F SDT=SDBEG:0 S SDT=$O(^SC(SC,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  D
"RTN","MBAAMDA1",231,0)
 ; . F SDDA=0:0 S SDDA=$O(^SC(SC,"S",SDT,1,SDDA)) Q:'SDDA  D
"RTN","MBAAMDA1",232,0)
 ; . . S CNSTLNK=$P($G(^SC(SC,"S",SDT,1,SDDA,"CONS")),U)
"RTN","MBAAMDA1",233,0)
 ; . . Q:'$D(^SC(SC,"S",SDT,1,SDDA,0))
"RTN","MBAAMDA1",234,0)
 ; . . ; next line changed to correct the naked global reference
"RTN","MBAAMDA1",235,0)
 ; . . ;S APT=^(0)
"RTN","MBAAMDA1",236,0)
 ; . . S APT=$G(^SC(SC,"S",SDT,1,SDDA,0))
"RTN","MBAAMDA1",237,0)
 ; . . S CNT=CNT+1
"RTN","MBAAMDA1",238,0)
 ; . . S SDATA=^DPT(+APT,"S",SDT,0)
"RTN","MBAAMDA1",239,0)
 ; . . S RETURN(CNT,"CONS")=$G(CNSTLNK)
"RTN","MBAAMDA1",240,0)
 ; . . S RETURN(CNT,"SD")=SDT
"RTN","MBAAMDA1",241,0)
 ; . . S RETURN(CNT,"SC")=+SDATA
"RTN","MBAAMDA1",242,0)
 ; . . S RETURN(CNT,"DFN")=+APT
"RTN","MBAAMDA1",243,0)
 ; . . S RETURN(CNT,"SDDA")=SDDA
"RTN","MBAAMDA1",244,0)
 ; . . S RETURN(CNT,"SDATA")=SDATA
"RTN","MBAAMDA1",245,0)
 ; . . S RETURN(CNT,"CDATA")=APT
"RTN","MBAAMDA1",246,0)
 ; Q
"RTN","MBAAMDA1",247,0)
 ; ;
"RTN","MBAAMDA1",248,0)
 ;LSTPAPTS(RETURN,DFN,SDBEG,SDEND) ; Get patient appointments
"RTN","MBAAMDA1",249,0)
 ; N SDT,CNT,SDDA,SC,CN,CNPAT
"RTN","MBAAMDA1",250,0)
 ; S CNT=0 S:'$D(SDBEG) SDBEG=DT S:'$D(SDEND) SDEND=99999999
"RTN","MBAAMDA1",251,0)
 ; F SDT=SDBEG:0 S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  D
"RTN","MBAAMDA1",252,0)
 ; . Q:'$D(^(SDT,0))
"RTN","MBAAMDA1",253,0)
 ; . S CNT=CNT+1
"RTN","MBAAMDA1",254,0)
 ; . S SDATA=^DPT(+DFN,"S",SDT,0)
"RTN","MBAAMDA1",255,0)
 ; . S SC=+SDATA
"RTN","MBAAMDA1",256,0)
 ; . S RETURN(CNT,"CONS")=$G(CNSTLNK)
"RTN","MBAAMDA1",257,0)
 ; . S RETURN(CNT,"SD")=SDT
"RTN","MBAAMDA1",258,0)
 ; . S RETURN(CNT,"SC")=SC
"RTN","MBAAMDA1",259,0)
 ; . S RETURN(CNT,"DFN")=DFN
"RTN","MBAAMDA1",260,0)
 ; . S SDDA="",CN=0
"RTN","MBAAMDA1",261,0)
 ; . F  S CN=$O(^SC(SC,"S",SDT,1,CN)) Q:'+CN!(SDDA>0)  D
"RTN","MBAAMDA1",262,0)
 ; . . S CNPAT=$P($G(^SC(SC,"S",SDT,1,CN,0)),U)
"RTN","MBAAMDA1",263,0)
 ; . . Q:CNPAT'=DFN
"RTN","MBAAMDA1",264,0)
 ; . . S SDDA=CN
"RTN","MBAAMDA1",265,0)
 ; . S RETURN(CNT,"SDDA")=SDDA
"RTN","MBAAMDA1",266,0)
 ; . S RETURN(CNT,"SDATA")=SDATA
"RTN","MBAAMDA1",267,0)
 ; . S:SDDA>0 RETURN(CNT,"CDATA")=$G(^SC(SC,"S",SDT,1,SDDA,0))
"RTN","MBAAMDA1",268,0)
 ; Q
"RTN","MBAAMDA1",269,0)
 ;
"RTN","MBAAMDA1",270,0)
GETDST(SC,SD) ; Get day slot  Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",271,0)
 ;T13 change to use a FM call to get the data from the file
"RTN","MBAAMDA1",272,0)
 N X S IENS=$P(SD,".")_","_SC_",",X=$$GET1^DIQ(44.005,IENS,1)
"RTN","MBAAMDA1",273,0)
 Q X    ;ICR#: 6044 SC(
"RTN","MBAAMDA1",274,0)
 ;Q $G(^SC(SC,"ST",SD,1))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",275,0)
 ;
"RTN","MBAAMDA1",276,0)
GETDPATT(RETURN,SC,SD,DAY) ; Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",277,0)
 S RETURN("IEN")=$O(^SC(SC,"T"_DAY,SD))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",278,0)
 S:RETURN("IEN")'="" RETURN("PAT")=$G(^SC(SC,"T"_DAY,RETURN("IEN"),1))  ;ICR#: 6044 SC(
"RTN","MBAAMDA1",279,0)
 Q
"RTN","MBAAMDA1",280,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA1",281,0)
 ;UPDPATT(DATA,SC,SD) ; Update day pattern
"RTN","MBAAMDA1",282,0)
 ; N IENS,I
"RTN","MBAAMDA1",283,0)
 ; S IENS=SD_","_SC_","
"RTN","MBAAMDA1",284,0)
 ; N FDA
"RTN","MBAAMDA1",285,0)
 ; F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","MBAAMDA1",286,0)
 ; . S FDA(44.005,IENS,I)=DATA(I)
"RTN","MBAAMDA1",287,0)
 ; N ERR
"RTN","MBAAMDA1",288,0)
 ; D UPDATE^DIE("","FDA",,"ERR")
"RTN","MBAAMDA1",289,0)
 ; Q
"RTN","MBAAMDA1",290,0)
 ;
"RTN","MBAAMDA1",291,0)
ADDPATT(DATA,SC,SD) ; Add day pattern Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",292,0)
 N IENS,I,FDA,ERR
"RTN","MBAAMDA1",293,0)
 S IENS="+1,"_SC_","
"RTN","MBAAMDA1",294,0)
 S IENS(1)=SD
"RTN","MBAAMDA1",295,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","MBAAMDA1",296,0)
 . S FDA(44.005,IENS,I)=DATA(I)
"RTN","MBAAMDA1",297,0)
 D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","MBAAMDA1",298,0)
 Q
"RTN","MBAAMDA1",299,0)
 ;
"RTN","MBAAMDA1",300,0)
LSTAENC(RETURN,SEARCH,START,NUMBER) ; Returns active encounters. MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMDA1",301,0)
 N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA1",302,0)
 S FILE="409.68",FIELDS="@;.01I;.04I;.06"
"RTN","MBAAMDA1",303,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA1",304,0)
 S SCR="I $P(^(0),""^"",2)="_SEARCH_"&($D(^SCE(""ADFN"","_SEARCH_",$P(^(0),""^"",1))))"
"RTN","MBAAMDA1",305,0)
 K SEARCH
"RTN","MBAAMDA1",306,0)
 D LIST^DIC(FILE,"",.FIELDS,"",$G(NUMBER),.START,.SEARCH,"B",.SCR,"","RETURN","ERR")
"RTN","MBAAMDA1",307,0)
 Q
"RTN","MBAAMDA2")
0^10^B17922124^n/a
"RTN","MBAAMDA2",1,0)
MBAAMDA2 ;OIT-PD/VSL - APPOINTMENT API ;02/10/2016
"RTN","MBAAMDA2",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMDA2",3,0)
 ;
"RTN","MBAAMDA2",4,0)
 ;Associated ICRs
"RTN","MBAAMDA2",5,0)
 ;  ICR#
"RTN","MBAAMDA2",6,0)
 ;  6053 DPT
"RTN","MBAAMDA2",7,0)
 ;  6044 SC(
"RTN","MBAAMDA2",8,0)
 ;
"RTN","MBAAMDA2",9,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA2",10,0)
 ;FRSTAVBL(RETURN,SC) ; Get first available date
"RTN","MBAAMDA2",11,0)
 ; S RETURN=$O(^SC(+SC,"T",0))
"RTN","MBAAMDA2",12,0)
 ; S RETURN=$O(^(0))
"RTN","MBAAMDA2",13,0)
 ; Q
"RTN","MBAAMDA2",14,0)
 ; ;
"RTN","MBAAMDA2",15,0)
SLOTS(RETURN,SC) ; Get available slots MBAA RPC: MBAA GET CLINIC AVAILABILITY
"RTN","MBAAMDA2",16,0)
 ;T13 Change to use FM to get the data
"RTN","MBAAMDA2",17,0)
 S SD=0 F  S SD=$O(^SC(SC,"ST",SD)) Q:SD'>0  D    ;ICR#: 6044 SC(
"RTN","MBAAMDA2",18,0)
 .N IENS,ARRAY,ERR S IENS=$G(SD)_","_SC_"," D GETS^DIQ(44.005,IENS,".01;1","I","ARRAY","ERR")
"RTN","MBAAMDA2",19,0)
 .S RETURN(SD,0)=$G(ARRAY(44.005,IENS,.01,"I")),RETURN(SD,1)=$G(ARRAY(44.005,IENS,1,"I"))
"RTN","MBAAMDA2",20,0)
 K SD
"RTN","MBAAMDA2",21,0)
 ;M RETURN=^SC(+SC,"ST")  ;ICR#: 6044 SC(
"RTN","MBAAMDA2",22,0)
 Q
"RTN","MBAAMDA2",23,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA2",24,0)
 ;SCEXST(RETURN,CSC) ; Returns Outpatient Classification Stop Code Exception status
"RTN","MBAAMDA2",25,0)
 ; N FILE,STOPN,IENACT,FLDS,FS
"RTN","MBAAMDA2",26,0)
 ; S STOPN=$$GET1^DIQ(40.7,+CSC_",",1)
"RTN","MBAAMDA2",27,0)
 ; S IENACT=""
"RTN","MBAAMDA2",28,0)
 ; S IENACT=$O(^SD(409.45,"B",STOPN,IENACT))
"RTN","MBAAMDA2",29,0)
 ; S FILE="409.45"
"RTN","MBAAMDA2",30,0)
 ; S FLDS("*")=""
"RTN","MBAAMDA2",31,0)
 ; S FS("75")="",FS("75","F")="409.4575",FS("75","N")="EFFECTIVE DATE"
"RTN","MBAAMDA2",32,0)
 ; S RETURN=0
"RTN","MBAAMDA2",33,0)
 ; I $D(IENACT) D
"RTN","MBAAMDA2",34,0)
 ; . D GETREC^MBAAMDAL(.RETURN,IENACT,FILE,.FLDS,.FS,1,1,1) S RETURN=1
"RTN","MBAAMDA2",35,0)
 ; Q
"RTN","MBAAMDA2",36,0)
 ; ;
"RTN","MBAAMDA2",37,0)
LSTAPPT(RETURN,SEARCH,START,NUMBER) ; Lists appointment types MBAA RPC: MBAA APPOINTMENT LIST BY NAME
"RTN","MBAAMDA2",38,0)
 N FILE,FIELDS,RET
"RTN","MBAAMDA2",39,0)
 S FILE="409.1",FIELDS="@;.01"
"RTN","MBAAMDA2",40,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",41,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B","","","RETURN")
"RTN","MBAAMDA2",42,0)
 Q
"RTN","MBAAMDA2",43,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA2",44,0)
 ;GETAPPT(RETURN,TYPE,INT,EXT,REZ) ; Get Appointment Type
"RTN","MBAAMDA2",45,0)
 ; N FILE,FLDS,SF
"RTN","MBAAMDA2",46,0)
 ; S FILE=409.1,FLDS("*")=""
"RTN","MBAAMDA2",47,0)
 ; D GETREC^MBAAMDAL(.RETURN,TYPE,FILE,.FLDS,.SF,$G(INT),$G(EXT),$G(REZ))
"RTN","MBAAMDA2",48,0)
 ; Q
"RTN","MBAAMDA2",49,0)
 ;
"RTN","MBAAMDA2",50,0)
 ;GETELIG(RETURN,ELIG,INT,EXT,REZ) ; Get eligibility code
"RTN","MBAAMDA2",51,0)
 ;N FILE,FLDS
"RTN","MBAAMDA2",52,0)
 ;S FILE=8,FLDS("*")=""
"RTN","MBAAMDA2",53,0)
 ;D GETREC^MBAAMDAL(.RETURN,ELIG,FILE,.FLDS,,$G(INT),$G(EXT),$G(REZ))
"RTN","MBAAMDA2",54,0)
 ;Q
"RTN","MBAAMDA2",55,0)
 ; ;
"RTN","MBAAMDA2",56,0)
 ;HASPEND(RETURN,PAT,DT) ; Return 1 if patient has pending appointment
"RTN","MBAAMDA2",57,0)
 ; S RETURN=0
"RTN","MBAAMDA2",58,0)
 ; I '$D(^DPT(+$G(PAT),0)) D ERRX^MBAAAPIE(.RETURN,"PATNFND") Q RETURN
"RTN","MBAAMDA2",59,0)
 ; S:$O(^DPT(PAT,"S",DT))>DT RETURN=1
"RTN","MBAAMDA2",60,0)
 ; Q RETURN
"RTN","MBAAMDA2",61,0)
 ; ;
"RTN","MBAAMDA2",62,0)
 ;GETPEND(RETURN,PAT,DT) ; Get pending appointments
"RTN","MBAAMDA2",63,0)
 ; N Y,AP
"RTN","MBAAMDA2",64,0)
 ; F Y=DT:0 S Y=$O(^DPT(PAT,"S",Y)) Q:Y'>0  D
"RTN","MBAAMDA2",65,0)
 ; . S AP=^(Y,0)
"RTN","MBAAMDA2",66,0)
 ; . I "I"[$P(AP,U,2) D
"RTN","MBAAMDA2",67,0)
 ; . . S RETURN(Y,.01)=$P(AP,U,1)
"RTN","MBAAMDA2",68,0)
 ; . . S RETURN(Y,13)=$P(AP,U,11)
"RTN","MBAAMDA2",69,0)
 ; . . S RETURN(Y,9.5)=$P(AP,U,16)
"RTN","MBAAMDA2",70,0)
 ; . . S RETURN(Y,2)=$P(AP,U,3)
"RTN","MBAAMDA2",71,0)
 ; . . S RETURN(Y,3)=$P(AP,U,4)
"RTN","MBAAMDA2",72,0)
 ; . . S RETURN(Y,4)=$P(AP,U,5)
"RTN","MBAAMDA2",73,0)
 ; Q
"RTN","MBAAMDA2",74,0)
 ; ;
"RTN","MBAAMDA2",75,0)
APTYNAME(TYPE) ; Get appointment type name MBAA RPC: MBAA PATIENT PENDING APPT
"RTN","MBAAMDA2",76,0)
 Q $$GET1^DIQ(409.1,TYPE_",",.01)
"RTN","MBAAMDA2",77,0)
 ;
"RTN","MBAAMDA2",78,0)
GETAPTS(RETURN,DFN,SD) ; Get patient appointments Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA2",79,0)
 N FILE,SFILES,APTS,DT
"RTN","MBAAMDA2",80,0)
 S FILE=2
"RTN","MBAAMDA2",81,0)
 S SFILES("1900")="",SFILES("1900","N")="APT",SFILES("1900","F")="2.98",ROUT=3
"RTN","MBAAMDA2",82,0)
 S:$G(ROUTC)=1 ROUT=4
"RTN","MBAAMDA2",83,0)
 D GETREC^MBAAMDAL(.APTS,DFN,FILE,,.SFILES,1,1,1)
"RTN","MBAAMDA2",84,0)
 I '$D(SD) M RETURN=APTS Q
"RTN","MBAAMDA2",85,0)
 I $G(SD)>0&'$D(SD(0)) D  Q
"RTN","MBAAMDA2",86,0)
 . I $D(APTS("APT",SD)) M RETURN("APT",SD)=APTS("APT",SD) Q
"RTN","MBAAMDA2",87,0)
 S DT=$S(SD(0)=1:$P(SD,"."),SD(0)=0:$O(APTS("APT","")))
"RTN","MBAAMDA2",88,0)
 F  S DT=$O(APTS("APT",DT)) Q:'$D(DT)!(DT="")  D
"RTN","MBAAMDA2",89,0)
 . M RETURN("APT",DT)=APTS("APT",DT)
"RTN","MBAAMDA2",90,0)
 Q
"RTN","MBAAMDA2",91,0)
 ;
"RTN","MBAAMDA2",92,0)
GETDAPTS(RETURN,DFN,SD) ; Get all appointments in the day Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA2",93,0)
 N NOD
"RTN","MBAAMDA2",94,0)
 S RETURN=0
"RTN","MBAAMDA2",95,0)
 S IND=$P(SD,".")
"RTN","MBAAMDA2",96,0)
 F  S IND=$O(^DPT(DFN,"S",IND)) Q:IND=""!($P(IND,".")>$P(SD,"."))  D  ;ICR#: 6053 DPT
"RTN","MBAAMDA2",97,0)
 . ;T13 Change to use FM to get these fields
"RTN","MBAAMDA2",98,0)
 . N ARRAY S IENS=$G(SD)_","_$G(DFN)_"," D GETS^DIQ(2.98,IENS,".01;3","I","ARRAY")
"RTN","MBAAMDA2",99,0)
 . S RETURN(IND,1)=$G(ARRAY(2.98,IENS,.01,"I"))
"RTN","MBAAMDA2",100,0)
 . S RETURN(IND,2)=$G(ARRAY(2.98,IENS,3,"I"))
"RTN","MBAAMDA2",101,0)
 . ;S NOD=^DPT(DFN,"S",IND,0)
"RTN","MBAAMDA2",102,0)
 . ;S RETURN(IND,1)=$P(NOD,U,1)
"RTN","MBAAMDA2",103,0)
 . ;S RETURN(IND,2)=$P(NOD,U,2)
"RTN","MBAAMDA2",104,0)
 S RETURN=1
"RTN","MBAAMDA2",105,0)
 Q
"RTN","MBAAMDA2",106,0)
 ;
"RTN","MBAAMDA2",107,0)
LSTCRSNS(RETURN,SEARCH,START,NUMBER) ; MBAA RPC: MBAA LIST CANCELLATION REASONS
"RTN","MBAAMDA2",108,0)
 N FILE,FIELDS,RET,SCR,TYP
"RTN","MBAAMDA2",109,0)
 S FILE="409.2",FIELDS="@;.01"
"RTN","MBAAMDA2",110,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",111,0)
 ;T16 Change to return only cancel reasons that a patient can select
"RTN","MBAAMDA2",112,0)
 ;I $D(RETURN("TYPE")) S TYP=RETURN("TYPE"),SCR="I $P(^(0),U,2)[""PB""&'$P(^(0),U,4),(TYP_""B""[$P(^(0),U,2))"
"RTN","MBAAMDA2",113,0)
 I $D(RETURN("TYPE")) S TYP=RETURN("TYPE")
"RTN","MBAAMDA2",114,0)
 S SCR="I ""BP""[$P(^(0),U,2)"
"RTN","MBAAMDA2",115,0)
 K RETURN
"RTN","MBAAMDA2",116,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN","ERR")
"RTN","MBAAMDA2",117,0)
 Q
"RTN","MBAAMDA2",118,0)
 ;
"RTN","MBAAMDA2",119,0)
LSTCSTA1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow cancellation. MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA2",120,0)
 N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA2",121,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","MBAAMDA2",122,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",123,0)
 S START(1)=1
"RTN","MBAAMDA2",124,0)
 S START(2)=0
"RTN","MBAAMDA2",125,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACAN",.SCR,"","RETURN","ERR")
"RTN","MBAAMDA2",126,0)
 Q
"RTN","MBAAMDA2",127,0)
 ;
"RTN","MBAAMDA2",128,0)
LSTCIST1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow check in. MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMDA2",129,0)
 N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA2",130,0)
 S FILE="409.63",FIELDS="@;.01"
"RTN","MBAAMDA2",131,0)
 S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",132,0)
 S START(1)=1
"RTN","MBAAMDA2",133,0)
 S START(2)=0
"RTN","MBAAMDA2",134,0)
 D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACI",.SCR,"","RETURN","ERR")
"RTN","MBAAMDA2",135,0)
 Q
"RTN","MBAAMDA2",136,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA2",137,0)
 ;LSTCOST1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow check in.
"RTN","MBAAMDA2",138,0)
 ; N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA2",139,0)
 ; S FILE="409.63",FIELDS="@;.01"
"RTN","MBAAMDA2",140,0)
 ; S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",141,0)
 ; S START(1)=1
"RTN","MBAAMDA2",142,0)
 ; S START(2)=0
"RTN","MBAAMDA2",143,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ACO",.SCR,"","RETURN","ERR")
"RTN","MBAAMDA2",144,0)
 ; Q
"RTN","MBAAMDA2",145,0)
 ;
"RTN","MBAAMDA2",146,0)
 ;LSTNSTA1(RETURN,SEARCH,START,NUMBER) ; Returns the list of states that allow no-show. 
"RTN","MBAAMDA2",147,0)
 ;N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA2",148,0)
 ;S FILE="409.63",FIELDS="@;.01"
"RTN","MBAAMDA2",149,0)
 ;S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA2",150,0)
 ;S START(1)=1
"RTN","MBAAMDA2",151,0)
 ;S START(2)=0
"RTN","MBAAMDA2",152,0)
 ;D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"ANS",,"","RETURN","ERR")
"RTN","MBAAMDA2",153,0)
 ;Q
"RTN","MBAAMDA2",154,0)
 ;
"RTN","MBAAMDA2",155,0)
GETAPT0(DFN,SD) ; Get appointment 0 node MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA2",156,0)
 Q $G(^DPT(DFN,"S",SD,0))  ;ICR#: 6053 DPT
"RTN","MBAAMDA2",157,0)
 ;
"RTN","MBAAMDA2",158,0)
GETPAPT(RETURN,DFN,SD) ; Get patient appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA2",159,0)
 N IND
"RTN","MBAAMDA2",160,0)
 F IND=0:0 S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","MBAAMDA2",161,0)
 . S RETURN(IND)=$$GET1^DIQ(2.98,SD_","_DFN_",",IND,"I")
"RTN","MBAAMDA2",162,0)
 S RETURN=1
"RTN","MBAAMDA2",163,0)
 Q
"RTN","MBAAMDA2",164,0)
 ;
"RTN","MBAAMDA3")
0^11^B10404049^n/a
"RTN","MBAAMDA3",1,0)
MBAAMDA3 ;OIT-PD/CBR - APPOINTMENT API ;02/10/2016
"RTN","MBAAMDA3",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMDA3",3,0)
 ;
"RTN","MBAAMDA3",4,0)
 ;Associated ICRs
"RTN","MBAAMDA3",5,0)
 ;  ICR#
"RTN","MBAAMDA3",6,0)
 ;  6053 DPT
"RTN","MBAAMDA3",7,0)
 ;  10076 XUSEC
"RTN","MBAAMDA3",8,0)
 ;
"RTN","MBAAMDA3",9,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA3",10,0)
 ;GETPATS(RETURN,SEARCH,START,NUMBER) ; Get patients
"RTN","MBAAMDA3",11,0)
 ; N FILE,FIELDS,RET,SCR,INDX
"RTN","MBAAMDA3",12,0)
 ; S FILE="2",FIELDS="@;.01;.03;.09;391;1901",INDX="B"
"RTN","MBAAMDA3",13,0)
 ; S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA3",14,0)
 ; I $D(SEARCH),SEARCH?4N S INDX="BS"
"RTN","MBAAMDA3",15,0)
 ; I $L(SEARCH)>1,SEARCH?.N S INDX="SSN"
"RTN","MBAAMDA3",16,0)
 ; I $L(SEARCH)>0,SEARCH?1A4N S INDX="BS5"
"RTN","MBAAMDA3",17,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,INDX,.SCR,"","RETURN")
"RTN","MBAAMDA3",18,0)
 ; Q
"RTN","MBAAMDA3",19,0)
 ;
"RTN","MBAAMDA3",20,0)
GETPAT(RETURN,PAT,INT,EXT,REZ) ; Get patient detail Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA3",21,0)
 N FILE,SFILES,FLDS
"RTN","MBAAMDA3",22,0)
 S FILE=2
"RTN","MBAAMDA3",23,0)
 S FLDS("*")=""
"RTN","MBAAMDA3",24,0)
 S SFILES(".3721")="",SFILES(".3721","N")="RATED DISABILITIES",SFILES(".3721","F")="2.04"
"RTN","MBAAMDA3",25,0)
 S SFILES("2")="",SFILES("2","N")="RACE INFORMATION",SFILES("2","F")="2.02"
"RTN","MBAAMDA3",26,0)
 S SFILES("6")="",SFILES("6","N")="ETHNICITY INFORMATION",SFILES("6","F")="2.06"
"RTN","MBAAMDA3",27,0)
 S ROUT=2
"RTN","MBAAMDA3",28,0)
 D GETREC^MBAAMDAL(.RETURN,PAT,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","MBAAMDA3",29,0)
 Q
"RTN","MBAAMDA3",30,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA3",31,0)
 ;LSTETNS(RETURN,SEARCH,START,NUMBER) ; Return ethnicity information.
"RTN","MBAAMDA3",32,0)
 ; N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA3",33,0)
 ; S FILE="10.2",FIELDS="@;.01"
"RTN","MBAAMDA3",34,0)
 ; S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA3",35,0)
 ; S SCR="I $S('$D(^(.02)):1,$P(^(.02),U,1)=1:0,1:1)"
"RTN","MBAAMDA3",36,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","MBAAMDA3",37,0)
 ; Q
"RTN","MBAAMDA3",38,0)
 ; ;
"RTN","MBAAMDA3",39,0)
 ;SETETN(PAT,ETN) ; Set patient ethnicity.
"RTN","MBAAMDA3",40,0)
 ; N IENS,FDA,MSG
"RTN","MBAAMDA3",41,0)
 ; S IENS="?+1,"_PAT_","
"RTN","MBAAMDA3",42,0)
 ; S FDA(2.06,IENS,".01")=ETN
"RTN","MBAAMDA3",43,0)
 ; S FDA(2.06,IENS,".02")=1
"RTN","MBAAMDA3",44,0)
 ; D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","MBAAMDA3",45,0)
 ; Q
"RTN","MBAAMDA3",46,0)
 ;
"RTN","MBAAMDA3",47,0)
 ;LSTRACES(RETURN,SEARCH,START,NUMBER) ; Return races.
"RTN","MBAAMDA3",48,0)
 ; N FILE,FIELDS,RET,SCR
"RTN","MBAAMDA3",49,0)
 ; S FILE="10",FIELDS="@;.01"
"RTN","MBAAMDA3",50,0)
 ; S:$D(START)=0 START="" S:$D(SEARCH)=0 SEARCH=""
"RTN","MBAAMDA3",51,0)
 ; S SCR="I $S('$D(^(.02)):1,$P(^(.02),U,1)=1:0,1:1)"
"RTN","MBAAMDA3",52,0)
 ; D LIST^DIC(FILE,"",FIELDS,"",$G(NUMBER),.START,SEARCH,"B",.SCR,"","RETURN")
"RTN","MBAAMDA3",53,0)
 ; Q
"RTN","MBAAMDA3",54,0)
 ; ;
"RTN","MBAAMDA3",55,0)
 ;GETPRES(RETURN,PAT) ; Get patient races
"RTN","MBAAMDA3",56,0)
 ; N FILE,SFILES,FLDS
"RTN","MBAAMDA3",57,0)
 ; S FILE=2
"RTN","MBAAMDA3",58,0)
 ; S SFILES("2")="",SFILES("2","N")="RACE INFORMATION",SFILES("2","F")="2.02"
"RTN","MBAAMDA3",59,0)
 ; D GETREC^MBAAMDAL(.RETURN,PAT,FILE,.FLDS,.SFILES,$G(INT),$G(EXT),$G(REZ))
"RTN","MBAAMDA3",60,0)
 ; Q
"RTN","MBAAMDA3",61,0)
 ;
"RTN","MBAAMDA3",62,0)
 ;ADDRACE(PAT,RACE) ; Set patient race.
"RTN","MBAAMDA3",63,0)
 ; N IENS,FDA,MSG
"RTN","MBAAMDA3",64,0)
 ; S IENS="?+2,"_PAT_","
"RTN","MBAAMDA3",65,0)
 ; S IENS(2)=RACE
"RTN","MBAAMDA3",66,0)
 ; S FDA(2.02,IENS,".01")=RACE
"RTN","MBAAMDA3",67,0)
 ; S FDA(2.02,IENS,".02")=1
"RTN","MBAAMDA3",68,0)
 ; D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","MBAAMDA3",69,0)
 ; Q
"RTN","MBAAMDA3",70,0)
 ;
"RTN","MBAAMDA3",71,0)
MAKE(DFN,SD,SC,TYPE,STYP,STAT,RSN,USR,DT,SRT,NAAI,LAB,XRAY,EKG,DESDT) ; Make patient appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA3",72,0)
 N ERR,FDA,IENS
"RTN","MBAAMDA3",73,0)
 I $D(^DPT(DFN,"S",+SD,0)),$P(^DPT(DFN,"S",+SD,0),U,2)["C" D   ;ICR#: 6053 DPT
"RTN","MBAAMDA3",74,0)
 . S IENS=SD_","_DFN_","
"RTN","MBAAMDA3",75,0)
 . S FDA(2.98,IENS,".01")=SC
"RTN","MBAAMDA3",76,0)
 . S FDA(2.98,IENS,"3")="@"
"RTN","MBAAMDA3",77,0)
 . S FDA(2.98,IENS,"9")=$G(RSN)
"RTN","MBAAMDA3",78,0)
 . S FDA(2.98,IENS,"9.5")=$G(TYPE)
"RTN","MBAAMDA3",79,0)
 . S FDA(2.98,IENS,"17")="@"
"RTN","MBAAMDA3",80,0)
 . S FDA(2.98,IENS,"20")=DT
"RTN","MBAAMDA3",81,0)
 . S FDA(2.98,IENS,"27")=$G(DESDT)
"RTN","MBAAMDA3",82,0)
 . D FILE^DIE("","FDA","ERR")
"RTN","MBAAMDA3",83,0)
 E  D
"RTN","MBAAMDA3",84,0)
 . S IENS="?+2,"_DFN_","
"RTN","MBAAMDA3",85,0)
 . S IENS(2)=+SD
"RTN","MBAAMDA3",86,0)
 . S FDA(2.98,IENS,.01)=SC
"RTN","MBAAMDA3",87,0)
 . S FDA(2.98,IENS,"3")=STAT
"RTN","MBAAMDA3",88,0)
 . S FDA(2.98,IENS,"5")=$G(LAB)
"RTN","MBAAMDA3",89,0)
 . S FDA(2.98,IENS,"6")=$G(XRAY)
"RTN","MBAAMDA3",90,0)
 . S FDA(2.98,IENS,"7")=$G(EKG)
"RTN","MBAAMDA3",91,0)
 . S FDA(2.98,IENS,"9")=$G(RSN)
"RTN","MBAAMDA3",92,0)
 . S FDA(2.98,IENS,"9.5")=$G(TYPE)
"RTN","MBAAMDA3",93,0)
 . S FDA(2.98,IENS,"19")=USR
"RTN","MBAAMDA3",94,0)
 . S FDA(2.98,IENS,"20")=DT
"RTN","MBAAMDA3",95,0)
 . S FDA(2.98,IENS,"24")=$G(STYP)
"RTN","MBAAMDA3",96,0)
 . S FDA(2.98,IENS,"25")=$G(SRT)
"RTN","MBAAMDA3",97,0)
 . S FDA(2.98,IENS,"26")=$G(NAAI)
"RTN","MBAAMDA3",98,0)
 . S FDA(2.98,IENS,"27")=$G(DESDT)
"RTN","MBAAMDA3",99,0)
 . D UPDATE^DIE("","FDA","IENS","ERR")
"RTN","MBAAMDA3",100,0)
 Q
"RTN","MBAAMDA3",101,0)
 ;
"RTN","MBAAMDA3",102,0)
CANCEL(RETURN,DFN,SD,TYP,RSN,RMK,CDT,USR,OUSR,ODT) ; Cancel appointment. Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA3",103,0)
 N IENS,FDA
"RTN","MBAAMDA3",104,0)
 S IENS=SD_","_DFN_","
"RTN","MBAAMDA3",105,0)
 S FDA(2.98,IENS,3)=TYP
"RTN","MBAAMDA3",106,0)
 S FDA(2.98,IENS,14)=USR
"RTN","MBAAMDA3",107,0)
 S FDA(2.98,IENS,15)=CDT
"RTN","MBAAMDA3",108,0)
 S FDA(2.98,IENS,16)=RSN
"RTN","MBAAMDA3",109,0)
 S FDA(2.98,IENS,19)=OUSR
"RTN","MBAAMDA3",110,0)
 S FDA(2.98,IENS,20)=ODT
"RTN","MBAAMDA3",111,0)
 S:$G(RMK)]"" FDA(2.98,IENS,17)=$E(RMK,1,160)
"RTN","MBAAMDA3",112,0)
 D FILE^DIE("","FDA","RETURN")
"RTN","MBAAMDA3",113,0)
 Q
"RTN","MBAAMDA3",114,0)
 ;
"RTN","MBAAMDA3",115,0)
GETXUS(RETURN,KEYS,USR) ; Get user access Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA3",116,0)
 N KEY
"RTN","MBAAMDA3",117,0)
 K RETURN S KEY=""
"RTN","MBAAMDA3",118,0)
 F  S KEY=$O(KEYS(KEY)) Q:KEY=""  S:$D(^XUSEC(KEY,USR)) RETURN(KEY)=""  ;ICR#: 10076 XUSEC
"RTN","MBAAMDA3",119,0)
 Q
"RTN","MBAAMDA3",120,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA3",121,0)
 ;GETCENRL(RETURN,DFN,SC) ; Get clinic enrolls
"RTN","MBAAMDA3",122,0)
 ; N IND,EC,SSC
"RTN","MBAAMDA3",123,0)
 ; K RETURN S RETURN=0
"RTN","MBAAMDA3",124,0)
 ; F SSC=0:0 S SSC=$O(^DPT(DFN,"DE","B",SSC)) Q:SSC=""  D
"RTN","MBAAMDA3",125,0)
 ; . Q:$G(SC)>0&(SSC'=$G(SC))
"RTN","MBAAMDA3",126,0)
 ; . S EC=$O(^DPT(DFN,"DE","B",SSC,"")) Q:'EC
"RTN","MBAAMDA3",127,0)
 ; . S RETURN(SSC,0)=EC_U_^DPT(DFN,"DE",EC,0)
"RTN","MBAAMDA3",128,0)
 ; . F IND=0:0 S IND=$O(^DPT(DFN,"DE",EC,1,IND)) Q:IND=""  D
"RTN","MBAAMDA3",129,0)
 ; . . S RETURN(SSC,IND)=^DPT(DFN,"DE",EC,1,IND,0)
"RTN","MBAAMDA3",130,0)
 ; S RETURN=1
"RTN","MBAAMDA3",131,0)
 ; Q
"RTN","MBAAMDA3",132,0)
 ;
"RTN","MBAAMDA3",133,0)
 ;UPDENRL(ENS,DFN) ;
"RTN","MBAAMDA3",134,0)
 ; N IENS,FDA,ERR,IND,SC
"RTN","MBAAMDA3",135,0)
 ; S SC=$O(ENS(""))
"RTN","MBAAMDA3",136,0)
 ; S IENS=ENS(SC,"IEN")_","_DFN_","
"RTN","MBAAMDA3",137,0)
 ; S FDA(2.001,IENS,2)="I"
"RTN","MBAAMDA3",138,0)
 ; D UPDATE^DIE("","FDA",,"ERR")
"RTN","MBAAMDA3",139,0)
 ; F IND=0:0 S IND=$O(ENS(SC,"EN",IND)) Q:IND=""  D
"RTN","MBAAMDA3",140,0)
 ; . Q:(IND'>0)
"RTN","MBAAMDA3",141,0)
 ; . S IENS=IND_","_ENS(SC,"IEN")_","_DFN_","
"RTN","MBAAMDA3",142,0)
 ; . S:$D(ENS(SC,"EN",IND,"DISCHARGE")) FDA(2.011,IENS,3)=ENS(SC,"EN",IND,"DISCHARGE")
"RTN","MBAAMDA3",143,0)
 ; . S:$D(ENS(SC,"EN",IND,"REASON")) FDA(2.011,IENS,4)=ENS(SC,"EN",IND,"REASON")
"RTN","MBAAMDA3",144,0)
 ; . D UPDATE^DIE("","FDA",,"ERR")
"RTN","MBAAMDA3",145,0)
 ; Q
"RTN","MBAAMDA3",146,0)
 ;
"RTN","MBAAMDA4")
0^12^B4043284^n/a
"RTN","MBAAMDA4",1,0)
MBAAMDA4 ;OIT-PD/VSL - APPOINTMENT AP ;02/10/2016
"RTN","MBAAMDA4",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAMDA4",3,0)
 ;
"RTN","MBAAMDA4",4,0)
 ;Associated ICRs
"RTN","MBAAMDA4",5,0)
 ;  ICR#
"RTN","MBAAMDA4",6,0)
 ;  6053 DPT
"RTN","MBAAMDA4",7,0)
 ;  6044 SC(
"RTN","MBAAMDA4",8,0)
 ;
"RTN","MBAAMDA4",9,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA4",10,0)
 ;GETOE(RETURN,SDOE) ; Get outpatient encounter
"RTN","MBAAMDA4",11,0)
 ; N IND S IND=0
"RTN","MBAAMDA4",12,0)
 ; F  S IND=$O(RETURN(IND)) Q:IND=""  D
"RTN","MBAAMDA4",13,0)
 ; . S RETURN(IND)=$$GET1^DIQ(409.68,SDOE_",",IND,"I")
"RTN","MBAAMDA4",14,0)
 ; S RETURN=1
"RTN","MBAAMDA4",15,0)
 ; Q
"RTN","MBAAMDA4",16,0)
 ; ;
"RTN","MBAAMDA4",17,0)
 ;GETCHLD(RETURN,SDOE) ; Get children encounters
"RTN","MBAAMDA4",18,0)
 ; N SDOEC
"RTN","MBAAMDA4",19,0)
 ; F SDOEC=0:0 S SDOEC=$O(^SCE("APAR",SDOE,SDOEC)) Q:'SDOEC  D
"RTN","MBAAMDA4",20,0)
 ; . S RETURN(SDOEC)=""
"RTN","MBAAMDA4",21,0)
 ; . S NOD=^SCE(SDOEC,0)
"RTN","MBAAMDA4",22,0)
 ; . S RETURN(SDOEC,"DATE")=$P(NOD,U,1)
"RTN","MBAAMDA4",23,0)
 ; . S RETURN(SDOEC,"PATIENT")=$P(NOD,U,2)
"RTN","MBAAMDA4",24,0)
 ; . S RETURN(SDOEC,"SCODE")=$P(NOD,U,3)
"RTN","MBAAMDA4",25,0)
 ; . S RETURN(SDOEC,"CLINIC")=$P(NOD,U,4)
"RTN","MBAAMDA4",26,0)
 ; . S RETURN(SDOEC,"VISIT")=$P(NOD,U,5)
"RTN","MBAAMDA4",27,0)
 ; Q
"RTN","MBAAMDA4",28,0)
 ;DELOE(SDOE) ; Delete Outpatient Encounter
"RTN","MBAAMDA4",29,0)
 ; N DA,DIK
"RTN","MBAAMDA4",30,0)
 ; S DA=SDOE,DIK="^SCE(" D ^DIK
"RTN","MBAAMDA4",31,0)
 ; Q
"RTN","MBAAMDA4",32,0)
UPDPAPT(DATA,DFN,SD) ; Update patient appointment MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMDA4",33,0)
 N IENS,I
"RTN","MBAAMDA4",34,0)
 S IENS=SD_","_DFN_","
"RTN","MBAAMDA4",35,0)
 N FDA
"RTN","MBAAMDA4",36,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","MBAAMDA4",37,0)
 . S FDA(2.98,IENS,I)=DATA(I)
"RTN","MBAAMDA4",38,0)
 N ERR
"RTN","MBAAMDA4",39,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","MBAAMDA4",40,0)
 Q
"RTN","MBAAMDA4",41,0)
 ;
"RTN","MBAAMDA4",42,0)
UPDCAPT(DATA,SC,SD,IEN) ; Update clinic appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMDA4",43,0)
 N IENS,I
"RTN","MBAAMDA4",44,0)
 S IENS=IEN_","_SD_","_SC_","
"RTN","MBAAMDA4",45,0)
 N FDA
"RTN","MBAAMDA4",46,0)
 F I=0:0 S I=$O(DATA(I)) Q:I=""  D
"RTN","MBAAMDA4",47,0)
 . S FDA(44.003,IENS,I)=DATA(I)
"RTN","MBAAMDA4",48,0)
 N ERR
"RTN","MBAAMDA4",49,0)
 D UPDATE^DIE("","FDA",,"ERR")
"RTN","MBAAMDA4",50,0)
 Q
"RTN","MBAAMDA4",51,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA4",52,0)
 ;DELCLS(SDOE) ;Delete Classification
"RTN","MBAAMDA4",53,0)
 ; N DA,DIK,SDI,SDFL
"RTN","MBAAMDA4",54,0)
 ; S SDFL=409.42
"RTN","MBAAMDA4",55,0)
 ; S DIK="^SDD("_SDFL_",",SDI=0
"RTN","MBAAMDA4",56,0)
 ; F SDI=0:0 S SDI=$O(^SDD(SDFL,"AO",SDOE,SDI)) Q:'SDI  S DA=+$O(^(SDI,0)) D ^DIK
"RTN","MBAAMDA4",57,0)
 ; Q
"RTN","MBAAMDA4",58,0)
 ; ;
"RTN","MBAAMDA4",59,0)
 ;GETPAPT(RETURN,DFN,SD,FLDS) ; Get patient appointment
"RTN","MBAAMDA4",60,0)
 ; N APT,DIQ,DIC,DA,DR
"RTN","MBAAMDA4",61,0)
 ; I '$D(FLDS) S FLDS=".01;3;5;6;7;9;12;13;14;15;16;9.5;17;19;20;21;25;26;27;28"
"RTN","MBAAMDA4",62,0)
 ; S DIQ(0)="IE",DIQ="APT(",DIC="^DPT(DFN,""S"",",DA=SD,DR=FLDS D EN^DIQ1
"RTN","MBAAMDA4",63,0)
 ; M RETURN=APT(2.98,SD)
"RTN","MBAAMDA4",64,0)
 ; Q
"RTN","MBAAMDA4",65,0)
 ;
"RTN","MBAAMDA4",66,0)
GETCAPT(RETURN,DFN,SD,FLDS,FLAG) ; Get clinic appointment MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAAMDA4",67,0)
 N CAPT,ZL,SDDA,SC,DIQ,DIC,DA,DR S SDDA=0
"RTN","MBAAMDA4",68,0)
 I '$D(FLDS) S FLDS=".01;1;3;7;8;9;30;309;302;303;304;306"
"RTN","MBAAMDA4",69,0)
 S SC=+$G(^DPT(DFN,"S",SD,0))  ;ICR#: 6053 DPT
"RTN","MBAAMDA4",70,0)
 I $D(^SC(SC,"S",SD))  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA4",71,0)
 . S ZL=0
"RTN","MBAAMDA4",72,0)
 . F  S ZL=$O(^SC(SC,"S",SD,1,ZL)) Q:'ZL  D  ;ICR#: 6044 SC(
"RTN","MBAAMDA4",73,0)
 . . I +^SC(SC,"S",SD,1,ZL,0)=DFN S SDDA=ZL  ;ICR#: 6044 SC(
"RTN","MBAAMDA4",74,0)
 . Q
"RTN","MBAAMDA4",75,0)
 Q:SDDA=0
"RTN","MBAAMDA4",76,0)
 S DIQ(0)=$G(FLAG)
"RTN","MBAAMDA4",77,0)
 S DIQ="CAPT(",DIC="^SC(SC,""S"",SD,1,",DA=SDDA,DR=FLDS D EN^DIQ1  ;ICR#: 6044 SC(
"RTN","MBAAMDA4",78,0)
 M RETURN=CAPT(44.003,SDDA)
"RTN","MBAAMDA4",79,0)
 S RETURN(222)=SC
"RTN","MBAAMDA4",80,0)
 S RETURN(333)=SDDA
"RTN","MBAAMDA4",81,0)
 Q
"RTN","MBAAMDA4",82,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDA4",83,0)
 ;Linetag GETPAT will not be used until the next release of MBAA
"RTN","MBAAMDA4",84,0)
 ;GETPAT(RETURN,DFN) ; Get patient
"RTN","MBAAMDA4",85,0)
 ;N PAT,DIQ,DIC,DA,DR
"RTN","MBAAMDA4",86,0)
 ;S DIQ(0)="IE",DIQ="PAT(",DIC="^DPT(",DA=DFN
"RTN","MBAAMDA4",87,0)
 ;S DR=".01;.02;.03;.05;.08;.361;.323;.131;.111;.134;.112;.135;.1173;.1112;"
"RTN","MBAAMDA4",88,0)
 ;S DR=DR_".114;.115;.1172;.1171;.133;.32103;.525;.32102;.3213;.32115;.322013"
"RTN","MBAAMDA4",89,0)
 ;D EN^DIQ1
"RTN","MBAAMDA4",90,0)
 ;M RETURN=PAT(2,DFN)
"RTN","MBAAMDA4",91,0)
 ;Q
"RTN","MBAAMDA4",92,0)
 ;
"RTN","MBAAMDA4",93,0)
 ;DELCODT(RETURN,SDOE) ;Delete Check Out Process Completion Date
"RTN","MBAAMDA4",94,0)
 ; N DA,DE,DIE,DQ,DR
"RTN","MBAAMDA4",95,0)
 ; S DA=SDOE,DIE="^SCE(",DR=".07///@" D ^DIE
"RTN","MBAAMDA4",96,0)
 ; Q
"RTN","MBAAMDA4",97,0)
 ;
"RTN","MBAAMDAL")
0^13^B8935806^n/a
"RTN","MBAAMDAL",1,0)
MBAAMDAL ;OIT-PD/VSL - FILE ACCESS DAL ;02/10/2016
"RTN","MBAAMDAL",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAAMDAL",3,0)
 ;
"RTN","MBAAMDAL",4,0)
GETREC(RETURN,IFN,FILE,FLDS,SFILES,INT,EXT,REZ) ; Get one record and specified subfiles from a file Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT, MBAA PATIENT PENDING APPT
"RTN","MBAAMDAL",5,0)
 N STRF,FLD,FLAG,C,SFILE,IFLD,REC,SFLDN
"RTN","MBAAMDAL",6,0)
 S STRF=""
"RTN","MBAAMDAL",7,0)
 S IFLD=""
"RTN","MBAAMDAL",8,0)
 F  S IFLD=$O(FLDS(IFLD)) Q:IFLD=""  S STRF=STRF_$S(STRF="":"",1:";")_IFLD
"RTN","MBAAMDAL",9,0)
 S SFILE=""
"RTN","MBAAMDAL",10,0)
 F  S SFILE=$O(SFILES(SFILE)) Q:SFILE=""  S STRF=STRF_$S(STRF="":"",1:";")_SFILE_"*"
"RTN","MBAAMDAL",11,0)
 S FLD="",FLAG=""
"RTN","MBAAMDAL",12,0)
 S:$G(INT) FLAG=FLAG_"I" ;Returns Internal values
"RTN","MBAAMDAL",13,0)
 S:$G(EXT) FLAG=FLAG_"E" ;Returns External values
"RTN","MBAAMDAL",14,0)
 S:$G(REZ) FLAG=FLAG_"R" ;Resolves field numbers to field names
"RTN","MBAAMDAL",15,0)
 ;Change below to add a filter to the results so that the REC array doesn't get so large that it takes all the memory in the partition
"RTN","MBAAMDAL",16,0)
 D:$G(ROUT)'=3 GETS^DIQ(FILE,IFN,STRF,FLAG,"REC")
"RTN","MBAAMDAL",17,0)
 D:$G(ROUT)>2 GETRECA
"RTN","MBAAMDAL",18,0)
 F  S FLD=$O(REC(FILE,""_IFN_",",FLD)) Q:FLD=""  D
"RTN","MBAAMDAL",19,0)
 . S:FLAG=""!(FLAG="R") RETURN(FLD)=REC(FILE,""_IFN_",",FLD)
"RTN","MBAAMDAL",20,0)
 . S:FLAG["I" RETURN(FLD)=REC(FILE,""_IFN_",",FLD,"I")
"RTN","MBAAMDAL",21,0)
 . S:FLAG["E" RETURN(FLD)=$S($L($G(RETURN(FLD)))>0:RETURN(FLD)_U,1:"")_REC(FILE,""_IFN_",",FLD,"E")
"RTN","MBAAMDAL",22,0)
 S SFILE=""
"RTN","MBAAMDAL",23,0)
 F  S SFILE=$O(SFILES(SFILE)) Q:SFILE=""  D
"RTN","MBAAMDAL",24,0)
 . S SFLDN=$S(FLAG["R":SFILES(SFILE,"N"),1:SFILE)
"RTN","MBAAMDAL",25,0)
 . D GETSREC(.RETURN,.REC,SFILES(SFILE,"F"),SFLDN,FLAG)
"RTN","MBAAMDAL",26,0)
 K ROUT,ROUTC,FLAG,FILE,STRF
"RTN","MBAAMDAL",27,0)
 Q
"RTN","MBAAMDAL",28,0)
 ;
"RTN","MBAAMDAL",29,0)
GETSREC(RETURN,REC,SFILE,SFLD,FLAG) ; Get record subfile data Called by RPC MBAA APPOINTMENT MAKE, MBAA RPC: MBAA CANCEL APPOINTMENT, MBAA PATIENT PENDING APPT
"RTN","MBAAMDAL",30,0)
 N IDX,ID S FLD="",IDX=""
"RTN","MBAAMDAL",31,0)
 F  S IDX=$O(REC(SFILE,IDX)) Q:IDX=""  D
"RTN","MBAAMDAL",32,0)
 . F  S FLD=$O(REC(SFILE,IDX,FLD)) Q:FLD=""  D
"RTN","MBAAMDAL",33,0)
 . . S ID=$P(IDX,",",1)
"RTN","MBAAMDAL",34,0)
 . . S:FLAG=""!(FLAG="R") RETURN(SFLD,ID,FLD)=REC(SFILE,IDX,FLD)
"RTN","MBAAMDAL",35,0)
 . . S:FLAG["I" RETURN(SFLD,ID,FLD)=REC(SFILE,IDX,FLD,"I")
"RTN","MBAAMDAL",36,0)
 . . S:FLAG["E" RETURN(SFLD,ID,FLD)=$S($L($G(RETURN(SFLD,ID,FLD)))>0:RETURN(SFLD,ID,FLD)_U,1:"")_REC(SFILE,IDX,FLD,"E")
"RTN","MBAAMDAL",37,0)
 . . N SI S SI=0
"RTN","MBAAMDAL",38,0)
 . . F  S SI=$O(REC(SFILE,IDX,FLD,SI)) Q:SI=""!(SI="I")!(SI="E")  D
"RTN","MBAAMDAL",39,0)
 . . . S RETURN(SFLD,ID,FLD,SI)=REC(SFILE,IDX,FLD,SI),RETURN(SFLD,ID,FLD)=""
"RTN","MBAAMDAL",40,0)
 Q
"RTN","MBAAMDAL",41,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMDAL",42,0)
 ;LSTSCOD(FILE,FIELD,LIST) ;List codes in SET OF CODE fields
"RTN","MBAAMDAL",43,0)
 ; ;FILE = file number
"RTN","MBAAMDAL",44,0)
 ; ;FIELD = field number
"RTN","MBAAMDAL",45,0)
 ; ;LIST = output array:
"RTN","MBAAMDAL",46,0)
 ; ;   LIST(#)=code^display_name
"RTN","MBAAMDAL",47,0)
 ; N SET,NODE,CODE,NAME,I,COUNT
"RTN","MBAAMDAL",48,0)
 ; S SET=$$GET1^DID(FILE,FIELD,,"POINTER")
"RTN","MBAAMDAL",49,0)
 ; S COUNT=1
"RTN","MBAAMDAL",50,0)
 ; F I=1:1:$L(SET,";") D
"RTN","MBAAMDAL",51,0)
 ; . S NODE=$P(SET,";",I)
"RTN","MBAAMDAL",52,0)
 ; . S CODE=$P(NODE,":")
"RTN","MBAAMDAL",53,0)
 ; . Q:CODE=""
"RTN","MBAAMDAL",54,0)
 ; . S NAME=$P(NODE,":",2)
"RTN","MBAAMDAL",55,0)
 ; . S LIST(COUNT)=CODE_"^"_NAME
"RTN","MBAAMDAL",56,0)
 ; . S COUNT=COUNT+1
"RTN","MBAAMDAL",57,0)
 ; S LIST(0)=COUNT-1
"RTN","MBAAMDAL",58,0)
 ; Q
"RTN","MBAAMDAL",59,0)
 ;
"RTN","MBAAMDAL",60,0)
GETRECA ; run a diq call to get data and put it into a tmp global, then only get out the data that is needed based on the current date
"RTN","MBAAMDAL",61,0)
 K ^TMP($J,"REC"),REC
"RTN","MBAAMDAL",62,0)
 S:$G(ROUT)>2 FILE1="2.98"
"RTN","MBAAMDAL",63,0)
 ;S:$G(ROUT)=4 FILE1=FILE
"RTN","MBAAMDAL",64,0)
 D GETS^DIQ(FILE,IFN,STRF,FLAG,"^TMP($J,""REC""")
"RTN","MBAAMDAL",65,0)
 S STRT=$$FMADD^XLFDT(DT,-1,0,0,0)_".2359" F  S STRT=$O(^TMP($J,"REC",FILE1,STRT)) Q:STRT'>0  S FLD="" F  S FLD=$O(^TMP($J,"REC",FILE1,STRT,FLD)) Q:FLD=""  S IDX="" F  S IDX=$O(^TMP($J,"REC",FILE1,STRT,FLD,IDX)) Q:IDX=""  D
"RTN","MBAAMDAL",66,0)
 .Q:$G(STRT)<$$FMADD^XLFDT(DT,-1,0,0,0)
"RTN","MBAAMDAL",67,0)
 .S REC(FILE1,STRT,FLD,IDX)=$G(^TMP($J,"REC",FILE1,STRT,FLD,IDX))
"RTN","MBAAMDAL",68,0)
 K ^TMP($J,"REC"),IDX,STRT,FILE1
"RTN","MBAAMDAL",69,0)
 Q
"RTN","MBAAMRP1")
0^14^B3062007^n/a
"RTN","MBAAMRP1",1,0)
MBAAMRP1 ;OIT-PD/CKU - APPOINTMENT RPC ;02/10/2016
"RTN","MBAAMRP1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Jun 23, 2015;Build 85
"RTN","MBAAMRP1",3,0)
 ;
"RTN","MBAAMRP1",4,0)
 Q
"RTN","MBAAMRP1",5,0)
GETCLN(RV,SC) ; gets the clinic details
"RTN","MBAAMRP1",6,0)
 ; MBAA RPC: MBAA GET CLINIC DETAILS
"RTN","MBAAMRP1",7,0)
 N STATUS,RESULT ;S STATUS=$$DETAILS(.RESULT,SC)
"RTN","MBAAMRP1",8,0)
 D DETAILS(.RESULT,SC)
"RTN","MBAAMRP1",9,0)
 ;I 'STATUS S RV=-1
"RTN","MBAAMRP1",10,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",11,0)
 Q
"RTN","MBAAMRP1",12,0)
DETAILS(ARRAY,SC)  ; Get clinic details
"RTN","MBAAMRP1",13,0)
 S FILE=44,FIELDS=".01;1;2;7;8;9;9.5;10;24;1912;1914;1917;1918;2500;2503",FLAG="IE"
"RTN","MBAAMRP1",14,0)
 K ARRAY D GETS^DIQ(44,SC_",",FIELDS,FLAG,"ARRAY")
"RTN","MBAAMRP1",15,0)
 I $G(ARRAY(44,SC_",",1914,"E"))="" S ARRAY(44,SC_",",1914,"E")=8
"RTN","MBAAMRP1",16,0)
 I $G(ARRAY(44,SC_",",1914,"I"))="" S ARRAY(44,SC_",",1914,"I")=8
"RTN","MBAAMRP1",17,0)
 K FILE,FIELDS,FLAG
"RTN","MBAAMRP1",18,0)
 Q
"RTN","MBAAMRP1",19,0)
 ;GETCLN(RV,CLINIC) ; SD GET CLINIC DETAILS
"RTN","MBAAMRP1",20,0)
 ; N STATUS,RESULT S STATUS=$$GETCLN^MBAAMAP1(.RESULT,CLINIC)
"RTN","MBAAMRP1",21,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",22,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",23,0)
 ; Q
"RTN","MBAAMRP1",24,0)
 ;LSTCLNS(RV,SEARCH,START,NUMBER) ; SD GET CLINICS BY NAME
"RTN","MBAAMRP1",25,0)
 ; N STATUS,RESULT S STATUS=$$LSTCLNS^MBAAMAP1(.RESULT,SEARCH,.START,NUMBER)
"RTN","MBAAMRP1",26,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",27,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",28,0)
 ; Q
"RTN","MBAAMRP1",29,0)
 ;FRSTAVBL(RV,SC) ; SD GET FIRST AVAILABLE APPT
"RTN","MBAAMRP1",30,0)
 ; N STATUS,RESULT S STATUS=$$FRSTAVBL^MBAAMAP1(.RESULT,SC)
"RTN","MBAAMRP1",31,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",32,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",33,0)
 ; Q
"RTN","MBAAMRP1",34,0)
 ;CLNCK(RV,CLN) ; SD VALID CLINIC STOP CODE 
"RTN","MBAAMRP1",35,0)
 ; N STATUS,RESULT S STATUS=$$CLNCK^MBAAMAP1(.RESULT,CLN)
"RTN","MBAAMRP1",36,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",37,0)
 ; Q
"RTN","MBAAMRP1",38,0)
CLNRGHT(RV,CLN) ; MBAA RPC: MBAA VERIFY CLINIC ACCESS
"RTN","MBAAMRP1",39,0)
 N STATUS,RESULT S STATUS=$$CLNRGHT^MBAAMAP1(.RESULT,CLN)
"RTN","MBAAMRP1",40,0)
 ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",41,0)
 S RV(0)=0
"RTN","MBAAMRP1",42,0)
 I $G(STATUS)=1 S RV(0)=1
"RTN","MBAAMRP1",43,0)
 Q
"RTN","MBAAMRP1",44,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP1",45,0)
 ;CLNVSC(RV,SC) ; SD VALID STOP CODE
"RTN","MBAAMRP1",46,0)
 ; N STATUS,RESULT S STATUS=$$CLNVSC^MBAAMAP1(.RESULT,SC)
"RTN","MBAAMRP1",47,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",48,0)
 ; Q
"RTN","MBAAMRP1",49,0)
SLOTS(RV,SC) ; MBAA RPC: MBAA GET CLINIC AVAILABILITY
"RTN","MBAAMRP1",50,0)
 N STATUS,RESULT S STATUS=$$SLOTS^MBAAMAP1(.RESULT,SC)
"RTN","MBAAMRP1",51,0)
 I 'STATUS S RV=-1
"RTN","MBAAMRP1",52,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",53,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP1",54,0)
 ;GETPEND(RV,PAT,DT) ; SD GET PATIENT PENDING APPTS
"RTN","MBAAMRP1",55,0)
 ; N STATUS,RESULT S STATUS=$$GETPEND^MBAAMAP1(.RESULT,PAT,DT)
"RTN","MBAAMRP1",56,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",57,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",58,0)
 ; Q
"RTN","MBAAMRP1",59,0)
 ;GETAPTS(RV,DFN,SD) ; SD GET PATIENT APPOINTMENTS
"RTN","MBAAMRP1",60,0)
 ; N STATUS,RESULT S STATUS=$$GETAPTS^MBAAMAP1(.RESULT,DFN,.SD)
"RTN","MBAAMRP1",61,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",62,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",63,0)
 ; Q
"RTN","MBAAMRP1",64,0)
 ;HASPEND(RV,PAT,DT) ; SD HAS PATIENT PENDING APPTS
"RTN","MBAAMRP1",65,0)
 ; N STATUS,RESULT S STATUS=$$HASPEND^MBAAMAP1(.RESULT,PAT,DT)
"RTN","MBAAMRP1",66,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",67,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",68,0)
 ; Q
"RTN","MBAAMRP1",69,0)
LSTCRSNS(RV,SEARCH,START,NUMBER) ;  MBAA RPC: MBAA LIST CANCELLATION REASONS
"RTN","MBAAMRP1",70,0)
 N STATUS,RESULT S STATUS=$$LSTCRSNS^MBAAMAP1(.RESULT,SEARCH,START,NUMBER)
"RTN","MBAAMRP1",71,0)
 I 'STATUS S RV=-1
"RTN","MBAAMRP1",72,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",73,0)
 Q
"RTN","MBAAMRP1",74,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP1",75,0)
 ;LISTEWL(RV,DFN,STATUS,BEGIN,END) ; SD EWL LIST
"RTN","MBAAMRP1",76,0)
 ; N STATUS,RESULT S STATUS=$$LIST^MBAAWLAP(.RESULT,DFN,STATUS,BEGIN,END)
"RTN","MBAAMRP1",77,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",78,0)
 ; Q
"RTN","MBAAMRP1",79,0)
 ;DETALEWL(RV,IEN) ; SD EWL DETAIL
"RTN","MBAAMRP1",80,0)
 ; N STATUS,RESULT S STATUS=$$DETAIL^MBAAWLAP(.RESULT,IEN)
"RTN","MBAAMRP1",81,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",82,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",83,0)
 ; Q
"RTN","MBAAMRP1",84,0)
 ;NEWEWL(RV,SDWLD) ; MBAA RPC: MBAA EWL NEW
"RTN","MBAAMRP1",85,0)
 ;N STATUS,RESULT S STATUS=$$NEW^MBAAWLAP(.RESULT,SDWLD)
"RTN","MBAAMRP1",86,0)
 ;I 'STATUS S RV=-1
"RTN","MBAAMRP1",87,0)
 ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",88,0)
 ;Q
"RTN","MBAAMRP1",89,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP1",90,0)
 ;UPDTEWL(RV,SDWLIEN,SDWLD) ; SD EWL UPDATE
"RTN","MBAAMRP1",91,0)
 ; N STATUS,RESULT S STATUS=$$UPDATE^MBAAWLAP(.RESULT,SDWLIEN,.SDWLD)
"RTN","MBAAMRP1",92,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",93,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",94,0)
 ; Q
"RTN","MBAAMRP1",95,0)
 ;DISPEWL(RV,SDWLDFN,SDWLIEN,SDWLDISP,SDWLAPPT) ; SD EWL DISPOSITION
"RTN","MBAAMRP1",96,0)
 ; N STATUS,RESULT S STATUS=$$DISP^MBAAWLAP(.RESULT,SDWLDFN,SDWLIEN,SDWLDISP,.SDWLAPPT)
"RTN","MBAAMRP1",97,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",98,0)
 ; Q
"RTN","MBAAMRP1",99,0)
 ;DELEWL(RV,SDWLIEN) ; SD EWL DELETE 
"RTN","MBAAMRP1",100,0)
 ; N STATUS,RESULT S STATUS=$$DELETE^MBAAWLAP(.RESULT,SDWLIEN)
"RTN","MBAAMRP1",101,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",102,0)
 ; Q
"RTN","MBAAMRP1",103,0)
 ;ISEWL(RV,DFN) ; SD EWL IS PATIENT ON LIST
"RTN","MBAAMRP1",104,0)
 ; N STATUS,RESULT S STATUS=$$HASENTRY^MBAAWLAP(.RESULT,DFN)
"RTN","MBAAMRP1",105,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",106,0)
 ; Q
"RTN","MBAAMRP1",107,0)
 ;LSTSRT(RV) ; SD GET REQUEST TYPES
"RTN","MBAAMRP1",108,0)
 ; N STATUS,RESULT S STATUS=$$LSTSRT^MBAAMAP1(.RESULT)
"RTN","MBAAMRP1",109,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP1",110,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP1",111,0)
 ; Q
"RTN","MBAAMRP2")
0^15^B2288454^n/a
"RTN","MBAAMRP2",1,0)
MBAAMRP2 ;OIT-PD/CKU - APPOINTMENT RPC ;02/10/2016
"RTN","MBAAMRP2",2,0)
 ;;1.0;Scheduling Calendar View;**1**;May 5, 2015;Build 85
"RTN","MBAAMRP2",3,0)
 ;
"RTN","MBAAMRP2",4,0)
 Q
"RTN","MBAAMRP2",5,0)
MAKE(RV,DFN,SC,SD,TYPE,STYP,LEN,SRT,OTHR,CIO,LAB,XRAY,EKG,RQXRAY,CONS,LVL,DESDT) ; MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMRP2",6,0)
 N STATUS,RESULT
"RTN","MBAAMRP2",7,0)
 S STATUS=$$MAKE^MBAAMAP2(.RESULT,DFN,SC,SD,TYPE,STYP,LEN,SRT,$G(OTHR),$G(CIO),$G(LAB),$G(XRAY),$G(EKG),$G(RQXRAY),$G(CONS),$G(LVL),$G(DESDT))
"RTN","MBAAMRP2",8,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",9,0)
 S RV(0)=$G(RV)
"RTN","MBAAMRP2",10,0)
 Q
"RTN","MBAAMRP2",11,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP2",12,0)
 ;MAKEUS(RV,DFN,SC,SD,TYP,STYP) ; SD APPOINTMENT MAKE UNSCH
"RTN","MBAAMRP2",13,0)
 ; N STATUS,RESULT S STATUS=$$MAKEUS^MBAAMAP2(.RESULT,DFN,SC,SD,TYP,STYP)
"RTN","MBAAMRP2",14,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",15,0)
 ; Q
"RTN","MBAAMRP2",16,0)
 ;CHKAPP(RV,SC,DFN,SD,LEN) ; SD APPOINTMENT CHECK
"RTN","MBAAMRP2",17,0)
 ; N STATUS,RESULT S STATUS=$$CHKAPP^MBAAMAP2(.RESULT,SC,DFN,SD,LEN)
"RTN","MBAAMRP2",18,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",19,0)
 ; Q
"RTN","MBAAMRP2",20,0)
CHECKIN(RV,DFN,SD,SC,CHKINDT) ; SD APPOINTMENT CHECK-IN
"RTN","MBAAMRP2",21,0)
 I $G(CHKINDT)="" D NOW^%DTC S CHKINDT=% K %
"RTN","MBAAMRP2",22,0)
 N STATUS,RESULT S STATUS=$$CHECKIN^MBAAMAP2(.RESULT,DFN,SD,SC,CHKINDT)
"RTN","MBAAMRP2",23,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",24,0)
 Q
"RTN","MBAAMRP2",25,0)
 ;CANCEL(RV,DFN,SC,SD,TYPE,RSN,RMK) ; SD APPOINTMENT CANCEL
"RTN","MBAAMRP2",26,0)
 ; N STATUS,RESULT S STATUS=$$CANCEL^MBAAMAP2(.RESULT,DFN,SC,SD,TYPE,RSN,RMK)
"RTN","MBAAMRP2",27,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",28,0)
 ; Q
"RTN","MBAAMRP2",29,0)
 ;NOSHOW(RV,DFN,SC,SD,LVL) ; SD APPOINTMENT NOSHOW
"RTN","MBAAMRP2",30,0)
 ; N STATUS,RESULT S STATUS=$$NOSHOW^MBAAMAP2(.RESULT,DFN,SC,SD,LVL)
"RTN","MBAAMRP2",31,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP2",32,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",33,0)
 ; Q
"RTN","MBAAMRP2",34,0)
LSTAPPT(RV,SEARCH,START,NUMBER) ; MBAA RPC: MBAA APPOINTMENT LIST BY NAME
"RTN","MBAAMRP2",35,0)
 N STATUS,RESULT S STATUS=$$LSTAPPT^MBAAMAP1(.RESULT,$G(SEARCH),$G(START),$G(NUMBER))
"RTN","MBAAMRP2",36,0)
 I 'STATUS S RV=-1
"RTN","MBAAMRP2",37,0)
 D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",38,0)
 Q
"RTN","MBAAMRP2",39,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMRP2",40,0)
 ;GETAPPT(RV,TYPE) ; SD GET APPOINTMENT TYPE
"RTN","MBAAMRP2",41,0)
 ; N STATUS,RESULT S STATUS=$$GETAPPT^MBAAMAP1(.RESULT,TYPE)
"RTN","MBAAMRP2",42,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP2",43,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",44,0)
 ; Q
"RTN","MBAAMRP2",45,0)
 ;GETELIG(RV,ELIG) ; SD GET ELIGIBILITY DETAILS
"RTN","MBAAMRP2",46,0)
 ; N STATUS,RESULT S STATUS=$$GETELIG^MBAAMAP1(.RESULT,ELIG)
"RTN","MBAAMRP2",47,0)
 ; I 'STATUS S RV=-1
"RTN","MBAAMRP2",48,0)
 ; D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAAMRP2",49,0)
 ; Q
"RTN","MBAAMRPC")
0^16^B230431^n/a
"RTN","MBAAMRPC",1,0)
MBAAMRPC ;OIT-PD/VSL - APPOINTMENT RPC ;02/10/2016
"RTN","MBAAMRPC",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAMRPC",3,0)
 ;
"RTN","MBAAMRPC",4,0)
 Q
"RTN","MBAAMRPC",5,0)
MERGE(RV,RESULT) ; MBAA RPC: MBAA EWL NEW, MBAA PATIENT PENDING APPT, MBAA LIST CANCELLATION REASONS
"RTN","MBAAMRPC",6,0)
 N NODE,COUNTER S NODE="RESULT",COUNTER=1
"RTN","MBAAMRPC",7,0)
 F  S NODE=$Q(@NODE) Q:NODE=""  D
"RTN","MBAAMRPC",8,0)
 . S RV(COUNTER)=NODE_"="_@NODE
"RTN","MBAAMRPC",9,0)
 . S COUNTER=$G(COUNTER)+1
"RTN","MBAAMRPC",10,0)
 Q
"RTN","MBAARPC1")
0^18^B58612031^n/a
"RTN","MBAARPC1",1,0)
MBAARPC1 ;OIT-PD/PB - Scheduling RPCs ;02/10/2016
"RTN","MBAARPC1",2,0)
 ;;1.0;Scheduling Calendar View;**1**;FEB 10, 2016;Build 85
"RTN","MBAARPC1",3,0)
 ;
"RTN","MBAARPC1",4,0)
 ;This routine has multiple RPCs created to support the mobile Scheduling apps
"RTN","MBAARPC1",5,0)
 ;Associated ICRs:
"RTN","MBAARPC1",6,0)
 ;  ICR#
"RTN","MBAARPC1",7,0)
 ;  6053 DPT
"RTN","MBAARPC1",8,0)
 ;  6044 SC(
"RTN","MBAARPC1",9,0)
 ;  4433 SDAMA301
"RTN","MBAARPC1",10,0)
 ;  6417 DATP^SDWLEVAL
"RTN","MBAARPC1",11,0)
 ;  6418 $$CHKENC^SDWLQSC1
"RTN","MBAARPC1",12,0)
 ;
"RTN","MBAARPC1",13,0)
GETPEND(RV,DFN,DT) ; Get pending appointments for a patient MBAA RPC: MBAA PATIENT PENDING APPT
"RTN","MBAARPC1",14,0)
 ; input is patient dfn and the date to start the search and go forward
"RTN","MBAARPC1",15,0)
 K RETURN
"RTN","MBAARPC1",16,0)
 I $G(DFN)="" S RV(0)="1^DFN must be defined" Q
"RTN","MBAARPC1",17,0)
 I $G(DT)="" S RV(0)="1^Start date must be defined" Q
"RTN","MBAARPC1",18,0)
 N CNT,SCAP,APP,CLN,%
"RTN","MBAARPC1",19,0)
 S CNT=""
"RTN","MBAARPC1",20,0)
 D GETPND(.APP,DFN,DT)
"RTN","MBAARPC1",21,0)
 F  S CNT=$O(APP(CNT)) Q:CNT=""  D
"RTN","MBAARPC1",22,0)
 . S RETURN(CNT,"COLLATERAL VISIT")=$G(APP(CNT,13))
"RTN","MBAARPC1",23,0)
 . S RETURN(CNT,"APPOINTMENT TYPE")=$$APTYNAME^MBAAMDA2($G(APP(CNT,9.5)))
"RTN","MBAARPC1",24,0)
 . S RETURN(CNT,"LAB")=$G(APP(CNT,2))
"RTN","MBAARPC1",25,0)
 . S RETURN(CNT,"XRAY")=$G(APP(CNT,3))
"RTN","MBAARPC1",26,0)
 . S RETURN(CNT,"EKG")=$G(APP(CNT,4))
"RTN","MBAARPC1",27,0)
 . S %=$$GETCLN^MBAAMAP1(.CLN,$G(APP(CNT,.01)))
"RTN","MBAARPC1",28,0)
 . S RETURN(CNT,"CLINIC")=$P($G(CLN("NAME")),U,2)
"RTN","MBAARPC1",29,0)
 . N SCAP S %=$$GETSCAP(.SCAP,$G(APP(CNT,.01)),DFN,CNT)
"RTN","MBAARPC1",30,0)
 . S RETURN(CNT,"LENGTH OF APP'T")=$G(SCAP("LENGTH"))
"RTN","MBAARPC1",31,0)
 . S RETURN(CNT,"CONSULT LINK")=$G(SCAP("CONSULT"))
"RTN","MBAARPC1",32,0)
 . S RETURN(CNT,"OTHER")=$G(SCAP("OTHER"))
"RTN","MBAARPC1",33,0)
 .; Adding new fields
"RTN","MBAARPC1",34,0)
 . S RETURN(CNT,"CLINIC ID")=$G(APP(CNT,.01))
"RTN","MBAARPC1",35,0)
 . S RETURN(CNT,"CURRENT STATUS")=$G(APP(CNT,100))
"RTN","MBAARPC1",36,0)
 . S RETURN(CNT,"DESIRED APPT DATE")=$G(APP(CNT,127))
"RTN","MBAARPC1",37,0)
 S RETURN=($D(RETURN)>0)
"RTN","MBAARPC1",38,0)
 D MERGE^MBAAMRPC(.RV,.RETURN)
"RTN","MBAARPC1",39,0)
 Q 1
"RTN","MBAARPC1",40,0)
 ;
"RTN","MBAARPC1",41,0)
GETPND(LST,PAT,SD1) ; Get pending appointments MBAA RPC: MBAA PATIENT PENDING APPT
"RTN","MBAARPC1",42,0)
 N SDT1
"RTN","MBAARPC1",43,0)
 S SDT1=$$FMADD^XLFDT(SD1,0,0,-1,0)
"RTN","MBAARPC1",44,0)
 F  S SDT1=$O(^DPT(PAT,"S",SDT1)) Q:SDT1=""!(SDT1'>0)  D    ;ICR#: 6053 DPT
"RTN","MBAARPC1",45,0)
 . Q:$G(SDT1)=""
"RTN","MBAARPC1",46,0)
 . N ERR,ARRAY,IENS S IENS=SDT1_","_$G(PAT)_"," D GETS^DIQ(2.98,IENS,".01;13;9.5;5;6;7;3;27","I","ARRAY","ERR")
"RTN","MBAARPC1",47,0)
 . Q:$G(ARRAY(2.98,IENS,.01,"I"))=""
"RTN","MBAARPC1",48,0)
 . Q:$G(ERR)
"RTN","MBAARPC1",49,0)
 . S LST(SDT1,.01)=$G(ARRAY(2.98,IENS,.01,"I"))
"RTN","MBAARPC1",50,0)
 . S LST(SDT1,13)=$G(ARRAY(2.98,IENS,13,"I"))
"RTN","MBAARPC1",51,0)
 . S LST(SDT1,9.5)=$G(ARRAY(2.98,IENS,9.5,"I"))
"RTN","MBAARPC1",52,0)
 . S LST(SDT1,2)=$G(ARRAY(2.98,IENS,5,"I"))
"RTN","MBAARPC1",53,0)
 . S LST(SDT1,3)=$G(ARRAY(2.98,IENS,6,"I"))
"RTN","MBAARPC1",54,0)
 . S LST(SDT1,4)=$G(ARRAY(2.98,IENS,7,"I"))
"RTN","MBAARPC1",55,0)
 . S LST(SDT1,5)=$G(ARRAY(2.98,IENS,6,"I"))
"RTN","MBAARPC1",56,0)
 . S LST(SDT1,10)=$G(ARRAY(2.98,IENS,3,"I"))
"RTN","MBAARPC1",57,0)
 . S LST(SDT1,127)=$G(ARRAY(2.98,IENS,27,"I"))
"RTN","MBAARPC1",58,0)
 . N R1 D STATUS(.R1,PAT,SDT1,$G(ARRAY(2.98,IENS,.01,"I"))) I $G(R1)'="" S LST(SDT1,100)=$P(R1,";",3)
"RTN","MBAARPC1",59,0)
 . K ARRAY,ERR,IENS
"RTN","MBAARPC1",60,0)
 ;. ;S RETURN(Y,100)=$P($$STATUS^SDAM1(PAT,Y,+AP,AP),";",3) ;ICR#: 2851 MBAA ACCESS TO SDAM1 API get appointment status
"RTN","MBAARPC1",61,0)
 ;. ;I $P($G(^DPT(PAT,"S",Y,1)),"^")'="" S RETURN(Y,127)=$P($G(^DPT(PAT,"S",Y,1)),"^")
"RTN","MBAARPC1",62,0)
 Q
"RTN","MBAARPC1",63,0)
GETSCAP(RETURN,SC,DFN,SD) ; Get clinic appointment MBAA RPC: MBAA PATIENT PENDING APPT
"RTN","MBAARPC1",64,0)
 N NOD0,CO,TXT
"RTN","MBAARPC1",65,0)
 I '$D(DFN)!(+$G(DFN)'>0) S RETURN=0,TXT(1)="DFN" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAARPC1",66,0)
 I '$D(SC)!(+$G(SC)'>0) S RETURN=0,TXT(1)="SC" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAARPC1",67,0)
 I '$D(SD)!(+$G(SD)'>0) S RETURN=0,TXT(1)="SD" D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAARPC1",68,0)
 D GETSCAP^MBAAMDA1(.RETURN,+SC,+DFN,+SD)
"RTN","MBAARPC1",69,0)
 I $D(RETURN) D
"RTN","MBAARPC1",70,0)
 . S NOD0=RETURN(0),CO=$G(RETURN("C"))
"RTN","MBAARPC1",71,0)
 . S RETURN("IFN")=RETURN
"RTN","MBAARPC1",72,0)
 . S RETURN("USER")=$P(NOD0,U,6)
"RTN","MBAARPC1",73,0)
 . S RETURN("DATE")=$P(NOD0,U,7)
"RTN","MBAARPC1",74,0)
 . S RETURN("CHECKOUT")=$P(CO,U,3)
"RTN","MBAARPC1",75,0)
 . S RETURN("CHECKIN")=$P(CO,U,1)
"RTN","MBAARPC1",76,0)
 . S RETURN("LENGTH")=$P(NOD0,U,2)
"RTN","MBAARPC1",77,0)
 . S RETURN("CONSULT")=$P($G(RETURN("CONS")),U)
"RTN","MBAARPC1",78,0)
 . S RETURN("OTHER")=$P($G(NOD0),"^",4)
"RTN","MBAARPC1",79,0)
 Q 1
"RTN","MBAARPC1",80,0)
 ;
"RTN","MBAARPC1",81,0)
PROVCLIN(RESULTS,PROVIDER)    ; Get list of clinics for a provider MBAA RPC: MBAA PROVIDER TO CLINIC
"RTN","MBAARPC1",82,0)
 ; input is provider id (IEN for VA(200))
"RTN","MBAARPC1",83,0)
 K RESULTS
"RTN","MBAARPC1",84,0)
 I $G(PROVIDER)="" S RESULTS(0)="1^Provider IEN is required." Q
"RTN","MBAARPC1",85,0)
 S (CNT,CLIN)=0 F  S CLIN=$O(^SC(CLIN)) Q:CLIN'>0  S PROV=0 F  S PROV=$O(^SC(CLIN,"PR","B",PROV)) Q:PROV'>0  S REC=0 F  S REC=$O(^SC(CLIN,"PR","B",PROV,REC)) Q:REC'>0  D  ;ICR#: 6044 SC(
"RTN","MBAARPC1",86,0)
 .;T13 Change to use FM
"RTN","MBAARPC1",87,0)
 .N ARRAY D GETS^DIQ(44,CLIN_",",".01;2","I","ARRAY")
"RTN","MBAARPC1",88,0)
 .S CLINNAME=$G(ARRAY(44,CLIN_",",.01,"I"))
"RTN","MBAARPC1",89,0)
 .S TYPE=$G(ARRAY(44,CLIN_",",2,"I"))
"RTN","MBAARPC1",90,0)
 .Q:$G(TYPE)'="C"
"RTN","MBAARPC1",91,0)
 .;Q:$P(^SC(CLIN,0),"^",3)'="C"  ;ICR#: 6044 SC(
"RTN","MBAARPC1",92,0)
 .;N IENS S IENS=$G(REC)_","_$G(CLIN)_"," S PROVIDER=$$GET1^DIQ(44.1,IENS,".01","I")
"RTN","MBAARPC1",93,0)
 .;Q:$P(^SC(CLIN,0),"^",3)'="C"  ;ICR#: 6044 SC(
"RTN","MBAARPC1",94,0)
 .Q:$G(PROV)'=$G(PROVIDER)
"RTN","MBAARPC1",95,0)
 .;S CLINNAME=$P(^SC(CLIN,0),"^")  ;ICR#: 6044 SC(
"RTN","MBAARPC1",96,0)
 .S RESULTS(CNT)=CLIN_"^"_CLINNAME,CNT=CNT+1
"RTN","MBAARPC1",97,0)
 .K CLINNAME,TYPE
"RTN","MBAARPC1",98,0)
 K CLIN,PROV,PROVIDER,CNT,REC,TYPE
"RTN","MBAARPC1",99,0)
 S:$G(RESULTS(0))="" RESULTS(0)="1^Provider is not assigned to any clinics."
"RTN","MBAARPC1",100,0)
 Q
"RTN","MBAARPC1",101,0)
 ;Line tags REMREC, UPDTEWL, PARSE, UPDATE have been commented out due to being descoped from the first release
"RTN","MBAARPC1",102,0)
 ;REMREC(RESULTS,DFN,CLINIC,PROVIDER,RECALLDT,PTRECDT)  ; Remove a patient from the Recall list MBAA RPC: MBAA REMOVE FROM RECALL LIST
"RTN","MBAARPC1",103,0)
 ; Input Parameters:
"RTN","MBAARPC1",104,0)
 ;   DFN = Patient ID
"RTN","MBAARPC1",105,0)
 ;   Clinic = Clinic ID - IEN from the Hospital Location file (#44)
"RTN","MBAARPC1",106,0)
 ;   PROVIDER = Provider IEN (optional)
"RTN","MBAARPC1",107,0)
 ;   RECALLDT = The recall date requested by the provider 
"RTN","MBAARPC1",108,0)
 ;   PTRECDT = The recall date requested by the patient 
"RTN","MBAARPC1",109,0)
 ;   Either the RECALLDT or the PTRECDT is required.
"RTN","MBAARPC1",110,0)
 ;
"RTN","MBAARPC1",111,0)
 ;   Checks for multiple entries on the recall list that are for the same patient, provider, clinic and recall dates and deletes all
"RTN","MBAARPC1",112,0)
 ; Output:
"RTN","MBAARPC1",113,0)
 ;   If successful:
"RTN","MBAARPC1",114,0)
 ;      RESULTS="1^DELETED" the patient was removed from the recall list for the clinic
"RTN","MBAARPC1",115,0)
 ;   If not successful:
"RTN","MBAARPC1",116,0)
 ;      RESULTS="0^DFN MISSING"
"RTN","MBAARPC1",117,0)
 ;      RESULTS="0^CLINIC ID MISSING"
"RTN","MBAARPC1",118,0)
 ;      RESULTS="0^User doesn't have the provider key."
"RTN","MBAARPC1",119,0)
 ;
"RTN","MBAARPC1",120,0)
 ;S RESULTS(0)=""
"RTN","MBAARPC1",121,0)
 ;I $G(DFN)="" S RESULTS(0)="0^DFN MISSING" Q
"RTN","MBAARPC1",122,0)
 ;I $G(CLINIC)="" S RESULTS(0)="0^CLINIC ID MISSING" Q
"RTN","MBAARPC1",123,0)
 ;T13 Changes to use FM
"RTN","MBAARPC1",124,0)
 ;N JX S JX=$$GET1^DIQ(2,$G(DFN),.01) I $G(JX)="" S RESULTS(0)="0^NOT A PATIENT" Q  ;ICR#: 6053 DPT
"RTN","MBAARPC1",125,0)
 ;N JX S JX=$$GET1^DIQ(44,$G(CLINIC),.01) I $G(JX)="" S RESULTS(0)="0^NOT A CLINIC" Q  ;ICR#: 6044 SC(
"RTN","MBAARPC1",126,0)
 ;I '$D(^DPT(DFN,0)) S RESULTS(0)="0^NOT A PATIENT" Q  ;ICR#: 6053 DPT
"RTN","MBAARPC1",127,0)
 ;I '$D(^SC(CLINIC,0)) S RESULTS(0)="0^NOT A CLINIC" Q  ;ICR#: 6044 SC(
"RTN","MBAARPC1",128,0)
 ;T13 Change to use FM
"RTN","MBAARPC1",129,0)
 ;S (SDPRV,KEY,SDFLAG)="" S SDPRV=$P($G(^SD(403.5,CLINIC,0)),U,5) I SDPRV'="" S KEY=$P($G(^SD(403.54,SDPRV,0)),U,7) D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC1",130,0)
 ;N CLIN S CLIN=$O(^SD(403.5,"E",CLINIC,0))
"RTN","MBAARPC1",131,0)
 ;I $G(CLIN)>0 S (SDPRV,KEY,SDFLAG)="" S SDPRV=$$GET1^DIQ(403.5,CLIN_",",4,"I") I SDPRV'="" S KEY=$$GET1^DIQ(403.54,SDPRV_",",6,"I") D  ;ICR#: 6158 SD(403.54
"RTN","MBAARPC1",132,0)
 ;.Q:KEY=""
"RTN","MBAARPC1",133,0)
 ;.N VALUE
"RTN","MBAARPC1",134,0)
 ;.S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)  ;ICR#: 3277 XUSRB
"RTN","MBAARPC1",135,0)
 ;.I $G(KY(0))=0 S RESULTS(0)="0^User doesn't have the security key."
"RTN","MBAARPC1",136,0)
 ;Q:$G(RESULTS(0))'=""
"RTN","MBAARPC1",137,0)
 ;S IEN=0 F  S IEN=$O(^SD(403.5,"E",CLINIC,IEN)) Q:IEN'>0  D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC1",138,0)
 ;.K NODE,PROV,PROVDT,PTDT,RESULTS(0),XDFN,OK
"RTN","MBAARPC1",139,0)
 ;.S OK=0
"RTN","MBAARPC1",140,0)
 ;.;T13 Change to use FM
"RTN","MBAARPC1",141,0)
 ;.;S NODE=$G(^SD(403.5,IEN,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC1",142,0)
 ;.;S XDFN=$P(NODE,"^")
"RTN","MBAARPC1",143,0)
 ;.N ARRAY,ERR D GETS^DIQ(403.5,IEN_",",".01;4;5;5.5","I","ARRAY","ERR")
"RTN","MBAARPC1",144,0)
 ;.S XDFN=$G(ARRAY(403.5,IEN_",",.01,"I")),PROV=$G(ARRAY(403.5,IEN_",",4,"I")),PROVDT=$G(ARRAY(403.5,IEN_",",5,"I")),PTDT=$G(ARRAY(403.5,IEN_",",5.5,"I"))
"RTN","MBAARPC1",145,0)
 ;.I $G(XDFN)'=DFN S RESULTS(0)="0^PATIENT NOT ON RECALL LIST" Q
"RTN","MBAARPC1",146,0)
 ;.;S PROV=$P(NODE,"^",5),PROVDT=$P(NODE,"^",6),PTDT=$P(NODE,"^",12),DFN1=$P(NODE,"^",1)
"RTN","MBAARPC1",147,0)
 ;.;I $G(PROV)'=$G(PROVIDER) Q  ;S RESULTS(0)="0^PROVIDER DOESN'T MATCH" Q
"RTN","MBAARPC1",148,0)
 ;.;I $G(PROVDT)'=$G(RECALLDT) Q  ;S RESULTS(0)="0^PROVIDER RECALL DATE DOESN'T MATCH" Q
"RTN","MBAARPC1",149,0)
 ;.;I $G(PTRECDT)'="" I $G(PTDT)'=$G(PTRECDT) S RESULTS(0)="0^PATIENT RECALL DATE DOESN'T MATCH" Q
"RTN","MBAARPC1",150,0)
 ;.;I $G(DFN1)'=$G(DFN) S RESULTS(0)="0^PATIENT MISMATCH" Q
"RTN","MBAARPC1",151,0)
 ;.S DIK="^SD(403.5,",DA=IEN D ^DIK  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC1",152,0)
 ;.S OK=1
"RTN","MBAARPC1",153,0)
 ;I OK=1 S RESULTS(0)="1^DELETED"
"RTN","MBAARPC1",154,0)
 ;I OK=0 S RESULTS(0)="0^NOT ON RECALL LIST"
"RTN","MBAARPC1",155,0)
 ;K SDPRV,KEY,SDFLAG,VALUE,IEN,DIK,DA,OK
"RTN","MBAARPC1",156,0)
 ;Q
"RTN","MBAARPC1",157,0)
UPDTEWL(RESULTS,DFN,SDWLIEN,SDWLDISP,SDWLDATA) ; Update or remove a patient on the EWL MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAARPC1",158,0)
 ;Input paramters:
"RTN","MBAARPC1",159,0)
 ;  DFN - Patient DFN
"RTN","MBAARPC1",160,0)
 ;  EWLIEN - for EWL Record to be updated
"RTN","MBAARPC1",161,0)
 ;  DISP - The disposition code of the EWL entry:
"RTN","MBAARPC1",162,0)
 ;    D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;CL:CLINIC CHANGE
"RTN","MBAARPC1",163,0)
 ;  SDWLDATA array:
"RTN","MBAARPC1",164,0)
 ;      $P(1) = SDWLAPPT(1)=SCHEDULED DATE OF APPT
"RTN","MBAARPC1",165,0)
 ;      $P(2) = SDWLAPPT(2)=PTR TO APPT CLINIC (CLINIC WHERE APPT MADE)
"RTN","MBAARPC1",166,0)
 ;      $P(4) = SDWLAPPT(15)=APPOINTMENT INSTITUTION (PTR to Institution File)
"RTN","MBAARPC1",167,0)
 ;      $P(5) = SDWLAPPT(13)=APPT STOP CODE (PTR to file 40.7)
"RTN","MBAARPC1",168,0)
 ;      $P(6) = SDWLAPPT(14)=APPT CREDIT STOP CODE (PTR to file 40.7)
"RTN","MBAARPC1",169,0)
 ;      $P(7) = SDWLAPPT(16)=APPT STATION NUMBER (Free Text) MUST BE AN IEN FROM DIC(4 but is not a ptr field)
"RTN","MBAARPC1",170,0)
 ;      $P(3) = SDWLAPPT(3)=APPT STATUS (Set of codes: 'R' FOR Scheduled/Kept; 
"RTN","MBAARPC1",171,0)
 ;          'I' FOR Inpatient; 
"RTN","MBAARPC1",172,0)
 ;          'NS' FOR No-Show; 
"RTN","MBAARPC1",173,0)
 ;          'NSR' FOR No_Show, Rescheduled; 
"RTN","MBAARPC1",174,0)
 ;          'CP' FOR Canceled by Patient; 
"RTN","MBAARPC1",175,0)
 ;          'CPR' FOR Canceled by Patient, Rescheduled; 
"RTN","MBAARPC1",176,0)
 ;          'CC' FOR Canceled by Clinic; 
"RTN","MBAARPC1",177,0)
 ;          'CCR' FOR Canceled by Clinic, Rescheduled; 
"RTN","MBAARPC1",178,0)
 ;          'NT' FOR No Action Taken; )
"RTN","MBAARPC1",179,0)
 ;Output:
"RTN","MBAARPC1",180,0)
 ;  RESULTS(0)=1 - Successful
"RTN","MBAARPC1",181,0)
 ;  RESULTS(0)="0^DFN is required" - DFN parameter missing
"RTN","MBAARPC1",182,0)
 ;  RESULTS(0)="0^SDWLIEN is required" - SDWLIEN parameter is missing
"RTN","MBAARPC1",183,0)
 ;  RESULTS(0)="0^Patient not on EWL" - Patient is not on the EWL
"RTN","MBAARPC1",184,0)
 ;  RESULTS(0)="0^Disposition is missing."
"RTN","MBAARPC1",185,0)
 ;  RESULTS(0)="0^Disposition is SA but missing Appointment data."
"RTN","MBAARPC1",186,0)
 ;
"RTN","MBAARPC1",187,0)
 S RESULTS(0)=1
"RTN","MBAARPC1",188,0)
 I $G(DFN)="" S RESULTS(0)="0^DFN is required" Q
"RTN","MBAARPC1",189,0)
 I $G(SDWLIEN)="" S RESULTS(0)="0^SDWLIEN is required" Q
"RTN","MBAARPC1",190,0)
 I '$D(^SDWL(409.3,"B",DFN)) S RESULTS(0)="0^Patient not on EWL" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC1",191,0)
 I $G(SDWLDISP)="" S RESULTS(0)="0^Disposition is missing." Q
"RTN","MBAARPC1",192,0)
 I ($G(SDWLDISP)="SA"&($G(SDWLDATA)="")) S RESULTS(0)="0^Disposition is SA but missing Appointment data." Q
"RTN","MBAARPC1",193,0)
 ;T13 Change to use FM
"RTN","MBAARPC1",194,0)
 N TYPE S TYPE=$$GET1^DIQ(409.3,SDWLIEN_",",23,"I") I $G(TYPE)="C" S RESULTS(0)="0^Patient not on EWL" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC1",195,0)
 I $P(^SDWL(409.3,SDWLIEN,0),"^",17)="C" S RESULTS(0)="0^Patient not on EWL" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC1",196,0)
 D PARSE
"RTN","MBAARPC1",197,0)
 I '$$LOCK^MBAAWLAP(.SDWLERR,SDWLIEN) ; W !,"Another User is Editing this Entry. Try Later." Q
"RTN","MBAARPC1",198,0)
 S %=$$DETAIL^MBAAWLAP(.SDWLDATA,SDWLIEN)
"RTN","MBAARPC1",199,0)
 G ENQ:SDWLDISP=""
"RTN","MBAARPC1",200,0)
 D UPDATE(DFN,SDWLIEN,SDWLDISP,.SDWLDATA)
"RTN","MBAARPC1",201,0)
ENQ ; MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAARPC1",202,0)
 S %=$$UNLOCK^MBAAWLAP(SDWLIEN)
"RTN","MBAARPC1",203,0)
 Q
"RTN","MBAARPC1",204,0)
UPDATE(SDWLDFN,SDWLIEN,SDWLDISP,SDWLDATA) ;UPDATE EWL ENTRY MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAARPC1",205,0)
 N SDWLERR,SDWLAPPT,SDWLTY
"RTN","MBAARPC1",206,0)
 S SDWLTY=$P(SDWLDATA("WLTYPE"),U)
"RTN","MBAARPC1",207,0)
 I SDWLDISP="SA","3,4"[SDWLTY S SDWLERR='$$SELAPPT(SDWLIEN,.SDWLDATA,.SDWLAPPT) Q:SDWLERR  ; QUIT OR NOT?
"RTN","MBAARPC1",208,0)
 I SDWLDISP="CL" Q
"RTN","MBAARPC1",209,0)
 S %=$$DISP^MBAAWLAP(.SDWLERR,SDWLDFN,SDWLIEN,SDWLDISP,.SDWLAPPT)
"RTN","MBAARPC1",210,0)
 S RETURN(0)=1
"RTN","MBAARPC1",211,0)
 Q
"RTN","MBAARPC1",212,0)
PARSE ; MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAARPC1",213,0)
 Q:$G(SDWLDATA)=""
"RTN","MBAARPC1",214,0)
 S SDWLAPPT(1)=$P(SDWLDATA,"^",1),SDWLAPPT(2)=$P(SDWLDATA,"^",2),SDWLAPPT(3)=$P(SDWLDATA,"^",3),SDWLAPPT(15)=$P(SDWLDATA,"^",4)
"RTN","MBAARPC1",215,0)
 S SDWLAPPT(13)=$P(SDWLDATA,"^",5),SDWLAPPT(14)=$P(SDWLDATA,"^",6),SDWLAPPT(16)=$P(SDWLDATA,"^",7)
"RTN","MBAARPC1",216,0)
 Q
"RTN","MBAARPC1",217,0)
 ;T13 Change add the code below to replace the STATUS^SDAM1 API with the SDAMA301 API  ICR #
"RTN","MBAARPC1",218,0)
STATUS(RESULTS,DFN,SD,SC) ;get the status of an appointment  ;ICR 4433
"RTN","MBAARPC1",219,0)
 K SDARRAY,SDCOUNT
"RTN","MBAARPC1",220,0)
 S RESULTS=""
"RTN","MBAARPC1",221,0)
 S SDARRAY(1)=SD,SDARRAY(2)=SC,SDARRAY(4)=DFN,SDARRAY("FLDS")="22"
"RTN","MBAARPC1",222,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)   ; ICR 
"RTN","MBAARPC1",223,0)
 I SDCOUNT>0 S RESULTS=$P($G(^TMP($J,"SDAMA301",DFN,SC,SD)),"^",22)
"RTN","MBAARPC1",224,0)
 ;S RESULTS=$G(^TMP($J,"SDAMA301",DFN,SC,SD))
"RTN","MBAARPC1",225,0)
 Q
"RTN","MBAARPC1",226,0)
SELAPPT(SDWLIEN,SDWLDATA,SDWLAPPT) ;SELECT APPOINTMENT TO CLOSE WITH
"RTN","MBAARPC1",227,0)
 N SDWLTY,SDCL,SDSP,SDORG,SDDS,SDAP,SDA,DIR,X
"RTN","MBAARPC1",228,0)
 S SDWLTY=$P(SDWLDATA("WLTYPE"),U)
"RTN","MBAARPC1",229,0)
 S (SDCL,SDSP)=""
"RTN","MBAARPC1",230,0)
 S:SDWLTY=4 SDCL=$P(SDWLDATA("WAITFORP"),U)
"RTN","MBAARPC1",231,0)
 S:SDWLTY=3 SDSP=$P(SDWLDATA("WAITFORP"),U)
"RTN","MBAARPC1",232,0)
 S SDORG=$P(SDWLDATA("ORIGDT"),U)
"RTN","MBAARPC1",233,0)
 S SDDS=$$CHKENC^SDWLQSC1(SDWLIEN,SDORG,SDCL,SDSP,1)  ;ICR 6418
"RTN","MBAARPC1",234,0)
 S SDAP=$O(^TMP($J,"APPT",""))
"RTN","MBAARPC1",235,0)
 Q:SDAP="" 1
"RTN","MBAARPC1",236,0)
 I $O(^TMP($J,"APPT",""))'=$O(^TMP($J,"APPT",""),-1) D
"RTN","MBAARPC1",237,0)
 . W !
"RTN","MBAARPC1",238,0)
 . S SDA=$O(^TMP($J,"APPT",""),-1)
"RTN","MBAARPC1",239,0)
 . I SDA=1 S DIR("B")=1
"RTN","MBAARPC1",240,0)
 . S DIR(0)="N^1:"_SDA S DIR("A")="Select appt for Removal Reason or '^' to Quit>",DIR("?")="Select Appointment to close with the open EWL."
"RTN","MBAARPC1",241,0)
 . D ^DIR
"RTN","MBAARPC1",242,0)
 . S SDAP=X
"RTN","MBAARPC1",243,0)
 Q:SDAP="^" 0
"RTN","MBAARPC1",244,0)
 Q:'SDAP 1
"RTN","MBAARPC1",245,0)
 D DATP^SDWLEVAL(SDAP,.SDWLAPPT)  ; ICR 6417
"RTN","MBAARPC1",246,0)
 Q 1
"RTN","MBAARPC2")
0^19^B78656995^n/a
"RTN","MBAARPC2",1,0)
MBAARPC2 ;OIT-PD/PB - Scheduling RPCs ;02/10/2016
"RTN","MBAARPC2",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAARPC2",3,0)
 ;
"RTN","MBAARPC2",4,0)
 ;This routine has multiple RPCs created to support the mobile Scheduling apps
"RTN","MBAARPC2",5,0)
 ;
"RTN","MBAARPC2",6,0)
 ;Associated ICRs:
"RTN","MBAARPC2",7,0)
 ;  ICR#
"RTN","MBAARPC2",8,0)
 ;  10103 XLFDT
"RTN","MBAARPC2",9,0)
 ;  5838 SDAMEVT
"RTN","MBAARPC2",10,0)
 ;  6048 SDAMEVT
"RTN","MBAARPC2",11,0)
 ;  6053 DPT
"RTN","MBAARPC2",12,0)
 ;  4433 SDAMA301
"RTN","MBAARPC2",13,0)
 ;
"RTN","MBAARPC2",14,0)
 ;Cancel an Appointment
"RTN","MBAARPC2",15,0)
CANCEL(RV,DFN,SC,SD,TYPE,RSN,RMK) ; SD APPOINTMENT CANCEL MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",16,0)
 N STATUS,RESULT S STATUS=$$CANCEL1(.RESULT,DFN,SC,SD,TYPE,RSN,RMK)
"RTN","MBAARPC2",17,0)
 ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAARPC2",18,0)
 S RV=$G(RESULT)
"RTN","MBAARPC2",19,0)
 Q
"RTN","MBAARPC2",20,0)
CANCEL1(RETURN,DFN,SC,SD,TYP,RSN,RMK) ; Cancel appointment MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",21,0)
 N CDATE,CDT,ERR,ODT,OIFN,OUSR,%
"RTN","MBAARPC2",22,0)
 S RETURN=0
"RTN","MBAARPC2",23,0)
 S %=$$CHKCAN(.RETURN,DFN,SC,SD) I $E(%,1,3)="APT" Q RETURN
"RTN","MBAARPC2",24,0)
 S CDATE=$$NOW^XLFDT  ;ICR#: 10103 XLFDT
"RTN","MBAARPC2",25,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAARPC2",26,0)
 S CIFN=CAPT("IFN")
"RTN","MBAARPC2",27,0)
 S OUSR=CAPT("USER"),ODT=CAPT("DATE")
"RTN","MBAARPC2",28,0)
 N SDATA,SDCPHDL
"RTN","MBAARPC2",29,0)
 S SDCPHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5838 SDAMEVT
"RTN","MBAARPC2",30,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCPHDL)
"RTN","MBAARPC2",31,0)
 S CDT=$$NOW^XLFDT()  ;ICR#: 10103 XLFDT
"RTN","MBAARPC2",32,0)
 D CANCEL^MBAAMDA3(.ERR,DFN,SD,TYP,RSN,RMK,$E(CDT,1,12),DUZ,OUSR,ODT)
"RTN","MBAARPC2",33,0)
 S OIFN=$$COVERB^MBAAMDA1(SC,SD,CIFN)
"RTN","MBAARPC2",34,0)
 S %=$$CANCEL^MBAAAPI1(RETURN,CAPT("CONSULT"),SC,SD,CIFN,RMK,TYP)
"RTN","MBAARPC2",35,0)
 D CANCEL^MBAAMDA1(SC,SD,DFN,CIFN)
"RTN","MBAARPC2",36,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,0,SDCPHDL) ;ICR#: 6048 MBAA SDAMEVT API CALLS
"RTN","MBAARPC2",37,0)
 S RETURN=1
"RTN","MBAARPC2",38,0)
 Q RETURN
"RTN","MBAARPC2",39,0)
 ;
"RTN","MBAARPC2",40,0)
CHKCAN(RETURN,DFN,SC,SD) ; Verify cancel MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",41,0)
 ;N APT,RET,%
"RTN","MBAARPC2",42,0)
 K APT N RET,%
"RTN","MBAARPC2",43,0)
 S RETURN=0
"RTN","MBAARPC2",44,0)
 I '$D(^DPT(DFN,"S",SD)) S RETURN="APTNTSCH" Q RETURN ; patient doesn't have an appointment at the requested time  ;ICR#: 6053 DPT
"RTN","MBAARPC2",45,0)
 S ROUTC=1
"RTN","MBAARPC2",46,0)
 D GETAPTS^MBAAMDA2(.APT,DFN,.SD)
"RTN","MBAARPC2",47,0)
 I APT("APT",SD,"STATUS")["C" D  S RETURN="APTCAND" Q RETURN ; Appointment already canceled.
"RTN","MBAARPC2",48,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCAND")
"RTN","MBAARPC2",49,0)
 I $$ISAPTCO^MBAAMAP4(,DFN,SD) D  Q RETURN="APTCCHO" ; Appointment has a check out date and can't be canceled
"RTN","MBAARPC2",50,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCCHO")
"RTN","MBAARPC2",51,0)
 S %=$$CLNRGHT^MBAAMAP1(.RET,+SC)
"RTN","MBAARPC2",52,0)
 I RET=0 D  S RETURN="APTCRGT" Q RETURN="APTCRGT" ; Appointment not cancelled. Access to this clinic to this clinic is restricted to only priv. users
"RTN","MBAARPC2",53,0)
 . S TXT(1)=RET("CLN"),TXT(2)=$C(10)
"RTN","MBAARPC2",54,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCRGT",.TXT)
"RTN","MBAARPC2",55,0)
 I '$$CHKSPC(.STAT,DFN,SD) D  S RETURN="APTCNPE" Q RETURN="APTCNPE" ; This appointment can't be canceled
"RTN","MBAARPC2",56,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCNPE",.TXT)
"RTN","MBAARPC2",57,0)
 S RETURN=1
"RTN","MBAARPC2",58,0)
 Q RETURN
"RTN","MBAARPC2",59,0)
CHKSPC(RETURN,DFN,SD) ; Check if status permit cancelation, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",60,0)
 N APT0,STATUS,IND,STAT,STATS
"RTN","MBAARPC2",61,0)
 S RETURN=0
"RTN","MBAARPC2",62,0)
 S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAARPC2",63,0)
 ;T13 Change to use SDAMA301 API
"RTN","MBAARPC2",64,0)
 K R1 D STATUS^MBAARPC1(.R1,DFN,SD,+$G(APT0)) S STATUS=+R1 K R1  ;ICR 4433
"RTN","MBAARPC2",65,0)
 ;S STATUS=+$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))  ;ICR#: 2851 MBAA ACCESS TO SDAM1 API get appointment status
"RTN","MBAARPC2",66,0)
 D LSTCSTA1^MBAAMDA2(.STAT)
"RTN","MBAARPC2",67,0)
 D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAARPC2",68,0)
 S IND=0
"RTN","MBAARPC2",69,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAARPC2",70,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAARPC2",71,0)
 S RETURN=$G(RETURN)
"RTN","MBAARPC2",72,0)
 Q RETURN
"RTN","MBAARPC2",73,0)
 ;Line Tags CLNDATA, RECALL, DELETE, CHK, NEWEWL, WFCK, ENRCHK, REQBY is commented out due to the functionality being descoped from the first release
"RTN","MBAARPC2",74,0)
 ;CLNDATA(RETURN,CLINICID) ; returns additional clinic data MBAA ADDITIONAL CLINIC DETAILS
"RTN","MBAARPC2",75,0)
 ; Input: CLINICID - IEN for the Clinic in the Hospital Location file (#44)
"RTN","MBAARPC2",76,0)
 ; Returns: 
"RTN","MBAARPC2",77,0)
 ; If Successful:
"RTN","MBAARPC2",78,0)
 ;  RETURN(0)="TREATING SPECIALTY^STOP CODE^CREDIT STOP CODE^SPECIALTY"
"RTN","MBAARPC2",79,0)
 ; If Failure:
"RTN","MBAARPC2",80,0)
 ;  RETURN(0)="0^Missing CLINICID" 
"RTN","MBAARPC2",81,0)
 ;  RETURN(0)="0^Clinic doesn't exist."
"RTN","MBAARPC2",82,0)
 ;
"RTN","MBAARPC2",83,0)
 ;I $G(CLINICID)="" S RETURN(0)="0^Missing CLINICID" Q
"RTN","MBAARPC2",84,0)
 ;I '$D(^SC(CLINICID,0)) S RETURN(0)="0^Clinic doesn't exist." Q  ;ICR#: 6044
"RTN","MBAARPC2",85,0)
 ;I $P(^SC(CLINICID,0),"^",3)'="C" S RETURN(0)="0^Clinic doesn't exist." Q  ;ICR#: 6044
"RTN","MBAARPC2",86,0)
 ;N NODE,STOPPTR,SPECPTR,CREDITPRT,SPECLTY,SPECL,SPEC,SPEC2,STOPCODE,CREDIT,CREDITPTR,CLINIC1,SPEC1  ;IRC#: 6044
"RTN","MBAARPC2",87,0)
 ;S NODE=$G(^SC(CLINICID,0)),STOPPTR=$P(NODE,"^",7),SPECPTR=$P(NODE,"^",20),CREDITPTR=$P(NODE,"^",18)
"RTN","MBAARPC2",88,0)
 ;S STOPCODE=$P(^DIC(40.7,STOPPTR,0),"^"),CREDIT=$P(^DIC(40.7,CREDITPTR,0),"^"),SPEC=$P(^DIC(45.7,SPECPTR,0),"^")  ;ICR#: 1024, 362
"RTN","MBAARPC2",89,0)
 ;S SPECLTY=$P(^DIC(45.7,SPECPTR,0),"^",2),SPECL=$P(^DIC(42.4,SPECLTY,0),"^",1)  ;ICR#: 430, 362
"RTN","MBAARPC2",90,0)
 ;D GETS^DIQ(44,CLINICID,"8;9.5;2503","IE","CLINIC1")
"RTN","MBAARPC2",91,0)
 ;S SPEC=$G(CLINIC1(44,CLINICID_",",9.5,"I")),STOPCODE=$G(CLINIC1(44,CLINICID_",",8,"E")),CREDIT=$G(CLINIC1(44,CLINICID_",",2503,"E")),SPEC2=$G(CLINIC1(44,CLINICID_",",9.5,"E"))
"RTN","MBAARPC2",92,0)
 ;D GETS^DIQ(45.7,SPEC,".01;1","IE","SPEC1")
"RTN","MBAARPC2",93,0)
 ;S SPECL=$G(SPEC1(45.7,SPEC_",",1,"E"))
"RTN","MBAARPC2",94,0)
 ;S RETURN(0)=$G(SPEC2)_"^"_$G(STOPCODE)_"^"_$G(CREDIT)_"^"_$G(SPECL)
"RTN","MBAARPC2",95,0)
 ;K NODE,STOPPTR,SPECPTR,CREDITPRT,SPECLTY,SPECL,SPEC,STOPCODE,CREDIT,CREDITPTR,CLINIC1,SPEC1
"RTN","MBAARPC2",96,0)
 ;Q
"RTN","MBAARPC2",97,0)
 ;RECALL(RESULTS,DFN,CLINIC,RECALLDT,PTRECDT,PROVIDER,LEN,FAST,TEST,USER,COMMENT) ; adds new patients to the Recall List MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",98,0)
 ; Input parameter is the Patient DFN
"RTN","MBAARPC2",99,0)
 ;S RESULTS(0)=1
"RTN","MBAARPC2",100,0)
 ;I $G(DFN)="" S RESULTS(0)="0^DFN is not defined" Q
"RTN","MBAARPC2",101,0)
 ;T13 Change to FM read
"RTN","MBAARPC2",102,0)
 ;N JX S JX=$$GET1^DIQ(2,$G(DFN),.01) I $G(JX)="" S RESULTS(0)="0^Not a patient in this system." Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",103,0)
 ;I '$D(^DPT(DFN,0)) S RESULTS(0)="0^Not a patient in this system." Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",104,0)
 ;I $G(CLINIC)="" S RESULTS(0)="0^Clinic not provided." Q
"RTN","MBAARPC2",105,0)
 ;T13 Change to FM read
"RTN","MBAARPC2",106,0)
 ;I '$D(^SC(CLINIC,0)) S RESULTS(0)="0^Clinic not in the Hospital Location File." Q  ;ICR#: 6044
"RTN","MBAARPC2",107,0)
 ;N JX S JX=$$GET1^DIQ(44,$G(CLINIC),.01) I $G(JX)="" S RESULTS(0)="0^Clinic not in the Hospital Location File." Q  ;ICR#: 6044
"RTN","MBAARPC2",108,0)
 ;I ($G(RECALLDT)=""!($G(RECALLDT)'>DT)) S RESULTS(0)="0^Provider Recall date not provided or not a valid date. Date must be in the future." Q
"RTN","MBAARPC2",109,0)
 ;I ($G(PTRECDT)=""!($G(PTRECDT)'>DT)) S RESULTS(0)="0^Patient recall date not provided or not a valid date. Date must be in the future" Q
"RTN","MBAARPC2",110,0)
 ;I $G(PROVIDER)="" S RESULTS(0)="0^Provider IEN not provided." Q
"RTN","MBAARPC2",111,0)
 ;I '$D(^VA(200,$G(PROVIDER),0)) S RESULTS(0)="0^Provider not provided." Q
"RTN","MBAARPC2",112,0)
 ;N JX S JX=$$GET1^DIQ(200,$G(PROVIDER),.01) I $G(JX)="" S RESULTS(0)="0^Provider not in the New Person file." Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",113,0)
 ;I $G(LEN)'>0 S RESULTS(0)="0^Appointment length not provided." Q
"RTN","MBAARPC2",114,0)
 ;I $G(FAST)="" S RESULTS(0)="0^FAST code not provided." Q
"RTN","MBAARPC2",115,0)
 ;S FAST=$$LOW^XLFSTR($G(FAST))
"RTN","MBAARPC2",116,0)
 ;I "nf"'[FAST S RESULTS(0)="0^FAST code not provided." Q
"RTN","MBAARPC2",117,0)
 ;I $G(TEST)'>0 S RESULTS(0)="0^Appointment Type code not provided. Appointment Type is a numeric value." Q
"RTN","MBAARPC2",118,0)
 ;I $G(USER)'>0 S RESULTS(0)="0^User IEN not provided." Q
"RTN","MBAARPC2",119,0)
 ;I '$D(^VA(200,$G(USER),0)) S RESULTS(0)="0^User IEN not provided." Q
"RTN","MBAARPC2",120,0)
 ;N JX S JX=$$GET1^DIQ(200,$G(USER),.01) I $G(JX)="" S RESULTS(0)="0^User not in the New Person File." Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",121,0)
 ;S ERR=0 D CHK I ERR=1 S RESULTS(0)="0^Duplicate Recall List Entry" Q
"RTN","MBAARPC2",122,0)
 ;K DO S (DIC,DIE)="^SD(403.5,",DIC(0)="Z",X=DFN,DLAYGO=403.5 D FILE^DICN K DO S NUM=+Y  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",123,0)
 ;S DA=NUM,DR="4.5///"_$G(CLINIC)_";4///"_$G(PROVIDER)_";2.6///"_$G(FAST)_";4.7///"_$G(LEN)_";5///"_$G(RECALLDT)_";5.5///"_$G(PTRECDT)_";2.5///"_$G(COMMENT)_";3///"_$G(TEST)_";7///"_$G(USER)
"RTN","MBAARPC2",124,0)
 ;D ^DIE
"RTN","MBAARPC2",125,0)
 ;S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","MBAARPC2",126,0)
 ;I $D(DTOUT) D DELETE
"RTN","MBAARPC2",127,0)
 ;K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,DIR,DTOUT
"RTN","MBAARPC2",128,0)
 ;Q
"RTN","MBAARPC2",129,0)
 ;DELETE ;delete new incomplete record and display message MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",130,0)
 ;S DIK=DIE
"RTN","MBAARPC2",131,0)
 ;D ^DIK K DIK
"RTN","MBAARPC2",132,0)
 ;S RESULTS(0)="0^All required data was not provided. Recall was not created!"
"RTN","MBAARPC2",133,0)
 ;Q
"RTN","MBAARPC2",134,0)
 ;CHK ; checks to see if the patient is on the recall list for the clinic and provider date MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",135,0)
 ;S XX=0 F  S XX=$O(^SD(403.5,"B",DFN,XX)) Q:XX'>0  D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",136,0)
 ;.;T13 Change to use FM
"RTN","MBAARPC2",137,0)
 ;.N ARRAY,ERR,C1,RD1,P1 D GETS^DIQ(403.5,XX_",","2;4,5","I","ARRAY","ERR")   ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",138,0)
 ;.S C1=$G(ARRAY(403.5,XX_",",2,"I")),RD1=$G(ARRAY(403.5,XX_",",5,"I")),P1=$G(ARRAY(403.5,XX_",",4,"I"))
"RTN","MBAARPC2",139,0)
 ;.I $G(C1)=CLINIC&($G(RD1)=RECALLDT)&($G(P1)=PROVIDER) S ERR=1
"RTN","MBAARPC2",140,0)
 ;.;S NODE=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",141,0)
 ;.;I ($P(NODE,"^",2)=CLINIC&($P(NODE,"^",6)=RECALLDT)&($P(NODE,"^",5)=PROVIDER)) S ERR=1
"RTN","MBAARPC2",142,0)
 ;I $G(ERR)>0 S ERR=1
"RTN","MBAARPC2",143,0)
 ;Q
"RTN","MBAARPC2",144,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAARPC2",145,0)
 ;CLNRGHT(RV,CLN) ;
"RTN","MBAARPC2",146,0)
 ; N STATUS,RESULT S STATUS=$$CLNRGHT^MBAAMAP1(.RESULT,CLN)
"RTN","MBAARPC2",147,0)
 ; ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAARPC2",148,0)
 ; S RV(0)=$G(RESULT)
"RTN","MBAARPC2",149,0)
 ; Q
"RTN","MBAARPC2",150,0)
NEWEWL(RV,SDWLD) ; ZLV EWL NEW
"RTN","MBAARPC2",151,0)
 I $G(SDWLD)="" S RV(0)="0^SDWLD List missing." Q
"RTN","MBAARPC2",152,0)
 S SDWLD("WLTYPE")=$P($G(SDWLD),"^",1)
"RTN","MBAARPC2",153,0)
 I SDWLD("WLTYPE")=""  S RV(0)="0^INVPARAM WLTYPE IS NULL" Q
"RTN","MBAARPC2",154,0)
 I $G(SDWLD("WLTYPE"))'>0!($G(SDWLD("WLTYPE"))'<5) S RV(0)="0^INVPARAM WLTYPE" Q
"RTN","MBAARPC2",155,0)
 S SDWLD("PATIENT")=$P($G(SDWLD),"^",2)
"RTN","MBAARPC2",156,0)
 I SDWLD("PATIENT")=""  S RV(0)="0^INVPARAM PATIENT IS NULL" Q
"RTN","MBAARPC2",157,0)
 S DFN=$G(SDWLD("PATIENT")) I '$D(^DPT(DFN,0)) S RV(0)="0^INVPARAM PATIENT DOESN'T EXIST." K DFN Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",158,0)
 S SDWLD("INSTITUTION")=$P($G(SDWLD),"^",3)
"RTN","MBAARPC2",159,0)
 I SDWLD("INSTITUTION")=""  S RV(0)="0^INVPARAM INSTITUTION IS NULL" Q
"RTN","MBAARPC2",160,0)
 N SITE S X=$G(SDWLD("INSTITUTION")) S SITE=$$IEN^XUMF(4,,X) I +$G(SITE)'>0 S RV(0)="0^INVPARAM INVALID INSTITUTION NUMBER." Q  ;ICR#:3795 XUMF
"RTN","MBAARPC2",161,0)
 S SDWLD("WAITFOR")=$P($G(SDWLD),"^",4)
"RTN","MBAARPC2",162,0)
 I SDWLD("WAITFOR")=""  S RV(0)="0^INVPARAM WAITFOR IS NULL" Q
"RTN","MBAARPC2",163,0)
 ;S ERR=0 D WFCK Q:$G(ERR)>0
"RTN","MBAARPC2",164,0)
 S SDWLD("PRIORITY")=$P($G(SDWLD),"^",5)
"RTN","MBAARPC2",165,0)
 I SDWLD("PRIORITY")=""  S RV(0)="0^INVPARAM PRIORITY IS NULL" Q
"RTN","MBAARPC2",166,0)
 I SDWLD("PRIORITY")'="A",(SDWLD("PRIORITY")'="F") S RV(0)="0^INVPARAM INVALID PRIORITY" Q
"RTN","MBAARPC2",167,0)
 S SDWLD("REQBY")=$P($G(SDWLD),"^",6)
"RTN","MBAARPC2",168,0)
 D REQBY
"RTN","MBAARPC2",169,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",170,0)
 S SDWLD("PROVIDER")=$P($G(SDWLD),"^",7)
"RTN","MBAARPC2",171,0)
 I SDWLD("PROVIDER")'="" D
"RTN","MBAARPC2",172,0)
 .N IEN S ERR=0,IEN=$G(SDWLD("PROVIDER"))
"RTN","MBAARPC2",173,0)
 .N JX S JX=$$GET1^DIQ(200,$G(IEN),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM PROVIDER IS NOT IN THE NEW PERSON FILE" Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",174,0)
 .;I '$D(^VA(200,IEN,0)) S ERR=1,RV(0)="0^INVPARAM PROVIDER IS NOT IN THE NEW PERSON FILE" Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",175,0)
 .I '$D(^XUSEC("PROVIDER",IEN)) S ERR=1,RV(0)="0^INVPARAM NOT A PROVIDER" Q  ;ICR#: 10076 XUSEC
"RTN","MBAARPC2",176,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",177,0)
 S SDWLD("SCPRCNT")=$P($G(SDWLD),"^",8)
"RTN","MBAARPC2",178,0)
 I SDWLD("SCPRCNT")'=""  D
"RTN","MBAARPC2",179,0)
 .S ERR=0 I SDWLD("SCPRCNT")'>0!(SDWLD("SCPRCNT")'<101) S ERR=1,RV(0)="0^INVPARAM SERVICE CONNECTED PERCENTAGE" Q
"RTN","MBAARPC2",180,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",181,0)
 S SDWLD("SCPRIORITY")=$P($G(SDWLD),"^",9)
"RTN","MBAARPC2",182,0)
 I SDWLD("SCPRIORITY")'=""  D
"RTN","MBAARPC2",183,0)
 .S ERR=0 I $G(SDWLD("SCPRIORITY"))'=0,($G(SDWLD("SCPRIORITY"))'=1) S ERR=1,RV(0)="0^INVPARAM INVALID PRIORITY" Q
"RTN","MBAARPC2",184,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",185,0)
 S SDWLD("DSRDDT")=$P($G(SDWLD),"^",10)
"RTN","MBAARPC2",186,0)
 I SDWLD("DSRDDT")=""  S RV(0)="0^INVPARAM DESIRED DATE OF APPOINTMENT IS NULL" Q
"RTN","MBAARPC2",187,0)
 S ERR=0,X=$G(SDWLD("DSRDDT")) D ^%DT I Y=-1 S ERR=0,RV(0)="0^INVPARAM NOT A VALID DATE" Q
"RTN","MBAARPC2",188,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",189,0)
 S SDWLD("CMNTS")=$P($G(SDWLD),"^",11)
"RTN","MBAARPC2",190,0)
 I SDWLD("CMNTS")'=""  D
"RTN","MBAARPC2",191,0)
 .I $L($G(SDWLD("CMNTS")))'>0!($L($G(SDWLD("CMNTS")))'<61) S ERR=1,RV(0)="0^INVPARAM COMMENTS ARE TOO LONG" Q
"RTN","MBAARPC2",192,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",193,0)
 S SDWLD("ENRSTAT")=$P($G(SDWLD),"^",12)
"RTN","MBAARPC2",194,0)
 I SDWLD("ENRSTAT")=""  S RV(0)="0^INVPARAM ENROLLEE STATUS IS NULL" Q
"RTN","MBAARPC2",195,0)
 S ERR=0 D ENRCHK Q:$G(ERR)=1
"RTN","MBAARPC2",196,0)
 S SDWLD("ENRDU")=$P($G(SDWLD),"^",13)
"RTN","MBAARPC2",197,0)
 I SDWLD("ENRDU")'=""  D
"RTN","MBAARPC2",198,0)
 .S ERR=0 S X=$G(SDWLD("ENRDU")) D ^%DT I $G(Y)=-1 S ERR=1,RV(0)="0^INVPARAM ENROLLEE DATE INVALID DATE" Q
"RTN","MBAARPC2",199,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",200,0)
 S SDWLD("ENRDF")=$P($G(SDWLD),"^",14)
"RTN","MBAARPC2",201,0)
 I SDWLD("ENRDF")'=""  D
"RTN","MBAARPC2",202,0)
 .S ERR=0 I $G(SDWLD("ENRDF"))'=0,($G(SDWLD("ENRDF"))'<5) S ERR=1,RV(0)="0^INVPARAM ENROLLEE DATABASE FILE" Q
"RTN","MBAARPC2",203,0)
 Q:ERR=1
"RTN","MBAARPC2",204,0)
 S SDWLD("TICKLER")=$P($G(SDWLD),"^",15)
"RTN","MBAARPC2",205,0)
 I SDWLD("TICKLER")'=""  D
"RTN","MBAARPC2",206,0)
 .S SDWLD("TICKLER")=$$UP^XLFSTR($G(SDWLD("TICKLER")))
"RTN","MBAARPC2",207,0)
 .S ERR=0 I $G(SDWLD("TICKLER"))'="Y" S ERR=1,RV(0)="0^INVPARAM TICKLER" Q
"RTN","MBAARPC2",208,0)
 Q:ERR=1
"RTN","MBAARPC2",209,0)
 S SDWLD("CHDCLINP")=$P($G(SDWLD),"^",16)
"RTN","MBAARPC2",210,0)
 I SDWLD("CHDCLINP")'=""  D
"RTN","MBAARPC2",211,0)
 .N APTR
"RTN","MBAARPC2",212,0)
 .S ERR=0,PTR=$G(SDWLD("CHDCLINP")) I '$D(^SDWL(409.3,PTR,0)) S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS NOT VALID" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",213,0)
 .;T13 Change to use FM
"RTN","MBAARPC2",214,0)
 .I $D(^SDWL(409.3,PTR,0)) S APTR=$$GET1^DIQ(409.3,PTR_",",".01","I") I APTR'=SDWLD("PATIENT") S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS FOR A DIFFERENT PATIENT" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",215,0)
 .;I $D(^SDWL(409.3,PTR,0)) S APTR=$P(^SDWL(409.3,PTR,0),"^",1) I APTR'=SDWLD("PATIENT") S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS FOR A DIFFERENT PATIENT" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",216,0)
 .K APTR
"RTN","MBAARPC2",217,0)
 Q:ERR=1
"RTN","MBAARPC2",218,0)
 I SDWLD("WLTYPE")=3!(SDWLD("WLTYPE")=4) D
"RTN","MBAARPC2",219,0)
 .K ERR S ERR=0
"RTN","MBAARPC2",220,0)
 .I SDWLD("REQBY")'=1,$G(SDWLD("REQBY"))'=2 S ERR=1
"RTN","MBAARPC2",221,0)
 I ERR=1 K ERR S RV(0)="0^INVPARAM REQBY" Q
"RTN","MBAARPC2",222,0)
 N STATUS,RESULT S STATUS=$$NEW^MBAAWLAP(.RESULT,.SDWLD)
"RTN","MBAARPC2",223,0)
 I 'STATUS S RV=-1
"RTN","MBAARPC2",224,0)
 I $G(STATUS) S RV(0)=1
"RTN","MBAARPC2",225,0)
 K ERR,X,IEN,DFN,PTR,CHK,TYPE,REQBY
"RTN","MBAARPC2",226,0)
 Q
"RTN","MBAARPC2",227,0)
 ;WFCK ; Check to make sure the pointer is valid for the Waitfor parameter
"RTN","MBAARPC2",228,0)
 ;N PTR S PTR=$G(SDWLD("WAITFOR")),ERR=0
"RTN","MBAARPC2",229,0)
 ;I SDWLD("WLTYPE")=1 D
"RTN","MBAARPC2",230,0)
 ;.;I '$D(^SCTM(404.51,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID TEAM" Q  ;ICR#: 1945 DBIA 1945
"RTN","MBAARPC2",231,0)
 ;.N JX S JX=$$GET1^DIQ(404.51,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID TEAM" Q  ;ICR#: 1945 DBIA 1945
"RTN","MBAARPC2",232,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",233,0)
 ;I SDWLD("WLTYPE")=2 D
"RTN","MBAARPC2",234,0)
 ;.;I '$D(^SCTM(404.57,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID POSITION" Q  ;ICR#: 6064 MBAA ACCESS TO SCTM(404.57
"RTN","MBAARPC2",235,0)
 ;.N JX S JX=$$GET1^DIQ(404.57,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID POSITION" Q  ;ICR#: 6064 MBAA ACCESS TO SCTM(404.57
"RTN","MBAARPC2",236,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",237,0)
 ;I SDWLD("WLTYPE")=3 D
"RTN","MBAARPC2",238,0)
 ;.;I '$D(^SDWL(409.31,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID SPECIALTY" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",239,0)
 ;.N JX S JX=$$GET1^DIQ(409.31,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID SPECIALTY" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",240,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",241,0)
 ;I SDWLD("WLTYPE")=4 D
"RTN","MBAARPC2",242,0)
 ;.;I '$D(^SDWL(409.32,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID WAIT LIST CLINIC" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",243,0)
 ;.N JX S JX=$$GET1^DIQ(409.32,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID WAIT LIST CLINIC" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",244,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",245,0)
 ;I SDWLD("WLTYPE")>5 S RV(0)="0^INVPARAM WAIT LIST TYPE" Q
"RTN","MBAARPC2",246,0)
 ;Q
"RTN","MBAARPC2",247,0)
ENRCHK ; Check enrollee status codes - must be either N, E, P or U
"RTN","MBAARPC2",248,0)
 S CHK=$G(SDWLD("ENRSTAT"))
"RTN","MBAARPC2",249,0)
 I CHK'="N",(CHK'="E"),(CHK'="P"),(CHK'="U") S ERR=1,RV(0)="0^INVPARAM INVALID ENROLLEE STATUS" Q
"RTN","MBAARPC2",250,0)
 Q
"RTN","MBAARPC2",251,0)
REQBY ; Checksto be sure a correct value for the REQBY parameter is correct based on the Wait List Type
"RTN","MBAARPC2",252,0)
 S ERR=0,TYPE=$G(SDWLD("WLTYPE")),REQBY=$G(SDWLD("REQBY"))
"RTN","MBAARPC2",253,0)
 I $G(REQBY)'=1,($G(REQBY)'=2),($G(REQBY)'="") S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",254,0)
 I $G(REQBY)'=""  D
"RTN","MBAARPC2",255,0)
 .I TYPE=3,(TYPE=4) D
"RTN","MBAARPC2",256,0)
 ..I REQBY'=1,(REQBY'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",257,0)
 .I TYPE=1,(TYPE=2) D
"RTN","MBAARPC2",258,0)
 ..I REQBY=1,(REQBY'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",259,0)
 I $G(REQBY)="" D
"RTN","MBAARPC2",260,0)
 .I TYPE'=1,(TYPE'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",261,0)
 Q
"RTN","MBAARPC3")
0^20^B3456217^n/a
"RTN","MBAARPC3",1,0)
MBAARPC3 ;OIT-PD/PB - Scheduling RPCs ;02/10/2016
"RTN","MBAARPC3",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 13, 2015;Build 85
"RTN","MBAARPC3",3,0)
 ;
"RTN","MBAARPC3",4,0)
 ;Associated ICRs:
"RTN","MBAARPC3",5,0)
 ;  ICR#
"RTN","MBAARPC3",6,0)
 ;  6044 SC(
"RTN","MBAARPC3",7,0)
 ;
"RTN","MBAARPC3",8,0)
 ;This routine has multiple RPCs created to support the mobile Scheduling apps
"RTN","MBAARPC3",9,0)
 ;Line Tag ADMITS commented out due to the descoping the functionality in the first release
"RTN","MBAARPC3",10,0)
 ;ADMITS(RESULTS,DFN) ;Returns all admisssions for a patient MBAA RPC: MBAA PATIENT ADMISSIONS
"RTN","MBAARPC3",11,0)
 ;Input parameter: Patient DFN
"RTN","MBAARPC3",12,0)
 ;Returns:
"RTN","MBAARPC3",13,0)
 ;  if admissions are found returns an array in the format of:
"RTN","MBAARPC3",14,0)
 ;  RESULTS(0)=Discharge flag (0 = admitted, 1 = discharged)^Admission date^reason for admission^primary provider^attending physician^length of stay^ward^room-bed^treating specialty^date of discharge^type of discharge
"RTN","MBAARPC3",15,0)
 ; if no admissions are found for the patient in the last year
"RTN","MBAARPC3",16,0)
 ; Returns: 
"RTN","MBAARPC3",17,0)
 ;  RESULTS(INC)="0^No admissions"
"RTN","MBAARPC3",18,0)
 ;  Returns the following errors:
"RTN","MBAARPC3",19,0)
 ;  RESULTS(0)="0^DFN Missing"
"RTN","MBAARPC3",20,0)
 ;  RESULTS(0)="0^Not a patient at this facility"
"RTN","MBAARPC3",21,0)
 ;
"RTN","MBAARPC3",22,0)
 ;K MOVEDT,DTFLG
"RTN","MBAARPC3",23,0)
 ;I $G(DFN)'>0 S RESULTS(0)="0^DFN Missing" Q
"RTN","MBAARPC3",24,0)
 ;I '$D(^DPT($G(DFN),0)) S RESULTS(0)="0^Not a patient at this facility" Q
"RTN","MBAARPC3",25,0)
 ;I '$D(^DGPM("APTT1",DFN)) S RESULTS(0)="0^Patient has not been admitted at this facility" Q  ;ICR#: 565 DGPM("APTT1"
"RTN","MBAARPC3",26,0)
 ;D NOW^%DTC S MOVEDT=$$FMADD^XLFDT(%,-366,0,0,0),INC=1,DTFLG=0 ; removed customer wants all admissions
"RTN","MBAARPC3",27,0)
 ;S MOVEDT="",INC=1,DTFLG=0
"RTN","MBAARPC3",28,0)
 ;I $D(^DGPM("APTT1",DFN)) D CHKDT
"RTN","MBAARPC3",29,0)
 ;I DTFLG=1 S RESULTS(0)="0^Patient has not been admitted at this facility in the last year." Q
"RTN","MBAARPC3",30,0)
 ;F  S MOVEDT=$O(^DGPM("APTT1",DFN,MOVEDT)) Q:MOVEDT'>0  S REC=0 F  S REC=$O(^DGPM("APTT1",DFN,MOVEDT,REC)) Q:REC'>0  D
"RTN","MBAARPC3",31,0)
 ;.;K NODE,W1,WARD,RM1,RMBED,P1,PROVIDER,ATENDING,DGPP,DGAP,S1,TRSPCLTY,SHRTDIAG,DISFLAG,ADFLG,DISDATE,R1,TYPEDIS,STAYLEN,ADMITS
"RTN","MBAARPC3",32,0)
 ;.;S NODE=$G(^DGPM(REC,0)),ADFLG=0
"RTN","MBAARPC3",33,0)
 ;.;S ADFLG=0
"RTN","MBAARPC3",34,0)
 ;.;D GETS^DIQ(405,REC,".04;.06;.07;.08;.09;.1;.17;.19","IE","ADMITS")
"RTN","MBAARPC3",35,0)
 ;.;S W1=$P(NODE,"^",6) S:$G(W1)>0 WARD=$P(^DIC(42,W1,0),"^")  ;ICR#: 10039
"RTN","MBAARPC3",36,0)
 ;.;S WARD=$G(ADMITS(405,REC_",",.06,"E"))
"RTN","MBAARPC3",37,0)
 ;.;S RM1=$P(NODE,"^",7) S:$G(RM1)>0 RMBED=$P(^DG(405.4,RM1,0),"^")  ;ICR#: 1380 DG(405.4
"RTN","MBAARPC3",38,0)
 ;.;S RMBED=$G(ADMITS(405,REC_",",.07,"E"))
"RTN","MBAARPC3",39,0)
 ;.;S (DGPP,DGAP)="" D NOW^%DTC S NOWI=9999999.999999-% K %
"RTN","MBAARPC3",40,0)
 ;.;F I=NOWI:0 S I=$O(^DGPM("ATS",DFN,REC,I)) Q:'I  F J=0:0 S J=$O(^DGPM("ATS",DFN,REC,I,J)) Q:'J  F IFN=0:0 S IFN=$O(^DGPM("ATS",DFN,REC,I,J,IFN)) Q:'IFN  D TS1   ;ICR#: 419 DGPM(
"RTN","MBAARPC3",41,0)
 ;.;S S1=$P(NODE,"^",9) S:$G(S1)>0 TRSPCLTY=$P(^DIC(45.7,S1,0),"^")  ;ICR#: 362
"RTN","MBAARPC3",42,0)
 ;.;S TRSPCLTY=$G(ADMITS(405,REC_",",.09,"E"))
"RTN","MBAARPC3",43,0)
 ;.;S SHRTDIAG=$P(NODE,"^",10)
"RTN","MBAARPC3",44,0)
 ;.;S SHRTDIAG=$G(ADMITS(405,REC_",",.1,"E"))
"RTN","MBAARPC3",45,0)
 ;.;S DISFLAG=$P(NODE,"^",17)
"RTN","MBAARPC3",46,0)
 ;.;S DISFLAG=$G(ADMITS(405,REC_",",.17,"I"))
"RTN","MBAARPC3",47,0)
 ;.;I $G(DISFLAG)>0 S ADFLG=1,DISDATE=$P(^DGPM($G(DISFLAG),0),"^"),R1=$P(^DGPM($G(DISFLAG),0),"^",4),TYPEDIS=$P(^DG(405.1,R1,0),"^"),STAYLEN=$$FMDIFF^XLFDT(DISDATE,MOVEDT,1)  ;ICR#: 10103 XLFDT, 2965 DG(405.1
"RTN","MBAARPC3",48,0)
 ;.;I $G(DISFLAG)>0 W !,$G(DISFLAG) S ADFLG=1,DISDATE=$P(^DGPM($G(DISFLAG),0),"^"),R1=$P(^DGPM($G(DISFLAG),0),"^",4),TYPEDIS=$G(ADMITS(405,REC_",",.04,"E")),STAYLEN=$$FMDIFF^XLFDT(DISDATE,MOVEDT,1)  ;ICR#: 10103 XLFDT, 2965 DG(405.1
"RTN","MBAARPC3",49,0)
 ;.;S RESULTS(INC)=$G(ADFLG)_"^"_MOVEDT_"^"_$G(SHRTDIAG)_"^"_$G(PROVIDER)_"^"_$G(ATENDING)_"^"_$G(STAYLEN)_"^"_$G(WARD)_"^"_$G(RMBED)_"^"_$G(TRSPCLTY)_"^"_$G(DISDATE)_"^"_$G(TYPEDIS),INC=$G(INC)+1
"RTN","MBAARPC3",50,0)
 ;.;K NODE,W1,WARD,RM1,RMBED,P1,PROVIDER,ATENDING,DGPP,DGAP,S1,TRSPCLTY,SHRTDIAG,DISFLAG,ADFLG,DISDATE,R1,TYPEDIS,STAYLEN
"RTN","MBAARPC3",51,0)
 ;K MOVEDT,DFN,NODE,W1,I,IFN,INC,J,WARD,RM1,RMBED,P1,NOWI,REC,PROVIDER,ATENDING,DGPP,DGAP,S1,TRSPCLTY,SHRTDIAG,DISFLAG,ADFLG,DISDATE,R1,TYPEDIS,STAYLEN,DTFLG,ADMITS
"RTN","MBAARPC3",52,0)
 ;Q
"RTN","MBAARPC3",53,0)
 ;T13 Change to remove the linetag TS1 as it is not used in the first release of SCV
"RTN","MBAARPC3",54,0)
 ;TS1 ;
"RTN","MBAARPC3",55,0)
 ;N ADMITS1
"RTN","MBAARPC3",56,0)
 ;D GETS^DIQ(405,IFN,".08;.19","IE","ADMITS1")
"RTN","MBAARPC3",57,0)
 ;S PROVIDER=$G(ADMITS1(405,IFN_",",.08,"E")),ATENDING=$G(ADMITS1(405,IFN_",",.19,"E"))
"RTN","MBAARPC3",58,0)
 ;K PROVIDER,ATENDING
"RTN","MBAARPC3",59,0)
 ;Q
"RTN","MBAARPC3",60,0)
GETPROV(PROV1,CLINID) ; Get a list of providers by clinic  - RPC MBAA PROVIDERS BY CLINIC
"RTN","MBAARPC3",61,0)
 ; RPC MBAA PROVIDERS BY CLINIC
"RTN","MBAARPC3",62,0)
 ; INPUT PARAMETER: CLINIC ID - IEN for the clinic in the HOSPITAL LOCATION File (#44)
"RTN","MBAARPC3",63,0)
 ; OUTPUT: Array of providers in the format
"RTN","MBAARPC3",64,0)
 ; Success: ARRAY(I)=DFN^PROVIDER NAME
"RTN","MBAARPC3",65,0)
 ; Failure: ARRAY(0)="0^ERROR CODE"
"RTN","MBAARPC3",66,0)
 ;
"RTN","MBAARPC3",67,0)
 N ERR,CLINIC
"RTN","MBAARPC3",68,0)
 I $G(CLINID)="" S PROV1(1)="0^CLINIC ID IS NULL" Q
"RTN","MBAARPC3",69,0)
 S CLINIC=$$GET1^DIQ(44,CLINID,.01) I $G(CLINIC)="" S PROV1(1)="0^CLINIC DOESN'T EXIST" Q  ;ICR#: 6044 SC(
"RTN","MBAARPC3",70,0)
 D GETS^DIQ(44,$G(CLINID),"2600*","IE","PROV")
"RTN","MBAARPC3",71,0)
 S CNT=1,XX="" F  S XX=$O(PROV(44.1,XX)) Q:XX=""  D
"RTN","MBAARPC3",72,0)
 .K PIEN,PNAME
"RTN","MBAARPC3",73,0)
 .S PIEN=$G(PROV(44.1,XX,.01,"I")),PNAME=$G(PROV(44.1,XX,.01,"E"))
"RTN","MBAARPC3",74,0)
 .I $G(PIEN)>0  S PROV1(CNT)=$G(PIEN)_"^"_$G(PNAME),CNT=CNT+1
"RTN","MBAARPC3",75,0)
 .K PIEN,PNAME
"RTN","MBAARPC3",76,0)
 K CNT,CLINID,CLINIC,XX,PROV,PIEN,PNAME
"RTN","MBAARPC3",77,0)
 I $G(PROV1(1))="" S PROV1(1)="NO PROVIDERS ASSIGNED TO THE CLINIC"
"RTN","MBAARPC3",78,0)
 Q
"RTN","MBAARPCL")
0^21^B175476210^n/a
"RTN","MBAARPCL",1,0)
MBAARPCL ;OIT-PD/PB - Scheduling RPCs ;02/10/2016
"RTN","MBAARPCL",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Feb 10, 2016;Build 85
"RTN","MBAARPCL",3,0)
 ;
"RTN","MBAARPCL",4,0)
 ;Associated ICRs:
"RTN","MBAARPCL",5,0)
 ;  ICR#
"RTN","MBAARPCL",6,0)
 ;  6045 SD(403.5
"RTN","MBAARPCL",7,0)
 ;  10061 VADPT
"RTN","MBAARPCL",8,0)
 ;  6044 SC(
"RTN","MBAARPCL",9,0)
 ;  10112 VASITE
"RTN","MBAARPCL",10,0)
 ;  6053 DPT
"RTN","MBAARPCL",11,0)
 ;  10103 XLFDT
"RTN","MBAARPCL",12,0)
 ;  6047 SDWL(409.32
"RTN","MBAARPCL",13,0)
 ;  1024 DIC(40.7
"RTN","MBAARPCL",14,0)
 ;  6046 SDWL(409.3
"RTN","MBAARPCL",15,0)
 ;
"RTN","MBAARPCL",16,0)
 ;This routine has multiple RPCs created to support the mobile Scheduling apps
"RTN","MBAARPCL",17,0)
RECALL(RESULTS)  ;pull a list of recalls for a facility MBAA RPC: MBAA RECALL FACILITY LIST
"RTN","MBAARPCL",18,0)
 ;   No input parameters
"RTN","MBAARPCL",19,0)
 ;   Output: RESULTS Array:
"RTN","MBAARPCL",20,0)
 ;       $P(1) = DFN
"RTN","MBAARPCL",21,0)
 ;       $P(2) = PTR TO CLINIC FILE
"RTN","MBAARPCL",22,0)
 ;       $P(3) = ACCESSION#
"RTN","MBAARPCL",23,0)
 ;       $P(4) = TEST/APP - PTR TO FILE 403.51
"RTN","MBAARPCL",24,0)
 ;       $P(5) = PROVIDER - PTR TO FILE 405.54
"RTN","MBAARPCL",25,0)
 ;       $P(6) = RECALL DATE PER PROVIDER
"RTN","MBAARPCL",26,0)
 ;       $P(7) = COMMENT
"RTN","MBAARPCL",27,0)
 ;       $P(8) = FAST/NON-FASTING (SET OF CODES: f = Fasting, n = Non- Fasting)
"RTN","MBAARPCL",28,0)
 ;       $P(9) = LENGTH OF APPOINTMENT
"RTN","MBAARPCL",29,0)
 ;       $P(10) = DATE REMINDER SENT
"RTN","MBAARPCL",30,0)
 ;       $P(11) = USER WHO ENTERED RECALL (PTR to file 200)
"RTN","MBAARPCL",31,0)
 ;       $P(12) = RECALL DATE (PER PATIENT)
"RTN","MBAARPCL",32,0)
 ;       $P(13) = SECOND PRINT DATE
"RTN","MBAARPCL",33,0)
 ;       $P(14) = PATIENT NAME (LAST,FIRST)
"RTN","MBAARPCL",34,0)
 ;       $P(15) = PATIENT SSN
"RTN","MBAARPCL",35,0)
 ;       $P(16) = CLINIC NAME
"RTN","MBAARPCL",36,0)
 ;
"RTN","MBAARPCL",37,0)
 S CNT=0 S XX=0 F  S XX=$O(^SD(403.5,XX)) Q:XX'>0  D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",38,0)
 .K DFN,LNAME,SSN,CLINIC,CIEN,NODE,ACCESS,COMMENT,USER,TESTAPP,FASTNON,PATRECDT,PROVIDER,APPTLEN,SCEPRT,RECALLDT,REMINDDT
"RTN","MBAARPCL",39,0)
 .;T13 Change to FM read
"RTN","MBAARPCL",40,0)
 .;S NODE=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",41,0)
 .;S DFN=$P(NODE,"^"),CIEN=$P(NODE,"^",2)
"RTN","MBAARPCL",42,0)
 .;D DEM^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",43,0)
 .;S LNAME=$G(VADM(1)),SSN=$P($G(VADM(2)),"^",2)
"RTN","MBAARPCL",44,0)
 .;I $G(CIEN)>0 S CLINIC=$P(^SC(CIEN,0),"^")  ;ICR#: 6044 SC(
"RTN","MBAARPCL",45,0)
 .;S ACCESS=$P(NODE,"^",3),TESTAPP=$P(NODE,"^",4),PROVIDER=$P(NODE,"^",5),RECALLDT=$P(NODE,"^",6)
"RTN","MBAARPCL",46,0)
 .;S COMMENT=$P(NODE,"^",7),FASTNON=$P(NODE,"^",8),APPTLEN=$P(NODE,"^",9),REMINDDT=$P(NODE,"^",10)
"RTN","MBAARPCL",47,0)
 .;S USER=$P(NODE,"^",11),PATRECDT=$P(NODE,"^",12),SECPRT=$P(NODE,"^",13)
"RTN","MBAARPCL",48,0)
 .;S RESULTS(CNT)=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",49,0)
 .N ARRAY D GETS^DIQ(403.5,$G(XX),"**","IE","ARRAY")
"RTN","MBAARPCL",50,0)
 .S DFN=$G(ARRAY(403.5,XX_",",.01,"I")),LNAME=$G(ARRAY(403.5,XX_",",.01,"E")),CIEN=$G(ARRAY(403.5,XX_",",4.5,"I")),CLINIC=$G(ARRAY(403.5,XX_",",4.5,"E"))
"RTN","MBAARPCL",51,0)
 .D DEM^VADPT S SSN=$P($G(VADM(2)),"^",2)
"RTN","MBAARPCL",52,0)
 .S ACCESS=$G(ARRAY(403.5,XX_",",2,"I")),TESTAPP=$G(ARRAY(403.5,XX_",",3,"I")),PROVIDER=$G(ARRAY(403.5,XX_",",4,"I")),RECALLDT=$G(ARRAY(403.5,XX_",",5,"I"))
"RTN","MBAARPCL",53,0)
 .S COMMENT=$G(ARRAY(403.5,XX_",",2.5,"I")),FASTNON=$G(ARRAY(403.5,XX_",",2.6,"I")),APPTLEN=$G(ARRAY(403.5,XX_",",4.7,"I"))
"RTN","MBAARPCL",54,0)
 .S REMINDDT=$G(ARRAY(403.5,XX_",",6,"I")),USER=$G(ARRAY(403.5,XX_",",7,"I")),PATRECDT=$G(ARRAY(403.5,XX_",",5.5,"I")),SECPRT=$G(ARRAY(403.5,XX_",",8,"I"))
"RTN","MBAARPCL",55,0)
 .S RESULTS(CNT)=$G(DFN)_U_$G(CIEN)_U_$G(ACCESS)_U_$G(TESTAPP)_U_$G(PROVIDER)_U_$G(RECALLDT)_U_$G(COMMENT)_U_$G(FASTNON)_U_$G(APPTLEN)_U_$G(REMINDDT)_U_$G(USER)_U_$G(PATRECDT)_U_$G(SECPRT)_U_$G(LNAME)_U_$G(SSN)_U_$G(CLINIC)
"RTN","MBAARPCL",56,0)
 .;S:$P(RESULTS(CNT),"^",13)="" RESULTS(CNT)=$G(RESULTS(CNT))_"^^"_$G(LNAME)_"^"_$G(SSN)_"^"_$G(CLINIC)
"RTN","MBAARPCL",57,0)
 .S CNT=CNT+1
"RTN","MBAARPCL",58,0)
 .D KVA^VADPT
"RTN","MBAARPCL",59,0)
 S:$G(RESULTS(0))="" RESULTS(0)="1^RECALL LIST EMPTY"
"RTN","MBAARPCL",60,0)
 K XDT,XX,CNT,DFN,LNAME,VA("PID"),VA("BID"),SSN,CLINIC,CIEN,NODE,ACCESS,COMMENT,USER,TESTAPP,FASTNON,PATRECDT,PROVIDER,APPTLEN,SCEPRT,RECALLDT,REMINDDT,SECPRT
"RTN","MBAARPCL",61,0)
 Q
"RTN","MBAARPCL",62,0)
RCLDFN(RESULTS,DFN) ;pull a list of recalls by patient MBAA RPC: MBAA RECALL LIST BY PATIENT
"RTN","MBAARPCL",63,0)
 ;   Input parameter = DFN (PTR to Patient file #2)
"RTN","MBAARPCL",64,0)
 ;   Output: RESULTS Array:
"RTN","MBAARPCL",65,0)
 ;       $P(1) = DFN
"RTN","MBAARPCL",66,0)
 ;       $P(2) = PTR TO CLINIC FILE
"RTN","MBAARPCL",67,0)
 ;       $P(3) = ACCESSION#
"RTN","MBAARPCL",68,0)
 ;       $P(4) = TEST/APP - PTR TO FILE 403.51
"RTN","MBAARPCL",69,0)
 ;       $P(5) = PROVIDER - PTR TO FILE 405.54
"RTN","MBAARPCL",70,0)
 ;       $P(6) = RECALL DATE PER PROVIDER
"RTN","MBAARPCL",71,0)
 ;       $P(7) = COMMENT
"RTN","MBAARPCL",72,0)
 ;       $P(8) = FAST/NON-FASTING (SET OF CODES: f = Fasting, n = Non- Fasting)
"RTN","MBAARPCL",73,0)
 ;       $P(9) = LENGTH OF APPOINTMENT
"RTN","MBAARPCL",74,0)
 ;       $P(10) = DATE REMINDER SENT
"RTN","MBAARPCL",75,0)
 ;       $P(11) = USER WHO ENTERED RECALL (PTR to file 200)
"RTN","MBAARPCL",76,0)
 ;       $P(12) = RECALL DATE (PER PATIENT)
"RTN","MBAARPCL",77,0)
 ;       $P(13) = SECOND PRINT DATE
"RTN","MBAARPCL",78,0)
 ;       $P(14) = PATIENT NAME (LAST,FIRST)
"RTN","MBAARPCL",79,0)
 ;       $P(15) = PATIENT SSN
"RTN","MBAARPCL",80,0)
 ;       $P(16) = CLINIC NAME
"RTN","MBAARPCL",81,0)
 ;
"RTN","MBAARPCL",82,0)
 K RESULTS
"RTN","MBAARPCL",83,0)
 I $G(DFN)="" S RESULTS(0)="1^DFN HAS TO BE SUPPLIED" Q
"RTN","MBAARPCL",84,0)
 S RESULTS(0)="1^RECALL LIST EMPTY"
"RTN","MBAARPCL",85,0)
 S CNT=0,XX=0 F  S XX=$O(^SD(403.5,"B",DFN,XX)) Q:XX'>0  D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",86,0)
 .K LNAME,SSN,CLINIC,CIEN,NODE,ACCESS,COMMENT,USER,TESTAPP,FASTNON,PATRECDT,PROVIDER,APPTLEN,SCEPRT,RECALLDT,REMINDDT
"RTN","MBAARPCL",87,0)
 .;T13 Change to FM read
"RTN","MBAARPCL",88,0)
 .;S NODE=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",89,0)
 .;S CIEN=$P(NODE,"^",2)
"RTN","MBAARPCL",90,0)
 .;D DEM^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",91,0)
 .;S LNAME=$G(VADM(1)),SSN=$P($G(VADM(2)),"^",2)
"RTN","MBAARPCL",92,0)
 .;I $G(CIEN)>0 S CLINIC=$P(^SC(CIEN,0),"^")  ;ICR#: 6044 SC(
"RTN","MBAARPCL",93,0)
 .;S ACCESS=$P(NODE,"^",3),TESTAPP=$P(NODE,"^",4),PROVIDER=$P(NODE,"^",5),RECALLDT=$P(NODE,"^",6)
"RTN","MBAARPCL",94,0)
 .;S COMMENT=$P(NODE,"^",7),FASTNON=$P(NODE,"^",8),APPTLEN=$P(NODE,"^",9),REMINDDT=$P(NODE,"^",10)
"RTN","MBAARPCL",95,0)
 .;S USER=$P(NODE,"^",11),PATRECDT=$P(NODE,"^",12),SECPRT=$P(NODE,"^",13)
"RTN","MBAARPCL",96,0)
 .;S RESULTS(CNT)=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPCL",97,0)
 .N ARRAY D GETS^DIQ(403.5,$G(XX),"**","IE","ARRAY")
"RTN","MBAARPCL",98,0)
 .S DFN=$G(ARRAY(403.5,XX_",",.01,"I")),LNAME=$G(ARRAY(403.5,XX_",",.01,"E")),CIEN=$G(ARRAY(403.5,XX_",",4.5,"I")),CLINIC=$G(ARRAY(403.5,XX_",",4.5,"E"))
"RTN","MBAARPCL",99,0)
 .D DEM^VADPT S SSN=$P($G(VADM(2)),"^",2)
"RTN","MBAARPCL",100,0)
 .S ACCESS=$G(ARRAY(403.5,XX_",",2,"I")),TESTAPP=$G(ARRAY(403.5,XX_",",3,"I")),PROVIDER=$G(ARRAY(403.5,XX_",",4,"I")),RECALLDT=$G(ARRAY(403.5,XX_",",5,"I"))
"RTN","MBAARPCL",101,0)
 .S COMMENT=$G(ARRAY(403.5,XX_",",2.5,"I")),FASTNON=$G(ARRAY(403.5,XX_",",2.6,"I")),APPTLEN=$G(ARRAY(403.5,XX_",",4.7,"I"))
"RTN","MBAARPCL",102,0)
 .S REMINDDT=$G(ARRAY(403.5,XX_",",6,"I")),USER=$G(ARRAY(403.5,XX_",",7,"I")),PATRECDT=$G(ARRAY(403.5,XX_",",5.5,"I")),SECPRT=$G(ARRAY(403.5,XX_",",8,"I"))
"RTN","MBAARPCL",103,0)
 .S RESULTS(CNT)=$G(DFN)_U_$G(CIEN)_U_$G(ACCESS)_U_$G(TESTAPP)_U_$G(PROVIDER)_U_$G(RECALLDT)_U_$G(COMMENT)_U_$G(FASTNON)_U_$G(APPTLEN)_U_$G(REMINDDT)_U_$G(USER)_U_$G(PATRECDT)_U_$G(SECPRT)_U_$G(LNAME)_U_$G(SSN)_U_$G(CLINIC)
"RTN","MBAARPCL",104,0)
 .;S RESULTS(CNT)=$G(^SD(403.5,XX,0))
"RTN","MBAARPCL",105,0)
 .;S:$P(RESULTS(CNT),"^",13)="" RESULTS(CNT)=$G(RESULTS(CNT))_"^"
"RTN","MBAARPCL",106,0)
 .S CNT=CNT+1
"RTN","MBAARPCL",107,0)
 .D KVA^VADPT
"RTN","MBAARPCL",108,0)
 K XDT,XX,CNT
"RTN","MBAARPCL",109,0)
 K DFN,LNAME,SSN,CLINIC,VA("PID"),VA("BID"),CIEN,NODE,ACCESS,COMMENT,USER,TESTAPP,FASTNON,PATRECDT,PROVIDER,APPTLEN,SCEPRT,RECALLDT,REMINDDT
"RTN","MBAARPCL",110,0)
 Q
"RTN","MBAARPCL",111,0)
NEARLST(RESULTS) ;Gets the NEAR List for a Facility MBAA RPC: MBAA FACILITY NEAR LIST
"RTN","MBAARPCL",112,0)
 ;  No input parameters required
"RTN","MBAARPCL",113,0)
 ;  Output: TMP($J,"NEAR")=DFN^PATIENTNAME^SSN^ELIGIBILITY CODE INTERNAL^ELIGIBILITY CODE EXTERNAL^HOME PHONE^CELL PHONE^DATE^SITE
"RTN","MBAARPCL",114,0)
 ;    DFN = PATIENT ID
"RTN","MBAARPCL",115,0)
 ;    PATIENTNAME = PATIENT NAME
"RTN","MBAARPCL",116,0)
 ;    SSN = LAST FOUR OF SSN
"RTN","MBAARPCL",117,0)
 ;    ELIGIBILITY CODE INTERNAL = INTERNAL ELIGIBILITY CODE
"RTN","MBAARPCL",118,0)
 ;    ELIGIBILITY CODE EXTERNAL = EXTERNAL ELIGIBILITY CODE
"RTN","MBAARPCL",119,0)
 ;    HOME PHONE
"RTN","MBAARPCL",120,0)
 ;    CELL PHONE
"RTN","MBAARPCL",121,0)
 ;    DATE = APPOINTMENT DATE REQUESTED
"RTN","MBAARPCL",122,0)
 ;    SITE = FACILITY ID
"RTN","MBAARPCL",123,0)
 ;-Build temp global
"RTN","MBAARPCL",124,0)
 K ^TMP($J,"NEAR")
"RTN","MBAARPCL",125,0)
 N DFNIEN,DGSITE,PNAME,SSN,ELIG,PHONE,CELL,DFN
"RTN","MBAARPCL",126,0)
 S DGSITE=+$$SITE^VASITE()  ;ICR#: 10112 VASITE
"RTN","MBAARPCL",127,0)
 S (CNT,DFNIEN)=0 F  S DFNIEN=$O(^DPT("AEAR",1,DFNIEN)) Q:'DFNIEN  D  ;ICR#: 6053 DPT
"RTN","MBAARPCL",128,0)
 .I $$GET1^DIQ(2,DFNIEN,1010.159,"I") D
"RTN","MBAARPCL",129,0)
 .Q:$P($G(^DPT(DFNIEN,1010.16)),"^",1)'=""  ;ICR#: 6053 DPT
"RTN","MBAARPCL",130,0)
 .S DFN=DFNIEN D DEM^VADPT,ELIG^VADPT,ADD^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",131,0)
 .S CNT=CNT+1
"RTN","MBAARPCL",132,0)
 .;T13 Change to get cell phone using FM read
"RTN","MBAARPCL",133,0)
 .;S PNAME=VADM(1),SSN=+VADM(2),ELIG=VAEL(1),PHONE=VAPA(8),CELL=$P($G(^DPT(DFNIEN,.13)),"^",4)  ;ICR#: 6053 DPT
"RTN","MBAARPCL",134,0)
 .S PNAME=VADM(1),SSN=+VADM(2),ELIG=VAEL(1),PHONE=VAPA(8),CELL=$$GET1^DIQ(2,100841,.01,"I")  ;ICR#: 6053 DPT
"RTN","MBAARPCL",135,0)
 .I $G(ELIG)="" S ELIG="^"
"RTN","MBAARPCL",136,0)
 .S ^TMP($J,"NEAR",CNT)=DFNIEN_"^"_$G(PNAME)_"^"_$G(SSN)_"^"_$G(ELIG)_"^"_$G(PHONE)_"^"_$G(CELL)_"^"_$$GET1^DIQ(2,DFNIEN,1010.1511,"I")_"^"_DGSITE_$C(10)
"RTN","MBAARPCL",137,0)
 .K PNAME,DFN,SSN,ELIG,PHONE,CELL
"RTN","MBAARPCL",138,0)
 .D KVA^VADPT
"RTN","MBAARPCL",139,0)
 S RESULTS=$NA(^TMP($J,"NEAR"))
"RTN","MBAARPCL",140,0)
 K DFN,VADM,VAEL,VAPA,VA("BID"),VA("PID"),VACNTRY,VAERR
"RTN","MBAARPCL",141,0)
 Q
"RTN","MBAARPCL",142,0)
 ;
"RTN","MBAARPCL",143,0)
NEARDFN(RESULTS,DFN) ;Gets the NEAR List for a PATIENT MBAA RPC: MBAA PATIENT NEAR LIST
"RTN","MBAARPCL",144,0)
 ;  INPUT: Patient DFN
"RTN","MBAARPCL",145,0)
 ;  Output:
"RTN","MBAARPCL",146,0)
 ;  If the patient is on the NEAR List, returns the array:
"RTN","MBAARPCL",147,0)
 ;    DFN^PATIENTNAME^SSN^ELIGIBILITY CODE INTERNAL^ELIGIBILITY CODE EXTERNAL^HOME PHONE^CELL PHONE^DATE^SITE
"RTN","MBAARPCL",148,0)
 ;    DFN = PATIENT ID
"RTN","MBAARPCL",149,0)
 ;    PATIENTNAME = PATIENT NAME
"RTN","MBAARPCL",150,0)
 ;    SSN = LAST FOUR OF SSN
"RTN","MBAARPCL",151,0)
 ;    ELIGIBILITY CODE INTERNAL = INTERNAL ELIGIBILITY CODE
"RTN","MBAARPCL",152,0)
 ;    ELIGIBILITY CODE EXTERNAL = EXTERNAL ELIGIBILITY CODE
"RTN","MBAARPCL",153,0)
 ;    HOME PHONE
"RTN","MBAARPCL",154,0)
 ;    CELL PHONE
"RTN","MBAARPCL",155,0)
 ;    DATE = APPOINTMENT DATE REQUESTED
"RTN","MBAARPCL",156,0)
 ;    SITE = FACILITY ID
"RTN","MBAARPCL",157,0)
 ;   If the patient is not on the NEAR List returns "1^Patient not on the NEAR List"
"RTN","MBAARPCL",158,0)
 N DGSITE,SSN,ELIG,PHONE,CELL,PNAME
"RTN","MBAARPCL",159,0)
 I $G(DFN)="" S RESULTS(0)="1^DFN IS NOT DEFINED" Q
"RTN","MBAARPCL",160,0)
 S RESULTS(0)=""
"RTN","MBAARPCL",161,0)
 I $$GET1^DIQ(2,DFN,1010.159,"I") D
"RTN","MBAARPCL",162,0)
 .Q:$P($G(^DPT(DFN,1010.16)),"^",1)'=""  ;ICR#: 6053 DPT
"RTN","MBAARPCL",163,0)
 .S DGSITE=+$$SITE^VASITE()
"RTN","MBAARPCL",164,0)
 .D DEM^VADPT,ELIG^VADPT,ADD^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",165,0)
 .;T13 Change to get cell phone using FM read
"RTN","MBAARPCL",166,0)
 .;S PNAME=VADM(1),SSN=+VADM(2),ELIG=VAEL(1),PHONE=VAPA(8),CELL=$P($G(^DPT(DFN,.13)),"^",4)  ;ICR#: 6053 DPT
"RTN","MBAARPCL",167,0)
 .S PNAME=VADM(1),SSN=+VADM(2),ELIG=VAEL(1),PHONE=VAPA(8),CELL=$$GET1^DIQ(2,100841,.01,"I")  ;ICR#: 6053 DPT
"RTN","MBAARPCL",168,0)
 .I $G(ELIG)="" S ELIG="^"
"RTN","MBAARPCL",169,0)
 .S RESULTS(0)=DFN_"^"_$G(PNAME)_"^"_$G(SSN)_"^"_$G(ELIG)_"^"_$G(PHONE)_"^"_$G(CELL)_"^"_$$GET1^DIQ(2,DFN,1010.1511,"I")_"^"_DGSITE
"RTN","MBAARPCL",170,0)
 .D KVA^VADPT
"RTN","MBAARPCL",171,0)
 I RESULTS(0)="" S RESULTS(0)="1^Patient not on the NEAR List"
"RTN","MBAARPCL",172,0)
 K DFN,VADM,VAEL,VAPA,VA("BID"),VA("PID"),VACNTRY,VAERR
"RTN","MBAARPCL",173,0)
 Q
"RTN","MBAARPCL",174,0)
EWL(RESULTS,DFN) ; gets the EWL data by patient as described in the output data MBAA RPC: MBAA WAIT LIST BY DFN
"RTN","MBAARPCL",175,0)
 ;  Input: Patient DFN (PTR to Patient File (#2))
"RTN","MBAARPCL",176,0)
 ;  Outputs if successful - patient is on the EWL:
"RTN","MBAARPCL",177,0)
 ;  $P(1)  = DFN
"RTN","MBAARPCL",178,0)
 ;  $P(2)  = DSS STOP CODE
"RTN","MBAARPCL",179,0)
 ;  $P(3)  = LAST UPDATED (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",180,0)
 ;  $P(4)  = PATIENT NAME
"RTN","MBAARPCL",181,0)
 ;  $P(5)  = PATIENT SSN
"RTN","MBAARPCL",182,0)
 ;  $P(6)  = CLINIC NAME
"RTN","MBAARPCL",183,0)
 ;  $P(7)  = ORIGINATING DATE (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",184,0)
 ;  $P(8)  = DESIRED DATE OF APPOINTMENT
"RTN","MBAARPCL",185,0)
 ;  $P(9)  = DAYS ON EWL
"RTN","MBAARPCL",186,0)
 ;  $P(10) = DATE REMOVED FROM EWL (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",187,0)
 ;  $P(11) = PATIENT ZIP CODE
"RTN","MBAARPCL",188,0)
 ;  $P(12) = SERVICE CONNECTED %
"RTN","MBAARPCL",189,0)
 ;  $P(13) = ENROLLEE STATUS
"RTN","MBAARPCL",190,0)
 ;  $P(14) = PRIORITY
"RTN","MBAARPCL",191,0)
 ;  $P(15) = CLINIC ID
"RTN","MBAARPCL",192,0)
 ;  $P(16) = IEN FROM SDWL(409.3 FOR THE ENTRY
"RTN","MBAARPCL",193,0)
 ;
"RTN","MBAARPCL",194,0)
 ;  If patient is not on the EWL, returns
"RTN","MBAARPCL",195,0)
 ;  RESULTS(0)="1^PATIENT NOT ON THE EWL."
"RTN","MBAARPCL",196,0)
 ;
"RTN","MBAARPCL",197,0)
 I $G(DFN)="" S RESULTS(0)="1^DFN IS NOT DEFINED" Q
"RTN","MBAARPCL",198,0)
 I '$D(^SDWL(409.3,"B",DFN)) S RESULTS(0)="1^PATIENT NOT ON THE EWL" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",199,0)
 S REC=0,CNT=1 F  S REC=$O(^SDWL(409.3,"B",DFN,REC)) Q:REC'>0  D  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",200,0)
 .;T13 Change to use FM reads
"RTN","MBAARPCL",201,0)
 .;S NODE=$G(^SDWL(409.3,REC,0))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",202,0)
 .;Q:$G(NODE)=""
"RTN","MBAARPCL",203,0)
 .;I $P($G(NODE),"^",17)="C" S RESULTS(0)="1^PATIENT NOT ON THE EWL" Q
"RTN","MBAARPCL",204,0)
 .;I $P($G(NODE),"^",17)="O" S RESULTS(0)="" 
"RTN","MBAARPCL",205,0)
 .I $$GET1^DIQ(409.3,REC,23,"I")="C" S RESULTS(0)="1^PATIENT NOT ON THE EWL" Q
"RTN","MBAARPCL",206,0)
 .I $$GET1^DIQ(409.3,REC,23,"I")="O" S RESULTS(0)=""
"RTN","MBAARPCL",207,0)
 .N SDWL1
"RTN","MBAARPCL",208,0)
 .D GETS^DIQ(409.3,REC_",","1;8;10;13.1;14;22;23;27","IE","SDWL1")
"RTN","MBAARPCL",209,0)
 .D NOW^%DTC,DEM^VADPT,ADD^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",210,0)
 .S (ORIGDT,LASTUPDT)=$G(SDWL1(409.3,REC_",",1,"I")),DAYSON=$$FMDIFF^XLFDT(%,ORIGDT,1)  ;ICR#: 10103 XLFDT
"RTN","MBAARPCL",211,0)
 .;S (ORIGDT,LASTUPDT)=$P(NODE,"^",2),DAYSON=$$FMDIFF^XLFDT(%,ORIGDT,1)  ;ICR#: 10103 XLFDT
"RTN","MBAARPCL",212,0)
 .S PTNAME=$G(VADM(1))  ;,LASTNAME=$P(PTNAME,",")
"RTN","MBAARPCL",213,0)
 .S SSN=$P($G(VADM(2)),"^",2),ZIP=$G(VAPA(6))
"RTN","MBAARPCL",214,0)
 .S DESIRED=$G(SDWL1(409.3,REC_",",22,"I")),CLINIEN=$G(SDWL1(409.3,REC_",",8,"I"))
"RTN","MBAARPCL",215,0)
 .;S DESIRED=$P(NODE,"^",16),CLINIEN=$P(NODE,"^",9)
"RTN","MBAARPCL",216,0)
 .I $G(CLINIEN)'="" D
"RTN","MBAARPCL",217,0)
 ..S PTR=$$GET1^DIQ(409.32,CLINIEN_",",".01","I")  ;ICR#: 6047 SDWL(409.32
"RTN","MBAARPCL",218,0)
 ..K CLIN1 D GETS^DIQ(44,PTR_",",".01;8","IE","CLIN1") S CLINNAME=$G(CLIN1(44,PTR_",",.01,"E")),STPCODE=$G(CLIN1(44,PTR_",",8,"E"))
"RTN","MBAARPCL",219,0)
 .;S SC=$P($G(^SDWL(409.3,REC,"SC")),"^",1),PRIOR=$P(NODE,"^",11),ENRSTAT1=$P(NODE,"^",20)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",220,0)
 .S SC=$G(SDWL1(409.3,REC_",",14,"E")),PRIOR1=$G(SDWL1(409.3,REC_",",10,"E")),ENRSTAT=$G(SDWL1(409.3,REC_",",27,"E"))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",221,0)
 .;S DTREMOVE=$P($G(^SDWL(409.3,REC,"SDAPT")),"^",1)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",222,0)
 .S DTREMOVE=$G(SDWL1(409.3,REC_",",13.1,"I"))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",223,0)
 .;I ENRSTAT1'="" S ENRSTAT=$S(ENRSTAT1="N":"NEW",ENRSTAT1="E":"ESTABLISHED",ENRSTAT1="P":"PRIOR",ENRSTAT1="U":"UNDETERMINED",1:"UNKNOWN")
"RTN","MBAARPCL",224,0)
 .;I PRIOR'="" S PRIOR1=$S(PRIOR="A":"ASAP",PRIOR="F":"FUTURE",1:0)
"RTN","MBAARPCL",225,0)
 .S RESULTS(CNT)=DFN_U_$G(STPCODE)_U_$G(LASTUPDT)_U_$G(PTNAME)_U_$G(SSN)_U_$G(CLINNAME)_U_$G(ORIGDT)_U_$G(DESIRED)_U_$G(DAYSON)_U_$G(DTREMOVE)_U_$G(ZIP)_U_$G(SC)_U_$G(ENRSTAT)_U_$G(PRIOR1)_U_$G(CLINIEN)_U_$G(REC),CNT=CNT+1
"RTN","MBAARPCL",226,0)
 .D KVA^VADPT
"RTN","MBAARPCL",227,0)
 .K NODE,%,ORIGDT,LASTUPDT,DAYSON,PTNAME,LASTNAME,SSN
"RTN","MBAARPCL",228,0)
 .K DESIRED,CLINIEN,PTR,CLINNAME,STOPPTR,STPCODE,PRIOR,ENRSTAT,SC,ENRSTAT1,PRIOR1,DTREMOVE,ZIP,CLIN1,SDWL1
"RTN","MBAARPCL",229,0)
 K REC,CNT,REC,DFN
"RTN","MBAARPCL",230,0)
 Q
"RTN","MBAARPCL",231,0)
FACEWL(RESULTS) ; gets the EWL data for a facility as described in the output data MBAA RPC: MBAA FACILITY WAIT LIST
"RTN","MBAARPCL",232,0)
 ;  Outputs if successful - patient is on the EWL:
"RTN","MBAARPCL",233,0)
 ;  $P(1)  = DFN
"RTN","MBAARPCL",234,0)
 ;  $P(2)  = DSS STOP CODE
"RTN","MBAARPCL",235,0)
 ;  $P(3)  = LAST UPDATED (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",236,0)
 ;  $P(4)  = PATIENT NAME
"RTN","MBAARPCL",237,0)
 ;  $P(5)  = PATIENT SSN
"RTN","MBAARPCL",238,0)
 ;  $P(6)  = CLINIC NAME
"RTN","MBAARPCL",239,0)
 ;  $P(7)  = ORIGINATING DATE (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",240,0)
 ;  $P(8)  = DESIRED DATE OF APPOINTMENT
"RTN","MBAARPCL",241,0)
 ;  $P(9)  = DAYS ON EWL
"RTN","MBAARPCL",242,0)
 ;  $P(10) = DATE REMOVED FROM EWL (RETURNED IN FILEMAN FORMAT)
"RTN","MBAARPCL",243,0)
 ;  $P(11) = PATIENT ZIP CODE
"RTN","MBAARPCL",244,0)
 ;  $P(12) = SERVICE CONNECTED %
"RTN","MBAARPCL",245,0)
 ;  $P(13) = ENROLLEE STATUS
"RTN","MBAARPCL",246,0)
 ;  $P(14) = PRIORITY
"RTN","MBAARPCL",247,0)
 ;  $P(15) = CLINIC ID
"RTN","MBAARPCL",248,0)
 ;  $P(16) = IEN FROM SDWL(409.3 FOR THE ENTRY
"RTN","MBAARPCL",249,0)
 ;
"RTN","MBAARPCL",250,0)
 ;  If no patients are not on the EWL, returns
"RTN","MBAARPCL",251,0)
 ;  RESULTS(0)="1^EWL is empty."
"RTN","MBAARPCL",252,0)
 ;
"RTN","MBAARPCL",253,0)
 I '$D(^SDWL(409.3,"B")) S RESULTS(0)="1^EWL is empty." Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",254,0)
 S REC=0,CNT=0,DFN=0 F  S DFN=$O(^SDWL(409.3,"B",DFN)) Q:DFN'>0  F  S REC=$O(^SDWL(409.3,"B",DFN,REC)) Q:REC'>0  D  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",255,0)
 .;T13 Change to use FM reads
"RTN","MBAARPCL",256,0)
 .;S NODE=$G(^SDWL(409.3,REC,0))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",257,0)
 .;Q:$G(NODE)=""
"RTN","MBAARPCL",258,0)
 .;I $P($G(NODE),"^",17)="C" S RESULTS(0)="1^PATIENT NOT ON THE EWL" Q
"RTN","MBAARPCL",259,0)
 .;I $P($G(NODE),"^",17)="O" S RESULTS(0)="" 
"RTN","MBAARPCL",260,0)
 .;I $$GET1^DIQ(409.3,REC,23,"I")="C" S RESULTS(0)="1^PATIENT NOT ON THE EWL" Q
"RTN","MBAARPCL",261,0)
 .;I $$GET1^DIQ(409.3,REC,23,"I")="O" S RESULTS(0)=""
"RTN","MBAARPCL",262,0)
 .Q:$$GET1^DIQ(409.3,REC,23,"I")="C"
"RTN","MBAARPCL",263,0)
 .N SDWL1
"RTN","MBAARPCL",264,0)
 .K SEWL1 D GETS^DIQ(409.3,REC_",","1;8;10;13.1;14;22;23;27","IE","SDWL1")
"RTN","MBAARPCL",265,0)
 .D NOW^%DTC,DEM^VADPT,ADD^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",266,0)
 .S (ORIGDT,LASTUPDT)=$G(SDWL1(409.3,REC_",",1,"I")),DAYSON=$$FMDIFF^XLFDT(%,ORIGDT,1)  ;ICR#: 10103 XLFDT
"RTN","MBAARPCL",267,0)
 .;S (ORIGDT,LASTUPDT)=$P(NODE,"^",2),DAYSON=$$FMDIFF^XLFDT(%,ORIGDT,1)  ;ICR#: 10103 XLFDT
"RTN","MBAARPCL",268,0)
 .S PTNAME=$G(VADM(1))  ;,LASTNAME=$P(PTNAME,",")
"RTN","MBAARPCL",269,0)
 .S SSN=$P($G(VADM(2)),"^",2),ZIP=$G(VAPA(6))
"RTN","MBAARPCL",270,0)
 .S DESIRED=$G(SDWL1(409.3,REC_",",22,"I")),CLINIEN=$G(SDWL1(409.3,REC_",",8,"I"))
"RTN","MBAARPCL",271,0)
 .;S DESIRED=$P(NODE,"^",16),CLINIEN=$P(NODE,"^",9)
"RTN","MBAARPCL",272,0)
 .I $G(CLINIEN)'="" D
"RTN","MBAARPCL",273,0)
 ..S PTR=$$GET1^DIQ(409.32,CLINIEN_",",".01","I")  ;ICR#: 6047 SDWL(409.32
"RTN","MBAARPCL",274,0)
 ..K CLIN1 D GETS^DIQ(44,PTR_",",".01;8","IE","CLIN1") S CLINNAME=$G(CLIN1(44,PTR_",",.01,"E")),STPCODE=$G(CLIN1(44,PTR_",",8,"E"))
"RTN","MBAARPCL",275,0)
 .S SC=$G(SDWL1(409.3,REC_",",14,"E")),PRIOR1=$G(SDWL1(409.3,REC_",",10,"E")),ENRSTAT=$G(SDWL1(409.3,REC_",",27,"E"))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",276,0)
 .;S DTREMOVE=$P($G(^SDWL(409.3,REC,"SDAPT")),"^",1)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",277,0)
 .S DTREMOVE=$G(SDWL1(409.3,REC_",",13.1,"I"))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",278,0)
 .;I ENRSTAT1'="" S ENRSTAT=$S(ENRSTAT1="N":"NEW",ENRSTAT1="E":"ESTABLISHED",ENRSTAT1="P":"PRIOR",ENRSTAT1="U":"UNDETERMINED",1:"UNKNOWN")
"RTN","MBAARPCL",279,0)
 .;I PRIOR'="" S PRIOR1=$S(PRIOR="A":"ASAP",PRIOR="F":"FUTURE",1:0)
"RTN","MBAARPCL",280,0)
 .;S NODE=$G(^SDWL(409.3,REC,0))  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",281,0)
 .;Q:$G(NODE)=""
"RTN","MBAARPCL",282,0)
 .;Q:$P($G(NODE),"^",17)="C"
"RTN","MBAARPCL",283,0)
 .;D NOW^%DTC,DEM^VADPT,ADD^VADPT  ;ICR#: 10061 VADPT
"RTN","MBAARPCL",284,0)
 .;S (ORIGDT,LASTUPDT)=$P(NODE,"^",2),DAYSON=$$FMDIFF^XLFDT(%,ORIGDT,1)  ;ICR#: 10103 XLFDT
"RTN","MBAARPCL",285,0)
 .;S PTNAME=$G(VADM(1)) ;,LASTNAME=$P(PTNAME,",")
"RTN","MBAARPCL",286,0)
 .;S SSN=$P($G(VADM(2)),"^",2),ZIP=$G(VAPA(6))
"RTN","MBAARPCL",287,0)
 .;S DESIRED=$P(NODE,"^",16),CLINIEN=$P(NODE,"^",9)
"RTN","MBAARPCL",288,0)
 .;I $G(CLINIEN)'="" D
"RTN","MBAARPCL",289,0)
 .;S SC=$P($G(^SDWL(409.3,REC,"SC")),"^",1),PRIOR=$P(NODE,"^",11),ENRSTAT1=$P(NODE,"^",20)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",290,0)
 .;S DTREMOVE=$P($G(^SDWL(409.3,REC,"SDAPT")),"^",1)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPCL",291,0)
 .;I ENRSTAT1'="" S ENRSTAT=$S(ENRSTAT1="N":"NEW",ENRSTAT1="E":"ESTABLISHED",ENRSTAT1="P":"PRIOR",ENRSTAT1="U":"UNDETERMINED",1:"UNKNOWN")
"RTN","MBAARPCL",292,0)
 .;I PRIOR'="" S PRIOR1=$S(PRIOR="A":"ASAP",PRIOR="F":"FUTURE",1:0)
"RTN","MBAARPCL",293,0)
 .S RESULTS(CNT)=DFN_U_$G(STPCODE)_U_$G(LASTUPDT)_U_$G(PTNAME)_U_$G(SSN)_U_$G(CLINNAME)_U_$G(ORIGDT)_U_$G(DESIRED)_U_$G(DAYSON)_U_$G(DTREMOVE)_U_$G(ZIP)_U_$G(SC)_U_$G(ENRSTAT)_U_$G(PRIOR1)_U_$G(CLINIEN)_U_$G(REC),CNT=CNT+1
"RTN","MBAARPCL",294,0)
 .D KVA^VADPT
"RTN","MBAARPCL",295,0)
 .K NODE,%,ORIGDT,LASTUPDT,DAYSON,PTNAME,LASTNAME,SSN
"RTN","MBAARPCL",296,0)
 .K DESIRED,CLINIEN,PTR,CLINNAME,STOPPTR,STPCODE,PRIOR,ENRSTAT,SC,ENRSTAT1,PRIOR1
"RTN","MBAARPCL",297,0)
 K REC,CNT,REC,DFN
"RTN","MBAARPCL",298,0)
 Q
"RTN","MBAARPCL",299,0)
EDITNEAR(RESULTS,DFN,STATUS,COMM) ;Edit a patient on the NEAR List MBAA RPC: MBAA UPDATE NEAR LIST
"RTN","MBAARPCL",300,0)
 ;Called by the RPC ZSD EDIT NEAR
"RTN","MBAARPCL",301,0)
 ;Input: 
"RTN","MBAARPCL",302,0)
 ;  DFN         = Patient DFN
"RTN","MBAARPCL",303,0)
 ;  STATUS      = Set of codes:
"RTN","MBAARPCL",304,0)
 ;                  C = Cancelled
"RTN","MBAARPCL",305,0)
 ;                  E = EWL - Moved to the EWL
"RTN","MBAARPCL",306,0)
 ;                  F = Filled
"RTN","MBAARPCL",307,0)
 ;                  I = In Process/Veteran Contacted
"RTN","MBAARPCL",308,0)
 ;  COMM        = Comments. Required if the status is cancelled, otherwise it is optional
"RTN","MBAARPCL",309,0)
 ;Output: RESULTS(0)="0^Patient NEAR List entry updated." if the update was successful
"RTN","MBAARPCL",310,0)
 ;        RESULTS(0)="1^Patient is not on the NEAR List."
"RTN","MBAARPCL",311,0)
 ;        RESULTS(0)="1^DFN was not provided."
"RTN","MBAARPCL",312,0)
 ;        RESULTS(0)="1^Status is null. Status is a required field."
"RTN","MBAARPCL",313,0)
 ;        RESULTS(0)="1^Could not update the record."
"RTN","MBAARPCL",314,0)
 ;        RESULTS(0)="1^Patient record is locked, try again later."
"RTN","MBAARPCL",315,0)
 S RESULTS(0)=""
"RTN","MBAARPCL",316,0)
 I $G(DFN)="" S RESULTS(0)="1^DFN was not provided." Q
"RTN","MBAARPCL",317,0)
 I $G(STATUS)="" S RESULTS(0)="1^Status is null. Status is a required field." Q
"RTN","MBAARPCL",318,0)
 I $D(^DPT(DFN,1010.16)) D  ;ICR#: 6053 DPT
"RTN","MBAARPCL",319,0)
 .I $P(^DPT(DFN,1010.16),U,1)'="" S ERR=1  ;ICR#: 6053 DPT
"RTN","MBAARPCL",320,0)
 I $G(ERR)=1 S RESULTS(0)="1^Patient is not on the NEAR List." Q
"RTN","MBAARPCL",321,0)
 I '$$GET1^DIQ(2,DFN,1010.159,"I") S RESULTS(0)="1^Patient is not on the NEAR List." Q
"RTN","MBAARPCL",322,0)
 D NOW^%DTC
"RTN","MBAARPCL",323,0)
 L +^DPT(DFN):10 I '$TEST S ERR=1,RESULTS(0)="1^Patient record is locked, try again later." Q  ;ICR#: 6053 DPT
"RTN","MBAARPCL",324,0)
 S DA=DFN,DIE="^DPT(",DR="1010.161///"_$G(STATUS)_";1010.163///"_$G(COMM) D ^DIE
"RTN","MBAARPCL",325,0)
 L -^DPT(DFN)  ;ICR#: 6053 DPT
"RTN","MBAARPCL",326,0)
 K DA,DIE,DR
"RTN","MBAARPCL",327,0)
 ;I $P($G(^DPT(DFN,1010.16)),"^")='$G(STATUS) S ERR=1
"RTN","MBAARPCL",328,0)
 ;I $P($G(^DPT(DFN,1010.16)),"^",2)'=% S ERR=1
"RTN","MBAARPCL",329,0)
 I $P($G(^DPT(DFN,1010.16)),"^")=$G(STATUS) S RESULTS(0)="0^Patient removed from NEAR List."  ;ICR#: 6053 DPT
"RTN","MBAARPCL",330,0)
 ;I $G(ERR)=1 S RESULTS(0)="1^Could not update the record." Q
"RTN","MBAARPCL",331,0)
 S RESULTS(0)="0^Patient NEAR List entry updated."
"RTN","MBAARPCL",332,0)
 Q
"RTN","MBAAWLAP")
0^22^B8952366^n/a
"RTN","MBAAWLAP",1,0)
MBAAWLAP ;OIT-PD/CBR - WAIT LIST API ;02/13/2015
"RTN","MBAAWLAP",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAWLAP",3,0)
 ;
"RTN","MBAAWLAP",4,0)
 ;Associated ICRs:
"RTN","MBAAWLAP",5,0)
 ;  ICR#
"RTN","MBAAWLAP",6,0)
 ;  6051 MBAA SDWLE6 API
"RTN","MBAAWLAP",7,0)
 ;
"RTN","MBAAWLAP",8,0)
LOCK(RETURN,IEN) ;LOCK ^SDWL GLOBAL MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLAP",9,0)
 S RETURN=0
"RTN","MBAAWLAP",10,0)
 I '+$G(IEN) D  Q 0
"RTN","MBAAWLAP",11,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","IEN")
"RTN","MBAAWLAP",12,0)
 S RETURN=$$LOCK^MBAAWLDA(IEN)
"RTN","MBAAWLAP",13,0)
 Q:RETURN 1
"RTN","MBAAWLAP",14,0)
 D ERRX^MBAAAPIE(.RETURN,"FILELOCK")
"RTN","MBAAWLAP",15,0)
 Q 0
"RTN","MBAAWLAP",16,0)
 ;
"RTN","MBAAWLAP",17,0)
UNLOCK(IEN) ; MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLAP",18,0)
 Q:'+$G(IEN) 0
"RTN","MBAAWLAP",19,0)
 Q $$UNLOCK^MBAAWLDA(IEN)
"RTN","MBAAWLAP",20,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAWLAP",21,0)
 ;HASENTRY(RETURN,DFN) ;PATIENT HAS EWL ENTRIES?
"RTN","MBAAWLAP",22,0)
 ; S RETURN=0
"RTN","MBAAWLAP",23,0)
 ; I '+$G(DFN) D  Q 0
"RTN","MBAAWLAP",24,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","DFN")
"RTN","MBAAWLAP",25,0)
 ; S RETURN=$$HASENTRY^MBAAWLDA(DFN)
"RTN","MBAAWLAP",26,0)
 ; Q 1
"RTN","MBAAWLAP",27,0)
 ; ;
"RTN","MBAAWLAP",28,0)
 ;LIST(RETURN,DFN,STATUS,BEGIN,END) ;LIST PATIENT EWL ENTRIES
"RTN","MBAAWLAP",29,0)
 ; N PATOK
"RTN","MBAAWLAP",30,0)
 ; S RETURN=0
"RTN","MBAAWLAP",31,0)
 ; I '+$G(DFN) D  Q 0
"RTN","MBAAWLAP",32,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","DFN")
"RTN","MBAAWLAP",33,0)
 ; I '$$HASENTRY(.PATOK,DFN)!'PATOK D  Q 0
"RTN","MBAAWLAP",34,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"PATNFND")
"RTN","MBAAWLAP",35,0)
 ; S STATUS=$E($G(STATUS))
"RTN","MBAAWLAP",36,0)
 ; S BEGIN=$G(BEGIN)
"RTN","MBAAWLAP",37,0)
 ; S END=$G(END)
"RTN","MBAAWLAP",38,0)
 ; D LIST^MBAAWLDA(.RETURN,DFN,STATUS,BEGIN,END)
"RTN","MBAAWLAP",39,0)
 ; Q 1
"RTN","MBAAWLAP",40,0)
 ;
"RTN","MBAAWLAP",41,0)
DETAIL(RETURN,IEN) ; MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLAP",42,0)
 I '+$G(IEN) D  Q 0
"RTN","MBAAWLAP",43,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","IEN")
"RTN","MBAAWLAP",44,0)
 K RETURN
"RTN","MBAAWLAP",45,0)
 D DETAIL^MBAAWLDA(.RETURN,IEN)
"RTN","MBAAWLAP",46,0)
 Q 1
"RTN","MBAAWLAP",47,0)
 ;
"RTN","MBAAWLAP",48,0)
 ;TRNDET(RETURN,SDWLIEN) ; Get transfer details for Electronic Wait List internal entry number
"RTN","MBAAWLAP",49,0)
 ; ; Input:   SDWLIEN:   EWL IEN
"RTN","MBAAWLAP",50,0)
 ; ; Output:  RETURN("ACTIVE"): 0: no active transfer, 1: active transfer
"RTN","MBAAWLAP",51,0)
 ; ;          RETURN("INSTITUTION"): Institution name
"RTN","MBAAWLAP",52,0)
 ; ;          RETURN("STATION"):  Station Number
"RTN","MBAAWLAP",53,0)
 ; N HASENTRY
"RTN","MBAAWLAP",54,0)
 ; S RETURN("ACTIVE")=0
"RTN","MBAAWLAP",55,0)
 ; I '+$G(SDWLIEN) D  Q 0
"RTN","MBAAWLAP",56,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","MBAAWLAP",57,0)
 ; I '$$TRFRQACT^MBAAWLDA(SDWLIEN) Q 1
"RTN","MBAAWLAP",58,0)
 ; S RETURN("ACTIVE")=1
"RTN","MBAAWLAP",59,0)
 ; Q $$TRFRQDET^MBAAWLDA(.RETURN,SDWLIEN)
"RTN","MBAAWLAP",60,0)
 ; Q 1
"RTN","MBAAWLAP",61,0)
 ;
"RTN","MBAAWLAP",62,0)
DISP(RETURN,SDWLDFN,SDWLIEN,SDWLDISP,SDWLAPPT) ;UPDATE DISPOSITION MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLAP",63,0)
 N DA,DIE,SDWLDUZ
"RTN","MBAAWLAP",64,0)
 S RETURN=0
"RTN","MBAAWLAP",65,0)
 I '+$G(SDWLIEN) D  Q 0
"RTN","MBAAWLAP",66,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","MBAAWLAP",67,0)
 I ($G(SDWLDISP)="")!("^D^NC^SA^CC^NN^ER^TR^CL^"'["^"_$G(SDWLDISP)) D  Q 0
"RTN","MBAAWLAP",68,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLDISP")
"RTN","MBAAWLAP",69,0)
 S RETURN=$$DISP^MBAAWLDA(SDWLDFN,SDWLIEN,SDWLDISP,.SDWLAPPT)
"RTN","MBAAWLAP",70,0)
 ;; OG ; SD*5.3*446 Inter-facility transfer.
"RTN","MBAAWLAP",71,0)
 ;; OG ; SD*5.3*446 Inter-facility transfer.
"RTN","MBAAWLAP",72,0)
 Q RETURN
"RTN","MBAAWLAP",73,0)
 ;
"RTN","MBAAWLAP",74,0)
NEW(RETURN,SDWLD) ;CREATE NEW EWL ENTRY MBAA RPC: MBAA EWL NEW
"RTN","MBAAWLAP",75,0)
 ;RETURN: RETURNS NEW ENTRY IEN
"RTN","MBAAWLAP",76,0)
 N PAT,TYP
"RTN","MBAAWLAP",77,0)
 K RETURN
"RTN","MBAAWLAP",78,0)
 S RETURN=0
"RTN","MBAAWLAP",79,0)
 I '$D(SDWLD) D  Q 0
"RTN","MBAAWLAP",80,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","MBAAWLAP",81,0)
 I +$G(SDWLD("PATIENT"))'>0 D  Q 0
"RTN","MBAAWLAP",82,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","PATIENT")
"RTN","MBAAWLAP",83,0)
 I '$$PATDET^MBAALEXT(.PAT,+SDWLD("PATIENT")) D  Q 0
"RTN","MBAAWLAP",84,0)
 . D ERRX^MBAAAPIE(.RETURN,"PATNFND")
"RTN","MBAAWLAP",85,0)
 I +$G(SDWLD("INSTITUTION"))'>0 D  Q 0
"RTN","MBAAWLAP",86,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","INSTITUTION")
"RTN","MBAAWLAP",87,0)
 S TYP=+$G(SDWLD("WLTYPE"))
"RTN","MBAAWLAP",88,0)
 I TYP'>0,TYP'<5  D  Q 0
"RTN","MBAAWLAP",89,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","WLTYPE")
"RTN","MBAAWLAP",90,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("PRIORITY")) D  Q 0
"RTN","MBAAWLAP",91,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","PRIORITY")
"RTN","MBAAWLAP",92,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("REQBY")) D  Q 0
"RTN","MBAAWLAP",93,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","REQBY")
"RTN","MBAAWLAP",94,0)
 I (TYP=3)!(TYP=4),'$D(SDWLD("DSRDDT")) D  Q 0
"RTN","MBAAWLAP",95,0)
 . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","DSRDDT")
"RTN","MBAAWLAP",96,0)
 Q $$NEW^MBAAWLDA(.RETURN,.SDWLD)
"RTN","MBAAWLAP",97,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAWLAP",98,0)
 ;UPDATE(RETURN,SDWLIEN,SDWLD) ;
"RTN","MBAAWLAP",99,0)
 ; K RETURN
"RTN","MBAAWLAP",100,0)
 ; S RETURN=0
"RTN","MBAAWLAP",101,0)
 ; I +$G(SDWLIEN)'>0 D  Q 0
"RTN","MBAAWLAP",102,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","MBAAWLAP",103,0)
 ; I '+$D(SDWLD) D  Q 0
"RTN","MBAAWLAP",104,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","MBAAWLAP",105,0)
 ; Q $$UPDATE^MBAAWLDA(.RETURN,SDWLIEN,.SDWLD)
"RTN","MBAAWLAP",106,0)
 ; ;
"RTN","MBAAWLAP",107,0)
 ;DELETE(RETURN,SDWLIEN) ;DELETE EWL ENTRY
"RTN","MBAAWLAP",108,0)
 ; K RETURN
"RTN","MBAAWLAP",109,0)
 ; S RETURN=0
"RTN","MBAAWLAP",110,0)
 ; I +$G(SDWLIEN)'>0 D  Q 0
"RTN","MBAAWLAP",111,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","MBAAWLAP",112,0)
 ; Q $$DELETE^MBAAWLDA(.RETURN,SDWLIEN)
"RTN","MBAAWLAP",113,0)
 ; ;
"RTN","MBAAWLDA")
0^24^B38800212^n/a
"RTN","MBAAWLDA",1,0)
MBAAWLDA ;OIT-PD/CBR - WAIT LIST API ;02/13/2015
"RTN","MBAAWLDA",2,0)
 ;;1.0;Scheduling Calendar View;**1**;Aug 27, 2014;Build 85
"RTN","MBAAWLDA",3,0)
 ;
"RTN","MBAAWLDA",4,0)
 ;Associated ICRs:
"RTN","MBAAWLDA",5,0)
 ;  ICR#
"RTN","MBAAWLDA",6,0)
 ;  6046 SDWL(409.3
"RTN","MBAAWLDA",7,0)
 ;  10103 XLFDT
"RTN","MBAAWLDA",8,0)
 ;
"RTN","MBAAWLDA",9,0)
 ;Code below is scheduled for a future release of MBAA
"RTN","MBAAWLDA",10,0)
LOCK(IEN,TIMEOUT) ;LOCK ^SDWL MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLDA",11,0)
 L +^SDWL(409.3,IEN):$G(TIMEOUT,5)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAAWLDA",12,0)
 Q $T
"RTN","MBAAWLDA",13,0)
 ;
"RTN","MBAAWLDA",14,0)
UNLOCK(IEN) ; MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLDA",15,0)
 L -^SDWL(409.3,IEN)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAAWLDA",16,0)
 Q 1
"RTN","MBAAWLDA",17,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAWLDA",18,0)
 ;HASENTRY(DFN) ;TRUE IF PATIENT HAS EWL ENTRIES ON FILE
"RTN","MBAAWLDA",19,0)
 ; Q $D(^SDWL(409.3,"B",DFN))>0
"RTN","MBAAWLDA",20,0)
 ; ;
"RTN","MBAAWLDA",21,0)
 ;LIST(RETURN,DFN,STATUS,BEGIN,END) ;RETURNS LIST OF EWL ENTRIES FOR PATIENT
"RTN","MBAAWLDA",22,0)
 ; N I,IENLST,IEN,SDWL,CNT,SCRSET,SCRIF,TYP,WF,WFN
"RTN","MBAAWLDA",23,0)
 ; S RETURN=0
"RTN","MBAAWLDA",24,0)
 ; S SDWL=409.3
"RTN","MBAAWLDA",25,0)
 ; S CNT=0
"RTN","MBAAWLDA",26,0)
 ; S SCRSET="",SCRIF="$P(^(0),U,3)'="""""
"RTN","MBAAWLDA",27,0)
 ; S:STATUS'="" SCRIF=SCRIF_",$P(^(0),U,17)="""_STATUS_""""
"RTN","MBAAWLDA",28,0)
 ; I BEGIN'="",END'="" D
"RTN","MBAAWLDA",29,0)
 ; . S SCRSET="SDWLDT=$P(^(0),U,2)"
"RTN","MBAAWLDA",30,0)
 ; . S SCRIF=SCRIF_",SDWLDT'<BEGIN,SDWLDT'>END"
"RTN","MBAAWLDA",31,0)
 ; S SCRIF=$S(SCRSET="":"",1:"S "_SCRSET_" ")_"I "_SCRIF
"RTN","MBAAWLDA",32,0)
 ; D FIND^DIC(SDWL,,"@","BXQ",DFN,,"B",SCRIF,,"IENLST","ERT")
"RTN","MBAAWLDA",33,0)
 ; S RETURN=+$P(IENLST("DILIST",0),U)
"RTN","MBAAWLDA",34,0)
 ; Q:'RETURN
"RTN","MBAAWLDA",35,0)
 ; F I=1:1:RETURN D
"RTN","MBAAWLDA",36,0)
 ; . N REC
"RTN","MBAAWLDA",37,0)
 ; . S IEN=IENLST("DILIST",2,I)
"RTN","MBAAWLDA",38,0)
 ; . D GETS^DIQ(SDWL,IEN,"1;2;4:8;10;21;23","IE","REC","ERT")
"RTN","MBAAWLDA",39,0)
 ; . S TYP=REC(SDWL,IEN_",",4,"I")
"RTN","MBAAWLDA",40,0)
 ; . S WF=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"I"),1:"")
"RTN","MBAAWLDA",41,0)
 ; . S WFN=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"E"),1:"")
"RTN","MBAAWLDA",42,0)
 ; . S RETURN(I,"IEN")=IEN
"RTN","MBAAWLDA",43,0)
 ; . S RETURN(I,"ORIGDT")=REC(SDWL,IEN_",",1,"I")_"^"_REC(SDWL,IEN_",",1,"E")
"RTN","MBAAWLDA",44,0)
 ; . S RETURN(I,"INSTITUTION")=REC(SDWL,IEN_",",2,"I")_"^"_REC(SDWL,IEN_",",2,"E")
"RTN","MBAAWLDA",45,0)
 ; . S RETURN(I,"WLTYPE")=REC(SDWL,IEN_",",4,"I")_"^"_REC(SDWL,IEN_",",4,"E")
"RTN","MBAAWLDA",46,0)
 ; . S RETURN(I,"PRIORITY")=REC(SDWL,IEN_",",10,"I")_"^"_REC(SDWL,IEN_",",10,"E")
"RTN","MBAAWLDA",47,0)
 ; . S RETURN(I,"WAITFOR")=WF_"^"_WFN
"RTN","MBAAWLDA",48,0)
 ; . S RETURN(I,"DISPTYPE")=REC(SDWL,IEN_",",21,"I")_"^"_REC(SDWL,IEN_",",21,"E")
"RTN","MBAAWLDA",49,0)
 ; . S RETURN(I,"STATUS")=REC(SDWL,IEN_",",23,"I")_"^"_REC(SDWL,IEN_",",23,"E")
"RTN","MBAAWLDA",50,0)
 ; Q
"RTN","MBAAWLDA",51,0)
 ;
"RTN","MBAAWLDA",52,0)
DETAIL(RETURN,IEN) ;RETURNS EWL ENTRY DETAILED DATA MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLDA",53,0)
 N SDWL,REC,TYP,WF,WFN
"RTN","MBAAWLDA",54,0)
 S SDWL=409.3
"RTN","MBAAWLDA",55,0)
 D GETS^DIQ(SDWL,IEN,".01:23;25;29;30;37","IE","REC","ERT")
"RTN","MBAAWLDA",56,0)
 S RETURN("PATIENT")=REC(SDWL,IEN_",",.01,"I")_"^"_REC(SDWL,IEN_",",.01,"E")
"RTN","MBAAWLDA",57,0)
 S RETURN("ORIGDT")=REC(SDWL,IEN_",",1,"I")_"^"_REC(SDWL,IEN_",",1,"E")
"RTN","MBAAWLDA",58,0)
 S RETURN("INSTITUTION")=REC(SDWL,IEN_",",2,"I")_"^"_REC(SDWL,IEN_",",2,"E")
"RTN","MBAAWLDA",59,0)
 S RETURN("WLTYPE")=REC(SDWL,IEN_",",4,"I")_"^"_REC(SDWL,IEN_",",4,"E")
"RTN","MBAAWLDA",60,0)
 S TYP=REC(SDWL,IEN_",",4,"I")
"RTN","MBAAWLDA",61,0)
 S WF=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"I"),1:"")
"RTN","MBAAWLDA",62,0)
 S WFN=$S("1234"[+TYP:REC(SDWL,IEN_",",TYP+4,"E"),1:"")
"RTN","MBAAWLDA",63,0)
 S RETURN("WAITFOR")=WF_"^"_WFN
"RTN","MBAAWLDA",64,0)
 S:TYP=3 RETURN("WAITFORP")=$$GET1^DIQ(409.31,WF_",",.01,"I")_"^"_WFN
"RTN","MBAAWLDA",65,0)
 S:TYP=4 RETURN("WAITFORP")=$$GET1^DIQ(409.32,WF_",",.01,"I")_"^"_WFN
"RTN","MBAAWLDA",66,0)
 S RETURN("ENTEREDBY")=REC(SDWL,IEN_",",9,"I")_"^"_REC(SDWL,IEN_",",9,"E")
"RTN","MBAAWLDA",67,0)
 S RETURN("PRIORITY")=REC(SDWL,IEN_",",10,"I")_"^"_REC(SDWL,IEN_",",10,"E")
"RTN","MBAAWLDA",68,0)
 S RETURN("REQBY")=REC(SDWL,IEN_",",11,"I")_"^"_REC(SDWL,IEN_",",11,"E")
"RTN","MBAAWLDA",69,0)
 S RETURN("PROVIDER")=REC(SDWL,IEN_",",12,"I")_"^"_REC(SDWL,IEN_",",12,"E")
"RTN","MBAAWLDA",70,0)
 S RETURN("APPTSCHED")=REC(SDWL,IEN_",",13,"I")_"^"_REC(SDWL,IEN_",",13,"E")
"RTN","MBAAWLDA",71,0)
 S RETURN("APPTDATE")=REC(SDWL,IEN_",",13.1,"I")_"^"_REC(SDWL,IEN_",",13.1,"E")
"RTN","MBAAWLDA",72,0)
 S RETURN("APPTCLIN")=REC(SDWL,IEN_",",13.2,"I")_"^"_REC(SDWL,IEN_",",13.2,"E")
"RTN","MBAAWLDA",73,0)
 S RETURN("APPTINST")=REC(SDWL,IEN_",",13.3,"I")_"^"_REC(SDWL,IEN_",",13.3,"E")
"RTN","MBAAWLDA",74,0)
 S RETURN("APPTSC")=REC(SDWL,IEN_",",13.4,"I")_"^"_REC(SDWL,IEN_",",13.4,"E")
"RTN","MBAAWLDA",75,0)
 S RETURN("APPTCREDSC")=REC(SDWL,IEN_",",13.5,"I")_"^"_REC(SDWL,IEN_",",13.5,"E")
"RTN","MBAAWLDA",76,0)
 S RETURN("APPTSN")=REC(SDWL,IEN_",",13.6,"I")_"^"_REC(SDWL,IEN_",",13.6,"E")
"RTN","MBAAWLDA",77,0)
 S RETURN("APPTCLERK")=REC(SDWL,IEN_",",13.7,"I")_"^"_REC(SDWL,IEN_",",13.7,"E")
"RTN","MBAAWLDA",78,0)
 S RETURN("APPTSTATUS")=REC(SDWL,IEN_",",13.8,"I")_"^"_REC(SDWL,IEN_",",13.8,"E")
"RTN","MBAAWLDA",79,0)
 S RETURN("SCPRIORITY")=REC(SDWL,IEN_",",15,"I")_"^"_REC(SDWL,IEN_",",15,"E")
"RTN","MBAAWLDA",80,0)
 S RETURN("DNRDT")=REC(SDWL,IEN_",",16,"I")_"^"_$$FMTE^XLFDT(REC(SDWL,IEN_",",16,"I"),"2DZ")  ;ICR#: 10103 XLFDT
"RTN","MBAAWLDA",81,0)
 S RETURN("DNRUSR")=REC(SDWL,IEN_",",17,"I")_"^"_REC(SDWL,IEN_",",17,"E")
"RTN","MBAAWLDA",82,0)
 S RETURN("DNRRSN")=REC(SDWL,IEN_",",18,"I")_"^"_REC(SDWL,IEN_",",18,"E")
"RTN","MBAAWLDA",83,0)
 S RETURN("DNRCMT")=REC(SDWL,IEN_",",18.1,"I")_"^"_REC(SDWL,IEN_",",18.1,"E")
"RTN","MBAAWLDA",84,0)
 S RETURN("DISPDT")=REC(SDWL,IEN_",",19,"I")_"^"_REC(SDWL,IEN_",",19,"E")
"RTN","MBAAWLDA",85,0)
 S RETURN("DISPBY")=REC(SDWL,IEN_",",20,"I")_"^"_REC(SDWL,IEN_",",20,"E")
"RTN","MBAAWLDA",86,0)
 S RETURN("DISPTYPE")=REC(SDWL,IEN_",",21,"I")_"^"_REC(SDWL,IEN_",",21,"E")
"RTN","MBAAWLDA",87,0)
 S RETURN("DSRDDT")=REC(SDWL,IEN_",",22,"I")_"^"_$$FMTE^XLFDT(REC(SDWL,IEN_",",22,"I"),"2DZ")  ;ICR#: 10103 XLFDT
"RTN","MBAAWLDA",88,0)
 S RETURN("STATUS")=REC(SDWL,IEN_",",23,"I")_"^"_REC(SDWL,IEN_",",23,"E")
"RTN","MBAAWLDA",89,0)
 S RETURN("CMNTS")=REC(SDWL,IEN_",",25,"I")_"^"_REC(SDWL,IEN_",",25,"E")
"RTN","MBAAWLDA",90,0)
 S RETURN("REOPENRSN")=REC(SDWL,IEN_",",29,"I")_"^"_REC(SDWL,IEN_",",29,"E")
"RTN","MBAAWLDA",91,0)
 S RETURN("REOPENCMT")=REC(SDWL,IEN_",",30,"I")_"^"_REC(SDWL,IEN_",",30,"E")
"RTN","MBAAWLDA",92,0)
 S RETURN("CHDCLINP")=REC(SDWL,IEN_",",37,"I")_"^"_REC(SDWL,IEN_",",37,"E")
"RTN","MBAAWLDA",93,0)
 Q
"RTN","MBAAWLDA",94,0)
 ;
"RTN","MBAAWLDA",95,0)
DISP(SDWLDFN,SDWLIEN,SDWLDISP,SDA) ;UPDATE DISPOSITION MBAA RPC: MBAA REMOVE FROM EWL
"RTN","MBAAWLDA",96,0)
 N DA,DIE,DR,SDWLSS,SDWLSCL
"RTN","MBAAWLDA",97,0)
 S DIE="^SDWL(409.3,"  ;ICR#: 6046 SDWL(409.3
"RTN","MBAAWLDA",98,0)
 S DA=SDWLIEN
"RTN","MBAAWLDA",99,0)
 S DR="21///^S X=SDWLDISP" D ^DIE
"RTN","MBAAWLDA",100,0)
 S DR="19///^S X=DT" D ^DIE
"RTN","MBAAWLDA",101,0)
 S DR="20///^S X=DUZ" D ^DIE
"RTN","MBAAWLDA",102,0)
 S DR="23///^S X=""C""" D ^DIE
"RTN","MBAAWLDA",103,0)
 I SDWLDISP="SA",$D(SDA) D
"RTN","MBAAWLDA",104,0)
 . S DR="13///"_SDA(1)_";13.1///"_DT_";13.2///"_SDA(2)_";13.3///"_SDA(15)_";13.4///"_SDA(13)_";13.5///"_SDA(14)_";13.6///"_SDA(16)_";13.8///"_SDA(3)_";13.7///"_DUZ
"RTN","MBAAWLDA",105,0)
 . D ^DIE
"RTN","MBAAWLDA",106,0)
 S SDWLSS=$$GET1^DIQ(409.3,SDWLIEN_",",7,"I")
"RTN","MBAAWLDA",107,0)
 I SDWLSS K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLIEN)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLIEN)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAAWLDA",108,0)
 S SDWLSCL=$$GET1^DIQ(409.3,SDWLIEN_",",8,"I")
"RTN","MBAAWLDA",109,0)
 ;S SDWLSCL="" I SDWLSC S SDWLSCL=+$P(^SDWL(409.32,SDWLSC,0),U,1)
"RTN","MBAAWLDA",110,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLIEN)) ^SDWL(409.3,"SC",SDWLSCL,SDWLIEN)  ;ICR#: 6046 SDWL(409.3
"RTN","MBAAWLDA",111,0)
 Q 1
"RTN","MBAAWLDA",112,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAWLDA",113,0)
 ;TRFRQACT(SDWLIEN) ;RETURNS 1 IF SDWLIEN HAS AN ACTIVE TRANSFER REQUEST
"RTN","MBAAWLDA",114,0)
 ; Q $D(^SDWL(409.35,"B",SDWLIEN))
"RTN","MBAAWLDA",115,0)
 ; ;
"RTN","MBAAWLDA",116,0)
 ;TRFRQDET(RETURN,SDWLIEN) ;RETURNS TRANSFER REQUEST DETAILS
"RTN","MBAAWLDA",117,0)
 ; N SDWLIFTN
"RTN","MBAAWLDA",118,0)
 ; S SDWLIFTN=$O(^SDWL(409.35,"B",SDWLIEN,":"),-1)
"RTN","MBAAWLDA",119,0)
 ; S RETURN("STATUS")=$$GET1^DIQ(409.35,SDWLIFTN,3,"I")  ; Get the last transfer: a status of P, T or R can not have entries after.
"RTN","MBAAWLDA",120,0)
 ; Q:"^P^T^R^"'[("^"_RETURN("STATUS")_"^") 0
"RTN","MBAAWLDA",121,0)
 ; S RETURN("STATION")=$$GET1^DIQ(409.35,SDWLIFTN,1)
"RTN","MBAAWLDA",122,0)
 ; S RETURN("INSTITUTION")=$$INSTFMST^MBAALEXT(RETURN("STATION"))
"RTN","MBAAWLDA",123,0)
 ; Q 1
"RTN","MBAAWLDA",124,0)
 ;
"RTN","MBAAWLDA",125,0)
NEW(SDWLIEN,SDWLD) ;CREATES NEW ENTRY MBAA RPC: MBAA EWL NEW
"RTN","MBAAWLDA",126,0)
 N TYP,SDWL,FDA,IEN,MSG
"RTN","MBAAWLDA",127,0)
 S SDWL=409.3
"RTN","MBAAWLDA",128,0)
 S TYP=+SDWLD("WLTYPE")
"RTN","MBAAWLDA",129,0)
 S FDA(SDWL,"+1,",.01)=+SDWLD("PATIENT")
"RTN","MBAAWLDA",130,0)
 S FDA(SDWL,"+1,",1)=DT
"RTN","MBAAWLDA",131,0)
 S FDA(SDWL,"+1,",2)=+SDWLD("INSTITUTION")
"RTN","MBAAWLDA",132,0)
 S FDA(SDWL,"+1,",4)=TYP
"RTN","MBAAWLDA",133,0)
 S FDA(SDWL,"+1,",TYP+4)=+SDWLD("WAITFOR")
"RTN","MBAAWLDA",134,0)
 S FDA(SDWL,"+1,",9)=DUZ
"RTN","MBAAWLDA",135,0)
 I $D(SDWLD("PRIORITY")) S FDA(SDWL,"+1,",10)=$P(SDWLD("PRIORITY"),U)
"RTN","MBAAWLDA",136,0)
 I $D(SDWLD("REQBY")) S FDA(SDWL,"+1,",11)=+SDWLD("REQBY")
"RTN","MBAAWLDA",137,0)
 I $D(SDWLD("PROVIDER")) S FDA(SDWL,"+1,",12)=+SDWLD("PROVIDER")
"RTN","MBAAWLDA",138,0)
 I $D(SDWLD("SCPRCNT")) S FDA(SDWL,"+1,",14)=$P(SDWLD("SCPRCNT"),U)
"RTN","MBAAWLDA",139,0)
 I $D(SDWLD("SCPRIORITY")) S FDA(SDWL,"+1,",15)=$P(SDWLD("SCPRIORITY"),U)
"RTN","MBAAWLDA",140,0)
 I $D(SDWLD("DSRDDT"))  S FDA(SDWL,"+1,",22)=$P(SDWLD("DSRDDT"),U)
"RTN","MBAAWLDA",141,0)
 S FDA(SDWL,"+1,",23)="O" ;RECORD STATUS = "OPEN"
"RTN","MBAAWLDA",142,0)
 I $D(SDWLD("CMNTS"))  S FDA(SDWL,"+1,",25)=$P(SDWLD("CMNTS"),U)
"RTN","MBAAWLDA",143,0)
 I $D(SDWLD("ENRSTAT"))  S FDA(SDWL,"+1,",27)=$P(SDWLD("ENRSTAT"),U)
"RTN","MBAAWLDA",144,0)
 I $D(SDWLD("ENRDU"))  S FDA(SDWL,"+1,",27.1)=$P(SDWLD("ENRDU"),U)
"RTN","MBAAWLDA",145,0)
 I $D(SDWLD("ENRDF"))  S FDA(SDWL,"+1,",27.2)=$P(SDWLD("ENRDF"),U)
"RTN","MBAAWLDA",146,0)
 S FDA(SDWL,"+1,",28)=DUZ
"RTN","MBAAWLDA",147,0)
 I $D(SDWLD("TICKLER"))  S FDA(SDWL,"+1,",33)=$P(SDWLD("TICKLER"),U)
"RTN","MBAAWLDA",148,0)
 I $D(SDWLD("CHDCLINP")) S FDA(SDWL,"+1,",37)=$P(SDWLD("CHDCLINP"),U)
"RTN","MBAAWLDA",149,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","MBAAWLDA",150,0)
 I '$D(IEN) D  Q 0
"RTN","MBAAWLDA",151,0)
 . D ERRX^MBAAAPIE(.SDWLIEN,"?","?")
"RTN","MBAAWLDA",152,0)
 S SDWLIEN=IEN(1)
"RTN","MBAAWLDA",153,0)
 Q 1
"RTN","MBAAWLDA",154,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAWLDA",155,0)
 ;UPDATE(RETURN,SDWLIEN,SDWLD) ;UPDATES AN EXISTING ENTRY
"RTN","MBAAWLDA",156,0)
 ; N IEN,SDWL,FDA,MSG,TYP
"RTN","MBAAWLDA",157,0)
 ; S RETURN=0
"RTN","MBAAWLDA",158,0)
 ; S SDWL=409.3
"RTN","MBAAWLDA",159,0)
 ; S IEN=SDWLIEN_","
"RTN","MBAAWLDA",160,0)
 ; S FDA(SDWL,IEN,1)=DT
"RTN","MBAAWLDA",161,0)
 ; S TYP=+$G(SDWL("WLTYPE"))
"RTN","MBAAWLDA",162,0)
 ; I $D(SDWL("INSTITUTION")) S FDA(SDWL,IEN,2)=$P(SDWL("INSTITUTION"),U)
"RTN","MBAAWLDA",163,0)
 ; I TYP>0,TYP<5 D
"RTN","MBAAWLDA",164,0)
 ; . S FDA(SDWL,IEN,2)=TYP
"RTN","MBAAWLDA",165,0)
 ; . I $D(SDWL("WAITFOR")) S FDA(SDWL,IEN,TYP+4)=$P(SDWL("WAITFOR"),U)
"RTN","MBAAWLDA",166,0)
 ; ;S FDA(SDWL,IEN,9)=DUZ
"RTN","MBAAWLDA",167,0)
 ; I $D(SDWLD("PRIORITY")) S FDA(SDWL,IEN,10)=$P(SDWLD("PRIORITY"),U)
"RTN","MBAAWLDA",168,0)
 ; I $D(SDWLD("REQBY")) S FDA(SDWL,IEN,11)=+SDWLD("REQBY")
"RTN","MBAAWLDA",169,0)
 ; I $D(SDWLD("PROVIDER")) S FDA(SDWL,IEN,12)=+SDWLD("PROVIDER")
"RTN","MBAAWLDA",170,0)
 ; I $D(SDWLD("SCPRCNT")) S FDA(SDWL,IEN,14)=$P(SDWLD("SCPRCNT"),U)
"RTN","MBAAWLDA",171,0)
 ; I $D(SDWLD("SCPRIORITY")) S FDA(SDWL,IEN,15)=$P(SDWLD("SCPRIORITY"),U)
"RTN","MBAAWLDA",172,0)
 ; I $D(SDWLD("DSRDDT"))  S FDA(SDWL,IEN,22)=$P(SDWLD("DSRDDT"),U)
"RTN","MBAAWLDA",173,0)
 ; I $D(SDWLD("CMNTS"))  S FDA(SDWL,IEN,25)=$P(SDWLD("CMNTS"),U)
"RTN","MBAAWLDA",174,0)
 ; I $D(SDWLD("ENRSTAT"))  S FDA(SDWL,IEN,27)=$P(SDWLD("ENRSTAT"),U)
"RTN","MBAAWLDA",175,0)
 ; S FDA(SDWL,IEN,28)=DUZ
"RTN","MBAAWLDA",176,0)
 ; I $D(SDWLD("REJECTED"))  S FDA(SDWL,IEN,32)=$P(SDWLD("REJECTED"),U)
"RTN","MBAAWLDA",177,0)
 ; I $D(SDWLD("TICKLER"))  S FDA(SDWL,IEN,33)=$P(SDWLD("TICKLER"),U)
"RTN","MBAAWLDA",178,0)
 ; I $D(SDWLD("INTRATF"))  S FDA(SDWL,IEN,34)=$P(SDWLD("INTRATF"),U)
"RTN","MBAAWLDA",179,0)
 ; I $D(SDWLD("MULTITEAM"))  S FDA(SDWL,IEN,38)=$P(SDWLD("MULTITEAM"),U)
"RTN","MBAAWLDA",180,0)
 ; D FILE^DIE("","FDA","MSG")
"RTN","MBAAWLDA",181,0)
 ; I $D(MSG) D  Q 0
"RTN","MBAAWLDA",182,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLD")
"RTN","MBAAWLDA",183,0)
 ; S RETURN=1
"RTN","MBAAWLDA",184,0)
 ; Q 1
"RTN","MBAAWLDA",185,0)
 ;
"RTN","MBAAWLDA",186,0)
 ;DELETE(RETURN,SDWLIEN) ;
"RTN","MBAAWLDA",187,0)
 ; N FDA,MSG
"RTN","MBAAWLDA",188,0)
 ; S RETURN=0
"RTN","MBAAWLDA",189,0)
 ; S FDA(409.3,SDWLIEN_",",.01)="@"
"RTN","MBAAWLDA",190,0)
 ; D FILE^DIE("","FDA","MSG")
"RTN","MBAAWLDA",191,0)
 ; I $D(MSG) D  Q 0
"RTN","MBAAWLDA",192,0)
 ; . D ERRX^MBAAAPIE(.RETURN,"INVPARAM","SDWLIEN")
"RTN","MBAAWLDA",193,0)
 ; S RETURN=1
"RTN","MBAAWLDA",194,0)
 ; Q 1
"RTN","MBAAWLDA",195,0)
 ;
"VER")
8.0^22.0
"BLD",9755,6)
^1
**END**
**END**

