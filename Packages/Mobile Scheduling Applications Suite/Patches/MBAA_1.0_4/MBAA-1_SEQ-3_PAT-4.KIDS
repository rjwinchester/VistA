Released MBAA*1*4 SEQ #3
Extracted from mail message
**KIDS**:MBAA*1.0*4^

**INSTALL NAME**
MBAA*1.0*4
"BLD",10313,0)
MBAA*1.0*4^MOBILE SCHEDULING APPLICATIONS^0^3170223^y
"BLD",10313,4,0)
^9.64PA^^
"BLD",10313,6.3)
2
"BLD",10313,"ABPKG")
n
"BLD",10313,"KRN",0)
^9.67PA^779.2^20
"BLD",10313,"KRN",.4,0)
.4
"BLD",10313,"KRN",.401,0)
.401
"BLD",10313,"KRN",.402,0)
.402
"BLD",10313,"KRN",.403,0)
.403
"BLD",10313,"KRN",.5,0)
.5
"BLD",10313,"KRN",.84,0)
.84
"BLD",10313,"KRN",3.6,0)
3.6
"BLD",10313,"KRN",3.8,0)
3.8
"BLD",10313,"KRN",9.2,0)
9.2
"BLD",10313,"KRN",9.8,0)
9.8
"BLD",10313,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10313,"KRN",9.8,"NM",1,0)
MBAARPC2^^0^B83536861
"BLD",10313,"KRN",9.8,"NM",2,0)
MBAAMAP2^^0^B79362552
"BLD",10313,"KRN",9.8,"NM","B","MBAAMAP2",2)

"BLD",10313,"KRN",9.8,"NM","B","MBAARPC2",1)

"BLD",10313,"KRN",19,0)
19
"BLD",10313,"KRN",19.1,0)
19.1
"BLD",10313,"KRN",101,0)
101
"BLD",10313,"KRN",409.61,0)
409.61
"BLD",10313,"KRN",771,0)
771
"BLD",10313,"KRN",779.2,0)
779.2
"BLD",10313,"KRN",870,0)
870
"BLD",10313,"KRN",8989.51,0)
8989.51
"BLD",10313,"KRN",8989.52,0)
8989.52
"BLD",10313,"KRN",8994,0)
8994
"BLD",10313,"KRN","B",.4,.4)

"BLD",10313,"KRN","B",.401,.401)

"BLD",10313,"KRN","B",.402,.402)

"BLD",10313,"KRN","B",.403,.403)

"BLD",10313,"KRN","B",.5,.5)

"BLD",10313,"KRN","B",.84,.84)

"BLD",10313,"KRN","B",3.6,3.6)

"BLD",10313,"KRN","B",3.8,3.8)

"BLD",10313,"KRN","B",9.2,9.2)

"BLD",10313,"KRN","B",9.8,9.8)

"BLD",10313,"KRN","B",19,19)

"BLD",10313,"KRN","B",19.1,19.1)

"BLD",10313,"KRN","B",101,101)

"BLD",10313,"KRN","B",409.61,409.61)

"BLD",10313,"KRN","B",771,771)

"BLD",10313,"KRN","B",779.2,779.2)

"BLD",10313,"KRN","B",870,870)

"BLD",10313,"KRN","B",8989.51,8989.51)

"BLD",10313,"KRN","B",8989.52,8989.52)

"BLD",10313,"KRN","B",8994,8994)

"BLD",10313,"QUES",0)
^9.62^^
"BLD",10313,"REQB",0)
^9.611^1^1
"BLD",10313,"REQB",1,0)
MBAA*1.0*1^1
"BLD",10313,"REQB","B","MBAA*1.0*1",1)

"MBREQ")
0
"PKG",226,-1)
1^1
"PKG",226,0)
MOBILE SCHEDULING APPLICATIONS^MBAA^Mobile Application for Scheduling Calendar View
"PKG",226,20,0)
^9.402P^^
"PKG",226,22,0)
^9.49I^1^1
"PKG",226,22,1,0)
1.0^3160601^3160601^520736418
"PKG",226,22,1,"PAH",1,0)
4^3170223
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MBAAMAP2")
0^2^B79362552^B71740579
"RTN","MBAAMAP2",1,0)
MBAAMAP2 ;OIT-PD/VSL - APPOINTMENT API ;FEB 23, 2017
"RTN","MBAAMAP2",2,0)
 ;;1.0;Scheduling Calendar View;**1,4**;May 5, 2015;Build 2
"RTN","MBAAMAP2",3,0)
 ;
"RTN","MBAAMAP2",4,0)
 ;Associated ICRs
"RTN","MBAAMAP2",5,0)
 ;  ICR#
"RTN","MBAAMAP2",6,0)
 ;  5838 SDAMEVT
"RTN","MBAAMAP2",7,0)
 ;  6048 SDAMEVT
"RTN","MBAAMAP2",8,0)
 ;  6054 MBAA USE OF SDAM2 API get inpatient data
"RTN","MBAAMAP2",9,0)
 ;  6049 MBAA SDMANA API USE
"RTN","MBAAMAP2",10,0)
 ;  5838 SDAMEVT
"RTN","MBAAMAP2",11,0)
 ;
"RTN","MBAAMAP2",12,0)
CHKAPP(RETURN,SC,DFN,SD,LEN,LVL) ; Check make appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",13,0)
 N PAT,CLN,VAL,PATT,HOL,TXT,X1,X2,APT,CAPT,FRSTA,SDEDT,SDSOH,%
"RTN","MBAAMAP2",14,0)
 K RETURN
"RTN","MBAAMAP2",15,0)
 S RETURN=1
"RTN","MBAAMAP2",16,0)
 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",17,0)
 D GETPAT^MBAAMDA3(.PAT,DFN,1) ; get patient data
"RTN","MBAAMAP2",18,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1) ; get clinic data
"RTN","MBAAMAP2",19,0)
 ;check patient, stop code and inactive
"RTN","MBAAMAP2",20,0)
 S %=$$CHKAPTU(.RETURN,SC,DFN,SD,.CLN,.PAT) Q:RETURN=0 0
"RTN","MBAAMAP2",21,0)
 ;check user permissions
"RTN","MBAAMAP2",22,0)
 S VAL=$$CLNRGHT^MBAAMAP1(.RETURN,SC) Q:VAL=0 VAL
"RTN","MBAAMAP2",23,0)
 S %=$$SETST^MBAAMAP4(.RETURN,SC,SD) Q:RETURN=0 0
"RTN","MBAAMAP2",24,0)
 ;verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","MBAAMAP2",25,0)
 D GETPATT^MBAAMDA1(.PATT,SC,SD) I $G(PATT(0))'["[" S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCLUV") Q 0
"RTN","MBAAMAP2",26,0)
 ;check if schedule on holiday is permited
"RTN","MBAAMAP2",27,0)
 D GETHOL^MBAAMDA1(.HOL,$P(SD,"."))
"RTN","MBAAMAP2",28,0)
 S SDSOH=$S('$D(CLN(1918.5)):0,CLN(1918.5)']"":0,1:1)
"RTN","MBAAMAP2",29,0)
 I $D(HOL(0)),'SDSOH S TXT(1)=$P(HOL(0),U,2) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTSHOL",.TXT) Q 0
"RTN","MBAAMAP2",30,0)
 ;check if exceed max days for future appointment
"RTN","MBAAMAP2",31,0)
 S X1=DT,SDEDT=$G(CLN(2002))
"RTN","MBAAMAP2",32,0)
 S:SDEDT'>0 SDEDT=365
"RTN","MBAAMAP2",33,0)
 S X2=SDEDT D C^%DTC S SDEDT=X
"RTN","MBAAMAP2",34,0)
 I $P(SD,".")'<SDEDT S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTEXCD") Q 0
"RTN","MBAAMAP2",35,0)
 ;check if patient has an active appointment on the same time
"RTN","MBAAMAP2",36,0)
 D GETAPTS^MBAAMDA2(.APT,DFN,SD)
"RTN","MBAAMAP2",37,0)
 I $D(APT),APT("APT",SD,"STATUS")'["C"  D
"RTN","MBAAMAP2",38,0)
 . S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD) Q:'$D(CAPT)
"RTN","MBAAMAP2",39,0)
 . S TXT(1)="("_CAPT("LENGTH")_" MINUTES)"
"RTN","MBAAMAP2",40,0)
 . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPAHA",.TXT,2)
"RTN","MBAAMAP2",41,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",42,0)
 ;check if patient has an active appointment on the same day
"RTN","MBAAMAP2",43,0)
 I LVL>2 D
"RTN","MBAAMAP2",44,0)
 . K APT N IDX S IDX=""
"RTN","MBAAMAP2",45,0)
 . D GETDAPTS^MBAAMDA2(.APT,DFN,$P(SD,"."))
"RTN","MBAAMAP2",46,0)
 . F  S IDX=$O(APT(IDX)) Q:IDX=""  I APT(IDX,2)'["C"  D  Q
"RTN","MBAAMAP2",47,0)
 . . K TXT S TXT(1)="(AT "_$E(IDX_0,9,10)_":"_$E(IDX_"000",11,12)_")"
"RTN","MBAAMAP2",48,0)
 . . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPHSD",.TXT,3)
"RTN","MBAAMAP2",49,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",50,0)
 ;check if patient has an canceled appointment on the same time
"RTN","MBAAMAP2",51,0)
 I LVL'<2 D
"RTN","MBAAMAP2",52,0)
 . K APT
"RTN","MBAAMAP2",53,0)
 . D GETAPTS^MBAAMDA2(.APT,DFN,SD)
"RTN","MBAAMAP2",54,0)
 . I $D(APT),APT("APT",SD,"STATUS")["P" D 
"RTN","MBAAMAP2",55,0)
 . . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPPCP",,2)
"RTN","MBAAMAP2",56,0)
 Q:RETURN=0 0
"RTN","MBAAMAP2",57,0)
 ;check if date is prior to patient birth date
"RTN","MBAAMAP2",58,0)
 I $P(SD,".",1)<$P(PAT(.03),U,1) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPPAB") Q RETURN
"RTN","MBAAMAP2",59,0)
 ;check if date is prior to clinic availability
"RTN","MBAAMAP2",60,0)
 S FRSTA=$$GETFSTA^MBAAMDA1(SC) I FRSTA,$P(SD,".",1)<FRSTA S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPCLA") Q 0
"RTN","MBAAMAP2",61,0)
 ;check overbook
"RTN","MBAAMAP2",62,0)
 S %=$$CHKOVB(.RETURN,.CLN,SC,SD,LEN,LVL) Q:RETURN=0 RETURN
"RTN","MBAAMAP2",63,0)
 S RETURN=1
"RTN","MBAAMAP2",64,0)
 Q RETURN
"RTN","MBAAMAP2",65,0)
 ;
"RTN","MBAAMAP2",66,0)
CHKOVB(RETURN,CLN,SC,SD,LEN,LVL) ; Check overbook Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",67,0)
 N TXT,ACC,SM,MAXOB,OBNO,PP,KEYS
"RTN","MBAAMAP2",68,0)
 S RETURN=1 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",69,0)
 S SM=$$DECAVA(.CLN,SC,SD,LEN,.PP)
"RTN","MBAAMAP2",70,0)
 Q:'SM 0
"RTN","MBAAMAP2",71,0)
 S KEYS("SDOB")="",KEYS("SDMOB")=""
"RTN","MBAAMAP2",72,0)
 D GETXUS^MBAAMDA3(.ACC,.KEYS,DUZ)
"RTN","MBAAMAP2",73,0)
 I '$D(ACC("SDOB")) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTNOST") Q 0
"RTN","MBAAMAP2",74,0)
 S MAXOB=CLN(1918)
"RTN","MBAAMAP2",75,0)
 S OBNO=$$GETOBNO(SC,SD)
"RTN","MBAAMAP2",76,0)
 S TXT(1)=MAXOB,TXT(2)=$S(OBNO>1:"S",1:"")
"RTN","MBAAMAP2",77,0)
 I OBNO>MAXOB,'$D(ACC("SDMOB")) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOAPD",.TXT) Q 0
"RTN","MBAAMAP2",78,0)
 I OBNO>MAXOB,LVL>1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTEXOB",,2) Q 0
"RTN","MBAAMAP2",79,0)
 I SM=6,LVL>1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOVBK",,2) Q 0
"RTN","MBAAMAP2",80,0)
 I SM=7 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTOVOS",,2) Q 0
"RTN","MBAAMAP2",81,0)
 I SM=1 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCBCP") Q 0
"RTN","MBAAMAP2",82,0)
 Q RETURN
"RTN","MBAAMAP2",83,0)
 ;
"RTN","MBAAMAP2",84,0)
GETOBNO(SC,SD) ; Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",85,0)
 N IND,CNT,APTS
"RTN","MBAAMAP2",86,0)
 S IND="",CNT=0
"RTN","MBAAMAP2",87,0)
 D GETDAYA^MBAAMDA1(.APTS,SC,SD)
"RTN","MBAAMAP2",88,0)
 F  S IND=$O(APTS(IND)) Q:IND=""  S:APTS(IND,"OB")>0 CNT=CNT+1
"RTN","MBAAMAP2",89,0)
 Q CNT
"RTN","MBAAMAP2",90,0)
 ;
"RTN","MBAAMAP2",91,0)
CHKAPTU(RETURN,SC,DFN,SD,CLN,PAT,UNS) ; Check make unscheduled appointment MBAA RPC: MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",92,0)
 N PAPT,CLN,TXT
"RTN","MBAAMAP2",93,0)
 D:'$D(PAT) GETPAT^MBAAMDA3(.PAT,DFN,1) ; get patient data
"RTN","MBAAMAP2",94,0)
 D:'$D(CLN) GETCLN^MBAAMDA1(.CLN,SC,1) ; get clinic data
"RTN","MBAAMAP2",95,0)
 ;check if patient already has appointment
"RTN","MBAAMAP2",96,0)
 S PAPT(.01)="" D GETPAPT^MBAAMDA2(.PAPT,DFN,SD)
"RTN","MBAAMAP2",97,0)
 S TXT(1)=$$FTIME^VALM1(SD)  ;ICR#: 10116 VALM1
"RTN","MBAAMAP2",98,0)
 I PAPT(.01)>0,$D(UNS) S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTPAHU",.TXT) Q RETURN
"RTN","MBAAMAP2",99,0)
 ;check if patient is dead
"RTN","MBAAMAP2",100,0)
 I +$G(PAT(.351))>0 S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"PATDIED") Q RETURN
"RTN","MBAAMAP2",101,0)
 ;check if clinic is valid (stop code)
"RTN","MBAAMAP2",102,0)
 S VAL=$$CLNCK^MBAAMAP1(.RETURN,SC) Q:VAL=0 VAL
"RTN","MBAAMAP2",103,0)
 ;check inactive clinic period
"RTN","MBAAMAP2",104,0)
 I CLN(2505),$P(SD,".")'<CLN(2505),$S('CLN(2506):1,CLN(2506)>$P(SD,".")!('CLN(2506)):1,1:0) D  Q 0
"RTN","MBAAMAP2",105,0)
 . S TXT(1)=$$DTS^MBAAMAPI(CLN(2505))
"RTN","MBAAMAP2",106,0)
 . S:CLN(2506) TXT(2)=" and reactivated on "_$$DTS^MBAAMAPI(CLN(2506))
"RTN","MBAAMAP2",107,0)
 . S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTCINV",.TXT)
"RTN","MBAAMAP2",108,0)
 Q 1
"RTN","MBAAMAP2",109,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP2",110,0)
 ;MAKEUS(RETURN,DFN,SC,SD,TYP,STYP) ; Make unscheduled appointment
"RTN","MBAAMAP2",111,0)
 ; N SCAP,STAT,CHKIN,%
"RTN","MBAAMAP2",112,0)
 ; S RETURN=0
"RTN","MBAAMAP2",113,0)
 ; S %=$$CHKAPTU(.RETURN,SC,DFN,SD,,,1) Q:RETURN=0 0
"RTN","MBAAMAP2",114,0)
 ; S STAT=$$INP^SDAM2(DFN,SD)
"RTN","MBAAMAP2",115,0)
 ; D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP2",116,0)
 ; D MAKE^MBAAMDA3(DFN,SD,SC,TYP,.STYP,STAT,4,DUZ,DT,"W",0)
"RTN","MBAAMAP2",117,0)
 ; D MAKE^MBAAMDA1(SC,SD,DFN,CLN(1912),,DUZ)
"RTN","MBAAMAP2",118,0)
 ; S %=$$LOCKST^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",119,0)
 ; S SM=$$DECAVA(.CLN,SC,SD,CLN(1912),.S)
"RTN","MBAAMAP2",120,0)
 ; D SETST^MBAAMDA1(SC,SD,S)
"RTN","MBAAMAP2",121,0)
 ; D UNLCKST^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",122,0)
 ; S %=$$GETSCAP^MBAAMAP1(.SCAP,SC,DFN,SD)
"RTN","MBAAMAP2",123,0)
 ; D MAKE^SDAMEVT(DFN,SD,SC,SCAP("IFN"))
"RTN","MBAAMAP2",124,0)
 ; Q 1
"RTN","MBAAMAP2",125,0)
 ; ;
"RTN","MBAAMAP2",126,0)
MAKE(RETURN,DFN,SC,SD,TYPE,STYP,LEN,SRT,OTHR,CIO,LAB,XRAY,EKG,RQXRAY,CONS,LVL,DESDT) ; Make appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",127,0)
 N %
"RTN","MBAAMAP2",128,0)
 ;IF WE NEED TO CHECK FOR DEPARTMENT OF DEFENSE PUT IN THE CODE TO DO THE TASKS BELOW
"RTN","MBAAMAP2",129,0)
 ;I DUZ="" THEN SET DUZ FOR DEPARTMENT OF DEFENSE 
"RTN","MBAAMAP2",130,0)
 ;S REC=$O(^VA(200,"B","DEPARTMENT OF DEFENSE,USER",""))
"RTN","MBAAMAP2",131,0)
 ;I REC'>0 SEND ERROR MESSAGE THAT THE DEPARTMENT OF DEFENSE,USER DOESN'T EXIST ON THE SYSTEM
"RTN","MBAAMAP2",132,0)
 ;I REC>0 S DUZ=REC D CLNRGHT^MBAAMRP1(.RETURN,SC) I RETURN(0)=1 S RETURN="0^RESTRICED CLINIC, USER NOT ALLOWED TO BOOK APPTS IN THIS CLINIC" Q
"RTN","MBAAMAP2",133,0)
 ;CALL VERIFY CLINIC ACCESS
"RTN","MBAAMAP2",134,0)
 ;Q:IF NOT ACCESS 
"RTN","MBAAMAP2",135,0)
 S:'$G(LVL) LVL=7
"RTN","MBAAMAP2",136,0)
 S RETURN=1
"RTN","MBAAMAP2",137,0)
 F I="SC","DFN","SD","LEN" I '$D(@I) S RETURN=0,TXT(1)=I D ERRX^MBAAAPIE(.RETURN,"INVPARAM",.TXT)
"RTN","MBAAMAP2",138,0)
 I RETURN=0 Q 0
"RTN","MBAAMAP2",139,0)
 S %=$$CHKAPP(.RETURN,SC,DFN,SD,LEN,LVL)
"RTN","MBAAMAP2",140,0)
 I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN(0)
"RTN","MBAAMAP2",141,0)
 I RETURN=0,$P(RETURN(0),U)="PATDIED" Q RETURN(0)
"RTN","MBAAMAP2",142,0)
 I RETURN=0,$P(RETURN(0),U)="APTPAHA" D
"RTN","MBAAMAP2",143,0)
 . S %=$$CANCEL(.RETURN,DFN,SC,SD,"C",13,"")
"RTN","MBAAMAP2",144,0)
 E  Q:'$G(RETURN)&('$G(LVL)) 0
"RTN","MBAAMAP2",145,0)
 N CLN,S,SM,SDY,SCAP,SRT0
"RTN","MBAAMAP2",146,0)
 S %=$$LOCKST^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",147,0)
 S %=$$LOCKS^MBAAMDA1(SC,SD) I '% S RETURN=0 D ERRX^MBAAAPIE(.RETURN,"APTLOCK") Q 0
"RTN","MBAAMAP2",148,0)
 D GETCLN^MBAAMDA1(.CLN,SC,1)
"RTN","MBAAMAP2",149,0)
 S SM=$$DECAVA(.CLN,SC,SD,+LEN,.S)
"RTN","MBAAMAP2",150,0)
 D SETST^MBAAMDA1(SC,SD,S)
"RTN","MBAAMAP2",151,0)
 D MAKE^MBAAMDA1(SC,SD,DFN,+LEN,SM,DUZ,$G(OTHR),.RQXRAY)
"RTN","MBAAMAP2",152,0)
 D UNLCKS^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",153,0)
 D UNLCKST^MBAAMDA1(SC,SD)
"RTN","MBAAMAP2",154,0)
 S STAT=$$INP^SDAM2(DFN,SD)  ;ICR#: 6054 MBAA USE OF SDAM2 API get inpatient data
"RTN","MBAAMAP2",155,0)
 S:SD<DT SRT="W"
"RTN","MBAAMAP2",156,0)
 S SRT0=$$NAVA^SDMANA(SC,SD,.SRT)  ;ICR#: 6049 MBAA SDMANA API USE
"RTN","MBAAMAP2",157,0)
 D MAKE^MBAAMDA3(DFN,SD,SC,.TYPE,.STYP,STAT,3,DUZ,DT,SRT,SRT0,.LAB,.XRAY,.EKG,$G(DESDT))
"RTN","MBAAMAP2",158,0)
 ;N DATA S DATA(27)=DT,DATA(28)=$$PTFU^MBAAMAP1(,DFN,SC)
"RTN","MBAAMAP2",159,0)
 ;D UPDPAPT^MBAAMDA4(.DATA,DFN,SD)
"RTN","MBAAMAP2",160,0)
 S %=$$GETSCAP^MBAAMAP1(.SCAP,SC,DFN,SD)
"RTN","MBAAMAP2",161,0)
 I $G(CONS)>0 S DATA(688)=CONS
"RTN","MBAAMAP2",162,0)
 D UPDCAPT^MBAAMDA4(.DATA,SC,SD,$G(SCAP("IFN")))
"RTN","MBAAMAP2",163,0)
 S:$G(CONS)>0 %=$$EDITCS^MBAAAPI1(.RETURN,CONS,SD,.OTHR,$G(CLN("NAME"))) ;SD/478
"RTN","MBAAMAP2",164,0)
 D MAKE^SDAMEVT(DFN,SD,SC,$G(SCAP("IFN")),2) ;ICR#: 6048 SDAMEVT
"RTN","MBAAMAP2",165,0)
 ;alb/sat 4 - begin mod to update SDEC files
"RTN","MBAAMAP2",166,0)
 N SDAPTYP,SDECAR,SDECR,SDRES,SDRQTYP,SDSTAT
"RTN","MBAAMAP2",167,0)
 S CONS=$G(CONS)
"RTN","MBAAMAP2",168,0)
 S:'CONS SDECAR=$$SDWLA^SDM1A(DFN,SD,SC,DESDT,TYPE)  ;build SDEC APPT REQUEST entry
"RTN","MBAAMAP2",169,0)
 S SDAPTYP=$S(+CONS:"C|"_CONS,1:"A|"_SDECAR)
"RTN","MBAAMAP2",170,0)
 S SDRES=$$GETRES^SDECUTL(SC)
"RTN","MBAAMAP2",171,0)
 D PCSTGET^SDEC(.SDECR,DFN,SC) S SDSTAT=$P(@SDECR@(1),$C(30,31),1),SDECR=$S($P(SDSTAT,U,2)="YES":"E",1:"N")
"RTN","MBAAMAP2",172,0)
 D SDECADD^SDEC07(SD,,DFN,SDRES,0,$G(DESDT),"",SDAPTYP,,SC,$G(OTHR),,SDRES,TYPE,SDECR) ;add SDEC APPOINTMENT entry
"RTN","MBAAMAP2",173,0)
 ;alb/sat 4 - end mod
"RTN","MBAAMAP2",174,0)
 I $D(CIO),CIO="CI" S %=$$CHECKIN^MBAAMAP2(.CHKIN,DFN,SD,SC,SD)
"RTN","MBAAMAP2",175,0)
 K CHKIN,DATA,STAT
"RTN","MBAAMAP2",176,0)
 Q 1
"RTN","MBAAMAP2",177,0)
 ;
"RTN","MBAAMAP2",178,0)
DECAVA(CLN,SC,SD,LEN,PATT) ; Decrease availability Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",179,0)
 N AV,S,SB,X,Y,I,SS,ST,STR,STARTDAY,HSI,SI,SDDIF,SM,CAN,SDNOT
"RTN","MBAAMAP2",180,0)
 S SM=0,CAN=0
"RTN","MBAAMAP2",181,0)
 D GETPATT^MBAAMDA1(.AV,SC,SD)
"RTN","MBAAMAP2",182,0)
 S S=$G(AV(0)),SB=CLN(1914)
"RTN","MBAAMAP2",183,0)
 S STARTDAY=$S($L(SB):SB,1:8),SB=STARTDAY-1/100
"RTN","MBAAMAP2",184,0)
 S X=CLN(1917),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4)
"RTN","MBAAMAP2",185,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2)
"RTN","MBAAMAP2",186,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=LEN*HSI/60*SDDIF+ST+ST
"RTN","MBAAMAP2",187,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!(CLN(1917)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","MBAAMAP2",188,0)
 I ST+ST>$L(S),$L(S)<80 S S=S_" "
"RTN","MBAAMAP2",189,0)
 S SDNOT=1   ;SD*5.3*490 naked Do added below
"RTN","MBAAMAP2",190,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) S:S["CAN"!(ST="X"&($D(AV(1)))) CAN=1 Q:CAN  S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","MBAAMAP2",191,0)
 .Q:ST'=""
"RTN","MBAAMAP2",192,0)
 .Q:+LEN'>CLN(1912)
"RTN","MBAAMAP2",193,0)
 .S ST="   "
"RTN","MBAAMAP2",194,0)
 .Q
"RTN","MBAAMAP2",195,0)
 S PATT=S
"RTN","MBAAMAP2",196,0)
 Q:CAN CAN
"RTN","MBAAMAP2",197,0)
 Q SM
"RTN","MBAAMAP2",198,0)
 ;
"RTN","MBAAMAP2",199,0)
CANCEL(RETURN,DFN,SC,SD,TYP,RSN,RMK) ; Cancel appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",200,0)
 N CDATE,CDT,ERR,ODT,OIFN,OUSR,%
"RTN","MBAAMAP2",201,0)
 S RETURN=0
"RTN","MBAAMAP2",202,0)
 S %=$$CHKCAN^MBAAMAP3(.RETURN,DFN,SC,SD) Q:RETURN=0 0
"RTN","MBAAMAP2",203,0)
 S CDATE=$$NOW^XLFDT  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP2",204,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",205,0)
 S CIFN=CAPT("IFN")
"RTN","MBAAMAP2",206,0)
 S OUSR=CAPT("USER"),ODT=CAPT("DATE")
"RTN","MBAAMAP2",207,0)
 N SDATA,SDCPHDL
"RTN","MBAAMAP2",208,0)
 S SDCPHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",209,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCPHDL) ;ICR#: 5835 SDAMEVT
"RTN","MBAAMAP2",210,0)
 S CDT=$$NOW^XLFDT()  ;ICR#: 10103 XLFDT
"RTN","MBAAMAP2",211,0)
 D CANCEL^MBAAMDA3(.ERR,DFN,SD,TYP,RSN,RMK,$E(CDT,1,12),DUZ,OUSR,ODT)
"RTN","MBAAMAP2",212,0)
 S OIFN=$$COVERB^MBAAMDA1(SC,SD,CIFN)
"RTN","MBAAMAP2",213,0)
 S %=$$CANCEL^MBAAAPI1(RETURN,CAPT("CONSULT"),SC,SD,CIFN,RMK,TYP)
"RTN","MBAAMAP2",214,0)
 D CANCEL^MBAAMDA1(SC,SD,DFN,CIFN)
"RTN","MBAAMAP2",215,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,0,SDCPHDL) ;ICR#: 6048 MBAA SDAMEVT API CALLS
"RTN","MBAAMAP2",216,0)
 S RETURN=1 K CIFN
"RTN","MBAAMAP2",217,0)
 Q RETURN
"RTN","MBAAMAP2",218,0)
 ;
"RTN","MBAAMAP2",219,0)
CHECKIN(RETURN,DFN,SD,SC,CIDT) ; Check in appointment Called by RPC MBAA APPOINTMENT MAKE
"RTN","MBAAMAP2",220,0)
 N CAPT,CI,%
"RTN","MBAAMAP2",221,0)
 S CI=DT
"RTN","MBAAMAP2",222,0)
 S:$D(CIDT) CI=CIDT
"RTN","MBAAMAP2",223,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",224,0)
 I $G(CAPT(0))="" D ERRX^MBAAAPIE(.RETURN,"APTWHEN") Q 0
"RTN","MBAAMAP2",225,0)
 S CIFN=$G(CAPT("IFN"))
"RTN","MBAAMAP2",226,0)
 I 'CIFN D ERRX^MBAAAPIE(.RETURN,"APTWHEN") Q 0
"RTN","MBAAMAP2",227,0)
 N SDATA,SDCIHDL,X
"RTN","MBAAMAP2",228,0)
 S SDATA=CIFN_U_DFN_U_SD_U_SC,SDCIHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5835 SDAMEVT
"RTN","MBAAMAP2",229,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",230,0)
 S %=$$CHKCIN^MBAAMAP3(.RETURN,DFN,SD,+SDATA("BEFORE","STATUS")) Q:'% 0
"RTN","MBAAMAP2",231,0)
 S CD(302)=DUZ,CD(309)=CI
"RTN","MBAAMAP2",232,0)
 D UPDCAPT^MBAAMDA4(.CD,SC,SD,CAPT("IFN"))
"RTN","MBAAMAP2",233,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCIHDL) ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",234,0)
 M RETURN=SDATA
"RTN","MBAAMAP2",235,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","MBAAMAP2",236,0)
 . D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode  ;ICR#: 5838 SDAMEVT
"RTN","MBAAMAP2",237,0)
 K CD,CIFN
"RTN","MBAAMAP2",238,0)
 Q 1
"RTN","MBAAMAP2",239,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAAMAP2",240,0)
 ;Linetag NOSHOW is not needed until the next enhancement of MBAA
"RTN","MBAAMAP2",241,0)
 ;NOSHOW(RETURN,DFN,SC,SD,LVL) ; No-show appointment
"RTN","MBAAMAP2",242,0)
 ;N APT0,STATUS,APTSTAT,AUTO,CNSTLNK,NSDA,NSDIE,%
"RTN","MBAAMAP2",243,0)
 ;S:'$D(LVL) LVL=7
"RTN","MBAAMAP2",244,0)
 ;S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP2",245,0)
 ;S APTSTAT=$P(APT0,U,2)
"RTN","MBAAMAP2",246,0)
 ;S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP2",247,0)
 ;S RETURN=0
"RTN","MBAAMAP2",248,0)
 ;S %=$$CHKNS^MBAAMAP3(.RETURN,APT0,+STATUS,LVL)
"RTN","MBAAMAP2",249,0)
 ;I RETURN=0,$P(RETURN(0),U,3)'>LVL Q RETURN
"RTN","MBAAMAP2",250,0)
 ;N FDA,CIFN,CAPT
"RTN","MBAAMAP2",251,0)
 ;S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAAMAP2",252,0)
 ;S CIFN=CAPT("IFN")
"RTN","MBAAMAP2",253,0)
 ;S CNSTLNK=$G(CAPT("CONSULT"))
"RTN","MBAAMAP2",254,0)
 ;S RETURN("BEFORE")=STATUS
"RTN","MBAAMAP2",255,0)
 ;N SDNSHDL S SDNSHDL=$$HANDLE^SDAMEVT(1)
"RTN","MBAAMAP2",256,0)
 ;D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDNSHDL)
"RTN","MBAAMAP2",257,0)
 ;I APTSTAT=""!(APTSTAT="NT") D
"RTN","MBAAMAP2",258,0)
 ;. S FDA(3)="N",FDA(14)=DUZ,FDA(15)=$$NOW^XLFDT()
"RTN","MBAAMAP2",259,0)
 ;E  D
"RTN","MBAAMAP2",260,0)
 ;. S FDA(3)="@",FDA(14)="@",FDA(15)="@"
"RTN","MBAAMAP2",261,0)
 ;D UPDPAPT^MBAAMDA4(.FDA,DFN,SD)
"RTN","MBAAMAP2",262,0)
 ;D NOSHOW^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,2,SDNSHDL)
"RTN","MBAAMAP2",263,0)
 ;S:+$G(CNSTLNK) %=$$NOSHOW^MBAAAPI1(.RETURN,SC,SD,DFN,CNSTLNK,CIFN)
"RTN","MBAAMAP2",264,0)
 ;S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAAMAP2",265,0)
 ;S APTSTAT=$P(APT0,U,2)
"RTN","MBAAMAP2",266,0)
 ;S STATUS=$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))
"RTN","MBAAMAP2",267,0)
 ;S RETURN("AFTER")=STATUS
"RTN","MBAAMAP2",268,0)
 ;Q 1
"RTN","MBAAMAP2",269,0)
 ;
"RTN","MBAARPC2")
0^1^B83536861^B78656995
"RTN","MBAARPC2",1,0)
MBAARPC2 ;OIT-PD/PB - Scheduling RPCs ;FEB 23, 2017
"RTN","MBAARPC2",2,0)
 ;;1.0;Scheduling Calendar View;**1,4**;Feb 13, 2015;Build 2
"RTN","MBAARPC2",3,0)
 ;
"RTN","MBAARPC2",4,0)
 ;This routine has multiple RPCs created to support the mobile Scheduling apps
"RTN","MBAARPC2",5,0)
 ;
"RTN","MBAARPC2",6,0)
 ;Associated ICRs:
"RTN","MBAARPC2",7,0)
 ;  ICR#
"RTN","MBAARPC2",8,0)
 ;  10103 XLFDT
"RTN","MBAARPC2",9,0)
 ;  5838 SDAMEVT
"RTN","MBAARPC2",10,0)
 ;  6048 SDAMEVT
"RTN","MBAARPC2",11,0)
 ;  6053 DPT
"RTN","MBAARPC2",12,0)
 ;  4433 SDAMA301
"RTN","MBAARPC2",13,0)
 ;
"RTN","MBAARPC2",14,0)
 ;Cancel an Appointment
"RTN","MBAARPC2",15,0)
CANCEL(RV,DFN,SC,SD,TYPE,RSN,RMK) ; SD APPOINTMENT CANCEL MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",16,0)
 N STATUS,RESULT,ROUTC S STATUS=$$CANCEL1(.RESULT,DFN,SC,SD,TYPE,RSN,RMK)  ;alb/sat 4 - existing ROUTC needs to be Newed
"RTN","MBAARPC2",17,0)
 ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAARPC2",18,0)
 S RV=$G(RESULT)
"RTN","MBAARPC2",19,0)
 Q
"RTN","MBAARPC2",20,0)
CANCEL1(RETURN,DFN,SC,SD,TYP,RSN,RMK) ; Cancel appointment MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",21,0)
 N CDATE,CDT,ERR,ODT,OIFN,OUSR,%
"RTN","MBAARPC2",22,0)
 N CAPT,CIFN  ;alb/sat 4 - existing variables need to be Newed
"RTN","MBAARPC2",23,0)
 S RETURN=0
"RTN","MBAARPC2",24,0)
 S %=$$CHKCAN(.RETURN,DFN,SC,SD) I $E(%,1,3)="APT" Q RETURN
"RTN","MBAARPC2",25,0)
 S CDATE=$$NOW^XLFDT  ;ICR#: 10103 XLFDT
"RTN","MBAARPC2",26,0)
 S %=$$GETSCAP^MBAAMAP1(.CAPT,SC,DFN,SD)
"RTN","MBAARPC2",27,0)
 S CIFN=CAPT("IFN")
"RTN","MBAARPC2",28,0)
 S OUSR=CAPT("USER"),ODT=CAPT("DATE")
"RTN","MBAARPC2",29,0)
 N SDATA,SDCPHDL
"RTN","MBAARPC2",30,0)
 S SDCPHDL=$$HANDLE^SDAMEVT(1) ;ICR#: 5838 SDAMEVT
"RTN","MBAARPC2",31,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,SDCPHDL)
"RTN","MBAARPC2",32,0)
 S CDT=$$NOW^XLFDT()  ;ICR#: 10103 XLFDT
"RTN","MBAARPC2",33,0)
 D CANCEL^MBAAMDA3(.ERR,DFN,SD,TYP,RSN,RMK,$E(CDT,1,12),DUZ,OUSR,ODT)
"RTN","MBAARPC2",34,0)
 S OIFN=$$COVERB^MBAAMDA1(SC,SD,CIFN)
"RTN","MBAARPC2",35,0)
 S %=$$CANCEL^MBAAAPI1(RETURN,CAPT("CONSULT"),SC,SD,CIFN,RMK,TYP)
"RTN","MBAARPC2",36,0)
 D CANCEL^MBAAMDA1(SC,SD,DFN,CIFN)
"RTN","MBAARPC2",37,0)
 ;alb/sat 4 - begin mod to update SDEC
"RTN","MBAARPC2",38,0)
 N SDECAPPT
"RTN","MBAARPC2",39,0)
 S SDECAPPT=$$APPTGET^SDECUTL(DFN,SD,SC)
"RTN","MBAARPC2",40,0)
 D:+SDECAPPT SDECCAN^SDEC08(SDECAPPT,"PC",RSN,RMK,"",DUZ,"01")
"RTN","MBAARPC2",41,0)
 ;alb/sat 4 - end mod
"RTN","MBAARPC2",42,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SD,SC,CIFN,0,SDCPHDL) ;ICR#: 6048 MBAA SDAMEVT API CALLS
"RTN","MBAARPC2",43,0)
 S RETURN=1
"RTN","MBAARPC2",44,0)
 Q RETURN
"RTN","MBAARPC2",45,0)
 ;
"RTN","MBAARPC2",46,0)
CHKCAN(RETURN,DFN,SC,SD) ; Verify cancel MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",47,0)
 ;N APT,RET,%
"RTN","MBAARPC2",48,0)
 K APT N RET,TXT,%   ;alb/sat 4 - existing TXT needs to be Newed
"RTN","MBAARPC2",49,0)
 S RETURN=0
"RTN","MBAARPC2",50,0)
 I '$D(^DPT(DFN,"S",SD)) S RETURN="APTNTSCH" Q RETURN ; patient doesn't have an appointment at the requested time  ;ICR#: 6053 DPT
"RTN","MBAARPC2",51,0)
 S ROUTC=1
"RTN","MBAARPC2",52,0)
 D GETAPTS^MBAAMDA2(.APT,DFN,.SD)
"RTN","MBAARPC2",53,0)
 I APT("APT",SD,"STATUS")["C" D  S RETURN="APTCAND" Q RETURN ; Appointment already canceled.
"RTN","MBAARPC2",54,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCAND")
"RTN","MBAARPC2",55,0)
 I $$ISAPTCO^MBAAMAP4(,DFN,SD) D  Q RETURN="APTCCHO" ; Appointment has a check out date and can't be canceled
"RTN","MBAARPC2",56,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCCHO")
"RTN","MBAARPC2",57,0)
 S %=$$CLNRGHT^MBAAMAP1(.RET,+SC)
"RTN","MBAARPC2",58,0)
 I RET=0 D  S RETURN="APTCRGT" Q RETURN="APTCRGT" ; Appointment not cancelled. Access to this clinic to this clinic is restricted to only priv. users
"RTN","MBAARPC2",59,0)
 . S TXT(1)=RET("CLN"),TXT(2)=$C(10)
"RTN","MBAARPC2",60,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCRGT",.TXT)
"RTN","MBAARPC2",61,0)
 I '$$CHKSPC(.STAT,DFN,SD) D  S RETURN="APTCNPE" Q RETURN="APTCNPE" ; This appointment can't be canceled
"RTN","MBAARPC2",62,0)
 . D ERRX^MBAAAPIE(.RETURN,"APTCNPE",.TXT)
"RTN","MBAARPC2",63,0)
 S RETURN=1
"RTN","MBAARPC2",64,0)
 Q RETURN
"RTN","MBAARPC2",65,0)
CHKSPC(RETURN,DFN,SD) ; Check if status permit cancelation, MBAA RPC: MBAA CANCEL APPOINTMENT
"RTN","MBAARPC2",66,0)
 N APT0,STATUS,IND,STAT,STATS
"RTN","MBAARPC2",67,0)
 S RETURN=0
"RTN","MBAARPC2",68,0)
 S APT0=$$GETAPT0^MBAAMDA2(DFN,SD)
"RTN","MBAARPC2",69,0)
 ;T13 Change to use SDAMA301 API
"RTN","MBAARPC2",70,0)
 K R1 D STATUS^MBAARPC1(.R1,DFN,SD,+$G(APT0)) S STATUS=+R1 K R1  ;ICR 4433
"RTN","MBAARPC2",71,0)
 ;S STATUS=+$$STATUS^SDAM1(DFN,SD,+$G(APT0),$G(APT0))  ;ICR#: 2851 MBAA ACCESS TO SDAM1 API get appointment status
"RTN","MBAARPC2",72,0)
 D LSTCSTA1^MBAAMDA2(.STAT)
"RTN","MBAARPC2",73,0)
 D BLDLST^MBAAMAPI(.STATS,.STAT)
"RTN","MBAARPC2",74,0)
 S IND=0
"RTN","MBAARPC2",75,0)
 F  S IND=$O(STATS(IND)) Q:IND=""!(RETURN=1)  D
"RTN","MBAARPC2",76,0)
 . I STATS(IND,"ID")=STATUS S RETURN=1 Q
"RTN","MBAARPC2",77,0)
 S RETURN=$G(RETURN)
"RTN","MBAARPC2",78,0)
 Q RETURN
"RTN","MBAARPC2",79,0)
 ;Line Tags CLNDATA, RECALL, DELETE, CHK, NEWEWL, WFCK, ENRCHK, REQBY is commented out due to the functionality being descoped from the first release
"RTN","MBAARPC2",80,0)
 ;CLNDATA(RETURN,CLINICID) ; returns additional clinic data MBAA ADDITIONAL CLINIC DETAILS
"RTN","MBAARPC2",81,0)
 ; Input: CLINICID - IEN for the Clinic in the Hospital Location file (#44)
"RTN","MBAARPC2",82,0)
 ; Returns: 
"RTN","MBAARPC2",83,0)
 ; If Successful:
"RTN","MBAARPC2",84,0)
 ;  RETURN(0)="TREATING SPECIALTY^STOP CODE^CREDIT STOP CODE^SPECIALTY"
"RTN","MBAARPC2",85,0)
 ; If Failure:
"RTN","MBAARPC2",86,0)
 ;  RETURN(0)="0^Missing CLINICID" 
"RTN","MBAARPC2",87,0)
 ;  RETURN(0)="0^Clinic doesn't exist."
"RTN","MBAARPC2",88,0)
 ;
"RTN","MBAARPC2",89,0)
 ;I $G(CLINICID)="" S RETURN(0)="0^Missing CLINICID" Q
"RTN","MBAARPC2",90,0)
 ;I '$D(^SC(CLINICID,0)) S RETURN(0)="0^Clinic doesn't exist." Q  ;ICR#: 6044
"RTN","MBAARPC2",91,0)
 ;I $P(^SC(CLINICID,0),"^",3)'="C" S RETURN(0)="0^Clinic doesn't exist." Q  ;ICR#: 6044
"RTN","MBAARPC2",92,0)
 ;N NODE,STOPPTR,SPECPTR,CREDITPRT,SPECLTY,SPECL,SPEC,SPEC2,STOPCODE,CREDIT,CREDITPTR,CLINIC1,SPEC1  ;IRC#: 6044
"RTN","MBAARPC2",93,0)
 ;S NODE=$G(^SC(CLINICID,0)),STOPPTR=$P(NODE,"^",7),SPECPTR=$P(NODE,"^",20),CREDITPTR=$P(NODE,"^",18)
"RTN","MBAARPC2",94,0)
 ;S STOPCODE=$P(^DIC(40.7,STOPPTR,0),"^"),CREDIT=$P(^DIC(40.7,CREDITPTR,0),"^"),SPEC=$P(^DIC(45.7,SPECPTR,0),"^")  ;ICR#: 1024, 362
"RTN","MBAARPC2",95,0)
 ;S SPECLTY=$P(^DIC(45.7,SPECPTR,0),"^",2),SPECL=$P(^DIC(42.4,SPECLTY,0),"^",1)  ;ICR#: 430, 362
"RTN","MBAARPC2",96,0)
 ;D GETS^DIQ(44,CLINICID,"8;9.5;2503","IE","CLINIC1")
"RTN","MBAARPC2",97,0)
 ;S SPEC=$G(CLINIC1(44,CLINICID_",",9.5,"I")),STOPCODE=$G(CLINIC1(44,CLINICID_",",8,"E")),CREDIT=$G(CLINIC1(44,CLINICID_",",2503,"E")),SPEC2=$G(CLINIC1(44,CLINICID_",",9.5,"E"))
"RTN","MBAARPC2",98,0)
 ;D GETS^DIQ(45.7,SPEC,".01;1","IE","SPEC1")
"RTN","MBAARPC2",99,0)
 ;S SPECL=$G(SPEC1(45.7,SPEC_",",1,"E"))
"RTN","MBAARPC2",100,0)
 ;S RETURN(0)=$G(SPEC2)_"^"_$G(STOPCODE)_"^"_$G(CREDIT)_"^"_$G(SPECL)
"RTN","MBAARPC2",101,0)
 ;K NODE,STOPPTR,SPECPTR,CREDITPRT,SPECLTY,SPECL,SPEC,STOPCODE,CREDIT,CREDITPTR,CLINIC1,SPEC1
"RTN","MBAARPC2",102,0)
 ;Q
"RTN","MBAARPC2",103,0)
 ;RECALL(RESULTS,DFN,CLINIC,RECALLDT,PTRECDT,PROVIDER,LEN,FAST,TEST,USER,COMMENT) ; adds new patients to the Recall List MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",104,0)
 ; Input parameter is the Patient DFN
"RTN","MBAARPC2",105,0)
 ;S RESULTS(0)=1
"RTN","MBAARPC2",106,0)
 ;I $G(DFN)="" S RESULTS(0)="0^DFN is not defined" Q
"RTN","MBAARPC2",107,0)
 ;T13 Change to FM read
"RTN","MBAARPC2",108,0)
 ;N JX S JX=$$GET1^DIQ(2,$G(DFN),.01) I $G(JX)="" S RESULTS(0)="0^Not a patient in this system." Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",109,0)
 ;I '$D(^DPT(DFN,0)) S RESULTS(0)="0^Not a patient in this system." Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",110,0)
 ;I $G(CLINIC)="" S RESULTS(0)="0^Clinic not provided." Q
"RTN","MBAARPC2",111,0)
 ;T13 Change to FM read
"RTN","MBAARPC2",112,0)
 ;I '$D(^SC(CLINIC,0)) S RESULTS(0)="0^Clinic not in the Hospital Location File." Q  ;ICR#: 6044
"RTN","MBAARPC2",113,0)
 ;N JX S JX=$$GET1^DIQ(44,$G(CLINIC),.01) I $G(JX)="" S RESULTS(0)="0^Clinic not in the Hospital Location File." Q  ;ICR#: 6044
"RTN","MBAARPC2",114,0)
 ;I ($G(RECALLDT)=""!($G(RECALLDT)'>DT)) S RESULTS(0)="0^Provider Recall date not provided or not a valid date. Date must be in the future." Q
"RTN","MBAARPC2",115,0)
 ;I ($G(PTRECDT)=""!($G(PTRECDT)'>DT)) S RESULTS(0)="0^Patient recall date not provided or not a valid date. Date must be in the future" Q
"RTN","MBAARPC2",116,0)
 ;I $G(PROVIDER)="" S RESULTS(0)="0^Provider IEN not provided." Q
"RTN","MBAARPC2",117,0)
 ;I '$D(^VA(200,$G(PROVIDER),0)) S RESULTS(0)="0^Provider not provided." Q
"RTN","MBAARPC2",118,0)
 ;N JX S JX=$$GET1^DIQ(200,$G(PROVIDER),.01) I $G(JX)="" S RESULTS(0)="0^Provider not in the New Person file." Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",119,0)
 ;I $G(LEN)'>0 S RESULTS(0)="0^Appointment length not provided." Q
"RTN","MBAARPC2",120,0)
 ;I $G(FAST)="" S RESULTS(0)="0^FAST code not provided." Q
"RTN","MBAARPC2",121,0)
 ;S FAST=$$LOW^XLFSTR($G(FAST))
"RTN","MBAARPC2",122,0)
 ;I "nf"'[FAST S RESULTS(0)="0^FAST code not provided." Q
"RTN","MBAARPC2",123,0)
 ;I $G(TEST)'>0 S RESULTS(0)="0^Appointment Type code not provided. Appointment Type is a numeric value." Q
"RTN","MBAARPC2",124,0)
 ;I $G(USER)'>0 S RESULTS(0)="0^User IEN not provided." Q
"RTN","MBAARPC2",125,0)
 ;I '$D(^VA(200,$G(USER),0)) S RESULTS(0)="0^User IEN not provided." Q
"RTN","MBAARPC2",126,0)
 ;N JX S JX=$$GET1^DIQ(200,$G(USER),.01) I $G(JX)="" S RESULTS(0)="0^User not in the New Person File." Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",127,0)
 ;S ERR=0 D CHK I ERR=1 S RESULTS(0)="0^Duplicate Recall List Entry" Q
"RTN","MBAARPC2",128,0)
 ;K DO S (DIC,DIE)="^SD(403.5,",DIC(0)="Z",X=DFN,DLAYGO=403.5 D FILE^DICN K DO S NUM=+Y  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",129,0)
 ;S DA=NUM,DR="4.5///"_$G(CLINIC)_";4///"_$G(PROVIDER)_";2.6///"_$G(FAST)_";4.7///"_$G(LEN)_";5///"_$G(RECALLDT)_";5.5///"_$G(PTRECDT)_";2.5///"_$G(COMMENT)_";3///"_$G(TEST)_";7///"_$G(USER)
"RTN","MBAARPC2",130,0)
 ;D ^DIE
"RTN","MBAARPC2",131,0)
 ;S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","MBAARPC2",132,0)
 ;I $D(DTOUT) D DELETE
"RTN","MBAARPC2",133,0)
 ;K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,DIR,DTOUT
"RTN","MBAARPC2",134,0)
 ;Q
"RTN","MBAARPC2",135,0)
 ;DELETE ;delete new incomplete record and display message MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",136,0)
 ;S DIK=DIE
"RTN","MBAARPC2",137,0)
 ;D ^DIK K DIK
"RTN","MBAARPC2",138,0)
 ;S RESULTS(0)="0^All required data was not provided. Recall was not created!"
"RTN","MBAARPC2",139,0)
 ;Q
"RTN","MBAARPC2",140,0)
 ;CHK ; checks to see if the patient is on the recall list for the clinic and provider date MBAA RPC: MBAA ADD TO RECALL LIST
"RTN","MBAARPC2",141,0)
 ;S XX=0 F  S XX=$O(^SD(403.5,"B",DFN,XX)) Q:XX'>0  D  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",142,0)
 ;.;T13 Change to use FM
"RTN","MBAARPC2",143,0)
 ;.N ARRAY,ERR,C1,RD1,P1 D GETS^DIQ(403.5,XX_",","2;4,5","I","ARRAY","ERR")   ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",144,0)
 ;.S C1=$G(ARRAY(403.5,XX_",",2,"I")),RD1=$G(ARRAY(403.5,XX_",",5,"I")),P1=$G(ARRAY(403.5,XX_",",4,"I"))
"RTN","MBAARPC2",145,0)
 ;.I $G(C1)=CLINIC&($G(RD1)=RECALLDT)&($G(P1)=PROVIDER) S ERR=1
"RTN","MBAARPC2",146,0)
 ;.;S NODE=$G(^SD(403.5,XX,0))  ;ICR#: 6045 SD(403.5
"RTN","MBAARPC2",147,0)
 ;.;I ($P(NODE,"^",2)=CLINIC&($P(NODE,"^",6)=RECALLDT)&($P(NODE,"^",5)=PROVIDER)) S ERR=1
"RTN","MBAARPC2",148,0)
 ;I $G(ERR)>0 S ERR=1
"RTN","MBAARPC2",149,0)
 ;Q
"RTN","MBAARPC2",150,0)
 ;code below is not being used in the initial release of MBAA. It will be released at a later date in a future release of MBAA
"RTN","MBAARPC2",151,0)
 ;CLNRGHT(RV,CLN) ;
"RTN","MBAARPC2",152,0)
 ; N STATUS,RESULT S STATUS=$$CLNRGHT^MBAAMAP1(.RESULT,CLN)
"RTN","MBAARPC2",153,0)
 ; ;D MERGE^MBAAMRPC(.RV,.RESULT)
"RTN","MBAARPC2",154,0)
 ; S RV(0)=$G(RESULT)
"RTN","MBAARPC2",155,0)
 ; Q
"RTN","MBAARPC2",156,0)
NEWEWL(RV,SDWLD) ; ZLV EWL NEW
"RTN","MBAARPC2",157,0)
 N Y   ;alb/sat 4 - existing Y needs to be Newed
"RTN","MBAARPC2",158,0)
 I $G(SDWLD)="" S RV(0)="0^SDWLD List missing." Q
"RTN","MBAARPC2",159,0)
 S SDWLD("WLTYPE")=$P($G(SDWLD),"^",1)
"RTN","MBAARPC2",160,0)
 I SDWLD("WLTYPE")=""  S RV(0)="0^INVPARAM WLTYPE IS NULL" Q
"RTN","MBAARPC2",161,0)
 I $G(SDWLD("WLTYPE"))'>0!($G(SDWLD("WLTYPE"))'<5) S RV(0)="0^INVPARAM WLTYPE" Q
"RTN","MBAARPC2",162,0)
 S SDWLD("PATIENT")=$P($G(SDWLD),"^",2)
"RTN","MBAARPC2",163,0)
 I SDWLD("PATIENT")=""  S RV(0)="0^INVPARAM PATIENT IS NULL" Q
"RTN","MBAARPC2",164,0)
 S DFN=$G(SDWLD("PATIENT")) I '$D(^DPT(DFN,0)) S RV(0)="0^INVPARAM PATIENT DOESN'T EXIST." K DFN Q  ;ICR#: 6053 DPT
"RTN","MBAARPC2",165,0)
 S SDWLD("INSTITUTION")=$P($G(SDWLD),"^",3)
"RTN","MBAARPC2",166,0)
 I SDWLD("INSTITUTION")=""  S RV(0)="0^INVPARAM INSTITUTION IS NULL" Q
"RTN","MBAARPC2",167,0)
 N SITE S X=$G(SDWLD("INSTITUTION")) S SITE=$$IEN^XUMF(4,,X) I +$G(SITE)'>0 S RV(0)="0^INVPARAM INVALID INSTITUTION NUMBER." Q  ;ICR#:3795 XUMF
"RTN","MBAARPC2",168,0)
 S SDWLD("WAITFOR")=$P($G(SDWLD),"^",4)
"RTN","MBAARPC2",169,0)
 I SDWLD("WAITFOR")=""  S RV(0)="0^INVPARAM WAITFOR IS NULL" Q
"RTN","MBAARPC2",170,0)
 ;S ERR=0 D WFCK Q:$G(ERR)>0
"RTN","MBAARPC2",171,0)
 S SDWLD("PRIORITY")=$P($G(SDWLD),"^",5)
"RTN","MBAARPC2",172,0)
 I SDWLD("PRIORITY")=""  S RV(0)="0^INVPARAM PRIORITY IS NULL" Q
"RTN","MBAARPC2",173,0)
 I SDWLD("PRIORITY")'="A",(SDWLD("PRIORITY")'="F") S RV(0)="0^INVPARAM INVALID PRIORITY" Q
"RTN","MBAARPC2",174,0)
 S SDWLD("REQBY")=$P($G(SDWLD),"^",6)
"RTN","MBAARPC2",175,0)
 D REQBY
"RTN","MBAARPC2",176,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",177,0)
 S SDWLD("PROVIDER")=$P($G(SDWLD),"^",7)
"RTN","MBAARPC2",178,0)
 I SDWLD("PROVIDER")'="" D
"RTN","MBAARPC2",179,0)
 .N IEN S ERR=0,IEN=$G(SDWLD("PROVIDER"))
"RTN","MBAARPC2",180,0)
 .N JX S JX=$$GET1^DIQ(200,$G(IEN),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM PROVIDER IS NOT IN THE NEW PERSON FILE" Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",181,0)
 .;I '$D(^VA(200,IEN,0)) S ERR=1,RV(0)="0^INVPARAM PROVIDER IS NOT IN THE NEW PERSON FILE" Q  ;ICR#: 713 VA(200
"RTN","MBAARPC2",182,0)
 .I '$D(^XUSEC("PROVIDER",IEN)) S ERR=1,RV(0)="0^INVPARAM NOT A PROVIDER" Q  ;ICR#: 10076 XUSEC
"RTN","MBAARPC2",183,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",184,0)
 S SDWLD("SCPRCNT")=$P($G(SDWLD),"^",8)
"RTN","MBAARPC2",185,0)
 I SDWLD("SCPRCNT")'=""  D
"RTN","MBAARPC2",186,0)
 .S ERR=0 I SDWLD("SCPRCNT")'>0!(SDWLD("SCPRCNT")'<101) S ERR=1,RV(0)="0^INVPARAM SERVICE CONNECTED PERCENTAGE" Q
"RTN","MBAARPC2",187,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",188,0)
 S SDWLD("SCPRIORITY")=$P($G(SDWLD),"^",9)
"RTN","MBAARPC2",189,0)
 I SDWLD("SCPRIORITY")'=""  D
"RTN","MBAARPC2",190,0)
 .S ERR=0 I $G(SDWLD("SCPRIORITY"))'=0,($G(SDWLD("SCPRIORITY"))'=1) S ERR=1,RV(0)="0^INVPARAM INVALID PRIORITY" Q
"RTN","MBAARPC2",191,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",192,0)
 S SDWLD("DSRDDT")=$P($G(SDWLD),"^",10)
"RTN","MBAARPC2",193,0)
 I SDWLD("DSRDDT")=""  S RV(0)="0^INVPARAM DESIRED DATE OF APPOINTMENT IS NULL" Q
"RTN","MBAARPC2",194,0)
 S ERR=0,X=$G(SDWLD("DSRDDT")) D ^%DT I Y=-1 S ERR=0,RV(0)="0^INVPARAM NOT A VALID DATE" Q
"RTN","MBAARPC2",195,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",196,0)
 S SDWLD("CMNTS")=$P($G(SDWLD),"^",11)
"RTN","MBAARPC2",197,0)
 I SDWLD("CMNTS")'=""  D
"RTN","MBAARPC2",198,0)
 .I $L($G(SDWLD("CMNTS")))'>0!($L($G(SDWLD("CMNTS")))'<61) S ERR=1,RV(0)="0^INVPARAM COMMENTS ARE TOO LONG" Q
"RTN","MBAARPC2",199,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",200,0)
 S SDWLD("ENRSTAT")=$P($G(SDWLD),"^",12)
"RTN","MBAARPC2",201,0)
 I SDWLD("ENRSTAT")=""  S RV(0)="0^INVPARAM ENROLLEE STATUS IS NULL" Q
"RTN","MBAARPC2",202,0)
 S ERR=0 D ENRCHK Q:$G(ERR)=1
"RTN","MBAARPC2",203,0)
 S SDWLD("ENRDU")=$P($G(SDWLD),"^",13)
"RTN","MBAARPC2",204,0)
 I SDWLD("ENRDU")'=""  D
"RTN","MBAARPC2",205,0)
 .S ERR=0 S X=$G(SDWLD("ENRDU")) D ^%DT I $G(Y)=-1 S ERR=1,RV(0)="0^INVPARAM ENROLLEE DATE INVALID DATE" Q
"RTN","MBAARPC2",206,0)
 Q:$G(ERR)=1
"RTN","MBAARPC2",207,0)
 S SDWLD("ENRDF")=$P($G(SDWLD),"^",14)
"RTN","MBAARPC2",208,0)
 I SDWLD("ENRDF")'=""  D
"RTN","MBAARPC2",209,0)
 .S ERR=0 I $G(SDWLD("ENRDF"))'=0,($G(SDWLD("ENRDF"))'<5) S ERR=1,RV(0)="0^INVPARAM ENROLLEE DATABASE FILE" Q
"RTN","MBAARPC2",210,0)
 Q:ERR=1
"RTN","MBAARPC2",211,0)
 S SDWLD("TICKLER")=$P($G(SDWLD),"^",15)
"RTN","MBAARPC2",212,0)
 I SDWLD("TICKLER")'=""  D
"RTN","MBAARPC2",213,0)
 .S SDWLD("TICKLER")=$$UP^XLFSTR($G(SDWLD("TICKLER")))
"RTN","MBAARPC2",214,0)
 .S ERR=0 I $G(SDWLD("TICKLER"))'="Y" S ERR=1,RV(0)="0^INVPARAM TICKLER" Q
"RTN","MBAARPC2",215,0)
 Q:ERR=1
"RTN","MBAARPC2",216,0)
 S SDWLD("CHDCLINP")=$P($G(SDWLD),"^",16)
"RTN","MBAARPC2",217,0)
 I SDWLD("CHDCLINP")'=""  D
"RTN","MBAARPC2",218,0)
 .N APTR
"RTN","MBAARPC2",219,0)
 .S ERR=0,PTR=$G(SDWLD("CHDCLINP")) I '$D(^SDWL(409.3,PTR,0)) S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS NOT VALID" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",220,0)
 .;T13 Change to use FM
"RTN","MBAARPC2",221,0)
 .I $D(^SDWL(409.3,PTR,0)) S APTR=$$GET1^DIQ(409.3,PTR_",",".01","I") I APTR'=SDWLD("PATIENT") S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS FOR A DIFFERENT PATIENT" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",222,0)
 .;I $D(^SDWL(409.3,PTR,0)) S APTR=$P(^SDWL(409.3,PTR,0),"^",1) I APTR'=SDWLD("PATIENT") S ERR=1,RV(0)="0^INVPARAM CHANGED CLINIC PARENT POINTER IS FOR A DIFFERENT PATIENT" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",223,0)
 .K APTR
"RTN","MBAARPC2",224,0)
 Q:ERR=1
"RTN","MBAARPC2",225,0)
 I SDWLD("WLTYPE")=3!(SDWLD("WLTYPE")=4) D
"RTN","MBAARPC2",226,0)
 .K ERR S ERR=0
"RTN","MBAARPC2",227,0)
 .I SDWLD("REQBY")'=1,$G(SDWLD("REQBY"))'=2 S ERR=1
"RTN","MBAARPC2",228,0)
 I ERR=1 K ERR S RV(0)="0^INVPARAM REQBY" Q
"RTN","MBAARPC2",229,0)
 N STATUS,RESULT S STATUS=$$NEW^MBAAWLAP(.RESULT,.SDWLD)
"RTN","MBAARPC2",230,0)
 I 'STATUS S RV=-1
"RTN","MBAARPC2",231,0)
 I $G(STATUS) S RV(0)=1
"RTN","MBAARPC2",232,0)
 K ERR,X,IEN,DFN,PTR,CHK,TYPE,REQBY
"RTN","MBAARPC2",233,0)
 Q
"RTN","MBAARPC2",234,0)
 ;WFCK ; Check to make sure the pointer is valid for the Waitfor parameter
"RTN","MBAARPC2",235,0)
 ;N PTR S PTR=$G(SDWLD("WAITFOR")),ERR=0
"RTN","MBAARPC2",236,0)
 ;I SDWLD("WLTYPE")=1 D
"RTN","MBAARPC2",237,0)
 ;.;I '$D(^SCTM(404.51,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID TEAM" Q  ;ICR#: 1945 DBIA 1945
"RTN","MBAARPC2",238,0)
 ;.N JX S JX=$$GET1^DIQ(404.51,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID TEAM" Q  ;ICR#: 1945 DBIA 1945
"RTN","MBAARPC2",239,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",240,0)
 ;I SDWLD("WLTYPE")=2 D
"RTN","MBAARPC2",241,0)
 ;.;I '$D(^SCTM(404.57,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID POSITION" Q  ;ICR#: 6064 MBAA ACCESS TO SCTM(404.57
"RTN","MBAARPC2",242,0)
 ;.N JX S JX=$$GET1^DIQ(404.57,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID POSITION" Q  ;ICR#: 6064 MBAA ACCESS TO SCTM(404.57
"RTN","MBAARPC2",243,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",244,0)
 ;I SDWLD("WLTYPE")=3 D
"RTN","MBAARPC2",245,0)
 ;.;I '$D(^SDWL(409.31,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID SPECIALTY" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",246,0)
 ;.N JX S JX=$$GET1^DIQ(409.31,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID SPECIALTY" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",247,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",248,0)
 ;I SDWLD("WLTYPE")=4 D
"RTN","MBAARPC2",249,0)
 ;.;I '$D(^SDWL(409.32,PTR,0)) S ERR=1,RV(0)="0^INVPARAM INVALID WAIT LIST CLINIC" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",250,0)
 ;.N JX S JX=$$GET1^DIQ(409.32,$G(PTR),.01) I $G(JX)="" S ERR=1,RV(0)="0^INVPARAM INVALID WAIT LIST CLINIC" Q  ;ICR#: 6046 SDWL(409.3
"RTN","MBAARPC2",251,0)
 ;Q:$G(ERR)>0
"RTN","MBAARPC2",252,0)
 ;I SDWLD("WLTYPE")>5 S RV(0)="0^INVPARAM WAIT LIST TYPE" Q
"RTN","MBAARPC2",253,0)
 ;Q
"RTN","MBAARPC2",254,0)
ENRCHK ; Check enrollee status codes - must be either N, E, P or U
"RTN","MBAARPC2",255,0)
 S CHK=$G(SDWLD("ENRSTAT"))
"RTN","MBAARPC2",256,0)
 I CHK'="N",(CHK'="E"),(CHK'="P"),(CHK'="U") S ERR=1,RV(0)="0^INVPARAM INVALID ENROLLEE STATUS" Q
"RTN","MBAARPC2",257,0)
 Q
"RTN","MBAARPC2",258,0)
REQBY ; Checksto be sure a correct value for the REQBY parameter is correct based on the Wait List Type
"RTN","MBAARPC2",259,0)
 S ERR=0,TYPE=$G(SDWLD("WLTYPE")),REQBY=$G(SDWLD("REQBY"))
"RTN","MBAARPC2",260,0)
 I $G(REQBY)'=1,($G(REQBY)'=2),($G(REQBY)'="") S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",261,0)
 I $G(REQBY)'=""  D
"RTN","MBAARPC2",262,0)
 .I TYPE=3,(TYPE=4) D
"RTN","MBAARPC2",263,0)
 ..I REQBY'=1,(REQBY'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",264,0)
 .I TYPE=1,(TYPE=2) D
"RTN","MBAARPC2",265,0)
 ..I REQBY=1,(REQBY'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",266,0)
 I $G(REQBY)="" D
"RTN","MBAARPC2",267,0)
 .I TYPE'=1,(TYPE'=2) S ERR=1,RV(0)="0^INVPARAM INVALID REQBY" Q
"RTN","MBAARPC2",268,0)
 Q
"VER")
8.0^22.0
"BLD",10313,6)
^3
**END**
**END**

