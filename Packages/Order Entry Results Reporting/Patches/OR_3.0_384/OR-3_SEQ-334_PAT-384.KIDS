Released OR*3*384 SEQ #334
Extracted from mail message
**KIDS**:OR*3.0*384^

**INSTALL NAME**
OR*3.0*384
"BLD",8910,0)
OR*3.0*384^ORDER ENTRY/RESULTS REPORTING^0^3131219^y
"BLD",8910,4,0)
^9.64PA^^
"BLD",8910,6.3)
2
"BLD",8910,"KRN",0)
^9.67PA^779.2^20
"BLD",8910,"KRN",.4,0)
.4
"BLD",8910,"KRN",.401,0)
.401
"BLD",8910,"KRN",.402,0)
.402
"BLD",8910,"KRN",.403,0)
.403
"BLD",8910,"KRN",.5,0)
.5
"BLD",8910,"KRN",.84,0)
.84
"BLD",8910,"KRN",3.6,0)
3.6
"BLD",8910,"KRN",3.8,0)
3.8
"BLD",8910,"KRN",9.2,0)
9.2
"BLD",8910,"KRN",9.8,0)
9.8
"BLD",8910,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8910,"KRN",9.8,"NM",1,0)
ORDSGCHK^^0^B102045357
"BLD",8910,"KRN",9.8,"NM","B","ORDSGCHK",1)

"BLD",8910,"KRN",19,0)
19
"BLD",8910,"KRN",19.1,0)
19.1
"BLD",8910,"KRN",101,0)
101
"BLD",8910,"KRN",409.61,0)
409.61
"BLD",8910,"KRN",771,0)
771
"BLD",8910,"KRN",779.2,0)
779.2
"BLD",8910,"KRN",870,0)
870
"BLD",8910,"KRN",8989.51,0)
8989.51
"BLD",8910,"KRN",8989.52,0)
8989.52
"BLD",8910,"KRN",8994,0)
8994
"BLD",8910,"KRN","B",.4,.4)

"BLD",8910,"KRN","B",.401,.401)

"BLD",8910,"KRN","B",.402,.402)

"BLD",8910,"KRN","B",.403,.403)

"BLD",8910,"KRN","B",.5,.5)

"BLD",8910,"KRN","B",.84,.84)

"BLD",8910,"KRN","B",3.6,3.6)

"BLD",8910,"KRN","B",3.8,3.8)

"BLD",8910,"KRN","B",9.2,9.2)

"BLD",8910,"KRN","B",9.8,9.8)

"BLD",8910,"KRN","B",19,19)

"BLD",8910,"KRN","B",19.1,19.1)

"BLD",8910,"KRN","B",101,101)

"BLD",8910,"KRN","B",409.61,409.61)

"BLD",8910,"KRN","B",771,771)

"BLD",8910,"KRN","B",779.2,779.2)

"BLD",8910,"KRN","B",870,870)

"BLD",8910,"KRN","B",8989.51,8989.51)

"BLD",8910,"KRN","B",8989.52,8989.52)

"BLD",8910,"KRN","B",8994,8994)

"BLD",8910,"QUES",0)
^9.62^^
"BLD",8910,"REQB",0)
^9.611^1^1
"BLD",8910,"REQB",1,0)
OR*3.0*311^2
"BLD",8910,"REQB","B","OR*3.0*311",1)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
384^3131219
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORDSGCHK")
0^1^B102045357^B109034124
"RTN","ORDSGCHK",1,0)
ORDSGCHK ; SLC/AGP - PRE 0.5 DOSE ORDER CHECKS;04/03/13  09:01 ;12/18/13  08:13
"RTN","ORDSGCHK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**280,352,345,311,384**;Dec 17, 1997;Build 2
"RTN","ORDSGCHK",3,0)
 ;
"RTN","ORDSGCHK",4,0)
EN(ORY,DFN,TYPE,OIL) ;
"RTN","ORDSGCHK",5,0)
 N ARRAY,CNT,NAME
"RTN","ORDSGCHK",6,0)
 ;if renewed order build OIL array
"RTN","ORDSGCHK",7,0)
 I $G(ORREN)=1,+$G(ORIFN)>0 D
"RTN","ORDSGCHK",8,0)
 .;IV orders should only have a null type
"RTN","ORDSGCHK",9,0)
 .I TYPE="" S TYPE="PSIV"
"RTN","ORDSGCHK",10,0)
 .D BLDREN(TYPE,ORIFN,.OIL)
"RTN","ORDSGCHK",11,0)
 ;Build easy array to work with
"RTN","ORDSGCHK",12,0)
 S CNT=0 F  S CNT=$O(OIL(CNT)) Q:CNT'>0  D
"RTN","ORDSGCHK",13,0)
 .S NODE=$G(OIL(CNT)) Q:$P(NODE,U,2)="PSIV"
"RTN","ORDSGCHK",14,0)
 .S NAME=$P(NODE,U,2)
"RTN","ORDSGCHK",15,0)
 .Q:'$P(NODE,U,3)
"RTN","ORDSGCHK",16,0)
 .S ARRAY(NAME,$P(NODE,U,3))=NODE
"RTN","ORDSGCHK",17,0)
 I TYPE="PSH" Q
"RTN","ORDSGCHK",18,0)
 I TYPE="PSIV" D IV(.ORY,DFN,.ARRAY)
"RTN","ORDSGCHK",19,0)
 I TYPE'="PSIV" D NONIV(.ORY,DFN,.ARRAY)
"RTN","ORDSGCHK",20,0)
 Q
"RTN","ORDSGCHK",21,0)
 ;
"RTN","ORDSGCHK",22,0)
BLDREN(TYPE,ORIFN,OUT) ;
"RTN","ORDSGCHK",23,0)
 N CNT,EXTVALUE,ISOI,ITEM,LOC,NAME,NUM,NODE,ORDIALOG,TEXT,VALUE,X0
"RTN","ORDSGCHK",24,0)
 S CNT=$O(OUT(""),-1)
"RTN","ORDSGCHK",25,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","ORDSGCHK",26,0)
 S ORDIALOG=+$P(X0,U,5)
"RTN","ORDSGCHK",27,0)
 D GETDLG^ORCD(ORDIALOG)
"RTN","ORDSGCHK",28,0)
 D GETORDER^ORCD(+ORIFN)
"RTN","ORDSGCHK",29,0)
 S LOC=0 F  S LOC=$O(ORDIALOG(LOC)) Q:LOC'>0  D
"RTN","ORDSGCHK",30,0)
 .S ITEM=$P($G(ORDIALOG(LOC)),U,2)
"RTN","ORDSGCHK",31,0)
 .I ITEM="" Q
"RTN","ORDSGCHK",32,0)
 .I ITEM="COMMENT" Q
"RTN","ORDSGCHK",33,0)
 .S ISOI=$S($G(ORDIALOG(LOC,0))[101.43:1,1:0)
"RTN","ORDSGCHK",34,0)
 .S NUM=0 F  S NUM=$O(ORDIALOG(LOC,NUM)) Q:NUM'>0  D
"RTN","ORDSGCHK",35,0)
 ..I NUM<1 Q
"RTN","ORDSGCHK",36,0)
 ..S VALUE=$G(ORDIALOG(LOC,NUM)),EXTVALUE=""
"RTN","ORDSGCHK",37,0)
 ..I ISOI=1 D
"RTN","ORDSGCHK",38,0)
 ...S EXTVALUE=$P($G(^ORD(101.43,VALUE,0)),U)
"RTN","ORDSGCHK",39,0)
 ...I $P($G(^ORD(101.41,LOC,0)),U)="OR GTX ADDITIVE" S ITEM="ADDITIVE"
"RTN","ORDSGCHK",40,0)
 ..I ITEM="RATE" S EXTVALUE=VALUE
"RTN","ORDSGCHK",41,0)
 ..S TEXT=TYPE_U_ITEM_U_NUM_U_VALUE_U_EXTVALUE
"RTN","ORDSGCHK",42,0)
 ..S CNT=CNT+1,OUT(CNT)=TEXT
"RTN","ORDSGCHK",43,0)
 Q
"RTN","ORDSGCHK",44,0)
 ;
"RTN","ORDSGCHK",45,0)
DURATION(STR) ;
"RTN","ORDSGCHK",46,0)
 N LEN,VAL,UNIT,IVLMT,TVAL
"RTN","ORDSGCHK",47,0)
 S (UNIT,IVLMT)="",VAL=0
"RTN","ORDSGCHK",48,0)
 I $E($$LOW^XLFSTR(STR))="f" D
"RTN","ORDSGCHK",49,0)
 . I STR["for a total of" D  Q
"RTN","ORDSGCHK",50,0)
 . .S VAL=$P(STR," ",5)
"RTN","ORDSGCHK",51,0)
 . .S UNIT=$P(STR," ",6)
"RTN","ORDSGCHK",52,0)
 . .S STR=""
"RTN","ORDSGCHK",53,0)
 . S VAL=$P(STR," ",2)
"RTN","ORDSGCHK",54,0)
 . S UNIT=$E($P(STR," ",3))
"RTN","ORDSGCHK",55,0)
 . S STR=""
"RTN","ORDSGCHK",56,0)
 I $E($$LOW^XLFSTR(STR))="w" D
"RTN","ORDSGCHK",57,0)
 . S TVAL=$P(STR," ",4)
"RTN","ORDSGCHK",58,0)
 . S VAL=+TVAL
"RTN","ORDSGCHK",59,0)
 . S LEN=$F(TVAL,VAL)
"RTN","ORDSGCHK",60,0)
 . I $P(VAL,".")="" S VAL=0_VAL
"RTN","ORDSGCHK",61,0)
 . F  S UNIT=$E(TVAL,LEN) Q:((UNIT'=0)&(UNIT'="."))  D
"RTN","ORDSGCHK",62,0)
 . . S LEN=LEN+1
"RTN","ORDSGCHK",63,0)
 . S STR=""
"RTN","ORDSGCHK",64,0)
 I $L(UNIT),$L(VAL) S IVLMT=VAL_$$UP^XLFSTR(UNIT)
"RTN","ORDSGCHK",65,0)
 I STR'="",IVLMT="" D
"RTN","ORDSGCHK",66,0)
 .I STR["ML" S IVLMT=$P(STR,"M")_"M" Q
"RTN","ORDSGCHK",67,0)
 .I STR["CC" S IVLMT=$P(STR,"C")_"M" Q
"RTN","ORDSGCHK",68,0)
 .S IVLMT=STR
"RTN","ORDSGCHK",69,0)
 Q IVLMT
"RTN","ORDSGCHK",70,0)
 ;
"RTN","ORDSGCHK",71,0)
IV(ORY,DFN,ARRAY) ;
"RTN","ORDSGCHK",72,0)
 N CNT,DRUG,DRUGIEN,DRUGNAME,NAME,NUM,OI,ORBASE,ORPSJARR,STR,STRENGTH
"RTN","ORDSGCHK",73,0)
 ;
"RTN","ORDSGCHK",74,0)
 ;populate single values from order
"RTN","ORDSGCHK",75,0)
 S ORPSJARR("TVOL_DUR")="",ORPSJARR("SCHEDULE")=""
"RTN","ORDSGCHK",76,0)
 I $D(ARRAY("DAYS")) S ORPSJARR("TVOL_DUR")=$$DURATION($P(ARRAY("DAYS",1),U,4))
"RTN","ORDSGCHK",77,0)
 ;S RATE=$P(ARRAY(NAME,1),U,4)
"RTN","ORDSGCHK",78,0)
 S ORPSJARR("MR_IEN")=$P(ARRAY("ROUTE",1),U,4)
"RTN","ORDSGCHK",79,0)
 I $D(ARRAY("SCHEDULE")) S ORPSJARR("SCHEDULE")=$P(ARRAY("SCHEDULE",1),U,4)
"RTN","ORDSGCHK",80,0)
 S ORPSJARR("IV_TYPE")=$S($P(ARRAY("TYPE",1),U,4)="I":1,1:2)
"RTN","ORDSGCHK",81,0)
 I ORPSJARR("IV_TYPE")=2 S ORPSJARR("INF_RATE")=$P(ARRAY("RATE",1),U,5)
"RTN","ORDSGCHK",82,0)
 ;
"RTN","ORDSGCHK",83,0)
 ;build additive first, Drug, Strength/unit, bag
"RTN","ORDSGCHK",84,0)
 F NAME="ADDITIVE","ORDERABLE" D
"RTN","ORDSGCHK",85,0)
 .K DRUG
"RTN","ORDSGCHK",86,0)
 .S CNT=0,NUM=0
"RTN","ORDSGCHK",87,0)
 .F  S NUM=$O(ARRAY(NAME,NUM)) Q:NUM'>0  D
"RTN","ORDSGCHK",88,0)
 ..S CNT=CNT+1
"RTN","ORDSGCHK",89,0)
 ..S NODE=$G(ARRAY(NAME,NUM)),OI=$P(NODE,U,4)
"RTN","ORDSGCHK",90,0)
 ..;
"RTN","ORDSGCHK",91,0)
 ..S DRUGIEN=+$P(^ORD(101.43,OI,0),U,2) I DRUGIEN="" Q  ;PHARMACY OI FROM 101.43
"RTN","ORDSGCHK",92,0)
 ..S DRUGNAME=$P($G(ARRAY(NAME,NUM)),U,5) ;OI NAME
"RTN","ORDSGCHK",93,0)
 ..;
"RTN","ORDSGCHK",94,0)
 ..I NAME="ADDITIVE" D  Q
"RTN","ORDSGCHK",95,0)
 ...S STRENGTH=$P($G(ARRAY("STRENGTH",NUM)),U,4)_" "_$P($G(ARRAY("UNITS",NUM)),U,4)
"RTN","ORDSGCHK",96,0)
 ...S STR=+DRUGIEN_U_DRUGNAME_U_STRENGTH_U_$P($G(ARRAY("ADDFREQ",NUM)),U,4)
"RTN","ORDSGCHK",97,0)
 ...S ORPSJARR("AD",CNT)=STR_U_0
"RTN","ORDSGCHK",98,0)
 ...;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",99,0)
 ...I $G(^TMP($J,"ORENHCHK"))=1 S ORPSJARR("AD",CNT)=STR_U_1
"RTN","ORDSGCHK",100,0)
 ..;
"RTN","ORDSGCHK",101,0)
 ..;Soltution information
"RTN","ORDSGCHK",102,0)
 ..S STR=+DRUGIEN_U_DRUGNAME_U_$P($G(ARRAY("VOLUME",NUM)),U,4)_" ML"
"RTN","ORDSGCHK",103,0)
 ..S ORPSJARR("SOL",CNT)=STR,$P(ORPSJARR("SOL",CNT),U,5)=0
"RTN","ORDSGCHK",104,0)
 ..;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",105,0)
 ..I $G(^TMP($J,"ORENHCHK"))=1 S ORPSJARR("SOL",CNT)=STR,$P(ORPSJARR("SOL",CNT),U,5)=1
"RTN","ORDSGCHK",106,0)
 ;
"RTN","ORDSGCHK",107,0)
 I $D(^TMP($J,"ORDSGCHK_CACHE")) M ^TMP($J,"ORDSGCHK2")=^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORDSGCHK",108,0)
 I '$D(^TMP($J,"ORDSGCHK_CACHE")) D
"RTN","ORDSGCHK",109,0)
 .S ORBASE(1)="ORDSGCHK1"
"RTN","ORDSGCHK",110,0)
 .S ORBASE(2)="ORDSGCHK2"
"RTN","ORDSGCHK",111,0)
 .D DOSE^PSJAPIDS(.ORBASE,DFN,.ORPSJARR)
"RTN","ORDSGCHK",112,0)
 .M ^TMP($J,"ORDSGCHK_CACHE")=^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",113,0)
 D PARSEOUT
"RTN","ORDSGCHK",114,0)
 K ^TMP($J,"ORDSGCHK1"),^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",115,0)
 Q
"RTN","ORDSGCHK",116,0)
 ;
"RTN","ORDSGCHK",117,0)
NONIV(ORY,DFN,ARRAY) ;
"RTN","ORDSGCHK",118,0)
 N CNT,DOSESTR,DRUG,DRUGARR,DRUGIEN,DRUGNAME,DUR,NAME,NODE
"RTN","ORDSGCHK",119,0)
 N OIIEN,ORBASE,ORDRUG,ORPSARR,PACK,PSNODE,SUB,TYPE,USAGE
"RTN","ORDSGCHK",120,0)
 ;
"RTN","ORDSGCHK",121,0)
 ;assume same drug type used throughout the order dialog
"RTN","ORDSGCHK",122,0)
 ;free text dose do not have a drug.
"RTN","ORDSGCHK",123,0)
 S DRUGIEN=$P($G(ARRAY("DRUG",1)),U,4)
"RTN","ORDSGCHK",124,0)
 I +DRUGIEN>0,$$EXMT^PSSDSAPI(DRUGIEN)=1 Q
"RTN","ORDSGCHK",125,0)
 ;if no ARRAY(DOSE) node set it to null to force free text evaluation
"RTN","ORDSGCHK",126,0)
 ;I '$D(ARRAY("DOSE")),$D(ARRAY("INSTR")) N I S I=0 F  S I=$O(ARRAY("INSTR",I)) Q:'I  S ARRAY("DOSE",I)=$P(ARRAY("INSTR",I),U)_"^DOSE^"_I_"^"
"RTN","ORDSGCHK",127,0)
 N I S I=0 F  S I=$O(ARRAY("INSTR",I)) Q:'I  I '$D(ARRAY("DOSE",I))  S ARRAY("DOSE",I)=$P(ARRAY("INSTR",I),U)_"^DOSE^"_I_"^"
"RTN","ORDSGCHK",128,0)
 ;
"RTN","ORDSGCHK",129,0)
 S NAME="" F  S NAME=$O(ARRAY(NAME)) Q:NAME=""  D
"RTN","ORDSGCHK",130,0)
 .S SUB=$$GETSUB(NAME) I SUB="" Q
"RTN","ORDSGCHK",131,0)
 .S CNT=0 F  S CNT=$O(ARRAY(NAME,CNT)) Q:CNT'>0  D
"RTN","ORDSGCHK",132,0)
 ..S NODE=$G(ARRAY(NAME,CNT))
"RTN","ORDSGCHK",133,0)
 ..;
"RTN","ORDSGCHK",134,0)
 ..;get dose information and drug information from Dose Prompt
"RTN","ORDSGCHK",135,0)
 ..I SUB="DOSE" D
"RTN","ORDSGCHK",136,0)
 ...S PACK=$P(NODE,U)
"RTN","ORDSGCHK",137,0)
 ...S TYPE=$S($P(NODE,U)="PSO":"O",1:"I")
"RTN","ORDSGCHK",138,0)
 ...S DOSESTR=$P(NODE,U,4)
"RTN","ORDSGCHK",139,0)
 ...;free text dose
"RTN","ORDSGCHK",140,0)
 ...I DOSESTR="" D
"RTN","ORDSGCHK",141,0)
 ....S ARRAY("ORPSA",CNT)=$$OI2DD^ORKPS($P(ARRAY("ORDERABLE",1),U,4),$E($P(ARRAY("ORDERABLE",1),U,1),3),2)
"RTN","ORDSGCHK",142,0)
 ....Q:'$P(ARRAY("ORPSA",CNT),";",1)
"RTN","ORDSGCHK",143,0)
 ....S OIIEN=$P($G(ARRAY("ORDERABLE",1)),U,4) ;orderable only exists for first item (in complex order)
"RTN","ORDSGCHK",144,0)
 ....S ORDRUG("OI")=+$P($G(^ORD(101.43,OIIEN,0)),U,2)
"RTN","ORDSGCHK",145,0)
 ....S ORDRUG("PACKAGE")=$S(PACK="PSO":"O",PACK="PSH":"X",1:"I")
"RTN","ORDSGCHK",146,0)
 ....S PSNODE=$G(^ORD(101.43,OIIEN,"PS")),USAGE=""
"RTN","ORDSGCHK",147,0)
 ....I $P(PSNODE,U,4)=1 S USAGE=USAGE_"A"
"RTN","ORDSGCHK",148,0)
 ....I $P(PSNODE,U,3)=1 S USAGE=USAGE_"B"
"RTN","ORDSGCHK",149,0)
 ....S ORDRUG("OI_USAGE")=USAGE
"RTN","ORDSGCHK",150,0)
 ....S ORPSARR(CNT,"DO")=$P($G(ARRAY("INSTR",CNT)),U,4)
"RTN","ORDSGCHK",151,0)
 ....S ORDRUG(CNT,"DRUG_NM")=$$TRIM^ORBCMA32($P($G(ARRAY("ORDERABLE",1)),U,5))
"RTN","ORDSGCHK",152,0)
 ....S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",153,0)
 ...;
"RTN","ORDSGCHK",154,0)
 ...;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",155,0)
 ...I $G(^TMP($J,"ORENHCHK"))=1,((DOSESTR=""&$D(ORDRUG))!(DOSESTR'="")) S ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",156,0)
 ...Q:DOSESTR=""
"RTN","ORDSGCHK",157,0)
 ...S DRUGIEN=$P(DOSESTR,"&",6)
"RTN","ORDSGCHK",158,0)
 ...K ^TMP($J,"DRUGARR")
"RTN","ORDSGCHK",159,0)
 ...D ZERO^PSS50(DRUGIEN,,,,,"DRUGARR")
"RTN","ORDSGCHK",160,0)
 ...S DRUGNAME=$G(^TMP($J,"DRUGARR",DRUGIEN,.01))
"RTN","ORDSGCHK",161,0)
 ...K ^TMP($J,"DRUGARR")
"RTN","ORDSGCHK",162,0)
 ...;
"RTN","ORDSGCHK",163,0)
 ...;Local Possible Dose
"RTN","ORDSGCHK",164,0)
 ...I $P(DOSESTR,"&")="" D  Q
"RTN","ORDSGCHK",165,0)
 ....S ORPSARR(CNT,"DO")=$P($G(ARRAY("INSTR",CNT)),U,4)
"RTN","ORDSGCHK",166,0)
 ....S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",167,0)
 ....S ORDRUG(CNT,"DRUG_IEN")=DRUGIEN
"RTN","ORDSGCHK",168,0)
 ....S ORDRUG(CNT,"DRUG_NM")=$$GETPSNM^ORKPS(DRUGIEN) ;DRUGNAME
"RTN","ORDSGCHK",169,0)
 ...;
"RTN","ORDSGCHK",170,0)
 ...;Possible Dose
"RTN","ORDSGCHK",171,0)
 ...S ORPSARR(CNT,"DRG_AMT")=$P(DOSESTR,"&")
"RTN","ORDSGCHK",172,0)
 ...S ORPSARR(CNT,"DRG_UNIT")=$P(DOSESTR,"&",2)
"RTN","ORDSGCHK",173,0)
 ...S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",174,0)
 ...S ORDRUG(CNT,"DRUG_IEN")=DRUGIEN
"RTN","ORDSGCHK",175,0)
 ...S ORDRUG(CNT,"DRUG_NM")=$$GETPSNM^ORKPS(DRUGIEN) ;DRUGNAME
"RTN","ORDSGCHK",176,0)
 ..;
"RTN","ORDSGCHK",177,0)
 ..;Additional Order Data
"RTN","ORDSGCHK",178,0)
 ..I SUB="DRATE" D  Q
"RTN","ORDSGCHK",179,0)
 ...S DUR=$P($P(NODE,U,4)," ")
"RTN","ORDSGCHK",180,0)
 ...S ORPSARR(CNT,SUB)=DUR_$$DRATESTR($P($P(NODE,U,4)," ",2))
"RTN","ORDSGCHK",181,0)
 ..S ORPSARR(CNT,SUB)=$P(NODE,U,4)
"RTN","ORDSGCHK",182,0)
 ;
"RTN","ORDSGCHK",183,0)
 ;Get rid of any preceeding or trailing spaces on the dose
"RTN","ORDSGCHK",184,0)
 N ORSPI S ORSPI=0 F  S ORSPI=$O(ORPSARR(ORSPI)) Q:'ORSPI  D
"RTN","ORDSGCHK",185,0)
 .I $D(ORPSARR(ORSPI,"DO")) S ORPSARR(ORSPI,"DO")=$$TRIM^XLFSTR(ORPSARR(ORSPI,"DO"))
"RTN","ORDSGCHK",186,0)
 ;
"RTN","ORDSGCHK",187,0)
 I $D(ORDRUG) D
"RTN","ORDSGCHK",188,0)
 .S ORBASE(1)="ORDSGCHK1",ORBASE(2)="ORDSGCHK2"
"RTN","ORDSGCHK",189,0)
 .D DOSE^PSSDSAPD(.ORBASE,DFN,.ORPSARR,.ORDRUG),PARSEOUT
"RTN","ORDSGCHK",190,0)
 .K ^TMP($J,"ORDSGCHK1"),^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",191,0)
 Q
"RTN","ORDSGCHK",192,0)
 ;
"RTN","ORDSGCHK",193,0)
PARSEOUT ;PARSE OUTPUT GLOBAL
"RTN","ORDSGCHK",194,0)
 N ORNBP S ORNBP=""
"RTN","ORDSGCHK",195,0)
 I $D(^TMP($J,"ORDSGCHK2")) D
"RTN","ORDSGCHK",196,0)
 .I $P($G(^TMP($J,"ORDSGCHK2","OUT",0)),U)=-1 S ORNBP=$$DSDWNMSG^ORDSGCHK Q
"RTN","ORDSGCHK",197,0)
 .I $D(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR")) D
"RTN","ORDSGCHK",198,0)
 ..N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",199,0)
 ...N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",200,0)
 .... I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"MSG"))) S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"MSG") D
"RTN","ORDSGCHK",201,0)
 ..... I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"TEXT"))) S ORY(ORY)=ORY(ORY)_".  "_$G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"TEXT"))
"RTN","ORDSGCHK",202,0)
 .I $D(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE")) D
"RTN","ORDSGCHK",203,0)
 ..N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",204,0)
 ...N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",205,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["could not be performed" S ORNBP=^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",206,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["Error Summary" S ORNBP=^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",207,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["Reason(s):" S ORNBP=ORNBP_"."_^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",208,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["           " S ORNBP=ORNBP_"."_$P(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J),"           ",2) Q
"RTN","ORDSGCHK",209,0)
 .... I $L(ORNBP)>1 S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_ORNBP,ORNBP=""
"RTN","ORDSGCHK",210,0)
 .... I $L($G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))) S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J)
"RTN","ORDSGCHK",211,0)
 .N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",212,0)
 ..Q:(I="ERROR")
"RTN","ORDSGCHK",213,0)
 ..N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",214,0)
 ...N TYP S TYP="" F  S TYP=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP)) Q:'$L(TYP)  D
"RTN","ORDSGCHK",215,0)
 ....N ORDIEN S ORDIEN=0 F  S ORDIEN=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN)) Q:'ORDIEN  D
"RTN","ORDSGCHK",216,0)
 .....I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN))) D
"RTN","ORDSGCHK",217,0)
 ......N OROCTYPE S OROCTYPE="DS"
"RTN","ORDSGCHK",218,0)
 ......I TYP="3_GENERAL" S OROCTYPE="ERR" N ORDIEN2 S ORDIEN2=0 F  S ORDIEN2=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN,ORDIEN2)) Q:'ORDIEN2  D
"RTN","ORDSGCHK",219,0)
 .......S ORY=$G(ORY)+1,ORY(ORY)=OROCTYPE_U_^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN,ORDIEN2)
"RTN","ORDSGCHK",220,0)
 ......Q:OROCTYPE="ERR"
"RTN","ORDSGCHK",221,0)
 ......S ORY=$G(ORY)+1,ORY(ORY)=OROCTYPE_U_^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN)
"RTN","ORDSGCHK",222,0)
 I $L(ORNBP)>1 S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_ORNBP,ORNBP=""
"RTN","ORDSGCHK",223,0)
 Q
"RTN","ORDSGCHK",224,0)
 ;
"RTN","ORDSGCHK",225,0)
GETSUB(NAME) ;
"RTN","ORDSGCHK",226,0)
 I NAME="CONJ" Q "CONJ"
"RTN","ORDSGCHK",227,0)
 I NAME="DAYS" Q "DRATE"
"RTN","ORDSGCHK",228,0)
 I NAME="DOSE" Q "DOSE"
"RTN","ORDSGCHK",229,0)
 I NAME="ROUTE" Q "MR_IEN"
"RTN","ORDSGCHK",230,0)
 I NAME="SCHEDULE" Q "SCHEDULE"
"RTN","ORDSGCHK",231,0)
 Q ""
"RTN","ORDSGCHK",232,0)
 ;
"RTN","ORDSGCHK",233,0)
DRATESTR(ORIN) ;change the form of the DURATION
"RTN","ORDSGCHK",234,0)
 ;DAYS=D,WEEKS=W,MONTHS=L,HOURS=H,MINUTES=M
"RTN","ORDSGCHK",235,0)
 I $$UP^XLFSTR(ORIN)="MONTHS" Q "L"
"RTN","ORDSGCHK",236,0)
 Q $E($$UP^XLFSTR(ORIN))
"RTN","ORDSGCHK",237,0)
 ;
"RTN","ORDSGCHK",238,0)
DSDWNMSG() ;dosage down message (not displayed to user)
"RTN","ORDSGCHK",239,0)
 Q "Drug Dosage checks were not able to be performed."
"VER")
8.0^22.0
"BLD",8910,6)
^334
**END**
**END**

