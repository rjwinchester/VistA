Released OR*3*493 SEQ #418
Extracted from mail message
**KIDS**:OR*3.0*493^

**INSTALL NAME**
OR*3.0*493
"BLD",11026,0)
OR*3.0*493^ORDER ENTRY/RESULTS REPORTING^0^3180803^y
"BLD",11026,4,0)
^9.64PA^^
"BLD",11026,6.3)
6
"BLD",11026,"ABPKG")
n
"BLD",11026,"KRN",0)
^9.67PA^779.2^20
"BLD",11026,"KRN",.4,0)
.4
"BLD",11026,"KRN",.401,0)
.401
"BLD",11026,"KRN",.402,0)
.402
"BLD",11026,"KRN",.403,0)
.403
"BLD",11026,"KRN",.5,0)
.5
"BLD",11026,"KRN",.84,0)
.84
"BLD",11026,"KRN",3.6,0)
3.6
"BLD",11026,"KRN",3.8,0)
3.8
"BLD",11026,"KRN",9.2,0)
9.2
"BLD",11026,"KRN",9.8,0)
9.8
"BLD",11026,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11026,"KRN",9.8,"NM",1,0)
ORQ20^^0^B53121386
"BLD",11026,"KRN",9.8,"NM","B","ORQ20",1)

"BLD",11026,"KRN",19,0)
19
"BLD",11026,"KRN",19.1,0)
19.1
"BLD",11026,"KRN",101,0)
101
"BLD",11026,"KRN",409.61,0)
409.61
"BLD",11026,"KRN",771,0)
771
"BLD",11026,"KRN",779.2,0)
779.2
"BLD",11026,"KRN",870,0)
870
"BLD",11026,"KRN",8989.51,0)
8989.51
"BLD",11026,"KRN",8989.52,0)
8989.52
"BLD",11026,"KRN",8994,0)
8994
"BLD",11026,"KRN","B",.4,.4)

"BLD",11026,"KRN","B",.401,.401)

"BLD",11026,"KRN","B",.402,.402)

"BLD",11026,"KRN","B",.403,.403)

"BLD",11026,"KRN","B",.5,.5)

"BLD",11026,"KRN","B",.84,.84)

"BLD",11026,"KRN","B",3.6,3.6)

"BLD",11026,"KRN","B",3.8,3.8)

"BLD",11026,"KRN","B",9.2,9.2)

"BLD",11026,"KRN","B",9.8,9.8)

"BLD",11026,"KRN","B",19,19)

"BLD",11026,"KRN","B",19.1,19.1)

"BLD",11026,"KRN","B",101,101)

"BLD",11026,"KRN","B",409.61,409.61)

"BLD",11026,"KRN","B",771,771)

"BLD",11026,"KRN","B",779.2,779.2)

"BLD",11026,"KRN","B",870,870)

"BLD",11026,"KRN","B",8989.51,8989.51)

"BLD",11026,"KRN","B",8989.52,8989.52)

"BLD",11026,"KRN","B",8994,8994)

"BLD",11026,"QUES",0)
^9.62^^
"BLD",11026,"REQB",0)
^9.611^1^1
"BLD",11026,"REQB",1,0)
OR*3.0*434^1
"BLD",11026,"REQB","B","OR*3.0*434",1)

"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
493^3180803
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORQ20")
0^1^B53121386^B51272743
"RTN","ORQ20",1,0)
ORQ20 ; SLC/MKB - Detailed Order Report cont ;8/17/2017
"RTN","ORQ20",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,92,94,116,141,177,186,190,215,243,434,493**;Dec 17, 1997;Build 6
"RTN","ORQ20",3,0)
ACT ; -- add Activity [from ^ORQ2]
"RTN","ORQ20",4,0)
 N ORACT,ORPACK,ORUCID S ORACT=$P(ACTION,U,2)
"RTN","ORQ20",5,0)
 I ORACT'="NW",$P(ACTION,U,4)=5,$P(ACTION,U,15)=13 Q  ;skip canc actions
"RTN","ORQ20",6,0)
 N NVA,USER S:$P(^ORD(100.98,$P(^OR(100,+ORIFN,0),U,11),0),U)="NON-VA MEDICATIONS" NVA=1
"RTN","ORQ20",7,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(ACTION,U))_"  "_$$ACTION(ORACT)
"RTN","ORQ20",8,0)
 I $P(ACTION,U,13) S @ORY@(CNT)=@ORY@(CNT)_" entered by "_$$USER(+$P(ACTION,U,13))
"RTN","ORQ20",9,0)
 I ORACT="NW" D  ;Show original order text
"RTN","ORQ20",10,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";1",80)
"RTN","ORQ20",11,0)
 . S ORPACK=$G(^OR(100,+ORIFN,4)) I $P(ORPACK,";",2)="GMRC" D  ;493
"RTN","ORQ20",12,0)
 . . S ORPACK=+ORPACK,ORUCID=$$GET1^DIQ(123,ORPACK,80)
"RTN","ORQ20",13,0)
 . . I ORUCID]"" S CNT=CNT+1,@ORY@(CNT)="     UCID:              "_ORUCID
"RTN","ORQ20",14,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ20",15,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",16,0)
 I ORACT="XX" D  ;Changed - show new text
"RTN","ORQ20",17,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";"_ORI,80)
"RTN","ORQ20",18,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Changed to:        "_$G(ORZ(1))
"RTN","ORQ20",19,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",20,0)
A1 I $P(ACTION,U,12) D  ;Nature of Order/Release
"RTN","ORQ20",21,0)
 . N ORZ S ORZ=$G(^ORD(100.02,+$P(ACTION,U,12),0))
"RTN","ORQ20",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Nature of Order:   "_$P(ORZ,U)
"RTN","ORQ20",23,0)
 . I $P(OR0,U,17),(ORACT="NW") Q  ;see event
"RTN","ORQ20",24,0)
 . I "^V^P^"[(U_$P(ORZ,U,2)_U),$P(ACTION,U,16) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",25,0)
 I $P(OR0,U,17)&(ORACT="NW") D  ;Delayed Release Event
"RTN","ORQ20",26,0)
 . N EVT,X,ORV,I S EVT=+$P(OR0,U,17),X=$$NAME^OREVNTX(EVT)
"RTN","ORQ20",27,0)
 . S:$E(X,1,8)="Delayed " X=$E(X,9,99)
"RTN","ORQ20",28,0)
 . I $G(^ORE(100.2,EVT,1)),'$P(ACTION,U,16) S X=X_" on "_$$DATE(+^(1))
"RTN","ORQ20",29,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Delayed Until:     "_X Q:'$P(ACTION,U,16)
"RTN","ORQ20",30,0)
 . D EVENT(.ORV) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_ORV(1)
"RTN","ORQ20",31,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",32,0)
A2 I $P(ACTION,U,5) S CNT=CNT+1,@ORY@(CNT)=$S($P(ACTION,U,4)=7:"      Dig",1:"     Elec")_" Signature:    "_$$USER(+$P(ACTION,U,5))_" on "_$$DATE($P(ACTION,U,6))
"RTN","ORQ20",33,0)
 I '$P(ACTION,U,5)!($P(ACTION,U,3)'=$P(ACTION,U,5)),'$$SERVCORR S CNT=CNT+1,@ORY@(CNT)="     "_$S($D(NVA):"Documented by:",1:"Ordered by:   ")_"     "_$$USER(+$P(ACTION,U,3))
"RTN","ORQ20",34,0)
 I '$P(ACTION,U,5),$L($P(ACTION,U,4)) D
"RTN","ORQ20",35,0)
 .I $P(ACTION,U,4)=0 D
"RTN","ORQ20",36,0)
 ..S USER=$$USER(+$P(ACTION,U,7))
"RTN","ORQ20",37,0)
 ..S CNT=CNT+1
"RTN","ORQ20",38,0)
 ..I USER'="" S @ORY@(CNT)="     Released by:       "_USER_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",39,0)
 ..I USER="" S @ORY@(CNT)="        Released:       "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",40,0)
 .S CNT=CNT+1,@ORY@(CNT)="     Signature:         "_$$SIG($P(ACTION,U,4)) ;186
"RTN","ORQ20",41,0)
 ;I '$P(ACTION,U,5),$L($P(ACTION,U,4)) S:$P(ACTION,U,4)=0 CNT=CNT+1,@ORY@(CNT)="     Released by:       "_$$USER(+$P(ACTION,U,7))_" on "_$$DATE($P(ACTION,U,16)) S CNT=CNT+1,@ORY@(CNT)="     Signature:         "_$$SIG($P(ACTION,U,4)) ;186
"RTN","ORQ20",42,0)
 I $P(ACTION,U,9) S CNT=CNT+1,@ORY@(CNT)="     Nurse Verified:    "_$S($P(ACTION,U,8):$$USER(+$P(ACTION,U,8))_" on ",1:"")_$$DATE($P(ACTION,U,9))
"RTN","ORQ20",43,0)
 I $P(ACTION,U,11) S CNT=CNT+1,@ORY@(CNT)="     Clerk Verified:    "_$S($P(ACTION,U,10):$$USER(+$P(ACTION,U,10))_" on ",1:"")_$$DATE($P(ACTION,U,11))
"RTN","ORQ20",44,0)
 I $P(ACTION,U,19) S CNT=CNT+1,@ORY@(CNT)="     Chart Reviewed:    "_$S($P(ACTION,U,18):$$USER(+$P(ACTION,U,18))_" on ",1:"")_$$DATE($P(ACTION,U,19))
"RTN","ORQ20",45,0)
A3 I $P(ACTION,U,2)="DC",$L(OR6) S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",46,0)
 I $L($G(^OR(100,ORIFN,8,ORI,1))) S X=^(1) D  ;add backdoor comments
"RTN","ORQ20",47,0)
 . N LBL,I S LBL=""
"RTN","ORQ20",48,0)
 . I $P(ACTION,U,15)="",$P(ACTION,U,2)'="DC" S LBL="     Comments:          " ;DC shown above
"RTN","ORQ20",49,0)
 . I $P(ACTION,U,15)=13,$P(ACTION,U,2)'="NW" S LBL="     Cancelled:         " ;NW shown in ORQ2
"RTN","ORQ20",50,0)
 . Q:'$L(LBL)  I $L(X)'>56 S CNT=CNT+1,@ORY@(CNT)=LBL_X Q
"RTN","ORQ20",51,0)
 . S DIWL=1,DIWR=56,DIWF="C56" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ20",52,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=LBL_^(I,0),LBL="                        "
"RTN","ORQ20",53,0)
 I $D(^OR(100,ORIFN,8,ORI,5)) D  ;Ward comments
"RTN","ORQ20",54,0)
 . N X,ORJ K ^UTILITY($J,"W")
"RTN","ORQ20",55,0)
 . S ORJ=0 F  S ORJ=$O(^OR(100,ORIFN,8,ORI,5,ORJ)) Q:ORJ'>0  S X=^(ORJ,0) D ^DIWP
"RTN","ORQ20",56,0)
 . S ORJ=0 F  S ORJ=$O(^UTILITY($J,"W",DIWL,ORJ)) Q:ORJ'>0  S CNT=CNT+1,@ORY@(CNT)=$S(ORJ=1:"     Ward/Clinic Cmmts: ",1:"                        ")_^(ORJ,0)
"RTN","ORQ20",57,0)
 . K ^UTILITY($J,"W")
"RTN","ORQ20",58,0)
A4 I $P(ACTION,U,2)="HD",$G(^OR(100,ORIFN,8,ORI,2)) S X2=^(2),CNT=CNT+1,@ORY@(CNT)="     Hold Released:     "_$$FMTE^XLFDT($P(X2,U),"2P")_" by "_$$USER($P(X2,U,2))
"RTN","ORQ20",59,0)
 I $D(^OR(100,ORIFN,8,ORI,3)) D  ;Un-/Flagged
"RTN","ORQ20",60,0)
 . N X S X=$G(^OR(100,ORIFN,8,ORI,3))
"RTN","ORQ20",61,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Flagged by:        "_$$USER(+$P(X,U,4))_" on "_$$DATE($P(X,U,3))
"RTN","ORQ20",62,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,5)
"RTN","ORQ20",63,0)
 . Q:X  S CNT=CNT+1,@ORY@(CNT)="     Unflagged by:      "_$$USER(+$P(X,U,7))_" on "_$$DATE($P(X,U,6))
"RTN","ORQ20",64,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,8)
"RTN","ORQ20",65,0)
A5 ;disposition/RTC Orders
"RTN","ORQ20",66,0)
 I $D(^OR(100,ORIFN,8,ORI,4)) D
"RTN","ORQ20",67,0)
 .N S S X=$G(^OR(100,ORIFN,8,ORI,4))
"RTN","ORQ20",68,0)
 .I +$P(X,U)>0 S CNT=CNT+1,@ORY@(CNT)="     Disposition by:    "_$$USER(+$P(X,U))_" on "_$$DATE($P(X,U,2))
"RTN","ORQ20",69,0)
 Q
"RTN","ORQ20",70,0)
 ;
"RTN","ORQ20",71,0)
DC ; -- Add Reason for DC
"RTN","ORQ20",72,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(OR6,U,3))_$S($P(OR6,U,8):"  Auto-",1:"  ")_"Discontinued"
"RTN","ORQ20",73,0)
 I $P(OR6,U,8) D  Q
"RTN","ORQ20",74,0)
 . N EVT,PKG,ORV,I
"RTN","ORQ20",75,0)
 . S EVT=$P(OR6,U,8),PKG=$P($G(^ORE(100.2,+EVT,3,ORIFN,0)),U,2)
"RTN","ORQ20",76,0)
 . S @ORY@(CNT)=@ORY@(CNT)_" by "_$S(PKG="FH":"DIETETICS",PKG="LR":"LABORATORY",PKG="PS":"PHARMACY",1:"CPRS")
"RTN","ORQ20",77,0)
 . D EVENT(.ORV,1) S CNT=CNT+1,@ORY@(CNT)="     Patient Movement:  "_ORV(1)
"RTN","ORQ20",78,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",79,0)
 I $P(OR6,U,2),$P($G(^ORD(100.02,+$P(OR6,U),0)),U,2)'="A" S @ORY@(CNT)=@ORY@(CNT)_" by "_$$USER($P(OR6,U,2)) ;don't show user name if auto-dc
"RTN","ORQ20",80,0)
 N X S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",81,0)
 Q
"RTN","ORQ20",82,0)
 ;
"RTN","ORQ20",83,0)
ACTION(CODE) ; -- Return name of action CODE
"RTN","ORQ20",84,0)
 N NAME S NAME=$S(CODE="NW":"New Order",CODE="DC":"Discontinue",CODE="HD":"Hold",CODE="RL":"Release Hold",CODE="RN":"Renewal",CODE="XX":"Change",1:"")
"RTN","ORQ20",85,0)
 I CODE="NW",$P(OR3,U,11) S NAME=NAME_$S($P(OR3,U,11)=1:" (Change)",$P(OR3,U,11)=2:" (Renewal)",1:"")
"RTN","ORQ20",86,0)
 Q NAME
"RTN","ORQ20",87,0)
 ;
"RTN","ORQ20",88,0)
XACT(X) ; -- Return name of transaction code X
"RTN","ORQ20",89,0)
 N Y S X=$G(X)
"RTN","ORQ20",90,0)
 S Y=$S(X="XX":"Edited",X="DC":"Discontinued",X="HD":"Held",X="RL":"Hold Released",X="FW":"Forwarded",X="CA":"Cancelled",1:"")
"RTN","ORQ20",91,0)
 Q Y
"RTN","ORQ20",92,0)
 ;
"RTN","ORQ20",93,0)
DATE(X) ; -- Return date formatted as 00/00/0000 00:00
"RTN","ORQ20",94,0)
 N T,Y  S T=$P(X,".",2)_"0000"
"RTN","ORQ20",95,0)
 S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","ORQ20",96,0)
 I T S Y=Y_" "_$E(T,1,2)_":"_$E(T,3,4)
"RTN","ORQ20",97,0)
 Q Y
"RTN","ORQ20",98,0)
 ;
"RTN","ORQ20",99,0)
USER(X) ; -- Returns NAME (TITLE) of New Person X
"RTN","ORQ20",100,0)
 N X0,Y S X0=$G(^VA(200,+X,0)),Y=$P(X0,U)
"RTN","ORQ20",101,0)
 S:$P(X0,U,9) Y=Y_" ("_$E($P($G(^DIC(3.1,+$P(X0,U,9),0)),U),1,15)_")"
"RTN","ORQ20",102,0)
 Q Y
"RTN","ORQ20",103,0)
 ;
"RTN","ORQ20",104,0)
SIG(X) ; -- Returns text of signature status X
"RTN","ORQ20",105,0)
 N Y S Y=""
"RTN","ORQ20",106,0)
 I X=0 S Y="ON CHART WITH WRITTEN ORDERS"
"RTN","ORQ20",107,0)
 I X=1 S Y="ELECTRONICALLY SIGNED"
"RTN","ORQ20",108,0)
 I X=2 S Y="NOT SIGNED"
"RTN","ORQ20",109,0)
 I X=3 S Y="NOT REQUIRED"
"RTN","ORQ20",110,0)
 I X=4 S Y="ON CHART WITH PRINTED ORDERS"
"RTN","ORQ20",111,0)
 I X=5 S Y="NOT REQUIRED DUE TO SERVICE CANCEL/LAPSE"
"RTN","ORQ20",112,0)
 I X=6 S Y="SERVICE CORRECTION TO SIGNED ORDER"
"RTN","ORQ20",113,0)
 Q Y
"RTN","ORQ20",114,0)
 ;
"RTN","ORQ20",115,0)
SERVCORR() ; -- Returns 1 or 0, if current ACTION is a serv corr change
"RTN","ORQ20",116,0)
 N Y,NATURE,I,X S Y=0
"RTN","ORQ20",117,0)
 G:ORACT'="XX" SCQ
"RTN","ORQ20",118,0)
 S NATURE=+$P(ACTION,U,12),NATURE=$P($G(^ORD(100.02,NATURE,0)),U,2)
"RTN","ORQ20",119,0)
 I "^S^I^"'[(U_NATURE_U) G SCQ
"RTN","ORQ20",120,0)
 S I=$O(^OR(100,ORIFN,8,ORI),-1),X=$G(^(I,0))
"RTN","ORQ20",121,0)
 I $P(X,U,3)'=$P(ACTION,U,3),$P(X,U,5)'=$P(ACTION,U,3) G SCQ ;show prov
"RTN","ORQ20",122,0)
 S Y=1
"RTN","ORQ20",123,0)
SCQ Q Y
"RTN","ORQ20",124,0)
 ;
"RTN","ORQ20",125,0)
EVENT(ORTX,DC) ; -- Returns patient event info for EVT
"RTN","ORQ20",126,0)
 N EVT1,REL,X,Y,I,ORMAX
"RTN","ORQ20",127,0)
 S ORTX(1)="" ;177
"RTN","ORQ20",128,0)
 S EVT1=$G(^ORE(100.2,EVT,1)),REL=$G(^ORE(100.2,EVT,2,ORIFN,0))
"RTN","ORQ20",129,0)
 ; Return event data if AutoDC or auto-released by an event:
"RTN","ORQ20",130,0)
 I $G(DC)!(REL&'$L($P(REL,U,2))&($P(EVT1,U,2)!$P(EVT1,U,4))) D  Q
"RTN","ORQ20",131,0)
 . S Y=$S($P(EVT1,U,5):$P(EVT1,U,5),1:EVT) ;parent owns Activity
"RTN","ORQ20",132,0)
 . S Y=+$O(^ORE(100.2,+Y,10,0)),Y=$G(^(Y,0)),X=$P(Y,U,4) Q:'$L(X)
"RTN","ORQ20",133,0)
 . S X=$S(X="A":"ADMISSION",X="T":"TRANSFER",X="D":"DISCHARGE",X="S":"SPECIALTY CHANGE",1:$S($P(EVT1,U)>$$DPI^ORUTL1("SR*3.0*157"):"IN TO O.R.",1:"OUT OF O.R."))_" on "_$$DATE($P(EVT1,U)) ;243
"RTN","ORQ20",134,0)
 . S ORTX(1)=X,ORTX=1,ORMAX=56
"RTN","ORQ20",135,0)
 . I $P(Y,U,6) S X=$S($P(Y,U,4)="D":"from ",1:"to ")_$$GET1^DIQ(45.7,+$P(Y,U,6)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",136,0)
 . I $P(Y,U,7) S X="on "_$$GET1^DIQ(42,+$P(Y,U,7)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",137,0)
 S X=$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",138,0)
 I ORIFN'=+$P($G(^ORE(100.2,EVT,0)),U,4),$P(REL,U,2)="MN" S X=X_" (manually released)"
"RTN","ORQ20",139,0)
 S ORTX(1)=X
"RTN","ORQ20",140,0)
 Q
"VER")
8.0^22.2
"BLD",11026,6)
^418
**END**
**END**

