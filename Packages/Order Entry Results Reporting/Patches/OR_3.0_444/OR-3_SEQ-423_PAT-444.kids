Released OR*3*444 SEQ #423
Extracted from mail message
**KIDS**:OR*3.0*444^

**INSTALL NAME**
OR*3.0*444
"BLD",10652,0)
OR*3.0*444^ORDER ENTRY/RESULTS REPORTING^0^3190405^y
"BLD",10652,1,0)
^^1^1^3161115^
"BLD",10652,1,1,0)
This patch is for NSR20130714 Unified Action Profile
"BLD",10652,4,0)
^9.64PA^100^1
"BLD",10652,4,100,0)
100
"BLD",10652,4,100,2,0)
^9.641^100^1
"BLD",10652,4,100,2,100,0)
ORDER  (File-top level)
"BLD",10652,4,100,2,100,1,0)
^9.6411^.63^3
"BLD",10652,4,100,2,100,1,.61,0)
UAP Reviewed?
"BLD",10652,4,100,2,100,1,.62,0)
UAP Last Reviewed
"BLD",10652,4,100,2,100,1,.63,0)
UAP Last Reviewed By
"BLD",10652,4,100,222)
y^y^p^^^^n^^n
"BLD",10652,4,100,224)

"BLD",10652,4,"APDD",100,100)

"BLD",10652,4,"APDD",100,100,.61)

"BLD",10652,4,"APDD",100,100,.62)

"BLD",10652,4,"APDD",100,100,.63)

"BLD",10652,4,"B",100,100)

"BLD",10652,6)
15^
"BLD",10652,6.3)
48
"BLD",10652,"ABPKG")
n
"BLD",10652,"INID")
^y
"BLD",10652,"INIT")
ORUA444P
"BLD",10652,"KRN",0)
^9.67PA^779.2^20
"BLD",10652,"KRN",.4,0)
.4
"BLD",10652,"KRN",.401,0)
.401
"BLD",10652,"KRN",.402,0)
.402
"BLD",10652,"KRN",.403,0)
.403
"BLD",10652,"KRN",.5,0)
.5
"BLD",10652,"KRN",.84,0)
.84
"BLD",10652,"KRN",3.6,0)
3.6
"BLD",10652,"KRN",3.8,0)
3.8
"BLD",10652,"KRN",9.2,0)
9.2
"BLD",10652,"KRN",9.8,0)
9.8
"BLD",10652,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",10652,"KRN",9.8,"NM",1,0)
ORQ1^^0^B12018675
"BLD",10652,"KRN",9.8,"NM",2,0)
ORQ11^^0^B86143021
"BLD",10652,"KRN",9.8,"NM",4,0)
ORWORR1^^0^B14089076
"BLD",10652,"KRN",9.8,"NM",6,0)
ORTOULT4^^0^B55857069
"BLD",10652,"KRN",9.8,"NM",7,0)
ORQ12^^0^B44346271
"BLD",10652,"KRN",9.8,"NM",8,0)
ORWORR^^0^B88246015
"BLD",10652,"KRN",9.8,"NM","B","ORQ1",1)

"BLD",10652,"KRN",9.8,"NM","B","ORQ11",2)

"BLD",10652,"KRN",9.8,"NM","B","ORQ12",7)

"BLD",10652,"KRN",9.8,"NM","B","ORTOULT4",6)

"BLD",10652,"KRN",9.8,"NM","B","ORWORR",8)

"BLD",10652,"KRN",9.8,"NM","B","ORWORR1",4)

"BLD",10652,"KRN",19,0)
19
"BLD",10652,"KRN",19,"NM",0)
^9.68A^^0
"BLD",10652,"KRN",19.1,0)
19.1
"BLD",10652,"KRN",101,0)
101
"BLD",10652,"KRN",101,"NM",0)
^9.68A^^
"BLD",10652,"KRN",409.61,0)
409.61
"BLD",10652,"KRN",771,0)
771
"BLD",10652,"KRN",779.2,0)
779.2
"BLD",10652,"KRN",870,0)
870
"BLD",10652,"KRN",8989.51,0)
8989.51
"BLD",10652,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",10652,"KRN",8989.51,"NM",1,0)
OR UNIFIED ACTION PROFILE OFF^^0
"BLD",10652,"KRN",8989.51,"NM","B","OR UNIFIED ACTION PROFILE OFF",1)

"BLD",10652,"KRN",8989.52,0)
8989.52
"BLD",10652,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",10652,"KRN",8994,0)
8994
"BLD",10652,"KRN",8994,"NM",0)
^9.68A^5^5
"BLD",10652,"KRN",8994,"NM",1,0)
ORTO GETRVW^^0
"BLD",10652,"KRN",8994,"NM",2,0)
ORTO SET UAP FLAG^^0
"BLD",10652,"KRN",8994,"NM",3,0)
ORTO SETRVW^^0
"BLD",10652,"KRN",8994,"NM",4,0)
ORTO UAPOFF^^0
"BLD",10652,"KRN",8994,"NM",5,0)
ORTO DGROUP^^0
"BLD",10652,"KRN",8994,"NM","B","ORTO DGROUP",5)

"BLD",10652,"KRN",8994,"NM","B","ORTO GETRVW",1)

"BLD",10652,"KRN",8994,"NM","B","ORTO SET UAP FLAG",2)

"BLD",10652,"KRN",8994,"NM","B","ORTO SETRVW",3)

"BLD",10652,"KRN",8994,"NM","B","ORTO UAPOFF",4)

"BLD",10652,"KRN","B",.4,.4)

"BLD",10652,"KRN","B",.401,.401)

"BLD",10652,"KRN","B",.402,.402)

"BLD",10652,"KRN","B",.403,.403)

"BLD",10652,"KRN","B",.5,.5)

"BLD",10652,"KRN","B",.84,.84)

"BLD",10652,"KRN","B",3.6,3.6)

"BLD",10652,"KRN","B",3.8,3.8)

"BLD",10652,"KRN","B",9.2,9.2)

"BLD",10652,"KRN","B",9.8,9.8)

"BLD",10652,"KRN","B",19,19)

"BLD",10652,"KRN","B",19.1,19.1)

"BLD",10652,"KRN","B",101,101)

"BLD",10652,"KRN","B",409.61,409.61)

"BLD",10652,"KRN","B",771,771)

"BLD",10652,"KRN","B",779.2,779.2)

"BLD",10652,"KRN","B",870,870)

"BLD",10652,"KRN","B",8989.51,8989.51)

"BLD",10652,"KRN","B",8989.52,8989.52)

"BLD",10652,"KRN","B",8994,8994)

"BLD",10652,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10652,"QUES",0)
^9.62^^
"BLD",10652,"REQB",0)
^9.611^4^4
"BLD",10652,"REQB",1,0)
OR*3.0*456^1
"BLD",10652,"REQB",2,0)
OR*3.0*471^1
"BLD",10652,"REQB",3,0)
OR*3.0*441^1
"BLD",10652,"REQB",4,0)
OR*3.0*350^1
"BLD",10652,"REQB","B","OR*3.0*350",4)

"BLD",10652,"REQB","B","OR*3.0*441",3)

"BLD",10652,"REQB","B","OR*3.0*456",1)

"BLD",10652,"REQB","B","OR*3.0*471",2)

"FIA",100)
ORDER
"FIA",100,0)
^OR(100,
"FIA",100,0,0)
100I
"FIA",100,0,1)
y^y^p^^^^n^^n
"FIA",100,0,10)

"FIA",100,0,11)

"FIA",100,0,"RLRO")

"FIA",100,0,"VR")
3.0^OR
"FIA",100,100)
1
"FIA",100,100,.61)

"FIA",100,100,.62)

"FIA",100,100,.63)

"INIT")
ORUA444P
"KRN",8989.51,932,-1)
0^1
"KRN",8989.51,932,0)
OR UNIFIED ACTION PROFILE OFF^Unified Action Profile On/Off Switch^0^^UNIFIED ACTION PROFILE
"KRN",8989.51,932,1)
S^0:OFF;1:ON^Enter a 1 to turn on the Unified Action Profile function or a 0 to turn it of
"KRN",8989.51,932,20,0)
^8989.512^4^4^3170208^^
"KRN",8989.51,932,20,1,0)
This parameter is used to make the two unified action profile menu 
"KRN",8989.51,932,20,2,0)
choices, ("UAP" and "Discharge Meds" available in CPRS under the Views
"KRN",8989.51,932,20,3,0)
Menu.  These two menus on the views drop down menu, when activated, allow
"KRN",8989.51,932,20,4,0)
clinicians to use the Unified Action Profile Function.
"KRN",8989.51,932,30,0)
^8989.513I^1^1
"KRN",8989.51,932,30,1,0)
1^4.2
"KRN",8994,4199,-1)
0^1
"KRN",8994,4199,0)
ORTO GETRVW^GETRVW^ORTOULT4^1
"KRN",8994,4199,1,0)
^^5^5^3161117^
"KRN",8994,4199,1,1,0)
Unified Action Profile (UAP). This RPC gets the value of the field 'UAP
"KRN",8994,4199,1,2,0)
Reviewed?' field #100,.61,  Filed as the first piece of 100,.61;1.  This 
"KRN",8994,4199,1,3,0)
is the status of the review. It returns the string from a set of codes 
"KRN",8994,4199,1,4,0)
to CPRS. This includes cont for contiued, chg for changed, dc for
"KRN",8994,4199,1,5,0)
discontinued, rnw for renewed, and nw for a new order.
"KRN",8994,4199,2,0)
^8994.02A^1^1
"KRN",8994,4199,2,1,0)
ORDER IEN^1^20^1^1
"KRN",8994,4199,2,1,1,0)
^8994.021^1^1^3161117^^^^
"KRN",8994,4199,2,1,1,1,0)
IEN of the order in file 100
"KRN",8994,4199,2,"B","ORDER IEN",1)

"KRN",8994,4199,2,"PARAMSEQ",1,1)

"KRN",8994,4200,-1)
0^3
"KRN",8994,4200,0)
ORTO SETRVW^SETRVW^ORTOULT4^1
"KRN",8994,4200,1,0)
^8994.01^5^5^3161108^^
"KRN",8994,4200,1,1,0)
This RPC sets the value of three fields: first the 'UAP Reviewed?' field
"KRN",8994,4200,1,2,0)
#100,.61;1, with the passed value (0=NO, 1=YES). Second the 'UAP Date
"KRN",8994,4200,1,3,0)
Last
"KRN",8994,4200,1,4,0)
Reviewed' field # 100,.61;2 with the ,current date and time; and third the
"KRN",8994,4200,1,5,0)
'UAP Last Reviewed By' field #100.61;3 with the DUZ of the reviewer. 
"KRN",8994,4200,2,0)
^8994.02A^2^2
"KRN",8994,4200,2,1,0)
REVIEW STATUS^1^5^1^1
"KRN",8994,4200,2,1,1,0)
^^1^1^3161028^
"KRN",8994,4200,2,1,1,1,0)
Status of the order UAP Reviewed? (0 or 1)
"KRN",8994,4200,2,2,0)
ORDER IEN^1^20^1^2
"KRN",8994,4200,2,2,1,0)
^8994.021^1^1^3161108^^^^
"KRN",8994,4200,2,2,1,1,0)
IEN of the order in file 100.
"KRN",8994,4200,2,"B","ORDER IEN",2)

"KRN",8994,4200,2,"B","REVIEW STATUS",1)

"KRN",8994,4200,2,"PARAMSEQ",1,1)

"KRN",8994,4200,2,"PARAMSEQ",2,2)

"KRN",8994,4201,-1)
0^2
"KRN",8994,4201,0)
ORTO SET UAP FLAG^SETUAPF^ORTOULT4^1
"KRN",8994,4201,1,0)
^^5^5^3161108^
"KRN",8994,4201,1,1,0)
Unified Action Profile (UAP). Pass in 1 to flag that user has entered UAP
"KRN",8994,4201,1,2,0)
view.  Pass in 0 to flag they have changed to any other view in the
"KRN",8994,4201,1,3,0)
TfrmOrders.SetOrderView procedure. While in UAP view, new orders will have
"KRN",8994,4201,1,4,0)
the UAP Reviewed? field (#100,.61) of the order file set to 'N'. Global 
"KRN",8994,4201,1,5,0)
Loaction .61;1 SET of codes.
"KRN",8994,4201,1,6,0)
codes.
"KRN",8994,4201,2,0)
^8994.02A^1^1
"KRN",8994,4201,2,1,0)
FLAG^1^1^1^1
"KRN",8994,4201,2,1,1,0)
^8994.021^1^1^3161108^^^
"KRN",8994,4201,2,1,1,1,0)
Dummy value
"KRN",8994,4201,2,"B","FLAG",1)

"KRN",8994,4201,2,"PARAMSEQ",1,1)

"KRN",8994,4202,-1)
0^4
"KRN",8994,4202,0)
ORTO UAPOFF^UAPOFF^ORTOULT4^1
"KRN",8994,4202,1,0)
^^2^2^3170129^
"KRN",8994,4202,1,1,0)
This is used to turn on or off the Unified Action Profile function in 
"KRN",8994,4202,1,2,0)
CPRS.
"KRN",8994,4202,3,0)
^^2^2^3170129^
"KRN",8994,4202,3,1,0)
This returns a 1 if the site selected on or 0 if the site selected to 
"KRN",8994,4202,3,2,0)
 turn it off.
"KRN",8994,4203,-1)
0^5
"KRN",8994,4203,0)
ORTO DGROUP^DGROUP^ORTOULT4^1^P^0
"KRN",8994,4203,1,0)
^8994.01^1^1^3170525^^
"KRN",8994,4203,1,1,0)
RETURNS THE CPRS DISPLAY GROUP NAME
"KRN",8994,4203,2,0)
^8994.02A^1^1
"KRN",8994,4203,2,1,0)
DGROUP^1^999^1^1
"KRN",8994,4203,2,1,1,0)
^8994.021^1^1^3170525^^
"KRN",8994,4203,2,1,1,1,0)
The Display group IEN from CPRS
"KRN",8994,4203,2,"B","DGROUP",1)

"KRN",8994,4203,2,"PARAMSEQ",1,1)

"KRN",8994,4203,3,0)
^^1^1^3170605^
"KRN",8994,4203,3,1,0)
The Display Group Name
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;RPCE1^XPDIA1;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
444^3190405^11959
"PKG",170,22,1,"PAH",1,1,0)
^^1^1^3190405
"PKG",170,22,1,"PAH",1,1,1,0)
This patch is for NSR20130714 Unified Action Profile
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","ORQ1")
0^1^B12018675^B10080837
"RTN","ORQ1",1,0)
ORQ1 ;slc/dcm-Get orders for a patient. ;12/14/16  13:10
"RTN","ORQ1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,78,141,190,215,444**;Dec 17, 1997;Build 48
"RTN","ORQ1",3,0)
 ;
"RTN","ORQ1",4,0)
 ;EPIP/RTW Modified for the Unified Action Profile 26 Oct 2016
"RTN","ORQ1",5,0)
EN(PAT,GROUP,FLG,EXPAND,SDATE,EDATE,DETAIL,MULT,XREF,GETKID,EVENT) ;Get orders
"RTN","ORQ1",6,0)
 ; Returns orders in ^TMP("ORR",$J,ORLIST,i) for defined context:
"RTN","ORQ1",7,0)
 ;
"RTN","ORQ1",8,0)
 ; PAT  =patient variable ptr in format "DFN;DPT("
"RTN","ORQ1",9,0)
 ; GROUP=Display group
"RTN","ORQ1",10,0)
 ; FLG  =#:        Includes status:
"RTN","ORQ1",11,0)
 ; 1. All       => 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
"RTN","ORQ1",12,0)
 ; 2. Active/Current    =>     3,4,5,6,  8,9,   11, 15
"RTN","ORQ1",13,0)
 ;    Includes CONTEXT HRS 1,2,7,13 & Action Status=13
"RTN","ORQ1",14,0)
 ;         Orders in ^OR(100,"AC",PAT,TM,IFN,ACTION)
"RTN","ORQ1",15,0)
 ; 3. Discontinued      => 1       12,13
"RTN","ORQ1",16,0)
 ; 4. Completed/Expired =>   2,        7
"RTN","ORQ1",17,0)
 ; 5. Expiring  =>     3,4,5,6,  8,9
"RTN","ORQ1",18,0)
 ; 6. Recent Activity   => 1,2,3,4,5,6,7,8,9,      12,      15
"RTN","ORQ1",19,0)
 ;         Orders in ^OR(100,"AR",PAT,TM,IFN,ACTION)
"RTN","ORQ1",20,0)
 ; 7. Pending   => 5
"RTN","ORQ1",21,0)
 ; 8. Unverified        => 1,  3,4,5,6,  8,9,       15
"RTN","ORQ1",22,0)
 ; 9. Unverified/Nurse  => 1,  3,4,5,6,  8,9,       15
"RTN","ORQ1",23,0)
 ;10. Unverified/Clerk  => 1,  3,4,5,6,  8,9,       15
"RTN","ORQ1",24,0)
 ;11. Unsigned  => 1,2,3,4,5,6,7,8,9,10,11,   13,14,15
"RTN","ORQ1",25,0)
 ;         Orders in ^OR(100,"AS",PAT,TM,IFN)
"RTN","ORQ1",26,0)
 ;12. Flagged   => 1,2,3,4,5,6,7,8,9,      12,13,14,15
"RTN","ORQ1",27,0)
 ;13. Verbal/Phoned     => 1,2,3,4,5,6,7,8,9, 13,14,15
"RTN","ORQ1",28,0)
 ;         Nature of order of verbal or phoned
"RTN","ORQ1",29,0)
 ;14. Verb/Phn unsigned => 1,2,3,4,5,6,7,8,9, 13,14,15
"RTN","ORQ1",30,0)
 ;         Nature of order V or P & unsigned
"RTN","ORQ1",31,0)
 ;15. Admission =>   6,      10
"RTN","ORQ1",32,0)
 ;16. Discharge =>   6,      10
"RTN","ORQ1",33,0)
 ;17. Transfer  =>   6,      10
"RTN","ORQ1",34,0)
 ;         Orders in ^OR(100,"AEVNT",PAT,EVENT,IFN)
"RTN","ORQ1",35,0)
 ;18. On Hold   =>     3
"RTN","ORQ1",36,0)
 ;19. New Orders        =>   10,11
"RTN","ORQ1",37,0)
 ;         Orders in ^TMP("ORNEW",$J,ORIFN)
"RTN","ORQ1",38,0)
 ;20. Chart Review      => 1,  3,4,5,6,  8,9,       15
"RTN","ORQ1",39,0)
 ;21. Chart Copy Summary=> same as All w/screen on Nature of order
"RTN","ORQ1",40,0)
 ;22. Lapsed    =>       14
"RTN","ORQ1",41,0)
 ;23. Active status     => 5,6
"RTN","ORQ1",42,0)
 ;24. All Delayed       =>   6,      10
"RTN","ORQ1",43,0)
 ;25. Out of OR =>   6,      10
"RTN","ORQ1",44,0)
 ;26. Manual Release    =>   6,      10
"RTN","ORQ1",45,0)
 ;27. Expired   =>     7
"RTN","ORQ1",46,0)
 ;28. Discontinued Entered in Error => code handles this in ORQ12
"RTN","ORQ1",47,0)
 ;         Orders in ^OR(100,"AEVNT",PAT,EVENT,IFN)
"RTN","ORQ1",48,0)
EN0 ; where order status=#:
"RTN","ORQ1",49,0)
 ; 1 => Discontinued (dc) 6 => Active (a)   11 => Unreleased (u)
"RTN","ORQ1",50,0)
 ; 2 => Complete (c)      7 => Expired (e)  12 => DC/Edit (dce)
"RTN","ORQ1",51,0)
 ; 3 => Hold (h)  8 => Scheduled (s)        13 => Cancelled (x)
"RTN","ORQ1",52,0)
 ; 4 => Flagged (?)       9 => Partial Results (pr) 14 => Lapsed (l)
"RTN","ORQ1",53,0)
 ; 5 => Pending (p)      10 => Delayed (d)  15 => Renewed (rn)
"RTN","ORQ1",54,0)
 ;          99 => No Status (')
"RTN","ORQ1",55,0)
 ; EXPAND=ifn of parent order, used to expand child orders
"RTN","ORQ1",56,0)
 ; SDATE =Start date
"RTN","ORQ1",57,0)
 ; EDATE =End date
"RTN","ORQ1",58,0)
 ; DETAIL=Data to be returned (optional, default=0):
"RTN","ORQ1",59,0)
 ;     0 => ^TMP("ORR",$J,ORLIST,i) = order #
"RTN","ORQ1",60,0)
 ;     1 => ^TMP("ORR",$J,ORLIST,i) = order #^display group^when entered^
"RTN","ORQ1",61,0)
 ;    start d/t^stop d/t^status^sts abbrv
"RTN","ORQ1",62,0)
 ;  ^TMP("ORR",$J,ORLIST,i,"TX",j) = order text
"RTN","ORQ1",63,0)
 ; MULT  =0:Don't allow multiple occurrances of order
"RTN","ORQ1",64,0)
 ;       =1:Allow multiple occurances
"RTN","ORQ1",65,0)
 ; XREF  =cross reference to use instead of ACT (AW for completed orders)
"RTN","ORQ1",66,0)
 ; GETKID=includes children of multiple orders
"RTN","ORQ1",67,0)
 ; EVENT =ptr to Patient Event file #100.2, for orders tied to an event
"RTN","ORQ1",68,0)
 ;
"RTN","ORQ1",69,0)
EN1 ; -- start here
"RTN","ORQ1",70,0)
 Q:'$G(PAT)  N X,ORLST,ORGRP,LAPSE
"RTN","ORQ1",71,0)
 S:'$G(GROUP) GROUP=$O(^ORD(100.98,"B","ALL SERVICES",0))
"RTN","ORQ1",72,0)
 S:'$G(FLG) FLG=2 S:'$G(DETAIL) DETAIL=0 S:'$G(MULT) MULT=0
"RTN","ORQ1",73,0)
 I $G(EDATE)<$G(SDATE) S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","ORQ1",74,0)
 I $G(EDATE) S EDATE=$S($L(EDATE,".")=2:EDATE+.0001,1:EDATE+1)
"RTN","ORQ1",75,0)
 I $G(SDATE) S SDATE=$S($L(SDATE,".")=2:SDATE-.0001,1:SDATE)
"RTN","ORQ1",76,0)
 S SDATE=9999999-$S($G(SDATE):SDATE,FLG=6:DT-.7641,1:0),EDATE=9999999-$S($G(EDATE):EDATE,FLG=6:DT+.2359,1:9999998)
"RTN","ORQ1",77,0)
 S ORLST=0,X=EDATE,EDATE=SDATE,SDATE=X D GRP(GROUP),LIST
"RTN","ORQ1",78,0)
 S LAPSE=+$$GET^XPAR("ALL","OR DELAYED ORDERS LAPSE DAYS")
"RTN","ORQ1",79,0)
 S:LAPSE LAPSE=$$FMADD^XLFDT(DT,(0-LAPSE)) ;=0 or cutoff date
"RTN","ORQ1",80,0)
 I "^15^16^17^24^25^26^"[(U_FLG_U)!$G(EVENT) D EN^ORQ13 G ENQ
"RTN","ORQ1",81,0)
 ;RTW BEGIN UAP MODIFICATION
"RTN","ORQ1",82,0)
 I $$GET1^DIQ(100.98,GROUP,.01)="DISCHARGE MEDS" D LOOP^ORQ11 G ENQ
"RTN","ORQ1",83,0)
 I $$GET1^DIQ(100.98,GROUP,.01)="PHARMACY UAP" D LOOP^ORQ11 G ENQ
"RTN","ORQ1",84,0)
 ;RTW END UAP MODIFICATION
"RTN","ORQ1",85,0)
 D @($S(FLG=2:"CUR",FLG=5:"EXG","^6^8^9^10^20^"[(U_FLG_U):"ACT",FLG=11:"SIG",FLG=19:"NEW","^1^3^4^7^12^13^14^18^21^22^23^27^28^"[(U_FLG_U):"LOOP",1:"QUIT")_"^ORQ11")
"RTN","ORQ1",86,0)
ENQ K ^TMP("ORGOTIT",$J)
"RTN","ORQ1",87,0)
 Q
"RTN","ORQ1",88,0)
 ;
"RTN","ORQ1",89,0)
LIST ;Get entry in ^TMP("ORR",$J,ORLIST)
"RTN","ORQ1",90,0)
 S ORLIST=$H
"RTN","ORQ1",91,0)
 L +^TMP("ORR",$J,ORLIST):$S($G(DILOCKTM)>0:DILOCKTM,1:5) I '$T G LIST
"RTN","ORQ1",92,0)
 I $D(^TMP("ORR",$J,ORLIST)) L -^TMP("ORR",$J,ORLIST) H 1 G LIST
"RTN","ORQ1",93,0)
 S ^TMP("ORR",$J,ORLIST)=""
"RTN","ORQ1",94,0)
 L -^TMP("ORR",$J,ORLIST)
"RTN","ORQ1",95,0)
 Q
"RTN","ORQ1",96,0)
 ;
"RTN","ORQ1",97,0)
GRP(DG)  ;Setup display groups
"RTN","ORQ1",98,0)
 ;DG=Display group to expand
"RTN","ORQ1",99,0)
 N STK,MEM
"RTN","ORQ1",100,0)
 S ORGRP(DG)="",STK=1,STK(STK)=DG_"^0",STK(0)=0,MEM=0
"RTN","ORQ1",101,0)
 F  S MEM=$O(^ORD(100.98,+STK(STK),1,MEM)) D @$S(+MEM'>0:"POP",1:"PROC") Q:STK<1
"RTN","ORQ1",102,0)
 Q
"RTN","ORQ1",103,0)
 ;
"RTN","ORQ1",104,0)
POP S STK=STK-1,MEM=$P(STK(STK),"^",2)
"RTN","ORQ1",105,0)
 Q
"RTN","ORQ1",106,0)
PROC S $P(STK(STK),"^",2)=MEM,DG=$P(^ORD(100.98,+STK(STK),1,MEM,0),"^",1)
"RTN","ORQ1",107,0)
 S ORGRP(DG)="",STK=STK+1,STK(STK)=DG_"^0",MEM=0
"RTN","ORQ1",108,0)
 Q
"RTN","ORQ11")
0^2^B86143021^B65899286
"RTN","ORQ11",1,0)
ORQ11 ;SLC/DCM - Get patient orders in context ;07/27/12  14:34
"RTN","ORQ11",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,78,99,94,148,141,177,186,190,195,215,243,295,322,350,444**;Dec 17, 1997;Build 48
"RTN","ORQ11",3,0)
 ;EPIP/RTW Modified for the Unified Action Profile 26 Oct 2016
"RTN","ORQ11",4,0)
LOOP ; -- main loop through "ACT" x-ref
"RTN","ORQ11",5,0)
 I $G(XREF)="AW" D AW Q
"RTN","ORQ11",6,0)
 I $G(FLG)=27 D EXPD^ORQ12 Q
"RTN","ORQ11",7,0)
 K ^TMP("ORGOTIT",$J)
"RTN","ORQ11",8,0)
AWIN ;Jump in here to add active orders to AW context
"RTN","ORQ11",9,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",10,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TM=SDATE
"RTN","ORQ11",11,0)
 F  S TM=$O(^OR(100,"ACT",PAT,TM)) Q:'TM!(TM>EDATE)  S TO=0 F  S TO=$O(^OR(100,"ACT",PAT,TM,TO)) Q:'TO  I $D(ORGRP(TO)) D
"RTN","ORQ11",12,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"ACT",PAT,TM,TO,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT),$D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",13,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,TM,TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13!(FLG=1) S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",14,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",15,0)
 Q
"RTN","ORQ11",16,0)
AW ; -- loop through "AW" x-ref
"RTN","ORQ11",17,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ11",18,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",19,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ11",20,0)
 F  S TO=$O(^OR(100,"AW",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^OR(100,"AW",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ11",21,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AW",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ11",22,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ11",23,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ11",24,0)
 . S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",25,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",26,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",27,0)
 I +$$GET^XPAR("SYS","OR ORDER SUMMARY CONTEXT",1,"I")=2 S SDATE=9999999-SDATE,EDATE=9999999-EDATE D AWIN
"RTN","ORQ11",28,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ11",29,0)
 Q
"RTN","ORQ11",30,0)
LP1 ; -- main secondary loop
"RTN","ORQ11",31,0)
 N STS ;195
"RTN","ORQ11",32,0)
 N TAG
"RTN","ORQ11",33,0)
 Q:$P(X3,U,8)  Q:$P(X3,U,3)=99  S STS=$P(X3,U,3)
"RTN","ORQ11",34,0)
 I '$G(GETKID),$P(X3,U,9),'$P($G(^OR(100,$P(X3,U,9),3)),U,8),FLG'=11 Q
"RTN","ORQ11",35,0)
 I $L($P(X0,U,17)),"^10^11^"[(U_STS_U) S X=$$LAPSED^OREVNTX($P(X0,U,17))
"RTN","ORQ11",36,0)
 ;EPIP/RTW BEGIN ***UNIFIED ACTION PROFILE Modification*** 26/OCT/2016
"RTN","ORQ11",37,0)
 ; original note for DM line "DISCHARGE MEDS"
"RTN","ORQ11",38,0)
 ; original note for UAPM line "UAP MEDS"
"RTN","ORQ11",39,0)
 I $$GET1^DIQ(100.98,GROUP,.01)="DISCHARGE MEDS" D DM Q
"RTN","ORQ11",40,0)
 I $$GET1^DIQ(100.98,GROUP,.01)="PHARMACY UAP" D UAPM Q
"RTN","ORQ11",41,0)
 ;EPIP/RTW END ***UNIFIED ACTION PROFILE Modification*** 
"RTN","ORQ11",42,0)
 S TAG=$S(FLG=2:"CUR1",FLG=4:"COM1",FLG=5:"EXG1",FLG=7:"PEN1",FLG=8:"UVR1",FLG=9:"UVN1",FLG=10:"UVC1",FLG=12:"FLG1",FLG=13:"VP1",FLG=14:"VPU1",FLG=18:"HLD1",FLG=20:"CHT1",FLG=21:"CHTSUM",FLG=22:"LPS1",FLG=23:"AVT1",1:"ALL1")
"RTN","ORQ11",43,0)
 I TAG="ALL1" S TAG=$S(FLG=3:"DC1",FLG=28:"DC1",1:"ALL1")
"RTN","ORQ11",44,0)
 D @TAG
"RTN","ORQ11",45,0)
 Q
"RTN","ORQ11",46,0)
 ; ** FLG context specific loops:
"RTN","ORQ11",47,0)
 ;
"RTN","ORQ11",48,0)
ALL1 ; 1 -- secondary pass for All, Recent Orders, Unsigned
"RTN","ORQ11",49,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,$G(ACTOR))
"RTN","ORQ11",50,0)
 Q
"RTN","ORQ11",51,0)
 ;
"RTN","ORQ11",52,0)
CUR ; 2 -- Active/Current
"RTN","ORQ11",53,0)
 N X,X0,X1,X2,X3,X8,%H,YD,%,TM,IFN,ACTOR,NORX,OIEN,OACT
"RTN","ORQ11",54,0)
 I $G(GROUP)=$O(^ORD(100.98,"B","ALL SERVICES",0)),$G(ORWARD),$G(DGPMT)'=1 S NORX=U_$O(^ORD(100.98,"B","O RX",0))_U_$O(^ORD(100.98,"B","NON-VA MEDICATIONS",0))_U
"RTN","ORQ11",55,0)
 S X2=+$$GET^XPAR("SYS","ORPF ACTIVE ORDERS CONTEXT HRS",1,"I"),X=$H,X=+X*24+($P(X,",",2)/3600),X1=X-X2,X3=X1#24,X1=X1\24,X2=$J(X3*3600,0,0),%H=X1_","_X2 D YMD^%DTC S YD=+(X_%)
"RTN","ORQ11",56,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AC",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AC",PAT,TM,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",57,0)
 . Q:'$D(ORGRP($P(X0,U,11)))  S ACTOR=0
"RTN","ORQ11",58,0)
 . F  S ACTOR=$O(^OR(100,"AC",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)) S X8=^(0) D
"RTN","ORQ11",59,0)
 .. I "^10^12^"[(U_$P(X8,U,15)_U) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",60,0)
 .. I $P(X8,U,15)=13,$P(X8,U)<YD K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",61,0)
 .. I $P(X8,U,15)="",ACTOR'=$P(X3,U,7) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",62,0)
 .. ;AGP waiting for approval change to remove duplicate orders for DC reason
"RTN","ORQ11",63,0)
 .. ;I ACTOR>0,$P($G(^OR(100,IFN,8,ACTOR,0)),U,2)="DC" S OIEN=IFN,OACT=ACTOR
"RTN","ORQ11",64,0)
 .. ;I OIEN=IFN,OACT>ACTOR K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",65,0)
 .. D LP1
"RTN","ORQ11",66,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",67,0)
 Q
"RTN","ORQ11",68,0)
CUR1 ; 2 -- secondary pass for Active/Current
"RTN","ORQ11",69,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",70,0)
 I STS=10 K ^OR(100,"AC",PAT,TM,IFN) Q  ;no delayed orders
"RTN","ORQ11",71,0)
 N EVNT S EVNT=$P(X0,U,17)
"RTN","ORQ11",72,0)
 I STS=13,EVNT,'$D(^ORE(100.2,EVNT,1)) Q  ;DJE/VM *322 no cancelled orders linked to unreleased delay
"RTN","ORQ11",73,0)
 I $P(X8,U,4)=2,$P(X8,U,15)=11 G CURX ;incl all unsig/unrel actions
"RTN","ORQ11",74,0)
 I '$D(YD),"^1^2^7^12^13^14^"[(U_STS_U) K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",75,0)
 I $D(YD),"^1^2^7^12^13^14^"[(U_STS_U),STOP<YD K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",76,0)
 I $G(NORX)[(U_$P(X0,U,11)_U) Q  ;skip Rx for inpatients
"RTN","ORQ11",77,0)
CURX D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",78,0)
 Q
"RTN","ORQ11",79,0)
 ;
"RTN","ORQ11",80,0)
DC1 ; 3 -- secondary pass for DC
"RTN","ORQ11",81,0)
 I FLG=28 D GETEIE^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",82,0)
 I STS=1!(STS=13)!(STS=12) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",83,0)
 Q
"RTN","ORQ11",84,0)
 ;
"RTN","ORQ11",85,0)
COM1 ; 4 -- secondary pass for Completed/Expired
"RTN","ORQ11",86,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",87,0)
 I STS=2!(STS=7)!($L(STOP)&(STOP<NOW)&(STS'=1)&(STS'=13)&(STS'=12)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",88,0)
 Q
"RTN","ORQ11",89,0)
 ;
"RTN","ORQ11",90,0)
EXG ; 5 -- Expiring
"RTN","ORQ11",91,0)
 N ORNG,ORDT,ORDW,ORHOL,X,Y,%DT,DIC,TMW,NOW ;195
"RTN","ORQ11",92,0)
 F ORNG=1:1 D  I ORHOL=0,ORDW=0 Q
"RTN","ORQ11",93,0)
 . S ORDT=$$FMADD^XLFDT(DT,ORNG),ORDW=$S($H-4+ORNG#7>4:1,1:0)
"RTN","ORQ11",94,0)
 . S DIC="^HOLIDAY(",X=$P(ORDT,".")
"RTN","ORQ11",95,0)
 . D ^DIC S ORHOL=$S(+$G(Y)>0:1,1:0)
"RTN","ORQ11",96,0)
 S %DT="",X="T+"_ORNG D ^%DT
"RTN","ORQ11",97,0)
 S TMW=Y_".9999",NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORQ11",98,0)
 D CUR ;D LOOP
"RTN","ORQ11",99,0)
 Q
"RTN","ORQ11",100,0)
EXG1 ; 5 -- secondary pass for Expiring
"RTN","ORQ11",101,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",102,0)
 I STS'=1,STS'=2,STS'=7,STS'>9,STOP>NOW,STOP'>TMW D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",103,0)
 Q
"RTN","ORQ11",104,0)
 ;
"RTN","ORQ11",105,0)
ACT ; 6 -- Recent Activity (Order Summary)
"RTN","ORQ11",106,0)
 ;N ORLSIGN S ORLSIGN=$$GET^XPAR("ALL","OR ORDER REVIEW DT","`"_+PAT,"Q")
"RTN","ORQ11",107,0)
 N TM,IFN,X0,X3,ACTOR,X8
"RTN","ORQ11",108,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AR",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",109,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AR",PAT,TM,IFN)) Q:IFN<1  S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) I $D(ORGRP(+$P(X0,U,11))) D
"RTN","ORQ11",110,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AR",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0) D LP1
"RTN","ORQ11",111,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",112,0)
 Q
"RTN","ORQ11",113,0)
 ;
"RTN","ORQ11",114,0)
PEN1 ; 7 -- secondary pass for Pending
"RTN","ORQ11",115,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",116,0)
 Q
"RTN","ORQ11",117,0)
 ;
"RTN","ORQ11",118,0)
UVR1 ; 8 -- secondary pass for Unverified
"RTN","ORQ11",119,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",120,0)
 I '$P(X8,U,9),'$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",121,0)
 Q
"RTN","ORQ11",122,0)
 ;
"RTN","ORQ11",123,0)
UVN1 ; 9 -- secondary pass for Unverified/Nurse
"RTN","ORQ11",124,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",125,0)
 I '$P(X8,U,9),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",126,0)
 Q
"RTN","ORQ11",127,0)
 ;
"RTN","ORQ11",128,0)
UVC1 ; 10 -- secondary pass for Unverified/Clerk
"RTN","ORQ11",129,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",130,0)
 I '$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",131,0)
 Q
"RTN","ORQ11",132,0)
 ;
"RTN","ORQ11",133,0)
INPT() ; -- Returns 1 or 0, if inpt order using X0=^OR(100,IFN,0)
"RTN","ORQ11",134,0)
 I ($P(X0,U,12)="I")!($$TYPE^OREVNTX($P(X0,U,17))="D") Q 1
"RTN","ORQ11",135,0)
 I $P($G(^SC(+$P(X0,U,10),0)),U,3)="W" Q 1 ;UNCOMMENTED IN *295
"RTN","ORQ11",136,0)
 Q 0
"RTN","ORQ11",137,0)
 ;
"RTN","ORQ11",138,0)
SIG ; 11 -- Unsigned
"RTN","ORQ11",139,0)
 N TM,IFN,X0,X3,ACTOR S TM=SDATE
"RTN","ORQ11",140,0)
 F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",141,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3))
"RTN","ORQ11",142,0)
 . I X0="" K ^OR(100,"AS",PAT,TM,IFN) Q  ;deleted
"RTN","ORQ11",143,0)
 . Q:'$D(ORGRP(+$P(X0,U,11)))  ;not a selected DispGrp
"RTN","ORQ11",144,0)
 . S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",145,0)
 .. I $P($G(^OR(100,IFN,8,ACTOR,0)),U,4)'=2 K ^OR(100,"AS",PAT,TM,IFN,ACTOR) Q  ;signed or deleted
"RTN","ORQ11",146,0)
 .. D LP1
"RTN","ORQ11",147,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",148,0)
 Q
"RTN","ORQ11",149,0)
 ;
"RTN","ORQ11",150,0)
FLG1 ; 12 -- secondary pass for Flagged
"RTN","ORQ11",151,0)
 I +$G(^OR(100,IFN,8,ACTOR,3)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",152,0)
 Q
"RTN","ORQ11",153,0)
 ;
"RTN","ORQ11",154,0)
VP1 ; 13 -- secondary pass for Verbal/Phone
"RTN","ORQ11",155,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",156,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",157,0)
 Q
"RTN","ORQ11",158,0)
 ;
"RTN","ORQ11",159,0)
VPU1 ; 14 -- secondary pass for Verbal/Phone Unsigned
"RTN","ORQ11",160,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",161,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2),'$P(X8,U,5),$P(X8,U,4)=2 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",162,0)
 Q
"RTN","ORQ11",163,0)
 ;
"RTN","ORQ11",164,0)
HLD1 ; 18 -- secondary pass for On Hold
"RTN","ORQ11",165,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",166,0)
 Q
"RTN","ORQ11",167,0)
 ;
"RTN","ORQ11",168,0)
NEW ; 19 -- New Orders, plus other unsigned orders by current provider
"RTN","ORQ11",169,0)
 N IFN,ACTOR,TM,X0,X3,X8,ORENT,ORPAR
"RTN","ORQ11",170,0)
 S IFN=0 F  S IFN=$O(^TMP("ORNEW",$J,IFN)) Q:IFN'>0  D  ;New orders
"RTN","ORQ11",171,0)
 . S ACTOR=0 F  S ACTOR=$O(^TMP("ORNEW",$J,IFN,ACTOR)) Q:ACTOR'>0  D
"RTN","ORQ11",172,0)
 .. Q:'$D(^OR(100,IFN,0))  Q:'$D(^(8,ACTOR,0))  ;deleted
"RTN","ORQ11",173,0)
 .. D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",174,0)
 G:'$D(^XUSEC("ORES",DUZ)) NW1 ;ck parameter for add'l orders
"RTN","ORQ11",175,0)
 S ORENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORQ11",176,0)
 S ORPAR=$$GET^XPAR(ORENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORQ11",177,0)
 I ORPAR S TM=SDATE F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",178,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",179,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",180,0)
 ... Q:$D(^TMP("ORNEW",$J,IFN,ACTOR))  ;already included
"RTN","ORQ11",181,0)
 ... S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACTOR,0))
"RTN","ORQ11",182,0)
 ... I $S(ORPAR=1&($P(X8,U,3)=DUZ):1,ORPAR=2:1,1:0) D LP1
"RTN","ORQ11",183,0)
NW1 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",184,0)
 Q
"RTN","ORQ11",185,0)
 ;
"RTN","ORQ11",186,0)
CHT1 ; 20 -- secondary pass for Chart Review
"RTN","ORQ11",187,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",188,0)
 I '$P(X8,U,19),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",189,0)
 Q
"RTN","ORQ11",190,0)
 ;
"RTN","ORQ11",191,0)
CHTSUM ; 21 -- secondary pass for Chart copy summary
"RTN","ORQ11",192,0)
 ;       Included based on Nature of Order
"RTN","ORQ11",193,0)
 N XP,NAT
"RTN","ORQ11",194,0)
 S XP=+$$GET^XPAR("SYS","OR PRINT ALL ORDERS CHART SUM",1,"I")
"RTN","ORQ11",195,0)
 I XP=2 D  Q  ;depends on Nature of Order
"RTN","ORQ11",196,0)
 . S NAT=$P($G(^OR(100,IFN,6)),U)
"RTN","ORQ11",197,0)
 . I 'NAT S NAT=$P(X8,U,12)
"RTN","ORQ11",198,0)
 . I NAT,$$CHART^ORX1(NAT) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",199,0)
 I XP=0 D  Q  ;If original printed, print on sum
"RTN","ORQ11",200,0)
 . I X7 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",201,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;XP=1 gets All orders
"RTN","ORQ11",202,0)
 Q
"RTN","ORQ11",203,0)
 ;
"RTN","ORQ11",204,0)
LPS1 ; 22 -- secondary pass for Lapsed
"RTN","ORQ11",205,0)
 I STS=14 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",206,0)
 Q
"RTN","ORQ11",207,0)
 ;
"RTN","ORQ11",208,0)
AVT1 ; 23 -- secondary pass for Active/Pending sts only
"RTN","ORQ11",209,0)
 I (STS=6)!(STS=5) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",210,0)
 Q
"RTN","ORQ11",211,0)
 ;
"RTN","ORQ11",212,0)
QUIT ; -- stop
"RTN","ORQ11",213,0)
 Q
"RTN","ORQ11",214,0)
 ;EPIP/RTW ***BEGIN UNIFIED ACTION PROFILE Modification*** 26/OCT/2016
"RTN","ORQ11",215,0)
 ; UAP MEDS ACTIVE, PENDING, HOLD
"RTN","ORQ11",216,0)
UAPM ;
"RTN","ORQ11",217,0)
 N ORDTE,OREDTE,X,Y
"RTN","ORQ11",218,0)
 Q:$$GET1^DIQ(100.008,ACTOR_","_IFN_",","15")["dc/edit"
"RTN","ORQ11",219,0)
 S ORDTE=$$GET1^DIQ(100,IFN,4,"I") ;WHEN ENTERED (#4) date if defined in the order entry
"RTN","ORQ11",220,0)
 K %DT S X="T-3" D ^%DT S OREDTE=Y
"RTN","ORQ11",221,0)
 ;
"RTN","ORQ11",222,0)
 ;Hold
"RTN","ORQ11",223,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",224,0)
 ;Pending
"RTN","ORQ11",225,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",226,0)
 ;Active
"RTN","ORQ11",227,0)
 I STS=6 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",228,0)
 ;Delayed
"RTN","ORQ11",229,0)
 ;entered within 3 days
"RTN","ORQ11",230,0)
 ;just a starting point to test with since users haven't specified
"RTN","ORQ11",231,0)
 ;what date range to actually go with
"RTN","ORQ11",232,0)
 I (STS=10)&($L(ORDTE)&(ORDTE>OREDTE)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",233,0)
 ;Unreleased/new
"RTN","ORQ11",234,0)
 I STS=11 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",235,0)
 Q
"RTN","ORQ11",236,0)
 ;
"RTN","ORQ11",237,0)
DM ; DISCHARGE MEDS 9-2-03 ACTIVE, PENDING, DC < 7 DAYS AND EXPIRED LESS THAN 90 DAYS
"RTN","ORQ11",238,0)
 ;J0 - 06/22/2005 changes to include more types and dates
"RTN","ORQ11",239,0)
 ;J0 - 09/08/2005 changed back to T-90 for expired meds per Tamara Olcott.
"RTN","ORQ11",240,0)
 N ORSTOP,OREXPDT,ORDCDT,X,Y,ORDC
"RTN","ORQ11",241,0)
 S ORDC=$$GET1^DIQ(100,IFN,63,"I") ;DC date if defined in the order entry
"RTN","ORQ11",242,0)
 S ORSTOP=$P(X0,U,9)
"RTN","ORQ11",243,0)
 K %DT S X="T-90" D ^%DT S OREXPDT=Y
"RTN","ORQ11",244,0)
 K %DT S X="T-7" D ^%DT S ORDCDT=Y
"RTN","ORQ11",245,0)
 ;D/C within last 7 days
"RTN","ORQ11",246,0)
 I (STS=1)&($L(ORDC)&(ORDC>ORDCDT)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",247,0)
 ;Hold
"RTN","ORQ11",248,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",249,0)
 ;Pending
"RTN","ORQ11",250,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",251,0)
 ;Active
"RTN","ORQ11",252,0)
 I STS=6 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",253,0)
 ;Expired within last 90 days
"RTN","ORQ11",254,0)
 I (STS=7)&($L(ORSTOP)&(ORSTOP>OREXPDT)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",255,0)
 Q
"RTN","ORQ11",256,0)
 ;EPIP/RTW ***END UNIFIED ACTION PROFILE Modification*** 26/OCT/2016
"RTN","ORQ12")
0^7^B44346271^B41144852
"RTN","ORQ12",1,0)
ORQ12 ; slc/dcm - Get patient orders in context ; 11/1/11 11:39am
"RTN","ORQ12",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,78,92,116,190,220,215,243,356,441,444**;Dec 17, 1997;Build 48
"RTN","ORQ12",3,0)
GET(IFN,NEWD,DETAIL,ACTOR) ; -- Setup TMP array
"RTN","ORQ12",4,0)
 ; IFN=ifn of order
"RTN","ORQ12",5,0)
 ; NEWD=3rd subscript in ^TMP("ORR",$J, node (ORLIST)
"RTN","ORQ12",6,0)
 ; DETAIL=see description in ^ORQ1
"RTN","ORQ12",7,0)
 ;
"RTN","ORQ12",8,0)
 N X0,X3,X4,X6,TXT,STAT,START,DG,STOP,ENTERD
"RTN","ORQ12",9,0)
 S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,+$G(ACTOR))=""
"RTN","ORQ12",10,0)
 I '$G(DETAIL) S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"") Q
"RTN","ORQ12",11,0)
 S X0=^OR(100,IFN,0),X3=$G(^(3)),X4=$G(^(4)),X6=$G(^(6))
"RTN","ORQ12",12,0)
 S DG=$P(X0,U,11),DG=$P($G(^ORD(100.98,+DG,0)),U,3)
"RTN","ORQ12",13,0)
 S STAT=$S($P(X3,U,3):$P(^ORD(100.01,$P(X3,U,3),0),U,1,2),1:"") ;.01^abbr
"RTN","ORQ12",14,0)
 S ENTERD=$P(X0,U,7),START=$P(X0,U,8),STOP=$P(X0,U,9)
"RTN","ORQ12",15,0)
 ; S FLAGREA=$P(X6,U,7)
"RTN","ORQ12",16,0)
 S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"")_U_DG_U_ENTERD_U_START_U_STOP_U_STAT
"RTN","ORQ12",17,0)
 D TEXT(.TXT,IFN) M ^TMP("ORR",$J,NEWD,ORLST,"TX")=TXT
"RTN","ORQ12",18,0)
 Q
"RTN","ORQ12",19,0)
 ;
"RTN","ORQ12",20,0)
TEXT(ORTX,ORIFN,WIDTH,ORUGROUP) ; -- Returns text of order ORIFN in ORTX(#) ;RTW UAP
"RTN","ORQ12",21,0)
 N OR0,OR3,OR6,X,Y,FIRST,ORI,ORJ,DLG,ORX,ORACT,ORTA
"RTN","ORQ12",22,0)
 K ORTX S:'$G(WIDTH) WIDTH=244
"RTN","ORQ12",23,0)
 S ORACT=+$P(ORIFN,";",2),ORIFN=+ORIFN
"RTN","ORQ12",24,0)
 I ORACT<1 S ORACT=+$P($G(^OR(100,ORIFN,3)),U,7) S:'ORACT ORACT=1
"RTN","ORQ12",25,0)
 ;D:$O(^OR(100,ORIFN,1,0)) CNV^ORY92(ORIFN) ;convert text otf
"RTN","ORQ12",26,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6)),ORX=$G(^(8,ORACT,0))
"RTN","ORQ12",27,0)
 S ORTX=1,ORTX(1)=""
"RTN","ORQ12",28,0)
 I $P($G(OR0),U,11)'="",($P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS") S X="Non-VA" D ADD
"RTN","ORQ12",29,0)
 G:$G(ORIGVIEW)>1 T1
"RTN","ORQ12",30,0)
 S:$P(OR0,U,14)=$O(^DIC(9.4,"C","OR",0)) ORTX(1)=">>" ;generic
"RTN","ORQ12",31,0)
 S X=$$ACTION($P(ORX,U,2)) D:$L(X) ADD
"RTN","ORQ12",32,0)
 I $P(ORX,U,2)="NW",$P(OR3,U,11),'$G(ORIGVIEW) D  ; Changed or Renewed
"RTN","ORQ12",33,0)
 . I $P(OR3,U,11)=2 S X="Renew" D ADD Q
"RTN","ORQ12",34,0)
 . N ORIG,ORIGTA S ORIG=+$P(OR3,U,5) Q:'ORIG  Q:$P(OR3,U,11)'=1
"RTN","ORQ12",35,0)
 . S X="Change" D ADD S ORI=0
"RTN","ORQ12",36,0)
 . I $G(IOST)'="P-OTHER" D
"RTN","ORQ12",37,0)
 . .S ORIGTA=$$LASTXT(ORIG) ;D:$O(^OR(100,ORIG,1,0)) CNV^ORY92(ORIG)
"RTN","ORQ12",38,0)
 . .F  S ORI=$O(^OR(100,ORIG,8,ORIGTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:$E(X,1,3)=">> " X=$E(X,4,999) D ADD
"RTN","ORQ12",39,0)
 . .S X=" to" D ADD
"RTN","ORQ12",40,0)
T1 S ORTA=+$P(ORX,U,14),FIRST=+$O(^OR(100,ORIFN,8,ORTA,.1,0))
"RTN","ORQ12",41,0)
 N ORUAPVER,OROITEM,ORDG
"RTN","ORQ12",42,0)
 S ORUAPVER=0 ;RTW UAP SORTING
"RTN","ORQ12",43,0)
 S ORDG=$$GET1^DIQ(100,ORIFN,23,"E") S:(ORDG["IV")!(ORDG["INFUSION") ORUAPVER=1
"RTN","ORQ12",44,0)
 I $G(ORUGROUP),ORUAPVER=1 S ORUIFN=ORIFN,ORUTA=ORTA D UAPALPHA^ORTOULT4(.ORTOADD,ORUTA,ORUIFN) Q:$G(ORTOADD)  ;RTW UAP INFUSION sorting change
"RTN","ORQ12",45,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORIFN,8,ORTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:(FIRST=ORI)&($E(X,1,3)=">> ") X=$E(X,4,999) D:$L(X) ADD
"RTN","ORQ12",46,0)
 Q:$G(ORIGVIEW)>1  ;contents of global only
"RTN","ORQ12",47,0)
 S DLG=$P(OR0,U,5) K Y I DLG,$P(DLG,";",2)["101.41",$D(^ORD(101.41,+DLG,9)) X ^(9) I $L($G(Y)) S X=Y D ADD ; additional text
"RTN","ORQ12",48,0)
 ; I $P(OR3,U,11)=2 S X="(Renewal)" D ADD
"RTN","ORQ12",49,0)
 I $P(ORX,U,4)=2 S X="*UNSIGNED*" D ADD
"RTN","ORQ12",50,0)
 I $$GET^XPAR("ALL","OR FLAGGED & WARD COMMENTS") S ORXZ=$D(^OR(100,ORIFN,8,ORACT,5,0)) I ORXZ S X=$G(^OR(100,ORIFN,8,ORACT,5,1,0)) D:$L(X) ADD K ORXZ ;RTW 441 
"RTN","ORQ12",51,0)
 I $P(ORX,U,2)="DC"!("^1^13^"[(U_$P(OR3,U,3)_U)),$L(OR6) S X=" <"_$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),1:"")_">" D:$L(X)>3 ADD ; DC Reason
"RTN","ORQ12",52,0)
 I $$GET^XPAR("ALL","OR FLAGGED & WARD COMMENTS"),+$G(^OR(100,ORIFN,8,ORACT,3)),$L($P(^OR(100,ORIFN,8,ORACT,3),U,5)) S X="*Flagged - "_$P(^OR(100,ORIFN,8,ORACT,3),U,5)_" - " D ADD  ;RTW 441
"RTN","ORQ12",53,0)
 I $D(XQAID),$G(ORFLG)=12 S ORX=$G(^OR(100,ORIFN,8,ORACT,3)) I $P(ORX,U) S X=" Flagged "_$$DATETIME($P(ORX,U,3))_$S($P(ORX,U,4):" by "_$$NAME($P(ORX,U,4)),1:"")_": "_$P(ORX,U,5) D ADD ; Flagged - show in FUP
"RTN","ORQ12",54,0)
 Q
"RTN","ORQ12",55,0)
 ;
"RTN","ORQ12",56,0)
 S ORPAR=$O(^XTV(8989.51,"B","OR FLAGGED & WARD COMMENTS",ORPAR))
"RTN","ORQ12",57,0)
LASTXT(IFN)     ; -- Returns action with latest text for order IFN
"RTN","ORQ12",58,0)
 N I,Y S Y=1
"RTN","ORQ12",59,0)
 S I=0 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  S:$O(^(I,.1,0)) Y=I
"RTN","ORQ12",60,0)
 Q Y
"RTN","ORQ12",61,0)
 ;
"RTN","ORQ12",62,0)
LAST(CODE) ; -- Return DA of last occurence of CODE action
"RTN","ORQ12",63,0)
 N DA
"RTN","ORQ12",64,0)
 I '$L($G(CODE)) S DA=$O(^OR(100,ORIFN,8,"A"),-1) ; last entry
"RTN","ORQ12",65,0)
 E  S DA=$O(^OR(100,ORIFN,8,"C",CODE,"?"),-1) ; last CODE entry
"RTN","ORQ12",66,0)
 Q DA
"RTN","ORQ12",67,0)
 ;
"RTN","ORQ12",68,0)
ACTION(X) ; -- Returns text of action X
"RTN","ORQ12",69,0)
 N Y
"RTN","ORQ12",70,0)
 S Y=$S(X="DC":"Discontinue",X="HD":"Hold",X="RL"&'$G(ORIGVIEW):"Release Hold of",X="FL":"Flag",X="UF":"Unflag",X="RN"&'$G(ORIGVIEW):"Renew",1:"")
"RTN","ORQ12",71,0)
 Q Y
"RTN","ORQ12",72,0)
 ;
"RTN","ORQ12",73,0)
DATETIME(X) ; -- Returns date/time in format 00/00/00@00:00am
"RTN","ORQ12",74,0)
 N Y,D,T,T1,Z
"RTN","ORQ12",75,0)
 S D=$P(X,"."),T=$E($P(X,".",2)_"0000",1,4),T1=$E(T,1,2),Z="AM"
"RTN","ORQ12",76,0)
 S:T1>12 T1=T1-12,Z="PM"
"RTN","ORQ12",77,0)
 S Y=$E(D,4,5)_"/"_$E(D,6,7)_"/"_(1700+$E(D,1,3))_"@"_T1_":"_$E(T,3,4)_Z
"RTN","ORQ12",78,0)
 Q Y
"RTN","ORQ12",79,0)
 ;
"RTN","ORQ12",80,0)
NAME(X) ; -- Returns name as Lname,F
"RTN","ORQ12",81,0)
 N Y,Z S Z=$P($G(^VA(200,+X,0)),U) Q:Z="" ""
"RTN","ORQ12",82,0)
 S Y=$P(Z,",")_"," F I=$F(Z,","):1:$L(Z) I $E(Z,I)'=" " S Y=Y_$E(Z,I) Q
"RTN","ORQ12",83,0)
 S Y=$$LOWER^VALM1(Y) ; mixed case
"RTN","ORQ12",84,0)
 Q Y
"RTN","ORQ12",85,0)
 ;
"RTN","ORQ12",86,0)
ADD ; -- Add text X to ORTX()
"RTN","ORQ12",87,0)
 N I,Y S Y=$L(ORTX(ORTX)) S:Y Y=Y+1 ;allow for space
"RTN","ORQ12",88,0)
 I $E(X)=" ",Y S ORTX=ORTX+1,ORTX(ORTX)="",Y=0,X=$E(X,2,999) ;new line
"RTN","ORQ12",89,0)
 I Y+$L(X)'>WIDTH S ORTX(ORTX)=ORTX(ORTX)_$S(Y:" ",1:"")_X Q
"RTN","ORQ12",90,0)
 F I=1:1:$L(X," ") S Z=$P(X," ",I) D:(Y+$L(Z))>WIDTH  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_Z,Y=$L(ORTX(ORTX)) S:Y Y=Y+1
"RTN","ORQ12",91,0)
 . I $L(Z)>WIDTH F  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_$E(Z,1,WIDTH-Y),Z=$E(Z,WIDTH-Y+1,999) Q:$L(Z)'>WIDTH  S ORTX=ORTX+1,Y=0
"RTN","ORQ12",92,0)
 . S ORTX=ORTX+1,Y=0
"RTN","ORQ12",93,0)
 Q
"RTN","ORQ12",94,0)
 ;
"RTN","ORQ12",95,0)
EXPD ; -- loop through ^XTMP("ORAE" to get expired orders
"RTN","ORQ12",96,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ12",97,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X,ORREP
"RTN","ORQ12",98,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ12",99,0)
 F  S TO=$O(^XTMP("ORAE",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^XTMP("ORAE",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ12",100,0)
 . S IFN=0 F  S IFN=$O(^XTMP("ORAE",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ12",101,0)
 .. ;*356 Protect if x-ref dangles.
"RTN","ORQ12",102,0)
 .. I '$D(^OR(100,IFN)) K ^XTMP("ORAE",PAT,TO,TM,IFN) Q
"RTN","ORQ12",103,0)
 .. S USTS=$P(^OR(100,IFN,3),U,3)
"RTN","ORQ12",104,0)
 .. Q:+$G(USTS)'=7  ;quit if order no longer expired
"RTN","ORQ12",105,0)
 .. S ORREP=$P(^OR(100,IFN,3),U,6)
"RTN","ORQ12",106,0)
 .. Q:+$G(ORREP)>0  ;quit if order has been replaced
"RTN","ORQ12",107,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ12",108,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ12",109,0)
 .S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ12",110,0)
 ..S ACTOR=+$P(X3,U,7) D LP1^ORQ11
"RTN","ORQ12",111,0)
 ..;S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1^ORQ11
"RTN","ORQ12",112,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=$G(ORLST)
"RTN","ORQ12",113,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ12",114,0)
 Q
"RTN","ORQ12",115,0)
GETEIE(IFN,NEWD,DETAIL,ACTOR) ; -- Setup TMP array
"RTN","ORQ12",116,0)
 ; IFN=ifn of order
"RTN","ORQ12",117,0)
 ; NEWD=3rd subscript in ^TMP("ORR",$J, node (ORLIST)
"RTN","ORQ12",118,0)
 ; DETAIL=see description in ^ORQ1
"RTN","ORQ12",119,0)
 ;
"RTN","ORQ12",120,0)
 N X0,X3,X4,X6,TXT,STAT,START,DG,STOP,ENTERD,DCREAS
"RTN","ORQ12",121,0)
 S X0=^OR(100,IFN,0),X3=$G(^(3)),X4=$G(^(4)),X6=$G(^(6))
"RTN","ORQ12",122,0)
 S DG=$P(X0,U,11),DG=$P($G(^ORD(100.98,+DG,0)),U,3)
"RTN","ORQ12",123,0)
 S STAT=$S($P(X3,U,3):$P(^ORD(100.01,$P(X3,U,3),0),U,1,2),1:"")
"RTN","ORQ12",124,0)
 S ENTERD=$P(X0,U,7),START=$P(X0,U,8),STOP=$P(X0,U,9)
"RTN","ORQ12",125,0)
 S DCREAS=$P($G(X6),U,4) Q:DCREAS'>0
"RTN","ORQ12",126,0)
 I DCREAS'=$O(^ORD(100.03,"B","Entered in error","")) Q
"RTN","ORQ12",127,0)
 S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,+$G(ACTOR))=""
"RTN","ORQ12",128,0)
 I '$G(DETAIL) S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"") Q
"RTN","ORQ12",129,0)
 S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"")_U_DG_U_ENTERD_U_START_U_STOP_U_STAT
"RTN","ORQ12",130,0)
 D TEXT(.TXT,IFN) M ^TMP("ORR",$J,NEWD,ORLST,"TX")=TXT
"RTN","ORQ12",131,0)
 Q
"RTN","ORTOULT4")
0^6^B55857069^n/a
"RTN","ORTOULT4",1,0)
ORTOULT4 ;EPIP/RTW-UNIFIED ACTION PROFILE RPCS. ;Mar 05, 2019@08:07:49
"RTN","ORTOULT4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**444**;Dec 17, 1997;Build 48
"RTN","ORTOULT4",3,0)
 ;EPIP/RTW For the Unified Action Profile 26 Oct 2016
"RTN","ORTOULT4",4,0)
 ;ICR#   Type     Description
"RTN","ORTOULT4",5,0)
 ;-----  ----     -------------------------------------
"RTN","ORTOULT4",6,0)
 ;1014   Routine  LOW^XLFSTR
"RTN","ORTOULT4",7,0)
 ;
"RTN","ORTOULT4",8,0)
 ; RPC 'ORTO SET UAP FLAG'
"RTN","ORTOULT4",9,0)
 ; RPC 'ORTO SETRVW'
"RTN","ORTOULT4",10,0)
 ; RPC 'ORTO GETRVW'
"RTN","ORTOULT4",11,0)
 Q  ; NO DIRECT ENTRY
"RTN","ORTOULT4",12,0)
 ;
"RTN","ORTOULT4",13,0)
SETUAPF(ORTOK,ORTUAPF) ;
"RTN","ORTOULT4",14,0)
 N ORTUAP
"RTN","ORTOULT4",15,0)
 S ORTUAP=+$G(ORTUAPF) ;1=user in UAP view on orders tab, 0=user in any other view
"RTN","ORTOULT4",16,0)
 S ORTOK=1 ;dummy return variable
"RTN","ORTOULT4",17,0)
 Q
"RTN","ORTOULT4",18,0)
SETRVW(ORTOK,ORTRVW,ORTORIEN) ;
"RTN","ORTOULT4",19,0)
 ;
"RTN","ORTOULT4",20,0)
 N ORTIEN,ORTLRVW,ORTDT,ORTOK
"RTN","ORTOULT4",21,0)
 S ORTIEN=+$G(ORTORIEN),ORTLRVW=0,ORTOK=0
"RTN","ORTOULT4",22,0)
 Q:'ORTIEN
"RTN","ORTOULT4",23,0)
 Q:'$L($G(ORTRVW))
"RTN","ORTOULT4",24,0)
 N %,X,Y D NOW^%DTC S ORTDT=%
"RTN","ORTOULT4",25,0)
 N DR,DA,DIE
"RTN","ORTOULT4",26,0)
 S DIE="^OR(100,",DA=ORTIEN
"RTN","ORTOULT4",27,0)
 S DR=".61///^S X=ORTRVW;.62///^S X=ORTDT;.63///^S X=+$G(DUZ)"
"RTN","ORTOULT4",28,0)
 D ^DIE
"RTN","ORTOULT4",29,0)
 ;
"RTN","ORTOULT4",30,0)
 S ORTOK=1
"RTN","ORTOULT4",31,0)
 ;
"RTN","ORTOULT4",32,0)
 Q
"RTN","ORTOULT4",33,0)
GETRVW(ORTRVW,ORTORIEN) ;
"RTN","ORTOULT4",34,0)
 ;
"RTN","ORTOULT4",35,0)
 N ORTIEN
"RTN","ORTOULT4",36,0)
 S ORTRVW=0
"RTN","ORTOULT4",37,0)
 S ORTIEN=+$G(ORTORIEN)
"RTN","ORTOULT4",38,0)
 Q:'ORTIEN
"RTN","ORTOULT4",39,0)
 S ORTRVW=$P($G(^OR(100,ORTIEN,.61)),U,1)
"RTN","ORTOULT4",40,0)
 S ORTRVW=$S(ORTRVW="0":" ",ORTRVW="1":"yes",ORTRVW="C":"cont",ORTRVW="D":"dc",ORTRVW="G":"chg",ORTRVW="N":"new",ORTRVW="R":"renew",1:"")
"RTN","ORTOULT4",41,0)
 Q
"RTN","ORTOULT4",42,0)
 ;
"RTN","ORTOULT4",43,0)
REF ; REFORMAT ORDER LIST IN ALPHABETICAL ORDER
"RTN","ORTOULT4",44,0)
 ; FROM AGET^ORWORR
"RTN","ORTOULT4",45,0)
 N LIST,ORCITEM,ORI,ORJ,ORSUPPLY,ORTOADD,ORTIFN,ORTITEM,ORUI,ORUI2,ORUIEN,ORX,SUPPLY,ORTO,ORIGTA,ORKIEN,ORUAPIV,ORDG
"RTN","ORTOULT4",46,0)
 S (ORCNT,ORTO)=0  F ORI=0:0 S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<.1  D
"RTN","ORTOULT4",47,0)
 .S (ORSUPPLY,ORUAPIV,SUPPLY)=0
"RTN","ORTOULT4",48,0)
 .S ORX=^TMP("ORR",$J,ORLIST,ORI)
"RTN","ORTOULT4",49,0)
 .S ORTIFN=$P($P(ORX,U),";")
"RTN","ORTOULT4",50,0)
 .S ORTITEM=$P($G(^OR(100,ORTIFN,.1,1,0)),U) Q:ORTITEM=""
"RTN","ORTOULT4",51,0)
 .S ORCITEM=$P($G(^ORD(101.43,ORTITEM,0)),U) ;Oitem name used for sorting.
"RTN","ORTOULT4",52,0)
 .S:$D(^ORD(101.43,ORTITEM,"PS")) ORTO=1,SUPPLY=$P($G(^("PS")),U,5) ;set ORTO is "PS" exists
"RTN","ORTOULT4",53,0)
 .S ORDG=$$GET1^DIQ(100,ORTIFN,23,"E") S:(ORDG["IV")!(ORDG["INFUSION") ORUAPIV=1 ;is the service IV or Infusion
"RTN","ORTOULT4",54,0)
 .I '$G(ORUAPIV) D UAPLASTX(ORTIFN,ORTITEM) ;all non IV reset ORCITEM if last Oitem/Otext mismatch
"RTN","ORTOULT4",55,0)
 .I $G(ORUAPIV) S ORCITEM=$$UAPIV(ORCITEM,ORTIFN) ; multiple Oitem IV no ADDITIVE get last text.
"RTN","ORTOULT4",56,0)
 .K ^TMP("ORR",$J,ORLIST,ORI)
"RTN","ORTOULT4",57,0)
 .I $$GET1^DIQ(100.98,GROUPS,.01)="PHARMACY UAP" D
"RTN","ORTOULT4",58,0)
 .. S ORUI=0 F  S ORUI=$O(^ORD(100.98,GROUPS,1,ORUI)) Q:'ORUI  D
"RTN","ORTOULT4",59,0)
 ... S ORUI2=$G(^ORD(100.98,GROUPS,1,ORUI,0)) I $$GET1^DIQ(100.98,ORUI2,.01)["SUPPL" S ORSUPPLY=1
"RTN","ORTOULT4",60,0)
 .Q:(SUPPLY)&'$G(ORSUPPLY)
"RTN","ORTOULT4",61,0)
 .S ORCNT=ORCNT+1
"RTN","ORTOULT4",62,0)
 .S ORCITEM=$$LOW^XLFSTR(ORCITEM) ;tallman lettering fix rtw
"RTN","ORTOULT4",63,0)
 .S LIST(ORCITEM,ORCNT)=ORX
"RTN","ORTOULT4",64,0)
 S ORICNT=0
"RTN","ORTOULT4",65,0)
 S ORCITEM="" F ORJ=0:0 S ORCITEM=$O(LIST(ORCITEM)) Q:ORCITEM=""  D
"RTN","ORTOULT4",66,0)
 .F ORK=0:0 S ORK=$O(LIST(ORCITEM,ORK)) Q:ORK<1  D
"RTN","ORTOULT4",67,0)
 ..S ORUIEN=$P(LIST(ORCITEM,ORK),";"),ORKIEN=$P($P(LIST(ORCITEM,ORK),U),";",2)
"RTN","ORTOULT4",68,0)
 ..S IENS=ORKIEN_","_ORUIEN Q:$$GET1^DIQ(100.008,IENS_",","15")["dc/edit"
"RTN","ORTOULT4",69,0)
 ..S ORICNT=ORICNT+1
"RTN","ORTOULT4",70,0)
 ..S ^TMP("ORR",$J,ORLIST,ORICNT)=LIST(ORCITEM,ORK)
"RTN","ORTOULT4",71,0)
 K ORCNT,ORICNT
"RTN","ORTOULT4",72,0)
 Q
"RTN","ORTOULT4",73,0)
 ;
"RTN","ORTOULT4",74,0)
UAPIV(ORCITEM,ORTIFN) ;this puts an IV in correct number order by first additive if it has one.
"RTN","ORTOULT4",75,0)
 N ORTITMN,ORTADD
"RTN","ORTOULT4",76,0)
 S (ORTITMN,ORTOADD)=0 F  S ORTITMN=$O(^OR(100,ORTIFN,.1,ORTITMN)) Q:('ORTITMN)!(ORTOADD=1)  D  ;new sort when INFUSION ORDER
"RTN","ORTOULT4",77,0)
 . S ORTITEM=$P($G(^OR(100,ORTIFN,.1,ORTITMN,0)),U)
"RTN","ORTOULT4",78,0)
 . Q:+$D(^ORD(101.43,ORTITEM,"PS"))'>0
"RTN","ORTOULT4",79,0)
 . S:$P(^ORD(101.43,ORTITEM,"PS"),U,3) ORTOADD=0
"RTN","ORTOULT4",80,0)
 . Q:$P(^ORD(101.43,ORTITEM,"PS"),U,3)
"RTN","ORTOULT4",81,0)
 . S:$P(^ORD(101.43,ORTITEM,"PS"),U,4) ORTOADD=1 ;end new code to handle infusion orders.
"RTN","ORTOULT4",82,0)
 . S ORCITEM=$G(^ORD(101.43,ORTITEM,0),U)
"RTN","ORTOULT4",83,0)
 S:'$G(ORTOADD) ORIGTA=$$LASTXT^ORQ12(ORTIFN),ORCITEM=$G(^OR(100,ORTIFN,8,ORIGTA,.1,1,0)) S:$E(ORCITEM,1,3)=">> " ORCITEM=$E(ORCITEM,4,999)
"RTN","ORTOULT4",84,0)
 Q ORCITEM
"RTN","ORTOULT4",85,0)
 ;
"RTN","ORTOULT4",86,0)
UAPALPHA(ORTOADD,ORTA,ORTIFN) ; called by ORQ12 resorts the order text field so that the first additive is on the top to match the sorted by orderable item name.
"RTN","ORTOULT4",87,0)
 K ^TMP("UAP",$J),^TMP("UAPTEXT",$J)
"RTN","ORTOULT4",88,0)
 N ORUAP1,ORUAP2,ORUTX,ORUTY,ORUAPCN2,ORUAPCN3,ORUAPCNT,ORTMSAVE
"RTN","ORTOULT4",89,0)
 S ORTITEM=$P($G(^OR(100,ORTIFN,.1,1,0)),U),ORTMSAVE=ORTITEM ;set item first in case there is no additive.
"RTN","ORTOULT4",90,0)
 S (ORTITMN,ORTOADD)=0 F  S ORTITMN=$O(^OR(100,ORTIFN,.1,ORTITMN)) Q:('ORTITMN)!(ORTOADD=1)  D  ;new sort when INFUSION ORDER
"RTN","ORTOULT4",91,0)
 . S ORTITEM=$P($G(^OR(100,ORTIFN,.1,ORTITMN,0)),U)
"RTN","ORTOULT4",92,0)
 . Q:+$D(^ORD(101.43,ORTITEM,"PS"))'>0
"RTN","ORTOULT4",93,0)
 . S:$P(^ORD(101.43,ORTITEM,"PS"),U,3) ORTOADD=0
"RTN","ORTOULT4",94,0)
 . Q:$P(^ORD(101.43,ORTITEM,"PS"),U,3)  ;this indicates a base.
"RTN","ORTOULT4",95,0)
 . S:$P(^ORD(101.43,ORTITEM,"PS"),U,4) ORTOADD=1 ;end new code to put first additive on top of infusion order display.
"RTN","ORTOULT4",96,0)
 S:'$G(ORTOADD) ORTITEM=ORTMSAVE  ;code to handle if the IV has no additive.
"RTN","ORTOULT4",97,0)
 S ^TMP("UAP",$J,ORTIFN,1)=ORTITEM
"RTN","ORTOULT4",98,0)
 S ORUAP1=0,ORUAPCNT=2 F  S ORUAP1=$O(^OR(100,ORTIFN,.1,ORUAP1)) Q:'ORUAP1  D
"RTN","ORTOULT4",99,0)
 . Q:$P(^OR(100,ORTIFN,.1,ORUAP1,0),U)=ORTITEM
"RTN","ORTOULT4",100,0)
 . S ^TMP("UAP",$J,ORTIFN,ORUAPCNT)=$P(^OR(100,ORTIFN,.1,ORUAP1,0),U)
"RTN","ORTOULT4",101,0)
 . S ORUAPCNT=ORUAPCNT+1
"RTN","ORTOULT4",102,0)
 S ORUAP2=0,ORUAPCN2=1 F  S ORUAP2=$O(^OR(100,ORTIFN,8,ORTA,.1,ORUAP2)) Q:'ORUAP2  D
"RTN","ORTOULT4",103,0)
 . S ORUTX=$G(^OR(100,ORTIFN,8,ORTA,.1,ORUAP2,0)) S ORUTY=$L(ORUTX)
"RTN","ORTOULT4",104,0)
 . I $E(ORUTX)=" ",ORUTY S ORUTX=$E(ORUTX,2,999) ;new line
"RTN","ORTOULT4",105,0)
 . S ^TMP("UAPTEXT",$J,ORTIFN,ORUAPCN2)=ORUTX
"RTN","ORTOULT4",106,0)
 . S ORUAPCN2=ORUAPCN2+1
"RTN","ORTOULT4",107,0)
 Q:'$G(ORTOADD) ORTOADD
"RTN","ORTOULT4",108,0)
UAPRTW ; part of the UAPALPHA above this part takes the original IV list and places it in the new order
"RTN","ORTOULT4",109,0)
 K ORTX
"RTN","ORTOULT4",110,0)
 N ORUAP3,ORUAP4,ORUAP5,ORTITE2
"RTN","ORTOULT4",111,0)
 S ORTITE2=$P(^TMP("UAP",$J,ORTIFN,1),U)
"RTN","ORTOULT4",112,0)
 S ORUAP3=0,ORUAP4=1,ORUAPCN3=1 F  S ORUAP3=$O(^TMP("UAPTEXT",$J,ORTIFN,ORUAP3)) Q:'ORUAP3  D
"RTN","ORTOULT4",113,0)
 . I $G(^TMP("UAPTEXT",$J,ORTIFN,ORUAP3))[$$GET1^DIQ(101.43,ORTITE2,.01,"I",) S ORTX(ORUAP4)=^TMP("UAPTEXT",$J,ORTIFN,ORUAP3),ORUAP4=ORUAP4+1 Q
"RTN","ORTOULT4",114,0)
 I ORUAP4>1 S ORUAP5=0 F  S ORUAP5=$O(^TMP("UAPTEXT",$J,ORTIFN,ORUAP5)) Q:'ORUAP5  D
"RTN","ORTOULT4",115,0)
 . I $G(^TMP("UAPTEXT",$J,ORTIFN,ORUAP5))'[$$GET1^DIQ(101.43,ORTITE2,.01,"I",) S ORTX(ORUAP4)=^TMP("UAPTEXT",$J,ORTIFN,ORUAP5)
"RTN","ORTOULT4",116,0)
 . S ^TMP("UAP3",$J,ORTIFN,ORUAPCN3)=^TMP("UAPTEXT",$J,ORTIFN,ORUAP5)
"RTN","ORTOULT4",117,0)
 . S ORUAPCN3=ORUAPCN3+1,ORUAP4=ORUAP4+1
"RTN","ORTOULT4",118,0)
 Q
"RTN","ORTOULT4",119,0)
DCREF  ; Reformat order list in special Discharge View order
"RTN","ORTOULT4",120,0)
 ; Active : Hold : Pending : Discontinued : Expired
"RTN","ORTOULT4",121,0)
 ; FROM AGET^ORWORR => GET1^ORWORR1 => here
"RTN","ORTOULT4",122,0)
 N LIST,ORI,ORK,ORX,ORTIFN,ORTITEM,ORCITEM,SUPPLY,ORTSTLST,ORTSTA,ORTIDX,ORCNT,ORICNT
"RTN","ORTOULT4",123,0)
 N ORTSVPT1
"RTN","ORTOULT4",124,0)
 ;
"RTN","ORTOULT4",125,0)
 S ORTSTLST(6)=1 ;Active/Suspended
"RTN","ORTOULT4",126,0)
 S ORTSTLST(3)=2 ;Hold
"RTN","ORTOULT4",127,0)
 S ORTSTLST(5)=3 ;Pending
"RTN","ORTOULT4",128,0)
 S ORTSTLST(7)=4 ;Expired
"RTN","ORTOULT4",129,0)
 S ORTSTLST(1)=5 ;Discontinued
"RTN","ORTOULT4",130,0)
 ;
"RTN","ORTOULT4",131,0)
 I $D(^TMP("ORR",$J,ORLIST,.1)) S ORTSVPT1=$G(^TMP("ORR",$J,ORLIST,.1))
"RTN","ORTOULT4",132,0)
 ;
"RTN","ORTOULT4",133,0)
 S (ORI,ORCNT)=0
"RTN","ORTOULT4",134,0)
 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<.1  D
"RTN","ORTOULT4",135,0)
 .S ORX=^TMP("ORR",$J,ORLIST,ORI)
"RTN","ORTOULT4",136,0)
 .S ORTIFN=$P($P(ORX,U),";")
"RTN","ORTOULT4",137,0)
 .;
"RTN","ORTOULT4",138,0)
 .S ORTSTA=+$P($G(^OR(100,ORTIFN,3)),U,3)
"RTN","ORTOULT4",139,0)
 .S ORTIDX=$S($D(ORTSTLST(ORTSTA)):ORTSTLST(ORTSTA),1:9)
"RTN","ORTOULT4",140,0)
 .S ORTITEM=$P($G(^OR(100,ORTIFN,.1,1,0)),U) Q:ORTITEM=""
"RTN","ORTOULT4",141,0)
 .S ORCITEM=$P($G(^ORD(101.43,ORTITEM,0)),U),SUPPLY=$P($G(^("PS")),U,5)
"RTN","ORTOULT4",142,0)
 .K ^TMP("ORR",$J,ORLIST,ORI)
"RTN","ORTOULT4",143,0)
 .S ORCNT=ORCNT+1
"RTN","ORTOULT4",144,0)
 .S ORCITEM=$$LOW^XLFSTR(ORCITEM)  ;tallman lettering fix rtw
"RTN","ORTOULT4",145,0)
 .S LIST(ORTIDX,ORCITEM,ORCNT)=ORX
"RTN","ORTOULT4",146,0)
 ;
"RTN","ORTOULT4",147,0)
 S ORICNT=0
"RTN","ORTOULT4",148,0)
 S ORTIDX=0 F  S ORTIDX=$O(LIST(ORTIDX)) Q:'ORTIDX  D
"RTN","ORTOULT4",149,0)
 . S ORCITEM="" F  S ORCITEM=$O(LIST(ORTIDX,ORCITEM)) Q:ORCITEM=""  D
"RTN","ORTOULT4",150,0)
 . . S ORK=0 F  S ORK=$O(LIST(ORTIDX,ORCITEM,ORK)) Q:'ORK  D
"RTN","ORTOULT4",151,0)
 . . . S ORICNT=ORICNT+1
"RTN","ORTOULT4",152,0)
 . . . S ^TMP("ORR",$J,ORLIST,ORICNT)=LIST(ORTIDX,ORCITEM,ORK)
"RTN","ORTOULT4",153,0)
 ;
"RTN","ORTOULT4",154,0)
 I $D(ORTSVPT1) S ^TMP("ORR",$J,ORLIST,.1)=ORTSVPT1
"RTN","ORTOULT4",155,0)
 ;
"RTN","ORTOULT4",156,0)
 Q
"RTN","ORTOULT4",157,0)
UAPOFF(ORUAPOFF) ;ON/OFF SWITCH
"RTN","ORTOULT4",158,0)
 ;
"RTN","ORTOULT4",159,0)
 S ORUAPOFF=$$GET^XPAR("ALL","OR UNIFIED ACTION PROFILE OFF")
"RTN","ORTOULT4",160,0)
 Q ORUAPOFF
"RTN","ORTOULT4",161,0)
DGROUP(ORDGNAME,ORX) ;RPC ORTO DGROUP to get the DGroup name
"RTN","ORTOULT4",162,0)
 S ORDGNAME=$P($G(^ORD(100.98,ORX,0)),U,1)
"RTN","ORTOULT4",163,0)
 Q
"RTN","ORTOULT4",164,0)
UAPLASTX(ORTIFN,ORTITEM) ;
"RTN","ORTOULT4",165,0)
 N OROTXT,OROTXTX
"RTN","ORTOULT4",166,0)
 S ORIGTA=$$LASTXT^ORQ12(ORTIFN) ; GETS THE LAST ORDERTEXT IEN
"RTN","ORTOULT4",167,0)
 S OROTXT=$G(^OR(100,ORTIFN,8,ORIGTA,.1,1,0)) S:$E(OROTXT,1,3)=">> " OROTXT=$E(OROTXT,4,999)
"RTN","ORTOULT4",168,0)
 S ORCITEM=$P($G(^ORD(101.43,ORTITEM,0)),U)
"RTN","ORTOULT4",169,0)
 S OROTXTX=$E(OROTXT,1,2),ORCITEMX=$E(ORCITEM,1,2)
"RTN","ORTOULT4",170,0)
 S:OROTXTX'=ORCITEMX ORCITEM=OROTXT
"RTN","ORTOULT4",171,0)
 Q
"RTN","ORUA444P")
0^^B6132340^n/a
"RTN","ORUA444P",1,0)
ORUA444P ;EPIP/RTW - QUICK ORDER POST INSTALL ; 4/26/17 12:54am
"RTN","ORUA444P",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**444**;Dec 17, 1997;Build 48
"RTN","ORUA444P",3,0)
 ;ICR#   Type  Description
"RTN","ORUA444P",4,0)
 ;-----  ----  -------------------------------------
"RTN","ORUA444P",5,0)
 ;2053   Sup   UPDATE^DIE
"RTN","ORUA444P",6,0)
 D ADDGROUP,ORADDRPC
"RTN","ORUA444P",7,0)
 Q
"RTN","ORUA444P",8,0)
ADDGROUP ;
"RTN","ORUA444P",9,0)
 N ORDISPGP,ORDGSQCE,ORMBNAME,ORMXNAME,ORSHNAME,ORDGIEN,ORDGIEN2,ORX,MSG,FDA2,FDA
"RTN","ORUA444P",10,0)
 S ORDISPGP="" F ORDISPGP="DISCHARGE MEDS","PHARMACY UAP" Q:ORDISPGP=""  D
"RTN","ORUA444P",11,0)
 . Q:$D(^ORD(100.98,"B",ORDISPGP))
"RTN","ORUA444P",12,0)
 . S:ORDISPGP="DISCHARGE MEDS" ORSHNAME="DM",ORMXNAME="DISCHARGE MEDS"
"RTN","ORUA444P",13,0)
 . S:ORDISPGP="PHARMACY UAP" ORSHNAME="UAP",ORMXNAME="UAP"
"RTN","ORUA444P",14,0)
 . S FDA(100.98,"+1,",.01)=ORDISPGP
"RTN","ORUA444P",15,0)
 . S FDA(100.98,"+1,",2)=ORMXNAME
"RTN","ORUA444P",16,0)
 . S FDA(100.98,"+1,",3)=ORSHNAME
"RTN","ORUA444P",17,0)
 . D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","ORUA444P",18,0)
 . S ORDGIEN=+$P($Q(^ORD(100.98,"B",ORDISPGP)),",",4)
"RTN","ORUA444P",19,0)
 . S ORDGSQCE=0,ORMBNAME="" S ORMBNAME="" F ORMBNAME="OUTPATIENT MEDICATIONS","INPATIENT MEDICATIONS","NON-VA MEDICATIONS" Q:ORMBNAME=""  Q:(ORDISPGP="DISCHARGE MEDS")&(ORDGSQCE=1)  D
"RTN","ORUA444P",20,0)
 . . S ORDGIEN2=0,ORDGIEN2=$O(^ORD(100.98,"B",ORMBNAME,ORDGIEN2))
"RTN","ORUA444P",21,0)
 . . S ORDGSQCE=ORDGSQCE+1
"RTN","ORUA444P",22,0)
 . . S FDA2(1,100.981,"+2,"_ORDGIEN_",",.001)=ORDGSQCE
"RTN","ORUA444P",23,0)
 . . S FDA2(1,100.981,"+2,"_ORDGIEN_",",.01)=ORDGIEN2
"RTN","ORUA444P",24,0)
 . . D UPDATE^DIE("","FDA2(1)")
"RTN","ORUA444P",25,0)
 . K FDA,FDAIEN
"RTN","ORUA444P",26,0)
 I $D(MSG) D  Q
"RTN","ORUA444P",27,0)
 . S ORX="Display Group Creation Failed.  The following error message was returned:"
"RTN","ORUA444P",28,0)
 . W !
"RTN","ORUA444P",29,0)
 . D MES^XPDUTL(ORX)
"RTN","ORUA444P",30,0)
 S ORX="Display Groups created successfully."
"RTN","ORUA444P",31,0)
 D MES^XPDUTL(ORX)
"RTN","ORUA444P",32,0)
 Q
"RTN","ORUA444P",33,0)
ORADDRPC ;ADD RPCS TO THE OR CPRS GUI CHART OPTION
"RTN","ORUA444P",34,0)
 ;GET OR CPRS GUI CHART IEN
"RTN","ORUA444P",35,0)
 ;ORTO GETRVW
"RTN","ORUA444P",36,0)
 ;ORTO SET UAP FLAG
"RTN","ORUA444P",37,0)
 ;ORTO SETRVW
"RTN","ORUA444P",38,0)
 ;ORTO UAPOFF
"RTN","ORUA444P",39,0)
 ;ORTO DGROUP
"RTN","ORUA444P",40,0)
 N FDA,OROP,ORRPCIEN,ORTORPC
"RTN","ORUA444P",41,0)
 S OROP=+$P($Q(^DIC(19,"B","OR CPRS GUI CHART")),",",4)
"RTN","ORUA444P",42,0)
 S ORTORPC="" F ORTORPC="ORTO GETRVW","ORTO SET UAP FLAG","ORTO SETRVW","ORTO UAPOFF","ORTO DGROUP" Q:ORTORPC=""  D
"RTN","ORUA444P",43,0)
 . S ORRPCIEN=0 S ORRPCIEN=$O(^XWB(8994,"B",ORTORPC,ORRPCIEN))
"RTN","ORUA444P",44,0)
 . Q:$D(^DIC(19,OROP,"RPC","B",ORRPCIEN))
"RTN","ORUA444P",45,0)
 . S FDA(1,19.05,"+2,"_OROP_",",.01)=ORRPCIEN
"RTN","ORUA444P",46,0)
 . D UPDATE^DIE("","FDA(1)")
"RTN","ORUA444P",47,0)
  Q
"RTN","ORWORR")
0^8^B88246015^B81663175
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ;Aug 21, 2018@11:16
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141,163,189,195,215,243,280,306,471,444**;Dec 17, 1997;Build 48
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
 ;DBIA/ICR section
"RTN","ORWORR",5,0)
 ;10035 ^DPT(
"RTN","ORWORR",6,0)
 ;10040 ^SC(
"RTN","ORWORR",7,0)
 ;10060 ^VA(200
"RTN","ORWORR",8,0)
 ;10000 %DTC
"RTN","ORWORR",9,0)
 ; 2263 XPAR
"RTN","ORWORR",10,0)
 ; 2343 XUSER
"RTN","ORWORR",11,0)
 ;
"RTN","ORWORR",12,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",13,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",14,0)
 ;    & until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",15,0)
 ;    & until the date ranges implemented
"RTN","ORWORR",16,0)
 ; Get orders for patient
"RTN","ORWORR",17,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16 17    18
"RTN","ORWORR",18,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^^Schedule
"RTN","ORWORR",19,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",20,0)
 ;     DFN=Patient ID
"RTN","ORWORR",21,0)
 ;  FILTER=# indicates which orders to return, default=2 (current)
"RTN","ORWORR",22,0)
 ;  GROUPS=display grp of orders to show (default=ALL)
"RTN","ORWORR",23,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",24,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",25,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",26,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",27,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",28,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",29,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",30,0)
 . D GETFLDS
"RTN","ORWORR",31,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",32,0)
 G EXIT
"RTN","ORWORR",33,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT,ORRECIP) ;Get abbrev. event delayed order list for patient
"RTN","ORWORR",34,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",35,0)
 ; see input parameters above
"RTN","ORWORR",36,0)
 ; -- from ORWORR
"RTN","ORWORR",37,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",38,0)
 K ORUGROUP ;RTW UAP Pharmacist modify indication removal for UAP
"RTN","ORWORR",39,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",40,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",41,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",42,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",43,0)
 I $G(GROUPS),($$GET1^DIQ(100.98,GROUPS,.01)="PHARMACY UAP")!($$GET1^DIQ(100.98,GROUPS,.01)="DISCHARGE MEDS") S ORUGROUP=GROUPS ;Capturing GROUPS for later UAP use GETFLDS
"RTN","ORWORR",44,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",45,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",46,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; normally ptr to 42
"RTN","ORWORR",47,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",48,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",49,0)
 I $P(DTFROM,".")=$P(DTTHRU,"."),$P(DTFROM,".",2)>$P(DTTHRU,".",2),$P(DTTHRU,".",2)="" S $P(DTTHRU,".",2)=2359
"RTN","ORWORR",50,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",51,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",52,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"",1,EVENT)
"RTN","ORWORR",53,0)
 . D GET2^ORWORR1
"RTN","ORWORR",54,0)
 E  D
"RTN","ORWORR",55,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"",1,EVENT)
"RTN","ORWORR",56,0)
 . D GET1^ORWORR1
"RTN","ORWORR",57,0)
 Q
"RTN","ORWORR",58,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",59,0)
 N EVTDCREL
"RTN","ORWORR",60,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",61,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",62,0)
 Q
"RTN","ORWORR",63,0)
XGET ; retrieval algorithm before all the AC xref changes
"RTN","ORWORR",64,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA,PASS ;PKI
"RTN","ORWORR",65,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",66,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",67,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",68,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",69,0)
 . D XPND(GROUPS)
"RTN","ORWORR",70,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",71,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",72,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",73,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",74,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",75,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",76,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",77,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",78,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",79,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",80,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",81,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",82,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",83,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",84,0)
 D DOGET
"RTN","ORWORR",85,0)
EXIT I LST=0 D
"RTN","ORWORR",86,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",87,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",88,0)
 Q
"RTN","ORWORR",89,0)
DOGET ; Here to filter orders
"RTN","ORWORR",90,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",91,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",92,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",93,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",94,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",95,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",96,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",97,0)
 . . . ; any other filtering
"RTN","ORWORR",98,0)
 . . . D GETFLDS
"RTN","ORWORR",99,0)
 Q
"RTN","ORWORR",100,0)
DOALL ; Here to get all orders (no filter by status)
"RTN","ORWORR",101,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",102,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",103,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",104,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",105,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",106,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",107,0)
 . . . D GETFLDS
"RTN","ORWORR",108,0)
 Q
"RTN","ORWORR",109,0)
DOCUR ; Here to get all current orders
"RTN","ORWORR",110,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",111,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",112,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",113,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",114,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",115,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",116,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",117,0)
 . . ; filter out display groups here
"RTN","ORWORR",118,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",119,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",120,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",121,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",122,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",123,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",124,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",125,0)
 . . . D GETFLDS
"RTN","ORWORR",126,0)
 Q
"RTN","ORWORR",127,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",128,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",129,0)
 Q
"RTN","ORWORR",130,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get order fields TEMP
"RTN","ORWORR",131,0)
 G GET41
"RTN","ORWORR",132,0)
GET4LST(LST,IFNLST) ; get order fields for list of orders
"RTN","ORWORR",133,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",134,0)
 N LOC ;IMO
"RTN","ORWORR",135,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",136,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",137,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",138,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",139,0)
 . D GETFLDS
"RTN","ORWORR",140,0)
 Q
"RTN","ORWORR",141,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",142,0)
 ; get fields for single order
"RTN","ORWORR",143,0)
 ; .LST(n)=described above in GET
"RTN","ORWORR",144,0)
 ;  IFN=internal entry # for order
"RTN","ORWORR",145,0)
 I 'IFN Q
"RTN","ORWORR",146,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",147,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",148,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",149,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",150,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",151,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",152,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",153,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^^DigSig^LOC^[DCORIGNAL]^IsPendingDCorder^IsDelayOrder
"RTN","ORWORR",154,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",155,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",156,0)
 S DEA=$$DEA^XUSER(,+PRV) ; get user DEA info - PKI
"RTN","ORWORR",157,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",158,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",159,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",160,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",161,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",162,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",163,0)
 I '$D(ORUGROUP) S ORUGROUP="" ;RTW Pharmacist modify indication removal for UAP, first time entering CPRS all services view
"RTN","ORWORR",164,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",165,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",166,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",167,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",168,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI
"RTN","ORWORR",169,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",170,0)
 I '$P($G(^OR(100,IFN,8,ACT,2)),"^",5),$P(X0,"^",5) D  ;Copy orders PKI fix
"RTN","ORWORR",171,0)
 . N OI,ORVP,ORCAT,PKG,ORPKIU
"RTN","ORWORR",172,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",173,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",174,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",175,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORWORR",176,0)
 . S ORPKIU=0 I $D(^ORD(100.7,"C",DUZ)) S ORPKIU=1
"RTN","ORWORR",177,0)
 . D PKI^ORWDPS1(.ORY,OI,ORCAT,+ORVP,ORPKIU)
"RTN","ORWORR",178,0)
 . I $E($G(ORY))=2 S $P(LST(IDX),U,18)=ORY
"RTN","ORWORR",179,0)
 ; Change to display location for Clinic Orders, Inpatients, & IV infusion orders.
"RTN","ORWORR",180,0)
 N DGID,DGNAM
"RTN","ORWORR",181,0)
 S LOC=""
"RTN","ORWORR",182,0)
 S DGID=$P(X0,U,11)
"RTN","ORWORR",183,0)
 I $L(DGID) D
"RTN","ORWORR",184,0)
 .S DGNAM=$P($G(^ORD(100.98,DGID,0)),U)
"RTN","ORWORR",185,0)
 .;I DGNAM="CLINIC ORDERS"!(DGNAM="INPATIENT MEDICATIONS")!(DGNAM="IV MEDICATIONS")!(DGNAM="UNIT DOSE MEDICATIONS") D
"RTN","ORWORR",186,0)
 .S LOC=$P(X0,U,10) ;IMO
"RTN","ORWORR",187,0)
 .S:+LOC LOC=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO
"RTN","ORWORR",188,0)
 S $P(LST(IDX),U,19)=LOC ;IMO
"RTN","ORWORR",189,0)
 S $P(LST(IDX),U,20)=$P($G(^OR(100,IFN,6)),"^",9)
"RTN","ORWORR",190,0)
 ;need a way to determine if order is in an unsigned DC state.
"RTN","ORWORR",191,0)
 S $P(LST(IDX),U,21)=$S(ACTID="DC":1,1:0)
"RTN","ORWORR",192,0)
 S $P(LST(IDX),U,22)=$$CHKORD^OREVNTX1(IFN)
"RTN","ORWORR",193,0)
 D
"RTN","ORWORR",194,0)
 . N OI,ORVP,ORCAT,PKG,ORCONSUB,ORCSPKG,ORYD
"RTN","ORWORR",195,0)
 . S ORCSPKG=""
"RTN","ORWORR",196,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",197,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",198,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",199,0)
 . I PKG=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) S ORCSPKG="O"
"RTN","ORWORR",200,0)
 . I PKG=$O(^DIC(9.4,"B","UNIT DOSE MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",201,0)
 . I PKG=$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",202,0)
 . I PKG=$O(^DIC(9.4,"B","IV MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",203,0)
 . I ORCSPKG="" S $P(LST(IDX),U,23,24)="0^0" Q
"RTN","ORWORR",204,0)
 . D CSCHECK^ORDEA(.ORCONSUB,OI,ORCSPKG)
"RTN","ORWORR",205,0)
 . S $P(LST(IDX),U,23)=$P(ORCONSUB,U)
"RTN","ORWORR",206,0)
 . S $P(LST(IDX),U,24)=$P(ORCONSUB,U,2)
"RTN","ORWORR",207,0)
 ;
"RTN","ORWORR",208,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",209,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255,ORUGROUP) ; optimize later ;RTW PASSING ORUGROUP
"RTN","ORWORR",210,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",211,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)),'$G(ORUGROUP) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN) ;RTW ORUGROUP
"RTN","ORWORR",212,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",213,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",214,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",215,0)
 Q
"RTN","ORWORR",216,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",217,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",218,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",219,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",220,0)
GETTXT(LST,IFN) ; get text of an order
"RTN","ORWORR",221,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",222,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",223,0)
 Q
"RTN","ORWORR",224,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",225,0)
 ; Expand display group (GROUPS defined outside of call)
"RTN","ORWORR",226,0)
 N I,CHLD
"RTN","ORWORR",227,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",228,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",229,0)
 Q
"RTN","ORWORR",230,0)
GETPKG(Y,IFN) ; get order pkg
"RTN","ORWORR",231,0)
 N ORDERID,PKGID
"RTN","ORWORR",232,0)
 Q:+IFN<1
"RTN","ORWORR",233,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",234,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",235,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",236,0)
 Q
"RTN","ORWORR1")
0^4^B14089076^B9884468
"RTN","ORWORR1",1,0)
ORWORR1 ; SLC/JLI - Utilities for Retrieve Orders for Broker ;Feb 24, 2018@06:51 [7/23/18 10:25am]
"RTN","ORWORR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,243,456,444**;Dec 17, 1997;Build 48
"RTN","ORWORR1",3,0)
 ;Called from ORWORR
"RTN","ORWORR1",4,0)
 ;EPIP/RTW Modified for the Unified Action Profile 26 Oct 2016
"RTN","ORWORR1",5,0)
 ; External References
"RTN","ORWORR1",6,0)
 ;   DBIA  4834  GETUSER1^XQALDATA
"RTN","ORWORR1",7,0)
 ;   DBIA  2790  $$CURRSURO^XQALSURO
"RTN","ORWORR1",8,0)
 ;
"RTN","ORWORR1",9,0)
GET1 ;
"RTN","ORWORR1",10,0)
 N ORGROUP
"RTN","ORWORR1",11,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",12,0)
 S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S IFN=^(I) D
"RTN","ORWORR1",13,0)
 . ;I $G(ORRECIP)&&($G(FILTER)=12&&($$FLAGRULE(+IFN))) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",14,0)
 . ;correction above line, error in XINDEX ;OR*405
"RTN","ORWORR1",15,0)
 . I $G(ORRECIP),$G(FILTER)=12,$$FLAGRULE(+IFN) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",16,0)
 . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",17,0)
 . ;EPIP/RTW BEGIN ***UNIFIED ACTION PROFILE Modification*** 9/27/2017
"RTN","ORWORR1",18,0)
 . ;FILTER OUT NON OUTPATIENT ORDERS
"RTN","ORWORR1",19,0)
 . S ORGROUP=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORWORR1",20,0)
 . I $G(GROUPS),$$GET1^DIQ(100.98,GROUPS,.01)="DISCHARGE MEDS",$P($G(^OR(100,+IFN,0)),U,11)'=ORGROUP K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",21,0)
 . ;END ***UNIFIED ACTION PROFILE Modification*** 9/27/2017
"RTN","ORWORR1",22,0)
 . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",23,0)
 . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",24,0)
 . S ^TMP("ORR",$J,ORLIST,I)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",25,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",26,0)
 S ^TMP("ORR",$J,ORLIST,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",27,0)
 ;EPIP/RTW BEGIN ***UNIFIED ACTION PROFILE Modification*** 26/OCT/2016
"RTN","ORWORR1",28,0)
 ;ALPHABETICAL ORDER SORT FOR UAP View
"RTN","ORWORR1",29,0)
 ; Special sort for Discharge View
"RTN","ORWORR1",30,0)
 I $G(GROUPS),$$GET1^DIQ(100.98,GROUPS,.01)="DISCHARGE MEDS" D DCREF^ORTOULT4
"RTN","ORWORR1",31,0)
 I $G(GROUPS),$$GET1^DIQ(100.98,GROUPS,.01)="PHARMACY UAP" D REF^ORTOULT4
"RTN","ORWORR1",32,0)
 ; END UAP modification
"RTN","ORWORR1",33,0)
 S REF=$NA(^TMP("ORR",$J,ORLIST))
"RTN","ORWORR1",34,0)
 Q
"RTN","ORWORR1",35,0)
GET2 ; For AUTO DC/Event Release Orders
"RTN","ORWORR1",36,0)
 N JDND,JDIX,JDCNT,DCSPLIT
"RTN","ORWORR1",37,0)
 S JDCNT=1,DCSPLIT=0
"RTN","ORWORR1",38,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",39,0)
 F JDND="RL","DC" D
"RTN","ORWORR1",40,0)
 . S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  D
"RTN","ORWORR1",41,0)
 . . I '$D(^TMP("ORR",$J,ORLIST,I,JDND)) Q
"RTN","ORWORR1",42,0)
 . . S JDIX=0 F  S JDIX=$O(^TMP("ORR",$J,ORLIST,I,JDND,JDIX)) Q:'JDIX  S IFN=^(JDIX)  D
"RTN","ORWORR1",43,0)
 . . . I 'DCSPLIT,(JDND="DC") D
"RTN","ORWORR1",44,0)
 . . . . S ^TMP("ORRJD",$J,JDCNT)="DC START"
"RTN","ORWORR1",45,0)
 . . . . S DCSPLIT=1,JDCNT=JDCNT+1,TOT=TOT+1
"RTN","ORWORR1",46,0)
 . . . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) S TOT=TOT-1 Q
"RTN","ORWORR1",47,0)
 . . . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",48,0)
 . . . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",49,0)
 . . . S ^TMP("ORRJD",$J,JDCNT)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",50,0)
 . . . S JDCNT=JDCNT+1
"RTN","ORWORR1",51,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",52,0)
 S ^TMP("ORRJD",$J,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",53,0)
 S REF=$NA(^TMP("ORRJD",$J))
"RTN","ORWORR1",54,0)
 Q
"RTN","ORWORR1",55,0)
FLAGRULE(ORNUM,USR) ;
"RTN","ORWORR1",56,0)
 ;returns 0 if we should keep ORNUM in the list
"RTN","ORWORR1",57,0)
 ;returns 1 if we should remove ORNUM from the list
"RTN","ORWORR1",58,0)
 ;determines based on whether the user USR should see these flagged orders
"RTN","ORWORR1",59,0)
 ; based on presence in file 100 NODE 8 FIELD 39 and
"RTN","ORWORR1",60,0)
 ; based on whether the user should have gotten the flag due to provider recipients
"RTN","ORWORR1",61,0)
 N ORI,ORRET,ORQUIT,I,LST,ORDFN
"RTN","ORWORR1",62,0)
 I '$G(USR) S USR=DUZ
"RTN","ORWORR1",63,0)
 S ORRET=1,ORQUIT=0
"RTN","ORWORR1",64,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORNUM,8,ORI)) Q:'ORI  D
"RTN","ORWORR1",65,0)
 .I '$P($G(^OR(100,ORNUM,8,ORI,3)),U,6)&($P($G(^OR(100,ORNUM,8,ORI,3)),U,9)) S LST($P($G(^OR(100,ORNUM,8,ORI,3)),U,9))=""
"RTN","ORWORR1",66,0)
 S ORDFN=+$P($G(^OR(100,ORNUM,0)),U,2)
"RTN","ORWORR1",67,0)
 D START^ORBPRCHK(.LST,ORNUM,6,ORDFN)
"RTN","ORWORR1",68,0)
 ;add ordering provider
"RTN","ORWORR1",69,0)
 N ORDPROV
"RTN","ORWORR1",70,0)
 S ORDPROV=$$ORDERER^ORQOR2(ORNUM)
"RTN","ORWORR1",71,0)
 I $G(ORDPROV) S LST(ORDPROV)=""
"RTN","ORWORR1",72,0)
 D ADDSURR(.LST)
"RTN","ORWORR1",73,0)
 ;p456 add the current user if they have a notification associated with the current order
"RTN","ORWORR1",74,0)
 N ORNLST,ORI,ORRTN,ORMTCH S ORNLST=0,ORI=0,ORMTCH=0,ORRTN=""
"RTN","ORWORR1",75,0)
 D GETUSER1^XQALDATA("ORNLST",DUZ) I ORNLST D
"RTN","ORWORR1",76,0)
 .F  S ORI=$O(ORNLST(ORI)) Q:'ORI  D  Q:ORMTCH
"RTN","ORWORR1",77,0)
 ..D GETDATA^ORWORB(.ORRTN,$P(ORNLST(ORI),U,2))
"RTN","ORWORR1",78,0)
 ..I +ORRTN=ORNUM S LST(DUZ)="",ORMTCH=1
"RTN","ORWORR1",79,0)
 I $D(LST(USR)) S ORRET=0
"RTN","ORWORR1",80,0)
 Q ORRET
"RTN","ORWORR1",81,0)
ADDSURR(LST) ;TAKE LIST OF USERS AND ADD SURROGATES TO THE LIST
"RTN","ORWORR1",82,0)
 N I
"RTN","ORWORR1",83,0)
 S I=0 F  S I=$O(LST(I)) Q:'I  S LST($$CURRSURO^XQALSURO(I))=""
"RTN","ORWORR1",84,0)
 Q
"VER")
8.0^22.2
"^DD",100,100,.61,0)
UAP Reviewed?^S^0:NO;1:YES;C:cont;D:dc;G:chg;N:new;R:renew;^.61;1^Q
"^DD",100,100,.61,.1)
Unified Action Profile Review Status
"^DD",100,100,.61,1,0)
^.1
"^DD",100,100,.61,1,1,0)
100^E
"^DD",100,100,.61,1,1,1)
S ^OR(100,"E",$E(X,1,30),DA)=""
"^DD",100,100,.61,1,1,2)
K ^OR(100,"E",$E(X,1,30),DA)
"^DD",100,100,.61,1,1,3)
This is used to track if the order has been reviewed
"^DD",100,100,.61,1,1,"%D",0)
^^2^2^3161101^
"^DD",100,100,.61,1,1,"%D",1,0)
This cross reference is used to quickly lookup if a Unified Action Profile
"^DD",100,100,.61,1,1,"%D",2,0)
Review has been completed for the order.
"^DD",100,100,.61,1,1,"DT")
3161101
"^DD",100,100,.61,3)
Select the Unified Action Profile status for the order
"^DD",100,100,.61,21,0)
^^5^5^3161114^
"^DD",100,100,.61,21,1,0)
This field is added to record and track if an order has been reviewed 
"^DD",100,100,.61,21,2,0)
during the patient discharge process. If someone has reviewed an order in
"^DD",100,100,.61,21,3,0)
CPRS in the Unified Action Profile form the
"^DD",100,100,.61,21,4,0)
selection they made from the set of codes presented is recorded
"^DD",100,100,.61,21,5,0)
in this field for a selected order.
"^DD",100,100,.61,23,0)
^.001^4^4^3161114^^^
"^DD",100,100,.61,23,1,0)
A column is added to CPRS fOrders.hdrOrders.Sections[10] to track if
"^DD",100,100,.61,23,2,0)
someone has reviewed the order. The choices are displayed
"^DD",100,100,.61,23,3,0)
on the screen and the possible selections from this field are displayed
"^DD",100,100,.61,23,4,0)
using a popup menu option for the selected order.
"^DD",100,100,.61,"DT")
3161114
"^DD",100,100,.62,0)
UAP Last Reviewed^D^^.61;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",100,100,.62,.1)
Unified Action Profile Reviewed Date
"^DD",100,100,.62,3)
Enter the date the Unified Action Profile was last reviewed
"^DD",100,100,.62,21,0)
^.001^2^2^3161114^^^^
"^DD",100,100,.62,21,1,0)
This is the Date Someone last reviewed the order on the screen using the 
"^DD",100,100,.62,21,2,0)
Unified Action Profile Popup menu option for a selected order
"^DD",100,100,.62,"DT")
3161114
"^DD",100,100,.63,0)
UAP Last Reviewed By^P200'^VA(200,^.61;3^Q
"^DD",100,100,.63,.1)
Unified Action Profile was last reviewed by
"^DD",100,100,.63,3)
Enter the user who last reviewed the Unified Action Profile
"^DD",100,100,.63,21,0)
^.001^2^2^3161114^^^
"^DD",100,100,.63,21,1,0)
This is the DUZ of the person who last reviewed the order on the screen
"^DD",100,100,.63,21,2,0)
using the Unified Action Profile Popup menu option for a selected order.
"^DD",100,100,.63,"DT")
3161114
"BLD",10652,6)
^423
**END**
**END**

