Released OR*3*503 SEQ #422
Extracted from mail message
**KIDS**:OR*3.0*503^

**INSTALL NAME**
OR*3.0*503
"BLD",11366,0)
OR*3.0*503^ORDER ENTRY/RESULTS REPORTING^0^3190123^y
"BLD",11366,1,0)
^^7^7^3190123^
"BLD",11366,1,1,0)
This patch addresses two issues:
"BLD",11366,1,2,0)
 
"BLD",11366,1,3,0)
1. The C index in the OE/RR NOTIFICATIONS file (#100.9) contains entries
"BLD",11366,1,4,0)
   for the .01 NAME field.
"BLD",11366,1,5,0)
 
"BLD",11366,1,6,0)
2. A Lab VBECS component might have a modifier filed when there should be 
"BLD",11366,1,7,0)
   no modifier.
"BLD",11366,4,0)
^9.64PA^^
"BLD",11366,6.3)
6
"BLD",11366,"ABPKG")
n
"BLD",11366,"INID")
^y
"BLD",11366,"INIT")
EN^ORPS503
"BLD",11366,"KRN",0)
^9.67PA^1.61^23
"BLD",11366,"KRN",.4,0)
.4
"BLD",11366,"KRN",.401,0)
.401
"BLD",11366,"KRN",.402,0)
.402
"BLD",11366,"KRN",.403,0)
.403
"BLD",11366,"KRN",.5,0)
.5
"BLD",11366,"KRN",.84,0)
.84
"BLD",11366,"KRN",1.6,0)
1.6
"BLD",11366,"KRN",1.61,0)
1.61
"BLD",11366,"KRN",1.62,0)
1.62
"BLD",11366,"KRN",3.6,0)
3.6
"BLD",11366,"KRN",3.8,0)
3.8
"BLD",11366,"KRN",9.2,0)
9.2
"BLD",11366,"KRN",9.8,0)
9.8
"BLD",11366,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11366,"KRN",9.8,"NM",1,0)
ORCSEND2^^0^B33928599
"BLD",11366,"KRN",9.8,"NM","B","ORCSEND2",1)

"BLD",11366,"KRN",19,0)
19
"BLD",11366,"KRN",19.1,0)
19.1
"BLD",11366,"KRN",101,0)
101
"BLD",11366,"KRN",409.61,0)
409.61
"BLD",11366,"KRN",771,0)
771
"BLD",11366,"KRN",779.2,0)
779.2
"BLD",11366,"KRN",870,0)
870
"BLD",11366,"KRN",8989.51,0)
8989.51
"BLD",11366,"KRN",8989.52,0)
8989.52
"BLD",11366,"KRN",8994,0)
8994
"BLD",11366,"KRN","B",.4,.4)

"BLD",11366,"KRN","B",.401,.401)

"BLD",11366,"KRN","B",.402,.402)

"BLD",11366,"KRN","B",.403,.403)

"BLD",11366,"KRN","B",.5,.5)

"BLD",11366,"KRN","B",.84,.84)

"BLD",11366,"KRN","B",1.6,1.6)

"BLD",11366,"KRN","B",1.61,1.61)

"BLD",11366,"KRN","B",1.62,1.62)

"BLD",11366,"KRN","B",3.6,3.6)

"BLD",11366,"KRN","B",3.8,3.8)

"BLD",11366,"KRN","B",9.2,9.2)

"BLD",11366,"KRN","B",9.8,9.8)

"BLD",11366,"KRN","B",19,19)

"BLD",11366,"KRN","B",19.1,19.1)

"BLD",11366,"KRN","B",101,101)

"BLD",11366,"KRN","B",409.61,409.61)

"BLD",11366,"KRN","B",771,771)

"BLD",11366,"KRN","B",779.2,779.2)

"BLD",11366,"KRN","B",870,870)

"BLD",11366,"KRN","B",8989.51,8989.51)

"BLD",11366,"KRN","B",8989.52,8989.52)

"BLD",11366,"KRN","B",8994,8994)

"BLD",11366,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11366,"QUES",0)
^9.62^^
"BLD",11366,"REQB",0)
^9.611^2^2
"BLD",11366,"REQB",1,0)
OR*3.0*350^2
"BLD",11366,"REQB",2,0)
OR*3.0*332^2
"BLD",11366,"REQB","B","OR*3.0*332",2)

"BLD",11366,"REQB","B","OR*3.0*350",1)

"INIT")
EN^ORPS503
"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
503^3190123
"PKG",174,22,1,"PAH",1,1,0)
^^7^7^3190123
"PKG",174,22,1,"PAH",1,1,1,0)
This patch addresses two issues:
"PKG",174,22,1,"PAH",1,1,2,0)
 
"PKG",174,22,1,"PAH",1,1,3,0)
1. The C index in the OE/RR NOTIFICATIONS file (#100.9) contains entries
"PKG",174,22,1,"PAH",1,1,4,0)
   for the .01 NAME field.
"PKG",174,22,1,"PAH",1,1,5,0)
 
"PKG",174,22,1,"PAH",1,1,6,0)
2. A Lab VBECS component might have a modifier filed when there should be 
"PKG",174,22,1,"PAH",1,1,7,0)
   no modifier.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORCSEND2")
0^1^B33928599^B33762828
"RTN","ORCSEND2",1,0)
ORCSEND2 ;SLC/MKB - Release cont ;Jan 23, 2019@17:18
"RTN","ORCSEND2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212,332,503**;Dec 17, 1997;Build 6
"RTN","ORCSEND2",3,0)
 ;
"RTN","ORCSEND2",4,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORCSEND2",5,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_NAME,0))
"RTN","ORCSEND2",6,0)
 ;
"RTN","ORCSEND2",7,0)
EN ; -- Spawn child orders from ORIFN, send to VBECS [from VBEC^ORCSEND1]
"RTN","ORCSEND2",8,0)
 N ORPARENT,OR0,ORDIALOG,ORNP,ORDUZ,ORLOG,ORCAT,ORTS,ORDG,ORPKG,ORPRINT
"RTN","ORCSEND2",9,0)
 N ORESP,ORTIME,ORSTRT,ORI,ORIT,ORITX,ORFLDS,ORP,P,ORCHLD,ORLAST,X,STS,ORLAB,ORLRIFN
"RTN","ORCSEND2",10,0)
 N ORPITEM,ORPRBCM,ORPUNIT,ORPDTW,ORPREAS,ORPMSBS,ORPINFC,ORPURG,ORPTYPE,ORPCOLL,ORPCOMM,ORPRSLT,ORPSPEC,ORPLAB
"RTN","ORCSEND2",11,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0))
"RTN","ORCSEND2",12,0)
 S ORDIALOG=+$P(OR0,U,5),ORNP=+$P(OR0,U,4),ORDUZ=+$P(OR0,U,6)
"RTN","ORCSEND2",13,0)
 S ORLOG=$P(OR0,U,7),ORCAT=$P(OR0,U,12),ORTS=$P(OR0,U,13)
"RTN","ORCSEND2",14,0)
 S ORDG=+$P(OR0,U,11),ORPKG=$P(OR0,U,14),ORPRINT=0
"RTN","ORCSEND2",15,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(ORIFN,"ORESP"),GETIMES^ORCDLR1
"RTN","ORCSEND2",16,0)
 M ^TMP($J,"ORVBDLG")=ORDIALOG S ORPITEM=$$PTR("ORDERABLE ITEM")
"RTN","ORCSEND2",17,0)
 S ORPRBCM=$$PTR("RBC MODIFIERS"),ORPUNIT=$$PTR("AMOUNT")
"RTN","ORCSEND2",18,0)
 S ORPDTW=$$PTR("DATE/TIME"),ORPREAS=$$PTR("REASON")
"RTN","ORCSEND2",19,0)
 S ORPMSBS=$$PTR("TEXT"),ORPINFC=$$PTR("YES/NO")
"RTN","ORCSEND2",20,0)
 S ORPTYPE=$$PTR("COLLECTION TYPE"),ORPCOLL=$$PTR("START DATE/TIME")
"RTN","ORCSEND2",21,0)
 S ORPURG=$$PTR("URGENCY"),ORPCOMM=$$PTR("FREE TEXT 1")
"RTN","ORCSEND2",22,0)
 S ORPSPEC=$$PTR("SPECIMEN STATUS"),ORPRSLT=$$PTR("RESULTS")
"RTN","ORCSEND2",23,0)
 S ORPLAB=$$PTR("LAB ORDER") D START ;resolve ORSTRT dates
"RTN","ORCSEND2",24,0)
EN1 S ORI=0 F  S ORI=$O(ORESP(ORPITEM,ORI)) Q:ORI<1  D  Q:$G(ORERR)
"RTN","ORCSEND2",25,0)
 . N ORL S ORL=$P(OR0,U,10) ;protect ORL from calling routine
"RTN","ORCSEND2",26,0)
 . S ORIT=+$G(ORESP(ORPITEM,ORI)),ORITX=$G(^ORD(101.43,ORIT,"VB"))
"RTN","ORCSEND2",27,0)
 . D LABTST I $G(ORERR) D CANCEL(ORPARENT,$P(ORERR,U,2)) Q
"RTN","ORCSEND2",28,0)
 . K ORDIALOG M ORDIALOG=^TMP($J,"ORVBDLG") S ORDIALOG(ORPITEM,1)=ORIT
"RTN","ORCSEND2",29,0)
 . S ORFLDS=$S(ORITX:"ORPRBCM^ORPUNIT^ORPSPEC^ORPMSBS^ORPINFC",$P(ORITX,U,2)=1:"ORPTYPE^ORPCOLL",$P(ORITX,U,2)=2:"ORPMSBS^ORPINFC^ORPTYPE^ORPCOLL",1:"")_"^ORPDTW^ORPREAS^ORPURG^ORPCOMM"
"RTN","ORCSEND2",30,0)
 . F ORP=1:1:$L(ORFLDS,U) S P=$P(ORFLDS,U,ORP) Q:'$L(P)  S ORDIALOG(@P,1)=$S($D(ORESP(@P,ORI)):ORESP(@P,ORI),P="ORPRBCM":"",1:$G(ORESP(@P,1))) ;set values
"RTN","ORCSEND2",31,0)
 . S:$G(ORLRIFN) ORDIALOG(ORPLAB,1)=ORLRIFN
"RTN","ORCSEND2",32,0)
 . K ORIFN,ORIT D EN^ORCSAVE
"RTN","ORCSEND2",33,0)
 . I '$G(ORIFN) S ORERR="1^Unable to create order" Q
"RTN","ORCSEND2",34,0)
 . S X=ORSTRT($S(ORITX:"DTW",1:"COLL")) D DATES^ORCSAVE2(ORIFN,X)
"RTN","ORCSEND2",35,0)
 . D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),LINK
"RTN","ORCSEND2",36,0)
 . D NW^ORMBLDVB(ORIFN)
"RTN","ORCSEND2",37,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND2",38,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND2",39,0)
 ;D STATUS^ORCSAVE2(ORPARENT,5) ;testing
"RTN","ORCSEND2",40,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND2",41,0)
EN2 I STS'=11,STS'=13 D  ;successful
"RTN","ORCSEND2",42,0)
 . D RESULTS^ORMBLDVB(ORPARENT)
"RTN","ORCSEND2",43,0)
 . Q:'$O(ORPRINT(0))  N PAT,LOC,NATR
"RTN","ORCSEND2",44,0)
 . S PAT=$P(OR0,U,2),LOC=$S($G(ORL):ORL,1:$P(OR0,U,10))
"RTN","ORCSEND2",45,0)
 . S NATR=$$WORK^ORCSIGN($G(NATURE))
"RTN","ORCSEND2",46,0)
 . D PRINT^ORPR02(PAT,.ORPRINT,,LOC,"0^1^1^1^"_NATR) ;labels/req's
"RTN","ORCSEND2",47,0)
 I $$UNRL(ORPARENT) S ORERR="1^Unable to release order due to an HL7 network error: queued for delivery to VBECS"
"RTN","ORCSEND2",48,0)
 I STS=13 S ORERR="1^This order was rejected by VBECS and will NOT be acted upon: see the Order Details for more information and contact the Blood Bank for assistance!"
"RTN","ORCSEND2",49,0)
 K ^TMP($J,"ORVBDLG"),^TMP($J,"ORLRDLG")
"RTN","ORCSEND2",50,0)
 Q
"RTN","ORCSEND2",51,0)
 ;
"RTN","ORCSEND2",52,0)
UNRL(DAD) ; -- ck for any unreleased child orders
"RTN","ORCSEND2",53,0)
 N Y,I,STS S Y=0
"RTN","ORCSEND2",54,0)
 S I=0 F  S I=+$O(^OR(100,+$G(DAD),2,I)) Q:I<1  D  Q:Y
"RTN","ORCSEND2",55,0)
 . S STS=$P($G(^OR(100,I,3)),U,3)
"RTN","ORCSEND2",56,0)
 . I STS=10!(STS=11) S Y=1 Q
"RTN","ORCSEND2",57,0)
 Q Y
"RTN","ORCSEND2",58,0)
 ;
"RTN","ORCSEND2",59,0)
START ; -- Define ORSTRT(), set Start Date in ORPARENT
"RTN","ORCSEND2",60,0)
 N X,Y,%DT,STRT S ORSTRT("COLL")="",ORSTRT("DTW")="",%DT="TX",STRT=""
"RTN","ORCSEND2",61,0)
 S X=$G(ORESP(ORPDTW,1)) I $L(X) D ^%DT S:Y>0 ORSTRT("DTW")=Y,STRT=Y
"RTN","ORCSEND2",62,0)
 S X=$G(ORESP(ORPCOLL,1)) I $L(X) D
"RTN","ORCSEND2",63,0)
 . D AM^ORCSAVE2:X="AM",NEXT^ORCSAVE2:X="NEXT" ;return X
"RTN","ORCSEND2",64,0)
 . D ^%DT S:Y>0 ORSTRT("COLL")=Y,STRT=Y
"RTN","ORCSEND2",65,0)
 I '$P(OR0,U,8) D DATES^ORCSAVE2(+ORIFN,STRT)
"RTN","ORCSEND2",66,0)
 Q
"RTN","ORCSEND2",67,0)
 ;
"RTN","ORCSEND2",68,0)
LINK ; -- set up ORPARENT/ORIFN links, ORLAST in ORCHLD()
"RTN","ORCSEND2",69,0)
 ;    Uses ORVP,ORLOG in xref
"RTN","ORCSEND2",70,0)
 S ORCHLD=+$G(ORCHLD)+1,^OR(100,ORPARENT,2,ORIFN,0)=ORIFN,ORLAST=ORIFN
"RTN","ORCSEND2",71,0)
 S $P(^OR(100,ORIFN,3),U,8,9)="1^"_ORPARENT
"RTN","ORCSEND2",72,0)
 S $P(^OR(100,ORIFN,8,1,0),U,4)=8 K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;signature on parent only
"RTN","ORCSEND2",73,0)
 Q
"RTN","ORCSEND2",74,0)
 ;
"RTN","ORCSEND2",75,0)
LABTST ; -- Create Lab order for VBECS blood component or test
"RTN","ORCSEND2",76,0)
 ;    Expects var's from above, Returns ORLAB & ORLRIFN
"RTN","ORCSEND2",77,0)
 N ORDIALOG,ORDG,ORPKG,ORIFN,X,P,LRT K ORLAB,ORLRIFN
"RTN","ORCSEND2",78,0)
 I $G(^TMP($J,"ORLRDLG")) M ORDIALOG=^TMP($J,"ORLRDLG")
"RTN","ORCSEND2",79,0)
 E  D  ;build for now, later reuse
"RTN","ORCSEND2",80,0)
 . S ORDIALOG=+$O(^ORD(101.41,"AB","LR OTHER LAB TESTS",0))
"RTN","ORCSEND2",81,0)
 . D GETDLG1^ORCD(ORDIALOG) M ^TMP($J,"ORLRDLG")=ORDIALOG
"RTN","ORCSEND2",82,0)
 S ORDG=+$O(^ORD(100.98,"B","BB",0)),X=$P($G(^ORD(101.43,ORIT,0)),U,8)
"RTN","ORCSEND2",83,0)
 S X=+$$TEST(X) I X<1 S ORERR="1^Missing or invalid Lab workload test" Q
"RTN","ORCSEND2",84,0)
 S ORDIALOG(ORPITEM,1)=X,LRT=+$P($G(^ORD(101.43,X,0)),U,2)
"RTN","ORCSEND2",85,0)
 S ORDIALOG(ORPTYPE,1)=$S($D(ORESP(ORPTYPE,1)):ORESP(ORPTYPE,1),1:"SP")
"RTN","ORCSEND2",86,0)
 S ORDIALOG(ORPCOLL,1)=$S($D(ORESP(ORPCOLL,1)):ORESP(ORPCOLL,1),1:$G(ORESP(ORPDTW,1)))
"RTN","ORCSEND2",87,0)
LT1 ; VALIDATE??
"RTN","ORCSEND2",88,0)
 S X=+$O(^LAB(60,LRT,3,0)),X=+$G(^(X,0)) ;default/unique sample
"RTN","ORCSEND2",89,0)
 S ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=X
"RTN","ORCSEND2",90,0)
 S:'ORITX ORDIALOG($$PTR("SPECIMEN"),1)=$P($G(^LAB(62,X,0)),U,2)
"RTN","ORCSEND2",91,0)
 S X=+$G(ORESP(ORPURG,1)),X=$P($G(^ORD(101.42,X,0)),U)
"RTN","ORCSEND2",92,0)
 S X=$S($L(X):+$O(^LAB(62.05,"B",X,0)),1:9) S:'X X=9
"RTN","ORCSEND2",93,0)
 S ORDIALOG($$PTR("LAB URGENCY"),1)=X D
"RTN","ORCSEND2",94,0)
 . N ORIT D EN^ORCSAVE ;Isolate ORIT before creating child orders
"RTN","ORCSEND2",95,0)
 I '$G(ORIFN) S ORERR="1^Unable to create lab order" Q
"RTN","ORCSEND2",96,0)
 S X=$S($D(ORSTRT("COLL")):ORSTRT("COLL"),1:$G(ORSTRT("DTW")))
"RTN","ORCSEND2",97,0)
 D DATES^ORCSAVE2(ORIFN,X),LINK
"RTN","ORCSEND2",98,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND2",99,0)
 S ORLAB=$G(^OR(100,ORIFN,4))_";"_$G(LRT),ORLRIFN=ORIFN ;for VBECS msg
"RTN","ORCSEND2",100,0)
 I '$G(ORLAB) S ORERR="1^"_$$WHY^ORCSEND(ORIFN,1) Q
"RTN","ORCSEND2",101,0)
 S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1"
"RTN","ORCSEND2",102,0)
 ;D STATUS^ORCSAVE2(ORIFN,5) S ORLAB="ORLAB" ;for testing
"RTN","ORCSEND2",103,0)
 ;N ORZTEST S ORZTEST=1 D NEW^ORMBLD(ORIFN) ZW ORZTEST
"RTN","ORCSEND2",104,0)
 Q
"RTN","ORCSEND2",105,0)
 ;
"RTN","ORCSEND2",106,0)
TEST(X) ; -- find corresponding Lab test for VBECS item X, in #101.43
"RTN","ORCSEND2",107,0)
 N NM,I,Y S NM=X_" - LAB",Y=0
"RTN","ORCSEND2",108,0)
 S I=0 F  S I=+$O(^ORD(101.43,"B",$E(NM,1,30),I)) Q:I<1  I $P($G(^ORD(101.43,I,0)),U,8)=NM S Y=I Q
"RTN","ORCSEND2",109,0)
 Q Y
"RTN","ORCSEND2",110,0)
 ;
"RTN","ORCSEND2",111,0)
CANCEL(ORDAD,OREASON) ; -- Cancel parent order
"RTN","ORCSEND2",112,0)
 Q:'$G(ORDAD)  N NATR,NOW,ORCHLD
"RTN","ORCSEND2",113,0)
 S ORCHLD=0 F  S ORCHLD=+$O(^OR(100,ORDAD,2,ORCHLD)) Q:ORCHLD<1  D
"RTN","ORCSEND2",114,0)
 . Q:"^1^2^13^"[(U_$P($G(^OR(100,ORCHLD,3)),U,3)_U)  ;already done
"RTN","ORCSEND2",115,0)
 . D MSG^ORMBLD(ORCHLD,"CA",OREASON)
"RTN","ORCSEND2",116,0)
 S NATR=+$O(^ORD(100.02,"C","X",0)),NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND2",117,0)
 S ^OR(100,ORDAD,6)=NATR_U_U_NOW_U_U_$G(OREASON),$P(^(8,1,0),U,15)=13 S:$L($G(OREASON)) ^(1)=OREASON
"RTN","ORCSEND2",118,0)
 D STATUS^ORCSAVE2(ORDAD,13) ;cancel
"RTN","ORCSEND2",119,0)
 Q
"RTN","ORPS503")
0^^B944446^n/a
"RTN","ORPS503",1,0)
ORPS503 ;HPS/DJH - Save data before rebuilding index OR*3.0*503 ;Jan 11, 2019@14:33
"RTN","ORPS503",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**503**;Dec 17, 1997;Build 6
"RTN","ORPS503",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORPS503",4,0)
 Q  ; 
"RTN","ORPS503",5,0)
 ; This routine will save off the C index of file 100.9 and then rebuilding the C index
"RTN","ORPS503",6,0)
 ; OR*3.0*503 djh
"RTN","ORPS503",7,0)
 ;
"RTN","ORPS503",8,0)
EN ;
"RTN","ORPS503",9,0)
 N DIK,ORNOT,ORIEN
"RTN","ORPS503",10,0)
 ; save existing C index
"RTN","ORPS503",11,0)
 S ^XTMP("ORPS503",0)=$$FMADD^XLFDT(DT,730)_U_DT
"RTN","ORPS503",12,0)
 S ORNOT=""
"RTN","ORPS503",13,0)
 F  S ORNOT=$O(^ORD(100.9,"C",ORNOT)) Q:ORNOT=""  D
"RTN","ORPS503",14,0)
 . S ORIEN=0
"RTN","ORPS503",15,0)
 . F  S ORIEN=$O(^ORD(100.9,"C",ORNOT,ORIEN)) Q:'ORIEN  D
"RTN","ORPS503",16,0)
 . . S ^XTMP("ORPS503",ORNOT,ORIEN)=""
"RTN","ORPS503",17,0)
 ; kill C index before rebuilding
"RTN","ORPS503",18,0)
 K ^ORD(100.9,"C")
"RTN","ORPS503",19,0)
 S DIK="^ORD(100.9,",DIK(1)=".02^C"
"RTN","ORPS503",20,0)
 D ENALL^DIK  ;rebuild the C x-ref
"RTN","ORPS503",21,0)
 Q
"VER")
8.0^22.2
"BLD",11366,6)
^422
**END**
**END**

