Released OR*3*459 SEQ #389
Extracted from mail message
**KIDS**:OR*3.0*459^

**INSTALL NAME**
OR*3.0*459
"BLD",10601,0)
OR*3.0*459^ORDER ENTRY/RESULTS REPORTING^0^3171027^y
"BLD",10601,1,0)
^^3^3^3170925^^
"BLD",10601,1,1,0)
Patch OR*3.0*459 addresses the following issue:
"BLD",10601,1,2,0)
 
"BLD",10601,1,3,0)
1. Anti-Coagulation Show Rate not displaying correct information
"BLD",10601,4,0)
^9.64PA^^
"BLD",10601,6.3)
7
"BLD",10601,"ABPKG")
n
"BLD",10601,"KRN",0)
^9.67PA^779.2^20
"BLD",10601,"KRN",.4,0)
.4
"BLD",10601,"KRN",.401,0)
.401
"BLD",10601,"KRN",.402,0)
.402
"BLD",10601,"KRN",.403,0)
.403
"BLD",10601,"KRN",.5,0)
.5
"BLD",10601,"KRN",.84,0)
.84
"BLD",10601,"KRN",3.6,0)
3.6
"BLD",10601,"KRN",3.8,0)
3.8
"BLD",10601,"KRN",9.2,0)
9.2
"BLD",10601,"KRN",9.8,0)
9.8
"BLD",10601,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10601,"KRN",9.8,"NM",1,0)
ORAM2^^0^B63964344
"BLD",10601,"KRN",9.8,"NM","B","ORAM2",1)

"BLD",10601,"KRN",19,0)
19
"BLD",10601,"KRN",19.1,0)
19.1
"BLD",10601,"KRN",101,0)
101
"BLD",10601,"KRN",409.61,0)
409.61
"BLD",10601,"KRN",771,0)
771
"BLD",10601,"KRN",779.2,0)
779.2
"BLD",10601,"KRN",870,0)
870
"BLD",10601,"KRN",8989.51,0)
8989.51
"BLD",10601,"KRN",8989.52,0)
8989.52
"BLD",10601,"KRN",8994,0)
8994
"BLD",10601,"KRN","B",.4,.4)

"BLD",10601,"KRN","B",.401,.401)

"BLD",10601,"KRN","B",.402,.402)

"BLD",10601,"KRN","B",.403,.403)

"BLD",10601,"KRN","B",.5,.5)

"BLD",10601,"KRN","B",.84,.84)

"BLD",10601,"KRN","B",3.6,3.6)

"BLD",10601,"KRN","B",3.8,3.8)

"BLD",10601,"KRN","B",9.2,9.2)

"BLD",10601,"KRN","B",9.8,9.8)

"BLD",10601,"KRN","B",19,19)

"BLD",10601,"KRN","B",19.1,19.1)

"BLD",10601,"KRN","B",101,101)

"BLD",10601,"KRN","B",409.61,409.61)

"BLD",10601,"KRN","B",771,771)

"BLD",10601,"KRN","B",779.2,779.2)

"BLD",10601,"KRN","B",870,870)

"BLD",10601,"KRN","B",8989.51,8989.51)

"BLD",10601,"KRN","B",8989.52,8989.52)

"BLD",10601,"KRN","B",8994,8994)

"BLD",10601,"QUES",0)
^9.62^^
"BLD",10601,"REQB",0)
^9.611^1^1
"BLD",10601,"REQB",1,0)
OR*3.0*391^2
"BLD",10601,"REQB","B","OR*3.0*391",1)

"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
459^3171027
"PKG",174,22,1,"PAH",1,1,0)
^^3^3^3171027
"PKG",174,22,1,"PAH",1,1,1,0)
Patch OR*3.0*459 addresses the following issue:
"PKG",174,22,1,"PAH",1,1,2,0)
 
"PKG",174,22,1,"PAH",1,1,3,0)
1. Anti-Coagulation Show Rate not displaying correct information
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORAM2")
0^1^B63964344^B58023259
"RTN","ORAM2",1,0)
ORAM2 ;POR/RSF - ANTICOAGULATION MANAGEMENT RPCS (3 of 4) ; 10/27/17 4:12pm
"RTN","ORAM2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**307,339,354,361,391,459**;Dec 17, 1997;Build 7
"RTN","ORAM2",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified
"RTN","ORAM2",4,0)
 Q
"RTN","ORAM2",5,0)
 ;
"RTN","ORAM2",6,0)
 ;  External References:
"RTN","ORAM2",7,0)
 ;  $$GET1^DIQ                             ICR #2056
"RTN","ORAM2",8,0)
 ;  $$SETSTR^VALM1                         ICR #10116
"RTN","ORAM2",9,0)
 ;  $$FMADD/$$FMDIFF/$$FMTE/$$NOW^XLFDT    ICR #10103
"RTN","ORAM2",10,0)
 ;  $$TITLE/$$UP^XLFSTR                    ICR #10104
"RTN","ORAM2",11,0)
 ;  $$GET^XPAR                             ICR #2263
"RTN","ORAM2",12,0)
 ;  ^AUTNPOV(                              ICR #1593
"RTN","ORAM2",13,0)
 ;
"RTN","ORAM2",14,0)
ALLGOAL(RESULT,DAYS,CLINIC) ; last inr for all pts seen in last x days
"RTN","ORAM2",15,0)
 ;;RPC = ORAM2 ALLGOAL
"RTN","ORAM2",16,0)
 N ORAMDFN,ORAMNOW,ORAMCUT,ORAMCNT,ORAMPC,ORAMGOOD,ORAMBAD,ORAMBL
"RTN","ORAM2",17,0)
 S ORAMDFN=0,ORAMCNT=0,ORAMGOOD=0,ORAMBAD=0
"RTN","ORAM2",18,0)
 S ORAMNOW=$$NOW^XLFDT
"RTN","ORAM2",19,0)
 S ORAMCUT=$$FMADD^XLFDT(ORAMNOW,-DAYS)
"RTN","ORAM2",20,0)
 F  S ORAMDFN=$O(^ORAM(103,ORAMDFN)) Q:'ORAMDFN  D
"RTN","ORAM2",21,0)
 . N ORAMFS,ORAM3D0,ORAMDATE,ORAMCLIN
"RTN","ORAM2",22,0)
 . S ORAMFS=$O(^ORAM(103,ORAMDFN,3," "),-1) Q:$G(ORAMFS)=""
"RTN","ORAM2",23,0)
 . S ORAMCLIN=$P($G(^ORAM(103,ORAMDFN,6)),U,2)
"RTN","ORAM2",24,0)
 . I +$G(CLINIC),(ORAMCLIN'=CLINIC) Q
"RTN","ORAM2",25,0)
 . S ORAM3D0=$G(^ORAM(103,ORAMDFN,3,ORAMFS,0)),ORAMDATE=$P(ORAM3D0,"^")
"RTN","ORAM2",26,0)
 . I ($G(ORAMDATE)>$G(ORAMCUT)) D
"RTN","ORAM2",27,0)
 .. N ORAMINR,ORAMGOAL,ORAMGLO,ORAMGHI
"RTN","ORAM2",28,0)
 .. S ORAMINR=$P(ORAM3D0,"^",3),ORAMGOAL=$P(ORAM3D0,"^",12),ORAMGLO=$P(ORAMGOAL,"-"),ORAMGHI=$P(ORAMGOAL,"-",2) S:ORAMGHI[" " ORAMGHI=$P(ORAMGHI," ",2)
"RTN","ORAM2",29,0)
 .. S ORAMGLO=ORAMGLO-(.1*ORAMGLO),ORAMGHI=ORAMGHI+(.1*ORAMGHI)
"RTN","ORAM2",30,0)
 .. S ORAMCNT=ORAMCNT+1
"RTN","ORAM2",31,0)
 .. I (ORAMINR'<ORAMGLO)&(ORAMINR'>ORAMGHI) S ORAMGOOD=ORAMGOOD+1
"RTN","ORAM2",32,0)
 .. E  D
"RTN","ORAM2",33,0)
 ... N ORAMNAME,ORAMSSN,LINE
"RTN","ORAM2",34,0)
 ... S ORAMBAD=ORAMBAD+1,LINE=""
"RTN","ORAM2",35,0)
 ... S ORAMNAME=$P($P(^DPT(ORAMDFN,0),"^"),","),ORAMSSN=$E($P(^DPT(ORAMDFN,0),"^",9),6,9)
"RTN","ORAM2",36,0)
 ... S LINE=$$SETSTR^VALM1(ORAMNAME,LINE,1,15)
"RTN","ORAM2",37,0)
 ... S LINE=$$SETSTR^VALM1("("_ORAMSSN_")",LINE,17,6)
"RTN","ORAM2",38,0)
 ... S LINE=$$SETSTR^VALM1($S(+ORAMINR>0:ORAMINR,1:"N/A"),LINE,25,5)
"RTN","ORAM2",39,0)
 ... S LINE=$$SETSTR^VALM1("("_ORAMGOAL_")",LINE,32,9)
"RTN","ORAM2",40,0)
 ... S RESULT(ORAMBAD)=LINE
"RTN","ORAM2",41,0)
 I ORAMCNT>0 S ORAMPC=$J(((ORAMGOOD/ORAMCNT)*100),3,1)
"RTN","ORAM2",42,0)
 I ORAMBAD'="" S ORAMBL=$L(ORAMBAD,"^"),$P(ORAMBAD,"^",1)=ORAMBL
"RTN","ORAM2",43,0)
 S RESULT(0)=$G(ORAMPC)
"RTN","ORAM2",44,0)
 Q
"RTN","ORAM2",45,0)
 ;
"RTN","ORAM2",46,0)
PTAPPT(RESULT,CLINIC) ; Counts # of pts/day next 45 days
"RTN","ORAM2",47,0)
 ;RPC=ORAM2 PTAPPT
"RTN","ORAM2",48,0)
 N ORAMFDT,ORAMRDT,ORAMCNT
"RTN","ORAM2",49,0)
 S ORAMFDT=$$FMADD^XLFDT(DT,45)_".2359",ORAMRDT=DT
"RTN","ORAM2",50,0)
 F  S ORAMRDT=$O(^ORAM(103,"L",ORAMRDT)) Q:(+ORAMRDT'>0)!(ORAMRDT>ORAMFDT)  D
"RTN","ORAM2",51,0)
 . N ORAMDT,ORAMRD,ORAMDFN
"RTN","ORAM2",52,0)
 . S ORAMDT=$P(ORAMRDT,"."),ORAMRD=$$FMTE^XLFDT(ORAMDT,"2DF"),ORAMDFN=0
"RTN","ORAM2",53,0)
 . F  S ORAMDFN=$O(^ORAM(103,"L",ORAMRDT,ORAMDFN)) Q:'ORAMDFN  D
"RTN","ORAM2",54,0)
 .. N ORAMCLIN S ORAMCLIN=$P($G(^ORAM(103,ORAMDFN,6)),U,2)
"RTN","ORAM2",55,0)
 .. Q:ORAMCLIN'=$G(CLINIC)
"RTN","ORAM2",56,0)
 .. S ORAMCNT(ORAMDT)=+$G(ORAMCNT(ORAMDT))+1
"RTN","ORAM2",57,0)
 .. S RESULT(ORAMDT)=ORAMRD_" - "_$G(ORAMCNT(ORAMDT))
"RTN","ORAM2",58,0)
PTAPPTQ Q
"RTN","ORAM2",59,0)
 ;
"RTN","ORAM2",60,0)
NOACT(RESULT,DAYS,CLINIC) ; Finds pts w/o AC activity past X days
"RTN","ORAM2",61,0)
 ;RPC=ORAM2 NOACT
"RTN","ORAM2",62,0)
 N ORAMDT,ORAMFDT,ORAMVST,ORAMDFN,ORAMPT,ORAMSSN,ORAMSORT,ORAMC,ORAMI,ORAMMIS,ORAMLAST,ORAMFS,ORMISVST,ORAMCLIN,ORAMDONE,ORAMFSTA
"RTN","ORAM2",63,0)
 S ORAMDT=$$NOW^XLFDT,ORAMFDT=$$FMADD^XLFDT(ORAMDT,-DAYS),ORAMDFN=0
"RTN","ORAM2",64,0)
 F  S ORAMDFN=$O(^ORAM(103,ORAMDFN)) Q:+ORAMDFN'>0  D
"RTN","ORAM2",65,0)
 . S ORAMFS=" ",ORAMLAST=0,ORAMMIS=0,ORAMCLIN=$P($G(^ORAM(103,ORAMDFN,6)),U,2),ORAMDONE=0
"RTN","ORAM2",66,0)
 . Q:(ORAMCLIN'=$G(CLINIC))!(2=$$GET1^DIQ(103,ORAMDFN,15,"I"))
"RTN","ORAM2",67,0)
 . F  S ORAMFS=$O(^ORAM(103,ORAMDFN,3,ORAMFS),-1) Q:(ORAMFS']"")!ORAMDONE  D
"RTN","ORAM2",68,0)
 .. I '$G(ORAMMIS)&$$MISSED(ORAMDFN,ORAMFS) S ORAMMIS=ORAMFS Q
"RTN","ORAM2",69,0)
 .. I '$G(ORAMLAST)&'$$MISSED(ORAMDFN,ORAMFS) S ORAMLAST=ORAMFS,ORAMDONE=1
"RTN","ORAM2",70,0)
 . Q:($$GET1^DIQ(103.011,ORAMLAST_","_ORAMDFN,.01,"I")'<ORAMFDT)
"RTN","ORAM2",71,0)
 . F ORAMFS="ORAMMIS","ORAMLAST" D
"RTN","ORAM2",72,0)
 .. K ORMISVST,ORAMFSTA
"RTN","ORAM2",73,0)
 .. I (ORAMFS="ORAMMIS") S ORMISVST=$$GET1^DIQ(103.011,@ORAMFS_","_ORAMDFN,80,"I"),ORAMFSTA=1
"RTN","ORAM2",74,0)
 .. Q:(ORAMFS="ORAMMIS")&($G(ORMISVST)'>ORAMFDT)
"RTN","ORAM2",75,0)
 .. S ORAMFS=@ORAMFS
"RTN","ORAM2",76,0)
 .. Q:'ORAMFS
"RTN","ORAM2",77,0)
 .. N LINE S LINE=""
"RTN","ORAM2",78,0)
 .. S ORAMPT=$P(^DPT(ORAMDFN,0),"^"),ORAMPT=$P(ORAMPT,","),ORAMSSN=$E($P(^DPT(ORAMDFN,0),"^",9),6,9)
"RTN","ORAM2",79,0)
 .. S ORAMVST=$P(^ORAM(103,ORAMDFN,3,ORAMFS,0),"^")
"RTN","ORAM2",80,0)
 .. I $G(ORMISVST) S ORAMVST=ORMISVST
"RTN","ORAM2",81,0)
 .. S LINE=$$SETSTR^VALM1(ORAMPT,LINE,1,15)
"RTN","ORAM2",82,0)
 .. S LINE=$$SETSTR^VALM1("("_ORAMSSN_")",LINE,17,6)
"RTN","ORAM2",83,0)
 .. S LINE=$$SETSTR^VALM1($S($G(ORAMFSTA):"Missed Ap: ",1:"Last Seen: ")_$$FMTE^XLFDT($P(ORAMVST,"."),"2DF"),LINE,25,19)
"RTN","ORAM2",84,0)
 .. S ORAMSORT($P(ORAMVST,"."),ORAMPT_ORAMSSN)=LINE
"RTN","ORAM2",85,0)
 S (ORAMC,ORAMI)=0
"RTN","ORAM2",86,0)
 F  S ORAMI=$O(ORAMSORT(ORAMI)) Q:+ORAMI'>0  D
"RTN","ORAM2",87,0)
 . N ORAMJ S ORAMJ=""
"RTN","ORAM2",88,0)
 . F  S ORAMJ=$O(ORAMSORT(ORAMI,ORAMJ)) Q:ORAMJ']""  D
"RTN","ORAM2",89,0)
 .. S ORAMC=ORAMC+1,RESULT(ORAMC)=$G(ORAMSORT(ORAMI,ORAMJ))
"RTN","ORAM2",90,0)
 I ORAMC=0 S RESULT(0)="No patients lost to follow-up "_DAYS_" days or longer."
"RTN","ORAM2",91,0)
NOACTQ Q
"RTN","ORAM2",92,0)
 ;
"RTN","ORAM2",93,0)
MISSED(DFN,FS) ;*354 Added
"RTN","ORAM2",94,0)
 ;Input DFN -> Patient IEN
"RTN","ORAM2",95,0)
 ;      FS  -> FlowSheet IEN
"RTN","ORAM2",96,0)
 ;Output 1 if this flowsheet entry was a missed appt.
"RTN","ORAM2",97,0)
 ;       0 if this flowsheet entry was not a missed appt.
"RTN","ORAM2",98,0)
 ;
"RTN","ORAM2",99,0)
 N ORAMCM,IENS,I,RSLT
"RTN","ORAM2",100,0)
 Q:'$G(DFN)!'$G(FS) 0
"RTN","ORAM2",101,0)
 S IENS=FS_","_DFN_",",(I,RSLT)=0
"RTN","ORAM2",102,0)
 I $$GET1^DIQ(103.011,IENS,99,"","ORAMCM")="" Q RSLT
"RTN","ORAM2",103,0)
 F  S I=$O(ORAMCM(I)) Q:'I!RSLT  I ORAMCM(I)["Missed Appt; return:" S RSLT=1
"RTN","ORAM2",104,0)
 Q RSLT
"RTN","ORAM2",105,0)
 ;
"RTN","ORAM2",106,0)
SHOWRATE(RESULT,DFN) ; CALCULATES SHOWRATE
"RTN","ORAM2",107,0)
 ;;RPC=ORAM2 NOSHOW
"RTN","ORAM2",108,0)
 N ORAMFSDT,ORAMFS,ORAMR,ORAMARR,ORAMPC,ORAMPTT0,ORAMRDT,ORAMRDT0
"RTN","ORAM2",109,0)
 S ORAMR=0,ORAMPTT0=0,ORAMRDT0=""
"RTN","ORAM2",110,0)
 S ORAMFSDT=0 F  S ORAMFSDT=$O(^ORAM(103,DFN,3,"B",ORAMFSDT)) Q:'ORAMFSDT  D
"RTN","ORAM2",111,0)
 . S ORAMFS=0 F  S ORAMFS=$O(^ORAM(103,DFN,3,"B",ORAMFSDT,ORAMFS)) Q:'ORAMFS  D
"RTN","ORAM2",112,0)
 .. N ORAMD0,ORAMSD,ORAMSCR,ORAMPTT,ORAMLCNT,ORAMLLN,ORAMDIFF,FLAG
"RTN","ORAM2",113,0)
 .. S ORAMD0=$G(^ORAM(103,DFN,3,ORAMFS,0)),ORAMSCR=$P(ORAMD0,"^",13),ORAMSD=$P($P(ORAMD0,"^"),"."),ORAMPTT=$P(ORAMD0,"^",3)
"RTN","ORAM2",114,0)
 .. S ORAMLCNT=$P($G(^ORAM(103,DFN,3,ORAMFS,1,0)),"^",3) Q:'ORAMLCNT
"RTN","ORAM2",115,0)
 .. S ORAMLLN=$G(^ORAM(103,DFN,3,ORAMFS,1,ORAMLCNT,0))
"RTN","ORAM2",116,0)
 .. S ORAMDT=""
"RTN","ORAM2",117,0)
 .. S FLAG=$S($G(ORAMLLN)["Next draw:":"N",$G(ORAMLLN)["Callback:":"C",$G(ORAMLLN)["Missed Appt;":"M",1:"Q")
"RTN","ORAM2",118,0)
 .. I FLAG="Q",ORAMLCNT>1 D  ;last comment was maybe split in two lines
"RTN","ORAM2",119,0)
 ... S ORAMLLN=$G(^ORAM(103,DFN,3,ORAMFS,1,ORAMLCNT-1,0))_ORAMLLN ;concatenate last two lines. Various types of splits in data.
"RTN","ORAM2",120,0)
 ... S FLAG=$S($G(ORAMLLN)["Next draw:":"N",$G(ORAMLLN)["Callback:":"C",$G(ORAMLLN)["Missed Appt;":"M",1:"Q")
"RTN","ORAM2",121,0)
 .. Q:FLAG="Q"  ;either malformed or deleted entry
"RTN","ORAM2",122,0)
 .. I FLAG="N" S ORAMRDT=$P($G(ORAMLLN)," ",3)
"RTN","ORAM2",123,0)
 .. ;I ORAMRDT="E" S ORAMLCNT=ORAMLCNT-1,ORAMLLN=$G(^ORAM(103,DFN,3,ORAMFS,1,ORAMLCNT,0)) this case is handled by concatenation above
"RTN","ORAM2",124,0)
 .. ;I  S ORAMRDT=$S($G(ORAMLLN)["Next draw:":$P($G(ORAMLLN)," ",3),$G(ORAMLLN)["Callback:":$P($G(ORAMLLN)," ",2),$G(ORAMLLN)["Missed Appt;":"Q",1:$P($G(ORAMLLN)," "))
"RTN","ORAM2",125,0)
 .. I FLAG="M" S ORAMRDT=$P($G(ORAMLLN)," ",4),ORAMR=ORAMR+1 D DT^DILF("T",ORAMRDT,.ORAMRDT) S ORAMRDT0=ORAMRDT Q  ;NOTE PT MISSED DRAW, ADD ONE TO DENOMINATOR
"RTN","ORAM2",126,0)
 .. I $L(ORAMRDT)>1 D DT^DILF("T",ORAMRDT,.ORAMRDT)
"RTN","ORAM2",127,0)
 .. I FLAG="C" S ORAMRDT=$P($G(ORAMLLN)," ",2) D DT^DILF("T",ORAMRDT,.ORAMRDT) S ORAMRDT=$$FMADD^XLFDT(ORAMRDT,-1)
"RTN","ORAM2",128,0)
 .. I 'ORAMPTT!($G(ORAMPTT0)=$G(ORAMPTT)) S ORAMRDT0=ORAMRDT Q
"RTN","ORAM2",129,0)
 .. S ORAMPTT0=ORAMPTT
"RTN","ORAM2",130,0)
 .. I ORAMRDT0'="" S ORAMDIFF=$$FMDIFF^XLFDT(ORAMSD,ORAMRDT0,2) S ORAMR=ORAMR+1 I ORAMDIFF>-172801&(ORAMDIFF<172801) S ORAMARR(0)=$G(ORAMARR(0))+1
"RTN","ORAM2",131,0)
 .. S ORAMRDT0=ORAMRDT
"RTN","ORAM2",132,0)
 I ORAMR>0 S ORAMPC=($G(ORAMARR(0))/ORAMR)*100,ORAMPC=$E(ORAMPC,1,4)
"RTN","ORAM2",133,0)
 S RESULT=$G(ORAMPC)_"^"_$G(ORAMR)
"RTN","ORAM2",134,0)
 Q
"RTN","ORAM2",135,0)
 ;
"RTN","ORAM2",136,0)
RPTSTART(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,MAX,ORFHIE) ;
"RTN","ORAM2",137,0)
 ;;
"RTN","ORAM2",138,0)
 D START^ORWRP(80,"RPT^ORAM2(.ROOT,.DFN,.ID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.MAX,.ORFHIE)",999)
"RTN","ORAM2",139,0)
 Q
"RTN","ORAM2",140,0)
 ;
"RTN","ORAM2",141,0)
RPT(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,MAX,ORFHIE) ; Generate report for CPRS
"RTN","ORAM2",142,0)
 D RPT^ORAMX1(.ROOT,$G(DFN),$G(ID),$G(ALPHA),$G(OMEGA),$G(DTRANGE),$G(REMOTE),$G(MAX),$G(ORFHIE))
"RTN","ORAM2",143,0)
 Q
"RTN","ORAM2",144,0)
 ;
"RTN","ORAM2",145,0)
DTCHK(DFN,ALPHA,OMEGA,ORAMFSD) ; CHECKS DATE RANGE WITH ALPHA AND OMEGA FROM CPRS
"RTN","ORAM2",146,0)
 N ORAMFDT,ORAMVAL
"RTN","ORAM2",147,0)
 S ORAMVAL=0
"RTN","ORAM2",148,0)
 S ORAMFDT=$P(^ORAM(103,DFN,3,ORAMFSD,0),"^")
"RTN","ORAM2",149,0)
 S:ORAMFDT'<ALPHA ORAMVAL=1
"RTN","ORAM2",150,0)
 S:ORAMFDT>OMEGA ORAMVAL=0
"RTN","ORAM2",151,0)
 Q ORAMVAL
"RTN","ORAM2",152,0)
 ;
"RTN","ORAM2",153,0)
TEAMCHK(RESULT,ORAMTMS) ; SET-UP VERIFY NAMES
"RTN","ORAM2",154,0)
 ;RPC=ORAM2 TEAM CHECK
"RTN","ORAM2",155,0)
 N ORAMSKIP,ORAMI,ORAMERR
"RTN","ORAM2",156,0)
 Q:$G(ORAMTMS)=""
"RTN","ORAM2",157,0)
 F ORAMI=1:1:20 S ORAMSKIP=$G(ORAMSKIP)_" "
"RTN","ORAM2",158,0)
 S ORAMERR=0
"RTN","ORAM2",159,0)
 F ORAMI=1:1:$L(ORAMTMS,"^") D
"RTN","ORAM2",160,0)
 . N ORAMN
"RTN","ORAM2",161,0)
 . I $P(ORAMTMS,"^",ORAMI)'="" S ORAMN=$P(ORAMTMS,"^",ORAMI) D
"RTN","ORAM2",162,0)
 .. S RESULT(ORAMI)=ORAMN_$E(ORAMSKIP,1,(20-$L(ORAMN)))
"RTN","ORAM2",163,0)
 .. I $D(^OR(100.21,ORAMN)) S RESULT(ORAMI)=RESULT(ORAMI)_$P(^OR(100.21,ORAMN,0),"^")
"RTN","ORAM2",164,0)
 .. E  S RESULT(ORAMI)=RESULT(ORAMI)_"clinic not found.",ORAMERR=$G(ORAMERR)+1
"RTN","ORAM2",165,0)
 S RESULT(0)=$G(ORAMERR)
"RTN","ORAM2",166,0)
 Q
"RTN","ORAM2",167,0)
 ;
"RTN","ORAM2",168,0)
REMIND(RESULT,ORAMDFN,ORAMDT,ORAMREM) ; RPC=ORAM2 REMINDER
"RTN","ORAM2",169,0)
 N ORAMRML,ORAMDAY,ORAMR,D0,DA,DIK,X
"RTN","ORAM2",170,0)
 Q:'+$G(ORAMDFN)  Q:$G(ORAMDT)=""  Q:$G(ORAMREM)=""
"RTN","ORAM2",171,0)
 S RESULT=0
"RTN","ORAM2",172,0)
 D NOW^%DTC S ORAMDAY=X D DT^DILF(,ORAMDT,.X) S ORAMDT=X
"RTN","ORAM2",173,0)
 S $P(^ORAM(103,ORAMDFN,0),"^",18)=$G(ORAMDT)
"RTN","ORAM2",174,0)
 K ^ORAM(103,ORAMDFN,5)
"RTN","ORAM2",175,0)
 S ORAMRML=$L(ORAMREM,"^"),^ORAM(103,ORAMDFN,5,0)="^^"_ORAMRML_"^"_ORAMRML_"^"_ORAMDAY_"^"
"RTN","ORAM2",176,0)
 F ORAMR=1:1:ORAMRML D
"RTN","ORAM2",177,0)
 . S ^ORAM(103,ORAMDFN,5,ORAMR,0)=$P(ORAMREM,"^",ORAMR)
"RTN","ORAM2",178,0)
 S DIK="^ORAM(103,",DA=ORAMDFN
"RTN","ORAM2",179,0)
 D IX^DIK
"RTN","ORAM2",180,0)
 S RESULT=1
"RTN","ORAM2",181,0)
 Q
"VER")
8.0^22.2
"BLD",10601,6)
^389
**END**
**END**

