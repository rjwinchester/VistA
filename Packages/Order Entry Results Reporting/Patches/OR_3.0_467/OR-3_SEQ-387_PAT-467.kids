Released OR*3*467 SEQ #387
Extracted from mail message
**KIDS**:OR*3.0*467^

**INSTALL NAME**
OR*3.0*467
"BLD",10407,0)
OR*3.0*467^ORDER ENTRY/RESULTS REPORTING^0^3171114^y
"BLD",10407,4,0)
^9.64PA^^
"BLD",10407,6)
1^
"BLD",10407,6.3)
4
"BLD",10407,"ABPKG")
n
"BLD",10407,"KRN",0)
^9.67PA^779.2^20
"BLD",10407,"KRN",.4,0)
.4
"BLD",10407,"KRN",.401,0)
.401
"BLD",10407,"KRN",.402,0)
.402
"BLD",10407,"KRN",.403,0)
.403
"BLD",10407,"KRN",.5,0)
.5
"BLD",10407,"KRN",.84,0)
.84
"BLD",10407,"KRN",3.6,0)
3.6
"BLD",10407,"KRN",3.8,0)
3.8
"BLD",10407,"KRN",9.2,0)
9.2
"BLD",10407,"KRN",9.8,0)
9.8
"BLD",10407,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10407,"KRN",9.8,"NM",1,0)
ORCDPSIV^^0^B126767788
"BLD",10407,"KRN",9.8,"NM",2,0)
ORCDLG1^^0^B85414399
"BLD",10407,"KRN",9.8,"NM",3,0)
ORCDLG2^^0^B70372078
"BLD",10407,"KRN",9.8,"NM","B","ORCDLG1",2)

"BLD",10407,"KRN",9.8,"NM","B","ORCDLG2",3)

"BLD",10407,"KRN",9.8,"NM","B","ORCDPSIV",1)

"BLD",10407,"KRN",19,0)
19
"BLD",10407,"KRN",19.1,0)
19.1
"BLD",10407,"KRN",101,0)
101
"BLD",10407,"KRN",409.61,0)
409.61
"BLD",10407,"KRN",771,0)
771
"BLD",10407,"KRN",779.2,0)
779.2
"BLD",10407,"KRN",870,0)
870
"BLD",10407,"KRN",8989.51,0)
8989.51
"BLD",10407,"KRN",8989.52,0)
8989.52
"BLD",10407,"KRN",8994,0)
8994
"BLD",10407,"KRN","B",.4,.4)

"BLD",10407,"KRN","B",.401,.401)

"BLD",10407,"KRN","B",.402,.402)

"BLD",10407,"KRN","B",.403,.403)

"BLD",10407,"KRN","B",.5,.5)

"BLD",10407,"KRN","B",.84,.84)

"BLD",10407,"KRN","B",3.6,3.6)

"BLD",10407,"KRN","B",3.8,3.8)

"BLD",10407,"KRN","B",9.2,9.2)

"BLD",10407,"KRN","B",9.8,9.8)

"BLD",10407,"KRN","B",19,19)

"BLD",10407,"KRN","B",19.1,19.1)

"BLD",10407,"KRN","B",101,101)

"BLD",10407,"KRN","B",409.61,409.61)

"BLD",10407,"KRN","B",771,771)

"BLD",10407,"KRN","B",779.2,779.2)

"BLD",10407,"KRN","B",870,870)

"BLD",10407,"KRN","B",8989.51,8989.51)

"BLD",10407,"KRN","B",8989.52,8989.52)

"BLD",10407,"KRN","B",8994,8994)

"BLD",10407,"QUES",0)
^9.62^^
"BLD",10407,"REQB",0)
^9.611^3^3
"BLD",10407,"REQB",1,0)
OR*3.0*388^2
"BLD",10407,"REQB",2,0)
OR*3.0*297^2
"BLD",10407,"REQB",3,0)
OR*3.0*350^2
"BLD",10407,"REQB","B","OR*3.0*297",2)

"BLD",10407,"REQB","B","OR*3.0*350",3)

"BLD",10407,"REQB","B","OR*3.0*388",1)

"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
467^3171114^520824667
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORCDLG1")
0^2^B85414399^B84017168
"RTN","ORCDLG1",1,0)
ORCDLG1 ;SLC/MKB - ORDER DIALOGS CONT ;11/14/17  09:49
"RTN","ORCDLG1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**60,71,95,110,243,350,467**;Dec 17, 1997;Build 4
"RTN","ORCDLG1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","ORCDLG1",4,0)
 ;
"RTN","ORCDLG1",5,0)
EN(ITM,INST) ; -- ask each ITM prompt where
"RTN","ORCDLG1",6,0)
 ;    ORDIALOG(PROMPT,#) = internal form of each response
"RTN","ORCDLG1",7,0)
 ;
"RTN","ORCDLG1",8,0)
 N ITEM,COND,MULT,REQD,EDITONLY,DATATYPE,DOMAIN,DIR,Y,ACTION,PROMPT,ORX,VALIDEF
"RTN","ORCDLG1",9,0)
 S ITEM=$G(^ORD(101.41,+ORDIALOG,10,ITM,0)),COND=$G(^(3))
"RTN","ORCDLG1",10,0)
 S PROMPT=$P(ITEM,U,2) Q:'PROMPT  S:'$G(INST) INST=1
"RTN","ORCDLG1",11,0)
 S MULT=$P(ITEM,U,7),ACTION=$P(ITEM,U,9)
"RTN","ORCDLG1",12,0)
 S REQD=$P(ITEM,U,6),EDITONLY=$P(ITEM,U,8) S:$G(ORTYPE)="Z" (REQD,EDITONLY)=0
"RTN","ORCDLG1",13,0)
 I $D(^ORD(101.41,+ORDIALOG,10,ITM,9)) X ^(9) G:$G(ORQUIT) ENQ ;Entry
"RTN","ORCDLG1",14,0)
 I $G(ORTYPE)="Q",$D(ORDIALOG(PROMPT,INST)),$E(ORDIALOG(PROMPT,0))'="W" S EDITONLY=1
"RTN","ORCDLG1",15,0)
 I '$D(ORDIALOG(PROMPT,INST)) D  ; get default value
"RTN","ORCDLG1",16,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,ITM,8))>9 M ^TMP("ORWORD",$J,PROMPT,INST)=^(8) S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")" Q
"RTN","ORCDLG1",17,0)
 . K Y X:$D(^ORD(101.41,+ORDIALOG,10,ITM,7)) ^(7)
"RTN","ORCDLG1",18,0)
 . I $D(Y) S VALIDEF=$$VALID S:VALIDEF ORDIALOG(PROMPT,INST)=Y ;**95
"RTN","ORCDLG1",19,0)
 . I $G(VALIDEF)=0 W !,"The DEFAULT value for the ",$G(ORDIALOG(PROMPT,"A"))," prompt is invalid." S EDITONLY=0 ;**95
"RTN","ORCDLG1",20,0)
 . K VALIDEF ;**95
"RTN","ORCDLG1",21,0)
 I $G(AUTO),'REQD!($E(ORDIALOG(PROMPT,0))="W"&$D(ORDIALOG(PROMPT,INST))) S EDITONLY=1 ;Auto-accept
"RTN","ORCDLG1",22,0)
EN0 I FIRST&EDITONLY D:$D(ORDIALOG(PROMPT,INST))  G ENQ  ;ck child prompts
"RTN","ORCDLG1",23,0)
 . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))  N SEQ,DA,ITEM,PRMT,X,Y,VALIDEF ;**95
"RTN","ORCDLG1",24,0)
 . S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D  Q:$G(ORQUIT)
"RTN","ORCDLG1",25,0)
 . . K VALIDEF ;110
"RTN","ORCDLG1",26,0)
 . . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITEM,U,2)
"RTN","ORCDLG1",27,0)
 . . Q:$D(ORDIALOG(PRMT,INST))  ; already has a value
"RTN","ORCDLG1",28,0)
 . . K Y X:$D(^ORD(101.41,+ORDIALOG,10,DA,7)) ^(7)
"RTN","ORCDLG1",29,0)
 . . I $D(Y) S VALIDEF=$$VALID ;**95
"RTN","ORCDLG1",30,0)
 . . I $G(VALIDEF)!('$P(ITEM,U,6)) S:$G(VALIDEF) ORDIALOG(PRMT,INST)=Y Q  ;**95
"RTN","ORCDLG1",31,0)
 . . D EN(DA,INST) ; ask
"RTN","ORCDLG1",32,0)
 I ($G(OREDIT)&(ACTION'["C"))!($G(ORENEW)&(ACTION'["R")) G ENQ ;ask?
"RTN","ORCDLG1",33,0)
 I $G(OREWRITE),ACTION'["W",FIRST,'REQD!$D(ORDIALOG(PROMPT,INST)) G ENQ
"RTN","ORCDLG1",34,0)
 I $L(COND) X COND G:'$T ENQ ; failed condition
"RTN","ORCDLG1",35,0)
 M DIR=ORDIALOG(PROMPT) S DATATYPE=$E(DIR(0)),DOMAIN=$P(DIR(0),U,2)
"RTN","ORCDLG1",36,0)
 I 'MULT D WP^ORCDLG2:DATATYPE="W",ONE(INST,REQD):DATATYPE'="W" G ENQ
"RTN","ORCDLG1",37,0)
EN1 ; -- loop for multiples
"RTN","ORCDLG1",38,0)
 I '$O(ORDIALOG(PROMPT,0)) D  G:$G(ORQUIT)!('$O(ORDIALOG(PROMPT,0)))!FIRST ENQ
"RTN","ORCDLG1",39,0)
M1 . D ADDMULT Q:$G(ORQUIT)
"RTN","ORCDLG1",40,0)
 . Q:'REQD!$O(ORDIALOG(PROMPT,0))  I FIRST,$G(SEQ)=1 S ORQUIT=1 Q
"RTN","ORCDLG1",41,0)
 . W $C(7),!!,$$REQUIRED,! G M1
"RTN","ORCDLG1",42,0)
 F  S ORX=$$SELECT Q:ORX=""  S:ORX="^" ORQUIT=1 Q:$G(ORQUIT)  D  Q:$G(DIROUT)
"RTN","ORCDLG1",43,0)
 . S DIR("A")=ORDIALOG(PROMPT,"A"),X=$S('REQD:0,$$ONLY(ORX):1,1:0)
"RTN","ORCDLG1",44,0)
 . D ADDMULT:ORX="A",ONE(ORX,X):ORX Q:$G(DIROUT)  K ORQUIT,DIR("B")
"RTN","ORCDLG1",45,0)
 . I REQD,'$O(ORDIALOG(PROMPT,0)) W $C(7),!!,$$REQUIRED,!
"RTN","ORCDLG1",46,0)
ENQ X:$D(^ORD(101.41,+ORDIALOG,10,ITM,10)) ^(10) ; exit action
"RTN","ORCDLG1",47,0)
 Q
"RTN","ORCDLG1",48,0)
 ;
"RTN","ORCDLG1",49,0)
REQUIRED() ; -- Required response message
"RTN","ORCDLG1",50,0)
 Q "A response is required!  Enter '^' to quit."
"RTN","ORCDLG1",51,0)
 ;
"RTN","ORCDLG1",52,0)
SELECT() ; -- select instance of multiple to edit
"RTN","ORCDLG1",53,0)
 N DIR,X,Y,CNT,I,MAX,TOTAL,DONE,LAST
"RTN","ORCDLG1",54,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")),TOTAL=+$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",55,0)
 S DIR("A",1)=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORCDLG1",56,0)
 S (I,CNT,LAST)=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S LAST=I,CNT=CNT+1,CNT(CNT)=I,DIR("A",CNT+1)=$J(CNT,3)_": "_$$ITEM^ORCDLG(PROMPT,I) ; parent+children
"RTN","ORCDLG1",57,0)
 I 'MAX!(MAX&(MAX>TOTAL)) S CNT=CNT+1,CNT(CNT)="A",DIR("A",CNT+1)=$J(CNT,3)_": <enter more>"
"RTN","ORCDLG1",58,0)
 S DIR("A")="Select "_$S(CNT>1:"(1-"_CNT_")",1:1)_" or <return> to continue: "
"RTN","ORCDLG1",59,0)
 S DIR(0)="NAO^1:"_CNT,DIR("?")="Select the instance you wish to change"
"RTN","ORCDLG1",60,0)
S1 D ^DIR I $D(DTOUT)!(Y="^") Q "^"
"RTN","ORCDLG1",61,0)
 I Y?1"^".E D UJUMP Q:$G(ORQUIT)!($G(DONE)) "" G S1
"RTN","ORCDLG1",62,0)
 I Y="" Q Y
"RTN","ORCDLG1",63,0)
 I CNT(Y)="A" S ORDIALOG("CURINST")=LAST
"RTN","ORCDLG1",64,0)
 Q CNT(Y)
"RTN","ORCDLG1",65,0)
 ;
"RTN","ORCDLG1",66,0)
ONLY(I) ; -- I the only instance?
"RTN","ORCDLG1",67,0)
 N J,Z S J=0,Z=1
"RTN","ORCDLG1",68,0)
 F  S J=$O(ORDIALOG(PROMPT,J)) Q:J'>0  I J'=I S Z=0 Q
"RTN","ORCDLG1",69,0)
 Q Z
"RTN","ORCDLG1",70,0)
 ;
"RTN","ORCDLG1",71,0)
ADDMULT ; -- add new instances of multiple
"RTN","ORCDLG1",72,0)
 N DONE,LAST,MAX,ANOTHER,ORADDMUL
"RTN","ORCDLG1",73,0)
 S ORADDMUL=1
"RTN","ORCDLG1",74,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")) I MAX,MAX'>$G(ORDIALOG(PROMPT,"TOT")) W $C(7),!,"Only "_MAX_" items may be selected!",! Q
"RTN","ORCDLG1",75,0)
 S ANOTHER=$G(ORDIALOG(PROMPT,"MORE")) S:'$L(ANOTHER) ANOTHER="Another "
"RTN","ORCDLG1",76,0)
 S DIR("A")=$S($O(ORDIALOG(PROMPT,0)):ANOTHER,1:"")_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",77,0)
 F  D  Q:$G(ORQUIT)!($G(DONE))  I MAX Q:MAX'>$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",78,0)
 . S ORDIALOG("CURINST")=1+$G(ORDIALOG("CURINST"))
"RTN","ORCDLG1",79,0)
 . D ONE(ORDIALOG("CURINST"),0) I '$D(ORDIALOG(PROMPT,ORDIALOG("CURINST"))) S DONE=1 Q
"RTN","ORCDLG1",80,0)
 . S ORDIALOG(PROMPT,"TOT")=+$G(ORDIALOG(PROMPT,"TOT"))+1,DIR("A")=ANOTHER_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",81,0)
 Q
"RTN","ORCDLG1",82,0)
 ;
"RTN","ORCDLG1",83,0)
ONE(ORI,REQD) ; -- ask single-valued prompt
"RTN","ORCDLG1",84,0)
 N DONE,ORESET,QUERY
"RTN","ORCDLG1",85,0)
 S:$D(ORDIALOG(PROMPT,ORI)) DIR("B")=$$EXT^ORCD(PROMPT,ORI),ORESET=ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",86,0)
 S QUERY=0 I $G(ORTYPE)="Z",PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS") D  ;DJE/VM *350 Quick Order creation should query for schedule after dose.
"RTN","ORCDLG1",87,0)
 . N SCHEDITEM S SCHEDITEM=$O(^ORD(101.41,+ORDIALOG,10,"D",$$PTR^ORCD("OR GTX SCHEDULE"),"")) Q:'SCHEDITEM
"RTN","ORCDLG1",88,0)
 . I $P(^ORD(101.41,+ORDIALOG,10,SCHEDITEM,0),U,11)=PROMPT S QUERY=1  ;see if schedule is a child of dose
"RTN","ORCDLG1",89,0)
 F  D  Q:$G(DONE)  I $G(ORQUIT) Q:FIRST  Q:'REQD!$D(ORDIALOG(PROMPT,ORI))  S FIRST=$$DONE^ORCDLG2 Q:FIRST  K ORQUIT
"RTN","ORCDLG1",90,0)
 . D DIR^ORCDLG2 I $D(DTOUT)!$D(DIROUT)!(X=U) S ORQUIT=1 Q
"RTN","ORCDLG1",91,0)
 . I 'QUERY,X="" S DONE=1 Q
"RTN","ORCDLG1",92,0)
 . I X?1"^".E D UJUMP Q
"RTN","ORCDLG1",93,0)
 . I X="@" D DELETE Q:'QUERY
"RTN","ORCDLG1",94,0)
 . I $E(DIR(0))="N",Y<1,$E(Y,1,2)'="0." S Y=0_Y
"RTN","ORCDLG1",95,0)
 . S ORDIALOG(PROMPT,ORI)=$P(Y,U),DONE=1
"RTN","ORCDLG1",96,0)
 . X:$L($G(^ORD(101.41,+ORDIALOG,10,ITM,5))) ^(5) I '$G(DONE) D RESET Q  ; validate - if failed, K DONE to reask
"RTN","ORCDLG1",97,0)
 . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) CHILDREN(PROMPT,ORI) I '$G(DONE),'FIRST D DELCHILD(PROMPT,ORI),RESET Q
"RTN","ORCDLG1",98,0)
 . I QUERY,ORDIALOG(PROMPT,ORI)="" D  ;DJE/VM *350 disable empty parent node if children have no data
"RTN","ORCDLG1",99,0)
 . . N SEQ,DA,PTR,VALUE
"RTN","ORCDLG1",100,0)
 . . S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)),PTR=+$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) S:PTR&$D(ORDIALOG(PTR,ORI)) VALUE=1
"RTN","ORCDLG1",101,0)
 . . I '$G(VALUE) K ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",102,0)
 Q
"RTN","ORCDLG1",103,0)
 ;
"RTN","ORCDLG1",104,0)
CHILDREN(PARENT,INST) ; -- ask child prompts
"RTN","ORCDLG1",105,0)
 N SEQ,DA,ORQUIT S SEQ=0
"RTN","ORCDLG1",106,0)
 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D EN(DA,INST) K:$G(ORJUMP) ORJUMP Q:$G(ORQUIT)
"RTN","ORCDLG1",107,0)
 K:$G(ORQUIT) DONE ; reask parent
"RTN","ORCDLG1",108,0)
 Q
"RTN","ORCDLG1",109,0)
 ;
"RTN","ORCDLG1",110,0)
RESET ; -- Reset original prompt value
"RTN","ORCDLG1",111,0)
 K ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",112,0)
 S:$D(ORESET) ORDIALOG(PROMPT,ORI)=ORESET
"RTN","ORCDLG1",113,0)
 Q
"RTN","ORCDLG1",114,0)
 ;
"RTN","ORCDLG1",115,0)
UJUMP ; -- ^-jump
"RTN","ORCDLG1",116,0)
 N XP,P,CNT,MATCH,I,DIR,NEWSEQ ; XP=$$UP(X),P=PROMPT
"RTN","ORCDLG1",117,0)
 I $G(NOJUMP) W $C(7),"  ^-jumping not allowed!" Q
"RTN","ORCDLG1",118,0)
 S XP=$$UP^XLFSTR($P(X,U,2)) I "^"[XP S ORQUIT=1 Q
"RTN","ORCDLG1",119,0)
 I $G(ORDIALOG("B",XP)) S NEWSEQ=+ORDIALOG("B",XP) G UJQ
"RTN","ORCDLG1",120,0)
 S CNT=0,P=XP F  S P=$O(ORDIALOG("B",P)) Q:P=""  Q:$E(P,1,$L(XP))'=XP  Q:FIRST&(+ORDIALOG("B",P)'<SEQ)  S CNT=CNT+1,MATCH(CNT)=+ORDIALOG("B",P)_U_P ; =SEQ^TEXT
"RTN","ORCDLG1",121,0)
 I 'CNT W $C(7),"  ??" Q
"RTN","ORCDLG1",122,0)
 I CNT=1 S P=$P(MATCH(1),U,2) W $E(P,$L(XP)+1,$L(P)) S NEWSEQ=+MATCH(1) G UJQ
"RTN","ORCDLG1",123,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","ORCDLG1",124,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","ORCDLG1",125,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","ORCDLG1",126,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","ORCDLG1",127,0)
 S NEWSEQ=+MATCH(Y)
"RTN","ORCDLG1",128,0)
UJQ I FIRST,NEWSEQ'<SEQ W $C(7),"  ^-jumping ahead not allowed now!" Q
"RTN","ORCDLG1",129,0)
 S SEQ=NEWSEQ-.01,DONE=1
"RTN","ORCDLG1",130,0)
 I $G(ORADDMUL) S ORJUMP=1
"RTN","ORCDLG1",131,0)
 Q
"RTN","ORCDLG1",132,0)
 ;
"RTN","ORCDLG1",133,0)
DELETE ; -- delete response
"RTN","ORCDLG1",134,0)
 I '$D(DIR("B")) W $C(7),"  ??" Q
"RTN","ORCDLG1",135,0)
 Q:'$$SURE  S DONE=1
"RTN","ORCDLG1",136,0)
 K ORDIALOG(PROMPT,ORI),DIR("B")
"RTN","ORCDLG1",137,0)
 S:$G(ORDIALOG(PROMPT,"TOT")) ORDIALOG(PROMPT,"TOT")=ORDIALOG(PROMPT,"TOT")-1
"RTN","ORCDLG1",138,0)
 I 'QUERY,$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) D DELCHILD(PROMPT,ORI)
"RTN","ORCDLG1",139,0)
 Q
"RTN","ORCDLG1",140,0)
 ;
"RTN","ORCDLG1",141,0)
DELCHILD(PARENT,INST) ; -- delete child prompts
"RTN","ORCDLG1",142,0)
 N SEQ,DA,PTR S:'$G(INST) INST=1
"RTN","ORCDLG1",143,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)),PTR=+$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) K:PTR ORDIALOG(PTR,INST)
"RTN","ORCDLG1",144,0)
 Q
"RTN","ORCDLG1",145,0)
 ;
"RTN","ORCDLG1",146,0)
SURE() ; -- sure you want to delete?
"RTN","ORCDLG1",147,0)
 N X,Y,DIR
"RTN","ORCDLG1",148,0)
 S DIR(0)="YA",DIR("A")="  Are you sure you want to delete this value? "
"RTN","ORCDLG1",149,0)
 S DIR("B")="NO" W $C(7) D ^DIR
"RTN","ORCDLG1",150,0)
 S:$D(DTOUT) Y="^"
"RTN","ORCDLG1",151,0)
 Q Y
"RTN","ORCDLG1",152,0)
 ;
"RTN","ORCDLG1",153,0)
VALID() ;Check to see if default value is valid.  Returns 0 or 1
"RTN","ORCDLG1",154,0)
 ;Entire section added in patch 95
"RTN","ORCDLG1",155,0)
 N TYPE,RANGE,MIN,MAX,DIR,X,ORDIC,DDS,RTYPE,ORIG
"RTN","ORCDLG1",156,0)
 I Y="" Q 1 ;If default is null allow to pass ;110
"RTN","ORCDLG1",157,0)
 S DIR(0)=$G(ORDIALOG(PROMPT,0)),(ORIG,X)=Y,DIR("V")="" ;Set reader type, default input, silent call
"RTN","ORCDLG1",158,0)
 S TYPE=$E($P(DIR(0),"^")) ;Get type of look-up being done
"RTN","ORCDLG1",159,0)
 I TYPE="W" Q 1 ;If word processing assume value is valid, may be referencing a global location
"RTN","ORCDLG1",160,0)
 I TYPE="R" S $P(DIR(0),"^")="D"_$E($P(DIR(0),"^"),2,999),TYPE="D",RTYPE=1 ;If type is R then change to date look up
"RTN","ORCDLG1",161,0)
 I TYPE="D" I X="AM"!(X="NEXT")!(X="NEXTA")!(X="CLOSEST") Q 1 ;If date/time prompt default is AM, NEXT, NEXTA, or CLOSEST then accept without checking
"RTN","ORCDLG1",162,0)
 S:TYPE="P"&(X=+X) X="`"_X ;If pointer type add ` to IEN for DIR call
"RTN","ORCDLG1",163,0)
 I TYPE="P" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",2)=$TR($P(ORDIC,":",2),"QE","") S $P(DIR(0),"^",2)=ORDIC ;If pointer type remove Q&E from DIC(0) so no echo and no ?? on erroneous input
"RTN","ORCDLG1",164,0)
 I TYPE="D" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",3)=$TR($P(ORDIC,":",3),"E",""),$P(ORDIC,":")=$TR($P(ORDIC,":"),"DTNOW",""),$P(DIR(0),"^",2)=ORDIC ;Remove "E" so no echo, remove DT and NOW so DIR call works correctly
"RTN","ORCDLG1",165,0)
 I TYPE="Y" S:"^Y^YE^YES^"[("^"_$TR(X,"yes","YES")_"^")!(X=1) X="YES" S:"^N^NO^"[("^"_$TR(X,"no","NO")_"^")!(X=0) X="NO" ;If yes/no type convert input to uppercase full entry to avoid echo
"RTN","ORCDLG1",166,0)
 I TYPE="S" S DDS=1 ;Stops DIR call from echoing rest of entry for set of codes
"RTN","ORCDLG1",167,0)
 D ^DIR
"RTN","ORCDLG1",168,0)
 I TYPE="D"&('$D(Y(0))) Q 0 ;Date not valid
"RTN","ORCDLG1",169,0)
 I TYPE="L"&($G(Y)="") Q 0 ;List/Range not valid
"RTN","ORCDLG1",170,0)
 I TYPE="N"&('$D(Y)) Q 0 ;Numeric not valid
"RTN","ORCDLG1",171,0)
 I TYPE="P"&($G(Y)=-1) Q 0 ;Pointer not valid
"RTN","ORCDLG1",172,0)
 I TYPE="S"&($G(Y(0))="") Q 0 ;Set of codes not valid
"RTN","ORCDLG1",173,0)
 I TYPE="Y"&($G(Y(0))="") Q 0 ;Yes/No not valid
"RTN","ORCDLG1",174,0)
 I TYPE="F" S RANGE=$P(DIR(0),"^",2),MIN=$S($P(RANGE,":"):$P(RANGE,":"),1:1),MAX=$S($P(RANGE,":",2):$P(RANGE,":",2),1:240) I $L(Y)<MIN!($L(Y)>MAX) Q 0 ;Free text and not within valid limit
"RTN","ORCDLG1",175,0)
 I $G(RTYPE) S Y=ORIG ;Set y back to relative date
"RTN","ORCDLG1",176,0)
 I TYPE="P" S Y=$P(Y,"^") ;only store IEN ;110
"RTN","ORCDLG1",177,0)
 Q 1 ;Must be valid
"RTN","ORCDLG2")
0^3^B70372078^B67157200
"RTN","ORCDLG2",1,0)
ORCDLG2 ;SLC/MKB-Order dialogs cont ;10/12/2007
"RTN","ORCDLG2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,60,79,94,243,297,467**;Dec 17, 1997;Build 4
"RTN","ORCDLG2",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","ORCDLG2",4,0)
 ;;
"RTN","ORCDLG2",5,0)
 ;Reference to ^DISV supported by IA #510
"RTN","ORCDLG2",6,0)
 ;
"RTN","ORCDLG2",7,0)
DIR ; -- ^DIR read of X, returns Y
"RTN","ORCDLG2",8,0)
 N INPUTXFM,LKUP,REPL K DTOUT,DUOUT,DIRUT,DIROUT,DDER,Y
"RTN","ORCDLG2",9,0)
 S (X,Y)="",INPUTXFM=$P(DIR(0),U,3,99)
"RTN","ORCDLG2",10,0)
 S LKUP=$G(ORDIALOG(PROMPT,"LKP")) ; special lookup rtn
"RTN","ORCDLG2",11,0)
 S REPL=$S(DATATYPE'="F":0,$L($G(DIR("B")))>20:1,1:0) S:REPL DIR(0)=$E(DIR(0))_"AO^"_$P(DIR(0),U,2,99)
"RTN","ORCDLG2",12,0)
DIR1 I 'REPL W !,DIR("A")_$S($D(DIR("B")):DIR("B")_"// ",1:"") R X:DTIME I '$T S DTOUT=1 Q
"RTN","ORCDLG2",13,0)
 I REPL D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","ORCDLG2",14,0)
 I X="" S:$D(DIR("B")) X=DIR("B"),Y=ORDIALOG(PROMPT,ORI) S:'$L(X)&(SEQ=1)&('MULT) X="^" Q:'REQD!$L(X)  W $C(7),!!,$$REQUIRED^ORCDLG1,! G DIR1
"RTN","ORCDLG2",15,0)
 I X="@" Q:'REQD  W $C(7),!!,$$REQUIRED^ORCDLG1,! G DIR1
"RTN","ORCDLG2",16,0)
 I X?1"^".E S (DUOUT,DIRUT)=1,Y=X S:X="^^" DIROUT=1 Q
"RTN","ORCDLG2",17,0)
 I X?1"?".E D  G DIR1
"RTN","ORCDLG2",18,0)
 . N XHELP
"RTN","ORCDLG2",19,0)
 . S XHELP=$S($D(DIR("??")):$P(DIR("??"),U,2,99),1:("D "_DATATYPE_"^ORCDLGH"))
"RTN","ORCDLG2",20,0)
 . I (DATATYPE="P")!(DATATYPE="S")!(X?1"??".E) X XHELP
"RTN","ORCDLG2",21,0)
 . S:'$D(DIR("?")) DIR("?")=$$HELP(DATATYPE)
"RTN","ORCDLG2",22,0)
 . I $L(DIR("?"))<80 W !,DIR("?"),!
"RTN","ORCDLG2",23,0)
 . E  D  W !
"RTN","ORCDLG2",24,0)
 . . N X,DIWL,DIWR,I S X=DIR("?"),DIWL=1,DIWR=80 K ^UTILITY($J,"W")
"RTN","ORCDLG2",25,0)
 . . D ^DIWP F I=1:1:^UTILITY($J,"W",DIWL) W !,$G(^UTILITY($J,"W",DIWL,I,0))
"RTN","ORCDLG2",26,0)
 I $L(INPUTXFM) X INPUTXFM I '$D(X) D ERR G DIR1
"RTN","ORCDLG2",27,0)
 I $L(LKUP),$L($T(@LKUP)) D @LKUP Q:Y>0  D ERR G DIR1
"RTN","ORCDLG2",28,0)
 I $G(ORDIALOG(PROMPT,"LIST")) D  Q:$L(Y)  I $P(ORDIALOG(PROMPT,"LIST"),U,2) W $C(7) D LIST^ORCD G DIR1
"RTN","ORCDLG2",29,0)
 . N OROOT,ORY S OROOT="ORDIALOG("_PROMPT_",""LIST"")"
"RTN","ORCDLG2",30,0)
 . S:(X=" ")&(DATATYPE="P") X=$$SPACE(DOMAIN)
"RTN","ORCDLG2",31,0)
 . S ORY=$$FIND(OROOT,X)
"RTN","ORCDLG2",32,0)
 . I $L(ORY)!$P(ORDIALOG(PROMPT,"LIST"),U,2) S Y=ORY ;matched, or require list
"RTN","ORCDLG2",33,0)
 I DATATYPE="P" D DIC I Y'>0 D ERR G DIR1
"RTN","ORCDLG2",34,0)
 I (DATATYPE="R")!(DATATYPE="D") D DT I Y<0 D ERR G DIR1
"RTN","ORCDLG2",35,0)
 I "^F^N^S^Y^"[(U_DATATYPE_U) D  I $G(DDER) D ERR G DIR1
"RTN","ORCDLG2",36,0)
 . I REPL S Y=X Q                  ; free text - already validated
"RTN","ORCDLG2",37,0)
 . N I F I=1:1:31 S X=$TR(X,$C(I)) ; strip out control char's
"RTN","ORCDLG2",38,0)
 . S DIR("V")="" D ^DIR K DIR("V") ; silent
"RTN","ORCDLG2",39,0)
 Q
"RTN","ORCDLG2",40,0)
 ;
"RTN","ORCDLG2",41,0)
ERR ; -- show help msg on error
"RTN","ORCDLG2",42,0)
 W:$D(DIR("?")) $C(7),!,DIR("?"),!
"RTN","ORCDLG2",43,0)
 Q
"RTN","ORCDLG2",44,0)
 ;
"RTN","ORCDLG2",45,0)
FIND(LIST,X) ; -- find value X in LIST(#) or LIST("B",name)
"RTN","ORCDLG2",46,0)
 N Y,XP,CNT,MATCH,I,DIR
"RTN","ORCDLG2",47,0)
 S:$L(X)>63 X=$E(X,1,63) S X=$$UP^XLFSTR(X)
"RTN","ORCDLG2",48,0)
 S CNT=0,XP="" F  S XP=$O(@LIST@("B",XP)) Q:XP=""  I $S(X=+X:+XP=+X,1:$E(XP,1,$L(X))=X) S CNT=CNT+1,MATCH(CNT)=@LIST@("B",XP)_U_XP,DIR("A",CNT)=$J(CNT,3)_" "_XP
"RTN","ORCDLG2",49,0)
 I X=+X!(X?1"0."1.N) S Y=$G(@LIST@(X)) I $L(Y) W "   "_$P(Y,U,2) G:$$OK FQ S X="" W "   " ;force entire text to echo if CNT=1
"RTN","ORCDLG2",50,0)
 I 'CNT S Y="" G FQ
"RTN","ORCDLG2",51,0)
 I CNT=1 S Y=MATCH(1),XP=$P(Y,U,2) W $E(XP,$L(X)+1,$L(XP)) G FQ
"RTN","ORCDLG2",52,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","ORCDLG2",53,0)
 S DIR("?")="Select the desired value, by number"
"RTN","ORCDLG2",54,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") S Y="" G FQ
"RTN","ORCDLG2",55,0)
 S Y=MATCH(Y) W "  "_$P(Y,U,2)
"RTN","ORCDLG2",56,0)
FQ D:Y&((+DOMAIN=101.43)!(DOMAIN?1"ORD(101.43,:".E)) SETDISV
"RTN","ORCDLG2",57,0)
 Q Y
"RTN","ORCDLG2",58,0)
 ;
"RTN","ORCDLG2",59,0)
OK() ; -- Return 1 or 0, if selected item is correct
"RTN","ORCDLG2",60,0)
 N X,Y,DIR I CNT'>0 Q 1 ;no other matches
"RTN","ORCDLG2",61,0)
 S DIR(0)="YA",DIR("A")="   ...OK? ",DIR("B")="YES"
"RTN","ORCDLG2",62,0)
 S DIR("?")="Enter YES if this is the item you wish to select, or NO to continue searching the list"
"RTN","ORCDLG2",63,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDLG2",64,0)
 Q +Y
"RTN","ORCDLG2",65,0)
 ;
"RTN","ORCDLG2",66,0)
DIC ; -- ^DIC lookup on X, return Y
"RTN","ORCDLG2",67,0)
 N ORDMN,ORDITM,DIC,D,ORDIC,TYPE S Y=-1,ORDMN=$P(ORDIALOG(PROMPT,0),U,2)
"RTN","ORCDLG2",68,0)
 S ORDITM=$S(+ORDMN=101.43:1,ORDMN?1"ORD(101.43,:".E:1,1:0) ; OI file?
"RTN","ORCDLG2",69,0)
 I X=" ",ORDITM D SPBAR W $S(Y>0:"   "_X,1:$C(7)_"  ??") Q
"RTN","ORCDLG2",70,0)
 I ORDITM,X?1"`"1.N W $C(7),!,"Lookup by internal entry number not allowed!",! Q
"RTN","ORCDLG2",71,0)
 I X=$G(DIR("B")) S Y=ORDIALOG(PROMPT,ORI) Q  ; default
"RTN","ORCDLG2",72,0)
 S DIC=$P(ORDMN,":"),DIC(0)=$P(ORDMN,":",2),ORDIC="^DIC" S:'DIC DIC=U_DIC
"RTN","ORCDLG2",73,0)
 S:$D(ORDIALOG(PROMPT,"S")) DIC("S")=ORDIALOG(PROMPT,"S")
"RTN","ORCDLG2",74,0)
 I ORDITM,$L(X)>30 S X=$E(X,1,30) D
"RTN","ORCDLG2",75,0)
 . W !?5,"Entries are matched based on the first 30 characters. Longer entries may"
"RTN","ORCDLG2",76,0)
 . W !?5,"result in more than one match. If this happens, please select the desired"
"RTN","ORCDLG2",77,0)
 . W !?5,"entry.",!!,X
"RTN","ORCDLG2",78,0)
 S TYPE=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDLG2",79,0)
 S:ORDITM DIC("W")="W:$S('$D(%):0,'$D(DIY):0,%=DIY:0,1:1) $G(DIY)"_$S(TYPE["RX":" W:$P($G(^(""PS"")),U,6) ""   (non-formulary)"" ",1:"") ;W NAME if OI/synm, or NF
"RTN","ORCDLG2",80,0)
 S D=$G(ORDIALOG(PROMPT,"D")),D=$TR(D,";","^")
"RTN","ORCDLG2",81,0)
 I $L(D) S ORDIC="IX^DIC" S:$L(D,U)>1 ORDIC="MIX^DIC1",DIC(0)=DIC(0)_"M"
"RTN","ORCDLG2",82,0)
 D @ORDIC,SETDISV:Y&ORDITM
"RTN","ORCDLG2",83,0)
 I DIC(0)["S",X'=$P(Y,"^",2) W "  ",$P(Y,"^",2)
"RTN","ORCDLG2",84,0)
 Q
"RTN","ORCDLG2",85,0)
 ;
"RTN","ORCDLG2",86,0)
SPACE(FILE) ; -- Resolve spbar-return for ptrs
"RTN","ORCDLG2",87,0)
 N X,Y,DIC,ROOT S X=" ",FILE=$P(FILE,":")
"RTN","ORCDLG2",88,0)
 I (+FILE=101.43)!(FILE="ORD(101.43,") D SPBAR Q X
"RTN","ORCDLG2",89,0)
 S ROOT=$S(+FILE:$$ROOT^DILFD(+FILE),1:U_FILE),Y=$G(^DISV(DUZ,ROOT))
"RTN","ORCDLG2",90,0)
 S:Y X=$P(@(ROOT_Y_",0)"),U)
"RTN","ORCDLG2",91,0)
 Q X
"RTN","ORCDLG2",92,0)
 ;
"RTN","ORCDLG2",93,0)
SPBAR ; -- Resolve spbar-return for #101.43
"RTN","ORCDLG2",94,0)
 N SDX,I,X1,D S SDX="",D=$G(ORDIALOG(PROMPT,"D")),D=$TR(D,";","^")
"RTN","ORCDLG2",95,0)
 F I=1:1:$L(D,"^") I $P(D,U,I)?1"S."1.E S SDX=$P(D,U,I) Q
"RTN","ORCDLG2",96,0)
 Q:'$L(SDX)  S X1=$G(^DISV(DUZ,"ORDITM",SDX,1)) Q:'$L(X1)
"RTN","ORCDLG2",97,0)
 S Y=$O(^ORD(101.43,SDX,X1,0)) S:Y X=X1,Y=Y_U_X1
"RTN","ORCDLG2",98,0)
 Q
"RTN","ORCDLG2",99,0)
 ;
"RTN","ORCDLG2",100,0)
SETDISV ; -- Save entry Y=ifn^name in ^DISV for #101.43
"RTN","ORCDLG2",101,0)
 N SDX,I Q:'$L($P(Y,U,2))
"RTN","ORCDLG2",102,0)
 S SDX="",D=$G(ORDIALOG(PROMPT,"D")) Q:D'["S."
"RTN","ORCDLG2",103,0)
 F I=1:1:$L(D,";") I $P(D,";",I)?1"S."1.E S SDX=$P(D,";",I) Q
"RTN","ORCDLG2",104,0)
 Q:'$L(SDX)  S ^DISV(DUZ,"ORDITM",SDX,1)=$P(Y,U,2)
"RTN","ORCDLG2",105,0)
 Q
"RTN","ORCDLG2",106,0)
 ;
"RTN","ORCDLG2",107,0)
DT ; -- %DT validation on X, return Y
"RTN","ORCDLG2",108,0)
 N %DT,BEG,END S %DT=$P(DOMAIN,":",3),X=$$UP^XLFSTR(X)
"RTN","ORCDLG2",109,0)
 I $L($P(DOMAIN,":")) S BEG=$$FMDT($P(DOMAIN,":")) ;earliest date allowed
"RTN","ORCDLG2",110,0)
 I $L($P(DOMAIN,":",2)) S END=$$FMDT($P(DOMAIN,":",2)) ;latest allowed
"RTN","ORCDLG2",111,0)
 D ^%DT Q:Y'>0
"RTN","ORCDLG2",112,0)
 I $G(BEG) D  Q:Y<0
"RTN","ORCDLG2",113,0)
 . I $L(Y,".")'=$L(BEG,".") S BEG=$P(BEG,".") ; date only
"RTN","ORCDLG2",114,0)
 . I Y<BEG W $C(7),!,"Date may not be before "_$$FMTE^XLFDT(BEG) S Y=-1 Q
"RTN","ORCDLG2",115,0)
 I $G(END) D  Q:Y<0
"RTN","ORCDLG2",116,0)
 . I $L(Y,".")'=$L(END,".") S END=$P(END,".") ; date only
"RTN","ORCDLG2",117,0)
 . I Y>END W $C(7),!,"Date may not be after "_$$FMTE^XLFDT(END) S Y=-1 Q
"RTN","ORCDLG2",118,0)
 I DATATYPE="R",$$RELDT(X) S:(%DT'["T")&("NOW"[X) X="TODAY" S Y=X ;text
"RTN","ORCDLG2",119,0)
 Q
"RTN","ORCDLG2",120,0)
DT1 S:X="NOON" X="T@NOON" S:$E("MIDNIGHT",1,$L(X))=X X="T@MIDNIGHT"
"RTN","ORCDLG2",121,0)
 I X'?1"V".E,X'?1"T".E D ^%DT S:Y>0&("NOW"[X) Y="NOW" Q
"RTN","ORCDLG2",122,0)
 S D=$$UP^XLFSTR($P(X,"@")),T=$P(X,"@",2)
"RTN","ORCDLG2",123,0)
 S Y=$E(D) I "VT"'[Y S Y=-1 Q
"RTN","ORCDLG2",124,0)
 I (D["+")!(D["-") D  Q:Y<0
"RTN","ORCDLG2",125,0)
 . N SIGN,OFFSET,X1,X2
"RTN","ORCDLG2",126,0)
 . S SIGN=$S(D["+":"+",1:"-"),OFFSET=$P(D,SIGN,2) I 'OFFSET S Y=-1 Q
"RTN","ORCDLG2",127,0)
 . S X1=+OFFSET,X2=$P(OFFSET,X1,2) I "DWM"'[$E(X2) S Y=-1 Q
"RTN","ORCDLG2",128,0)
 . S Y=Y_SIGN_X1_$E(X2) ; T+3W, e.g.
"RTN","ORCDLG2",129,0)
 I '$L(T)&(DOMAIN["R") S Y=-1 Q  ; time missing, required
"RTN","ORCDLG2",130,0)
 I $L(T) D  I '$D(T) S Y=-1 Q
"RTN","ORCDLG2",131,0)
 . I '(DOMAIN["T"!(DOMAIN["R")) K T Q  ; time prohibited
"RTN","ORCDLG2",132,0)
 . N X,Y S X="T@"_T,%DT=$TR(DOMAIN,"E") D ^%DT I Y<0 K T Q
"RTN","ORCDLG2",133,0)
 . S T=$E($P(Y,".",2),1,4) S:$L(T)<4 T=T_$E("0000",1,4-$L(T))
"RTN","ORCDLG2",134,0)
 S:$L(T) Y=Y_"@"_T ; Y=date text, or -1 if error
"RTN","ORCDLG2",135,0)
 Q
"RTN","ORCDLG2",136,0)
 ;
"RTN","ORCDLG2",137,0)
RELDT(X) ; -- Returns 1 or 0, if X is relative date
"RTN","ORCDLG2",138,0)
 N Y S X=$G(X)
"RTN","ORCDLG2",139,0)
 I ("NOON"[X)!("MIDNIGHT"[X)!($E(X)="T")!($E(X)="N") S Y=1
"RTN","ORCDLG2",140,0)
 E  S Y=0
"RTN","ORCDLG2",141,0)
 Q Y
"RTN","ORCDLG2",142,0)
 ;
"RTN","ORCDLG2",143,0)
FMDT(X) ; -- Return FM form of date X
"RTN","ORCDLG2",144,0)
 N Y,%DT S %DT="T" D ^%DT
"RTN","ORCDLG2",145,0)
 Q Y
"RTN","ORCDLG2",146,0)
 ;
"RTN","ORCDLG2",147,0)
WP ; -- edit WP field
"RTN","ORCDLG2",148,0)
 N DIC,DWLW,DWPK,DIWESUB,DONE,ORLINEDT,LCNT,UPCARR
"RTN","ORCDLG2",149,0)
 S DIC="^TMP(""ORWORD"",$J,"_PROMPT_","_INST_",",DWLW=80,DWPK=1
"RTN","ORCDLG2",150,0)
 S DIWESUB=$P(DIR("A"),":"),ORLINEDT=$$LINEDTR(DUZ)
"RTN","ORCDLG2",151,0)
 I '$D(^TMP("ORWORD",$J,PROMPT,INST)) M:$D(^ORD(101.41,+ORDIALOG,10,ITM,8))>9 ^TMP("ORWORD",$J,PROMPT,INST)=^(8)
"RTN","ORCDLG2",152,0)
 I 'ORLINEDT,'REQD,'$$EDITWP Q  ;94
"RTN","ORCDLG2",153,0)
WP1 W:ORLINEDT !,DIR("A") S DIWESUB=$P(DIR("A"),":")
"RTN","ORCDLG2",154,0)
 D EN^DIWE I $D(DTOUT)!($D(DUOUT)) S ORQUIT=1 Q
"RTN","ORCDLG2",155,0)
 I REQD,'$O(^TMP("ORWORD",$J,PROMPT,INST,0)) W $C(7),!!,"A response is required!" G:'$$DONE WP1 S ORQUIT=1 Q
"RTN","ORCDLG2",156,0)
 I '$O(^TMP("ORWORD",$J,PROMPT,INST,0)) K ^TMP("ORWORD",$J,PROMPT,INST),ORDIALOG(PROMPT,INST) Q  ;empty
"RTN","ORCDLG2",157,0)
 S LCNT="",UPCARR=0
"RTN","ORCDLG2",158,0)
 F  S LCNT=$O(^TMP("ORWORD",$J,PROMPT,INST,LCNT)) Q:LCNT=""!(UPCARR=1)  D
"RTN","ORCDLG2",159,0)
 .I LCNT>0,$G(^TMP("ORWORD",$J,PROMPT,INST,LCNT,0))[U S UPCARR=1
"RTN","ORCDLG2",160,0)
 I UPCARR=1 W !!,"An ""^"" is not allowed in a word processing field." G:'$$DONE WP1 S ORQUIT=1 Q
"RTN","ORCDLG2",161,0)
 S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")",DONE=1
"RTN","ORCDLG2",162,0)
 I $D(^ORD(101.41,+ORDIALOG,10,ITM,5)) X ^(5) Q:$G(ORQUIT)!($G(DONE))  G WP1
"RTN","ORCDLG2",163,0)
 Q
"RTN","ORCDLG2",164,0)
 ;
"RTN","ORCDLG2",165,0)
EDITWP() ; -- Want to edit WP field?
"RTN","ORCDLG2",166,0)
 N X,Y,%,%Y
"RTN","ORCDLG2",167,0)
 W !,ORDIALOG(PROMPT,"A") S Y=$D(ORDIALOG(PROMPT,INST))
"RTN","ORCDLG2",168,0)
 I 'Y,REQD Q 1 ; no data, req'd
"RTN","ORCDLG2",169,0)
 W:'Y !,"  No existing text",! I Y D  ; show comments
"RTN","ORCDLG2",170,0)
 . N X,DIWL,DIWR,DIWF,ORI
"RTN","ORCDLG2",171,0)
 . S DIWL=3,DIWR=79,DIWF="W" K ^UTILITY($J,"W")
"RTN","ORCDLG2",172,0)
 . S ORI=0 F  S ORI=$O(^TMP("ORWORD",$J,PROMPT,INST,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) D:$L(X) ^DIWP
"RTN","ORCDLG2",173,0)
 . D ^DIWW
"RTN","ORCDLG2",174,0)
ED1 S %=$S($D(OREDIT):1,1:2) W "  Edit" D YN^DICN
"RTN","ORCDLG2",175,0)
 I %=0 W !,"  Enter 'YES' if you wish to go into the editor.",!,"  Enter 'NO' if you do not wish to edit at this time.",! G ED1
"RTN","ORCDLG2",176,0)
 S Y=$S(%<0:"^",%=2:0,1:1)
"RTN","ORCDLG2",177,0)
 Q Y
"RTN","ORCDLG2",178,0)
 ;
"RTN","ORCDLG2",179,0)
LINEDTR(USER) ; -- Returns 1 or 0, if user's editor will be LineEd
"RTN","ORCDLG2",180,0)
 N X,Y
"RTN","ORCDLG2",181,0)
 S X=+$P($G(^VA(200,USER,1)),U,5),Y=0 I 'X S Y=1
"RTN","ORCDLG2",182,0)
 E  S:$$GET1^DIQ(1.2,+X_",",.01)="LINE EDITOR - VA FILEMAN" Y=1
"RTN","ORCDLG2",183,0)
 Q Y
"RTN","ORCDLG2",184,0)
 ;
"RTN","ORCDLG2",185,0)
RETURN() ; -- press return to cont
"RTN","ORCDLG2",186,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDLG2",187,0)
 Q ""
"RTN","ORCDLG2",188,0)
 ;
"RTN","ORCDLG2",189,0)
DONE() ; -- Done editing?
"RTN","ORCDLG2",190,0)
 N DIR,X,Y
"RTN","ORCDLG2",191,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit? ",DIR("B")="NO"
"RTN","ORCDLG2",192,0)
 S DIR("?")="Enter YES to exit this order, or NO to continue editing"
"RTN","ORCDLG2",193,0)
 D ^DIR
"RTN","ORCDLG2",194,0)
 Q +Y
"RTN","ORCDLG2",195,0)
 ;
"RTN","ORCDLG2",196,0)
HELP(TYPE) ; -- Returns default help msg for TYPE prompt
"RTN","ORCDLG2",197,0)
 N Y S Y=""
"RTN","ORCDLG2",198,0)
 I TYPE="D" S Y="Enter a date[/time]."
"RTN","ORCDLG2",199,0)
 I TYPE="R" S Y="Enter a date[/time] as T for TODAY or T+1 for TOMORROW."
"RTN","ORCDLG2",200,0)
 I TYPE="F" S Y="Enter a string of text."
"RTN","ORCDLG2",201,0)
 I TYPE="N" S Y="Enter a number."
"RTN","ORCDLG2",202,0)
 I TYPE="S" S Y="Enter an item from the list."
"RTN","ORCDLG2",203,0)
 I TYPE="Y" S Y="Enter YES or NO."
"RTN","ORCDLG2",204,0)
 I TYPE="P" S Y="Enter an item from the file."
"RTN","ORCDLG2",205,0)
 I TYPE="W" S Y=""
"RTN","ORCDLG2",206,0)
 Q Y
"RTN","ORCDPSIV")
0^1^B126767788^B121517971
"RTN","ORCDPSIV",1,0)
ORCDPSIV ;SLC/MKB-Pharmacy IV dialog utilities ;06/17/10
"RTN","ORCDPSIV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,38,48,158,195,243,296,280,388,467**;Dec 17, 1997;Build 4
"RTN","ORCDPSIV",3,0)
 ;Per VHA Directive 6402, this routine should not be modified.
"RTN","ORCDPSIV",4,0)
 ;
"RTN","ORCDPSIV",5,0)
 ;Reference to ^PSSUTIL1 supported by ICR 3784
"RTN","ORCDPSIV",6,0)
 ;Reference to ^PSIVSP supported by ICR 2945
"RTN","ORCDPSIV",7,0)
 ;Reference to ^PSJORUT2 supported by ICR 2402
"RTN","ORCDPSIV",8,0)
 ;Reference to ^PSSDSAPA supported by ICR 5504
"RTN","ORCDPSIV",9,0)
 ;Reference to ^PSSGS0 supported by ICR 3423
"RTN","ORCDPSIV",10,0)
 ;
"RTN","ORCDPSIV",11,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPSIV",12,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD
"RTN","ORCDPSIV",13,0)
 D EN^PSSGS0(.ORX,"I")
"RTN","ORCDPSIV",14,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX Q
"RTN","ORCDPSIV",15,0)
 W $C(7),!,"Enter a standard schedule for administering this medication."
"RTN","ORCDPSIV",16,0)
 Q
"RTN","ORCDPSIV",17,0)
ISONETIM(SCH) ;
"RTN","ORCDPSIV",18,0)
 N DUR
"RTN","ORCDPSIV",19,0)
 I SCH="" Q 0
"RTN","ORCDPSIV",20,0)
 K ^TMP($J,"ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",21,0)
 D ZERO^PSS51P1(,SCH,"PSJ","O","ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",22,0)
 I $D(^TMP($J,"ORCDPSIV GETSCHTYP","B",SCH)) D  Q 1
"RTN","ORCDPSIV",23,0)
 .S DUR=$$PTR^ORCD("OR GTX DURATION")
"RTN","ORCDPSIV",24,0)
 .I $G(ORDIALOG(DUR,1))="" Q
"RTN","ORCDPSIV",25,0)
 .S ORDIALOG(DUR,1)=""
"RTN","ORCDPSIV",26,0)
 .W !,"IV Orders with a schedule type of one-time cannot have a duration."
"RTN","ORCDPSIV",27,0)
 .W !,"The duration has been deleted from this quick order." H 1
"RTN","ORCDPSIV",28,0)
 K ^TMP($J,"ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",29,0)
 Q 0
"RTN","ORCDPSIV",30,0)
 ;
"RTN","ORCDPSIV",31,0)
ADDFRD(ORDIALOG,INST,PROMPT) ;
"RTN","ORCDPSIV",32,0)
 N ADDFRIEN,ADDIEN,OI,PSOI,RESULT
"RTN","ORCDPSIV",33,0)
 S RESULT=""
"RTN","ORCDPSIV",34,0)
 I $G(ORIVTYPE)'="C" Q RESULT
"RTN","ORCDPSIV",35,0)
 S ADDFRIEN=$O(^ORD(101.41,"AB","OR GTX ADDITIVE FREQUENCY","")) I 'ADDFRIEN Q RESULT
"RTN","ORCDPSIV",36,0)
 S ADDIEN=$O(^ORD(101.41,"AB","OR GTX ADDITIVE","")) I 'ADDIEN Q RESULT
"RTN","ORCDPSIV",37,0)
 S RESULT=$$RECALL^ORCD(PROMPT,INST) I RESULT'="" Q RESULT
"RTN","ORCDPSIV",38,0)
 S OI=$G(ORDIALOG(ADDIEN,INST)) I OI="" Q RESULT
"RTN","ORCDPSIV",39,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2) I +PSOI'>0 Q RESULT
"RTN","ORCDPSIV",40,0)
 S RESULT=$$IV^PSSDSAPA(+PSOI)
"RTN","ORCDPSIV",41,0)
 S RESULT=$S(RESULT="A":"All Bags",RESULT=1:"1 Bag/Day",1:"")
"RTN","ORCDPSIV",42,0)
 Q RESULT
"RTN","ORCDPSIV",43,0)
 ;
"RTN","ORCDPSIV",44,0)
ADDFRQC ;
"RTN","ORCDPSIV",45,0)
 I $G(ORIVTYPE)'="C" Q
"RTN","ORCDPSIV",46,0)
 W !,"Select from the list of the codes below to assign an additive frequency for this additive."
"RTN","ORCDPSIV",47,0)
 W !,"A = All Bags"
"RTN","ORCDPSIV",48,0)
 W !,"1 = 1 Bag/Day"
"RTN","ORCDPSIV",49,0)
 W !,"S = See Comments"
"RTN","ORCDPSIV",50,0)
 W !
"RTN","ORCDPSIV",51,0)
 Q
"RTN","ORCDPSIV",52,0)
ADDFRQI ;
"RTN","ORCDPSIV",53,0)
 S X=$$UP^XLFSTR(X)
"RTN","ORCDPSIV",54,0)
 I X'="A",X'=1,X'="S" D ADDFRQC K X Q
"RTN","ORCDPSIV",55,0)
 I X="A" S X="All Bags" Q
"RTN","ORCDPSIV",56,0)
 I X=1 S X="1 Bag/Day" Q
"RTN","ORCDPSIV",57,0)
 I X="S" S X="See Comments"
"RTN","ORCDPSIV",58,0)
 Q
"RTN","ORCDPSIV",59,0)
 ;
"RTN","ORCDPSIV",60,0)
PROVIDER ; -- Check provider, if authorized to write med orders
"RTN","ORCDPSIV",61,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") W $C(7),!!,"OREMAS key holders may not enter medication orders." S ORQUIT=1 Q
"RTN","ORCDPSIV",62,0)
 N PS,NAME S PS=$G(^VA(200,+$G(ORNP),"PS")),NAME=$P($G(^(20)),U,2)
"RTN","ORCDPSIV",63,0)
 I '$L(NAME) S NAME=$P(^VA(200,+$G(ORNP),0),U)
"RTN","ORCDPSIV",64,0)
 I '$P(PS,U) W $C(7),!!,NAME_" is not authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",65,0)
 I $P(PS,U,4),$$NOW^XLFDT>$P(PS,U,4) W $C(7),!!,NAME_" is no longer authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",66,0)
 I $G(ORQUIT) W !,"You must select another provider to continue.",! S PS=$$MEDPROV I PS S ORXNP=ORNP,ORNP=PS K ORQUIT
"RTN","ORCDPSIV",67,0)
 Q
"RTN","ORCDPSIV",68,0)
 ;
"RTN","ORCDPSIV",69,0)
MEDPROV() ; -- Return ordering med provider
"RTN","ORCDPSIV",70,0)
 N X,Y,D,DIC
"RTN","ORCDPSIV",71,0)
 S DIC=200,DIC(0)="AEQ",DIC("A")="Select PROVIDER: ",D="AK.PROVIDER"
"RTN","ORCDPSIV",72,0)
 S DIC("S")="I $P($G(^(""PS"")),U),'$P(^(""PS""),U,4)!($P(^(""PS""),U,4)>$$NOW^XLFDT)"
"RTN","ORCDPSIV",73,0)
 D IX^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCDPSIV",74,0)
 Q Y
"RTN","ORCDPSIV",75,0)
 ;
"RTN","ORCDPSIV",76,0)
CHANGED(TYPE) ; -- Kill dependent values when OI changes
"RTN","ORCDPSIV",77,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPSIV",78,0)
 Q:'$L($G(TYPE))  S PROMPTS=""
"RTN","ORCDPSIV",79,0)
 S:TYPE="B" PROMPTS="VOLUME"
"RTN","ORCDPSIV",80,0)
 S:TYPE="A" PROMPTS="STRENGTH PSIV^UNITS"
"RTN","ORCDPSIV",81,0)
 I TYPE="T" D
"RTN","ORCDPSIV",82,0)
 .S PROMPTS="INFUSION RATE^SCHEDULE^ADDITIVE FREQUENCY"
"RTN","ORCDPSIV",83,0)
 .S PTR=$O(^ORD(101.41,"AB","OR GTX DURATION","")) Q:'PTR
"RTN","ORCDPSIV",84,0)
 .I $G(ORDIALOG(PTR,1))["DOSES" S PROMPTS=PROMPTS_U_"DURATION"
"RTN","ORCDPSIV",85,0)
 ;
"RTN","ORCDPSIV",86,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPSIV",87,0)
 . S PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) Q:'PTR
"RTN","ORCDPSIV",88,0)
 . K ORDIALOG(PTR,ORI)
"RTN","ORCDPSIV",89,0)
 . ;S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPSIV",90,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDPSIV",91,0)
 Q
"RTN","ORCDPSIV",92,0)
 ;
"RTN","ORCDPSIV",93,0)
INACTIVE(TYPE) ; -- Check OI inactive date
"RTN","ORCDPSIV",94,0)
 N OI,X,I,PSOI,DEA,EXIT S:$G(TYPE)'="A" TYPE="S"
"RTN","ORCDPSIV",95,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:OI'>0
"RTN","ORCDPSIV",96,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q  ;inactive
"RTN","ORCDPSIV",97,0)
 . S X=$S(TYPE="A":"additive",1:"solution"),ORQUIT=1
"RTN","ORCDPSIV",98,0)
 . W $C(7),!,"This "_X_" may not be ordered anymore.  Please select another."
"RTN","ORCDPSIV",99,0)
 S I=$S(TYPE="A":4,1:3) I '$P($G(^ORD(101.43,OI,"PS")),U,I) D  Q
"RTN","ORCDPSIV",100,0)
 . S X=$S(TYPE="A":"an additive",1:"a solution"),ORQUIT=1
"RTN","ORCDPSIV",101,0)
 . W $C(7),!,"This item may not be ordered as "_X_"."
"RTN","ORCDPSIV",102,0)
 S EXIT=$$INPT^ORCD I EXIT=0 D ROUTECHK Q
"RTN","ORCDPSIV",103,0)
 Q:'$L($T(IVDEA^PSSUTIL1))  ;DBIA #3784
"RTN","ORCDPSIV",104,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORCDPSIV",105,0)
 S DEA=$$IVDEA^PSSUTIL1(PSOI,TYPE) I DEA>0 D  Q:$G(ORQUIT)
"RTN","ORCDPSIV",106,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPSIV",107,0)
 . I DEA=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPSIV",108,0)
 D ROUTECHK
"RTN","ORCDPSIV",109,0)
 Q
"RTN","ORCDPSIV",110,0)
 ;
"RTN","ORCDPSIV",111,0)
VOLUME ; -- get allowable volumes for solution
"RTN","ORCDPSIV",112,0)
 N PSOI,ORY,CNT,I,XORY K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDPSIV",113,0)
 S PSOI=+$P($G(^ORD(101.43,+$$VAL^ORCD("SOLUTION",INST),0)),U,2)_"B"
"RTN","ORCDPSIV",114,0)
 D ENVOL^PSJORUT2(PSOI,.ORY) Q:'ORY
"RTN","ORCDPSIV",115,0)
 ;S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",+ORY(I))=+ORY(I)
"RTN","ORCDPSIV",116,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  D
"RTN","ORCDPSIV",117,0)
 . S CNT=CNT+1
"RTN","ORCDPSIV",118,0)
 . S XORY(I)=+ORY(I) I XORY(I)<1,$E(XORY(I),1,2)'="0." S XORY(I)=0_XORY(I)
"RTN","ORCDPSIV",119,0)
 . S ORDIALOG(PROMPT,"LIST",XORY(I))=XORY(I)
"RTN","ORCDPSIV",120,0)
 S ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDPSIV",121,0)
 Q
"RTN","ORCDPSIV",122,0)
 ;
"RTN","ORCDPSIV",123,0)
UNITS ; -- get allowable units for current additive
"RTN","ORCDPSIV",124,0)
 N PSOI,ORY,I,UNITS
"RTN","ORCDPSIV",125,0)
 S PSOI=+$P(^ORD(101.43,+ORDIALOG($$PTR^ORCD("OR GTX ADDITIVE"),INST),0),U,2)_"A"
"RTN","ORCDPSIV",126,0)
 D ENVOL^PSJORUT2(PSOI,.ORY)
"RTN","ORCDPSIV",127,0)
 S I=$O(ORY(0)) Q:'I  S UNITS=$P($G(ORY(I)),U,2)
"RTN","ORCDPSIV",128,0)
 S ORDIALOG($$PTR^ORCD("OR GTX UNITS"),INST)=UNITS
"RTN","ORCDPSIV",129,0)
 W !," (Units for this additive are "_UNITS_")"
"RTN","ORCDPSIV",130,0)
 Q
"RTN","ORCDPSIV",131,0)
 ;
"RTN","ORCDPSIV",132,0)
PREMIX() ; -- Returns 1 or 0, if IV base is a premix solution
"RTN","ORCDPSIV",133,0)
 N BASE,PS,I,Y
"RTN","ORCDPSIV",134,0)
 S BASE=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),Y=0
"RTN","ORCDPSIV",135,0)
 S I=0 F  S I=$O(ORDIALOG(BASE,I)) Q:I'>0  D  Q:Y
"RTN","ORCDPSIV",136,0)
 . S PS=$G(^ORD(101.43,+$G(ORDIALOG(BASE,I)),"PS"))
"RTN","ORCDPSIV",137,0)
 . I $P(PS,U,3)&($P(PS,U,4)) S Y=1
"RTN","ORCDPSIV",138,0)
 Q Y
"RTN","ORCDPSIV",139,0)
 ;
"RTN","ORCDPSIV",140,0)
IVRTEENT ;
"RTN","ORCDPSIV",141,0)
 N ARRAY,DIR,RIEN,TROUTE
"RTN","ORCDPSIV",142,0)
 I ORTYPE'="Z" Q
"RTN","ORCDPSIV",143,0)
 S RIEN=$P($G(ORDIALOG("B","ROUTE")),U,2) Q:RIEN'>0
"RTN","ORCDPSIV",144,0)
 S EXIT=0,TROUTE=$G(ORDIALOG(RIEN,1)) Q:TROUTE'>0
"RTN","ORCDPSIV",145,0)
 I $$IVRTESCR(TROUTE)=1 Q
"RTN","ORCDPSIV",146,0)
 S ORDIALOG(RIEN,1)=""
"RTN","ORCDPSIV",147,0)
 W !!,"The selected route is not a valid route for this order."
"RTN","ORCDPSIV",148,0)
 W !,"Select a new route for this order from the list of routes below."
"RTN","ORCDPSIV",149,0)
 D RTEDISP(.ARRAY)
"RTN","ORCDPSIV",150,0)
 Q
"RTN","ORCDPSIV",151,0)
 ;
"RTN","ORCDPSIV",152,0)
BIVOI(ARRAY) ;
"RTN","ORCDPSIV",153,0)
 N CNT,NUM,OIIEN,OTYPE
"RTN","ORCDPSIV",154,0)
 S CNT=0
"RTN","ORCDPSIV",155,0)
 F OTYPE="SOLUTION","ADDITIVE" D
"RTN","ORCDPSIV",156,0)
 .S OIIEN=+$P($G(ORDIALOG("B",OTYPE)),U,2) I OIIEN>0 D
"RTN","ORCDPSIV",157,0)
 ..S NUM=0 F  S NUM=$O(ORDIALOG(OIIEN,NUM)) Q:NUM'>0  I +$G(ORDIALOG(OIIEN,NUM))>0 D
"RTN","ORCDPSIV",158,0)
 ...S CNT=CNT+1,ARRAY(CNT)=ORDIALOG(OIIEN,NUM)
"RTN","ORCDPSIV",159,0)
 Q
"RTN","ORCDPSIV",160,0)
 ;
"RTN","ORCDPSIV",161,0)
LVROUTES ;
"RTN","ORCDPSIV",162,0)
 N ARRAY,ROUTES
"RTN","ORCDPSIV",163,0)
 D BIVOI(.ARRAY)
"RTN","ORCDPSIV",164,0)
 D IVDOSFRM^ORWDPS33(.ROUTES,.ARRAY,1)
"RTN","ORCDPSIV",165,0)
 D RTEDISP(.ROUTES)
"RTN","ORCDPSIV",166,0)
 Q
"RTN","ORCDPSIV",167,0)
 ;
"RTN","ORCDPSIV",168,0)
RTEDISP(ROUTES) ;
"RTN","ORCDPSIV",169,0)
 N CNT
"RTN","ORCDPSIV",170,0)
 S CNT="" F  S CNT=$O(ROUTES(CNT)) Q:CNT'>0  D
"RTN","ORCDPSIV",171,0)
 .W !,$P($G(ROUTES(CNT)),U,2)
"RTN","ORCDPSIV",172,0)
 Q
"RTN","ORCDPSIV",173,0)
 ;
"RTN","ORCDPSIV",174,0)
IVRTESCR(Y) ;
"RTN","ORCDPSIV",175,0)
 N ARRAY,ROUTES,VALUE
"RTN","ORCDPSIV",176,0)
 D BIVOI(.ARRAY)
"RTN","ORCDPSIV",177,0)
 S VALUE=$$IVQOVAL^ORWDPS33(.ARRAY,Y) I VALUE'="" Q 1
"RTN","ORCDPSIV",178,0)
 Q 0
"RTN","ORCDPSIV",179,0)
 ;
"RTN","ORCDPSIV",180,0)
ROUTECHK ;
"RTN","ORCDPSIV",181,0)
 N CNT,IEN,ROUTE,VALUE
"RTN","ORCDPSIV",182,0)
 S RIEN=$P($G(ORDIALOG("B","ROUTE")),U,2) Q:RIEN'>0
"RTN","ORCDPSIV",183,0)
 S TROUTE=$G(ORDIALOG(RIEN,1)) Q:TROUTE'>0
"RTN","ORCDPSIV",184,0)
 I $$IVRTESCR(TROUTE)=1 Q
"RTN","ORCDPSIV",185,0)
 S ORDIALOG(RIEN,1)=""
"RTN","ORCDPSIV",186,0)
 W !!,"The route defined for this order is an invalid route."
"RTN","ORCDPSIV",187,0)
 W !,"You will need to define a new route for this order."
"RTN","ORCDPSIV",188,0)
 Q
"RTN","ORCDPSIV",189,0)
 ;
"RTN","ORCDPSIV",190,0)
ENRATE ; -- set display text, help based on IV TYPE
"RTN","ORCDPSIV",191,0)
 N X,MSG S X=$G(ORIVTYPE),MSG=""
"RTN","ORCDPSIV",192,0)
 S ORDIALOG(PROMPT,"A")=$S(X="I":"Infuse over time (min): ",1:"Infusion Rate (ml/hr): ")
"RTN","ORCDPSIV",193,0)
 S MSG="Enter the "_$S(X="I":"number of minutes over which to infuse this medication.",1:"infusion rate, as the number of ml/hr or Text@Number of Labels per day. ")
"RTN","ORCDPSIV",194,0)
 S ORDIALOG(PROMPT,"?")=MSG,ORDIALOG(PROMPT,"??")=MSG ;p388
"RTN","ORCDPSIV",195,0)
 I X="I" D
"RTN","ORCDPSIV",196,0)
 .N RATEI,RATEV,TIME,UNIT
"RTN","ORCDPSIV",197,0)
 .S RATEI=$P($G(ORDIALOG("B","INFUSION RATE")),U,2) Q:RATEI'>0
"RTN","ORCDPSIV",198,0)
 .S RATEV=$G(ORDIALOG(RATEI,1)) Q:'$L(RATEV)
"RTN","ORCDPSIV",199,0)
 .I RATEV'["INFUSE OVER" Q
"RTN","ORCDPSIV",200,0)
 .S TIME=$P(RATEV," ",3)
"RTN","ORCDPSIV",201,0)
 .S UNIT=$P(RATEV," ",4)
"RTN","ORCDPSIV",202,0)
 .I TIME["." Q
"RTN","ORCDPSIV",203,0)
 .I UNIT="Hours" S TIME=TIME*60
"RTN","ORCDPSIV",204,0)
 .S ORDIALOG(RATEI,1)=TIME
"RTN","ORCDPSIV",205,0)
 Q
"RTN","ORCDPSIV",206,0)
 ;
"RTN","ORCDPSIV",207,0)
INF ; -- input transform for INFUSION RATE
"RTN","ORCDPSIV",208,0)
 N ALPHA,CNT,EXIT,FAIL,LDEC,RDEC,TEMP
"RTN","ORCDPSIV",209,0)
 I $G(ORIVTYPE)="I" D  Q
"RTN","ORCDPSIV",210,0)
 .I X["." W !,"Infuse Over Time must be a whole number." K X Q
"RTN","ORCDPSIV",211,0)
 .I $L(X)>4 W !,"Infuse Over Time cannot exceed 4 characters for minutes." K X Q
"RTN","ORCDPSIV",212,0)
 .S FAIL=0
"RTN","ORCDPSIV",213,0)
 .F CNT=1:1:$L(X) D  I FAIL=1 Q
"RTN","ORCDPSIV",214,0)
 ..I ($A($E(X,CNT))<48)!($A($E(X,CNT))>58) S FAIL=1
"RTN","ORCDPSIV",215,0)
 .I FAIL=1 W !,"Infuse Over Time must be a whole number." K X Q
"RTN","ORCDPSIV",216,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","ORCDPSIV",217,0)
 I $G(ORIVTYPE)="C" D  Q
"RTN","ORCDPSIV",218,0)
 .S TEMP=$E(X,($L(X)-5),$L(X))
"RTN","ORCDPSIV",219,0)
 .I X["@",$$UP^XLFSTR(TEMP)=" ML/HR" Q
"RTN","ORCDPSIV",220,0)
 .S ALPHA=0
"RTN","ORCDPSIV",221,0)
 .I X'["@",X'["." D  I ALPHA=1 K X Q
"RTN","ORCDPSIV",222,0)
 ..F CNT=1:1:$L(X) D  I ALPHA=1 Q
"RTN","ORCDPSIV",223,0)
 ...I ($A($E(X,CNT))<48)!($A($E(X,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",224,0)
 .S EXIT=0
"RTN","ORCDPSIV",225,0)
 .I X[".",X'["@" D  I EXIT=1 K X Q
"RTN","ORCDPSIV",226,0)
 ..S LDEC=$P(X,"."),RDEC=$P(X,".",2)
"RTN","ORCDPSIV",227,0)
 ..I LDEC="" W !,"Infusion Rate required a leading numeric value." S EXIT=1
"RTN","ORCDPSIV",228,0)
 ..I $L(RDEC)>1 W !,"Infusion Rate cannot exceed one decimal place." S EXIT=1
"RTN","ORCDPSIV",229,0)
 ..S ALPHA=0
"RTN","ORCDPSIV",230,0)
 ..F CNT=1:1:$L(LDEC) D  I ALPHA=1 S EXIT=1 Q
"RTN","ORCDPSIV",231,0)
 ...I ($A($E(LDEC,CNT))<48)!($A($E(LDEC,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",232,0)
 ..I $L(RDEC)=0 Q
"RTN","ORCDPSIV",233,0)
 ..F CNT=1:1:$L(RDEC) D  I ALPHA=1 S EXIT=1 Q
"RTN","ORCDPSIV",234,0)
 ...I ($A($E(RDEC,CNT))<48)!($A($E(RDEC,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",235,0)
 .D ORINF^PSIVSP Q
"RTN","ORCDPSIV",236,0)
 ; -- assume #minutes for now
"RTN","ORCDPSIV",237,0)
 K:(X'=+X)!(X<1)!(X>999) X ;range?
"RTN","ORCDPSIV",238,0)
 Q
"RTN","ORCDPSIV",239,0)
 ;
"RTN","ORCDPSIV",240,0)
VALIDAYS(X) ; -- Validate IV duration
"RTN","ORCDPSIV",241,0)
 N UNITS,X1,X2,Y,I
"RTN","ORCDPSIV",242,0)
 I X'?1.N." "1.A Q 0
"RTN","ORCDPSIV",243,0)
 S UNITS="^MIN^HOURS^DAYS^M^H^D^",(X1,X2)=""
"RTN","ORCDPSIV",244,0)
 F I=1:1:$L(X) S Y=$E(X,I) S:Y?1N X1=X1_Y S:Y?1A X2=X2_$$UP^XLFSTR(Y)
"RTN","ORCDPSIV",245,0)
 I 'X1 Q 0
"RTN","ORCDPSIV",246,0)
 I UNITS'[(U_X2_U) Q 0
"RTN","ORCDPSIV",247,0)
 Q 1
"RTN","ORCDPSIV",248,0)
 ;
"RTN","ORCDPSIV",249,0)
VALDURA(X) ;-- Validate IV duration/limitation
"RTN","ORCDPSIV",250,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","ORCDPSIV",251,0)
 ;
"RTN","ORCDPSIV",252,0)
IVPSI ;INPUT-TRANSFORM
"RTN","ORCDPSIV",253,0)
 I $L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) S X="" Q
"RTN","ORCDPSIV",254,0)
 I $L(X)>1,X[" " W !,"Spaces are not allow in the duration." K X Q
"RTN","ORCDPSIV",255,0)
 I $E(X)=0 W !,!,"Duration cannot start with a zero." K X Q
"RTN","ORCDPSIV",256,0)
 I X["." W !,!,"Invalid duration or total volume.",!,"Duration has to be integer value!" S X="" Q
"RTN","ORCDPSIV",257,0)
 S X=$$UP^XLFSTR(X)
"RTN","ORCDPSIV",258,0)
 I X["DOSES" D  Q
"RTN","ORCDPSIV",259,0)
 .I $G(ORIVTYPE)'="I" K X W !,"Continuous IV Orders cannot have DOSES as a duration." Q
"RTN","ORCDPSIV",260,0)
 .I +$P(X,"DOSES")<1,+$P(X,"DOSES")>200000 W !,"Invalid number of Doses.",! K X Q
"RTN","ORCDPSIV",261,0)
 I (X'?.N1.2A),(X'?.N1".".N1.2A) W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",262,0)
 I (X?.N1A) D
"RTN","ORCDPSIV",263,0)
 . I (X["L")!(X["H")!(X["D") Q
"RTN","ORCDPSIV",264,0)
 . E  W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",265,0)
 I (X?.N1".".N1A) D
"RTN","ORCDPSIV",266,0)
 . I X["L" Q
"RTN","ORCDPSIV",267,0)
 . E  W !,!,"Invalid duration or total volume.",!,"Duration has to be integer value!",! S X="" Q
"RTN","ORCDPSIV",268,0)
 I (X?.N2A)!(X?.N1".".N2A) D
"RTN","ORCDPSIV",269,0)
 . I (X["ML")!(X["CC") Q
"RTN","ORCDPSIV",270,0)
 . E  W !,!,"Invalid duration or total volume",! S X="" Q
"RTN","ORCDPSIV",271,0)
 I X="" K X
"RTN","ORCDPSIV",272,0)
 Q
"RTN","ORCDPSIV",273,0)
 ;
"RTN","ORCDPSIV",274,0)
IVPSI1 ; ASK ON CONDITION
"RTN","ORCDPSIV",275,0)
 N DURI,DURV,TEMPX
"RTN","ORCDPSIV",276,0)
 I $G(OROTSCH)=1 Q
"RTN","ORCDPSIV",277,0)
 S DURI=$P($G(ORDIALOG("B","LIMITATION")),U,2)
"RTN","ORCDPSIV",278,0)
 I DURI>0 S DURV=$G(ORDIALOG(DURI,1))
"RTN","ORCDPSIV",279,0)
 I $L(DURV)>1,$E(DURV)="f",DURV["doses" D
"RTN","ORCDPSIV",280,0)
 .S TEMPX=$P(DURV," ",5)_"DOSES"
"RTN","ORCDPSIV",281,0)
 .I TEMPX'="",TEMPX'=DURV S ORDIALOG(DURI,1)=TEMPX
"RTN","ORCDPSIV",282,0)
 N INT,IVTYPE,ONETIME,TYPE,SCH,SCHNAME
"RTN","ORCDPSIV",283,0)
 D IVDURT($G(ORIVTYPE))
"RTN","ORCDPSIV",284,0)
 ;I $G(ORIVTYPE)'="I" D  G IVPS1X
"RTN","ORCDPSIV",285,0)
 ;.W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours to set limitation."
"RTN","ORCDPSIV",286,0)
 ;.W !,"(Examples: 1500ML, 1000CC, 1L, 3D, or 72H)",!
"RTN","ORCDPSIV",287,0)
 ;W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",288,0)
 ;W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours or DOSES to set limitation."
"RTN","ORCDPSIV",289,0)
 ;W !,"(Examples: 1500ML, 1000CC, 1L, 3D, 72H, or 10DOSES)",!
"RTN","ORCDPSIV",290,0)
IVPS1X ;
"RTN","ORCDPSIV",291,0)
 ;W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",292,0)
 I 1
"RTN","ORCDPSIV",293,0)
 Q
"RTN","ORCDPSIV",294,0)
 ;
"RTN","ORCDPSIV",295,0)
IVDURT(TYPE) ;
"RTN","ORCDPSIV",296,0)
 I TYPE'="I" D  G IVDURX
"RTN","ORCDPSIV",297,0)
 .W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours to set limitation."
"RTN","ORCDPSIV",298,0)
 .W !,"(Examples: 1500ML, 1000CC, 1L, 3D, or 72H)",!
"RTN","ORCDPSIV",299,0)
 W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",300,0)
 W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours or DOSES to set limitation."
"RTN","ORCDPSIV",301,0)
 W !,"(Examples: 1500ML, 1000CC, 1L, 3D, 72H, or 10DOSES)",!
"RTN","ORCDPSIV",302,0)
IVDURX ;
"RTN","ORCDPSIV",303,0)
 W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",304,0)
 Q
"RTN","ORCDPSIV",305,0)
 ;
"RTN","ORCDPSIV",306,0)
IVDURH ;
"RTN","ORCDPSIV",307,0)
 D IVDURT($G(ORIVTYPE))
"RTN","ORCDPSIV",308,0)
 Q
"RTN","ORCDPSIV",309,0)
 ;
"VER")
8.0^22.2
"BLD",10407,6)
^387
**END**
**END**

