Released OR*3*471 SEQ #397
Extracted from mail message
**KIDS**:OR*3.0*471^

**INSTALL NAME**
OR*3.0*471
"BLD",10457,0)
OR*3.0*471^ORDER ENTRY/RESULTS REPORTING^0^3171018^y
"BLD",10457,1,0)
^^1^1^3171018^
"BLD",10457,1,1,0)
ORDER DETAILS, DRUG RESTRICTION, & RENEWED ORDER ISSUES
"BLD",10457,4,0)
^9.64PA^^
"BLD",10457,6.3)
2
"BLD",10457,"ABPKG")
n
"BLD",10457,"KRN",0)
^9.67PA^779.2^20
"BLD",10457,"KRN",.4,0)
.4
"BLD",10457,"KRN",.401,0)
.401
"BLD",10457,"KRN",.402,0)
.402
"BLD",10457,"KRN",.403,0)
.403
"BLD",10457,"KRN",.5,0)
.5
"BLD",10457,"KRN",.84,0)
.84
"BLD",10457,"KRN",3.6,0)
3.6
"BLD",10457,"KRN",3.8,0)
3.8
"BLD",10457,"KRN",9.2,0)
9.2
"BLD",10457,"KRN",9.8,0)
9.8
"BLD",10457,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10457,"KRN",9.8,"NM",1,0)
ORQ2^^0^B62428335
"BLD",10457,"KRN",9.8,"NM",2,0)
ORMFN^^0^B53240029
"BLD",10457,"KRN",9.8,"NM",3,0)
ORWORR^^0^B81663175
"BLD",10457,"KRN",9.8,"NM","B","ORMFN",2)

"BLD",10457,"KRN",9.8,"NM","B","ORQ2",1)

"BLD",10457,"KRN",9.8,"NM","B","ORWORR",3)

"BLD",10457,"KRN",19,0)
19
"BLD",10457,"KRN",19.1,0)
19.1
"BLD",10457,"KRN",101,0)
101
"BLD",10457,"KRN",409.61,0)
409.61
"BLD",10457,"KRN",771,0)
771
"BLD",10457,"KRN",779.2,0)
779.2
"BLD",10457,"KRN",870,0)
870
"BLD",10457,"KRN",8989.51,0)
8989.51
"BLD",10457,"KRN",8989.52,0)
8989.52
"BLD",10457,"KRN",8994,0)
8994
"BLD",10457,"KRN","B",.4,.4)

"BLD",10457,"KRN","B",.401,.401)

"BLD",10457,"KRN","B",.402,.402)

"BLD",10457,"KRN","B",.403,.403)

"BLD",10457,"KRN","B",.5,.5)

"BLD",10457,"KRN","B",.84,.84)

"BLD",10457,"KRN","B",3.6,3.6)

"BLD",10457,"KRN","B",3.8,3.8)

"BLD",10457,"KRN","B",9.2,9.2)

"BLD",10457,"KRN","B",9.8,9.8)

"BLD",10457,"KRN","B",19,19)

"BLD",10457,"KRN","B",19.1,19.1)

"BLD",10457,"KRN","B",101,101)

"BLD",10457,"KRN","B",409.61,409.61)

"BLD",10457,"KRN","B",771,771)

"BLD",10457,"KRN","B",779.2,779.2)

"BLD",10457,"KRN","B",870,870)

"BLD",10457,"KRN","B",8989.51,8989.51)

"BLD",10457,"KRN","B",8989.52,8989.52)

"BLD",10457,"KRN","B",8994,8994)

"BLD",10457,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10457,"QUES",0)
^9.62^^
"BLD",10457,"REQB",0)
^9.611^2^2
"BLD",10457,"REQB",1,0)
OR*3.0*350^1
"BLD",10457,"REQB",2,0)
OR*3.0*361^1
"BLD",10457,"REQB","B","OR*3.0*350",1)

"BLD",10457,"REQB","B","OR*3.0*361",2)

"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
471^3171018
"PKG",188,22,1,"PAH",1,1,0)
^^1^1^3171018
"PKG",188,22,1,"PAH",1,1,1,0)
ORDER DETAILS, DRUG RESTRICTION, & RENEWED ORDER ISSUES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORMFN")
0^2^B53240029^B42446020
"RTN","ORMFN",1,0)
ORMFN ; SLC/MKB - MFN msg router ; 05 Oct 2017  2:10 PM
"RTN","ORMFN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,97,94,176,215,243,280,350,471**;Dec 17, 1997;Build 2
"RTN","ORMFN",3,0)
 ;
"RTN","ORMFN",4,0)
 ;
"RTN","ORMFN",5,0)
 ;
"RTN","ORMFN",6,0)
EN(MSG) ; -- main entry point for OR ITEM RECEIVE
"RTN","ORMFN",7,0)
 N ORMSG,ORNMSP,ORDG,LEN,MSH,MFI,MFE,ZPKG,ZSY,NTE,ORMFE,ORDITEM,ORACTION,ORDIFN,ORFIEN,ORFLD,ORFDA,NUM,VALUE,X,Y,DA,DIC,DIK,SYS,ZLC,LAST,NAME,ID,INACTIVE,I,ORY,NEXT,DD,DO
"RTN","ORMFN",8,0)
 ;AGP Create a before and after temp global for compares by other protocols
"RTN","ORMFN",9,0)
 K ^TMP($J,"OR OI BEFORE"),^TMP($J,"OR OI AFTER"),^TMP($J,"OR OI NEW")
"RTN","ORMFN",10,0)
 S ORMSG=$G(MSG,"MSG") Q:'$O(@ORMSG@(0))  ; msg array root
"RTN","ORMFN",11,0)
 N ORNOW S ORNOW=$$NOW^XLFDT ;M ^XTMP("OR ITEM RECEIVE",ORNOW)=@ORMSG
"RTN","ORMFN",12,0)
MSH S MSH=0 F  S MSH=$O(@ORMSG@(MSH)) Q:MSH'>0  Q:$E(@ORMSG@(MSH),1,3)="MSH"
"RTN","ORMFN",13,0)
 Q:'MSH  S MSH=MSH_U_@ORMSG@(MSH)
"RTN","ORMFN",14,0)
 S X=$P(MSH,"|",3) S:X="RADIOLOGY" X="IMAGING"
"RTN","ORMFN",15,0)
 S ORDG=$O(^ORD(100.98,"B",X,0)),ORNMSP=$$NMSP(X) Q:'$L(ORNMSP)
"RTN","ORMFN",16,0)
 S MFI=$O(@ORMSG@(+MSH)) Q:$E(@ORMSG@(MFI),1,3)'="MFI"  ; error
"RTN","ORMFN",17,0)
MFE S MFE=+MFI ; ** loop through each MFE segment
"RTN","ORMFN",18,0)
 F  S MFE=$O(@ORMSG@(+MFE)) Q:MFE'>0  I $E(@ORMSG@(MFE),1,3)="MFE" D
"RTN","ORMFN",19,0)
 . K ORFLD,ORFDA
"RTN","ORMFN",20,0)
 . S MFE=MFE_U_@ORMSG@(MFE),ORMFE=$P(MFE,"|",2),INACTIVE=$P(MFE,"|",4)
"RTN","ORMFN",21,0)
 . S ORDITEM=$P(MFE,"|",5),NAME=$TR($P(ORDITEM,U,5),"~"," ")
"RTN","ORMFN",22,0)
 . ;AGP remove automatic stripping of trailing spaces
"RTN","ORMFN",23,0)
 . ;S LEN=$L(NAME) I $E(NAME,LEN)=" " S NAME=$E(NAME,1,(LEN-1))
"RTN","ORMFN",24,0)
 . S ID=$P(ORDITEM,U,4)_";"_$P(ORDITEM,U,6)
"RTN","ORMFN",25,0)
 . S ORDIFN=+$O(^ORD(101.43,"ID",ID,0)),ORFIEN=ORDIFN_","
"RTN","ORMFN",26,0)
 . S ORACTION=$S(ORMFE="MAD":1,(ORMFE="MAC")&('ORDIFN):1,(ORMFE="MUP")&('ORDIFN):1,'ORDIFN:0,ORMFE="MAC":2,ORMFE="MUP":2,ORMFE="MDC":3,ORMFE="MDL":3,1:0) ; 1=add, 2=change, 3=delete (inactivate)
"RTN","ORMFN",27,0)
 . Q:'ORACTION  ; 0=error
"RTN","ORMFN",28,0)
 . I ORACTION=3 S ORFDA(101.43,ORFIEN,.1)=$S(INACTIVE:$$HL7TFM^XLFDT(INACTIVE),1:$$NOW^XLFDT) D FILE^DIE("K","ORFDA") Q
"RTN","ORMFN",29,0)
ADD . I ORACTION=1,'ORDIFN D  Q:'ORDIFN  ;create item if it doesn't exist
"RTN","ORMFN",30,0)
 . . S ORDIFN=$$CREATE(NAME),ORFIEN=ORDIFN_","
"RTN","ORMFN",31,0)
 . . S ORFDA(101.43,ORFIEN,5)=+ORDG
"RTN","ORMFN",32,0)
 . . I ORDIFN>0 S ^TMP($J,"OR OI NEW",ORDIFN)=""
"RTN","ORMFN",33,0)
 . I '$D(^TMP($J,"OR OI NEW",ORDIFN)) M ^TMP($J,"OR OI BEFORE",ORDIFN)=^ORD(101.43,ORDIFN)
"RTN","ORMFN",34,0)
 . S ORFLD(.01)=NAME,ORFLD(1.1)=NAME,ORFLD(2)=ID,ORFLD(3)=$P(ORDITEM,U)
"RTN","ORMFN",35,0)
 . I $D(^TMP($J,"OR OI BEFORE",ORDIFN,9,"AQO")) D
"RTN","ORMFN",36,0)
 . . ;save orderable item quick order restriction
"RTN","ORMFN",37,0)
 . . M ^TMP($J,"ORCM QO",ORDIFN)=^TMP($J,"OR OI BEFORE",ORDIFN,9,"AQO")
"RTN","ORMFN",38,0)
 . S SYS=$P(ORDITEM,U,3),ORFLD(4)=$S(+SYS=99:$E(SYS,3,99),1:SYS)
"RTN","ORMFN",39,0)
 . S ORFLD(.1)=$S(ORMFE="MAC":"@",(ORMFE="MUP")&('INACTIVE):"@",INACTIVE:$$HL7TFM^XLFDT(INACTIVE),1:"")
"RTN","ORMFN",40,0)
 . F NUM=.01,.1,1.1,2,3,4 S VALUE=$S(ORFLD(NUM)="":"@",1:ORFLD(NUM)) D VAL^DIE(101.43,ORFIEN,NUM,"F",VALUE,.ORY,"ORFDA")
"RTN","ORMFN",41,0)
ZPKG . S LAST=+MFE,ZPKG=$O(@ORMSG@(+MFE))
"RTN","ORMFN",42,0)
 . I ZPKG,$E(@ORMSG@(ZPKG),1,3)=("Z"_ORNMSP) S ZPKG=ZPKG_U_@ORMSG@(ZPKG),LAST=+ZPKG D @ORNMSP ; ZXX segment
"RTN","ORMFN",43,0)
 . D FILE^DIE("K","ORFDA") ; file data
"RTN","ORMFN",44,0)
ZLC . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="ZLC" D
"RTN","ORMFN",45,0)
 . . N COMP,CID,CODE,CSYS
"RTN","ORMFN",46,0)
 . . K DA,^ORD(101.43,ORDIFN,10) ;S DIC("P")=$P(^DD(101.43,10,0),U,2)
"RTN","ORMFN",47,0)
 . . S DA(1)=ORDIFN,DIC="^ORD(101.43,"_DA(1)_",10,",DIC(0)="L",ZLC=LAST
"RTN","ORMFN",48,0)
 . . F  S ZLC=$O(@ORMSG@(ZLC)) Q:ZLC'>0  Q:$E(@ORMSG@(ZLC),1,3)'="ZLC"  D
"RTN","ORMFN",49,0)
 . . . S COMP=$P(@ORMSG@(ZLC),"|",5),X=$P(COMP,U,5) I X="" S LAST=ZLC Q
"RTN","ORMFN",50,0)
 . . . S CID=$P(COMP,U,4)_";"_$P(COMP,U,6) K DIC("DR"),DO,DD
"RTN","ORMFN",51,0)
 . . . S CODE=$P(COMP,U),CSYS=$P(COMP,U,3) S:+CSYS=99 CSYS=$E(CSYS,3,99)
"RTN","ORMFN",52,0)
 . . . S DIC("DR")="2///^S X=CID;3///^S X=CODE;4///^S X=CSYS"
"RTN","ORMFN",53,0)
 . . . D FILE^DICN S LAST=ZLC
"RTN","ORMFN",54,0)
ZSY . I $D(^ORD(101.43,ORDIFN,2)) D  ; kill old ones first
"RTN","ORMFN",55,0)
 . . S DA(1)=ORDIFN,DIK="^ORD(101.43,"_DA(1)_",2,"
"RTN","ORMFN",56,0)
 . . S DA=0 F  S DA=$O(^ORD(101.43,DA(1),2,DA)) Q:DA'>0  D ^DIK
"RTN","ORMFN",57,0)
 . . K ^ORD(101.43,ORDIFN,2),DIK,DA
"RTN","ORMFN",58,0)
 . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="ZSY" D
"RTN","ORMFN",59,0)
 . . K DA,DIC S DA(1)=ORDIFN,DIC="^ORD(101.43,"_DA(1)_",2,"
"RTN","ORMFN",60,0)
 . . S DIC(0)="L",ZSY=LAST ;,DIC("P")=$P(^DD(101.43,1,0),U,2)
"RTN","ORMFN",61,0)
 . . F  S ZSY=$O(@ORMSG@(+ZSY)) Q:ZSY'>0  Q:$E(@ORMSG@(ZSY),1,3)'="ZSY"  D
"RTN","ORMFN",62,0)
 . . . S X=$P(@ORMSG@(ZSY),"|",3),LAST=ZSY
"RTN","ORMFN",63,0)
 . . . K DD,DO D:$L(X) FILE^DICN
"RTN","ORMFN",64,0)
NTE . K ^ORD(101.43,ORDIFN,8) ; replace text
"RTN","ORMFN",65,0)
 . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="NTE" D
"RTN","ORMFN",66,0)
 . . S NTE=LAST,DA=0
"RTN","ORMFN",67,0)
 . . F  S NTE=$O(@ORMSG@(NTE)) Q:NTE'>0  Q:$E(@ORMSG@(NTE),1,3)'="NTE"  S DA=DA+1,^ORD(101.43,ORDIFN,8,DA,0)=$P(@ORMSG@(NTE),"|",4) I $O(@ORMSG@(NTE,0)) D
"RTN","ORMFN",68,0)
 . . . S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S DA=DA+1,^ORD(101.43,ORDIFN,8,DA,0)=@ORMSG@(NTE,I)
"RTN","ORMFN",69,0)
 . . S ^ORD(101.43,ORDIFN,8,0)="^^"_DA_U_DA_U_DT_U
"RTN","ORMFN",70,0)
 . I '$D(^TMP($J,"OR OI NEW",ORDIFN)) M ^TMP($J,"OR OI AFTER",ORDIFN)=^ORD(101.43,ORDIFN)
"RTN","ORMFN",71,0)
 . ;
"RTN","ORMFN",72,0)
 . ;if orderable item quick order restriction previously on orderable item, replace it
"RTN","ORMFN",73,0)
 . ;
"RTN","ORMFN",74,0)
 . ;QO section is called repeatedly for IV entries
"RTN","ORMFN",75,0)
 . ;Future FileMan calls after this error out for an unknown reason
"RTN","ORMFN",76,0)
 . ;even though variables are new'd
"RTN","ORMFN",77,0)
 . ;At final call to this section, DIR(0) does not contain "ADDITIVES".
"RTN","ORMFN",78,0)
 . ;
"RTN","ORMFN",79,0)
 . I $D(^TMP($J,"ORCM QO",ORDIFN)),$G(DIR(0))'["ADDITIVES" D QO
"RTN","ORMFN",80,0)
 Q
"RTN","ORMFN",81,0)
 ;
"RTN","ORMFN",82,0)
QO ;replace quick order restriction(s)
"RTN","ORMFN",83,0)
 N ORGRPX,DA,DIR,DIE,DR
"RTN","ORMFN",84,0)
 S ORGRPX=""
"RTN","ORMFN",85,0)
 F  S ORGRPX=$O(^TMP($J,"ORCM QO",ORDIFN,ORGRPX)) Q:ORGRPX=""  D
"RTN","ORMFN",86,0)
 . Q:$D(^ORD(101.43,ORDIFN,9,"AQO",ORGRPX))
"RTN","ORMFN",87,0)
 . S DA=$P(ORGRPX,"S.",2),DA=$O(^ORD(101.43,ORDIFN,9,"B",DA,0))
"RTN","ORMFN",88,0)
 . Q:DA=""
"RTN","ORMFN",89,0)
 . S DA(1)=ORDIFN
"RTN","ORMFN",90,0)
 . S DR="2///YES",DIE="^ORD(101.43,"_DA(1)_",9,"
"RTN","ORMFN",91,0)
 . D ^DIE
"RTN","ORMFN",92,0)
 K ^TMP($J,"ORCM QO",ORDIFN)
"RTN","ORMFN",93,0)
 Q 
"RTN","ORMFN",94,0)
 ;
"RTN","ORMFN",95,0)
NMSP(NAME) ; -- returns namespace for package
"RTN","ORMFN",96,0)
 I NAME="RADIOLOGY" Q "RA"
"RTN","ORMFN",97,0)
 I NAME="IMAGING" Q "RA"
"RTN","ORMFN",98,0)
 I NAME="LABORATORY" Q "LR"
"RTN","ORMFN",99,0)
 I NAME="DIETETICS" Q "FH"
"RTN","ORMFN",100,0)
 I NAME="PHARMACY" Q "PS"
"RTN","ORMFN",101,0)
 I NAME="CONSULTS" Q "CS"
"RTN","ORMFN",102,0)
 I NAME="PROCEDURES" Q "CS"
"RTN","ORMFN",103,0)
 Q ""
"RTN","ORMFN",104,0)
 ;
"RTN","ORMFN",105,0)
CREATE(X) ; -- Create new item in #101.43
"RTN","ORMFN",106,0)
 Q:'$L($G(X)) 0 N HDR,LAST,TOTAL,I
"RTN","ORMFN",107,0)
 L +^ORD(101.43,0):1 Q:'$T 0
"RTN","ORMFN",108,0)
 S HDR=$G(^ORD(101.43,0)) Q:HDR="" 0
"RTN","ORMFN",109,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","ORMFN",110,0)
 F I=(LAST+1):1 Q:'$D(^ORD(101.43,I,0))
"RTN","ORMFN",111,0)
 S ^ORD(101.43,I,0)=X,X=$E(X,1,30),^ORD(101.43,"B",$$UP^XLFSTR(X),I)=""
"RTN","ORMFN",112,0)
 S $P(^ORD(101.43,0),U,3,4)=I_U_(TOTAL+1)
"RTN","ORMFN",113,0)
 L -^ORD(101.43,0)
"RTN","ORMFN",114,0)
 Q I
"RTN","ORMFN",115,0)
 ;
"RTN","ORMFN",116,0)
FH ; -- Dietetics
"RTN","ORMFN",117,0)
 S X=$P(ZPKG,"|",2),ORFLD(111.1)=$S(X="":"@",1:X)
"RTN","ORMFN",118,0)
 S X=$P(ZPKG,"|",3),ORFLD(111.2)=$S(X="":"@",1:X)
"RTN","ORMFN",119,0)
 S X=$P(ZPKG,"|",5),ORFLD(111.3)=$S(X="":"@",1:X)
"RTN","ORMFN",120,0)
 F NUM=111.1,111.2,111.3 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",121,0)
 K ^ORD(101.43,ORDIFN,8) S X=$P(ZPKG,"|",4)
"RTN","ORMFN",122,0)
 I $L(X) S ^ORD(101.43,ORDIFN,8,0)="^^1^1^"_DT_U,^(1,0)=X
"RTN","ORMFN",123,0)
 Q
"RTN","ORMFN",124,0)
 ;
"RTN","ORMFN",125,0)
LR ; -- Laboratory
"RTN","ORMFN",126,0)
 S X=$P(ZPKG,"|",2),ORFLD(60.1)=$S(X="":"@",1:X)
"RTN","ORMFN",127,0)
 S X=$P(ZPKG,"|",3),ORFLD(60.2)=$S(X="":"@",1:X)
"RTN","ORMFN",128,0)
 ;S X=$P(ZPKG,"|",4),ORFLD(60.3)=$S(X="":"@",1:X)
"RTN","ORMFN",129,0)
 S X=$P(ZPKG,"|",5),ORFLD(60.6)=$S(X="":"@",1:X)
"RTN","ORMFN",130,0)
 S X=$P(ZPKG,"|",6),ORFLD(60.4)=$S(X="":"@",1:X)
"RTN","ORMFN",131,0)
 S X=$P(ZPKG,"|",7),ORFLD(60.5)=$S(X="":"@",1:X)
"RTN","ORMFN",132,0)
 S X=$P(ZPKG,"|",8),ORFLD(6)=$S(X="":"@",1:X)
"RTN","ORMFN",133,0)
 S X=$P(ZPKG,"|",9),ORFLD(60.7)=$S(X="":"@",1:X)
"RTN","ORMFN",134,0)
 F NUM=6,60.1,60.2,60.4,60.5,60.6,60.7 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",135,0)
 Q
"RTN","ORMFN",136,0)
 ;
"RTN","ORMFN",137,0)
PS ; -- Pharmacy
"RTN","ORMFN",138,0)
 N ROUTE,PSO,S3,ORPSVAC,ORPSOI
"RTN","ORMFN",139,0)
 K ^TMP("$J","ORMFN")
"RTN","ORMFN",140,0)
 S X=$P(ZPKG,"|",2)
"RTN","ORMFN",141,0)
 ;S ORFDA(101.43,ORFIEN,50.1)=$S(X'["I":0,$L($P($P(ORDITEM,U,5),"~",3)):2,1:1)
"RTN","ORMFN",142,0)
 S ORFDA(101.43,ORFIEN,50.1)=$S(X["V":2,X["I":1,1:0) ;inpt or iv med
"RTN","ORMFN",143,0)
 S ORFDA(101.43,ORFIEN,50.2)=(X["O") ;outpt med
"RTN","ORMFN",144,0)
 S ORFDA(101.43,ORFIEN,50.3)=(X["B") ;fluid base/soln
"RTN","ORMFN",145,0)
 S ORFDA(101.43,ORFIEN,50.4)=(X["A") ;fluid additive
"RTN","ORMFN",146,0)
 S ORFDA(101.43,ORFIEN,50.7)=(X["N") ;non-VA med
"RTN","ORMFN",147,0)
 ;Supply Items
"RTN","ORMFN",148,0)
 D
"RTN","ORMFN",149,0)
 . S ORPSOI=+$P($P(MFE,"|",5),"^",4) D DRGIEN^PSS50P7(ORPSOI,"","ORMFN")
"RTN","ORMFN",150,0)
 . I ^TMP($J,"ORMFN",0)'>0 Q
"RTN","ORMFN",151,0)
 . S S3=0,ORFDA(101.43,ORFIEN,50.5)=0
"RTN","ORMFN",152,0)
 . F  S S3=$O(^TMP($J,"ORMFN",S3)) Q:'S3  D
"RTN","ORMFN",153,0)
 .. D ZERO^PSS50(S3,,,,,"ORMFN")
"RTN","ORMFN",154,0)
 .. I ^TMP($J,"ORMFN",0)'>0 Q
"RTN","ORMFN",155,0)
 .. S ORPSVAC=$G(^TMP($J,"ORMFN",S3,2))
"RTN","ORMFN",156,0)
 .. I ORPSVAC?1"XA".E!(ORPSVAC?1"XX".E)!(ORPSVAC="DX900"&($G(^TMP($J,"ORMFN",S3,3))["S")) S ORFDA(101.43,ORFIEN,50.5)=1
"RTN","ORMFN",157,0)
 S X=$P(ZPKG,"|",3),ORFDA(101.43,ORFIEN,50.6)=$S(X:1,1:0)
"RTN","ORMFN",158,0)
 ;Check for default med route
"RTN","ORMFN",159,0)
 ;S ROUTE=$$MEDROUTE
"RTN","ORMFN",160,0)
 ;I ROUTE>0 S ORFDA(101.43,ORFIEN,50.8)=ROUTE
"RTN","ORMFN",161,0)
 Q
"RTN","ORMFN",162,0)
 ;
"RTN","ORMFN",163,0)
MEDROUTE() ;
"RTN","ORMFN",164,0)
 N CNT,ROUTE
"RTN","ORMFN",165,0)
 S CNT=0,ROUTE=0
"RTN","ORMFN",166,0)
 F  S CNT=$O(@ORMSG@(CNT)) Q:CNT'>0  D
"RTN","ORMFN",167,0)
 .I $P($G(@ORMSG@(CNT)),"|")'="ZPB" Q
"RTN","ORMFN",168,0)
 .S ROUTE=+$P($G(@ORMSG@(CNT)),"|",4)
"RTN","ORMFN",169,0)
 Q ROUTE
"RTN","ORMFN",170,0)
 ;
"RTN","ORMFN",171,0)
RA ; -- Radiology/Nuc Medicine
"RTN","ORMFN",172,0)
 S X=$P(ZPKG,"|",4),ORFLD(6)=$S(X="":"@",1:X)
"RTN","ORMFN",173,0)
 S X=$P(ZPKG,"|",5),ORFLD(71.1)=$S(X="":"@",1:X)
"RTN","ORMFN",174,0)
 S X=$P(ZPKG,"|",7),ORFLD(71.2)=$S(X="":"@",1:X)
"RTN","ORMFN",175,0)
 S X=$P(ZPKG,"|",2),ORFLD(71.3)=$S(X="":"@",1:X)
"RTN","ORMFN",176,0)
 S ORFLD(71.4)=$S($P(ZPKG,"|",6)="Y":1,1:0)
"RTN","ORMFN",177,0)
 S ORFLD(7)=$S($P(ZPKG,"|",3)="Y":2,1:1)
"RTN","ORMFN",178,0)
 F NUM=6,7,71.1,71.2,71.3,71.4 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",179,0)
 Q
"RTN","ORMFN",180,0)
 ;
"RTN","ORMFN",181,0)
CS ; -- Consults/Requests
"RTN","ORMFN",182,0)
 S X=$P(ZPKG,"|",2),ORFLD(123.1)=$S(X="":"@",1:X)
"RTN","ORMFN",183,0)
 D VAL^DIE(101.43,ORFIEN,123.1,"F",ORFLD(123.1),.ORY,"ORFDA")
"RTN","ORMFN",184,0)
 Q
"RTN","ORQ2")
0^1^B62428335^B60457146
"RTN","ORQ2",1,0)
ORQ2 ; SLC/MKB/GSS - Detailed Order Report ;10/21/13  07:06
"RTN","ORQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,56,75,94,141,213,195,243,282,293,280,346,361,471**;Dec 17, 1997;Build 2
"RTN","ORQ2",3,0)
 ;
"RTN","ORQ2",4,0)
 ;
"RTN","ORQ2",5,0)
 ;Reference to ^DIC(45.7 supported by IA #519
"RTN","ORQ2",6,0)
 ;Reference to OERR^VADPT supported by IA #4325
"RTN","ORQ2",7,0)
 ;Reference to CODECS^ICDEX supported by ICR #5747
"RTN","ORQ2",8,0)
 ;
"RTN","ORQ2",9,0)
DETAIL(ORY,ORIFN) ; -- Returns details of order ORIFN in ORY(#)
"RTN","ORQ2",10,0)
 N X,X2,I,CNT,ORDIALOG,OR0,OR3,OR6,SEQ,ITEM,PRMT,MULT,FIRST,TITLE,INST,DIWL,DIWR,DIWF,ACTION,VAIN,ORIGVIEW,ORNMSP,ORYT,ORCRACT
"RTN","ORQ2",11,0)
 ; p 471 added ORCACT to use action if passed in
"RTN","ORQ2",12,0)
 S CNT=0,ORCRACT=+$P(ORIFN,";",2),ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORQ2",13,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORQ2",14,0)
 ; p 471 if no action, default to CURRENT ACTION..or if not $O(<The action subfile>, -1)
"RTN","ORQ2",15,0)
 S:'ORCRACT ORCRACT=$S(+$P(OR3,U,7):+$P(OR3,U,7),1:+$O(^OR(100,ORIFN,8,":"),-1))
"RTN","ORQ2",16,0)
 K @ORY,ORYT S ORIGVIEW=1 D TEXT^ORQ12(.ORYT,+ORIFN_";"_ORCRACT,80) ;CurrTx
"RTN","ORQ2",17,0)
 M @ORY=ORYT ;Move text to global
"RTN","ORQ2",18,0)
 S I=0 F CNT=1:1 S I=$O(ORYT(I)) Q:I'>0  D:$D(IORVON) SETVIDEO(I,1,$L(ORYT(I)),IORVON,IORVOFF)
"RTN","ORQ2",19,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",20,0)
D1 I $O(^OR(100,+ORIFN,2,0)) D
"RTN","ORQ2",21,0)
 . S CNT=CNT+1,@ORY@(CNT)="Sub Orders:"
"RTN","ORQ2",22,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,11,IOUON,IOUOFF)
"RTN","ORQ2",23,0)
 . N IFN S IFN=0
"RTN","ORQ2",24,0)
 . F  S IFN=+$O(^OR(100,+ORIFN,2,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)) D SUB(IFN)
"RTN","ORQ2",25,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",26,0)
 I $P(OR3,U,9),$D(^OR(100,+$P(OR3,U,9),0)) D
"RTN","ORQ2",27,0)
 . S CNT=CNT+1,@ORY@(CNT)="Parent Order:"
"RTN","ORQ2",28,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,12,IOUON,IOUOFF)
"RTN","ORQ2",29,0)
 . D SUB(+$P(OR3,U,9))
"RTN","ORQ2",30,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",31,0)
 I $P(OR3,U,11)=1,$P(OR3,U,5) D  ;Changed - show previous order
"RTN","ORQ2",32,0)
 . S CNT=CNT+1,@ORY@(CNT)="Previous Order:"
"RTN","ORQ2",33,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,15,IOUON,IOUOFF) ;prev order original text
"RTN","ORQ2",34,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,+$P(OR3,U,5),55)
"RTN","ORQ2",35,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ2",36,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ2",37,0)
D2 S CNT=CNT+1,@ORY@(CNT)="Activity:"
"RTN","ORQ2",38,0)
 D:$D(IOUON) SETVIDEO(CNT,1,9,IOUON,IOUOFF)
"RTN","ORQ2",39,0)
 S DIWL=1,DIWR=64,DIWF="C64",ORI=0 K ^UTILITY($J,"W")
"RTN","ORQ2",40,0)
 F  S ORI=$O(^OR(100,ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORQ2",41,0)
 I "^1^12^13^"[(U_$P(OR3,U,3)_U),$L(OR6),$P(ACTION,U,2)'="DC" D DC^ORQ20
"RTN","ORQ2",42,0)
 I $P(OR3,U,3)=2,$P(OR6,U,6) S CNT=CNT+1,@ORY@(CNT)=$$DATE^ORQ20($P(OR6,U,6))_"  Completed"_$S($P(OR6,U,7):" by "_$$USER^ORQ20($P(OR6,U,7)),1:"")
"RTN","ORQ2",43,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",44,0)
D3 S CNT=CNT+1,@ORY@(CNT)="Current Data:"
"RTN","ORQ2",45,0)
 D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",46,0)
 D VA I $G(VAIN(2)) S CNT=CNT+1,@ORY@(CNT)="Current Primary Provider:     "_$P(VAIN(2),"^",2)
"RTN","ORQ2",47,0)
 I $G(VAIN(11)) S CNT=CNT+1,@ORY@(CNT)="Current Attending Physician:  "_$P(VAIN(11),"^",2)
"RTN","ORQ2",48,0)
 S CNT=CNT+1,@ORY@(CNT)="Treating Specialty:           "_$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U)
"RTN","ORQ2",49,0)
 S CNT=CNT+1,@ORY@(CNT)="Ordering Location:            "_$P($G(^SC(+$P(OR0,U,10),0)),U)
"RTN","ORQ2",50,0)
 S CNT=CNT+1,@ORY@(CNT)="Start Date/Time:              "_$S($P(OR0,U,8):$$DATE^ORQ20($P(OR0,U,8)),1:"")
"RTN","ORQ2",51,0)
 I $P(OR3,U,5),$P(OR3,U,11)=2 S X=$$ORIG(ORIFN),@ORY@(CNT)=@ORY@(CNT)_" (originally "_$$DATE^ORQ20(X)_")"
"RTN","ORQ2",52,0)
 S CNT=CNT+1,@ORY@(CNT)="Stop Date/Time:               "_$S($P(OR0,U,9):$$DATE^ORQ20($P(OR0,U,9)),1:"")
"RTN","ORQ2",53,0)
 I $P(OR3,U,3)=1,$P(OR6,U,6) S @ORY@(CNT)=@ORY@(CNT)_"  (expired "_$$DATE^ORQ20($P(OR6,U,6))_")"
"RTN","ORQ2",54,0)
 S CNT=CNT+1,@ORY@(CNT)="Current Status:               "_$S($D(^ORD(100.01,+$P(OR3,U,3),0)):$P(^(0),"^"),1:"-")
"RTN","ORQ2",55,0)
 I $$GET^XPAR("ALL","ORPF SHOW STATUS DESCRIPTION",1,"I"),$P(OR3,U,3),$D(^ORD(100.01,$P(OR3,U,3),0)) N J S J=0 F  S J=$O(^ORD(100.01,$P(OR3,U,3),1,J)) Q:J<1  S CNT=CNT+1,@ORY@(CNT)="  "_^(J,0)
"RTN","ORQ2",56,0)
 S CNT=CNT+1,@ORY@(CNT)="Order #"_ORIFN
"RTN","ORQ2",57,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",58,0)
D4 S CNT=CNT+1,@ORY@(CNT)="Order:" D:$D(IOUON) SETVIDEO(CNT,1,6,IOUON,IOUOFF)
"RTN","ORQ2",59,0)
 I '$O(^OR(100,ORIFN,4.5,0)),ORNMSP="RA" D RAD^ORQ21("") Q
"RTN","ORQ2",60,0)
 S ORDIALOG=$P(OR0,U,5) Q:$P(ORDIALOG,";",2)="ORD(101,"  ; 2.5 order
"RTN","ORQ2",61,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD(ORIFN)
"RTN","ORQ2",62,0)
 I ORNMSP="GMRC" D GMRCXTRA
"RTN","ORQ2",63,0)
 S DIWL=1,DIWR=50,DIWF="C50"
"RTN","ORQ2",64,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORQ2",65,0)
 . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(ITEM,U,11)  ; child
"RTN","ORQ2",66,0)
 . S PRMT=$P(ITEM,U,2),MULT=$P(ITEM,U,7) Q:$P(ITEM,U,9)["*"  ;hide
"RTN","ORQ2",67,0)
 . S FIRST=$O(ORDIALOG(PRMT,0)) Q:'FIRST  ; no values
"RTN","ORQ2",68,0)
 . S TITLE=$S(MULT&$L($G(ORDIALOG(PRMT,"TTL"))):ORDIALOG(PRMT,"TTL"),1:ORDIALOG(PRMT,"A"))
"RTN","ORQ2",69,0)
 . S TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",70,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:INST'>0  D
"RTN","ORQ2",71,0)
 . . I $E(ORDIALOG(PRMT,0))="W" D WP Q
"RTN","ORQ2",72,0)
 . . K ^UTILITY($J,"W") S X=$$EXT^ORCD(PRMT,INST) I TITLE["Infusion Rate"&(X'="")&(X'["ml/hr") S TITLE="Infuse Over Time:",TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",73,0)
 . . D ^DIWP
"RTN","ORQ2",74,0)
 . . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PRMT)) CHILDREN(PRMT)
"RTN","ORQ2",75,0)
 . . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$S((INST=FIRST)&(I=1):TITLE,1:$$REPEAT^XLFSTR(" ",30))_^(I,0)
"RTN","ORQ2",76,0)
 I ORNMSP="GMRC",$G(^OR(100,ORIFN,4)) S CNT=CNT+1,@ORY@(CNT)="Consult No.:                  "_+^(4)
"RTN","ORQ2",77,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",78,0)
 D RAD^ORQ21(1):ORNMSP="RA",MED^ORQ21:ORNMSP="PS" ;add'l data
"RTN","ORQ2",79,0)
 D BA^ORQ21 ;call for CIDC data
"RTN","ORQ2",80,0)
D5 K ^TMP($J,"OCDATA") I $$OCAPI^ORCHECK(+ORIFN,"OCDATA") D
"RTN","ORQ2",81,0)
 . N CK,OK,X0,X,CDL,I S CNT=CNT+1,@ORY@(CNT)="Order Checks:"
"RTN","ORQ2",82,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",83,0)
 . S CK=0 F  S CK=$O(^TMP($J,"OCDATA",CK)) Q:CK'>0  D
"RTN","ORQ2",84,0)
 .. S X0=^TMP($J,"OCDATA",CK,"OC NUMBER")_U_^TMP($J,"OCDATA",CK,"OC LEVEL")_U_U_^TMP($J,"OCDATA",CK,"OR REASON")_U_^TMP($J,"OCDATA",CK,"OR PROVIDER")_U_^TMP($J,"OCDATA",CK,"OR DT")
"RTN","ORQ2",85,0)
 .. S X=^TMP($J,"OCDATA",CK,"OC TEXT",1,0)
"RTN","ORQ2",86,0)
 .. S CDL=$$CDL($P(X0,U,2)) I $P(X0,U,6),'$D(OK) S OK=$P(X0,U,4,6)
"RTN","ORQ2",87,0)
 .. I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X D XTRA Q
"RTN","ORQ2",88,0)
 .. S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",89,0)
 .. S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="            "
"RTN","ORQ2",90,0)
 .. D XTRA
"RTN","ORQ2",91,0)
 . K ^TMP($J,"OCDATA")
"RTN","ORQ2",92,0)
 . Q:'$L($G(OK))  S CNT=CNT+1,@ORY@(CNT)="Override:   "_$S($P(OK,U,2):$$USER^ORQ20($P(OK,U,2))_" on ",1:"")_$$DATE^ORQ20($P(OK,U,3))
"RTN","ORQ2",93,0)
 . I $L($P(OK,U))'>68 S CNT=CNT+1,@ORY@(CNT)="            "_$P(OK,U) Q
"RTN","ORQ2",94,0)
 . S DIWL=1,DIWR=68,DIWF="C68",X=$P(OK,U) K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",95,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="            "_^(I,0)
"RTN","ORQ2",96,0)
 K ^TMP("ORWORD",$J),^UTILITY($J,"W")
"RTN","ORQ2",97,0)
 Q
"RTN","ORQ2",98,0)
 ;
"RTN","ORQ2",99,0)
XTRA ;
"RTN","ORQ2",100,0)
 I $O(^TMP($J,"OCDATA",CK,"OC TEXT",1)) N ORXT S ORXT=1 F  S ORXT=$O(^TMP($J,"OCDATA",CK,"OC TEXT",ORXT)) Q:'ORXT  D
"RTN","ORQ2",101,0)
 . S X=^TMP($J,"OCDATA",CK,"OC TEXT",ORXT,0),CDL="              "
"RTN","ORQ2",102,0)
 . I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X Q
"RTN","ORQ2",103,0)
 . S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",104,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="              "
"RTN","ORQ2",105,0)
 I $O(^TMP($J,"OCDATA",CK,"OC TEXT",1)) S X="",CNT=CNT+1,@ORY@(CNT)="              "
"RTN","ORQ2",106,0)
 Q
"RTN","ORQ2",107,0)
 ;
"RTN","ORQ2",108,0)
SUB(IFN) ; -- add suborder or parent
"RTN","ORQ2",109,0)
 N ORCY,STS,STRT,IG,A,STOP,SCHED D TEXT^ORQ12(.ORCY,IFN,58)
"RTN","ORQ2",110,0)
 S STS=$G(^ORD(100.01,+$P($G(^OR(100,IFN,3)),U,3),.1))
"RTN","ORQ2",111,0)
 S A=^OR(100,IFN,0),STRT=$P(A,U,8),STOP=$P(A,U,9)
"RTN","ORQ2",112,0)
 S SCHED=$$VALUE^ORX8(IFN,"SCHEDULE",1,"E")
"RTN","ORQ2",113,0)
 S:STRT'="" STRT=$$DATE^ORQ20(STRT) I ORNMSP="LR" S:STOP]"" STOP=$$DATE^ORQ20(STOP)
"RTN","ORQ2",114,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S CNT=CNT+1,@ORY@(CNT)=$J(STS,4)_" "_ORCY(IG)_" "_STRT,(STS,STRT)=" "
"RTN","ORQ2",115,0)
 I ORNMSP="LR",STOP]"" S CNT=CNT+1,@ORY@(CNT)=$J("How often: ",16)_SCHED_"   Stops:  "_STOP
"RTN","ORQ2",116,0)
 Q
"RTN","ORQ2",117,0)
 ;
"RTN","ORQ2",118,0)
WP ; -- add word-processing
"RTN","ORQ2",119,0)
 N WP,ORI,X M WP=@ORDIALOG(PRMT,INST)
"RTN","ORQ2",120,0)
 S CNT=CNT+1,@ORY@(CNT)=TITLE
"RTN","ORQ2",121,0)
 S ORI=0 F  S ORI=$O(WP(ORI)) Q:ORI'>0  S X=WP(ORI,0) S:X'="" CNT=CNT+1,@ORY@(CNT)="  "_X
"RTN","ORQ2",122,0)
 Q
"RTN","ORQ2",123,0)
 ;
"RTN","ORQ2",124,0)
CHILDREN(PARENT) ; -- add children
"RTN","ORQ2",125,0)
 N SEQ,DA,ITM,PRMT,TYPE,X
"RTN","ORQ2",126,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORQ2",127,0)
 . S ITM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITM,U,2)
"RTN","ORQ2",128,0)
 . Q:$G(ORDIALOG(PRMT,INST))=""  Q:$P(ITM,U,9)["*"  ;no value or hide
"RTN","ORQ2",129,0)
 . S TYPE=$E(ORDIALOG(PRMT,0)) D:TYPE="W" WP
"RTN","ORQ2",130,0)
 . I TYPE'="W" D
"RTN","ORQ2",131,0)
 . . S X=$$EXT^ORCD(PRMT,INST)
"RTN","ORQ2",132,0)
 . . I $L(X,"|")=2 S X=$$REPLACE^ORHLESC(X,"|","||")
"RTN","ORQ2",133,0)
 . . D ^DIWP
"RTN","ORQ2",134,0)
 Q
"RTN","ORQ2",135,0)
 ;
"RTN","ORQ2",136,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORQ2",137,0)
 S ORY("VIDEO",LINE,COL,WIDTH)=ON
"RTN","ORQ2",138,0)
 S ORY("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORQ2",139,0)
 Q
"RTN","ORQ2",140,0)
 ;
"RTN","ORQ2",141,0)
VA ; -- Call VADPT
"RTN","ORQ2",142,0)
 N ORY,DFN,Y S DFN=+$P(OR0,"^",2) D OERR^VADPT
"RTN","ORQ2",143,0)
 Q
"RTN","ORQ2",144,0)
 ;
"RTN","ORQ2",145,0)
CDL(X) ; -- Returns Clinical Danger Level X
"RTN","ORQ2",146,0)
 N Y S Y=$S(X=1:"HIGH:",X=2:"MODERATE:",X=3:"LOW:",1:"NONE:")
"RTN","ORQ2",147,0)
 S Y=$E(Y_"        ",1,12)
"RTN","ORQ2",148,0)
 Q Y
"RTN","ORQ2",149,0)
 ;
"RTN","ORQ2",150,0)
ORIG(IFN) ; -- Return original start date of [renewal] order
"RTN","ORQ2",151,0)
 N I,Y,X3,DONE
"RTN","ORQ2",152,0)
 S I=IFN,Y=$P($G(^OR(100,IFN,0)),U,8),DONE=0
"RTN","ORQ2",153,0)
 F  S X3=$G(^OR(100,I,3)) D  Q:DONE
"RTN","ORQ2",154,0)
 . I $P(X3,U,11)=2,$P(X3,U,5) S I=$P(X3,U,5) Q  ;loop
"RTN","ORQ2",155,0)
 . S Y=$P($G(^OR(100,I,0)),U,8),DONE=1
"RTN","ORQ2",156,0)
 Q Y
"RTN","ORQ2",157,0)
GMRCXTRA ; expects ORDIALOG to be populated and ORIFN to be present
"RTN","ORQ2",158,0)
 N ORGMROUT,ORDGDA,ORGMRICD,ORCODE,ORISCODE,ORCODSYS
"RTN","ORQ2",159,0)
 I '$G(^OR(100,ORIFN,4)) D
"RTN","ORQ2",160,0)
 . S ORISCODE=ORDIALOG("B","CODE"),ORISCODE=$P(ORISCODE,U,2)
"RTN","ORQ2",161,0)
  . I +$G(ORISCODE)>0 D
"RTN","ORQ2",162,0)
  .. Q:'$D(ORDIALOG(ORISCODE,1))
"RTN","ORQ2",163,0)
  .. S ORCODE=ORDIALOG(ORISCODE,1)
"RTN","ORQ2",164,0)
  .. S ORCODSYS=$$CODECS^ICDEX(ORCODE,"80")
"RTN","ORQ2",165,0)
  .. S ORGMROUT=$P($G(ORCODSYS),U,2)
"RTN","ORQ2",166,0)
 I $G(^OR(100,ORIFN,4)) D
"RTN","ORQ2",167,0)
 . S ORGMROUT="ICD-9-CM"
"RTN","ORQ2",168,0)
 . Q:'$D(^GMR(123,+^OR(100,+ORIFN,4),30.1))
"RTN","ORQ2",169,0)
 . S ORGMRICD=^GMR(123,+^OR(100,+ORIFN,4),30.1)
"RTN","ORQ2",170,0)
 . I $P(ORGMRICD,U,3)="10D" S ORGMROUT="ICD-10-CM"
"RTN","ORQ2",171,0)
 S ORDGDA=$G(ORDIALOG("B","CODE"))
"RTN","ORQ2",172,0)
 Q:'$P(ORDGDA,U,2)
"RTN","ORQ2",173,0)
 S ORDGDA=$P(ORDGDA,U,2)
"RTN","ORQ2",174,0)
 Q:'$D(ORDIALOG(ORDGDA,1))
"RTN","ORQ2",175,0)
 S ORDIALOG(ORDGDA,1)="("_ORGMROUT_" "_ORDIALOG(ORDGDA,1)_")"
"RTN","ORQ2",176,0)
 Q
"RTN","ORWORR")
0^3^B81663175^B76813647
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ; 10/17/17 10:42am
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141,163,189,195,215,243,280,306,471**;Dec 17, 1997;Build 2
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
 ;DBIA/ICR section
"RTN","ORWORR",5,0)
 ;10035 ^DPT(
"RTN","ORWORR",6,0)
 ;10040 ^SC(
"RTN","ORWORR",7,0)
 ;10060 ^VA(200
"RTN","ORWORR",8,0)
 ;10000 %DTC
"RTN","ORWORR",9,0)
 ; 2263 XPAR
"RTN","ORWORR",10,0)
 ; 2343 XUSER
"RTN","ORWORR",11,0)
 ;
"RTN","ORWORR",12,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",13,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",14,0)
 ;    & until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",15,0)
 ;    & until the date ranges implemented
"RTN","ORWORR",16,0)
 ; Get orders for patient
"RTN","ORWORR",17,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16 17    18
"RTN","ORWORR",18,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^^Schedule
"RTN","ORWORR",19,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",20,0)
 ;     DFN=Patient ID
"RTN","ORWORR",21,0)
 ;  FILTER=# indicates which orders to return, default=2 (current)
"RTN","ORWORR",22,0)
 ;  GROUPS=display grp of orders to show (default=ALL)
"RTN","ORWORR",23,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",24,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",25,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",26,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",27,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",28,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",29,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",30,0)
 . D GETFLDS
"RTN","ORWORR",31,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",32,0)
 G EXIT
"RTN","ORWORR",33,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT,ORRECIP) ;Get abbrev. event delayed order list for patient
"RTN","ORWORR",34,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",35,0)
 ; see input parameters above
"RTN","ORWORR",36,0)
 ; -- from ORWORR
"RTN","ORWORR",37,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",38,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",39,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",40,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",41,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",42,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",43,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",44,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; normally ptr to 42
"RTN","ORWORR",45,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",46,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",47,0)
 I $P(DTFROM,".")=$P(DTTHRU,"."),$P(DTFROM,".",2)>$P(DTTHRU,".",2),$P(DTTHRU,".",2)="" S $P(DTTHRU,".",2)=2359
"RTN","ORWORR",48,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",49,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",50,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"",1,EVENT)
"RTN","ORWORR",51,0)
 . D GET2^ORWORR1
"RTN","ORWORR",52,0)
 E  D
"RTN","ORWORR",53,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"",1,EVENT)
"RTN","ORWORR",54,0)
 . D GET1^ORWORR1
"RTN","ORWORR",55,0)
 Q
"RTN","ORWORR",56,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",57,0)
 N EVTDCREL
"RTN","ORWORR",58,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",59,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",60,0)
 Q
"RTN","ORWORR",61,0)
XGET ; retrieval algorithm before all the AC xref changes
"RTN","ORWORR",62,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA,PASS ;PKI
"RTN","ORWORR",63,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",64,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",65,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",66,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",67,0)
 . D XPND(GROUPS)
"RTN","ORWORR",68,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",69,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",70,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",71,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",72,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",73,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",74,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",75,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",76,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",77,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",78,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",79,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",80,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",81,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",82,0)
 D DOGET
"RTN","ORWORR",83,0)
EXIT I LST=0 D
"RTN","ORWORR",84,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",85,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",86,0)
 Q
"RTN","ORWORR",87,0)
DOGET ; Here to filter orders
"RTN","ORWORR",88,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",89,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",90,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",91,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",92,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",93,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",94,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",95,0)
 . . . ; any other filtering
"RTN","ORWORR",96,0)
 . . . D GETFLDS
"RTN","ORWORR",97,0)
 Q
"RTN","ORWORR",98,0)
DOALL ; Here to get all orders (no filter by status)
"RTN","ORWORR",99,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",100,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",101,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",102,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",103,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",104,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",105,0)
 . . . D GETFLDS
"RTN","ORWORR",106,0)
 Q
"RTN","ORWORR",107,0)
DOCUR ; Here to get all current orders
"RTN","ORWORR",108,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",109,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",110,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",111,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",112,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",113,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",114,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",115,0)
 . . ; filter out display groups here
"RTN","ORWORR",116,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",117,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",118,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",119,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",120,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",121,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",122,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",123,0)
 . . . D GETFLDS
"RTN","ORWORR",124,0)
 Q
"RTN","ORWORR",125,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",126,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",127,0)
 Q
"RTN","ORWORR",128,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get order fields TEMP
"RTN","ORWORR",129,0)
 G GET41
"RTN","ORWORR",130,0)
GET4LST(LST,IFNLST) ; get order fields for list of orders
"RTN","ORWORR",131,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",132,0)
 N LOC ;IMO
"RTN","ORWORR",133,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",134,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",135,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",136,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",137,0)
 . D GETFLDS
"RTN","ORWORR",138,0)
 Q
"RTN","ORWORR",139,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",140,0)
 ; get fields for single order
"RTN","ORWORR",141,0)
 ; .LST(n)=described above in GET
"RTN","ORWORR",142,0)
 ;  IFN=internal entry # for order
"RTN","ORWORR",143,0)
 I 'IFN Q
"RTN","ORWORR",144,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",145,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",146,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",147,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",148,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",149,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",150,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",151,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^^DigSig^LOC^[DCORIGNAL]^IsPendingDCorder^IsDelayOrder
"RTN","ORWORR",152,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",153,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",154,0)
 S DEA=$$DEA^XUSER(,+PRV) ; get user DEA info - PKI
"RTN","ORWORR",155,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",156,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",157,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",158,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",159,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",160,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",161,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",162,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",163,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",164,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",165,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI
"RTN","ORWORR",166,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",167,0)
 I '$P($G(^OR(100,IFN,8,ACT,2)),"^",5),$P(X0,"^",5) D  ;Copy orders PKI fix
"RTN","ORWORR",168,0)
 . N OI,ORVP,ORCAT,PKG,ORPKIU
"RTN","ORWORR",169,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",170,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",171,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",172,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORWORR",173,0)
 . S ORPKIU=0 I $D(^ORD(100.7,"C",DUZ)) S ORPKIU=1
"RTN","ORWORR",174,0)
 . D PKI^ORWDPS1(.ORY,OI,ORCAT,+ORVP,ORPKIU)
"RTN","ORWORR",175,0)
 . I $E($G(ORY))=2 S $P(LST(IDX),U,18)=ORY
"RTN","ORWORR",176,0)
 ; Change to display location for Clinic Orders, Inpatients, & IV infusion orders.
"RTN","ORWORR",177,0)
 N DGID,DGNAM
"RTN","ORWORR",178,0)
 S LOC=""
"RTN","ORWORR",179,0)
 S DGID=$P(X0,U,11)
"RTN","ORWORR",180,0)
 I $L(DGID) D
"RTN","ORWORR",181,0)
 .S DGNAM=$P($G(^ORD(100.98,DGID,0)),U)
"RTN","ORWORR",182,0)
 .;I DGNAM="CLINIC ORDERS"!(DGNAM="INPATIENT MEDICATIONS")!(DGNAM="IV MEDICATIONS")!(DGNAM="UNIT DOSE MEDICATIONS") D
"RTN","ORWORR",183,0)
 .S LOC=$P(X0,U,10) ;IMO
"RTN","ORWORR",184,0)
 .S:+LOC LOC=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO
"RTN","ORWORR",185,0)
 S $P(LST(IDX),U,19)=LOC ;IMO
"RTN","ORWORR",186,0)
 S $P(LST(IDX),U,20)=$P($G(^OR(100,IFN,6)),"^",9)
"RTN","ORWORR",187,0)
 ;need a way to determine if order is in an unsigned DC state.
"RTN","ORWORR",188,0)
 S $P(LST(IDX),U,21)=$S(ACTID="DC":1,1:0)
"RTN","ORWORR",189,0)
 S $P(LST(IDX),U,22)=$$CHKORD^OREVNTX1(IFN)
"RTN","ORWORR",190,0)
 D
"RTN","ORWORR",191,0)
 . N OI,ORVP,ORCAT,PKG,ORCONSUB,ORCSPKG,ORYD
"RTN","ORWORR",192,0)
 . S ORCSPKG=""
"RTN","ORWORR",193,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",194,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",195,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",196,0)
 . I PKG=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) S ORCSPKG="O"
"RTN","ORWORR",197,0)
 . I PKG=$O(^DIC(9.4,"B","UNIT DOSE MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",198,0)
 . I PKG=$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",199,0)
 . I PKG=$O(^DIC(9.4,"B","IV MEDICATIONS",0)) S ORCSPKG="I"
"RTN","ORWORR",200,0)
 . I ORCSPKG="" S $P(LST(IDX),U,23,24)="0^0" Q
"RTN","ORWORR",201,0)
 . D CSCHECK^ORDEA(.ORCONSUB,OI,ORCSPKG)
"RTN","ORWORR",202,0)
 . S $P(LST(IDX),U,23)=$P(ORCONSUB,U)
"RTN","ORWORR",203,0)
 . S $P(LST(IDX),U,24)=$P(ORCONSUB,U,2)
"RTN","ORWORR",204,0)
 ;
"RTN","ORWORR",205,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",206,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize later
"RTN","ORWORR",207,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",208,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",209,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",210,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",211,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",212,0)
 Q
"RTN","ORWORR",213,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",214,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",215,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",216,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",217,0)
GETTXT(LST,IFN) ; get text of an order
"RTN","ORWORR",218,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",219,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",220,0)
 Q
"RTN","ORWORR",221,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",222,0)
 ; Expand display group (GROUPS defined outside of call)
"RTN","ORWORR",223,0)
 N I,CHLD
"RTN","ORWORR",224,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",225,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",226,0)
 Q
"RTN","ORWORR",227,0)
GETPKG(Y,IFN) ; get order pkg
"RTN","ORWORR",228,0)
 N ORDERID,PKGID
"RTN","ORWORR",229,0)
 Q:+IFN<1
"RTN","ORWORR",230,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",231,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",232,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",233,0)
 Q
"VER")
8.0^22.2
"BLD",10457,6)
^397
**END**
**END**

