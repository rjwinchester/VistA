Released OR*3*374 SEQ #342
Extracted from mail message
**KIDS**:OR*3.0*374^

**INSTALL NAME**
OR*3.0*374
"BLD",8759,0)
OR*3.0*374^ORDER ENTRY/RESULTS REPORTING^0^3140506^y
"BLD",8759,1,0)
^^1^1^3140325^
"BLD",8759,1,1,0)
See patch description for full content description.
"BLD",8759,4,0)
^9.64PA^^
"BLD",8759,6)
5^
"BLD",8759,6.3)
9
"BLD",8759,"ABPKG")
n
"BLD",8759,"INID")
^
"BLD",8759,"INIT")
POST^ORY374
"BLD",8759,"KRN",0)
^9.67PA^779.2^20
"BLD",8759,"KRN",.4,0)
.4
"BLD",8759,"KRN",.401,0)
.401
"BLD",8759,"KRN",.402,0)
.402
"BLD",8759,"KRN",.403,0)
.403
"BLD",8759,"KRN",.5,0)
.5
"BLD",8759,"KRN",.84,0)
.84
"BLD",8759,"KRN",3.6,0)
3.6
"BLD",8759,"KRN",3.8,0)
3.8
"BLD",8759,"KRN",9.2,0)
9.2
"BLD",8759,"KRN",9.8,0)
9.8
"BLD",8759,"KRN",9.8,"NM",0)
^9.68A^10^6
"BLD",8759,"KRN",9.8,"NM",1,0)
ORDEA^^0^B85690484
"BLD",8759,"KRN",9.8,"NM",2,0)
ORWDXR^^0^B59460463
"BLD",8759,"KRN",9.8,"NM",3,0)
ORCACT01^^0^B75438939
"BLD",8759,"KRN",9.8,"NM",7,0)
ORYCHKE^^1^
"BLD",8759,"KRN",9.8,"NM",8,0)
ORDEA01^^0^B44517612
"BLD",8759,"KRN",9.8,"NM",10,0)
ORY374^^0^B4039046
"BLD",8759,"KRN",9.8,"NM","B","ORCACT01",3)

"BLD",8759,"KRN",9.8,"NM","B","ORDEA",1)

"BLD",8759,"KRN",9.8,"NM","B","ORDEA01",8)

"BLD",8759,"KRN",9.8,"NM","B","ORWDXR",2)

"BLD",8759,"KRN",9.8,"NM","B","ORY374",10)

"BLD",8759,"KRN",9.8,"NM","B","ORYCHKE",7)

"BLD",8759,"KRN",19,0)
19
"BLD",8759,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8759,"KRN",19,"NM",1,0)
OR EPCS CS RX BY PROVIDER^^0
"BLD",8759,"KRN",19,"NM","B","OR EPCS CS RX BY PROVIDER",1)

"BLD",8759,"KRN",19.1,0)
19.1
"BLD",8759,"KRN",101,0)
101
"BLD",8759,"KRN",409.61,0)
409.61
"BLD",8759,"KRN",771,0)
771
"BLD",8759,"KRN",779.2,0)
779.2
"BLD",8759,"KRN",870,0)
870
"BLD",8759,"KRN",8989.51,0)
8989.51
"BLD",8759,"KRN",8989.52,0)
8989.52
"BLD",8759,"KRN",8994,0)
8994
"BLD",8759,"KRN","B",.4,.4)

"BLD",8759,"KRN","B",.401,.401)

"BLD",8759,"KRN","B",.402,.402)

"BLD",8759,"KRN","B",.403,.403)

"BLD",8759,"KRN","B",.5,.5)

"BLD",8759,"KRN","B",.84,.84)

"BLD",8759,"KRN","B",3.6,3.6)

"BLD",8759,"KRN","B",3.8,3.8)

"BLD",8759,"KRN","B",9.2,9.2)

"BLD",8759,"KRN","B",9.8,9.8)

"BLD",8759,"KRN","B",19,19)

"BLD",8759,"KRN","B",19.1,19.1)

"BLD",8759,"KRN","B",101,101)

"BLD",8759,"KRN","B",409.61,409.61)

"BLD",8759,"KRN","B",771,771)

"BLD",8759,"KRN","B",779.2,779.2)

"BLD",8759,"KRN","B",870,870)

"BLD",8759,"KRN","B",8989.51,8989.51)

"BLD",8759,"KRN","B",8989.52,8989.52)

"BLD",8759,"KRN","B",8994,8994)

"BLD",8759,"QUES",0)
^9.62^^
"BLD",8759,"REQB",0)
^9.611^3^3
"BLD",8759,"REQB",1,0)
OR*3.0*306^2
"BLD",8759,"REQB",2,0)
OR*3.0*218^2
"BLD",8759,"REQB",3,0)
OR*3.0*349^2
"BLD",8759,"REQB","B","OR*3.0*218",2)

"BLD",8759,"REQB","B","OR*3.0*306",1)

"BLD",8759,"REQB","B","OR*3.0*349",3)

"INIT")
POST^ORY374
"KRN",19,14152,-1)
0^1
"KRN",19,14152,0)
OR EPCS CS RX BY PROVIDER^ePCS Controlled Subs by Provider^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,14152,1,0)
^^3^3^3121209^
"KRN",19,14152,1,1,0)
This is the option to be scheduled in TaskMan to run the monthly report 
"KRN",19,14152,1,2,0)
for controlled substances prescriptions issues by a provider. This report 
"KRN",19,14152,1,3,0)
is required by the Drug Enforcement Agency to be delivered once a month.
"KRN",19,14152,25)
EN^ORDEA02
"KRN",19,14152,"U")
EPCS CONTROLLED SUBS BY PROVID
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
374^3140506^10000000200
"PKG",170,22,1,"PAH",1,1,0)
^^1^1^3140506
"PKG",170,22,1,"PAH",1,1,1,0)
See patch description for full content description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","ORCACT01")
0^3^B75438939^B73162250
"RTN","ORCACT01",1,0)
ORCACT01 ;SLC/MKB-Validate order actions cont ;10/24/13  09:11
"RTN","ORCACT01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,141,163,187,190,213,243,306,374**;Dec 17, 1997;Build 9
"RTN","ORCACT01",3,0)
 ;
"RTN","ORCACT01",4,0)
 ;
"RTN","ORCACT01",5,0)
ES ; -- sign [on chart]
"RTN","ORCACT01",6,0)
 I ORDSTS=11,VER<3,PKG'="OR" S ERROR="This order cannot be released and must be discontinued!" Q
"RTN","ORCACT01",7,0)
 N X I ACTSTS=11!(ACTSTS=10) D  Q:$L($G(ERROR))
"RTN","ORCACT01",8,0)
 . I $P(ORA0,U,2)="DC",$$DONE^ORCACT0 D CANCEL^ORCSEND(+IFN),UNOTIF^ORCSIGN S OREBUILD=1 Q
"RTN","ORCACT01",9,0)
 . S X=$$DISABLED^ORCACT0 I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",10,0)
 I ACTION="OC",$G(DG)="NV RX" S:MEDPARM<2 ERROR="You are not authorized to release non-VA med orders!" Q
"RTN","ORCACT01",11,0)
 S X=$P(ORA0,U,4) I X=3 S:ACTSTS'=11&(ACTSTS'=10) ERROR="This order does not require a signature!" Q
"RTN","ORCACT01",12,0)
 I X'=2 S ERROR="This order has been signed!" Q
"RTN","ORCACT01",13,0)
 N ORCS D CSVALUE^ORDEA(.ORCS,+IFN)
"RTN","ORCACT01",14,0)
 I DG="O RX",ACTION="RS",$G(NATR)="I",ORCS=1 S ERROR="Controlled Substance outpatient meds may not be released without a clinician's signature!" Q
"RTN","ORCACT01",15,0)
 I DG="O RX",ACTION'="ES",ACTION'="DS",$G(NATR)'="I" S ERROR="Outpatient meds may not be released without a clinician's signature!" Q
"RTN","ORCACT01",16,0)
 I (ACTION="ES"!(ACTION="DS")),$D(^XUSEC("ORELSE",DUZ)),$P(OR0,U,16)'<2 S ERROR="You are not privileged to sign this order!" Q
"RTN","ORCACT01",17,0)
 I ACTION="OC" S:MEDPARM<2 ERROR="You are not authorized to release med orders!" Q
"RTN","ORCACT01",18,0)
 I ACTION="RS" D  Q:$D(ERROR)  Q:$G(NATR)'="I"
"RTN","ORCACT01",19,0)
 . Q:ACTSTS=11  Q:ACTSTS=10  ;unreleased - ok
"RTN","ORCACT01",20,0)
 . S ERROR="This order has already been released!"
"RTN","ORCACT01",21,0)
ES1 I PKG="PS" D  ;authorized to write meds?
"RTN","ORCACT01",22,0)
 . N TYPE,OI,PSOI,DEAFLG,PKI,IVERROR,ORDGNM
"RTN","ORCACT01",23,0)
 . S X=$G(^VA(200,DUZ,"PS"))
"RTN","ORCACT01",24,0)
 . I '$P(X,U) S ERROR="You are not authorized to sign med orders!" Q
"RTN","ORCACT01",25,0)
 . I $P(X,U,4),$$NOW^XLFDT>$P(X,U,4) S ERROR="You are no longer authorized to sign med orders!" Q
"RTN","ORCACT01",26,0)
 . ;Q:DG="IV RX"  Q:$P(ORA0,U,2)="DC"  ;don't need to ck DEA#
"RTN","ORCACT01",27,0)
 . Q:$P(ORA0,U,2)="DC"
"RTN","ORCACT01",28,0)
 . S ORDGNM=$$GET1^DIQ(100,+IFN_",",2)
"RTN","ORCACT01",29,0)
 . I ORDGNM["FLUID OE" D  Q
"RTN","ORCACT01",30,0)
 . .S FAIL=$$IVDEACHK(+IFN) I FAIL'=0 S ERROR=FAIL
"RTN","ORCACT01",31,0)
 . S OI=+$$VALUE^ORX8(+IFN,"ORDERABLE")
"RTN","ORCACT01",32,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",33,0)
 . S TYPE=$S($P(DG," ")="O":"O",1:"I"),DEAFLG=$P($$OIDEA^PSSOPKI(PSOI,TYPE),";",2)
"RTN","ORCACT01",34,0)
 . S DETFLAG=$$OIDETOX^PSSOPKI(PSOI,TYPE)
"RTN","ORCACT01",35,0)
 . S DETPRO=$$DETOX^XUSER(+$G(DUZ))
"RTN","ORCACT01",36,0)
 . I DETFLAG,DETPRO="" S ERROR=3 Q
"RTN","ORCACT01",37,0)
 . I DETFLAG,DETPRO>0 S Y=DETPRO X ^DD("DD") S ERROR="5^"_Y Q
"RTN","ORCACT01",38,0)
 . I (DEAFLG>0||$$ISCLOZ^ORALWORD(OI)) D  I $G(ERROR)]"" Q
"RTN","ORCACT01",39,0)
 .. N RET
"RTN","ORCACT01",40,0)
 .. I $$ISCLOZ^ORALWORD(OI) D  Q
"RTN","ORCACT01",41,0)
 ... S RET=$$DEA^XUSER(,DUZ) I RET="" S ERROR=1
"RTN","ORCACT01",42,0)
 .. S RET=$$SDEA^XUSER(,DUZ,DEAFLG)
"RTN","ORCACT01",43,0)
 .. I RET=1 S ERROR=1 Q
"RTN","ORCACT01",44,0)
 .. I RET=2 S ERROR="2^"_$$UP^XLFSTR(DEAFLG) Q
"RTN","ORCACT01",45,0)
 .. I RET?1"4".E S ERROR=RET Q
"RTN","ORCACT01",46,0)
 .. I RET?1N.E S ERROR=RET
"RTN","ORCACT01",47,0)
 . D PKISITE^ORWOR(.PKI)
"RTN","ORCACT01",48,0)
 . I $G(PKI),ACTION="RS",DEAFLG=1 S ERROR="This order cannot be released without a Digital Signature" Q
"RTN","ORCACT01",49,0)
 Q
"RTN","ORCACT01",50,0)
 ;
"RTN","ORCACT01",51,0)
IVDEACHK(IFN) ; -- Returns value of prompt by ID
"RTN","ORCACT01",52,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0))) Q ""
"RTN","ORCACT01",53,0)
 N I,DIAL,DIALTYP,FAIL,PATCLASS,RESULT,Y
"RTN","ORCACT01",54,0)
 S PATCLASS=$P(^OR(100,+IFN,0),U,12)
"RTN","ORCACT01",55,0)
 S RESULT=0
"RTN","ORCACT01",56,0)
 ;if ORNP is not set then assume this is called from VistA not CPRS
"RTN","ORCACT01",57,0)
 I $G(ORNP)="" S ORNP=DUZ
"RTN","ORCACT01",58,0)
 S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORCACT01",59,0)
 F  S I=$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I'>0!(RESULT=1)  D
"RTN","ORCACT01",60,0)
 .S Y=$G(^OR(100,+IFN,4.5,I,1)) Q:Y'>0
"RTN","ORCACT01",61,0)
 .;S PSOI=+$P($G(^ORD(101.43,Y,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",62,0)
 .I PATCLASS="I" D  Q
"RTN","ORCACT01",63,0)
 ..D FAILDEA^ORWDPS1(.FAIL,Y,ORNP,"I") I FAIL'=0 S RESULT=FAIL
"RTN","ORCACT01",64,0)
 .S DIAL=+$P(^OR(100,+IFN,4.5,I,0),U,2)
"RTN","ORCACT01",65,0)
 .S DIALTYP=$S($P(^ORD(101.41,DIAL,0),U)["ADDITIVE":"A",1:"S")
"RTN","ORCACT01",66,0)
 .D FDEA1^ORWDPS1(.FAIL,Y,DIALTYP,ORNP)
"RTN","ORCACT01",67,0)
 .I FAIL'=0 S RESULT=FAIL
"RTN","ORCACT01",68,0)
 .;I $$OIDEA^PSSUTLA1(PSOI,"I")>0 S RESULT=1 Q
"RTN","ORCACT01",69,0)
 Q RESULT
"RTN","ORCACT01",70,0)
 ;
"RTN","ORCACT01",71,0)
XFR ; -- transfer to inpt/outpt [IFN=order to be transferred]
"RTN","ORCACT01",72,0)
 N OI,PS I DG="TPN" S ERROR="TPN orders may not be copied!" Q
"RTN","ORCACT01",73,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be transferred; please enter a new order!" Q
"RTN","ORCACT01",74,0)
 S OI=+$O(^OR(100,+IFN,.1,"B",0)),ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",75,0)
 I DG="UD RX",'$P(ORPS,U,2) S ERROR="This drug may not be ordered for an outpatient!" Q
"RTN","ORCACT01",76,0)
 I DG="O RX" D  Q:$L($G(ERROR))
"RTN","ORCACT01",77,0)
 . I '$P(ORPS,U) S ERROR="This drug may not be ordered for an inpatient!" Q
"RTN","ORCACT01",78,0)
 . D:$O(^OR(100,+IFN,4.5,"ID","MISC",0)) DOSES^ORCACT02(+IFN)
"RTN","ORCACT01",79,0)
 Q
"RTN","ORCACT01",80,0)
 ;
"RTN","ORCACT01",81,0)
RW ; -- rewrite/copy
"RTN","ORCACT01",82,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be copied!" Q
"RTN","ORCACT01",83,0)
 I DG="NV RX" S ERROR="Non-VA Med orders cannot be copied!" Q
"RTN","ORCACT01",84,0)
 I DG="TPN" S ERROR="TPN orders may not be rewritten!" Q
"RTN","ORCACT01",85,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be rewritten!" Q
"RTN","ORCACT01",86,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be copied; please enter a new order!" Q
"RTN","ORCACT01",87,0)
 I PKG="PS",'$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",88,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",89,0)
 Q
"RTN","ORCACT01",90,0)
 ;
"RTN","ORCACT01",91,0)
RN ; -- renew
"RTN","ORCACT01",92,0)
 I PKG'="PS",PKG'="OR" S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",93,0)
 I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT01",94,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be renewed!" Q
"RTN","ORCACT01",95,0)
 I $P(OR3,U,6) S ERROR="This order has already been "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"changed!",1:"renewed!") Q
"RTN","ORCACT01",96,0)
 I PKG="OR" D  Q  ;Generic orders
"RTN","ORCACT01",97,0)
 . I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",98,0)
 . I DG="ADT" S ERROR="M.A.S. orders may not be renewed!" Q
"RTN","ORCACT01",99,0)
 . I "^1^2^6^7^"[(U_ORDSTS_U) Q  ;ok
"RTN","ORCACT01",100,0)
 . S ERROR="This order may not be renewed!"
"RTN","ORCACT01",101,0)
 I (PKG="PS"),$$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",102,0)
 I '$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",103,0)
RN1 N PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT01",104,0)
 I PSIFN<1,'$O(^OR(100,+IFN,2,0)) S ERROR="Missing or invalid order number!" Q
"RTN","ORCACT01",105,0)
 I DG="O RX" D  Q  ;Outpt Meds
"RTN","ORCACT01",106,0)
 . N ORZ,ORD S ORZ=$L($T(RENEW^PSORENW),",")
"RTN","ORCACT01",107,0)
 . I ORZ>1 S ORD=+$$VALUE^ORX8(+IFN,"DRUG"),X=$$RENEW^PSORENW(PSIFN,ORD)
"RTN","ORCACT01",108,0)
 . S:ORZ'>1 X=$$RENEW^PSORENW(PSIFN) I X<1 S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",109,0)
 . S X=+$P(X,U,2) D:X RESET^ORCACT03(+IFN,X)
"RTN","ORCACT01",110,0)
 . I $O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old format
"RTN","ORCACT01",111,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be renewed!" Q
"RTN","ORCACT01",112,0)
 I ORDSTS=7,'$$IV^ORCACT03,$P(OR0,U,9)<$$FMADD^XLFDT(DT,-4)  S ERROR="Inpatient med orders may not be renewed more than 4 days after expiration!" Q
"RTN","ORCACT01",113,0)
 I ORDSTS'=6,ORDSTS'=7 S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",114,0)
RN2 I $O(^OR(100,+IFN,2,0))!$P(OR3,U,9) D  Q:$D(ERROR)!'PSIFN
"RTN","ORCACT01",115,0)
 . I $P(OR3,U,9),$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW" S ERROR="One-time NOW orders may not be renewed!" Q
"RTN","ORCACT01",116,0)
 . N DAD,ORD3,I,Y S DAD=$S($P(OR3,U,9):+$P(OR3,U,9),1:+IFN),Y=0
"RTN","ORCACT01",117,0)
 . S ORD3=$G(^OR(100,DAD,3)) I $P(ORD3,U,6) S ERROR="This complex order has already been renewed!" Q
"RTN","ORCACT01",118,0)
 . I $P(ORD3,U,3)'=6 S ERROR="This complex order is not active and may not be renewed!" Q
"RTN","ORCACT01",119,0)
 . I '$$AND^ORX8(DAD) S ERROR="Complex orders with sequential doses may not be renewed!" Q
"RTN","ORCACT01",120,0)
 . S I=0 F  S I=+$O(^OR(100,DAD,2,I)) Q:I<1  D  Q:Y
"RTN","ORCACT01",121,0)
 .. I I=+$O(^OR(100,DAD,2,0)),$$VALUE^ORX8(I,"SCHEDULE",1,"E")="NOW",$$VALUE^ORX8(DAD,"NOW") Q  ;ignore NOW orders
"RTN","ORCACT01",122,0)
 .. I $P($G(^OR(100,I,3)),U,3)'=6 S Y=1,ERROR="Complex orders with terminated doses may not be renewed!" Q
"RTN","ORCACT01",123,0)
 .. I PSIFN<1 S X=$$ACTIVE^PSJORREN(+ORVP,$G(^OR(100,I,4))) I +X'=1 S ERROR="This order may not be renewed: "_$S(+X>1:"Inactive orderable item",1:$P(X,U,2)) Q
"RTN","ORCACT01",124,0)
 ;I DG="TPN" S ERROR="TPN orders may not be renewed!" Q
"RTN","ORCACT01",125,0)
 S X=$$ACTIVE^PSJORREN(+ORVP,PSIFN) Q:+X=1  ;Ok
"RTN","ORCACT01",126,0)
 I +X>1,$P(X,U,2) D RESET^ORCACT03(+IFN,+$P(X,U,2)) Q  ;replace OI
"RTN","ORCACT01",127,0)
 S ERROR="This order may not be renewed: "_$P(X,U,2)
"RTN","ORCACT01",128,0)
 Q
"RTN","ORCACT01",129,0)
 ;
"RTN","ORCACT01",130,0)
XX ; -- edit/change--
"RTN","ORCACT01",131,0)
 I PKG="RA",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Radiology cannot be changed!" Q
"RTN","ORCACT01",132,0)
 I PKG="LR",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Lab cannot be changed!" Q
"RTN","ORCACT01",133,0)
 I PKG="FH",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Dietetics cannot be changed!" Q
"RTN","ORCACT01",134,0)
 I PKG="GMRC",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Consults cannot be changed!" Q
"RTN","ORCACT01",135,0)
 I DG="TPN" S ERROR="TPN orders may not be changed!" Q
"RTN","ORCACT01",136,0)
 I ORDSTS=3 S ERROR="Orders on hold may not be changed!" Q
"RTN","ORCACT01",137,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be changed!" Q
"RTN","ORCACT01",138,0)
 I $O(^OR(100,+IFN,2,0)) S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",139,0)
 I $P(OR3,U,9) D  Q:$D(ERROR)
"RTN","ORCACT01",140,0)
 . Q:$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW"  ;NOW ok
"RTN","ORCACT01",141,0)
 . Q:'$O(^OR(100,+$P(OR3,U,9),4.5,"ID","CONJ",0))  ;no conj=1dose/ok
"RTN","ORCACT01",142,0)
 . S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",143,0)
 I $P(OR3,U,6) S ERROR="This order may not be changed - a "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"change",1:"renewal")_" order already exists!" Q
"RTN","ORCACT01",144,0)
 I $P(OR3,U,11)=2 D  Q:$D(ERROR)
"RTN","ORCACT01",145,0)
 . I (ORDSTS=10!(ORDSTS=11)),DG'="O RX" S ERROR="Unreleased renewals may not be changed!" Q
"RTN","ORCACT01",146,0)
 . I PKG="PS",ORDSTS=5 S ERROR="Pending renewals may not be changed!" Q
"RTN","ORCACT01",147,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be changed; please enter a new order!" Q
"RTN","ORCACT01",148,0)
 I PKG="PS",'$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",149,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",150,0)
 Q
"RTN","ORCACT01",151,0)
 ;
"RTN","ORDEA")
0^1^B85690484^B85981983
"RTN","ORDEA",1,0)
ORDEA ;ISL/TC & JMH & JLC - DEA related items ;05/06/14  06:58
"RTN","ORDEA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**306,374**;Dec 17, 1997;Build 9
"RTN","ORDEA",3,0)
 ;
"RTN","ORDEA",4,0)
 ;Reference to ^PSSOPKI supported by DBIA #3737
"RTN","ORDEA",5,0)
 ;Reference to ^PSSUTLA1 supported by DBIA #3373
"RTN","ORDEA",6,0)
 ;
"RTN","ORDEA",7,0)
 ;
"RTN","ORDEA",8,0)
DEATEXT(ORY) ;returns the mandatory dea text to show when a user checks a controlled substance order to be signed on the signature dialog
"RTN","ORDEA",9,0)
 N I,ORTY
"RTN","ORDEA",10,0)
 D GETWP^XPAR(.ORTY,"SYS","OR DEA TEXT")
"RTN","ORDEA",11,0)
 S I=0 F  S I=$O(ORTY(I)) Q:'I  S ORY(I)=ORTY(I,0)
"RTN","ORDEA",12,0)
 Q
"RTN","ORDEA",13,0)
 ;
"RTN","ORDEA",14,0)
CSVALUE(ORY,ORID) ;return 1 if the order (ORID) is a controlled substance, 0 for non-controlled substance
"RTN","ORDEA",15,0)
 N OROI,ORPSTYPE,ORRXDG
"RTN","ORDEA",16,0)
 S ORY=0,ORPSTYPE=""
"RTN","ORDEA",17,0)
 S OROI=$$OI^ORQOR2(+ORID)
"RTN","ORDEA",18,0)
 S ORRXDG=$$DGRX^ORQOR2(+ORID)
"RTN","ORDEA",19,0)
 I ORRXDG="UNIT DOSE MEDICATIONS" S ORPSTYPE="I"
"RTN","ORDEA",20,0)
 I ORRXDG="INPATIENT MEDICATIONS" S ORPSTYPE="I"
"RTN","ORDEA",21,0)
 I ORRXDG="IV MEDICATIONS" S ORPSTYPE="I"
"RTN","ORDEA",22,0)
 I ORRXDG="OUTPATIENT MEDICATIONS" S ORPSTYPE="O"
"RTN","ORDEA",23,0)
 I ORRXDG="PHARMACY" S ORPSTYPE="O"
"RTN","ORDEA",24,0)
 Q:ORPSTYPE=""
"RTN","ORDEA",25,0)
 D CSCHECK(.ORY,OROI,ORPSTYPE)
"RTN","ORDEA",26,0)
 S ORY=+ORY
"RTN","ORDEA",27,0)
 Q
"RTN","ORDEA",28,0)
 ;
"RTN","ORDEA",29,0)
PNDHLD(ORY,ORID) ;return 1 if the order is pending a HOLD, 0 otherwise
"RTN","ORDEA",30,0)
 S ORY=0
"RTN","ORDEA",31,0)
 N ORLSTACT S ORLSTACT=$O(^OR(100,+ORID,8,"A"),-1)
"RTN","ORDEA",32,0)
 I $P(^OR(100,+ORID,8,ORLSTACT,0),U,2)="HD" S ORY=1
"RTN","ORDEA",33,0)
 Q
"RTN","ORDEA",34,0)
 ;
"RTN","ORDEA",35,0)
CSCHECK(ORCSVAL,OROI,ORPSTYPE) ; return 1 if OI is a controlled substance, 0 for non-controlled substance
"RTN","ORDEA",36,0)
 ;ORCSVAL=1:controlled substance, 0:non-controlled substance
"RTN","ORDEA",37,0)
 ;OROI=OR orderable item
"RTN","ORDEA",38,0)
 ;ORPSTYPE="O":Outpatient pharmacy order, "I" or "U":Inpatient med order
"RTN","ORDEA",39,0)
 N ORPSOI,ORTPKG,ORDEAFLG,ORDETOX
"RTN","ORDEA",40,0)
 S ORCSVAL=0_U_0,ORTPKG=$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORDEA",41,0)
 I ORPSTYPE="I" Q
"RTN","ORDEA",42,0)
 Q:ORTPKG'["PS"
"RTN","ORDEA",43,0)
 S ORPSOI=+ORTPKG Q:ORPSOI'>0
"RTN","ORDEA",44,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORDEA",45,0)
 S ORDEAFLG=+$$OIDEA^PSSOPKI(ORPSOI,ORPSTYPE)
"RTN","ORDEA",46,0)
 I ORDEAFLG'>0 S ORCSVAL=0
"RTN","ORDEA",47,0)
 I ORDEAFLG>0 S ORCSVAL=1
"RTN","ORDEA",48,0)
 S ORDETOX=0
"RTN","ORDEA",49,0)
 ;get detox value either from OIDEA^PSSUTLA1 or from different api or method
"RTN","ORDEA",50,0)
 S ORDETOX=$$OIDETOX^PSSOPKI(ORPSOI,ORPSTYPE)
"RTN","ORDEA",51,0)
 S ORCSVAL=ORCSVAL_U_ORDETOX
"RTN","ORDEA",52,0)
 Q
"RTN","ORDEA",53,0)
SIGINFO(ORY,ORDFN,ORPROV) ;returns the provider/patient info that must be displayed when signing controlled substance orders
"RTN","ORDEA",54,0)
 N ORI S ORI=0
"RTN","ORDEA",55,0)
 ;patient name
"RTN","ORDEA",56,0)
 S ORI=ORI+1,ORY(ORI)=$P(^DPT(+ORDFN,0),U)
"RTN","ORDEA",57,0)
 ;date of issuance
"RTN","ORDEA",58,0)
 S ORI=ORI+1,ORY(ORI)="Date of Issuance: "_$$FMTE^XLFDT($$DT^XLFDT)
"RTN","ORDEA",59,0)
 ;provider name
"RTN","ORDEA",60,0)
 S ORI=ORI+1,ORY(ORI)="Provider: "_$$GET1^DIQ(200,ORPROV,.01,"E")
"RTN","ORDEA",61,0)
 ;provider address (facility address)
"RTN","ORDEA",62,0)
 N ORINST
"RTN","ORDEA",63,0)
 D GETS^DIQ(4,DUZ(2),".01;.02;1.01;1.02;1.03;1.04","E","ORINST")
"RTN","ORDEA",64,0)
 N ORADDNUM S ORADDNUM=0
"RTN","ORDEA",65,0)
 I $L(ORINST(4,DUZ(2)_",",1.01,"E"))>0 S ORI=ORI+1,ORY(ORI)=ORINST(4,DUZ(2)_",",1.01,"E"),ORADDNUM=ORADDNUM+1
"RTN","ORDEA",66,0)
 I $L(ORINST(4,DUZ(2)_",",1.02,"E"))>0 S ORI=ORI+1,ORY(ORI)=ORINST(4,DUZ(2)_",",1.02,"E"),ORADDNUM=ORADDNUM+1
"RTN","ORDEA",67,0)
 I $L(ORINST(4,DUZ(2)_",",1.03,"E"))>0 S ORI=ORI+1,ORY(ORI)=ORINST(4,DUZ(2)_",",1.03,"E"),ORADDNUM=ORADDNUM+1
"RTN","ORDEA",68,0)
 I $L(ORINST(4,DUZ(2)_",",.02,"E"))>0 S ORY(ORI)=ORY(ORI)_", "_ORINST(4,DUZ(2)_",",.02,"E"),ORADDNUM=ORADDNUM+1
"RTN","ORDEA",69,0)
 I $L(ORINST(4,DUZ(2)_",",1.04,"E"))>0 S ORY(ORI)=ORY(ORI)_"  "_ORINST(4,DUZ(2)_",",1.04,"E"),ORADDNUM=ORADDNUM+1
"RTN","ORDEA",70,0)
 I ORADDNUM=0 D
"RTN","ORDEA",71,0)
 .S ORI=ORI+1,ORY(ORI)="No Address on record"
"RTN","ORDEA",72,0)
 .I $L(ORINST(4,DUZ(2)_",",.01,"E"))>0 S ORI=ORI+1,ORY(ORI)="for "_ORINST(4,DUZ(2)_",",.01,"E")
"RTN","ORDEA",73,0)
 ;dea #
"RTN","ORDEA",74,0)
 S ORI=ORI+1,ORY(ORI)="DEA: "_$$DEA^XUSER(,ORPROV)
"RTN","ORDEA",75,0)
 ;detox #
"RTN","ORDEA",76,0)
 N ORDETOX S ORDETOX=$$DETOX^XUSER(ORPROV)
"RTN","ORDEA",77,0)
 I $L(ORDETOX)>0 S ORI=ORI+1,ORY(ORI)="Detox: "_ORDETOX
"RTN","ORDEA",78,0)
 Q
"RTN","ORDEA",79,0)
HASHINFO(ORY,ORDFN,ORPROV) ;basic data for all orders getting signed
"RTN","ORDEA",80,0)
 N ORI S ORI=0
"RTN","ORDEA",81,0)
 ;patient name
"RTN","ORDEA",82,0)
 S ORI=ORI+1,ORY(ORI)="PatientName:"_$P(^DPT(+ORDFN,0),U)
"RTN","ORDEA",83,0)
 ;patient address
"RTN","ORDEA",84,0)
 N VAPA,DFN,ORPATADD
"RTN","ORDEA",85,0)
 S DFN=ORDFN
"RTN","ORDEA",86,0)
 D ADD^VADPT
"RTN","ORDEA",87,0)
 S ORPATADD=VAPA(1)_U_VAPA(2)_U_VAPA(3)_U_VAPA(4)_U_$P(VAPA(5),"^")_U_$P(VAPA(5),"^",2)_U_VAPA(6)_U_VAPA(7)
"RTN","ORDEA",88,0)
 S ORI=ORI+1,ORY(ORI)="PatientAddress:"_ORPATADD
"RTN","ORDEA",89,0)
 ;date of issuance
"RTN","ORDEA",90,0)
 S ORI=ORI+1,ORY(ORI)="IssuanceDate:"_$$FMTE^XLFDT($$DT^XLFDT)
"RTN","ORDEA",91,0)
 S ORI=ORI+1,ORY(ORI)="IssuanceInt:"_$$DT^XLFDT
"RTN","ORDEA",92,0)
 ;provider name
"RTN","ORDEA",93,0)
 S ORI=ORI+1,ORY(ORI)="ProviderName:"_$$GET1^DIQ(200,ORPROV,.01,"E")
"RTN","ORDEA",94,0)
 S ORI=ORI+1,ORY(ORI)="ProviderNumber:"_ORPROV
"RTN","ORDEA",95,0)
 ;provider address (facility address)
"RTN","ORDEA",96,0)
 N ORINST
"RTN","ORDEA",97,0)
 D GETS^DIQ(4,DUZ(2),".01;.02;1.01;1.02;1.03;1.04","E","ORINST")
"RTN","ORDEA",98,0)
 S ORI=ORI+1,ORY(ORI)="ProviderAddress:"_ORINST(4,DUZ(2)_",",1.01,"E")_U_ORINST(4,DUZ(2)_",",1.02,"E")_U_ORINST(4,DUZ(2)_",",1.03,"E")_U_ORINST(4,DUZ(2)_",",.02,"E")_U_ORINST(4,DUZ(2)_",",1.04,"E")
"RTN","ORDEA",99,0)
 S ORI=ORI+1,ORY(ORI)="ProviderAdd1:"_ORINST(4,DUZ(2)_",",.01,"E")
"RTN","ORDEA",100,0)
 ;dea #
"RTN","ORDEA",101,0)
 S ORI=ORI+1,ORY(ORI)="DeaNumber:"_$$DEA^XUSER(,ORPROV)
"RTN","ORDEA",102,0)
 ;detox #
"RTN","ORDEA",103,0)
 N ORDETOX S ORDETOX=$$DETOX^XUSER(ORPROV)
"RTN","ORDEA",104,0)
 I $L(ORDETOX)>0 S ORI=ORI+1,ORY(ORI)="DetoxNumber:"_ORDETOX
"RTN","ORDEA",105,0)
 Q
"RTN","ORDEA",106,0)
ORDHINFO(ORY,ORIFN,HASH,OHINFO) ;
"RTN","ORDEA",107,0)
 N IENS
"RTN","ORDEA",108,0)
 D BUILDFDA(ORIFN,.ORDFDA,.ORY,$G(HASH),.OHINFO)
"RTN","ORDEA",109,0)
 Q
"RTN","ORDEA",110,0)
BUILDFDA(ORIFN,ORDFDA,OROUT,HASH,OHD) ;
"RTN","ORDEA",111,0)
 ;ORIFN is the CPRS order number to use
"RTN","ORDEA",112,0)
 ;this will need to be updated once we have a way to store DEA and DETOX
"RTN","ORDEA",113,0)
 ;numbers that are retrieved during validation
"RTN","ORDEA",114,0)
 ;returns 0 if not successful, 1 if successful
"RTN","ORDEA",115,0)
 N ERROR,ORDIALOG,A,PIEN,DFN,S1,DOSE,SCHED,ROUTE,I
"RTN","ORDEA",116,0)
 N CONJ,INSTR,SCHED,DUR,DOSE,VADM
"RTN","ORDEA",117,0)
 I $G(ORIFN)="" Q 0
"RTN","ORDEA",118,0)
 K ^TMP($J,"ORDEA")
"RTN","ORDEA",119,0)
 S ORDIALOG=$$GET1^DIQ(100,ORIFN_",",2,"I") I ORDIALOG="" Q 0
"RTN","ORDEA",120,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD("^OR(100,"_ORIFN_",4.5)")
"RTN","ORDEA",121,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION"),DOSE=$$PTR("DOSE")
"RTN","ORDEA",122,0)
 S CONJ=$$PTR("AND/THEN"),ROUTE=$$PTR("ROUTE")
"RTN","ORDEA",123,0)
 S IENS="+1,"
"RTN","ORDEA",124,0)
 F I=1:1 Q:'$D(OHD(I))  D
"RTN","ORDEA",125,0)
 . I $G(OHD(I))["IssuanceInt" S ORDFDA(101.52,IENS,4)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",126,0)
 . I $G(OHD(I))["ProviderNumber" S ORDFDA(101.52,IENS,31)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",127,0)
 . I $G(OHD(I))["ProviderName" S ORDFDA(101.52,IENS,12)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",128,0)
 . I $G(OHD(I))["DeaNumber" S ORDFDA(101.52,IENS,10)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",129,0)
 . I $G(OHD(I))["DetoxNumber" S ORDFDA(101.52,IENS,11)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",130,0)
 . I $G(OHD(I))["ProviderAdd1" S ORDFDA(101.52,IENS,13)=$P(OHD(I),":",2,99) Q
"RTN","ORDEA",131,0)
 . I $G(OHD(I))["ProviderAddress" D
"RTN","ORDEA",132,0)
 .. S A=$P(OHD(I),":",2,99)
"RTN","ORDEA",133,0)
 .. S ORDFDA(101.52,IENS,14)=$P(A,"^"),ORDFDA(101.52,IENS,15)=$P(A,"^",2)
"RTN","ORDEA",134,0)
 .. S ORDFDA(101.52,IENS,16)=$P(A,"^",3),ORDFDA(101.52,IENS,17)=$P(A,"^",4)
"RTN","ORDEA",135,0)
 .. S ORDFDA(101.52,IENS,17.5)=$P(A,"^",5)
"RTN","ORDEA",136,0)
 . I $G(OHD(I))["PatientAddress" D
"RTN","ORDEA",137,0)
 .. S A=$P(OHD(I),":",2,99)
"RTN","ORDEA",138,0)
 .. S ORDFDA(101.52,IENS,21)=$P(A,"^"),ORDFDA(101.52,IENS,22)=$P(A,"^",2),ORDFDA(101.52,IENS,24)=$P(A,"^",3)
"RTN","ORDEA",139,0)
 .. S ORDFDA(101.52,IENS,25)=$P(A,"^",4),ORDFDA(101.52,IENS,26)=$P(A,"^",6),ORDFDA(101.52,IENS,27)=$P(A,"^",7)
"RTN","ORDEA",140,0)
 S ORDFDA(101.52,IENS,.01)=ORIFN
"RTN","ORDEA",141,0)
 S A=$P($G(ORDIALOG("B","DISPENSE DRUG")),"^",2),PIEN=$G(ORDIALOG(A,1)) D
"RTN","ORDEA",142,0)
 . I PIEN="" S OROUT(1)="DrugName:" Q
"RTN","ORDEA",143,0)
 . D DATA^PSS50(PIEN,"","","","","ORDEA")
"RTN","ORDEA",144,0)
 . S ORDFDA(101.52,IENS,6)=^TMP($J,"ORDEA",PIEN,.01),ORDFDA(101.52,IENS,29)=PIEN,ORDFDA(101.52,IENS,30)=^TMP($J,"ORDEA",PIEN,3)
"RTN","ORDEA",145,0)
 . S OROUT(1)="DrugName:"_^TMP($J,"ORDEA",PIEN,.01)
"RTN","ORDEA",146,0)
 S INSTR=$O(^ORD(101.41,"AB","OR GTX INSTRUCTIONS",0))
"RTN","ORDEA",147,0)
 S A=$P($G(ORDIALOG("B","QUANTITY")),"^",2),ORDFDA(101.52,IENS,8)=$G(ORDIALOG(A,1))
"RTN","ORDEA",148,0)
 S OROUT(2)="Quantity:"_$G(ORDIALOG(A,1))
"RTN","ORDEA",149,0)
 S A=$P($G(ORDIALOG("B","REFILLS")),"^",2),ORDFDA(101.52,IENS,28)=$G(ORDIALOG(A,1))
"RTN","ORDEA",150,0)
 S S1=0 F I=1:1 Q:'$D(ORDIALOG(INSTR,I))  D
"RTN","ORDEA",151,0)
 . S A=$P($G(ORDIALOG(DOSE,I)),"&",1,6)_"|"_$G(ORDIALOG(SCHED,I))_"|"_$$DUR($G(ORDIALOG(DUR,I)))_"|"_$$CONJ($G(ORDIALOG(CONJ,I)))_"|"_$G(ORDIALOG(ROUTE,I))
"RTN","ORDEA",152,0)
 . S ORDFDA(101.529,"+"_(I+1)_","_IENS,.01)=A
"RTN","ORDEA",153,0)
 . I '$D(OROUT(3)) S OROUT(3)="Directions:"_A
"RTN","ORDEA",154,0)
 . E  S OROUT(3)=OROUT(3)_A
"RTN","ORDEA",155,0)
 S A=+$$GET1^DIQ(100,ORIFN_",",6,"I"),A=$$GET1^DIQ(44,A,3,"I")
"RTN","ORDEA",156,0)
 S DFN=+$$GET1^DIQ(100,ORIFN_",",.02,"I"),A=$$GETICN^MPIF001(DFN),ORDFDA(101.52,IENS,20)=$S(A["^":"",1:A)
"RTN","ORDEA",157,0)
 D DEM^VADPT S ORDFDA(101.52,IENS,18)=VADM(1),ORDFDA(101.52,IENS,19)=DFN
"RTN","ORDEA",158,0)
 S ORDFDA(101.52,IENS,2)=$G(HASH)
"RTN","ORDEA",159,0)
 Q
"RTN","ORDEA",160,0)
BUILD(ORIFN) ;Build ARCHIVE entry for CPRS order number
"RTN","ORDEA",161,0)
 N ORDFDA,OROUT,ERROR
"RTN","ORDEA",162,0)
 D BUILDFDA(ORIFN,.ORDFDA,.OROUT)
"RTN","ORDEA",163,0)
 D UPDATE^DIE("","ORDFDA","ORIEN","ERROR")
"RTN","ORDEA",164,0)
 Q 1
"RTN","ORDEA",165,0)
SUBSCRIB(ORIFN,RXN) ;API for Pharmacy to subscribe to an archive entry
"RTN","ORDEA",166,0)
 ;ORIFN is the CPRS order number of the archive Pharmacy wants to use
"RTN","ORDEA",167,0)
 ;RXN is the Pharmacy prescription number that is subscribing to the archive
"RTN","ORDEA",168,0)
 ;returns a 0 if not successful
"RTN","ORDEA",169,0)
 ;returns a 1 if successful
"RTN","ORDEA",170,0)
 N A,IEN,ORDFDA,ERROR
"RTN","ORDEA",171,0)
 I $G(ORIFN)=""!($G(RXN)="") Q 0
"RTN","ORDEA",172,0)
 S IEN=$$FIND1^DIC(101.52,"","MXQ",ORIFN,"","","ERR")
"RTN","ORDEA",173,0)
 I 'IEN Q 0
"RTN","ORDEA",174,0)
 S A=$$GET1^DIQ(101.52,IEN_",",1,"I") I A]"",A'=RXN Q 0
"RTN","ORDEA",175,0)
 S ORDFDA(101.52,IEN_",",1)=RXN
"RTN","ORDEA",176,0)
 D FILE^DIE("","ORDFDA","ERROR")
"RTN","ORDEA",177,0)
 I $D(ERROR) Q 0
"RTN","ORDEA",178,0)
 Q 1
"RTN","ORDEA",179,0)
ARCHIVE(ORIFN) ;retrieve archive for specified order number
"RTN","ORDEA",180,0)
 ;ORIFN is the CPRS order number whose archive is requested
"RTN","ORDEA",181,0)
 I $G(ORIFN)="" Q
"RTN","ORDEA",182,0)
 K ^TMP($J,"ORDEA",ORIFN) N IEN,ERROR,ORDEA,A,I,S1
"RTN","ORDEA",183,0)
 S IEN=$$FIND1^DIC(101.52,"","MXQ",ORIFN,"","","ERR")
"RTN","ORDEA",184,0)
 I 'IEN Q
"RTN","ORDEA",185,0)
 S IEN=IEN_","
"RTN","ORDEA",186,0)
 D GETS^DIQ(101.52,IEN,"**","IE","ORDEA","ERROR") I $D(ERROR) Q
"RTN","ORDEA",187,0)
 S A(1)="" F I=1,4,6,29,30,8,28 S A(1)=A(1)_$G(ORDEA(101.52,IEN,I,"I"))_"^"
"RTN","ORDEA",188,0)
 S A(1)=$P(A(1),"^",1,7)
"RTN","ORDEA",189,0)
 S A(2)="" F I=10,11,12,31 S A(2)=A(2)_$G(ORDEA(101.52,IEN,I,"I"))_"^"
"RTN","ORDEA",190,0)
 S A(2)=$P(A(2),"^",1,4)
"RTN","ORDEA",191,0)
 S A(3)="" F I=13,14,15,16,17,17.5 S A(3)=A(3)_$G(ORDEA(101.52,IEN,I,"I"))_"^"
"RTN","ORDEA",192,0)
 S A(3)=$P(A(3),"^",1,6)
"RTN","ORDEA",193,0)
 S A(4)="" F I=18,19,20 S A(4)=A(4)_$G(ORDEA(101.52,IEN,I,"I"))_"^"
"RTN","ORDEA",194,0)
 S A(4)=$P(A(4),"^",1,3)
"RTN","ORDEA",195,0)
 S A(5)="" F I=21,22,24,25,26,27 S A(5)=A(5)_$G(ORDEA(101.52,IEN,I,"I"))_"^"
"RTN","ORDEA",196,0)
 S A(5)=$P(A(5),"^",1,6)
"RTN","ORDEA",197,0)
 F I=1:1:5 S ^TMP($J,"ORDEA",ORIFN,I)=A(I)
"RTN","ORDEA",198,0)
 S S1=0 F  S S1=$O(ORDEA(101.529,S1)) Q:'S1  S ^TMP($J,"ORDEA",ORIFN,6,$P(S1,","))=ORDEA(101.529,S1,.01,"I")
"RTN","ORDEA",199,0)
 Q
"RTN","ORDEA",200,0)
HASHRTN(ORIFN) ;returns hash of a specified archive entry
"RTN","ORDEA",201,0)
 ;ORIFN is the CPRS order number for the archive
"RTN","ORDEA",202,0)
 N IEN,ORHASH,ERR,ERROR
"RTN","ORDEA",203,0)
 S IEN=$$FIND1^DIC(101.52,"","MXQ",ORIFN,"","","ERR")
"RTN","ORDEA",204,0)
 I 'IEN Q 0
"RTN","ORDEA",205,0)
 S IEN=IEN_","
"RTN","ORDEA",206,0)
 S ORHASH=$$GET1^DIQ(101.52,IEN,2,"I","","ERROR") I $D(ERROR) Q 0
"RTN","ORDEA",207,0)
 Q ORHASH
"RTN","ORDEA",208,0)
BACKDOOR(ORIFN,ORPROV,ORD) ;create archive for new backdoor order
"RTN","ORDEA",209,0)
 ;called from ORMPS
"RTN","ORDEA",210,0)
 N DFN,OHD,OUT,ORDFDA,PIEN,A,ORSCHED,S1
"RTN","ORDEA",211,0)
 K ^TMP($J,"ORDEAB")
"RTN","ORDEA",212,0)
 Q:$G(ORIFN)=""  I '$D(^OR(100,ORIFN,0)) Q
"RTN","ORDEA",213,0)
 I $P($G(^ORD(101.41,+ORD,0)),"^")'="PSO OERR" Q
"RTN","ORDEA",214,0)
 S S1=0 F  S S1=$O(ORD(S1)) Q:'S1  I $P(ORD(S1),"^",2)["DRUG" S PIEN=$G(ORD(S1,1)) I PIEN]"" Q
"RTN","ORDEA",215,0)
 I $G(PIEN)="" Q
"RTN","ORDEA",216,0)
 D DATA^PSS50(PIEN,"","","","","ORDEAB") S ORSCHED=$G(^TMP($J,"ORDEAB",PIEN,3))
"RTN","ORDEA",217,0)
 I ORSCHED'?1N.E Q
"RTN","ORDEA",218,0)
 I ",2,3,4,5,"'[$E(ORSCHED) Q
"RTN","ORDEA",219,0)
 S DFN=+$P($G(^OR(100,ORIFN,0)),"^",2)
"RTN","ORDEA",220,0)
 D HASHINFO(.OHD,DFN,ORPROV)
"RTN","ORDEA",221,0)
 D BUILDFDA(ORIFN,.ORDFDA,.OUT,"",.OHD)
"RTN","ORDEA",222,0)
 S ORDFDA(101.52,IENS,1)=$G(^OR(100,ORIFN,4))
"RTN","ORDEA",223,0)
 D UPDATE^DIE("","ORDFDA","","ERROR")
"RTN","ORDEA",224,0)
 Q
"RTN","ORDEA",225,0)
PINLKCHK(ORY) ;check if the current user has an active PIN lock
"RTN","ORDEA",226,0)
 ;ORY=1 if there is an active lock and ORY=0 if no active lock
"RTN","ORDEA",227,0)
 S ORY=0
"RTN","ORDEA",228,0)
 Q:'$D(^XTMP("OR DEA PIN LOCK",DUZ))
"RTN","ORDEA",229,0)
 N ORDIFF
"RTN","ORDEA",230,0)
 S ORDIFF=$$FMDIFF^XLFDT($$NOW^XLFDT,$G(^XTMP("OR DEA PIN LOCK",DUZ)),2)
"RTN","ORDEA",231,0)
 ;CHECK IF LOCK IS LESS THAN 15 MINUTES OLD
"RTN","ORDEA",232,0)
 I ORDIFF<900 S ORY=1
"RTN","ORDEA",233,0)
 Q
"RTN","ORDEA",234,0)
PINLKSET(ORY) ;set a PIN lock on the current user
"RTN","ORDEA",235,0)
 S ^XTMP("OR DEA PIN LOCK",0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","ORDEA",236,0)
 S ^XTMP("OR DEA PIN LOCK",DUZ)=$$NOW^XLFDT
"RTN","ORDEA",237,0)
 S ORY=^XTMP("OR DEA PIN LOCK",DUZ)
"RTN","ORDEA",238,0)
 Q
"RTN","ORDEA",239,0)
LNKMSG(ORY) ;message to display after successful PIV link for admin contact person
"RTN","ORDEA",240,0)
 N I,ORTY
"RTN","ORDEA",241,0)
 D GETWP^XPAR(.ORTY,"DIV^SYS^PKG","OR DEA PIV LINK MSG")
"RTN","ORDEA",242,0)
 S I=0 F  S I=$O(ORTY(I)) Q:'I  S ORY(I)=ORTY(I,0)
"RTN","ORDEA",243,0)
 Q
"RTN","ORDEA",244,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORDEA",245,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORDEA",246,0)
DUR(DUR) ;
"RTN","ORDEA",247,0)
 Q $S(DUR="":"",DUR=0:"",1:$E($P(DUR," ",2))_+DUR)
"RTN","ORDEA",248,0)
CONJ(CNJ) ;
"RTN","ORDEA",249,0)
 Q $S(CNJ="":"",CNJ'="T":CNJ,1:"S")
"RTN","ORDEA01")
0^8^B44517612^B39471115
"RTN","ORDEA01",1,0)
ORDEA01 ;ISP/RFR - DEA TOOLS;03/20/2013  07:07
"RTN","ORDEA01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**218,374**;Dec 17, 1997;Build 9
"RTN","ORDEA01",3,0)
 ;
"RTN","ORDEA01",4,0)
 ;
"RTN","ORDEA01",5,0)
 ;
"RTN","ORDEA01",6,0)
 ;
"RTN","ORDEA01",7,0)
 Q
"RTN","ORDEA01",8,0)
SITE ;Edit the site-level parameter
"RTN","ORDEA01",9,0)
 N DA,SITE
"RTN","ORDEA01",10,0)
 S DA=$O(^ORD(100.7,0))
"RTN","ORDEA01",11,0)
 I +$G(DA)=0 D
"RTN","ORDEA01",12,0)
 .N FDA,ERROR,IEN
"RTN","ORDEA01",13,0)
 .S SITE=$P($$SITE^VASITE(),U,2)
"RTN","ORDEA01",14,0)
 .S FDA(100.7,"+1,",.01)=SITE,FDA(100.7,"+1,",.02)="YES"
"RTN","ORDEA01",15,0)
 .D UPDATE^DIE("E","FDA","IEN","ERROR")
"RTN","ORDEA01",16,0)
 .I $D(ERROR) D  Q
"RTN","ORDEA01",17,0)
 ..N IDX
"RTN","ORDEA01",18,0)
 ..S IDX=0 F  S IDX=$O(ERROR("DIERR",IDX)) Q:'IDX  D
"RTN","ORDEA01",19,0)
 ...W "FILEMAN ERROR #"_ERROR("DIERR",IDX)_":",!
"RTN","ORDEA01",20,0)
 ...W ERROR("DIERR",IDX,"TEXT",1)
"RTN","ORDEA01",21,0)
 .S DA=IEN(1)
"RTN","ORDEA01",22,0)
 I +$G(DA)>0,($G(SITE)="") S SITE=$$GET1^DIQ(100.7,DA_",",.01)
"RTN","ORDEA01",23,0)
 Q:+$G(DA)=0
"RTN","ORDEA01",24,0)
 W !!,"This option is used to enable or disable electronic prescribing of outpatient",!
"RTN","ORDEA01",25,0)
 W "controlled substances for your entire site. Yes enables it and No disables it.",!
"RTN","ORDEA01",26,0)
 W !,"CONFIGURING SITE "_SITE,!
"RTN","ORDEA01",27,0)
 N DIE,DR
"RTN","ORDEA01",28,0)
 S DIE="^ORD(100.7,",DR=.02
"RTN","ORDEA01",29,0)
 D ^DIE
"RTN","ORDEA01",30,0)
 Q
"RTN","ORDEA01",31,0)
USER ;Edit user-level parameter
"RTN","ORDEA01",32,0)
 N DA
"RTN","ORDEA01",33,0)
 S DA=$O(^ORD(100.7,0))
"RTN","ORDEA01",34,0)
 I +$G(DA)=0 D  Q
"RTN","ORDEA01",35,0)
 .W !!,"NO SITE CONFIGURED.",!!
"RTN","ORDEA01",36,0)
 .W "You must first run the ePCS Site Enable/Disable [OR EPCS SITE PARAMETER] option",!
"RTN","ORDEA01",37,0)
 .W "before running this option.",!
"RTN","ORDEA01",38,0)
 .H 4
"RTN","ORDEA01",39,0)
 W !!,"This option is used to enable or disable electronic prescribing of outpatient",!
"RTN","ORDEA01",40,0)
 W "controlled substances for individual users.",!
"RTN","ORDEA01",41,0)
 W !,"CONFIGURING SITE "_$$GET1^DIQ(100.7,DA_",",.01),!
"RTN","ORDEA01",42,0)
 N EXIT
"RTN","ORDEA01",43,0)
 F  D  Q:+$G(EXIT)
"RTN","ORDEA01",44,0)
 .N DIC,X,Y,DTOUT,DUOUT,IEN,ACTION,DIR,DIRUT,DIROUT
"RTN","ORDEA01",45,0)
 .S DIC="^VA(200,",DIC(0)="AEQ",DIC("A")="Select the USER NAME: "
"RTN","ORDEA01",46,0)
 .D ^DIC
"RTN","ORDEA01",47,0)
 .S:+Y<1 EXIT=1
"RTN","ORDEA01",48,0)
 .Q:+Y<1
"RTN","ORDEA01",49,0)
 .S IEN=Y,ACTION=$S($D(^ORD(100.7,"C",+IEN)):"enabled^disable",1:"disabled^enable")
"RTN","ORDEA01",50,0)
 .W !!,$P(IEN,U,2)_" is currently "_$P(ACTION,U,1)_"."
"RTN","ORDEA01",51,0)
 .K X,Y
"RTN","ORDEA01",52,0)
 .S DIR(0)="Y^A",DIR("A")="Do you want to "_$P(ACTION,U,2)_" "_$P(IEN,U,2)
"RTN","ORDEA01",53,0)
 .S DIR("B")="NO"
"RTN","ORDEA01",54,0)
 .D ^DIR
"RTN","ORDEA01",55,0)
 .Q:$D(DIRUT)
"RTN","ORDEA01",56,0)
 .I Y=1 D
"RTN","ORDEA01",57,0)
 ..N FDA,ERROR,SCHEDULES,SEX
"RTN","ORDEA01",58,0)
 ..I $P(ACTION,U,1)="disabled" D
"RTN","ORDEA01",59,0)
 ...N RETURN,PROBLEM,OUTPUT,TEXT,DELIMIT,COUNT
"RTN","ORDEA01",60,0)
 ...S RETURN=$$VDEA^XUSER(.RETURN,+IEN),SEX=$$GET1^DIQ(200,+IEN_",",4),SEX=$S(SEX="MALE":"he",SEX="FEMALE":"she",1:"it")
"RTN","ORDEA01",61,0)
 ... I 'RETURN D
"RTN","ORDEA01",62,0)
 .... S PROBLEM="" F  S PROBLEM=$O(RETURN(PROBLEM)) Q:PROBLEM=""  D
"RTN","ORDEA01",63,0)
 ..... I PROBLEM["DEA number with no expiration date" K RETURN(PROBLEM)
"RTN","ORDEA01",64,0)
 ..... I PROBLEM["expired DEA number" K RETURN(PROBLEM)
"RTN","ORDEA01",65,0)
 .... S PROBLEM=$O(RETURN("")) I PROBLEM["permitted to prescribe all schedules",$O(RETURN(PROBLEM))="" S RETURN=1
"RTN","ORDEA01",66,0)
 ...I RETURN D
"RTN","ORDEA01",67,0)
 ....S FDA(100.71,"+1,"_DA_",",.01)=+IEN
"RTN","ORDEA01",68,0)
 ....D UPDATE^DIE("S","FDA",,"ERROR")
"RTN","ORDEA01",69,0)
 ...S PROBLEM="" F  S PROBLEM=$O(RETURN(PROBLEM)) Q:$G(PROBLEM)=""  D
"RTN","ORDEA01",70,0)
 ....I PROBLEM'["Is permitted to prescribe" D
"RTN","ORDEA01",71,0)
 .....S COUNT=+$G(COUNT)+1,PROBLEM(COUNT)=$$LOW^XLFSTR($E(PROBLEM,1))_$P($E(PROBLEM,2,*),".",1)
"RTN","ORDEA01",72,0)
 .....S:PROBLEM(COUNT)["user account status:" PROBLEM(COUNT)=$P(PROBLEM(COUNT),":",1)_" is"_$P(PROBLEM(COUNT),":",2)
"RTN","ORDEA01",73,0)
 ....S:PROBLEM["Is permitted to prescribe" SCHEDULES=$$LOW^XLFSTR($E(PROBLEM,1))_$E(PROBLEM,2,*)
"RTN","ORDEA01",74,0)
 ...S PROBLEM=+$G(COUNT)
"RTN","ORDEA01",75,0)
 ...I 'RETURN D
"RTN","ORDEA01",76,0)
 ....W !!
"RTN","ORDEA01",77,0)
 ....S DELIMIT=", "
"RTN","ORDEA01",78,0)
 ....F COUNT=1:1:PROBLEM  D
"RTN","ORDEA01",79,0)
 .....S:COUNT=PROBLEM DELIMIT=" and "
"RTN","ORDEA01",80,0)
 .....S TEXT=$S($G(TEXT)'="":TEXT_DELIMIT,1:"")_PROBLEM(COUNT)
"RTN","ORDEA01",81,0)
 ....S TEXT="Cannot enable "_$P(IEN,U,2)_" to sign controlled substance orders because "_$S($E(TEXT,1,4)'="user":SEX_" ",1:"")_TEXT_"."
"RTN","ORDEA01",82,0)
 ....D WRAP^ORUTL(TEXT,"OUTPUT")
"RTN","ORDEA01",83,0)
 ....F COUNT=1:1:OUTPUT W OUTPUT(COUNT),!
"RTN","ORDEA01",84,0)
 ..I $P(ACTION,U,1)="enabled" D
"RTN","ORDEA01",85,0)
 ...S FDA(100.71,$O(^ORD(100.7,"C",+IEN,DA,0))_","_DA_",",.01)="@"
"RTN","ORDEA01",86,0)
 ...D FILE^DIE("S","FDA","ERROR")
"RTN","ORDEA01",87,0)
 ..I $D(ERROR) D
"RTN","ORDEA01",88,0)
 ...N IDX
"RTN","ORDEA01",89,0)
 ...S IDX=0 F  S IDX=$O(ERROR("DIERR",IDX)) Q:'IDX  D
"RTN","ORDEA01",90,0)
 ....W !!,"FILEMAN ERROR #"_ERROR("DIERR",IDX)_":",!
"RTN","ORDEA01",91,0)
 ....W ERROR("DIERR",IDX,"TEXT",1),!
"RTN","ORDEA01",92,0)
 ..I '$D(ERROR),($D(FDA)) D
"RTN","ORDEA01",93,0)
 ...N OUTPUT,COUNT,TEXT
"RTN","ORDEA01",94,0)
 ...S TEXT="Successfully "_$P(ACTION,U,2)_"d "_$P(IEN,U,2)
"RTN","ORDEA01",95,0)
 ...S TEXT=TEXT_$S($G(SCHEDULES)'="":" and "_SEX_" "_SCHEDULES,1:".")
"RTN","ORDEA01",96,0)
 ...D WRAP^ORUTL(TEXT,"OUTPUT")
"RTN","ORDEA01",97,0)
 ...W !!
"RTN","ORDEA01",98,0)
 ...F COUNT=1:1:OUTPUT W OUTPUT(COUNT),!
"RTN","ORDEA01",99,0)
 Q
"RTN","ORDEA01",100,0)
PRVCHK ;CHECK SINGLE PROVIDER IS PROPERLY SETUP
"RTN","ORDEA01",101,0)
 N DIC,Y,X,DTOUT,DUOUT
"RTN","ORDEA01",102,0)
 S DIC="^VA(200,",DIC(0)="AEOQ"
"RTN","ORDEA01",103,0)
 S DIC("A")="Select the provider: "
"RTN","ORDEA01",104,0)
 D ^DIC
"RTN","ORDEA01",105,0)
 Q:+Y<1
"RTN","ORDEA01",106,0)
 W !!
"RTN","ORDEA01",107,0)
 N STATUS,RETURN,TEXT,OUTPUT,LINE,LAST
"RTN","ORDEA01",108,0)
 S STATUS=$$VDEA^XUSER(.RETURN,+Y)
"RTN","ORDEA01",109,0)
 S STATUS=$$CHKSWIT(.RETURN,+Y,STATUS)
"RTN","ORDEA01",110,0)
 S TEXT="This provider is"_$S(STATUS=0:" not",1:"")_" able to write controlled substance orders"
"RTN","ORDEA01",111,0)
 I STATUS=0 S OUTPUT=2,OUTPUT(1)=TEXT_" for the",OUTPUT(2)="following reasons:"
"RTN","ORDEA01",112,0)
 I STATUS=1 S TEXT=TEXT_" and "
"RTN","ORDEA01",113,0)
 S RETURN="" F  S RETURN=$O(RETURN(RETURN)) Q:$G(RETURN)=""  D
"RTN","ORDEA01",114,0)
 .I STATUS=1 D
"RTN","ORDEA01",115,0)
 ..D WRAP^ORUTL(TEXT_"is"_$P(RETURN,"Is",2),"OUTPUT")
"RTN","ORDEA01",116,0)
 ..S TEXT=""
"RTN","ORDEA01",117,0)
 .I STATUS=0 D
"RTN","ORDEA01",118,0)
 ..I RETURN["Is permitted to prescribe" D WRAP^ORUTL("Once all of the issues above are resolved, the provider is"_$P(RETURN,"Is",2),"LAST")
"RTN","ORDEA01",119,0)
 ..I RETURN'["Is permitted to prescribe" S OUTPUT=OUTPUT+1,OUTPUT(OUTPUT)=RETURN
"RTN","ORDEA01",120,0)
 I '$D(OUTPUT) D WRAP^ORUTL(TEXT_"is permitted to prescribe any schedule.","OUTPUT")
"RTN","ORDEA01",121,0)
 F LINE=1:1:OUTPUT W OUTPUT(LINE),!
"RTN","ORDEA01",122,0)
 W:$D(LAST) !
"RTN","ORDEA01",123,0)
 F LINE=1:1:+$G(LAST) W LAST(LINE),!
"RTN","ORDEA01",124,0)
 G PRVCHK
"RTN","ORDEA01",125,0)
 Q
"RTN","ORDEA01",126,0)
CHKSWIT(RETURN,IEN,RETVAL) ;CHECK THE LITTLE SWITCH
"RTN","ORDEA01",127,0)
 I '$D(^ORD(100.7,"C",IEN)) D
"RTN","ORDEA01",128,0)
 .S RETURN("Is not an ENABLED USER in the OE/RR EPCS PARAMETERS file.")="",RETVAL=0
"RTN","ORDEA01",129,0)
 Q RETVAL
"RTN","ORDEA01",130,0)
REPORTS ;PROMPT THE USER FOR THE REPORT TO RUN
"RTN","ORDEA01",131,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,REP
"RTN","ORDEA01",132,0)
 S REP("CFG")="Provider Incomplete Configuration;INCOMPL^ORDEA01A;INCOMPLQ^ORDEA01A"
"RTN","ORDEA01",133,0)
 S REP("DUP")="Duplicate VA Numbers;DUPVA^ORDEA01A;DUPVAQ^ORDEA01A"
"RTN","ORDEA01",134,0)
 S REP("DET")="DETOX/MAINTENANCE ID List;DETOX^ORDEA01A;DETOXQ^ORDEA01A"
"RTN","ORDEA01",135,0)
 S REP("LAS")="Provider Last Names Containing Punctuation;LAST^ORDEA01A;LASTQ^ORDEA01A"
"RTN","ORDEA01",136,0)
 S REP("FEE")="Fee Basis/C & A Providers Without a DEA Number;FEEDEA^ORDEA01B;FEEDEAQ^ORDEA01B"
"RTN","ORDEA01",137,0)
 S DIR(0)="SO"
"RTN","ORDEA01",138,0)
 S REP="" F  S REP=$O(REP(REP)) Q:$G(REP)=""  S $P(DIR(0),U,2)=$P(DIR(0),U,2)_REP_":"_$P(REP(REP),";")_";"
"RTN","ORDEA01",139,0)
 S DIR("A")="Select the data validation report to run"
"RTN","ORDEA01",140,0)
 D ^DIR
"RTN","ORDEA01",141,0)
 Q:$D(DIRUT)
"RTN","ORDEA01",142,0)
 Q:'$D(REP(Y))
"RTN","ORDEA01",143,0)
 S REP=Y
"RTN","ORDEA01",144,0)
 D @$P(REP(Y),";",2)
"RTN","ORDEA01",145,0)
 Q
"RTN","ORDEA01",146,0)
DISPRMPT() ;PROMPT THE USER TO INCLUDE DISUSERED AND TERMINATED USERS
"RTN","ORDEA01",147,0)
 ;RETURNS: ^ IF USER QUIT OR TIMED OUT
"RTN","ORDEA01",148,0)
 ;         OTHERWISE, THE VALUE OF VARIABLE Y
"RTN","ORDEA01",149,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORDEA01",150,0)
 S DIR(0)="Y"_U,DIR("A",1)="Do you want to include DISUSERed and TERMINATED users"
"RTN","ORDEA01",151,0)
 S DIR("A")="in the output",DIR("B")="NO"
"RTN","ORDEA01",152,0)
 D ^DIR
"RTN","ORDEA01",153,0)
 Q:$D(DIRUT) U
"RTN","ORDEA01",154,0)
 Q Y
"RTN","ORWDXR")
0^2^B59460463^B55649537
"RTN","ORWDXR",1,0)
ORWDXR ;SLC/KCM/JDL - Utilites for Order Actions ;05/06/14  16:06
"RTN","ORWDXR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,134,141,149,187,190,213,243,331,306,349,374**;Dec 17, 1997;Build 9
"RTN","ORWDXR",3,0)
 ;
"RTN","ORWDXR",4,0)
ACTDCREA(DCIEN) ; Valid DC Reason
"RTN","ORWDXR",5,0)
 N X
"RTN","ORWDXR",6,0)
 S X=$G(^ORD(100.03,DCIEN,0))
"RTN","ORWDXR",7,0)
 I $P(X,U,4) Q 0
"RTN","ORWDXR",8,0)
 I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q 0
"RTN","ORWDXR",9,0)
 I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q 0
"RTN","ORWDXR",10,0)
 Q 1
"RTN","ORWDXR",11,0)
 ;
"RTN","ORWDXR",12,0)
ISREL(VAL,ORIFN) ; Return true if an order has been released
"RTN","ORWDXR",13,0)
 N STS S STS=$P(^OR(100,+ORIFN,3),U,3)
"RTN","ORWDXR",14,0)
 S VAL=$S(STS=10:0,STS=11:0,1:1)  ; false if delayed or unreleased order
"RTN","ORWDXR",15,0)
 Q
"RTN","ORWDXR",16,0)
RENEW(REC,ORIFN,ORVP,ORNP,ORL,FLDS,CPLX,ORAPPT) ; Renew an order
"RTN","ORWDXR",17,0)
 N ORDG
"RTN","ORWDXR",18,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORPKG
"RTN","ORWDXR",19,0)
 N ORDIALOG,PRMT,X0
"RTN","ORWDXR",20,0)
 N FSTDOSE,FST
"RTN","ORWDXR",21,0)
 ;*349 Allow for ORDUZ to come in through FLDS. Allow renewer to be specified by the caller.
"RTN","ORWDXR",22,0)
 S ORDUZ=$G(FLDS("ORDUZ"))
"RTN","ORWDXR",23,0)
 S (FSTDOSE,FST)=0
"RTN","ORWDXR",24,0)
 I '$D(CPLX) S CPLX=0
"RTN","ORWDXR",25,0)
 I '$G(ORAPPT) S ORAPPT=""
"RTN","ORWDXR",26,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDXR",27,0)
 S X0=^OR(100,+ORIFN,0)
"RTN","ORWDXR",28,0)
 S ORDG=$P(X0,U,11)
"RTN","ORWDXR",29,0)
 S ORPKG=$P(X0,U,14)
"RTN","ORWDXR",30,0)
 I $D(FLDS("ORCHECK")) M ORCHECK=FLDS("ORCHECK")
"RTN","ORWDXR",31,0)
 I $P(X0,U,5)["101.41," D                        ; version 3
"RTN","ORWDXR",32,0)
 . S ORDIALOG=+$P(X0,U,5),ORCAT=$P(^OR(100,+ORIFN,0),U,12)
"RTN","ORWDXR",33,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORWDXR",34,0)
 . I CPLX S FSTDOSE=$P($G(ORDIALOG("B","FIRST DOSE")),U,2) S:'FSTDOSE FSTDOSE=$$PTR^ORCD("OR GTX NOW")
"RTN","ORWDXR",35,0)
 . I FSTDOSE,$G(ORDIALOG(FSTDOSE,1)) K ORDIALOG(FSTDOSE,1)
"RTN","ORWDXR",36,0)
 E  D                                            ; version 2.5 generic
"RTN","ORWDXR",37,0)
 . S ORDIALOG=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDE",0))
"RTN","ORWDXR",38,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDXR",39,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX WORD PROCESSING 1",0))
"RTN","ORWDXR",40,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",41,0)
 . M ^TMP("ORWORD",$J,PRMT,1)=^OR(100,+ORIFN,1)
"RTN","ORWDXR",42,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXR",43,0)
 . I $P(X0,U,9) S ORDIALOG(PRMT,1)=$P(X0,U,9)
"RTN","ORWDXR",44,0)
 I +FLDS(1)=999 D  ; generic order
"RTN","ORWDXR",45,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)=$P(FLDS(1),U,2)
"RTN","ORWDXR",46,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE/TIME"),1)=$P(FLDS(1),U,3)
"RTN","ORWDXR",47,0)
 I ($O(^ORD(101.41,"AB","PS MEDS",0))>0),(+FLDS(1)=130)!(+FLDS(1)=135)!(+FLDS(1)=140),'$L($G(ORDIALOG($$PTR^ORCD("OR GTX SIG"),1))) D
"RTN","ORWDXR",48,0)
 . N ORDOSE,ORDRUG,ORCAT,ORWPSOI,PROMPT,DRUG
"RTN","ORWDXR",49,0)
 . S ORCAT=$P($G(^OR(100,+ORIFN,0)),U,12)
"RTN","ORWDXR",50,0)
 . S PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORWDXR",51,0)
 . S ORDRUG=$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORWDXR",52,0)
 . S ORWPSOI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDXR",53,0)
 . I ORWPSOI S ORWPSOI=+$P($G(^ORD(101.43,+ORWPSOI,0)),U,2)
"RTN","ORWDXR",54,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,$S(ORCAT="I":"U",1:"O"),ORVP)       ; dflt doses
"RTN","ORWDXR",55,0)
 . D D1^ORCDPS2  ; set up ORDOSE
"RTN","ORWDXR",56,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORWDXR",57,0)
 . I DRUG,ORCAT="O" D RESETID^ORCDPS
"RTN","ORWDXR",58,0)
 . D SIG^ORCDPS2
"RTN","ORWDXR",59,0)
 I +FLDS(1)=140 D  ; outpatient meds
"RTN","ORWDXR",60,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1) ; remove effective dt
"RTN","ORWDXR",61,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX REFILLS"),1)=$P(FLDS(1),U,4)
"RTN","ORWDXR",62,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX ROUTING"),1)=$P(FLDS(1),U,5)
"RTN","ORWDXR",63,0)
 . S PRMT=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORWDXR",64,0)
 . K ^TMP("ORWORD",$J,PRMT,1)
"RTN","ORWDXR",65,0)
 . S I=1 F  S I=$O(FLDS(I)) Q:'I  S ^TMP("ORWORD",$J,PRMT,1,I-1,0)=FLDS(I)
"RTN","ORWDXR",66,0)
 . S ^TMP("ORWORD",$J,PRMT,1,0)=U_U_(I-1)_U_(I-1)_U_DT_U
"RTN","ORWDXR",67,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",68,0)
 . N SIG,PI,X S SIG=$$PTR^ORCD("OR GTX SIG")
"RTN","ORWDXR",69,0)
 . S PI=$$PTR^ORCD("OR GTX PATIENT INSTRUCTIONS"),X=$$STR(PI)
"RTN","ORWDXR",70,0)
 . I $L(X),$$STR(SIG)[X S ORDIALOG(PI,"FORMAT")="@" ;PI in Sig
"RTN","ORWDXR",71,0)
 D RN^ORCSAVE
"RTN","ORWDXR",72,0)
 S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXR",73,0)
 Q
"RTN","ORWDXR",74,0)
RNWFLDS(LST,ORIFN) ; Return fields for renew action
"RTN","ORWDXR",75,0)
 ; LST(0)=RenewType^Start^Stop^Refills^Pickup  LST(n)=Comments
"RTN","ORWDXR",76,0)
 N X0,DG,PKG,RNWTYPE,START,STOP,REFILLS,OROI
"RTN","ORWDXR",77,0)
 S ORIFN=+ORIFN,X0=^OR(100,ORIFN,0),DG=$P(X0,U,11),PKG=$P(X0,U,14)
"RTN","ORWDXR",78,0)
 S PKG=$E($P(^DIC(9.4,PKG,0),U,2),1,2),DG=$P(^ORD(100.98,DG,0),U,3)
"RTN","ORWDXR",79,0)
 S LST(0)=$S(PKG="OR":999,PKG="PS"&(DG="O RX"):140,PKG="PS"&(DG="UD RX"):130,PKG="PS"&(DG="NV RX"):145,1:0)
"RTN","ORWDXR",80,0)
 I +LST(0)=140 D
"RTN","ORWDXR",81,0)
 . N ORPICK,ORPREV
"RTN","ORWDXR",82,0)
 . S ORPICK=$$DEFPICK^ORWDPS1("")
"RTN","ORWDXR",83,0)
 . I ORPICK="" D
"RTN","ORWDXR",84,0)
 .. N D3
"RTN","ORWDXR",85,0)
 .. S D3=$G(^OR(100,ORIFN,3))
"RTN","ORWDXR",86,0)
 .. I $P(D3,"^",3)=11,$P(D3,"^",11)=2 S ORPREV=$P(D3,"^",5) I ORPREV]"" S ORPICK=$$VAL(ORPREV,"PICKUP")
"RTN","ORWDXR",87,0)
 .. I $P(D3,"^",3)'=11 S ORPICK=$$VAL(ORIFN,"PICKUP")
"RTN","ORWDXR",88,0)
 .. I ORPICK="" S ORPICK="M^by Mail"
"RTN","ORWDXR",89,0)
 . S LST(0)=LST(0)_U_U_U_+$$VAL(ORIFN,"REFILLS")_U_ORPICK
"RTN","ORWDXR",90,0)
 . ;D WPVAL(.LST,ORIFN,"COMMENT")
"RTN","ORWDXR",91,0)
 I +LST(0)=999 S LST(0)=LST(0)_U_$$VAL(ORIFN,"START")_U_$$VAL(ORIFN,"STOP")
"RTN","ORWDXR",92,0)
 ; make sure start/stop times are relative times, otherwise use NOW, no Stop
"RTN","ORWDXR",93,0)
 ;I +$P(LST(0),U,2) S $P(LST(0),U,2)="NOW" ;DJE-VM *331 - moved to $$VAL
"RTN","ORWDXR",94,0)
 ;I +$P(LST(0),U,3)!($P(LST(0),U,3)="0") S $P(LST(0),U,3)=""
"RTN","ORWDXR",95,0)
 ;NEW STUFF AFTER THIS LINE OR*3*243
"RTN","ORWDXR",96,0)
 S $P(LST(0),U,9)=0
"RTN","ORWDXR",97,0)
 S OROI=$O(^OR(100,+ORIFN,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXR",98,0)
 Q:'OROI
"RTN","ORWDXR",99,0)
 S OROI=$G(^OR(100,+ORIFN,4.5,OROI,1))
"RTN","ORWDXR",100,0)
 Q:'OROI
"RTN","ORWDXR",101,0)
 S $P(LST(0),U,9)=$$ISCLOZ^ORALWORD(OROI)
"RTN","ORWDXR",102,0)
 ; add to LST node specifying if patient of ORIFN passes clozapine lab tests
"RTN","ORWDXR",103,0)
 I $P(LST(0),U,9) D
"RTN","ORWDXR",104,0)
 .N ORY,ORDFN,ORTMP
"RTN","ORWDXR",105,0)
 .S ORTMP=LST(0)
"RTN","ORWDXR",106,0)
 .K LST
"RTN","ORWDXR",107,0)
 .S LST(0)=ORTMP
"RTN","ORWDXR",108,0)
 .S ORDFN=$P(^OR(100,ORIFN,0),U,2)
"RTN","ORWDXR",109,0)
 .I $P(ORDFN,";",2)'="DPT(" Q
"RTN","ORWDXR",110,0)
 .S ORDFN=+ORDFN
"RTN","ORWDXR",111,0)
 .D ALLWORD^ORALWORD(.ORY,ORDFN,ORIFN,"E")
"RTN","ORWDXR",112,0)
 .M LST(1)=ORY
"RTN","ORWDXR",113,0)
 Q
"RTN","ORWDXR",114,0)
VAL(ORIFN,ID) ; Return value for order response
"RTN","ORWDXR",115,0)
 N DA,Y,ORDIALOG,ORDGDA,CAPS,XCODE
"RTN","ORWDXR",116,0)
 S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",117,0)
 I (ID="START")!(ID="STOP") D  I 1 ;DJE-VM *331
"RTN","ORWDXR",118,0)
 . ; make sure start/stop times are relative times, otherwise use dialog default values
"RTN","ORWDXR",119,0)
 . S CAPS=$$UP^XLFSTR($G(^OR(100,ORIFN,4.5,DA,1)))
"RTN","ORWDXR",120,0)
 . I ('$L(CAPS))!($E(CAPS)="T")!($E(CAPS)="V")!($E(CAPS)="N"&($E(CAPS,1,3)'="NOV")) S Y=CAPS Q
"RTN","ORWDXR",121,0)
 . S ORDIALOG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDXR",122,0)
 . S ORDGDA=+^OR(100,ORIFN,4.5,DA,0)
"RTN","ORWDXR",123,0)
 . S XCODE=$G(^ORD(101.41,+ORDIALOG,10,ORDGDA,7))
"RTN","ORWDXR",124,0)
 . I $L(XCODE) X XCODE
"RTN","ORWDXR",125,0)
 . I '$L($G(Y)),ID="START" S Y="NOW" ;if no default, set START to NOW
"RTN","ORWDXR",126,0)
 E  S Y=$G(^OR(100,ORIFN,4.5,DA,1))
"RTN","ORWDXR",127,0)
 Q $G(Y)
"RTN","ORWDXR",128,0)
WPVAL(TXT,ORIFN,ID) ; Return word processing value
"RTN","ORWDXR",129,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",130,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,4.5,DA,2,I)) Q:'I  S TXT(I)=^(I,0)
"RTN","ORWDXR",131,0)
 Q
"RTN","ORWDXR",132,0)
STR(PTR) ; -- Return word processing text as long string for comparison
"RTN","ORWDXR",133,0)
 N X,Y,I,ARRY
"RTN","ORWDXR",134,0)
 S ARRY=$G(ORDIALOG(+$G(PTR),1)) Q:'$L(ARRY) ""
"RTN","ORWDXR",135,0)
 S I=+$O(@ARRY@(0)),Y=$$UP^XLFSTR($G(@ARRY@(I,0)))
"RTN","ORWDXR",136,0)
 F  S I=+$O(@ARRY@(I)) Q:'I  S X=$G(@ARRY@(I,0)),Y=Y_$$UP^XLFSTR(X)
"RTN","ORWDXR",137,0)
 S Y=$TR(Y," ") ;remove all spaces, compare only text
"RTN","ORWDXR",138,0)
 Q Y
"RTN","ORWDXR",139,0)
CHKACT(ORDERID,ORWSIG,ORWREL,ORWNATR) ; Return error if can't sign/release order
"RTN","ORWDXR",140,0)
 N ORACT,ORWERR
"RTN","ORWDXR",141,0)
 ; begin case
"RTN","ORWDXR",142,0)
 S ORACT=""
"RTN","ORWDXR",143,0)
 I (ORWSIG=1),$D(^XUSEC("ORES",DUZ)) S ORACT="ES" G XC1
"RTN","ORWDXR",144,0)
 I (ORWSIG=7),$D(^XUSEC("ORES",DUZ)) S ORACT="DS" G XC1
"RTN","ORWDXR",145,0)
 I ORWREL,(ORWNATR="W") S ORACT="OC" G XC1
"RTN","ORWDXR",146,0)
 I ORWREL S ORACT="RS" S:$P($G(^OR(100,+ORDERID,0)),U,16)<2 ORACT="ES"
"RTN","ORWDXR",147,0)
XC1 ; end case
"RTN","ORWDXR",148,0)
 S ORWERR=""
"RTN","ORWDXR",149,0)
 I $L(ORACT),$$VALID^ORCACT0(ORDERID,ORACT,.ORWERR,ORWNATR) S ORWERR=""
"RTN","ORWDXR",150,0)
 Q ORWERR
"RTN","ORWDXR",151,0)
GTORITM(Y,ORIFN) ;-- Get back the orderable item IEN
"RTN","ORWDXR",152,0)
 S ORIFN=+ORIFN
"RTN","ORWDXR",153,0)
 S Y=$$VALUE^ORCSAVE2(ORIFN,"ORDERABLE")
"RTN","ORWDXR",154,0)
 Q
"RTN","ORWDXR",155,0)
GETPKG(Y,IFN) ;Get package for an order
"RTN","ORWDXR",156,0)
 N ORDERID,PKGID
"RTN","ORWDXR",157,0)
 Q:+IFN<1
"RTN","ORWDXR",158,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWDXR",159,0)
 S PKGID=$P(^OR(100,ORDERID,0),U,14)
"RTN","ORWDXR",160,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWDXR",161,0)
 Q
"RTN","ORWDXR",162,0)
ISCPLX(ORY,ORID) ; 1: is complex order 0: is not
"RTN","ORWDXR",163,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",164,0)
 N PKG
"RTN","ORWDXR",165,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",166,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",167,0)
 I PKG'="PS" Q
"RTN","ORWDXR",168,0)
 N NUMCHDS,NOWID,NOWVAL
"RTN","ORWDXR",169,0)
 S (NOWVAL,NOWID)=0
"RTN","ORWDXR",170,0)
 S NUMCHDS=$P($G(^OR(100,+ORID,2,0)),U,4)
"RTN","ORWDXR",171,0)
 I NUMCHDS>2 S ORY=1 Q
"RTN","ORWDXR",172,0)
 I NUMCHDS=2 D
"RTN","ORWDXR",173,0)
 . S ORY=1
"RTN","ORWDXR",174,0)
 . S:$D(^OR(100,+ORID,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXR",175,0)
 . S:NOWID NOWVAL=$G(^OR(100,+ORID,4.5,NOWID,1))
"RTN","ORWDXR",176,0)
 I NOWVAL=1 S ORY=0 Q
"RTN","ORWDXR",177,0)
 Q
"RTN","ORWDXR",178,0)
ORCPLX(ORY,ORID,ORACT) ;Return children orders of the complex order
"RTN","ORWDXR",179,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",180,0)
 N PKG,LACT,OELACT,ISNOW
"RTN","ORWDXR",181,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",182,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",183,0)
 I PKG'="PS" Q
"RTN","ORWDXR",184,0)
 N CHLDCNT,IDX,X3
"RTN","ORWDXR",185,0)
 S (CHLDCNT,IDX)=0
"RTN","ORWDXR",186,0)
 S:$L($G(^OR(100,+ORID,2,0))) CHLDCNT=$P(^(0),U,4)
"RTN","ORWDXR",187,0)
 I 'CHLDCNT Q
"RTN","ORWDXR",188,0)
 F  S IDX=$O(^OR(100,+ORID,2,IDX)) Q:'IDX  D
"RTN","ORWDXR",189,0)
 . S (LACT,OELACT,ISNOW)=0
"RTN","ORWDXR",190,0)
 . D ISNOW(.ISNOW,IDX)
"RTN","ORWDXR",191,0)
 . Q:ISNOW
"RTN","ORWDXR",192,0)
 . S X3=$G(^OR(100,IDX,3))
"RTN","ORWDXR",193,0)
 . S LACT=$P(X3,U,7)
"RTN","ORWDXR",194,0)
 . F  S OELACT=$O(^OR(100,IDX,8,OELACT),-1) Q:OELACT
"RTN","ORWDXR",195,0)
 . S:OELACT>LACT LACT=OELACT
"RTN","ORWDXR",196,0)
 . S ORY(IDX)=IDX_";"_LACT
"RTN","ORWDXR",197,0)
 Q
"RTN","ORWDXR",198,0)
CANRN(ORY,ORID) ; Check conjunction for renew.
"RTN","ORWDXR",199,0)
 ; All conjunctioni = "And" return 1
"RTN","ORWDXR",200,0)
 ; Has a "Then" return 0
"RTN","ORWDXR",201,0)
 Q:'$G(^OR(100,+ORID,0))
"RTN","ORWDXR",202,0)
 N PKG
"RTN","ORWDXR",203,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",204,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",205,0)
 I PKG'="PS" Q
"RTN","ORWDXR",206,0)
 N INDX,INDY,CANRENEW
"RTN","ORWDXR",207,0)
 S INDX=0
"RTN","ORWDXR",208,0)
 S CANRENEW=1
"RTN","ORWDXR",209,0)
 N CHID
"RTN","ORWDXR",210,0)
 S CHID=0 F  S CHID=$O(^OR(100,+ORID,2,CHID)) Q:'CHID  D
"RTN","ORWDXR",211,0)
 . N ORSTS,ACTIVE S ORSTS=0
"RTN","ORWDXR",212,0)
 . S ORSTS=$P($G(^OR(100,CHID,3)),U,3)
"RTN","ORWDXR",213,0)
 . S ACTIVE=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","ORWDXR",214,0)
 . I ACTIVE'=ORSTS S CANRENEW=0
"RTN","ORWDXR",215,0)
 I 'CANRENEW S ORY=CANRENEW Q
"RTN","ORWDXR",216,0)
 F  S INDX=$O(^OR(100,+ORID,4.5,"ID","CONJ",INDX)) Q:'INDX  D
"RTN","ORWDXR",217,0)
 . S INDY=0 F  S INDY=$O(^OR(100,+ORID,4.5,INDX,INDY)) Q:'INDY  D
"RTN","ORWDXR",218,0)
 . . I $G(^(INDY))="T" S CANRENEW=0 Q
"RTN","ORWDXR",219,0)
 . I CANRENEW=0 Q
"RTN","ORWDXR",220,0)
 S ORY=CANRENEW
"RTN","ORWDXR",221,0)
 Q
"RTN","ORWDXR",222,0)
ISNOW(ORY,ORID) ; Is first time now order?
"RTN","ORWDXR",223,0)
 N SCH
"RTN","ORWDXR",224,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",225,0)
 S SCH=""
"RTN","ORWDXR",226,0)
 S SCH=$O(^OR(100,+ORID,4.5,"ID","SCHEDULE",0))
"RTN","ORWDXR",227,0)
 S:SCH SCH=$G(^OR(100,+ORID,4.5,SCH,1))
"RTN","ORWDXR",228,0)
 S:SCH="NOW" ORY=1
"RTN","ORWDXR",229,0)
 Q
"RTN","ORY374")
0^10^B4039046^n/a
"RTN","ORY374",1,0)
ORY374 ;ISL/TC - Post-install for patch OR*3*374 ;12/12/13  11:45
"RTN","ORY374",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**374**;Dec 17, 1997;Build 9
"RTN","ORY374",3,0)
 ;
"RTN","ORY374",4,0)
 ;
"RTN","ORY374",5,0)
 ;
"RTN","ORY374",6,0)
 ;
"RTN","ORY374",7,0)
POST ; Initiate post-init processes
"RTN","ORY374",8,0)
 D UPDTNOT
"RTN","ORY374",9,0)
 Q
"RTN","ORY374",10,0)
UPDTNOT ; Update Message Type & Description fields of Notification #76 to accommodate Inactive Provider scenario.
"RTN","ORY374",11,0)
 N ORFDA,ORERROR,ORMSG,I
"RTN","ORY374",12,0)
 D BMES^XPDUTL("Updating the MESSSAGE TYPE & DESCRIPTION fields of the DEA CERTIFICATE EXPIRED notification...")
"RTN","ORY374",13,0)
 S ORFDA(100.9,"76,",.04)="PKG"
"RTN","ORY374",14,0)
 S ORFDA(100.9,"76,",4)="Triggered by Outpatient Pharmacy when the prescriber's PKI certificate expires after "
"RTN","ORY374",15,0)
 S ORFDA(100.9,"76,",4)=ORFDA(100.9,"76,",4)_"the order is submitted in CPRS, but prior to Pharmacy processing the order. "
"RTN","ORY374",16,0)
 S ORFDA(100.9,"76,",4)=ORFDA(100.9,"76,",4)_"Also triggered when prescriber's Rx profile becomes inactive during processing."
"RTN","ORY374",17,0)
 D FILE^DIE("K","ORFDA","ORERROR")
"RTN","ORY374",18,0)
 I $D(ORERROR) D  Q
"RTN","ORY374",19,0)
 .S ORMSG(1)=" "
"RTN","ORY374",20,0)
 .S ORMSG(2)="ERROR: Unable to update the MESSAGE TYPE & DESCRIPTION fields."
"RTN","ORY374",21,0)
 .S ORMSG(3)="VA FileMan Error #"_ORERROR("DIERR",1)_":"
"RTN","ORY374",22,0)
 .F I=1:1:+$O(ORERROR("DIERR",1,"TEXT","A"),-1) D
"RTN","ORY374",23,0)
 ..S ORMSG(I+3)=ORERROR("DIERR",1,"TEXT",I)
"RTN","ORY374",24,0)
 .D BMES^XPDUTL(.ORMSG)
"RTN","ORY374",25,0)
 Q
"RTN","ORYCHKE")
1^7^^B2490043
"VER")
8.0^22.0
"BLD",8759,6)
^342
**END**
**END**

