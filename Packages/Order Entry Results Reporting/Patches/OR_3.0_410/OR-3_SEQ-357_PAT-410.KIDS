Released OR*3*410 SEQ #357
Extracted from mail message
**KIDS**:OR*3.0*410^

**INSTALL NAME**
OR*3.0*410
"BLD",9946,0)
OR*3.0*410^ORDER ENTRY/RESULTS REPORTING^0^3150422^y
"BLD",9946,1,0)
^^6^6^3150422^^
"BLD",9946,1,1,0)
This patch corrects 2 issues within the ORDER ENTRY/RESULTS REPORTING 
"BLD",9946,1,2,0)
package:
"BLD",9946,1,3,0)
 
"BLD",9946,1,4,0)
1. Non-OERR alerts are being deleted without the rights to do so.
"BLD",9946,1,5,0)
 
"BLD",9946,1,6,0)
2. Typo in the CPRS User Guide:GUI Version.
"BLD",9946,4,0)
^9.64PA^^
"BLD",9946,6.3)
1
"BLD",9946,"KRN",0)
^9.67PA^779.2^20
"BLD",9946,"KRN",.4,0)
.4
"BLD",9946,"KRN",.401,0)
.401
"BLD",9946,"KRN",.402,0)
.402
"BLD",9946,"KRN",.403,0)
.403
"BLD",9946,"KRN",.5,0)
.5
"BLD",9946,"KRN",.84,0)
.84
"BLD",9946,"KRN",3.6,0)
3.6
"BLD",9946,"KRN",3.8,0)
3.8
"BLD",9946,"KRN",9.2,0)
9.2
"BLD",9946,"KRN",9.8,0)
9.8
"BLD",9946,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9946,"KRN",9.8,"NM",1,0)
ORWORB^^0^B74023568
"BLD",9946,"KRN",9.8,"NM","B","ORWORB",1)
 
"BLD",9946,"KRN",19,0)
19
"BLD",9946,"KRN",19.1,0)
19.1
"BLD",9946,"KRN",101,0)
101
"BLD",9946,"KRN",101,"NM",0)
^9.68A^^0
"BLD",9946,"KRN",409.61,0)
409.61
"BLD",9946,"KRN",771,0)
771
"BLD",9946,"KRN",779.2,0)
779.2
"BLD",9946,"KRN",870,0)
870
"BLD",9946,"KRN",8989.51,0)
8989.51
"BLD",9946,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",9946,"KRN",8989.52,0)
8989.52
"BLD",9946,"KRN",8994,0)
8994
"BLD",9946,"KRN","B",.4,.4)
 
"BLD",9946,"KRN","B",.401,.401)
 
"BLD",9946,"KRN","B",.402,.402)
 
"BLD",9946,"KRN","B",.403,.403)
 
"BLD",9946,"KRN","B",.5,.5)
 
"BLD",9946,"KRN","B",.84,.84)
 
"BLD",9946,"KRN","B",3.6,3.6)
 
"BLD",9946,"KRN","B",3.8,3.8)
 
"BLD",9946,"KRN","B",9.2,9.2)
 
"BLD",9946,"KRN","B",9.8,9.8)
 
"BLD",9946,"KRN","B",19,19)
 
"BLD",9946,"KRN","B",19.1,19.1)
 
"BLD",9946,"KRN","B",101,101)
 
"BLD",9946,"KRN","B",409.61,409.61)
 
"BLD",9946,"KRN","B",771,771)
 
"BLD",9946,"KRN","B",779.2,779.2)
 
"BLD",9946,"KRN","B",870,870)
 
"BLD",9946,"KRN","B",8989.51,8989.51)
 
"BLD",9946,"KRN","B",8989.52,8989.52)
 
"BLD",9946,"KRN","B",8994,8994)
 
"BLD",9946,"QUES",0)
^9.62^^
"BLD",9946,"REQB",0)
^9.611^1^1
"BLD",9946,"REQB",1,0)
OR*3.0*334^1
"BLD",9946,"REQB","B","OR*3.0*334",1)
 
"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
410^3150422
"PKG",174,22,1,"PAH",1,1,0)
^^6^6^3150422
"PKG",174,22,1,"PAH",1,1,1,0)
This patch corrects 2 issues within the ORDER ENTRY/RESULTS REPORTING 
"PKG",174,22,1,"PAH",1,1,2,0)
package:
"PKG",174,22,1,"PAH",1,1,3,0)
 
"PKG",174,22,1,"PAH",1,1,4,0)
1. Non-OERR alerts are being deleted without the rights to do so.
"PKG",174,22,1,"PAH",1,1,5,0)
 
"PKG",174,22,1,"PAH",1,1,6,0)
2. Typo in the CPRS User Guide:GUI Version.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORWORB")
0^1^B74023568^B73567288
"RTN","ORWORB",1,0)
ORWORB ; slc/dee/REV/CLA,WAT - RPC functions which return user alert ;10:12 am JAN 31, 2001
"RTN","ORWORB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,148,173,190,215,243,296,329,334,410**;Dec 17, 1997;Build 1
"RTN","ORWORB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORWORB",4,0)
 ;
"RTN","ORWORB",5,0)
 ;DBIA reference section
"RTN","ORWORB",6,0)
 ;10035 - ^DPT
"RTN","ORWORB",7,0)
 ;2689  - ^XTV(8992
"RTN","ORWORB",8,0)
 ;4329  - ^VA(200,5
"RTN","ORWORB",9,0)
 ;10076 - ^XUSEC(
"RTN","ORWORB",10,0)
 ;3563  - RAO7PC4
"RTN","ORWORB",11,0)
 ;2834  - TIUSRVLO
"RTN","ORWORB",12,0)
 ;10061 - VADPT
"RTN","ORWORB",13,0)
 ;10103 - XLFDT
"RTN","ORWORB",14,0)
 ;2263  - XPAR
"RTN","ORWORB",15,0)
 ;4834  - XQALDATA
"RTN","ORWORB",16,0)
 ;10081 - XQALERT
"RTN","ORWORB",17,0)
 ;
"RTN","ORWORB",18,0)
URGENLST(ORY) ;return array of the  urgency for the notification
"RTN","ORWORB",19,0)
 N ORSRV,ORERROR
"RTN","ORWORB",20,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWORB",21,0)
 D GETLST^XPAR(.ORY,"USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORB URGENCY","I",.ORERROR)
"RTN","ORWORB",22,0)
 Q
"RTN","ORWORB",23,0)
 ;
"RTN","ORWORB",24,0)
FASTUSER(ORY) ;return current user's notifications across all patients
"RTN","ORWORB",25,0)
 N STRTDATE,STOPDATE,ORTOT,I,ORURG,URG,ORN,SORT,ORN0,URGLIST,REMLIST,REM,NONORLST,NONOR
"RTN","ORWORB",26,0)
 N ALRT,ALRTDT,ALRTPT,ALRTMSG,ALRTI,ALRTLOC,ALRTXQA,J,FWDBY,PRE,ALRTDFN
"RTN","ORWORB",27,0)
 K ^TMP("ORBG",$J)
"RTN","ORWORB",28,0)
 S STRTDATE="",STOPDATE="",FWDBY="Forwarded by: "
"RTN","ORWORB",29,0)
 D GETUSER1^XQALDATA("^TMP(""ORB"",$J)",DUZ,STRTDATE,STOPDATE)
"RTN","ORWORB",30,0)
 S ORTOT=^TMP("ORB",$J)
"RTN","ORWORB",31,0)
 D URGLIST^ORQORB(.URGLIST)
"RTN","ORWORB",32,0)
 D REMLIST^ORQORB(.REMLIST)
"RTN","ORWORB",33,0)
 D REMNONOR^ORQORB(.NONORLST)
"RTN","ORWORB",34,0)
 S J=0
"RTN","ORWORB",35,0)
 F I=1:1:ORTOT D
"RTN","ORWORB",36,0)
 .S REM=""
"RTN","ORWORB",37,0)
 .S ALRTDFN=""
"RTN","ORWORB",38,0)
 .S ALRT=^TMP("ORB",$J,I)
"RTN","ORWORB",39,0)
 .S PRE=$E(ALRT,1,1)
"RTN","ORWORB",40,0)
 .S ALRTXQA=$P(ALRT,U,2)  ;XQAID
"RTN","ORWORB",41,0)
 .S NONOR="" F  S NONOR=$O(NONORLST(NONOR)) Q:NONOR=""  D
"RTN","ORWORB",42,0)
 ..I ALRTXQA[NONOR S REM=1  ;allow this type of alert to be Removed
"RTN","ORWORB",43,0)
 .S ALRTMSG=$P($P(ALRT,U),PRE_"  ",2)
"RTN","ORWORB",44,0)
 .I $E(ALRT,4,8)'="-----" D  ;not forwarded alert info/comment
"RTN","ORWORB",45,0)
 ..S ORURG="n/a"
"RTN","ORWORB",46,0)
 ..S ALRTI=$P(ALRT,"  ")
"RTN","ORWORB",47,0)
 ..S ALRTPT=""
"RTN","ORWORB",48,0)
 ..S ALRTLOC=""
"RTN","ORWORB",49,0)
 ..I $E($P(ALRTXQA,";"),1,3)="TIU" S ORURG="Moderate"
"RTN","ORWORB",50,0)
 ..I $P(ALRTXQA,",")="OR" D
"RTN","ORWORB",51,0)
 ...S ORN=$P($P(ALRTXQA,";"),",",3)
"RTN","ORWORB",52,0)
 ...S URG=$G(URGLIST(ORN))
"RTN","ORWORB",53,0)
 ...S ORURG=$S(URG=1:"HIGH",URG=2:"Moderate",1:"low")
"RTN","ORWORB",54,0)
 ...S REM=$G(REMLIST(ORN))
"RTN","ORWORB",55,0)
 ...S ORN0=^ORD(100.9,ORN,0)
"RTN","ORWORB",56,0)
 ...S ALRTI=$S($P(ORN0,U,6)="INFODEL":"I",1:"")
"RTN","ORWORB",57,0)
 ...S ALRTDFN=$P(ALRTXQA,",",2)
"RTN","ORWORB",58,0)
 ...S ALRTLOC=$G(^DPT(+$G(ALRTDFN),.1))
"RTN","ORWORB",59,0)
 ..S ALRTI=$S(ALRTI="I":"I",1:"")
"RTN","ORWORB",60,0)
 ..I (ALRT["): ")!($G(ORN)=27&(ALRT[") CV")) D  ;WAT
"RTN","ORWORB",61,0)
 ...S ALRTPT=$P(ALRT,": ")
"RTN","ORWORB",62,0)
 ...S ALRTPT=$E(ALRTPT,4,$L(ALRTPT))
"RTN","ORWORB",63,0)
 ...I $G(ORN)=27&(ALRT[") CV") S ALRTMSG=$P($P(ALRT,U),": ",2) ;WAT
"RTN","ORWORB",64,0)
 ...E  S ALRTMSG=$P($P(ALRT,U),"): ",2) ;WAT
"RTN","ORWORB",65,0)
 ...I $E(ALRTMSG,1,1)="[" D
"RTN","ORWORB",66,0)
 ....S:'$L(ALRTLOC) ALRTLOC=$P($P(ALRTMSG,"]"),"[",2)
"RTN","ORWORB",67,0)
 ....S ALRTMSG=$P(ALRTMSG,"] ",2)
"RTN","ORWORB",68,0)
 ..I '$L($G(ALRTPT)) S ALRTPT="no patient"
"RTN","ORWORB",69,0)
 ..S ALRTDT=$P(ALRTXQA,";",3)
"RTN","ORWORB",70,0)
 ..S ALRTDT=$P(ALRTDT,".")_"."_$E($P(ALRTDT,".",2)_"0000",1,4)
"RTN","ORWORB",71,0)
 ..S ALRTDT=$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"/"_($E(ALRTDT,1,3)+1700)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",72,0)
 ..;S ALRTDT=($E(ALRTDT,1,3)+1700)_"/"_$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",73,0)
 ..S J=J+1,^TMP("ORBG",$J,J)=ALRTI_U_ALRTPT_U_ALRTLOC_U_ORURG_U_ALRTDT_U
"RTN","ORWORB",74,0)
 ..S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_ALRTMSG_U_U_ALRTXQA_U_$G(REM)_U
"RTN","ORWORB",75,0)
 .;
"RTN","ORWORB",76,0)
 .;if alert forward info/comment:
"RTN","ORWORB",77,0)
 .I $E(ALRTMSG,1,5)="-----" D
"RTN","ORWORB",78,0)
 ..S ALRTMSG=$P(ALRTMSG,"-----",2)
"RTN","ORWORB",79,0)
 ..I $E(ALRTMSG,1,14)=FWDBY D
"RTN","ORWORB",80,0)
 ...S J=J+1,^TMP("ORBG",$J,J)=FWDBY_U_$P($P(ALRTMSG,FWDBY,2),"Generated: ")_$P($P(ALRTMSG,FWDBY,2),"Generated: ",2)
"RTN","ORWORB",81,0)
 ..E  S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_U_""""_ALRTMSG_""""
"RTN","ORWORB",82,0)
 S ^TMP("ORBG",$J)=""
"RTN","ORWORB",83,0)
 S ORY=$NA(^TMP("ORBG",$J))
"RTN","ORWORB",84,0)
 Q
"RTN","ORWORB",85,0)
 ;
"RTN","ORWORB",86,0)
GETDATA(ORY,XQAID) ; return XQADATA for an alert
"RTN","ORWORB",87,0)
 N SHOWADD
"RTN","ORWORB",88,0)
 S ORY=""
"RTN","ORWORB",89,0)
 Q:$G(XQAID)=""!('$D(^XTV(8992,"AXQA",XQAID)))
"RTN","ORWORB",90,0)
 D GETACT^XQALERT(XQAID)
"RTN","ORWORB",91,0)
 S ORY=XQADATA
"RTN","ORWORB",92,0)
 I ($E(XQAID,1,3)="TIU"),(+ORY>0) D
"RTN","ORWORB",93,0)
 . S SHOWADD=1
"RTN","ORWORB",94,0)
 . S ORY=ORY_$$RESOLVE^TIUSRVLO(+ORY)
"RTN","ORWORB",95,0)
 K XQAID,XQADATA,XQAOPT,XQAROU
"RTN","ORWORB",96,0)
 Q
"RTN","ORWORB",97,0)
 ;
"RTN","ORWORB",98,0)
KILUNSNO(Y,ORVP) ; Delete unsigned order alerts if no unsigned orders remaining
"RTN","ORWORB",99,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWORB",100,0)
 D UNOTIF^ORCSIGN
"RTN","ORWORB",101,0)
 Q
"RTN","ORWORB",102,0)
 ;
"RTN","ORWORB",103,0)
UNFLORD(ORY,DFN,XQAID) ; -- auto-unflag orders?/delete alert
"RTN","ORWORB",104,0)
 Q
"RTN","ORWORB",105,0)
 ;*334/VMP-DJE Auto unflag has been disabled
"RTN","ORWORB",106,0)
 ;Q:'$L(DFN)!('$L(XQAID))
"RTN","ORWORB",107,0)
 ;N ORI,ORIFN,ORA,XQAKILL,ORN,ORBY,ORAUTO,ORUNF
"RTN","ORWORB",108,0)
 ;S ORN=+$O(^ORD(100.9,"B","FLAGGED ORDERS",0))
"RTN","ORWORB",109,0)
 ;;S XQAKILL=$$XQAKILL^ORB3F1(ORN)
"RTN","ORWORB",110,0)
 ;D LIST^ORQOR1(.ORBY,DFN,"ALL",12,"","")
"RTN","ORWORB",111,0)
 ;S ORAUTO=+$$GET^XPAR("ALL","ORPF AUTO UNFLAG")
"RTN","ORWORB",112,0)
 ;S ORI=0 F  S ORI=$O(ORBY(ORI)) Q:ORI'>0  D
"RTN","ORWORB",113,0)
 ;. I ORAUTO D  ; unflag
"RTN","ORWORB",114,0)
 ;. . ;DJE-VM *329 - use GUI RPC call to make it run the proper code, only run it if the user sees it.
"RTN","ORWORB",115,0)
 ;. . ;S ORUNF=+$E($$NOW^XLFDT,1,12)_U_DUZ_"^Auto-Unflagged"
"RTN","ORWORB",116,0)
 ;. . ;S ORIFN=$P(ORBY(ORI),U),ORA=+$P(ORIFN,";",2)
"RTN","ORWORB",117,0)
 ;. . ;I ORIFN,$D(^OR(100,+ORIFN,0)) S $P(^(8,ORA,3),U)=0,$P(^(3),U,6,8)=ORUNF D MSG^ORCFLAG(ORIFN) ; unflag
"RTN","ORWORB",118,0)
 ;. . S ORIFN=+ORBY(ORI)
"RTN","ORWORB",119,0)
 ;. . I $D(^OR(100,ORIFN,0)),'$$FLAGRULE^ORWORR1(ORIFN) D UNFLAG^ORWDXA(.ORUNF,$P(ORBY(ORI),U),"Auto-Unflagged")
"RTN","ORWORB",120,0)
 ;;DJE-VM *329 - ORWDXA is smarter and deletes the appropriate alert(s)
"RTN","ORWORB",121,0)
 ;;I (ORAUTO)!(+$G(ORBY(1))=0) D DELETE^XQALERT
"RTN","ORWORB",122,0)
 ;Q
"RTN","ORWORB",123,0)
KILEXMED(Y,ORDFN)  ; -- Delete expiring meds notification if no expiring meds remaining
"RTN","ORWORB",124,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",125,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",126,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",127,0)
 N XQAKILL,ORNIFN,ORVP,ORIO S OROI=""
"RTN","ORWORB",128,0)
 F OROI="INPT","OUTPT" D
"RTN","ORWORB",129,0)
 .S ORNIFN=$O(^ORD(100.9,"B","MEDICATIONS EXPIRING - "_OROI,0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",130,0)
 .Q:'$L($G(ORNIFN))
"RTN","ORWORB",131,0)
 .S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; expiring meds notif
"RTN","ORWORB",132,0)
 .I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",133,0)
 .I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",134,0)
 Q
"RTN","ORWORB",135,0)
KILEXOI(Y,ORDFN,ORNIFN)  ; -- Delete expiring flagged OI notification if no flagged expiring OI remaining
"RTN","ORWORB",136,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",137,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",138,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",139,0)
 N XQAKILL,ORVP
"RTN","ORWORB",140,0)
 S ORVP=ORDFN_";DPT("
"RTN","ORWORB",141,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; flagged expiring OI notifications
"RTN","ORWORB",142,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",143,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",144,0)
 Q
"RTN","ORWORB",145,0)
KILUNVOR(Y,ORDFN)  ; -- Delete UNVERIFIED ORDER notification if none remaining within current admission/30 days
"RTN","ORWORB",146,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",147,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",148,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",149,0)
 ;get current admission date/time:
"RTN","ORWORB",150,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",151,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",152,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",153,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",154,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",155,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",156,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",157,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",158,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",159,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",160,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",161,0)
 Q
"RTN","ORWORB",162,0)
KILUNVMD(Y,ORDFN)  ; -- Delete UNVERIFIED MEDS notification if none remaining within current admission/30 days
"RTN","ORWORB",163,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",164,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",165,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",166,0)
 ;get current admission date/time:
"RTN","ORWORB",167,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",168,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",169,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",170,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",171,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",172,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",173,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",174,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED MEDICATION ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",175,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",176,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",177,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",178,0)
 Q
"RTN","ORWORB",179,0)
ESORD(ORY,XQAID)   ;order(s) requiring electronic signature follow-up
"RTN","ORWORB",180,0)
 K XQAKILL
"RTN","ORWORB",181,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORX,ORZ,ORDERS,ORDNUM,ORQUIT,ORBLMDEL
"RTN","ORWORB",182,0)
 S ORBXQAID=XQAID,ORDERS=0,ORQUIT=0
"RTN","ORWORB",183,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORWORB",184,0)
 S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",185,0)
 ;the FLG code for UNSIGNED orders in ORQ1 is '11'
"RTN","ORWORB",186,0)
 ;get unsigned orders - if none exist, delete alert then quit:
"RTN","ORWORB",187,0)
 D EN^ORQ1(ORPT_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORWORB",188,0)
 S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  I +$G(^TMP("ORR",$J,ORX,"TOT"))<1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",189,0)
 ;
"RTN","ORWORB",190,0)
 ;user does not have ORES key, delete user's alert:
"RTN","ORWORB",191,0)
 I '$D(^XUSEC("ORES",DUZ)) S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",192,0)
 ;
"RTN","ORWORB",193,0)
 ;if prov is NOT linked to pt via attending, primary or teams:
"RTN","ORWORB",194,0)
 I $$PPLINK^ORQPTQ1(DUZ,ORPT)=0 D
"RTN","ORWORB",195,0)
 .S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""!(ORDERS=1)  D
"RTN","ORWORB",196,0)
 ..S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:+ORZ=0!(ORDERS=1)  D
"RTN","ORWORB",197,0)
 ...S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORWORB",198,0)
 ...;quit if this unsigned order's last action was made by the user
"RTN","ORWORB",199,0)
 ...I DUZ=+$$UNSIGNOR^ORQOR2(ORDNUM) S ORDERS=1
"RTN","ORWORB",200,0)
 .I ORDERS'=1 D  ;provider has no outstanding unsigned orders for pt
"RTN","ORWORB",201,0)
 ..S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID)  ;delete alert for this user
"RTN","ORWORB",202,0)
 K ^TMP("ORR",$J)
"RTN","ORWORB",203,0)
 Q
"RTN","ORWORB",204,0)
 ;
"RTN","ORWORB",205,0)
TXTFUP(ROOT,DFN,NOTIF,XQADATA) ; Follow-up for text messages
"RTN","ORWORB",206,0)
 ;
"RTN","ORWORB",207,0)
 I NOTIF=67 D CHGRAD
"RTN","ORWORB",208,0)
 Q
"RTN","ORWORB",209,0)
 ;
"RTN","ORWORB",210,0)
CHGRAD ;GUI follow-up for Imaging Request Changed (#67)
"RTN","ORWORB",211,0)
 S ROOT=$NA(^TMP($J,"RAE4"))
"RTN","ORWORB",212,0)
 K @ROOT
"RTN","ORWORB",213,0)
 D SET1^RAO7PC4  ;DBIA #3563
"RTN","ORWORB",214,0)
 Q
"RTN","ORWORB",215,0)
 ;
"RTN","ORWORB",216,0)
GETSORT(ORY) ;return notification sort method^direction for user/division/system/pkg
"RTN","ORWORB",217,0)
 S ORY=$$GET^XPAR("ALL","ORB SORT METHOD",1,"I")_U_$$GET^XPAR("ALL","ORB SORT DIRECTION",1,"I")
"RTN","ORWORB",218,0)
 Q
"RTN","ORWORB",219,0)
 ;
"RTN","ORWORB",220,0)
SETSORT(ORERR,SORT,DIR) ;set notification sort method^direction for user
"RTN","ORWORB",221,0)
 D EN^XPAR(DUZ_";VA(200,","ORB SORT METHOD",1,SORT,.ORERR)
"RTN","ORWORB",222,0)
 I $L($G(DIR)) D EN^XPAR(DUZ_";VA(200,","ORB SORT DIRECTION",1,DIR,.ORERR)
"RTN","ORWORB",223,0)
 Q
"VER")
8.0^22.0
"BLD",9946,6)
^357
**END**
**END**

