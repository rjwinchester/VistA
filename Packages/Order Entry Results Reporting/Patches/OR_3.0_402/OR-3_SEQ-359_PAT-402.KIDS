Released OR*3*402 SEQ #359
Extracted from mail message
**KIDS**:OR*3.0*402^

**INSTALL NAME**
OR*3.0*402
"BLD",9865,0)
OR*3.0*402^ORDER ENTRY/RESULTS REPORTING^0^3150529^y
"BLD",9865,1,0)
^^1^1^3141104^
"BLD",9865,1,1,0)
OR*3.0*402
"BLD",9865,4,0)
^9.64PA^^
"BLD",9865,6.3)
3
"BLD",9865,"ABPKG")
n
"BLD",9865,"KRN",0)
^9.67PA^779.2^20
"BLD",9865,"KRN",.4,0)
.4
"BLD",9865,"KRN",.401,0)
.401
"BLD",9865,"KRN",.402,0)
.402
"BLD",9865,"KRN",.403,0)
.403
"BLD",9865,"KRN",.5,0)
.5
"BLD",9865,"KRN",.84,0)
.84
"BLD",9865,"KRN",3.6,0)
3.6
"BLD",9865,"KRN",3.8,0)
3.8
"BLD",9865,"KRN",9.2,0)
9.2
"BLD",9865,"KRN",9.8,0)
9.8
"BLD",9865,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9865,"KRN",9.8,"NM",1,0)
ORDV03^^0^B59633983
"BLD",9865,"KRN",9.8,"NM",2,0)
ORKPS1^^0^B85828947
"BLD",9865,"KRN",9.8,"NM","B","ORDV03",1)
 
"BLD",9865,"KRN",9.8,"NM","B","ORKPS1",2)
 
"BLD",9865,"KRN",19,0)
19
"BLD",9865,"KRN",19,"NM",0)
^9.68A^^
"BLD",9865,"KRN",19.1,0)
19.1
"BLD",9865,"KRN",101,0)
101
"BLD",9865,"KRN",409.61,0)
409.61
"BLD",9865,"KRN",771,0)
771
"BLD",9865,"KRN",779.2,0)
779.2
"BLD",9865,"KRN",870,0)
870
"BLD",9865,"KRN",8989.51,0)
8989.51
"BLD",9865,"KRN",8989.52,0)
8989.52
"BLD",9865,"KRN",8994,0)
8994
"BLD",9865,"KRN","B",.4,.4)
 
"BLD",9865,"KRN","B",.401,.401)
 
"BLD",9865,"KRN","B",.402,.402)
 
"BLD",9865,"KRN","B",.403,.403)
 
"BLD",9865,"KRN","B",.5,.5)
 
"BLD",9865,"KRN","B",.84,.84)
 
"BLD",9865,"KRN","B",3.6,3.6)
 
"BLD",9865,"KRN","B",3.8,3.8)
 
"BLD",9865,"KRN","B",9.2,9.2)
 
"BLD",9865,"KRN","B",9.8,9.8)
 
"BLD",9865,"KRN","B",19,19)
 
"BLD",9865,"KRN","B",19.1,19.1)
 
"BLD",9865,"KRN","B",101,101)
 
"BLD",9865,"KRN","B",409.61,409.61)
 
"BLD",9865,"KRN","B",771,771)
 
"BLD",9865,"KRN","B",779.2,779.2)
 
"BLD",9865,"KRN","B",870,870)
 
"BLD",9865,"KRN","B",8989.51,8989.51)
 
"BLD",9865,"KRN","B",8989.52,8989.52)
 
"BLD",9865,"KRN","B",8994,8994)
 
"BLD",9865,"QUES",0)
^9.62^^
"BLD",9865,"REQB",0)
^9.611^2^2
"BLD",9865,"REQB",1,0)
OR*3.0*243^1
"BLD",9865,"REQB",2,0)
OR*3.0*311^1
"BLD",9865,"REQB","B","OR*3.0*243",1)
 
"BLD",9865,"REQB","B","OR*3.0*311",2)
 
"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
402^3150529
"PKG",174,22,1,"PAH",1,1,0)
^^1^1^3150529
"PKG",174,22,1,"PAH",1,1,1,0)
OR*3.0*402
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORDV03")
0^1^B59633983^B47046777
"RTN","ORDV03",1,0)
ORDV03 ; slc/dcm - OE/RR Report Extracts ;10/8/03 11:17
"RTN","ORDV03",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,208,215,243,402**;Dec 17, 1997;Build 3
"RTN","ORDV03",3,0)
RI(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Radiology impression
"RTN","ORDV03",4,0)
 ;External Calls: MAIN^GMTSRAE(1)
"RTN","ORDV03",5,0)
 ;
"RTN","ORDV03",6,0)
 ; ^TMP("GMTSRAD",$J) used via DBIA 4333
"RTN","ORDV03",7,0)
 ; ^TMP("RAE",$J) used via DBIA 3968
"RTN","ORDV03",8,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO
"RTN","ORDV03",9,0)
 Q:'$L(OREXT)
"RTN","ORDV03",10,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",11,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",12,0)
 S IOST=$G(IOST),GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS2=ORALPHA,GMTS1=OROMEGA
"RTN","ORDV03",13,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",14,0)
 K ^TMP("ORDATA",$J),^TMP("RAE",$J) ;DBIA 3968
"RTN","ORDV03",15,0)
 D @GO
"RTN","ORDV03",16,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",17,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)!(ORDT>GMTS2)  D
"RTN","ORDV03",18,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  I $G(^(ORJ,0)) S ORX0=^(0) D
"RTN","ORDV03",19,0)
 .. S ORCNT=ORCNT+1
"RTN","ORDV03",20,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",21,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV03",22,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",23,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",24,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$P(ORX0,U,4) ;report status
"RTN","ORDV03",25,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",26,0)
 .. D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6)),6) ;impression
"RTN","ORDV03",27,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ^TMP("ORDATA",$J,ORCNT,"WP",8)="8^[+]" ;flag for detail
"RTN","ORDV03",28,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",29,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",30,0)
 Q
"RTN","ORDV03",31,0)
RR(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Radiology report
"RTN","ORDV03",32,0)
 ;External Calls: MAIN^GMTSRAE(2)
"RTN","ORDV03",33,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV03",34,0)
 . N BEG,END,MAX
"RTN","ORDV03",35,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV03",36,0)
 . S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV03",37,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV03",38,0)
 . D GCPR^OMGCOAS1(DFN,"RR",BEG,END,MAX)
"RTN","ORDV03",39,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO,ORMORE
"RTN","ORDV03",40,0)
 Q:'$L(OREXT)
"RTN","ORDV03",41,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",42,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",43,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV03",44,0)
 S GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV03",45,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",46,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV03",47,0)
 . K ^TMP("RAE",$J)
"RTN","ORDV03",48,0)
 . D @GO
"RTN","ORDV03",49,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",50,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)  D
"RTN","ORDV03",51,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  D
"RTN","ORDV03",52,0)
 .. S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV03",53,0)
 .. S ORX0=$G(^TMP("RAE",$J,ORDT,ORJ,0))
"RTN","ORDV03",54,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",55,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV03",56,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",57,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",58,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$S($L($P(ORX0,U,4)):$P(ORX0,U,4),1:"No Report") ;report status
"RTN","ORDV03",59,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",60,0)
 .. N ORID S ORID=0 ;p402
"RTN","ORDV03",61,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"S",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"S")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6,1)),6) S ORID=6 ;reason for study
"RTN","ORDV03",62,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"H",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"H")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",7,1)),7) S ORID=7 ;clinical history
"RTN","ORDV03",63,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",8,1)),8) S ORID=8 ;impression
"RTN","ORDV03",64,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"R",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"R")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",9,1)),9) S ORID=9 ;report
"RTN","ORDV03",65,0)
 .. ;p402 Add primary and secondary diagnostic codes to report
"RTN","ORDV03",66,0)
 .. I ORID D 
"RTN","ORDV03",67,0)
 ... N ORIDX,ORSDC S ORIDX=9999999
"RTN","ORDV03",68,0)
 ... S ORIDX=$O(^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX),-1) Q:(ORIDX'>0)
"RTN","ORDV03",69,0)
 ... S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^" ; blank line
"RTN","ORDV03",70,0)
 ... S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^Primary Diagnostic Code: "_$S($L(^TMP("RAE",$J,ORDT,ORJ,"D",1))'>0:"NONE",$D(^TMP("RAE",$J,ORDT,ORJ,"D",1)):$G(^TMP("RAE",$J,ORDT,ORJ,"D",1)),1:"NONE")
"RTN","ORDV03",71,0)
 ... S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^Secondary Diagnostic Codes: "
"RTN","ORDV03",72,0)
 ... S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^ "_$S($D(^TMP("RAE",$J,ORDT,ORJ,"D",2)):$G(^TMP("RAE",$J,ORDT,ORJ,"D",2)),1:"NONE")
"RTN","ORDV03",73,0)
 ...S ORSDC=2 ; print a max of 2 secondary dx codes
"RTN","ORDV03",74,0)
 ...F  S ORSDC=$O(^TMP("RAE",$J,ORDT,ORJ,"D",ORSDC)) Q:(ORSDC="")!(ORSDC>3)  D
"RTN","ORDV03",75,0)
 ....S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^ "_$G(^TMP("RAE",$J,ORDT,ORJ,"D",ORSDC))
"RTN","ORDV03",76,0)
 ...S ORIDX=ORIDX+1,^TMP("ORDATA",$J,ORCNT,"WP",ORID,1,ORIDX)=ORID_"^" ; blank line
"RTN","ORDV03",77,0)
 ... K ORIDX
"RTN","ORDV03",78,0)
 .. K ORID ;p402 end
"RTN","ORDV03",79,0)
 .. I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",10)="10^[+]" ;flag for detail
"RTN","ORDV03",80,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",81,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",82,0)
 Q
"RTN","ORDV03",83,0)
RRDOD(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Radiology report
"RTN","ORDV03",84,0)
 ;External Calls: MAIN^GMTSRAE(2)
"RTN","ORDV03",85,0)
 ;
"RTN","ORDV03",86,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV03",87,0)
 . N BEG,END,MAX
"RTN","ORDV03",88,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV03",89,0)
 . S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV03",90,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV03",91,0)
 . D GCPR^OMGCOAS1(DFN,"RR",BEG,END,MAX)
"RTN","ORDV03",92,0)
 ;
"RTN","ORDV03",93,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO,ORMORE
"RTN","ORDV03",94,0)
 Q:'$L(OREXT)
"RTN","ORDV03",95,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",96,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",97,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV03",98,0)
 S GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV03",99,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",100,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV03",101,0)
 . K ^TMP("RAE",$J)
"RTN","ORDV03",102,0)
 . D @GO
"RTN","ORDV03",103,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",104,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)  D
"RTN","ORDV03",105,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  D
"RTN","ORDV03",106,0)
 .. S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV03",107,0)
 .. S ORX0=$G(^TMP("RAE",$J,ORDT,ORJ,0))
"RTN","ORDV03",108,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",109,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV03",110,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",111,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",112,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$S($L($P(ORX0,U,4)):$P(ORX0,U,4),1:"No Report") ;report status
"RTN","ORDV03",113,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",114,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"H",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"H")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6,1)),6) ;clinical history
"RTN","ORDV03",115,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",7,1)),7) ;impression
"RTN","ORDV03",116,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"R",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"R")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",8,1)),8) ;report
"RTN","ORDV03",117,0)
 .. I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",9)="9^[+]" ;flag for detail
"RTN","ORDV03",118,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",119,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",120,0)
 Q
"RTN","ORDV03",121,0)
RS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Radiology status
"RTN","ORDV03",122,0)
 ;External calls: GET^GMTSRAD
"RTN","ORDV03",123,0)
 N ORSITE,SITE,CNT,ORDT,ORDA,ORDA2,REC,GMTSEND,GMTSBEG,GO,STAT
"RTN","ORDV03",124,0)
 Q:'$L(OREXT)
"RTN","ORDV03",125,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",126,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",127,0)
 S GMTSBEG=ORDBEG,GMTSEND=ORDEND
"RTN","ORDV03",128,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",129,0)
 K ^TMP("GMTSRAD",$J) ;DBIA 4333
"RTN","ORDV03",130,0)
 D @GO
"RTN","ORDV03",131,0)
 S CNT=0,ORDT=OROMEGA
"RTN","ORDV03",132,0)
 F  S ORDT=$O(^TMP("GMTSRAD",$J,ORDT)) Q:(ORDT'>0)!(ORDT>ORALPHA)!(CNT'<ORMAX)  D
"RTN","ORDV03",133,0)
 .S ORDA=0
"RTN","ORDV03",134,0)
 .F  S ORDA=$O(^TMP("GMTSRAD",$J,ORDT,ORDA)) Q:'ORDA!(CNT'<ORMAX)  D
"RTN","ORDV03",135,0)
 ..S ORDA2=0
"RTN","ORDV03",136,0)
 ..F  S ORDA2=$O(^TMP("GMTSRAD",$J,ORDT,ORDA,ORDA2)) Q:'ORDA2!(CNT'<ORMAX)  S REC=^(ORDA2),STAT=$P(REC,"^",2) D
"RTN","ORDV03",137,0)
 ...S CNT=CNT+1
"RTN","ORDV03",138,0)
 ...S SITE=$S($L($G(^TMP("GMTSRAD",$J,ORDT,ORDA,ORDA2,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",139,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE
"RTN","ORDV03",140,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$$DATE^ORDVU($P(REC,"^"))
"RTN","ORDV03",141,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",3)="3^"_$S(STAT="d":"Discontinued",STAT="c":"Complete",STAT="h":"Hold",STAT="p":"Pending",STAT="a":"Active",STAT="s":"Scheduled",STAT="u":"Unreleased",1:STAT)
"RTN","ORDV03",142,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(REC,"^",3)
"RTN","ORDV03",143,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$$DATE^ORDVU($P(REC,"^",4))
"RTN","ORDV03",144,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$P(REC,"^",5)
"RTN","ORDV03",145,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",146,0)
 Q
"RTN","ORDV03",147,0)
RAD1 ;Get radiology impression
"RTN","ORDV03",148,0)
 D MAIN^GMTSRAE(1)
"RTN","ORDV03",149,0)
 Q
"RTN","ORDV03",150,0)
RAD2 ;Get radiology report
"RTN","ORDV03",151,0)
 D MAIN^GMTSRAE(2)
"RTN","ORDV03",152,0)
 Q
"RTN","ORKPS1")
0^2^B85828947^B80576469
"RTN","ORKPS1",1,0)
ORKPS1 ; SLC/CLA - Order checking support procedures for medications ;03/29/13  09:01
"RTN","ORKPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**232,272,346,352,345,311,402**;Dec 17, 1997;Build 3
"RTN","ORKPS1",3,0)
 Q
"RTN","ORKPS1",4,0)
PROCESS(OI,DFN,ORKDG,ORPROSP,ORGLOBL) ;process data from pharmacy order check API
"RTN","ORKPS1",5,0)
 ;ORPROSP = pharmacy orderable item ien [file #50.7] ^ drug ien [file #50]
"RTN","ORKPS1",6,0)
 ;          NOTE: PIECE 1 WILL ONLY BE FILLED IN FOR ORDERABLE ITEMS THAT RESOLVE TO SUPPLY ITEMS
"RTN","ORKPS1",7,0)
 Q:'$D(^TMP($J))
"RTN","ORKPS1",8,0)
 N II,XX,ZZ,ZZD,ORMTYPE,ORN,ORZ,RCNT,GL,I,J,K,L,M,TDATA,VADMVT,ORX,ORY
"RTN","ORKPS1",9,0)
 S II=1,XX=0,ZZ="",ZZD="",RCNT=0
"RTN","ORKPS1",10,0)
 I $G(^TMP($J,ORGLOBL,"OUT",0))<0 D  Q
"RTN","ORKPS1",11,0)
 .S YY(II)="ERR^Drug-Drug order checks (Duplicate Therapy, Duplicate Drug, Drug Interaction) were not able to be performed. "_$P($G(^TMP($J,ORGLOBL,"OUT",0)),U,2)
"RTN","ORKPS1",12,0)
 .S II=II+1
"RTN","ORKPS1",13,0)
 I $D(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS")) D
"RTN","ORKPS1",14,0)
 .S ORX="" F  S ORX=$O(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX)) Q:'$L(ORX)  D
"RTN","ORKPS1",15,0)
 ..S ORY=0 F  S ORY=$O(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX,ORY)) Q:'ORY  D
"RTN","ORKPS1",16,0)
 ...I $L($G(ORIFN))>0,$G(ORIFN)=$P($G(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX,ORY)),U,5) Q
"RTN","ORKPS1",17,0)
 ...S YY(II)="ERR^"_$P($G(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX,ORY)),U,7)
"RTN","ORKPS1",18,0)
 ...I $L($P($G(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX,ORY)),U,10))>0 S YY(II)=YY(II)_"("_$P($G(^TMP($J,ORGLOBL,"OUT","EXCEPTIONS",ORX,ORY)),U,10)_")"
"RTN","ORKPS1",19,0)
 ...S II=II+1
"RTN","ORKPS1",20,0)
 S ORX="" F ORX="DRUGDRUG","THERAPY" D
"RTN","ORKPS1",21,0)
 .Q:'$D(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR"))
"RTN","ORKPS1",22,0)
 .S ORY="" F  S ORY=$O(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR",ORY)) Q:'$L(ORY)  D
"RTN","ORKPS1",23,0)
 ..S ORZ=0 F  S ORZ=$O(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR",ORY,ORZ)) Q:'ORZ  D
"RTN","ORKPS1",24,0)
 ...S YY(II)="ERR^"_$$UPPER^ORWDPS32($G(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR",ORY,ORZ,"SEV")))_": "_$P($G(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR",ORY,ORZ,0)),U)_" - "_$G(^TMP($J,ORGLOBL,"OUT",ORX,"ERROR",ORY,ORZ,"TEXT"))
"RTN","ORKPS1",25,0)
 ...S II=II+1
"RTN","ORKPS1",26,0)
 I +$P(ORPROSP,U,2) D
"RTN","ORKPS1",27,0)
 .;set info about the drug being ordered
"RTN","ORKPS1",28,0)
 .S TDATA("NEW","TXT")=""
"RTN","ORKPS1",29,0)
 .S I="" F  S I=$O(^TMP($J,ORGLOBL,"IN","PROSPECTIVE",I)) Q:'$L(I)  D
"RTN","ORKPS1",30,0)
 ..I $P($G(^TMP($J,ORGLOBL,"IN","PROSPECTIVE",I)),U,3)=+$P(ORPROSP,U,2) D
"RTN","ORKPS1",31,0)
 ...S TDATA("NEW","TXT")=$P($G(^TMP($J,ORGLOBL,"IN","PROSPECTIVE",I)),U,4)
"RTN","ORKPS1",32,0)
 ...S TDATA("NEW","PROSP")=$P(I,";",3,4)
"RTN","ORKPS1",33,0)
 .S TDATA("NEW","PTYPE")=$S($G(ORKDG)="PSI":"I",$G(ORKDG)="PSO":"O",$G(ORKDG)="PSIV":"I",$G(ORKDG)="PSH":"O",1:"")
"RTN","ORKPS1",34,0)
 .S TDATA("NEW","OTYPE")=$S($G(ORKDG)="PSI":"UD",$G(ORKDG)="PSO":"OP",$G(ORKDG)="PSIV":"IV",$G(ORKDG)="PSH":"NV",1:"")
"RTN","ORKPS1",35,0)
 .I '$L(TDATA("NEW","PTYPE")) D  ;if no display group
"RTN","ORKPS1",36,0)
 ..D ADM^VADPT2
"RTN","ORKPS1",37,0)
 ..S TDATA("NEW","PTYPE")=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS1",38,0)
 ..K VADMVT
"RTN","ORKPS1",39,0)
 D DD(.TDATA,$S(+ORPROSP>0:0,1:1))
"RTN","ORKPS1",40,0)
 Q:'$L($G(TDATA("NEW","PROSP")))
"RTN","ORKPS1",41,0)
 D DI(.TDATA)
"RTN","ORKPS1",42,0)
 I $G(TDATA("NEW","OTYPE"))="UD" D  ;p402 Set OTYPE to C to distinguish the prospect as an IMO or clinical order if outpatient
"RTN","ORKPS1",43,0)
 .D ADM^VADPT2 S TDATA("NEW","PTYPE")=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS1",44,0)
 .I $G(TDATA("NEW","PTYPE"))="O" S TDATA("NEW","OTYPE")="C"
"RTN","ORKPS1",45,0)
 .K VADMVT
"RTN","ORKPS1",46,0)
 D DT(.TDATA)
"RTN","ORKPS1",47,0)
 Q
"RTN","ORKPS1",48,0)
 ;
"RTN","ORKPS1",49,0)
DI(TDATA) ;add drug interaction checks
"RTN","ORKPS1",50,0)
 N GL,ORSEV,ORDRUG,ORTXT,ORIEN
"RTN","ORKPS1",51,0)
 S GL=$NA(^TMP($J,ORGLOBL,"OUT","DRUGDRUG"))
"RTN","ORKPS1",52,0)
 S J="" F  S J=$O(@GL@(J)) Q:'$L(J)  D
"RTN","ORKPS1",53,0)
 .S K="" F  S K=$O(@GL@(J,K)) Q:'$L(K)  D
"RTN","ORKPS1",54,0)
 ..S L=0 F  S L=$O(@GL@(J,K,L)) Q:'$L(L)  D
"RTN","ORKPS1",55,0)
 ...S M=0 F  S M=$O(@GL@(J,K,L,M)) Q:'M  D
"RTN","ORKPS1",56,0)
 ....N ORNUM,ORSEV,ORDNAME,ORZ,CNT,ORSTAT,ORMON,ORWHICH,ORLINE,ORIDX
"RTN","ORKPS1",57,0)
 ....;get the associated order number
"RTN","ORKPS1",58,0)
 ....S ORNUM=$P(L,";",1,2)
"RTN","ORKPS1",59,0)
 ....;if the status of the associated order is DISCONTINUED then don't add
"RTN","ORKPS1",60,0)
 ....S ORSTAT=$$PHSTAT(DFN,ORNUM)
"RTN","ORKPS1",61,0)
 ....Q:ORSTAT="DISCONTINUED"
"RTN","ORKPS1",62,0)
 ....S ORWHICH=""
"RTN","ORKPS1",63,0)
 ....I $P($P(@GL@(J,K,L,M),U),";",3,4)=TDATA("NEW","PROSP") D
"RTN","ORKPS1",64,0)
 .....S ORWHICH=K_" ["_$S($P(L,";",3)="PROSPECTIVE":"UNRELEASED",1:ORSTAT)_"]"
"RTN","ORKPS1",65,0)
 ....I $P(L,";",3,4)=TDATA("NEW","PROSP") D
"RTN","ORKPS1",66,0)
 .....S ORWHICH=$P(@GL@(J,K,L,M),U,4)_" ["
"RTN","ORKPS1",67,0)
 .....S ORWHICH=ORWHICH_$S($P($P(@GL@(J,K,L,M),U),";",3)="PROSPECTIVE":"UNRELEASED",1:$$PHSTAT(DFN,$P($P(@GL@(J,K,L,M),U),";",1,2)))
"RTN","ORKPS1",68,0)
 .....S ORWHICH=ORWHICH_"]"
"RTN","ORKPS1",69,0)
 ....Q:$L(ORWHICH)<2
"RTN","ORKPS1",70,0)
 ....;get text
"RTN","ORKPS1",71,0)
 ....S ORTXT(J,K)=$S($G(ORTXT(J,K))'="":ORTXT(J,K)_" ",1:"")_$P($G(@GL@(J,K,L,M,"CLIN")),"CLINICAL EFFECTS:  ",2),ORTXT(J,K,"ORWHICH")=ORWHICH
"RTN","ORKPS1",72,0)
 ....;set the monograph into the temp global
"RTN","ORKPS1",73,0)
 ....I $D(@GL@(J,K,L,M,"PMON")) D
"RTN","ORKPS1",74,0)
 .....S ^TMP($J,"ORMONOGRAPH")=1+$G(^TMP($J,"ORMONOGRAPH"))
"RTN","ORKPS1",75,0)
 .....S ORMON=^TMP($J,"ORMONOGRAPH")
"RTN","ORKPS1",76,0)
 .....S ^TMP($J,"ORMONOGRAPH",ORMON,"INT")=@GL@(J,K,L,M,"INT")
"RTN","ORKPS1",77,0)
 .....S ORIDX="",ORLINE=1 F  S ORIDX=$O(@GL@(J,K,L,M,"PMON",ORIDX)) Q:+$G(ORIDX)=0  D
"RTN","ORKPS1",78,0)
 ......S ^TMP($J,"ORMONOGRAPH",ORMON,"DATA",ORLINE,0)=@GL@(J,K,L,M,"PMON",ORIDX,0),ORLINE=ORLINE+1
"RTN","ORKPS1",79,0)
 .....S ORTXT(J,K,"MONOGRAPH")=1,ORTXT(J,K,"ORMON",ORMON)=""
"RTN","ORKPS1",80,0)
 ....;get the severity
"RTN","ORKPS1",81,0)
 ....S ORSEV=$$UPPER^ORU($G(@GL@(J,K,L,M,"SEV")))
"RTN","ORKPS1",82,0)
 ....;get the drug name
"RTN","ORKPS1",83,0)
 ....S ORDNAME=K
"RTN","ORKPS1",84,0)
 ....S ORTXT(J,K,"YY")="DI^"_ORSEV_U_ORNUM_U_ORDNAME_U_U_$G(@GL@(J,K,L,M,"INT"))
"RTN","ORKPS1",85,0)
 ;RETURN DATA IN EXPECTED FORMAT
"RTN","ORKPS1",86,0)
 S ORSEV="" F  S ORSEV=$O(ORTXT(ORSEV)) Q:$G(ORSEV)=""  D
"RTN","ORKPS1",87,0)
 .S ORDRUG="" F  S ORDRUG=$O(ORTXT(ORSEV,ORDRUG)) Q:$G(ORDRUG)=""  D
"RTN","ORKPS1",88,0)
 ..S YY(II)=ORTXT(ORSEV,ORDRUG,"YY")
"RTN","ORKPS1",89,0)
 ..S $P(YY(II),U,5)=TDATA("NEW","TXT")_" and "_ORTXT(ORSEV,ORDRUG,"ORWHICH")_" - "_ORTXT(ORSEV,ORDRUG)
"RTN","ORKPS1",90,0)
 ..S ORIEN=0 F  S ORIEN=$O(ORTXT(ORSEV,ORDRUG,"ORMON",ORIEN)) Q:+$G(ORIEN)=0  D
"RTN","ORKPS1",91,0)
 ...S ^TMP($J,"ORMONOGRAPH",ORIEN,"OC")=$P(YY(II),U,5)
"RTN","ORKPS1",92,0)
 ..S:$G(ORTXT(ORSEV,ORDRUG,"MONOGRAPH")) $P(YY(II),U,5)=$P(YY(II),U,5)_" - Monograph Available"
"RTN","ORKPS1",93,0)
 ..S II=II+1
"RTN","ORKPS1",94,0)
 Q
"RTN","ORKPS1",95,0)
 ;
"RTN","ORKPS1",96,0)
DD(TDATA,ORDPROSP) ;add duplicate drug checks
"RTN","ORKPS1",97,0)
 ;ORDPROSP: PERFORM PROSPECTIVE DRUG CHECK
"RTN","ORKPS1",98,0)
 ;          1 FOR YES
"RTN","ORKPS1",99,0)
 ;          0 FOR NO
"RTN","ORKPS1",100,0)
 S XX=0,ZZ=""
"RTN","ORKPS1",101,0)
 F  S XX=$O(^TMP($J,"DD",XX)) Q:XX<1  D
"RTN","ORKPS1",102,0)
 .N ORREM
"RTN","ORKPS1",103,0)
 .S ZZ=$G(^TMP($J,"DD",XX,0)),ORMTYPE=$P($P(ZZ,U,4),";",2)
"RTN","ORKPS1",104,0)
 .S ORREM=$P($P(ZZ,U,4),";") I (ORREM["Z"),$D(^TMP($J,ORGLOBL,"OUT","REMOTE",+ORREM)) D
"RTN","ORKPS1",105,0)
 ..N ORTXT,ORREM1,ORREMSIG
"RTN","ORKPS1",106,0)
 ..S ORREM1=$G(^TMP($J,ORGLOBL,"OUT","REMOTE",+ORREM))
"RTN","ORKPS1",107,0)
 ..S ORREMSIG=$G(^TMP($J,ORGLOBL,"OUT","REMOTE",+ORREM,"SIG",0))
"RTN","ORKPS1",108,0)
 ..S ORTXT=" "_ORREMSIG_" ["_$P(ORREM1,U,4)_" -  Last Fill: "_$P(ORREM1,U,6)_"  Quantity Dispensed: "_$P(ORREM1,U,8)_"] >>"_$P(ORREM1,U)
"RTN","ORKPS1",109,0)
 ..S $P(ZZ,U,2)=$P(ZZ,U,2)_ORTXT
"RTN","ORKPS1",110,0)
 .I +ORDPROSP,$G(TDATA("NEW","PTYPE"))'=$G(ORMTYPE) Q
"RTN","ORKPS1",111,0)
 .S ORN=$P($P(ZZ,U,3),";"),ORZ=""
"RTN","ORKPS1",112,0)
 .I $L($G(ORN))>0,+$G(ORN)=+$G(ORIFN) Q  ;QUIT if dup med ord # = current ord #
"RTN","ORKPS1",113,0)
 .I +$G(ORIFN),+$G(ORN)=$P(^OR(100,+ORIFN,3),U,5) Q  ;QUIT if dup med ord # = the current order #'s REPLACED ORDER (changing an order)
"RTN","ORKPS1",114,0)
 .I +ORDPROSP,+$P(ORPROSP,U,2)'=+ZZ Q
"RTN","ORKPS1",115,0)
 .I $L(ORN),$D(^OR(100,ORN,8,0)) S ORZ=^OR(100,ORN,8,0)
"RTN","ORKPS1",116,0)
 .I $L($G(ORZ)),($P(^OR(100,ORN,8,$P(ORZ,U,3),0),U,2)="DC") Q
"RTN","ORKPS1",117,0)
 .I $L(ORN),$P(^ORD(100.01,$P(^OR(100,ORN,3),U,3),0),U)="DISCONTINUED" Q
"RTN","ORKPS1",118,0)
 .I ZZ'="" S YY(II)="DD^"_ZZ,II=II+1
"RTN","ORKPS1",119,0)
 .S ^TMP($J,"DD",XX,"OC")="" ;set this if this DD entry turned into an OC
"RTN","ORKPS1",120,0)
 Q
"RTN","ORKPS1",121,0)
 ;
"RTN","ORKPS1",122,0)
DT(TDATA) ;add duplicate therapy checks
"RTN","ORKPS1",123,0)
 N I
"RTN","ORKPS1",124,0)
 S GL=$NA(^TMP($J,ORGLOBL,"OUT","THERAPY"))
"RTN","ORKPS1",125,0)
 S I=0 F  S I=$O(@GL@(I)) Q:'I  D
"RTN","ORKPS1",126,0)
 .;get all drug names
"RTN","ORKPS1",127,0)
 .N ORDRUGS,ORCLASS,ORF,ORPROSCNT,ORPROFCNT,DRUGS,ORRETSTR S ORDRUGS="",ORCLASS="",ORF=0,ORPROSCNT=0,ORPROFCNT=0
"RTN","ORKPS1",128,0)
 .S J=0 F  S J=$O(@GL@(I,"DRUGS",J)) Q:'J  D
"RTN","ORKPS1",129,0)
 ..;keep count of PROSPECTIVE drugs
"RTN","ORKPS1",130,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3,4)=TDATA("NEW","PROSP") S ORF=1
"RTN","ORKPS1",131,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3)="PROSPECTIVE" D
"RTN","ORKPS1",132,0)
 ...S ORPROSCNT=1+$G(ORPROSCNT)
"RTN","ORKPS1",133,0)
 ...I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3,4)'=TDATA("NEW","PROSP") S ORDRUGS=ORDRUGS_$S($L(ORDRUGS):", ",1:"")_$P($G(@GL@(I,"DRUGS",J)),U,3)_" [UNRELEASED]",DRUGS($P($G(@GL@(I,"DRUGS",J)),U,3))=""
"RTN","ORKPS1",134,0)
 ..;-check each PROFILE drug to see if it is not the same order as the prospective (ORIFN)
"RTN","ORKPS1",135,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3)="PROFILE" D
"RTN","ORKPS1",136,0)
 ...;if not the same then set ORNUM=THE PROFILE DRUG "O;PSNUM"
"RTN","ORKPS1",137,0)
 ...I $P($P($G(@GL@(I,"DRUGS",J)),U),";",2)'=$G(^OR(100,+$G(ORIFN),4)) D
"RTN","ORKPS1",138,0)
 ....I $L($P($G(@GL@(I,"DRUGS",J)),U,4))>0,(+$P($G(@GL@(I,"DRUGS",J)),U,4)=$P($G(^OR(100,+$G(ORIFN),3)),U,5)) Q
"RTN","ORKPS1",139,0)
 ....I $L($P($G(@GL@(I,"DRUGS",J)),U,4))>0,(+$P($G(@GL@(I,"DRUGS",J)),U,4)=+$G(ORIFN)) Q
"RTN","ORKPS1",140,0)
 ....I $E($G(@GL@(I,"DRUGS",J)),1)="R" S $P(@GL@(I,"DRUGS",J),U,5)="O"
"RTN","ORKPS1",141,0)
 ....I $E($G(@GL@(I,"DRUGS",J)),1)="C" S $P(@GL@(I,"DRUGS",J),U,5)="O" ; p402 IMO or CLINIC ORDER
"RTN","ORKPS1",142,0)
 ....I $G(TDATA("NEW","PTYPE"))'=$P($G(@GL@(I,"DRUGS",J)),U,5) Q
"RTN","ORKPS1",143,0)
 ....S ORNUM=$P($P($G(@GL@(I,"DRUGS",J)),U),";",1,2)
"RTN","ORKPS1",144,0)
 ....I $$INDD($P($G(@GL@(I,"DRUGS",J)),U,3))=0 D
"RTN","ORKPS1",145,0)
 .....S ORDRUGS=ORDRUGS_$S($L(ORDRUGS):", ",1:"")_$P($G(@GL@(I,"DRUGS",J)),U,3)_" ["_$$PHSTAT(DFN,ORNUM)_"]"
"RTN","ORKPS1",146,0)
 .....S DRUGS($P($G(@GL@(I,"DRUGS",J)),U,3))=$P($G(@GL@(I,"DRUGS",J)),U,4),ORPROFCNT=ORPROFCNT+1
"RTN","ORKPS1",147,0)
 .Q:'$$CHKDD(.DRUGS)
"RTN","ORKPS1",148,0)
 .;quit if ORNUM is not set and PROSPECTIVE count <=1
"RTN","ORKPS1",149,0)
 .Q:('$L($G(ORNUM))&(ORPROSCNT<2))
"RTN","ORKPS1",150,0)
 .;get all classes
"RTN","ORKPS1",151,0)
 .I ORF S J=0 F  S J=$O(@GL@(I,J)) Q:'J  D
"RTN","ORKPS1",152,0)
 ..S ORCLASS=ORCLASS_$S($L(ORCLASS):", ",1:"")_$G(@GL@(I,J,"CLASS"))
"RTN","ORKPS1",153,0)
 .;assemble return string ("DC"+ORNUM_U_Classes_U_Classes (drugs))
"RTN","ORKPS1",154,0)
 .S ORRETSTR="Duplicate Therapy: Order(s) exist for {"_ORDRUGS_"} in the same therapeutic categor(ies): "_ORCLASS
"RTN","ORKPS1",155,0)
 .I ORF S YY(II)="DC"_U_$G(ORNUM)_U_ORCLASS_U_ORRETSTR,II=II+1
"RTN","ORKPS1",156,0)
 Q
"RTN","ORKPS1",157,0)
 ;
"RTN","ORKPS1",158,0)
PHSTAT(DFN,ORNUM) ;get the status of the order
"RTN","ORKPS1",159,0)
 N RET,J,I
"RTN","ORKPS1",160,0)
 S RET=""
"RTN","ORKPS1",161,0)
 I $P(ORNUM,";")="P" S RET="PENDING"
"RTN","ORKPS1",162,0)
 I $P(ORNUM,";")="N" S RET="ACTIVE NON-VA"
"RTN","ORKPS1",163,0)
 I $P(ORNUM,";")="O" D
"RTN","ORKPS1",164,0)
 .K ^TMP($J,"OROCLST") D RX^PSO52API(DFN,"OROCLST",$P(ORNUM,";",2),,"ST")
"RTN","ORKPS1",165,0)
 .S RET=$P($G(^TMP($J,"OROCLST",DFN,$P(ORNUM,";",2),100)),U,2)
"RTN","ORKPS1",166,0)
 .K ^TMP($J,"OROCLST")
"RTN","ORKPS1",167,0)
 I $P(ORNUM,";")="I"!($E($P(ORNUM,";"),1)="C") D
"RTN","ORKPS1",168,0)
 .N ORLAST,ORPHNUM
"RTN","ORKPS1",169,0)
 .I $E($P(ORNUM,";"),1)="C" S ORLAST=$S($E($P(ORNUM,";"),2)=1:"V",$E($P(ORNUM,";"),2)=2:"U",1:"NV")
"RTN","ORKPS1",170,0)
 .E  S ORLAST=$E(ORNUM,$L(ORNUM))
"RTN","ORKPS1",171,0)
 .I ORLAST="P" S RET="PENDING" Q
"RTN","ORKPS1",172,0)
 .S ORPHNUM=+$P(ORNUM,";",2)
"RTN","ORKPS1",173,0)
 .I ORLAST="U" D
"RTN","ORKPS1",174,0)
 ..K ^TMP($J,"OR GET STATUS") D PSS431^PSS55(DFN,ORPHNUM,"","","OR GET STATUS")
"RTN","ORKPS1",175,0)
 ..S RET=$P($G(^TMP($J,"OR GET STATUS",ORPHNUM,28)),U,2)
"RTN","ORKPS1",176,0)
 .I ORLAST="V" D
"RTN","ORKPS1",177,0)
 ..K ^TMP($J,"OR GET STATUS") D PSS436^PSS55(DFN,ORPHNUM,"OR GET STATUS")
"RTN","ORKPS1",178,0)
 ..S RET=$P($G(^TMP($J,"OR GET STATUS",ORPHNUM,100)),U,2)
"RTN","ORKPS1",179,0)
 .I ORLAST="NV" D
"RTN","ORKPS1",180,0)
 ..K ^TMP($J,"OR GET STATUS") D PSJ^PSJ53P1(ORPHNUM,"OR GET STATUS")
"RTN","ORKPS1",181,0)
 ..S RET=$P($G(^TMP($J,"OR GET STATUS",ORPHNUM,28)),U,2)
"RTN","ORKPS1",182,0)
 .S:$E($P(ORNUM,";"),1)="C" RET=RET_" CLINIC ORDER"
"RTN","ORKPS1",183,0)
 I $P(ORNUM,";")="R" D
"RTN","ORKPS1",184,0)
 .N ORREMOTE S ORREMOTE=$G(^TMP($J,ORGLOBL,"OUT","REMOTE",$P(ORNUM,";",2)))
"RTN","ORKPS1",185,0)
 .S RET=$P(ORREMOTE,U,4)_" >> "_$P(ORREMOTE,U)
"RTN","ORKPS1",186,0)
 I "^PENDING^NON-VERIFIED^NON VERIFIED^INCOMPLETE^DRUG INTERACTIONS^"[(U_RET_U) S RET="PENDING"
"RTN","ORKPS1",187,0)
 Q RET
"RTN","ORKPS1",188,0)
 ;
"RTN","ORKPS1",189,0)
CHKDD(DARRAY) ;check the duplicate drug OCs returned
"RTN","ORKPS1",190,0)
 ;if all drugs in DARRAY are already displayed in a DD OC then don't show the DT OC (return 0)
"RTN","ORKPS1",191,0)
 ;check the ^TMP($J,"DD",I,"OC") node to see if the DD entry turned into an OC
"RTN","ORKPS1",192,0)
 N I S I=0 F  S I=$O(^TMP($J,"DD",I)) Q:'I  D
"RTN","ORKPS1",193,0)
 .I $D(DARRAY($P($G(^TMP($J,"DD",I,0)),U,2))),$D(^TMP($J,"DD",I,"OC")) D
"RTN","ORKPS1",194,0)
 ..K DARRAY($P($G(^TMP($J,"DD",I,0)),U,2))
"RTN","ORKPS1",195,0)
 .N J S J=0 F  S J=$O(DARRAY(J)) Q:'$L(J)  D
"RTN","ORKPS1",196,0)
 ..I DARRAY(J)=$P($G(^TMP($J,"DD",I,0)),U,3),($L(DARRAY(J))>0) D
"RTN","ORKPS1",197,0)
 ...K DARRAY(J)
"RTN","ORKPS1",198,0)
 Q $D(DARRAY)
"RTN","ORKPS1",199,0)
 ;
"RTN","ORKPS1",200,0)
INDD(ORDRUG) ;checks if ORDRUG is in the duplicate drug OCs returned
"RTN","ORKPS1",201,0)
 N RET S RET=0
"RTN","ORKPS1",202,0)
 N I S I=0 F  S I=$O(^TMP($J,"DD",I)) Q:'I  D
"RTN","ORKPS1",203,0)
 .I ORDRUG=$P($G(^TMP($J,"DD",I,0)),U,2),$D(^TMP($J,"DD",I,"OC")) S RET=1
"RTN","ORKPS1",204,0)
 Q RET
"RTN","ORKPS1",205,0)
 ;
"VER")
8.0^22.0
"BLD",9865,6)
^359
**END**
**END**

