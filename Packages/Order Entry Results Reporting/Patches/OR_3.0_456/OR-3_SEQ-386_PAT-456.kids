Released OR*3*456 SEQ #386
Extracted from mail message
**KIDS**:OR*3.0*456^

**INSTALL NAME**
OR*3.0*456
"BLD",10418,0)
OR*3.0*456^ORDER ENTRY/RESULTS REPORTING^0^3170912^y
"BLD",10418,1,0)
^^1^1^3170907^
"BLD",10418,1,1,0)
FLAGGED ORDER SURROGATE NOTIFICATION ISSUE
"BLD",10418,4,0)
^9.64PA^^
"BLD",10418,6)
1^
"BLD",10418,6.3)
2
"BLD",10418,"ABPKG")
n
"BLD",10418,"KRN",0)
^9.67PA^779.2^20
"BLD",10418,"KRN",.4,0)
.4
"BLD",10418,"KRN",.401,0)
.401
"BLD",10418,"KRN",.402,0)
.402
"BLD",10418,"KRN",.403,0)
.403
"BLD",10418,"KRN",.5,0)
.5
"BLD",10418,"KRN",.84,0)
.84
"BLD",10418,"KRN",3.6,0)
3.6
"BLD",10418,"KRN",3.8,0)
3.8
"BLD",10418,"KRN",9.2,0)
9.2
"BLD",10418,"KRN",9.8,0)
9.8
"BLD",10418,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10418,"KRN",9.8,"NM",1,0)
ORWORR1^^0^B9884468
"BLD",10418,"KRN",9.8,"NM","B","ORWORR1",1)

"BLD",10418,"KRN",19,0)
19
"BLD",10418,"KRN",19.1,0)
19.1
"BLD",10418,"KRN",101,0)
101
"BLD",10418,"KRN",409.61,0)
409.61
"BLD",10418,"KRN",771,0)
771
"BLD",10418,"KRN",779.2,0)
779.2
"BLD",10418,"KRN",870,0)
870
"BLD",10418,"KRN",8989.51,0)
8989.51
"BLD",10418,"KRN",8989.52,0)
8989.52
"BLD",10418,"KRN",8994,0)
8994
"BLD",10418,"KRN","B",.4,.4)

"BLD",10418,"KRN","B",.401,.401)

"BLD",10418,"KRN","B",.402,.402)

"BLD",10418,"KRN","B",.403,.403)

"BLD",10418,"KRN","B",.5,.5)

"BLD",10418,"KRN","B",.84,.84)

"BLD",10418,"KRN","B",3.6,3.6)

"BLD",10418,"KRN","B",3.8,3.8)

"BLD",10418,"KRN","B",9.2,9.2)

"BLD",10418,"KRN","B",9.8,9.8)

"BLD",10418,"KRN","B",19,19)

"BLD",10418,"KRN","B",19.1,19.1)

"BLD",10418,"KRN","B",101,101)

"BLD",10418,"KRN","B",409.61,409.61)

"BLD",10418,"KRN","B",771,771)

"BLD",10418,"KRN","B",779.2,779.2)

"BLD",10418,"KRN","B",870,870)

"BLD",10418,"KRN","B",8989.51,8989.51)

"BLD",10418,"KRN","B",8989.52,8989.52)

"BLD",10418,"KRN","B",8994,8994)

"BLD",10418,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10418,"QUES",0)
^9.62^^
"BLD",10418,"REQB",0)
^9.611^1^1
"BLD",10418,"REQB",1,0)
OR*3.0*243^1
"BLD",10418,"REQB","B","OR*3.0*243",1)

"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
456^3170912^520824646
"PKG",188,22,1,"PAH",1,1,0)
^^1^1^3170912
"PKG",188,22,1,"PAH",1,1,1,0)
FLAGGED ORDER SURROGATE NOTIFICATION ISSUE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORWORR1")
0^1^B9884468^B7659282
"RTN","ORWORR1",1,0)
ORWORR1 ; SLC/JLI - Utilities for Retrieve Orders for Broker ; 4/3/08 7:47am
"RTN","ORWORR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,243,456**;Dec 17, 1997;Build 2
"RTN","ORWORR1",3,0)
 ;Called from ORWORR
"RTN","ORWORR1",4,0)
 ;
"RTN","ORWORR1",5,0)
 ; External References
"RTN","ORWORR1",6,0)
 ;   DBIA  4834  GETUSER1^XQALDATA
"RTN","ORWORR1",7,0)
 ;   DBIA  2790  $$CURRSURO^XQALSURO
"RTN","ORWORR1",8,0)
 ;
"RTN","ORWORR1",9,0)
GET1 ; 
"RTN","ORWORR1",10,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",11,0)
 S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S IFN=^(I) D
"RTN","ORWORR1",12,0)
 . I $G(ORRECIP)&&($G(FILTER)=12&&($$FLAGRULE(+IFN))) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",13,0)
 . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",14,0)
 . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",15,0)
 . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",16,0)
 . S ^TMP("ORR",$J,ORLIST,I)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",17,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",18,0)
 S ^TMP("ORR",$J,ORLIST,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",19,0)
 S REF=$NA(^TMP("ORR",$J,ORLIST))
"RTN","ORWORR1",20,0)
 Q
"RTN","ORWORR1",21,0)
GET2 ; For AUTO DC/Event Release Orders
"RTN","ORWORR1",22,0)
 N JDND,JDIX,JDCNT,DCSPLIT
"RTN","ORWORR1",23,0)
 S JDCNT=1,DCSPLIT=0
"RTN","ORWORR1",24,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",25,0)
 F JDND="RL","DC" D
"RTN","ORWORR1",26,0)
 . S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  D
"RTN","ORWORR1",27,0)
 . . I '$D(^TMP("ORR",$J,ORLIST,I,JDND)) Q
"RTN","ORWORR1",28,0)
 . . S JDIX=0 F  S JDIX=$O(^TMP("ORR",$J,ORLIST,I,JDND,JDIX)) Q:'JDIX  S IFN=^(JDIX)  D
"RTN","ORWORR1",29,0)
 . . . I 'DCSPLIT,(JDND="DC") D
"RTN","ORWORR1",30,0)
 . . . . S ^TMP("ORRJD",$J,JDCNT)="DC START"
"RTN","ORWORR1",31,0)
 . . . . S DCSPLIT=1,JDCNT=JDCNT+1,TOT=TOT+1
"RTN","ORWORR1",32,0)
 . . . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) S TOT=TOT-1 Q
"RTN","ORWORR1",33,0)
 . . . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",34,0)
 . . . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",35,0)
 . . . S ^TMP("ORRJD",$J,JDCNT)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",36,0)
 . . . S JDCNT=JDCNT+1
"RTN","ORWORR1",37,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",38,0)
 S ^TMP("ORRJD",$J,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",39,0)
 S REF=$NA(^TMP("ORRJD",$J))
"RTN","ORWORR1",40,0)
 Q
"RTN","ORWORR1",41,0)
FLAGRULE(ORNUM,USR) ;
"RTN","ORWORR1",42,0)
 ;returns 0 if we should keep ORNUM in the list
"RTN","ORWORR1",43,0)
 ;returns 1 if we should remove ORNUM from the list
"RTN","ORWORR1",44,0)
 ;determines based on whether the user USR should see these flagged orders
"RTN","ORWORR1",45,0)
 ; based on presence in file 100 NODE 8 FIELD 39 and
"RTN","ORWORR1",46,0)
 ; based on whether the user should have gotten the flag due to provider recipients
"RTN","ORWORR1",47,0)
 N ORI,ORRET,ORQUIT,I,LST,ORDFN
"RTN","ORWORR1",48,0)
 I '$G(USR) S USR=DUZ
"RTN","ORWORR1",49,0)
 S ORRET=1,ORQUIT=0
"RTN","ORWORR1",50,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORNUM,8,ORI)) Q:'ORI  D
"RTN","ORWORR1",51,0)
 .I '$P($G(^OR(100,ORNUM,8,ORI,3)),U,6)&($P($G(^OR(100,ORNUM,8,ORI,3)),U,9)) S LST($P($G(^OR(100,ORNUM,8,ORI,3)),U,9))=""
"RTN","ORWORR1",52,0)
 S ORDFN=+$P($G(^OR(100,ORNUM,0)),U,2)
"RTN","ORWORR1",53,0)
 D START^ORBPRCHK(.LST,ORNUM,6,ORDFN)
"RTN","ORWORR1",54,0)
 ;add ordering provider
"RTN","ORWORR1",55,0)
 N ORDPROV
"RTN","ORWORR1",56,0)
 S ORDPROV=$$ORDERER^ORQOR2(ORNUM)
"RTN","ORWORR1",57,0)
 I $G(ORDPROV) S LST(ORDPROV)=""
"RTN","ORWORR1",58,0)
 D ADDSURR(.LST)
"RTN","ORWORR1",59,0)
 ;p456 add the current user if they have a notification associated with the current order
"RTN","ORWORR1",60,0)
 N ORNLST,ORI,ORRTN,ORMTCH S ORNLST=0,ORI=0,ORMTCH=0,ORRTN="" D GETUSER1^XQALDATA("ORNLST",DUZ) I ORNLST D
"RTN","ORWORR1",61,0)
 .F  S ORI=$O(ORNLST(ORI)) Q:'ORI  D  Q:ORMTCH
"RTN","ORWORR1",62,0)
 ..D GETDATA^ORWORB(.ORRTN,$P(ORNLST(ORI),U,2))
"RTN","ORWORR1",63,0)
 ..I +ORRTN=ORNUM S LST(DUZ)="",ORMTCH=1
"RTN","ORWORR1",64,0)
 I $D(LST(USR)) S ORRET=0
"RTN","ORWORR1",65,0)
 Q ORRET
"RTN","ORWORR1",66,0)
ADDSURR(LST) ;TAKE LIST OF USERS AND ADD SURROGATES TO THE LIST
"RTN","ORWORR1",67,0)
 N I
"RTN","ORWORR1",68,0)
 S I=0 F  S I=$O(LST(I)) Q:'I  S LST($$CURRSURO^XQALSURO(I))=""
"RTN","ORWORR1",69,0)
 Q
"VER")
8.0^22.2
"BLD",10418,6)
^386
**END**
**END**

