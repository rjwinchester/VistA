EMERGENCY Released OR*3*461 SEQ #379
Extracted from mail message
**KIDS**:OR*3.0*461^

**INSTALL NAME**
OR*3.0*461
"BLD",10440,0)
OR*3.0*461^ORDER ENTRY/RESULTS REPORTING^0^3170710^y
"BLD",10440,4,0)
^9.64PA^^
"BLD",10440,6.3)
8
"BLD",10440,"ABPKG")
n
"BLD",10440,"INID")
^y
"BLD",10440,"INIT")
EN^ORY461
"BLD",10440,"KRN",0)
^9.67PA^779.2^20
"BLD",10440,"KRN",.4,0)
.4
"BLD",10440,"KRN",.401,0)
.401
"BLD",10440,"KRN",.402,0)
.402
"BLD",10440,"KRN",.403,0)
.403
"BLD",10440,"KRN",.5,0)
.5
"BLD",10440,"KRN",.84,0)
.84
"BLD",10440,"KRN",3.6,0)
3.6
"BLD",10440,"KRN",3.8,0)
3.8
"BLD",10440,"KRN",9.2,0)
9.2
"BLD",10440,"KRN",9.8,0)
9.8
"BLD",10440,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10440,"KRN",9.8,"NM",1,0)
ORWDX^^0^B84918116
"BLD",10440,"KRN",9.8,"NM",2,0)
ORWDX1^^0^B58032777
"BLD",10440,"KRN",9.8,"NM",3,0)
ORUTL5^^0^B1343402
"BLD",10440,"KRN",9.8,"NM","B","ORUTL5",3)

"BLD",10440,"KRN",9.8,"NM","B","ORWDX",1)

"BLD",10440,"KRN",9.8,"NM","B","ORWDX1",2)

"BLD",10440,"KRN",19,0)
19
"BLD",10440,"KRN",19.1,0)
19.1
"BLD",10440,"KRN",101,0)
101
"BLD",10440,"KRN",409.61,0)
409.61
"BLD",10440,"KRN",771,0)
771
"BLD",10440,"KRN",779.2,0)
779.2
"BLD",10440,"KRN",870,0)
870
"BLD",10440,"KRN",8989.51,0)
8989.51
"BLD",10440,"KRN",8989.52,0)
8989.52
"BLD",10440,"KRN",8994,0)
8994
"BLD",10440,"KRN","B",.4,.4)

"BLD",10440,"KRN","B",.401,.401)

"BLD",10440,"KRN","B",.402,.402)

"BLD",10440,"KRN","B",.403,.403)

"BLD",10440,"KRN","B",.5,.5)

"BLD",10440,"KRN","B",.84,.84)

"BLD",10440,"KRN","B",3.6,3.6)

"BLD",10440,"KRN","B",3.8,3.8)

"BLD",10440,"KRN","B",9.2,9.2)

"BLD",10440,"KRN","B",9.8,9.8)

"BLD",10440,"KRN","B",19,19)

"BLD",10440,"KRN","B",19.1,19.1)

"BLD",10440,"KRN","B",101,101)

"BLD",10440,"KRN","B",409.61,409.61)

"BLD",10440,"KRN","B",771,771)

"BLD",10440,"KRN","B",779.2,779.2)

"BLD",10440,"KRN","B",870,870)

"BLD",10440,"KRN","B",8989.51,8989.51)

"BLD",10440,"KRN","B",8989.52,8989.52)

"BLD",10440,"KRN","B",8994,8994)

"BLD",10440,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10440,"QUES",0)
^9.62^^
"BLD",10440,"REQB",0)
^9.611^1^1
"BLD",10440,"REQB",1,0)
OR*3.0*421^2
"BLD",10440,"REQB","B","OR*3.0*421",1)

"INIT")
EN^ORY461
"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
461^3170710^520736439
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORUTL5")
0^3^B1343402^n/a
"RTN","ORUTL5",1,0)
ORUTL5 ; SLC/JLC - OE/RR Utilities ;06/19/17  16:17
"RTN","ORUTL5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**461**;Dec 17, 1997;Build 8
"RTN","ORUTL5",3,0)
 ;
"RTN","ORUTL5",4,0)
 ;
"RTN","ORUTL5",5,0)
 ;
"RTN","ORUTL5",6,0)
MSG(ORREC,ORMSGT) ;
"RTN","ORUTL5",7,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,ORTEXT,SITE,I,A
"RTN","ORUTL5",8,0)
 S ORTEXT(1)="Attempt to save order with INPATIENT MEDICATIONS Display Group",SITE=$$SITE^VASITE()
"RTN","ORUTL5",9,0)
 S ORTEXT(2)=" "
"RTN","ORUTL5",10,0)
 S A="ORMSGT("""")" F I=3:1 S A=$Q(@A) Q:A=""  S ORTEXT(I)=$P(A,"(",2,99)_" = "_@A
"RTN","ORUTL5",11,0)
 S XMDUZ=DUZ
"RTN","ORUTL5",12,0)
 S XMSUB="NEW PROBLEM ORDER SUBMITTED FROM "_$P(SITE,"^",2)
"RTN","ORUTL5",13,0)
 S XMY("G.HPS CLIN2@FORUM.DOMAIN.EXT")="",XMY("G.CLINICAL REMINDERS SUPPORT@FORUM.DOMAIN.EXT")=""
"RTN","ORUTL5",14,0)
 S XMTEXT="ORTEXT("
"RTN","ORUTL5",15,0)
 D ^XMD
"RTN","ORWDX")
0^1^B84918116^B76124297
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dialog utilities ;06/19/17  17:29
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178,187,190,195,215,246,243,283,296,280,306,350,424,421,461**;Dec 17, 1997;Build 8
"RTN","ORWDX",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","ORWDX",4,0)
 ;
"RTN","ORWDX",5,0)
 ;Reference to DIC(9.4 supported by IA #2058
"RTN","ORWDX",6,0)
 ;Reference to ^SC( supported by ICR #10040
"RTN","ORWDX",7,0)
 ;Reference to ^DPT( supported by ICR #10035
"RTN","ORWDX",8,0)
 ;
"RTN","ORWDX",9,0)
 ;Sep 18, 2015 - PB - modified to trigger an unsolicited sync action
"RTN","ORWDX",10,0)
 ;
"RTN","ORWDX",11,0)
ORDITM(Y,FROM,DIR,XREF,QOCALL) ; Subset of orderable items
"RTN","ORWDX",12,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",13,0)
 N I,IEN,CNT,X,DTXT,CURTM,DEFROUTE
"RTN","ORWDX",14,0)
 S DEFROUTE=""
"RTN","ORWDX",15,0)
 S QOCALL=+$G(QOCALL)
"RTN","ORWDX",16,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",17,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",18,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",19,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",20,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",21,0)
 . . I 'QOCALL,$P(X,U,5) Q
"RTN","ORWDX",22,0)
 . . S I=I+1
"RTN","ORWDX",23,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",24,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",25,0)
 Q
"RTN","ORWDX",26,0)
ODITMBC(Y,XREF,ODLST) ;
"RTN","ORWDX",27,0)
 N CNT,NM,XRF
"RTN","ORWDX",28,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",29,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",30,0)
 Q
"RTN","ORWDX",31,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",32,0)
 D FNDINFO^ORWDX1(.Y,.ODIEN)
"RTN","ORWDX",33,0)
 Q
"RTN","ORWDX",34,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",35,0)
 D DLGDEF^ORWDX1(.LST,.DLG)
"RTN","ORWDX",36,0)
 Q
"RTN","ORWDX",37,0)
DLGQUIK(LST,QO) ;(NOT USED)
"RTN","ORWDX",38,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",39,0)
 Q
"RTN","ORWDX",40,0)
LOADRSP(LST,RSPID,TRANS)      ; Load responses from 101.41 or 100
"RTN","ORWDX",41,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",42,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",43,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT,ORLOC S ROOT=""
"RTN","ORWDX",44,0)
 K ^TMP($J,"ORWDX LOADRSP","QO SAVE")
"RTN","ORWDX",45,0)
 I +RSPID=$P(RSPID,"-",1) D
"RTN","ORWDX",46,0)
 .S ^TMP($J,"ORWDX LOADRSP","QO SAVE")=+RSPID
"RTN","ORWDX",47,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT^ORWDX2
"RTN","ORWDX",48,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT^ORWDX2
"RTN","ORWDX",49,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT^ORWDX2
"RTN","ORWDX",50,0)
 Q:ROOT=""
"RTN","ORWDX",51,0)
 G XROOT^ORWDX2
"RTN","ORWDX",52,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA,ORAPPT,ORSRC,OREVTDF) ;
"RTN","ORWDX",53,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",54,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog, ORAPPT=Appointment
"RTN","ORWDX",55,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",56,0)
 N MSGCAPT,SENDMSG
"RTN","ORWDX",57,0)
 ;S ORDG=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",""))
"RTN","ORWDX",58,0)
 N XCNT,XCOMM,XDONE,XX  ;SBR
"RTN","ORWDX",59,0)
 S (XCOMM,XCNT)=""  ;SBR
"RTN","ORWDX",60,0)
 I $G(ORIFN)'="" D  ;SBR problem only occurs on change or renew orders
"RTN","ORWDX",61,0)
 . S XCNT=$O(^OR(100,+ORIFN,4.5,"ID","COMMENT",XCNT))  ;SBR
"RTN","ORWDX",62,0)
 . I XCNT'="" S XCOMM=$P($G(^OR(100,+ORIFN,4.5,XCNT,0)),"^",2)  ;SBR
"RTN","ORWDX",63,0)
 . I XCOMM'="" S XDONE=0,XX="" F  S XX=$O(ORDIALOG("WP",XCOMM,1,XX)) Q:XX=""  D  ;SBR
"RTN","ORWDX",64,0)
 . . I ORDIALOG("WP",XCOMM,1,XX,0)'="" S XDONE=1 Q  ;SBR
"RTN","ORWDX",65,0)
 . I XCOMM'="",'$G(XDONE),$D(ORDIALOG("WP",XCOMM)) K ORDIALOG("WP",XCOMM)  ;SBR
"RTN","ORWDX",66,0)
 S ORCATFN="" I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",67,0)
 S SENDMSG=0 I $P($G(^ORD(100.98,ORDG,0)),U)="INPATIENT MEDICATIONS" D
"RTN","ORWDX",68,0)
 .S MSGCAPT("PATIENT")=ORVP,MSGCAPT("USER")=ORNP,MSGCAPT("LOC")=+$G(ORL)
"RTN","ORWDX",69,0)
 .S MSGCAPT("DIALOG")=DLG,MSGCAPT("DISPLAY GROUP")=ORDG,MSGCAPT("QUICK ORDER")=ORIT
"RTN","ORWDX",70,0)
 .M MSGCAPT("ORDIALOG")=ORDIALOG
"RTN","ORWDX",71,0)
 .S ORDG=$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS","")),SENDMSG=1
"RTN","ORWDX",72,0)
 ;Remove treating facility if inpatient and IMO order 26.42
"RTN","ORWDX",73,0)
 I $G(^DPT(ORVP,.1))'="",$P($G(^ORD(100.98,ORDG,0)),U)="CLINIC MEDICATIONS" K ORDIALOG("ORTS")
"RTN","ORWDX",74,0)
 I $G(^DPT(ORVP,.1))'="",$P($G(^ORD(100.98,ORDG,0)),U)="CLINIC INFUSIONS" K ORDIALOG("ORTS")
"RTN","ORWDX",75,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",76,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",77,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",78,0)
 ;=====================================================
"RTN","ORWDX",79,0)
 ; Changed for v26.27 (RV)
"RTN","ORWDX",80,0)
 S ORCAT=$$INPT^ORCD,ORCAT=$S(ORCAT=1:"I",1:"O")
"RTN","ORWDX",81,0)
 ;I $L($G(OREVENT)) D
"RTN","ORWDX",82,0)
 ;. S ONPASS=0
"RTN","ORWDX",83,0)
 ;. S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",84,0)
 ;. I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",85,0)
 ;. S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",86,0)
 ;E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",87,0)
 ;=====================================================
"RTN","ORWDX",88,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",89,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",90,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",91,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",92,0)
 I DLG="PSO OERR"!(DLG="PSO SUPPLY") S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",93,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",94,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",95,0)
 I DLG="PSJ OR CLINIC OE" S ORCAT="I"
"RTN","ORWDX",96,0)
 I DLG="CLINIC OR PAT FLUID OE" S ORCAT="I"
"RTN","ORWDX",97,0)
 S:DLG="FHW1" ORCAT="I" S:DLG?1"FHW "2.7U1" MEAL" ORCAT="O"
"RTN","ORWDX",98,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",99,0)
 I ORDG=$O(^ORD(100.98,"B","LAB",0)) D  ;use section
"RTN","ORWDX",100,0)
 . N OI,SUB S OI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDX",101,0)
 . S SUB=$P($G(^ORD(101.43,OI,"LR")),U,6),ORDG=$$DGRP^ORMLR(SUB)
"RTN","ORWDX",102,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",103,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",104,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",105,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",106,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",107,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",108,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",109,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",110,0)
 I $G(ORWP94) D
"RTN","ORWDX",111,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",112,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",113,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",114,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",115,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",116,0)
 S ORSRC=$G(ORSRC)
"RTN","ORWDX",117,0)
 D DELPI^ORWDX1 ;delete empty PI
"RTN","ORWDX",118,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",119,0)
 . D EN^ORCSAVE
"RTN","ORWDX",120,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",121,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",122,0)
 . D COMP^ORMBLDOR(+$G(ORIFN)) ;Sep 28, 2015 - PB - modified to trigger an unsolicited sync action
"RTN","ORWDX",123,0)
 E  D
"RTN","ORWDX",124,0)
 . N OR0
"RTN","ORWDX",125,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",126,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",127,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",128,0)
 . D COMP^ORMBLDOR(+$G(ORIFN)) ;Sep 28, 2015 - PB - modified to trigger an unsolicited sync action
"RTN","ORWDX",129,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",130,0)
 I SENDMSG D
"RTN","ORWDX",131,0)
 .S MSGCAPT("ORIGINAL IEN")=$G(ORIFN)
"RTN","ORWDX",132,0)
 .D MSG^ORUTL5(REC,.MSGCAPT)
"RTN","ORWDX",133,0)
 .;M ^XTMP("AGP ORDER TEST")=MSGCAPT
"RTN","ORWDX",134,0)
 Q
"RTN","ORWDX",135,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",136,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN,J,EVENT,LOCK,OR3
"RTN","ORWDX",137,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",138,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D  Q:ORWERR]""
"RTN","ORWDX",139,0)
 . S (ORIFN,ORWLST(ORIX))=ORIENS(ORIX)
"RTN","ORWDX",140,0)
 . S PTEVT=$P(^OR(100,+ORIFN,0),U,17)
"RTN","ORWDX",141,0)
 . I PTEVT D
"RTN","ORWDX",142,0)
 .. I $D(EVENT(PTEVT)) S LOCK=1 Q
"RTN","ORWDX",143,0)
 .. S LOCK=$$LCKEVT^ORX2(PTEVT) S:LOCK EVENT(PTEVT)=""
"RTN","ORWDX",144,0)
 . I 'LOCK S ORWERR="1^delayed event is locked - another user is processing orders for this event" S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",145,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",146,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",147,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",148,0)
 .. S ORSIGST=$P($G(^(0)),U,4),ORNATURE=$P($G(^(0)),U,12) ;naked references refer to OR(100,+ORIFN,8,ORDA on line above
"RTN","ORWDX",149,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",150,0)
 . I OK,$G(LOCK) D
"RTN","ORWDX",151,0)
 .. S OR3=$G(^OR(100,+ORIFN,3)) I $P(OR3,"^",3)'=10!($P(OR3,"^",9)]"") D UNLK1^ORX2(ORIENS(ORIX)) Q  ;order already released or has a parent
"RTN","ORWDX",152,0)
 .. S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",153,0)
 .. S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",154,0)
 .. D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX)) ;add ,LOCK to if statement for 195
"RTN","ORWDX",155,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",156,0)
 . E  D
"RTN","ORWDX",157,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",158,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",159,0)
 . S X="RS"
"RTN","ORWDX",160,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",161,0)
 S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195
"RTN","ORWDX",162,0)
 Q
"RTN","ORWDX",163,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",164,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",165,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",166,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X,I
"RTN","ORWDX",167,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",168,0)
 F I="LR","VBEC" S X=+$O(^DIC(9.4,"C",I,0)) S:X ORLR(X)=1
"RTN","ORWDX",169,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",170,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",171,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",172,0)
 . S ORBEF=0
"RTN","ORWDX",173,0)
 . I '$D(^OR(100,+ORDERID,0)) Q
"RTN","ORWDX",174,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",175,0)
 . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),"^",4)=3:"",1:ORWNATR)
"RTN","ORWDX",176,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",177,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",178,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",179,0)
 .. I $G(ORLR(+$P(^OR(100,+ORDERID,0),U,14))),'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",180,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",181,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",182,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",183,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",184,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",185,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",186,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",187,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",188,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",189,0)
 I $D(ORWLST)>9 D
"RTN","ORWDX",190,0)
 . N I,A
"RTN","ORWDX",191,0)
 . S I=0 F  S I=$O(ORWLST(I)) Q:I=""  S A=$G(ORWLST(I)) I A["Invalid Procedure, Inactive, no Imaging Type" D SM^ORWDX2(A)
"RTN","ORWDX",192,0)
  Q
"RTN","ORWDX",193,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",194,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",195,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",196,0)
 Q
"RTN","ORWDX",197,0)
FORMID(VAL,ORIFN) ; Base dlg FormID for an order
"RTN","ORWDX",198,0)
 N DLG
"RTN","ORWDX",199,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",200,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",201,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",202,0)
 Q
"RTN","ORWDX",203,0)
AGAIN(VAL,DLG) ; return true to keep dlg for another order
"RTN","ORWDX",204,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",205,0)
 Q
"RTN","ORWDX",206,0)
DGRP(VAL,DLG) ; Display grp pointer for a dlg
"RTN","ORWDX",207,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",208,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",209,0)
 Q
"RTN","ORWDX",210,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",211,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",212,0)
 Q
"RTN","ORWDX",213,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",214,0)
 G WRLST1^ORWDX1
"RTN","ORWDX",215,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",216,0)
 N I
"RTN","ORWDX",217,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",218,0)
 Q
"RTN","ORWDX",219,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",220,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",221,0)
 Q
"RTN","ORWDX",222,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",223,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",224,0)
 Q
"RTN","ORWDX",225,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",226,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",227,0)
 Q
"RTN","ORWDX",228,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",229,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",230,0)
 Q
"RTN","ORWDX",231,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",232,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",233,0)
 Q
"RTN","ORWDX",234,0)
UNLKOTH(OK,ORIFN) ; Unlock pt not by this session
"RTN","ORWDX",235,0)
 K ^XTMP("ORPTLK-"_ORIFN) S OK=1
"RTN","ORWDX",236,0)
 Q
"RTN","ORWDX1")
0^2^B58032777^B53489734
"RTN","ORWDX1",1,0)
ORWDX1 ; SLC/KCM/REV - Utilities for Order Dialogs ;06/20/17  07:41
"RTN","ORWDX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,187,195,215,243,296,341,350,461**;Dec 17, 1997;Build 8
"RTN","ORWDX1",3,0)
 ;
"RTN","ORWDX1",4,0)
 ;
"RTN","ORWDX1",5,0)
 ;
"RTN","ORWDX1",6,0)
 ;Reference to ^PSSORUTE supported by ICR #4555
"RTN","ORWDX1",7,0)
 ;Reference to ^SC( supported by ICR #10040
"RTN","ORWDX1",8,0)
 ;Reference to ^DIC(42 supported by ICR #10039
"RTN","ORWDX1",9,0)
 ;Reference to ^DPT( supported by ICR #10035
"RTN","ORWDX1",10,0)
 ;
"RTN","ORWDX1",11,0)
WRLST(LST,LOC) ; Return list of dialogs for writing orders
"RTN","ORWDX1",12,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","ORWDX1",13,0)
WRLST1 N ANENT
"RTN","ORWDX1",14,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","ORWDX1",15,0)
 S ANENT="ALL^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORWDX1",16,0)
 D WRLSTB(.LST) Q:$D(LST)>1  ; check ORWDX WRITE ORDERS first
"RTN","ORWDX1",17,0)
 N ORX,X0,X5,ORERR,I,SEQ,IEN,DGRP,FID,TXT,TYP
"RTN","ORWDX1",18,0)
 D GETLST^XPAR(.ORX,ANENT,"ORWOR WRITE ORDERS LIST","Q",.ORERR) Q:ORERR
"RTN","ORWDX1",19,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  D
"RTN","ORWDX1",20,0)
 . S SEQ=+ORX(I),IEN=$P(ORX(I),U,2),X0=$G(^ORD(101.41,+IEN,0)),X5=$G(^(5))
"RTN","ORWDX1",21,0)
 . S DGRP=+$P(X0,U,5),FID=+$P(X5,U,5),TXT=$P(X5,U,4),TYP=$P(X0,U,4)
"RTN","ORWDX1",22,0)
 . S:'$L(TXT) TXT=$P(X0,U,2)
"RTN","ORWDX1",23,0)
 . I $P(X0,U,4)="M" S:'FID FID=1001
"RTN","ORWDX1",24,0)
 . S LST(SEQ)=IEN_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",25,0)
 Q
"RTN","ORWDX1",26,0)
WRLSTB(LST)     ; return menu from which Write Orders list is built
"RTN","ORWDX1",27,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","ORWDX1",28,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS LIST",1,"I") Q:'MNU
"RTN","ORWDX1",29,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDX1",30,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","ORWDX1",31,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","ORWDX1",32,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","ORWDX1",33,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","ORWDX1",34,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","ORWDX1",35,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","ORWDX1",36,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",37,0)
 Q
"RTN","ORWDX1",38,0)
DELPI ; delete PI from ORDIALOG if PI = ""
"RTN","ORWDX1",39,0)
 ;Called from SAVE^ORWDX
"RTN","ORWDX1",40,0)
 N ORPI S ORPI=0
"RTN","ORWDX1",41,0)
 S ORPI=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",ORPI))
"RTN","ORWDX1",42,0)
 Q:'$D(ORDIALOG(ORPI))  ;ORDIALOG is passed into SAVE^ORWDX which calls this section
"RTN","ORWDX1",43,0)
 I '$D(ORDIALOG(ORPI,1)) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
"RTN","ORWDX1",44,0)
 N PINODE,PITX
"RTN","ORWDX1",45,0)
 S PITX="",PINODE=$G(ORDIALOG(ORPI,1))
"RTN","ORWDX1",46,0)
 S PITX=$G(@PINODE@(1,0))
"RTN","ORWDX1",47,0)
 S PITX=$TR(PITX," ","")
"RTN","ORWDX1",48,0)
 I '$L(PITX) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
"RTN","ORWDX1",49,0)
 N ORSIG S ORSIG=+$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX1",50,0)
 I $$STR^ORWDXR(ORSIG)[$$STR^ORWDXR(ORPI) S ORDIALOG(ORPI,"FORMAT")="@"
"RTN","ORWDX1",51,0)
 Q
"RTN","ORWDX1",52,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX1",53,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX1",54,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX1",55,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX1",56,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX1",57,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI) ;XRF NEW'd in ORWDX which calls this section
"RTN","ORWDX1",58,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX1",59,0)
 .. I ODI=ODIEN D
"RTN","ORWDX1",60,0)
 ... S NM=NM+1 ;variable NEW'd in ORWDX which calls this section
"RTN","ORWDX1",61,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX1",62,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX1",63,0)
 Q
"RTN","ORWDX1",64,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX1",65,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX1",66,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX1",67,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX1",68,0)
 Q:'DLG
"RTN","ORWDX1",69,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX1",70,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX1",71,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX1",72,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX1",73,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX1",74,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX1",75,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDL DIETS" S $P(LST(ILST),U)="ADDLDIETS"
"RTN","ORWDX1",76,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX1",77,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX1",78,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX1",79,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX1",80,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX1",81,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX1",82,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX1",83,0)
 Q
"RTN","ORWDX1",84,0)
 ;
"RTN","ORWDX1",85,0)
CHANGE(ORLST,ORCLST,DFN,ISIMO) ;
"RTN","ORWDX1",86,0)
 N CATCH,CHANGE,CNT,INP,INPDIEN,IVM,IVMDIEN,ORIEN,ORLOC,OR3,ORDG
"RTN","ORWDX1",87,0)
 N CIEN,CIVIEN,DIAL,TDIAL,TIEN,UDIEN,QORDDG,PACKIEN
"RTN","ORWDX1",88,0)
 S (INP,IVM,INPDIEN,IVMDIEN,UDIEN)=0
"RTN","ORWDX1",89,0)
 S (TDIAL,TIEN,CIEN,CIVIEN)=0
"RTN","ORWDX1",90,0)
 S INP=$O(^ORD(101.41,"B","PSJ OR PAT OE","")) Q:INP'>0
"RTN","ORWDX1",91,0)
 S IVM=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE","")) Q:IVM'>0
"RTN","ORWDX1",92,0)
 S TDIAL=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDER","")) Q:TDIAL'>0
"RTN","ORWDX1",93,0)
 S INPDIEN=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS","")) Q:INPDIEN'>0
"RTN","ORWDX1",94,0)
 S IVMDIEN=$O(^ORD(100.98,"B","IV MEDICATIONS","")) Q:IVMDIEN'>0
"RTN","ORWDX1",95,0)
 S UDIEN=$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS","")) Q:UDIEN'>0
"RTN","ORWDX1",96,0)
 S TIEN=$O(^ORD(100.98,"B","NURSING","")) Q:TIEN'>0
"RTN","ORWDX1",97,0)
 S CIEN=$O(^ORD(100.98,"B","CLINIC MEDICATIONS","")) Q:CIEN'>0
"RTN","ORWDX1",98,0)
 S CIVIEN=$O(^ORD(100.98,"B","CLINIC INFUSIONS","")) Q:CIEN'>0
"RTN","ORWDX1",99,0)
 S CNT=0 F  S CNT=$O(ORCLST(CNT)) Q:CNT'>0  D
"RTN","ORWDX1",100,0)
 .S CHANGE=0
"RTN","ORWDX1",101,0)
 .S ORIEN=$P($G(ORCLST(CNT)),U),ORIEN=$P(ORIEN,";")
"RTN","ORWDX1",102,0)
 .S ORDG=$P($G(^OR(100,ORIEN,0)),U,11)
"RTN","ORWDX1",103,0)
 .S ORLOC=$P($G(ORCLST(CNT)),U,2)
"RTN","ORWDX1",104,0)
 .S OR3=$G(^OR(100,ORIEN,3))
"RTN","ORWDX1",105,0)
 .S DIAL=$P(OR3,U,4)
"RTN","ORWDX1",106,0)
 .;Remove Treating Speciality if the order location is the clinic
"RTN","ORWDX1",107,0)
 .I $P($G(^OR(100,ORIEN,0)),U,10)=(ORLOC_";SC("),$P($G(^SC(ORLOC,0)),U,3)="C" D  Q
"RTN","ORWDX1",108,0)
 ..S $P(^OR(100,ORIEN,0),U,13)=""
"RTN","ORWDX1",109,0)
 .;
"RTN","ORWDX1",110,0)
 .;CHANGE PATIENT LOCATION AND PATIENT STATUS.
"RTN","ORWDX1",111,0)
 .S $P(^OR(100,ORIEN,0),U,10)=ORLOC_";SC("
"RTN","ORWDX1",112,0)
 .S PACKIEN=$P(^OR(100,ORIEN,0),U,14)
"RTN","ORWDX1",113,0)
 .I $$GET1^DIQ(9.4,PACKIEN_",",1)'="PSO" S $P(^OR(100,ORIEN,0),U,12)="I"
"RTN","ORWDX1",114,0)
 .;
"RTN","ORWDX1",115,0)
 .;Check for IMO orders Nursing Dialog problem
"RTN","ORWDX1",116,0)
 .S CATCH=$P($G(^OR(100,ORIEN,0)),U,11)
"RTN","ORWDX1",117,0)
 .;
"RTN","ORWDX1",118,0)
 .S $P(^OR(100,ORIEN,0),U,11)=$S(DIAL=(IVM_";ORD(101.41,"):IVMDIEN,DIAL=(INP_";ORD(101.41,"):UDIEN,DIAL=(TDIAL_";ORD(101.41,"):TIEN,1:CATCH)
"RTN","ORWDX1",119,0)
 .;
"RTN","ORWDX1",120,0)
 .;Check for Quick Order Dialog
"RTN","ORWDX1",121,0)
 .I CATCH=$P($G(^OR(100,ORIEN,0)),U,11),ISIMO=1 D
"RTN","ORWDX1",122,0)
 ..S QORDDG=$P($G(^ORD(101.41,+DIAL,0)),U,5)
"RTN","ORWDX1",123,0)
 ..I QORDDG=UDIEN!(QORDDG=INPDIEN) S $P(^OR(100,ORIEN,0),U,11)=UDIEN,DIAL=(INP_";ORD(101.41,") Q
"RTN","ORWDX1",124,0)
 ..I QORDDG=IVMDIEN S $P(^OR(100,ORIEN,0),U,11)=IVMDIEN,DIAL=(IVM_";ORD(101.41,") Q
"RTN","ORWDX1",125,0)
 ..I QORDDG=TIEN S $P(^OR(100,ORIEN,0),U,11)=TIEN,DIAL=(TDIAL_";ORD(101.41,") Q
"RTN","ORWDX1",126,0)
 .;
"RTN","ORWDX1",127,0)
 .;Add treating spec if Inpatient order
"RTN","ORWDX1",128,0)
 .;I (ISIMO=1)&(DIAL=(IVM_";ORD(101.41,"))!(DIAL=(INP_";ORD(101.41,")) D
"RTN","ORWDX1",129,0)
 .;.S $P(^OR(100,ORIEN,0),U,13)=+$G(^DPT(DFN,.103))
"RTN","ORWDX1",130,0)
 .I ISIMO=0 S $P(^OR(100,ORIEN,0),U,13)=+$G(^DPT(DFN,.103))
"RTN","ORWDX1",131,0)
 Q
"RTN","ORWDX1",132,0)
 ;
"RTN","ORWDX1",133,0)
STCHANGE(ORY,DFN,ORYARR) ;
"RTN","ORWDX1",134,0)
 N CNT,DONE,NODE,PHARMID,STR,STATUS
"RTN","ORWDX1",135,0)
 S ORY=0,DONE=0
"RTN","ORWDX1",136,0)
 I '$$PATCH^XPDUTL("PSS*1.0*93") Q
"RTN","ORWDX1",137,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0!(DONE>0)  D
"RTN","ORWDX1",138,0)
 . S NODE=$G(ORYARR(CNT))
"RTN","ORWDX1",139,0)
 . S PHARMID=$P(NODE,U),STATUS=$P(NODE,U,2)
"RTN","ORWDX1",140,0)
 . I $$UP^XLFSTR(STATUS)'=$$STATUS^PSSORUTE(DFN,PHARMID) S ORY=1,DONE=1
"RTN","ORWDX1",141,0)
 Q
"RTN","ORWDX1",142,0)
ORDMATCH(ORY,DFN,ORYARR) ;
"RTN","ORWDX1",143,0)
 N ACTION,CNT,IEN,MATCH,ORDERID,STATUS
"RTN","ORWDX1",144,0)
 S CNT=0,MATCH=1
"RTN","ORWDX1",145,0)
 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0!(MATCH=0)  D
"RTN","ORWDX1",146,0)
 . S ORDERID=$P(ORYARR(CNT),U),STATUS=$P(ORYARR(CNT),U,2)
"RTN","ORWDX1",147,0)
 . ;*341 Set up Action before validation.
"RTN","ORWDX1",148,0)
 . S IEN=$P(ORDERID,";"),ACTION=$P(ORDERID,";",2)
"RTN","ORWDX1",149,0)
 . I ORDERID=0,$G(ACTION)="" Q
"RTN","ORWDX1",150,0)
 . I STATUS=$P($G(^OR(100,IEN,3)),U,3) Q
"RTN","ORWDX1",151,0)
 . I $P($G(^ORD(100.01,STATUS,0)),U)="DISCONTINUED/EDIT" Q
"RTN","ORWDX1",152,0)
 . ;S MATCH=0
"RTN","ORWDX1",153,0)
 . I $P($G(^OR(100,IEN,8,ACTION,0)),U,15)'=STATUS S MATCH=0
"RTN","ORWDX1",154,0)
 S ORY=MATCH
"RTN","ORWDX1",155,0)
 Q
"RTN","ORWDX1",156,0)
 ;
"RTN","ORWDX1",157,0)
DCREN(ORY,ORYARR) ;
"RTN","ORWDX1",158,0)
 N ACT,CNT,CNT1,I,OR3,ORG,ORGID,ORID,TEXT,STATUS
"RTN","ORWDX1",159,0)
 S CNT1=0
"RTN","ORWDX1",160,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0  D
"RTN","ORWDX1",161,0)
 .S ORGID=ORYARR(CNT)
"RTN","ORWDX1",162,0)
 .S ORID=+ORGID,ACT=$P(ORGID,";",2),TEXT=""
"RTN","ORWDX1",163,0)
 .S OR3=$G(^OR(100,ORID,3))
"RTN","ORWDX1",164,0)
 .;Make sure current order status is pending
"RTN","ORWDX1",165,0)
 .I $P($G(^ORD(100.01,$P(OR3,U,3),0)),U)'="PENDING" Q
"RTN","ORWDX1",166,0)
 .S ORG=$P($G(OR3),U,5) Q:ORG'>0
"RTN","ORWDX1",167,0)
 .;do not add original order if it is expired
"RTN","ORWDX1",168,0)
 .S STATUS=$P(^OR(100,ORG,3),U,3)
"RTN","ORWDX1",169,0)
 .I $P($G(^ORD(100.01,STATUS,0)),U)="EXPIRED" Q
"RTN","ORWDX1",170,0)
 .;Do not add original order if Stop date has pass
"RTN","ORWDX1",171,0)
 .I $P(^OR(100,ORG,0),U,9)'>$$NOW^XLFDT Q
"RTN","ORWDX1",172,0)
 .;make sure current order is a renewed order
"RTN","ORWDX1",173,0)
 .I $P(OR3,U,11)'=2 Q
"RTN","ORWDX1",174,0)
 .S ACT=+$P($G(^OR(100,ORG,3)),U,7)
"RTN","ORWDX1",175,0)
 .S CNT1=CNT1+1,ORY(CNT1)=ORGID_U_$P(OR3,U,5)_";"_ACT_U_TEXT
"RTN","ORWDX1",176,0)
 Q
"RTN","ORWDX1",177,0)
DCORIG(ORY,ORIEN) ;
"RTN","ORWDX1",178,0)
 S $P(^OR(100,+ORIEN,6),U,9)=1
"RTN","ORWDX1",179,0)
 Q
"RTN","ORWDX1",180,0)
UNDCORIG(ORY,ORYARR) ;
"RTN","ORWDX1",181,0)
 N CNT
"RTN","ORWDX1",182,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0  S $P(^OR(100,+ORYARR(CNT),6),U,9)=0
"RTN","ORWDX1",183,0)
 Q
"RTN","ORWDX1",184,0)
PATWARD(ORY,DFN) ;
"RTN","ORWDX1",185,0)
 N TEMP
"RTN","ORWDX1",186,0)
 S ORY=""
"RTN","ORWDX1",187,0)
 I $G(^DPT(DFN,.1))="" Q
"RTN","ORWDX1",188,0)
 S TEMP=^DPT(DFN,.1)
"RTN","ORWDX1",189,0)
 S ORY=TEMP_U_+$G(^DIC(42,+$O(^DIC(42,"B",TEMP,0)),44))
"RTN","ORWDX1",190,0)
 Q
"RTN","ORWDX1",191,0)
 ;
"RTN","ORWDX1",192,0)
ISPEND(ORIFN) ;Is the order's status pending?
"RTN","ORWDX1",193,0)
 N ISPEND,PENDST,N3 S ISPEND=0
"RTN","ORWDX1",194,0)
 Q:'$D(^OR(100,+ORIFN,3))
"RTN","ORWDX1",195,0)
 S PENDST=$O(^ORD(100.01,"B","PENDING",0))
"RTN","ORWDX1",196,0)
 S N3=$G(^OR(100,+ORIFN,3))
"RTN","ORWDX1",197,0)
 I $P(N3,U,3)=PENDST S ISPEND=1
"RTN","ORWDX1",198,0)
 Q ISPEND
"RTN","ORY461")
0^^B4728625^n/a
"RTN","ORY461",1,0)
ORY461 ; HPS/MWA - Post install routine for OR*3*461 ; 6/9/17 11:22am
"RTN","ORY461",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**461**;;Build 8
"RTN","ORY461",3,0)
 Q  ;only allow routine to be run from entry points
"RTN","ORY461",4,0)
EN ; main entry point
"RTN","ORY461",5,0)
 N I,II,III,IIII,IDG,DIA,INPTS,IEN,MSGCNT,ORMSG
"RTN","ORY461",6,0)
 S MSGCNT=5
"RTN","ORY461",7,0)
 S IDG="",IDG=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IDG))
"RTN","ORY461",8,0)
 S DIA="",DIA=$O(^ORD(101.41,"B","PSJ OR PAT OE",DIA))
"RTN","ORY461",9,0)
 ;get all currently admitted patients
"RTN","ORY461",10,0)
 S I="" F  S I=$O(^DPT("ACN",I)) Q:'$L(I)  D
"RTN","ORY461",11,0)
 .S II="" F  S II=$O(^DPT("ACN",I,II)) Q:'$L(II)  D
"RTN","ORY461",12,0)
 ..S INPTS(II_";DPT(")=""
"RTN","ORY461",13,0)
 S I="" F  S I=$O(INPTS(I)) Q:'$L(I)  D
"RTN","ORY461",14,0)
 .S II="" F  S II=$O(^OR(100,"AW",I,II)) Q:'$L(II)  D
"RTN","ORY461",15,0)
 ..S III="" F  S III=$O(^OR(100,"AW",I,II,III)) Q:'$L(III)  D
"RTN","ORY461",16,0)
 ...Q:($E(III,1,3)<316)
"RTN","ORY461",17,0)
 ...S IIII="" F  S IIII=$O(^OR(100,"AW",I,II,III,IIII)) Q:'$L(IIII)  D
"RTN","ORY461",18,0)
 ....S IEN=IIII I "^3^5^6^10^11^"[(U_$P($G(^OR(100,IEN,3)),U,3)_U),$P($G(^OR(100,IEN,0)),U,5)=(DIA_";ORD(101.41,"),$P(^OR(100,IIII,0),U,11)=IDG D FIX
"RTN","ORY461",19,0)
 D MAIL
"RTN","ORY461",20,0)
 Q
"RTN","ORY461",21,0)
FIX ; fix
"RTN","ORY461",22,0)
 ;                      I               II            III        IIII
"RTN","ORY461",23,0)
 ; ^OR(100,"AW",<OBJECT OF ORDER>,<DISPLAY GROUP>,<START DATE>,<ORDER#>)
"RTN","ORY461",24,0)
 N DA,DR,DIE S DIE="^OR(100,",DA=IIII,DR="23///UNIT DOSE MEDICATIONS" D ^DIE
"RTN","ORY461",25,0)
 S ORMSG(MSGCNT)=IIII,MSGCNT=MSGCNT+1
"RTN","ORY461",26,0)
 Q
"RTN","ORY461",27,0)
MAIL ; send mailman message
"RTN","ORY461",28,0)
 N XMSUB,XMDUZ,XMTEXT,XMY,DIFROM
"RTN","ORY461",29,0)
 S ORMSG(1)="OR*3.0*461 Post install routine has completed"
"RTN","ORY461",30,0)
 S ORMSG(2)="The following order(s) have had their display group changed"
"RTN","ORY461",31,0)
 S ORMSG(3)="from INPATIENT MEDICATIONS to UNIT DOSE MEDICATIONS"
"RTN","ORY461",32,0)
 S ORMSG(4)="**INFORMATIONAL ONLY - No action required** :"
"RTN","ORY461",33,0)
 I '$D(ORMSG(5)) S ORMSG(5)="No changes"
"RTN","ORY461",34,0)
 S XMSUB="OR*3.0*461 Post install routine has completed"
"RTN","ORY461",35,0)
 S XMDUZ="ORDER ENTRY/RESULTS REPORTING PACKAGE"
"RTN","ORY461",36,0)
 S XMTEXT="ORMSG("
"RTN","ORY461",37,0)
 S XMY(DUZ)=""
"RTN","ORY461",38,0)
 D ^XMD
"RTN","ORY461",39,0)
 Q
"VER")
8.0^22.2
"BLD",10440,6)
^379
**END**
**END**

