Released OR*3*472 SEQ #421
Extracted from mail message
**KIDS**:OR*3.0*472^

**INSTALL NAME**
OR*3.0*472
"BLD",10347,0)
OR*3.0*472^ORDER ENTRY/RESULTS REPORTING^0^3180831^y
"BLD",10347,1,0)
^^12^12^3180831^
"BLD",10347,1,1,0)
The Mental Health Suicide Prevention - Suicide High Risk Patient 
"BLD",10347,1,2,0)
Enhancements (SHRPE) effort incorporates enhancements that will modify the
"BLD",10347,1,3,0)
VistA Registration application and CPRS.
"BLD",10347,1,4,0)
 
"BLD",10347,1,5,0)
The Disruptive Behavior Reporting System (DBRS) record numbers can now be 
"BLD",10347,1,6,0)
recorded in the Registration (DG) files that are related to Patient Record
"BLD",10347,1,7,0)
Flags (PRF) which now provides a convenient reference between VistA and 
"BLD",10347,1,8,0)
the DBRS. The "Patient Record Flags" screen in CPRS is updated to display
"BLD",10347,1,9,0)
DBRS numbers entered for the patient.
"BLD",10347,1,10,0)
 
"BLD",10347,1,11,0)
This patch implements the functionality that allows CPRS to display the 
"BLD",10347,1,12,0)
DBRS data stored in VistA Registration database.
"BLD",10347,4,0)
^9.64PA^^
"BLD",10347,6)
3^
"BLD",10347,6.3)
11
"BLD",10347,"KRN",0)
^9.67PA^779.2^20
"BLD",10347,"KRN",.4,0)
.4
"BLD",10347,"KRN",.401,0)
.401
"BLD",10347,"KRN",.402,0)
.402
"BLD",10347,"KRN",.403,0)
.403
"BLD",10347,"KRN",.5,0)
.5
"BLD",10347,"KRN",.84,0)
.84
"BLD",10347,"KRN",3.6,0)
3.6
"BLD",10347,"KRN",3.8,0)
3.8
"BLD",10347,"KRN",9.2,0)
9.2
"BLD",10347,"KRN",9.8,0)
9.8
"BLD",10347,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10347,"KRN",9.8,"NM",1,0)
ORPRF^^0^B16953522
"BLD",10347,"KRN",9.8,"NM","B","ORPRF",1)

"BLD",10347,"KRN",19,0)
19
"BLD",10347,"KRN",19.1,0)
19.1
"BLD",10347,"KRN",101,0)
101
"BLD",10347,"KRN",409.61,0)
409.61
"BLD",10347,"KRN",771,0)
771
"BLD",10347,"KRN",779.2,0)
779.2
"BLD",10347,"KRN",870,0)
870
"BLD",10347,"KRN",8989.51,0)
8989.51
"BLD",10347,"KRN",8989.52,0)
8989.52
"BLD",10347,"KRN",8994,0)
8994
"BLD",10347,"KRN","B",.4,.4)

"BLD",10347,"KRN","B",.401,.401)

"BLD",10347,"KRN","B",.402,.402)

"BLD",10347,"KRN","B",.403,.403)

"BLD",10347,"KRN","B",.5,.5)

"BLD",10347,"KRN","B",.84,.84)

"BLD",10347,"KRN","B",3.6,3.6)

"BLD",10347,"KRN","B",3.8,3.8)

"BLD",10347,"KRN","B",9.2,9.2)

"BLD",10347,"KRN","B",9.8,9.8)

"BLD",10347,"KRN","B",19,19)

"BLD",10347,"KRN","B",19.1,19.1)

"BLD",10347,"KRN","B",101,101)

"BLD",10347,"KRN","B",409.61,409.61)

"BLD",10347,"KRN","B",771,771)

"BLD",10347,"KRN","B",779.2,779.2)

"BLD",10347,"KRN","B",870,870)

"BLD",10347,"KRN","B",8989.51,8989.51)

"BLD",10347,"KRN","B",8989.52,8989.52)

"BLD",10347,"KRN","B",8994,8994)

"BLD",10347,"QUES",0)
^9.62^^
"BLD",10347,"REQB",0)
^9.611^1^1
"BLD",10347,"REQB",1,0)
OR*3.0*243^1
"BLD",10347,"REQB","B","OR*3.0*243",1)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
472^3180831^520824647
"PKG",170,22,1,"PAH",1,1,0)
^^12^12^3180831
"PKG",170,22,1,"PAH",1,1,1,0)
The Mental Health Suicide Prevention - Suicide High Risk Patient 
"PKG",170,22,1,"PAH",1,1,2,0)
Enhancements (SHRPE) effort incorporates enhancements that will modify the
"PKG",170,22,1,"PAH",1,1,3,0)
VistA Registration application and CPRS.
"PKG",170,22,1,"PAH",1,1,4,0)
 
"PKG",170,22,1,"PAH",1,1,5,0)
The Disruptive Behavior Reporting System (DBRS) record numbers can now be 
"PKG",170,22,1,"PAH",1,1,6,0)
recorded in the Registration (DG) files that are related to Patient Record
"PKG",170,22,1,"PAH",1,1,7,0)
Flags (PRF) which now provides a convenient reference between VistA and 
"PKG",170,22,1,"PAH",1,1,8,0)
the DBRS. The "Patient Record Flags" screen in CPRS is updated to display
"PKG",170,22,1,"PAH",1,1,9,0)
DBRS numbers entered for the patient.
"PKG",170,22,1,"PAH",1,1,10,0)
 
"PKG",170,22,1,"PAH",1,1,11,0)
This patch implements the functionality that allows CPRS to display the 
"PKG",170,22,1,"PAH",1,1,12,0)
DBRS data stored in VistA Registration database.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORPRF")
0^1^B16953522^B13135968
"RTN","ORPRF",1,0)
ORPRF ;SLC/JLI-Patient record flag ;6/14/06
"RTN","ORPRF",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**173,187,190,215,243,472**;Dec 17, 1997;Build 11
"RTN","ORPRF",3,0)
 ;
"RTN","ORPRF",4,0)
FMT(ROOT,DBRSDATA) ; Format - Convert record flag data to displayable data
"RTN","ORPRF",5,0)
 ; Sets ^TMP("ORPRF",$J,NN) with flag data for multiple flags
"RTN","ORPRF",6,0)
 ; DBRSDATA - local array with DBRS data
"RTN","ORPRF",7,0)
 N IDX,IX,CNT
"RTN","ORPRF",8,0)
 S (IDX,CNT)=0
"RTN","ORPRF",9,0)
 F  S IDX=$O(ROOT(IDX)) Q:'IDX  D
"RTN","ORPRF",10,0)
 . S ^TMP("ORPRF",$J,IDX,"FLAG")=$P($G(ROOT(IDX,"FLAG")),U,2)
"RTN","ORPRF",11,0)
 . S ^TMP("ORPRF",$J,IDX,"CATEGORY")=$P($G(ROOT(IDX,"CATEGORY")),U,2)
"RTN","ORPRF",12,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Name:               "_$P($G(ROOT(IDX,"FLAG")),U,2)
"RTN","ORPRF",13,0)
 . I $D(ROOT(IDX,"NARR")) D
"RTN","ORPRF",14,0)
 . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="            "
"RTN","ORPRF",15,0)
 . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Assignment Narrative:   "
"RTN","ORPRF",16,0)
 . . S IX=0 F  S IX=$O(ROOT(IDX,"NARR",IX)) Q:'IX  D
"RTN","ORPRF",17,0)
 . . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)=$G(ROOT(IDX,"NARR",IX,0))
"RTN","ORPRF",18,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="            "
"RTN","ORPRF",19,0)
 . ; -- Assignment Details:
"RTN","ORPRF",20,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Type:               "_$P($G(ROOT(IDX,"FLAGTYPE")),U,2)
"RTN","ORPRF",21,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Category:           "_$P($G(ROOT(IDX,"CATEGORY")),U,2)
"RTN","ORPRF",22,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Assignment Status:       "_"Active"
"RTN","ORPRF",23,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Initial Assigned Date:   "_$P($G(ROOT(IDX,"ASSIGNDT")),U,2)
"RTN","ORPRF",24,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Approved by:             "_$P($G(ROOT(IDX,"APPRVBY")),U,2)
"RTN","ORPRF",25,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Next Review Date:        "_$P($G(ROOT(IDX,"REVIEWDT")),U,2)
"RTN","ORPRF",26,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Owner Site:              "_$P($G(ROOT(IDX,"OWNER")),U,2)
"RTN","ORPRF",27,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Originating Site:        "_$P($G(ROOT(IDX,"ORIGSITE")),U,2)
"RTN","ORPRF",28,0)
 . ;DBRS data
"RTN","ORPRF",29,0)
 . I $O(DBRSDATA("BEHAVIORAL",0)) I $P($G(ROOT(IDX,"FLAG")),U,2)="BEHAVIORAL" D
"RTN","ORPRF",30,0)
 . . N ORDBRSC,ORZDBRSD
"RTN","ORPRF",31,0)
 . . S ORDBRSC=0 F  S ORDBRSC=+$O(DBRSDATA("BEHAVIORAL",ORDBRSC)) Q:ORDBRSC=0  D
"RTN","ORPRF",32,0)
 . . . S ORZDBRSD=$G(DBRSDATA("BEHAVIORAL",ORDBRSC))
"RTN","ORPRF",33,0)
 . . . I $P(ORZDBRSD,U,1)']"" Q
"RTN","ORPRF",34,0)
 . . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="DBRS number:             "_$P(ORZDBRSD,U,1)
"RTN","ORPRF",35,0)
 . . . I $P(ORZDBRSD,U,2)]"" S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Other DBRS data:         "_$P(ORZDBRSD,U,2)
"RTN","ORPRF",36,0)
 K ROOT
"RTN","ORPRF",37,0)
 Q
"RTN","ORPRF",38,0)
 ;
"RTN","ORPRF",39,0)
HASFLG(ORY,PTDFN) ;Does patient PTDFN has flags
"RTN","ORPRF",40,0)
 ;     DBIA 3860: $$GETACT^DGPFAPI(PTDFN,.FLGDATA)
"RTN","ORPRF",41,0)
 ; Returns array ORY listing active assigned flags
"RTN","ORPRF",42,0)
 ; Array ORY has form:
"RTN","ORPRF",43,0)
 ;   ORY(flagID) = flagID^flagname,CAT1
"RTN","ORPRF",44,0)
 ;      where CAT1 is 1 if flag is cat 1, 0 if cat 2
"RTN","ORPRF",45,0)
 ; ORY = Num of items returned in array ORY = num of flags
"RTN","ORPRF",46,0)
 I '$L($TEXT(GETACT^DGPFAPI)) S ORY=0 Q
"RTN","ORPRF",47,0)
 N IDY,PRFARR,CAT1
"RTN","ORPRF",48,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",49,0)
 S ORY=$$GETACT^DGPFAPI(PTDFN,"PRFARR")
"RTN","ORPRF",50,0)
 Q:'ORY
"RTN","ORPRF",51,0)
 ;
"RTN","ORPRF",52,0)
 N DBRSARR
"RTN","ORPRF",53,0)
 ;ICR# 6874 - check if DG*5.3*951 installed and then call the API 
"RTN","ORPRF",54,0)
 I $T(GETDBRS^DGPFDBRS)'="" I $$GETDBRS^DGPFDBRS(PTDFN,.DBRSARR)
"RTN","ORPRF",55,0)
 D FMT(.@("PRFARR"),.DBRSARR) ; Sets ^TMP("ORPRF"
"RTN","ORPRF",56,0)
 S IDY=0 F  S IDY=$O(^TMP("ORPRF",$J,IDY)) Q:'IDY  D
"RTN","ORPRF",57,0)
 . S ORY(IDY)=IDY_U_$G(^TMP("ORPRF",$J,IDY,"FLAG"))
"RTN","ORPRF",58,0)
 . S CAT1=0
"RTN","ORPRF",59,0)
 . I $G(^TMP("ORPRF",$J,IDY,"CATEGORY"))="I (NATIONAL)" S CAT1=1
"RTN","ORPRF",60,0)
 . S ORY(IDY)=ORY(IDY)_U_CAT1
"RTN","ORPRF",61,0)
 Q
"RTN","ORPRF",62,0)
 ;
"RTN","ORPRF",63,0)
HASFLG1(ORY,PTDFN) ; Does patient PTDFN have **Cat I** flags
"RTN","ORPRF",64,0)
 ; Returns array ORY listing active assigned Cat I flags
"RTN","ORPRF",65,0)
 ; Array ORY has form:
"RTN","ORPRF",66,0)
 ;   ORY(flagID) = flagID^flagname
"RTN","ORPRF",67,0)
 ; ORY = Num of Cat I flags
"RTN","ORPRF",68,0)
 ;   If pt has no Cat I flags ORY = 0 and no flags are returned.
"RTN","ORPRF",69,0)
 ; Also calls FMT^ORPRF, which sets ^TMP("ORPRF" for Cat I flags
"RTN","ORPRF",70,0)
 ;  
"RTN","ORPRF",71,0)
 I '$L($TEXT(GETACT^DGPFAPI)) S ORY=0 Q
"RTN","ORPRF",72,0)
 N FLAGID,PRFARR,CAT1CNT,ACTFLGS
"RTN","ORPRF",73,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",74,0)
 S ACTFLGS=$$GETACT^DGPFAPI(PTDFN,"PRFARR")
"RTN","ORPRF",75,0)
 I 'ACTFLGS S ORY=0 Q
"RTN","ORPRF",76,0)
 S (FLAGID,CAT1CNT)=0
"RTN","ORPRF",77,0)
 F  S FLAGID=$O(PRFARR(FLAGID)) Q:'FLAGID  D
"RTN","ORPRF",78,0)
 . I $P($G(PRFARR(FLAGID,"CATEGORY"))," ")="I" S CAT1CNT=CAT1CNT+1 Q
"RTN","ORPRF",79,0)
 . K PRFARR(FLAGID)
"RTN","ORPRF",80,0)
 I 'CAT1CNT S ORY=0 Q
"RTN","ORPRF",81,0)
 D FMT(.@("PRFARR"))
"RTN","ORPRF",82,0)
 S IDY=0 F  S IDY=$O(^TMP("ORPRF",$J,IDY)) Q:'IDY  D
"RTN","ORPRF",83,0)
 . S ORY(IDY)=IDY_U_$G(^TMP("ORPRF",$J,IDY,"FLAG"))
"RTN","ORPRF",84,0)
 S ORY=CAT1CNT
"RTN","ORPRF",85,0)
 Q
"RTN","ORPRF",86,0)
 ;
"RTN","ORPRF",87,0)
HASCAT1(HASCAT1,PTDFN) ;Does patient have Category I flags (no arrays)
"RTN","ORPRF",88,0)
 ; Returns boolean HASCAT1 = 0 or 1
"RTN","ORPRF",89,0)
 ; Does NOT set arrays or TMP globals
"RTN","ORPRF",90,0)
 N FLAGID,PRFARR,ACTFLGS
"RTN","ORPRF",91,0)
 S (HASCAT1,FLAGID)=0
"RTN","ORPRF",92,0)
 S ACTFLGS=$$GETACT^DGPFAPI(PTDFN,"PRFARR") I 'ACTFLGS G HASCAT1X
"RTN","ORPRF",93,0)
 F  S FLAGID=$O(PRFARR(FLAGID)) Q:'FLAGID  D  Q:HASCAT1
"RTN","ORPRF",94,0)
 . I $P($G(PRFARR(FLAGID,"CATEGORY"))," ")="I" S HASCAT1=1
"RTN","ORPRF",95,0)
HASCAT1X ;
"RTN","ORPRF",96,0)
 Q
"RTN","ORPRF",97,0)
 ;
"RTN","ORPRF",98,0)
TRIGRPOP(POPUP,PTDFN) ;Should the flag display pop up upon patient selection
"RTN","ORPRF",99,0)
 ; for patient PTDFN?
"RTN","ORPRF",100,0)
 ;As of 1/10/06, returns POPUP as:
"RTN","ORPRF",101,0)
 ;   1 if pt has any active flags, either Cat I or Cat II
"RTN","ORPRF",102,0)
 ;   0 otherwise
"RTN","ORPRF",103,0)
 N PRFARR
"RTN","ORPRF",104,0)
 S POPUP=$S($$GETACT^DGPFAPI(PTDFN,"PRFARR"):1,1:0)
"RTN","ORPRF",105,0)
 Q
"RTN","ORPRF",106,0)
 ;
"RTN","ORPRF",107,0)
GETFLG(ORY,PTDFN,FLAGID) ;Return detailed flag info for flag FLAGID
"RTN","ORPRF",108,0)
 I '$D(^TMP("ORPRF",$J,FLAGID)) Q
"RTN","ORPRF",109,0)
 N IX,CNT
"RTN","ORPRF",110,0)
 S (IX,CNT)=0
"RTN","ORPRF",111,0)
 F  S IX=$O(^TMP("ORPRF",$J,FLAGID,IX)) Q:'IX  D
"RTN","ORPRF",112,0)
 . S CNT=CNT+1,ORY(CNT)=$G(^TMP("ORPRF",$J,FLAGID,IX))
"RTN","ORPRF",113,0)
 Q
"RTN","ORPRF",114,0)
 ;
"RTN","ORPRF",115,0)
CLEAR(ORY) ;Clear up the temp global
"RTN","ORPRF",116,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",117,0)
 Q
"RTN","ORPRF",118,0)
 ;
"VER")
8.0^22.2
"BLD",10347,6)
^421
**END**
**END**

