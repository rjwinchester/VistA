EMERGENCY Released OR*3*440 SEQ #376
Extracted from mail message
**KIDS**:OR*3.0*440^

**INSTALL NAME**
OR*3.0*440
"BLD",10351,0)
OR*3.0*440^ORDER ENTRY/RESULTS REPORTING^0^3161027^y
"BLD",10351,4,0)
^9.64PA^^
"BLD",10351,6.3)
4
"BLD",10351,"KRN",0)
^9.67PA^779.2^20
"BLD",10351,"KRN",.4,0)
.4
"BLD",10351,"KRN",.401,0)
.401
"BLD",10351,"KRN",.402,0)
.402
"BLD",10351,"KRN",.403,0)
.403
"BLD",10351,"KRN",.5,0)
.5
"BLD",10351,"KRN",.84,0)
.84
"BLD",10351,"KRN",3.6,0)
3.6
"BLD",10351,"KRN",3.8,0)
3.8
"BLD",10351,"KRN",9.2,0)
9.2
"BLD",10351,"KRN",9.8,0)
9.8
"BLD",10351,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10351,"KRN",9.8,"NM",1,0)
ORCDPS^^0^B43486132
"BLD",10351,"KRN",9.8,"NM","B","ORCDPS",1)

"BLD",10351,"KRN",19,0)
19
"BLD",10351,"KRN",19.1,0)
19.1
"BLD",10351,"KRN",101,0)
101
"BLD",10351,"KRN",409.61,0)
409.61
"BLD",10351,"KRN",771,0)
771
"BLD",10351,"KRN",779.2,0)
779.2
"BLD",10351,"KRN",870,0)
870
"BLD",10351,"KRN",8989.51,0)
8989.51
"BLD",10351,"KRN",8989.52,0)
8989.52
"BLD",10351,"KRN",8994,0)
8994
"BLD",10351,"KRN","B",.4,.4)

"BLD",10351,"KRN","B",.401,.401)

"BLD",10351,"KRN","B",.402,.402)

"BLD",10351,"KRN","B",.403,.403)

"BLD",10351,"KRN","B",.5,.5)

"BLD",10351,"KRN","B",.84,.84)

"BLD",10351,"KRN","B",3.6,3.6)

"BLD",10351,"KRN","B",3.8,3.8)

"BLD",10351,"KRN","B",9.2,9.2)

"BLD",10351,"KRN","B",9.8,9.8)

"BLD",10351,"KRN","B",19,19)

"BLD",10351,"KRN","B",19.1,19.1)

"BLD",10351,"KRN","B",101,101)

"BLD",10351,"KRN","B",409.61,409.61)

"BLD",10351,"KRN","B",771,771)

"BLD",10351,"KRN","B",779.2,779.2)

"BLD",10351,"KRN","B",870,870)

"BLD",10351,"KRN","B",8989.51,8989.51)

"BLD",10351,"KRN","B",8989.52,8989.52)

"BLD",10351,"KRN","B",8994,8994)

"BLD",10351,"QUES",0)
^9.62^^
"BLD",10351,"REQB",0)
^9.611^1^1
"BLD",10351,"REQB",1,0)
OR*3.0*350^1
"BLD",10351,"REQB","B","OR*3.0*350",1)

"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
440^3161027
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORCDPS")
0^1^B43486132^B41761091
"RTN","ORCDPS",1,0)
ORCDPS ;SLC/MKB - Pharmacy dialog utilities ;5/1/2012 14:30
"RTN","ORCDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,38,62,86,94,129,350,440**;Dec 17, 1997;Build 4
"RTN","ORCDPS",3,0)
 ;
"RTN","ORCDPS",4,0)
 ; ** Keep for backwards compatibility, just in case:
"RTN","ORCDPS",5,0)
 ;
"RTN","ORCDPS",6,0)
CHANGED(TYPE) ; -- Kill dependent values when OI changes
"RTN","ORCDPS",7,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPS",8,0)
 Q:'$L($G(TYPE))  S PROMPTS=""
"RTN","ORCDPS",9,0)
 I TYPE="U" S PROMPTS="DISPENSE DRUG^INSTRUCTIONS^ROUTE" K ORSCHED,ORQTY
"RTN","ORCDPS",10,0)
 I TYPE="O" S PROMPTS="DISPENSE DRUG^INSTRUCTIONS^FREE TEXT^ROUTE^SCHEDULE^DURATION" K ORSCHED,ORQTY
"RTN","ORCDPS",11,0)
 S:TYPE="IVB" PROMPTS="VOLUME"
"RTN","ORCDPS",12,0)
 S:TYPE="IVA" PROMPTS="STRENGTH PSIV^UNITS"
"RTN","ORCDPS",13,0)
 I TYPE="ALL" S PROMPTS="ORDERABLE ITEM^DISPENSE DRUG^INSTRUCTIONS^FREE TEXT^ROUTE^SCHEDULE^DURATION^URGENCY^QUANTITY^REFILLS^ROUTING^SERVICE CONNECTED^VOLUME^STRENGTH PSIV^UNITS^ADDITIVE^INFUSION RATE^WORD PROCESSING 1" K ORSCHED,ORQTY
"RTN","ORCDPS",14,0)
 S:TYPE="XFR" PROMPTS="DISPENSE DRUG^INSTRUCTIONS^FREE TEXT^DURATION^QUANTITY^REFILLS^ROUTING^START DATE^SERVICE CONNECTED"
"RTN","ORCDPS",15,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPS",16,0)
 . S PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) Q:'PTR
"RTN","ORCDPS",17,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPS",18,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDPS",19,0)
 Q
"RTN","ORCDPS",20,0)
 ;
"RTN","ORCDPS",21,0)
ASKSC() ; -- Return 1 or 0, if SC prompt should be asked
"RTN","ORCDPS",22,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) Q 0 ;exempt from copay
"RTN","ORCDPS",23,0)
 I $$RXST^IBARXEU(+ORVP)>0 Q 0 ;exempt from copay
"RTN","ORCDPS",24,0)
 Q 1
"RTN","ORCDPS",25,0)
 ;
"RTN","ORCDPS",26,0)
INSTR(OI) ; -- Get allowable instructions and routes
"RTN","ORCDPS",27,0)
 N PSOI,INSTR,NOUN,I,X,CNT
"RTN","ORCDPS",28,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),ORLEAD,ORNOUNS,ORSCHED
"RTN","ORCDPS",29,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2) D START^PSSJORDF(PSOI)
"RTN","ORCDPS",30,0)
 S:$L($G(^TMP("PSJSCH",$J))) ORSCHED=^($J) ;default schedule
"RTN","ORCDPS",31,0)
 Q:$P($G(^ORD(100.98,+ORDG,0)),U,3)'="O RX"  ; Don't need nouns for Inpt
"RTN","ORCDPS",32,0)
 S NOUN=$$PTR^ORCD("OR GTX FREE TEXT"),ORNOUNS="",(I,CNT)=0
"RTN","ORCDPS",33,0)
 F  S I=$O(^TMP("PSJNOUN",$J,I)) Q:I'>0  S X=$P(^(I),U) I $L(X) S CNT=CNT+1,ORDIALOG(NOUN,"LIST",CNT)=X_U_X,ORDIALOG(NOUN,"LIST","B",X)=X,ORNOUNS=ORNOUNS_$S($L(ORNOUNS):" or ",1:"")_X
"RTN","ORCDPS",34,0)
 S ORDIALOG(NOUN,"LIST")=CNT_"^1",INSTR=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORCDPS",35,0)
 S I=$O(^TMP("PSJINS",$J,0)),X=$P($G(^TMP("PSJINS",$J,+I)),U)
"RTN","ORCDPS",36,0)
 S:$L(X) ORLEAD=$$LOWER^VALM1(X),ORDIALOG(INSTR,"TTL")=ORLEAD_": "
"RTN","ORCDPS",37,0)
 S ORDIALOG(INSTR,"A")=$S($L($G(ORLEAD)):ORLEAD,1:"Amount")_$S($L(ORNOUNS):" (in "_ORNOUNS_")",1:"")_": "
"RTN","ORCDPS",38,0)
 Q
"RTN","ORCDPS",39,0)
 ;
"RTN","ORCDPS",40,0)
CHOICES(TYPE) ; -- Get list of allowable dispense drugs
"RTN","ORCDPS",41,0)
 Q:$D(ORDIALOG(PROMPT,"LIST"))  N OI,PSJOI,I,X,Y,ORX,ORY
"RTN","ORCDPS",42,0)
 S OI=$$VAL^ORCD("MEDICATION"),PSJOI="^^^"_+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORCDPS",43,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORCDPS",44,0)
 I ORX>3 D ENDD^PSJORUTL(PSJOI,TYPE,.ORY,+ORVP) Q:ORY'>0
"RTN","ORCDPS",45,0)
 I ORX'>3 D ENDD^PSJORUTL(PSJOI,TYPE,.ORY) Q:ORY'>0
"RTN","ORCDPS",46,0)
 F I=1:1:ORY S X=$P(ORY(I),U,2),ORY("B",X)=ORY(I) K ORY(I) ; sort
"RTN","ORCDPS",47,0)
 S I=0,ORX="" W !
"RTN","ORCDPS",48,0)
 F  S ORX=$O(ORY("B",ORX)) Q:ORX=""  S X=ORY("B",ORX),I=I+1 D
"RTN","ORCDPS",49,0)
 . S Y=$P(X,U,1,2) I $L($P(X,U,5)),Y'[$P(X,U,5) S Y=Y_" "_$P(X,U,5)
"RTN","ORCDPS",50,0)
 . S:$P(X,U,4) Y=Y_" (non-formulary)"
"RTN","ORCDPS",51,0)
 . S:$P(X,U,3) Y=Y_"  $"_$P(X,U,3)_$S($L($P(X,U,5)):" per "_$P(X,U,5),1:"")
"RTN","ORCDPS",52,0)
 . S ORDIALOG(PROMPT,"LIST",I)=Y,ORDIALOG(PROMPT,"LIST","B",$P(X,U,2))=+X,ORDIALOG(PROMPT,"LIST","D",+X)=I_U_$P(X,U,4)_U_$P(X,U,6)
"RTN","ORCDPS",53,0)
 S ORDIALOG(PROMPT,"LIST")=ORY_"^1" ; total^list only
"RTN","ORCDPS",54,0)
 Q
"RTN","ORCDPS",55,0)
 ;
"RTN","ORCDPS",56,0)
 ; ** End of old code
"RTN","ORCDPS",57,0)
 ;
"RTN","ORCDPS",58,0)
NF(DRUG) ; -- Get alternatives for non-formulary drugs
"RTN","ORCDPS",59,0)
 ;    [Called from P-S Action for Dose]
"RTN","ORCDPS",60,0)
 N TYPE,ORY,I,DD,PSOI,ORPSOI,X,Y,DUOUT,DTOUT
"RTN","ORCDPS",61,0)
 Q:'$G(DRUG)  Q:$G(ORENEW)
"RTN","ORCDPS",62,0)
 S TYPE=$S($G(ORCAT)="I":"U",1:"O")
"RTN","ORCDPS",63,0)
 D ENRFA^PSJORUTL(DRUG,TYPE,.ORY)
"RTN","ORCDPS",64,0)
 S ORPSOI=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS",65,0)
 S (I,DD)=0 I ORY F  S DD=$O(ORY(DD)) Q:DD'>0  D  ;build list of choices
"RTN","ORCDPS",66,0)
 . S PSOI=$P(ORY(DD),U,4,5) Q:PSOI=ORPSOI  Q:$G(ORY("PS",+PSOI))
"RTN","ORCDPS",67,0)
 . S I=I+1,ORY("B",I)=PSOI,ORY("PS",+PSOI)=I
"RTN","ORCDPS",68,0)
 I '$P($G(^ORD(101.43,+$G(OROI),"PS")),U,6) D  ;skip if OI is NF
"RTN","ORCDPS",69,0)
 . W !!,"*** The dispense drug for this dose is not in the formulary! ***"
"RTN","ORCDPS",70,0)
 . W:'ORY!('I) !,"    There are no formulary alternatives entered for this item."
"RTN","ORCDPS",71,0)
 . W !,"    Please consult with your pharmacy before ordering this dose."
"RTN","ORCDPS",72,0)
NF1 Q:'ORY!('I)  D  Q:$G(ORQUIT)  ;Q if no different choices
"RTN","ORCDPS",73,0)
 . N DIR S DIR(0)="NAO^1:"_ORY
"RTN","ORCDPS",74,0)
 . S DIR("A")="Select alternative (or <return> to continue): "
"RTN","ORCDPS",75,0)
 . S I=0 F  S I=$O(ORY("B",I)) Q:I'>0  S DIR("A",I)=$J(I,3)_" "_$P(ORY("B",I),U,2)
"RTN","ORCDPS",76,0)
 . S DIR("?")="The dispense drug for the selected dose is not in the formulary; you may select an alternative orderable item, or press <return> to continue processing this order."
"RTN","ORCDPS",77,0)
 . W !,"    Formulary alternative orderable items:"
"RTN","ORCDPS",78,0)
 . D ^DIR S:$D(DTOUT)!($D(DUOUT)) ORQUIT=1
"RTN","ORCDPS",79,0)
 I Y D  ; reset OI, doses
"RTN","ORCDPS",80,0)
 . S PSOI=+ORY("B",Y),X=+$O(^ORD(101.43,"ID",PSOI_";99PSP",0))
"RTN","ORCDPS",81,0)
 . Q:'X  Q:X=OROI  ;error or same OI
"RTN","ORCDPS",82,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)=X
"RTN","ORCDPS",83,0)
 . D CHANGED^ORCDPS1("OI"),OI2^ORCDPS1,D1^ORCDPS2 ;get new doses
"RTN","ORCDPS",84,0)
 . D:$G(ORDIALOG(PROMPT,"LIST")) LIST^ORCD K DONE,ORESET
"RTN","ORCDPS",85,0)
 . S DIR("A")=ORDIALOG(PROMPT,"A"),(ORI,INST)=1 ;reset if complex
"RTN","ORCDPS",86,0)
 Q
"RTN","ORCDPS",87,0)
 ;
"RTN","ORCDPS",88,0)
DISPDRUG() ; -- Get Dispense Drug from dose selection(s) [from EXDOSE^ORCDPS2]
"RTN","ORCDPS",89,0)
 ;       Expects PROMPT, ORDIALOG(), ORDOSE()
"RTN","ORCDPS",90,0)
 ;
"RTN","ORCDPS",91,0)
 N DD,FORM,I,DOSE,X,ORID,OK,STR,ORX,HALFOK
"RTN","ORCDPS",92,0)
 I $E($G(XQY0),1,17)'="ORCM QUICK ORDERS" S DD=$G(ORDIALOG($$PTR("DISPENSE DRUG"),1)) I DD Q DD ;already have - DJE/VM *440 recalc for quick orders
"RTN","ORCDPS",93,0)
 S DD="",FORM="1.N.""."".N."" ""1"""_$P($G(ORDOSE(1)),U,2)_""""
"RTN","ORCDPS",94,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D  Q:DD="^"
"RTN","ORCDPS",95,0)
 . S DOSE=$G(ORDIALOG(PROMPT,I)),X=""
"RTN","ORCDPS",96,0)
 . S:$L(DOSE) X=$G(ORDIALOG(PROMPT,"LIST","D",DOSE))
"RTN","ORCDPS",97,0)
 . I X="" S DD=$S($G(ORCAT)="I":"^",'$G(ORDOSE(1)):"^",DOSE'?@FORM:"^",1:0) Q
"RTN","ORCDPS",98,0)
 . S:DD="" DD=X I X'=DD S DD=$S($G(ORCAT)="I":"^",1:0) Q
"RTN","ORCDPS",99,0)
 Q:DD DD Q:DD="^" "" ;all same, or not possible
"RTN","ORCDPS",100,0)
 S ORID=$$PTR("DOSE"),DD=0 F  S DD=$O(ORDOSE("DD",DD)) Q:DD'>0  D
"RTN","ORCDPS",101,0)
 . S OK=1,STR=+$P($G(ORDOSE("DD",DD)),U,5),HALFOK=+$P($G(ORDOSE("DD",DD)),U,11)
"RTN","ORCDPS",102,0)
 . S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D  Q:'OK
"RTN","ORCDPS",103,0)
 .. S DOSE=$G(ORDIALOG(PROMPT,I))
"RTN","ORCDPS",104,0)
 .. I '$G(ORDOSE(1)) D  Q  ;local doses
"RTN","ORCDPS",105,0)
 ... S X=$G(ORDOSE("DD",DD,DOSE)) I X="" S OK=0 K ORX(DD) Q
"RTN","ORCDPS",106,0)
 ... S ORX(DD,I)=DOSE,ORX(DD)=""
"RTN","ORCDPS",107,0)
 .. S X=+$G(ORDIALOG(ORID,I)) S:X'>0 X=+DOSE S X=X/STR
"RTN","ORCDPS",108,0)
 .. I (X?1.N)!(HALFOK&(X?.N.1".5")) S ORX(DD,I)=X S:X>$G(ORX(DD)) ORX(DD)=X Q
"RTN","ORCDPS",109,0)
 .. K ORX(DD) S OK=0
"RTN","ORCDPS",110,0)
 I '$G(ORDOSE(1)) S DD=$O(ORX(0)) Q DD ;first one
"RTN","ORCDPS",111,0)
 S DD="",X=99999,I=0 F  S I=$O(ORX(I)) Q:I'>0  I ORX(I)<X S X=ORX(I),DD=I
"RTN","ORCDPS",112,0)
 Q DD
"RTN","ORCDPS",113,0)
 ;
"RTN","ORCDPS",114,0)
ID() ; -- Return ID string for dose instance INST
"RTN","ORCDPS",115,0)
 N INSTR,DD,DOSE,ID
"RTN","ORCDPS",116,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$G(ORDIALOG(INSTR,INST)),(DD,ID)=""
"RTN","ORCDPS",117,0)
 S:$L(DOSE) DD=+$G(ORDIALOG(INSTR,"LIST","D",DOSE))
"RTN","ORCDPS",118,0)
 S:DD ID=$TR($G(ORDOSE("DD",DD,DOSE)),"^","&")
"RTN","ORCDPS",119,0)
 Q ID
"RTN","ORCDPS",120,0)
 ;
"RTN","ORCDPS",121,0)
RESETID ; -- Reset ORDIALOG(DOSE) nodes for new ORDRUG
"RTN","ORCDPS",122,0)
 ;    From EXDOSE^ORCDPS2: Expects PROMPT, DRUG
"RTN","ORCDPS",123,0)
 ;
"RTN","ORCDPS",124,0)
 Q:$G(ORCAT)'="O"  N I,ORID,STR,UNT,DOSE,X,FORM
"RTN","ORCDPS",125,0)
 S ORID=$$PTR("DOSE"),STR=+$P(DRUG,U,5),UNT=$P(DRUG,U,6)
"RTN","ORCDPS",126,0)
 S FORM="1.N.""."".N."" ""1"""_UNT_""""
"RTN","ORCDPS",127,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D
"RTN","ORCDPS",128,0)
 . S DOSE=$G(ORDIALOG(PROMPT,I)),X=$G(ORDOSE("DD",+ORDRUG,DOSE))
"RTN","ORCDPS",129,0)
 . I '$L(X),STR,DOSE?@FORM D
"RTN","ORCDPS",130,0)
 .. N UD,NOUN S UD=+DOSE/STR,NOUN=$P($G(ORDOSE(1)),U,4)
"RTN","ORCDPS",131,0)
 .. I UD>1,$E(NOUN,$L(NOUN))'="S" S NOUN=NOUN_"S"
"RTN","ORCDPS",132,0)
 .. S X=+DOSE_"&"_UNT_"&"_UD_"&"_NOUN_"&"_DOSE_"&"_+ORDRUG_"&"_STR_"&"_UNT
"RTN","ORCDPS",133,0)
 . S:$L(X) ORDIALOG(ORID,I)=$TR(X,"^","&") Q
"RTN","ORCDPS",134,0)
 Q
"RTN","ORCDPS",135,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPS",136,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"VER")
8.0^22.0
"BLD",10351,6)
^376
**END**
**END**

