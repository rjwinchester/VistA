Released OR*3*417 SEQ #371
Extracted from mail message
**KIDS**:OR*3.0*417^

**INSTALL NAME**
OR*3.0*417
"BLD",9251,0)
OR*3.0*417^ORDER ENTRY/RESULTS REPORTING^0^3160519^y
"BLD",9251,1,0)
^^34^34^3160519^
"BLD",9251,1,1,0)
OR*3.0*417 makes changes to order details in support of Bar Code
"BLD",9251,1,2,0)
Medications Administration (BCMA) and Inpatient Medications enhancements
"BLD",9251,1,3,0)
for Transdermal Administrations.
"BLD",9251,1,4,0)
 
"BLD",9251,1,5,0)
******************************* ATTENTION ********************************
"BLD",9251,1,6,0)
  
"BLD",9251,1,7,0)
Clinical Ancillary Services (CAS) Development-Delivery of Pharmacy 
"BLD",9251,1,8,0)
Enhancements (DDPE) VA Inpatient Medication Administration - Transdermal
"BLD",9251,1,9,0)
enhancement includes 5 patches which must be installed in the following
"BLD",9251,1,10,0)
order:
"BLD",9251,1,11,0)
 
"BLD",9251,1,12,0)
1.      PSS*1*191
"BLD",9251,1,13,0)
2.      PSJ*5*315
"BLD",9251,1,14,0)
3.      PSB*3*83
"BLD",9251,1,15,0)
4.      PSB*3*87
"BLD",9251,1,16,0)
5.      OR*3*417
"BLD",9251,1,17,0)
 
"BLD",9251,1,18,0)
ATTENTION: This enhancement also includes a new Graphical User Interface
"BLD",9251,1,19,0)
(GUI) executable, BCMA GUI PSB3_P083.EXE. Installation of this GUI is
"BLD",9251,1,20,0)
required immediately after the KIDS install for the Patch to function.
"BLD",9251,1,21,0)
 
"BLD",9251,1,22,0)
For retrieval and installation instructions, please see the Client 
"BLD",9251,1,23,0)
Installation Instructions section.
"BLD",9251,1,24,0)
 
"BLD",9251,1,25,0)
**************************************************************************
"BLD",9251,1,26,0)
 
"BLD",9251,1,27,0)
The change made by OR*3*417 is in support of requirements for patch
"BLD",9251,1,28,0)
PSB*3.0*83.  All the patches in this group should be installed  prior to 
"BLD",9251,1,29,0)
patch OR*3.0*417.
"BLD",9251,1,30,0)
 
"BLD",9251,1,31,0)
The change will add a line to the Order Details report and the Medication
"BLD",9251,1,32,0)
Administration History Report in the Computerized Patient Record System
"BLD",9251,1,33,0)
(CPRS). These reports will display the Removal times for Medications
"BLD",9251,1,34,0)
that Require Removal (MRRs).
"BLD",9251,4,0)
^9.64PA^^
"BLD",9251,6.3)
10
"BLD",9251,"ABPKG")
n
"BLD",9251,"KRN",0)
^9.67PA^9002226^21
"BLD",9251,"KRN",.4,0)
.4
"BLD",9251,"KRN",.401,0)
.401
"BLD",9251,"KRN",.402,0)
.402
"BLD",9251,"KRN",.403,0)
.403
"BLD",9251,"KRN",.5,0)
.5
"BLD",9251,"KRN",.84,0)
.84
"BLD",9251,"KRN",3.6,0)
3.6
"BLD",9251,"KRN",3.8,0)
3.8
"BLD",9251,"KRN",9.2,0)
9.2
"BLD",9251,"KRN",9.8,0)
9.8
"BLD",9251,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9251,"KRN",9.8,"NM",1,0)
ORQ21^^0^B37800373
"BLD",9251,"KRN",9.8,"NM","B","ORQ21",1)
 
"BLD",9251,"KRN",19,0)
19
"BLD",9251,"KRN",19.1,0)
19.1
"BLD",9251,"KRN",101,0)
101
"BLD",9251,"KRN",409.61,0)
409.61
"BLD",9251,"KRN",771,0)
771
"BLD",9251,"KRN",779.2,0)
779.2
"BLD",9251,"KRN",870,0)
870
"BLD",9251,"KRN",8989.51,0)
8989.51
"BLD",9251,"KRN",8989.52,0)
8989.52
"BLD",9251,"KRN",8994,0)
8994
"BLD",9251,"KRN",9002226,0)
9002226
"BLD",9251,"KRN","B",.4,.4)
 
"BLD",9251,"KRN","B",.401,.401)
 
"BLD",9251,"KRN","B",.402,.402)
 
"BLD",9251,"KRN","B",.403,.403)
 
"BLD",9251,"KRN","B",.5,.5)
 
"BLD",9251,"KRN","B",.84,.84)
 
"BLD",9251,"KRN","B",3.6,3.6)
 
"BLD",9251,"KRN","B",3.8,3.8)
 
"BLD",9251,"KRN","B",9.2,9.2)
 
"BLD",9251,"KRN","B",9.8,9.8)
 
"BLD",9251,"KRN","B",19,19)
 
"BLD",9251,"KRN","B",19.1,19.1)
 
"BLD",9251,"KRN","B",101,101)
 
"BLD",9251,"KRN","B",409.61,409.61)
 
"BLD",9251,"KRN","B",771,771)
 
"BLD",9251,"KRN","B",779.2,779.2)
 
"BLD",9251,"KRN","B",870,870)
 
"BLD",9251,"KRN","B",8989.51,8989.51)
 
"BLD",9251,"KRN","B",8989.52,8989.52)
 
"BLD",9251,"KRN","B",8994,8994)
 
"BLD",9251,"KRN","B",9002226,9002226)
 
"BLD",9251,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9251,"QUES",0)
^9.62^^
"BLD",9251,"REQB",0)
^9.611^4^4
"BLD",9251,"REQB",1,0)
OR*3.0*361^2
"BLD",9251,"REQB",2,0)
PSJ*5.0*315^2
"BLD",9251,"REQB",3,0)
PSB*3.0*83^2
"BLD",9251,"REQB",4,0)
OR*3.0*350^2
"BLD",9251,"REQB","B","OR*3.0*350",4)
 
"BLD",9251,"REQB","B","OR*3.0*361",1)
 
"BLD",9251,"REQB","B","PSB*3.0*83",3)
 
"BLD",9251,"REQB","B","PSJ*5.0*315",2)
 
"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
417^3160519
"PKG",170,22,1,"PAH",1,1,0)
^^34^34^3160519
"PKG",170,22,1,"PAH",1,1,1,0)
OR*3.0*417 makes changes to order details in support of Bar Code
"PKG",170,22,1,"PAH",1,1,2,0)
Medications Administration (BCMA) and Inpatient Medications enhancements
"PKG",170,22,1,"PAH",1,1,3,0)
for Transdermal Administrations.
"PKG",170,22,1,"PAH",1,1,4,0)
 
"PKG",170,22,1,"PAH",1,1,5,0)
******************************* ATTENTION ********************************
"PKG",170,22,1,"PAH",1,1,6,0)
  
"PKG",170,22,1,"PAH",1,1,7,0)
Clinical Ancillary Services (CAS) Development-Delivery of Pharmacy 
"PKG",170,22,1,"PAH",1,1,8,0)
Enhancements (DDPE) VA Inpatient Medication Administration - Transdermal
"PKG",170,22,1,"PAH",1,1,9,0)
enhancement includes 5 patches which must be installed in the following
"PKG",170,22,1,"PAH",1,1,10,0)
order:
"PKG",170,22,1,"PAH",1,1,11,0)
 
"PKG",170,22,1,"PAH",1,1,12,0)
1.      PSS*1*191
"PKG",170,22,1,"PAH",1,1,13,0)
2.      PSJ*5*315
"PKG",170,22,1,"PAH",1,1,14,0)
3.      PSB*3*83
"PKG",170,22,1,"PAH",1,1,15,0)
4.      PSB*3*87
"PKG",170,22,1,"PAH",1,1,16,0)
5.      OR*3*417
"PKG",170,22,1,"PAH",1,1,17,0)
 
"PKG",170,22,1,"PAH",1,1,18,0)
ATTENTION: This enhancement also includes a new Graphical User Interface
"PKG",170,22,1,"PAH",1,1,19,0)
(GUI) executable, BCMA GUI PSB3_P083.EXE. Installation of this GUI is
"PKG",170,22,1,"PAH",1,1,20,0)
required immediately after the KIDS install for the Patch to function.
"PKG",170,22,1,"PAH",1,1,21,0)
 
"PKG",170,22,1,"PAH",1,1,22,0)
For retrieval and installation instructions, please see the Client 
"PKG",170,22,1,"PAH",1,1,23,0)
Installation Instructions section.
"PKG",170,22,1,"PAH",1,1,24,0)
 
"PKG",170,22,1,"PAH",1,1,25,0)
**************************************************************************
"PKG",170,22,1,"PAH",1,1,26,0)
 
"PKG",170,22,1,"PAH",1,1,27,0)
The change made by OR*3*417 is in support of requirements for patch
"PKG",170,22,1,"PAH",1,1,28,0)
PSB*3.0*83.  All the patches in this group should be installed  prior to 
"PKG",170,22,1,"PAH",1,1,29,0)
patch OR*3.0*417.
"PKG",170,22,1,"PAH",1,1,30,0)
 
"PKG",170,22,1,"PAH",1,1,31,0)
The change will add a line to the Order Details report and the Medication
"PKG",170,22,1,"PAH",1,1,32,0)
Administration History Report in the Computerized Patient Record System
"PKG",170,22,1,"PAH",1,1,33,0)
(CPRS). These reports will display the Removal times for Medications
"PKG",170,22,1,"PAH",1,1,34,0)
that Require Removal (MRRs).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORQ21")
0^1^B37800373^B35534512
"RTN","ORQ21",1,0)
ORQ21 ;SLC/MKB,GSS - DETAILED ORDER REPORT CONTINUED ;01/24/2014  11:39
"RTN","ORQ21",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,190,195,215,243,361,350,417**;Dec 17, 1997;Build 10
"RTN","ORQ21",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORQ21",4,0)
 ;
"RTN","ORQ21",5,0)
 ; DBIA 2400   OEL^PSOORRL   ^TMP("PS",$J)
"RTN","ORQ21",6,0)
 ; DBIA 2266   EN30^RAO7PC1  ^TMP($J,"RAE2")
"RTN","ORQ21",7,0)
 ;
"RTN","ORQ21",8,0)
RAD(TCOM) ; -- add RA data for 2.5 orders
"RTN","ORQ21",9,0)
 N RAIFN,CASE,PROC,ORD,ORI,X,ORTTL,ORB
"RTN","ORQ21",10,0)
 S RAIFN=$G(^OR(100,ORIFN,4)) Q:RAIFN'>0
"RTN","ORQ21",11,0)
 D EN30^RAO7PC1(RAIFN) Q:'$D(^TMP($J,"RAE2",+ORVP))  ;DBIA 2266
"RTN","ORQ21",12,0)
 S ORD=$G(^TMP($J,"RAE2",+ORVP,"ORD")),CASE=$O(^(0)) Q:'CASE  S PROC=$O(^(CASE,""))
"RTN","ORQ21",13,0)
 I '$G(TCOM) D  ;else add only Tech Comments
"RTN","ORQ21",14,0)
 . S CNT=CNT+1,@ORY@(CNT)=$$LJ^XLFSTR("Procedure:",30)_$S($L(ORD):ORD,1:PROC)
"RTN","ORQ21",15,0)
 . S ORI=0,ORTTL="Procedure Modifiers:          ",ORB=1
"RTN","ORQ21",16,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)=ORTTL_^(ORI),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="History and Reason for Exam:"
"RTN","ORQ21",18,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"H",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(ORI)
"RTN","ORQ21",19,0)
RAD1 I $L($G(^TMP($J,"RAE2",+ORVP,CASE,PROC,"TCOM",1))) S X=^(1) D
"RTN","ORQ21",20,0)
 . N DIWL,DIWR,DIWF,I K ^UTILITY($J,"W")
"RTN","ORQ21",21,0)
 . S DIWL=1,DIWR=72,DIWF="C72" D ^DIWP
"RTN","ORQ21",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="Technologist's Comment:",ORB=1
"RTN","ORQ21",23,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(I,0)
"RTN","ORQ21",24,0)
 I $D(^TMP($J,"RAE2",+ORVP,CASE,PROC,"CM")) D
"RTN","ORQ21",25,0)
 . S ORTTL="Contrast Media used:          ",ORI=0,ORB=1
"RTN","ORQ21",26,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"CM",ORI)) Q:ORI<1  S CNT=CNT+1,@ORY@(CNT)=ORTTL_$P(^(ORI),U,2),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",27,0)
 K ^TMP($J,"RAE2",+ORVP),^UTILITY($J,"W")
"RTN","ORQ21",28,0)
 S:$G(ORB) CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",29,0)
 Q
"RTN","ORQ21",30,0)
 ;
"RTN","ORQ21",31,0)
MED ; -- Add Pharmacy order data
"RTN","ORQ21",32,0)
 Q:$G(^OR(100,ORIFN,4))["N"  ;non-VA med -- no refill history
"RTN","ORQ21",33,0)
 N TYPE,NODE,RXN,OR5,STAT S TYPE=$P(OR0,U,12)
"RTN","ORQ21",34,0)
 I '$D(^TMP("PS",$J,0)) D  ;get PS data / DBIA 2400
"RTN","ORQ21",35,0)
 . N PSIFN S PSIFN=$G(^OR(100,ORIFN,4))
"RTN","ORQ21",36,0)
 . S:TYPE="O" PSIFN=$TR(PSIFN,"S","P")_$S(PSIFN?1.N:"R",1:"")
"RTN","ORQ21",37,0)
 . D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)  ;DBIA 2400
"RTN","ORQ21",38,0)
 S NODE=$G(^TMP("PS",$J,0)),RXN=$G(^("RXN",0)),STAT=$P(NODE,U,6)
"RTN","ORQ21",39,0)
 I '$L(NODE) K ^TMP("PS",$J) Q  ;error
"RTN","ORQ21",40,0)
 I $O(^TMP("PS",$J,"DD",0)) D  ;Disp Drugs
"RTN","ORQ21",41,0)
 . N I,X,Y S X="Dispense Drugs (units/dose):  ",I=0
"RTN","ORQ21",42,0)
 . F  S I=$O(^TMP("PS",$J,"DD",I)) Q:I'>0  S Y=$G(^(I,0)) S:Y CNT=CNT+1,@ORY@(CNT)=X_$$GET1^DIQ(50,+Y_",",.01)_" ("_$P(Y,U,2)_")"
"RTN","ORQ21",43,0)
 S:$P(NODE,U,9) CNT=CNT+1,@ORY@(CNT)="Total Dose:                   "_$P(NODE,U,9)
"RTN","ORQ21",44,0)
M1 I TYPE="I" D  ;admin data
"RTN","ORQ21",45,0)
 . N I,X,Y I $O(^TMP("PS",$J,"B",0)) D
"RTN","ORQ21",46,0)
 .. S X="IV Print Name:                ",I=0
"RTN","ORQ21",47,0)
 .. F  S I=$O(^TMP("PS",$J,"B",I)) Q:I<1  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_$P(Y,U),X=$$REPEAT^XLFSTR(" ",30) I $L($P(Y,U,3)) S CNT=CNT+1,@ORY@(CNT)=X_" "_$P(Y,U,3)
"RTN","ORQ21",48,0)
 . S I=+$O(^TMP("PS",$J,"SCH",0)),X=$G(^(I,0))
"RTN","ORQ21",49,0)
 . S X=$S($L(X,U)=1:X,1:$P(X,U,2))
"RTN","ORQ21",50,0)
 . S:$L(X) CNT=CNT+1,@ORY@(CNT)="Schedule Type:                "_X
"RTN","ORQ21",51,0)
 . S X="Administration Times:         ",I=0
"RTN","ORQ21",52,0)
 . F  S I=$O(^TMP("PS",$J,"ADM",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",53,0)
 . S X="Removal Times:                ",I=0 ;OR*3.0*417
"RTN","ORQ21",54,0)
 . F  S I=$O(^TMP("PS",$J,"RMV",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",55,0)
 .Q
"RTN","ORQ21",56,0)
M2 I TYPE="O" D  ;fill history
"RTN","ORQ21",57,0)
 . N FILLD,RET,X,Y,I
"RTN","ORQ21",58,0)
 . S:$P(NODE,U,12) CNT=CNT+1,@ORY@(CNT)="Last Filled:                  "_$$FMTE^XLFDT($P(NODE,U,12),2)
"RTN","ORQ21",59,0)
 . S CNT=CNT+1,@ORY@(CNT)="Refills Remaining:            "_$P(NODE,U,4)
"RTN","ORQ21",60,0)
 . I $P(RXN,U,6)!$G(^TMP("PS",$J,"REF",0)) S X="Filled:                       " D
"RTN","ORQ21",61,0)
 .. I $P(RXN,U,6) S FILLD=$P(RXN,U,6)_"^^^"_$P(RXN,U,7)_U_$P(RXN,U,3,4) D FILLED("R")
"RTN","ORQ21",62,0)
 .. S RET=$G(^TMP("PS",$J,"RXN","RSTC")) I RET'="" D RETURNS(RET)
"RTN","ORQ21",63,0)
 .. S I=0 F  S I=$O(^TMP("PS",$J,"REF",I)) Q:I'>0  D
"RTN","ORQ21",64,0)
 ... S FILLD=$G(^(I,0)) D FILLED("R")
"RTN","ORQ21",65,0)
 ... S RET=$G(^TMP("PS",$J,"REF",I,"RSTC")) I RET'="" D RETURNS(RET)
"RTN","ORQ21",66,0)
 . I $G(^TMP("PS",$J,"PAR",0)) S I=0,X="Partial Fills:      " F  S I=$O(^TMP("PS",$J,"PAR",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("P")
"RTN","ORQ21",67,0)
 . S:RXN CNT=CNT+1,@ORY@(CNT)="Prescription#:                "_$P(RXN,U)
"RTN","ORQ21",68,0)
M3 S:$P(RXN,U,5) CNT=CNT+1,@ORY@(CNT)="Pharmacist:                   "_$P($G(^VA(200,+$P(RXN,U,5),0)),U)
"RTN","ORQ21",69,0)
    I $G(STAT)="ACTIVE/SUSP" S CNT=CNT+1,@ORY@(CNT)="Prescription Status:          "_STAT_" - Order is active. Fill or Refill has been requested."
"RTN","ORQ21",70,0)
 S:$P(NODE,U,13) CNT=CNT+1,@ORY@(CNT)="NOT TO BE GIVEN" K ^TMP("PS",$J)
"RTN","ORQ21",71,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",72,0)
 S OR5=$G(^OR(100,ORIFN,5)) I $L(OR5) D  ;SC data
"RTN","ORQ21",73,0)
 . N X,Y,I
"RTN","ORQ21",74,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",75,0)
 . S CNT=CNT+1,@ORY@(CNT)="First Party Pay Exemptions"
"RTN","ORQ21",76,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",77,0)
 . F I=1:1:8 S Y=$P(OR5,U,I) I Y S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",78,0)
 Q
"RTN","ORQ21",79,0)
 ;
"RTN","ORQ21",80,0)
BA ;Billing Aware data display
"RTN","ORQ21",81,0)
 N DXIEN,DXV,ICD9,ICDR,OCT,ORFMDAT
"RTN","ORQ21",82,0)
 S OCT=0,X=""
"RTN","ORQ21",83,0)
 ; Get the date of the order for CSV/CTD usage
"RTN","ORQ21",84,0)
 S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIFN)
"RTN","ORQ21",85,0)
 ; $O through diagnoses for an order
"RTN","ORQ21",86,0)
 F  S OCT=$O(^OR(100,ORIFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORQ21",87,0)
 . ; DXIEN=Dx IEN
"RTN","ORQ21",88,0)
 . S DXIEN=+^OR(100,ORIFN,5.1,OCT,0)
"RTN","ORQ21",89,0)
 . ; Get Dx record for date ORFMDAT
"RTN","ORQ21",90,0)
 . S ICDR=$$ICDDATA^ICDXCODE("DIAGNOSIS",DXIEN,ORFMDAT)
"RTN","ORQ21",91,0)
 . ; Get Dx verbiage and ICD code
"RTN","ORQ21",92,0)
 . S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORQ21",93,0)
 . S X="               "
"RTN","ORQ21",94,0)
 . I OCT=1 D
"RTN","ORQ21",95,0)
 .. S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",96,0)
 .. S CNT=CNT+1,@ORY@(CNT)="Clinical Indicators"
"RTN","ORQ21",97,0)
 .. S X="Diagnosis of:  "
"RTN","ORQ21",98,0)
 . S X=X_ICD9_" - "_DXV,CNT=CNT+1,@ORY@(CNT)=X
"RTN","ORQ21",99,0)
 I OCT'="" D  ;if there are diagnoses show Treatment Factors
"RTN","ORQ21",100,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",101,0)
 . F I=1:1:8 S Y=$P(^OR(100,ORIFN,5.2),U,I) I Y D
"RTN","ORQ21",102,0)
 .. S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",103,0)
 Q
"RTN","ORQ21",104,0)
 ;
"RTN","ORQ21",105,0)
FILLED(TYPE) ; -- add FILLD data
"RTN","ORQ21",106,0)
 N Y S Y=$$FMTE^XLFDT($P(FILLD,U),2)_" ("_$$ROUTING($P(FILLD,U,5))_")"
"RTN","ORQ21",107,0)
 S:TYPE="R"&$P(FILLD,U,4) Y=Y_" released "_$$FMTE^XLFDT($P(FILLD,U,4),2)
"RTN","ORQ21",108,0)
 S:TYPE="P"&$P(FILLD,U,3) Y=Y_" Qty: "_$P(FILLD,U,3)
"RTN","ORQ21",109,0)
 S CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",110,0)
 S:$L($P(FILLD,U,6)) CNT=CNT+1,@ORY@(CNT)=X_$P(FILLD,U,6)
"RTN","ORQ21",111,0)
 Q
"RTN","ORQ21",112,0)
RETURNS(NODE) ; add Return to Stock Data
"RTN","ORQ21",113,0)
 N DATE,NAME,TEXT,X
"RTN","ORQ21",114,0)
 S DATE=$$FMTE^XLFDT($P(NODE,U))
"RTN","ORQ21",115,0)
 S NAME=$P(^VA(200,$P(NODE,U,2),0),U)
"RTN","ORQ21",116,0)
 S X=$$REPEAT^XLFSTR(" ",13)
"RTN","ORQ21",117,0)
 S TEXT="Return to Stock: "_X_DATE_" by "_NAME
"RTN","ORQ21",118,0)
 S CNT=CNT+1,@ORY@(CNT)=TEXT
"RTN","ORQ21",119,0)
 S X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",120,0)
 S TEXT=X_"Comments: "_$P(NODE,U,3)
"RTN","ORQ21",121,0)
 S CNT=CNT+1,@ORY@(CNT)=TEXT
"RTN","ORQ21",122,0)
 Q
"RTN","ORQ21",123,0)
 ;
"RTN","ORQ21",124,0)
ROUTING(X) ; -- Returns external form
"RTN","ORQ21",125,0)
 N Y S Y=$S($G(X)="M":"Mail",$G(X)="W":"Window",1:$G(X))
"RTN","ORQ21",126,0)
 Q Y
"RTN","ORQ21",127,0)
 ;
"RTN","ORQ21",128,0)
SC(J) ; -- Returns name of SC field by piece number
"RTN","ORQ21",129,0)
 I '$G(J) Q ""
"RTN","ORQ21",130,0)
 I J=1 Q "SERVICE CONNECTED CONDITION"
"RTN","ORQ21",131,0)
 I J=2 Q "MILITARY SEXUAL TRAUMA"
"RTN","ORQ21",132,0)
 I J=3 Q "AGENT ORANGE EXPOSURE"
"RTN","ORQ21",133,0)
 I J=4 Q "IONIZING RADIATION EXPOSURE"
"RTN","ORQ21",134,0)
 I J=5 Q "ENVIRONMENTAL CONTAMINANTS"
"RTN","ORQ21",135,0)
 I J=6 Q "HEAD OR NECK CANCER"
"RTN","ORQ21",136,0)
 I J=7 Q "COMBAT VETERAN"
"RTN","ORQ21",137,0)
 I J=8 Q "SHIPBOARD HAZARD AND DEFENSE"
"RTN","ORQ21",138,0)
 Q ""
"VER")
8.0^22.0
"BLD",9251,6)
^371
**END**
**END**

