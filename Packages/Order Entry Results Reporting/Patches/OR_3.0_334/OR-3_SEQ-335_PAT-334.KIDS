Released OR*3*334 SEQ #335
Extracted from mail message
**KIDS**:OR*3.0*334^

**INSTALL NAME**
OR*3.0*334
"BLD",9122,0)
OR*3.0*334^ORDER ENTRY/RESULTS REPORTING^0^3140128^y
"BLD",9122,1,0)
^^6^6^3120828^
"BLD",9122,1,1,0)
This patch corrects 1 issue within the ORDER ENTRY/RESULTS REPORTING 
"BLD",9122,1,2,0)
package:
"BLD",9122,1,3,0)
 
"BLD",9122,1,4,0)
1. The Auto-unflagging of orders with the ORPF AUTO UNFLAG parameter set
"BLD",9122,1,5,0)
   to YES has resulted in pharmacy queries or reccomendations not being
"BLD",9122,1,6,0)
   read or responded to.
"BLD",9122,4,0)
^9.64PA^^
"BLD",9122,6.3)
5
"BLD",9122,"INI")
ORY334
"BLD",9122,"INID")
^^y
"BLD",9122,"KRN",0)
^9.67PA^779.2^20
"BLD",9122,"KRN",.4,0)
.4
"BLD",9122,"KRN",.401,0)
.401
"BLD",9122,"KRN",.402,0)
.402
"BLD",9122,"KRN",.403,0)
.403
"BLD",9122,"KRN",.5,0)
.5
"BLD",9122,"KRN",.84,0)
.84
"BLD",9122,"KRN",3.6,0)
3.6
"BLD",9122,"KRN",3.8,0)
3.8
"BLD",9122,"KRN",9.2,0)
9.2
"BLD",9122,"KRN",9.8,0)
9.8
"BLD",9122,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9122,"KRN",9.8,"NM",1,0)
ORWORB^^0^B73567288
"BLD",9122,"KRN",9.8,"NM",2,0)
ORCB^^0^B49591069
"BLD",9122,"KRN",9.8,"NM","B","ORCB",2)

"BLD",9122,"KRN",9.8,"NM","B","ORWORB",1)

"BLD",9122,"KRN",19,0)
19
"BLD",9122,"KRN",19.1,0)
19.1
"BLD",9122,"KRN",101,0)
101
"BLD",9122,"KRN",409.61,0)
409.61
"BLD",9122,"KRN",771,0)
771
"BLD",9122,"KRN",779.2,0)
779.2
"BLD",9122,"KRN",870,0)
870
"BLD",9122,"KRN",8989.51,0)
8989.51
"BLD",9122,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9122,"KRN",8989.51,"NM",1,0)
ORPF AUTO UNFLAG^^0
"BLD",9122,"KRN",8989.51,"NM","B","ORPF AUTO UNFLAG",1)

"BLD",9122,"KRN",8989.52,0)
8989.52
"BLD",9122,"KRN",8994,0)
8994
"BLD",9122,"KRN","B",.4,.4)

"BLD",9122,"KRN","B",.401,.401)

"BLD",9122,"KRN","B",.402,.402)

"BLD",9122,"KRN","B",.403,.403)

"BLD",9122,"KRN","B",.5,.5)

"BLD",9122,"KRN","B",.84,.84)

"BLD",9122,"KRN","B",3.6,3.6)

"BLD",9122,"KRN","B",3.8,3.8)

"BLD",9122,"KRN","B",9.2,9.2)

"BLD",9122,"KRN","B",9.8,9.8)

"BLD",9122,"KRN","B",19,19)

"BLD",9122,"KRN","B",19.1,19.1)

"BLD",9122,"KRN","B",101,101)

"BLD",9122,"KRN","B",409.61,409.61)

"BLD",9122,"KRN","B",771,771)

"BLD",9122,"KRN","B",779.2,779.2)

"BLD",9122,"KRN","B",870,870)

"BLD",9122,"KRN","B",8989.51,8989.51)

"BLD",9122,"KRN","B",8989.52,8989.52)

"BLD",9122,"KRN","B",8994,8994)

"BLD",9122,"QUES",0)
^9.62^^
"BLD",9122,"REQB",0)
^9.611^1^1
"BLD",9122,"REQB",1,0)
OR*3.0*329^1
"BLD",9122,"REQB","B","OR*3.0*329",1)

"INI")
ORY334
"KRN",8989.51,371,-1)
0^1
"KRN",8989.51,371,0)
ORPF AUTO UNFLAG^Auto Unflag^^^AUTO UNFLAG^1
"KRN",8989.51,371,1)
Y^^**Disabled per PSPO #2176**
"KRN",8989.51,371,20,0)
^^4^4^3120801^
"KRN",8989.51,371,20,1,0)
**Disabled per PSPO #2176**
"KRN",8989.51,371,20,2,0)
This parameter, when set to YES, will automatically cancel
"KRN",8989.51,371,20,3,0)
the Flag Orders Notification and unflag all orders for a
"KRN",8989.51,371,20,4,0)
patient when a user process a Flagged Orders Notification.
"KRN",8989.51,371,30,0)
^8989.513I^1^1
"KRN",8989.51,371,30,1,0)
1^4.2
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
334^3140128
"PKG",174,22,1,"PAH",1,1,0)
^^6^6^3140128
"PKG",174,22,1,"PAH",1,1,1,0)
This patch corrects 1 issue within the ORDER ENTRY/RESULTS REPORTING 
"PKG",174,22,1,"PAH",1,1,2,0)
package:
"PKG",174,22,1,"PAH",1,1,3,0)
 
"PKG",174,22,1,"PAH",1,1,4,0)
1. The Auto-unflagging of orders with the ORPF AUTO UNFLAG parameter set
"PKG",174,22,1,"PAH",1,1,5,0)
   to YES has resulted in pharmacy queries or reccomendations not being
"PKG",174,22,1,"PAH",1,1,6,0)
   read or responded to.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORCB")
0^2^B49591069^B51269339
"RTN","ORCB",1,0)
ORCB ;SLC/MKB-Notifications followup for LMgr chart ;4/5/01  21:32
"RTN","ORCB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,36,48,70,108,116,243,334**;Dec 17, 1997;Build 5
"RTN","ORCB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORCB",4,0)
 ;DBIA reference section
"RTN","ORCB",5,0)
 ;10035 - ^DPT
"RTN","ORCB",6,0)
 ;2437  - ^DGPM
"RTN","ORCB",7,0)
 ;10009 - DICN
"RTN","ORCB",8,0)
 ;10026 - DIR
"RTN","ORCB",9,0)
 ;10118 - VALM
"RTN","ORCB",10,0)
 ;10116 - VALM1
"RTN","ORCB",11,0)
 ;10103 - XLFDT
"RTN","ORCB",12,0)
 ;10104 - XLFSTR
"RTN","ORCB",13,0)
 ;10140 - XQORM
"RTN","ORCB",14,0)
EN(DFN,ORFLG,DGRP,DEL) ; -- main entry point
"RTN","ORCB",15,0)
 Q:'$G(DFN)  Q:'$G(ORFLG)
"RTN","ORCB",16,0)
 N BEG,END D SLCT1^ORQPT
"RTN","ORCB",17,0)
 S DGRP=$P($G(^ORD(100.98,+$G(DGRP),0)),U,3) S:'$L(DGRP) DGRP="ALL"
"RTN","ORCB",18,0)
 S (BEG,END)="" I ORFLG=6 D  ;get BEG from XQAID for New Orders
"RTN","ORCB",19,0)
 . S BEG=$P(XQAID,";",3) I BEG'?7N1".".6N!(BEG'<DT) S BEG="" Q
"RTN","ORCB",20,0)
 . S BEG=$$FMADD^XLFDT(BEG,,,-5),END=$$NOW^XLFDT
"RTN","ORCB",21,0)
 I ORFLG=9 D  ;get BEG from Current Admission
"RTN","ORCB",22,0)
 . N ADM S ADM=+$G(^DPT(DFN,.105)) S:ADM ADM=+$P($G(^DGPM(ADM,0)),U)
"RTN","ORCB",23,0)
 . S END=$$NOW^XLFDT,BEG=$S(ADM:ADM,1:$$FMADD^XLFDT(END,-30))
"RTN","ORCB",24,0)
 S ^TMP("OR",$J,"ORDERS",0)="^^"_BEG_";"_END_";"_ORFLG_";"_DGRP_";L"
"RTN","ORCB",25,0)
 D EN^VALM("ORCB NOTIFICATIONS")
"RTN","ORCB",26,0)
 Q
"RTN","ORCB",27,0)
 ;
"RTN","ORCB",28,0)
INIT ; -- init variables and list array
"RTN","ORCB",29,0)
 S ORTAB="ORDERS" D TAB^ORCHART("ORDERS",1)
"RTN","ORCB",30,0)
 I VALMCNT=1,$G(^TMP("OR",$J,ORTAB,1,0))["No data available" D
"RTN","ORCB",31,0)
 . N X,I S X="     No "_$S(ORFLG=5:"expiring",ORFLG=11:"unsigned",ORFLG=12:"flagged",9:"unverified",1:"new")_" orders found."
"RTN","ORCB",32,0)
 . F I="ORDERS","CURRENT" S ^TMP("OR",$J,I,1,0)=$$LJ^XLFSTR(X,45)_"|"
"RTN","ORCB",33,0)
 Q
"RTN","ORCB",34,0)
 ;
"RTN","ORCB",35,0)
HELP ; -- help code
"RTN","ORCB",36,0)
 N X S VALMBCK=""
"RTN","ORCB",37,0)
 W !!,"Enter the display numbers of the orders you wish to act on;"
"RTN","ORCB",38,0)
 W !,"select either DT for a detailed listing of information about each"
"RTN","ORCB",39,0)
 W !,"order, or the desired action.  Enter Q to exit."
"RTN","ORCB",40,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCB",41,0)
 Q
"RTN","ORCB",42,0)
 ;
"RTN","ORCB",43,0)
PHDR ; -- protocol menu header code
"RTN","ORCB",44,0)
 N NUM,ORI,ORDEF,I,X K ORNMBR,OREBUILD
"RTN","ORCB",45,0)
 S VALMSG=$$MSG^ORCHART D SHOW^VALM
"RTN","ORCB",46,0)
 S NUM=+$P($G(^TMP("OR",$J,"CURRENT",0)),U,2)
"RTN","ORCB",47,0)
 S XQORM("#")=$O(^ORD(101,"B","ORCB ACTIONS",0))_"^1:"_NUM
"RTN","ORCB",48,0)
 S ORI=$S(ORFLG=5:1,ORFLG=11:"2,3,4",ORFLG=12:"3,4,5,6,7",1:8)
"RTN","ORCB",49,0)
 S ORDEF=$S(ORFLG=5:1,ORFLG=11:9,ORFLG=12:5,1:10)
"RTN","ORCB",50,0)
 F I=1:1:$L(ORI,",") S X=$T(ACTIONS+$P(ORI,",",I)),XQORM("KEY",$P(X,";",3))=$O(^ORD(101,"B","ORC "_$P(X,";",4)_" ORDERS",0))_"^1"
"RTN","ORCB",51,0)
 S XQORM("KEY","DT")=$O(^ORD(101,"B","ORC DETAILED DISPLAY",0))_"^1"
"RTN","ORCB",52,0)
 I +$P($G(^TMP("OR",$J,"CURRENT",0)),U,2)>0,XQORM("B")="Quit" S X=$T(ACTIONS+ORDEF),X=$P(X,";",4),XQORM("KEY",$P(X," "))=$O(^ORD(101,"B","ORC "_X_" ORDERS",0))_"^1",XQORM("B")=$$LOWER^VALM1(X)_" Orders" ; default action
"RTN","ORCB",53,0)
 S:'$G(ORL) ORL=$$FINDLOC ; attempt to determine location from orders
"RTN","ORCB",54,0)
 Q
"RTN","ORCB",55,0)
 ;
"RTN","ORCB",56,0)
SELECT ; -- process selected order(s)
"RTN","ORCB",57,0)
 N MENU,XQORM,Y,ORNMBR,OREBUILD,ORY S VALMBCK=""
"RTN","ORCB",58,0)
 S ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"RTN","ORCB",59,0)
 S:'$G(ORFLG) ORFLG=$P($P(^TMP("OR",$J,"CURRENT",0),U,3),";",3)
"RTN","ORCB",60,0)
 S MENU=$S(ORFLG=5:"EXPIRING",ORFLG=11:"UNSIGNED",ORFLG=12:"FLAGGED",1:"NEW")
"RTN","ORCB",61,0)
 S XQORM=$O(^ORD(101,"B","ORCB "_MENU_" MENU",0))_";ORD(101,"
"RTN","ORCB",62,0)
 I 'XQORM W !!,"ERROR" H 2 G SQ
"RTN","ORCB",63,0)
 S XQORM(0)="1AD",XQORM("A")="Select action: "
"RTN","ORCB",64,0)
 W ! D EN^XQORM G:Y'>0 SQ M ORY=Y
"RTN","ORCB",65,0)
 I $D(^ORD(101,+$P(ORY(1),U,2),20)) X ^(20) S VALMBCK="R"
"RTN","ORCB",66,0)
 I $G(OREBUILD) D:ORFLG=12 UNFLAG D TAB^ORCHART(ORTAB,1) Q
"RTN","ORCB",67,0)
SQ D DESELECT^ORCHART(ORNMBR)
"RTN","ORCB",68,0)
 Q
"RTN","ORCB",69,0)
 ;
"RTN","ORCB",70,0)
UNFLAG ; -- Unflag orders
"RTN","ORCB",71,0)
 N ORX,ORI,NUM,ORIFN,ORA,X
"RTN","ORCB",72,0)
 S ORX=$P(ORY(1),U,3) Q:(ORX="Unflag")!(ORX="Detailed Display")
"RTN","ORCB",73,0)
 F ORI=1:1:$L(ORNMBR,",") S NUM=$P(ORNMBR,",",ORI) I NUM D
"RTN","ORCB",74,0)
 . S ORIFN=$P(^TMP("OR",$J,"CURRENT","IDX",NUM),U) Q:'ORIFN
"RTN","ORCB",75,0)
 . S ORA=+$P(ORIFN,";",2),ORIFN=+ORIFN Q:'ORA
"RTN","ORCB",76,0)
 . Q:'$D(^OR(100,ORIFN))  Q:(ORX="Edit")&($P(^(ORIFN,3),U,3)'=12)
"RTN","ORCB",77,0)
 . S X=+$G(^OR(100,ORIFN,8,ORA,0)),$P(^(3),U)=0,$P(^(3),U,6,8)=X_U_DUZ_"^Unflagged by action" ; Unflag
"RTN","ORCB",78,0)
 . S X=ORIFN_";"_ORA D MSG^ORCFLAG(X)
"RTN","ORCB",79,0)
 Q
"RTN","ORCB",80,0)
 ;
"RTN","ORCB",81,0)
EN1(ORIFN,ACTION) ; -- entry point to display single order
"RTN","ORCB",82,0)
 Q:'ORIFN  Q:'$D(^OR(100,ORIFN))
"RTN","ORCB",83,0)
 Q:"^^NEW^RENEW^REPLACE^"'[(U_$G(ACTION)_U)
"RTN","ORCB",84,0)
 S DFN=+$P(^OR(100,ORIFN,0),U,2) Q:'DFN
"RTN","ORCB",85,0)
 S ^TMP("ORXPND",$J,0)=ORIFN_U_$G(ACTION)
"RTN","ORCB",86,0)
 D EN1^ORCXPND(DFN,ORIFN)
"RTN","ORCB",87,0)
 K ^TMP("ORXPND",$J),^TMP("OR",$J)
"RTN","ORCB",88,0)
 Q
"RTN","ORCB",89,0)
 ;
"RTN","ORCB",90,0)
NEW ; -- Add new order as follow-up action
"RTN","ORCB",91,0)
 N IFN,TYPE,ORIG,ORNP,ORPTLK S VALMBCK="" K ^TMP("ORNEW",$J)
"RTN","ORCB",92,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCB",93,0)
 S ORNP=$$PROVIDER^ORCMENU1,VALMBCK="R" G:ORNP="^" NWQ
"RTN","ORCB",94,0)
 I '$G(ORL) S ORL=$$LOCATION^ORCMENU1 G:ORL["^" NWQ
"RTN","ORCB",95,0)
 S ORIG=+$P($G(^TMP("ORXPND",$J,0)),U),IFN=+$P($G(^OR(100,+ORIG,0)),U,5)
"RTN","ORCB",96,0)
 G:'IFN NWQ S TYPE=$P($G(^ORD(101.41,IFN,0)),U,4)
"RTN","ORCB",97,0)
 ; If 2.5 order, use DG or PKG to get dlg
"RTN","ORCB",98,0)
 D FULL^VALM1,ORDER^ORCMENU
"RTN","ORCB",99,0)
 I $O(^TMP("ORNEW",$J,0)) D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",100,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",101,0)
NWQ D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",102,0)
 Q
"RTN","ORCB",103,0)
 ;
"RTN","ORCB",104,0)
EDIT ; -- Edit order as follow-up action
"RTN","ORCB",105,0)
 N OREBUILD K ^TMP("ORNEW",$J)
"RTN","ORCB",106,0)
 D EDIT^ORCACT I $G(OREBUILD) D
"RTN","ORCB",107,0)
 . D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",108,0)
 . S $P(^TMP("ORXPND",$J,0),U,2)=""
"RTN","ORCB",109,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",110,0)
 D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",111,0)
 Q
"RTN","ORCB",112,0)
 ;
"RTN","ORCB",113,0)
RENEW ; --Renew order as follow-up action
"RTN","ORCB",114,0)
 N OREBUILD K ^TMP("ORNEW",$J)
"RTN","ORCB",115,0)
 D RENEW^ORCACT I $G(OREBUILD) D
"RTN","ORCB",116,0)
 . D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",117,0)
 . S $P(^TMP("ORXPND",$J,0),U,2)=""
"RTN","ORCB",118,0)
 . K ^TMP("ORXPND",$J) D INIT^ORCXPND
"RTN","ORCB",119,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",120,0)
 D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",121,0)
 Q
"RTN","ORCB",122,0)
 ;
"RTN","ORCB",123,0)
SIGN ; -- Sign new order
"RTN","ORCB",124,0)
 N ORIFN,ORTAB,ORNMBR,CNT
"RTN","ORCB",125,0)
 S ORTAB="NEW",(ORIFN,CNT)=0,ORNMBR=""
"RTN","ORCB",126,0)
 F  S ORIFN=+$O(^TMP("ORNEW",$J,ORIFN)) Q:ORIFN'>0  S CNT=CNT+1,^TMP("OR",$J,"NEW","IDX",CNT)=ORIFN,ORNMBR=ORNMBR_CNT_","
"RTN","ORCB",127,0)
 I CNT D EN^ORCSIGN K ^TMP("OR",$J,"NEW","IDX")
"RTN","ORCB",128,0)
 Q
"RTN","ORCB",129,0)
 ;
"RTN","ORCB",130,0)
EXIT ; -- exit action
"RTN","ORCB",131,0)
 ;*334/VMP-DJE Auto unflag has been disabled
"RTN","ORCB",132,0)
 ;I $P($P(^TMP("OR",$J,"CURRENT",0),U,3),";",3)=12 D  ; flagged orders
"RTN","ORCB",133,0)
 ;. Q:'$$GET^XPAR("ALL","ORPF AUTO UNFLAG")
"RTN","ORCB",134,0)
 ;. N ORI,ORIFN,ORA,XQAKILL,ORN,ORUNF
"RTN","ORCB",135,0)
 ;. S ORUNF=+$E($$NOW^XLFDT,1,12)_U_DUZ_"^Auto-Unflagged"
"RTN","ORCB",136,0)
 ;. S ORI=0 F  S ORI=$O(^TMP("OR",$J,"CURRENT","IDX",ORI)) Q:ORI'>0  S ORIFN=$P(^(ORI),U),ORA=+$P(ORIFN,";",2) I ORIFN,$D(^OR(100,+ORIFN,0)) S $P(^(8,ORA,3),U)=0,$P(^(3),U,6,8)=ORUNF D MSG^ORCFLAG(ORIFN) ; unflag
"RTN","ORCB",137,0)
 ;. S ORN=+$O(^ORD(100.9,"B","FLAGGED ORDERS",0))
"RTN","ORCB",138,0)
 ;. S XQAKILL=$$XQAKILL^ORB3F1(ORN) D:$D(XQAID) DELETE^XQALERT
"RTN","ORCB",139,0)
 D EXIT^ORCHART
"RTN","ORCB",140,0)
 Q
"RTN","ORCB",141,0)
 ;
"RTN","ORCB",142,0)
ACTIONS ;;KEY;NAME
"RTN","ORCB",143,0)
 ;;RN;RENEW
"RTN","ORCB",144,0)
 ;;$;SIGN
"RTN","ORCB",145,0)
 ;;DC;DISCONTINUE
"RTN","ORCB",146,0)
 ;;ED;CHANGE
"RTN","ORCB",147,0)
 ;;UF;UNFLAG
"RTN","ORCB",148,0)
 ;;HD;HOLD
"RTN","ORCB",149,0)
 ;;RL;UNHOLD
"RTN","ORCB",150,0)
 ;;VF;VERIFY
"RTN","ORCB",151,0)
 ;;;SIGN ALL
"RTN","ORCB",152,0)
 ;;;VERIFY ALL
"RTN","ORCB",153,0)
 ;
"RTN","ORCB",154,0)
ALL ; -- Select ALL orders
"RTN","ORCB",155,0)
 N X,Y,DIR,MAX
"RTN","ORCB",156,0)
 S MAX=+$P($G(^TMP("OR",$J,"CURRENT",0)),U,2),X="1-"_MAX,Y=""
"RTN","ORCB",157,0)
 S DIR(0)="L^1:"_MAX,DIR("V")="" D:MAX ^DIR
"RTN","ORCB",158,0)
 S ORNMBR=Y
"RTN","ORCB",159,0)
 Q
"RTN","ORCB",160,0)
 ;
"RTN","ORCB",161,0)
FINDLOC() ; -- Loop through orders in alert to find assigned location
"RTN","ORCB",162,0)
 N ORI,ORIFN,ORY S ORI=0,ORY=""
"RTN","ORCB",163,0)
 F  S ORI=$O(^TMP("OR",$J,"CURRENT","IDX",ORI)) Q:ORI'>0  S ORIFN=+^(ORI),ORX=$P($G(^OR(100,ORIFN,0)),U,10) S:ORY="" ORY=ORX I ORY'="",ORX'=ORY S ORY="" Q  ; ORY=location for all orders, or "" if different
"RTN","ORCB",164,0)
 Q ORY
"RTN","ORCB",165,0)
 ;
"RTN","ORCB",166,0)
DELETE ; -- Delete current alert
"RTN","ORCB",167,0)
 N %,%Y,X,Y,PRMT,XQAKILL S VALMBCK="",XQAKILL=1
"RTN","ORCB",168,0)
 S PRMT="Your "_$S(ORFLG=5:"Expiring",ORFLG=11:"Unsigned",ORFLG=12:"Flagged",ORFLG=9:"Unverified",1:"New")_" Orders alert for "_$G(ORPNM)_" will be deleted!"
"RTN","ORCB",169,0)
D1 W !!,PRMT,!,"Are you sure" S %=2 D YN^DICN
"RTN","ORCB",170,0)
 I (%<0)!(%=2) W !,"Nothing deleted." H 2 Q
"RTN","ORCB",171,0)
 I %=0 D  G D1
"RTN","ORCB",172,0)
 . W !!,"This action will delete the alert you are currently processing; the alert will",!,"disappear automatically when all orders have been acted on, but this action may",!,"be used to remove the alert if some orders are to be left unchanged."
"RTN","ORCB",173,0)
 . W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCB",174,0)
 W !,"Removing alert ..." D:$D(XQAID) DEL^ORB3FUP1(.Y,XQAID)
"RTN","ORCB",175,0)
 I $G(Y)="TRUE" W " done." S VALMBCK="Q",DEL=1 H 2
"RTN","ORCB",176,0)
 E  W " unable to delete alert." H 2
"RTN","ORCB",177,0)
 Q
"RTN","ORWORB")
0^1^B73567288^B72691529
"RTN","ORWORB",1,0)
ORWORB ; slc/dee/REV/CLA,WAT - RPC functions which return user alert ;10:12 am JAN 31, 2001
"RTN","ORWORB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,148,173,190,215,243,296,329,334**;Dec 17, 1997;Build 5
"RTN","ORWORB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORWORB",4,0)
 ;
"RTN","ORWORB",5,0)
 ;DBIA reference section
"RTN","ORWORB",6,0)
 ;10035 - ^DPT
"RTN","ORWORB",7,0)
 ;2689  - ^XTV(8992
"RTN","ORWORB",8,0)
 ;4329  - ^VA(200,5
"RTN","ORWORB",9,0)
 ;10076 - ^XUSEC(
"RTN","ORWORB",10,0)
 ;3563  - RAO7PC4
"RTN","ORWORB",11,0)
 ;2834  - TIUSRVLO
"RTN","ORWORB",12,0)
 ;10061 - VADPT
"RTN","ORWORB",13,0)
 ;10103 - XLFDT
"RTN","ORWORB",14,0)
 ;2263  - XPAR
"RTN","ORWORB",15,0)
 ;4834  - XQALDATA
"RTN","ORWORB",16,0)
 ;10081 - XQALERT
"RTN","ORWORB",17,0)
 ;
"RTN","ORWORB",18,0)
URGENLST(ORY) ;return array of the  urgency for the notification
"RTN","ORWORB",19,0)
 N ORSRV,ORERROR
"RTN","ORWORB",20,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWORB",21,0)
 D GETLST^XPAR(.ORY,"USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORB URGENCY","I",.ORERROR)
"RTN","ORWORB",22,0)
 Q
"RTN","ORWORB",23,0)
 ;
"RTN","ORWORB",24,0)
FASTUSER(ORY) ;return current user's notifications across all patients
"RTN","ORWORB",25,0)
 N STRTDATE,STOPDATE,ORTOT,I,ORURG,URG,ORN,SORT,ORN0,URGLIST,REMLIST,REM,NONORLST,NONOR
"RTN","ORWORB",26,0)
 N ALRT,ALRTDT,ALRTPT,ALRTMSG,ALRTI,ALRTLOC,ALRTXQA,J,FWDBY,PRE,ALRTDFN
"RTN","ORWORB",27,0)
 K ^TMP("ORBG",$J)
"RTN","ORWORB",28,0)
 S STRTDATE="",STOPDATE="",FWDBY="Forwarded by: "
"RTN","ORWORB",29,0)
 D GETUSER1^XQALDATA("^TMP(""ORB"",$J)",DUZ,STRTDATE,STOPDATE)
"RTN","ORWORB",30,0)
 S ORTOT=^TMP("ORB",$J)
"RTN","ORWORB",31,0)
 D URGLIST^ORQORB(.URGLIST)
"RTN","ORWORB",32,0)
 D REMLIST^ORQORB(.REMLIST)
"RTN","ORWORB",33,0)
 D REMNONOR^ORQORB(.NONORLST)
"RTN","ORWORB",34,0)
 S J=0
"RTN","ORWORB",35,0)
 F I=1:1:ORTOT D
"RTN","ORWORB",36,0)
 .S ALRTDFN=""
"RTN","ORWORB",37,0)
 .S ALRT=^TMP("ORB",$J,I)
"RTN","ORWORB",38,0)
 .S PRE=$E(ALRT,1,1)
"RTN","ORWORB",39,0)
 .S ALRTXQA=$P(ALRT,U,2)  ;XQAID
"RTN","ORWORB",40,0)
 .S NONOR="" F  S NONOR=$O(NONORLST(NONOR)) Q:NONOR=""  D
"RTN","ORWORB",41,0)
 ..I ALRTXQA[NONOR S REM=1  ;allow this type of alert to be Removed
"RTN","ORWORB",42,0)
 .S ALRTMSG=$P($P(ALRT,U),PRE_"  ",2)
"RTN","ORWORB",43,0)
 .I $E(ALRT,4,8)'="-----" D  ;not forwarded alert info/comment
"RTN","ORWORB",44,0)
 ..S ORURG="n/a"
"RTN","ORWORB",45,0)
 ..S ALRTI=$P(ALRT,"  ")
"RTN","ORWORB",46,0)
 ..S ALRTPT=""
"RTN","ORWORB",47,0)
 ..S ALRTLOC=""
"RTN","ORWORB",48,0)
 ..I $E($P(ALRTXQA,";"),1,3)="TIU" S ORURG="Moderate"
"RTN","ORWORB",49,0)
 ..I $P(ALRTXQA,",")="OR" D
"RTN","ORWORB",50,0)
 ...S ORN=$P($P(ALRTXQA,";"),",",3)
"RTN","ORWORB",51,0)
 ...S URG=$G(URGLIST(ORN))
"RTN","ORWORB",52,0)
 ...S ORURG=$S(URG=1:"HIGH",URG=2:"Moderate",1:"low")
"RTN","ORWORB",53,0)
 ...S REM=$G(REMLIST(ORN))
"RTN","ORWORB",54,0)
 ...S ORN0=^ORD(100.9,ORN,0)
"RTN","ORWORB",55,0)
 ...S ALRTI=$S($P(ORN0,U,6)="INFODEL":"I",1:"")
"RTN","ORWORB",56,0)
 ...S ALRTDFN=$P(ALRTXQA,",",2)
"RTN","ORWORB",57,0)
 ...S ALRTLOC=$G(^DPT(+$G(ALRTDFN),.1))
"RTN","ORWORB",58,0)
 ..S ALRTI=$S(ALRTI="I":"I",1:"")
"RTN","ORWORB",59,0)
 ..I (ALRT["): ")!($G(ORN)=27&(ALRT[") CV")) D  ;WAT
"RTN","ORWORB",60,0)
 ...S ALRTPT=$P(ALRT,": ")
"RTN","ORWORB",61,0)
 ...S ALRTPT=$E(ALRTPT,4,$L(ALRTPT))
"RTN","ORWORB",62,0)
 ...I $G(ORN)=27&(ALRT[") CV") S ALRTMSG=$P($P(ALRT,U),": ",2) ;WAT
"RTN","ORWORB",63,0)
 ...E  S ALRTMSG=$P($P(ALRT,U),"): ",2) ;WAT
"RTN","ORWORB",64,0)
 ...I $E(ALRTMSG,1,1)="[" D
"RTN","ORWORB",65,0)
 ....S:'$L(ALRTLOC) ALRTLOC=$P($P(ALRTMSG,"]"),"[",2)
"RTN","ORWORB",66,0)
 ....S ALRTMSG=$P(ALRTMSG,"] ",2)
"RTN","ORWORB",67,0)
 ..I '$L($G(ALRTPT)) S ALRTPT="no patient"
"RTN","ORWORB",68,0)
 ..S ALRTDT=$P(ALRTXQA,";",3)
"RTN","ORWORB",69,0)
 ..S ALRTDT=$P(ALRTDT,".")_"."_$E($P(ALRTDT,".",2)_"0000",1,4)
"RTN","ORWORB",70,0)
 ..S ALRTDT=$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"/"_($E(ALRTDT,1,3)+1700)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",71,0)
 ..;S ALRTDT=($E(ALRTDT,1,3)+1700)_"/"_$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",72,0)
 ..S J=J+1,^TMP("ORBG",$J,J)=ALRTI_U_ALRTPT_U_ALRTLOC_U_ORURG_U_ALRTDT_U
"RTN","ORWORB",73,0)
 ..S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_ALRTMSG_U_U_ALRTXQA_U_$G(REM)_U
"RTN","ORWORB",74,0)
 .;
"RTN","ORWORB",75,0)
 .;if alert forward info/comment:
"RTN","ORWORB",76,0)
 .I $E(ALRTMSG,1,5)="-----" D
"RTN","ORWORB",77,0)
 ..S ALRTMSG=$P(ALRTMSG,"-----",2)
"RTN","ORWORB",78,0)
 ..I $E(ALRTMSG,1,14)=FWDBY D
"RTN","ORWORB",79,0)
 ...S J=J+1,^TMP("ORBG",$J,J)=FWDBY_U_$P($P(ALRTMSG,FWDBY,2),"Generated: ")_$P($P(ALRTMSG,FWDBY,2),"Generated: ",2)
"RTN","ORWORB",80,0)
 ..E  S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_U_""""_ALRTMSG_""""
"RTN","ORWORB",81,0)
 S ^TMP("ORBG",$J)=""
"RTN","ORWORB",82,0)
 S ORY=$NA(^TMP("ORBG",$J))
"RTN","ORWORB",83,0)
 Q
"RTN","ORWORB",84,0)
 ;
"RTN","ORWORB",85,0)
GETDATA(ORY,XQAID) ; return XQADATA for an alert
"RTN","ORWORB",86,0)
 N SHOWADD
"RTN","ORWORB",87,0)
 S ORY=""
"RTN","ORWORB",88,0)
 Q:$G(XQAID)=""!('$D(^XTV(8992,"AXQA",XQAID)))
"RTN","ORWORB",89,0)
 D GETACT^XQALERT(XQAID)
"RTN","ORWORB",90,0)
 S ORY=XQADATA
"RTN","ORWORB",91,0)
 I ($E(XQAID,1,3)="TIU"),(+ORY>0) D
"RTN","ORWORB",92,0)
 . S SHOWADD=1
"RTN","ORWORB",93,0)
 . S ORY=ORY_$$RESOLVE^TIUSRVLO(+ORY)
"RTN","ORWORB",94,0)
 K XQAID,XQADATA,XQAOPT,XQAROU
"RTN","ORWORB",95,0)
 Q
"RTN","ORWORB",96,0)
 ;
"RTN","ORWORB",97,0)
KILUNSNO(Y,ORVP) ; Delete unsigned order alerts if no unsigned orders remaining
"RTN","ORWORB",98,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWORB",99,0)
 D UNOTIF^ORCSIGN
"RTN","ORWORB",100,0)
 Q
"RTN","ORWORB",101,0)
 ;
"RTN","ORWORB",102,0)
UNFLORD(ORY,DFN,XQAID) ; -- auto-unflag orders?/delete alert
"RTN","ORWORB",103,0)
 Q
"RTN","ORWORB",104,0)
 ;*334/VMP-DJE Auto unflag has been disabled
"RTN","ORWORB",105,0)
 ;Q:'$L(DFN)!('$L(XQAID))
"RTN","ORWORB",106,0)
 ;N ORI,ORIFN,ORA,XQAKILL,ORN,ORBY,ORAUTO,ORUNF
"RTN","ORWORB",107,0)
 ;S ORN=+$O(^ORD(100.9,"B","FLAGGED ORDERS",0))
"RTN","ORWORB",108,0)
 ;;S XQAKILL=$$XQAKILL^ORB3F1(ORN)
"RTN","ORWORB",109,0)
 ;D LIST^ORQOR1(.ORBY,DFN,"ALL",12,"","")
"RTN","ORWORB",110,0)
 ;S ORAUTO=+$$GET^XPAR("ALL","ORPF AUTO UNFLAG")
"RTN","ORWORB",111,0)
 ;S ORI=0 F  S ORI=$O(ORBY(ORI)) Q:ORI'>0  D
"RTN","ORWORB",112,0)
 ;. I ORAUTO D  ; unflag
"RTN","ORWORB",113,0)
 ;. . ;DJE-VM *329 - use GUI RPC call to make it run the proper code, only run it if the user sees it.
"RTN","ORWORB",114,0)
 ;. . ;S ORUNF=+$E($$NOW^XLFDT,1,12)_U_DUZ_"^Auto-Unflagged"
"RTN","ORWORB",115,0)
 ;. . ;S ORIFN=$P(ORBY(ORI),U),ORA=+$P(ORIFN,";",2)
"RTN","ORWORB",116,0)
 ;. . ;I ORIFN,$D(^OR(100,+ORIFN,0)) S $P(^(8,ORA,3),U)=0,$P(^(3),U,6,8)=ORUNF D MSG^ORCFLAG(ORIFN) ; unflag
"RTN","ORWORB",117,0)
 ;. . S ORIFN=+ORBY(ORI)
"RTN","ORWORB",118,0)
 ;. . I $D(^OR(100,ORIFN,0)),'$$FLAGRULE^ORWORR1(ORIFN) D UNFLAG^ORWDXA(.ORUNF,$P(ORBY(ORI),U),"Auto-Unflagged")
"RTN","ORWORB",119,0)
 ;;DJE-VM *329 - ORWDXA is smarter and deletes the appropriate alert(s)
"RTN","ORWORB",120,0)
 ;;I (ORAUTO)!(+$G(ORBY(1))=0) D DELETE^XQALERT
"RTN","ORWORB",121,0)
 ;Q
"RTN","ORWORB",122,0)
KILEXMED(Y,ORDFN)  ; -- Delete expiring meds notification if no expiring meds remaining
"RTN","ORWORB",123,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",124,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",125,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",126,0)
 N XQAKILL,ORNIFN,ORVP,ORIO S OROI=""
"RTN","ORWORB",127,0)
 F OROI="INPT","OUTPT" D
"RTN","ORWORB",128,0)
 .S ORNIFN=$O(^ORD(100.9,"B","MEDICATIONS EXPIRING - "_OROI,0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",129,0)
 .Q:'$L($G(ORNIFN))
"RTN","ORWORB",130,0)
 .S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; expiring meds notif
"RTN","ORWORB",131,0)
 .I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",132,0)
 .I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",133,0)
 Q
"RTN","ORWORB",134,0)
KILEXOI(Y,ORDFN,ORNIFN)  ; -- Delete expiring flagged OI notification if no flagged expiring OI remaining
"RTN","ORWORB",135,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",136,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",137,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",138,0)
 N XQAKILL,ORVP
"RTN","ORWORB",139,0)
 S ORVP=ORDFN_";DPT("
"RTN","ORWORB",140,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; flagged expiring OI notifications
"RTN","ORWORB",141,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",142,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",143,0)
 Q
"RTN","ORWORB",144,0)
KILUNVOR(Y,ORDFN)  ; -- Delete UNVERIFIED ORDER notification if none remaining within current admission/30 days
"RTN","ORWORB",145,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",146,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",147,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",148,0)
 ;get current admission date/time:
"RTN","ORWORB",149,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",150,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",151,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",152,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",153,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",154,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",155,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",156,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",157,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",158,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",159,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",160,0)
 Q
"RTN","ORWORB",161,0)
KILUNVMD(Y,ORDFN)  ; -- Delete UNVERIFIED MEDS notification if none remaining within current admission/30 days
"RTN","ORWORB",162,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",163,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",164,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",165,0)
 ;get current admission date/time:
"RTN","ORWORB",166,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",167,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",168,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",169,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",170,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",171,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",172,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",173,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED MEDICATION ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",174,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",175,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",176,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",177,0)
 Q
"RTN","ORWORB",178,0)
ESORD(ORY,XQAID)   ;order(s) requiring electronic signature follow-up
"RTN","ORWORB",179,0)
 K XQAKILL
"RTN","ORWORB",180,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORX,ORZ,ORDERS,ORDNUM,ORQUIT,ORBLMDEL
"RTN","ORWORB",181,0)
 S ORBXQAID=XQAID,ORDERS=0,ORQUIT=0
"RTN","ORWORB",182,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORWORB",183,0)
 S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",184,0)
 ;the FLG code for UNSIGNED orders in ORQ1 is '11'
"RTN","ORWORB",185,0)
 ;get unsigned orders - if none exist, delete alert then quit:
"RTN","ORWORB",186,0)
 D EN^ORQ1(ORPT_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORWORB",187,0)
 S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  I +$G(^TMP("ORR",$J,ORX,"TOT"))<1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",188,0)
 ;
"RTN","ORWORB",189,0)
 ;user does not have ORES key, delete user's alert:
"RTN","ORWORB",190,0)
 I '$D(^XUSEC("ORES",DUZ)) S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",191,0)
 ;
"RTN","ORWORB",192,0)
 ;if prov is NOT linked to pt via attending, primary or teams:
"RTN","ORWORB",193,0)
 I $$PPLINK^ORQPTQ1(DUZ,ORPT)=0 D
"RTN","ORWORB",194,0)
 .S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""!(ORDERS=1)  D
"RTN","ORWORB",195,0)
 ..S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:+ORZ=0!(ORDERS=1)  D
"RTN","ORWORB",196,0)
 ...S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORWORB",197,0)
 ...;quit if this unsigned order's last action was made by the user
"RTN","ORWORB",198,0)
 ...I DUZ=+$$UNSIGNOR^ORQOR2(ORDNUM) S ORDERS=1
"RTN","ORWORB",199,0)
 .I ORDERS'=1 D  ;provider has no outstanding unsigned orders for pt
"RTN","ORWORB",200,0)
 ..S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID)  ;delete alert for this user
"RTN","ORWORB",201,0)
 K ^TMP("ORR",$J)
"RTN","ORWORB",202,0)
 Q
"RTN","ORWORB",203,0)
 ;
"RTN","ORWORB",204,0)
TXTFUP(ROOT,DFN,NOTIF,XQADATA) ; Follow-up for text messages
"RTN","ORWORB",205,0)
 ;
"RTN","ORWORB",206,0)
 I NOTIF=67 D CHGRAD
"RTN","ORWORB",207,0)
 Q
"RTN","ORWORB",208,0)
 ;
"RTN","ORWORB",209,0)
CHGRAD ;GUI follow-up for Imaging Request Changed (#67)
"RTN","ORWORB",210,0)
 S ROOT=$NA(^TMP($J,"RAE4"))
"RTN","ORWORB",211,0)
 K @ROOT
"RTN","ORWORB",212,0)
 D SET1^RAO7PC4  ;DBIA #3563
"RTN","ORWORB",213,0)
 Q
"RTN","ORWORB",214,0)
 ;
"RTN","ORWORB",215,0)
GETSORT(ORY) ;return notification sort method^direction for user/division/system/pkg
"RTN","ORWORB",216,0)
 S ORY=$$GET^XPAR("ALL","ORB SORT METHOD",1,"I")_U_$$GET^XPAR("ALL","ORB SORT DIRECTION",1,"I")
"RTN","ORWORB",217,0)
 Q
"RTN","ORWORB",218,0)
 ;
"RTN","ORWORB",219,0)
SETSORT(ORERR,SORT,DIR) ;set notification sort method^direction for user
"RTN","ORWORB",220,0)
 D EN^XPAR(DUZ_";VA(200,","ORB SORT METHOD",1,SORT,.ORERR)
"RTN","ORWORB",221,0)
 I $L($G(DIR)) D EN^XPAR(DUZ_";VA(200,","ORB SORT DIRECTION",1,DIR,.ORERR)
"RTN","ORWORB",222,0)
 Q
"RTN","ORY334")
0^^B21763040^n/a
"RTN","ORY334",1,0)
ORY334 ; SLC/KCM - Turn off Auto Unflag ;03:16 PM  2 Sep 1998
"RTN","ORY334",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**334**;Dec 17, 1997;Build 5
"RTN","ORY334",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORY334",4,0)
 ;
"RTN","ORY334",5,0)
 ;DBIA reference section
"RTN","ORY334",6,0)
 ;2992  - ^XTV(8989.51
"RTN","ORY334",7,0)
 ;2053  - DIE
"RTN","ORY334",8,0)
 ;10070 - XMD
"RTN","ORY334",9,0)
 ;2263  - XPAR
"RTN","ORY334",10,0)
 ;
"RTN","ORY334",11,0)
 N AUTOUNFL,XPARIEN
"RTN","ORY334",12,0)
 S AUTOUNFL=$$GET^XPAR("SYS","ORPF AUTO UNFLAG")
"RTN","ORY334",13,0)
 S XPARIEN=$O(^XTV(8989.51,"B","ORPF AUTO UNFLAG",0))
"RTN","ORY334",14,0)
 I AUTOUNFL=1,$G(XPARIEN) D
"RTN","ORY334",15,0)
 . N ERR
"RTN","ORY334",16,0)
 . I $P(^XTV(8989.51,XPARIEN,0),"^",6) D PROHIBIT(XPARIEN,0)  ;Edit has been disabled so enable for just now.
"RTN","ORY334",17,0)
 . D EN^XPAR("SYS","ORPF AUTO UNFLAG",1,0,.ERR) ;turn off auto unflag
"RTN","ORY334",18,0)
 . I +ERR D MAIL(ERR)
"RTN","ORY334",19,0)
 D PROHIBIT(XPARIEN,1)
"RTN","ORY334",20,0)
 Q
"RTN","ORY334",21,0)
 ;
"RTN","ORY334",22,0)
PROHIBIT(DA,YESNO) ;Set PROHIBIT EDITING field of the parameter definition file
"RTN","ORY334",23,0)
 N DR,DIE
"RTN","ORY334",24,0)
 S DR=".06////"_YESNO,DIE="^XTV(8989.51,"
"RTN","ORY334",25,0)
 D ^DIE
"RTN","ORY334",26,0)
 Q
"RTN","ORY334",27,0)
 ;
"RTN","ORY334",28,0)
MAIL(ERR) ;
"RTN","ORY334",29,0)
 ; setup, create, and send a mailman message to the installer
"RTN","ORY334",30,0)
 ; instructing him/her on how to manually set the ORPF AUTO UNFLAG 
"RTN","ORY334",31,0)
 ; to NO in VistA when the pre-install process has failed.
"RTN","ORY334",32,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,XMMG,I
"RTN","ORY334",33,0)
 S XMDUZ="PATCH OR*3*334 PRE-INIT" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY334",34,0)
 S I=0,I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",35,0)
 S I=I+1,^TMP($J,"ORTXT",I)="The following error occurred in the process of modifying the ORPF AUTO UNFLAG"
"RTN","ORY334",36,0)
 S I=I+1,^TMP($J,"ORTXT",I)="parameter programmatically.",I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",37,0)
 S I=I+1,^TMP($J,"ORTXT",I)="  "_ERR,I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",38,0)
 S I=I+1,^TMP($J,"ORTXT",I)="Attached are some instructions on how to manually change these parameter settings"
"RTN","ORY334",39,0)
 S I=I+1,^TMP($J,"ORTXT",I)="in VistA. Please follow the below instructions to make this change."
"RTN","ORY334",40,0)
 S I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",41,0)
 S I=I+1,^TMP($J,"ORTXT",I)="  1) First, enable editing on the ORPF AUTO UNFLAG parameter."
"RTN","ORY334",42,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    a) In VistA, access FileMan."
"RTN","ORY334",43,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    b) Select option 1 ENTER OR EDIT FILE ENTRIES."
"RTN","ORY334",44,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    c) At INPUT TO WHAT FILE: prompt select PARAMETER DEFINITION."
"RTN","ORY334",45,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    d) At the EDIT WHICH FIELD: ALL// prompt, enter in PROHIBIT EDITING."
"RTN","ORY334",46,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    e) At the THEN EDIT FIELD: prompt, hit enter."
"RTN","ORY334",47,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    f) At the Select PARAMETER DEFINITION NAME: prompt, enter ORPF AUTO UNFLAG."
"RTN","ORY334",48,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    g) At the PROHIBIT EDITING: Yes// prompt, enter No."
"RTN","ORY334",49,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    h) Exit FileMan.",I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",50,0)
 S I=I+1,^TMP($J,"ORTXT",I)="  2) Second, set the ORPF AUTO UNFLAG parameter to NO."
"RTN","ORY334",51,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    a) In VistA, access the General Parameter Tools menu [XPAR MENU TOOLS]."
"RTN","ORY334",52,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    b) Select EP, Edit Parameter Values [XPAR EDIT PARAMETER]."
"RTN","ORY334",53,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    c) At the Select PARAMETER DEFINITION NAME: prompt, "
"RTN","ORY334",54,0)
 S I=I+1,^TMP($J,"ORTXT",I)="       enter in ORPF AUTO UNFLAG."
"RTN","ORY334",55,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    d) At the next prompt, AUTO UNFLAG: YES//, enter in NO."
"RTN","ORY334",56,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    e) Exit the General Parameter Tools",I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",57,0)
 S I=I+1,^TMP($J,"ORTXT",I)="  3) Finally, disable editing on the ORPF AUTO UNFLAG parameter."
"RTN","ORY334",58,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    a) In VistA, access FileMan."
"RTN","ORY334",59,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    b) Select option 1 ENTER OR EDIT FILE ENTRIES."
"RTN","ORY334",60,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    c) At INPUT TO WHAT FILE: prompt select PARAMETER DEFINITION."
"RTN","ORY334",61,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    d) At the EDIT WHICH FIELD: ALL// prompt, enter in PROHIBIT EDITING."
"RTN","ORY334",62,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    e) At the THEN EDIT FIELD: prompt, hit enter."
"RTN","ORY334",63,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    f) At the Select PARAMETER DEFINITION NAME: prompt, enter ORPF AUTO UNFLAG."
"RTN","ORY334",64,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    g) At the PROHIBIT EDITING: No// prompt, enter Yes."
"RTN","ORY334",65,0)
 S I=I+1,^TMP($J,"ORTXT",I)="    h) Exit FileMan.",I=I+1,^TMP($J,"ORTXT",I)="",I=I+1,^TMP($J,"ORTXT",I)=""
"RTN","ORY334",66,0)
 S I=I+1,^TMP($J,"ORTXT",I)="",XMTEXT="^TMP($J,""ORTXT"",",XMSUB="PATCH OR*3*334 Pre-init FAILED!"
"RTN","ORY334",67,0)
 D ^XMD
"RTN","ORY334",68,0)
 Q
"VER")
8.0^22.0
"BLD",9122,6)
^335
**END**
**END**

