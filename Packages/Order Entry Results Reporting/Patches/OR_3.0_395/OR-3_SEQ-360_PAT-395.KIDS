Released OR*3*395 SEQ #360
Extracted from mail message
**KIDS**:OR*3.0*395^

**INSTALL NAME**
OR*3.0*395
"BLD",9012,0)
OR*3.0*395^ORDER ENTRY/RESULTS REPORTING^0^3150128^y
"BLD",9012,4,0)
^9.64PA^^
"BLD",9012,6.3)
11
"BLD",9012,"ABPKG")
n
"BLD",9012,"INID")
^n
"BLD",9012,"INIT")
POST^ORY395
"BLD",9012,"KRN",0)
^9.67PA^779.2^20
"BLD",9012,"KRN",.4,0)
.4
"BLD",9012,"KRN",.401,0)
.401
"BLD",9012,"KRN",.402,0)
.402
"BLD",9012,"KRN",.403,0)
.403
"BLD",9012,"KRN",.5,0)
.5
"BLD",9012,"KRN",.84,0)
.84
"BLD",9012,"KRN",3.6,0)
3.6
"BLD",9012,"KRN",3.8,0)
3.8
"BLD",9012,"KRN",9.2,0)
9.2
"BLD",9012,"KRN",9.8,0)
9.8
"BLD",9012,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",9012,"KRN",9.8,"NM",1,0)
ORWDXC^^0^B69940726
"BLD",9012,"KRN",9.8,"NM",2,0)
ORDSGCHK^^0^B110004235
"BLD",9012,"KRN",9.8,"NM",3,0)
ORDV04^^0^B62541465
"BLD",9012,"KRN",9.8,"NM",4,0)
ORY395^^0^B15368598
"BLD",9012,"KRN",9.8,"NM",5,0)
ORUQO^^0^B18883882
"BLD",9012,"KRN",9.8,"NM",6,0)
ORUTLA1^^1^
"BLD",9012,"KRN",9.8,"NM",7,0)
ORUTLA2^^1^
"BLD",9012,"KRN",9.8,"NM",8,0)
ORUTLA3^^1^
"BLD",9012,"KRN",9.8,"NM",9,0)
ORMBLDPS^^0^B94048957
"BLD",9012,"KRN",9.8,"NM","B","ORDSGCHK",2)

"BLD",9012,"KRN",9.8,"NM","B","ORDV04",3)

"BLD",9012,"KRN",9.8,"NM","B","ORMBLDPS",9)

"BLD",9012,"KRN",9.8,"NM","B","ORUQO",5)

"BLD",9012,"KRN",9.8,"NM","B","ORUTLA1",6)

"BLD",9012,"KRN",9.8,"NM","B","ORUTLA2",7)

"BLD",9012,"KRN",9.8,"NM","B","ORUTLA3",8)

"BLD",9012,"KRN",9.8,"NM","B","ORWDXC",1)

"BLD",9012,"KRN",9.8,"NM","B","ORY395",4)

"BLD",9012,"KRN",19,0)
19
"BLD",9012,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",9012,"KRN",19,"NM",1,0)
ORE ORDER INSTRUCTIONS CLEANUP^^1^
"BLD",9012,"KRN",19,"NM",2,0)
ORE CAC MGR^^1^
"BLD",9012,"KRN",19,"NM","B","ORE CAC MGR",2)

"BLD",9012,"KRN",19,"NM","B","ORE ORDER INSTRUCTIONS CLEANUP",1)

"BLD",9012,"KRN",19.1,0)
19.1
"BLD",9012,"KRN",101,0)
101
"BLD",9012,"KRN",409.61,0)
409.61
"BLD",9012,"KRN",771,0)
771
"BLD",9012,"KRN",779.2,0)
779.2
"BLD",9012,"KRN",870,0)
870
"BLD",9012,"KRN",8989.51,0)
8989.51
"BLD",9012,"KRN",8989.51,"NM",0)
^9.68A^2^2
"BLD",9012,"KRN",8989.51,"NM",1,0)
ORE CLEAN UP UTIL LAST RUN DT^^1^
"BLD",9012,"KRN",8989.51,"NM",2,0)
ORE CLEAN UP UTIL START DATE^^1^
"BLD",9012,"KRN",8989.51,"NM","B","ORE CLEAN UP UTIL LAST RUN DT",1)

"BLD",9012,"KRN",8989.51,"NM","B","ORE CLEAN UP UTIL START DATE",2)

"BLD",9012,"KRN",8989.52,0)
8989.52
"BLD",9012,"KRN",8994,0)
8994
"BLD",9012,"KRN","B",.4,.4)

"BLD",9012,"KRN","B",.401,.401)

"BLD",9012,"KRN","B",.402,.402)

"BLD",9012,"KRN","B",.403,.403)

"BLD",9012,"KRN","B",.5,.5)

"BLD",9012,"KRN","B",.84,.84)

"BLD",9012,"KRN","B",3.6,3.6)

"BLD",9012,"KRN","B",3.8,3.8)

"BLD",9012,"KRN","B",9.2,9.2)

"BLD",9012,"KRN","B",9.8,9.8)

"BLD",9012,"KRN","B",19,19)

"BLD",9012,"KRN","B",19.1,19.1)

"BLD",9012,"KRN","B",101,101)

"BLD",9012,"KRN","B",409.61,409.61)

"BLD",9012,"KRN","B",771,771)

"BLD",9012,"KRN","B",779.2,779.2)

"BLD",9012,"KRN","B",870,870)

"BLD",9012,"KRN","B",8989.51,8989.51)

"BLD",9012,"KRN","B",8989.52,8989.52)

"BLD",9012,"KRN","B",8994,8994)

"BLD",9012,"QUES",0)
^9.62^^
"BLD",9012,"REQB",0)
^9.611^4^3
"BLD",9012,"REQB",2,0)
OR*3.0*384^2
"BLD",9012,"REQB",3,0)
OR*3.0*361^2
"BLD",9012,"REQB",4,0)
OR*3.0*315^2
"BLD",9012,"REQB","B","OR*3.0*315",4)

"BLD",9012,"REQB","B","OR*3.0*361",3)

"BLD",9012,"REQB","B","OR*3.0*384",2)

"INIT")
POST^ORY395
"KRN",19,14320,-1)
1^1
"KRN",19,14320,0)
ORE ORDER INSTRUCTIONS CLEANUP
"KRN",19,14321,-1)
1^2
"KRN",19,14321,0)
ORE CAC MGR
"KRN",8989.51,4765,-1)
1^1
"KRN",8989.51,4765,0)
ORE CLEAN UP UTIL LAST RUN DT
"KRN",8989.51,4766,-1)
1^2
"KRN",8989.51,4766,0)
ORE CLEAN UP UTIL START DATE
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
395^3150128
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","ORDSGCHK")
0^2^B110004235^B102045357
"RTN","ORDSGCHK",1,0)
ORDSGCHK ; SLC/AGP - PRE 0.5 DOSE ORDER CHECKS;04/03/13  09:01 ;10/02/14  08:06
"RTN","ORDSGCHK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**280,352,345,311,384,395**;Dec 17, 1997;Build 11
"RTN","ORDSGCHK",3,0)
 ;
"RTN","ORDSGCHK",4,0)
EN(ORY,DFN,TYPE,OIL) ;
"RTN","ORDSGCHK",5,0)
 N ARRAY,CNT,NAME
"RTN","ORDSGCHK",6,0)
 ;if renewed order build OIL array
"RTN","ORDSGCHK",7,0)
 I $G(ORREN)=1,+$G(ORIFN)>0 D
"RTN","ORDSGCHK",8,0)
 .;IV orders should only have a null type
"RTN","ORDSGCHK",9,0)
 .I TYPE="" S TYPE="PSIV"
"RTN","ORDSGCHK",10,0)
 .D BLDREN(TYPE,ORIFN,.OIL)
"RTN","ORDSGCHK",11,0)
 ;Build easy array to work with
"RTN","ORDSGCHK",12,0)
 S CNT=0 F  S CNT=$O(OIL(CNT)) Q:CNT'>0  D
"RTN","ORDSGCHK",13,0)
 .S NODE=$G(OIL(CNT)) Q:$P(NODE,U,2)="PSIV"
"RTN","ORDSGCHK",14,0)
 .S NAME=$P(NODE,U,2)
"RTN","ORDSGCHK",15,0)
 .Q:'$P(NODE,U,3)
"RTN","ORDSGCHK",16,0)
 .S ARRAY(NAME,$P(NODE,U,3))=NODE
"RTN","ORDSGCHK",17,0)
 I TYPE="PSH" Q
"RTN","ORDSGCHK",18,0)
 I TYPE="PSIV" D IV(.ORY,DFN,.ARRAY)
"RTN","ORDSGCHK",19,0)
 I TYPE'="PSIV" D NONIV(.ORY,DFN,.ARRAY)
"RTN","ORDSGCHK",20,0)
 Q
"RTN","ORDSGCHK",21,0)
 ;
"RTN","ORDSGCHK",22,0)
BLDREN(TYPE,ORIFN,OUT) ;
"RTN","ORDSGCHK",23,0)
 N CNT,EXTVALUE,ISOI,ITEM,LOC,NAME,NUM,NODE,ORDIALOG,TEXT,VALUE,X0,ORDSGSET
"RTN","ORDSGCHK",24,0)
 S ORDSGSET=0
"RTN","ORDSGCHK",25,0)
 S CNT=$O(OUT(""),-1)
"RTN","ORDSGCHK",26,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","ORDSGCHK",27,0)
 S ORDIALOG=+$P(X0,U,5)
"RTN","ORDSGCHK",28,0)
 D GETDLG^ORCD(ORDIALOG)
"RTN","ORDSGCHK",29,0)
 D GETORDER^ORCD(+ORIFN)
"RTN","ORDSGCHK",30,0)
 S LOC=0 F  S LOC=$O(ORDIALOG(LOC)) Q:LOC'>0  D
"RTN","ORDSGCHK",31,0)
 .S ITEM=$P($G(ORDIALOG(LOC)),U,2)
"RTN","ORDSGCHK",32,0)
 .I ITEM="" Q
"RTN","ORDSGCHK",33,0)
 .I ITEM="COMMENT" Q
"RTN","ORDSGCHK",34,0)
 .S ISOI=$S($G(ORDIALOG(LOC,0))[101.43:1,1:0)
"RTN","ORDSGCHK",35,0)
 .S NUM=0 F  S NUM=$O(ORDIALOG(LOC,NUM)) Q:NUM'>0  D
"RTN","ORDSGCHK",36,0)
 ..I NUM<1 Q
"RTN","ORDSGCHK",37,0)
 ..S VALUE=$G(ORDIALOG(LOC,NUM)),EXTVALUE=""
"RTN","ORDSGCHK",38,0)
 ..I ISOI=1 D
"RTN","ORDSGCHK",39,0)
 ...S EXTVALUE=$P($G(^ORD(101.43,VALUE,0)),U)
"RTN","ORDSGCHK",40,0)
 ...I $P($G(^ORD(101.41,LOC,0)),U)="OR GTX ADDITIVE" S ITEM="ADDITIVE"
"RTN","ORDSGCHK",41,0)
 ..I ITEM="RATE" S EXTVALUE=VALUE
"RTN","ORDSGCHK",42,0)
 ..I ITEM="DOSE" S ORDSGSET=1
"RTN","ORDSGCHK",43,0)
 ..S TEXT=TYPE_U_ITEM_U_NUM_U_VALUE_U_EXTVALUE
"RTN","ORDSGCHK",44,0)
 ..S CNT=CNT+1,OUT(CNT)=TEXT
"RTN","ORDSGCHK",45,0)
 ;SET THE DOSE AS BLANK IN THE OUTPUT ARRAY IF IT WASN'T SET ALREADY
"RTN","ORDSGCHK",46,0)
 I 'ORDSGSET S CNT=CNT+1,OUT(CNT)=TYPE_U_"DOSE^1^^"
"RTN","ORDSGCHK",47,0)
 Q
"RTN","ORDSGCHK",48,0)
 ;
"RTN","ORDSGCHK",49,0)
DURATION(STR) ;
"RTN","ORDSGCHK",50,0)
 N LEN,VAL,UNIT,IVLMT,TVAL
"RTN","ORDSGCHK",51,0)
 S (UNIT,IVLMT)="",VAL=0
"RTN","ORDSGCHK",52,0)
 I $E($$LOW^XLFSTR(STR))="f" D
"RTN","ORDSGCHK",53,0)
 . I STR["for a total of" D  Q
"RTN","ORDSGCHK",54,0)
 . .S VAL=$P(STR," ",5)
"RTN","ORDSGCHK",55,0)
 . .S UNIT=$P(STR," ",6)
"RTN","ORDSGCHK",56,0)
 . .S STR=""
"RTN","ORDSGCHK",57,0)
 . S VAL=$P(STR," ",2)
"RTN","ORDSGCHK",58,0)
 . S UNIT=$E($P(STR," ",3))
"RTN","ORDSGCHK",59,0)
 . S STR=""
"RTN","ORDSGCHK",60,0)
 I $E($$LOW^XLFSTR(STR))="w" D
"RTN","ORDSGCHK",61,0)
 . S TVAL=$P(STR," ",4)
"RTN","ORDSGCHK",62,0)
 . S VAL=+TVAL
"RTN","ORDSGCHK",63,0)
 . S LEN=$F(TVAL,VAL)
"RTN","ORDSGCHK",64,0)
 . I $P(VAL,".")="" S VAL=0_VAL
"RTN","ORDSGCHK",65,0)
 . F  S UNIT=$E(TVAL,LEN) Q:((UNIT'=0)&(UNIT'="."))  D
"RTN","ORDSGCHK",66,0)
 . . S LEN=LEN+1
"RTN","ORDSGCHK",67,0)
 . S STR=""
"RTN","ORDSGCHK",68,0)
 I $L(UNIT),$L(VAL) S IVLMT=VAL_$$UP^XLFSTR(UNIT)
"RTN","ORDSGCHK",69,0)
 I STR'="",IVLMT="" D
"RTN","ORDSGCHK",70,0)
 .I STR["ML" S IVLMT=$P(STR,"M")_"M" Q
"RTN","ORDSGCHK",71,0)
 .I STR["CC" S IVLMT=$P(STR,"C")_"M" Q
"RTN","ORDSGCHK",72,0)
 .S IVLMT=STR
"RTN","ORDSGCHK",73,0)
 Q IVLMT
"RTN","ORDSGCHK",74,0)
 ;
"RTN","ORDSGCHK",75,0)
IV(ORY,DFN,ARRAY) ;
"RTN","ORDSGCHK",76,0)
 N CNT,DRUG,DRUGIEN,DRUGNAME,NAME,NUM,OI,ORBASE,ORPSJARR,STR,STRENGTH
"RTN","ORDSGCHK",77,0)
 ;
"RTN","ORDSGCHK",78,0)
 I '$D(ARRAY) D  Q
"RTN","ORDSGCHK",79,0)
 . S ORY=$G(ORY)+1,ORY(ORY)="ERR^Incomplete data.  Dosage check could not be performed."
"RTN","ORDSGCHK",80,0)
 ;populate single values from order
"RTN","ORDSGCHK",81,0)
 S ORPSJARR("TVOL_DUR")="",ORPSJARR("SCHEDULE")=""
"RTN","ORDSGCHK",82,0)
 I $D(ARRAY("DAYS")) S ORPSJARR("TVOL_DUR")=$$DURATION($P(ARRAY("DAYS",1),U,4))
"RTN","ORDSGCHK",83,0)
 ;S RATE=$P(ARRAY(NAME,1),U,4)
"RTN","ORDSGCHK",84,0)
 S ORPSJARR("MR_IEN")=$P(ARRAY("ROUTE",1),U,4)
"RTN","ORDSGCHK",85,0)
 I $D(ARRAY("SCHEDULE")) S ORPSJARR("SCHEDULE")=$P(ARRAY("SCHEDULE",1),U,4)
"RTN","ORDSGCHK",86,0)
 S ORPSJARR("IV_TYPE")=$S($P(ARRAY("TYPE",1),U,4)="I":1,1:2)
"RTN","ORDSGCHK",87,0)
 I ORPSJARR("IV_TYPE")=2 S ORPSJARR("INF_RATE")=$P(ARRAY("RATE",1),U,5)
"RTN","ORDSGCHK",88,0)
 ;
"RTN","ORDSGCHK",89,0)
 ;build additive first, Drug, Strength/unit, bag
"RTN","ORDSGCHK",90,0)
 F NAME="ADDITIVE","ORDERABLE" D
"RTN","ORDSGCHK",91,0)
 .K DRUG
"RTN","ORDSGCHK",92,0)
 .S CNT=0,NUM=0
"RTN","ORDSGCHK",93,0)
 .F  S NUM=$O(ARRAY(NAME,NUM)) Q:NUM'>0  D
"RTN","ORDSGCHK",94,0)
 ..S CNT=CNT+1
"RTN","ORDSGCHK",95,0)
 ..S NODE=$G(ARRAY(NAME,NUM)),OI=$P(NODE,U,4)
"RTN","ORDSGCHK",96,0)
 ..;
"RTN","ORDSGCHK",97,0)
 ..S DRUGIEN=+$P(^ORD(101.43,OI,0),U,2) I DRUGIEN="" Q  ;PHARMACY OI FROM 101.43
"RTN","ORDSGCHK",98,0)
 ..S DRUGNAME=$P($G(ARRAY(NAME,NUM)),U,5) ;OI NAME
"RTN","ORDSGCHK",99,0)
 ..;
"RTN","ORDSGCHK",100,0)
 ..I NAME="ADDITIVE" D  Q
"RTN","ORDSGCHK",101,0)
 ...S STRENGTH=$P($G(ARRAY("STRENGTH",NUM)),U,4)_" "_$P($G(ARRAY("UNITS",NUM)),U,4)
"RTN","ORDSGCHK",102,0)
 ...S STR=+DRUGIEN_U_DRUGNAME_U_STRENGTH_U_$P($G(ARRAY("ADDFREQ",NUM)),U,4)
"RTN","ORDSGCHK",103,0)
 ...S ORPSJARR("AD",CNT)=STR_U_0
"RTN","ORDSGCHK",104,0)
 ...;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",105,0)
 ...I $G(^TMP($J,"ORENHCHK"))=1 S ORPSJARR("AD",CNT)=STR_U_1
"RTN","ORDSGCHK",106,0)
 ..;
"RTN","ORDSGCHK",107,0)
 ..;Solution information
"RTN","ORDSGCHK",108,0)
 ..S STR=+DRUGIEN_U_DRUGNAME_U_$P($G(ARRAY("VOLUME",NUM)),U,4)_" ML"
"RTN","ORDSGCHK",109,0)
 ..S ORPSJARR("SOL",CNT)=STR,$P(ORPSJARR("SOL",CNT),U,5)=0
"RTN","ORDSGCHK",110,0)
 ..;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",111,0)
 ..I $G(^TMP($J,"ORENHCHK"))=1 S ORPSJARR("SOL",CNT)=STR,$P(ORPSJARR("SOL",CNT),U,5)=1
"RTN","ORDSGCHK",112,0)
 ;
"RTN","ORDSGCHK",113,0)
 I $D(^TMP($J,"ORDSGCHK_CACHE")) M ^TMP($J,"ORDSGCHK2")=^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORDSGCHK",114,0)
 I '$D(^TMP($J,"ORDSGCHK_CACHE")) D
"RTN","ORDSGCHK",115,0)
 .S ORBASE(1)="ORDSGCHK1"
"RTN","ORDSGCHK",116,0)
 .S ORBASE(2)="ORDSGCHK2"
"RTN","ORDSGCHK",117,0)
 .D DOSE^PSJAPIDS(.ORBASE,DFN,.ORPSJARR)
"RTN","ORDSGCHK",118,0)
 .M ^TMP($J,"ORDSGCHK_CACHE")=^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",119,0)
 D PARSEOUT
"RTN","ORDSGCHK",120,0)
 K ^TMP($J,"ORDSGCHK1"),^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",121,0)
 Q
"RTN","ORDSGCHK",122,0)
 ;
"RTN","ORDSGCHK",123,0)
NONIV(ORY,DFN,ARRAY) ;
"RTN","ORDSGCHK",124,0)
 N CNT,DOSESTR,DRUG,DRUGARR,DRUGIEN,DRUGNAME,DUR,NAME,NODE
"RTN","ORDSGCHK",125,0)
 N OIIEN,ORBASE,ORDRUG,ORPSARR,PACK,PSNODE,SUB,TYPE,USAGE
"RTN","ORDSGCHK",126,0)
 ;
"RTN","ORDSGCHK",127,0)
 ;assume same drug type used throughout the order dialog
"RTN","ORDSGCHK",128,0)
 ;free text dose do not have a drug.
"RTN","ORDSGCHK",129,0)
 S DRUGIEN=$P($G(ARRAY("DRUG",1)),U,4)
"RTN","ORDSGCHK",130,0)
 I +DRUGIEN>0,$$EXMT^PSSDSAPI(DRUGIEN)=1 Q
"RTN","ORDSGCHK",131,0)
 ;if no ARRAY(DOSE) node set it to null to force free text evaluation
"RTN","ORDSGCHK",132,0)
 ;I '$D(ARRAY("DOSE")),$D(ARRAY("INSTR")) N I S I=0 F  S I=$O(ARRAY("INSTR",I)) Q:'I  S ARRAY("DOSE",I)=$P(ARRAY("INSTR",I),U)_"^DOSE^"_I_"^"
"RTN","ORDSGCHK",133,0)
 N I S I=0 F  S I=$O(ARRAY("INSTR",I)) Q:'I  I '$D(ARRAY("DOSE",I))  S ARRAY("DOSE",I)=$P(ARRAY("INSTR",I),U)_"^DOSE^"_I_"^"
"RTN","ORDSGCHK",134,0)
 ;
"RTN","ORDSGCHK",135,0)
 S NAME="" F  S NAME=$O(ARRAY(NAME)) Q:NAME=""  D
"RTN","ORDSGCHK",136,0)
 .S SUB=$$GETSUB(NAME) I SUB="" Q
"RTN","ORDSGCHK",137,0)
 .S CNT=0 F  S CNT=$O(ARRAY(NAME,CNT)) Q:CNT'>0  D
"RTN","ORDSGCHK",138,0)
 ..S NODE=$G(ARRAY(NAME,CNT))
"RTN","ORDSGCHK",139,0)
 ..;
"RTN","ORDSGCHK",140,0)
 ..;get dose information and drug information from Dose Prompt
"RTN","ORDSGCHK",141,0)
 ..I SUB="DOSE" D
"RTN","ORDSGCHK",142,0)
 ...S PACK=$P(NODE,U)
"RTN","ORDSGCHK",143,0)
 ...S TYPE=$S($P(NODE,U)="PSO":"O",1:"I")
"RTN","ORDSGCHK",144,0)
 ...S DOSESTR=$P(NODE,U,4)
"RTN","ORDSGCHK",145,0)
 ...;free text dose
"RTN","ORDSGCHK",146,0)
 ...I DOSESTR="" D
"RTN","ORDSGCHK",147,0)
 ....N ORTDOSE,ORTDNAME
"RTN","ORDSGCHK",148,0)
 ....S ARRAY("ORPSA",CNT)=$$OI2DD^ORKPS($P(ARRAY("ORDERABLE",1),U,4),$E($P(ARRAY("ORDERABLE",1),U,1),3),2)
"RTN","ORDSGCHK",149,0)
 ....Q:'$P(ARRAY("ORPSA",CNT),";",1)
"RTN","ORDSGCHK",150,0)
 ....K ^TMP($J,"DRUGARR") D ZERO^PSS50($P(ARRAY("ORPSA",CNT),";",1),,,,,"DRUGARR")
"RTN","ORDSGCHK",151,0)
 ....N ORDRGNM S ORDRGNM=$G(^TMP($J,"DRUGARR",$P(ARRAY("ORPSA",CNT),";",1),.01))
"RTN","ORDSGCHK",152,0)
 ....S OIIEN=$P($G(ARRAY("ORDERABLE",1)),U,4) ;orderable only exists for first item (in complex order)
"RTN","ORDSGCHK",153,0)
 ....S ORDRUG("OI")=+$P($G(^ORD(101.43,OIIEN,0)),U,2)
"RTN","ORDSGCHK",154,0)
 ....S ORDRUG("PACKAGE")=$S(PACK="PSO":"O",PACK="PSH":"X",1:"I")
"RTN","ORDSGCHK",155,0)
 ....S PSNODE=$G(^ORD(101.43,OIIEN,"PS")),USAGE=""
"RTN","ORDSGCHK",156,0)
 ....I $P(PSNODE,U,4)=1 S USAGE=USAGE_"A"
"RTN","ORDSGCHK",157,0)
 ....I $P(PSNODE,U,3)=1 S USAGE=USAGE_"B"
"RTN","ORDSGCHK",158,0)
 ....S ORDRUG("OI_USAGE")=USAGE
"RTN","ORDSGCHK",159,0)
 ....S ORPSARR(CNT,"DO")=$$TRIM^ORBCMA32($P($P($G(ARRAY("INSTR",CNT)),U,4),ORDRGNM))
"RTN","ORDSGCHK",160,0)
 ....S ORDRUG(CNT,"DRUG_NM")=$$TRIM^ORBCMA32($P($G(ARRAY("ORDERABLE",1)),U,5))
"RTN","ORDSGCHK",161,0)
 ....S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",162,0)
 ...;
"RTN","ORDSGCHK",163,0)
 ...;check if enhanced order checks were done for this drug order and if so set ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",164,0)
 ...I $G(^TMP($J,"ORENHCHK"))=1,((DOSESTR=""&$D(ORDRUG))!(DOSESTR'="")) S ORDRUG(CNT,"ENH")=1
"RTN","ORDSGCHK",165,0)
 ...Q:DOSESTR=""
"RTN","ORDSGCHK",166,0)
 ...S DRUGIEN=$P(DOSESTR,"&",6)
"RTN","ORDSGCHK",167,0)
 ...K ^TMP($J,"DRUGARR")
"RTN","ORDSGCHK",168,0)
 ...D ZERO^PSS50(DRUGIEN,,,,,"DRUGARR")
"RTN","ORDSGCHK",169,0)
 ...S DRUGNAME=$G(^TMP($J,"DRUGARR",DRUGIEN,.01))
"RTN","ORDSGCHK",170,0)
 ...K ^TMP($J,"DRUGARR")
"RTN","ORDSGCHK",171,0)
 ...;
"RTN","ORDSGCHK",172,0)
 ...;Local Possible Dose
"RTN","ORDSGCHK",173,0)
 ...I $P(DOSESTR,"&")="" D  Q
"RTN","ORDSGCHK",174,0)
 ....S ORPSARR(CNT,"DO")=$P($G(ARRAY("INSTR",CNT)),U,4)
"RTN","ORDSGCHK",175,0)
 ....S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",176,0)
 ....S ORDRUG(CNT,"DRUG_IEN")=DRUGIEN
"RTN","ORDSGCHK",177,0)
 ....S ORDRUG(CNT,"DRUG_NM")=$$GETPSNM^ORKPS(DRUGIEN) ;DRUGNAME
"RTN","ORDSGCHK",178,0)
 ...;
"RTN","ORDSGCHK",179,0)
 ...;Possible Dose
"RTN","ORDSGCHK",180,0)
 ...S ORPSARR(CNT,"DRG_AMT")=$P(DOSESTR,"&")
"RTN","ORDSGCHK",181,0)
 ...S ORPSARR(CNT,"DRG_UNIT")=$P(DOSESTR,"&",2)
"RTN","ORDSGCHK",182,0)
 ...S ORDRUG(CNT,"RX_NUM")=TYPE_";1;PROSPECTIVE;"_CNT
"RTN","ORDSGCHK",183,0)
 ...S ORDRUG(CNT,"DRUG_IEN")=DRUGIEN
"RTN","ORDSGCHK",184,0)
 ...S ORDRUG(CNT,"DRUG_NM")=$$GETPSNM^ORKPS(DRUGIEN) ;DRUGNAME
"RTN","ORDSGCHK",185,0)
 ..;
"RTN","ORDSGCHK",186,0)
 ..;Additional Order Data
"RTN","ORDSGCHK",187,0)
 ..I SUB="DRATE" D  Q
"RTN","ORDSGCHK",188,0)
 ...S DUR=$P($P(NODE,U,4)," ")
"RTN","ORDSGCHK",189,0)
 ...S ORPSARR(CNT,SUB)=DUR_$$DRATESTR($P($P(NODE,U,4)," ",2))
"RTN","ORDSGCHK",190,0)
 ..S ORPSARR(CNT,SUB)=$P(NODE,U,4)
"RTN","ORDSGCHK",191,0)
 ;
"RTN","ORDSGCHK",192,0)
 ;Get rid of any preceeding or trailing spaces on the dose
"RTN","ORDSGCHK",193,0)
 N ORSPI S ORSPI=0 F  S ORSPI=$O(ORPSARR(ORSPI)) Q:'ORSPI  D
"RTN","ORDSGCHK",194,0)
 .I $D(ORPSARR(ORSPI,"DO")) S ORPSARR(ORSPI,"DO")=$$TRIM^XLFSTR(ORPSARR(ORSPI,"DO"))
"RTN","ORDSGCHK",195,0)
 ;
"RTN","ORDSGCHK",196,0)
 I $D(ORDRUG) D
"RTN","ORDSGCHK",197,0)
 .S ORBASE(1)="ORDSGCHK1",ORBASE(2)="ORDSGCHK2"
"RTN","ORDSGCHK",198,0)
 .D DOSE^PSSDSAPD(.ORBASE,DFN,.ORPSARR,.ORDRUG),PARSEOUT
"RTN","ORDSGCHK",199,0)
 .K ^TMP($J,"ORDSGCHK1"),^TMP($J,"ORDSGCHK2")
"RTN","ORDSGCHK",200,0)
 Q
"RTN","ORDSGCHK",201,0)
 ;
"RTN","ORDSGCHK",202,0)
PARSEOUT ;PARSE OUTPUT GLOBAL
"RTN","ORDSGCHK",203,0)
 N ORNBP S ORNBP=""
"RTN","ORDSGCHK",204,0)
 I $D(^TMP($J,"ORDSGCHK2")) D
"RTN","ORDSGCHK",205,0)
 .I $P($G(^TMP($J,"ORDSGCHK2","OUT",0)),U)=-1 S ORNBP=$$DSDWNMSG^ORDSGCHK Q
"RTN","ORDSGCHK",206,0)
 .I $D(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR")) D
"RTN","ORDSGCHK",207,0)
 ..N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",208,0)
 ...N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",209,0)
 .... I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"MSG"))) S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"MSG") D
"RTN","ORDSGCHK",210,0)
 ..... I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"TEXT"))) S ORY(ORY)=ORY(ORY)_".  "_$G(^TMP($J,"ORDSGCHK2","OUT","DOSE","ERROR",I,J,"TEXT"))
"RTN","ORDSGCHK",211,0)
 .I $D(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE")) D
"RTN","ORDSGCHK",212,0)
 ..N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",213,0)
 ...N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",214,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["could not be performed" S ORNBP=^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",215,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["Error Summary" S ORNBP=^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",216,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["Reason(s):" S ORNBP=ORNBP_"."_^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J) Q
"RTN","ORDSGCHK",217,0)
 .... I $G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))["           " S ORNBP=ORNBP_"."_$P(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J),"           ",2) Q
"RTN","ORDSGCHK",218,0)
 .... I $L(ORNBP)>1 S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_ORNBP,ORNBP=""
"RTN","ORDSGCHK",219,0)
 .... I $L($G(^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J))) S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_^TMP($J,"ORDSGCHK2","OUT","EXCEPTIONS","DOSE",I,J)
"RTN","ORDSGCHK",220,0)
 .N I S I="" F  S I=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I)) Q:'$L(I)  D
"RTN","ORDSGCHK",221,0)
 ..Q:(I="ERROR")
"RTN","ORDSGCHK",222,0)
 ..N J S J="" F  S J=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J)) Q:'$L(J)  D
"RTN","ORDSGCHK",223,0)
 ...N TYP S TYP="" F  S TYP=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP)) Q:'$L(TYP)  D
"RTN","ORDSGCHK",224,0)
 ....N ORDIEN S ORDIEN=0 F  S ORDIEN=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN)) Q:'ORDIEN  D
"RTN","ORDSGCHK",225,0)
 .....I $L($G(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN))) D
"RTN","ORDSGCHK",226,0)
 ......N OROCTYPE S OROCTYPE="DS"
"RTN","ORDSGCHK",227,0)
 ......I TYP="3_GENERAL" S OROCTYPE="ERR" N ORDIEN2 S ORDIEN2=0 F  S ORDIEN2=$O(^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN,ORDIEN2)) Q:'ORDIEN2  D
"RTN","ORDSGCHK",228,0)
 .......S ORY=$G(ORY)+1,ORY(ORY)=OROCTYPE_U_^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN,ORDIEN2)
"RTN","ORDSGCHK",229,0)
 ......Q:OROCTYPE="ERR"
"RTN","ORDSGCHK",230,0)
 ......S ORY=$G(ORY)+1,ORY(ORY)=OROCTYPE_U_^TMP($J,"ORDSGCHK2","OUT","DOSE",I,J,TYP,"MESSAGE",ORDIEN)
"RTN","ORDSGCHK",231,0)
 I $L(ORNBP)>1 S ORY=$G(ORY)+1,ORY(ORY)="ERR^"_ORNBP,ORNBP=""
"RTN","ORDSGCHK",232,0)
 Q
"RTN","ORDSGCHK",233,0)
 ;
"RTN","ORDSGCHK",234,0)
GETSUB(NAME) ;
"RTN","ORDSGCHK",235,0)
 I NAME="CONJ" Q "CONJ"
"RTN","ORDSGCHK",236,0)
 I NAME="DAYS" Q "DRATE"
"RTN","ORDSGCHK",237,0)
 I NAME="DOSE" Q "DOSE"
"RTN","ORDSGCHK",238,0)
 I NAME="ROUTE" Q "MR_IEN"
"RTN","ORDSGCHK",239,0)
 I NAME="SCHEDULE" Q "SCHEDULE"
"RTN","ORDSGCHK",240,0)
 Q ""
"RTN","ORDSGCHK",241,0)
 ;
"RTN","ORDSGCHK",242,0)
DRATESTR(ORIN) ;change the form of the DURATION
"RTN","ORDSGCHK",243,0)
 ;DAYS=D,WEEKS=W,MONTHS=L,HOURS=H,MINUTES=M
"RTN","ORDSGCHK",244,0)
 I $$UP^XLFSTR(ORIN)="MONTHS" Q "L"
"RTN","ORDSGCHK",245,0)
 Q $E($$UP^XLFSTR(ORIN))
"RTN","ORDSGCHK",246,0)
 ;
"RTN","ORDSGCHK",247,0)
DSDWNMSG() ;dosage down message (not displayed to user)
"RTN","ORDSGCHK",248,0)
 Q "Drug Dosage checks were not able to be performed."
"RTN","ORDV04")
0^3^B62541465^B78115705
"RTN","ORDV04",1,0)
ORDV04 ; SLC/DAN - OE/RR Components ;10/02/14  08:08
"RTN","ORDV04",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,148,160,208,195,241,215,274,256,243,306,361,395**;Dec 17,1997;Build 11
"RTN","ORDV04",3,0)
 ;
"RTN","ORDV04",4,0)
 ; ^TMP("GMPLHS",$J) DBIA 1183
"RTN","ORDV04",5,0)
 ; ^UTILITY & ^TMP("GMRVD") DBIA 10061
"RTN","ORDV04",6,0)
 ;
"RTN","ORDV04",7,0)
ORC(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; Current Orders
"RTN","ORDV04",8,0)
 N ORCNT,ORJ,ORSITE,SITE,ORX0,ORLIST,GO
"RTN","ORDV04",9,0)
 Q:'$L(OREXT)
"RTN","ORDV04",10,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",11,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",12,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",13,0)
 K ^TMP("ORR",$J),^TMP("ORDATA",$J)
"RTN","ORDV04",14,0)
 D @GO
"RTN","ORDV04",15,0)
 I '$D(^TMP("ORR",$J)) Q
"RTN","ORDV04",16,0)
 S ORCNT=0,ORJ=0
"RTN","ORDV04",17,0)
 F  S ORJ=$O(^TMP("ORR",$J,ORLIST,ORJ)) Q:'+ORJ!(ORCNT'<ORMAX)  S ORX0=^(ORJ) D
"RTN","ORDV04",18,0)
 . S ORCNT=ORCNT+1,SITE=$S($L($G(^TMP("ORR",$J,ORLIST,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",19,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",20,0)
 . D SPMRG^ORDVU("^TMP(""ORR"","_$J_","""_ORLIST_""","_ORJ_",""TX"")","^TMP(""ORDATA"","_$J_","""_ORLIST_""","_ORJ_",""WP"",2)",2) ;order text
"RTN","ORDV04",21,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",3)="3^"_$P(ORX0,"^",6) ; status
"RTN","ORDV04",22,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",4)="4^"_$$DATE^ORDVU($P(ORX0,"^",4)) ;start date
"RTN","ORDV04",23,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",5)="5^"_$$DATE^ORDVU($P(ORX0,"^",5)) ;stop date
"RTN","ORDV04",24,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",7)="7^"_$P(^TMP("ORR",$J,ORLIST,ORJ),U) ;Order Number
"RTN","ORDV04",25,0)
 . I $O(^TMP("ORR",$J,ORLIST,ORJ,"TX",1)) S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",6)="6^[+]" ;flag for details
"RTN","ORDV04",26,0)
 K ^TMP("ORR",$J)
"RTN","ORDV04",27,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",28,0)
 Q
"RTN","ORDV04",29,0)
ORCVA ; Current Orders
"RTN","ORDV04",30,0)
 N ORVP
"RTN","ORDV04",31,0)
 S ORVP=DFN_";DPT("
"RTN","ORDV04",32,0)
 I '$D(^OR(100,"AC",ORVP)) Q
"RTN","ORDV04",33,0)
 D EN^ORQ1(ORVP,,2,,ORDBEG,ORDEND,1) ; current orders. ORLIST is set in ORQ1
"RTN","ORDV04",34,0)
 Q
"RTN","ORDV04",35,0)
PLAILALL(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; API - ALL problems
"RTN","ORDV04",36,0)
 N GO
"RTN","ORDV04",37,0)
 Q:'$L(OREXT)
"RTN","ORDV04",38,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",39,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",40,0)
 D PLAIL
"RTN","ORDV04",41,0)
 Q
"RTN","ORDV04",42,0)
PLALL ; All Problems
"RTN","ORDV04",43,0)
 D GETLIST^GMPLHS(DFN,"ALL")
"RTN","ORDV04",44,0)
 Q
"RTN","ORDV04",45,0)
PLAILI(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; API - INACTIVE problems
"RTN","ORDV04",46,0)
 N GO
"RTN","ORDV04",47,0)
 Q:'$L(OREXT)
"RTN","ORDV04",48,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",49,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",50,0)
 D PLAIL
"RTN","ORDV04",51,0)
 Q
"RTN","ORDV04",52,0)
PLI ; Inactive Problems
"RTN","ORDV04",53,0)
 D GETLIST^GMPLHS(DFN,"I")
"RTN","ORDV04",54,0)
 Q
"RTN","ORDV04",55,0)
PLAILA(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; API - ACTIVE problems
"RTN","ORDV04",56,0)
 N GO
"RTN","ORDV04",57,0)
 Q:'$L(OREXT)
"RTN","ORDV04",58,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",59,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",60,0)
 D PLAIL
"RTN","ORDV04",61,0)
 Q
"RTN","ORDV04",62,0)
PLA ; Active Problems
"RTN","ORDV04",63,0)
 D GETLIST^GMPLHS(DFN,"A")
"RTN","ORDV04",64,0)
 Q
"RTN","ORDV04",65,0)
PLAIL ; problems(active, inactive or all)
"RTN","ORDV04",66,0)
 ;Ext call: GMPLHS
"RTN","ORDV04",67,0)
 ; input:
"RTN","ORDV04",68,0)
 ;   STATUS = "A"   => active
"RTN","ORDV04",69,0)
 ;   STATUS = "I"   => inactive
"RTN","ORDV04",70,0)
 ;   STATUS = "ALL" => all
"RTN","ORDV04",71,0)
 ;
"RTN","ORDV04",72,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",73,0)
 . S ORDBEG=0,ORDEND=9999999,ORMAX=99999
"RTN","ORDV04",74,0)
 . D GCPR^OMGCOAS1(DFN,"PLL",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",75,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",76,0)
 N ORPROBNO,ORLOC,I,ORSITE
"RTN","ORDV04",77,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",78,0)
 K ^TMP("ORDATA",$J),^TMP("GMPLHS",$J)  ;DBIA #1183
"RTN","ORDV04",79,0)
 D @GO
"RTN","ORDV04",80,0)
 I '$D(^TMP("GMPLHS",$J)) Q
"RTN","ORDV04",81,0)
 S ORPROBNO=0
"RTN","ORDV04",82,0)
 F I=1:1 S ORPROBNO=$O(^TMP("GMPLHS",$J,ORPROBNO)) Q:'ORPROBNO  D
"RTN","ORDV04",83,0)
 . N ORXREC0,SITE,ICD,SCTC,VHATC,PROVNARR,ORMORE,K,ORCSYS,ORICDLBL
"RTN","ORDV04",84,0)
 . S ORXREC0=$G(^TMP("GMPLHS",$J,ORPROBNO,0)),ORMORE=0
"RTN","ORDV04",85,0)
 . S SITE=$S($L($G(^TMP("GMPLHS",$J,ORPROBNO,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",86,0)
 . S ICD=$P(ORXREC0,U,17),SCTC=$P(ORXREC0,U,15),VHATC=$P(ORXREC0,U,19)
"RTN","ORDV04",87,0)
 . S ORCSYS=$P(ORXREC0,U,22),ORICDLBL=$S(ORCSYS="10D":"ICD-10-CM",1:"ICD-9-CM")
"RTN","ORDV04",88,0)
 . S PROVNARR=$P($G(^TMP("GMPLHS",$J,ORPROBNO,"N"))," (")
"RTN","ORDV04",89,0)
 . S PROVNARR=PROVNARR_$S($L($G(ICD))&('$L($G(SCTC))&'$L($G(VHATC))):" ("_$G(ORICDLBL)_" "_$G(ICD)_")",$L($G(SCTC))&($L($G(ICD))):" (SCT "_$G(SCTC)_")"_" ("_$G(ORICDLBL)_" "_$G(ICD)_")",$L($G(VHATC)):" (VHAT "_$G(VHATC)_")",1:"")
"RTN","ORDV04",90,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",91,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",2)="2^"_$P(ORXREC0,U,5) ;status
"RTN","ORDV04",92,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",3)="3^"_PROVNARR ;provider narrative
"RTN","ORDV04",93,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",4)="4^"_$$DATE^ORDVU($P(ORXREC0,U,6)) ;onset date
"RTN","ORDV04",94,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",5)="5^"_$$DATE^ORDVU($P(ORXREC0,U,2)) ;last modified date
"RTN","ORDV04",95,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",6)="6^"_$P(ORXREC0,U,7) ;provider
"RTN","ORDV04",96,0)
 . S ORLOC=0,K=0
"RTN","ORDV04",97,0)
 . F  S ORLOC=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC)) Q:'ORLOC  D
"RTN","ORDV04",98,0)
 .. N X S X=0
"RTN","ORDV04",99,0)
 .. F  S X=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X)) Q:'X  D
"RTN","ORDV04",100,0)
 ... S K=K+1,ORMORE=1
"RTN","ORDV04",101,0)
 ... S ^TMP("ORDATA",$J,ORPROBNO,"WP",7,K)="7^"_$P($G(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X,0)),U) ;note narrative
"RTN","ORDV04",102,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",8)="8^"_$P(ORXREC0,U,14) ;exposures
"RTN","ORDV04",103,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORPROBNO,"WP",9)="9^[+]" ;flag for details
"RTN","ORDV04",104,0)
 K ^TMP("GMPLHS",$J)
"RTN","ORDV04",105,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",106,0)
 Q
"RTN","ORDV04",107,0)
SR(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Surgery Report
"RTN","ORDV04",108,0)
 N ORCNT
"RTN","ORDV04",109,0)
 S ORCNT=0
"RTN","ORDV04",110,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",111,0)
 D ENSR^ORDV04A
"RTN","ORDV04",112,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",113,0)
 Q
"RTN","ORDV04",114,0)
VS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; get vital Signs
"RTN","ORDV04",115,0)
 D VS^ORDV04A
"RTN","ORDV04",116,0)
 Q
"RTN","ORDV04",117,0)
TIUPRG(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  progress notes
"RTN","ORDV04",118,0)
 ;Ext calls: TIUSRVLO, TIUSRVR1, VASITE
"RTN","ORDV04",119,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",120,0)
 . D GCPR^OMGCOAS1(DFN,"PN",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",121,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",122,0)
 N ORDT,DATE,ORCI,ORGLOB,ORGLOBA,ORTEMP,ORSITE,SITE,I,ORNODE,GO,ORIMAG
"RTN","ORDV04",123,0)
 Q:'$L(OREXT)
"RTN","ORDV04",124,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",125,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",126,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",127,0)
 D @GO
"RTN","ORDV04",128,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",129,0)
 S ORNODE=0,ORCI=0
"RTN","ORDV04",130,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",131,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORCI'<ORMAX)  D
"RTN","ORDV04",132,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",133,0)
 . S ORIMAG=$P($$RESOLVE^TIUSRVLO($P(ORTEMP,U)),U,10)
"RTN","ORDV04",134,0)
 . S DATE=$P(ORTEMP,U,3)       ;date
"RTN","ORDV04",135,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",136,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",137,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$P(ORTEMP,U) ;TIU ien
"RTN","ORDV04",138,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATE^ORDVU(DATE) ;date
"RTN","ORDV04",139,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$P(ORTEMP,U,2) ;type
"RTN","ORDV04",140,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$P($P(ORTEMP,U,5),";",2) ;author
"RTN","ORDV04",141,0)
 . S ORCI=ORCI+1
"RTN","ORDV04",142,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call back to get note text
"RTN","ORDV04",143,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",6)),6) ;Notes Text
"RTN","ORDV04",144,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",7)="7^[+]"
"RTN","ORDV04",145,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^"_ORIMAG
"RTN","ORDV04",146,0)
 . K @ORGLOBA
"RTN","ORDV04",147,0)
 K @ORGLOB
"RTN","ORDV04",148,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",149,0)
 Q
"RTN","ORDV04",150,0)
TPRG ; Progress Notes
"RTN","ORDV04",151,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,3,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",152,0)
 Q
"RTN","ORDV04",153,0)
TIUDCS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  Discharge Summaries
"RTN","ORDV04",154,0)
 ;Ext calls: VASITE, DIQ1, TIUSRVLO
"RTN","ORDV04",155,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",156,0)
 . D GCPR^OMGCOAS1(DFN,"DS",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",157,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",158,0)
 N ORGLOB,ORGLOBA,ORI,ORNODE,ORICDIEN,ORARRAY,ORTEMP,ORSITE,SITE,DIC,DR,DIQ,DA,GO
"RTN","ORDV04",159,0)
 Q:'$L(OREXT)
"RTN","ORDV04",160,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",161,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",162,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",163,0)
 D @GO
"RTN","ORDV04",164,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",165,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",166,0)
 S ORNODE=0,ORI=0
"RTN","ORDV04",167,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORI'<ORMAX)  D
"RTN","ORDV04",168,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",169,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",170,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",171,0)
 . K ORARRAY S DIC=8925,DA=$P(ORTEMP,U),DR=".05;.07;.08;1202;1502",DIQ="ORARRAY"
"RTN","ORDV04",172,0)
 . D EN^DIQ1
"RTN","ORDV04",173,0)
 . S DIQ="ORARRAY(8925,"_DA_")"
"RTN","ORDV04",174,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$$DATEMMM^ORDVU($G(@DIQ@(.07))) ;episode begin date/time
"RTN","ORDV04",175,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATEMMM^ORDVU($G(@DIQ@(.08))) ;episode end date/time
"RTN","ORDV04",176,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$G(@DIQ@(1202)) ;author/dicator
"RTN","ORDV04",177,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$G(@DIQ@(1502)) ;signed by
"RTN","ORDV04",178,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",6)="6^"_$G(@DIQ@(.05)) ;status
"RTN","ORDV04",179,0)
 . S ORI=ORI+1
"RTN","ORDV04",180,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call to get summary text
"RTN","ORDV04",181,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",7)),7) ;summary Text
"RTN","ORDV04",182,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^[+]" ;detail flag
"RTN","ORDV04",183,0)
 . K @ORGLOBA
"RTN","ORDV04",184,0)
 K @ORGLOB
"RTN","ORDV04",185,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",186,0)
 Q
"RTN","ORDV04",187,0)
TDCS ; Discharge Summary
"RTN","ORDV04",188,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,244,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",189,0)
 Q
"RTN","ORMBLDPS")
0^9^B94048957^B86692352
"RTN","ORMBLDPS",1,0)
ORMBLDPS ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;10/02/14  08:07
"RTN","ORMBLDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,38,54,86,97,94,116,129,141,190,195,237,254,243,293,280,266,395**;Dec 17, 1997;Build 11
"RTN","ORMBLDPS",3,0)
 ;
"RTN","ORMBLDPS",4,0)
 ;
"RTN","ORMBLDPS",5,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDPS",6,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDPS",7,0)
 ;
"RTN","ORMBLDPS",8,0)
NVA ; -- new Non-VA Meds order
"RTN","ORMBLDPS",9,0)
 N NVA S NVA=1
"RTN","ORMBLDPS",10,0)
OUT ; -- new Outpt Meds order [same as UD, +3 fields]
"RTN","ORMBLDPS",11,0)
UD ; -- new Inpt (Unit Dose) Meds order
"RTN","ORMBLDPS",12,0)
 N ADMIN,OI,DRUG,INSTR,DOSE,ROUTE,SCHED,DUR,URG,PROVCOMM,PI,DISPENSE,X,Y,I,J,K,L,QT1,QT2,QT3,QT4,QT6,QT9,CONJ,ORC,SC,OUTPT,OITXT,OITXT2
"RTN","ORMBLDPS",13,0)
 N QT7,SCHTYPE
"RTN","ORMBLDPS",14,0)
 S OUTPT=$S($P(OR0,U,12)="O":1,1:0) ;outpt flag
"RTN","ORMBLDPS",15,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",16,0)
 S OI=$$PTR("ORDERABLE ITEM"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMBLDPS",17,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE"),ADMIN=$$PTR("ADMIN TIMES")
"RTN","ORMBLDPS",18,0)
 S SCHTYPE=$$PTR("SCHEDULE TYPE")
"RTN","ORMBLDPS",19,0)
 S DUR=$$PTR("DURATION"),URG=$$PTR("URGENCY"),DOSE=$$PTR("DOSE")
"RTN","ORMBLDPS",20,0)
 S ROUTE=$$PTR("ROUTE"),PROVCOMM=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDPS",21,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMBLDPS",22,0)
 S J=1,ORC(J)=$P(ORMSG(4),"|",1,7)_"|"
"RTN","ORMBLDPS",23,0)
 I +$G(NVA)=1 G NVA1
"RTN","ORMBLDPS",24,0)
UD1 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D
"RTN","ORMBLDPS",25,0)
 . S X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",26,0)
 . ;S QT1=$S($L(X):$P(X,"&",1,4)_"&"_$P(X,"&",6),1:"")
"RTN","ORMBLDPS",27,0)
 . S QT2=$$ESC($G(ORDIALOG(SCHED,I)))_$S(OUTPT:"",1:"&"_$G(ORDIALOG(ADMIN,I)))
"RTN","ORMBLDPS",28,0)
 . S QT3=$$HL7DUR
"RTN","ORMBLDPS",29,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",30,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",31,0)
 . S QT7=$G(ORDIALOG(SCHTYPE,I))
"RTN","ORMBLDPS",32,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",33,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_U_QT7_U_$$INSTR_U_QT9
"RTN","ORMBLDPS",34,0)
 ;
"RTN","ORMBLDPS",35,0)
NVA1 I +$G(NVA)=1 D
"RTN","ORMBLDPS",36,0)
 . S I=1 ;only one dosage possible for non-va meds
"RTN","ORMBLDPS",37,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",38,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",39,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",40,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",41,0)
 . S J=J+1,ORC(J)=QT1_U_$$ESC(QT2)_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",42,0)
 ;
"RTN","ORMBLDPS",43,0)
 I $L($P(OR0,U,8)) S $P(ORC(2),U,4)=$$FMTHL7^XLFDT($P(OR0,U,8)) S:J<2 J=2
"RTN","ORMBLDPS",44,0)
 S J=J+1,ORC(J)="|"_$P(ORMSG(4),"|",9,999),ORC=J,X="ORMSG(4)",ORMSG(4)="",I=0
"RTN","ORMBLDPS",45,0)
 F J=1:1:ORC S Y=ORC(J) D  ;add to ORMSG(4)
"RTN","ORMBLDPS",46,0)
 . I $L(@X)+$L(Y)'>245 S @X=@X_Y
"RTN","ORMBLDPS",47,0)
 . E  S L=245-$L(@X),@X=@X_$E(Y,1,L),I=I+1,X="ORMSG(4,"_I_")",@X=$E(Y,L+1,$L(Y))
"RTN","ORMBLDPS",48,0)
 I $G(ORDIALOG(DRUG,1)) S X=$$ENDCM^PSJORUTL(ORDIALOG(DRUG,1)),DISPENSE=$P(X,U,3)_"^^99NDF^"_ORDIALOG(DRUG,1)_"^^99PSD"
"RTN","ORMBLDPS",49,0)
 S OITXT=$$USID^ORMBLD($G(ORDIALOG(OI,1)))
"RTN","ORMBLDPS",50,0)
 S OITXT2=$P(OITXT,U,1,4)_U_$$ESC($P(OITXT,U,5))_U_$P(OITXT,U,6,99)
"RTN","ORMBLDPS",51,0)
 S ORMSG(5)="RXO|"_OITXT2_"|||||||||"_$G(DISPENSE)
"RTN","ORMBLDPS",52,0)
UD2 I $G(OUTPT) D
"RTN","ORMBLDPS",53,0)
 . N QTY,REFS,DSPY
"RTN","ORMBLDPS",54,0)
 . S QTY=$$PTR("QUANTITY"),REFS=$$PTR("REFILLS"),DSPY=$$PTR("DAYS SUPPLY")
"RTN","ORMBLDPS",55,0)
 . S ORMSG(5)=ORMSG(5)_"|"_$G(ORDIALOG(QTY,1))_"||"_$G(ORDIALOG(REFS,1))_"||||D"_$G(ORDIALOG(DSPY,1))
"RTN","ORMBLDPS",56,0)
 S I=5 I $L($G(ORDIALOG(PROVCOMM,1))) D
"RTN","ORMBLDPS",57,0)
 . S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,0)) Q:'J
"RTN","ORMBLDPS",58,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$$ESC($G(^TMP("ORWORD",$J,PROVCOMM,1,J,0)))
"RTN","ORMBLDPS",59,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=$G(^(J,0))
"RTN","ORMBLDPS",60,0)
 I $G(OUTPT),$L($G(ORDIALOG(PI,1))) D
"RTN","ORMBLDPS",61,0)
 . S J=$O(^TMP("ORWORD",$J,PI,1,0)) Q:'J
"RTN","ORMBLDPS",62,0)
 . S I=I+1,ORMSG(I)="NTE|7|P|"_$G(^TMP("ORWORD",$J,PI,1,J,0))
"RTN","ORMBLDPS",63,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PI,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=$G(^(J,0))
"RTN","ORMBLDPS",64,0)
UD3 S J=0 F  S J=$O(ORDIALOG(ROUTE,J)) Q:J'>0  S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,J)))
"RTN","ORMBLDPS",65,0)
 D ORDCHKS
"RTN","ORMBLDPS",66,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN,OUTPT)
"RTN","ORMBLDPS",67,0)
 I $G(OUTPT) D  ;add SC data
"RTN","ORMBLDPS",68,0)
 . N OR5 S OR5=$G(^OR(100,IFN,5))
"RTN","ORMBLDPS",69,0)
 . I $L(OR5),OR5'?5"^" S I=I+1,ORMSG(I)="ZSC|"_$TR(OR5,"^","|") Q
"RTN","ORMBLDPS",70,0)
 . S SC=$$PTR("SERVICE CONNECTED") S:$D(ORDIALOG(SC,1)) I=I+1,ORMSG(I)="ZSC|"_$S(ORDIALOG(SC,1):"SC",1:"NSC")
"RTN","ORMBLDPS",71,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",72,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",73,0)
 I $P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORMBLDPS",74,0)
 . S I=I+1 D ZRN(IFN,.ORMSG,I)
"RTN","ORMBLDPS",75,0)
 Q
"RTN","ORMBLDPS",76,0)
 ;
"RTN","ORMBLDPS",77,0)
INSTR() ; -- Return text instructions for QT-8, instance I
"RTN","ORMBLDPS",78,0)
 N Y,OROI S Y=$P($G(ORDIALOG(DOSE,I)),"&",5)
"RTN","ORMBLDPS",79,0)
 I $G(ORDIALOG(DRUG,1)),$L(Y) Q $$ESC(Y)
"RTN","ORMBLDPS",80,0)
 S Y=$G(ORDIALOG(INSTR,I))
"RTN","ORMBLDPS",81,0)
 S OROI=$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1))
"RTN","ORMBLDPS",82,0)
 S Y=$$RMVDRGNM(Y,OROI,OUTPT)
"RTN","ORMBLDPS",83,0)
 I $G(OUTPT) D
"RTN","ORMBLDPS",84,0)
 . N UNITS,UNT S UNITS=$$PTR("FREE TEXT"),UNT=$G(ORDIALOG(UNITS,I))
"RTN","ORMBLDPS",85,0)
 . S:$L(UNT) Y=Y_" "_UNT ;old format
"RTN","ORMBLDPS",86,0)
 Q $$ESC(Y)
"RTN","ORMBLDPS",87,0)
 ;
"RTN","ORMBLDPS",88,0)
RMVDRGNM(ORIG,OROI,OROUTPT) ;remove the drug name from the dosage string
"RTN","ORMBLDPS",89,0)
 N OROUT,ORTYPE,ORDD,ORDGNAME
"RTN","ORMBLDPS",90,0)
 S OROUT=ORIG
"RTN","ORMBLDPS",91,0)
 S ORTYPE="I"
"RTN","ORMBLDPS",92,0)
 I OROUTPT S ORTYPE="O"
"RTN","ORMBLDPS",93,0)
 S ORDD=+$$OI2DD^ORKPS(OROI,ORTYPE,0)
"RTN","ORMBLDPS",94,0)
 I 'ORDD Q ORIG
"RTN","ORMBLDPS",95,0)
 S ORDGNAME=$$GETPSNM^ORKPS(ORDD)
"RTN","ORMBLDPS",96,0)
 S ORIG=$$TRIM^ORBCMA32($P(ORIG,ORDGNAME))
"RTN","ORMBLDPS",97,0)
 Q ORIG
"RTN","ORMBLDPS",98,0)
 ;
"RTN","ORMBLDPS",99,0)
HL7DUR() ; -- Returns HL7 form of duration X
"RTN","ORMBLDPS",100,0)
 N X,X1,X2,Y S X=$G(ORDIALOG(DUR,I))
"RTN","ORMBLDPS",101,0)
 S X1=+$G(X),Y="" G:X1'>0 HDQ
"RTN","ORMBLDPS",102,0)
 S X2=$$UP^XLFSTR($P(X,X1,2)) S:$E(X2)=" " X2=$E(X2,2,99)
"RTN","ORMBLDPS",103,0)
 S Y=$S($E(X2,1,2)="MO":"L",'$L(X2):"D",1:$E(X2))_X1
"RTN","ORMBLDPS",104,0)
HDQ Q Y
"RTN","ORMBLDPS",105,0)
 ;
"RTN","ORMBLDPS",106,0)
IV ; -- new IV Meds order
"RTN","ORMBLDPS",107,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,WP,QT,I,X1,X2,INST
"RTN","ORMBLDPS",108,0)
 N IVLIMIT ; duratioin or total volume for IV order
"RTN","ORMBLDPS",109,0)
 N IVTYPE,IVZRX,X,CNT,ROUTE,ORBCMA,DFN,ADDFREQ
"RTN","ORMBLDPS",110,0)
 S IVLIMIT=$$PTR("DURATION")
"RTN","ORMBLDPS",111,0)
 S IVTYPE=$G(ORDIALOG(+$$PTR("IV TYPE"),1))
"RTN","ORMBLDPS",112,0)
 I IVTYPE="",$P($G(^OR(100,IFN,3)),U,11)="B" D
"RTN","ORMBLDPS",113,0)
 .S IVTYPE=$$MOB^ORMBLDP1(IFN,+$P($G(^OR(100,IFN,0)),U,2))
"RTN","ORMBLDPS",114,0)
 .D RESP^ORCSAVE2(IFN,"OR GTX IV TYPE",IVTYPE)
"RTN","ORMBLDPS",115,0)
 S RATE=$$PTR("INFUSION RATE"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMBLDPS",116,0)
 S ADDFREQ=$$PTR("ADDITIVE FREQUENCY")
"RTN","ORMBLDPS",117,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMBLDPS",118,0)
 S WP=$$PTR("WORD PROCESSING 1"),VOL=$$PTR("VOLUME")
"RTN","ORMBLDPS",119,0)
 S SCHTYPE=$$PTR("SCHEDULE TYPE")
"RTN","ORMBLDPS",120,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDPS",121,0)
 ;I IVTYPE="",$G(ORDIALOG(+$$PTR("SCHEDULE"),1))="" S IVTYPE="C"
"RTN","ORMBLDPS",122,0)
 I IVTYPE="I" S QT=U_$$ESC($G(ORDIALOG(+$$PTR("SCHEDULE"),1)))_"&"_$G(ORDIALOG(+$$PTR("ADMIN TIMES"),1))_"^^^^"
"RTN","ORMBLDPS",123,0)
 I IVTYPE="C" S QT="^^^^^"
"RTN","ORMBLDPS",124,0)
 ;S QT=U_$G(ORDIALOG(+$$PTR("SCHEDULE"),1))_"^^^^"
"RTN","ORMBLDPS",125,0)
 S:URG QT=QT_$P($G(^ORD(101.42,URG,0)),U,2)
"RTN","ORMBLDPS",126,0)
 S $P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDPS",127,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",128,0)
 S RATE=$G(ORDIALOG(RATE,1)) S:$E(RATE,$L(RATE))=" " RATE=$E(RATE,1,($L(RATE)-1)) S ORMSG(5)="RXO|^^^PS-1^IV^99OTH|"_$$ESC(RATE) ;strip any trailing spaces
"RTN","ORMBLDPS",129,0)
 S IVLIMIT=$G(ORDIALOG(IVLIMIT,1))
"RTN","ORMBLDPS",130,0)
 I $L(IVLIMIT) S IVLIMIT=$$HL7IVLMT^ORMBLDP1(IVLIMIT),ORMSG(5)="RXO|^^"_IVLIMIT_"^PS-1^IV^99OTH|"_RATE
"RTN","ORMBLDPS",131,0)
 S I=5 I $L($G(ORDIALOG(WP,1))) D
"RTN","ORMBLDPS",132,0)
 . N J,K S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J
"RTN","ORMBLDPS",133,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$$ESC($G(^TMP("ORWORD",$J,WP,1,J,0)))
"RTN","ORMBLDPS",134,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=^(J,0)
"RTN","ORMBLDPS",135,0)
 ;S I=I+1,ORMSG(I)=$$RXR(+$$PTR("ROUTE"))
"RTN","ORMBLDPS",136,0)
 S ROUTE=+$$PTR("ROUTE")
"RTN","ORMBLDPS",137,0)
 S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,1)))
"RTN","ORMBLDPS",138,0)
IV1 S INST=0 F  S INST=$O(ORDIALOG(SOLN,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",139,0)
 . S X1="B",X2=+$G(ORDIALOG(SOLN,INST))
"RTN","ORMBLDPS",140,0)
 . I $P($G(^ORD(101.43,X2,"PS")),U,4) S X1=X1_"A" ;pre-mix
"RTN","ORMBLDPS",141,0)
 . S I=I+1,ORMSG(I)="RXC|"_X1_"|"_$$USID^ORMBLD(X2)_"|"_$G(ORDIALOG(VOL,INST))_"|"_$$HL7UNIT("ML")
"RTN","ORMBLDPS",142,0)
 I $O(ORDIALOG(ADDS,0)) D
"RTN","ORMBLDPS",143,0)
 . S INST=0 F  S INST=$O(ORDIALOG(ADDS,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",144,0)
 . . S X1=$G(ORDIALOG(ADDS,INST)),X2=$G(ORDIALOG(UNITS,INST))
"RTN","ORMBLDPS",145,0)
 . . S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)_"|"_$$ADDFRQCV^ORMBLDP1($G(ORDIALOG(ADDFREQ,INST)),"O")
"RTN","ORMBLDPS",146,0)
 . . ;S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)
"RTN","ORMBLDPS",147,0)
 D ORDCHKS
"RTN","ORMBLDPS",148,0)
 S IVZRX=$$ZRX(IFN,0)
"RTN","ORMBLDPS",149,0)
 S CNT=0
"RTN","ORMBLDPS",150,0)
 F X=1:1:$L(IVZRX) I $E(IVZRX,X)="|" S CNT=CNT+1
"RTN","ORMBLDPS",151,0)
 I CNT<6 F X=CNT:1:5 S IVZRX=IVZRX_"|"
"RTN","ORMBLDPS",152,0)
 S I=I+1,ORMSG(I)=IVZRX_IVTYPE
"RTN","ORMBLDPS",153,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",154,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",155,0)
 Q
"RTN","ORMBLDPS",156,0)
 ;
"RTN","ORMBLDPS",157,0)
RXR(ROUTE) ; -- Returns RXR segment
"RTN","ORMBLDPS",158,0)
 N IEN,NAME
"RTN","ORMBLDPS",159,0)
 I +ROUTE=0 Q "RXR|^^^^^99PSR"
"RTN","ORMBLDPS",160,0)
 K ^TMP($J,"ORMBLDPS RXR")
"RTN","ORMBLDPS",161,0)
 D ALL^PSS51P2(+ROUTE,,,,"ORMBLDPS RXR")
"RTN","ORMBLDPS",162,0)
 S NAME=^TMP($J,"ORMBLDPS RXR",+ROUTE,.01)
"RTN","ORMBLDPS",163,0)
 ;N NAME S NAME=$$GET1^DIQ(51.2,+ROUTE_",",.01)
"RTN","ORMBLDPS",164,0)
 K ^TMP($J,"ORMBLDPS RXR")
"RTN","ORMBLDPS",165,0)
 Q "RXR|^^^"_+ROUTE_U_NAME_"^99PSR"
"RTN","ORMBLDPS",166,0)
 ;
"RTN","ORMBLDPS",167,0)
ZRX(IFN,OUTPT) ; -- Returns ZRX segment
"RTN","ORMBLDPS",168,0)
 N NATURE,TYPE,ORIG,PSORIG,ROUTING,ZRX
"RTN","ORMBLDPS",169,0)
 S TYPE=$P($G(^OR(100,IFN,3)),U,11),NATURE=$P($G(^(8,1,0)),U,12)
"RTN","ORMBLDPS",170,0)
 S:NATURE NATURE=$P($G(^ORD(100.02,+NATURE,0)),U,2) ;code
"RTN","ORMBLDPS",171,0)
 S PSORIG="" I (TYPE=1)!(TYPE=2) D
"RTN","ORMBLDPS",172,0)
 . S ORIG=$P($G(^OR(100,IFN,3)),U,5),PSORIG=$G(^OR(100,+ORIG,4))
"RTN","ORMBLDPS",173,0)
 . I PSORIG'>0 S PSORIG="",TYPE=0 ;edit of unreleased order
"RTN","ORMBLDPS",174,0)
 S ZRX="ZRX|"_PSORIG_"|"_NATURE_"|"_$S(TYPE=1:"E",TYPE=2:"R",1:"N")
"RTN","ORMBLDPS",175,0)
 S ROUTING=$G(ORDIALOG($$PTR("ROUTING"),1))
"RTN","ORMBLDPS",176,0)
 ;AGP FIX FOR PROBLEM WITH ROUTING BE SET TO DAY SUPPLY ONCE ROOT CAUSE
"RTN","ORMBLDPS",177,0)
 ;IS FOUND THIS CODE WILL BE REMOVE
"RTN","ORMBLDPS",178,0)
 I OUTPT=1,ROUTING'="",ROUTING>0 S ROUTING="M"
"RTN","ORMBLDPS",179,0)
 I $G(OUTPT) S ZRX=ZRX_"|"_ROUTING_$S($L($P($G(^OR(100,ORIFN,8,1,2)),"^",3)):"|||1",1:"")
"RTN","ORMBLDPS",180,0)
 Q ZRX
"RTN","ORMBLDPS",181,0)
 ;
"RTN","ORMBLDPS",182,0)
ZRN(IFN,ORMSG,I) ; -- Set ZRN segment
"RTN","ORMBLDPS",183,0)
 N ST,ZRN,J,K,TXT
"RTN","ORMBLDPS",184,0)
 S ORMSG(I)="ZRN|N|"
"RTN","ORMBLDPS",185,0)
 S ST=$$PTR("STATEMENTS")
"RTN","ORMBLDPS",186,0)
 I $L($G(ORDIALOG(ST,1))) D
"RTN","ORMBLDPS",187,0)
 . S J=$O(^TMP("ORWORD",$J,ST,1,0)) Q:'J
"RTN","ORMBLDPS",188,0)
 . S K=0,TXT=$G(^TMP("ORWORD",$J,ST,1,J,0))
"RTN","ORMBLDPS",189,0)
 . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",190,0)
 . F  S J=$O(^TMP("ORWORD",$J,ST,1,J)) Q:J'>0  S TXT=$G(^(J,0)) D
"RTN","ORMBLDPS",191,0)
 . . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",192,0)
 Q
"RTN","ORMBLDPS",193,0)
 ;
"RTN","ORMBLDPS",194,0)
ORDCHKS ; -- Include order checks in OBX segments
"RTN","ORMBLDPS",195,0)
 N ORRET,OC,CNT S CNT=0
"RTN","ORMBLDPS",196,0)
 D GETOC5^OROCAPI1(+IFN,"SIGNATURE_CPRS",.ORRET)
"RTN","ORMBLDPS",197,0)
 S OC=0 F  S OC=$O(ORRET(+IFN,"DATA",OC)) Q:'OC  D
"RTN","ORMBLDPS",198,0)
 .S I=I+1,CNT=CNT+1
"RTN","ORMBLDPS",199,0)
 .S ORMSG(I)="OBX|"_CNT_"|TX|^^^"_+ORRET(+IFN,"DATA",OC,1)_"^^99OCX||"_$$ESC($G(ORRET(+IFN,"DATA",OC,"OC",1,0)))
"RTN","ORMBLDPS",200,0)
 .I '$L($G(ORRET(+IFN,"DATA",OC,"OC",2,0))) S ORMSG(I)=ORMSG(I)_"|||||||||"_$$FMTHL7^XLFDT($P(ORRET(+IFN,"DATA",OC,1),U,5))_"||"_$P(ORRET(+IFN,"DATA",OC,1),U,5)
"RTN","ORMBLDPS",201,0)
 .I $L($G(ORRET(+IFN,"DATA",OC,"OC",2,0))) D
"RTN","ORMBLDPS",202,0)
 ..N J S J=1 F  S J=$O(ORRET(+IFN,"DATA",OC,"OC",J)) Q:'J  S ORMSG(I,J-1)=$G(ORRET(+IFN,"DATA",OC,"OC",J,0))
"RTN","ORMBLDPS",203,0)
 ..S ORMSG(I,$O(ORMSG(I,""),-1))=ORMSG(I,$O(ORMSG(I,""),-1))_"|||||||||"_$$FMTHL7^XLFDT($P(ORRET(+IFN,"DATA",OC,1),U,5))_"||"_$P(ORRET(+IFN,"DATA",OC,1),U,5)
"RTN","ORMBLDPS",204,0)
 .I $L($G(ORRET(+IFN,"DATA",OC,"OR",1,0))) S I=I+1,ORMSG(I)="NTE|"_OC_"|P|"_$$ESC($G(ORRET(+IFN,"DATA",OC,"OR",1,0)))
"RTN","ORMBLDPS",205,0)
 Q
"RTN","ORMBLDPS",206,0)
 ;
"RTN","ORMBLDPS",207,0)
HL7UNIT(X) ; -- Return coded element for volume/strength units
"RTN","ORMBLDPS",208,0)
 N I,UNIT,Y
"RTN","ORMBLDPS",209,0)
 F I=1:1:$L(X) I $E(X,I)?1A Q  ; first letter
"RTN","ORMBLDPS",210,0)
 S UNIT=$$UP^XLFSTR($E(X,I,$L(X))),Y=""
"RTN","ORMBLDPS",211,0)
 F I=1:1:14 S X=$P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",I) I UNIT=X S Y="^^^PSIV-"_I_U_UNIT_"^99OTH" Q
"RTN","ORMBLDPS",212,0)
 Q Y
"RTN","ORMBLDPS",213,0)
 ;
"RTN","ORMBLDPS",214,0)
VER(IFN) ; -- Send msg for nurse-verified orders
"RTN","ORMBLDPS",215,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0))
"RTN","ORMBLDPS",216,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",217,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDPS",218,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",219,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",220,0)
 Q
"RTN","ORMBLDPS",221,0)
 ;
"RTN","ORMBLDPS",222,0)
REF(IFN,ROUTING,CLINIC) ; -- Send msg for refill request
"RTN","ORMBLDPS",223,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="O"
"RTN","ORMBLDPS",224,0)
 S:'$G(CLINIC) CLINIC=$S($G(ORL):+ORL,1:+$P(OR0,U,10))
"RTN","ORMBLDPS",225,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",226,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),"O",CLINIC)
"RTN","ORMBLDPS",227,0)
 S ORMSG(4)="ORC|ZF|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS|||||||"_DUZ_"||"_$G(ORNP)_"|||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",228,0)
 S ORMSG(5)="ZRX||||"_ROUTING
"RTN","ORMBLDPS",229,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",230,0)
 Q
"RTN","ORMBLDPS",231,0)
ESC(STR) ;
"RTN","ORMBLDPS",232,0)
 Q $$ESC^ORHLESC(STR,"~|\&^")
"RTN","ORUQO")
0^5^B18883882^B15426804
"RTN","ORUQO",1,0)
ORUQO ;SLC/JLC - SEARCH QOS FOR  ;01/02/15  17:39
"RTN","ORUQO",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**315,395**;Dec 17,1997;Build 11
"RTN","ORUQO",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORUQO",4,0)
 ;
"RTN","ORUQO",5,0)
 ; Reference to PXRMD(801.41 is supported by IA #4097
"RTN","ORUQO",6,0)
 ; Reference to DIC(9.4 is supported by IA #2058
"RTN","ORUQO",7,0)
 Q
"RTN","ORUQO",8,0)
 ;
"RTN","ORUQO",9,0)
EN(PKG,OINU,OINA) ; check for quick orders
"RTN","ORUQO",10,0)
 N CREAT,EXPR,OROIP,ORDUO,S1,S2,A,B,%,ORDG,DIEN,AFIND,TEXT,TYPE,I,ORPKG
"RTN","ORUQO",11,0)
 D NOW^%DTC S CREAT=$E(%,1,7),EXPR=$$FMADD^XLFDT(CREAT,30,0,0,0) K ^XTMP("ORUQO",$J),^TMP($J)
"RTN","ORUQO",12,0)
 S OROI=$P(PKG,";"),ORPKG=$P(PKG,";",2)
"RTN","ORUQO",13,0)
 K ORDG
"RTN","ORUQO",14,0)
 I ORPKG="LR" F I="LAB","MI","BB","HEMA","CH","CY","EM" S ORDG=$O(^ORD(100.98,"B",I,"")) I ORDG]"" S ORDG(ORDG)=""
"RTN","ORUQO",15,0)
 I ORPKG="PS" F I="C RX","CI RX","I RX","IV RX","NV RX","O RX","SPLY","UD RX","RX","TPN" S ORDG=$O(^ORD(100.98,"B",I,"")) I ORDG]"" S ORDG(ORDG)=""
"RTN","ORUQO",16,0)
 F TYPE="G","E" D
"RTN","ORUQO",17,0)
 . S DIEN="" F  S DIEN=$O(^PXRMD(801.41,"TYPE",TYPE,DIEN)) Q:DIEN'>0  D
"RTN","ORUQO",18,0)
 .. S TEXT=$P($G(^PXRMD(801.41,DIEN,1)),"^",5)
"RTN","ORUQO",19,0)
 .. I TEXT[101.41 S ^TMP($J,$P(TEXT,";"))=""
"RTN","ORUQO",20,0)
 .. S AFIND="" F  S AFIND=$O(^PXRMD(801.41,DIEN,3,"B",AFIND)) Q:AFIND=""  D
"RTN","ORUQO",21,0)
 ... I AFIND'[101.41 Q
"RTN","ORUQO",22,0)
 ... S ^TMP($J,$P(AFIND,";"))=""
"RTN","ORUQO",23,0)
 S OROIP=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",""))
"RTN","ORUQO",24,0)
 S ORD=0
"RTN","ORUQO",25,0)
 F  S ORD=$O(^ORD(101.41,ORD)) Q:'ORD  S A=$G(^(ORD,0)) I $P(A,"^",4)="Q" S B=$P(A,"^",5) I B]"" D
"RTN","ORUQO",26,0)
 . I '$D(ORDG(B)) Q
"RTN","ORUQO",27,0)
 . S ORDUO=""
"RTN","ORUQO",28,0)
 . S S1=$O(^ORD(101.41,ORD,6,"D",OROIP,"")) Q:'S1
"RTN","ORUQO",29,0)
 . I $G(^ORD(101.41,ORD,6,S1,1))=OROI S ^XTMP("ORUQO",$J,ORD,S1)=$P(A,"^")_"^"_$P(A,"^",3)
"RTN","ORUQO",30,0)
 I $D(^XTMP("ORUQO",$J)) S ^XTMP("ORUQO",$J,0)=EXPR_"^"_CREAT D SEND
"RTN","ORUQO",31,0)
 Q
"RTN","ORUQO",32,0)
SEND ;Send message
"RTN","ORUQO",33,0)
 K ORMSG,XMY N OCNT,ORD,A,S1,XMDUZ,XMSUB,XMTEXT,H1,H2,H3
"RTN","ORUQO",34,0)
 S XMDUZ="CPRS, SEARCH",XMSUB="QUICK ORDER SEARCH",XMTEXT="ORMSG(",XMY(DUZ)="",XMY("G.OR CACS")=""
"RTN","ORUQO",35,0)
 I ORPKG="LR" S ORMSG(1,0)="  The check of Lab Quick Orders that contain Lab Test",ORMSG(2,0)=" "_OINU_" ("_$G(OINA)_") is complete.",OCNT=1
"RTN","ORUQO",36,0)
 I ORPKG="PS" S ORMSG(1,0)="  The check of Pharmacy Quick Orders that contain Pharmacy",ORMSG(2,0)=" Orderable Item "_OINU_" ("_$G(OINA)_") is complete.",OCNT=1
"RTN","ORUQO",37,0)
 S OCNT=OCNT+2,ORMSG(OCNT,0)=" ",ORMSG(OCNT+1,0)="  Here is the list of all quick orders that should be reviewed by your "
"RTN","ORUQO",38,0)
 S OCNT=OCNT+2,ORMSG(OCNT,0)="Clinical Applications Coordinator or whoever manages CPRS Quick Orders"
"RTN","ORUQO",39,0)
 S OCNT=OCNT+1,ORMSG(OCNT,0)="at your site.",ORMSG(OCNT+1,0)=" "
"RTN","ORUQO",40,0)
 S ORD=0,OCNT=OCNT+2,ORMSG(OCNT,0)="Quick Order Name                       Disable Text     Text or Start Date/Time                 Ancestors/Menus or Reminders"
"RTN","ORUQO",41,0)
 S OCNT=OCNT+1,ORMSG(OCNT,0)="  "
"RTN","ORUQO",42,0)
 F  S ORD=$O(^XTMP("ORUQO",$J,ORD)) Q:ORD=""  S S1=$O(^XTMP("ORUQO",$J,ORD,0)) Q:S1=""  S A=^(S1) D
"RTN","ORUQO",43,0)
 . S OCNT=OCNT+1,ORMSG(OCNT,0)=$E($P(A,"^")_$J(" ",38),1,37)_"  "_$E($P(A,"^",2)_$J(" ",38),1,15)_"  ",(H1,H2,H3)=""
"RTN","ORUQO",44,0)
 . I $D(^TMP($J,ORD)) S H2="Used in Clinical Reminders Dialog"
"RTN","ORUQO",45,0)
 . I $D(^ORD(101.41,"AD",ORD)) S H3="On a menu or in an order set"
"RTN","ORUQO",46,0)
 . S S1=0 F  S S1=$O(^XTMP("ORUQO",$J,ORD,S1)) Q:S1=""  S A=^(S1) D
"RTN","ORUQO",47,0)
 .. S S2=0 F  S S2=$O(^XTMP("ORUQO",$J,ORD,S1,S2)) Q:S2=""  S A=^(S2) I $TR(A," ")]"" D
"RTN","ORUQO",48,0)
 ... I H1 S OCNT=OCNT+1,ORMSG(OCNT,0)=$J(" ",56)
"RTN","ORUQO",49,0)
 ... S ORMSG(OCNT,0)=ORMSG(OCNT,0)_$E($P(A,"^")_$J(" ",39),1,38)_"  ",H1=1
"RTN","ORUQO",50,0)
 ... I H2]"" S ORMSG(OCNT,0)=ORMSG(OCNT,0)_H2 S H2="" Q
"RTN","ORUQO",51,0)
 ... I H3]"" S ORMSG(OCNT,0)=ORMSG(OCNT,0)_H3 S H3=""
"RTN","ORUQO",52,0)
 . I H2]"" S ORMSG(OCNT,0)=ORMSG(OCNT,0)_H2
"RTN","ORUQO",53,0)
 . I H3]"" S:$L(ORMSG(OCNT,0))>97 OCNT=OCNT+1,ORMSG(OCNT,0)=$J(" ",97) S ORMSG(OCNT,0)=ORMSG(OCNT,0)_H3
"RTN","ORUQO",54,0)
 . S OCNT=OCNT+1,ORMSG(OCNT,0)=" "
"RTN","ORUQO",55,0)
 D ^XMD
"RTN","ORUQO",56,0)
 Q
"RTN","ORUQO",57,0)
CHECKLR(OR60,OR60N) ;
"RTN","ORUQO",58,0)
 ;OR60 is the file 60 IEN that needs to be checked
"RTN","ORUQO",59,0)
 N ORPT,OROI
"RTN","ORUQO",60,0)
 S OR60=$G(OR60) Q:OR60=""
"RTN","ORUQO",61,0)
 S ORPT=OR60_";99LRT" I '$D(^ORD(101.43,"ID",ORPT)) Q  ;test is not in a CPRS orderable item
"RTN","ORUQO",62,0)
 S OROI=$O(^ORD(101.43,"ID",ORPT,"")) Q:OROI=""
"RTN","ORUQO",63,0)
 D EN(OROI_";LR",OR60,OR60N) Q
"RTN","ORUQO",64,0)
CHECKPS(OR507,OR507N) ;
"RTN","ORUQO",65,0)
 ;OR507 is the file 50.7 IEN that needs to be checked
"RTN","ORUQO",66,0)
 N ORPT,OROI,ORP
"RTN","ORUQO",67,0)
 S OR507=$G(OR507) Q:OR507=""
"RTN","ORUQO",68,0)
 S ORPT=OR507_";99PSP" I '$D(^ORD(101.43,"ID",ORPT)) Q  ;drug is not in a CPRS orderable item
"RTN","ORUQO",69,0)
 S OROI=$O(^ORD(101.43,"ID",ORPT,"")) Q:OROI=""
"RTN","ORUQO",70,0)
 D EN(OROI_";PS",OR507,OR507N)
"RTN","ORUQO",71,0)
 Q
"RTN","ORUTLA1")
1^6^^n/a
"RTN","ORUTLA2")
1^7^^n/a
"RTN","ORUTLA3")
1^8^^n/a
"RTN","ORWDXC")
0^1^B69940726^B67359281
"RTN","ORWDXC",1,0)
ORWDXC ; SLC/KCM - Utilities for Order Checking ;01/28/15  08:30
"RTN","ORWDXC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,141,221,243,280,346,345,311,395**;Dec 17, 1997;Build 11
"RTN","ORWDXC",3,0)
 ;
"RTN","ORWDXC",4,0)
ON(VAL) ; returns E if order checking enabled, otherwise D
"RTN","ORWDXC",5,0)
 S VAL=$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")
"RTN","ORWDXC",6,0)
 Q
"RTN","ORWDXC",7,0)
FILLID(VAL,DLG) ; Return the FillerID (namespace) for a dialog
"RTN","ORWDXC",8,0)
 N DGRP
"RTN","ORWDXC",9,0)
 S VAL="",DGRP=$P($G(^ORD(101.41,DLG,0)),U,5) Q:'DGRP
"RTN","ORWDXC",10,0)
 S DLG=$$DEFDLG^ORWDXQ(DGRP)
"RTN","ORWDXC",11,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,7),VAL=$$NMSP^ORCD(VAL)
"RTN","ORWDXC",12,0)
 I VAL="PS" D
"RTN","ORWDXC",13,0)
 . N X
"RTN","ORWDXC",14,0)
 . S X=$P($P($G(^ORD(100.98,DGRP,0)),U,3)," ")
"RTN","ORWDXC",15,0)
 . I $L(X) S VAL="PS"_$S(X="UD":"I",1:X)
"RTN","ORWDXC",16,0)
 Q
"RTN","ORWDXC",17,0)
DISPLAY(LST,DFN,FID) ; Return list of Order Checks for a FillerID (namespace)
"RTN","ORWDXC",18,0)
 N I,ORX,ORY
"RTN","ORWDXC",19,0)
 S ORX=1,ORX(1)="|"_FID
"RTN","ORWDXC",20,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"DISPLAY")
"RTN","ORWDXC",21,0)
 S I=0 F  S I=$O(ORY(I)) Q:I'>0  S LST(I)=$P(ORY(I),U,4)
"RTN","ORWDXC",22,0)
 Q
"RTN","ORWDXC",23,0)
ACCEPT(LST,DFN,FID,STRT,ORL,OIL,ORIFN,ORREN)    ; Return list of Order Checks on Accept Order
"RTN","ORWDXC",24,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORWDXC",25,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",26,0)
 ; ORREN - IF ORREN IS SET TO 1 THEN ORIFN IS THE ORDER GETTING RENEWED
"RTN","ORWDXC",27,0)
 K ^TMP($J,"ORENHCHK")
"RTN","ORWDXC",28,0)
 N X,Y,USID,ORCHECK,ORI,ORX,ORY,%DT,ORDODSG
"RTN","ORWDXC",29,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",30,0)
 S ORL=ORL_";SC(",X=STRT,STRT="",ORDODSG=0
"RTN","ORWDXC",31,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",32,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",33,0)
 ; do the SELECT order checks
"RTN","ORWDXC",34,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",35,0)
 . Q:'OIL(ORI)
"RTN","ORWDXC",36,0)
 . S USID=$$USID(OIL(ORI))
"RTN","ORWDXC",37,0)
 . S OIL(ORI,"USID")=USID
"RTN","ORWDXC",38,0)
 . S ORX=ORX+1,ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_USID
"RTN","ORWDXC",39,0)
 . S:$P(OIL(ORI),U,2)="PSIV" $P(ORX(ORX),"|",7)=$P($P(OIL(ORI),U,3),";")
"RTN","ORWDXC",40,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"SELECT",.OIL,.ORDODSG)
"RTN","ORWDXC",41,0)
 I $D(ORY) D RETURN^ORCHECK ; expects ORY, ORCHECK
"RTN","ORWDXC",42,0)
 K ORX,ORY
"RTN","ORWDXC",43,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",44,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",45,0)
 . Q:'OIL(ORI)
"RTN","ORWDXC",46,0)
 . S ORX=ORX+1
"RTN","ORWDXC",47,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_OIL(ORI,"USID")_"|"_STRT
"RTN","ORWDXC",48,0)
 . S:$P(OIL(ORI),U,2)="LR" $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",49,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ACCEPT",.OIL,.ORDODSG)
"RTN","ORWDXC",50,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",51,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",52,0)
 D FDBDOWN^ORCHECK(0)
"RTN","ORWDXC",53,0)
 D OPOS(DFN)
"RTN","ORWDXC",54,0)
 D CHK2LST
"RTN","ORWDXC",55,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"DD"),^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORWDXC",56,0)
 Q
"RTN","ORWDXC",57,0)
DELAY(LST,DFN,FID,STRT,ORL,OIL) ; Return list of Order Checks on Accept Delayed
"RTN","ORWDXC",58,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"DD"),^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORWDXC",59,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",60,0)
 N X,Y,ORCHECK,ORI,ORX,ORY,%DT
"RTN","ORWDXC",61,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",62,0)
 S ORL=ORL_";SC(",X=STRT,STRT=""
"RTN","ORWDXC",63,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",64,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",65,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",66,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",67,0)
 . S ORX=ORX+1
"RTN","ORWDXC",68,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_$$USID(OIL(ORI))_"|"_STRT
"RTN","ORWDXC",69,0)
 . I $P(OIL(ORI),U,2)="LR" S $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",70,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ALL",.OIL)
"RTN","ORWDXC",71,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",72,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",73,0)
 D CHK2LST
"RTN","ORWDXC",74,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"DD"),^TMP($J,"ORDSGCHK_CACHE")
"RTN","ORWDXC",75,0)
 Q
"RTN","ORWDXC",76,0)
SESSION(LST,ORVP,ORLST) ; Return list of Order Checks on Release Order
"RTN","ORWDXC",77,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"DD")
"RTN","ORWDXC",78,0)
 N ORES,ORCHECK
"RTN","ORWDXC",79,0)
 S ORVP=+ORVP_";DPT("
"RTN","ORWDXC",80,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDXC",81,0)
 . I +$P(ORLST(I),";",2)'=1 Q  ; order not new
"RTN","ORWDXC",82,0)
 . I $P(ORLST(I),U,3)="0" Q    ; order not being released
"RTN","ORWDXC",83,0)
 . S ORES($P(ORLST(I),U))=""
"RTN","ORWDXC",84,0)
 D SESSION^ORCHECK
"RTN","ORWDXC",85,0)
 D OPOS(+ORVP)
"RTN","ORWDXC",86,0)
 D CHK2LST
"RTN","ORWDXC",87,0)
 D CHECKIT(.LST)
"RTN","ORWDXC",88,0)
 K ^TMP($J,"OROCOUTO;"),^TMP($J,"OROCOUTI;"),^TMP($J,"DD")
"RTN","ORWDXC",89,0)
 Q
"RTN","ORWDXC",90,0)
SAVECHK(OK,ORVP,RSN,LST)    ; Save order checks for session
"RTN","ORWDXC",91,0)
 N ORCHECK,ORIFN S OK=1
"RTN","ORWDXC",92,0)
 D LST2CHK
"RTN","ORWDXC",93,0)
 I $L(RSN)>0 S ORCHECK("OK")=RSN
"RTN","ORWDXC",94,0)
 S ORIFN=0 F  S ORIFN=$O(ORCHECK(ORIFN)) Q:'ORIFN  D OC^ORCSAVE2
"RTN","ORWDXC",95,0)
 Q
"RTN","ORWDXC",96,0)
DELORD(OK,ORIFN)      ; Delete order
"RTN","ORWDXC",97,0)
 N STS,DIK,DA
"RTN","ORWDXC",98,0)
 S STS=$P(^OR(100,+ORIFN,8,1,0),U,15),OK=0
"RTN","ORWDXC",99,0)
 I (STS=10)!(STS=11) D  Q  ; makes sure it's an unreleased order
"RTN","ORWDXC",100,0)
 . ;*400 - Delete unused replacement order
"RTN","ORWDXC",101,0)
 . N OLDIFN,DA,DIE,DR S OLDIFN=$P(^OR(100,+ORIFN,3),U,5) I $G(OLDIFN) D
"RTN","ORWDXC",102,0)
 . . S DA=+OLDIFN,DIE="^OR(100,",DR="9.1///@"
"RTN","ORWDXC",103,0)
 . . D ^DIE K DA,DIE,DR
"RTN","ORWDXC",104,0)
 . S DA=+ORIFN,DIK="^OR(100," Q:'DA
"RTN","ORWDXC",105,0)
 . D ^DIK
"RTN","ORWDXC",106,0)
 . S OK=1
"RTN","ORWDXC",107,0)
 . D DELETE^OROCAPI1(+ORIFN)
"RTN","ORWDXC",108,0)
 Q
"RTN","ORWDXC",109,0)
USID(ORITMX) ; Return universal svc ID for an orderable item
"RTN","ORWDXC",110,0)
 ; ORITMX = OI^NMSP^PKGINFO
"RTN","ORWDXC",111,0)
 N RSLT,ORDRUG S RSLT=""
"RTN","ORWDXC",112,0)
 I $E($P(ORITMX,U,2),1,2)="PS" D
"RTN","ORWDXC",113,0)
 . I $P(ORITMX,U,2)="PSIV" D
"RTN","ORWDXC",114,0)
 . . N PSOI,TYPE,VOL S VOL=""
"RTN","ORWDXC",115,0)
 . . S PSOI=+$P($G(^ORD(101.43,+ORITMX,0)),U,2)
"RTN","ORWDXC",116,0)
 . . S TYPE=$P($P(ORITMX,U,3),";")
"RTN","ORWDXC",117,0)
 . . I TYPE="B" S VOL=$P($P(ORITMX,U,3),";",2)
"RTN","ORWDXC",118,0)
 . . D ENDDIV^PSJORUTL(PSOI,TYPE,VOL,.ORDRUG)
"RTN","ORWDXC",119,0)
 . . S ORDRUG=+ORDRUG
"RTN","ORWDXC",120,0)
 . E  S ORDRUG=+$P(ORITMX,U,3)
"RTN","ORWDXC",121,0)
 . S RSLT=$$ENDCM^PSJORUTL(ORDRUG)
"RTN","ORWDXC",122,0)
 . S RSLT=$P(RSLT,U,3)_"^^99NDF^"_ORDRUG_U_$$NAME50^ORPEAPI(ORDRUG)_"^99PSD"
"RTN","ORWDXC",123,0)
 E  S RSLT=$$USID^ORMBLD(+ORITMX)
"RTN","ORWDXC",124,0)
 I +$P(RSLT,U)=0,+($P(RSLT,U,4)=0) S RSLT="" ; has to be null (why?)
"RTN","ORWDXC",125,0)
 Q RSLT
"RTN","ORWDXC",126,0)
 ;
"RTN","ORWDXC",127,0)
CHK2LST ; creates list that can be passed to broker from ORCHECK array
"RTN","ORWDXC",128,0)
 ; expects ORCHECK to be present and populates LST
"RTN","ORWDXC",129,0)
 D REMDUPS ;similar to REMDUPS^ORCHECK
"RTN","ORWDXC",130,0)
 N ORIFN,ORID,CDL,I,ILST,LASTIFN,RESERVED,ORCHECK2,ORNUM,OLIST S ILST=0,LASTIFN=0,RESERVED=0,OLIST=0
"RTN","ORWDXC",131,0)
 S ORIFN="" F  S ORIFN=$O(ORCHECK(ORIFN)) Q:ORIFN=""  D
"RTN","ORWDXC",132,0)
 . S CDL=0 F  S CDL=$O(ORCHECK(ORIFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",133,0)
 . . S I=0 F  S I=$O(ORCHECK(ORIFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",134,0)
 . . . S ORCHECK2(ORIFN,CDL,+ORCHECK(ORIFN,CDL,I),I)=ORCHECK(ORIFN,CDL,I)
"RTN","ORWDXC",135,0)
 K ORCHECK
"RTN","ORWDXC",136,0)
 S ORIFN="" F  S ORIFN=$O(ORCHECK2(ORIFN)) Q:ORIFN=""  D
"RTN","ORWDXC",137,0)
 . S CDL=0 F  S CDL=$O(ORCHECK2(ORIFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",138,0)
 . . S ORNUM=0 F  S ORNUM=$O(ORCHECK2(ORIFN,CDL,ORNUM)) Q:'ORNUM  D
"RTN","ORWDXC",139,0)
 . . . S I=0 F  S I=$O(ORCHECK2(ORIFN,CDL,ORNUM,I)) Q:'I  D
"RTN","ORWDXC",140,0)
 . . . . S OLIST=OLIST+1,ORCHECK(ORIFN,CDL,OLIST)=ORCHECK2(ORIFN,CDL,ORNUM,I)
"RTN","ORWDXC",141,0)
 S ORIFN="" F  S ORIFN=$O(ORCHECK(ORIFN)) Q:ORIFN=""  D
"RTN","ORWDXC",142,0)
 . S CDL=0 F  S CDL=$O(ORCHECK(ORIFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",143,0)
 . . S I=0 F  S I=$O(ORCHECK(ORIFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",144,0)
 . . . I LASTIFN'=ORIFN S LASTIFN=ORIFN,RESERVED=ILST+1,ILST=ILST+1 ; saves a spot for the RDI warning at the top of each order's checks
"RTN","ORWDXC",145,0)
 . . . S ORID=ORIFN I +ORID,(+ORID=ORID) S ORID=ORID_";1"
"RTN","ORWDXC",146,0)
 . . . I '$P(ORCHECK(ORIFN,CDL,I),U,2) Q  ; CDL="" means don't show
"RTN","ORWDXC",147,0)
 . . . I $P(ORCHECK(ORIFN,CDL,I),U,1)=99 S LST(RESERVED)=ORID_U_ORCHECK(ORIFN,CDL,I) Q  ;Put RDI warning at the top of each order's checks
"RTN","ORWDXC",148,0)
 . . . S ILST=ILST+1,LST(ILST)=ORID_U_ORCHECK(ORIFN,CDL,I)
"RTN","ORWDXC",149,0)
 Q
"RTN","ORWDXC",150,0)
LST2CHK ; create ORCHECK array from list passed by broker
"RTN","ORWDXC",151,0)
 N ORIFN,CDL,I,ILST S I=0
"RTN","ORWDXC",152,0)
 S ILST="" F  S ILST=$O(LST("ORCHECKS",ILST)) Q:$L(ILST)'>0  D
"RTN","ORWDXC",153,0)
 . I $D(LST("ORCHECKS",ILST,0)) D
"RTN","ORWDXC",154,0)
 . . N J S J=0 S X=LST("ORCHECKS",ILST,J) F  S J=$O(LST("ORCHECKS",ILST,J)) Q:'J  S X=X_LST("ORCHECKS",ILST,J)
"RTN","ORWDXC",155,0)
 . I '$D(LST("ORCHECKS",ILST,0)) S X=LST("ORCHECKS",ILST)
"RTN","ORWDXC",156,0)
 . S ORIFN=$P(X,U),CDL=$P(X,U,3)
"RTN","ORWDXC",157,0)
 . I +$G(ORIFN)>0,+$G(CDL)>0 D  ;cla 12/16/03
"RTN","ORWDXC",158,0)
 . . S I=I+1,ORCHECK(+ORIFN,CDL,I)=$P(X,U,2,4)
"RTN","ORWDXC",159,0)
 Q
"RTN","ORWDXC",160,0)
CHECKIT(X) ;remove uncessesary duplication of Duplicate Therapy checks
"RTN","ORWDXC",161,0)
 N I,J,Y
"RTN","ORWDXC",162,0)
 S I=0 F  S I=$O(X(I)) Q:'I  I $P(X(I),U,2)=17 D
"RTN","ORWDXC",163,0)
 .Q:$P($G(^ORD(100.8,17,0)),U)'="DUPLICATE DRUG THERAPY"
"RTN","ORWDXC",164,0)
 .N STR S STR=$P($P(X(I),"{",2),"}")
"RTN","ORWDXC",165,0)
 .S J=0 F  S J=J+1 Q:J>$L(STR,", ")  S Y(+X(I),I,J)=$P(STR,", ",J)
"RTN","ORWDXC",166,0)
 S I=0 F  S I=$O(Y(I)) Q:'I  D
"RTN","ORWDXC",167,0)
 .S J=0 F  S J=$O(Y(I,J)) Q:'J  D
"RTN","ORWDXC",168,0)
 ..S K=J F  S K=$O(Y(I,K)) Q:'K!('$D(Y(I,J)))  D
"RTN","ORWDXC",169,0)
 ...N A,B M A=Y(I,J),B=Y(I,K)
"RTN","ORWDXC",170,0)
 ...I $$AINB(.A,.B) K X(J),Y(I,J)
"RTN","ORWDXC",171,0)
 ...Q:'$D(Y(I,J))
"RTN","ORWDXC",172,0)
 ...I $$AINB(.B,.A) K X(K),Y(I,K)
"RTN","ORWDXC",173,0)
 Q
"RTN","ORWDXC",174,0)
AINB(A,B) ;if array A is a subset of array B then return 1, else return 0
"RTN","ORWDXC",175,0)
 N I,RET
"RTN","ORWDXC",176,0)
 S RET=1
"RTN","ORWDXC",177,0)
 S I=0 F  S I=$O(A(I)) Q:'I  I '$$XINA(A(I),.B) S RET=0 Q
"RTN","ORWDXC",178,0)
 Q RET
"RTN","ORWDXC",179,0)
XINA(X,A) ;if string X is an entry in array A then return 1, else return 0
"RTN","ORWDXC",180,0)
 N I,RET
"RTN","ORWDXC",181,0)
 S RET=0
"RTN","ORWDXC",182,0)
 S I=0 F  S I=$O(A(I)) Q:'I  I X=A(I) S RET=1 Q
"RTN","ORWDXC",183,0)
 Q RET
"RTN","ORWDXC",184,0)
REMDUPS ;
"RTN","ORWDXC",185,0)
 N IFN,CDL,I,J,CDL2 S IFN="NEW"
"RTN","ORWDXC",186,0)
 S CDL=0 F  S CDL=$O(ORCHECK(IFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",187,0)
 . S I=0 F  S I=$O(ORCHECK(IFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",188,0)
 .. S CDL2=0 F  S CDL2=$O(ORCHECK(IFN,CDL2)) Q:'CDL2  D
"RTN","ORWDXC",189,0)
 ... S J=I F  S J=$O(ORCHECK(IFN,CDL2,J)) Q:'J  I $TR($P($G(ORCHECK(IFN,CDL,I)),U,3),";",",")=$TR($P($G(ORCHECK(IFN,CDL2,J)),U,3),";",",") D
"RTN","ORWDXC",190,0)
 .... I CDL2<=CDL K ORCHECK(IFN,CDL2,J) S ORCHECK=$G(ORCHECK)-1
"RTN","ORWDXC",191,0)
 .... I CDL2>CDL S $P(ORCHECK(IFN,CDL,I),U,7)="X"
"RTN","ORWDXC",192,0)
 .. I $P(ORCHECK(IFN,CDL,I),U,7)="X" K ORCHECK(IFN,CDL,I) S ORCHECK=$G(ORCHECK)-1
"RTN","ORWDXC",193,0)
 Q
"RTN","ORWDXC",194,0)
REMDUPSX ;similar to REMDUPS^ORCHECK
"RTN","ORWDXC",195,0)
 N IFN,CDL,I S IFN="NEW"
"RTN","ORWDXC",196,0)
 S CDL=0 F  S CDL=$O(ORCHECK(IFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",197,0)
 . S I=0 F  S I=$O(ORCHECK(IFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",198,0)
 . . S J=I F  S J=$O(ORCHECK(IFN,CDL,J)) Q:'J  I $G(ORCHECK(IFN,CDL,I))=$G(ORCHECK(IFN,CDL,J)) K ORCHECK(IFN,CDL,J) S ORCHECK=$G(ORCHECK)-1
"RTN","ORWDXC",199,0)
 Q
"RTN","ORWDXC",200,0)
OPOS(DFN) ;handles saving and removing order checks that should only be displayed once per cprs session
"RTN","ORWDXC",201,0)
 ; expects ORCHECK
"RTN","ORWDXC",202,0)
 ; sets these order checks into the "Once Per cprs Session" global ^TMP($J,"OC-OPOS",DFN)
"RTN","ORWDXC",203,0)
 N I,J,K
"RTN","ORWDXC",204,0)
 S I="" F  S I=$O(ORCHECK(I)) Q:'$L(I)  D
"RTN","ORWDXC",205,0)
 .S J=0 F  S J=$O(ORCHECK(I,J)) Q:'J  D
"RTN","ORWDXC",206,0)
 ..S K=0 F  S K=$O(ORCHECK(I,J,K)) Q:'K  D
"RTN","ORWDXC",207,0)
 ...N ORTXT,ORTXT0,ORTXTI,ORXTRAI
"RTN","ORWDXC",208,0)
 ...S ORTXTO="These checks could not be completed for this patient:"
"RTN","ORWDXC",209,0)
 ...Q:(ORCHECK(I,J,K)'[ORTXTO)
"RTN","ORWDXC",210,0)
 ...S ORTXT=ORTXTO
"RTN","ORWDXC",211,0)
 ...S ORXTRAI=$P($P(ORCHECK(I,J,K),"||",2),"&")
"RTN","ORWDXC",212,0)
 ...S ORTXTI=0 F  S ORTXTI=$O(^TMP($J,"ORK XTRA TXT",ORXTRAI,ORTXTO,ORTXTI))  Q:'ORTXTI  D
"RTN","ORWDXC",213,0)
 ....S ORTXT=ORTXT_$G(^TMP($J,"ORK XTRA TXT",ORXTRAI,ORTXTO,ORTXTI))
"RTN","ORWDXC",214,0)
 ...I $D(^TMP($J,"OC-OPOS",DFN,$E(ORTXT,1,225))) K ORCHECK(I,J,K) Q
"RTN","ORWDXC",215,0)
 ...S ^TMP($J,"OC-OPOS",DFN,$E(ORTXT,1,225))="" Q
"RTN","ORWDXC",216,0)
 Q
"RTN","ORY395")
0^4^B15368598^n/a
"RTN","ORY395",1,0)
ORY395 ;ISP/TC,RFR - POST INSTALL FOR PATCH OR*3*395;07/23/2014  12:22
"RTN","ORY395",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**395**;Dec 17, 1997;Build 11
"RTN","ORY395",3,0)
 ;
"RTN","ORY395",4,0)
POST ; Initiate post-init processes
"RTN","ORY395",5,0)
 D UNDOPLRP,FIXMENU
"RTN","ORY395",6,0)
 Q
"RTN","ORY395",7,0)
UNDOPLRP ; Remove SNOMED CT description, Primary ICD code/description, and Secondary ICD code/description columns from PL Clinical Reports.
"RTN","ORY395",8,0)
 N I
"RTN","ORY395",9,0)
 F I=1:1:4  D
"RTN","ORY395",10,0)
 . N DIC,DA,X,J,ORIFN
"RTN","ORY395",11,0)
 . S DIC="^ORD(101.24,",DIC(0)="BIX"
"RTN","ORY395",12,0)
 . S X=$S(I=1:"ORRPW PROBLEM ACTIVE",I=2:"ORRPW PROBLEM ALL",I=3:"ORRPW PROBLEM INACTIVE",1:"ORRPW DOD PROBLEM LIST ALL")
"RTN","ORY395",13,0)
 . D ^DIC I Y=-1 K DIC Q  ; perform top file level search for record X, if unsuccessful quit
"RTN","ORY395",14,0)
 . S DA(1)=+Y,DIC=DIC_DA(1)_",3,",DIC(0)="IXZ",ORIFN=DA(1)
"RTN","ORY395",15,0)
 . D BMES^XPDUTL("Updating the "_X_" report in File #101.24.")
"RTN","ORY395",16,0)
 . L +^ORD(101.24,DA(1)):5 I '$T D  Q
"RTN","ORY395",17,0)
 . . D BMES^XPDUTL("Error updating the "_X_" report in File #101.24.")
"RTN","ORY395",18,0)
 . . D BMES^XPDUTL("Another user is currently editing this report entry.")
"RTN","ORY395",19,0)
 . . Q
"RTN","ORY395",20,0)
 . I ORIFN>1000 D  ; if report is a national standard, then proceed to modify the below X fields in the subfile #101.243
"RTN","ORY395",21,0)
 . . N X,L,ORPRIMCN,ORSECCLN
"RTN","ORY395",22,0)
 . . F L=1:1:2  D
"RTN","ORY395",23,0)
 . . . S X=$S(L=1:"Primary ICD-9-CM Code & Description",1:"Secondary ICD-9-CM Code & Description") D ^DIC
"RTN","ORY395",24,0)
 . . . I Y=-1 D
"RTN","ORY395",25,0)
 . . . . I L=1 S ORPRIMCN="Primary ICD Code & Description"
"RTN","ORY395",26,0)
 . . . . I L=2 S ORSECCLN="Secondary ICD Code & Description"
"RTN","ORY395",27,0)
 . . . . Q
"RTN","ORY395",28,0)
 . . . I $D(Y(0,0)),(Y(0,0)]""),(Y(0,0)["ICD-9") D
"RTN","ORY395",29,0)
 . . . . I L=1 S ORPRIMCN=Y(0,0)
"RTN","ORY395",30,0)
 . . . . I L=2 S ORSECCLN=Y(0,0)
"RTN","ORY395",31,0)
 . . F J=1:1:9  D
"RTN","ORY395",32,0)
 . . . N X,ORCOLHDR S X=$S(J=1:"Date of Onset",J=2:"Date Modified",J=3:"Provider Name    ",J=4:"Note Narrative",J=5:"[+]",J=6:"Exposures",J=7:"SNOMED CT Description",J=8:ORPRIMCN,J=9:ORSECCLN)
"RTN","ORY395",33,0)
 . . . S ORCOLHDR=X
"RTN","ORY395",34,0)
 . . . D ^DIC I Y=-1 Q  ;perform subfile entry level search for record X, if unsuccessful quit
"RTN","ORY395",35,0)
 . . . N DIE,DA,DR S DIE=DIC S DA=+Y,DA(1)=ORIFN
"RTN","ORY395",36,0)
 . . . S DR=".03///"_$S(J=1:"5",J=2:"6",J=3:"7",J=4:"8",J=5:"10",J=6:"9",1:"@")
"RTN","ORY395",37,0)
 . . . D ^DIE  ; edit the SEQUENCE fields of the X COLUMN HEADER multiple accordingly
"RTN","ORY395",38,0)
 . . . I J>6 D
"RTN","ORY395",39,0)
 . . . . D MES^XPDUTL("   Deleting the "_ORCOLHDR_" column header.")
"RTN","ORY395",40,0)
 . . . . N DIK S DIK=DIE D ^DIK  ; delete the 3 new column headers introduced in OR*3*306
"RTN","ORY395",41,0)
 . . . K DIE,DIK,DR,DA,Y Q
"RTN","ORY395",42,0)
 . . K DIC Q
"RTN","ORY395",43,0)
 . L -^ORD(101.24,DA(1)) Q
"RTN","ORY395",44,0)
 . Q
"RTN","ORY395",45,0)
 Q
"RTN","ORY395",46,0)
FIXMENU ;UNDO MENU CHANGES FROM PATCH OR*3*378
"RTN","ORY395",47,0)
 N RESULT
"RTN","ORY395",48,0)
 D BMES^XPDUTL("Cleaning up menus...")
"RTN","ORY395",49,0)
 S RESULT=$$FIND("OR PARAM COORDINATOR MENU","ORE KEY CHECK")
"RTN","ORY395",50,0)
 Q:RESULT=-1
"RTN","ORY395",51,0)
 I RESULT D
"RTN","ORY395",52,0)
 .N ERROR
"RTN","ORY395",53,0)
 .D MES^XPDUTL("  Adding ORE KEY CHECK to OR PARAM COORDINATOR MENU")
"RTN","ORY395",54,0)
 .;IA #1157
"RTN","ORY395",55,0)
 .S ERROR=$$ADD^XPDMENU("OR PARAM COORDINATOR MENU","ORE KEY CHECK","KK")
"RTN","ORY395",56,0)
 .D:ERROR=1 MES^XPDUTL("  DONE")
"RTN","ORY395",57,0)
 .D:ERROR=0 MES^XPDUTL("  ORE KEY CHECK was not added to OR PARAM COORDINATOR MENU")
"RTN","ORY395",58,0)
 D MES^XPDUTL("DONE")
"RTN","ORY395",59,0)
 Q
"RTN","ORY395",60,0)
ERROR(MESSAGE) ;HANDLE AN ERROR MESSAGE FROM FILEMAN
"RTN","ORY395",61,0)
 N IDX
"RTN","ORY395",62,0)
 S IDX=0 F  S IDX=$O(MESSAGE("DIERR",IDX)) Q:'IDX  D
"RTN","ORY395",63,0)
 .D MES^XPDUTL("FILEMAN ERROR #"_MESSAGE("DIERR",IDX)_":")
"RTN","ORY395",64,0)
 .D MES^XPDUTL(MESSAGE("DIERR",IDX,"TEXT",1))
"RTN","ORY395",65,0)
 Q
"RTN","ORY395",66,0)
FIND(ORMENU,OROPTION) ;DETERMINE IF MENU CONTAINS OPTION
"RTN","ORY395",67,0)
 N IEN,RETURN,ERROR,ADD
"RTN","ORY395",68,0)
 ;IA #10156
"RTN","ORY395",69,0)
 S ADD=1,IEN=$$FIND1^DIC(19,,"X",ORMENU)
"RTN","ORY395",70,0)
 I +$G(IEN)=0 D  Q -1
"RTN","ORY395",71,0)
 .D MES^XPDUTL("ERROR: Could not find the "_ORMENU_" option in the OPTION file (#19).")
"RTN","ORY395",72,0)
 ;IA #10156
"RTN","ORY395",73,0)
 D GETS^DIQ(19,IEN_",","10*",,"RETURN","ERROR")
"RTN","ORY395",74,0)
 I $D(ERROR) D ERROR(.ERROR)  Q -1
"RTN","ORY395",75,0)
 I $D(RETURN) D
"RTN","ORY395",76,0)
 .N IDX
"RTN","ORY395",77,0)
 .S IDX=0 F  S IDX=$O(RETURN(19.01,IDX)) Q:+$G(IDX)=0  D
"RTN","ORY395",78,0)
 ..S:RETURN(19.01,IDX,.01)=OROPTION ADD=0
"RTN","ORY395",79,0)
 Q ADD
"VER")
8.0^22.0
**END**
**END**

