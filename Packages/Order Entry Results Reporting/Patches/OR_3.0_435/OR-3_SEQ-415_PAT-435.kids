Released OR*3*435 SEQ #415
Extracted from mail message
**KIDS**:OR*3.0*435^

**INSTALL NAME**
OR*3.0*435
"BLD",9940,0)
OR*3.0*435^ORDER ENTRY/RESULTS REPORTING^0^3180220^y
"BLD",9940,1,0)
^^1^1^3170220^
"BLD",9940,1,1,0)
Please see forum for a complete description of patch OR*3.0*435
"BLD",9940,4,0)
^9.64PA^^
"BLD",9940,6.3)
29
"BLD",9940,"ABPKG")
n
"BLD",9940,"INID")
^y
"BLD",9940,"INIT")
ORFD435P
"BLD",9940,"KRN",0)
^9.67PA^779.2^20
"BLD",9940,"KRN",.4,0)
.4
"BLD",9940,"KRN",.401,0)
.401
"BLD",9940,"KRN",.402,0)
.402
"BLD",9940,"KRN",.403,0)
.403
"BLD",9940,"KRN",.5,0)
.5
"BLD",9940,"KRN",.84,0)
.84
"BLD",9940,"KRN",3.6,0)
3.6
"BLD",9940,"KRN",3.8,0)
3.8
"BLD",9940,"KRN",9.2,0)
9.2
"BLD",9940,"KRN",9.8,0)
9.8
"BLD",9940,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9940,"KRN",9.8,"NM",1,0)
ORCSEND1^^0^B75776613
"BLD",9940,"KRN",9.8,"NM",2,0)
ORWDPS1^^0^B65920710
"BLD",9940,"KRN",9.8,"NM","B","ORCSEND1",1)

"BLD",9940,"KRN",9.8,"NM","B","ORWDPS1",2)

"BLD",9940,"KRN",19,0)
19
"BLD",9940,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9940,"KRN",19.1,0)
19.1
"BLD",9940,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9940,"KRN",101,0)
101
"BLD",9940,"KRN",409.61,0)
409.61
"BLD",9940,"KRN",771,0)
771
"BLD",9940,"KRN",779.2,0)
779.2
"BLD",9940,"KRN",870,0)
870
"BLD",9940,"KRN",8989.51,0)
8989.51
"BLD",9940,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9940,"KRN",8989.51,"NM",1,0)
ORDER URGENCY ASAP ALTERNATIVE^^0
"BLD",9940,"KRN",8989.51,"NM","B","ORDER URGENCY ASAP ALTERNATIVE",1)

"BLD",9940,"KRN",8989.52,0)
8989.52
"BLD",9940,"KRN",8994,0)
8994
"BLD",9940,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",9940,"KRN",8994,"NM",1,0)
ORWDPS1 GETPRIOR^^0
"BLD",9940,"KRN",8994,"NM",2,0)
ORWDPS1 GETPRIEN^^0
"BLD",9940,"KRN",8994,"NM","B","ORWDPS1 GETPRIEN",2)

"BLD",9940,"KRN",8994,"NM","B","ORWDPS1 GETPRIOR",1)

"BLD",9940,"KRN","B",.4,.4)

"BLD",9940,"KRN","B",.401,.401)

"BLD",9940,"KRN","B",.402,.402)

"BLD",9940,"KRN","B",.403,.403)

"BLD",9940,"KRN","B",.5,.5)

"BLD",9940,"KRN","B",.84,.84)

"BLD",9940,"KRN","B",3.6,3.6)

"BLD",9940,"KRN","B",3.8,3.8)

"BLD",9940,"KRN","B",9.2,9.2)

"BLD",9940,"KRN","B",9.8,9.8)

"BLD",9940,"KRN","B",19,19)

"BLD",9940,"KRN","B",19.1,19.1)

"BLD",9940,"KRN","B",101,101)

"BLD",9940,"KRN","B",409.61,409.61)

"BLD",9940,"KRN","B",771,771)

"BLD",9940,"KRN","B",779.2,779.2)

"BLD",9940,"KRN","B",870,870)

"BLD",9940,"KRN","B",8989.51,8989.51)

"BLD",9940,"KRN","B",8989.52,8989.52)

"BLD",9940,"KRN","B",8994,8994)

"BLD",9940,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9940,"QUES",0)
^9.62^^
"BLD",9940,"REQB",0)
^9.611^^
"INIT")
ORFD435P
"KRN",8989.51,895,-1)
0^1
"KRN",8989.51,895,0)
ORDER URGENCY ASAP ALTERNATIVE^ORDER GIVE ADDITIONAL DOSE SITE URGENCY^0^^SITE ASAP ORDER URGENCY ALTERNATIVE
"KRN",8989.51,895,1)
P^101.42^Enter your sites alternative to the "ASAP" urgency.
"KRN",8989.51,895,6)
P^101.42
"KRN",8989.51,895,20,0)
^8989.512^4^4^3170208^^^^
"KRN",8989.51,895,20,1,0)
The Order Urgency "ASAP" is not desired at all sites. This is where a 
"KRN",8989.51,895,20,2,0)
site designates their desired alternative to the default "ASAP"
"KRN",8989.51,895,20,3,0)
urgency for the
"KRN",8989.51,895,20,4,0)
Give Additional Dose Now order in CPRS.
"KRN",8989.51,895,30,0)
^8989.513I^1^1
"KRN",8989.51,895,30,1,0)
1^4.2
"KRN",8994,4210,-1)
0^1
"KRN",8994,4210,0)
ORWDPS1 GETPRIOR^GETPRIOR^ORWDPS1^1
"KRN",8994,4210,1,0)
^8994.01^3^3^3170312^^^^
"KRN",8994,4210,1,1,0)
This gets the sites preferred priority for "ASAP". If "ASAP" is not used 
"KRN",8994,4210,1,2,0)
it holds the sites alternative to "ASAP" or if "ASAP" has been renamed it 
"KRN",8994,4210,1,3,0)
can hold that information if it is chosen. It only holds one entry.
"KRN",8994,4210,3,0)
^8994.03^1^1^3170312^^^^
"KRN",8994,4210,3,1,0)
It returns the sites selection for the "ASAP" priority alternative.
"KRN",8994,4214,-1)
0^2
"KRN",8994,4214,0)
ORWDPS1 GETPRIEN^GETPRIEN^ORWDPS1^1^^0
"KRN",8994,4214,1,0)
^8994.01^2^2^3170501^^^^
"KRN",8994,4214,1,1,0)
Returns the IEN of the sites selection for an Alternative to the "ASAP" 
"KRN",8994,4214,1,2,0)
order urgency, from file ORD(101.42.
"KRN",8994,4214,2,0)
^8994.02A^^0
"KRN",8994,4214,3,0)
^8994.03^1^1^3170501^^^^
"KRN",8994,4214,3,1,0)
The IEN of the sites "ASAP" urgency selection
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
435^3180220
"PKG",188,22,1,"PAH",1,1,0)
^^1^1^3180220
"PKG",188,22,1,"PAH",1,1,1,0)
Please see forum for a complete description of patch OR*3.0*435
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORCSEND1")
0^1^B75776613^B66241171
"RTN","ORCSEND1",1,0)
ORCSEND1 ;SLC/MKB-Release cont ; 12/8/10 10:17am [3/1/17 7:04am]
"RTN","ORCSEND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,45,61,79,94,116,138,158,149,187,215,243,282,323,394,435**;Dec 17, 1997;Build 29
"RTN","ORCSEND1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCSEND1",4,0)
 ;
"RTN","ORCSEND1",5,0)
 ;Reference to PSJEEU supported by IA #486
"RTN","ORCSEND1",6,0)
 ;Reference to PSJORPOE supported by IA #3167
"RTN","ORCSEND1",7,0)
 ;
"RTN","ORCSEND1",8,0)
PKGSTUFF(PKG) ; Package code
"RTN","ORCSEND1",9,0)
 S PKG=$$GET1^DIQ(9.4,+PKG_",",1) Q:'$L(PKG)
"RTN","ORCSEND1",10,0)
 D:$L($T(@PKG)) @PKG
"RTN","ORCSEND1",11,0)
 Q
"RTN","ORCSEND1",12,0)
LR ; Spawn child orders if continuous schedule
"RTN","ORCSEND1",13,0)
 N ORSTRT,ORPARENT,OR0,ORNP,ORDIALOG,ORL,ORX,ORTIME,ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE,ORPCOLL,ORS1,ORS2,P,ORCHLD,ORDG,ORLAST,ORDUZ,ORLOG,ORCOLLCT,STS
"RTN","ORCSEND1",14,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),ORL=$P(OR0,U,10)
"RTN","ORCSEND1",15,0)
 D SCHEDULE(ORIFN,"LR",.ORSTRT) I ORSTRT'>1 D  Q
"RTN","ORCSEND1",16,0)
 . N START S START=$O(ORSTRT(0)) Q:START=$P($G(^OR(100,+ORIFN,0)),U,8)
"RTN","ORCSEND1",17,0)
 . D DATES^ORCSAVE2(+ORIFN,START) ;update start date from schedule
"RTN","ORCSEND1",18,0)
 S ORNP=+$P(OR0,U,4),ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7),ORDG=+$P(OR0,U,11)
"RTN","ORCSEND1",19,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORIFN),GETIMES^ORCDLR1
"RTN","ORCSEND1",20,0)
 K ORDIALOG($$PTR^ORCD("OR GTX ADMIN SCHEDULE"),1),ORDIALOG($$PTR^ORCD("OR GTX DURATION"),1)
"RTN","ORCSEND1",21,0)
 S ORPITEM=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCSEND1",22,0)
 S ORPSAMP=$$PTR^ORCD("OR GTX COLLECTION SAMPLE")
"RTN","ORCSEND1",23,0)
 S ORPSPEC=$$PTR^ORCD("OR GTX SPECIMEN")
"RTN","ORCSEND1",24,0)
 S ORPURG=$$PTR^ORCD("OR GTX LAB URGENCY")
"RTN","ORCSEND1",25,0)
 S ORPCOMM=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORCSEND1",26,0)
 S ORPTYPE=$$PTR^ORCD("OR GTX COLLECTION TYPE")
"RTN","ORCSEND1",27,0)
 S ORPCOLL=$$PTR^ORCD("OR GTX START DATE/TIME")
"RTN","ORCSEND1",28,0)
LR1 N ORLASTC  S ORS1=0 F  S ORS1=$O(ORX(ORS1)) Q:ORS1'>0  D
"RTN","ORCSEND1",29,0)
 . N ORL S ORL=$P(OR0,U,10) ;protect ORL from calling routine ;DJE/VM *323
"RTN","ORCSEND1",30,0)
 . F P=ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE S ORDIALOG(P,1)=$G(ORX(ORS1,P)) ;set values to next instance
"RTN","ORCSEND1",31,0)
 . S ORCOLLCT=$G(ORDIALOG(ORPTYPE,1))
"RTN","ORCSEND1",32,0)
 . S ORS2=0 F  S ORS2=$O(ORSTRT(ORS2)) Q:ORS2'>0  D
"RTN","ORCSEND1",33,0)
 .. S ORDIALOG(ORPCOLL,1)=ORS2 ;,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND1",34,0)
 .. I ORCOLLCT="LC" S ORDIALOG(ORPTYPE,1)=$S($$LABCOLL^ORCDLR1(ORS2):"LC",1:"WC")
"RTN","ORCSEND1",35,0)
 .. I ORCOLLCT="I" S ORDIALOG(ORPTYPE,1)=$S($$IMMCOLL^ORCDLR1(ORS2):"I",1:"WC")
"RTN","ORCSEND1",36,0)
 .. D CHILD^ORCSEND3()
"RTN","ORCSEND1",37,0)
 .. S ORLASTC=$P(^OR(100,ORIFN,0),"^",8)
"RTN","ORCSEND1",38,0)
 . D DATES^ORCSAVE2(ORPARENT,,ORLASTC) S:$G(NATURE)'="V" $P(^OR(100,ORPARENT,3),"^",8)=1 ;p394 exclude parent verbal order from veiling
"RTN","ORCSEND1",39,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",40,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND1",41,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",42,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND1",43,0)
 Q
"RTN","ORCSEND1",44,0)
SCHEDULE(IFN,PKG,ORY,STRT) ; Returns list of start time(s) from schedule
"RTN","ORCSEND1",45,0)
 N I,X,PSJSD,PSJFD,PSJW,PSJNE,PSJPP,PSJX,PSJAT,PSJM,PSJTS,PSJY,PSJAX,PSJSCH,PSJOSD,PSJOFD,PSJC,ORDUR
"RTN","ORCSEND1",46,0)
 S PSJSD=$S(+$G(STRT):STRT,1:$P($G(^OR(100,+IFN,0)),U,8)) I 'PSJSD S ORY=-1 Q
"RTN","ORCSEND1",47,0)
 S ORY=1,ORY(PSJSD)="" ;1st occurrance
"RTN","ORCSEND1",48,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","SCHEDULE",0)) Q:'I  Q:'$L($G(PKG))
"RTN","ORCSEND1",49,0)
 S X=$G(^OR(100,+IFN,4.5,I,1)),PSJX=$S(X:$$GET1^DIQ(51.1,+X_",",.01),1:X)
"RTN","ORCSEND1",50,0)
 S PSJW=+$G(ORL),PSJNE="",PSJPP=PKG D ENSV^PSJEEU Q:'$L($G(PSJX))
"RTN","ORCSEND1",51,0)
 I $G(PSJTS)'="C",$G(PSJTS)'="D" Q  ;not continuous or day-of-week
"RTN","ORCSEND1",52,0)
 S PSJSCH=PSJX,I=$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) Q:'I
"RTN","ORCSEND1",53,0)
 S ORDUR=$G(^OR(100,+IFN,4.5,+I,1))
"RTN","ORCSEND1",54,0)
 S:ORDUR PSJFD=$$FMADD^XLFDT(PSJSD,+ORDUR,,-1)
"RTN","ORCSEND1",55,0)
 I 'ORDUR S X=+$E(ORDUR,2,9) D
"RTN","ORCSEND1",56,0)
 . I PSJM S PSJFD=$$FMADD^XLFDT(PSJSD,,,(PSJM*X)-1) ;X_#times
"RTN","ORCSEND1",57,0)
 . E  D  ;no freq in minutes --> day of week
"RTN","ORCSEND1",58,0)
 .. N DAYS,LOCMX,SCHMX
"RTN","ORCSEND1",59,0)
 .. S LOCMX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCSEND1",60,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",61,0)
 .. D ZERO^PSS51P1(PSJY,,,,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",62,0)
 .. S SCHMX=+$G(^TMP($J,"ORCSEND1 SCHEDULE",PSJY,2.5))
"RTN","ORCSEND1",63,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",64,0)
 .. ;S SCHMX=$P(^PS(51.1,PSJY,0),U,7)
"RTN","ORCSEND1",65,0)
 .. S DAYS=$S('SCHMX:LOCMX,LOCMX<SCHMX:LOCMX,1:SCHMX)
"RTN","ORCSEND1",66,0)
 .. S PSJFD=$$FMADD^XLFDT(PSJSD,DAYS,,-1)
"RTN","ORCSEND1",67,0)
 D ENSPU^PSJEEU K ORY
"RTN","ORCSEND1",68,0)
 I ORDUR M ORY=PSJC Q
"RTN","ORCSEND1",69,0)
 S ORY=$S(PSJC<$E(ORDUR,2,9):PSJC,1:$E(ORDUR,2,9))
"RTN","ORCSEND1",70,0)
 N NXT
"RTN","ORCSEND1",71,0)
 S NXT=0 F I=1:1:ORY S NXT=$O(PSJC(NXT)) Q:'NXT  S ORY(NXT)=PSJC(NXT)
"RTN","ORCSEND1",72,0)
 Q
"RTN","ORCSEND1",73,0)
GETORDER(IFN) ; Set ORX(Inst,Ptr)=Value
"RTN","ORCSEND1",74,0)
 N I,X,Y,PTR,INST,TYPE
"RTN","ORCSEND1",75,0)
 S I=0 F  S I=$O(^OR(100,IFN,4.5,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)) D
"RTN","ORCSEND1",76,0)
 . S PTR=+$P(X,U,2),INST=+$P(X,U,3),TYPE=$P($G(^ORD(101.41,PTR,1)),U)
"RTN","ORCSEND1",77,0)
 . I TYPE'="W" S ORX(INST,PTR)=Y Q
"RTN","ORCSEND1",78,0)
 . S ORX(INST,PTR)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND1",79,0)
 Q
"RTN","ORCSEND1",80,0)
PTR(X) ; Returns ptr of prompt X in Order Dialog file
"RTN","ORCSEND1",81,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORCSEND1",82,0)
PS ; spawn child orders if multiple doses
"RTN","ORCSEND1",83,0)
PSJ ; (Inpt only)
"RTN","ORCSEND1",84,0)
PSS ;
"RTN","ORCSEND1",85,0)
 N ORPARENT,OR0,ORNP,ORDIALOG,ORDUZ,ORLOG,ORL,ORDG,ORCAT,ORX,ORP,ORI,STS
"RTN","ORCSEND1",86,0)
 N ORDOSE,ORT,ORSCH,ORDUR,ORSTRT,ORFRST,ORCONJ,ORID,ORDD,ORSTR,ORDGNM
"RTN","ORCSEND1",87,0)
 N ORSTART,ORCHLD,ORLAST,ORSIG,OROI,ID,OR3,ORIG,CODE,ORPKG,ORENEW,I,ORADMIN
"RTN","ORCSEND1",88,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORPARENT,0)),OR3=$G(^(3))
"RTN","ORCSEND1",89,0)
 Q:$P(OR0,U,12)'="I"  S ORCAT="I",ORNP=+$P(OR0,U,4)
"RTN","ORCSEND1",90,0)
 S ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7)
"RTN","ORCSEND1",91,0)
 S ORL=$P(OR0,U,10),ORDG=+$P(OR0,U,11),ORPKG=+$P(OR0,U,14)
"RTN","ORCSEND1",92,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORPARENT)
"RTN","ORCSEND1",93,0)
 S ORDOSE=$$PTR("INSTRUCTIONS"),ORT=$$PTR("ROUTE")
"RTN","ORCSEND1",94,0)
 S ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCSEND1",95,0)
 S ORCONJ=$$PTR("AND/THEN") D STRT S ORSTART=$G(ORSTRT("BEG"))
"RTN","ORCSEND1",96,0)
 S ORADMIN=$$PTR("ADMIN TIMES")
"RTN","ORCSEND1",97,0)
 D DATES^ORCSAVE2(ORPARENT,ORSTART) Q:$$DOSES(ORPARENT)'>1
"RTN","ORCSEND1",98,0)
 S ORFRST=$$PTR("NOW"),ORSIG=$$PTR("SIG")
"RTN","ORCSEND1",99,0)
 S ORID=$$PTR("DOSE"),ORDD=$$PTR("DISPENSE DRUG")
"RTN","ORCSEND1",100,0)
 S ORSTR=$$PTR("STRENGTH"),ORDGNM=$$PTR("DRUG NAME")
"RTN","ORCSEND1",101,0)
 I $P(OR3,U,11)=2,$O(^OR(100,+$P(OR3,U,5),2,0)) D
"RTN","ORCSEND1",102,0)
 . S ORENEW=+$P(OR3,U,5),I=0
"RTN","ORCSEND1",103,0)
 . I $$VALUE^ORX8(ORENEW,"NOW") S I=$O(^OR(100,ORENEW,2,0))
"RTN","ORCSEND1",104,0)
 . F  S I=$O(^OR(100,ORENEW,2,I)) Q:I<1  S ORENEW(I)=""
"RTN","ORCSEND1",105,0)
PS1 F ORP="ORDERABLE ITEM","URGENCY","WORD PROCESSING 1" D
"RTN","ORCSEND1",106,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(1,PTR))
"RTN","ORCSEND1",107,0)
 . S ORDIALOG(PTR,1)=ORX(1,PTR) S:$E(ORP)="O" OROI=ORX(1,PTR)
"RTN","ORCSEND1",108,0)
 S ORI=$$FRSTDOSE I $G(ORX(1,ORFRST)) D
"RTN","ORCSEND1",109,0)
 . F ORP=ORDOSE,ORT,ORID S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP)
"RTN","ORCSEND1",110,0)
 . S ID=$G(ORX(ORI,ORID)) S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",111,0)
 . S ORDIALOG(ORSCH,1)="NOW",ORSTART=$$NOW^XLFDT
"RTN","ORCSEND1",112,0)
 . N ORPRR,ORPRA,ORURG
"RTN","ORCSEND1",113,0)
 . S ORURG=$$PTR("URGENCY")
"RTN","ORCSEND1",114,0)
 . S ORPRR=$O(^ORD(101.42,"B","ROUTINE",0))
"RTN","ORCSEND1",115,0)
 . S ORURGID=0,ORURGID=$O(^OR(100,ORIFN,4.5,"ID","URGENCY",ORURGID))
"RTN","ORCSEND1",116,0)
 . I $D(^ORD(101.42,"B","ASAP")) S ORPRA=$O(^ORD(101.42,"B","ASAP",0))
"RTN","ORCSEND1",117,0)
 . I '$D(^ORD(101.42,"B","ASAP")) S ORPRA=$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")
"RTN","ORCSEND1",118,0)
 . S:'$G(ORURGID)&$D(^OR(100,ORIFN,4.5,"ID","NOW")) ORURGR=ORPRA,ORDIALOG(ORURG,1)=ORPRA  ;RTW
"RTN","ORCSEND1",119,0)
 . S:$G(ORURGID) ORURGR=$P(^OR(100,ORIFN,4.5,ORURGID,1),U,1)
"RTN","ORCSEND1",120,0)
 . S:ORPRA'=ORURGR ORPRA=ORURGR
"RTN","ORCSEND1",121,0)
 . I ORDIALOG(ORURG,1)=ORPRR S ORDIALOG(ORURG,1)=ORPRA
"RTN","ORCSEND1",122,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",123,0)
 F  D  S ORI=$O(ORX(ORI)) Q:ORI'>0
"RTN","ORCSEND1",124,0)
 . F ORP=ORDOSE,ORT,ORSCH,ORDUR,ORID,ORADMIN S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP) K:'$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)
"RTN","ORCSEND1",125,0)
 . K ORDIALOG(ORDD,1) S ID=$G(ORX(ORI,ORID))
"RTN","ORCSEND1",126,0)
 . S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",127,0)
 . S ORSTART=$G(ORSTRT(ORI))
"RTN","ORCSEND1",128,0)
 . I $G(ORX(1,ORFRST)) D
"RTN","ORCSEND1",129,0)
 . . N ORPRR,ORURG
"RTN","ORCSEND1",130,0)
 . . S ORURG=$$PTR("URGENCY")
"RTN","ORCSEND1",131,0)
 . . S ORPRR=$O(^ORD(101.42,"B","ROUTINE",0))
"RTN","ORCSEND1",132,0)
 . . S ORDIALOG(ORURG,1)=ORPRR
"RTN","ORCSEND1",133,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",134,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",135,0)
 S ORIFN=ORPARENT,ORQUIT=1,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND1",136,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",137,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)) K ^TMP("ORWORD",$J)
"RTN","ORCSEND1",138,0)
 S $P(^OR(100,ORIFN,3),U,8)=1 ;veil parent order - set stop date/time?
"RTN","ORCSEND1",139,0)
 Q:(STS=1)!(STS=13)!(STS=11)  ;unsuccessful
"RTN","ORCSEND1",140,0)
PS2 ; ck if parent is unsigned or edit
"RTN","ORCSEND1",141,0)
 I $P($G(^OR(100,ORIFN,8,1,0)),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;clear ES
"RTN","ORCSEND1",142,0)
 Q:$P(OR3,U,11)'=1  S ORIG=$P(OR3,U,5) Q:ORIG'>0
"RTN","ORCSEND1",143,0)
 S CODE=$S($P($G(^OR(100,ORIG,3)),U,3)=5:"CA",1:"DC")
"RTN","ORCSEND1",144,0)
 D MSG^ORMBLD(ORIG,CODE) I "^1^13^"[(U_$P($G(^OR(100,ORIG,3)),U,3)_U) D
"RTN","ORCSEND1",145,0)
 . N NATR S NATR=+$O(^ORD(100.02,"C","C",0))
"RTN","ORCSEND1",146,0)
 . S $P(^OR(100,ORIG,3),U,3)=12,$P(^(3),U,7)=0,^(6)=NATR_U_DUZ_U_ORNOW
"RTN","ORCSEND1",147,0)
 . D CANCEL^ORCSEND(ORIG) ;ck for unrel actions
"RTN","ORCSEND1",148,0)
 Q
"RTN","ORCSEND1",149,0)
DOSES(IFN) ; count number of doses in order
"RTN","ORCSEND1",150,0)
 N I,CNT S CNT=0
"RTN","ORCSEND1",151,0)
 S I=0 F  S I=$O(^OR(100,+$G(IFN),4.5,"ID","INSTR",I)) Q:I'>0  I $L($G(^OR(100,+$G(IFN),4.5,I,1))) S CNT=CNT+1
"RTN","ORCSEND1",152,0)
 S I=+$O(^OR(100,+$G(IFN),4.5,"ID","NOW",0)) I I,$G(^OR(100,+$G(IFN),4.5,I,1)) S CNT=CNT+1
"RTN","ORCSEND1",153,0)
 Q CNT
"RTN","ORCSEND1",154,0)
FRSTDOSE() ; Return instance of first dose
"RTN","ORCSEND1",155,0)
 N I,Y S I=0,Y=1
"RTN","ORCSEND1",156,0)
 F  S I=$O(ORX(I)) Q:I'>0  I $D(ORX(I,ORDOSE)) S Y=I Q
"RTN","ORCSEND1",157,0)
 Q Y
"RTN","ORCSEND1",158,0)
SIG ; Build text of instructions
"RTN","ORCSEND1",159,0)
 N ORDRUG,ID,DOSE,ORI,ORX K ^TMP("ORWORD",$J,ORSIG,1)
"RTN","ORCSEND1",160,0)
 S ORDRUG=$G(ORDIALOG(ORDD,1)),ID=$G(ORDIALOG(ORID,1))
"RTN","ORCSEND1",161,0)
 S DOSE=$G(ORDIALOG(ORDOSE,1)),ORI=1
"RTN","ORCSEND1",162,0)
 S ORX=$$DOSE^ORCDPS2_$$RTE^ORCDPS2_$$SCH^ORCDPS2_$$DUR^ORCDPS2
"RTN","ORCSEND1",163,0)
 S ^TMP("ORWORD",$J,ORSIG,1,0)="^^1^1^"_DT_U,^(1,0)=ORX
"RTN","ORCSEND1",164,0)
 S ORDIALOG(ORSIG,1)=$NA(^TMP("ORWORD",$J,ORSIG,1))
"RTN","ORCSEND1",165,0)
 S ORDIALOG(ORDOSE,"FORMAT")="@"
"RTN","ORCSEND1",166,0)
 K ORDIALOG(ORSTR,1),ORDIALOG(ORDGNM,1)
"RTN","ORCSEND1",167,0)
 I ORDRUG,'ID D  ;set strength or drug name
"RTN","ORCSEND1",168,0)
 . N STR,ITM S STR=$P(ID,"&",7)_$P(ID,"&",8)
"RTN","ORCSEND1",169,0)
 . I STR'>0 S ORDIALOG(ORDGNM,1)=$$GET1^DIQ(50,+ORDRUG_",",.01) Q
"RTN","ORCSEND1",170,0)
 . S ITM=$P($G(^ORD(101.43,+$G(OROI),0)),U)
"RTN","ORCSEND1",171,0)
 . S:ITM'[STR ORDIALOG(ORSTR,1)=STR
"RTN","ORCSEND1",172,0)
 Q
"RTN","ORCSEND1",173,0)
STRT ; Build ORSTRT(inst)=date.time array of start times by dose
"RTN","ORCSEND1",174,0)
 N OI,PSOI,XD,XH,XM,XS,ORWD,ORI,SCH,ORSD,X,ORD K ORSTRT
"RTN","ORCSEND1",175,0)
 S OI=$G(ORX(1,$$PTR^ORCD("OR GTX ORDERABLE ITEM")))
"RTN","ORCSEND1",176,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),(XD,XH,XM,XS)=0
"RTN","ORCSEND1",177,0)
 S ORWD=+$G(^SC(+$G(ORL),42)) ;ward
"RTN","ORCSEND1",178,0)
 S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI<1  D
"RTN","ORCSEND1",179,0)
 . S SCH=$G(ORX(ORI,ORSCH)),ORSD="" S:'$L(SCH) X=$$NOW^XLFDT
"RTN","ORCSEND1",180,0)
 . S:$L(SCH) ORSD=$$STARTSTP^PSJORPOE(+ORVP,SCH,PSOI,ORWD),X=$P(ORSD,U,4)
"RTN","ORCSEND1",181,0)
 . S ORSTRT(ORI)=$$FMADD^XLFDT(X,XD,XH,XM,XS) ;START+OFFSET
"RTN","ORCSEND1",182,0)
 . ; update OFFSET for next THEN dose
"RTN","ORCSEND1",183,0)
 . D DUR(ORI) I $G(ORX(ORI,ORCONJ))="T" D
"RTN","ORCSEND1",184,0)
 .. I $G(ORD("XD"))<1,$G(ORD("XH"))<1,$G(ORD("XM"))<1,$G(ORD("XS"))<1 S ORD("XD")=+$P(ORSD,U,3) ;default duration
"RTN","ORCSEND1",185,0)
 .. N I,Y F I="XD","XH","XM","XS" S Y=@I,@I=Y+$G(ORD(I))
"RTN","ORCSEND1",186,0)
 .. K ORD
"RTN","ORCSEND1",187,0)
 ; find beginning date.time for parent
"RTN","ORCSEND1",188,0)
 S ORI=0,X=9999999 F  S ORI=$O(ORSTRT(ORI)) Q:ORI<1  I ORSTRT(ORI)<X S X=ORSTRT(ORI)
"RTN","ORCSEND1",189,0)
 S ORSTRT("BEG")=X
"RTN","ORCSEND1",190,0)
 Q
"RTN","ORCSEND1",191,0)
DUR(I) ; Accumulate duration in ORD("Xt") for offsetting next THEN dose
"RTN","ORCSEND1",192,0)
 N X,Y S X=$$FMDUR^ORCDPS3($G(ORX(I,ORDUR)))
"RTN","ORCSEND1",193,0)
 I X["S",+X>$G(ORD("XS")) S ORD("XS")=+X
"RTN","ORCSEND1",194,0)
 I X["'",+X>$G(ORD("XM")) S ORD("XM")=+X
"RTN","ORCSEND1",195,0)
 I X["H",+X>$G(ORD("XH")) S ORD("XH")=+X
"RTN","ORCSEND1",196,0)
 S Y=$S(X["D":+X,X["W":+X*7,X["M":+X*30,1:0)
"RTN","ORCSEND1",197,0)
 I Y,Y>$G(ORD("XD")) S ORD("XD")=Y
"RTN","ORCSEND1",198,0)
 Q
"RTN","ORCSEND1",199,0)
VBEC ; Spawn VBECS children
"RTN","ORCSEND1",200,0)
 D:$L($T(EN^ORCSEND2)) EN^ORCSEND2
"RTN","ORCSEND1",201,0)
 Q
"RTN","ORFD435P")
0^^B7794799^n/a
"RTN","ORFD435P",1,0)
ORFD435P ;ALB/RTW - FIRST DOSE NOW POST INSTALL ; 02/14/17 11:59pm
"RTN","ORFD435P",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**435**;Dec 17, 1997;Build 29
"RTN","ORFD435P",3,0)
 ;ICR#   Type  Description
"RTN","ORFD435P",4,0)
 ;-----  ----  -------------------------------------
"RTN","ORFD435P",5,0)
 ;2263   Sup   $$GET^XPAR  SUPPORTED PARAMETER TOOL ENTRY POINTS 
"RTN","ORFD435P",6,0)
 D CHECK,ORADDRPC
"RTN","ORFD435P",7,0)
CHECK ; Check to See if "ASAP" exists
"RTN","ORFD435P",8,0)
 N ORX
"RTN","ORFD435P",9,0)
 I $$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")'="" S ORX="The ORDER URGENCY ASAP ALTERNATIVE parameter has already been set" D MES^XPDUTL(ORX)
"RTN","ORFD435P",10,0)
 Q:$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")'=""
"RTN","ORFD435P",11,0)
 N ORPARDEF,ORPRA,ORPARSET,ORPARNUM,ERROR,ORX1
"RTN","ORFD435P",12,0)
 ;If a site does not have the "ASAP" Urgency in the Order Urgency FIle ASK for an alternative
"RTN","ORFD435P",13,0)
 ;If a site does have the "ASAP" Urgency in the Order Urgency FIle set ASAP in the parameter, this ensures ASAP ia pointed to if it is changed
"RTN","ORFD435P",14,0)
CHECK2 ;
"RTN","ORFD435P",15,0)
 I '$D(^ORD(101.42,"B","ASAP")) S ORX="Your sites' Order Urgency file does not contain 'ASAP' , please select an alternative to the ""ASAP"" urgency for your site" D MES^XPDUTL(ORX) D
"RTN","ORFD435P",16,0)
 . S ORPARDEF=0,ORPARDEF=$O(^XTV(8989.51,"B","ORDER URGENCY ASAP ALTERNATIVE",ORPARDEF)) D EDITPAR^XPAREDIT(ORPARDEF)
"RTN","ORFD435P",17,0)
 . G:$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")="" CHECK2
"RTN","ORFD435P",18,0)
 . S ORPARNUM=$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")
"RTN","ORFD435P",19,0)
 . S ORPARSET=$P(^ORD(101.42,ORPARNUM,0),U,1)
"RTN","ORFD435P",20,0)
 . S ORX1=ORPARSET_" : Was recorded as your sites selection for an alternative to ""ASAP"""
"RTN","ORFD435P",21,0)
 . D MES^XPDUTL(ORX1)
"RTN","ORFD435P",22,0)
 I $D(^ORD(101.42,"B","ASAP")) S ORPRA=0,ORPRA=$O(^ORD(101.42,"B","ASAP",ORPRA)) D EN^XPAR("SYS","ORDER URGENCY ASAP ALTERNATIVE",1,"ASAP",.ERROR) D
"RTN","ORFD435P",23,0)
 . I ERROR=0 S ORX="""ASAP"" Order Urgency exists in file 100.42 and was recorded in the ""ORDER URGENCY ASAP ALTERNATIVE"" parameter" D MES^XPDUTL(ORX)
"RTN","ORFD435P",24,0)
 Q
"RTN","ORFD435P",25,0)
ORADDRPC ;ADD RPCS TO THE OR CPRS GUI CHART OPTION
"RTN","ORFD435P",26,0)
 ;
"RTN","ORFD435P",27,0)
 N FDA,OROP,ORRPCIEN,ORTORPC
"RTN","ORFD435P",28,0)
 S OROP=+$P($Q(^DIC(19,"B","OR CPRS GUI CHART")),",",4)
"RTN","ORFD435P",29,0)
 S ORTORPC="" F ORTORPC="ORWDPS1 GETPRIEN","ORWDPS1 GETPRIOR" Q:ORTORPC=""  D
"RTN","ORFD435P",30,0)
 . S ORRPCIEN=0 S ORRPCIEN=$O(^XWB(8994,"B",ORTORPC,ORRPCIEN))
"RTN","ORFD435P",31,0)
 . Q:$D(^DIC(19,OROP,"RPC","B",ORRPCIEN))
"RTN","ORFD435P",32,0)
 . S FDA(1,19.05,"+2,"_OROP_",",.01)=ORRPCIEN
"RTN","ORFD435P",33,0)
 . D UPDATE^DIE("","FDA(1)")
"RTN","ORFD435P",34,0)
 Q
"RTN","ORWDPS1")
0^2^B65920710^B58422591
"RTN","ORWDPS1",1,0)
ORWDPS1 ; SLC/KCM/JLI/TC - Pharmacy Calls for Windows Dialog ;12/05/17  13:40
"RTN","ORWDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,132,141,163,215,255,243,306,350,435**;Dec 17, 1997;Build 29
"RTN","ORWDPS1",3,0)
 ;
"RTN","ORWDPS1",4,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORWDPS1",5,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORWDPS1",6,0)
 N ILST S ILST=0
"RTN","ORWDPS1",7,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORWDPS1",8,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORWDPS1",9,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORWDPS1",10,0)
 ;
"RTN","ORWDPS1",11,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORWDPS1",12,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORWDPS1",13,0)
 ;
"RTN","ORWDPS1",14,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORWDPS1",15,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORWDPS1",16,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORWDPS1",17,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORWDPS1",18,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORWDPS1",19,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORWDPS1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORWDPS1",21,0)
 Q
"RTN","ORWDPS1",22,0)
PKI(ORY,OI,PSTYPE,ORVP,PKIACTIV) ; return DEA Schedule for drug
"RTN","ORWDPS1",23,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2,X
"RTN","ORWDPS1",24,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",25,0)
 S ILST=0
"RTN","ORWDPS1",26,0)
 S ORWPSOI=0
"RTN","ORWDPS1",27,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS1",28,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS1",29,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS1",30,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS1",31,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS1",32,0)
 S ORY="" ;PKI
"RTN","ORWDPS1",33,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS1",34,0)
 . I '$L(X2) Q
"RTN","ORWDPS1",35,0)
 . I $G(PKIACTIV) S X=X2
"RTN","ORWDPS1",36,0)
 S ORY=X
"RTN","ORWDPS1",37,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",38,0)
 Q
"RTN","ORWDPS1",39,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS1",40,0)
 N X,XREF,ORX
"RTN","ORWDPS1",41,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS1",42,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS1",43,0)
 . I XREF["PSO",X="DONE" Q
"RTN","ORWDPS1",44,0)
 . I $D(^ORD(101.42,"B","ASAP")) S ORPRA=$O(^ORD(101.42,"B","ASAP",0))
"RTN","ORWDPS1",45,0)
 . I '$D(^ORD(101.42,"B","ASAP")) S ORPRA=$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")
"RTN","ORWDPS1",46,0)
 . S ORX=$P($G(^ORD(101.42,ORPRA,0)),U,1)
"RTN","ORWDPS1",47,0)
 . I XREF["PSJ",X'=ORX,X'="ROUTINE",X'="STAT" Q
"RTN","ORWDPS1",48,0)
 . S ILST=ILST+1,LST(ILST)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS1",49,0)
 S ILST=ILST+1,LST(ILST)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS1",50,0)
 Q
"RTN","ORWDPS1",51,0)
GETPRIOR(ORX) ; from RPC ORWDPS1 GETPRIOR gets sites alterative to "ASAP" if present
"RTN","ORWDPS1",52,0)
 N ORPRA
"RTN","ORWDPS1",53,0)
 I $D(^ORD(101.42,"B","ASAP")) S ORPRA=$O(^ORD(101.42,"B","ASAP",0))
"RTN","ORWDPS1",54,0)
 I '$D(^ORD(101.42,"B","ASAP")) S ORPRA=$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")
"RTN","ORWDPS1",55,0)
 S ORX=$P($G(^ORD(101.42,ORPRA,0)),U,1)
"RTN","ORWDPS1",56,0)
 Q ORX
"RTN","ORWDPS1",57,0)
 ;
"RTN","ORWDPS1",58,0)
GETPRIEN(ORPRA) ; from RPC ORWDPS1 GETPRIEN gets sites alterative to "ASAP" IEN if present
"RTN","ORWDPS1",59,0)
 I $D(^ORD(101.42,"B","ASAP")) S ORPRA=$O(^ORD(101.42,"B","ASAP",0))
"RTN","ORWDPS1",60,0)
 I '$D(^ORD(101.42,"B","ASAP")) S ORPRA=$$GET^XPAR("ALL","ORDER URGENCY ASAP ALTERNATIVE")
"RTN","ORWDPS1",61,0)
 Q ORPRA
"RTN","ORWDPS1",62,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORWDPS1",63,0)
 N X,DLG,PRMT
"RTN","ORWDPS1",64,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS1",65,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS1",66,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS1",67,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORWDPS1",68,0)
 ;
"RTN","ORWDPS1",69,0)
 ;S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",70,0)
 S X=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",71,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS1",72,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS1",73,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS1",74,0)
 I X="N" S X=""            G XPICK
"RTN","ORWDPS1",75,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS1",76,0)
XPICK Q X
"RTN","ORWDPS1",77,0)
 ;
"RTN","ORWDPS1",78,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORWDPS1",79,0)
 N ORWX
"RTN","ORWDPS1",80,0)
 S ORWX("PATIENT")=DFN
"RTN","ORWDPS1",81,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",82,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",83,0)
 ;
"RTN","ORWDPS1",84,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG,OI)        ; return days supply given quantity
"RTN","ORWDPS1",85,0)
 ; VAL: default days supply
"RTN","ORWDPS1",86,0)
 N ORWX,I,PSOI,TPKG
"RTN","ORWDPS1",87,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS1",88,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS1",89,0)
 I $D(OI) D
"RTN","ORWDPS1",90,0)
 . S TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2) Q:TPKG'["PS"
"RTN","ORWDPS1",91,0)
 . S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",92,0)
 . S ORWX("OI")=PSOI
"RTN","ORWDPS1",93,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS1",94,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS1",95,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS1",96,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",97,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",98,0)
 Q
"RTN","ORWDPS1",99,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORWDPS1",100,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORWDPS1",101,0)
 ;
"RTN","ORWDPS1",102,0)
DOWSCH(LST,DFN,LOCIEN)     ; return all schedules
"RTN","ORWDPS1",103,0)
 N CNT,FREQ,ILST,ORARRAY,WIEN
"RTN","ORWDPS1",104,0)
 S WIEN=$$WARDIEN^ORWDPS32(+$G(LOCIEN))
"RTN","ORWDPS1",105,0)
 D SCHED^PSS51P1(WIEN,.ORARRAY)
"RTN","ORWDPS1",106,0)
 S ILST=0
"RTN","ORWDPS1",107,0)
 S CNT=0 F  S CNT=$O(ORARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS1",108,0)
 .S NODE=$G(ORARRAY(CNT))
"RTN","ORWDPS1",109,0)
 .I $P(NODE,U,4)="C" D
"RTN","ORWDPS1",110,0)
 ..K ^TMP($J,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",111,0)
 ..D ZERO^PSS51P1($P(NODE,U),,,,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",112,0)
 ..S FREQ=$G(^TMP($J,"ORWDPS1 DOWSCH",$P(NODE,U),2))
"RTN","ORWDPS1",113,0)
 ..K ^TMP($J,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",114,0)
 ..I +FREQ=0 Q
"RTN","ORWDPS1",115,0)
 ..I +FREQ>1440 Q
"RTN","ORWDPS1",116,0)
 ..S ILST=ILST+1,LST(ILST)=$P(ORARRAY(CNT),U,2,5)
"RTN","ORWDPS1",117,0)
 Q
"RTN","ORWDPS1",118,0)
 ;
"RTN","ORWDPS1",119,0)
SCHALL(LST,DFN,LOCIEN)     ; return all schedules
"RTN","ORWDPS1",120,0)
 N CNT,ILST,ORARRAY,WIEN
"RTN","ORWDPS1",121,0)
 S WIEN=$$WARDIEN^ORWDPS32(+$G(LOCIEN))
"RTN","ORWDPS1",122,0)
 D SCHED^PSS51P1(WIEN,.ORARRAY)
"RTN","ORWDPS1",123,0)
 S ILST=0
"RTN","ORWDPS1",124,0)
 S CNT=0 F  S CNT=$O(ORARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS1",125,0)
 .S ILST=ILST+1,LST(ILST)=$P(ORARRAY(CNT),U,2,5)
"RTN","ORWDPS1",126,0)
 Q
"RTN","ORWDPS1",127,0)
 ;
"RTN","ORWDPS1",128,0)
FORMALT(ORLST,ORIEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS1",129,0)
 N PSID,I
"RTN","ORWDPS1",130,0)
 S ORIEN=+$P(^ORD(101.43,ORIEN,0),U,2)
"RTN","ORWDPS1",131,0)
 D EN1^PSSUTIL1(.ORIEN,PSTYPE)
"RTN","ORWDPS1",132,0)
 S PSID=0,I=0
"RTN","ORWDPS1",133,0)
 F  S PSID=$O(ORIEN(PSID)) Q:'PSID  D
"RTN","ORWDPS1",134,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORWDPS1",135,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",136,0)
 Q
"RTN","ORWDPS1",137,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORWDPS1",138,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORWDPS1",139,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORWDPS1",140,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORWDPS1",141,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS1",142,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",143,0)
 Q
"RTN","ORWDPS1",144,0)
QOMEDALT(ORY,ODIEN) ;
"RTN","ORWDPS1",145,0)
 N ARRAY,IDIEN,ORDERID,PKG,PSTYPE,VALUE
"RTN","ORWDPS1",146,0)
 S ORY=0,PKG=+$P(^ORD(101.41,ODIEN,0),U,7)
"RTN","ORWDPS1",147,0)
 S PSTYPE=$S($$GET1^DIQ(9.4,PKG_",",1)="PSO":"O",1:"I")
"RTN","ORWDPS1",148,0)
 S ORDERID=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM","")) Q:ORDERID'>0
"RTN","ORWDPS1",149,0)
 S IDIEN=$O(^ORD(101.41,ODIEN,6,"D",ORDERID,"")) Q:IDIEN'>0
"RTN","ORWDPS1",150,0)
 S VALUE=$G(^ORD(101.41,ODIEN,6,IDIEN,1)) Q:VALUE'>0
"RTN","ORWDPS1",151,0)
 I $P($G(^ORD(101.43,VALUE,"PS")),U,6)=1 S ORY=VALUE
"RTN","ORWDPS1",152,0)
 ;D FORMALT(.ARRAY,VALUE,PSTYPE) I $D(ARRAY)>0 S ORY=VALUE
"RTN","ORWDPS1",153,0)
 ;I ORY=0,$P($G(^ORD(101.43,VALUE,"PS")),U,6)=1 S ORY=VALUE
"RTN","ORWDPS1",154,0)
 Q
"RTN","ORWDPS1",155,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORWDPS1",156,0)
 N DEAFLG,PSOI,TPKG,RT,DETFLG,DETPRO
"RTN","ORWDPS1",157,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",158,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",159,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",160,0)
 S DETFLAG=$$OIDETOX^PSSOPKI(PSOI,PSTYPE)
"RTN","ORWDPS1",161,0)
 S DETPRO=$$DETOX^XUSER(+$G(ORNP))
"RTN","ORWDPS1",162,0)
 I DETFLAG,DETPRO="" S FAIL=3 Q
"RTN","ORWDPS1",163,0)
 I DETFLAG,DETPRO>0 S Y=DETPRO X ^DD("DD") S FAIL="5^"_Y Q
"RTN","ORWDPS1",164,0)
 S DEAFLG=$P($$OIDEA^PSSOPKI(PSOI,PSTYPE),";",2) Q:DEAFLG'>0
"RTN","ORWDPS1",165,0)
 I DEAFLG=1 S FAIL=6 Q
"RTN","ORWDPS1",166,0)
 S RT=$$SDEA^XUSER(,+$G(ORNP),DEAFLG) I RT=1 S FAIL=1
"RTN","ORWDPS1",167,0)
 I RT=2 S FAIL="2^"_$$UP^XLFSTR(DEAFLG)
"RTN","ORWDPS1",168,0)
 I RT?1"4".E S FAIL=RT
"RTN","ORWDPS1",169,0)
 Q
"RTN","ORWDPS1",170,0)
FDEA1(FAIL,OI,OITYPE,ORNP) ; only be called for an outpaitent and IV dialog
"RTN","ORWDPS1",171,0)
 ;OI: IV Orderable Item
"RTN","ORWDPS1",172,0)
 ;OITYPE: A:ADDITIVE  S:SOLUTION
"RTN","ORWDPS1",173,0)
 N DEAFLG,PSOI,TKPG,RT,DETFLG,DETPRO
"RTN","ORWDPS1",174,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",175,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",176,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",177,0)
 S DETFLAG=$$OIDETOX^PSSOPKI(PSOI,"I")
"RTN","ORWDPS1",178,0)
 S DETPRO=$$DETOX^XUSER(+$G(ORNP))
"RTN","ORWDPS1",179,0)
 I DETFLAG,DETPRO="" S FAIL=3 Q
"RTN","ORWDPS1",180,0)
 I DETFLAG,DETPRO>0 S Y=DETPRO X ^DD("DD") S FAIL="5^"_Y Q
"RTN","ORWDPS1",181,0)
 S DEAFLG=$P($$IVDEA^PSSUTIL1(PSOI,OITYPE),";",2) Q:DEAFLG'>0
"RTN","ORWDPS1",182,0)
 I DEAFLG=1 S FAIL=6 Q
"RTN","ORWDPS1",183,0)
 S RT=$$SDEA^XUSER(,+$G(ORNP),DEAFLG) I RT=1 S FAIL=1
"RTN","ORWDPS1",184,0)
 I RT=2 S FAIL="2^"_$$UP^XLFSTR(DEAFLG)
"RTN","ORWDPS1",185,0)
 I RT?1"4".E S FAIL=RT
"RTN","ORWDPS1",186,0)
 Q
"RTN","ORWDPS1",187,0)
 ;
"RTN","ORWDPS1",188,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORWDPS1",189,0)
 S VAL=0
"RTN","ORWDPS1",190,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORWDPS1",191,0)
 Q
"RTN","ORWDPS1",192,0)
LOCPICK(Y,LOC) ; return default Location level routing
"RTN","ORWDPS1",193,0)
 S Y=""
"RTN","ORWDPS1",194,0)
 S Y=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",195,0)
 I Y="C" S Y="C^in Clinic"
"RTN","ORWDPS1",196,0)
 I Y="M" S Y="M^by Mail"
"RTN","ORWDPS1",197,0)
 I Y="W" S Y="W^at Window"
"RTN","ORWDPS1",198,0)
 I Y="N" S Y=""
"RTN","ORWDPS1",199,0)
 Q
"RTN","ORWDPS1",200,0)
HASOIPI(Y,QOID) ; Check if QO put orderable item's PI into Sig
"RTN","ORWDPS1",201,0)
 N PIIEN,OIX
"RTN","ORWDPS1",202,0)
 S Y=0
"RTN","ORWDPS1",203,0)
 Q:'$D(^ORD(101.41,QOID,0))
"RTN","ORWDPS1",204,0)
 S PIIEN=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",0))
"RTN","ORWDPS1",205,0)
 Q:'PIIEN
"RTN","ORWDPS1",206,0)
 S OIX=0
"RTN","ORWDPS1",207,0)
 Q:'$D(^ORD(101.41,QOID,6,"D"))
"RTN","ORWDPS1",208,0)
 F  S OIX=$O(^ORD(101.41,+QOID,6,"D",OIX)) Q:'OIX  D
"RTN","ORWDPS1",209,0)
 . I OIX=PIIEN S Y=1 Q
"RTN","ORWDPS1",210,0)
 Q
"RTN","ORWDPS1",211,0)
HASROUTE(Y,QOID) ;Check if QO has a ROUTE defined
"RTN","ORWDPS1",212,0)
 N ROUTID
"RTN","ORWDPS1",213,0)
 S Y=0,ROUTID=0
"RTN","ORWDPS1",214,0)
 S ROUTID=$O(^ORD(101.41,"B","OR GTX ROUTING",0))
"RTN","ORWDPS1",215,0)
 Q:'ROUTID
"RTN","ORWDPS1",216,0)
 Q:'$D(^ORD(101.41,+QOID))
"RTN","ORWDPS1",217,0)
 I $D(^ORD(101.41,+QOID,6,"D",ROUTID)) S Y=1
"RTN","ORWDPS1",218,0)
 Q
"RTN","ORWDPS1",219,0)
QOCHECK(ORY,DIEN) ;
"RTN","ORWDPS1",220,0)
 N ARY,DG,FORMIEN,NAME,OI,OIIEN,ORDIALOG,ORPKG,TYPE
"RTN","ORWDPS1",221,0)
 S ORPKG=$$NMSP^ORCD($P($G(^ORD(101.41,DIEN,0)),U,7)) Q:ORPKG'["PS"
"RTN","ORWDPS1",222,0)
 S DG=$P(^ORD(101.41,DIEN,0),U,5)
"RTN","ORWDPS1",223,0)
 S NAME=$P(^ORD(100.98,DIEN,0),U)
"RTN","ORWDPS1",224,0)
 S TYPE=$S(NAME="INPATIENT MEDICATIONS":"I",NAME="OUTPATIENT MEDICATIONS":"O",1:"")
"RTN","ORWDPS1",225,0)
 I TYPE="" Q
"RTN","ORWDPS1",226,0)
 S ORDIALOG=$$DEFDLG^ORCD(DIEN) Q:ORDIALOG
"RTN","ORWDPS1",227,0)
 D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD("^ORD(101.41,"_DIEN_",6)")
"RTN","ORWDPS1",228,0)
 I $D(ORDIALOG)'>0 Q
"RTN","ORWDPS1",229,0)
 S OI=$P($G(ORDIALOG("B","ORDERABLE")),U,2) Q:OI'>0
"RTN","ORWDPS1",230,0)
 S OIIEN=$G(ORDIALOG(OI,1)) Q:OIIEN'>0
"RTN","ORWDPS1",231,0)
 D FORMALT(.ARY,OIIEN,TYPE) I $D(ARY)'>0 Q
"RTN","ORWDPS1",232,0)
 S ORY=OIIEN
"RTN","ORWDPS1",233,0)
 Q
"VER")
8.0^22.2
"BLD",9940,6)
^415
**END**
**END**

