Released OR*3*465 SEQ #390
Extracted from mail message
**KIDS**:OR*3.0*465^

**INSTALL NAME**
OR*3.0*465
"BLD",10638,0)
OR*3.0*465^ORDER ENTRY/RESULTS REPORTING^0^3171026^y
"BLD",10638,1,0)
^^12^12^3170911^
"BLD",10638,1,1,0)
This patch corrects 3 issues within the ORDER ENTRY/RESULTS REPORTING 
"BLD",10638,1,2,0)
package:
"BLD",10638,1,3,0)
 
"BLD",10638,1,4,0)
1. The hard error <UNDEFINED>EN+3^LEXAFIL occasionally and sporadically
"BLD",10638,1,5,0)
   occurs when the user uses a function in CPRS that calls the Remote
"BLD",10638,1,6,0)
   Procedure Call (RPC) ORWPCE4 LEX.
"BLD",10638,1,7,0)
 
"BLD",10638,1,8,0)
2. The automated monthly controlled substance report to providers is 
"BLD",10638,1,9,0)
   sending the internal id for Prescription instead of the external id.
"BLD",10638,1,10,0)
 
"BLD",10638,1,11,0)
3. Users can't remove themselves from patient lists of type "Patient 
"BLD",10638,1,12,0)
   Manual" 
"BLD",10638,4,0)
^9.64PA^100.21^1
"BLD",10638,4,100.21,0)
100.21
"BLD",10638,4,100.21,2,0)
^9.641^100.21^1
"BLD",10638,4,100.21,2,100.21,0)
OE/RR LIST  (File-top level)
"BLD",10638,4,100.21,2,100.21,1,0)
^9.6411^1.7^1
"BLD",10638,4,100.21,2,100.21,1,1.7,0)
SUBSCRIBE
"BLD",10638,4,100.21,222)
y^y^p^^^^n^^n
"BLD",10638,4,100.21,224)

"BLD",10638,4,"APDD",100.21,100.21)

"BLD",10638,4,"APDD",100.21,100.21,1.7)

"BLD",10638,4,"B",100.21,100.21)

"BLD",10638,6.3)
7
"BLD",10638,"KRN",0)
^9.67PA^779.2^20
"BLD",10638,"KRN",.4,0)
.4
"BLD",10638,"KRN",.401,0)
.401
"BLD",10638,"KRN",.402,0)
.402
"BLD",10638,"KRN",.403,0)
.403
"BLD",10638,"KRN",.5,0)
.5
"BLD",10638,"KRN",.84,0)
.84
"BLD",10638,"KRN",3.6,0)
3.6
"BLD",10638,"KRN",3.8,0)
3.8
"BLD",10638,"KRN",9.2,0)
9.2
"BLD",10638,"KRN",9.8,0)
9.8
"BLD",10638,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",10638,"KRN",9.8,"NM",2,0)
ORWPCE4^^0^B24454182
"BLD",10638,"KRN",9.8,"NM",3,0)
ORLP^^0^B84312710
"BLD",10638,"KRN",9.8,"NM",4,0)
ORDEA02^^0^B10300366
"BLD",10638,"KRN",9.8,"NM","B","ORDEA02",4)

"BLD",10638,"KRN",9.8,"NM","B","ORLP",3)

"BLD",10638,"KRN",9.8,"NM","B","ORWPCE4",2)

"BLD",10638,"KRN",19,0)
19
"BLD",10638,"KRN",19.1,0)
19.1
"BLD",10638,"KRN",101,0)
101
"BLD",10638,"KRN",409.61,0)
409.61
"BLD",10638,"KRN",771,0)
771
"BLD",10638,"KRN",779.2,0)
779.2
"BLD",10638,"KRN",870,0)
870
"BLD",10638,"KRN",8989.51,0)
8989.51
"BLD",10638,"KRN",8989.52,0)
8989.52
"BLD",10638,"KRN",8994,0)
8994
"BLD",10638,"KRN","B",.4,.4)

"BLD",10638,"KRN","B",.401,.401)

"BLD",10638,"KRN","B",.402,.402)

"BLD",10638,"KRN","B",.403,.403)

"BLD",10638,"KRN","B",.5,.5)

"BLD",10638,"KRN","B",.84,.84)

"BLD",10638,"KRN","B",3.6,3.6)

"BLD",10638,"KRN","B",3.8,3.8)

"BLD",10638,"KRN","B",9.2,9.2)

"BLD",10638,"KRN","B",9.8,9.8)

"BLD",10638,"KRN","B",19,19)

"BLD",10638,"KRN","B",19.1,19.1)

"BLD",10638,"KRN","B",101,101)

"BLD",10638,"KRN","B",409.61,409.61)

"BLD",10638,"KRN","B",771,771)

"BLD",10638,"KRN","B",779.2,779.2)

"BLD",10638,"KRN","B",870,870)

"BLD",10638,"KRN","B",8989.51,8989.51)

"BLD",10638,"KRN","B",8989.52,8989.52)

"BLD",10638,"KRN","B",8994,8994)

"BLD",10638,"QUES",0)
^9.62^^
"BLD",10638,"REQB",0)
^9.611^3^3
"BLD",10638,"REQB",1,0)
OR*3.0*423^1
"BLD",10638,"REQB",2,0)
OR*3.0*371^1
"BLD",10638,"REQB",3,0)
OR*3.0*273^1
"BLD",10638,"REQB","B","OR*3.0*273",3)

"BLD",10638,"REQB","B","OR*3.0*371",2)

"BLD",10638,"REQB","B","OR*3.0*423",1)

"FIA",100.21)
OE/RR LIST
"FIA",100.21,0)
^OR(100.21,
"FIA",100.21,0,0)
100.21
"FIA",100.21,0,1)
y^y^p^^^^n^^n
"FIA",100.21,0,10)

"FIA",100.21,0,11)

"FIA",100.21,0,"RLRO")

"FIA",100.21,0,"VR")
3.0^OR
"FIA",100.21,100.21)
1
"FIA",100.21,100.21,1.7)

"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
465^3171026
"PKG",174,22,1,"PAH",1,1,0)
^^12^12^3171026
"PKG",174,22,1,"PAH",1,1,1,0)
This patch corrects 3 issues within the ORDER ENTRY/RESULTS REPORTING 
"PKG",174,22,1,"PAH",1,1,2,0)
package:
"PKG",174,22,1,"PAH",1,1,3,0)
 
"PKG",174,22,1,"PAH",1,1,4,0)
1. The hard error <UNDEFINED>EN+3^LEXAFIL occasionally and sporadically
"PKG",174,22,1,"PAH",1,1,5,0)
   occurs when the user uses a function in CPRS that calls the Remote
"PKG",174,22,1,"PAH",1,1,6,0)
   Procedure Call (RPC) ORWPCE4 LEX.
"PKG",174,22,1,"PAH",1,1,7,0)
 
"PKG",174,22,1,"PAH",1,1,8,0)
2. The automated monthly controlled substance report to providers is 
"PKG",174,22,1,"PAH",1,1,9,0)
   sending the internal id for Prescription instead of the external id.
"PKG",174,22,1,"PAH",1,1,10,0)
 
"PKG",174,22,1,"PAH",1,1,11,0)
3. Users can't remove themselves from patient lists of type "Patient 
"PKG",174,22,1,"PAH",1,1,12,0)
   Manual" 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORDEA02")
0^4^B10300366^B8327482
"RTN","ORDEA02",1,0)
ORDEA02 ;ISL/JLC - DEA PROVIDER REPORT ; 9/13/17 2:24pm
"RTN","ORDEA02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**371,465**;Dec 17, 1997;Build 7
"RTN","ORDEA02",3,0)
 ;
"RTN","ORDEA02",4,0)
 ;DBIA reference section
"RTN","ORDEA02",5,0)
 ;10017 ^DD("DD"
"RTN","ORDEA02",6,0)
 ;10003 DD^%DT
"RTN","ORDEA02",7,0)
 ;10063 $$S^%ZTLOAD
"RTN","ORDEA02",8,0)
 ;10015 EN^DIQ1
"RTN","ORDEA02",9,0)
 ;10103 $$NOW^XLFDT
"RTN","ORDEA02",10,0)
 ;10070 ^XMD
"RTN","ORDEA02",11,0)
 ; 4820 RX^PSO52API
"RTN","ORDEA02",12,0)
 ;
"RTN","ORDEA02",13,0)
 Q
"RTN","ORDEA02",14,0)
EN ;TaskMan entry point
"RTN","ORDEA02",15,0)
 N YR,MN,ORREPH,ORREP,ORPROV,BL,S1,S3,ORRX,DATA0,DATA1,DATA3,DATA5,ORPNM,ORDRUG,ORDEA,ORCNT,ORISS,Y,ORDT,DIC,DA,DR,DIQ,ORS,ORIFN
"RTN","ORDEA02",16,0)
 S ZTSTOP=0 K ^TMP($J,"CS BY PROV")
"RTN","ORDEA02",17,0)
 S DT=$$NOW^XLFDT,YR=$E(DT,1,3)+1700,MN=$E(100+$E(DT,4,5)-1,2,99) I MN<1 S MN=12,YR=YR-1
"RTN","ORDEA02",18,0)
 S Y=YR-1700_MN D DD^%DT S ORREPH=Y,ORREP=YR-1700_$E(MN+100,2,3),ORPROV=0,$P(BL," ",99)=""
"RTN","ORDEA02",19,0)
 F  S ORPROV=$O(^ORPA(101.52,"C",ORPROV)) Q:'ORPROV  D  I ZTSTOP Q
"RTN","ORDEA02",20,0)
 . S S1=ORREP K ^TMP($J,"CS BY PROV") S ORCNT=0
"RTN","ORDEA02",21,0)
 . F  S S1=$O(^ORPA(101.52,"C",ORPROV,S1)) Q:'S1  I $E(S1,1,5)=ORREP D
"RTN","ORDEA02",22,0)
 .. S S3=0
"RTN","ORDEA02",23,0)
 .. F  S S3=$O(^ORPA(101.52,"C",ORPROV,S1,S3)) Q:'S3  D
"RTN","ORDEA02",24,0)
 ... S DATA0=$G(^ORPA(101.52,S3,0)),DATA1=$G(^(1)),DATA3=$G(^(3)),DATA5=$G(^(5))
"RTN","ORDEA02",25,0)
 ... S ORIFN=$P(DATA0,"^"),ORRX=$P(DATA0,"^",2)
"RTN","ORDEA02",26,0)
 ... I ORRX="" S DA=$P(^OR(100,ORIFN,3),"^",3) S DIC=100.01,DR=.01,DIQ="ORS" D EN^DIQ1 S ORRX=ORS(100.01,DA,.01)
"RTN","ORDEA02",27,0)
 ... I ORRX S ORRX=$$RXNUM($P(DATA5,"^",2),ORRX)
"RTN","ORDEA02",28,0)
 ... S ORRX=ORRX_BL,ORPNM=$P(DATA5,"^")_BL,ORDRUG=$E($P(DATA1,"^",2),1,22)_BL,ORDEA=$E($P(DATA1,"^",4))_BL
"RTN","ORDEA02",29,0)
 ... I 'ORCNT D
"RTN","ORDEA02",30,0)
 .... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)=$E(BL,1,16)_"Monthly Controlled Substances Issued by Provider"
"RTN","ORDEA02",31,0)
 .... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)="Report for: "_ORREPH_" for "_$P(DATA3,"^",3)
"RTN","ORDEA02",32,0)
 .... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)=" "
"RTN","ORDEA02",33,0)
 .... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)=$E("PATIENT NAME"_BL,1,25)_$E("DRUG NAME"_BL,1,25)_"SCH  "_$E("ISSUE DATE"_BL,1,13)_$E("RX #"_BL,1,12)
"RTN","ORDEA02",34,0)
 .... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)=" "
"RTN","ORDEA02",35,0)
 ... S Y=$P(DATA1,"^") X ^DD("DD") S ORISS=Y_BL
"RTN","ORDEA02",36,0)
 ... S ORCNT=ORCNT+1,^TMP($J,"CS BY PROV",ORCNT,0)=$E(ORPNM,1,23)_"  "_$E(ORDRUG,1,24)_" "_$E(ORDEA)_"    "_$E(ORISS,1,13)_$E(ORRX,1,11)
"RTN","ORDEA02",37,0)
 . D SEND K ^TMP($J)
"RTN","ORDEA02",38,0)
 . S ZTSTOP=$$REQ2STOP()
"RTN","ORDEA02",39,0)
 S ZTREQ="@" Q
"RTN","ORDEA02",40,0)
SEND ;
"RTN","ORDEA02",41,0)
 Q:'$D(^TMP($J,"CS BY PROV"))  N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","ORDEA02",42,0)
 S XMDUZ="CPRS,REPORT",XMY(ORPROV)="",XMSUB="MONTHLY CONTROLLED SUBSTANCES REPORT",XMTEXT="^TMP("_$J_",""CS BY PROV"","
"RTN","ORDEA02",43,0)
 D ^XMD Q
"RTN","ORDEA02",44,0)
REQ2STOP() ;
"RTN","ORDEA02",45,0)
 ; Check for task stop request
"RTN","ORDEA02",46,0)
 ; Returns 1 if stop request made.
"RTN","ORDEA02",47,0)
 N STATUS,X
"RTN","ORDEA02",48,0)
 S STATUS=0
"RTN","ORDEA02",49,0)
 I '$D(ZTQUEUED) Q 0
"RTN","ORDEA02",50,0)
 S X=$$S^%ZTLOAD()
"RTN","ORDEA02",51,0)
 I X D  ;
"RTN","ORDEA02",52,0)
 . S STATUS=1
"RTN","ORDEA02",53,0)
 . S X=$$S^%ZTLOAD("Received shutdown request")
"RTN","ORDEA02",54,0)
 ;
"RTN","ORDEA02",55,0)
 Q STATUS
"RTN","ORDEA02",56,0)
RXNUM(DFN,RXIEN) N RXNUM K ^TMP($J,"RX")
"RTN","ORDEA02",57,0)
 S RXIEN=+$G(RXIEN)
"RTN","ORDEA02",58,0)
 D RX^PSO52API(DFN,"RX",RXIEN,,0)
"RTN","ORDEA02",59,0)
 S RXNUM=$G(^TMP($J,"RX",DFN,RXIEN,.01))
"RTN","ORDEA02",60,0)
 K ^TMP($J,"RX")
"RTN","ORDEA02",61,0)
 Q RXNUM
"RTN","ORLP")
0^3^B84312710^B83826939
"RTN","ORLP",1,0)
ORLP ;SLC/CLA - Manager for Team List options ; 10/26/17 12:48pm
"RTN","ORLP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**47,90,98,243,273,465**;Dec 17, 1997;Build 7
"RTN","ORLP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORLP",4,0)
 ;
"RTN","ORLP",5,0)
 ;DBIA reference section
"RTN","ORLP",6,0)
 ;10035 - ^DPT(
"RTN","ORLP",7,0)
 ;2160  - ^XUTL("OR"
"RTN","ORLP",8,0)
 ;10006 - DIC
"RTN","ORLP",9,0)
 ;10009 - DICN
"RTN","ORLP",10,0)
 ;10018 - DIE
"RTN","ORLP",11,0)
 ;10013 - DIK
"RTN","ORLP",12,0)
 ;10026 - DIR
"RTN","ORLP",13,0)
 ;3070  - PTCL^SCAPMC
"RTN","ORLP",14,0)
 ;
"RTN","ORLP",15,0)
CLEAR ; From TM, MERG^ORLP1, END^ORLP0.
"RTN","ORLP",16,0)
 K ^XUTL("OR",$J,"ORLP"),^("ORV"),^("ORU"),^("ORW") S ORCNT=0
"RTN","ORLP",17,0)
 Q
"RTN","ORLP",18,0)
 ;
"RTN","ORLP",19,0)
TM ; From option ORLP TEAM ADD - create/add a team list.
"RTN","ORLP",20,0)
 N ORLTYP
"RTN","ORLP",21,0)
 D CLEAR
"RTN","ORLP",22,0)
 W @IOF,!,"A team list is a list containing patients related to several providers.",!,"These providers are the list's users.  You may now create a new team list"
"RTN","ORLP",23,0)
 W !,"or add autolinks, users and/or patients to an existing team list.  Autolinks",!,"automatically add or remove patients with ADT movements.  Users on the list"
"RTN","ORLP",24,0)
 W !,"may receive notifications regarding patients on the same list.  Please prefix",!,"your list name with 'TEAM' or 'SERVICE' (e.g. TEAM7B, SERVICECARDIOLOGY.)",!
"RTN","ORLP",25,0)
 D ASKLIST,END
"RTN","ORLP",26,0)
 Q
"RTN","ORLP",27,0)
 ;
"RTN","ORLP",28,0)
ASKLIST ; Ask for team list.
"RTN","ORLP",29,0)
 ; NOTE: For new entries, TYPE field is required and trigger
"RTN","ORLP",30,0)
 ;       stuffs CREATOR field with DUZ of current user.
"RTN","ORLP",31,0)
 ;
"RTN","ORLP",32,0)
AL N DLAYGO,DIC,DIE,DIK,DR,ORFLAG,ORLTNAM,OROWNER,ORROOT,ORDA,ORYY
"RTN","ORLP",33,0)
 N DIR S DIR(0)="FAO^3:30",DIR("A")="Enter team list name: "
"RTN","ORLP",34,0)
 D ^DIR
"RTN","ORLP",35,0)
 I '$D(X)!$D(DIRUT) K DIR,DIRUT Q
"RTN","ORLP",36,0)
 S ORLTNAM=$$CHKNAM(Y) ; Check for duplication.
"RTN","ORLP",37,0)
 K DIR
"RTN","ORLP",38,0)
 N DIC S X=$G(X),(ORROOT,DIC)="^OR(100.21,",DLAYGO=100.21,DIC(0)="LEFQZ" D ^DIC
"RTN","ORLP",39,0)
 I '$D(X)!(+Y<0)!$D(DIRUT) K DIRUT Q   ; User aborted or problem.
"RTN","ORLP",40,0)
 ; Check for "Personal" lists (and not a new entry):
"RTN","ORLP",41,0)
 I ORLTNAM>0,(+Y>0),$P($G(^OR(100.21,+Y,0)),U,2)="P" W !!,"     Personal lists cannot be edited here.",! G AL
"RTN","ORLP",42,0)
 S (ORYY,TEAM)=Y,ORDA=+Y,TEAM(0)=Y(0),^TMP("ORLP",$J,"TLIST")=+Y K DIC
"RTN","ORLP",43,0)
 ;
"RTN","ORLP",44,0)
 ; Lock before allowing editing or creation
"RTN","ORLP",45,0)
 L +^OR(100.21,+TEAM):3 I '$T W !?5,"  Another user is editing this entry." Q
"RTN","ORLP",46,0)
 ;
"RTN","ORLP",47,0)
 ; Check for entry of team type (new team entry):
"RTN","ORLP",48,0)
 I $P(TEAM,U,3) D  Q
"RTN","ORLP",49,0)
 .I $P(TEAM(0),U,2)="" D
"RTN","ORLP",50,0)
 ..SET Y=TEAM,Y(0)=TEAM(0) ; Reassign in case DIE previously called.
"RTN","ORLP",51,0)
 ..N DIE S DIE=ORROOT,DA=+Y,DR="1  Enter type:  ~R" D ^DIE I $O(Y(0)) S DIK=DIE D ^DIK Q
"RTN","ORLP",52,0)
 .S (ORLTYP,OROWNER)=""
"RTN","ORLP",53,0)
 .S ORLTYP=$P($G(^OR(100.21,+TEAM,0)),U,2) Q:'$L(ORLTYP)
"RTN","ORLP",54,0)
 .; Check for "P" type, ask for user/owner input:
"RTN","ORLP",55,0)
 .I ORLTYP="P" D 
"RTN","ORLP",56,0)
 ..D OWNER^ORLP1 ; Sets OROWNER variable.
"RTN","ORLP",57,0)
 ..I +TEAM,'+$G(^OR(100.21,+TEAM,11)) S ^OR(100.21,+TEAM,11)="0^"
"RTN","ORLP",58,0)
 .I (ORLTYP="P")&(OROWNER="") S DIK=ORROOT,DA=ORDA D ^DIK Q
"RTN","ORLP",59,0)
 .;
"RTN","ORLP",60,0)
 .; Allow further editing of autolink type teams:
"RTN","ORLP",61,0)
 .I ORLTYP["A" S:'$D(^OR(100.21,+TEAM,2,0)) ^(0)="^100.213AVI^^" D  Q
"RTN","ORLP",62,0)
 .. D ASKLINK,ASKUSER,ASKDEV,ASKSUB
"RTN","ORLP",63,0)
 .;
"RTN","ORLP",64,0)
 .; Proceed with editing for "TM" type teams:
"RTN","ORLP",65,0)
 .D ASKPT^ORLP00(+TEAM),ASKUSER,ASKDEV
"RTN","ORLP",66,0)
 .I ORLTYP="TM" D ASKSUB
"RTN","ORLP",67,0)
 ;
"RTN","ORLP",68,0)
 ; For existing teams, display team type:
"RTN","ORLP",69,0)
 W !,"  Type: "_$S($P(Y(0),U,2)="TM":"Manual Team List",$P(Y(0),U,2)="TA":"Autolinked Team List",$P(Y(0),U,2)="MRAL":"Manual Removal Autolinked Team List",1:"(Unknown)")
"RTN","ORLP",70,0)
 ;
"RTN","ORLP",71,0)
 ; Allow applicable editing for all types but "TM" teams:
"RTN","ORLP",72,0)
 I $P(TEAM(0),U,2)'="TM" D
"RTN","ORLP",73,0)
 . D ASKLINK,ASKUSER,ASKDEV
"RTN","ORLP",74,0)
 . ;
"RTN","ORLP",75,0)
 . ; Editing of "subscription" attribute for "TA" and "MRAL" teams:
"RTN","ORLP",76,0)
 . I $P(TEAM(0),U,2)["A" D
"RTN","ORLP",77,0)
 . . D ASKSUB
"RTN","ORLP",78,0)
 ; Proceed with editing for "TM" type teams:
"RTN","ORLP",79,0)
 I $P(TEAM(0),U,2)="TM" D ASKPT^ORLP00(+TEAM),ASKUSER,ASKDEV,ASKSUB
"RTN","ORLP",80,0)
 Q
"RTN","ORLP",81,0)
 ;
"RTN","ORLP",82,0)
ASKLINK ; Ask for autolinks.
"RTN","ORLP",83,0)
 N DIC,DA,DLAYGO,Y,DUOUT,LVP,LVPT,LNAME
"RTN","ORLP",84,0)
 W !
"RTN","ORLP",85,0)
 F  K DIC,DA,DUOUT D  I LVP<1 Q
"RTN","ORLP",86,0)
 .S DLAYGO=100.21,DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",2,",DIC(0)="AELMQZ",DIC("A")="  Enter team autolink: "
"RTN","ORLP",87,0)
 .D ^DIC S LVP=Y I Y<1 Q
"RTN","ORLP",88,0)
 .I $P($G(Y),U,3)=1 D
"RTN","ORLP",89,0)
 ..S LNAME=Y(0,0)
"RTN","ORLP",90,0)
 ..I LVP["VA(200" F  D  Q:'$D(Y)
"RTN","ORLP",91,0)
 ...S DA(1)=+TEAM,DIE="^OR(100.21,"_DA(1)_",2,",DA(1)=+TEAM,DA=+LVP,DR="1R" D ^DIE I $D(Y) W !,"  This field is required in order for Provider autolinks to work correctly.",!,"  Please answer the question."
"RTN","ORLP",92,0)
 ..S LVPT=$P($G(^OR(100.21,+TEAM,2,+LVP,0)),U,2)
"RTN","ORLP",93,0)
 ..; For clinics, take a fork in the road:
"RTN","ORLP",94,0)
 ..I $P($P(LVP,U,2),";",2)="SC(" D BYCL(LVP) Q
"RTN","ORLP",95,0)
 ..; For autolinks besides clinics, truck on:
"RTN","ORLP",96,0)
 ..D ADDLPTS
"RTN","ORLP",97,0)
 Q
"RTN","ORLP",98,0)
 ;
"RTN","ORLP",99,0)
ADDLPTS ; Add patients linked to autolink.
"RTN","ORLP",100,0)
 W !
"RTN","ORLP",101,0)
 W !,"       [ADT movements linked to "
"RTN","ORLP",102,0)
 W !,"          ",LNAME
"RTN","ORLP",103,0)
 W !,"        will now automatically add patients to this list.]"
"RTN","ORLP",104,0)
 S LINK=$P(LVP,U,2),FILE="^"_$P(LINK,";",2),X="",CNT=0
"RTN","ORLP",105,0)
 W !!,"       Adding patients linked to ",LNAME,"..."
"RTN","ORLP",106,0)
 W !
"RTN","ORLP",107,0)
 I FILE="^DIC(42," D LOOPTS("CN",LNAME) Q
"RTN","ORLP",108,0)
 I FILE="^DG(405.4," D LOOPTS("RM",LNAME) Q
"RTN","ORLP",109,0)
 I FILE="^VA(200," D  Q
"RTN","ORLP",110,0)
 . ; Variable LVPT determines if provider pointer is for:
"RTN","ORLP",111,0)
 . ;    B - Both Primary and Attending
"RTN","ORLP",112,0)
 . ;    A - Attending
"RTN","ORLP",113,0)
 . ;    P - Primary
"RTN","ORLP",114,0)
 . I LVPT["B" D LOOPTS("APR",+LINK) N CNTAPR S CNTAPR=CNT,CNT=0 D LOOPTS("AAP",+LINK) Q
"RTN","ORLP",115,0)
 . I LVPT["P" D LOOPTS("APR",+LINK) Q
"RTN","ORLP",116,0)
 . I LVPT["A" D LOOPTS("AAP",+LINK)
"RTN","ORLP",117,0)
 I FILE="^DIC(45.7," D LOOPTS("ATR",+LINK) Q
"RTN","ORLP",118,0)
 Q
"RTN","ORLP",119,0)
 ;
"RTN","ORLP",120,0)
BYCL(CLINIC) ; SLC/PKS - 6/99 - Return list of clinic patients by enrollment.
"RTN","ORLP",121,0)
 ;
"RTN","ORLP",122,0)
 ; Called by ASKLINK.
"RTN","ORLP",123,0)
 ;
"RTN","ORLP",124,0)
 ; Variables used:
"RTN","ORLP",125,0)
 ;
"RTN","ORLP",126,0)
 ;    CLINIC  = Clinic to search.
"RTN","ORLP",127,0)
 ;    ORLIST  = Array, returned by call to PTCL^SCAPMC.
"RTN","ORLP",128,0)
 ;    ORERR   = Array for errors, returned by call to PTCL^SCAPMC.
"RTN","ORLP",129,0)
 ;    ORRET  = Flag for problem with PTCL^SCAPMC call.
"RTN","ORLP",130,0)
 ;    RESULT  = Holds result of PTCL^SCAPMC call (1=OK, 0=error).
"RTN","ORLP",131,0)
 ;    RCD     = Holder for each record in ^TMP of PTCL^SCAPMC.
"RTN","ORLP",132,0)
 ;    DFN     = Patient IEN.
"RTN","ORLP",133,0)
 ;    ALCNT   = Count of autolink patients added.
"RTN","ORLP",134,0)
 ;    DUPCNT  = Count of duplicate patients already on list.
"RTN","ORLP",135,0)
 ;    X       = Temp value holder variable.
"RTN","ORLP",136,0)
 ;
"RTN","ORLP",137,0)
 N DIC,DA,DO,DD,ORLIST,ORERR,RESULT,RCD,DFN,ALCNT,DUPCNT,X,ORRET
"RTN","ORLP",138,0)
 ;
"RTN","ORLP",139,0)
 ; Assign clinic variable:
"RTN","ORLP",140,0)
 S CLINIC=$P(CLINIC,"^",2)
"RTN","ORLP",141,0)
 S CLINIC=$P(CLINIC,";")
"RTN","ORLP",142,0)
 ;
"RTN","ORLP",143,0)
 ; Keep user informed:
"RTN","ORLP",144,0)
 W !
"RTN","ORLP",145,0)
 W !,"       [Patient enrollments linked to "
"RTN","ORLP",146,0)
 W !,"          ",LNAME
"RTN","ORLP",147,0)
 W !,"        will now automatically add patients to this list.]"
"RTN","ORLP",148,0)
 W !
"RTN","ORLP",149,0)
 W !,"       Adding patients enrolled in ",LNAME,"..."
"RTN","ORLP",150,0)
 W !
"RTN","ORLP",151,0)
 ;
"RTN","ORLP",152,0)
 ; Process the Autolink entries:
"RTN","ORLP",153,0)
 K ^TMP("SC TMP LIST") ; Clean up potential leftover data.
"RTN","ORLP",154,0)
 S ORRET=1
"RTN","ORLP",155,0)
 S RESULT=$$PTCL^SCAPMC(CLINIC,,.ORLIST,.ORERR)
"RTN","ORLP",156,0)
 I $L($G(RESULT)) D   ; Make sure something was returned.
"RTN","ORLP",157,0)
 .I RESULT>0 S ORRET=0 ; Was return value 1 or more?
"RTN","ORLP",158,0)
 I ORRET W !,"  Error in processing - patients will not be added." Q  ; Abort if there's a problem.
"RTN","ORLP",159,0)
 ; Clinic patients should now be in ^TMP("SC TMP LIST",$J file.
"RTN","ORLP",160,0)
 ;
"RTN","ORLP",161,0)
 ; Write the patients to the OE/RR LIST file:
"RTN","ORLP",162,0)
 S ALCNT=0  ; Initialize autolink counter.
"RTN","ORLP",163,0)
 S DUPCNT=0 ; Initialize duplicate counter.
"RTN","ORLP",164,0)
 S RCD=0    ; Initialize to start with first data record.
"RTN","ORLP",165,0)
 F  S RCD=$O(^TMP("SC TMP LIST",$J,RCD)) Q:'RCD  D  ; Each record.
"RTN","ORLP",166,0)
 .S DFN=$P(^TMP("SC TMP LIST",$J,RCD),"^")          ; Patient IEN.
"RTN","ORLP",167,0)
 .S X=DFN_";DPT(" ; Add ";DPT(" to patient string.
"RTN","ORLP",168,0)
 .I $D(^OR(100.21,+TEAM,10,"B",X)) S DUPCNT=DUPCNT+1 Q  ; This patient already on list - increment dupe counter.
"RTN","ORLP",169,0)
 .S:'$D(^OR(100.21,+TEAM,10,0)) ^(0)="^100.2101AV^^"
"RTN","ORLP",170,0)
 .K DIC,DA,DO,DD
"RTN","ORLP",171,0)
 .S DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",10,",DIC(0)="L"
"RTN","ORLP",172,0)
 .D FILE^DICN
"RTN","ORLP",173,0)
 .I +X S ALCNT=ALCNT+1 ; Increment counter.
"RTN","ORLP",174,0)
 .Q  ; Loop for each record in ^TMP file.
"RTN","ORLP",175,0)
 ;
"RTN","ORLP",176,0)
 ; Give user the results:
"RTN","ORLP",177,0)
 I ALCNT>0 W !,"       "_ALCNT_" patient(s) added to list."
"RTN","ORLP",178,0)
 I ALCNT=0 W !,"       No linked patients found."
"RTN","ORLP",179,0)
 I DUPCNT>0 W !,"       "_DUPCNT_" patient(s) already on list."
"RTN","ORLP",180,0)
 W !
"RTN","ORLP",181,0)
 K ^TMP("SC TMP LIST",$J) ; Clean up ^TMP file entries.
"RTN","ORLP",182,0)
 ;
"RTN","ORLP",183,0)
 Q
"RTN","ORLP",184,0)
 ;
"RTN","ORLP",185,0)
LOOPTS(REF,DEX) ;
"RTN","ORLP",186,0)
 S ORLPT=0 F  S ORLPT=$O(^DPT(REF,DEX,ORLPT)) Q:ORLPT'>0  S X=ORLPT_";DPT(" D ADDLOOP
"RTN","ORLP",187,0)
 I $D(LVPT),LVPT["B"!(LVPT']"") Q:REF="APR"
"RTN","ORLP",188,0)
 I +X W !,$S(+CNT:"       "_(+$G(CNTAPR)+(+CNT))_" patient(s) added.",1:"       Linked patients already on list.")
"RTN","ORLP",189,0)
 E  W "       No linked patients found."
"RTN","ORLP",190,0)
 W !
"RTN","ORLP",191,0)
 K DEX,FILE,MSG,REF,X,Y
"RTN","ORLP",192,0)
 Q
"RTN","ORLP",193,0)
 ;
"RTN","ORLP",194,0)
ASKUSER ; From ASKLIST - ask for providers/users.
"RTN","ORLP",195,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","ORLP",196,0)
 W !
"RTN","ORLP",197,0)
 S:'$D(^OR(100.21,+TEAM,1,0)) ^(0)="^100.212PA^^"
"RTN","ORLP",198,0)
 K DIC,DA
"RTN","ORLP",199,0)
 S DLAYGO=100.212,DA(1)=+TEAM
"RTN","ORLP",200,0)
 S DIC("P")="100.212PA",DIC="^OR(100.21,"_DA(1)_",1,",DIC(0)="AELMQ"
"RTN","ORLP",201,0)
 S DIC("A")="  Enter team provider/user: "
"RTN","ORLP",202,0)
 ; SLC/PKS - Next line added on 4/11/2000:
"RTN","ORLP",203,0)
 S DIC("S")="I $D(X),$D(^VA(200,""AK.PROVIDER"",$P(^(0),U))),$$ACTIVE^XUSER(+Y)"
"RTN","ORLP",204,0)
 F  D  Q:Y<1
"RTN","ORLP",205,0)
 .D ^DIC
"RTN","ORLP",206,0)
 .I '(Y<1) W !
"RTN","ORLP",207,0)
 K DIC,DA,DLAYGO
"RTN","ORLP",208,0)
 Q
"RTN","ORLP",209,0)
 ;
"RTN","ORLP",210,0)
ASKDEV ; From ASKLIST - ask for device.
"RTN","ORLP",211,0)
 ;
"RTN","ORLP",212,0)
 ; New, by PKS - 7/29/99:
"RTN","ORLP",213,0)
 Q:$D(DTOUT)!($D(DUOUT))  ; Previous interaction fail?
"RTN","ORLP",214,0)
 W !
"RTN","ORLP",215,0)
 N DIE,DR
"RTN","ORLP",216,0)
 S DIE="^OR(100.21,"
"RTN","ORLP",217,0)
 S DA=+TEAM
"RTN","ORLP",218,0)
 S DR="1.5  Enter device: "
"RTN","ORLP",219,0)
 D ^DIE ; Writes to DEVICE field.
"RTN","ORLP",220,0)
 K DIE
"RTN","ORLP",221,0)
 Q
"RTN","ORLP",222,0)
 ;
"RTN","ORLP",223,0)
ASKSUB ; From ASKLIST - Ask re: subscription status.
"RTN","ORLP",224,0)
 ; (PKS - 8/1999)
"RTN","ORLP",225,0)
 ;
"RTN","ORLP",226,0)
 Q:$D(DTOUT)!($D(DUOUT))  ; Previous interaction fail?
"RTN","ORLP",227,0)
 W !
"RTN","ORLP",228,0)
 N DIE,DR
"RTN","ORLP",229,0)
 S DIE="^OR(100.21,"
"RTN","ORLP",230,0)
 S DA=+TEAM
"RTN","ORLP",231,0)
 S DR="1.7  Enter subscription status: "
"RTN","ORLP",232,0)
 D ^DIE ; Writes to SUBSCRIBE field.
"RTN","ORLP",233,0)
 K DIE
"RTN","ORLP",234,0)
 ;
"RTN","ORLP",235,0)
 Q
"RTN","ORLP",236,0)
 ;
"RTN","ORLP",237,0)
STOR ; From SEQ^ORLP0 - store list in 100.21.
"RTN","ORLP",238,0)
 Q:'$D(DUZ)!('ORCNT)
"RTN","ORLP",239,0)
 I '$D(TEAM),($D(Y)#2) S TEAM=Y
"RTN","ORLP",240,0)
 S DLAYGO=100.21
"RTN","ORLP",241,0)
 L +^OR(100.21,+TEAM):$G(DILOCKTM,3) I '$T W !,"Another user is editing this entry." Q
"RTN","ORLP",242,0)
 S (CNT,ORLI)=0 F ORLJ=1:1 S ORLI=$O(^XUTL("OR",$J,"ORLP",ORLI)) Q:ORLI<1  I $D(^(ORLI,0)) S X=^(0),X=$P(X,U,3) D ADDLOOP
"RTN","ORLP",243,0)
 I $G(X)>0 S MSG=$S(CNT=0:"       Patient(s) already on list.",1:"       "_CNT_" patient(s) added.") W !?5,MSG
"RTN","ORLP",244,0)
 E  W !?5,"       No patients found."
"RTN","ORLP",245,0)
 I CNT>0 W !?5,"  Storing list " W:$D(TEAM) $P(TEAM,U,2)," " W "for future reference..."
"RTN","ORLP",246,0)
 L -^OR(100.21,+TEAM)
"RTN","ORLP",247,0)
 Q
"RTN","ORLP",248,0)
 ;
"RTN","ORLP",249,0)
ADDLOOP ; From STOR, LOOPTS - add patients.
"RTN","ORLP",250,0)
 Q:$D(^OR(100.21,+TEAM,10,"B",X))  ; Quit if on list.
"RTN","ORLP",251,0)
 S:'$D(^OR(100.21,+TEAM,10,0)) ^(0)="^100.2101AV^^"
"RTN","ORLP",252,0)
 K DIC,DA,DO,DD
"RTN","ORLP",253,0)
 S DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",10,",DIC(0)="L"
"RTN","ORLP",254,0)
 D FILE^DICN I Y>0 S:$D(CNT) CNT=CNT+1
"RTN","ORLP",255,0)
 Q
"RTN","ORLP",256,0)
 ;
"RTN","ORLP",257,0)
CHKNAM(X) ; Check for duplicate entry.
"RTN","ORLP",258,0)
 N DIC
"RTN","ORLP",259,0)
 S X=$G(X)
"RTN","ORLP",260,0)
 S DIC="^OR(100.21,"
"RTN","ORLP",261,0)
 D ^DIC
"RTN","ORLP",262,0)
 S X=+Y
"RTN","ORLP",263,0)
 Q X
"RTN","ORLP",264,0)
 ;
"RTN","ORLP",265,0)
END ;
"RTN","ORLP",266,0)
 I $G(TEAM) L -^OR(100.21,+TEAM)
"RTN","ORLP",267,0)
 ;
"RTN","ORLP",268,0)
END1 K %,CNT,DA,DD,DIC,DO,DIE,DIK,DIR,DR,LINK,ORCNT,ORLI,ORLJ,ORLPT,SEL,TEAM,X,Y,ORBSTG,ORBROOT,DTOUT
"RTN","ORLP",269,0)
 Q
"RTN","ORWPCE4")
0^2^B24454182^B23255140
"RTN","ORWPCE4",1,0)
ORWPCE4 ;SLC/JM/REV - wrap calls to PCE and AICS ; 10/26/17 12:48pm
"RTN","ORWPCE4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**306,361,350,423,465**;Dec 17, 1997;Build 7
"RTN","ORWPCE4",3,0)
 ;
"RTN","ORWPCE4",4,0)
 ; DBIA reference section
"RTN","ORWPCE4",5,0)
 ;  2950 LOOK^LEXA
"RTN","ORWPCE4",6,0)
 ;  1609 CONFIG^LEXSET
"RTN","ORWPCE4",7,0)
 ;  5006 $$GETSYN^LEXTRAN1
"RTN","ORWPCE4",8,0)
 ;  5679 $$IMPDATE^LEXU
"RTN","ORWPCE4",9,0)
 ;  5679 $$ONE^LEXU
"RTN","ORWPCE4",10,0)
 ; 10104 $$STRIP^XLFSTR
"RTN","ORWPCE4",11,0)
 ; 10104 $$TRIM^XLFSTR
"RTN","ORWPCE4",12,0)
 ; 10104 $$UP^XLFSTR
"RTN","ORWPCE4",13,0)
 ;
"RTN","ORWPCE4",14,0)
 Q
"RTN","ORWPCE4",15,0)
LEX(LST,X,APP,ORDATE,ORXTND,ORINCSYN) ; return list after lexicon lookup
"RTN","ORWPCE4",16,0)
 ; Call with: X           (Required) The search text entered by the user
"RTN","ORWPCE4",17,0)
 ;            APP         (Required) The Lexicon APP parameter (e.g., "GMPX"
"RTN","ORWPCE4",18,0)
 ;                                   for Problem List Subset, "10D" for ICD-10-CM, etc.
"RTN","ORWPCE4",19,0)
 ;            [ORDATE]    (Optional) the date of interest (Defaults to TODAY - should
"RTN","ORWPCE4",20,0)
 ;                                   be passed as DATE OF SERVICE if not TODAY)
"RTN","ORWPCE4",21,0)
 ;            [ORXTND]    (Optional) Boolean flag specifying whether or not to
"RTN","ORWPCE4",22,0)
 ;                                   use an extended search (Initial search is PL Subset
"RTN","ORWPCE4",23,0)
 ;                                   of SCT, extended search is ICD (or 10D after impl.)
"RTN","ORWPCE4",24,0)
 ;                                   (Defaults to 0 (FALSE))
"RTN","ORWPCE4",25,0)
 ;            [ORINCSYN]  (Optional) Boolean flag specifying whether or not to
"RTN","ORWPCE4",26,0)
 ;                                   include synonyms for SNOMED CT Concepts
"RTN","ORWPCE4",27,0)
 ;                                   (Defaults to 0 (FALSE))
"RTN","ORWPCE4",28,0)
 ;
"RTN","ORWPCE4",29,0)
 ;   Returns: LST=local array name passed by ref, which contains search result set as:
"RTN","ORWPCE4",30,0)
 ;            <lvn>(1..n)=LEXIEN^PREFTEXT^CODESYS^CONCEPTID^ICDVER^DESIGID^PARENTSUBSCRIPT
"RTN","ORWPCE4",31,0)
 ;
"RTN","ORWPCE4",32,0)
 N LEX,ILST,I,IEN,IMPLDT,SUBSET,FILTER,DIC
"RTN","ORWPCE4",33,0)
 S FILTER=""
"RTN","ORWPCE4",34,0)
 S IMPLDT=$$IMPDATE^LEXU("10D")
"RTN","ORWPCE4",35,0)
 S:APP="CPT" APP="CHP" ; LEX PATCH 10
"RTN","ORWPCE4",36,0)
 I APP="ICD",'+$G(ORXTND) S APP=$S($E(X,1,3)?.1A2.3N:"ICD",1:"GMPX")
"RTN","ORWPCE4",37,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE4",38,0)
 S ORINCSYN=+$G(ORINCSYN)
"RTN","ORWPCE4",39,0)
 I APP="ICD",(ORDATE'<IMPLDT) S APP="10D"
"RTN","ORWPCE4",40,0)
 S SUBSET=$S(APP="GMPX":$S(ORDATE<IMPLDT:"PLS",1:"CLF"),1:APP)
"RTN","ORWPCE4",41,0)
 ; call CONFIG^LEXSET to set-up the constraints of the Lexicon search
"RTN","ORWPCE4",42,0)
 D CONFIG^LEXSET(APP,SUBSET,ORDATE)  ;DBIA 1609
"RTN","ORWPCE4",43,0)
 I APP="CHP" D
"RTN","ORWPCE4",44,0)
 . ; Set the filter for CPT only using CS APIs - format is the same as for DIC("S")
"RTN","ORWPCE4",45,0)
 . S ^TMP("LEXSCH",$J,"FIL",0)="I $L($$CPTONE^LEXU(+Y,$G(ORDATE)))!($L($$CPCONE^LEXU(+Y,$G(ORDATE))))"  ;DBIA 1609
"RTN","ORWPCE4",46,0)
 . ; Set Applications Default Flag (Lexicon can not overwrite filter)
"RTN","ORWPCE4",47,0)
 . S ^TMP("LEXSCH",$J,"ADF",0)=1
"RTN","ORWPCE4",48,0)
 ; setup and/or search
"RTN","ORWPCE4",49,0)
 S X=$$UP^XLFSTR(X)
"RTN","ORWPCE4",50,0)
 ; execute the search
"RTN","ORWPCE4",51,0)
 D SRCH(.LST,X,APP,SUBSET,ORDATE,ORINCSYN)
"RTN","ORWPCE4",52,0)
LEXX K ^TMP("LEXFND",$J),^TMP("LEXHIT",$J),^TMP("LEXSCH",$J),^TMP("LEXLE",$J)
"RTN","ORWPCE4",53,0)
 Q
"RTN","ORWPCE4",54,0)
SRCH(LST,X,APP,SUBSET,ORDATE,ORINCSYN) ; call LOOK^LEXA to execute the search
"RTN","ORWPCE4",55,0)
 N LEX,I,IEN,ILST
"RTN","ORWPCE4",56,0)
 D LOOK^LEXA(X,APP,1,SUBSET,ORDATE)
"RTN","ORWPCE4",57,0)
 I '$D(LEX("LIST",1)) D  G LEXX
"RTN","ORWPCE4",58,0)
 . S LST(1)="-1^No matches found.^"_APP
"RTN","ORWPCE4",59,0)
 S ILST=0
"RTN","ORWPCE4",60,0)
 S LEX("LIST",1)=$$LEXXFRM(LEX("LIST",1),ORDATE,APP)
"RTN","ORWPCE4",61,0)
 I $S(APP="GMPX":1,APP="ICD":1,1:0),($P(LEX("LIST",1),U,6)'="799.9") D  I 1
"RTN","ORWPCE4",62,0)
 . I APP="ICD",($E($P(LEX("LIST",1),U,3),1,3)'="ICD") Q
"RTN","ORWPCE4",63,0)
 . S LST(1)=LEX("LIST",1),ILST=1
"RTN","ORWPCE4",64,0)
 E  S LST(1)=LEX("LIST",1),ILST=1
"RTN","ORWPCE4",65,0)
 I APP="GMPX",+$G(ORINCSYN) D SYNONYMS(.LST,.ILST,"SCT",$P(LST(1),U,4),ORDATE)
"RTN","ORWPCE4",66,0)
 S (I,IEN)=""
"RTN","ORWPCE4",67,0)
 F  S I=$O(^TMP("LEXFND",$J,I)) Q:I=""  D  ;DBIA 2950
"RTN","ORWPCE4",68,0)
 .F  S IEN=$O(^TMP("LEXFND",$J,I,IEN)) Q:IEN=""  D
"RTN","ORWPCE4",69,0)
 ..N TXT,ELEMENT S TXT=^TMP("LEXFND",$J,I,IEN)
"RTN","ORWPCE4",70,0)
 ..S ELEMENT=IEN_U_TXT
"RTN","ORWPCE4",71,0)
 ..S ELEMENT=$$LEXXFRM(ELEMENT,ORDATE,APP) Q:$S(APP="GMPX":1,APP="ICD":1,1:0)&($P(ELEMENT,U,6)="799.9")
"RTN","ORWPCE4",72,0)
 ..I APP="ICD",($E($P(ELEMENT,U,3),1,3)'="ICD") Q
"RTN","ORWPCE4",73,0)
 ..S ILST=ILST+1,LST(ILST)=ELEMENT
"RTN","ORWPCE4",74,0)
 ..I APP="GMPX",+$G(ORINCSYN) D SYNONYMS(.LST,.ILST,"SCT",$P(LST(ILST),U,4),ORDATE)
"RTN","ORWPCE4",75,0)
 I '$D(LST(1)) S LST(1)="-1^No matches found.^"_APP
"RTN","ORWPCE4",76,0)
 Q
"RTN","ORWPCE4",77,0)
LEXXFRM(ORX,ORDATE,ORAPP) ; Transform text for SCT look-up
"RTN","ORWPCE4",78,0)
 N ORLEX,ORY,ORICD,ORSCT,ORTXT,ORCODSYS,ORCCODE,ORDCODE
"RTN","ORWPCE4",79,0)
 S ORLEX=$P(ORX,U),ORTXT=$P(ORX,U,2),(ORCCODE,ORCODSYS)=""
"RTN","ORWPCE4",80,0)
 I ORTXT["*" S ORTXT=$$STRIP^XLFSTR(ORTXT,"*")
"RTN","ORWPCE4",81,0)
 I (ORTXT["("),(ORTXT[")") D
"RTN","ORWPCE4",82,0)
 . S ORCODSYS=$RE($P($P($RE(ORTXT),"("),")",2))
"RTN","ORWPCE4",83,0)
 . S ORCCODE=$S(ORTXT["SNOMED":$$ONE^LEXU(+ORLEX,ORDATE,"SCT"),1:$RE($P($RE(ORCODSYS)," ")))
"RTN","ORWPCE4",84,0)
 . S ORCODSYS=$RE($P($RE(ORCODSYS)," ",2,99))
"RTN","ORWPCE4",85,0)
 . S ORTXT=$$TRIM^XLFSTR($RE($P($RE(ORTXT),"(",2,99)))
"RTN","ORWPCE4",86,0)
 S ORY=$$SETELEM(ORLEX,ORTXT,ORCODSYS,ORCCODE,ORDATE)
"RTN","ORWPCE4",87,0)
 Q ORY
"RTN","ORWPCE4",88,0)
SYNONYMS(LST,ILST,ORCSYS,ORCCODE,ORDT) ; Get synonyms for expression
"RTN","ORWPCE4",89,0)
 N ORSYN,ORI,ORDAD S ORDT=$G(ORDT,DT),ORDAD=ILST
"RTN","ORWPCE4",90,0)
 D GETSYN^LEXTRAN1(ORCSYS,ORCCODE,ORDT,"ORSYN",1,1)
"RTN","ORWPCE4",91,0)
 S ORI=0 F  S ORI=$O(ORSYN("S",ORI)) Q:+ORI'>0  D
"RTN","ORWPCE4",92,0)
 . N ELEMENT,TXT,IEN,ORDCODE
"RTN","ORWPCE4",93,0)
 . S IEN=$P(ORSYN("S",ORI),U,2),TXT=$P(ORSYN("S",ORI),U),ORDCODE=$P(ORSYN("S",ORI),U,3)
"RTN","ORWPCE4",94,0)
 . S ELEMENT=$$SETELEM(IEN,TXT,"SNOMED CT",ORCCODE,ORDT,ORDCODE)_U_ORDAD
"RTN","ORWPCE4",95,0)
 . S ILST=ILST+1,LST(ILST)=ELEMENT
"RTN","ORWPCE4",96,0)
 Q
"RTN","ORWPCE4",97,0)
SETELEM(ORLEX,ORTXT,ORCODSYS,ORCCODE,ORDATE,ORDCODE) ; Set List Element
"RTN","ORWPCE4",98,0)
 ;LEXIEN^PREFTEXT^CODESYS^CONCEPTID^ICDVER^ICDCODE^DESIGID^PARENTSUBSCRIPT
"RTN","ORWPCE4",99,0)
 N ORY,ORIMPDT,ORICD,ORSYN,ORTYP,ORQT,ORNUM
"RTN","ORWPCE4",100,0)
 S ORIMPDT=$$IMPDATE^LEXU("10D"),(ORTYP,ORQT,ORNUM)=""
"RTN","ORWPCE4",101,0)
 S ORY=ORLEX_U_ORTXT_U_ORCODSYS_U_ORCCODE
"RTN","ORWPCE4",102,0)
 I $S(ORCODSYS["SNOMED":1,ORCODSYS["VHAT":1,1:0) D
"RTN","ORWPCE4",103,0)
 . S ORY=ORY_U_$S(ORDATE<ORIMPDT:"ICD-9-CM",1:"ICD-10-CM"),ORICD=""
"RTN","ORWPCE4",104,0)
 . S ORICD=$$GETDX^ORQQPL1(ORCCODE,ORCODSYS,ORDATE)
"RTN","ORWPCE4",105,0)
 . I '$D(ORDCODE) D
"RTN","ORWPCE4",106,0)
 . . S ORDCODE=$$GETSYN^LEXTRAN1("SCT",ORCCODE,ORDATE,"ORSYN",1,1)
"RTN","ORWPCE4",107,0)
 . . I $P(ORDCODE,U)'=1 S ORDCODE="" Q
"RTN","ORWPCE4",108,0)
 . . F  S ORTYP=$O(ORSYN(ORTYP)) Q:ORTYP="S"!(ORQT)  D
"RTN","ORWPCE4",109,0)
 . . . I $P(ORSYN(ORTYP),U)=ORTXT S ORDCODE=$P(ORSYN(ORTYP),U,3),ORQT=1 Q
"RTN","ORWPCE4",110,0)
 . . I ORTYP="S" F  S ORNUM=$O(ORSYN(ORTYP,ORNUM)) Q:ORNUM=""!(ORQT)  D
"RTN","ORWPCE4",111,0)
 . . . I $P(ORSYN(ORTYP,ORNUM),U)=ORTXT S ORDCODE=$P(ORSYN(ORTYP,ORNUM),U,3),ORQT=1 Q
"RTN","ORWPCE4",112,0)
 . I ORDCODE["^" S ORDCODE=""
"RTN","ORWPCE4",113,0)
 .S ORY=ORY_U_ORICD_U_ORDCODE
"RTN","ORWPCE4",114,0)
 E  S ORY=ORY_U_U
"RTN","ORWPCE4",115,0)
 Q ORY
"VER")
8.0^22.2
"^DD",100.21,100.21,1.7,0)
SUBSCRIBE^S^Y:YES;N:NO;^0;6^Q
"^DD",100.21,100.21,1.7,3)
YES means users can add or remove themselves as team members (providers).
"^DD",100.21,100.21,1.7,21,0)
^^4^4^3160902^
"^DD",100.21,100.21,1.7,21,1,0)
This field stores either a Y or N (for YES or NO) entry and is used in
"^DD",100.21,100.21,1.7,21,2,0)
CPRS to determine whether or not individual users will be allowed to add
"^DD",100.21,100.21,1.7,21,3,0)
or remove themselves as members of the team list if it is of autolink
"^DD",100.21,100.21,1.7,21,4,0)
or manual type.
"^DD",100.21,100.21,1.7,"DT")
3160902
"BLD",10638,6)
^390
**END**
**END**

