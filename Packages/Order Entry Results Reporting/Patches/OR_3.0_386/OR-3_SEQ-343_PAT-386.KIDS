Released OR*3*386 SEQ #343
Extracted from mail message
**KIDS**:OR*3.0*386^

**INSTALL NAME**
OR*3.0*386
"BLD",9635,0)
OR*3.0*386^ORDER ENTRY/RESULTS REPORTING^0^3140514^y
"BLD",9635,4,0)
^9.64PA^^
"BLD",9635,6.3)
4
"BLD",9635,"ABPKG")
n
"BLD",9635,"INI")
EN^ORY386
"BLD",9635,"INID")
^^y
"BLD",9635,"KRN",0)
^9.67PA^779.2^20
"BLD",9635,"KRN",.4,0)
.4
"BLD",9635,"KRN",.401,0)
.401
"BLD",9635,"KRN",.402,0)
.402
"BLD",9635,"KRN",.403,0)
.403
"BLD",9635,"KRN",.5,0)
.5
"BLD",9635,"KRN",.84,0)
.84
"BLD",9635,"KRN",3.6,0)
3.6
"BLD",9635,"KRN",3.8,0)
3.8
"BLD",9635,"KRN",9.2,0)
9.2
"BLD",9635,"KRN",9.8,0)
9.8
"BLD",9635,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9635,"KRN",9.8,"NM",1,0)
ORMPS2^^0^B50459648
"BLD",9635,"KRN",9.8,"NM",2,0)
ORCDFH1^^0^B24674182
"BLD",9635,"KRN",9.8,"NM",3,0)
ORCMEDT0^^0^B19035854
"BLD",9635,"KRN",9.8,"NM","B","ORCDFH1",2)

"BLD",9635,"KRN",9.8,"NM","B","ORCMEDT0",3)

"BLD",9635,"KRN",9.8,"NM","B","ORMPS2",1)

"BLD",9635,"KRN",19,0)
19
"BLD",9635,"KRN",19.1,0)
19.1
"BLD",9635,"KRN",101,0)
101
"BLD",9635,"KRN",409.61,0)
409.61
"BLD",9635,"KRN",771,0)
771
"BLD",9635,"KRN",779.2,0)
779.2
"BLD",9635,"KRN",870,0)
870
"BLD",9635,"KRN",8989.51,0)
8989.51
"BLD",9635,"KRN",8989.52,0)
8989.52
"BLD",9635,"KRN",8994,0)
8994
"BLD",9635,"KRN","B",.4,.4)

"BLD",9635,"KRN","B",.401,.401)

"BLD",9635,"KRN","B",.402,.402)

"BLD",9635,"KRN","B",.403,.403)

"BLD",9635,"KRN","B",.5,.5)

"BLD",9635,"KRN","B",.84,.84)

"BLD",9635,"KRN","B",3.6,3.6)

"BLD",9635,"KRN","B",3.8,3.8)

"BLD",9635,"KRN","B",9.2,9.2)

"BLD",9635,"KRN","B",9.8,9.8)

"BLD",9635,"KRN","B",19,19)

"BLD",9635,"KRN","B",19.1,19.1)

"BLD",9635,"KRN","B",101,101)

"BLD",9635,"KRN","B",409.61,409.61)

"BLD",9635,"KRN","B",771,771)

"BLD",9635,"KRN","B",779.2,779.2)

"BLD",9635,"KRN","B",870,870)

"BLD",9635,"KRN","B",8989.51,8989.51)

"BLD",9635,"KRN","B",8989.52,8989.52)

"BLD",9635,"KRN","B",8994,8994)

"BLD",9635,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9635,"QUES",0)
^9.62^^
"BLD",9635,"REQB",0)
^9.611^2^2
"BLD",9635,"REQB",1,0)
OR*3.0*363^1
"BLD",9635,"REQB",2,0)
OR*3.0*296^1
"BLD",9635,"REQB","B","OR*3.0*296",2)

"BLD",9635,"REQB","B","OR*3.0*363",1)

"INI")
EN^ORY386
"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
386^3140514
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORCDFH1")
0^2^B24674182^B22101872
"RTN","ORCDFH1",1,0)
ORCDFH1 ;SLC/MKB,DKM - Utility functions for FH dialogs cont ;8/24/01  10:22
"RTN","ORCDFH1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**73,95,243,386**;Dec 17, 1997;Build 4
"RTN","ORCDFH1",3,0)
 ;
"RTN","ORCDFH1",4,0)
RECENT ; -- get 5 most recent diet orders
"RTN","ORCDFH1",5,0)
 N ORDT,ORIFN,ORIT,ORTXT,ORCURR,I,X,CNT,INDT S ORDT=$$NOW^XLFDT,CNT=0
"RTN","ORCDFH1",6,0)
 F  S ORDT=$O(^OR(100,"AW",ORVP,ORDG,ORDT),-1) Q:ORDT'>0  S ORIFN=0 D  Q:CNT'<5
"RTN","ORCDFH1",7,0)
 . F  S ORIFN=$O(^OR(100,"AW",ORVP,ORDG,ORDT,ORIFN)) Q:ORIFN'>0  D  Q:CNT'<5
"RTN","ORCDFH1",8,0)
 .. S (ORIT,ORTXT)="" K ORCURR
"RTN","ORCDFH1",9,0)
 .. S:$P($G(^OR(100,+ORIFN,3)),U,3)=6 ORCURR=1 Q:'$O(^(.1,0))
"RTN","ORCDFH1",10,0)
 .. S I=0 F  S I=$O(^OR(100,ORIFN,.1,I)) Q:I'>0  S X=+$G(^(I,0)) I X D  ;**95
"RTN","ORCDFH1",11,0)
 ... S INDT=$G(^ORD(101.43,X,.1)) S ORIT=ORIT_$S($L(ORIT):";",1:"")_X,ORTXT=ORTXT_$S($L(ORTXT):", ",1:"")_$P($G(^ORD(101.43,X,0)),U)_$S(INDT&(INDT<$$NOW^XLFDT):" (*INACTIVE*)",1:"") ;**95
"RTN","ORCDFH1",12,0)
 .. Q:'ORIT  Q:'$L(ORTXT)  Q:ORTXT="NPO"
"RTN","ORCDFH1",13,0)
 .. S ORDIALOG(PROMPT,"LIST","D",ORIT)=ORIFN ;link oi string to order#
"RTN","ORCDFH1",14,0)
 .. Q:$G(ORCURR)  Q:+$G(ORDIALOG(PROMPT,"LIST","B",ORTXT))
"RTN","ORCDFH1",15,0)
 .. S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=ORIT_U_ORTXT
"RTN","ORCDFH1",16,0)
 .. S ORDIALOG(PROMPT,"LIST","B",ORTXT)=ORIT
"RTN","ORCDFH1",17,0)
 S ORDIALOG(PROMPT,"LIST")=CNT,ORDIALOG(PROMPT,"TOT")=0
"RTN","ORCDFH1",18,0)
 Q
"RTN","ORCDFH1",19,0)
 ;
"RTN","ORCDFH1",20,0)
PTR(X) ; -- Return ptr to Order Dialog file #101.41 for prompt X
"RTN","ORCDFH1",21,0)
 Q +$O(^ORD(101.41,"B","OR GTX "_X,0))
"RTN","ORCDFH1",22,0)
 ;
"RTN","ORCDFH1",23,0)
EXP ; -- Expand old order into instances
"RTN","ORCDFH1",24,0)
 N X,I,P,D S X=$G(ORDIALOG(PROMPT,ORI)) Q:'$L(X)  Q:X'[";"
"RTN","ORCDFH1",25,0)
 S ORDIALOG(PROMPT,ORI)=+X,I=ORI ;1st mod only
"RTN","ORCDFH1",26,0)
 F P=2:1:$L(X,";") S D=$P(X,";",P),I=I+1,ORDIALOG(PROMPT,I)=D,ORDIALOG(PROMPT,"TOT")=+$G(ORDIALOG(PROMPT,"TOT"))+1
"RTN","ORCDFH1",27,0)
 ;S:FIRST MAX=$L(X,";")
"RTN","ORCDFH1",28,0)
 Q
"RTN","ORCDFH1",29,0)
 ;
"RTN","ORCDFH1",30,0)
VALID() ; -- Returns 1 or 0, if selected diet modification is valid
"RTN","ORCDFH1",31,0)
 N Y,NUM,I,TOTAL,OI
"RTN","ORCDFH1",32,0)
 ; p.386 read the total from current OI's in ORDIALOG because ORDIALOG(PROMPT,"TOT") doesn't always exist
"RTN","ORCDFH1",33,0)
 N ITEM S ITEM=0,TOTAL=0 F  S ITEM=$O(ORDIALOG(PROMPT,ITEM)) Q:'ITEM  S TOTAL=TOTAL+1
"RTN","ORCDFH1",34,0)
 I '$D(ORESET) S TOTAL=TOTAL-1
"RTN","ORCDFH1",35,0)
 S OI=$G(ORDIALOG(PROMPT,ORI)) I OI[";" D  Q Y
"RTN","ORCDFH1",36,0)
 .S Y=1 D EXP
"RTN","ORCDFH1",37,0)
 .I $$INACTIVE S Y=0 S ORDIALOG(PROMPT,"TOT")=ORDIALOG(PROMPT,"TOT")-($L(OI,";")-1) F I=0:1:($L(OI,";")-1) K ORDIALOG(PROMPT,(I+ORI)) ;**95
"RTN","ORCDFH1",38,0)
 S Y=1,ORDIALOG(PROMPT,"MAX")=5,MAX=5
"RTN","ORCDFH1",39,0)
 I $$INACTIVE Q 0  ;**95
"RTN","ORCDFH1",40,0)
 ;S:FIRST MAX=$S($G(ORDIALOG(PROMPT,"LIST","D",OI)):1,1:5)
"RTN","ORCDFH1",41,0)
 S OI=$P($G(^ORD(101.43,+OI,0)),U)
"RTN","ORCDFH1",42,0)
 I (OI="REGULAR")!(OI="NPO") D  Q Y
"RTN","ORCDFH1",43,0)
 . I '$D(ORESET),TOTAL=0 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; add first
"RTN","ORCDFH1",44,0)
 . I $G(ORESET),TOTAL'>1 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; edit first
"RTN","ORCDFH1",45,0)
 . S Y=0 W $C(7),!,OI_" may not be ordered with other diets!"
"RTN","ORCDFH1",46,0)
 ;I $$DUP^ORCD(PROMPT,ORI) W $C(7),"This diet has already been selected!" Q 0  ;may delete after testing patch 95
"RTN","ORCDFH1",47,0)
 S NUM=$P($G(^ORD(101.43,+ORDIALOG(PROMPT,ORI),"FH")),U,2) ; precedence #
"RTN","ORCDFH1",48,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D  Q:Y'>0
"RTN","ORCDFH1",49,0)
 . ;p.386 if Regular or NPO diet do not allow other diets to be added
"RTN","ORCDFH1",50,0)
 . Q:I=ORI  Q:($P($G(^ORD(101.43,+ORDIALOG(PROMPT,I),"FH")),U,2)'=NUM)&($P($G(^ORD(101.43,+ORDIALOG(PROMPT,I),0)),U)'="REGULAR")&($P($G(^ORD(101.43,+ORDIALOG(PROMPT,I),0)),U)'="NPO")
"RTN","ORCDFH1",51,0)
 . S Y=0 W $C(7),!,"This diet is not orderable with those already selected!",!
"RTN","ORCDFH1",52,0)
 Q Y
"RTN","ORCDFH1",53,0)
 ;
"RTN","ORCDFH1",54,0)
PREV ; -- Ck if previous diet being reordered
"RTN","ORCDFH1",55,0)
 N I,OI,IFN S OI="",I=0
"RTN","ORCDFH1",56,0)
 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S OI=OI_$S(OI:";",1:"")_ORDIALOG(PROMPT,I)
"RTN","ORCDFH1",57,0)
 S IFN=$S(OI:$G(ORDIALOG(PROMPT,"LIST","D",OI)),1:"")
"RTN","ORCDFH1",58,0)
 S:IFN ORDIALOG("PREV")=IFN K:'IFN ORDIALOG("PREV")
"RTN","ORCDFH1",59,0)
 Q
"RTN","ORCDFH1",60,0)
 ;
"RTN","ORCDFH1",61,0)
CNV ; -- Convert meal abbreviation to time in X [Input Xform]
"RTN","ORCDFH1",62,0)
 ; Expects X,PROMPT [also called from Entry Action, DO^ORWDXM2]
"RTN","ORCDFH1",63,0)
 N A1 S X=$$UP^XLFSTR(X),A1=$P(X,"@",2)
"RTN","ORCDFH1",64,0)
 I A1?1U,"BNE"[A1 D
"RTN","ORCDFH1",65,0)
 . I $G(ORTYPE)="Z" S DATATYPE="",Y=X Q  ;editor - ok
"RTN","ORCDFH1",66,0)
 . N TIMES S TIMES=$S($D(ORPARAM(2)):$P(ORPARAM(2),U,7,9),1:"6:00A^12:00P^6:00P")
"RTN","ORCDFH1",67,0)
 . S A1=$S(A1="B":$P(TIMES,U),A1="N":$P(TIMES,U,2),A1="E":$P(TIMES,U,3),1:A1)
"RTN","ORCDFH1",68,0)
 . S $P(X,"@",2)=A1
"RTN","ORCDFH1",69,0)
 Q
"RTN","ORCDFH1",70,0)
 ;
"RTN","ORCDFH1",71,0)
LKUP ; -- special lookup routine for diet modifications
"RTN","ORCDFH1",72,0)
 G:'$G(ORDIALOG(PROMPT,"LIST")) LKQ N OROOT,Z
"RTN","ORCDFH1",73,0)
 S:X=" " X=$$SPACE^ORCDLG2(DOMAIN) S OROOT=$NA(ORDIALOG(PROMPT,"LIST"))
"RTN","ORCDFH1",74,0)
 S Y=$$FIND^ORCDLG2(OROOT,X)
"RTN","ORCDFH1",75,0)
 I Y Q:X?1N  Q:'$$MORE(X,Y)  S Z=$$OK Q:Z  I Z="^" S Y="^" Q
"RTN","ORCDFH1",76,0)
LKQ D DIC^ORCDLG2
"RTN","ORCDFH1",77,0)
 Q
"RTN","ORCDFH1",78,0)
 ;
"RTN","ORCDFH1",79,0)
MORE(XX,YY) ; -- Returns 1 or 0, if more matches exist
"RTN","ORCDFH1",80,0)
 Q:$P(YY,U)[";" 1 ;multiple mods
"RTN","ORCDFH1",81,0)
 N CNT,XP,NOW S CNT=0,XP=XX,NOW=+$$NOW^XLFDT
"RTN","ORCDFH1",82,0)
 F  S XP=$O(^ORD(101.43,"S.DO",XP)) Q:$E(XP,1,$L(XX))'=XX  D  Q:CNT
"RTN","ORCDFH1",83,0)
 . N IFN S IFN=$O(^ORD(101.43,"S.DO",XP,0)) Q:IFN=+YY  ;same mod
"RTN","ORCDFH1",84,0)
 . I $G(^ORD(101.43,IFN,.1)),$G(^(.1))'>NOW Q  ;inactive
"RTN","ORCDFH1",85,0)
 . S CNT=CNT+1
"RTN","ORCDFH1",86,0)
 Q CNT
"RTN","ORCDFH1",87,0)
 ;
"RTN","ORCDFH1",88,0)
OK() ; -- Verify multiple diet mod selection
"RTN","ORCDFH1",89,0)
 N X,Y,DIR S DIR(0)="YA",DIR("A")="   ... OK? ",DIR("B")="Yes"
"RTN","ORCDFH1",90,0)
 S DIR("?")="Enter YES if you wish to re-order this entire diet, or NO to search for another single diet modification"
"RTN","ORCDFH1",91,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y="^"
"RTN","ORCDFH1",92,0)
 Q Y
"RTN","ORCDFH1",93,0)
INACTIVE() ;Check for inactive/duplicate diets in single or multiple modifications ;**95
"RTN","ORCDFH1",94,0)
 N I,Y
"RTN","ORCDFH1",95,0)
 S Y=0
"RTN","ORCDFH1",96,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:'+I  D
"RTN","ORCDFH1",97,0)
 .I $G(^ORD(101.43,ORDIALOG(PROMPT,I),.1)),^(.1)<$$NOW^XLFDT S Y=1 W !,"The ",$P(^ORD(101.43,ORDIALOG(PROMPT,I),0),U)," diet is INACTIVE." Q  ;Quit if inactive diet found in order
"RTN","ORCDFH1",98,0)
 F I=0:1:($L(OI,";")-1) I $$DUP^ORCD(PROMPT,(I+ORI)) S Y=1 W !,"The ",$P(^ORD(101.43,ORDIALOG(PROMPT,(I+ORI)),0),U)," diet has already been selected." ;check for duplicate orders
"RTN","ORCDFH1",99,0)
 Q Y
"RTN","ORCMEDT0")
0^3^B19035854^B17670670
"RTN","ORCMEDT0",1,0)
ORCMEDT0 ;SLC/MKB-Dialog Utilities ;08/06/2007
"RTN","ORCMEDT0",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**46,60,190,215,243,296,386**;Dec 17, 1997;Build 4
"RTN","ORCMEDT0",3,0)
DIALOG(TYPE) ; -- Get Dialog file entry
"RTN","ORCMEDT0",4,0)
 N X,Y,Z,D,DIC,DIE,DIK,DA,DR,DLAYGO,ORPKG,ORDLG,ORIT,OROI,I,IDX
"RTN","ORCMEDT0",5,0)
 S ORPKG="ORDER ENTRY/RESULTS REPORTING",DIC="^ORD(101.41,",DIC(0)="AEQLZ"
"RTN","ORCMEDT0",6,0)
 S DIC("S")="I $P(^(0),U,4)="""_TYPE_"""",DLAYGO=101.41
"RTN","ORCMEDT0",7,0)
 S DIC("A")="Select "_$S(TYPE="Q":"QUICK ORDER",TYPE="O":"ORDER SET",TYPE="A":"ACTION",1:"ORDER DIALOG")_" NAME: "
"RTN","ORCMEDT0",8,0)
 S DIC("DR")="4///"_TYPE_$S(TYPE="D":";7///^S X=ORPKG",1:"")
"RTN","ORCMEDT0",9,0)
D0 S D="AB" D IX^DIC I Y'>0 S ORDLG="^" G DQ
"RTN","ORCMEDT0",10,0)
 S ORDLG=+Y,ORDG=$P(Y(0),U,5) G:'$P(Y,U,3) DQ ; not a new entry
"RTN","ORCMEDT0",11,0)
 I $O(^ORD(101.41,"AB",$P(Y,U,2),0))'=+Y W $C(7),!,"Another entry already exists by this name!",! D DEL(+Y) G D0
"RTN","ORCMEDT0",12,0)
 I TYPE="D" D  G:ORDLG="^" DQ ;new dialog
"RTN","ORCMEDT0",13,0)
 . S DA=ORDLG,DR="5R",DIE=DIC,ORIT=$P(Y,U,2) D ^DIE
"RTN","ORCMEDT0",14,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDLG,0)),U,5)
"RTN","ORCMEDT0",15,0)
 . I 'ORDG W $C(7),!,"Deleting <"_ORIT_"> ..." S DA=ORDLG,DIK=DIC D ^DIK S ORDLG="^" Q
"RTN","ORCMEDT0",16,0)
 . S ORIT=$$OI^ORCMEDT3(+ORDG) S:ORIT="^" ORDLG="^"
"RTN","ORCMEDT0",17,0)
 I TYPE="Q" D  G DQ ;new quick order
"RTN","ORCMEDT0",18,0)
 . S DIC="^ORD(100.98,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,4)"
"RTN","ORCMEDT0",19,0)
 . S DIC("A")="TYPE OF QUICK ORDER: " D ^DIC
"RTN","ORCMEDT0",20,0)
 . I Y>0 S ORDG=+Y,$P(^ORD(101.41,ORDLG,0),U,5)=+Y Q
"RTN","ORCMEDT0",21,0)
 . W !,$P(^ORD(101.41,ORDLG,0),U)_" quick order dialog DELETED!",!
"RTN","ORCMEDT0",22,0)
 . S DA=ORDLG,DIK="^ORD(101.41,",ORDLG="^" D ^DIK
"RTN","ORCMEDT0",23,0)
D1 I $$COPY^ORCMEDIT(TYPE) D  ;copy an existing dialog?
"RTN","ORCMEDT0",24,0)
 . K DLAYGO,DIC("B") S DIC(0)="AEQZ",DIC("A")="Select "_$S(TYPE="Q":"QUICK ORDER",TYPE="O":"ORDER SET",1:"ORDER DIALOG")_" TO COPY: "
"RTN","ORCMEDT0",25,0)
 . D ^DIC Q:Y'>0  W !,"Copying ..."
"RTN","ORCMEDT0",26,0)
 . F I=2,6,8,9 S $P(^ORD(101.41,ORDLG,0),U,I)=$P(Y(0),U,I)
"RTN","ORCMEDT0",27,0)
 . S:TYPE'="D" $P(^ORD(101.41,ORDLG,0),U,5)=$P(Y(0),U,5) ;skip DG if Dlg
"RTN","ORCMEDT0",28,0)
 . S:$L($P(Y(0),U,2)) ^ORD(101.41,"C",$$UP^XLFSTR($P(Y(0),U,2)),ORDLG)="" ;disp text
"RTN","ORCMEDT0",29,0)
 . F I=2,3,3.1,4,5,6,7,9,10 I $D(^ORD(101.41,+Y,I)) M ^ORD(101.41,ORDLG,I)=^ORD(101.41,+Y,I)
"RTN","ORCMEDT0",30,0)
 . I $P(Y(0),U,7) S DA=ORDLG,DIE=DIC,DR="7///"_$P(Y(0),U,7) D ^DIE
"RTN","ORCMEDT0",31,0)
 . K DA S DA(1)=ORDLG,DIK="^ORD(101.41,"_ORDLG_",10,",DIK(1)="2^AD" D ENALL^DIK
"RTN","ORCMEDT0",32,0)
D2 I TYPE="D",$G(ORIT) D  ;stuff in default OI
"RTN","ORCMEDT0",33,0)
 . S DA=ORDLG,DR="2///"_$P(ORIT,U,2),DIE="^ORD(101.41," D ^DIE
"RTN","ORCMEDT0",34,0)
 . S OROI=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),DA=$O(^ORD(101.41,ORDLG,10,"D",OROI,0)) I 'DA D  Q:'DA  ;create OI prompt
"RTN","ORCMEDT0",35,0)
 .. S X=+$O(^ORD(101.41,ORDLG,10,"B",0)),X=$S(X=0:1,1:X-.1) ;get Seq#
"RTN","ORCMEDT0",36,0)
 .. K DA,DIC S DIC="^ORD(101.41,"_ORDLG_",10,",DIC(0)="L",DA(1)=ORDLG
"RTN","ORCMEDT0",37,0)
 .. D ^DIC Q:Y'>0  S DA=+Y ;S DIC("P")=$P(^DD(101.41,10,0),U,2)
"RTN","ORCMEDT0",38,0)
 .. S Z=+$O(^ORD(101.41,ORDLG,10,"ATXT",0)),Z=$S(Z=0:1,1:Z-.1) ;TxtSeq#
"RTN","ORCMEDT0",39,0)
 .. S ^ORD(101.41,ORDLG,10,DA,0)=X_U_OROI_"^^Order: ^^1",^(2)=Z
"RTN","ORCMEDT0",40,0)
 .. S ^ORD(101.41,"AD",OROI,ORDLG,DA)="",^ORD(101.41,ORDLG,10,"B",X,DA)="",^ORD(101.41,ORDLG,10,"D",OROI,DA)="",^ORD(101.41,ORDLG,10,"ATXT",X,DA)=""
"RTN","ORCMEDT0",41,0)
 . S IDX="S."_$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORCMEDT0",42,0)
 . S $P(^ORD(101.41,ORDLG,10,DA,0),U,8)=1,$P(^(0),U,10)=IDX,^(3)="I 0 ;uneditable",^(7)="S Y="_+ORIT
"RTN","ORCMEDT0",43,0)
DQ Q ORDLG
"RTN","ORCMEDT0",44,0)
 ;
"RTN","ORCMEDT0",45,0)
DEL(DA) ; -- delete bad entry in Order Dialog file
"RTN","ORCMEDT0",46,0)
 N DIK S DIK="^ORD(101.41," D:$G(DA) ^DIK
"RTN","ORCMEDT0",47,0)
 Q
"RTN","ORCMEDT0",48,0)
 ;
"RTN","ORCMEDT0",49,0)
SAVE ; -- Save ORDG, responses in ORDIALOG to dialog ORQDLG
"RTN","ORCMEDT0",50,0)
 N PROMPT,CNT,ITM,TYPE,INST,ICNT,VALUE,INP,UD K ^ORD(101.41,ORQDLG,6)
"RTN","ORCMEDT0",51,0)
 S (PROMPT,CNT)=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCMEDT0",52,0)
 . S ITM=ORDIALOG(PROMPT),TYPE=$E(ORDIALOG(PROMPT,0))
"RTN","ORCMEDT0",53,0)
 . S INST=0,ICNT=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCMEDT0",54,0)
 . . S VALUE=$G(ORDIALOG(PROMPT,INST)),CNT=CNT+1,ICNT=ICNT+1
"RTN","ORCMEDT0",55,0)
 . . S ^ORD(101.41,ORQDLG,6,CNT,0)=+ITM_U_PROMPT_U_ICNT ;p.386 changed 3rd piece from INST to ICNT (This reorders instances if one was deleted) 
"RTN","ORCMEDT0",56,0)
 . . S:TYPE'="W" ^ORD(101.41,ORQDLG,6,CNT,1)=VALUE
"RTN","ORCMEDT0",57,0)
 . . M:TYPE="W" ^ORD(101.41,ORQDLG,6,CNT,2)=@VALUE
"RTN","ORCMEDT0",58,0)
 . . S ^ORD(101.41,ORQDLG,6,"D",PROMPT,CNT)=""
"RTN","ORCMEDT0",59,0)
 S ^ORD(101.41,ORQDLG,6,0)="^101.416^"_CNT_U_CNT
"RTN","ORCMEDT0",60,0)
 S INP=+$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",""))
"RTN","ORCMEDT0",61,0)
 S UD=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",""))
"RTN","ORCMEDT0",62,0)
 I +$G(ORDG)>0,ORDG=INP,UD>0 S ORDG=UD
"RTN","ORCMEDT0",63,0)
 S:$G(ORDG) $P(^ORD(101.41,ORQDLG,0),U,5)=+ORDG
"RTN","ORCMEDT0",64,0)
 Q
"RTN","ORCMEDT0",65,0)
 ;
"RTN","ORCMEDT0",66,0)
ITEM(Z) ; -- Select new item to add
"RTN","ORCMEDT0",67,0)
 N X,Y,DIC,ORDDF,ORERR,I
"RTN","ORCMEDT0",68,0)
 S DIC=101.41,DIC(0)="AEQM",DIC("A")="ITEM: "
"RTN","ORCMEDT0",69,0)
 I $G(Z) S Z=$P($G(^ORD(101.41,+Z,0)),U) S:$L(Z) DIC("B")=Z
"RTN","ORCMEDT0",70,0)
 S DIC("S")="I $P(^(0),U,4)'=""P"""
"RTN","ORCMEDT0",71,0)
IT1 D ^DIC I Y'>0 S Y=$S($D(DUOUT)!$D(DTOUT):"^",1:"") Q Y
"RTN","ORCMEDT0",72,0)
 D RECURSV^ORCMEDT5(+Y,+ORMENU,.ORERR) I $D(ORERR) D  G IT1
"RTN","ORCMEDT0",73,0)
 . W $C(7),!!,"If an item is already included on this menu, it may not be added!"
"RTN","ORCMEDT0",74,0)
 . W !,ORERR S I=0 F  S I=$O(ORERR(I)) Q:I'>0  W !?18," =>"_ORERR(I)
"RTN","ORCMEDT0",75,0)
 Q +Y
"RTN","ORMPS2")
0^1^B50459648^B49592916
"RTN","ORMPS2",1,0)
ORMPS2 ;SLC/MKB - Process Pharmacy ORM msgs cont ;10/01/2009
"RTN","ORMPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,129,134,186,190,195,215,265,243,280,363,386**;Dec 17, 1997;Build 4
"RTN","ORMPS2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORMPS2",4,0)
 ;
"RTN","ORMPS2",5,0)
FINISHED() ; -- new order [SN^ORMPS] due to finishing?
"RTN","ORMPS2",6,0)
 N Y,ORIG,TYPE,ORIG4 S Y=0
"RTN","ORMPS2",7,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4),ORIG4=$G(^OR(100,ORIG,4))
"RTN","ORMPS2",8,0)
 I ORIG,TYPE="E",ORIG4?1.N1"P"!(ORIG4?1.N1"S") S ORIFN=+ORIG,Y=1
"RTN","ORMPS2",9,0)
 Q Y
"RTN","ORMPS2",10,0)
 ;
"RTN","ORMPS2",11,0)
WPX() ; -- Compare comments in @ORMSG@(NTE) with order ORIFN
"RTN","ORMPS2",12,0)
 ;     Returns 1 if different, or 0 if same
"RTN","ORMPS2",13,0)
 N NTE,SPINST,Y,X S Y=0
"RTN","ORMPS2",14,0)
 S NTE=+$$NTE^ORMPS3(21),SPINST=$S(NTE:$$NTXT^ORMPS3(NTE),1:"")
"RTN","ORMPS2",15,0)
 S X=$$VALTXT^ORMPS3(+ORIFN,"COMMENT")
"RTN","ORMPS2",16,0)
 I $TR(X," ")'=$TR(SPINST," ") S Y=1 ;comp text w/o spaces
"RTN","ORMPS2",17,0)
WQ Q Y
"RTN","ORMPS2",18,0)
 ;
"RTN","ORMPS2",19,0)
IVX() ; -- Compare ORMSG to Inpt order ORIFN if IV, return 0 if 'diff or 'IV
"RTN","ORMPS2",20,0)
 N Y,ADDFREQ,RXC,DG,OI,PSOI,XC,X,RATE,RXR,ORA,ORB,ORX,I,J,OI0,INST,VOL,STR,UNT
"RTN","ORMPS2",21,0)
 S RXC=$$RXC^ORMPS,Y=0 I RXC'>0 Q Y  ;not IV of any kind
"RTN","ORMPS2",22,0)
 S DG=+$P($G(^OR(100,+ORIFN,0)),U,11),DG=$P($G(^ORD(100.98,DG,0)),U,3)
"RTN","ORMPS2",23,0)
 I DG'="IV RX",DG'="TPN" D  Q Y  ;not fluid
"RTN","ORMPS2",24,0)
 . I $P(ZRX,"|",7)'="" S Y=1 Q
"RTN","ORMPS2",25,0)
 . I $$NUMADDS^ORMPS3>1 S Y=1 Q
"RTN","ORMPS2",26,0)
 . S OI=$$VALUE("ORDERABLE"),PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORMPS2",27,0)
 . S XC=@ORMSG@(RXC) I PSOI'=$P(XC,U,4) S Y=1 Q
"RTN","ORMPS2",28,0)
 . N X1,X2,X3 S X1=$P(XC,"|",4),X2=$P($P(XC,"|",5),U,5)
"RTN","ORMPS2",29,0)
 . S X3=$$VALUE("INSTR") I (X1_X2)'=X3,(X1_" "_X2)'=X3 S Y=1 Q
"RTN","ORMPS2",30,0)
IV1 S RATE=$$FIND^ORM(+RXE,24),UNT=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS2",31,0)
 S:$L(UNT) RATE=RATE_" "_UNT S X=$$VALUE("RATE") I RATE'=X D  Q:Y Y
"RTN","ORMPS2",32,0)
 . S:RATE["@" RATE=$P(RATE,"@") S:X["@" X=$P(X,"@") ;rate@labels
"RTN","ORMPS2",33,0)
 . I RATE'=X S Y=1 Q
"RTN","ORMPS2",34,0)
 I $P(ZRX,"|",7)'=$$VALUE("TYPE") S Y=1 Q Y
"RTN","ORMPS2",35,0)
 S RXR=$$RXR^ORMPS
"RTN","ORMPS2",36,0)
 I $P($P(RXR,"|",2),U,4)'=$$VALUE("ROUTE") S Y=1 Q Y
"RTN","ORMPS2",37,0)
 S ORB=+$$PTR("ORDERABLE ITEM"),ORA=+$$PTR("ADDITIVE"),I=+RXC
"RTN","ORMPS2",38,0)
 F  S XC=@ORMSG@(I) Q:$E(XC,1,3)'="RXC"  D  S I=$O(@ORMSG@(I)) Q:I'>0
"RTN","ORMPS2",39,0)
 . S ORX($P(XC,"|",2),+$P(XC,U,4))=$P(XC,"|",4)_U_$P($P(XC,"|",5),U,5)_U_$P(XC,"|",6)
"RTN","ORMPS2",40,0)
 . ;ORX("A",PSOI)=str^units^bag or ORX("B",PSOI)=volume^units^null
"RTN","ORMPS2",41,0)
 F I="STRENGTH","UNITS","VOLUME","ADDFREQ" D  ;ORX(I,inst)=value
"RTN","ORMPS2",42,0)
 . S J=0 F  S J=$O(^OR(100,+ORIFN,4.5,"ID",I,J)) Q:J'>0  D
"RTN","ORMPS2",43,0)
 .. S INST=+$P($G(^OR(100,+ORIFN,4.5,J,0)),U,3)
"RTN","ORMPS2",44,0)
 .. S:INST ORX(I,INST)=$G(^OR(100,+ORIFN,4.5,J,1))
"RTN","ORMPS2",45,0)
 S I=0 F  S I=$O(^OR(100,+ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORMPS2",46,0)
 . S OI0=$G(^OR(100,+ORIFN,4.5,I,0)),OI=+$G(^(1))
"RTN","ORMPS2",47,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORMPS2",48,0)
 . I $P(OI0,U,2)=ORA,$G(ORX("A",PSOI)) D  Q
"RTN","ORMPS2",49,0)
 .. S INST=$P(OI0,U,3),STR=+ORX("A",PSOI),UNT=$P(ORX("A",PSOI),U,2)
"RTN","ORMPS2",50,0)
 .. S ADDFREQ=$P(ORX("A",PSOI),U,3)
"RTN","ORMPS2",51,0)
 .. I STR'=$G(ORX("STRENGTH",INST)) S Y=1 Q
"RTN","ORMPS2",52,0)
 .. I UNT'=$G(ORX("UNITS",INST)) S Y=1 Q
"RTN","ORMPS2",53,0)
 .. I $$ADDFRQCV^ORMBLDP1(ADDFREQ,"I")'=$G(ORX("ADDFREQ",INST)) S Y=1 Q
"RTN","ORMPS2",54,0)
 .. K ORX("A",PSOI) ;same
"RTN","ORMPS2",55,0)
 . I $P(OI0,U,2)=ORB,$G(ORX("B",PSOI)) D  Q
"RTN","ORMPS2",56,0)
 .. S INST=$P(OI0,U,3),VOL=+$G(ORX("B",PSOI))
"RTN","ORMPS2",57,0)
 .. I VOL'=$G(ORX("VOLUME",INST)) S Y=1 Q
"RTN","ORMPS2",58,0)
 .. K ORX("B",PSOI) ;same
"RTN","ORMPS2",59,0)
 . S Y=1
"RTN","ORMPS2",60,0)
 I $O(ORX("A",0))!$O(ORX("B",0)) S Y=1 ;leftover items - changed
"RTN","ORMPS2",61,0)
 Q Y
"RTN","ORMPS2",62,0)
 ;
"RTN","ORMPS2",63,0)
CHANGED() ; -- Compare ORMSG to order ORIFN, return 1 if different
"RTN","ORMPS2",64,0)
 N I,X,Y,X1,NTE,SIG,PI,TRXO S Y=0
"RTN","ORMPS2",65,0)
 I +$P($$FIND^ORM(+RXE,3),U,4)'=+$$VALUE("DRUG") S Y=1 G CHQ ;p.363 dispense drug change check
"RTN","ORMPS2",66,0)
 I $G(ORCAT)="I" D  G CHQ
"RTN","ORMPS2",67,0)
 . I $$FIND^ORM(+RXE,2)'=$$VALUE("SCHEDULE") S Y=1 Q  ;p386 added schedule check
"RTN","ORMPS2",68,0)
 . I $$WPX S Y=1 Q  ;Special Instructions
"RTN","ORMPS2",69,0)
 . S X=$$VALUE("DAYS") ;duration
"RTN","ORMPS2",70,0)
 . I $G(X)'="" D  I $G(X)'=X1 S Y=1 Q
"RTN","ORMPS2",71,0)
 . .S X=$$HL7IVLMT^ORMBLDP1(X)
"RTN","ORMPS2",72,0)
 . .S TRXO=$$RXO^ORMPS,X1=$P($P($G(TRXO),"|",2),U,3)
"RTN","ORMPS2",73,0)
 . .;S X1=$$DURATION^ORMPS3($P($P(TRXO,"|",2),U,3))
"RTN","ORMPS2",74,0)
 . I $$IVX S Y=1 Q  ;IV fields
"RTN","ORMPS2",75,0)
 ;S X=+$P($P(RXE,"|",3),U,4) I X'=+$$VALUE("DRUG") S Y=1 G CHQ
"RTN","ORMPS2",76,0)
 I +$$FIND^ORM(+RXE,11)'=+$$VALUE("QTY") S Y=1 G CHQ ;p.363 changed to $$FIND^ORM api
"RTN","ORMPS2",77,0)
 I +$$FIND^ORM(+RXE,13)'=+$$VALUE("REFILLS") S Y=1 G CHQ ;p.363 changed to $$FIND^ORM api
"RTN","ORMPS2",78,0)
 ;S X=$P(RXE,"|",23) S:$E(X)="D" X=+$E(X,2,99) I X'=+$$VALUE("SUPPLY") S Y=1 G CHQ
"RTN","ORMPS2",79,0)
 ;I $P(ZRX,"|",5)'=$$VALUE("PICKUP") S Y=1 G CHQ
"RTN","ORMPS2",80,0)
 S NTE=$$NTE^ORMPS3(21),SIG=+$O(^OR(100,+ORIFN,4.5,"ID","SIG",0)) ;verb
"RTN","ORMPS2",81,0)
 I NTE,SIG,$P($P(@ORMSG@(NTE),"|",4)," ")'=$P($G(^OR(100,+ORIFN,4.5,SIG,2,1,0))," ") S Y=1 G CHQ
"RTN","ORMPS2",82,0)
 S NTE=$$NTE^ORMPS3(7),PI=+$O(^OR(100,+ORIFN,4.5,"ID","PI",0))
"RTN","ORMPS2",83,0)
 I (NTE&'PI)!('NTE&PI) Q 1 ;added or deleted
"RTN","ORMPS2",84,0)
 I NTE,PI D  G CHQ ;compare text
"RTN","ORMPS2",85,0)
 . S PI=$$VALTXT^ORMPS3(+ORIFN,PI)_$$VALTXT^ORMPS3(+ORIFN,"COMMENT")
"RTN","ORMPS2",86,0)
 . S NTE=$$NTXT^ORMPS3(NTE)
"RTN","ORMPS2",87,0)
 . I $TR(NTE," ")'=$TR(PI," ") S Y=1 Q  ;comp text w/o spaces
"RTN","ORMPS2",88,0)
CHQ Q Y
"RTN","ORMPS2",89,0)
 ;
"RTN","ORMPS2",90,0)
VALUE(ID) ; -- Return value of ID in ^OR(100,+ORIFN,4.5,"ID")
"RTN","ORMPS2",91,0)
 N I,Y I '$L($G(ID)) Q ""
"RTN","ORMPS2",92,0)
 S I=+$O(^OR(100,+ORIFN,4.5,"ID",ID,0))
"RTN","ORMPS2",93,0)
 S Y=$G(^OR(100,+ORIFN,4.5,I,1))
"RTN","ORMPS2",94,0)
 Q Y
"RTN","ORMPS2",95,0)
 ;
"RTN","ORMPS2",96,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORMPS2",97,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORMPS2",98,0)
 ;
"RTN","ORMPS2",99,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS2",100,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORDA,ORX,ORSIG,ORP,ZSC,NEWSTS
"RTN","ORMPS2",101,0)
 N ADMIN,IVTYPE
"RTN","ORMPS2",102,0)
 K ^TMP("ORWORD",$J)
"RTN","ORMPS2",103,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS2",104,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS2",105,0)
 S RXO=$$RXO^ORMPS,RXC=$$RXC^ORMPS,ORIFN=+$G(ORIFN)
"RTN","ORMPS2",106,0)
 I ORIFN'>0 S ORERR="Missing or invalid order number" Q
"RTN","ORMPS2",107,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS2",108,0)
 ;Check keep Admin Time with order if not define in the RXE segment on
"RTN","ORMPS2",109,0)
 ;verify
"RTN","ORMPS2",110,0)
 I RXC,$$VALUE("TYPE")="I" S ORDIALOG($$PTR("ADMIN TIMES"),1)=$$VALUE("ADMIN")
"RTN","ORMPS2",111,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,"",ORNOW,ORWHO)
"RTN","ORMPS2",112,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS2",113,0)
RO1 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMPS2",114,0)
 S ORX=ORDA F  S ORX=+$O(^OR(100,ORIFN,8,ORX),-1) Q:ORX'>0  I $D(^(ORX,0)),$P(^(0),U,15)="" Q  ;ORX=last released action
"RTN","ORMPS2",115,0)
 S:ORX $P(^OR(100,ORIFN,8,ORX,0),U,15)=12 ;dc/edit
"RTN","ORMPS2",116,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA,NEWSTS=$S('$G(ORSTS):0,ORSTS=$P(^(3),U,3):0,1:1) K ^(6)
"RTN","ORMPS2",117,0)
 D STATUS^ORCSAVE2(ORIFN,ORSTS):NEWSTS,SETALL^ORDD100(ORIFN):'NEWSTS
"RTN","ORMPS2",118,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS2",119,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS2",120,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMPS2",121,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMPS2",122,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMPS2",123,0)
RO2 ; -Update responses, get/save new order text:
"RTN","ORMPS2",124,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMPS2",125,0)
 S $P(^OR(100,ORIFN,0),U,5)=ORDIALOG_";ORD(101.41,",$P(^(0),U,14)=ORPKG
"RTN","ORMPS2",126,0)
 ;I $P(^OR(100,ORIFN,0),U,11)'=ORDG D  ;update DG,xrefs
"RTN","ORMPS2",127,0)
 ;AGP Changes to handle IMO IV orders CPRS 26v43
"RTN","ORMPS2",128,0)
 I $P(^OR(100,ORIFN,0),U,11)'=ORDG,$P(^OR(100,ORIFN,0),U,11)'=$O(^ORD(100.98,"B","CLINIC ORDERS","")) D
"RTN","ORMPS2",129,0)
 . N DA,DR,DIE
"RTN","ORMPS2",130,0)
 . S DA=ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS2",131,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(8,ORDA,0),U,14)=ORDA
"RTN","ORMPS2",132,0)
 S ORIFN=ORIFN_";"_ORDA,ORDCNTRL="SN" ;to send NA msg back
"RTN","ORMPS2",133,0)
 I $G(ORL) S ORP(1)=ORIFN_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS2",134,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS3 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,9),"|","^") ;1 or 0 instead of [N]SC in #100
"RTN","ORMPS2",135,0)
 Q
"RTN","ORMPS2",136,0)
IVLIM(IVDUR) ;
"RTN","ORMPS2",137,0)
 I $L(IVDUR) D
"RTN","ORMPS2",138,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORMPS2",139,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORMPS2",140,0)
 . I IVDUR["dose" S DURV=$E(IVDUR,6,$L(IVDUR)),IVDUR="for a total of "_+DURV_$S(+DURV=1:" doses",+DURV>1:" doses",1:" dose") Q
"RTN","ORMPS2",141,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORMPS2",142,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORMPS2",143,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORMPS2",144,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORMPS2",145,0)
 Q IVDUR
"RTN","ORMPS2",146,0)
UNESC(STRING) ;
"RTN","ORMPS2",147,0)
 Q $$UNESC^ORHLESC(STRING)
"RTN","ORMPS2",148,0)
UNESCARR(ARR) ;
"RTN","ORMPS2",149,0)
 N I S I="" F  S I=$O(@ARR@(I)) Q:'$L(I)  D
"RTN","ORMPS2",150,0)
 .N IND S IND=$S(ARR["(":$E(ARR,0,$L(ARR)-1)_","""_I_""")",1:ARR_"("""_I_""")")
"RTN","ORMPS2",151,0)
 .N TYPE S TYPE=$D(@ARR@(I))
"RTN","ORMPS2",152,0)
 .I TYPE=11!(TYPE=10) D UNESCARR(IND)
"RTN","ORMPS2",153,0)
 .I TYPE=1!(TYPE=11) S @ARR@(I)=$$UNESC(@ARR@(I))
"RTN","ORMPS2",154,0)
 Q
"RTN","ORMPS2",155,0)
PCOMM ; -- Get Provider Comments from previous order, when changed
"RTN","ORMPS2",156,0)
 N OLD,I
"RTN","ORMPS2",157,0)
 S OLD=+$G(ORIFN) I OLD<1 S OLD=+$P(ZRX,"|",2) Q:OLD<1
"RTN","ORMPS2",158,0)
 S I=+$O(^OR(100,OLD,4.5,"ID","COMMENT",0)) Q:I<1
"RTN","ORMPS2",159,0)
 Q:'$O(^OR(100,OLD,4.5,I,2,0))  ;none
"RTN","ORMPS2",160,0)
 M ^TMP("ORWORD",$J,PC,1)=^OR(100,OLD,4.5,I,2)
"RTN","ORMPS2",161,0)
 S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS2",162,0)
 S ORDIALOG(PC,"FORMAT")="@" ;text in Sig already
"RTN","ORMPS2",163,0)
 Q
"RTN","ORY386")
0^^B9828447^n/a
"RTN","ORY386",1,0)
ORY386 ;MWA/VMP - PRE/POST INSTALL FOR PATCH OR*3.0*386 ; 3/12/14 12:27pm
"RTN","ORY386",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**386**;;Build 4
"RTN","ORY386",3,0)
 Q
"RTN","ORY386",4,0)
EN ;entry point
"RTN","ORY386",5,0)
 N ORX,DLG0,MSGCNT,ORMSG,DIETDG,FAILREGS
"RTN","ORY386",6,0)
 S DIETDG=$O(^ORD(100.98,"B","DIET ORDERS",0))
"RTN","ORY386",7,0)
 S ORX=0,MSGCNT=4
"RTN","ORY386",8,0)
 F  S ORX=$O(^ORD(101.41,ORX)) Q:'ORX  I $G(^ORD(101.41,ORX,0))'="" S DLG0=^ORD(101.41,ORX,0) D
"RTN","ORY386",9,0)
 .Q:$P(DLG0,U,4)'="Q"
"RTN","ORY386",10,0)
 .N DLG S DLG=0 F  S DLG=$O(^ORD(101.41,ORX,6,"D",DLG)) Q:'DLG  D
"RTN","ORY386",11,0)
 ..I DLG=4,$P(DLG0,U,5)=DIETDG D REGCHK
"RTN","ORY386",12,0)
 ..N RPIEN S RPIEN=0,RPIEN=$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) I RPIEN,$$OUTAORD D FIXORD
"RTN","ORY386",13,0)
 D ADDREGS,MAIL
"RTN","ORY386",14,0)
 Q
"RTN","ORY386",15,0)
OUTAORD() ; are the instances out of order?
"RTN","ORY386",16,0)
 N INCHK,FAIL S INCHK=0,RPIEN=0,FAIL=0
"RTN","ORY386",17,0)
 F  S RPIEN=$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) Q:'RPIEN  D
"RTN","ORY386",18,0)
 .I $D(^ORD(101.41,ORX,6,RPIEN,0)),$P($G(^ORD(101.41,ORX,6,RPIEN,0)),U,3) S INCHK($P($G(^ORD(101.41,ORX,6,RPIEN,0)),U,3))="",INCHK=INCHK+1
"RTN","ORY386",19,0)
 N I F I=1:1:INCHK I '$D(INCHK(I)) S FAIL=1
"RTN","ORY386",20,0)
 I FAIL Q 1
"RTN","ORY386",21,0)
 Q 0
"RTN","ORY386",22,0)
FIXORD ; fix instance order for specific response dialog
"RTN","ORY386",23,0)
 N ICNT S ICNT=1,RPIEN=0 F  S RPIEN=$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) Q:'RPIEN  D
"RTN","ORY386",24,0)
 .N DIE,DA,DR S DIE="^ORD(101.41,"_ORX_",6,",DA(1)=ORX,DA=RPIEN,DR=".03///"_ICNT D ^DIE S ICNT=ICNT+1
"RTN","ORY386",25,0)
 .I '$D(MSGCNT(ORX)) S ORMSG(MSGCNT)=$P($G(^ORD(101.41,ORX,0)),U)_"   IEN - "_ORX,MSGCNT(ORX)="",MSGCNT=MSGCNT+1
"RTN","ORY386",26,0)
 Q
"RTN","ORY386",27,0)
REGCHK ; check for regular/npo diet with another diet on a diet quick order
"RTN","ORY386",28,0)
 N RPIEN S RPIEN=0,RPIEN=$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) I RPIEN,$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) D
"RTN","ORY386",29,0)
 .S RPIEN="" F  S RPIEN=$O(^ORD(101.41,ORX,6,"D",DLG,RPIEN)) Q:'RPIEN  D
"RTN","ORY386",30,0)
 ..N DIET S DIET=+$G(^ORD(101.41,ORX,6,RPIEN,1))
"RTN","ORY386",31,0)
 ..I ($P($G(^ORD(101.43,DIET,0)),U)="REGULAR")!($P($G(^ORD(101.43,+DIET,0)),U)="NPO") S FAILREGS(ORX)=""
"RTN","ORY386",32,0)
 Q
"RTN","ORY386",33,0)
ADDREGS ; add any orders found in REGCHK to mail man message
"RTN","ORY386",34,0)
  I '$D(ORMSG(4)) S MSGCNT=5
"RTN","ORY386",35,0)
  S ORMSG(MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","ORY386",36,0)
  S ORMSG(MSGCNT)="The following Diet Quick orders have both a Regular/NPO and another diet",MSGCNT=MSGCNT+1
"RTN","ORY386",37,0)
  S ORMSG(MSGCNT)="They must be manually edited",MSGCNT=MSGCNT+1
"RTN","ORY386",38,0)
  S ORMSG(MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","ORY386",39,0)
  S FAILREGS="" I '$O(FAILREGS(FAILREGS)) S ORMSG(MSGCNT)="None Found"
"RTN","ORY386",40,0)
  S FAILREGS="" F  S FAILREGS=$O(FAILREGS(FAILREGS)) Q:'FAILREGS  D
"RTN","ORY386",41,0)
  .S ORMSG(MSGCNT)=$P($G(^ORD(101.41,FAILREGS,0)),U)_"   IEN - "_FAILREGS,MSGCNT=MSGCNT+1
"RTN","ORY386",42,0)
  I
"RTN","ORY386",43,0)
  Q
"RTN","ORY386",44,0)
MAIL ; send mailman message
"RTN","ORY386",45,0)
 N XMSUB,XMDUZ,XMTEXT,XMY,DIFROM
"RTN","ORY386",46,0)
 S ORMSG(1)="OR*3.0*386 install routine has completed"
"RTN","ORY386",47,0)
 S ORMSG(2)="The instances for the following quick orders have been changed"
"RTN","ORY386",48,0)
 S ORMSG(3)=" "
"RTN","ORY386",49,0)
 I '$D(ORMSG(4)) S ORMSG(4)="No changes"
"RTN","ORY386",50,0)
 S XMSUB="OR*3.0*386 install routine has completed"
"RTN","ORY386",51,0)
 S XMDUZ="ORDER ENTRY/RESULTS REPORTING PACKAGE"
"RTN","ORY386",52,0)
 S XMTEXT="ORMSG("
"RTN","ORY386",53,0)
 S XMY(DUZ)=""
"RTN","ORY386",54,0)
 D ^XMD
"RTN","ORY386",55,0)
 Q
"VER")
8.0^22.0
"BLD",9635,6)
^343
**END**
**END**

