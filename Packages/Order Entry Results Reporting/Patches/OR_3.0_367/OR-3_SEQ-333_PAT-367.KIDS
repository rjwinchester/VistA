Released OR*3*367 SEQ #333
Extracted from mail message
**KIDS**:OR*3.0*367^

**INSTALL NAME**
OR*3.0*367
"BLD",9194,0)
OR*3.0*367^ORDER ENTRY/RESULTS REPORTING^0^3121107^y
"BLD",9194,4,0)
^9.64PA^^
"BLD",9194,6.3)
2
"BLD",9194,"ABPKG")
n
"BLD",9194,"KRN",0)
^9.67PA^779.2^20
"BLD",9194,"KRN",.4,0)
.4
"BLD",9194,"KRN",.401,0)
.401
"BLD",9194,"KRN",.402,0)
.402
"BLD",9194,"KRN",.403,0)
.403
"BLD",9194,"KRN",.5,0)
.5
"BLD",9194,"KRN",.84,0)
.84
"BLD",9194,"KRN",3.6,0)
3.6
"BLD",9194,"KRN",3.8,0)
3.8
"BLD",9194,"KRN",9.2,0)
9.2
"BLD",9194,"KRN",9.8,0)
9.8
"BLD",9194,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9194,"KRN",9.8,"NM",1,0)
OREVNTX1^^0^B77890224
"BLD",9194,"KRN",9.8,"NM",2,0)
OREV4^^0^B24244068
"BLD",9194,"KRN",9.8,"NM","B","OREV4",2)

"BLD",9194,"KRN",9.8,"NM","B","OREVNTX1",1)

"BLD",9194,"KRN",19,0)
19
"BLD",9194,"KRN",19.1,0)
19.1
"BLD",9194,"KRN",101,0)
101
"BLD",9194,"KRN",409.61,0)
409.61
"BLD",9194,"KRN",771,0)
771
"BLD",9194,"KRN",779.2,0)
779.2
"BLD",9194,"KRN",870,0)
870
"BLD",9194,"KRN",8989.51,0)
8989.51
"BLD",9194,"KRN",8989.52,0)
8989.52
"BLD",9194,"KRN",8994,0)
8994
"BLD",9194,"KRN","B",.4,.4)

"BLD",9194,"KRN","B",.401,.401)

"BLD",9194,"KRN","B",.402,.402)

"BLD",9194,"KRN","B",.403,.403)

"BLD",9194,"KRN","B",.5,.5)

"BLD",9194,"KRN","B",.84,.84)

"BLD",9194,"KRN","B",3.6,3.6)

"BLD",9194,"KRN","B",3.8,3.8)

"BLD",9194,"KRN","B",9.2,9.2)

"BLD",9194,"KRN","B",9.8,9.8)

"BLD",9194,"KRN","B",19,19)

"BLD",9194,"KRN","B",19.1,19.1)

"BLD",9194,"KRN","B",101,101)

"BLD",9194,"KRN","B",409.61,409.61)

"BLD",9194,"KRN","B",771,771)

"BLD",9194,"KRN","B",779.2,779.2)

"BLD",9194,"KRN","B",870,870)

"BLD",9194,"KRN","B",8989.51,8989.51)

"BLD",9194,"KRN","B",8989.52,8989.52)

"BLD",9194,"KRN","B",8994,8994)

"BLD",9194,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9194,"QUES",0)
^9.62^^
"BLD",9194,"REQB",0)
^9.611^1^1
"BLD",9194,"REQB",1,0)
OR*3.0*347^2
"BLD",9194,"REQB","B","OR*3.0*347",1)

"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,20,0)
^9.402P^^
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990325^66481
"PKG",174,22,1,"PAH",1,0)
367^3121107
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","OREV4")
0^2^B24244068^B23656896
"RTN","OREV4",1,0)
OREV4 ;SLC/DAN Event delayed orders cont ;10/25/02  13:54
"RTN","OREV4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,367**;Dec 17, 1997;Build 2
"RTN","OREV4",3,0)
 ;DBIA reference section
"RTN","OREV4",4,0)
 ;10006 - DIC
"RTN","OREV4",5,0)
 ;10018 - DIE
"RTN","OREV4",6,0)
 ;10013 - DIK
"RTN","OREV4",7,0)
 ;10103 - XLFDT
"RTN","OREV4",8,0)
 ;2056  - DIQ
"RTN","OREV4",9,0)
 ;2263  - XPAR
"RTN","OREV4",10,0)
 ;
"RTN","OREV4",11,0)
 N Y,DIC,ZTSAVE,IEN
"RTN","OREV4",12,0)
 S DIC="^ORE(100.2,",DIC(0)="AEMQ" D ^DIC
"RTN","OREV4",13,0)
 Q:Y=-1  ;Quit if no selection made
"RTN","OREV4",14,0)
 S IEN=+Y
"RTN","OREV4",15,0)
 W !
"RTN","OREV4",16,0)
 S ZTSAVE("IEN")="",ZTSAVE("DIC")="",ZTSAVE("IO*")=""
"RTN","OREV4",17,0)
 D QUE^ORUTL1("DQI^OREV4","Patient event inquiry",.ZTSAVE) ;Get device to print on
"RTN","OREV4",18,0)
 Q
"RTN","OREV4",19,0)
 ;
"RTN","OREV4",20,0)
DQI ;Tasked entry point or continue if not queued
"RTN","OREV4",21,0)
 U IO
"RTN","OREV4",22,0)
 S DA=IEN
"RTN","OREV4",23,0)
 D EN^DIQ
"RTN","OREV4",24,0)
 Q
"RTN","OREV4",25,0)
 ;
"RTN","OREV4",26,0)
CHKPRM ;Checks to see if event is defined in either the OREVNT DEFAULT
"RTN","OREV4",27,0)
 ;or the OREVNT COMMON LIST parameter.  If so, then it will be removed
"RTN","OREV4",28,0)
 ;from the parameters as PARENT type events are not allowed in these
"RTN","OREV4",29,0)
 ;parameters.  This API is called when an event becomes a parent.
"RTN","OREV4",30,0)
 N DIC,Y,X,PRMC,PRMD,PARAM,I,J
"RTN","OREV4",31,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV4",32,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV4",33,0)
 S PRMC=+Y
"RTN","OREV4",34,0)
 S X="OREVNT DEFAULT" D ^DIC
"RTN","OREV4",35,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV4",36,0)
 S PRMD=+Y
"RTN","OREV4",37,0)
 F PARAM=PRMC,PRMD D
"RTN","OREV4",38,0)
 .K ORLST
"RTN","OREV4",39,0)
 .D ENVAL^XPAR(.ORLST,PRMC) ;get list of values
"RTN","OREV4",40,0)
 .Q:ORLST=0  ;No values
"RTN","OREV4",41,0)
 .S I="" F  S I=$O(ORLST(I)) Q:I=""  D
"RTN","OREV4",42,0)
 ..S J="" F  S J=$O(ORLST(I,J)) Q:J=""  D
"RTN","OREV4",43,0)
 ...I ORLST(I,J)=DA D EN^XPAR(I,PARAM,J,"@") ;delete event from parameter
"RTN","OREV4",44,0)
 Q
"RTN","OREV4",45,0)
 ;
"RTN","OREV4",46,0)
DELAYED(DFN) ;Display list of delayed events for a patient, identified by DFN
"RTN","OREV4",47,0)
 N EVT,IFN,DISP
"RTN","OREV4",48,0)
 I '$D(^ORE(100.2,"AE",DFN)) Q  ;Quit if no delayed orders exist for the patient
"RTN","OREV4",49,0)
 S EVT=0,DISP=0
"RTN","OREV4",50,0)
 F  S EVT=$O(^ORE(100.2,"AE",DFN,EVT)) Q:'+EVT  D
"RTN","OREV4",51,0)
 .S IFN=$O(^ORE(100.2,"AE",DFN,EVT,0))
"RTN","OREV4",52,0)
 .Q:$$LAPSED^OREVNTX(IFN)  ;quit if event has lapsed
"RTN","OREV4",53,0)
 .W:'DISP !!,"Delayed orders exist for this patient!",$C(7) S DISP=1
"RTN","OREV4",54,0)
 .W !,"EVENT: ",$P($G(^ORD(100.5,+$P(^ORE(100.2,IFN,0),U,2),0)),U,8),", created on ",$$FMTE^XLFDT($P(^ORE(100.2,IFN,0),U,5),1)
"RTN","OREV4",55,0)
 Q
"RTN","OREV4",56,0)
 ;
"RTN","OREV4",57,0)
PARENTOK() ;This function determines if the event can be a parent
"RTN","OREV4",58,0)
 ;if an event has future delayed orders tied to it then it can't be
"RTN","OREV4",59,0)
 ;a parent
"RTN","OREV4",60,0)
 N OK,SUB,RIEN,PIEN
"RTN","OREV4",61,0)
 S OK=1
"RTN","OREV4",62,0)
 S SUB="^ORE(100.2,""AE"")"
"RTN","OREV4",63,0)
 F  S SUB=$Q(@SUB) Q:SUB'["AE"!('OK)  D
"RTN","OREV4",64,0)
 .S RIEN=$P(SUB,",",4) ;Release event ID
"RTN","OREV4",65,0)
 .S PIEN=+$P(SUB,",",5) ;Patient event ID -- p.367 added "+" to prevent PIEN from containing ")" 
"RTN","OREV4",66,0)
 .Q:$$LAPSED^OREVNTX(PIEN)  ;quit if event has lapsed
"RTN","OREV4",67,0)
 .I RIEN=DA W !!,"You may not make ",$P($G(^ORD(100.5,DA,0)),U)," a parent",!,"at this time because there are unprocessed delayed orders assigned to it." H 3 S OK=0
"RTN","OREV4",68,0)
 Q OK
"RTN","OREV4",69,0)
 ;
"RTN","OREV4",70,0)
ACTSURG(ORTYPE,DA) ;Function returns 1 if an active surgery event already exists
"RTN","OREV4",71,0)
 N ACT,DIV,I
"RTN","OREV4",72,0)
 S ACT=0
"RTN","OREV4",73,0)
 I ORTYPE="E" D
"RTN","OREV4",74,0)
 .S DIV=$P($G(^ORD(100.5,DA,0)),U,3)
"RTN","OREV4",75,0)
 .S I=0 F  S I=$O(^ORD(100.5,"ADT","O",I)) Q:'+I  I DA'=I I DIV=$P($G(^ORD(100.5,I,0)),U,3)&('$G(^ORD(100.5,I,1))) S ACT=1
"RTN","OREV4",76,0)
 .Q
"RTN","OREV4",77,0)
 I ORTYPE="A" D
"RTN","OREV4",78,0)
 .S DIV=$P($G(^ORD(100.6,DA,0)),U,3)
"RTN","OREV4",79,0)
 .S I=0 F  S I=$O(^ORD(100.6,"AE",DIV,"O",I)) Q:'+I  I I'=DA S ACT=1
"RTN","OREV4",80,0)
 .Q
"RTN","OREV4",81,0)
 Q ACT
"RTN","OREV4",82,0)
 ;
"RTN","OREV4",83,0)
FROMTO(MUL,SUB1,SUB2) ;Check FROM - TO entries in file 100.6
"RTN","OREV4",84,0)
 N DA,DIK,LOC0,X,Y,DEL,ERR
"RTN","OREV4",85,0)
 I MUL="S" D  Q
"RTN","OREV4",86,0)
 .I '$D(^ORD(100.6,SUB1,4,SUB2,1,"B")) D  ;Check for TO entries in specialties multiple
"RTN","OREV4",87,0)
 ..W !!,"ERROR - Missing TO entry - ",$P($G(^DIC(45.7,$P(^ORD(100.6,SUB1,4,SUB2,0),U),0)),U)," DELETED.",!
"RTN","OREV4",88,0)
 ..S DA(1)=SUB1,DA=SUB2,DIK="^ORD(100.6,"_DA(1)_",4," D ^DIK
"RTN","OREV4",89,0)
 ;
"RTN","OREV4",90,0)
 I MUL="L" D
"RTN","OREV4",91,0)
 .S LOC0=^ORD(100.6,SUB1,5,SUB2,0)
"RTN","OREV4",92,0)
 .I +$P(LOC0,U,2)=0&($P(LOC0,U,3)="") S DEL=1,ERR=1
"RTN","OREV4",93,0)
 .I +$P(LOC0,U,4)=0&($P(LOC0,U,5)="") S DEL=1,ERR=1
"RTN","OREV4",94,0)
 .I $G(ERR) W !!,"ERROR - Missing FROM or TO location - '",$P(LOC0,U),"' DELETED.",! Q
"RTN","OREV4",95,0)
 .I $P(LOC0,U,2) D CLEAR(SUB1,SUB2,2) ;If user selects "all" clear "from" field
"RTN","OREV4",96,0)
 .I $P(LOC0,U,4) D CLEAR(SUB1,SUB2,4) ;If user selects "all" clear "to" field
"RTN","OREV4",97,0)
 .I $P(LOC0,U,2)&($P(LOC0,U,4)) W !!,"WARNING - You've defined a 'FROM ALL' locations to 'TO ALL' locations entry",!,"and it will supercede all other entries.",! Q
"RTN","OREV4",98,0)
 .I $O(^ORD(100.6,SUB1,5,"ADC",$S($P(LOC0,U,2)=1:"ALL",1:$P(LOC0,U,3)),$S($P(LOC0,U,4)=1:"ALL",1:$P(LOC0,U,5)),SUB2)) S DEL=1,ERR=1
"RTN","OREV4",99,0)
 .I $O(^ORD(100.6,SUB1,5,"ADC",$S($P(LOC0,U,2)=1:"ALL",1:$P(LOC0,U,3)),$S($P(LOC0,U,4)=1:"ALL",1:$P(LOC0,U,5)),SUB2),-1) S DEL=1,ERR=1
"RTN","OREV4",100,0)
 .I $G(ERR) W !!,"ERROR - Duplicate entry exists - '",$P(LOC0,U),"' DELETED.",!
"RTN","OREV4",101,0)
 I $G(DEL) S DIK="^ORD(100.6,"_SUB1_",5,",DA=SUB2,DA(1)=SUB1 D ^DIK
"RTN","OREV4",102,0)
 Q
"RTN","OREV4",103,0)
 ;
"RTN","OREV4",104,0)
CLEAR(TENT,MENT,FIELD) ;Clear selected fields
"RTN","OREV4",105,0)
 N DA,DIE,Y,X,FILE
"RTN","OREV4",106,0)
 S FILE(100.62,MENT_","_TENT_",",FIELD)="@" D FILE^DIE("","FILE")
"RTN","OREV4",107,0)
 Q
"RTN","OREVNTX1")
0^1^B77890224^B76466044
"RTN","OREVNTX1",1,0)
OREVNTX1 ; SLC/JLI - Event delayed orders RPC's ; 4/5/11 2:53pm
"RTN","OREVNTX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165,149,243,280,347,367**;Dec 17, 1997;Build 2
"RTN","OREVNTX1",3,0)
 ;
"RTN","OREVNTX1",4,0)
PUTEVNT(ORY,DFN,EVT,ORIFN) ; Save new patient delayed events to file 100.2
"RTN","OREVNTX1",5,0)
 S ORY=$$NEW^OREVNT(DFN,EVT,ORIFN)
"RTN","OREVNTX1",6,0)
 Q
"RTN","OREVNTX1",7,0)
 ;
"RTN","OREVNTX1",8,0)
GTEVT(ORY,PTEVT) ; Return Event infomation based on PTEVT ptr #100.2
"RTN","OREVNTX1",9,0)
 ;EVTID     ptr #100.5
"RTN","OREVNTX1",10,0)
 Q:'+PTEVT
"RTN","OREVNTX1",11,0)
 N EVTID,EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",12,0)
 S (EVTTYPE,EVTNAME,EVTDISP,PRTEVT)=""
"RTN","OREVNTX1",13,0)
 S EVTDLG=0
"RTN","OREVNTX1",14,0)
 I '$P(^ORE(100.2,+$G(PTEVT),0),U,2) Q
"RTN","OREVNTX1",15,0)
 S EVTID=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",16,0)
 S PRTEVT=$P(^ORD(100.5,EVTID,0),U,12)
"RTN","OREVNTX1",17,0)
 I PRTEVT S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",18,0)
 E  S EVTTYPE=$P(^ORD(100.5,EVTID,0),U,2)
"RTN","OREVNTX1",19,0)
 I $D(^ORD(100.5,EVTID,0)) D
"RTN","OREVNTX1",20,0)
 . S EVTNAME=$P(^ORD(100.5,EVTID,0),U,1)
"RTN","OREVNTX1",21,0)
 . S EVTDISP=$P(^ORD(100.5,EVTID,0),U,8)
"RTN","OREVNTX1",22,0)
 . S EVTDLG=$P(^ORD(100.5,EVTID,0),U,4)
"RTN","OREVNTX1",23,0)
 S ORY=EVTTYPE_U_EVTID_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",24,0)
 Q
"RTN","OREVNTX1",25,0)
GTEVT1(ORY,EVT) ; Return Event information based on EVT ptr #100.5
"RTN","OREVNTX1",26,0)
 ;EVT    ptr #100.5
"RTN","OREVNTX1",27,0)
 Q:'+EVT
"RTN","OREVNTX1",28,0)
 N EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",29,0)
 S (EVTDLG,PRTEVT)=0
"RTN","OREVNTX1",30,0)
 S PRTEVT=$P(^ORD(100.5,+EVT,0),U,12)
"RTN","OREVNTX1",31,0)
 I PRTEVT>0 S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",32,0)
 E  S EVTTYPE=$P(^ORD(100.5,+EVT,0),U,2)
"RTN","OREVNTX1",33,0)
 S EVTNAME=$P($G(^ORD(100.5,+EVT,0)),U,1)
"RTN","OREVNTX1",34,0)
 S EVTDISP=$P($G(^ORD(100.5,+EVT,0)),U,8)
"RTN","OREVNTX1",35,0)
 S EVTDLG=$P($G(^ORD(100.5,+EVT,0)),U,4)
"RTN","OREVNTX1",36,0)
 S ORY=EVTTYPE_U_EVT_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",37,0)
 Q
"RTN","OREVNTX1",38,0)
 ;
"RTN","OREVNTX1",39,0)
EVT(ORY,PTEVT) ; Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",40,0)
 Q:'+PTEVT
"RTN","OREVNTX1",41,0)
 S ORY=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",42,0)
 Q
"RTN","OREVNTX1",43,0)
 ; 
"RTN","OREVNTX1",44,0)
EXISTS(ORY,DFN,EVT) ;Returns PtEvtID ptr #100.2 if patient already has delayed orders
"RTN","OREVNTX1",45,0)
 I '+EVT S ORY=0 Q
"RTN","OREVNTX1",46,0)
 N PTEVT S (PTEVT,ORY)=0
"RTN","OREVNTX1",47,0)
 S PTEVT=$O(^ORE(100.2,"AE",+DFN,+EVT,PTEVT))
"RTN","OREVNTX1",48,0)
 I PTEVT>0 S ORY=PTEVT
"RTN","OREVNTX1",49,0)
 Q
"RTN","OREVNTX1",50,0)
 ;
"RTN","OREVNTX1",51,0)
TYPEXT(ORY,DFN,EVT) ; does EVT has delayed orders?
"RTN","OREVNTX1",52,0)
 ; 1 if Patient DFN has delayed orders for EVT
"RTN","OREVNTX1",53,0)
 ; 2 if Parent/Sibling event has delayed orders
"RTN","OREVNTX1",54,0)
 ; 0 if No delayed orders for EVT
"RTN","OREVNTX1",55,0)
 Q:'+EVT
"RTN","OREVNTX1",56,0)
 S ORY=$$EXISTS^OREVNTX(DFN,EVT)
"RTN","OREVNTX1",57,0)
 Q
"RTN","OREVNTX1",58,0)
 ;
"RTN","OREVNTX1",59,0)
MATCH(ORY,DFN,EVT) ;If Pt's current data match selected event
"RTN","OREVNTX1",60,0)
 ;DFN: patient DFN
"RTN","OREVNTX1",61,0)
 ;EVT: ptr to #100.5
"RTN","OREVNTX1",62,0)
 S ORY=0
"RTN","OREVNTX1",63,0)
 Q:('+DFN)!('+EVT)
"RTN","OREVNTX1",64,0)
 S ORY=$$MATCH^OREVNT(DFN,EVT)
"RTN","OREVNTX1",65,0)
 N TS,TSNM
"RTN","OREVNTX1",66,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNTX1",67,0)
 S TSNM=$P($G(^DIC(45.7,TS,0)),U)
"RTN","OREVNTX1",68,0)
 S:ORY ORY=ORY_U_TSNM
"RTN","OREVNTX1",69,0)
 Q
"RTN","OREVNTX1",70,0)
 ;
"RTN","OREVNTX1",71,0)
NAME(ORY,PTEVT) ; Return Event name from #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",72,0)
 I PTEVT'>0 S ORY="" Q
"RTN","OREVNTX1",73,0)
 S ORY=$$NAME^OREVNTX(PTEVT)
"RTN","OREVNTX1",74,0)
 Q
"RTN","OREVNTX1",75,0)
 ;
"RTN","OREVNTX1",76,0)
DIV(ORY,PTEVT) ; Return division for PTEVT ptr #100.2
"RTN","OREVNTX1",77,0)
 Q:'+PTEVT
"RTN","OREVNTX1",78,0)
 S ORY=$$DIV^OREVNTX(PTEVT)
"RTN","OREVNTX1",79,0)
 Q
"RTN","OREVNTX1",80,0)
 ;
"RTN","OREVNTX1",81,0)
DIV1(ORY,EVT) ; Return division for EVT ptr #100.5
"RTN","OREVNTX1",82,0)
 Q:'+EVT
"RTN","OREVNTX1",83,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,3) S:ORY<1 ORY=+$G(DUZ(2))
"RTN","OREVNTX1",84,0)
 Q
"RTN","OREVNTX1",85,0)
 ;
"RTN","OREVNTX1",86,0)
LOC(ORY,PTEVT) ; Return default hospital location ^SC( for PTEVT ptr #100.2
"RTN","OREVNTX1",87,0)
 Q:'+PTEVT
"RTN","OREVNTX1",88,0)
 S ORY=$$LOC^OREVNTX(PTEVT)
"RTN","OREVNTX1",89,0)
 S ORY=+ORY
"RTN","OREVNTX1",90,0)
 Q
"RTN","OREVNTX1",91,0)
 ;
"RTN","OREVNTX1",92,0)
LOC1(ORY,EVT) ; Return default hospital location ^SC( for EVT ptr #100.5
"RTN","OREVNTX1",93,0)
 Q:'+EVT
"RTN","OREVNTX1",94,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,9) S:ORY<1 ORY=+$G(ORL)
"RTN","OREVNTX1",95,0)
 Q
"RTN","OREVNTX1",96,0)
 ;
"RTN","OREVNTX1",97,0)
CHGEVT(ORY,NEWEVT,ORIDS) ; Change order's event
"RTN","OREVNTX1",98,0)
 N ORI
"RTN","OREVNTX1",99,0)
 S ORI=0
"RTN","OREVNTX1",100,0)
 F  S ORI=$O(ORIDS(ORI)) Q:'+ORI  D
"RTN","OREVNTX1",101,0)
 . D CHGEVT^OREVNTX(+$G(ORIDS(ORI)),NEWEVT)
"RTN","OREVNTX1",102,0)
 Q
"RTN","OREVNTX1",103,0)
 ;
"RTN","OREVNTX1",104,0)
EMPTY(ORY,PTEVT) ; Return 1 if PTEVT doesn't have any orders
"RTN","OREVNTX1",105,0)
 Q:'+PTEVT
"RTN","OREVNTX1",106,0)
 S ORY=$$EMPTY^OREVNTX(PTEVT)
"RTN","OREVNTX1",107,0)
 Q
"RTN","OREVNTX1",108,0)
 ;
"RTN","OREVNTX1",109,0)
DELPTEVT(ORY,PTEVT) ; Delete Patient Event in #100.2
"RTN","OREVNTX1",110,0)
 Q:'+PTEVT
"RTN","OREVNTX1",111,0)
 D CANCEL^OREVNTX(PTEVT)
"RTN","OREVNTX1",112,0)
 Q
"RTN","OREVNTX1",113,0)
 ;
"RTN","OREVNTX1",114,0)
UPDTOR(ORY,PTIFN,ORIFN,PTEVT) ; If delayed order was DCed, then update the EVENT and "AEVNT"
"RTN","OREVNTX1",115,0)
 Q  ;Don't ever need to do this!
"RTN","OREVNTX1",116,0)
CURSPE(ORY,PTIFN) ; Return current treating specialty
"RTN","OREVNTX1",117,0)
 Q:'PTIFN
"RTN","OREVNTX1",118,0)
 N SPEC S SPEC=$$PT^DGPMOBS(PTIFN),ORY=""
"RTN","OREVNTX1",119,0)
 I SPEC'<0 S ORY=$P(SPEC,U,3)_U_$P(SPEC,U,2)_U_$P(SPEC,U) ;name^ien^obs flag
"RTN","OREVNTX1",120,0)
 Q
"RTN","OREVNTX1",121,0)
DFLTEVT(ORY,PVIFN) ; Return default release event based on provider IFN
"RTN","OREVNTX1",122,0)
 N CMEVTLST,IDX
"RTN","OREVNTX1",123,0)
 S CMEVTLST="",IDX=0
"RTN","OREVNTX1",124,0)
 D GETLST^OREV3(.CMEVTLST)
"RTN","OREVNTX1",125,0)
 F  S IDX=$O(CMEVTLST(IDX)) Q:'IDX  D
"RTN","OREVNTX1",126,0)
 . I $P($G(CMEVTLST(IDX)),U,2) S ORY=$P($G(CMEVTLST(IDX)),U) Q
"RTN","OREVNTX1",127,0)
 Q
"RTN","OREVNTX1",128,0)
CMEVTS(ORY,CLOC) ;Return common event list
"RTN","OREVNTX1",129,0)
 N IDX,X0,X,LOC
"RTN","OREVNTX1",130,0)
 S:CLOC>0 LOC=CLOC
"RTN","OREVNTX1",131,0)
 S IDX=0,ORY=""
"RTN","OREVNTX1",132,0)
 D GETLST^OREV3(.ORY)
"RTN","OREVNTX1",133,0)
 F  S IDX=$O(ORY(IDX)) Q:'IDX  D
"RTN","OREVNTX1",134,0)
 . S X0=""
"RTN","OREVNTX1",135,0)
 . S:$L($G(^ORD(100.5,+ORY(IDX),0))) X0=$G(^(0))
"RTN","OREVNTX1",136,0)
 . I '$L($P(X0,U,2)) D
"RTN","OREVNTX1",137,0)
 .. S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX1",138,0)
 . S:$L(X0) ORY(IDX)=+ORY(IDX)_U_X0
"RTN","OREVNTX1",139,0)
 Q
"RTN","OREVNTX1",140,0)
 ;
"RTN","OREVNTX1",141,0)
DELDFLT(ORY,PVIFN) ; Delete default release event
"RTN","OREVNTX1",142,0)
 Q:'PVIFN
"RTN","OREVNTX1",143,0)
 N ORERR
"RTN","OREVNTX1",144,0)
 S ORERR=""
"RTN","OREVNTX1",145,0)
 D DEL^XPAR(PVIFN_";VA(200,","OREVNT DEFAULT",1,.ORERR)
"RTN","OREVNTX1",146,0)
 Q
"RTN","OREVNTX1",147,0)
WRLSTED(LST,LOC,EVTID) ; Return list of dialogs for writing event delayed orders
"RTN","OREVNTX1",148,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","OREVNTX1",149,0)
WRLST1 N ANENT
"RTN","OREVNTX1",150,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","OREVNTX1",151,0)
 S ANENT="ALL^USR.`"_DUZ_"^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","OREVNTX1",152,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","OREVNTX1",153,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS EVENT LIST",EVTID,"I") Q:'MNU
"RTN","OREVNTX1",154,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","OREVNTX1",155,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","OREVNTX1",156,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","OREVNTX1",157,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","OREVNTX1",158,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","OREVNTX1",159,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","OREVNTX1",160,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","OREVNTX1",161,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","OREVNTX1",162,0)
 Q
"RTN","OREVNTX1",163,0)
 ;
"RTN","OREVNTX1",164,0)
GETDLG(LST,DLGID) ; Return dialog infomation based on the DLGID
"RTN","OREVNTX1",165,0)
 N DIEN,DFID,DTXT,DTYP,DGRP,X0,X5
"RTN","OREVNTX1",166,0)
 S DLGID=+DLGID
"RTN","OREVNTX1",167,0)
 Q:'DLGID
"RTN","OREVNTX1",168,0)
 S X0=^ORD(101.41,DLGID,0),X5=$G(^(5))
"RTN","OREVNTX1",169,0)
 S DGRP=+$P(X0,U,5),DFID=+$P(X5,U,5),DTXT=$P(X5,U,4),DTYP=$P(X0,U,4)
"RTN","OREVNTX1",170,0)
    S:'$L(DTXT) DTXT=$P(X0,U,2)
"RTN","OREVNTX1",171,0)
 I $P(X0,U,4)="M" S:'DFID DFID=1001
"RTN","OREVNTX1",172,0)
 S LST=DLGID_";"_DFID_";"_DGRP_";"_DTYP_U_DTXT
"RTN","OREVNTX1",173,0)
 Q
"RTN","OREVNTX1",174,0)
DONE(LST,PTEVT) ; Terminate PTEvt
"RTN","OREVNTX1",175,0)
 Q:'PTEVT
"RTN","OREVNTX1",176,0)
 D DONE^OREVNTX(PTEVT)
"RTN","OREVNTX1",177,0)
 D ACTLOG^OREVNTX(PTEVT,"MN")
"RTN","OREVNTX1",178,0)
 Q
"RTN","OREVNTX1",179,0)
SETDFLT(ORY,EVT) ;Set personal default event
"RTN","OREVNTX1",180,0)
 N ERR,VAL S ERR=""
"RTN","OREVNTX1",181,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",182,0)
 S VAL=$P(^ORD(100.5,EVT,0),U)
"RTN","OREVNTX1",183,0)
 D EN^XPAR(DUZ_";VA(200,","OREVNT DEFAULT",1,VAL,ERR)
"RTN","OREVNTX1",184,0)
 S ORY=ERR
"RTN","OREVNTX1",185,0)
 Q
"RTN","OREVNTX1",186,0)
CPACT(ORY,EVT) ; Return True/False to display active orders for copy
"RTN","OREVNTX1",187,0)
 ; EVT ptr to #100.5
"RTN","OREVNTX1",188,0)
 Q:'EVT
"RTN","OREVNTX1",189,0)
 S ORY=0
"RTN","OREVNTX1",190,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",191,0)
 S ORY=$P(^ORD(100.5,EVT,0),U,11)
"RTN","OREVNTX1",192,0)
 Q
"RTN","OREVNTX1",193,0)
PRMPTID(ORY,PRTNM) ;Return event prompt IEN for OR GTX EVENT
"RTN","OREVNTX1",194,0)
 S:$D(^ORD(101.41,"B","OR GTX EVENT")) ORY=$O(^("OR GTX EVENT",0))
"RTN","OREVNTX1",195,0)
 Q
"RTN","OREVNTX1",196,0)
ISDCOD(ORY,ORIFN) ;True: the order need to be filtered out
"RTN","OREVNTX1",197,0)
 N PAS,X3,X0,ORGRPLST,THEGRP,IDX,ODGRP
"RTN","OREVNTX1",198,0)
 S (ORY,IDX)=0
"RTN","OREVNTX1",199,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",200,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",201,0)
 S ODGRP=$P(X0,U,11)
"RTN","OREVNTX1",202,0)
 D GETLST^XPAR(.ORGRPLST,"ALL","OREVNT EXCLUDE DGRP")
"RTN","OREVNTX1",203,0)
 F  S IDX=$O(ORGRPLST(IDX)) Q:'IDX!ORY  D
"RTN","OREVNTX1",204,0)
 . S THEGRP=$P($G(ORGRPLST(IDX)),U,2)
"RTN","OREVNTX1",205,0)
 . I $$GRPCHK(THEGRP,ODGRP) S ORY=1
"RTN","OREVNTX1",206,0)
 I ORY Q
"RTN","OREVNTX1",207,0)
 S PAS=";1;2;7;13;"  ;*347 Update Filter
"RTN","OREVNTX1",208,0)
 S:$D(^OR(100,+ORIFN,3)) X3=^OR(100,+ORIFN,3)
"RTN","OREVNTX1",209,0)
 ;*347 Filter out DC
"RTN","OREVNTX1",210,0)
 S:(PAS[(";"_$P(X3,U,3)_";")) ORY=1
"RTN","OREVNTX1",211,0)
 Q
"RTN","OREVNTX1",212,0)
DEFLTS(ORY,EVTID) ;Return default specialty for EVTID(#100.5)
"RTN","OREVNTX1",213,0)
 Q:'+EVTID
"RTN","OREVNTX1",214,0)
 N PRTEVT
"RTN","OREVNTX1",215,0)
 S PRTEVT=0
"RTN","OREVNTX1",216,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",217,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",218,0)
 S ORY=$$DEFTS^ORCDADT(EVTID)
"RTN","OREVNTX1",219,0)
 Q
"RTN","OREVNTX1",220,0)
 ;
"RTN","OREVNTX1",221,0)
MULTS(ORY,EVTID) ;Return specialty list for the EVTID(#100.5)
"RTN","OREVNTX1",222,0)
 Q:'+EVTID
"RTN","OREVNTX1",223,0)
 N I,CNT,X,Y S (I,CNT)=0
"RTN","OREVNTX1",224,0)
 N PRTEVT
"RTN","OREVNTX1",225,0)
 S PRTEVT=0
"RTN","OREVNTX1",226,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",227,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",228,0)
 F  S I=$O(^ORD(100.5,+$G(EVTID),"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","OREVNTX1",229,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","OREVNTX1",230,0)
 . S CNT=CNT+1,ORY(CNT)=X_U_Y
"RTN","OREVNTX1",231,0)
 Q
"RTN","OREVNTX1",232,0)
 ;
"RTN","OREVNTX1",233,0)
PRTIDS(ORY,IDS) ;Return some prompt ids from #101.41
"RTN","OREVNTX1",234,0)
 ; treating specialty Id^attending provider id
"RTN","OREVNTX1",235,0)
 N IDX,ORTS,ORATT
"RTN","OREVNTX1",236,0)
 S (ORY,ORTS,ORATT)=""
"RTN","OREVNTX1",237,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX TREATING SPECIALTY",0))
"RTN","OREVNTX1",238,0)
 S:$D(^ORD(101.41,IDX,1)) ORTS=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",239,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX PROVIDER",0))
"RTN","OREVNTX1",240,0)
 S:$D(^ORD(101.41,IDX,1)) ORATT=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",241,0)
 S ORY=ORTS_"~"_ORATT
"RTN","OREVNTX1",242,0)
 Q
"RTN","OREVNTX1",243,0)
 ;
"RTN","OREVNTX1",244,0)
DFLTDLG(ORY,EVTID) ;Return event default dialog IEN
"RTN","OREVNTX1",245,0)
 S ORY=0
"RTN","OREVNTX1",246,0)
 ; p.367 if this is a child event, dialog will be "" so use the parent's default dialog
"RTN","OREVNTX1",247,0)
 S:$P($G(^ORD(100.5,+EVTID,0)),U,12) EVTID=$P($G(^ORD(100.5,+EVTID,0)),U,12)
"RTN","OREVNTX1",248,0)
 Q:'$D(^ORD(100.5,+EVTID,0))
"RTN","OREVNTX1",249,0)
 S ORY=$P(^ORD(100.5,+EVTID,0),U,4)
"RTN","OREVNTX1",250,0)
 Q
"RTN","OREVNTX1",251,0)
AUTHMREL(ORY,USER) ;1: user can manual release delayed orders 0: can't
"RTN","OREVNTX1",252,0)
 S ORY=$$CANREL^OREV3
"RTN","OREVNTX1",253,0)
 Q
"RTN","OREVNTX1",254,0)
HAVEPRT(ORY,PTEVT) ;return parent patient event from #100.2
"RTN","OREVNTX1",255,0)
 Q:'+PTEVT
"RTN","OREVNTX1",256,0)
 S ORY=""
"RTN","OREVNTX1",257,0)
 S:$L($G(^ORE(100.2,PTEVT,1))) ORY=$P(^(1),U,5)
"RTN","OREVNTX1",258,0)
 Q
"RTN","OREVNTX1",259,0)
GRPCHK(DG,AGRP) ;If an order's group belong to DG group
"RTN","OREVNTX1",260,0)
 N RST
"RTN","OREVNTX1",261,0)
 S RST=0
"RTN","OREVNTX1",262,0)
 N ORGRP
"RTN","OREVNTX1",263,0)
 D GRP^ORQ1(DG)
"RTN","OREVNTX1",264,0)
 S RST=$S($D(ORGRP(AGRP)):1,1:0)
"RTN","OREVNTX1",265,0)
 Q RST
"RTN","OREVNTX1",266,0)
ODPTEVID(ORY,ORID) ;Return PtEvtID based on the ORID
"RTN","OREVNTX1",267,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",268,0)
 S ORY=$P($G(^OR(100,+ORID,0)),U,17)
"RTN","OREVNTX1",269,0)
 Q
"RTN","OREVNTX1",270,0)
COMP(ORY,PTEVT) ;Return 1 or 0 if PTEVT completed or not
"RTN","OREVNTX1",271,0)
 Q:'+PTEVT
"RTN","OREVNTX1",272,0)
 S ORY=$$COMP^OREVNTX(+PTEVT)
"RTN","OREVNTX1",273,0)
 Q
"RTN","OREVNTX1",274,0)
ISHDORD(ORY,ORID) ;Return 1 if it's on-hold med order
"RTN","OREVNTX1",275,0)
 Q:'+ORID
"RTN","OREVNTX1",276,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",277,0)
 N STS,HDSTS,ODGP,INPT,OUPT,MEDS,IVMD
"RTN","OREVNTX1",278,0)
 S HDSTS=$O(^ORD(100.01,"B","HOLD",0))
"RTN","OREVNTX1",279,0)
 S STS=$P($G(^OR(100,+ORID,3)),U,3)
"RTN","OREVNTX1",280,0)
 S INPT=$O(^ORD(100.98,"B","UD RX",0))
"RTN","OREVNTX1",281,0)
 S OUPT=$O(^ORD(100.98,"B","O RX",0))
"RTN","OREVNTX1",282,0)
 S MEDS=$O(^ORD(100.98,"B","RX",0))
"RTN","OREVNTX1",283,0)
 S IVMD=$O(^ORD(100.98,"B","IV RX",0))
"RTN","OREVNTX1",284,0)
 S ODGP=$P(^OR(100,+ORID,0),U,11)
"RTN","OREVNTX1",285,0)
 I (U_INPT_U_OUPT_U_MEDS_U_IVMD_U[U_ODGP_U),(HDSTS=STS) S ORY=1
"RTN","OREVNTX1",286,0)
 Q
"RTN","OREVNTX1",287,0)
ISPASS(ORY,PTEVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",288,0)
 S ORY=$$EVT^OREVNTX(PTEVTID)
"RTN","OREVNTX1",289,0)
 S ORY=$P($G(^ORD(100.5,+ORY,0)),U,7)
"RTN","OREVNTX1",290,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",291,0)
 E  S ORY=0
"RTN","OREVNTX1",292,0)
 Q
"RTN","OREVNTX1",293,0)
ISPASS1(ORY,EVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",294,0)
 S ORY=$P($G(^ORD(100.5,+EVTID,0)),U,7)
"RTN","OREVNTX1",295,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",296,0)
 E  S ORY=0
"RTN","OREVNTX1",297,0)
 Q
"RTN","OREVNTX1",298,0)
DLGIEN(ORY,DLGNAME) ;Return Order Dialog IEN based on name
"RTN","OREVNTX1",299,0)
 Q:'$D(^ORD(101.41,"B",DLGNAME))
"RTN","OREVNTX1",300,0)
 S ORY=$O(^ORD(101.41,"B",DLGNAME,0))
"RTN","OREVNTX1",301,0)
 Q
"RTN","OREVNTX1",302,0)
GETSTS(ORY,ORDID) ;Return Order status
"RTN","OREVNTX1",303,0)
 Q:'+ORDID
"RTN","OREVNTX1",304,0)
 Q:'$D(^OR(100,+ORDID,0))
"RTN","OREVNTX1",305,0)
 S ORY=$P($G(^OR(100,+ORDID,3)),U,3)
"RTN","OREVNTX1",306,0)
 Q
"RTN","OREVNTX1",307,0)
 ;
"RTN","OREVNTX1",308,0)
CHKORD(ORDER) ;Extrinsic function to determine if order is delayed and the "event" order
"RTN","OREVNTX1",309,0)
 ;
"RTN","OREVNTX1",310,0)
 N VALUE
"RTN","OREVNTX1",311,0)
 S VALUE=0
"RTN","OREVNTX1",312,0)
 I +$P($G(^OR(100,ORDER,0)),U,17),'$O(^ORE(100.2,"AO",ORDER,0)) S VALUE=1 ;Delayed but not the "event" order
"RTN","OREVNTX1",313,0)
 Q VALUE
"VER")
8.0^22.0
"BLD",9194,6)
^333
**END**
**END**

