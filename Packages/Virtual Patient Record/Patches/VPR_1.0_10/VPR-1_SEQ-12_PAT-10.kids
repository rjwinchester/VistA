Released VPR*1*10 SEQ #12
Extracted from mail message
**KIDS**:VPR*1.0*10^

**INSTALL NAME**
VPR*1.0*10
"BLD",9472,0)
VPR*1.0*10^VIRTUAL PATIENT RECORD^0^3190409^y
"BLD",9472,4,0)
^9.64PA^^
"BLD",9472,6.3)
16
"BLD",9472,"ABPKG")
n
"BLD",9472,"INIT")
POST^VPRP10
"BLD",9472,"KRN",0)
^9.67PA^1.5^24
"BLD",9472,"KRN",.4,0)
.4
"BLD",9472,"KRN",.401,0)
.401
"BLD",9472,"KRN",.402,0)
.402
"BLD",9472,"KRN",.403,0)
.403
"BLD",9472,"KRN",.5,0)
.5
"BLD",9472,"KRN",.84,0)
.84
"BLD",9472,"KRN",1.5,0)
1.5
"BLD",9472,"KRN",1.5,"NM",0)
^9.68A^30^27
"BLD",9472,"KRN",1.5,"NM",1,0)
VPR PROBLEM^^0
"BLD",9472,"KRN",1.5,"NM",2,0)
VPR FIM^^0
"BLD",9472,"KRN",1.5,"NM",3,0)
VPR ALLERGY^^0
"BLD",9472,"KRN",1.5,"NM",4,0)
VPR ALLERGY ASSESSMENT^^0
"BLD",9472,"KRN",1.5,"NM",5,0)
VPR RAD ORDER^^0
"BLD",9472,"KRN",1.5,"NM",6,0)
VPR RAD RESULT^^0
"BLD",9472,"KRN",1.5,"NM",7,0)
VPR RAD RESULT EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",8,0)
VPR RAD REPORT^^0
"BLD",9472,"KRN",1.5,"NM",9,0)
VPR RAD RPT EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",10,0)
VPR LRAP EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",11,0)
VPR LRAP REPORT^^0
"BLD",9472,"KRN",1.5,"NM",12,0)
VPR LRMI EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",13,0)
VPR LRMI REPORT^^0
"BLD",9472,"KRN",1.5,"NM",14,0)
VPR PATIENT^^0
"BLD",9472,"KRN",1.5,"NM",15,0)
VPR PATIENT EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",16,0)
VPR SOURCE FACILITY^^0
"BLD",9472,"KRN",1.5,"NM",17,0)
VPR PATIENT ID^^0
"BLD",9472,"KRN",1.5,"NM",18,0)
VPR LOCATION EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",19,0)
VPR OTHER ORDER^^0
"BLD",9472,"KRN",1.5,"NM",20,0)
VPR LAB ORDER^^0
"BLD",9472,"KRN",1.5,"NM",21,0)
VPR LR RESULT EXTENSION^^0
"BLD",9472,"KRN",1.5,"NM",22,0)
VPR LRCH RESULT^^0
"BLD",9472,"KRN",1.5,"NM",24,0)
VPR LRCY RESULT^^0
"BLD",9472,"KRN",1.5,"NM",27,0)
VPR LREM RESULT^^0
"BLD",9472,"KRN",1.5,"NM",28,0)
VPR LRMI RESULT^^0
"BLD",9472,"KRN",1.5,"NM",29,0)
VPR LRSP RESULT^^0
"BLD",9472,"KRN",1.5,"NM",30,0)
VPR MEDICATION^^0
"BLD",9472,"KRN",1.5,"NM","B","VPR ALLERGY",3)

"BLD",9472,"KRN",1.5,"NM","B","VPR ALLERGY ASSESSMENT",4)

"BLD",9472,"KRN",1.5,"NM","B","VPR FIM",2)

"BLD",9472,"KRN",1.5,"NM","B","VPR LAB ORDER",20)

"BLD",9472,"KRN",1.5,"NM","B","VPR LOCATION EXTENSION",18)

"BLD",9472,"KRN",1.5,"NM","B","VPR LR RESULT EXTENSION",21)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRAP EXTENSION",10)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRAP REPORT",11)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRCH RESULT",22)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRCY RESULT",24)

"BLD",9472,"KRN",1.5,"NM","B","VPR LREM RESULT",27)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRMI EXTENSION",12)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRMI REPORT",13)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRMI RESULT",28)

"BLD",9472,"KRN",1.5,"NM","B","VPR LRSP RESULT",29)

"BLD",9472,"KRN",1.5,"NM","B","VPR MEDICATION",30)

"BLD",9472,"KRN",1.5,"NM","B","VPR OTHER ORDER",19)

"BLD",9472,"KRN",1.5,"NM","B","VPR PATIENT",14)

"BLD",9472,"KRN",1.5,"NM","B","VPR PATIENT EXTENSION",15)

"BLD",9472,"KRN",1.5,"NM","B","VPR PATIENT ID",17)

"BLD",9472,"KRN",1.5,"NM","B","VPR PROBLEM",1)

"BLD",9472,"KRN",1.5,"NM","B","VPR RAD ORDER",5)

"BLD",9472,"KRN",1.5,"NM","B","VPR RAD REPORT",8)

"BLD",9472,"KRN",1.5,"NM","B","VPR RAD RESULT",6)

"BLD",9472,"KRN",1.5,"NM","B","VPR RAD RESULT EXTENSION",7)

"BLD",9472,"KRN",1.5,"NM","B","VPR RAD RPT EXTENSION",9)

"BLD",9472,"KRN",1.5,"NM","B","VPR SOURCE FACILITY",16)

"BLD",9472,"KRN",1.6,0)
1.6
"BLD",9472,"KRN",1.61,0)
1.61
"BLD",9472,"KRN",1.62,0)
1.62
"BLD",9472,"KRN",3.6,0)
3.6
"BLD",9472,"KRN",3.8,0)
3.8
"BLD",9472,"KRN",9.2,0)
9.2
"BLD",9472,"KRN",9.8,0)
9.8
"BLD",9472,"KRN",9.8,"NM",0)
^9.68A^9^8
"BLD",9472,"KRN",9.8,"NM",1,0)
VPRSDA^^0^B238403489
"BLD",9472,"KRN",9.8,"NM",2,0)
VPRSDAL^^0^B8006329
"BLD",9472,"KRN",9.8,"NM",3,0)
VPRSDAR^^0^B16670259
"BLD",9472,"KRN",9.8,"NM",4,0)
VPRSR^^0^B1588116
"BLD",9472,"KRN",9.8,"NM",5,0)
VPRHS^^0^B24940964
"BLD",9472,"KRN",9.8,"NM",7,0)
VPREVNT^^0^B125233310
"BLD",9472,"KRN",9.8,"NM",8,0)
VPRSDAQ^^0^B148289095
"BLD",9472,"KRN",9.8,"NM",9,0)
VPRP10^^0^B1260403
"BLD",9472,"KRN",9.8,"NM","B","VPREVNT",7)

"BLD",9472,"KRN",9.8,"NM","B","VPRHS",5)

"BLD",9472,"KRN",9.8,"NM","B","VPRP10",9)

"BLD",9472,"KRN",9.8,"NM","B","VPRSDA",1)

"BLD",9472,"KRN",9.8,"NM","B","VPRSDAL",2)

"BLD",9472,"KRN",9.8,"NM","B","VPRSDAQ",8)

"BLD",9472,"KRN",9.8,"NM","B","VPRSDAR",3)

"BLD",9472,"KRN",9.8,"NM","B","VPRSR",4)

"BLD",9472,"KRN",19,0)
19
"BLD",9472,"KRN",19.1,0)
19.1
"BLD",9472,"KRN",101,0)
101
"BLD",9472,"KRN",409.61,0)
409.61
"BLD",9472,"KRN",771,0)
771
"BLD",9472,"KRN",779.2,0)
779.2
"BLD",9472,"KRN",870,0)
870
"BLD",9472,"KRN",8989.51,0)
8989.51
"BLD",9472,"KRN",8989.52,0)
8989.52
"BLD",9472,"KRN",8994,0)
8994
"BLD",9472,"KRN","B",.4,.4)

"BLD",9472,"KRN","B",.401,.401)

"BLD",9472,"KRN","B",.402,.402)

"BLD",9472,"KRN","B",.403,.403)

"BLD",9472,"KRN","B",.5,.5)

"BLD",9472,"KRN","B",.84,.84)

"BLD",9472,"KRN","B",1.5,1.5)

"BLD",9472,"KRN","B",1.6,1.6)

"BLD",9472,"KRN","B",1.61,1.61)

"BLD",9472,"KRN","B",1.62,1.62)

"BLD",9472,"KRN","B",3.6,3.6)

"BLD",9472,"KRN","B",3.8,3.8)

"BLD",9472,"KRN","B",9.2,9.2)

"BLD",9472,"KRN","B",9.8,9.8)

"BLD",9472,"KRN","B",19,19)

"BLD",9472,"KRN","B",19.1,19.1)

"BLD",9472,"KRN","B",101,101)

"BLD",9472,"KRN","B",409.61,409.61)

"BLD",9472,"KRN","B",771,771)

"BLD",9472,"KRN","B",779.2,779.2)

"BLD",9472,"KRN","B",870,870)

"BLD",9472,"KRN","B",8989.51,8989.51)

"BLD",9472,"KRN","B",8989.52,8989.52)

"BLD",9472,"KRN","B",8994,8994)

"BLD",9472,"QUES",0)
^9.62^^
"BLD",9472,"REQB",0)
^9.611^1^1
"BLD",9472,"REQB",1,0)
VPR*1.0*8^2
"BLD",9472,"REQB","B","VPR*1.0*8",1)

"INIT")
POST^VPRP10
"KRN",1.5,2,-1)
0^17
"KRN",1.5,2,0)
VPR PATIENT ID^2^^^^S
"KRN",1.5,2,.1)
PatientID
"KRN",1.5,2,1,0)
^1.51^8^4
"KRN",1.5,2,1,1,0)
PatientNumbers^1^L
"KRN",1.5,2,1,1,1)
3^PatientNumber
"KRN",1.5,2,1,1,3,0)
^1.513I^3^3
"KRN",1.5,2,1,1,3,1,0)
1^SSN
"KRN",1.5,2,1,1,3,2,0)
2^MRN
"KRN",1.5,2,1,1,3,3,0)
3^ICN
"KRN",1.5,2,1,1,3,"B",1,1)

"KRN",1.5,2,1,1,3,"B",2,2)

"KRN",1.5,2,1,1,3,"B",3,3)

"KRN",1.5,2,1,2,0)
SSN^^E^2^.09^^^VPR PATIENT NUMBER
"KRN",1.5,2,1,2,4)
S VALUE=VALUE_"^SSN^^SSA"
"KRN",1.5,2,1,3,0)
MRN^^E^2^^^^VPR PATIENT NUMBER
"KRN",1.5,2,1,3,6)
S VALUE=DIEN_"^MRN^"_$G(VASTN)_U_$G(VASTN)
"KRN",1.5,2,1,8,0)
ICN^^E^2^^^^VPR PATIENT NUMBER
"KRN",1.5,2,1,8,6)
S VALUE=$$GETICN^MPIF001(DIEN)_"^ICN"
"KRN",1.5,2,1,"B","ICN",8)

"KRN",1.5,2,1,"B","MRN",3)

"KRN",1.5,2,1,"B","PatientNumbers",1)

"KRN",1.5,2,1,"B","SSN",2)

"KRN",1.5,2,1,"SEQ",1,1)

"KRN",1.5,2,2)
N X S X=$$SITE^VASITE S:X>0 VASITE=+X,VASTN=$P(X,U,3) I X'>0 S VASITE=$$KSP^XUPARAM("INST"),VASTN=$$STA^XUAF4(VASITE)
"KRN",1.5,2,3)
K VASITE,VASTN
"KRN",1.5,2,4)
S DNAME="Patient"
"KRN",1.5,2,19,0)
^^3^3^3180606^
"KRN",1.5,2,19,1,0)
This entity supports VPR PATIENT, and expects the Patient file #2 ien
"KRN",1.5,2,19,2,0)
as the ID. It builds an abbreviated version of VPR PATIENT that includes
"KRN",1.5,2,19,3,0)
only the patient numbers.
"KRN",1.5,32,-1)
0^1
"KRN",1.5,32,0)
VPR PROBLEM^9000011^^^^S
"KRN",1.5,32,.1)
Problem
"KRN",1.5,32,1,0)
^1.51^14^13
"KRN",1.5,32,1,1,0)
Extension^4^E^9000011^^^^VPR PROBLEM EXTENSION
"KRN",1.5,32,1,1,6)
S VALUE=DIEN
"KRN",1.5,32,1,2,0)
UpdatedOn^1^S^9000011^.03^^1
"KRN",1.5,32,1,2,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,32,1,2,6)
S VALUE=$P($G(GMPFLD(.03)),U)
"KRN",1.5,32,1,3,0)
EnteredOn^16^S^9000011^.08^^1
"KRN",1.5,32,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,32,1,3,6)
S VALUE=$P($G(GMPFLD(.08)),U)
"KRN",1.5,32,1,4,0)
EnteredBy^14^E^9000011^1.03^^1^VPR USER
"KRN",1.5,32,1,5,0)
EnteredAt^15^E^9000011^.06^^1^VPR FACILITY
"KRN",1.5,32,1,6,0)
Problem^6.1^E^9000011^.01^^1^VPR ICD
"KRN",1.5,32,1,6,6)
S:$L($G(GMPFLD(80001))) DDEOUT=1 I $G(GMPFLD(80001))="" S VALUE=$P($G(GMPFLD(.01)),U),DATA("DATE")=$P($G(GMPFLD(80201)),U),DATA("SYS")=$P($G(GMPFLD(80202)),U)
"KRN",1.5,32,1,7,0)
ProblemDetails^5^S^9000011^.05
"KRN",1.5,32,1,7,6)
S VALUE=$P($G(GMPFLD(.05)),U,2)
"KRN",1.5,32,1,8,0)
Clinician^7^E^9000011^1.05^^1^VPR PROVIDER
"KRN",1.5,32,1,8,6)
S VALUE=$P($G(GMPFLD(1.05)),U)
"KRN",1.5,32,1,9,0)
Status^9^E^9000011^.12^^1^VPR CODE TABLE
"KRN",1.5,32,1,9,4)
S VALUE=$S(VALUE="A":"55561003^Active^SNOMED CT",VALUE="I":"73425007^Inactive^SNOMED CT",1:"")
"KRN",1.5,32,1,9,6)
S VALUE=$P($G(GMPFLD(.12)),U)
"KRN",1.5,32,1,10,0)
FromTime^17^S^9000011^.13^^1
"KRN",1.5,32,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,32,1,10,6)
S VALUE=$P($G(GMPFLD(.13)),U)
"KRN",1.5,32,1,11,0)
ToTime^18^S^9000011^1.07^^1
"KRN",1.5,32,1,11,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,32,1,11,6)
S VALUE=$P($G(GMPFLD(1.07)),U)
"KRN",1.5,32,1,13,0)
Problem^6^E^9000011^80001^^^VPR CODE TABLE
"KRN",1.5,32,1,13,4)
S VALUE=VALUE_U_$$SCTTEXT^VPRSDA(VALUE,DIEN)_"^SNOMED CT"
"KRN",1.5,32,1,13,6)
S VALUE=$P($G(GMPFLD(80001)),U)
"KRN",1.5,32,1,14,0)
ExternalId^19^I
"KRN",1.5,32,1,14,4)
S VALUE=VALUE_";PL"
"KRN",1.5,32,1,"B","Clinician",8)

"KRN",1.5,32,1,"B","EnteredAt",5)

"KRN",1.5,32,1,"B","EnteredBy",4)

"KRN",1.5,32,1,"B","EnteredOn",3)

"KRN",1.5,32,1,"B","Extension",1)

"KRN",1.5,32,1,"B","ExternalId",14)

"KRN",1.5,32,1,"B","FromTime",10)

"KRN",1.5,32,1,"B","Problem",6)

"KRN",1.5,32,1,"B","Problem",13)

"KRN",1.5,32,1,"B","ProblemDetails",7)

"KRN",1.5,32,1,"B","Status",9)

"KRN",1.5,32,1,"B","ToTime",11)

"KRN",1.5,32,1,"B","UpdatedOn",2)

"KRN",1.5,32,1,"SEQ",1,2)

"KRN",1.5,32,1,"SEQ",4,1)

"KRN",1.5,32,1,"SEQ",5,7)

"KRN",1.5,32,1,"SEQ",6,13)

"KRN",1.5,32,1,"SEQ",6.1,6)

"KRN",1.5,32,1,"SEQ",7,8)

"KRN",1.5,32,1,"SEQ",9,9)

"KRN",1.5,32,1,"SEQ",14,4)

"KRN",1.5,32,1,"SEQ",15,5)

"KRN",1.5,32,1,"SEQ",16,3)

"KRN",1.5,32,1,"SEQ",17,10)

"KRN",1.5,32,1,"SEQ",18,11)

"KRN",1.5,32,1,"SEQ",19,14)

"KRN",1.5,32,3)
K GMPFLD,GMPORIG
"KRN",1.5,32,4)
K GMPFLD,GMPORIG D GETFLDS^GMPLEDT3(DIEN)
"KRN",1.5,32,5)
PROBLEMS^VPRSDAQ
"KRN",1.5,32,19,0)
^^1^1^3181227^
"KRN",1.5,32,19,1,0)
This entity populates the Problem container in HealthShare.
"KRN",1.5,34,-1)
0^20
"KRN",1.5,34,0)
VPR LAB ORDER^100^^^^S
"KRN",1.5,34,.1)
LabOrder
"KRN",1.5,34,1,0)
^1.51^22^21
"KRN",1.5,34,1,1,0)
EnteredAt^35^E^100^6^^1^VPR FACILITY
"KRN",1.5,34,1,1,4)
S:VALUE VALUE=$$GET1^DIQ(44,+VALUE_",",3,"I") S:'VALUE VALUE=$G(VASITE) ;#4 ien
"KRN",1.5,34,1,2,0)
EnteredBy^34^E^100^3^^1^VPR USER
"KRN",1.5,34,1,3,0)
EnteredOn^36^S^100^4^^1
"KRN",1.5,34,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,4,0)
FillerId^3^S^100^33
"KRN",1.5,34,1,4,6)
S ORPK=$$PKGID^ORX8(DIEN),VALUE=ORPK S:VALUE?1.";" DDEOUT=1
"KRN",1.5,34,1,5,0)
OrderCategory^6^E^100^23^^1^VPR DISPLAY GROUP
"KRN",1.5,34,1,5,4)
D LRDG^VPRSDA(.VALUE) ;convert if LAB
"KRN",1.5,34,1,6,0)
OrderItem^5^E^100^^^^VPR ORDERABLE ITEM
"KRN",1.5,34,1,6,6)
S ORIT=$$OI^ORX8(DIEN),VALUE=+ORIT
"KRN",1.5,34,1,7,0)
OrderedBy^8^E^100^1^^1^VPR PROVIDER
"KRN",1.5,34,1,9,0)
Priority^19^E^100^^^^VPR LAB URGENCY
"KRN",1.5,34,1,9,6)
S VALUE=$$VALUE^ORX8(DIEN,"URGENCY")
"KRN",1.5,34,1,10,0)
ResultCopiesTo^29^L^100^35^^1^VPR PROVIDER
"KRN",1.5,34,1,10,1)
4^CareProvider
"KRN",1.5,34,1,10,6)
N X S X=$$GET1^DIQ(FILE,DIEN_",",FIELD,"I") S:X DLIST(1)=X
"KRN",1.5,34,1,11,0)
Specimen^12^S^100
"KRN",1.5,34,1,11,6)
N ID S ID=$$VALUE^ORX8(DIEN,"SPECIMEN") S:ID VALUE=$$GET1^DIQ(61,ID_",",.01)
"KRN",1.5,34,1,12,0)
SpecimenCollectedTime^13^S^100^21^^1
"KRN",1.5,34,1,12,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,13,0)
Status^18^S^100^5^.02
"KRN",1.5,34,1,13,4)
N X S X=VALUE,VALUE=$S(X="dc":"D",X="canc":"C",X="laps":"C",X="dc/e":"R",X="comp":"E",X="exp":"E",X="hold":"H",X="part":"A",1:"IP")
"KRN",1.5,34,1,14,0)
Result^39^E^100^33^^^VPR LRCH RESULT
"KRN",1.5,34,1,14,4)

"KRN",1.5,34,1,14,6)
D LRSLT^VPRSDA
"KRN",1.5,34,1,15,0)
PlacerId^1^I
"KRN",1.5,34,1,16,0)
EnteringOrganization^9^E^100^6^^1^VPR LOCATION
"KRN",1.5,34,1,16,4)
S VALUE=+VALUE S:VALUE<1 VALUE=""
"KRN",1.5,34,1,17,0)
FromTime^37^S^100^21^^1
"KRN",1.5,34,1,17,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,18,0)
ToTime^38^S^100^22^^1
"KRN",1.5,34,1,18,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,19,0)
UpdatedOn^50^S^100^31^^1
"KRN",1.5,34,1,19,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,20,0)
AuthorizationTime^26^S^100.008^6^^1
"KRN",1.5,34,1,20,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,34,1,20,6)
S IEN="1,"_DIEN
"KRN",1.5,34,1,21,0)
Extension^53^E^100^^^^VPR ORDER EXTENSION
"KRN",1.5,34,1,21,6)
S VALUE=DIEN
"KRN",1.5,34,1,22,0)
ExternalId^51^I
"KRN",1.5,34,1,"B","AuthorizationTime",20)

"KRN",1.5,34,1,"B","EnteredAt",1)

"KRN",1.5,34,1,"B","EnteredBy",2)

"KRN",1.5,34,1,"B","EnteredOn",3)

"KRN",1.5,34,1,"B","EnteringOrganization",16)

"KRN",1.5,34,1,"B","Extension",21)

"KRN",1.5,34,1,"B","ExternalId",22)

"KRN",1.5,34,1,"B","FillerId",4)

"KRN",1.5,34,1,"B","FromTime",17)

"KRN",1.5,34,1,"B","OrderCategory",5)

"KRN",1.5,34,1,"B","OrderItem",6)

"KRN",1.5,34,1,"B","OrderedBy",7)

"KRN",1.5,34,1,"B","PlacerId",15)

"KRN",1.5,34,1,"B","Priority",9)

"KRN",1.5,34,1,"B","Result",14)

"KRN",1.5,34,1,"B","ResultCopiesTo",10)

"KRN",1.5,34,1,"B","Specimen",11)

"KRN",1.5,34,1,"B","SpecimenCollectedTime",12)

"KRN",1.5,34,1,"B","Status",13)

"KRN",1.5,34,1,"B","ToTime",18)

"KRN",1.5,34,1,"B","UpdatedOn",19)

"KRN",1.5,34,1,"SEQ",1,15)

"KRN",1.5,34,1,"SEQ",3,4)

"KRN",1.5,34,1,"SEQ",5,6)

"KRN",1.5,34,1,"SEQ",6,5)

"KRN",1.5,34,1,"SEQ",8,7)

"KRN",1.5,34,1,"SEQ",9,16)

"KRN",1.5,34,1,"SEQ",12,11)

"KRN",1.5,34,1,"SEQ",13,12)

"KRN",1.5,34,1,"SEQ",18,13)

"KRN",1.5,34,1,"SEQ",19,9)

"KRN",1.5,34,1,"SEQ",26,20)

"KRN",1.5,34,1,"SEQ",29,10)

"KRN",1.5,34,1,"SEQ",34,2)

"KRN",1.5,34,1,"SEQ",35,1)

"KRN",1.5,34,1,"SEQ",36,3)

"KRN",1.5,34,1,"SEQ",37,17)

"KRN",1.5,34,1,"SEQ",38,18)

"KRN",1.5,34,1,"SEQ",39,14)

"KRN",1.5,34,1,"SEQ",50,19)

"KRN",1.5,34,1,"SEQ",51,22)

"KRN",1.5,34,1,"SEQ",53,21)

"KRN",1.5,34,2)
S:'DFN&ID DFN=+$P($G(^OR(100,ID,0)),U,2) S LRDFN=+$G(^DPT(DFN,"LR")) S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,34,3)
K LRDFN,VASITE,VPRSUB,ORIT,ORPK
"KRN",1.5,34,5)
ORDERS^VPRSDAQ("LAB")
"KRN",1.5,34,19,0)
^1.519^1^1^3190226^^^
"KRN",1.5,34,19,1,0)
This entity populates the Lab Order container in HealthShare.
"KRN",1.5,38,-1)
0^22
"KRN",1.5,38,0)
VPR LRCH RESULT^63.04^^^^S
"KRN",1.5,38,.1)
Result
"KRN",1.5,38,1,0)
^1.51^9^9
"KRN",1.5,38,1,1,0)
Extension^3^E^63.04^^^^VPR LRCH RESULT EXTENSION
"KRN",1.5,38,1,1,6)
S VALUE=DIEN
"KRN",1.5,38,1,2,0)
EnteredAt^22^E^63.04^.112^^1^VPR FACILITY
"KRN",1.5,38,1,2,6)
S VALUE=$G(LRFAC) S:'VALUE VALUE=$P($G(LR0),U,14)
"KRN",1.5,38,1,3,0)
ResultTime^7^S^63.04^.03^^1
"KRN",1.5,38,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,38,1,3,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,38,1,4,0)
ResultStatus^8^S^63.04^.03^^1
"KRN",1.5,38,1,4,4)
S VALUE=$S(VALUE:"F",1:"P") ;Date Rpt Comp = Final
"KRN",1.5,38,1,4,5)
S VALUE=""
"KRN",1.5,38,1,4,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,38,1,5,0)
ResultType^4^F
"KRN",1.5,38,1,5,2)
AT
"KRN",1.5,38,1,6,0)
VerifiedBy^6^E^63.04^.04^^1^VPR USER
"KRN",1.5,38,1,6,6)
S VALUE=$G(LRVER) S:'VALUE VALUE=$P($G(LR0),U,4)
"KRN",1.5,38,1,7,0)
Comments^15^W^63.04^.99^^^^1
"KRN",1.5,38,1,7,6)
N I S I=0 F  S I=$O(^LR(+$G(LRDFN),"CH",+IEN,1,I)) S:(I="")&'$D(WP) DDEOUT=1 Q:I<1  S WP(I)=$P($G(^(I,0)),U)
"KRN",1.5,38,1,8,0)
ResultItems^5^L^^^^^VPR LRCH RESULT ITEM
"KRN",1.5,38,1,8,1)
4^LabResultItem
"KRN",1.5,38,1,8,6)
D LRCH^VPRSDA(+DATA) ;build DLIST(60 ien) = CH data node#,LRIDT,LRDFN
"KRN",1.5,38,1,9,0)
ExternalId^24^F
"KRN",1.5,38,1,9,6)
S VALUE="CH;"_+DIEN
"KRN",1.5,38,1,"B","Comments",7)

"KRN",1.5,38,1,"B","EnteredAt",2)

"KRN",1.5,38,1,"B","Extension",1)

"KRN",1.5,38,1,"B","ExternalId",9)

"KRN",1.5,38,1,"B","ResultItems",8)

"KRN",1.5,38,1,"B","ResultStatus",4)

"KRN",1.5,38,1,"B","ResultTime",3)

"KRN",1.5,38,1,"B","ResultType",5)

"KRN",1.5,38,1,"B","VerifiedBy",6)

"KRN",1.5,38,1,"SEQ",3,1)

"KRN",1.5,38,1,"SEQ",4,5)

"KRN",1.5,38,1,"SEQ",5,8)

"KRN",1.5,38,1,"SEQ",6,6)

"KRN",1.5,38,1,"SEQ",7,3)

"KRN",1.5,38,1,"SEQ",8,4)

"KRN",1.5,38,1,"SEQ",15,7)

"KRN",1.5,38,1,"SEQ",22,2)

"KRN",1.5,38,1,"SEQ",24,9)

"KRN",1.5,38,3)
K LRVER,LRFAC
"KRN",1.5,38,4)
S LR0=$G(^LR(LRDFN,"CH",+DIEN,0)) I '$P(LR0,U,3) S DDEOUT=1
"KRN",1.5,41,-1)
0^14
"KRN",1.5,41,0)
VPR PATIENT^2^^^^S
"KRN",1.5,41,.1)
Patient
"KRN",1.5,41,1,0)
^1.51^50^37
"KRN",1.5,41,1,1,0)
Name^3^E^2^.01^^^VPR NAME
"KRN",1.5,41,1,1,6)
S VALUE=$G(VADM(1))
"KRN",1.5,41,1,4,0)
MothersMaidenName^5^S^2^.2403
"KRN",1.5,41,1,4,4)
S VALUE=$P(VALUE,",")
"KRN",1.5,41,1,4,6)
S VALUE=$G(VAPD(5))
"KRN",1.5,41,1,5,0)
MothersFullName^6^E^2^.2402^^^VPR NAME
"KRN",1.5,41,1,5,6)
S VALUE=$G(VAPD(4))
"KRN",1.5,41,1,6,0)
Aliases^7^L^2.01^^^^VPR PATIENT ALIAS
"KRN",1.5,41,1,6,1)
2^Name
"KRN",1.5,41,1,7,0)
PrimaryLanguage^8^E^2.07^^^^VPR LANGUAGE
"KRN",1.5,41,1,7,6)
N X S X=$P($G(VADM(13,1)),U,2) I $L(X) S DATA=X,VALUE=$$FIND1^DIC(.85,,"X",X)
"KRN",1.5,41,1,8,0)
Religion^10^E^2^.08^^1^VPR RELIGION
"KRN",1.5,41,1,8,6)
S VALUE=$P($G(VADM(9)),U),DATA=$P($G(VADM(9)),U,2)
"KRN",1.5,41,1,9,0)
MaritalStatus^11^E^2^.05^^1^VPR MARITAL STATUS
"KRN",1.5,41,1,9,6)
N X S X=$G(VADM(10)) S:'X DDEOUT=1 I X S VALUE=+$G(^DIC(11,+X,"MASTER")) S:'VALUE VALUE=X
"KRN",1.5,41,1,10,0)
Gender^12^E^2^.02^^1^VPR CODE TABLE
"KRN",1.5,41,1,10,6)
S VALUE=$G(VADM(5))
"KRN",1.5,41,1,11,0)
Races^15^L^2.02^^^^VPR RACE
"KRN",1.5,41,1,11,1)
4^Race
"KRN",1.5,41,1,11,6)
M DLIST=VADM(12)
"KRN",1.5,41,1,12,0)
EthnicGroup^16^E^2.06^^^^VPR ETHNICITY
"KRN",1.5,41,1,12,6)
S VALUE=$P($G(VADM(11,1)),U),DATA=$P($G(VADM(11,1)),U,2)
"KRN",1.5,41,1,13,0)
SupportContacts^17^L^2
"KRN",1.5,41,1,13,1)
3^SupportContact
"KRN",1.5,41,1,13,3,0)
^1.513I^2^2
"KRN",1.5,41,1,13,3,1,0)
1^NOK
"KRN",1.5,41,1,13,3,2,0)
2^ECON
"KRN",1.5,41,1,13,3,"B",1,1)

"KRN",1.5,41,1,13,3,"B",2,2)

"KRN",1.5,41,1,14,0)
BirthTime^18^S^2^.03^^1
"KRN",1.5,41,1,14,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,41,1,14,6)
S VALUE=$P($G(VADM(3)),U) I $E(VALUE,4,5)="00"!($E(VALUE,6,7)="00") S DDEOUT=1
"KRN",1.5,41,1,15,0)
IsProtected^21^S^38.1^2^^1
"KRN",1.5,41,1,15,4)
S VALUE=$S(VALUE:"true",VALUE=0:"false",1:"")
"KRN",1.5,41,1,15,5)
S VALUE=$S(VALUE="true":1,VALUE="false":0,1:"")
"KRN",1.5,41,1,16,0)
ProtectedEffectiveDate^22^S^38.1^4^^1
"KRN",1.5,41,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,41,1,17,0)
DeathTime^23^S^2^.351^^1
"KRN",1.5,41,1,17,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,41,1,17,6)
S VALUE=$P($G(VADM(6)),U)
"KRN",1.5,41,1,18,0)
IsDead^24^S^2^.351^^1
"KRN",1.5,41,1,18,4)
S VALUE=$S(VALUE:"true",1:"false")
"KRN",1.5,41,1,18,5)
S VALUE=""
"KRN",1.5,41,1,18,6)
S VALUE=+$G(VADM(6))
"KRN",1.5,41,1,19,0)
PatientNumbers^28^L
"KRN",1.5,41,1,19,1)
3^PatientNumber
"KRN",1.5,41,1,19,3,0)
^1.513I^2^2
"KRN",1.5,41,1,19,3,1,0)
1^SSN
"KRN",1.5,41,1,19,3,2,0)
2^MRN
"KRN",1.5,41,1,19,3,"B",1,1)

"KRN",1.5,41,1,19,3,"B",2,2)

"KRN",1.5,41,1,20,0)
Addresses^30^L
"KRN",1.5,41,1,20,1)
3^Address
"KRN",1.5,41,1,20,3,0)
^1.513I^1^1
"KRN",1.5,41,1,20,3,1,0)
1^PermanentAddress
"KRN",1.5,41,1,20,3,"B",1,1)

"KRN",1.5,41,1,21,0)
ContactInfo^31^C^
"KRN",1.5,41,1,21,3,0)
^1.513I^4^4
"KRN",1.5,41,1,21,3,1,0)
1^HomePhoneNumber
"KRN",1.5,41,1,21,3,2,0)
2^WorkPhoneNumber
"KRN",1.5,41,1,21,3,3,0)
3^MobilePhoneNumber
"KRN",1.5,41,1,21,3,4,0)
4^EmailAddress
"KRN",1.5,41,1,21,3,"B",1,1)

"KRN",1.5,41,1,21,3,"B",2,2)

"KRN",1.5,41,1,21,3,"B",3,3)

"KRN",1.5,41,1,21,3,"B",4,4)

"KRN",1.5,41,1,22,0)
FamilyDoctor^32^E^2^^^^VPR FAMILY DOCTOR
"KRN",1.5,41,1,22,6)
N X S X=$$OUTPTPR^SDUTL3(DIEN) S:X VALUE=+X ;pcProvider
"KRN",1.5,41,1,23,0)
Occupation^34^E^2^.07^^^VPR CODE ONLY
"KRN",1.5,41,1,23,6)
S VALUE=$G(VAPD(6))
"KRN",1.5,41,1,24,0)
Comments^37^S^2^.091
"KRN",1.5,41,1,24,6)
S VALUE=$G(VADM(7))
"KRN",1.5,41,1,27,0)
EnteredBy^43^E^2^.096^^1^VPR USER
"KRN",1.5,41,1,28,0)
EnteredAt^45^E^2^^^^VPR FACILITY
"KRN",1.5,41,1,28,6)
S VALUE=$G(VASITE) ;default #4 ien
"KRN",1.5,41,1,29,0)
EnteredOn^46^S^2^.097^^1
"KRN",1.5,41,1,29,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,41,1,32,0)
PermanentAddress^^E^2^^^^VPR PATIENT ADDRESS
"KRN",1.5,41,1,32,6)
S VALUE=DIEN
"KRN",1.5,41,1,33,0)
HomePhoneNumber^^S^2^.131
"KRN",1.5,41,1,34,0)
WorkPhoneNumber^^S^2^.132
"KRN",1.5,41,1,35,0)
MobilePhoneNumber^^S^2^.134
"KRN",1.5,41,1,36,0)
EmailAddress^^S^2^.133
"KRN",1.5,41,1,37,0)
SSN^^E^2^.09^^^VPR PATIENT NUMBER
"KRN",1.5,41,1,37,4)
S VALUE=$P($G(VADM(2)),U)_"^SSN^^SSA"
"KRN",1.5,41,1,42,0)
MRN^^E^2^^^^VPR PATIENT NUMBER
"KRN",1.5,41,1,42,6)
S VALUE=DIEN_"^MRN^"_$G(VASTN)_U_$G(VASTN)
"KRN",1.5,41,1,46,0)
BirthPlace^19^E^2^^^^VPR PATIENT BIRTHPLACE
"KRN",1.5,41,1,46,6)
S VALUE=DIEN
"KRN",1.5,41,1,47,0)
NOK^^E^2^^^^VPR PATIENT NOK
"KRN",1.5,41,1,47,6)
S VALUE=DIEN
"KRN",1.5,41,1,48,0)
ECON^^E^2^^^^VPR PATIENT ECON
"KRN",1.5,41,1,48,6)
S VALUE=DIEN
"KRN",1.5,41,1,49,0)
Extension^1^E^2^^^^VPR PATIENT EXTENSION
"KRN",1.5,41,1,49,6)
S VALUE=DIEN
"KRN",1.5,41,1,50,0)
OtherLanguages^9^L^^^^^VPR PATIENT LANGUAGE
"KRN",1.5,41,1,50,1)
4^PatientLanguage
"KRN",1.5,41,1,50,6)
N I S I=+$G(VADM(13,1)) S:I DLIST(1)=I_","_$G(DFN)
"KRN",1.5,41,1,"B","Addresses",20)

"KRN",1.5,41,1,"B","Aliases",6)

"KRN",1.5,41,1,"B","BirthPlace",46)

"KRN",1.5,41,1,"B","BirthTime",14)

"KRN",1.5,41,1,"B","Comments",24)

"KRN",1.5,41,1,"B","ContactInfo",21)

"KRN",1.5,41,1,"B","DeathTime",17)

"KRN",1.5,41,1,"B","ECON",48)

"KRN",1.5,41,1,"B","EmailAddress",36)

"KRN",1.5,41,1,"B","EnteredAt",28)

"KRN",1.5,41,1,"B","EnteredBy",27)

"KRN",1.5,41,1,"B","EnteredOn",29)

"KRN",1.5,41,1,"B","EthnicGroup",12)

"KRN",1.5,41,1,"B","Extension",49)

"KRN",1.5,41,1,"B","FamilyDoctor",22)

"KRN",1.5,41,1,"B","Gender",10)

"KRN",1.5,41,1,"B","HomePhoneNumber",33)

"KRN",1.5,41,1,"B","IsDead",18)

"KRN",1.5,41,1,"B","IsProtected",15)

"KRN",1.5,41,1,"B","MRN",42)

"KRN",1.5,41,1,"B","MaritalStatus",9)

"KRN",1.5,41,1,"B","MobilePhoneNumber",35)

"KRN",1.5,41,1,"B","MothersFullName",5)

"KRN",1.5,41,1,"B","MothersMaidenName",4)

"KRN",1.5,41,1,"B","NOK",47)

"KRN",1.5,41,1,"B","Name",1)

"KRN",1.5,41,1,"B","Occupation",23)

"KRN",1.5,41,1,"B","OtherLanguages",50)

"KRN",1.5,41,1,"B","PatientNumbers",19)

"KRN",1.5,41,1,"B","PermanentAddress",32)

"KRN",1.5,41,1,"B","PrimaryLanguage",7)

"KRN",1.5,41,1,"B","ProtectedEffectiveDate",16)

"KRN",1.5,41,1,"B","Races",11)

"KRN",1.5,41,1,"B","Religion",8)

"KRN",1.5,41,1,"B","SSN",37)

"KRN",1.5,41,1,"B","SupportContacts",13)

"KRN",1.5,41,1,"B","WorkPhoneNumber",34)

"KRN",1.5,41,1,"SEQ",1,49)

"KRN",1.5,41,1,"SEQ",3,1)

"KRN",1.5,41,1,"SEQ",5,4)

"KRN",1.5,41,1,"SEQ",6,5)

"KRN",1.5,41,1,"SEQ",7,6)

"KRN",1.5,41,1,"SEQ",8,7)

"KRN",1.5,41,1,"SEQ",9,50)

"KRN",1.5,41,1,"SEQ",10,8)

"KRN",1.5,41,1,"SEQ",11,9)

"KRN",1.5,41,1,"SEQ",12,10)

"KRN",1.5,41,1,"SEQ",15,11)

"KRN",1.5,41,1,"SEQ",16,12)

"KRN",1.5,41,1,"SEQ",17,13)

"KRN",1.5,41,1,"SEQ",18,14)

"KRN",1.5,41,1,"SEQ",19,46)

"KRN",1.5,41,1,"SEQ",21,15)

"KRN",1.5,41,1,"SEQ",22,16)

"KRN",1.5,41,1,"SEQ",23,17)

"KRN",1.5,41,1,"SEQ",24,18)

"KRN",1.5,41,1,"SEQ",28,19)

"KRN",1.5,41,1,"SEQ",30,20)

"KRN",1.5,41,1,"SEQ",31,21)

"KRN",1.5,41,1,"SEQ",32,22)

"KRN",1.5,41,1,"SEQ",34,23)

"KRN",1.5,41,1,"SEQ",37,24)

"KRN",1.5,41,1,"SEQ",43,27)

"KRN",1.5,41,1,"SEQ",45,28)

"KRN",1.5,41,1,"SEQ",46,29)

"KRN",1.5,41,2)
N X S X=$$SITE^VASITE S:X>0 VASITE=+X,VASTN=$P(X,U,3) I X'>0 S VASITE=$$KSP^XUPARAM("INST"),VASTN=$$STA^XUAF4(VASITE)
"KRN",1.5,41,3)
K VA,VADM,VAPD,DDESC,VASITE,VASTN
"KRN",1.5,41,4)
S DFN=DIEN D DEM^VADPT,OPD^VADPT
"KRN",1.5,41,19,0)
^1.519^2^2^3181227^^^^
"KRN",1.5,41,19,1,0)
This entity populates the Patient container in HealthShare. Data is pulled
"KRN",1.5,41,19,2,0)
from the Registration package using supported calls to VADPT.
"KRN",1.5,52,-1)
0^3
"KRN",1.5,52,0)
VPR ALLERGY^120.8^^^^S
"KRN",1.5,52,.1)
Allergy
"KRN",1.5,52,1,0)
^1.51^25^18
"KRN",1.5,52,1,1,0)
Allergy^3^E^120.8^1^^1^VPR CODE TABLE
"KRN",1.5,52,1,1,4)
S VALUE=$$ALLERGEN^VPRSDAL(VALUE)
"KRN",1.5,52,1,1,6)
S VALUE=$P(VPRALG,U,9)
"KRN",1.5,52,1,2,0)
AllergyCategory^4^E^120.8^3.1^^1^VPR CODE TABLE
"KRN",1.5,52,1,2,4)
N X S X=$$EXTERNAL^DILFD(120.8,3.1,,VALUE),VALUE=X_U_X_"^VHAT"
"KRN",1.5,52,1,2,6)
S VALUE=$P(VPRALG,U,7)
"KRN",1.5,52,1,3,0)
EnteredBy^22^E^120.8^5^^1^VPR USER
"KRN",1.5,52,1,4,0)
Reaction^6^E^120.8^^^^VPR ALLERGY SIGN/SYMPTOM
"KRN",1.5,52,1,4,6)
I $D(VPRALG("S")) N X S X=$G(VPRALG("S",1)),VALUE=$P($P(X,U),";",2)_U_$P($P(X,U),";") ;first
"KRN",1.5,52,1,5,0)
Severity^7^E^120.85^^^^VPR CODE TABLE
"KRN",1.5,52,1,5,6)
S VALUE=$$ALGSEV^VPRSDAL(DIEN)
"KRN",1.5,52,1,6,0)
Certainty^8^E^120.8^19^^1^VPR CODE TABLE
"KRN",1.5,52,1,6,4)
S VALUE=VALUE_U_$S('VALUE:"Unv",1:"V")_"erified"
"KRN",1.5,52,1,6,6)
S VALUE=($E($P($G(GMRAY),U,4))="V")
"KRN",1.5,52,1,8,0)
VerifiedTime^14^S^120.8^20^^1
"KRN",1.5,52,1,8,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,52,1,8,6)
S VALUE=$P($G(GMRAY),U,9)
"KRN",1.5,52,1,9,0)
FreeTextAllergy^17^S^120.8^.02
"KRN",1.5,52,1,9,6)
S VALUE=$P(VPRALG,U,2) S:VALUE="" VALUE=$P(GMRAY,U)
"KRN",1.5,52,1,11,0)
EnteredAt^23^E^120.8^^^^VPR FACILITY
"KRN",1.5,52,1,11,6)
S VALUE=$G(VASITE) ;default #4 ien
"KRN",1.5,52,1,12,0)
EnteredOn^24^S^120.8^4^^1
"KRN",1.5,52,1,12,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,52,1,12,6)
N X,Y,%DT S X=$P($G(GMRAY),U,10),%DT="TSX" I $L(X) D ^%DT S:Y>0 VALUE=Y
"KRN",1.5,52,1,18,0)
Extension^2^E^120.8^^^^VPR ALLERGY EXTENSION
"KRN",1.5,52,1,18,6)
S VALUE=DIEN
"KRN",1.5,52,1,19,0)
Clinician^5^E^120.8^21^^1^VPR PROVIDER
"KRN",1.5,52,1,20,0)
Status^19^S^120.8^22^^1
"KRN",1.5,52,1,20,4)
S VALUE=$S(VALUE:"I",1:"A")
"KRN",1.5,52,1,21,0)
FromTime^25^S^120.85
"KRN",1.5,52,1,21,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,52,1,21,6)
S VALUE=$$ALGDT^VPRSDAL(DIEN)
"KRN",1.5,52,1,22,0)
ToTime^26^S^120.8^23^^1
"KRN",1.5,52,1,22,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,52,1,23,0)
InactiveTime^12^S^120.8^23^^1
"KRN",1.5,52,1,23,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,52,1,24,0)
InactiveComments^13^S^120.8
"KRN",1.5,52,1,24,6)
S VALUE=$$ALGCMT1^VPRSDAL(DIEN,"E")
"KRN",1.5,52,1,25,0)
ExternalId^27^I
"KRN",1.5,52,1,"B","Allergy",1)

"KRN",1.5,52,1,"B","AllergyCategory",2)

"KRN",1.5,52,1,"B","Certainty",6)

"KRN",1.5,52,1,"B","Clinician",19)

"KRN",1.5,52,1,"B","EnteredAt",11)

"KRN",1.5,52,1,"B","EnteredBy",3)

"KRN",1.5,52,1,"B","EnteredOn",12)

"KRN",1.5,52,1,"B","Extension",18)

"KRN",1.5,52,1,"B","ExternalId",25)

"KRN",1.5,52,1,"B","FreeTextAllergy",9)

"KRN",1.5,52,1,"B","FromTime",21)

"KRN",1.5,52,1,"B","InactiveComments",24)

"KRN",1.5,52,1,"B","InactiveTime",23)

"KRN",1.5,52,1,"B","Reaction",4)

"KRN",1.5,52,1,"B","Severity",5)

"KRN",1.5,52,1,"B","Status",20)

"KRN",1.5,52,1,"B","ToTime",22)

"KRN",1.5,52,1,"B","VerifiedTime",8)

"KRN",1.5,52,1,"SEQ",2,18)

"KRN",1.5,52,1,"SEQ",3,1)

"KRN",1.5,52,1,"SEQ",4,2)

"KRN",1.5,52,1,"SEQ",5,19)

"KRN",1.5,52,1,"SEQ",6,4)

"KRN",1.5,52,1,"SEQ",7,5)

"KRN",1.5,52,1,"SEQ",8,6)

"KRN",1.5,52,1,"SEQ",12,23)

"KRN",1.5,52,1,"SEQ",13,24)

"KRN",1.5,52,1,"SEQ",14,8)

"KRN",1.5,52,1,"SEQ",17,9)

"KRN",1.5,52,1,"SEQ",19,20)

"KRN",1.5,52,1,"SEQ",22,3)

"KRN",1.5,52,1,"SEQ",23,11)

"KRN",1.5,52,1,"SEQ",24,12)

"KRN",1.5,52,1,"SEQ",25,21)

"KRN",1.5,52,1,"SEQ",26,22)

"KRN",1.5,52,1,"SEQ",27,25)

"KRN",1.5,52,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,52,3)
K GMRAL,GMRAY,VPRALG,VASITE
"KRN",1.5,52,4)
D ALG1^VPRSDAL(DIEN)
"KRN",1.5,52,5)
ALLERGYS^VPRSDAQ
"KRN",1.5,52,19,0)
^^1^1^3181227^
"KRN",1.5,52,19,1,0)
This entity populates the Allergy container in HealthShare.
"KRN",1.5,55,-1)
0^5
"KRN",1.5,55,0)
VPR RAD ORDER^100^^^^S
"KRN",1.5,55,.1)
RadOrder
"KRN",1.5,55,1,0)
^1.51^24^21
"KRN",1.5,55,1,1,0)
EnteredAt^35^E^100^6^^1^VPR FACILITY
"KRN",1.5,55,1,1,4)
S:VALUE VALUE=$$GET1^DIQ(44,+VALUE_",",3,"I") S:'VALUE VALUE=$G(VASITE) ;#4 ien
"KRN",1.5,55,1,2,0)
EnteredBy^34^E^100^3^^1^VPR USER
"KRN",1.5,55,1,3,0)
EnteredOn^36^S^100^4^^1
"KRN",1.5,55,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,55,1,4,0)
FillerId^3^S^100^33
"KRN",1.5,55,1,4,6)
S ORPK=$$PKGID^ORX8(DIEN),VALUE=ORPK
"KRN",1.5,55,1,5,0)
OrderCategory^6^E^100^23^^1^VPR DISPLAY GROUP
"KRN",1.5,55,1,6,0)
OrderItem^5^E^100.01^.01^^^VPR ORDERABLE ITEM
"KRN",1.5,55,1,6,6)
S VALUE=+$O(^OR(100,DIEN,.1,"B",0)) ;only 1
"KRN",1.5,55,1,7,0)
OrderedBy^8^E^100^1^^1^VPR PROVIDER
"KRN",1.5,55,1,9,0)
Priority^19^E^100^^^^VPR ORDER URGENCY
"KRN",1.5,55,1,9,6)
S VALUE=$$VALUE^ORX8(DIEN,"URGENCY")
"KRN",1.5,55,1,10,0)
ResultCopiesTo^29^L^100^35^^1^VPR PROVIDER
"KRN",1.5,55,1,10,1)
4^CareProvider
"KRN",1.5,55,1,10,6)
N X S X=$$GET1^DIQ(FILE,DIEN_",",FIELD,"I") S:X DLIST(1)=X
"KRN",1.5,55,1,13,0)
Status^18^S^100^5^.02
"KRN",1.5,55,1,13,4)
N X S X=VALUE,VALUE=$S(X="dc":"D",X="canc":"C",X="laps":"C",X="dc/e":"R",X="comp":"E",X="exp":"E",X="hold":"H",X="part":"A",1:"IP")
"KRN",1.5,55,1,14,0)
Result^39^E^100^33^^^VPR RAD RESULT
"KRN",1.5,55,1,14,4)

"KRN",1.5,55,1,14,6)
S VALUE=$G(ORPK) S:VALUE="" DDEOUT=1
"KRN",1.5,55,1,15,0)
PlacerId^1^I
"KRN",1.5,55,1,16,0)
FromTime^37^S^100^21^^1
"KRN",1.5,55,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,55,1,17,0)
ToTime^38^S^100^22^^1
"KRN",1.5,55,1,17,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,55,1,18,0)
UpdatedOn^50^S^100^31^^1
"KRN",1.5,55,1,18,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,55,1,19,0)
ClinicalInformation^41^S^100
"KRN",1.5,55,1,19,6)
S VALUE=$$VALUE^ORX8(DIEN,"COMMENT")
"KRN",1.5,55,1,20,0)
ReasonForStudy^49^E^100^^^^VPR CODE ONLY
"KRN",1.5,55,1,20,6)
S VALUE=$$VALUE^ORX8(DIEN,"REASON")
"KRN",1.5,55,1,21,0)
AuthorizationTime^26^S^100.008^6^^1
"KRN",1.5,55,1,21,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,55,1,21,6)
S IEN="1,"_DIEN
"KRN",1.5,55,1,22,0)
EnteringOrganization^9^E^100^6^^1^VPR LOCATION
"KRN",1.5,55,1,22,4)
S VALUE=+VALUE S:VALUE<1 VALUE=""
"KRN",1.5,55,1,23,0)
Extension^53^E^100^^^^VPR ORDER EXTENSION
"KRN",1.5,55,1,23,6)
S VALUE=DIEN
"KRN",1.5,55,1,24,0)
ExternalId^51^I
"KRN",1.5,55,1,"B","AuthorizationTime",21)

"KRN",1.5,55,1,"B","ClinicalInformation",19)

"KRN",1.5,55,1,"B","EnteredAt",1)

"KRN",1.5,55,1,"B","EnteredBy",2)

"KRN",1.5,55,1,"B","EnteredOn",3)

"KRN",1.5,55,1,"B","EnteringOrganization",22)

"KRN",1.5,55,1,"B","Extension",23)

"KRN",1.5,55,1,"B","ExternalId",24)

"KRN",1.5,55,1,"B","FillerId",4)

"KRN",1.5,55,1,"B","FromTime",16)

"KRN",1.5,55,1,"B","OrderCategory",5)

"KRN",1.5,55,1,"B","OrderItem",6)

"KRN",1.5,55,1,"B","OrderedBy",7)

"KRN",1.5,55,1,"B","PlacerId",15)

"KRN",1.5,55,1,"B","Priority",9)

"KRN",1.5,55,1,"B","ReasonForStudy",20)

"KRN",1.5,55,1,"B","Result",14)

"KRN",1.5,55,1,"B","ResultCopiesTo",10)

"KRN",1.5,55,1,"B","Status",13)

"KRN",1.5,55,1,"B","ToTime",17)

"KRN",1.5,55,1,"B","UpdatedOn",18)

"KRN",1.5,55,1,"SEQ",1,15)

"KRN",1.5,55,1,"SEQ",3,4)

"KRN",1.5,55,1,"SEQ",5,6)

"KRN",1.5,55,1,"SEQ",6,5)

"KRN",1.5,55,1,"SEQ",8,7)

"KRN",1.5,55,1,"SEQ",9,22)

"KRN",1.5,55,1,"SEQ",18,13)

"KRN",1.5,55,1,"SEQ",19,9)

"KRN",1.5,55,1,"SEQ",26,21)

"KRN",1.5,55,1,"SEQ",29,10)

"KRN",1.5,55,1,"SEQ",34,2)

"KRN",1.5,55,1,"SEQ",35,1)

"KRN",1.5,55,1,"SEQ",36,3)

"KRN",1.5,55,1,"SEQ",37,16)

"KRN",1.5,55,1,"SEQ",38,17)

"KRN",1.5,55,1,"SEQ",39,14)

"KRN",1.5,55,1,"SEQ",41,19)

"KRN",1.5,55,1,"SEQ",49,20)

"KRN",1.5,55,1,"SEQ",50,18)

"KRN",1.5,55,1,"SEQ",51,24)

"KRN",1.5,55,1,"SEQ",53,23)

"KRN",1.5,55,2)
D PRE^VPRSDAR S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,55,3)
D POST^VPRSDAR K VASITE
"KRN",1.5,55,5)
ORDERS^VPRSDAQ("XRAY")
"KRN",1.5,55,19,0)
^^1^1^3181227^
"KRN",1.5,55,19,1,0)
This entity populates the Rad Order container in HealthShare.
"KRN",1.5,56,-1)
0^19
"KRN",1.5,56,0)
VPR OTHER ORDER^100^^^^S
"KRN",1.5,56,.1)
OtherOrder
"KRN",1.5,56,1,0)
^1.51^22^18
"KRN",1.5,56,1,1,0)
EnteredAt^35^E^100^6^^1^VPR FACILITY
"KRN",1.5,56,1,1,4)
S:VALUE VALUE=$$GET1^DIQ(44,+VALUE_",",3,"I") S:'VALUE VALUE=$G(VASITE) ;#4 ien
"KRN",1.5,56,1,2,0)
EnteredBy^34^E^100^3^^1^VPR USER
"KRN",1.5,56,1,3,0)
EnteredOn^36^S^100^4^^1
"KRN",1.5,56,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,56,1,4,0)
FillerId^3^S^100^33
"KRN",1.5,56,1,4,6)
S VALUE=$$PKGID^ORX8(DIEN)
"KRN",1.5,56,1,5,0)
OrderCategory^6^E^100^23^^1^VPR DISPLAY GROUP
"KRN",1.5,56,1,6,0)
OrderItem^5^E^100.01^.01^^^VPR ORDERABLE ITEM
"KRN",1.5,56,1,6,6)
S VALUE=$O(^OR(100,DIEN,.1,"B",0)) ;first
"KRN",1.5,56,1,7,0)
OrderedBy^8^E^100^1^^1^VPR PROVIDER
"KRN",1.5,56,1,9,0)
Priority^19^E^100^^^^VPR ORDER URGENCY
"KRN",1.5,56,1,9,6)
S VALUE=$$VALUE^ORX8(DIEN,"URGENCY")
"KRN",1.5,56,1,10,0)
ResultCopiesTo^29^L^100^35^^1^VPR PROVIDER
"KRN",1.5,56,1,10,1)
4^CareProvider
"KRN",1.5,56,1,10,6)
N X S X=$$GET1^DIQ(FILE,DIEN_",",FIELD,"I") S:X DLIST(1)=X I X="" S DDEOUT=1
"KRN",1.5,56,1,13,0)
Status^18^S^100^5^.02
"KRN",1.5,56,1,13,4)
N X S X=VALUE,VALUE=$S(X="dc":"D",X="canc":"C",X="laps":"C",X="dc/e":"R",X="comp":"E",X="exp":"E",X="hold":"H",X="part":"A",1:"IP")
"KRN",1.5,56,1,15,0)
PlacerId^1^I
"KRN",1.5,56,1,16,0)
EnteringOrganization^9^E^100^6^^1^VPR LOCATION
"KRN",1.5,56,1,16,4)
S VALUE=+VALUE S:VALUE<1 VALUE=""
"KRN",1.5,56,1,17,0)
FromTime^37^S^100^21^^1
"KRN",1.5,56,1,17,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,56,1,18,0)
ToTime^38^S^100^22^^1
"KRN",1.5,56,1,18,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,56,1,19,0)
UpdatedOn^50^S^100^31^^1
"KRN",1.5,56,1,19,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,56,1,20,0)
AuthorizationTime^26^S^100.008^6^^1
"KRN",1.5,56,1,20,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,56,1,20,6)
S IEN="1,"_DIEN
"KRN",1.5,56,1,21,0)
Extension^53^E^100^^^^VPR ORDER EXTENSION
"KRN",1.5,56,1,21,6)
S VALUE=DIEN
"KRN",1.5,56,1,22,0)
ExternalId^51^I
"KRN",1.5,56,1,"B","AuthorizationTime",20)

"KRN",1.5,56,1,"B","EnteredAt",1)

"KRN",1.5,56,1,"B","EnteredBy",2)

"KRN",1.5,56,1,"B","EnteredOn",3)

"KRN",1.5,56,1,"B","EnteringOrganization",16)

"KRN",1.5,56,1,"B","Extension",21)

"KRN",1.5,56,1,"B","ExternalId",22)

"KRN",1.5,56,1,"B","FillerId",4)

"KRN",1.5,56,1,"B","FromTime",17)

"KRN",1.5,56,1,"B","OrderCategory",5)

"KRN",1.5,56,1,"B","OrderItem",6)

"KRN",1.5,56,1,"B","OrderedBy",7)

"KRN",1.5,56,1,"B","PlacerId",15)

"KRN",1.5,56,1,"B","Priority",9)

"KRN",1.5,56,1,"B","ResultCopiesTo",10)

"KRN",1.5,56,1,"B","Status",13)

"KRN",1.5,56,1,"B","ToTime",18)

"KRN",1.5,56,1,"B","UpdatedOn",19)

"KRN",1.5,56,1,"SEQ",1,15)

"KRN",1.5,56,1,"SEQ",3,4)

"KRN",1.5,56,1,"SEQ",5,6)

"KRN",1.5,56,1,"SEQ",6,5)

"KRN",1.5,56,1,"SEQ",8,7)

"KRN",1.5,56,1,"SEQ",9,16)

"KRN",1.5,56,1,"SEQ",18,13)

"KRN",1.5,56,1,"SEQ",19,9)

"KRN",1.5,56,1,"SEQ",26,20)

"KRN",1.5,56,1,"SEQ",29,10)

"KRN",1.5,56,1,"SEQ",34,2)

"KRN",1.5,56,1,"SEQ",35,1)

"KRN",1.5,56,1,"SEQ",36,3)

"KRN",1.5,56,1,"SEQ",37,17)

"KRN",1.5,56,1,"SEQ",38,18)

"KRN",1.5,56,1,"SEQ",50,19)

"KRN",1.5,56,1,"SEQ",51,22)

"KRN",1.5,56,1,"SEQ",53,21)

"KRN",1.5,56,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,56,3)
K VASITE
"KRN",1.5,56,5)
NONORD^VPRSDAQ
"KRN",1.5,56,19,0)
^^1^1^3181227^
"KRN",1.5,56,19,1,0)
This entity populates the Other Order container in HealthShare.
"KRN",1.5,58,-1)
0^6
"KRN",1.5,58,0)
VPR RAD RESULT^70.03^^^^S
"KRN",1.5,58,.1)
Result
"KRN",1.5,58,1,0)
^1.51^16^16
"KRN",1.5,58,1,1,0)
Extension^3^E^70.03^17^^1^VPR RAD RESULT EXTENSION
"KRN",1.5,58,1,1,6)
S VALUE=$G(RARPT) S:'VALUE DDEOUT=1
"KRN",1.5,58,1,2,0)
ResultType^4^F
"KRN",1.5,58,1,2,2)
IM
"KRN",1.5,58,1,3,0)
VerifiedBy^6^E^70.03^15^^1^VPR PROVIDER
"KRN",1.5,58,1,3,6)
S VALUE=+$G(@VPRAE2@("V")) S:VALUE<1 DDEOUT=1
"KRN",1.5,58,1,4,0)
ResultTime^7^S^70.03^17^8^1
"KRN",1.5,58,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,58,1,5,0)
ResultStatus^8^S^70.03^17^5^
"KRN",1.5,58,1,5,4)
S VALUE=$S(VALUE["Draft":"P",VALUE="Deleted":"X",VALUE["Released/Not":"P",VALUE="No Report":"S",1:"F")
"KRN",1.5,58,1,5,6)
S VALUE=$P(@VPRAE2,U)
"KRN",1.5,58,1,6,0)
ResultText^9^W^70.03^17^200^^^1
"KRN",1.5,58,1,6,6)
S DDEOUT=1 ;M WP=@VPRAE2@("R")
"KRN",1.5,58,1,7,0)
FileType^10^F
"KRN",1.5,58,1,7,2)
TXT
"KRN",1.5,58,1,8,0)
DocumentName^11^S^70.03
"KRN",1.5,58,1,8,6)
S VALUE=$G(RAPROC) S:VALUE="" VALUE="RADIOLOGY REPORT"
"KRN",1.5,58,1,9,0)
DocumentNumber^14^S^70.03^17^^1
"KRN",1.5,58,1,9,6)
S:$D(RARPT)=1 VALUE=RARPT_";RA" I $D(RARPT)>9 S DDEOUT=1 ;list, returned in Extension instead
"KRN",1.5,58,1,10,0)
AuthorizationTime^16^S^70.03^17^7^1
"KRN",1.5,58,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,58,1,11,0)
PerformedAt^17^E^70.03^^^^VPR FACILITY
"KRN",1.5,58,1,11,6)
N IMG,HLOC S IMG=$P(VPRAE1,U,7) S:$L(IMG) HLOC=+$O(^SC("B",IMG,0)),VALUE=$$GET1^DIQ(44,HLOC_",",3,"I")
"KRN",1.5,58,1,12,0)
ResultInterpretation^18^S^70.03
"KRN",1.5,58,1,12,6)
S VALUE=$$ABN^VPRSDAR ;Abnormal?
"KRN",1.5,58,1,13,0)
EnteredBy^21^E^70.03^17^11^1^VPR USER
"KRN",1.5,58,1,14,0)
EnteredAt^22^E^70.03^^^^VPR FACILITY
"KRN",1.5,58,1,14,6)
N IMG,HLOC S IMG=$P(VPRAE1,U,7) S:$L(IMG) HLOC=+$O(^SC("B",IMG,0)),VALUE=$$GET1^DIQ(44,HLOC_",",3,"I") S:'$G(VALUE) VALUE=$G(VASITE)
"KRN",1.5,58,1,15,0)
EnteredOn^23^S^70.03^17^6^1
"KRN",1.5,58,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,58,1,16,0)
FromTime^1^S^70.03
"KRN",1.5,58,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,58,1,16,6)
S VALUE=9999999.9999-$P(DIEN,",",2)
"KRN",1.5,58,1,"B","AuthorizationTime",10)

"KRN",1.5,58,1,"B","DocumentName",8)

"KRN",1.5,58,1,"B","DocumentNumber",9)

"KRN",1.5,58,1,"B","EnteredAt",14)

"KRN",1.5,58,1,"B","EnteredBy",13)

"KRN",1.5,58,1,"B","EnteredOn",15)

"KRN",1.5,58,1,"B","Extension",1)

"KRN",1.5,58,1,"B","FileType",7)

"KRN",1.5,58,1,"B","FromTime",16)

"KRN",1.5,58,1,"B","PerformedAt",11)

"KRN",1.5,58,1,"B","ResultInterpretation",12)

"KRN",1.5,58,1,"B","ResultStatus",5)

"KRN",1.5,58,1,"B","ResultText",6)

"KRN",1.5,58,1,"B","ResultTime",4)

"KRN",1.5,58,1,"B","ResultType",2)

"KRN",1.5,58,1,"B","VerifiedBy",3)

"KRN",1.5,58,1,"SEQ",1,16)

"KRN",1.5,58,1,"SEQ",3,1)

"KRN",1.5,58,1,"SEQ",4,2)

"KRN",1.5,58,1,"SEQ",6,3)

"KRN",1.5,58,1,"SEQ",7,4)

"KRN",1.5,58,1,"SEQ",8,5)

"KRN",1.5,58,1,"SEQ",9,6)

"KRN",1.5,58,1,"SEQ",10,7)

"KRN",1.5,58,1,"SEQ",11,8)

"KRN",1.5,58,1,"SEQ",14,9)

"KRN",1.5,58,1,"SEQ",16,10)

"KRN",1.5,58,1,"SEQ",17,11)

"KRN",1.5,58,1,"SEQ",18,12)

"KRN",1.5,58,1,"SEQ",21,13)

"KRN",1.5,58,1,"SEQ",22,14)

"KRN",1.5,58,1,"SEQ",23,15)

"KRN",1.5,58,2)

"KRN",1.5,58,3)
K VPRAE1,VPRAE2,RARPT,RAPROC
"KRN",1.5,58,4)
D ONE^VPRSDAR(.DIEN) ;RA order# -> case,exam,DFN IENS
"KRN",1.5,58,19,0)
^^1^1^3190220^
"KRN",1.5,58,19,1,0)
This entity supports VPR RAD ORDER, supplying result information.
"KRN",1.5,79,-1)
0^30
"KRN",1.5,79,0)
VPR MEDICATION^100^^^^S
"KRN",1.5,79,.1)
Medication
"KRN",1.5,79,1,0)
^1.51^44^37
"KRN",1.5,79,1,1,0)
EnteredAt^30^E^100^6^^1^VPR FACILITY
"KRN",1.5,79,1,1,4)
S:VALUE VALUE=$$GET1^DIQ(44,+VALUE_",",3,"I") S:'VALUE VALUE=$G(VASITE) ;#4 ien
"KRN",1.5,79,1,2,0)
EnteredBy^29^E^100^3^^1^VPR USER
"KRN",1.5,79,1,3,0)
EnteredOn^31^S^100^4^^1
"KRN",1.5,79,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,79,1,4,0)
FillerId^3^S^100^33
"KRN",1.5,79,1,4,6)
S VALUE=$$PKGID^ORX8(DIEN)
"KRN",1.5,79,1,5,0)
OrderCategory^6^E^100^23^^1^VPR DISPLAY GROUP
"KRN",1.5,79,1,5,6)
S DATA=$S($G(PSTYPE)="N":"OTC",$G(PSTYPE)="O":"Prescription",1:"") ;HITSP category
"KRN",1.5,79,1,6,0)
OrderItem^5^E^100^^^^VPR ORDERABLE ITEM
"KRN",1.5,79,1,6,6)
N OI S OI=$$OI^ORX8(DIEN),VALUE=+OI,PSOI=+$P(OI,U,3) ;first
"KRN",1.5,79,1,7,0)
OrderedBy^8^E^100^1^^1^VPR PROVIDER
"KRN",1.5,79,1,9,0)
Priority^16^E^100^^^^VPR ORDER URGENCY
"KRN",1.5,79,1,9,6)
S VALUE=$$VALUE^ORX8(DIEN,"URGENCY")
"KRN",1.5,79,1,13,0)
Status^15^S^100^5^.02
"KRN",1.5,79,1,13,4)
N X S X=VALUE,VALUE=$S(X="dc":"D",X="canc":"C",X="laps":"C",X="dc/e":"R",X="comp":"E",X="exp":"E",X="hold":"H",X="part":"A",1:"IP")
"KRN",1.5,79,1,15,0)
PlacerId^1^I
"KRN",1.5,79,1,16,0)
EnteringOrganization^9^E^100^6^^1^VPR LOCATION
"KRN",1.5,79,1,16,4)
S VALUE=+VALUE S:VALUE<1 VALUE=""
"KRN",1.5,79,1,17,0)
FromTime^32^S^100^21^^1
"KRN",1.5,79,1,17,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,79,1,18,0)
ToTime^33^S^100^22^^1
"KRN",1.5,79,1,18,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,79,1,19,0)
UpdatedOn^58^S^100^31^^1
"KRN",1.5,79,1,19,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,79,1,20,0)
AuthorizationTime^23^S^100.008^16^^1
"KRN",1.5,79,1,20,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,79,1,20,6)
S IEN="1,"_DIEN
"KRN",1.5,79,1,21,0)
VerifiedBy^10^E^100^^^^VPR PROVIDER
"KRN",1.5,79,1,21,4)

"KRN",1.5,79,1,21,5)

"KRN",1.5,79,1,21,6)
S VALUE=$P($G(@VPRPS@("RXN",0)),U,5)
"KRN",1.5,79,1,22,0)
TextInstruction^19^S^100
"KRN",1.5,79,1,22,6)
S VALUE=$$WP^VPRSDA(DIEN,"PI")
"KRN",1.5,79,1,23,0)
DrugProduct^34^E^100^^^^VPR DRUG PRODUCT
"KRN",1.5,79,1,23,6)
S VALUE=$$VALUE^ORX8(DIEN,"DRUG",1) S:'VALUE DDEOUT=1
"KRN",1.5,79,1,24,0)
DosageForm^44^E^100^^^^VPR CODE TABLE
"KRN",1.5,79,1,24,6)
S VALUE=$$DOSEFORM^VPRSDAP(DIEN)
"KRN",1.5,79,1,25,0)
DosageSteps^51^L^^^^^VPR DOSAGE STEP
"KRN",1.5,79,1,25,1)
4^DosageStep
"KRN",1.5,79,1,25,6)
D DOSES^VPRSDAP(DIEN)
"KRN",1.5,79,1,27,0)
Route^45^E^51.2^^^^VPR MED ROUTE
"KRN",1.5,79,1,27,6)
S VALUE=$$VALUE^ORX8(DIEN,"ROUTE")
"KRN",1.5,79,1,29,0)
OrderQuantity^7^S^100
"KRN",1.5,79,1,29,6)
S VALUE=$$VALUE^ORX8(DIEN,"QTY")
"KRN",1.5,79,1,30,0)
NumberOfRefills^43^S^100
"KRN",1.5,79,1,30,6)
S:$G(PSTYPE)="O" VALUE=$$VALUE^ORX8(DIEN,"REFILLS")
"KRN",1.5,79,1,31,0)
PrescriptionNumber^48^S^100^
"KRN",1.5,79,1,31,4)

"KRN",1.5,79,1,31,6)
S:$G(PSTYPE)="O" VALUE=$P($G(@VPRPS@("RXN",0)),U)
"KRN",1.5,79,1,32,0)
RefillNumber^49^S^100^
"KRN",1.5,79,1,32,4)

"KRN",1.5,79,1,32,6)
S:$G(PSTYPE)="O" VALUE=$O(@VPRPS@("REF",""),-1) ;last#
"KRN",1.5,79,1,33,0)
ComponentMeds^53^L^^^^^VPR IV PRODUCT
"KRN",1.5,79,1,33,1)
4^DrugProduct
"KRN",1.5,79,1,33,6)
I $G(PSTYPE)="V" D IVMEDS^VPRSDAP(ORIFN)
"KRN",1.5,79,1,34,0)
RateAmount^37^S^100
"KRN",1.5,79,1,34,6)
I $G(PSTYPE)="V" S VALUE=$$IVRATE^VPRSDAP(ORIFN)
"KRN",1.5,79,1,35,0)
RateUnits^38^E^100^^^^VPR CODE ONLY
"KRN",1.5,79,1,35,6)
S:$G(PSTYPE)="V"&$G(VPRATE) VALUE="ml"
"KRN",1.5,79,1,36,0)
RateTimeUnit^39^F
"KRN",1.5,79,1,36,2)

"KRN",1.5,79,1,36,6)
S:$G(PSTYPE)="V"&$G(VPRATE) VALUE="per hour"
"KRN",1.5,79,1,37,0)
Frequency^13^E^100^^^^VPR CODE ONLY
"KRN",1.5,79,1,37,6)
S:$G(PSTYPE)="V" VALUE=$P($G(@VPRPS@("SCH",1,0)),U)
"KRN",1.5,79,1,38,0)
Duration^14^E^100^^^^VPR CODE ONLY
"KRN",1.5,79,1,38,6)
S:$G(PSTYPE)="V" VALUE=$$VALUE^ORX8(ORIFN,"DAYS")
"KRN",1.5,79,1,39,0)
StrengthVolume^35^S^100
"KRN",1.5,79,1,39,6)
I $G(PSTYPE)="V" S VALUE=$$VALUE^ORX8(DIEN,"VOLUME"),VPRUNTS=$S(VALUE:"ML",1:"")
"KRN",1.5,79,1,40,0)
StrengthVolumeUnits^36^F^100
"KRN",1.5,79,1,40,6)
I $G(PSTYPE)="V" S VALUE=$G(VPRUNTS) K VPRUNTS
"KRN",1.5,79,1,41,0)
Extension^59^E^100^^^^VPR MED EXTENSION
"KRN",1.5,79,1,41,6)
S VALUE=DIEN
"KRN",1.5,79,1,42,0)
PharmacyStatus^47^F
"KRN",1.5,79,1,42,6)
S VALUE=$P($G(@VPRPS@(0)),U,6)
"KRN",1.5,79,1,43,0)
Comments^21^S^100
"KRN",1.5,79,1,43,6)
S VALUE=$$WP^VPRSDA(DIEN,"COMMENT")
"KRN",1.5,79,1,44,0)
ExternalId^59^I
"KRN",1.5,79,1,"B","AuthorizationTime",20)

"KRN",1.5,79,1,"B","Comments",43)

"KRN",1.5,79,1,"B","ComponentMeds",33)

"KRN",1.5,79,1,"B","DosageForm",24)

"KRN",1.5,79,1,"B","DosageSteps",25)

"KRN",1.5,79,1,"B","DrugProduct",23)

"KRN",1.5,79,1,"B","Duration",38)

"KRN",1.5,79,1,"B","EnteredAt",1)

"KRN",1.5,79,1,"B","EnteredBy",2)

"KRN",1.5,79,1,"B","EnteredOn",3)

"KRN",1.5,79,1,"B","EnteringOrganization",16)

"KRN",1.5,79,1,"B","Extension",41)

"KRN",1.5,79,1,"B","ExternalId",44)

"KRN",1.5,79,1,"B","FillerId",4)

"KRN",1.5,79,1,"B","Frequency",37)

"KRN",1.5,79,1,"B","FromTime",17)

"KRN",1.5,79,1,"B","NumberOfRefills",30)

"KRN",1.5,79,1,"B","OrderCategory",5)

"KRN",1.5,79,1,"B","OrderItem",6)

"KRN",1.5,79,1,"B","OrderQuantity",29)

"KRN",1.5,79,1,"B","OrderedBy",7)

"KRN",1.5,79,1,"B","PharmacyStatus",42)

"KRN",1.5,79,1,"B","PlacerId",15)

"KRN",1.5,79,1,"B","PrescriptionNumber",31)

"KRN",1.5,79,1,"B","Priority",9)

"KRN",1.5,79,1,"B","RateAmount",34)

"KRN",1.5,79,1,"B","RateTimeUnit",36)

"KRN",1.5,79,1,"B","RateUnits",35)

"KRN",1.5,79,1,"B","RefillNumber",32)

"KRN",1.5,79,1,"B","Route",27)

"KRN",1.5,79,1,"B","Status",13)

"KRN",1.5,79,1,"B","StrengthVolume",39)

"KRN",1.5,79,1,"B","StrengthVolumeUnits",40)

"KRN",1.5,79,1,"B","TextInstruction",22)

"KRN",1.5,79,1,"B","ToTime",18)

"KRN",1.5,79,1,"B","UpdatedOn",19)

"KRN",1.5,79,1,"B","VerifiedBy",21)

"KRN",1.5,79,1,"SEQ",1,15)

"KRN",1.5,79,1,"SEQ",3,4)

"KRN",1.5,79,1,"SEQ",5,6)

"KRN",1.5,79,1,"SEQ",6,5)

"KRN",1.5,79,1,"SEQ",7,29)

"KRN",1.5,79,1,"SEQ",8,7)

"KRN",1.5,79,1,"SEQ",9,16)

"KRN",1.5,79,1,"SEQ",10,21)

"KRN",1.5,79,1,"SEQ",13,37)

"KRN",1.5,79,1,"SEQ",14,38)

"KRN",1.5,79,1,"SEQ",15,13)

"KRN",1.5,79,1,"SEQ",16,9)

"KRN",1.5,79,1,"SEQ",19,22)

"KRN",1.5,79,1,"SEQ",21,43)

"KRN",1.5,79,1,"SEQ",23,20)

"KRN",1.5,79,1,"SEQ",29,2)

"KRN",1.5,79,1,"SEQ",30,1)

"KRN",1.5,79,1,"SEQ",31,3)

"KRN",1.5,79,1,"SEQ",32,17)

"KRN",1.5,79,1,"SEQ",33,18)

"KRN",1.5,79,1,"SEQ",34,23)

"KRN",1.5,79,1,"SEQ",35,39)

"KRN",1.5,79,1,"SEQ",36,40)

"KRN",1.5,79,1,"SEQ",37,34)

"KRN",1.5,79,1,"SEQ",38,35)

"KRN",1.5,79,1,"SEQ",39,36)

"KRN",1.5,79,1,"SEQ",43,30)

"KRN",1.5,79,1,"SEQ",44,24)

"KRN",1.5,79,1,"SEQ",45,27)

"KRN",1.5,79,1,"SEQ",47,42)

"KRN",1.5,79,1,"SEQ",48,31)

"KRN",1.5,79,1,"SEQ",49,32)

"KRN",1.5,79,1,"SEQ",51,25)

"KRN",1.5,79,1,"SEQ",53,33)

"KRN",1.5,79,1,"SEQ",58,19)

"KRN",1.5,79,1,"SEQ",59,41)

"KRN",1.5,79,1,"SEQ",59,44)

"KRN",1.5,79,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,79,3)
K:$D(VPRPS) @VPRPS K ORIFN,PSTYPE,VPRATE,VPRPS,^TMP("VPRX",$J),VASITE,PSOI
"KRN",1.5,79,4)
D PS1^VPRSDAP(DIEN)
"KRN",1.5,79,5)
ORDERS^VPRSDAQ("RX")
"KRN",1.5,79,19,0)
^^1^1^3181227^
"KRN",1.5,79,19,1,0)
This entity populates the Medication container in HealthShare.
"KRN",1.5,107,-1)
0^11
"KRN",1.5,107,0)
VPR LRAP REPORT^63.08^^^^S
"KRN",1.5,107,.1)
Document
"KRN",1.5,107,1,0)
^1.51^16^15
"KRN",1.5,107,1,1,0)
FromTime^1^S^63.08^.01^^1
"KRN",1.5,107,1,1,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,107,1,1,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,107,1,2,0)
ToTime^2^S^63.08^.03^^1
"KRN",1.5,107,1,2,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,107,1,2,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,107,1,3,0)
DocumentTime^6^S^63.08^.01^^1
"KRN",1.5,107,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,107,1,3,6)
S VALUE=$P($G(LR0),U)
"KRN",1.5,107,1,4,0)
NoteText^7^W^
"KRN",1.5,107,1,4,6)
D LRPT^VPRSDA(VPRSUB,+DIEN)
"KRN",1.5,107,1,5,0)
DocumentType^8^E^^^^^VPR CODE TABLE
"KRN",1.5,107,1,5,6)
S VALUE="LR^LABORATORY REPORT"
"KRN",1.5,107,1,6,0)
Clinician^9^E^63.08^.02^^1^VPR PROVIDER
"KRN",1.5,107,1,6,6)
S VALUE=$P($G(LR0),U,2)
"KRN",1.5,107,1,7,0)
AuthorizationTime^11^S^63.08^.11^^1
"KRN",1.5,107,1,7,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,107,1,7,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,107,1,8,0)
DocumentName^12^F^
"KRN",1.5,107,1,8,6)
S VALUE="LR "_$$NAME^VPRDLRA($G(VPRSUB))_" REPORT"
"KRN",1.5,107,1,9,0)
FileType^13^F^
"KRN",1.5,107,1,9,2)
TXT
"KRN",1.5,107,1,10,0)
DocumentNumber^16^I
"KRN",1.5,107,1,10,4)
S VALUE=+DIEN_";"_$G(VPRSUB)
"KRN",1.5,107,1,11,0)
DocumentCompletionStatus^19^E^63.08^.11^^1^VPR CODE TABLE
"KRN",1.5,107,1,11,4)
S VALUE=$S(VALUE:"C^COMPLETED",1:"R^RELEASED") ;final, if date exists
"KRN",1.5,107,1,11,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,107,1,13,0)
EnteredBy^22^E^63.08^.02^^1^VPR USER
"KRN",1.5,107,1,13,6)
S VALUE=$P($G(LR0),U,2)
"KRN",1.5,107,1,14,0)
EnteredAt^23^E^^^^^VPR FACILITY
"KRN",1.5,107,1,14,6)
S VALUE=$G(VASITE)
"KRN",1.5,107,1,15,0)
EnteredOn^24^S^63.08^.1^^1
"KRN",1.5,107,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,107,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,107,1,16,0)
Extension^5^E^^^^^VPR LRAP EXTENSION
"KRN",1.5,107,1,16,6)
S VALUE=DIEN
"KRN",1.5,107,1,"B","AuthorizationTime",7)

"KRN",1.5,107,1,"B","Clinician",6)

"KRN",1.5,107,1,"B","DocumentCompletionStatus",11)

"KRN",1.5,107,1,"B","DocumentName",8)

"KRN",1.5,107,1,"B","DocumentNumber",10)

"KRN",1.5,107,1,"B","DocumentTime",3)

"KRN",1.5,107,1,"B","DocumentType",5)

"KRN",1.5,107,1,"B","EnteredAt",14)

"KRN",1.5,107,1,"B","EnteredBy",13)

"KRN",1.5,107,1,"B","EnteredOn",15)

"KRN",1.5,107,1,"B","Extension",16)

"KRN",1.5,107,1,"B","FileType",9)

"KRN",1.5,107,1,"B","FromTime",1)

"KRN",1.5,107,1,"B","NoteText",4)

"KRN",1.5,107,1,"B","ToTime",2)

"KRN",1.5,107,1,"SEQ",1,1)

"KRN",1.5,107,1,"SEQ",2,2)

"KRN",1.5,107,1,"SEQ",5,16)

"KRN",1.5,107,1,"SEQ",6,3)

"KRN",1.5,107,1,"SEQ",7,4)

"KRN",1.5,107,1,"SEQ",8,5)

"KRN",1.5,107,1,"SEQ",9,6)

"KRN",1.5,107,1,"SEQ",11,7)

"KRN",1.5,107,1,"SEQ",12,8)

"KRN",1.5,107,1,"SEQ",13,9)

"KRN",1.5,107,1,"SEQ",16,10)

"KRN",1.5,107,1,"SEQ",19,11)

"KRN",1.5,107,1,"SEQ",22,13)

"KRN",1.5,107,1,"SEQ",23,14)

"KRN",1.5,107,1,"SEQ",24,15)

"KRN",1.5,107,2)
S LRDFN=+$G(^DPT(DFN,"LR")) S:'DFN&ID LRDFN=+$P(ID,",",2),DFN=$$DFN^LRPXAPIU(LRDFN) S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,107,3)
K LRDFN,LR0,VPRSUB,VASITE
"KRN",1.5,107,4)
D LRAP1^VPRSDA(.DIEN)
"KRN",1.5,107,5)
LRAP^VPRSDAQ
"KRN",1.5,107,19,0)
^^6^6^3190311^^^
"KRN",1.5,107,19,1,0)
This entity populates the Document container in HealthShare with 
"KRN",1.5,107,19,2,0)
Pathology reports that are not stored in TIU. Because these can come from 
"KRN",1.5,107,19,3,0)
the Surgical Pathology, Cytopathology, or Electron Microscropy sub-files 
"KRN",1.5,107,19,4,0)
in the Lab Data file #63, the GET ID PROCESSING code will set the Default 
"KRN",1.5,107,19,5,0)
File# for the appropriate sub-file based on the value of ID; it also sets 
"KRN",1.5,107,19,6,0)
the LR0 local variable to the sub-file zero node.
"KRN",1.5,113,-1)
0^8
"KRN",1.5,113,0)
VPR RAD REPORT^74^^^^S
"KRN",1.5,113,.1)
Document
"KRN",1.5,113,1,0)
^1.51^17^17
"KRN",1.5,113,1,1,0)
FromTime^1^S^74^3^^1
"KRN",1.5,113,1,1,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,2,0)
ToTime^2^S^74^7^^1
"KRN",1.5,113,1,2,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,3,0)
EncounterNumber^3^S^74
"KRN",1.5,113,1,3,4)
S:'$D(^AUPNVSIT(VALUE,0)) VALUE=""
"KRN",1.5,113,1,3,6)
S VALUE=$$VNUM^VPRSDAR(DFN,VPRXID)
"KRN",1.5,113,1,4,0)
DocumentTime^6^S^74^3^^1
"KRN",1.5,113,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,5,0)
NoteText^7^W^74
"KRN",1.5,113,1,5,6)
M WP=@VPRAE3
"KRN",1.5,113,1,6,0)
DocumentType^8^E^74^^^^VPR CODE TABLE
"KRN",1.5,113,1,6,6)
S VALUE="RA^RADIOLOGY REPORT"
"KRN",1.5,113,1,7,0)
Clinician^9^E^70.03^15^^1^VPR PROVIDER
"KRN",1.5,113,1,7,6)
S VALUE=$P($G(@VPRAE2@("P")),U) S:'VALUE VALUE=$P($G(@VPRAE2@("P")),U,2) I 'VALUE S DDEOUT=1
"KRN",1.5,113,1,8,0)
TranscriptionTime^10^S^74^8^^1
"KRN",1.5,113,1,8,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,8,6)

"KRN",1.5,113,1,9,0)
AuthorizationTime^11^S^74^7^^1
"KRN",1.5,113,1,9,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,10,0)
DocumentName^12^S^74
"KRN",1.5,113,1,10,6)
S VALUE=$G(RAPROC) S:VALUE="" VALUE="RADIOLOGY REPORT"
"KRN",1.5,113,1,11,0)
DocumentNumber^16^I
"KRN",1.5,113,1,11,4)
S VALUE=VALUE_";RA"
"KRN",1.5,113,1,11,5)
S:$P(VALUE,";",2)="RA" VALUE=+VALUE
"KRN",1.5,113,1,12,0)
DocumentCompletionStatus^19^E^74^5^^1^VPR CODE TABLE
"KRN",1.5,113,1,12,4)
I $D(VPRAE2),$D(@VPRAE2) S VALUE=VALUE_U_$P(@VPRAE2,U)
"KRN",1.5,113,1,13,0)
EnteredBy^22^E^74^11^^1^VPR USER
"KRN",1.5,113,1,14,0)
EnteredAt^23^E^74^^^^VPR FACILITY
"KRN",1.5,113,1,14,6)
S VALUE=$G(VASITE)
"KRN",1.5,113,1,15,0)
EnteredOn^24^S^74^6^^1
"KRN",1.5,113,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,113,1,15,6)
S VALUE=$P($G(@VPRAE2@("P")),U,3)
"KRN",1.5,113,1,16,0)
FileType^13^F
"KRN",1.5,113,1,16,2)
TXT
"KRN",1.5,113,1,17,0)
Extension^5^E^74^^^^VPR RAD RPT EXTENSION
"KRN",1.5,113,1,17,6)
S VALUE=DIEN
"KRN",1.5,113,1,"B","AuthorizationTime",9)

"KRN",1.5,113,1,"B","Clinician",7)

"KRN",1.5,113,1,"B","DocumentCompletionStatus",12)

"KRN",1.5,113,1,"B","DocumentName",10)

"KRN",1.5,113,1,"B","DocumentNumber",11)

"KRN",1.5,113,1,"B","DocumentTime",4)

"KRN",1.5,113,1,"B","DocumentType",6)

"KRN",1.5,113,1,"B","EncounterNumber",3)

"KRN",1.5,113,1,"B","EnteredAt",14)

"KRN",1.5,113,1,"B","EnteredBy",13)

"KRN",1.5,113,1,"B","EnteredOn",15)

"KRN",1.5,113,1,"B","Extension",17)

"KRN",1.5,113,1,"B","FileType",16)

"KRN",1.5,113,1,"B","FromTime",1)

"KRN",1.5,113,1,"B","NoteText",5)

"KRN",1.5,113,1,"B","ToTime",2)

"KRN",1.5,113,1,"B","TranscriptionTime",8)

"KRN",1.5,113,1,"SEQ",1,1)

"KRN",1.5,113,1,"SEQ",2,2)

"KRN",1.5,113,1,"SEQ",3,3)

"KRN",1.5,113,1,"SEQ",5,17)

"KRN",1.5,113,1,"SEQ",6,4)

"KRN",1.5,113,1,"SEQ",7,5)

"KRN",1.5,113,1,"SEQ",8,6)

"KRN",1.5,113,1,"SEQ",9,7)

"KRN",1.5,113,1,"SEQ",10,8)

"KRN",1.5,113,1,"SEQ",11,9)

"KRN",1.5,113,1,"SEQ",12,10)

"KRN",1.5,113,1,"SEQ",13,16)

"KRN",1.5,113,1,"SEQ",16,11)

"KRN",1.5,113,1,"SEQ",19,12)

"KRN",1.5,113,1,"SEQ",22,13)

"KRN",1.5,113,1,"SEQ",23,14)

"KRN",1.5,113,1,"SEQ",24,15)

"KRN",1.5,113,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,113,3)
K ^TMP($J,"RAE2"),^TMP($J,"RAE3"),VPRXID,VPRAE2,VPRAE3,RAPROC,VASITE
"KRN",1.5,113,4)
D RPT1^VPRSDAR
"KRN",1.5,113,5)
RPTS^VPRSDAR
"KRN",1.5,113,19,0)
^^1^1^3181227^
"KRN",1.5,113,19,1,0)
This entity populates the Document container in HealthShare.
"KRN",1.5,114,-1)
0^13
"KRN",1.5,114,0)
VPR LRMI REPORT^63.05^^^^S
"KRN",1.5,114,.1)
Document
"KRN",1.5,114,1,0)
^1.51^16^14
"KRN",1.5,114,1,1,0)
FromTime^1^S^63.05^.01^^1
"KRN",1.5,114,1,1,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,114,1,1,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,114,1,2,0)
ToTime^2^S^63.05^.03^^1
"KRN",1.5,114,1,2,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,114,1,2,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,114,1,3,0)
DocumentTime^6^S^63.05^.01^^1
"KRN",1.5,114,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,114,1,3,6)
S VALUE=$P($G(LR0),U)
"KRN",1.5,114,1,4,0)
NoteText^7^W^63.05
"KRN",1.5,114,1,4,6)
D LRPT^VPRSDA("MI",+DIEN)
"KRN",1.5,114,1,5,0)
DocumentType^8^E^63.05^^^^VPR CODE TABLE
"KRN",1.5,114,1,5,6)
S VALUE="LR^LABORATORY REPORT"
"KRN",1.5,114,1,6,0)
Clinician^9^E^63.05^.04^^1^VPR PROVIDER
"KRN",1.5,114,1,6,6)
S VALUE=$P($G(LR0),U,4)
"KRN",1.5,114,1,7,0)
AuthorizationTime^11^S^63.05^.03^^1
"KRN",1.5,114,1,7,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,114,1,7,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,114,1,8,0)
DocumentName^12^F^
"KRN",1.5,114,1,8,6)
S VALUE="LR MICROBIOLOGY REPORT"
"KRN",1.5,114,1,9,0)
FileType^13^F^
"KRN",1.5,114,1,9,2)
TXT
"KRN",1.5,114,1,10,0)
DocumentNumber^16^I
"KRN",1.5,114,1,10,4)
S VALUE=+DIEN_";MI"
"KRN",1.5,114,1,11,0)
DocumentCompletionStatus^19^E^63.05^.03^^1^VPR CODE TABLE
"KRN",1.5,114,1,11,4)
S VALUE=$S(VALUE:"C^COMPLETED",1:"") ;final, if date exists
"KRN",1.5,114,1,11,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,114,1,14,0)
EnteredAt^23^E^63.05^.112^^1^VPR FACILITY
"KRN",1.5,114,1,14,6)
S VALUE=$P($G(LR0),U,14) S:'VALUE VALUE=$G(VASITE)
"KRN",1.5,114,1,15,0)
EnteredOn^24^S^63.05^.1^^1
"KRN",1.5,114,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,114,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,114,1,16,0)
Extension^5^E^63.05^^^^VPR LRMI EXTENSION
"KRN",1.5,114,1,16,6)
S VALUE=DIEN
"KRN",1.5,114,1,"B","AuthorizationTime",7)

"KRN",1.5,114,1,"B","Clinician",6)

"KRN",1.5,114,1,"B","DocumentCompletionStatus",11)

"KRN",1.5,114,1,"B","DocumentName",8)

"KRN",1.5,114,1,"B","DocumentNumber",10)

"KRN",1.5,114,1,"B","DocumentTime",3)

"KRN",1.5,114,1,"B","DocumentType",5)

"KRN",1.5,114,1,"B","EnteredAt",14)

"KRN",1.5,114,1,"B","EnteredOn",15)

"KRN",1.5,114,1,"B","Extension",16)

"KRN",1.5,114,1,"B","FileType",9)

"KRN",1.5,114,1,"B","FromTime",1)

"KRN",1.5,114,1,"B","NoteText",4)

"KRN",1.5,114,1,"B","ToTime",2)

"KRN",1.5,114,1,"SEQ",1,1)

"KRN",1.5,114,1,"SEQ",2,2)

"KRN",1.5,114,1,"SEQ",5,16)

"KRN",1.5,114,1,"SEQ",6,3)

"KRN",1.5,114,1,"SEQ",7,4)

"KRN",1.5,114,1,"SEQ",8,5)

"KRN",1.5,114,1,"SEQ",9,6)

"KRN",1.5,114,1,"SEQ",11,7)

"KRN",1.5,114,1,"SEQ",12,8)

"KRN",1.5,114,1,"SEQ",13,9)

"KRN",1.5,114,1,"SEQ",16,10)

"KRN",1.5,114,1,"SEQ",19,11)

"KRN",1.5,114,1,"SEQ",23,14)

"KRN",1.5,114,1,"SEQ",24,15)

"KRN",1.5,114,2)
S LRDFN=+$G(^DPT(DFN,"LR")) S:'DFN&ID LRDFN=+$P(ID,",",2),DFN=$$DFN^LRPXAPIU(LRDFN) S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,114,3)
K LRDFN,LR0,VPRSUB,VASITE
"KRN",1.5,114,4)
D LRAP1^VPRSDA(.DIEN)
"KRN",1.5,114,5)
LRMI^VPRSDAQ
"KRN",1.5,114,19,0)
^^1^1^3190226^^
"KRN",1.5,114,19,1,0)
This entity populates the Document container in HealthShare.
"KRN",1.5,119,-1)
0^15
"KRN",1.5,119,0)
VPR PATIENT EXTENSION^2^^^^S
"KRN",1.5,119,.1)
PatientExtension
"KRN",1.5,119,1,0)
^1.51^20^20
"KRN",1.5,119,1,1,0)
Bid^1^F
"KRN",1.5,119,1,1,6)
S VALUE=$E($G(VADM(1)))_$G(VA("BID"))
"KRN",1.5,119,1,2,0)
Dob^2^S^2^.03^^1
"KRN",1.5,119,1,2,6)
S VALUE=$P($P($G(VADM(3)),U),".")
"KRN",1.5,119,1,3,0)
IsExposureAO^3^S^2^.32102^^1
"KRN",1.5,119,1,3,4)
S VALUE=$S(VALUE:"true",VALUE="Y":"true",1:"false")
"KRN",1.5,119,1,3,6)
S VALUE=+$G(VASV(2))
"KRN",1.5,119,1,4,0)
IsExposureIR^4^S^2^.32103^^1
"KRN",1.5,119,1,4,4)
S VALUE=$S(VALUE:"true","Yy"[$E(VALUE):"true",1:"false")
"KRN",1.5,119,1,4,6)
S VALUE=+$G(VASV(3))
"KRN",1.5,119,1,5,0)
IsExposurePG^5^F
"KRN",1.5,119,1,5,6)
S VALUE=$S(VASV(11)!VASV(12)!VASV(13):"true",1:"false") ;OIF/OEF
"KRN",1.5,119,1,6,0)
IsExposureCV^6^S^2^.5291^^1
"KRN",1.5,119,1,6,4)
S VALUE=$S(VALUE:"true",VALUE="Y":"true",1:"false")
"KRN",1.5,119,1,6,6)
S VALUE=+$G(VASV(5))
"KRN",1.5,119,1,7,0)
IsExposureHNC^7^F
"KRN",1.5,119,1,7,6)
N X,HNC S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),VALUE=$S(X=4:"true",X=5:"true",X=1:"false",X=6:"false",1:"")
"KRN",1.5,119,1,8,0)
VeteranLrdfn^9^S^2^63^^1
"KRN",1.5,119,1,8,6)
S VALUE=$G(^DPT(DFN,"LR"))
"KRN",1.5,119,1,9,0)
IsVeteran^10^S^2^1901^^1
"KRN",1.5,119,1,9,4)
S VALUE=$S(VALUE:"true","Yy"[$E(VALUE):"true",1:"false")
"KRN",1.5,119,1,9,6)
S VALUE=+$G(VAEL(4))
"KRN",1.5,119,1,10,0)
IsServiceConnected^11^S^2^.301^^1
"KRN",1.5,119,1,10,4)
S VALUE=$S(VALUE:"true","Yy"[$E(VALUE):"true",1:"false")
"KRN",1.5,119,1,10,6)
S VALUE=+$G(VAEL(3))
"KRN",1.5,119,1,11,0)
ScPercent^12^S^2^.302
"KRN",1.5,119,1,11,6)
S VALUE=$P(VAEL(3),U,2)
"KRN",1.5,119,1,12,0)
ServicePeriod^13^S^2^.323
"KRN",1.5,119,1,12,6)
S:$G(VAEL(2)) VALUE=$P(VAEL(2),U,2)
"KRN",1.5,119,1,13,0)
MeansTestStatus^14^S^2^.14
"KRN",1.5,119,1,13,6)
S:$L($G(VAEL(9))) VALUE=$P(VAEL(9),U,2)
"KRN",1.5,119,1,14,0)
EligibilityStatus^15^S^2^.3611
"KRN",1.5,119,1,14,6)
S:$L($G(VAEL(8))) VALUE=$P(VAEL(8),U,2)
"KRN",1.5,119,1,15,0)
Eligibilities^16^L^^^^^VPR PATIENT ELIGIBILITY
"KRN",1.5,119,1,15,1)
4^Eligibility
"KRN",1.5,119,1,15,6)
N X M DLIST=VAEL(1) S X=$G(VAEL(1)) S:X DLIST(.5)=X_"^1"
"KRN",1.5,119,1,16,0)
Disabilities^17^L^2.04^^^^VPR PATIENT DISABILITY
"KRN",1.5,119,1,16,1)
2^Disability
"KRN",1.5,119,1,17,0)
IsExposureMST^8^F^
"KRN",1.5,119,1,17,6)
N X S X=$P($$GETSTAT^DGMSTAPI(DFN),U,2),VALUE=$S(X="Y":"true",X="N":"false",1:"")
"KRN",1.5,119,1,18,0)
CareTeamName^18^F
"KRN",1.5,119,1,18,6)
S VPRTEAM=$$INSTPCTM^SCAPMC(DFN) S:VPRTEAM VALUE=$P(VPRTEAM,U,2)
"KRN",1.5,119,1,19,0)
CareTeamMembers^19^L^^^^^VPR TEAM MEMBER
"KRN",1.5,119,1,19,1)
4^CareProvider
"KRN",1.5,119,1,19,6)
D PCMM^VPRSDA
"KRN",1.5,119,1,20,0)
LastTreated^41^E^2^^^^VPR SOURCE FACILITY
"KRN",1.5,119,1,20,6)
S VALUE=DIEN
"KRN",1.5,119,1,"B","Bid",1)

"KRN",1.5,119,1,"B","CareTeamMembers",19)

"KRN",1.5,119,1,"B","CareTeamName",18)

"KRN",1.5,119,1,"B","Disabilities",16)

"KRN",1.5,119,1,"B","Dob",2)

"KRN",1.5,119,1,"B","Eligibilities",15)

"KRN",1.5,119,1,"B","EligibilityStatus",14)

"KRN",1.5,119,1,"B","IsExposureAO",3)

"KRN",1.5,119,1,"B","IsExposureCV",6)

"KRN",1.5,119,1,"B","IsExposureHNC",7)

"KRN",1.5,119,1,"B","IsExposureIR",4)

"KRN",1.5,119,1,"B","IsExposureMST",17)

"KRN",1.5,119,1,"B","IsExposurePG",5)

"KRN",1.5,119,1,"B","IsServiceConnected",10)

"KRN",1.5,119,1,"B","IsVeteran",9)

"KRN",1.5,119,1,"B","LastTreated",20)

"KRN",1.5,119,1,"B","MeansTestStatus",13)

"KRN",1.5,119,1,"B","ScPercent",11)

"KRN",1.5,119,1,"B","ServicePeriod",12)

"KRN",1.5,119,1,"B","VeteranLrdfn",8)

"KRN",1.5,119,1,"SEQ",1,1)

"KRN",1.5,119,1,"SEQ",2,2)

"KRN",1.5,119,1,"SEQ",3,3)

"KRN",1.5,119,1,"SEQ",4,4)

"KRN",1.5,119,1,"SEQ",5,5)

"KRN",1.5,119,1,"SEQ",6,6)

"KRN",1.5,119,1,"SEQ",7,7)

"KRN",1.5,119,1,"SEQ",8,17)

"KRN",1.5,119,1,"SEQ",9,8)

"KRN",1.5,119,1,"SEQ",10,9)

"KRN",1.5,119,1,"SEQ",11,10)

"KRN",1.5,119,1,"SEQ",12,11)

"KRN",1.5,119,1,"SEQ",13,12)

"KRN",1.5,119,1,"SEQ",14,13)

"KRN",1.5,119,1,"SEQ",15,14)

"KRN",1.5,119,1,"SEQ",16,15)

"KRN",1.5,119,1,"SEQ",17,16)

"KRN",1.5,119,1,"SEQ",18,18)

"KRN",1.5,119,1,"SEQ",19,19)

"KRN",1.5,119,1,"SEQ",41,20)

"KRN",1.5,119,2)
D 7^VADPT
"KRN",1.5,119,3)
K VAEL,VASV,VAERR,VPRTEAM,^TMP("SC TMP LIST",$J)
"KRN",1.5,119,19,0)
^^2^2^3180611^^
"KRN",1.5,119,19,1,0)
This entity extends VPR PATIENT, using supported calls to VADPT to
"KRN",1.5,119,19,2,0)
retrieve the data.
"KRN",1.5,123,-1)
0^18
"KRN",1.5,123,0)
VPR LOCATION EXTENSION^44^^^^S
"KRN",1.5,123,.1)
HealthCareFacilityExtension
"KRN",1.5,123,1,0)
^1.51^4^4
"KRN",1.5,123,1,1,0)
StopCode^1^E^44^8^^1^VPR AMIS
"KRN",1.5,123,1,1,4)

"KRN",1.5,123,1,2,0)
CreditStopCode^2^E^44^2503^^1^VPR AMIS
"KRN",1.5,123,1,2,4)

"KRN",1.5,123,1,3,0)
Service^3^S^44^9
"KRN",1.5,123,1,4,0)
Specialty^4^E^44^9.5^^1^VPR SPECIALTY
"KRN",1.5,123,1,"B","CreditStopCode",2)

"KRN",1.5,123,1,"B","Service",3)

"KRN",1.5,123,1,"B","Specialty",4)

"KRN",1.5,123,1,"B","StopCode",1)

"KRN",1.5,123,1,"SEQ",1,1)

"KRN",1.5,123,1,"SEQ",2,2)

"KRN",1.5,123,1,"SEQ",3,3)

"KRN",1.5,123,1,"SEQ",4,4)

"KRN",1.5,123,19,0)
^^1^1^3180607^
"KRN",1.5,123,19,1,0)
This entity extends VPR LOCATION, to expose additional data elements.
"KRN",1.5,142,-1)
0^7
"KRN",1.5,142,0)
VPR RAD RESULT EXTENSION^74^^^^S
"KRN",1.5,142,.1)
ResultExtension
"KRN",1.5,142,1,0)
^1.51^3^3
"KRN",1.5,142,1,1,0)
IsImagePresent^1^S^74^2005
"KRN",1.5,142,1,1,6)
S VALUE=$S($O(^RARPT(DIEN,2005,0)):"true",1:"false")
"KRN",1.5,142,1,2,0)
VAResultStatus^2^E^74^5^^^VPR CODE ONLY
"KRN",1.5,142,1,2,6)
S VALUE=$P(@VPRAE2,U)
"KRN",1.5,142,1,3,0)
DocumentNumbers^3^L
"KRN",1.5,142,1,3,1)
4^DocumentNumbersItem
"KRN",1.5,142,1,3,6)
M DLIST=RARPT
"KRN",1.5,142,1,"B","DocumentNumbers",3)

"KRN",1.5,142,1,"B","IsImagePresent",1)

"KRN",1.5,142,1,"B","VAResultStatus",2)

"KRN",1.5,142,1,"SEQ",1,1)

"KRN",1.5,142,1,"SEQ",2,2)

"KRN",1.5,142,1,"SEQ",3,3)

"KRN",1.5,142,19,0)
^^1^1^3180612^
"KRN",1.5,142,19,1,0)
This entity extends VPR RAD RESULT; it expects the Radiology Report #74 ien.
"KRN",1.5,153,-1)
0^4
"KRN",1.5,153,0)
VPR ALLERGY ASSESSMENT^120.86^^^^S
"KRN",1.5,153,.1)
Allergy
"KRN",1.5,153,1,0)
^1.51^7^7
"KRN",1.5,153,1,1,0)
Allergy^3^E^120.86^1^^1^VPR CODE TABLE
"KRN",1.5,153,1,1,4)

"KRN",1.5,153,1,1,6)
S VALUE=$S($G(GMRAL)=0:"NKA^No Known Allergies",$G(GMRAL)=1:"ALG^Assessment",1:"NONE^No Assessment")
"KRN",1.5,153,1,2,0)
EnteredBy^22^E^120.86^2^^1^VPR USER
"KRN",1.5,153,1,3,0)
EnteredOn^24^S^120.86^3^^1
"KRN",1.5,153,1,3,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,153,1,4,0)
EnteredAt^23^E^120.86^^^^VPR FACILITY
"KRN",1.5,153,1,4,6)
S VALUE=$G(VASITE) ;default #4 ien
"KRN",1.5,153,1,5,0)
Clinician^5^E^120.86^2^^1^VPR PROVIDER
"KRN",1.5,153,1,6,0)
FromTime^25^S^120.86^3^^1
"KRN",1.5,153,1,6,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,153,1,7,0)
ExternalId^27^I
"KRN",1.5,153,1,7,4)
S VALUE=VALUE_";DFN"
"KRN",1.5,153,1,"B","Allergy",1)

"KRN",1.5,153,1,"B","Clinician",5)

"KRN",1.5,153,1,"B","EnteredAt",4)

"KRN",1.5,153,1,"B","EnteredBy",2)

"KRN",1.5,153,1,"B","EnteredOn",3)

"KRN",1.5,153,1,"B","ExternalId",7)

"KRN",1.5,153,1,"B","FromTime",6)

"KRN",1.5,153,1,"SEQ",3,1)

"KRN",1.5,153,1,"SEQ",5,5)

"KRN",1.5,153,1,"SEQ",22,2)

"KRN",1.5,153,1,"SEQ",23,4)

"KRN",1.5,153,1,"SEQ",24,3)

"KRN",1.5,153,1,"SEQ",25,6)

"KRN",1.5,153,1,"SEQ",27,7)

"KRN",1.5,153,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,153,3)
K GMRAL,VASITE
"KRN",1.5,153,5)
ASSESS^VPRSDAL
"KRN",1.5,153,19,0)
^^3^3^3181227^
"KRN",1.5,153,19,1,0)
This entity works with VPR ALLERGY to populate the Allergy container, if 
"KRN",1.5,153,19,2,0)
the patient has not been assessed or found to have No Known Allergies
"KRN",1.5,153,19,3,0)
(NKA).
"KRN",1.5,158,-1)
0^9
"KRN",1.5,158,0)
VPR RAD RPT EXTENSION^74^^^^S
"KRN",1.5,158,.1)
DocumentExtension
"KRN",1.5,158,1,0)
^1.51^3^3
"KRN",1.5,158,1,1,0)
CareProviders^1^L^^^^^VPR SIGNER
"KRN",1.5,158,1,1,1)
4^CareProvider
"KRN",1.5,158,1,1,6)
N X S X=$P($G(@VPRAE2@("V")),U) S:X DLIST(1)=X_"^V" ;verifier
"KRN",1.5,158,1,2,0)
NationalTitle^4^E^^^^^VPR CODE TABLE
"KRN",1.5,158,1,2,6)
S VALUE="18726-0^RADIOLOGY STUDIES^LOINC"
"KRN",1.5,158,1,3,0)
NationalTitleSubject^8^E^^^^^VPR CODE TABLE
"KRN",1.5,158,1,3,6)
S VALUE="4693357^RADIOLOGY^VHAT"
"KRN",1.5,158,1,"B","CareProviders",1)

"KRN",1.5,158,1,"B","NationalTitle",2)

"KRN",1.5,158,1,"B","NationalTitleSubject",3)

"KRN",1.5,158,1,"SEQ",1,1)

"KRN",1.5,158,1,"SEQ",4,2)

"KRN",1.5,158,1,"SEQ",8,3)

"KRN",1.5,158,19,0)
^^2^2^3180809^^
"KRN",1.5,158,19,1,0)
This entity extends VPR RAD REPORT; it expects the VPRAE2 variable
"KRN",1.5,158,19,2,0)
and ^TMP array to be defined.
"KRN",1.5,159,-1)
0^10
"KRN",1.5,159,0)
VPR LRAP EXTENSION^63.08^^^^S
"KRN",1.5,159,.1)
DocumentExtension
"KRN",1.5,159,1,0)
^1.51^3^3
"KRN",1.5,159,1,1,0)
CareProviders^1^L^^^^^VPR SIGNER
"KRN",1.5,159,1,1,1)
4^CareProvider
"KRN",1.5,159,1,1,6)
N X S X=$P($G(LR0),U,13) S:X DLIST(1)=X_"^V" ;verifier
"KRN",1.5,159,1,2,0)
NationalTitle^4^E^^^^^VPR CODE TABLE
"KRN",1.5,159,1,2,6)
S VALUE=$S(VPRSUB="CY":"26438-2^CYTOLOGY",VPRSUB="EM":"50668-3^MICROSCOPY",1:"27898-6^PATHOLOGY")_" STUDIES^LOINC"
"KRN",1.5,159,1,3,0)
NationalTitleSubject^8^E^^^^^VPR CODE TABLE
"KRN",1.5,159,1,3,6)
S VALUE="4697104^LABORATORY^VHAT"
"KRN",1.5,159,1,"B","CareProviders",1)

"KRN",1.5,159,1,"B","NationalTitle",2)

"KRN",1.5,159,1,"B","NationalTitleSubject",3)

"KRN",1.5,159,1,"SEQ",1,1)

"KRN",1.5,159,1,"SEQ",4,2)

"KRN",1.5,159,1,"SEQ",8,3)

"KRN",1.5,159,19,0)
^^2^2^3190226^^
"KRN",1.5,159,19,1,0)
This entity extends VPR LRAP REPORT; it expects the LR0 and VPRSUB local
"KRN",1.5,159,19,2,0)
variables to be defined.
"KRN",1.5,160,-1)
0^12
"KRN",1.5,160,0)
VPR LRMI EXTENSION^63.05^^^^S
"KRN",1.5,160,.1)
DocumentExtension
"KRN",1.5,160,1,0)
^1.51^3^3
"KRN",1.5,160,1,1,0)
CareProviders^1^L^^^^^VPR SIGNER
"KRN",1.5,160,1,1,1)
4^CareProvider
"KRN",1.5,160,1,1,6)
N X S X=$P($G(LR0),U,4) S:X DLIST(1)=X_"^V" ;verifier
"KRN",1.5,160,1,2,0)
NationalTitle^4^E^63.05^^^^VPR CODE TABLE
"KRN",1.5,160,1,2,6)
S VALUE="18725-2^MICROBIOLOGY STUDIES^LOINC"
"KRN",1.5,160,1,3,0)
NationalTitleSubject^8^E^63.05^^^^VPR CODE TABLE
"KRN",1.5,160,1,3,6)
S VALUE="4697104^LABORATORY^VHAT"
"KRN",1.5,160,1,"B","CareProviders",1)

"KRN",1.5,160,1,"B","NationalTitle",2)

"KRN",1.5,160,1,"B","NationalTitleSubject",3)

"KRN",1.5,160,1,"SEQ",1,1)

"KRN",1.5,160,1,"SEQ",4,2)

"KRN",1.5,160,1,"SEQ",8,3)

"KRN",1.5,160,19,0)
^^2^2^3190226^^
"KRN",1.5,160,19,1,0)
This entity extends VPR LRMI REPORT; it expects the LR0 variable to be
"KRN",1.5,160,19,2,0)
defined.
"KRN",1.5,162,-1)
0^2
"KRN",1.5,162,0)
VPR FIM^783^^^^S
"KRN",1.5,162,.1)
Problem
"KRN",1.5,162,1,0)
^1.51^14^14
"KRN",1.5,162,1,1,0)
UpdatedOn^1^S^783^.12^^1
"KRN",1.5,162,1,1,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,162,1,2,0)
CustomPairs^3^L^^^^^VPR CUSTOM PAIR
"KRN",1.5,162,1,2,1)
4
"KRN",1.5,162,1,2,6)
D FIMS^VPRSDA ;sets VPRFIMS, DLIST array
"KRN",1.5,162,1,3,0)
ProblemDetails^5^F^
"KRN",1.5,162,1,3,6)
S VALUE=$G(VPRFIMS)
"KRN",1.5,162,1,4,0)
Problem^6^E^783^^^^VPR CODE TABLE
"KRN",1.5,162,1,4,6)
S VALUE="408907016^Functional independence measure^SNOMED CT"
"KRN",1.5,162,1,5,0)
Clinician^7^E^783^.16^1202^1^VPR PROVIDER
"KRN",1.5,162,1,5,6)
S VALUE=$G(VPRM("TIU",1202,"I"))
"KRN",1.5,162,1,6,0)
Category^10^E^783^^^^VPR CODE TABLE
"KRN",1.5,162,1,6,6)
S VALUE="248536006^Finding of functional performance and activity^SNOMED CT"
"KRN",1.5,162,1,7,0)
EnteredBy^14^E^783^.16^1302^1^VPR USER
"KRN",1.5,162,1,7,6)
S VALUE=$G(VPRM("TIU",1302,"I"))
"KRN",1.5,162,1,8,0)
EnteredAt^15^E^783^^^^VPR FACILITY
"KRN",1.5,162,1,8,6)
S VALUE=$$IEN^XUAF4($P(VPRSITE(1),U,2)) S:'VALUE VALUE=$G(VASITE)
"KRN",1.5,162,1,9,0)
EnteredOn^16^S^783^.16^1201^1
"KRN",1.5,162,1,9,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,162,1,9,6)
S VALUE=$G(VPRM("TIU",1201,"I"))
"KRN",1.5,162,1,10,0)
FromTime^17^S^783^.1^^1
"KRN",1.5,162,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,162,1,10,6)
N X S X=$P($G(VPRM(1)),U,10) S:$L(X) VALUE=$$INTDATE^VPRSDA(X)
"KRN",1.5,162,1,11,0)
ToTime^18^S^783^.11^^1
"KRN",1.5,162,1,11,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,162,1,11,6)
N X S X=$P($G(VPRM(1)),U,11) S:$L(X) VALUE=$$INTDATE^VPRSDA(X)
"KRN",1.5,162,1,12,0)
ExternalId^19^I
"KRN",1.5,162,1,12,4)
S VALUE=VALUE_";FIM"
"KRN",1.5,162,1,13,0)
Extension^4^E^783^^^^VPR FIM EXTENSION
"KRN",1.5,162,1,13,6)
S VALUE=DIEN
"KRN",1.5,162,1,14,0)
Status^9^E^783^^^^VPR CODE TABLE
"KRN",1.5,162,1,14,6)
S VALUE="55561003^Active^SNOMED CT"
"KRN",1.5,162,1,"B","Category",6)

"KRN",1.5,162,1,"B","Clinician",5)

"KRN",1.5,162,1,"B","CustomPairs",2)

"KRN",1.5,162,1,"B","EnteredAt",8)

"KRN",1.5,162,1,"B","EnteredBy",7)

"KRN",1.5,162,1,"B","EnteredOn",9)

"KRN",1.5,162,1,"B","Extension",13)

"KRN",1.5,162,1,"B","ExternalId",12)

"KRN",1.5,162,1,"B","FromTime",10)

"KRN",1.5,162,1,"B","Problem",4)

"KRN",1.5,162,1,"B","ProblemDetails",3)

"KRN",1.5,162,1,"B","Status",14)

"KRN",1.5,162,1,"B","ToTime",11)

"KRN",1.5,162,1,"B","UpdatedOn",1)

"KRN",1.5,162,1,"SEQ",1,1)

"KRN",1.5,162,1,"SEQ",3,2)

"KRN",1.5,162,1,"SEQ",4,13)

"KRN",1.5,162,1,"SEQ",5,3)

"KRN",1.5,162,1,"SEQ",6,4)

"KRN",1.5,162,1,"SEQ",7,5)

"KRN",1.5,162,1,"SEQ",9,14)

"KRN",1.5,162,1,"SEQ",10,6)

"KRN",1.5,162,1,"SEQ",14,7)

"KRN",1.5,162,1,"SEQ",15,8)

"KRN",1.5,162,1,"SEQ",16,9)

"KRN",1.5,162,1,"SEQ",17,10)

"KRN",1.5,162,1,"SEQ",18,11)

"KRN",1.5,162,1,"SEQ",19,12)

"KRN",1.5,162,2)
S VASITE=+$$SITE^VASITE S:VASITE'>0 VASITE=$$KSP^XUPARAM("INST")
"KRN",1.5,162,3)
K VPRM,VPRSITE,VPRFIMS,VASITE
"KRN",1.5,162,4)
D FIM1^VPRSDA(DIEN)
"KRN",1.5,162,5)
FIM^VPRSDAQ
"KRN",1.5,162,19,0)
^1.519^2^2^3181227^^
"KRN",1.5,162,19,1,0)
This entity populates the Problem container with Functional Independence
"KRN",1.5,162,19,2,0)
Measurement data.
"KRN",1.5,201,-1)
0^16
"KRN",1.5,201,0)
VPR SOURCE FACILITY^2^^^^S
"KRN",1.5,201,.1)
LastTreated
"KRN",1.5,201,1,0)
^1.51^2^2
"KRN",1.5,201,1,1,0)
EnteredAt^1^E^2^^^^VPR FACILITY
"KRN",1.5,201,1,1,6)
S VALUE=+$G(VASITE) ;default #4 ien
"KRN",1.5,201,1,2,0)
EnteredOn^2^S^2
"KRN",1.5,201,1,2,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,201,1,2,6)
N X S X=$O(^AUPNVSIT("AA",DFN,0)) S:X VALUE=$S(X:9999999-$P(X,"."),1:"")
"KRN",1.5,201,1,"B","EnteredAt",1)

"KRN",1.5,201,1,"B","EnteredOn",2)

"KRN",1.5,201,1,"SEQ",1,1)

"KRN",1.5,201,1,"SEQ",2,2)

"KRN",1.5,201,19,0)
^^3^3^3190212^
"KRN",1.5,201,19,1,0)
This entity is included in VPR PATIENT EXTENSION to pass the date the
"KRN",1.5,201,19,2,0)
patient was last treated at this facility to the Patient Registry in
"KRN",1.5,201,19,3,0)
the HealthConnect Edge Cache Repository.
"KRN",1.5,204,-1)
0^29
"KRN",1.5,204,0)
VPR LRSP RESULT^63.08^^^^S
"KRN",1.5,204,.1)
Result
"KRN",1.5,204,1,0)
^1.51^16^15
"KRN",1.5,204,1,1,0)
Extension^3^E^63.08^^^^VPR LR RESULT EXTENSION
"KRN",1.5,204,1,1,6)
S VALUE=DIEN
"KRN",1.5,204,1,2,0)
ResultType^4^F
"KRN",1.5,204,1,2,2)
IM
"KRN",1.5,204,1,3,0)
VerifiedBy^6^E^63.08^.13^^1^VPR PROVIDER
"KRN",1.5,204,1,3,6)
S VALUE=$P($G(LR0(0)),U,13)
"KRN",1.5,204,1,4,0)
ResultTime^7^S^63.08^.03^^1
"KRN",1.5,204,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,204,1,4,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,204,1,5,0)
ResultStatus^8^S^63.08^.11^^1
"KRN",1.5,204,1,5,4)
S VALUE=$S(VALUE:"F",1:"P")
"KRN",1.5,204,1,5,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,204,1,6,0)
ResultText^9^W^63.08^^^^^
"KRN",1.5,204,1,6,6)
Q  D LRPT^VPRSDA("SP",+DIEN)
"KRN",1.5,204,1,7,0)
FileType^10^F
"KRN",1.5,204,1,7,2)
TXT
"KRN",1.5,204,1,8,0)
DocumentName^11^F^
"KRN",1.5,204,1,8,6)
S VALUE="LR SURGICAL PATHOLOGY REPORT"
"KRN",1.5,204,1,9,0)
DocumentNumber^14^I^63.08^^^
"KRN",1.5,204,1,9,6)
S VALUE=$$LRTIU^VPRSDA(+DIEN,"SP") ;SP or TIU
"KRN",1.5,204,1,10,0)
AuthorizationTime^16^S^63.08^.11^^1
"KRN",1.5,204,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,204,1,10,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,204,1,11,0)
PerformedAt^17^E^63.08^^^^VPR FACILITY
"KRN",1.5,204,1,11,6)
S VALUE=+$G(VASITE)
"KRN",1.5,204,1,13,0)
EnteredBy^21^E^63.08^.02^^1^VPR USER
"KRN",1.5,204,1,13,6)
S VALUE=$P($G(LR0),U,2)
"KRN",1.5,204,1,14,0)
EnteredAt^22^E^63.08^^^^VPR FACILITY
"KRN",1.5,204,1,14,6)
S VALUE=$G(VASITE)
"KRN",1.5,204,1,15,0)
EnteredOn^23^S^63.08^.1^^1
"KRN",1.5,204,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,204,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,204,1,16,0)
FromTime^1^S^63.08^.01^^1
"KRN",1.5,204,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,204,1,16,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,204,1,"B","AuthorizationTime",10)

"KRN",1.5,204,1,"B","DocumentName",8)

"KRN",1.5,204,1,"B","DocumentNumber",9)

"KRN",1.5,204,1,"B","EnteredAt",14)

"KRN",1.5,204,1,"B","EnteredBy",13)

"KRN",1.5,204,1,"B","EnteredOn",15)

"KRN",1.5,204,1,"B","Extension",1)

"KRN",1.5,204,1,"B","FileType",7)

"KRN",1.5,204,1,"B","FromTime",16)

"KRN",1.5,204,1,"B","PerformedAt",11)

"KRN",1.5,204,1,"B","ResultStatus",5)

"KRN",1.5,204,1,"B","ResultText",6)

"KRN",1.5,204,1,"B","ResultTime",4)

"KRN",1.5,204,1,"B","ResultType",2)

"KRN",1.5,204,1,"B","VerifiedBy",3)

"KRN",1.5,204,1,"SEQ",1,16)

"KRN",1.5,204,1,"SEQ",3,1)

"KRN",1.5,204,1,"SEQ",4,2)

"KRN",1.5,204,1,"SEQ",6,3)

"KRN",1.5,204,1,"SEQ",7,4)

"KRN",1.5,204,1,"SEQ",8,5)

"KRN",1.5,204,1,"SEQ",9,6)

"KRN",1.5,204,1,"SEQ",10,7)

"KRN",1.5,204,1,"SEQ",11,8)

"KRN",1.5,204,1,"SEQ",14,9)

"KRN",1.5,204,1,"SEQ",16,10)

"KRN",1.5,204,1,"SEQ",17,11)

"KRN",1.5,204,1,"SEQ",21,13)

"KRN",1.5,204,1,"SEQ",22,14)

"KRN",1.5,204,1,"SEQ",23,15)

"KRN",1.5,204,2)

"KRN",1.5,204,3)
K LR0
"KRN",1.5,204,4)
S:'$G(LRDFN) LRDFN=+$P(DIEN,",",2) S LR0=$G(^LR(LRDFN,"SP",+DIEN,0)) I '$P(LR0,U,11) S DDEOUT=1
"KRN",1.5,204,19,0)
^^1^1^3190220^
"KRN",1.5,204,19,1,0)
This entity supports VPR LAB ORDER, providing Surgical Pathology results.
"KRN",1.5,205,-1)
0^24
"KRN",1.5,205,0)
VPR LRCY RESULT^63.09^^^^S
"KRN",1.5,205,.1)
Result
"KRN",1.5,205,1,0)
^1.51^16^15
"KRN",1.5,205,1,1,0)
Extension^3^E^63.09^^^^VPR LR RESULT EXTENSION
"KRN",1.5,205,1,1,6)
S VALUE=DIEN
"KRN",1.5,205,1,2,0)
ResultType^4^F
"KRN",1.5,205,1,2,2)
IM
"KRN",1.5,205,1,3,0)
VerifiedBy^6^E^63.09^.13^^1^VPR PROVIDER
"KRN",1.5,205,1,3,6)
S VALUE=$P($G(LR0),U,13)
"KRN",1.5,205,1,4,0)
ResultTime^7^S^63.09^.03^^1
"KRN",1.5,205,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,205,1,4,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,205,1,5,0)
ResultStatus^8^S^63.09^.11^^1
"KRN",1.5,205,1,5,4)
S VALUE=$S(VALUE:"F",1:"P")
"KRN",1.5,205,1,5,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,205,1,6,0)
ResultText^9^W^63.09
"KRN",1.5,205,1,6,6)
Q  D LRPT^VPRSDA("CY",+DIEN)
"KRN",1.5,205,1,7,0)
FileType^10^F
"KRN",1.5,205,1,7,2)
TXT
"KRN",1.5,205,1,8,0)
DocumentName^11^F
"KRN",1.5,205,1,8,6)
S VALUE="LR CYTOPATHOLOGY REPORT"
"KRN",1.5,205,1,9,0)
DocumentNumber^14^I^
"KRN",1.5,205,1,9,6)
S VALUE=$$LRTIU^VPRSDA(+DIEN,"CY") ;CY or TIU
"KRN",1.5,205,1,10,0)
AuthorizationTime^16^S^63.09^.11^^1
"KRN",1.5,205,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,205,1,10,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,205,1,11,0)
PerformedAt^17^E^63.09^^^^VPR FACILITY
"KRN",1.5,205,1,11,6)
S VALUE=+$G(VASITE)
"KRN",1.5,205,1,13,0)
EnteredBy^21^E^63.09^.02^^1^VPR USER
"KRN",1.5,205,1,13,6)
S VALUE=$P($G(LR0),U,2)
"KRN",1.5,205,1,14,0)
EnteredAt^22^E^63.09^^^^VPR FACILITY
"KRN",1.5,205,1,14,6)
S VALUE=$G(VASITE)
"KRN",1.5,205,1,15,0)
EnteredOn^23^S^63.09^.1^^1
"KRN",1.5,205,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,205,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,205,1,16,0)
FromTime^1^S^63.09^.01^^1
"KRN",1.5,205,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,205,1,16,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,205,1,"B","AuthorizationTime",10)

"KRN",1.5,205,1,"B","DocumentName",8)

"KRN",1.5,205,1,"B","DocumentNumber",9)

"KRN",1.5,205,1,"B","EnteredAt",14)

"KRN",1.5,205,1,"B","EnteredBy",13)

"KRN",1.5,205,1,"B","EnteredOn",15)

"KRN",1.5,205,1,"B","Extension",1)

"KRN",1.5,205,1,"B","FileType",7)

"KRN",1.5,205,1,"B","FromTime",16)

"KRN",1.5,205,1,"B","PerformedAt",11)

"KRN",1.5,205,1,"B","ResultStatus",5)

"KRN",1.5,205,1,"B","ResultText",6)

"KRN",1.5,205,1,"B","ResultTime",4)

"KRN",1.5,205,1,"B","ResultType",2)

"KRN",1.5,205,1,"B","VerifiedBy",3)

"KRN",1.5,205,1,"SEQ",1,16)

"KRN",1.5,205,1,"SEQ",3,1)

"KRN",1.5,205,1,"SEQ",4,2)

"KRN",1.5,205,1,"SEQ",6,3)

"KRN",1.5,205,1,"SEQ",7,4)

"KRN",1.5,205,1,"SEQ",8,5)

"KRN",1.5,205,1,"SEQ",9,6)

"KRN",1.5,205,1,"SEQ",10,7)

"KRN",1.5,205,1,"SEQ",11,8)

"KRN",1.5,205,1,"SEQ",14,9)

"KRN",1.5,205,1,"SEQ",16,10)

"KRN",1.5,205,1,"SEQ",17,11)

"KRN",1.5,205,1,"SEQ",21,13)

"KRN",1.5,205,1,"SEQ",22,14)

"KRN",1.5,205,1,"SEQ",23,15)

"KRN",1.5,205,3)
K LR0
"KRN",1.5,205,4)
S:'$G(LRDFN) LRDFN=+$P(DIEN,",",2) S LR0=$G(^LR(LRDFN,"CY",+DIEN,0)) I '$P(LR0,U,11) S DDEOUT=1
"KRN",1.5,205,19,0)
^^1^1^3190220^^
"KRN",1.5,205,19,1,0)
This entity supports VPR LAB ORDER, providing Cytopathology results.
"KRN",1.5,206,-1)
0^27
"KRN",1.5,206,0)
VPR LREM RESULT^63.02^^^^S
"KRN",1.5,206,.1)
Result
"KRN",1.5,206,1,0)
^1.51^16^15
"KRN",1.5,206,1,1,0)
Extension^3^E^63.02^^^^VPR LR RESULT EXTENSION
"KRN",1.5,206,1,1,6)
S VALUE=DIEN
"KRN",1.5,206,1,2,0)
ResultType^4^F
"KRN",1.5,206,1,2,2)
IM
"KRN",1.5,206,1,3,0)
VerifiedBy^6^E^63.02^.13^^1^VPR PROVIDER
"KRN",1.5,206,1,3,6)
S VALUE=$P($G(LR0),U,13)
"KRN",1.5,206,1,4,0)
ResultTime^7^S^63.02^.03^^1
"KRN",1.5,206,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,206,1,4,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,206,1,5,0)
ResultStatus^8^S^63.02^.11^^1
"KRN",1.5,206,1,5,4)
S VALUE=$S(VALUE:"F",1:"P")
"KRN",1.5,206,1,5,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,206,1,6,0)
ResultText^9^W^63.02
"KRN",1.5,206,1,6,6)
Q  D LRPT^VPRSDA("EM",+DIEN)
"KRN",1.5,206,1,7,0)
FileType^10^F
"KRN",1.5,206,1,7,2)
TXT
"KRN",1.5,206,1,8,0)
DocumentName^11^F
"KRN",1.5,206,1,8,6)
S VALUE="LR ELECTRON MICROSCOPY REPORT"
"KRN",1.5,206,1,9,0)
DocumentNumber^14^I^
"KRN",1.5,206,1,9,6)
S VALUE=$$LRTIU^VPRSDA(+DIEN,"EM") ;EM or TIU
"KRN",1.5,206,1,10,0)
AuthorizationTime^16^S^63.02^.11^^1
"KRN",1.5,206,1,10,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,206,1,10,6)
S VALUE=$P($G(LR0),U,11)
"KRN",1.5,206,1,11,0)
PerformedAt^17^E^63.02^^^^VPR FACILITY
"KRN",1.5,206,1,11,6)
S VALUE=+$G(VASITE)
"KRN",1.5,206,1,13,0)
EnteredBy^21^E^63.02^.02^^1^VPR USER
"KRN",1.5,206,1,13,6)
S VALUE=$P($G(LR0),U,2)
"KRN",1.5,206,1,14,0)
EnteredAt^22^E^63.02^^^^VPR FACILITY
"KRN",1.5,206,1,14,6)
S VALUE=$G(VASITE)
"KRN",1.5,206,1,15,0)
EnteredOn^23^S^63.02^.1^^1
"KRN",1.5,206,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,206,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,206,1,16,0)
FromTime^1^S^63.02^.01^^1
"KRN",1.5,206,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,206,1,16,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,206,1,"B","AuthorizationTime",10)

"KRN",1.5,206,1,"B","DocumentName",8)

"KRN",1.5,206,1,"B","DocumentNumber",9)

"KRN",1.5,206,1,"B","EnteredAt",14)

"KRN",1.5,206,1,"B","EnteredBy",13)

"KRN",1.5,206,1,"B","EnteredOn",15)

"KRN",1.5,206,1,"B","Extension",1)

"KRN",1.5,206,1,"B","FileType",7)

"KRN",1.5,206,1,"B","FromTime",16)

"KRN",1.5,206,1,"B","PerformedAt",11)

"KRN",1.5,206,1,"B","ResultStatus",5)

"KRN",1.5,206,1,"B","ResultText",6)

"KRN",1.5,206,1,"B","ResultTime",4)

"KRN",1.5,206,1,"B","ResultType",2)

"KRN",1.5,206,1,"B","VerifiedBy",3)

"KRN",1.5,206,1,"SEQ",1,16)

"KRN",1.5,206,1,"SEQ",3,1)

"KRN",1.5,206,1,"SEQ",4,2)

"KRN",1.5,206,1,"SEQ",6,3)

"KRN",1.5,206,1,"SEQ",7,4)

"KRN",1.5,206,1,"SEQ",8,5)

"KRN",1.5,206,1,"SEQ",9,6)

"KRN",1.5,206,1,"SEQ",10,7)

"KRN",1.5,206,1,"SEQ",11,8)

"KRN",1.5,206,1,"SEQ",14,9)

"KRN",1.5,206,1,"SEQ",16,10)

"KRN",1.5,206,1,"SEQ",17,11)

"KRN",1.5,206,1,"SEQ",21,13)

"KRN",1.5,206,1,"SEQ",22,14)

"KRN",1.5,206,1,"SEQ",23,15)

"KRN",1.5,206,3)
K LR0
"KRN",1.5,206,4)
S:'$G(LRDFN) LRDFN=+$P(DIEN,",",2) S LR0=$G(^LR(LRDFN,"EM",+DIEN,0)) I '$P(LR0,U,11) S DDEOUT=1
"KRN",1.5,206,19,0)
^^1^1^3190220^^
"KRN",1.5,206,19,1,0)
This entity supports VPR LAB ORDER, providing Electron Microscopy results.
"KRN",1.5,207,-1)
0^28
"KRN",1.5,207,0)
VPR LRMI RESULT^63.05^^^^S
"KRN",1.5,207,.1)
Result
"KRN",1.5,207,1,0)
^1.51^16^13
"KRN",1.5,207,1,1,0)
Extension^3^E^63.05
"KRN",1.5,207,1,2,0)
ResultType^4^F
"KRN",1.5,207,1,2,2)
IM
"KRN",1.5,207,1,3,0)
VerifiedBy^6^E^63.05^.04^^1^VPR PROVIDER
"KRN",1.5,207,1,3,6)
S VALUE=$P($G(LR0(0)),U,4)
"KRN",1.5,207,1,4,0)
ResultTime^7^S^63.05^.03^^1
"KRN",1.5,207,1,4,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,207,1,4,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,207,1,5,0)
ResultStatus^8^S^63.05^.03^^1
"KRN",1.5,207,1,5,4)
S VALUE=$S(VALUE:"F",1:"P")
"KRN",1.5,207,1,5,6)
S VALUE=$P($G(LR0),U,3)
"KRN",1.5,207,1,6,0)
ResultText^9^W^63.05
"KRN",1.5,207,1,6,6)
Q  D LRPT^VPRSDA("MI",+DIEN)
"KRN",1.5,207,1,7,0)
FileType^10^F
"KRN",1.5,207,1,7,2)
TXT
"KRN",1.5,207,1,8,0)
DocumentName^11^F
"KRN",1.5,207,1,8,6)
S VALUE="LR MICROBIOLOGY REPORT"
"KRN",1.5,207,1,9,0)
DocumentNumber^14^I^
"KRN",1.5,207,1,9,6)
S VALUE=+DIEN_";MI"
"KRN",1.5,207,1,11,0)
PerformedAt^17^E^63.05^.112^^^VPR FACILITY
"KRN",1.5,207,1,11,6)
S VALUE=$P($G(LR0),U,14) S:'VALUE VALUE=+$G(VASITE)
"KRN",1.5,207,1,14,0)
EnteredAt^22^E^63.05^.112^^1^VPR FACILITY
"KRN",1.5,207,1,14,6)
S VALUE=$P($G(LR0),U,14) S:'VALUE VALUE=$G(VASITE)
"KRN",1.5,207,1,15,0)
EnteredOn^23^S^63.05^.1^^1
"KRN",1.5,207,1,15,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,207,1,15,6)
S VALUE=$P($G(LR0),U,10)
"KRN",1.5,207,1,16,0)
FromTime^1^S^63.05^.01^^1
"KRN",1.5,207,1,16,4)
S VALUE=$$DATE^VPRSDA(VALUE)
"KRN",1.5,207,1,16,6)
S VALUE=9999999-(+DIEN)
"KRN",1.5,207,1,"B","DocumentName",8)

"KRN",1.5,207,1,"B","DocumentNumber",9)

"KRN",1.5,207,1,"B","EnteredAt",14)

"KRN",1.5,207,1,"B","EnteredOn",15)

"KRN",1.5,207,1,"B","Extension",1)

"KRN",1.5,207,1,"B","FileType",7)

"KRN",1.5,207,1,"B","FromTime",16)

"KRN",1.5,207,1,"B","PerformedAt",11)

"KRN",1.5,207,1,"B","ResultStatus",5)

"KRN",1.5,207,1,"B","ResultText",6)

"KRN",1.5,207,1,"B","ResultTime",4)

"KRN",1.5,207,1,"B","ResultType",2)

"KRN",1.5,207,1,"B","VerifiedBy",3)

"KRN",1.5,207,1,"SEQ",1,16)

"KRN",1.5,207,1,"SEQ",3,1)

"KRN",1.5,207,1,"SEQ",4,2)

"KRN",1.5,207,1,"SEQ",6,3)

"KRN",1.5,207,1,"SEQ",7,4)

"KRN",1.5,207,1,"SEQ",8,5)

"KRN",1.5,207,1,"SEQ",9,6)

"KRN",1.5,207,1,"SEQ",10,7)

"KRN",1.5,207,1,"SEQ",11,8)

"KRN",1.5,207,1,"SEQ",14,9)

"KRN",1.5,207,1,"SEQ",17,11)

"KRN",1.5,207,1,"SEQ",22,14)

"KRN",1.5,207,1,"SEQ",23,15)

"KRN",1.5,207,3)
K LR0
"KRN",1.5,207,4)
S:'$G(LRDFN) LRDFN=+$P(DIEN,",",2) S LR0=$G(^LR(LRDFN,"MI",+DIEN,0)) I '$P(LR0,U,3) S DDEOUT=1
"KRN",1.5,207,19,0)
^^1^1^3190220^^
"KRN",1.5,207,19,1,0)
This entity supports VPR LAB ORDER, providing Microbiology results.
"KRN",1.5,208,-1)
0^21
"KRN",1.5,208,0)
VPR LR RESULT EXTENSION^63^^^^S
"KRN",1.5,208,.1)
ResultExtension
"KRN",1.5,208,1,0)
^1.51^1^1
"KRN",1.5,208,1,1,0)
GroupName^1^F
"KRN",1.5,208,1,1,6)
S VALUE=$P($G(LR0),U,6) ;field #.06 Accession Number
"KRN",1.5,208,1,"B","GroupName",1)

"KRN",1.5,208,1,"SEQ",1,1)

"KRN",1.5,208,19,0)
^^2^2^3190220^
"KRN",1.5,208,19,1,0)
This entity supports the VPR LRxx RESULT entities. It expects the local
"KRN",1.5,208,19,2,0)
variable LR0, set to the appropriate Lab Data specimen zero node.
"MBREQ")
0
"ORD",28,1.5)
1.5;28;;;ENT^XPDTA2;ENTF1^XPDIA0;ENTE1^XPDIA0;ENTF2^XPDIA0;;ENTDEL^XPDIA0(%)
"ORD",28,1.5,0)
ENTITY
"PKG",571,-1)
1^1
"PKG",571,0)
VIRTUAL PATIENT RECORD^VPR^Utilities to manage a virtual copy of the patient record
"PKG",571,22,0)
^9.49I^1^1
"PKG",571,22,1,0)
1.0^3110804^3110901^1
"PKG",571,22,1,"PAH",1,0)
10^3190409^10000000407
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","VPREVNT")
0^7^B125233310^B123701454
"RTN","VPREVNT",1,0)
VPREVNT ;SLC/MKB -- VistA event listeners ;10/25/18  15:29
"RTN","VPREVNT",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPREVNT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","VPREVNT",4,0)
 ;
"RTN","VPREVNT",5,0)
 ; External References          DBIA#
"RTN","VPREVNT",6,0)
 ; -------------------          -----
"RTN","VPREVNT",7,0)
 ; DG FIELD MONITOR              3344
"RTN","VPREVNT",8,0)
 ; DGPM MOVEMENT EVENTS          1181
"RTN","VPREVNT",9,0)
 ; FH EVSEND OR                  6097
"RTN","VPREVNT",10,0)
 ; GMPL EVENT                    6065
"RTN","VPREVNT",11,0)
 ; GMRA ENTERED IN ERROR         1467
"RTN","VPREVNT",12,0)
 ; GMRA SIGN-OFF ON DATA         1469
"RTN","VPREVNT",13,0)
 ; GMRC EVSEND OR                3140
"RTN","VPREVNT",14,0)
 ; IBCN NEW INSURANCE            7010
"RTN","VPREVNT",15,0)
 ; LR7O AP EVSEND OR             7011
"RTN","VPREVNT",16,0)
 ; LR70 CH EVSEND OR             6087
"RTN","VPREVNT",17,0)
 ; MDC OBSERVATION UPDATE        6084
"RTN","VPREVNT",18,0)
 ; OR EVSEND FH                  6090
"RTN","VPREVNT",19,0)
 ; OR EVSEND GMRC                3135
"RTN","VPREVNT",20,0)
 ; OR EVSEND LRCH                6091
"RTN","VPREVNT",21,0)
 ; OR EVSEND ORG                 6092
"RTN","VPREVNT",22,0)
 ; OR EVSEND PS                  6093
"RTN","VPREVNT",23,0)
 ; OR EVSEND RA                  6094
"RTN","VPREVNT",24,0)
 ; OR EVSEND VPR                 6095
"RTN","VPREVNT",25,0)
 ; PS EVSEND OR                  2415
"RTN","VPREVNT",26,0)
 ; PSB EVSEND VPR                6085
"RTN","VPREVNT",27,0)
 ; PXK VISIT DATA EVENT          1298
"RTN","VPREVNT",28,0)
 ; RA EVSEND OR                  6086
"RTN","VPREVNT",29,0)
 ; SCMC PATIENT TEAM CHANGES     7012
"RTN","VPREVNT",30,0)
 ; SCMC PATIENT TEAM POSITION    7013
"RTN","VPREVNT",31,0)
 ; SDAM APPOINTMENT EVENTS       1320
"RTN","VPREVNT",32,0)
 ; ^AUPNPROB                     5703
"RTN","VPREVNT",33,0)
 ; ^AUPNVSIT                     2028
"RTN","VPREVNT",34,0)
 ; ^AUTTHF                       4295
"RTN","VPREVNT",35,0)
 ; ^DGPM                         1865
"RTN","VPREVNT",36,0)
 ; ^DPT                         10035
"RTN","VPREVNT",37,0)
 ; ^LR                            525
"RTN","VPREVNT",38,0)
 ; ^OR(100                       5771
"RTN","VPREVNT",39,0)
 ; ^PSB(53.79                    5909
"RTN","VPREVNT",40,0)
 ; ^RADPT                        2480
"RTN","VPREVNT",41,0)
 ; ^TIU(8925.1                   5677
"RTN","VPREVNT",42,0)
 ; DIC                           2051
"RTN","VPREVNT",43,0)
 ; DIQ                           2056
"RTN","VPREVNT",44,0)
 ; TIULQ                         2693
"RTN","VPREVNT",45,0)
 ; TIULX                         3058
"RTN","VPREVNT",46,0)
 ; VADPT2                         325
"RTN","VPREVNT",47,0)
 ;
"RTN","VPREVNT",48,0)
DG ; -- DG FIELD MONITOR protocol listener
"RTN","VPREVNT",49,0)
 N VPRFN S VPRFN=$G(DGFILE)
"RTN","VPREVNT",50,0)
 I "^2^2.01^2.02^2.06^38.1^"'[(U_VPRFN_U) Q
"RTN","VPREVNT",51,0)
 N DFN S DFN=+$G(DGDA)
"RTN","VPREVNT",52,0)
 ; collect individual fields into single tasked update if possible
"RTN","VPREVNT",53,0)
 I VPRFN=2 D:$$FLD(+$G(DGFIELD)) QUE^VPRHS(DFN) Q
"RTN","VPREVNT",54,0)
 D POST^VPRHS(DFN,"Patient",DFN_";2")
"RTN","VPREVNT",55,0)
 Q
"RTN","VPREVNT",56,0)
 ;
"RTN","VPREVNT",57,0)
FLD(X) ; -- Return 1 or 0, if X is a field tracked by VPR
"RTN","VPREVNT",58,0)
 ;    via DG FIELD MONITOR
"RTN","VPREVNT",59,0)
 S X=U_+$G(X)_U
"RTN","VPREVNT",60,0)
 I "^.01^.02^.03^.05^.07^.08^.09^.092^.093^.351^"[X Q 1     ;demographic
"RTN","VPREVNT",61,0)
 I "^.111^.1112^.112^.113^.114^.115^.131^.132^.134^"[X Q 1  ;addr/phone
"RTN","VPREVNT",62,0)
 I "^.211^.212^.213^.214^.216^.217^.218^.219^.21011^"[X Q 1 ;NOK
"RTN","VPREVNT",63,0)
 I "^.331^.332^.333^.334^.335^.336^.337^.338^.339^"[X Q 1   ;ECON
"RTN","VPREVNT",64,0)
 I "^.301^.302^.32102^.32103^.3215^.32201^.5295^"[X Q 1     ;serv conn
"RTN","VPREVNT",65,0)
 I "^.14^.323^.361^1901^"[X Q 1
"RTN","VPREVNT",66,0)
 Q 0
"RTN","VPREVNT",67,0)
 ;
"RTN","VPREVNT",68,0)
DGPM ; -- DGPM MOVEMENT EVENTS protocol listener
"RTN","VPREVNT",69,0)
 ;    [expects DFN,DGPM* variables]
"RTN","VPREVNT",70,0)
 I $$NEWINPT,$$ON^VPRHS,'$$SUBS^VPRHS(DFN) D NEW^VPRHS(DFN) Q
"RTN","VPREVNT",71,0)
 N ADM S ADM=DGPMDA
"RTN","VPREVNT",72,0)
 I DGPMT'=1 S ADM=$S(DGPMA:$P(DGPMA,U,14),1:$P(DGPMP,U,14)) Q:ADM<1
"RTN","VPREVNT",73,0)
 ; loop to find all Visits (have seen >1 per admission)
"RTN","VPREVNT",74,0)
 ; if no visit# yet, will be updated when assigned in PCE section
"RTN","VPREVNT",75,0)
 N VAINDT,X,I,PTF
"RTN","VPREVNT",76,0)
 S X=+$G(^DGPM(+$G(ADM),0)),VAINDT=(9999999-$P(X,"."))_"."_$P(X,".",2)
"RTN","VPREVNT",77,0)
 S I=0 F  S I=$O(^AUPNVSIT("AAH",DFN,VAINDT,I)) Q:I<1  D
"RTN","VPREVNT",78,0)
 . ; If Admission is deleted, update as Visit; else update as Admission
"RTN","VPREVNT",79,0)
 . I DGPMT=1,'DGPMA D POST^VPRHS(DFN,"Encounter",I_";9000010") Q
"RTN","VPREVNT",80,0)
 . D POST^VPRHS(DFN,"Encounter",ADM_"~"_I_";405")
"RTN","VPREVNT",81,0)
 . S PTF=$P(DGPMA,U,16) D:PTF POST^VPRHS(DFN,"Diagnosis",PTF_";45")
"RTN","VPREVNT",82,0)
 Q
"RTN","VPREVNT",83,0)
 ;
"RTN","VPREVNT",84,0)
NEWINPT() ; -- is DFN newly admitted?
"RTN","VPREVNT",85,0)
 N Y S Y=0
"RTN","VPREVNT",86,0)
 I DGPMT=1,DGPMA,'DGPMP,+$G(^DPT(DFN,.105))=DGPMDA S Y=1 ;new admission
"RTN","VPREVNT",87,0)
 Q Y
"RTN","VPREVNT",88,0)
 ;
"RTN","VPREVNT",89,0)
SDAM ; -- SDAM APPOINTMENT EVENTS protocol listener
"RTN","VPREVNT",90,0)
 I $G(SDATA) D  Q  ;appointments
"RTN","VPREVNT",91,0)
 . N DFN,DATE,HLOC,ACT
"RTN","VPREVNT",92,0)
 . S DFN=+$P(SDATA,U,2) Q:DFN<1
"RTN","VPREVNT",93,0)
 . Q:$G(SDAMEVT)>5  ;only track make, cancel, no show, check in/out
"RTN","VPREVNT",94,0)
 . S DATE=+$P(SDATA,U,3),HLOC=+$P(SDATA,U,4)
"RTN","VPREVNT",95,0)
 . S ACT=$S($G(SDATA("AFTER","STATUS"))["CANCEL":"@",1:"")
"RTN","VPREVNT",96,0)
 . ;Q:$P($G(^DPT(DFN,"S",DATE,0)),U)'=HLOC
"RTN","VPREVNT",97,0)
 . D POST^VPRHS(DFN,"Appointment",(DATE_","_DFN_";2.98"),ACT)
"RTN","VPREVNT",98,0)
 Q
"RTN","VPREVNT",99,0)
 ;
"RTN","VPREVNT",100,0)
PCE ; -- PXK VISIT DATA EVENT protocol listener
"RTN","VPREVNT",101,0)
 N IEN,PX0A,PX0B,DFN,SUB,DA,ACT,X
"RTN","VPREVNT",102,0)
 S IEN=+$O(^TMP("PXKCO",$J,0)) Q:IEN<1
"RTN","VPREVNT",103,0)
 S PX0A=$G(^TMP("PXKCO",$J,IEN,"VST",IEN,0,"AFTER")),PX0B=$G(^("BEFORE"))
"RTN","VPREVNT",104,0)
 S DFN=$S($L(PX0A):+$P(PX0A,U,5),1:+$P(PX0B,U,5)) Q:DFN<1
"RTN","VPREVNT",105,0)
 ; Visit file
"RTN","VPREVNT",106,0)
 S ACT=$S(PX0A="":"@",1:"")
"RTN","VPREVNT",107,0)
 I $P(PX0A,U,7)'="H",PX0A'=PX0B,ACT="" D POST^VPRHS(DFN,"Encounter",IEN_";9000010")
"RTN","VPREVNT",108,0)
 I $P(PX0A,U,7)="H",PX0B="" D  ;assign visit# (other edits via DGPM)
"RTN","VPREVNT",109,0)
 . N VAINDT S VAINDT=+PX0A D ADM^VADPT2
"RTN","VPREVNT",110,0)
 . D:$G(VADMVT) POST^VPRHS(DFN,"Encounter",VADMVT_"~"_IEN_";405")
"RTN","VPREVNT",111,0)
 ; check V-files
"RTN","VPREVNT",112,0)
 F SUB="IMM","XAM","POV","HF" D  ;"PED","SK","CPT"
"RTN","VPREVNT",113,0)
 . S DA=0 F  S DA=$O(^TMP("PXKCO",$J,IEN,SUB,DA)) Q:DA<1  D
"RTN","VPREVNT",114,0)
 .. N NODE,AFTER,BEFORE,DIFF,SUB0 S DIFF=0
"RTN","VPREVNT",115,0)
 .. F NODE=0,12,13,811 D  Q:DIFF
"RTN","VPREVNT",116,0)
 ... S AFTER=$G(^TMP("PXKCO",$J,IEN,SUB,DA,NODE,"AFTER")),BEFORE=$G(^("BEFORE"))
"RTN","VPREVNT",117,0)
 ... I NODE=0 S SUB0=$S(AFTER'="":AFTER,1:BEFORE)
"RTN","VPREVNT",118,0)
 ... I BEFORE'=AFTER S DIFF=1,ACT=$S(NODE'=0:"",AFTER'="":"",1:"@")
"RTN","VPREVNT",119,0)
 .. Q:'DIFF  S X=$$NAME(SUB) Q:X=""
"RTN","VPREVNT",120,0)
 .. D POST^VPRHS(DFN,$P(X,U),(DA_";"_$P(X,U,2)),ACT,IEN)
"RTN","VPREVNT",121,0)
 ; delete visit itself last
"RTN","VPREVNT",122,0)
 I PX0B,PX0A="" D POST^VPRHS(DFN,"Encounter",IEN_";9000010","@")
"RTN","VPREVNT",123,0)
 Q
"RTN","VPREVNT",124,0)
 ;
"RTN","VPREVNT",125,0)
NAME(X) ; -- return container name for V-files
"RTN","VPREVNT",126,0)
 I X="HF",$$FHX Q "FamilyHistory^9000010.23"
"RTN","VPREVNT",127,0)
 I X="HF",$$SHX Q "SocialHistory^9000010.23"
"RTN","VPREVNT",128,0)
 ; X="HF"  Q "HealthConcern^9000010.23"
"RTN","VPREVNT",129,0)
 I X="IMM" Q "Vaccination^9000010.11"
"RTN","VPREVNT",130,0)
 I X="XAM" Q "PhysicalExam^9000010.13"
"RTN","VPREVNT",131,0)
 I X="POV" Q "Diagnosis^9000010.07"
"RTN","VPREVNT",132,0)
 ; X="CPT" Q "Procedure^9000010.18"
"RTN","VPREVNT",133,0)
 ; X="PED" Q "education^9000010.16"
"RTN","VPREVNT",134,0)
 ; X="SK"  Q "Procedure^9000010.12"
"RTN","VPREVNT",135,0)
 Q ""
"RTN","VPREVNT",136,0)
 ;
"RTN","VPREVNT",137,0)
FHX() ; -- return 1 or 0, if HF name is for FamilyHistory
"RTN","VPREVNT",138,0)
 N X S X=+$G(SUB0),X=$P($G(^AUTTHF(X,0)),U)
"RTN","VPREVNT",139,0)
 I X["FAMILY HISTORY" Q 1
"RTN","VPREVNT",140,0)
 I X["FAMILY HX" Q 1
"RTN","VPREVNT",141,0)
 Q 0
"RTN","VPREVNT",142,0)
 ;
"RTN","VPREVNT",143,0)
SHX() ; -- return 1 or 0, if HF name is for SocialHistory
"RTN","VPREVNT",144,0)
 N X S X=+$G(SUB0),X=$P($G(^AUTTHF(X,0)),U)
"RTN","VPREVNT",145,0)
 I (X["TOBACCO")!(X["SMOK") Q 1
"RTN","VPREVNT",146,0)
 ; (X["LIVES")!(X["LIVING") Q 1
"RTN","VPREVNT",147,0)
 ; (X["RELIGIO")!(X["SPIRIT") Q 1
"RTN","VPREVNT",148,0)
 Q 0
"RTN","VPREVNT",149,0)
 ;
"RTN","VPREVNT",150,0)
XQOR(MSG,FD) ; -- CPRS protocol event listener
"RTN","VPREVNT",151,0)
 ; FD   = frontdoor msg from CPRS (get ORIFN for new backdoor orders)
"RTN","VPREVNT",152,0)
 ; else = backdoor msg/ack from Pharmacy, Lab, Radiology, etc.
"RTN","VPREVNT",153,0)
 N VPRMSG,MSH,VPRPKG,VPRSDA,DFN,ORC,ACT
"RTN","VPREVNT",154,0)
 S VPRMSG=$S($L($G(MSG)):MSG,1:"MSG") Q:'$O(@VPRMSG@(0))
"RTN","VPREVNT",155,0)
 S MSH=0 F  S MSH=$O(@VPRMSG@(MSH)) Q:MSH'>0  Q:$E(@VPRMSG@(MSH),1,3)="MSH"
"RTN","VPREVNT",156,0)
 Q:'MSH  Q:'$L($G(@VPRMSG@(MSH)))
"RTN","VPREVNT",157,0)
 S VPRPKG=$S($G(FD):$P(@VPRMSG@(MSH),"|",5),1:$P(@VPRMSG@(MSH),"|",3))
"RTN","VPREVNT",158,0)
 S VPRSDA=$$ORDCONT(VPRPKG),DFN=$$PID Q:DFN<1
"RTN","VPREVNT",159,0)
 S ORC=MSH F  S ORC=$O(@VPRMSG@(+ORC)) Q:ORC'>0  I $E($G(@VPRMSG@(ORC)),1,3)="ORC" D
"RTN","VPREVNT",160,0)
 . N ORDCNTRL,PKGIFN,ORIFN
"RTN","VPREVNT",161,0)
 . S ORC=ORC_U_@VPRMSG@(ORC),ORDCNTRL=$TR($P(ORC,"|",2),"@","P")
"RTN","VPREVNT",162,0)
 . ; QUIT if action failed, conversion, purge, or backdoor verify/new
"RTN","VPREVNT",163,0)
 . I ORDCNTRL["U"!("DE^ZC^ZP^ZR^ZV^SN"[ORDCNTRL) Q
"RTN","VPREVNT",164,0)
 . I $G(FD),ORDCNTRL'="NA" Q  ;only want NA msg, from CPRS
"RTN","VPREVNT",165,0)
 . S ACT=$S(ORDCNTRL="OC":"@",1:"")
"RTN","VPREVNT",166,0)
 . ; Update *Order containers
"RTN","VPREVNT",167,0)
 . S ORIFN=+$P($P(ORC,"|",3),U),PKGIFN=$P($P(ORC,"|",4),U)
"RTN","VPREVNT",168,0)
 . Q:$O(^OR(100,ORIFN,2,0))  ;should not be getting parent orders
"RTN","VPREVNT",169,0)
 . D POST^VPRHS(DFN,VPRSDA,ORIFN_";100",ACT)
"RTN","VPREVNT",170,0)
 . I ORIFN D  ;update replaced order
"RTN","VPREVNT",171,0)
 .. N ORIG S ORIG=+$P($G(^OR(100,ORIFN,3)),U,5)
"RTN","VPREVNT",172,0)
 .. I ORIG D POST^VPRHS(DFN,VPRSDA,ORIG_";100")
"RTN","VPREVNT",173,0)
 . ; Update Referral or Document containers
"RTN","VPREVNT",174,0)
 . I VPRPKG="CONSULTS"!(VPRPKG="PROCEDURES") D GMRC
"RTN","VPREVNT",175,0)
 . Q:ORDCNTRL'="RE"
"RTN","VPREVNT",176,0)
 . I VPRPKG="RADIOLOGY"!(VPRPKG="IMAGING") D RAD
"RTN","VPREVNT",177,0)
 . I VPRPKG="LABORATORY" D LRD
"RTN","VPREVNT",178,0)
 Q
"RTN","VPREVNT",179,0)
 ;
"RTN","VPREVNT",180,0)
ORDCONT(NAME) ; -- Returns SDA Order container name
"RTN","VPREVNT",181,0)
 I NAME="LABORATORY"  Q "LabOrder"
"RTN","VPREVNT",182,0)
 I NAME="PHARMACY"    Q "Medication"
"RTN","VPREVNT",183,0)
 I NAME="RADIOLOGY"   Q "RadOrder"
"RTN","VPREVNT",184,0)
 I NAME="IMAGING"     Q "RadOrder"
"RTN","VPREVNT",185,0)
 Q "OtherOrder"
"RTN","VPREVNT",186,0)
 ;
"RTN","VPREVNT",187,0)
 I NAME="CONSULTS"    Q "Referral"
"RTN","VPREVNT",188,0)
 I NAME="PROCEDURES"  Q "Referral"
"RTN","VPREVNT",189,0)
 I NAME="ORDER ENTRY" Q "OtherOrder"
"RTN","VPREVNT",190,0)
 I NAME="DIETETICS"   Q "OtherOrder"
"RTN","VPREVNT",191,0)
 ;
"RTN","VPREVNT",192,0)
GMRC ; -- Referrals
"RTN","VPREVNT",193,0)
 N VST S VST=$$GET1^DIQ(123,+PKGIFN,"16:.03","I")
"RTN","VPREVNT",194,0)
 D POST^VPRHS(DFN,"Referral",+PKGIFN_";123",,VST)
"RTN","VPREVNT",195,0)
 ; update CP in Procedures?
"RTN","VPREVNT",196,0)
 I ORDCNTRL="RE",$$GET1^DIQ(123,+PKGIFN,1.01,"I") D  ;CP
"RTN","VPREVNT",197,0)
 . N VPRC,ID D FIND^DIC(702,,"@","Q",+PKGIFN,,"ACON",,,"VPRC")
"RTN","VPREVNT",198,0)
 . S I=0 F  S I=$O(VPRC("DILIST",2,I)) Q:I<1  D
"RTN","VPREVNT",199,0)
 .. S ID=+$G(VPRC("DILIST",2,I))
"RTN","VPREVNT",200,0)
 .. D POST^VPRHS(DFN,"Procedure",ID_";702",,VST)
"RTN","VPREVNT",201,0)
 Q
"RTN","VPREVNT",202,0)
 ;
"RTN","VPREVNT",203,0)
RAD ; -- Radiology documents
"RTN","VPREVNT",204,0)
 N IDT,RPT,I,X,VST,STS,ACT
"RTN","VPREVNT",205,0)
 S IDT=+$O(^RADPT("AO",+PKGIFN,DFN,0)),I=0
"RTN","VPREVNT",206,0)
 ; find report(s) for order
"RTN","VPREVNT",207,0)
 F  S I=$O(^RADPT("AO",+PKGIFN,DFN,IDT,I)) Q:I<1  D
"RTN","VPREVNT",208,0)
 . S X=+$P($G(^RADPT(DFN,"DT",IDT,"P",I,0)),U,17),VST=$P($G(^(0)),U,27)
"RTN","VPREVNT",209,0)
 . Q:'X  S STS=$$GET1^DIQ(74,X_",",5,"I"),ACT=""
"RTN","VPREVNT",210,0)
 . Q:STS'="V"&(STS'="EF")&(STS'="X")  I STS="X" S ACT="@"
"RTN","VPREVNT",211,0)
 . S:VST VST(X)=VST S:'$D(RPT(X)) RPT(X)=IDT_"-"_I
"RTN","VPREVNT",212,0)
 ; update Document container
"RTN","VPREVNT",213,0)
 S X=0 F  S X=$O(RPT(X)) Q:X<1  D POST^VPRHS(DFN,"Document",X_"~"_RPT(X)_";74",ACT,$G(VST(X)))
"RTN","VPREVNT",214,0)
 Q
"RTN","VPREVNT",215,0)
 ;
"RTN","VPREVNT",216,0)
LRAP(MSG) ; -- LR7O AP EVSEND OR protocol listener
"RTN","VPREVNT",217,0)
 N VPRMSG,MSH,DFN,ORC
"RTN","VPREVNT",218,0)
 S VPRMSG=$S($L($G(MSG)):MSG,1:"MSG") Q:'$O(@VPRMSG@(0))
"RTN","VPREVNT",219,0)
 S MSH=0 F  S MSH=$O(@VPRMSG@(MSH)) Q:MSH'>0  Q:$E(@VPRMSG@(MSH),1,3)="MSH"
"RTN","VPREVNT",220,0)
 Q:'MSH  Q:'$L($G(@VPRMSG@(MSH)))
"RTN","VPREVNT",221,0)
 S DFN=$$PID Q:DFN<1
"RTN","VPREVNT",222,0)
 S ORC=MSH F  S ORC=$O(@VPRMSG@(+ORC)) Q:ORC'>0  I $E($G(@VPRMSG@(ORC)),1,3)="ORC" D
"RTN","VPREVNT",223,0)
 . N ORDCNTRL,PKGIFN
"RTN","VPREVNT",224,0)
 . S ORC=ORC_U_@VPRMSG@(ORC),ORDCNTRL=$TR($P(ORC,"|",2),"@","P")
"RTN","VPREVNT",225,0)
 . Q:ORDCNTRL'="RE"  S PKGIFN=$P($P(ORC,"|",4),U)
"RTN","VPREVNT",226,0)
 . D LRD
"RTN","VPREVNT",227,0)
 Q
"RTN","VPREVNT",228,0)
 ;
"RTN","VPREVNT",229,0)
LRD ; -- AP/MI documents [from XQOR, LRAP: expects PKGIFN]
"RTN","VPREVNT",230,0)
 N SUB,IDT,LRDFN,X
"RTN","VPREVNT",231,0)
 S SUB=$P($G(PKGIFN),";",4),IDT=$P($G(PKGIFN),";",5)
"RTN","VPREVNT",232,0)
 Q:'IDT  Q:SUB=""  Q:SUB="CH"
"RTN","VPREVNT",233,0)
 S LRDFN=+$G(^DPT(DFN,"LR"))
"RTN","VPREVNT",234,0)
 I SUB'="MI" Q:$O(^LR(LRDFN,SUB,IDT,.05,0))  ;report in TIU
"RTN","VPREVNT",235,0)
 Q:'$P($G(^LR(LRDFN,SUB,IDT,0)),U,3)         ;report not complete
"RTN","VPREVNT",236,0)
 S X=IDT_","_LRDFN_"~"_SUB_";"_$S(SUB="MI":63.05,1:63.08)
"RTN","VPREVNT",237,0)
 D POST^VPRHS(DFN,"Document",X)
"RTN","VPREVNT",238,0)
 Q
"RTN","VPREVNT",239,0)
 ;
"RTN","VPREVNT",240,0)
PID() ; -- Returns patient from PID segment in current msg
"RTN","VPREVNT",241,0)
 N I,SEG,Y S I=MSH
"RTN","VPREVNT",242,0)
 F  S I=$O(@VPRMSG@(I)) Q:I'>0  S SEG=$E($G(@VPRMSG@(I)),1,3) Q:SEG="ORC"  I SEG="PID" D  Q
"RTN","VPREVNT",243,0)
 . S Y=+$P(@VPRMSG@(I),"|",4)
"RTN","VPREVNT",244,0)
 .;I '$D(^DPT(Y,0)) S:$L($P(@VPRMSG@(I),"|",5)) Y=+$P(@VPRMSG@(I),"|",5) ;alt ID for Lab
"RTN","VPREVNT",245,0)
 Q Y
"RTN","VPREVNT",246,0)
 ;
"RTN","VPREVNT",247,0)
PSB ; -- VPR PSB EVENTS protocol listener (BCMA)
"RTN","VPREVNT",248,0)
 N IEN,DFN,ORPK,TYPE,ORIFN
"RTN","VPREVNT",249,0)
 S IEN=$S($P($G(PSBIEN),",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":+$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","VPREVNT",250,0)
 S DFN=+$G(^PSB(53.79,IEN,0)),ORPK=$P($G(^(.1)),U)
"RTN","VPREVNT",251,0)
 Q:DFN<1  Q:ORPK<1  S TYPE=$S(ORPK["V":"IV",ORPK["U":5,1:"") Q:TYPE=""
"RTN","VPREVNT",252,0)
 S ORIFN=0 ;+$P($G(^PS(55,DFN,TYPE,+ORPK,0)),U,21)
"RTN","VPREVNT",253,0)
 D:ORIFN POST^VPRHS(DFN,"Medication",ORIFN_";100")
"RTN","VPREVNT",254,0)
 Q
"RTN","VPREVNT",255,0)
 ;
"RTN","VPREVNT",256,0)
GMRA(ACT) ; -- GMRA SIGN-OFF ON DATA protocol listener
"RTN","VPREVNT",257,0)
 ;   also GMRA ENTERED IN ERROR [ACT=@]
"RTN","VPREVNT",258,0)
 N DFN,IEN
"RTN","VPREVNT",259,0)
 S DFN=+$G(GMRAPA(0)),IEN=+$G(GMRAPA)
"RTN","VPREVNT",260,0)
 D POST^VPRHS(DFN,"Allergy",IEN_";120.8") ;,$G(ACT))
"RTN","VPREVNT",261,0)
 Q
"RTN","VPREVNT",262,0)
 ;
"RTN","VPREVNT",263,0)
GMRASMT(DFN) ; -- GMRAHDR Allergy Assessment listener
"RTN","VPREVNT",264,0)
 D POST^VPRHS(DFN,"Allergy")
"RTN","VPREVNT",265,0)
 Q
"RTN","VPREVNT",266,0)
 ;
"RTN","VPREVNT",267,0)
GMPL(DFN,IEN) ; -- GMPL EVENT protocol listener
"RTN","VPREVNT",268,0)
 S DFN=+$G(DFN),IEN=+$G(IEN)
"RTN","VPREVNT",269,0)
 N ACT S ACT=$S($P($G(^AUPNPROB(IEN,1)),U,2)="H":"@",1:"")
"RTN","VPREVNT",270,0)
 D POST^VPRHS(DFN,"Problem",IEN_";9000011",ACT)
"RTN","VPREVNT",271,0)
 Q
"RTN","VPREVNT",272,0)
 ;
"RTN","VPREVNT",273,0)
GMRV(DFN,IEN,ERR) ; -- Vital Measurement file #120.5 AVPR index
"RTN","VPREVNT",274,0)
 S DFN=+$G(DFN),IEN=+$G(IEN)
"RTN","VPREVNT",275,0)
 N ACT S ACT=$S($G(ERR):"@",1:"")
"RTN","VPREVNT",276,0)
 D POST^VPRHS(DFN,"Observation",IEN_";120.5",ACT)
"RTN","VPREVNT",277,0)
 Q
"RTN","VPREVNT",278,0)
 ;
"RTN","VPREVNT",279,0)
MDC(OBS) ; -- MDC OBSERVATION UPDATE protocol listener
"RTN","VPREVNT",280,0)
 N DFN,ID,ACT
"RTN","VPREVNT",281,0)
 S DFN=+$G(OBS("PATIENT_ID","I")) Q:DFN<1
"RTN","VPREVNT",282,0)
 S ID=$G(OBS("OBS_ID","I")) Q:'$L(ID)
"RTN","VPREVNT",283,0)
 S ACT=$S('$G(OBS("STATUS","I")):"@",1:"")
"RTN","VPREVNT",284,0)
 D POST^VPRHS(DFN,"Observation",ID_";704.117",ACT)
"RTN","VPREVNT",285,0)
 ;I $G(OBS("DOMAIN","VITALS")) D POST^VPRHS(DFN,"Observation",ID,ACT)
"RTN","VPREVNT",286,0)
 Q
"RTN","VPREVNT",287,0)
 ;
"RTN","VPREVNT",288,0)
CP(DFN,ID,ACT) ; -- CP Transaction file #702 AVPR index (via VPRPROC)
"RTN","VPREVNT",289,0)
 S DFN=+$G(DFN),ID=+$G(ID)
"RTN","VPREVNT",290,0)
 N VST S VST=$$GET1^DIQ(702,ID,".06:.03","I")
"RTN","VPREVNT",291,0)
 D POST^VPRHS(DFN,"Procedure",ID_";702",$G(ACT),VST)
"RTN","VPREVNT",292,0)
 Q
"RTN","VPREVNT",293,0)
 ;
"RTN","VPREVNT",294,0)
TIU(DFN,IEN) ; -- TIU Document file #8925 AVPR index
"RTN","VPREVNT",295,0)
 N ACT,STS,DAD,VST,VPRTIU,PROC
"RTN","VPREVNT",296,0)
 S DFN=+$G(DFN),IEN=+$G(IEN),ACT=""
"RTN","VPREVNT",297,0)
 ; $$ISA^TIULX(IEN,$$LR) Q   ;update from order?
"RTN","VPREVNT",298,0)
 S STS=$G(X(2)),DAD=$G(X(3)) ;X = FM data array for index
"RTN","VPREVNT",299,0)
 I STS<7 Q                   ;not complete
"RTN","VPREVNT",300,0)
 I STS=9 Q                   ;archived, leave in cache
"RTN","VPREVNT",301,0)
 S:DAD IEN=DAD I 'DAD D      ;if addendum, repull entire note
"RTN","VPREVNT",302,0)
 . I STS>13 S ACT="@"        ;deleted or retracted
"RTN","VPREVNT",303,0)
 . I $G(X2(1))="" S ACT="@"  ;deleted (new title = null)
"RTN","VPREVNT",304,0)
 D EXTRACT^TIULQ(IEN,"VPRTIU",,".03;1405",,1,"I")
"RTN","VPREVNT",305,0)
 S VST=$G(VPRTIU(IEN,.03,"I"))
"RTN","VPREVNT",306,0)
 D POST^VPRHS(DFN,"Document",IEN_";8925",ACT,VST)
"RTN","VPREVNT",307,0)
 ;Update request?
"RTN","VPREVNT",308,0)
 S PROC=$G(VPRTIU(IEN,1405,"I")) I PROC D
"RTN","VPREVNT",309,0)
 . I PROC["SRF" D POST^VPRHS(DFN,"Procedure",+PROC_";130")
"RTN","VPREVNT",310,0)
 . I PROC["GMR" D POST^VPRHS(DFN,"Referral",+PROC_";123")
"RTN","VPREVNT",311,0)
 ; Also update alert containers if CWD
"RTN","VPREVNT",312,0)
 I $$ISA^TIULX(IEN,27) D POST^VPRHS(DFN,"AdvanceDirective") Q  ;rebuild
"RTN","VPREVNT",313,0)
 I $$ISA^TIULX(IEN,30) D POST^VPRHS(DFN,"Alert",IEN_";8925",ACT) Q
"RTN","VPREVNT",314,0)
 I $$ISA^TIULX(IEN,31) D POST^VPRHS(DFN,"Alert",IEN_";8925",ACT) Q
"RTN","VPREVNT",315,0)
 Q
"RTN","VPREVNT",316,0)
 ;
"RTN","VPREVNT",317,0)
LR() ; -- Return ien of Lab class
"RTN","VPREVNT",318,0)
 N Y S Y=+$O(^TIU(8925.1,"B","LR LABORATORY REPORTS",0))
"RTN","VPREVNT",319,0)
 I Y>0,$S($P($G(^TIU(8925.1,Y,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S Y=0
"RTN","VPREVNT",320,0)
 Q Y
"RTN","VPREVNT",321,0)
 ;
"RTN","VPREVNT",322,0)
IBCN ; -- IBCN NEW INSURANCE EVENTS listener
"RTN","VPREVNT",323,0)
 I $G(DFN) D POST^VPRHS(DFN,"MemberEnrollment") ;rebuild container
"RTN","VPREVNT",324,0)
 Q
"RTN","VPREVNT",325,0)
 ;
"RTN","VPREVNT",326,0)
PCMMT ; -- SCMC PATIENT TEAM CHANGES protocol listener
"RTN","VPREVNT",327,0)
 I '$G(SCPCTM) Q  ;not pc change
"RTN","VPREVNT",328,0)
 N DFN S DFN=$S($G(SCPTTMAF):+SCPTTMAF,1:+$G(SCPTTMB4)) Q:'DFN
"RTN","VPREVNT",329,0)
 D POST^VPRHS(DFN,"Patient",DFN_";2")
"RTN","VPREVNT",330,0)
 Q
"RTN","VPREVNT",331,0)
 ;
"RTN","VPREVNT",332,0)
PCMMTP ; -- SCMC PATIENT TEAM POSITION CHANGES protocol listener
"RTN","VPREVNT",333,0)
 I '$G(SCPCTP) Q  ;not pc change
"RTN","VPREVNT",334,0)
 N TM,DFN
"RTN","VPREVNT",335,0)
 S TM=$S($G(SCPTTPAF):+SCPTTPAF,1:+$G(SCPTTPB4)) Q:'TM
"RTN","VPREVNT",336,0)
 S DFN=+$$GET1^DIQ(404.42,TM_",",.01,"I")
"RTN","VPREVNT",337,0)
 D POST^VPRHS(DFN,"Patient",DFN_";2")
"RTN","VPREVNT",338,0)
 Q
"RTN","VPREVNT",339,0)
 ;
"RTN","VPREVNT",340,0)
 ; Deprecated calls:
"RTN","VPREVNT",341,0)
 ;
"RTN","VPREVNT",342,0)
DOCDEF(IEN) ; -- TIU Document Definition file #8925.1 AVPR index
"RTN","VPREVNT",343,0)
 Q
"RTN","VPREVNT",344,0)
 ;
"RTN","VPREVNT",345,0)
DOCITM(DAD) ; -- TIU Document Def'n Items subfile #8925.14 AVPR1 index
"RTN","VPREVNT",346,0)
 Q
"RTN","VPREVNT",347,0)
 ;
"RTN","VPREVNT",348,0)
USR(IEN) ; -- USR Authorization/Subscription file #8930.1 AVPR index
"RTN","VPREVNT",349,0)
 Q
"RTN","VPREVNT",350,0)
 ;
"RTN","VPREVNT",351,0)
XU(IEN,ACT) ; -- XU USER ADD/CHANGE/TERMINATE option listener
"RTN","VPREVNT",352,0)
 Q
"RTN","VPRHS")
0^5^B24940964^B23926181
"RTN","VPRHS",1,0)
VPRHS ;SLC/MKB -- HealthShare utilities ;10/25/18  15:29
"RTN","VPRHS",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRHS",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","VPRHS",4,0)
 ;
"RTN","VPRHS",5,0)
 ; External References          DBIA#
"RTN","VPRHS",6,0)
 ; -------------------          -----
"RTN","VPRHS",7,0)
 ; ^DDE                          7014
"RTN","VPRHS",8,0)
 ; ^DGS(41.1                     3796
"RTN","VPRHS",9,0)
 ; ^DPT                         10035
"RTN","VPRHS",10,0)
 ; %ZTLOAD                      10063
"RTN","VPRHS",11,0)
 ; DDE                           7008
"RTN","VPRHS",12,0)
 ; MPIF001                       2701
"RTN","VPRHS",13,0)
 ; SDAMA301                      4433
"RTN","VPRHS",14,0)
 ; XLFDT                        10103
"RTN","VPRHS",15,0)
 ; XLFSTR                       10104
"RTN","VPRHS",16,0)
 ;
"RTN","VPRHS",17,0)
 Q
"RTN","VPRHS",18,0)
 ;
"RTN","VPRHS",19,0)
ON() ; -- return 1 or 0, if monitoring is on
"RTN","VPRHS",20,0)
 Q $P($G(^VPR(1,0)),U,2)
"RTN","VPRHS",21,0)
 ;
"RTN","VPRHS",22,0)
EN(DFN) ; -- subscribe a patient for data event monitoring
"RTN","VPRHS",23,0)
 Q:'$G(DFN)  Q:$D(^VPR(1,2,+DFN,0))
"RTN","VPRHS",24,0)
 S ^VPR(1,2,+DFN,0)=+DFN,^VPR(1,2,"B",+DFN,+DFN)=""
"RTN","VPRHS",25,0)
 ;N X,Y,DA,DIC,DINUM
"RTN","VPRHS",26,0)
 ;S DIC="^VPR(1,2,",DIC(0)="UL",DA(1)=1,(DINUM,X)=+DFN
"RTN","VPRHS",27,0)
 ;D FILE^DICN
"RTN","VPRHS",28,0)
 Q
"RTN","VPRHS",29,0)
 ;
"RTN","VPRHS",30,0)
UN(DFN) ; -- unsubscribe
"RTN","VPRHS",31,0)
 Q:'$G(DFN)  Q:'$D(^VPR(1,2,+DFN,0))
"RTN","VPRHS",32,0)
 K ^VPR(1,2,+DFN,0),^VPR(1,2,"B",+DFN,+DFN)
"RTN","VPRHS",33,0)
 ;N DA,DIK
"RTN","VPRHS",34,0)
 ;S DA(1)=1,DA=+DFN,DIK="^VPR(1,2,"
"RTN","VPRHS",35,0)
 ;D ^DIK
"RTN","VPRHS",36,0)
 Q
"RTN","VPRHS",37,0)
 ;
"RTN","VPRHS",38,0)
SUBS(DFN) ; -- return 1 or 0, if patient is subscribed or not
"RTN","VPRHS",39,0)
 Q $D(^VPR(1,2,+$G(DFN),0))
"RTN","VPRHS",40,0)
 ;
"RTN","VPRHS",41,0)
QUE(DFN) ; -- create task to POST a Patient update
"RTN","VPRHS",42,0)
 Q:'$P($G(^VPR(1,0)),U,2)       ;monitoring disabled
"RTN","VPRHS",43,0)
 Q:DFN<1  Q:'$$SUBS(DFN)        ;not subscribed
"RTN","VPRHS",44,0)
 Q:$P($G(^VPR(1,2,DFN,0)),U,2)  ;task exists
"RTN","VPRHS",45,0)
 ; create task
"RTN","VPRHS",46,0)
 N ZTRTN,ZTDTH,ZTDESC,ZTIO,ZTSAVE,ZTUCI,ZTCPU,ZTPRI,ZTKIL,ZTSYNC,ZTSK
"RTN","VPRHS",47,0)
 S ZTRTN="PAT^VPRHS",ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,10)
"RTN","VPRHS",48,0)
 S ZTDESC="Task single VPR SDA Patient Container update"
"RTN","VPRHS",49,0)
 S ZTIO="",ZTSAVE("DFN")="" D ^%ZTLOAD
"RTN","VPRHS",50,0)
 S:$G(ZTSK)>0 $P(^VPR(1,2,DFN,0),U,2)=ZTSK
"RTN","VPRHS",51,0)
 Q
"RTN","VPRHS",52,0)
 ;
"RTN","VPRHS",53,0)
PAT ; -- post Patient update
"RTN","VPRHS",54,0)
 D POST^VPRHS(DFN,"Patient",DFN_";2")
"RTN","VPRHS",55,0)
 S $P(^VPR(1,2,DFN,0),U,2)="",ZTREQ="@"
"RTN","VPRHS",56,0)
 Q
"RTN","VPRHS",57,0)
 ;
"RTN","VPRHS",58,0)
POST(DFN,TYPE,ID,ACT,VST) ; -- post an update to
"RTN","VPRHS",59,0)
 ;  ^VPR("AVPR",seq#,DFN) = ICN ^ TYPE ^ ID ^ U/D ^ VISIT#
"RTN","VPRHS",60,0)
 ;
"RTN","VPRHS",61,0)
 Q:'$P($G(^VPR(1,0)),U,2)                   ;monitoring disabled
"RTN","VPRHS",62,0)
 S DFN=+$G(DFN),TYPE=$G(TYPE),ID=$G(ID)
"RTN","VPRHS",63,0)
 Q:DFN<1  Q:TYPE=""                         ;incomplete request
"RTN","VPRHS",64,0)
 N ICN S ICN=$$GETICN^MPIF001(DFN) Q:ICN<0  ;ICN required
"RTN","VPRHS",65,0)
 ; add to ^VPR if not subscribed, not dead
"RTN","VPRHS",66,0)
 I '$$SUBS(DFN),'$G(^DPT(DFN,.35)) D NEW(DFN,ICN) Q
"RTN","VPRHS",67,0)
 S ACT=$S($G(ACT)="@":"D",1:"U")
"RTN","VPRHS",68,0)
P1 ;may enter here from VPRHSX manual update option
"RTN","VPRHS",69,0)
 N SEQ S SEQ=$I(^VPR(1,1))
"RTN","VPRHS",70,0)
 S ^VPR("AVPR",SEQ,DFN)=ICN_U_$G(TYPE)_U_$G(ID)_U_$G(ACT)_U_$G(VST)
"RTN","VPRHS",71,0)
 Q
"RTN","VPRHS",72,0)
 ;
"RTN","VPRHS",73,0)
NEW(DFN,ICN) ; -- post a new patient to ^VPR("ANEW",seq#,DFN) = ICN
"RTN","VPRHS",74,0)
 Q:$G(DFN)<1  I $G(ICN)<1 S ICN=$$GETICN^MPIF001(DFN) Q:ICN<0
"RTN","VPRHS",75,0)
 N SEQ S SEQ=$I(^VPR(1,1))
"RTN","VPRHS",76,0)
 S ^VPR("ANEW",SEQ,DFN)=ICN
"RTN","VPRHS",77,0)
 Q
"RTN","VPRHS",78,0)
 ;
"RTN","VPRHS",79,0)
GET(DFN,NAME,ID,VPRQ,MTYPE,VPRY,VPRR) ; -- return VistA data in @VPRY@(#)
"RTN","VPRHS",80,0)
 N ICN,VPRNM,VPRFN,VPRE,VPRI,VPRN,VPRX,VPRMAX
"RTN","VPRHS",81,0)
 S DFN=$G(DFN),ICN=$P(DFN,";",2),DFN=+DFN
"RTN","VPRHS",82,0)
 Q:DFN<1  Q:'$D(^DPT(DFN))  S VPRQ("patient")=DFN
"RTN","VPRHS",83,0)
 ;
"RTN","VPRHS",84,0)
 S VPRNM=$G(NAME)  Q:VPRNM=""
"RTN","VPRHS",85,0)
 S ID=$G(ID),MTYPE=$G(MTYPE,1) ;XML
"RTN","VPRHS",86,0)
 I $G(VPRQ("max")) S VPRMAX=VPRQ("max")
"RTN","VPRHS",87,0)
 ;
"RTN","VPRHS",88,0)
 S VPRY=$G(VPRY,$NA(^TMP("VPR GET",$J))),VPRI=0 K @VPRY
"RTN","VPRHS",89,0)
 S VPRR=$G(VPRR,$NA(^TMP("VPR ERR",$J))) K @VPRR
"RTN","VPRHS",90,0)
 I VPRNM="Patient",'ID&DFN S ID=DFN_";2"
"RTN","VPRHS",91,0)
 ;
"RTN","VPRHS",92,0)
 ; update one record for ECR
"RTN","VPRHS",93,0)
 I ID'="" D  Q
"RTN","VPRHS",94,0)
 . S VPRFN=$P(ID,";",2),ID=$P(ID,";")
"RTN","VPRHS",95,0)
 . S VPRE=$O(^DDE("SDA",VPRNM,VPRFN,0)) Q:'VPRE  ;ERROR?
"RTN","VPRHS",96,0)
 . S VPRI=VPRI+1,@VPRY@(VPRI)=$$GET1^DDE(VPRE,ID,.VPRQ,MTYPE,.VPRR)
"RTN","VPRHS",97,0)
 ;
"RTN","VPRHS",98,0)
 ; pre-load of whole container for patient
"RTN","VPRHS",99,0)
 S VPRX=$NA(^TMP("VPRHS",$J))
"RTN","VPRHS",100,0)
 S VPRFN=0 F  S VPRFN=$O(^DDE("SDA",VPRNM,VPRFN)) Q:VPRFN<1  D
"RTN","VPRHS",101,0)
 . S VPRE=$O(^DDE("SDA",VPRNM,VPRFN,0)) K @VPRX
"RTN","VPRHS",102,0)
 . D:VPRE GET^DDE(VPRE,,.VPRQ,MTYPE,.VPRMAX,.VPRX,.VPRR)
"RTN","VPRHS",103,0)
 . Q:'$D(VPRX)  Q:+$G(@VPRX@(0))'>0
"RTN","VPRHS",104,0)
 . S VPRN=0 F  S VPRN=$O(@VPRX@(VPRN)) Q:VPRN<1  S VPRI=VPRI+1,@VPRY@(VPRI)=@VPRX@(VPRN)
"RTN","VPRHS",105,0)
 K @VPRX
"RTN","VPRHS",106,0)
 Q
"RTN","VPRHS",107,0)
 ;
"RTN","VPRHS",108,0)
ACTIVE ; -- find currently non-deceased, active patients
"RTN","VPRHS",109,0)
 N DFN S DFN=0
"RTN","VPRHS",110,0)
 F  S DFN=$O(^DPT(DFN)) Q:DFN<1  I '$G(^DPT(DFN,.35)) D
"RTN","VPRHS",111,0)
 . I $G(^DPT(DFN,.105)) D POST(DFN,"*") Q
"RTN","VPRHS",112,0)
 . I $O(^DPT(DFN,"S",DT)) D POST(DFN,"*")
"RTN","VPRHS",113,0)
 Q
"RTN","VPRHS",114,0)
 ;
"RTN","VPRHS",115,0)
APPTS(BEG,END,VPRY) ; -- return patients w/appointments
"RTN","VPRHS",116,0)
 N VPRX,VPRN,DFN,VPRDT,VPRI,VPRA
"RTN","VPRHS",117,0)
 S VPRY=$G(VPRY,$NA(^TMP("VPR PATS",$J))) K @VPRY
"RTN","VPRHS",118,0)
 I '$G(BEG) D   ;default = tomorrow, if not passed in
"RTN","VPRHS",119,0)
 . S BEG=$$FMADD^XLFDT(DT,1),END=BEG
"RTN","VPRHS",120,0)
 ; find patients with appointments
"RTN","VPRHS",121,0)
 S END=$G(END,BEG),VPRX(1)=BEG_";"_END
"RTN","VPRHS",122,0)
 S VPRX("SORT")="P",VPRX("FLDS")=1,VPRX(3)="R;I;NT"
"RTN","VPRHS",123,0)
 S VPRI=$$SDAPI^SDAMA301(.VPRX),VPRN=0 K VPRX
"RTN","VPRHS",124,0)
 S DFN=0 F  S DFN=$O(^TMP($J,"SDAMA301",DFN)) Q:DFN<1  S VPRX(DFN)=""
"RTN","VPRHS",125,0)
 ; find patients scheduled for admission
"RTN","VPRHS",126,0)
 S VPRDT=0 F  S VPRDT=$O(^DGS(41.1,"C",VPRDT)) Q:VPRDT<1!(VPRDT>END)  D
"RTN","VPRHS",127,0)
 . S VPRI=0 F  S VPRI=$O(^DGS(41.1,"C",VPRDT,VPRI)) Q:VPRI<1  D
"RTN","VPRHS",128,0)
 .. S VPRA=$G(^DGS(41.1,VPRI))
"RTN","VPRHS",129,0)
 .. Q:$P(VPRA,U,13)  Q:$P(VPRA,U,17)  ;cancelled or admitted
"RTN","VPRHS",130,0)
 .. S DFN=+VPRA S:DFN VPRX(DFN)=""
"RTN","VPRHS",131,0)
 ; build return array
"RTN","VPRHS",132,0)
 S (DFN,VPRN)=0
"RTN","VPRHS",133,0)
 F  S DFN=$O(VPRX(DFN)) Q:DFN<1  S VPRN=VPRN+1,@VPRY@(VPRN)=DFN
"RTN","VPRHS",134,0)
 S @VPRY@(0)=VPRN
"RTN","VPRHS",135,0)
 K ^TMP($J,"SDAMA301")
"RTN","VPRHS",136,0)
 Q
"RTN","VPRHS",137,0)
 ;
"RTN","VPRHS",138,0)
INPTS(VPRY) ; -- return current inpatients
"RTN","VPRHS",139,0)
 N DGPM,DFN,VPRN
"RTN","VPRHS",140,0)
 S VPRY=$G(VPRY,$NA(^TMP("VPR PATS",$J))),VPRN=0 K @VPRY
"RTN","VPRHS",141,0)
 S DGPM=0 F  S DGPM=$O(^DPT("ACA",DGPM)) Q:DGPM<1  D
"RTN","VPRHS",142,0)
 . S DFN=0 F  S DFN=$O(^DPT("ACA",DGPM,DFN)) Q:DFN<1  S VPRN=VPRN+1,@VPRY@(VPRN)=DFN
"RTN","VPRHS",143,0)
 S @VPRY@(0)=VPRN
"RTN","VPRHS",144,0)
 Q
"RTN","VPRP10")
0^9^B1260403^n/a
"RTN","VPRP10",1,0)
VPRP10 ;SLC/MKB -- SDA updates for patch 10 ;3/14/19  20:13
"RTN","VPRP10",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**10**;Sep 01, 2011;Build 16
"RTN","VPRP10",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","VPRP10",4,0)
 ;
"RTN","VPRP10",5,0)
 ; External References          DBIA#
"RTN","VPRP10",6,0)
 ; -------------------          -----
"RTN","VPRP10",7,0)
 ; XUSAP                         4677
"RTN","VPRP10",8,0)
 ;
"RTN","VPRP10",9,0)
 ;
"RTN","VPRP10",10,0)
POST ; -- postinit tasks
"RTN","VPRP10",11,0)
 D LRAP
"RTN","VPRP10",12,0)
 ;D PRXY
"RTN","VPRP10",13,0)
 Q
"RTN","VPRP10",14,0)
 ;
"RTN","VPRP10",15,0)
LRAP ; -- switch protocol items
"RTN","VPRP10",16,0)
 N DA,DR,DIE,XQOR,LRAP
"RTN","VPRP10",17,0)
 S DA(1)=+$O(^ORD(101,"B","LR7O AP EVSEND OR",0)) Q:DA(1)<1
"RTN","VPRP10",18,0)
 S XQOR=+$O(^ORD(101,"B","VPR XQOR EVENTS",0))
"RTN","VPRP10",19,0)
 S LRAP=+$O(^ORD(101,"B","VPR LRAP EVENTS",0))
"RTN","VPRP10",20,0)
 S DA=$O(^ORD(101,"AD",LRAP,DA(1),0)) I DA D
"RTN","VPRP10",21,0)
 . S DR=".01////"_XQOR,DIE="^ORD(101,"_DA(1)_",10,"
"RTN","VPRP10",22,0)
 . D ^DIE
"RTN","VPRP10",23,0)
 Q
"RTN","VPRP10",24,0)
 ;
"RTN","VPRP10",25,0)
PRXY ; -- create proxy user
"RTN","VPRP10",26,0)
 I '$O(^VA(200,"B","VDIF,APPLICATION PROXY",0)) D
"RTN","VPRP10",27,0)
 . N X S X=$$CREATE^XUSAP("VDIF,APPLICATION PROXY","")
"RTN","VPRP10",28,0)
 Q
"RTN","VPRSDA")
0^1^B238403489^B175529612
"RTN","VPRSDA",1,0)
VPRSDA ;SLC/MKB -- SDA utilities ;10/25/18  15:29
"RTN","VPRSDA",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRSDA",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","VPRSDA",4,0)
 ;
"RTN","VPRSDA",5,0)
 ; External References          DBIA#
"RTN","VPRSDA",6,0)
 ; -------------------          -----
"RTN","VPRSDA",7,0)
 ; ^AUPNPROB                     5703
"RTN","VPRSDA",8,0)
 ; ^AUPNVSIT                     2028
"RTN","VPRSDA",9,0)
 ; ^DDE                          7008
"RTN","VPRSDA",10,0)
 ; ^DGPM                         1865
"RTN","VPRSDA",11,0)
 ; ^DIC(42                      10039
"RTN","VPRSDA",12,0)
 ; ^DPT                         10035
"RTN","VPRSDA",13,0)
 ; ^LAB(60                      10054
"RTN","VPRSDA",14,0)
 ; ^LR                            525
"RTN","VPRSDA",15,0)
 ; ^OR(100                       5771
"RTN","VPRSDA",16,0)
 ; ^ORD(100.98                   6982
"RTN","VPRSDA",17,0)
 ; ^ORD(101.43                   2843
"RTN","VPRSDA",18,0)
 ; ^SC                          10040
"RTN","VPRSDA",19,0)
 ; ^SCE("AVSIT"                  2045
"RTN","VPRSDA",20,0)
 ; ^SRF                          5675
"RTN","VPRSDA",21,0)
 ; ^TIU(8925.1                   5677
"RTN","VPRSDA",22,0)
 ; %DT                          10003
"RTN","VPRSDA",23,0)
 ; DILFD                         2055
"RTN","VPRSDA",24,0)
 ; DIQ                           2056
"RTN","VPRSDA",25,0)
 ; ETSLNC                        6731
"RTN","VPRSDA",26,0)
 ; ETSRXN                        6758
"RTN","VPRSDA",27,0)
 ; GMRCGUIB                      2980
"RTN","VPRSDA",28,0)
 ; GMRVUT0, ^UTILITY($J          1446
"RTN","VPRSDA",29,0)
 ; GMVGETVT                      5047
"RTN","VPRSDA",30,0)
 ; GMVUTL                        5046
"RTN","VPRSDA",31,0)
 ; ICDEX                         5747
"RTN","VPRSDA",32,0)
 ; LEXTRAN                       4912
"RTN","VPRSDA",33,0)
 ; LR7OSUM, ^TMP("LR"*,$J        2766
"RTN","VPRSDA",34,0)
 ; LR7OU1                        2955
"RTN","VPRSDA",35,0)
 ; LRPXAPIU                      4246
"RTN","VPRSDA",36,0)
 ; ORX8                          3071
"RTN","VPRSDA",37,0)
 ; PXAPI, ^TMP("PXKENC",$J       1894
"RTN","VPRSDA",38,0)
 ; RMIMRP                        4745
"RTN","VPRSDA",39,0)
 ; SCAPMC                        1916
"RTN","VPRSDA",40,0)
 ; SDAMA301, ^TMP($J             4433
"RTN","VPRSDA",41,0)
 ; SDOE                          2546
"RTN","VPRSDA",42,0)
 ; SDUTL3                        1252
"RTN","VPRSDA",43,0)
 ; TIULQ                         2693
"RTN","VPRSDA",44,0)
 ; VADPT                        10061
"RTN","VPRSDA",45,0)
 ; XLFNAME                       3065
"RTN","VPRSDA",46,0)
 ;
"RTN","VPRSDA",47,0)
INTDATE(X) ; -- Return internal form of date X
"RTN","VPRSDA",48,0)
 N %DT,Y
"RTN","VPRSDA",49,0)
 S %DT="TSX" D ^%DT
"RTN","VPRSDA",50,0)
 Q Y
"RTN","VPRSDA",51,0)
 ;
"RTN","VPRSDA",52,0)
DATE(X,DTO) ; -- return FM date X as SDA date
"RTN","VPRSDA",53,0)
 N D,T,Y
"RTN","VPRSDA",54,0)
 S X=$G(X) I X'?7N.1".".7N Q ""
"RTN","VPRSDA",55,0)
 ; convert to SDA format
"RTN","VPRSDA",56,0)
 S X=$$IMPREC(X),D=$P(X,"."),T=$P(X,".",2)
"RTN","VPRSDA",57,0)
 S Y=(1700+$E(D,1,3))_"-"_$E(D,4,5)_"-"_$E(D,6,7)
"RTN","VPRSDA",58,0)
 I $G(DTO) Q Y  ;date only
"RTN","VPRSDA",59,0)
 ; validate T = time
"RTN","VPRSDA",60,0)
 I T=24 S T=235959 ;for SDA
"RTN","VPRSDA",61,0)
 S:$L(T)<6 T=$E((T_"000000"),1,6)  ;pad the time to 6 digits
"RTN","VPRSDA",62,0)
 I $E(T,1,2)>23 S T="000000"       ;invalid hours >> remove time
"RTN","VPRSDA",63,0)
 I $E(T,3,4)>59 S $E(T,3,6)="0000" ;strip invalid minutes/seconds
"RTN","VPRSDA",64,0)
 I $E(T,5,6)>59 S $E(T,5,6)="00"   ;strip invalid seconds
"RTN","VPRSDA",65,0)
 S Y=Y_"T"_$E(T,1,2)_":"_$E(T,3,4)_":"_$E(T,5,6)
"RTN","VPRSDA",66,0)
 ; time zone?
"RTN","VPRSDA",67,0)
 Q Y
"RTN","VPRSDA",68,0)
 ;
"RTN","VPRSDA",69,0)
IMPREC(X) ; -- if X is imprecise, make actual date
"RTN","VPRSDA",70,0)
 N Y S Y=$E(X,1,3)
"RTN","VPRSDA",71,0)
 S Y=Y_$S($E(X,4,5)="00":"01",1:$E(X,4,5))
"RTN","VPRSDA",72,0)
 S Y=Y_$S($E(X,6,7)="00":"01",1:$E(X,6,7))
"RTN","VPRSDA",73,0)
 I X["." S Y=Y_"."_$P(X,".",2)
"RTN","VPRSDA",74,0)
 Q Y
"RTN","VPRSDA",75,0)
 ;
"RTN","VPRSDA",76,0)
NAMECOMP(NAME) ; -- return name as string of component pieces
"RTN","VPRSDA",77,0)
 ; NAME -> FAMILY^GIVEN^MIDDLE^SUFFIX
"RTN","VPRSDA",78,0)
 D NAMECOMP^XLFNAME(.NAME)
"RTN","VPRSDA",79,0)
 N I,Y S Y=$G(NAME("FAMILY"))
"RTN","VPRSDA",80,0)
 F I="GIVEN","MIDDLE","SUFFIX" S Y=Y_U_$G(NAME(I))
"RTN","VPRSDA",81,0)
 Q Y
"RTN","VPRSDA",82,0)
 ;
"RTN","VPRSDA",83,0)
WP(ORIFN,ID) ; -- return a WP value from an order response as a string
"RTN","VPRSDA",84,0)
 N DA,I,X,Y S Y=""
"RTN","VPRSDA",85,0)
 S DA=+$O(^OR(100,+$G(ORIFN),4.5,"ID",ID,0))
"RTN","VPRSDA",86,0)
 S I=0 F  S I=$O(^OR(100,+$G(ORIFN),4.5,DA,2,I)) Q:'I  S X=$G(^(I,0)) D
"RTN","VPRSDA",87,0)
 . I '$L(Y) Q:(X="")!(X?1." ")  S Y=X Q
"RTN","VPRSDA",88,0)
 . I $E(X)=" " S Y=Y_$C(13,10)_X Q
"RTN","VPRSDA",89,0)
 . S Y=Y_$S($E(Y,$L(Y))=" ":"",1:" ")_X
"RTN","VPRSDA",90,0)
 Q Y
"RTN","VPRSDA",91,0)
 ;
"RTN","VPRSDA",92,0)
CODED ; -- ck Code Table ID for internal^external format
"RTN","VPRSDA",93,0)
 Q:$G(ID)=""  Q:$L(ID,"^")>1  ;ok
"RTN","VPRSDA",94,0)
 N X,NM S NM=ID
"RTN","VPRSDA",95,0)
 I $G(FILE),$G(FIELD) D
"RTN","VPRSDA",96,0)
 . S X=$$EXTERNAL^DILFD(FILE,FIELD,,ID)
"RTN","VPRSDA",97,0)
 . S:X'="" NM=X
"RTN","VPRSDA",98,0)
 S ID=ID_U_NM
"RTN","VPRSDA",99,0)
 Q
"RTN","VPRSDA",100,0)
 ;
"RTN","VPRSDA",101,0)
CODE(IEN,FILE,CSYS) ; -- find CSYS code for IEN in FILE
"RTN","VPRSDA",102,0)
 ; CSYS can be string of abbreviations to look for, in order
"RTN","VPRSDA",103,0)
 N FLD,VPRC,SFN,S,SYS,NAMES,IENS,SFN1,I,X,Y S Y=""
"RTN","VPRSDA",104,0)
 S FLD=$$FLDNUM^DILFD(FILE,"CODING SYSTEM") Q:'FLD ""
"RTN","VPRSDA",105,0)
 D GETS^DIQ(FILE,IEN_",",FLD_"*","NR","VPRC")
"RTN","VPRSDA",106,0)
 S SFN=+$O(VPRC(0)) Q:'SFN ""  ;Sub-file# = Coding System multiple
"RTN","VPRSDA",107,0)
 F S=1:1 S SYS=$P(CSYS,U,S) Q:SYS=""  D  Q:$L(Y)
"RTN","VPRSDA",108,0)
 . S NAMES=$S(SYS="RXN":"RxNorm^RXNORM",SYS="NDF":"NDF-RT^NDFRT^NDF",SYS="SCT":"SNOMED CT^SNOMED-CT^SCT",SYS="LNC":"LOINC^LNC",SYS="UNI":"UNII^UNI",1:SYS)
"RTN","VPRSDA",109,0)
 . S IENS="" F  S IENS=$O(VPRC(SFN,IENS)) Q:IENS=""  D  Q:$L(Y)
"RTN","VPRSDA",110,0)
 .. S X=$G(VPRC(SFN,IENS,"CODING SYSTEM")) Q:X=""  Q:NAMES'[X
"RTN","VPRSDA",111,0)
 .. S SFN1=$O(VPRC(SFN)),I=$O(VPRC(SFN1,""))
"RTN","VPRSDA",112,0)
 .. S:I Y=$G(VPRC(SFN1,I,"CODE")) ;first code for system
"RTN","VPRSDA",113,0)
 . I $L(Y) S Y=Y_U_$$DESC(Y)_U_$P(NAMES,U)
"RTN","VPRSDA",114,0)
 Q Y
"RTN","VPRSDA",115,0)
 ;
"RTN","VPRSDA",116,0)
DESC(CODE) ; -- called from CODE, to return coding system text
"RTN","VPRSDA",117,0)
 ; Expects all the variables used in CODE()
"RTN","VPRSDA",118,0)
 N X,Y,LEX S Y=""
"RTN","VPRSDA",119,0)
 I SYS="SCT" D
"RTN","VPRSDA",120,0)
 . S X=$$CODE^LEXTRAN(CODE,"SCT",DT)
"RTN","VPRSDA",121,0)
 . S:X>0 Y=$G(LEX("P")) ;preferred term
"RTN","VPRSDA",122,0)
 I SYS="RXN",$L($T(CSDATA^ETSRXN)) D
"RTN","VPRSDA",123,0)
 . S X=$$CSDATA^ETSRXN(CODE,"RXN",DT,.LEX)
"RTN","VPRSDA",124,0)
 . S:X>0 Y=$P($G(LEX("LEX",1)),U,2)
"RTN","VPRSDA",125,0)
 I SYS="LNC",$L($T(GETNAME^ETSLNC)) D
"RTN","VPRSDA",126,0)
 . S X=$$GETNAME^ETSLNC(CODE,"C",.LEX)
"RTN","VPRSDA",127,0)
 . S:X>0 Y=$G(LEX("LONGNAME"))
"RTN","VPRSDA",128,0)
 I '$L($G(Y)) S Y=$$GET1^DIQ(FILE,IEN_",",.01)
"RTN","VPRSDA",129,0)
 Q Y
"RTN","VPRSDA",130,0)
 ;
"RTN","VPRSDA",131,0)
CONSNAME(IEN) ; -- return full display name using fields
"RTN","VPRSDA",132,0)
 ; To Service (#1) & Procedure/Request Type (#4)
"RTN","VPRSDA",133,0)
 N X,Y S X=$G(VPRCONS(0))
"RTN","VPRSDA",134,0)
 S Y=$P(X,U,5)
"RTN","VPRSDA",135,0)
 I $L($P(X,U,8)) S Y=Y_" "_$P(X,U,8)_" Proc"
"RTN","VPRSDA",136,0)
 E  S Y=Y_" Cons"
"RTN","VPRSDA",137,0)
 Q Y
"RTN","VPRSDA",138,0)
 ;
"RTN","VPRSDA",139,0)
PROVDX(IEN) ; -- return full Consult ProvDx string, or null
"RTN","VPRSDA",140,0)
 N X,Y,VPRDX S X=$G(VPRCONS(30.1)),Y=""
"RTN","VPRSDA",141,0)
 I $L(X,U)<3 S DDEOUT=1 Q ""
"RTN","VPRSDA",142,0)
 I $E(X)=U S DDEOUT=1 Q ""
"RTN","VPRSDA",143,0)
 S:$P(X,U,2)="" $P(X,U,2)=DT
"RTN","VPRSDA",144,0)
 S:$P(X,U,3)="" $P(X,U,3)="ICD"
"RTN","VPRSDA",145,0)
 I $$ICDD^ICDEX($P(X,U),.VPRDX,$P(X,U,2),$P(X,U,3))>0 D
"RTN","VPRSDA",146,0)
 . S Y=$P(X,U)_U_VPRDX(1)_U_$$SNAM^ICDEX($$SYS^ICDEX($P(X,U,3)))
"RTN","VPRSDA",147,0)
 Q Y
"RTN","VPRSDA",148,0)
 ;
"RTN","VPRSDA",149,0)
PROBCMT(IEN) ; -- return list of comments in
"RTN","VPRSDA",150,0)
 ; DLIST(#) = id ^ date ^ user ^ type ^ facility ^ text
"RTN","VPRSDA",151,0)
 N I,J,N,X,FAC S N=0
"RTN","VPRSDA",152,0)
 S I=0 F  S I=$O(^AUPNPROB(IEN,11,I)) Q:I<1  S FAC=$G(^(I,0)) D
"RTN","VPRSDA",153,0)
 . S J=0 F  S J=$O(^AUPNPROB(IEN,11,I,11,J)) Q:J<1  S X=$G(^(J,0)) D
"RTN","VPRSDA",154,0)
 .. Q:$P(X,U,4)'="A"
"RTN","VPRSDA",155,0)
 .. S Y=$P(X,U,5)_U_$P(X,U,6)_U_U_FAC_U_$P(X,U,3)
"RTN","VPRSDA",156,0)
 .. S N=N+1,DLIST(N)=J_","_I_","_IEN_U_Y
"RTN","VPRSDA",157,0)
 Q
"RTN","VPRSDA",158,0)
 ;
"RTN","VPRSDA",159,0)
SCTTEXT(CODE,IEN) ; -- get Preferred Text for SCT Code
"RTN","VPRSDA",160,0)
 N Y,GMPDT,LEX,LEXY S Y=""
"RTN","VPRSDA",161,0)
 S GMPDT=$P($G(^AUPNPROB(IEN,0)),U,8) S:'GMPDT GMPDT=DT
"RTN","VPRSDA",162,0)
 S LEXY=$$CODE^LEXTRAN(CODE,"SCT",GMPDT)
"RTN","VPRSDA",163,0)
 S:LEXY>0 Y=$G(LEX("P")) ;preferred term
"RTN","VPRSDA",164,0)
 Q Y
"RTN","VPRSDA",165,0)
 ;
"RTN","VPRSDA",166,0)
POVNARR() ; -- build Original Text for POV
"RTN","VPRSDA",167,0)
 N NARR,MOD,Y S Y=""
"RTN","VPRSDA",168,0)
 S NARR=$G(VPRPOV("PROVIDER NARRATIVE")),MOD=$G(VPRPOV("MODIFIER"))
"RTN","VPRSDA",169,0)
 S:NARR Y=$$GET1^DIQ(9999999.27,NARR_",",.01)
"RTN","VPRSDA",170,0)
 I $L(MOD),$L(Y) S Y=$$EXTERNAL^DILFD(9000010.07,.06,,MOD)_" "_Y
"RTN","VPRSDA",171,0)
 Q Y
"RTN","VPRSDA",172,0)
 ;
"RTN","VPRSDA",173,0)
AD(ID) ; -- get info for one Adv Directive
"RTN","VPRSDA",174,0)
 K VPRTIU S ID=$G(ID)
"RTN","VPRSDA",175,0)
 D EXTRACT^TIULQ(+ID,"VPRTIU",,".01:.05;1201;1212;1301;1302",,1,"I")
"RTN","VPRSDA",176,0)
 S:'DFN DFN=+$G(VPRTIU(+ID,.02,"I"))
"RTN","VPRSDA",177,0)
 I DFN,'$D(^TMP("TIUPPCV",$J)) D  ;one, do query
"RTN","VPRSDA",178,0)
 . N DLIST,I,X
"RTN","VPRSDA",179,0)
 . D ADVDIR^VPRSDAQ
"RTN","VPRSDA",180,0)
 . S I=0 F  S I=$O(DLIST(I)) Q:I<1  S X=$G(DLIST(I)) I +X=+ID S ID=X Q
"RTN","VPRSDA",181,0)
 S VPRADV=ID,ID=+ID
"RTN","VPRSDA",182,0)
 Q
"RTN","VPRSDA",183,0)
 ;
"RTN","VPRSDA",184,0)
TIULNC(IEN) ; -- convert 8925.1 IEN to 8926.1 IEN
"RTN","VPRSDA",185,0)
 ;  Returns   DATA = code ^ [description] ^ system
"RTN","VPRSDA",186,0)
 ;          TIUTTL = local title name
"RTN","VPRSDA",187,0)
 N TIUNATL S IEN=+$G(IEN),DATA=""
"RTN","VPRSDA",188,0)
 ; VPRNATL set in VPR DOCUMENT EXTENSION
"RTN","VPRSDA",189,0)
 S TIUNATL=$S($G(VPRNATL):VPRNATL,1:+$G(^TIU(8925.1,IEN,15)))
"RTN","VPRSDA",190,0)
 S TIUTTL=$P($G(^TIU(8925.1,IEN,0)),U)
"RTN","VPRSDA",191,0)
 ; if no national mapping, return local title
"RTN","VPRSDA",192,0)
 I 'TIUNATL D  Q
"RTN","VPRSDA",193,0)
 . I $P(TIUTTL," ")="LR" D  Q:$L(DATA)
"RTN","VPRSDA",194,0)
 .. N TTL S TTL=$E($P(TIUTTL," ",2),1,2)
"RTN","VPRSDA",195,0)
 .. S DATA=$S(TTL="AU":"18743-5^AUTOPSY REPORT",TTL="CY":"26438-2^CYTOLOGY STUDIES",TTL="EL":"50668-3^MICROSCOPY STUDIES",TTL="SU":"27898-6^PATHOLOGY STUDIES",1:"")
"RTN","VPRSDA",196,0)
 .. I $L(DATA) S DATA=DATA_"^LOINC" Q
"RTN","VPRSDA",197,0)
 . S DATA=IEN_U_TIUTTL_"^VA8925.1"
"RTN","VPRSDA",198,0)
 ; get LOINC or VUID
"RTN","VPRSDA",199,0)
 S IEN=TIUNATL,DATA=$$CODE(IEN,8926.1,"LNC")
"RTN","VPRSDA",200,0)
 I DATA="" S DATA=$$VUID^VPRD(IEN,8926.1) S:DATA DATA=DATA_"^^VHAT"
"RTN","VPRSDA",201,0)
 ; else default = 8926.1 ien as per usual
"RTN","VPRSDA",202,0)
 Q
"RTN","VPRSDA",203,0)
 ;
"RTN","VPRSDA",204,0)
TIUTYPE(IEN) ; -- return code^name for document type/class
"RTN","VPRSDA",205,0)
 N X,Y S Y=""
"RTN","VPRSDA",206,0)
 S X=$$CATG^VPRDTIU(IEN) I X="PN" D
"RTN","VPRSDA",207,0)
 . N NATL,SVC
"RTN","VPRSDA",208,0)
 . S NATL=+$G(^TIU(8925.1,+$G(IEN),15)) Q:'NATL
"RTN","VPRSDA",209,0)
 . S SVC=$$GET1^DIQ(8926.1,NATL_",",.07) Q:SVC=""
"RTN","VPRSDA",210,0)
 . I SVC["HISTORY & PHYSICAL"!(SVC["HISTORY AND PHYSICAL") S Y="HP^History & Physical" Q
"RTN","VPRSDA",211,0)
 . I SVC["COMPENSATION & PENSION" S Y="CM^Compensation & Pension" Q
"RTN","VPRSDA",212,0)
 S:'$L(Y) Y=X_U_$$TYPE^VPRDJ08(X)
"RTN","VPRSDA",213,0)
 Q Y
"RTN","VPRSDA",214,0)
 ;
"RTN","VPRSDA",215,0)
TIUSIG() ; -- return date of authorization
"RTN","VPRSDA",216,0)
 N Y S Y=""
"RTN","VPRSDA",217,0)
 I $G(VPRTIU(DIEN,1501,"I")) S Y=VPRTIU(DIEN,1501,"I") ;Signed
"RTN","VPRSDA",218,0)
 I $G(VPRTIU(DIEN,1507,"I")) S Y=VPRTIU(DIEN,1507,"I") ;Co-signed
"RTN","VPRSDA",219,0)
 I $G(VPRTIU(DIEN,1606,"I")) S Y=VPRTIU(DIEN,1606,"I") ;Admin Closure
"RTN","VPRSDA",220,0)
 Q Y
"RTN","VPRSDA",221,0)
 ;
"RTN","VPRSDA",222,0)
TIUCOMP(IEN,STS) ; -- return 1 or 0, if document is complete
"RTN","VPRSDA",223,0)
 S IEN=+$G(IEN) I IEN<1 Q ""
"RTN","VPRSDA",224,0)
 S STS=+$G(STS) I STS<1 D
"RTN","VPRSDA",225,0)
 . N VPRTIU D EXTRACT^TIULQ(IEN,"VPRTIU",,.05,,,"I")
"RTN","VPRSDA",226,0)
 . S STS=+$G(VPRTIU(IEN,.05,"I"))
"RTN","VPRSDA",227,0)
 N Y S Y=$S(STS=7:1,STS=8:1,1:0)
"RTN","VPRSDA",228,0)
 Q Y
"RTN","VPRSDA",229,0)
 ;
"RTN","VPRSDA",230,0)
LRTIU(IDT,SUB) ; -- return TIU ien of lab report
"RTN","VPRSDA",231,0)
 N I,IEN,X,Y S IDT=$G(IDT),SUB=$G(SUB)
"RTN","VPRSDA",232,0)
 S Y=IDT_";"_SUB
"RTN","VPRSDA",233,0)
 S I=0 F  S I=$O(^LR(LRDFN,SUB,IDT,.05,I)) Q:I<1  S IEN=+$P($G(^(I,0)),U,2),X=+$$GET1^DIQ(8925,IEN,.05,"I") I (X=7)!(X=8) S Y=IEN_";TIU" Q
"RTN","VPRSDA",234,0)
 Q Y
"RTN","VPRSDA",235,0)
 ;
"RTN","VPRSDA",236,0)
LRAP1(ID) ; -- parse ID for AP,MI report
"RTN","VPRSDA",237,0)
 ; Returns DIFN, VPRSUB, updated ID, LR0=^LR(LRDFN,SUB,IDT,0)
"RTN","VPRSDA",238,0)
 S ID=$G(ID),VPRSUB=$P(ID,"~",2),ID=$P(ID,"~")
"RTN","VPRSDA",239,0)
 I VPRSUB D  ;sub-file#
"RTN","VPRSDA",240,0)
 . S DIFN=VPRSUB,VPRSUB=$S(DIFN=63.05:"MI",DIFN=63.09:"CY",DIFN=63.02:"EM",DIFN=63.08:"SP",1:"AP")
"RTN","VPRSDA",241,0)
 E  S DIFN=$S(VPRSUB="MI":63.05,VPRSUB="CY":63.09,VPRSUB="EM":63.02,VPRSUB="SP":63.08,1:0)
"RTN","VPRSDA",242,0)
 I DIFN<1 S DDEOUT=1 Q
"RTN","VPRSDA",243,0)
 S:'$G(LRDFN) LRDFN=+$P(ID,",",2)
"RTN","VPRSDA",244,0)
 S LR0=$G(^LR(LRDFN,VPRSUB,+ID,0))
"RTN","VPRSDA",245,0)
 Q
"RTN","VPRSDA",246,0)
 ;
"RTN","VPRSDA",247,0)
LRPT(SUB,IDT) ; -- return report text in WP(), expects DFN
"RTN","VPRSDA",248,0)
 N I,DATE,NAME,VPRS,VPRY,X,LRAU
"RTN","VPRSDA",249,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J),^TMP("LRT",$J)
"RTN","VPRSDA",250,0)
 S DATE=9999999-+$G(IDT),NAME=$S(SUB="EM":"EM",1:$$NAME^VPRDLRA(SUB)),VPRS(NAME)=""
"RTN","VPRSDA",251,0)
 D EN^LR7OSUM(.VPRY,DFN,DATE,DATE,,,.VPRS)
"RTN","VPRSDA",252,0)
 S I=+$G(^TMP("LRH",$J,NAME)) ;LRH=header
"RTN","VPRSDA",253,0)
 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=$G(^(I,0)) Q:X?1."="  S WP(I)=X
"RTN","VPRSDA",254,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J),^TMP("LRT",$J)
"RTN","VPRSDA",255,0)
 Q
"RTN","VPRSDA",256,0)
 ;
"RTN","VPRSDA",257,0)
LRSLT ; -- get Entity for LabOrder Result
"RTN","VPRSDA",258,0)
 ; Returns ENTITY, VPRSUB, DATA
"RTN","VPRSDA",259,0)
 S:'$D(ORPK) ORPK=$$PKGID^ORX8(DIEN)
"RTN","VPRSDA",260,0)
 I $L(ORPK,";")<5 S DDEOUT=1 Q  ;no results yet
"RTN","VPRSDA",261,0)
 S VPRSUB=$P(ORPK,";",4),VALUE=$P(ORPK,";",5)_","_+$G(LRDFN)
"RTN","VPRSDA",262,0)
 S ENTITY="VPR LR"_VPRSUB_" RESULT"
"RTN","VPRSDA",263,0)
 S ENTITY=+$O(^DDE("B",ENTITY,0)) I ENTITY<1 S DDEOUT=1 Q
"RTN","VPRSDA",264,0)
 S DATA=+$P($G(ORIT),U,3) ;#60 ien ordered
"RTN","VPRSDA",265,0)
 Q
"RTN","VPRSDA",266,0)
 ;
"RTN","VPRSDA",267,0)
LRDFN(ORIFN) ; -- set up LRDFN for Lab Order
"RTN","VPRSDA",268,0)
 I 'DFN,$G(ORIFN) S DFN=+$$GET1^DIQ(100,+ORIFN_",",.02,"I")
"RTN","VPRSDA",269,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN)
"RTN","VPRSDA",270,0)
 Q
"RTN","VPRSDA",271,0)
 ;
"RTN","VPRSDA",272,0)
LRCH(TEST) ; -- builds DLIST(#) of result nodes for TEST
"RTN","VPRSDA",273,0)
 ; called from ResultItems in VPR LRCH RESULT, expects DIEN
"RTN","VPRSDA",274,0)
 N T,X S TEST=+$G(TEST)
"RTN","VPRSDA",275,0)
 D EXPAND^LR7OU1(TEST,.DLIST)
"RTN","VPRSDA",276,0)
 S T=0 F  S T=$O(DLIST(T)) Q:T<1  D
"RTN","VPRSDA",277,0)
 . S X=$P($G(^LAB(60,T,0)),U,3) I X'="O",X'="B" Q  ;not displayable
"RTN","VPRSDA",278,0)
 . ; DLIST(60 ien) = CH data node#,LRIDT,LRDFN
"RTN","VPRSDA",279,0)
 . S DLIST(T)=$$LRDN^LRPXAPIU(T)_","_DIEN
"RTN","VPRSDA",280,0)
 Q
"RTN","VPRSDA",281,0)
 ;
"RTN","VPRSDA",282,0)
ORDG(DG) ; -- return ien^name^VA100.98 for a DG abbreviation
"RTN","VPRSDA",283,0)
 N X,Y S X=$O(^ORD(100.98,"B",DG,0)),Y=""
"RTN","VPRSDA",284,0)
 S:X Y=X_U_$P(^ORD(100.98,X,0),U)_"^VA100.98"
"RTN","VPRSDA",285,0)
 Q Y
"RTN","VPRSDA",286,0)
 ;
"RTN","VPRSDA",287,0)
LRDG(DG) ; -- convert DG to section, if generic LAB
"RTN","VPRSDA",288,0)
 Q:$P($G(^ORD(100.98,+$G(DG),0)),U,3)'="LAB"  ;ok
"RTN","VPRSDA",289,0)
 N X,Y S X=$P($G(^ORD(101.43,+$G(ORIT),"LR")),U,6),Y=0
"RTN","VPRSDA",290,0)
 I X'="" S Y=$O(^ORD(100.98,"B",X,0)) S:Y DG=Y
"RTN","VPRSDA",291,0)
 Q
"RTN","VPRSDA",292,0)
 ;
"RTN","VPRSDA",293,0)
WARDFAC(IEN) ; -- return #4 ien for a Ward Location
"RTN","VPRSDA",294,0)
 N HLOC,Y
"RTN","VPRSDA",295,0)
 S HLOC=+$G(^DIC(42,+$G(IEN),44)),Y=""
"RTN","VPRSDA",296,0)
 S:HLOC Y=$P($G(^SC(HLOC,0)),U,4)
"RTN","VPRSDA",297,0)
 Q Y
"RTN","VPRSDA",298,0)
 ;
"RTN","VPRSDA",299,0)
VST(VISIT) ; -- get info for a VISIT in @VPRVST
"RTN","VPRSDA",300,0)
 S VISIT=+$G(VISIT) Q:VISIT<1
"RTN","VPRSDA",301,0)
 D ENCEVENT^PXAPI(VISIT)
"RTN","VPRSDA",302,0)
 S VPRVST=$NA(^TMP("PXKENC",$J,VISIT,"VST",VISIT))
"RTN","VPRSDA",303,0)
 Q
"RTN","VPRSDA",304,0)
 ;
"RTN","VPRSDA",305,0)
VAIP(MVT,DFN) ; -- get admission info & Visit#
"RTN","VPRSDA",306,0)
 ; Return VAIP(#)= array of movements
"RTN","VPRSDA",307,0)
 ;        VPRVST = Visit#
"RTN","VPRSDA",308,0)
 S MVT=$G(MVT),DFN=+$G(DFN)
"RTN","VPRSDA",309,0)
 S VPRVST=+$P(MVT,"~",2),MVT=+MVT
"RTN","VPRSDA",310,0)
 S:'DFN DFN=+$$GET1^DIQ(405,MVT_",",.03,"I")
"RTN","VPRSDA",311,0)
 I 'DFN!'MVT S DDEOUT=1 Q
"RTN","VPRSDA",312,0)
 N VAERR,VADMVT K VAIP
"RTN","VPRSDA",313,0)
 S:MVT'=+$G(^DPT(DFN,.105)) VAIP("E")=MVT
"RTN","VPRSDA",314,0)
 D IN5^VADPT
"RTN","VPRSDA",315,0)
 S:'VPRVST VPRVST=$$VNUM(+$G(VAIP(13)))
"RTN","VPRSDA",316,0)
 Q
"RTN","VPRSDA",317,0)
 ;
"RTN","VPRSDA",318,0)
VNUM(ADM) ; -- find Visit# for an admission
"RTN","VPRSDA",319,0)
 N VAINDT,X,Y
"RTN","VPRSDA",320,0)
 S X=+$G(^DGPM(+$G(ADM),0)),VAINDT=(9999999-$P(X,"."))_"."_$P(X,".",2)
"RTN","VPRSDA",321,0)
 S Y=$O(^AUPNVSIT("AAH",DFN,VAINDT,0))
"RTN","VPRSDA",322,0)
 Q Y
"RTN","VPRSDA",323,0)
 ;
"RTN","VPRSDA",324,0)
SPEC ; -- build DLIST(#)=45.7 iens using VAIP array
"RTN","VPRSDA",325,0)
 N I,X,SPEC
"RTN","VPRSDA",326,0)
 F I=13:1:17 S X=$G(VAIP(I,6)) S:X SPEC(+X)=""
"RTN","VPRSDA",327,0)
 S (I,X)=0 F  S X=$O(SPEC(X)) Q:X<1  S I=I+1,DLIST(I)=X
"RTN","VPRSDA",328,0)
 Q
"RTN","VPRSDA",329,0)
 ;
"RTN","VPRSDA",330,0)
VSTR() ; -- build Visit string of Type;date.time[;location]
"RTN","VPRSDA",331,0)
 N Y S Y=""
"RTN","VPRSDA",332,0)
 I $G(VAIP(13)) S Y="H;"_+VAIP(13)
"RTN","VPRSDA",333,0)
 E  S X=$G(@VPRVST@(0)),Y=$P(X,U,7)_";"_+X_";"_$P(X,U,22)
"RTN","VPRSDA",334,0)
 Q Y
"RTN","VPRSDA",335,0)
 ;
"RTN","VPRSDA",336,0)
VPRV(VISIT) ; -- build DLIST(n)=#200 ien for V Providers
"RTN","VPRSDA",337,0)
 N I,X,R S I=0
"RTN","VPRSDA",338,0)
 F  S I=$O(^TMP("PXKENC",$J,VISIT,"PRV",I)) Q:I<1  S X=$G(^(I,0)) D
"RTN","VPRSDA",339,0)
 . S R=$P(X,U,4)
"RTN","VPRSDA",340,0)
 . S DLIST(I)=+X_U_$S(R="P":"PRIMARY",R="S":"SECONDARY",1:"")
"RTN","VPRSDA",341,0)
 Q
"RTN","VPRSDA",342,0)
 ;
"RTN","VPRSDA",343,0)
APPT1(VPRID) ; -- get ^TMP node for single appt, returns VPRAPPT
"RTN","VPRSDA",344,0)
 N DFN,VPRDT
"RTN","VPRSDA",345,0)
 S DFN=$P(VPRID,",",2),VPRDT=$P(VPRID,",")
"RTN","VPRSDA",346,0)
 I '$D(^TMP($J,"SDAMA301",DFN)) D
"RTN","VPRSDA",347,0)
 . N VPRX,VPRNUM
"RTN","VPRSDA",348,0)
 . S VPRX(1)=VPRDT_";"_VPRDT,VPRX(4)=DFN
"RTN","VPRSDA",349,0)
 . S VPRX("FLDS")="1;2;3;10;11",VPRX("SORT")="P"
"RTN","VPRSDA",350,0)
 . S VPRNUM=$$SDAPI^SDAMA301(.VPRX)
"RTN","VPRSDA",351,0)
 S VPRAPPT=$G(^TMP($J,"SDAMA301",DFN,VPRDT))
"RTN","VPRSDA",352,0)
 S:VPRAPPT="" VPRAPPT=VPRDT_U_$P($G(^DPT(DFN,"S",VPRDT,0)),U,1,2) ;DDEOUT=1
"RTN","VPRSDA",353,0)
 Q
"RTN","VPRSDA",354,0)
 ;
"RTN","VPRSDA",355,0)
VTO(VISIT) ; -- determine ToTime for a visit based on type
"RTN","VPRSDA",356,0)
 N TYPE,INPT,Y S Y=""
"RTN","VPRSDA",357,0)
 S TYPE=$P($G(@VPRVST@(0)),U,7),INPT=$P($G(@VPRVST@(150)),U,2)
"RTN","VPRSDA",358,0)
 ; should not have any inpatient episodes here, handled via DGPM
"RTN","VPRSDA",359,0)
 I "H^R"[TYPE,INPT Q Y
"RTN","VPRSDA",360,0)
 ; look for an appointment check-out time
"RTN","VPRSDA",361,0)
 I "A^I^O"[TYPE S Y=$$CKOUT(VISIT) I Y Q Y
"RTN","VPRSDA",362,0)
 ; check Surgery for Time Out of OR
"RTN","VPRSDA",363,0)
 I TYPE="S" D  I Y Q Y
"RTN","VPRSDA",364,0)
 . N I S I=$O(^SRF("AV",VISIT,0))
"RTN","VPRSDA",365,0)
 . S:I Y=$$GET1^DIQ(130,I_",",.232,"I")
"RTN","VPRSDA",366,0)
 ; otherwise use the Visit Time
"RTN","VPRSDA",367,0)
 I "H^R^A^I^O^S"'[TYPE!(+$G(@VPRVST@(0))<DT) S Y=+$G(@VPRVST@(0))
"RTN","VPRSDA",368,0)
 Q Y
"RTN","VPRSDA",369,0)
 ;
"RTN","VPRSDA",370,0)
CKOUT(VISIT) ; -- get Check-out date from Outpt Enc file
"RTN","VPRSDA",371,0)
 N X,Y,IEN
"RTN","VPRSDA",372,0)
 S IEN=$O(^SCE("AVSIT",VISIT,0)),(X,Y)=""
"RTN","VPRSDA",373,0)
 S:IEN X=$$GETOE^SDOE(IEN),Y=$P(X,U,7)
"RTN","VPRSDA",374,0)
 Q Y
"RTN","VPRSDA",375,0)
 ;
"RTN","VPRSDA",376,0)
CP1(IEN) ; -- get MD nodes for procedure
"RTN","VPRSDA",377,0)
 ; VPRCP = ^TMP("MDHSP",$J,I)
"RTN","VPRSDA",378,0)
 ; VPRCN = ^GMR(123,consult,0)
"RTN","VPRSDA",379,0)
 ; VPRTIU(field#,"I") = TIU data field
"RTN","VPRSDA",380,0)
 I '$D(^TMP("MDHSP",$J)) D
"RTN","VPRSDA",381,0)
 . S:'DFN DFN=+$$GET1^DIQ(702,IEN,.01,"I")
"RTN","VPRSDA",382,0)
 . N DLIST D CPROCS^VPRSDAQ
"RTN","VPRSDA",383,0)
 S I=+$G(^TMP("MDHSP",$J,"IEN",IEN)),VPRCP=$G(^TMP("MDHSP",$J,I))
"RTN","VPRSDA",384,0)
 I VPRCP="" Q  ;S DDEOUT=1 Q
"RTN","VPRSDA",385,0)
 ; undo date formatting
"RTN","VPRSDA",386,0)
 N X,Y,%DT,VPRD
"RTN","VPRSDA",387,0)
 S X=$P(VPRCP,U,6) I $L(X) S %DT="STX" D ^%DT S:Y>0 $P(VPRCP,U,6)=Y
"RTN","VPRSDA",388,0)
 ; get supporting data from Consult, TIU note
"RTN","VPRSDA",389,0)
 S X=+$P(VPRCP,U,13) I X D  K VPRD
"RTN","VPRSDA",390,0)
 . D DOCLIST^GMRCGUIB(.VPRD,X) S VPRCN=$G(VPRD(0)) M VPRCN=VPRD(50)
"RTN","VPRSDA",391,0)
 S X=+$P(VPRCP,U,14) I X D  K VPRD
"RTN","VPRSDA",392,0)
 . D EXTRACT^TIULQ(X,"VPRD",,".03;.05;1202;1211;1212",,,"I")
"RTN","VPRSDA",393,0)
 . M VPRTIU=VPRD(X)
"RTN","VPRSDA",394,0)
 Q
"RTN","VPRSDA",395,0)
 ;
"RTN","VPRSDA",396,0)
SRPTS(IEN) ; -- put Op Reports into DLIST(#) = TIU ien
"RTN","VPRSDA",397,0)
 S I=0 F  S I=$O(VPRSR(IEN,I)) Q:I<1  S X=$G(VPRSR(IEN,I)) I X D
"RTN","VPRSDA",398,0)
 . ;X = ien ^ $$RESOLVE^TIUSRVLO data string
"RTN","VPRSDA",399,0)
 . I $P(X,U,7)'="completed",$P(X,U,7)'="amended" Q
"RTN","VPRSDA",400,0)
 . I $P(X,U,2)["Addendum to " Q
"RTN","VPRSDA",401,0)
 . S DLIST(I)=+X_";TIU"
"RTN","VPRSDA",402,0)
 . ; X["OPERATION REPORT"!(X["PROCEDURE REPORT") S SURG("opReport")=X
"RTN","VPRSDA",403,0)
 Q
"RTN","VPRSDA",404,0)
 ;
"RTN","VPRSDA",405,0)
SRF(IEN) ; -- procedure
"RTN","VPRSDA",406,0)
 N X,SROP
"RTN","VPRSDA",407,0)
 S X=$P(VPRSR(IEN),U,2)
"RTN","VPRSDA",408,0)
 ; Use CPT ien if defined
"RTN","VPRSDA",409,0)
 S SROP=$$GET1^DIQ(136,IEN_",",.02,"I")
"RTN","VPRSDA",410,0)
 S:'SROP SROP=$P($G(^SRF(IEN,"OP")),U,2)
"RTN","VPRSDA",411,0)
 I SROP S VALUE=$$CPT^VPRDSR(SROP)_"^CPT-4",DATA=X Q
"RTN","VPRSDA",412,0)
 ; else use procedure name
"RTN","VPRSDA",413,0)
 S VALUE=X_U_X
"RTN","VPRSDA",414,0)
 Q
"RTN","VPRSDA",415,0)
 ;
"RTN","VPRSDA",416,0)
VIT1(IEN) ; -- get info for one Vital measurement, returns VPRGMV
"RTN","VPRSDA",417,0)
 S IEN=$G(IEN) I IEN="" S DDEOUT=1 Q
"RTN","VPRSDA",418,0)
 D GETREC^GMVUTL(.VPRV,IEN,1)
"RTN","VPRSDA",419,0)
 S VPRGMV=$G(VPRV(0)) I '$G(VPRV(0)) S DDEOUT=1 Q
"RTN","VPRSDA",420,0)
 S VPRTYPE=$$FIELD^GMVGETVT(+$P(VPRGMV,U,3),2)
"RTN","VPRSDA",421,0)
 I VPRTYPE="WT" D  ;get BMI for weight record
"RTN","VPRSDA",422,0)
 . I $G(^TMP("VPRGMV",$J,IEN)) S $P(VPRGMV,U,14)=$P(^(IEN),U,14) Q
"RTN","VPRSDA",423,0)
 . ; get BMI from query array if available, else call GMRVUT0
"RTN","VPRSDA",424,0)
 . N GMRVSTR,DFN,IDT,BMI
"RTN","VPRSDA",425,0)
 . S GMRVSTR=VPRTYPE,GMRVSTR(0)=+VPRGMV_U_+VPRGMV_"^1^1",DFN=+$P(VPRGMV,U,2)
"RTN","VPRSDA",426,0)
 . D EN1^GMRVUT0 S IDT=9999999-(+VPRGMV)
"RTN","VPRSDA",427,0)
 . S BMI=$P($G(^UTILITY($J,"GMRVD",IDT,VPRTYPE,IEN)),U,14)
"RTN","VPRSDA",428,0)
 . S:BMI'="" $P(VPRGMV,U,14)=BMI
"RTN","VPRSDA",429,0)
 . K ^UTILITY($J,"GMRVD")
"RTN","VPRSDA",430,0)
 S VPRANGE=$$RANGE^VPRDGMV(VPRTYPE)
"RTN","VPRSDA",431,0)
 Q
"RTN","VPRSDA",432,0)
 ;
"RTN","VPRSDA",433,0)
VITQUAL ; -- build DLIST(#)=Qualifiers [code^name]
"RTN","VPRSDA",434,0)
 N I,X,QUALS
"RTN","VPRSDA",435,0)
 S QUALS=$G(VPRV(5))
"RTN","VPRSDA",436,0)
 F I=1:1 S X=$P(QUALS,U,I) Q:X=""  S DLIST(I)=X
"RTN","VPRSDA",437,0)
 Q
"RTN","VPRSDA",438,0)
 ;
"RTN","VPRSDA",439,0)
VITCODE(IEN,SFN) ; -- return [first] code for vital type
"RTN","VPRSDA",440,0)
 ; SubFileNumber = 120.518 for Vital Type
"RTN","VPRSDA",441,0)
 ;                 120.522 for Vital Qualifier
"RTN","VPRSDA",442,0)
 N VPRC,IENS,Y
"RTN","VPRSDA",443,0)
 D GETS^DIQ(SFN,"1,"_IEN_",","**",,"VPRC")
"RTN","VPRSDA",444,0)
 S IENS=$O(VPRC(SFN_1,""))
"RTN","VPRSDA",445,0)
 S Y=$S($L(IENS):$G(VPRC(SFN_1,IENS,.01,"I")),1:"")
"RTN","VPRSDA",446,0)
 Q Y
"RTN","VPRSDA",447,0)
 ;
"RTN","VPRSDA",448,0)
FIM1(IEN) ; -- get info for one set of measurements
"RTN","VPRSDA",449,0)
 I '$D(VPRSITE) D PRM^RMIMRP(.VPRSITE) I '$O(VPRSITE(1)) S DDEOUT=1 Q
"RTN","VPRSDA",450,0)
 D GC^RMIMRP(.VPRM,IEN)
"RTN","VPRSDA",451,0)
 ; S:'$G(DFN) ??
"RTN","VPRSDA",452,0)
 N NOTE S NOTE=+$P($G(VPRM(1)),U,12) K VPRTIU
"RTN","VPRSDA",453,0)
 D EXTRACT^TIULQ(NOTE,"VPRTIU",,"1201;1202;1302",,,"I")
"RTN","VPRSDA",454,0)
 M VPRM("TIU")=VPRTIU(NOTE)
"RTN","VPRSDA",455,0)
 Q
"RTN","VPRSDA",456,0)
 ;
"RTN","VPRSDA",457,0)
FIMS ; -- get DLIST(#)=name^value of each score
"RTN","VPRSDA",458,0)
 ; Returns VPRFIMS = Assessment type(s) for ProblemDetail
"RTN","VPRSDA",459,0)
 N I,J,N,X,NAMES,SCORES,SUM,TYPE
"RTN","VPRSDA",460,0)
 S N=0,VPRFIMS=""
"RTN","VPRSDA",461,0)
 S NAMES="Eating^Grooming^Bathing^Dressing - Upper Body^Dressing - Lower Body^Toileting^Bladder Management^Bowel Management^Bed, Chair, Wheelchair^Toilet^Tub, Shower^Walk/Wheelchair^Stairs"
"RTN","VPRSDA",462,0)
 S NAMES=NAMES_"^Comprehension^Expression^Social Interaction^Problem Solving^Memory"
"RTN","VPRSDA",463,0)
 S NAMES=NAMES_"^walkMode^comprehendMode^expressMode^Z"
"RTN","VPRSDA",464,0)
 F I=5:1:9 I VPRM(I)'?1."^" D  ;has data
"RTN","VPRSDA",465,0)
 . S SCORES=VPRM(I),SUM=$$TOTAL(SCORES) Q:'SUM
"RTN","VPRSDA",466,0)
 . S TYPE=$S(I=5:"Admission",I=6:"Discharge",I=7:"Interim",I=8:"Follow up",1:"Goals")
"RTN","VPRSDA",467,0)
 . S VPRFIMS=VPRFIMS_$S(VPRFIMS'="":", ",1:"")_TYPE
"RTN","VPRSDA",468,0)
 . ; add score set to list
"RTN","VPRSDA",469,0)
 . S N=N+1,DLIST(N)="Assessment Type^"_TYPE
"RTN","VPRSDA",470,0)
 . F J=1:1:21 S X=$P(SCORES,U,J),N=N+1,DLIST(N)=$P(NAMES,U,J)_U_X
"RTN","VPRSDA",471,0)
 . S N=N+1,DLIST(N)="FIM Total^"_SUM
"RTN","VPRSDA",472,0)
 S:$L(VPRFIMS) VPRFIMS=VPRFIMS_" Assessment"_$S(VPRFIMS[",":"s",1:"")
"RTN","VPRSDA",473,0)
 Q
"RTN","VPRSDA",474,0)
 ;
"RTN","VPRSDA",475,0)
TOTAL(NODE) ; -- Return total of scores, or "" if incomplete
"RTN","VPRSDA",476,0)
 N SUM,I,X
"RTN","VPRSDA",477,0)
 S SUM=0 F I=1:1:18 S X=$P(NODE,U,I) S:X SUM=SUM+X I X<1 S SUM="" Q
"RTN","VPRSDA",478,0)
 Q SUM
"RTN","VPRSDA",479,0)
 ;
"RTN","VPRSDA",480,0)
PRF1(ID) ; -- set up one patient record flag assignment
"RTN","VPRSDA",481,0)
 ; Returns VPRF1("NAME")=VALUE
"RTN","VPRSDA",482,0)
 S:'$G(DFN) DFN=+$P(ID,"~",2)
"RTN","VPRSDA",483,0)
 I '$G(DFN)!'$G(ID) S DDEOUT=1 Q
"RTN","VPRSDA",484,0)
 D:'$D(VPRF)  K VPRF1
"RTN","VPRSDA",485,0)
 . N DLIST D PRF^VPRSDAQ
"RTN","VPRSDA",486,0)
 N I S I=+$G(VPRF("IDX",+ID))
"RTN","VPRSDA",487,0)
 I I M VPRF1=VPRF(I)
"RTN","VPRSDA",488,0)
 Q
"RTN","VPRSDA",489,0)
 ;
"RTN","VPRSDA",490,0)
PCMM ; -- get DLIST(#)=ien^role of PCP, PC Team members
"RTN","VPRSDA",491,0)
 ; Expects DFN, VPRTEAM = ien^name of PCTeam
"RTN","VPRSDA",492,0)
 N PCP,X,N,VPRT,IDX,ROLE
"RTN","VPRSDA",493,0)
 S PCP=$$OUTPTPR^SDUTL3(DFN),N=0 S:PCP>0 N=1,DLIST(1)=+PCP_"^PRIMARY CARE PROVIDER"
"RTN","VPRSDA",494,0)
 S X=$$PRTM^SCAPMC(+$G(VPRTEAM),,,,.VPRT) I X D
"RTN","VPRSDA",495,0)
 . S IDX=$NA(@VPRT@("SCPR")) Q:IDX=""
"RTN","VPRSDA",496,0)
 . F  S IDX=$Q(@IDX) Q:IDX=""  Q:$QS(IDX,3)'="SCPR"  I $QS(IDX,4)'=+PCP D
"RTN","VPRSDA",497,0)
 .. S ROLE=$$GET1^DIQ(404.57,+$QS(IDX,5),.01)
"RTN","VPRSDA",498,0)
 .. S N=N+1,DLIST(N)=$QS(IDX,4)_U_ROLE ;provider ien ^ position name
"RTN","VPRSDA",499,0)
 Q
"RTN","VPRSDAL")
0^2^B8006329^B7855097
"RTN","VPRSDAL",1,0)
VPRSDAL ;SLC/MKB -- SDA Allergy utilities ;10/25/18  15:29
"RTN","VPRSDAL",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRSDAL",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","VPRSDAL",4,0)
 ;
"RTN","VPRSDAL",5,0)
 ; External References          DBIA#
"RTN","VPRSDAL",6,0)
 ; -------------------          -----
"RTN","VPRSDAL",7,0)
 ; ^GMR(120.8                    6973
"RTN","VPRSDAL",8,0)
 ; DILFD                         2055
"RTN","VPRSDAL",9,0)
 ; DIQ                           2056
"RTN","VPRSDAL",10,0)
 ; GMRADPT                      10099
"RTN","VPRSDAL",11,0)
 ; GMRAOR2                       2422
"RTN","VPRSDAL",12,0)
 ;
"RTN","VPRSDAL",13,0)
ALG1(IEN) ; -- get info for single allergy, returns VPRALG
"RTN","VPRSDAL",14,0)
 N GMRA K VPRALG
"RTN","VPRSDAL",15,0)
 I '$D(^GMR(120.8,+$G(IEN),0)) S DDEOUT=1 Q
"RTN","VPRSDAL",16,0)
 I '$D(GMRAL) D
"RTN","VPRSDAL",17,0)
 . N DFN S DFN=+$$GET1^DIQ(120.8,IEN_",",.01,"I")
"RTN","VPRSDAL",18,0)
 . S GMRA="0^0^111^0^1"
"RTN","VPRSDAL",19,0)
 . I $L($T(EN2^GMRADPT)) D EN2^GMRADPT Q
"RTN","VPRSDAL",20,0)
 . D EN1^GMRADPT
"RTN","VPRSDAL",21,0)
 M VPRALG=GMRAL(IEN)
"RTN","VPRSDAL",22,0)
 I $G(VPRALG)="" S VPRALG="" ;S DDEOUT=1 Q
"RTN","VPRSDAL",23,0)
 I $L($T(EN2^GMRAOR2)) D EN2^GMRAOR2(IEN,"GMRAY") Q
"RTN","VPRSDAL",24,0)
 D EN1^GMRAOR2(IEN,"GMRAY")
"RTN","VPRSDAL",25,0)
 Q
"RTN","VPRSDAL",26,0)
 ;
"RTN","VPRSDAL",27,0)
ALLERGEN(VPTR) ; -- return code^name^system for Allergen
"RTN","VPRSDAL",28,0)
 N Y,FN,TYPE,CSYS
"RTN","VPRSDAL",29,0)
 S FN=$S(VPTR["PSDRUG":50,1:+$P(VPTR,"(",2)),TYPE=$P(VPRALG,U,7)
"RTN","VPRSDAL",30,0)
 S CSYS=$S(TYPE="D":"RXN^UNI^SCT",TYPE["D":"RXN^SCT^UNI",1:"SCT^UNI")
"RTN","VPRSDAL",31,0)
 S Y=$$CODE^VPRSDA(+VPTR,FN,CSYS) I Y="" D
"RTN","VPRSDAL",32,0)
 . N NAME S NAME=$$GET1^DIQ(FN,+VPTR,$S(FN=50.605:1,1:.01))
"RTN","VPRSDAL",33,0)
 . ; $$EXTERNAL^DILFD(120.8,1,,VPTR)
"RTN","VPRSDAL",34,0)
 . S Y=$$VUID^VPRD(+VPTR,FN) I Y S Y=Y_U_NAME_"^VHAT" Q
"RTN","VPRSDAL",35,0)
 . S Y=+$G(VPTR)_U_NAME_"^VA"_FN
"RTN","VPRSDAL",36,0)
 Q Y
"RTN","VPRSDAL",37,0)
 ;
"RTN","VPRSDAL",38,0)
ALGCMT1(IEN,TYPE) ; -- return TYPE comment
"RTN","VPRSDAL",39,0)
 N I,TXT,Y
"RTN","VPRSDAL",40,0)
 S I=$O(^GMR(120.8,IEN,26,"AVER","E",0)),Y=""
"RTN","VPRSDAL",41,0)
 I I M TXT=^GMR(120.8,IEN,26,I,2) S Y=$$STRING^VPRD(.TXT)
"RTN","VPRSDAL",42,0)
 Q Y
"RTN","VPRSDAL",43,0)
 ;
"RTN","VPRSDAL",44,0)
ALGCMT(IEN) ; -- return list of comments in
"RTN","VPRSDAL",45,0)
 ; DLIST(#) = id ^ date ^ user ^ type ^ facility ^ text
"RTN","VPRSDAL",46,0)
 N I,X,Y,TXT
"RTN","VPRSDAL",47,0)
 S I=0 F  S I=$O(^GMR(120.8,IEN,26,I)) Q:I<1  S X=$G(^(I,0)) D
"RTN","VPRSDAL",48,0)
 . Q:$P(X,U,3)="E"
"RTN","VPRSDAL",49,0)
 . S $P(X,U,3)=$$EXTERNAL^DILFD(120.826,1.5,,$P(X,U,3))
"RTN","VPRSDAL",50,0)
 . M TXT=^GMR(120.8,IEN,26,I,2) S Y=$$STRING^VPRD(.TXT)
"RTN","VPRSDAL",51,0)
 . S DLIST(I)=I_","_IEN_U_X_U_+$G(VASITE)_U_Y
"RTN","VPRSDAL",52,0)
 Q
"RTN","VPRSDAL",53,0)
 ;
"RTN","VPRSDAL",54,0)
ALGSEV(IEN) ; -- return overall Allergy Severity
"RTN","VPRSDAL",55,0)
 N I,SEV,X,Y
"RTN","VPRSDAL",56,0)
 S (SEV,Y)="",I=0
"RTN","VPRSDAL",57,0)
 ; find highest severity among reactions
"RTN","VPRSDAL",58,0)
 F  S I=$O(GMRAY("O",I)) Q:I<1  S X=$P(GMRAY("O",I),U,2) I $L(X),X]SEV S SEV=X
"RTN","VPRSDAL",59,0)
 I $L(SEV)>1 D
"RTN","VPRSDAL",60,0)
 . S X=$E(SEV,1,2),Y=$S(X="MI":255604002,X="MO":6736007,X="SE":24484000,1:"")
"RTN","VPRSDAL",61,0)
 . I Y S Y=Y_U_SEV_"^SNOMED CT" Q
"RTN","VPRSDAL",62,0)
 . S Y=SEV_U_SEV
"RTN","VPRSDAL",63,0)
 Q Y
"RTN","VPRSDAL",64,0)
 ;
"RTN","VPRSDAL",65,0)
ALGDT(IEN) ; -- return first D/T of Event
"RTN","VPRSDAL",66,0)
 N I,RDT,X,Y
"RTN","VPRSDAL",67,0)
 S I=0,RDT=9999999,Y=""
"RTN","VPRSDAL",68,0)
 ; find first date.time among reactions
"RTN","VPRSDAL",69,0)
 F  S I=$O(GMRAY("O",I)) Q:I<1  S X=$P(GMRAY("O",I),U) S:X<RDT RDT=X
"RTN","VPRSDAL",70,0)
 S:RDT<9999999 Y=RDT
"RTN","VPRSDAL",71,0)
 Q Y
"RTN","VPRSDAL",72,0)
 ;
"RTN","VPRSDAL",73,0)
ALGSIGN(IEN) ; -- convert ien^name[^date] to national code for Sign/Symptom
"RTN","VPRSDAL",74,0)
 ; Return +IEN, DATA=code^name^system for SNOMED or VUID
"RTN","VPRSDAL",75,0)
 N Y S DATA=$G(IEN),IEN=+$G(IEN),Y=""
"RTN","VPRSDAL",76,0)
 S Y=$$CODE^VPRSDA(IEN,120.83,"SCT")
"RTN","VPRSDAL",77,0)
 I Y="" S Y=$$VUID^VPRD(IEN,120.83) S:$L(Y) Y=Y_U_$P(DATA,U,2)_"^VHAT"
"RTN","VPRSDAL",78,0)
 S:$L(Y) DATA=Y ;return code string
"RTN","VPRSDAL",79,0)
 Q
"RTN","VPRSDAL",80,0)
 ;
"RTN","VPRSDAL",81,0)
ASSESS ; -- get Assessment #120.86 for patient
"RTN","VPRSDAL",82,0)
 I '$G(DFN),$G(ID) S DFN=ID
"RTN","VPRSDAL",83,0)
 Q:'$G(DFN)
"RTN","VPRSDAL",84,0)
 K GMRAL D EN1^GMRADPT
"RTN","VPRSDAL",85,0)
 I GMRAL<1 S DLIST(1)=DFN
"RTN","VPRSDAL",86,0)
 Q
"RTN","VPRSDAQ")
0^8^B148289095^B144153181
"RTN","VPRSDAQ",1,0)
VPRSDAQ ;SLC/MKB -- SDA queries ;3/28/19  14:09
"RTN","VPRSDAQ",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRSDAQ",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","VPRSDAQ",4,0)
 ;
"RTN","VPRSDAQ",5,0)
 ; External References          DBIA#
"RTN","VPRSDAQ",6,0)
 ; -------------------          -----
"RTN","VPRSDAQ",7,0)
 ; ^AUPNVSIT                     2028
"RTN","VPRSDAQ",8,0)
 ; ^AUTTHF                       4295
"RTN","VPRSDAQ",9,0)
 ; ^DGS(41.1                     3796
"RTN","VPRSDAQ",10,0)
 ; ^DIC(9.4                     10048
"RTN","VPRSDAQ",11,0)
 ; ^LR                            525
"RTN","VPRSDAQ",12,0)
 ; ^OR(100                       5771
"RTN","VPRSDAQ",13,0)
 ; ^ORD(100.98                   6982
"RTN","VPRSDAQ",14,0)
 ; ^PXRMINDX                     4290
"RTN","VPRSDAQ",15,0)
 ; ^SC                          10040
"RTN","VPRSDAQ",16,0)
 ; ^WV(790.05                    5772
"RTN","VPRSDAQ",17,0)
 ; %DT                          10003
"RTN","VPRSDAQ",18,0)
 ; DGPFAPI                       3860
"RTN","VPRSDAQ",19,0)
 ; DIC                           2051
"RTN","VPRSDAQ",20,0)
 ; DIQ                           2056
"RTN","VPRSDAQ",21,0)
 ; GMPLUTL2                      2741
"RTN","VPRSDAQ",22,0)
 ; GMRADPT                      10099
"RTN","VPRSDAQ",23,0)
 ; GMRCSLM1, ^TMP("GMRCR",$J)    2740
"RTN","VPRSDAQ",24,0)
 ; GMRVUT0, ^UTILITY($J)         1446
"RTN","VPRSDAQ",25,0)
 ; IBBAPI                        4419
"RTN","VPRSDAQ",26,0)
 ; ICDEX                         5747
"RTN","VPRSDAQ",27,0)
 ; LR7OR1, ^TMP("LRRR",$J)       2503
"RTN","VPRSDAQ",28,0)
 ; MDPS1,^TMP("MDHSP",$J)        4230
"RTN","VPRSDAQ",29,0)
 ; ORQ1, ^TM("ORR",$J)           3154
"RTN","VPRSDAQ",30,0)
 ; RMIMRP                        4745
"RTN","VPRSDAQ",31,0)
 ; SDAMA301, ^TMP($J)            4433
"RTN","VPRSDAQ",32,0)
 ; SROESTV                       3533
"RTN","VPRSDAQ",33,0)
 ; TIUPP3, ^TMP("TIUPPCV",$J)    2864
"RTN","VPRSDAQ",34,0)
 ; TIUVPR                        6077
"RTN","VPRSDAQ",35,0)
 ; VADPT2                         325
"RTN","VPRSDAQ",36,0)
 ; XLFDT                        10103
"RTN","VPRSDAQ",37,0)
 ;
"RTN","VPRSDAQ",38,0)
 ; VistA application queries, return DLIST(#) = record ID
"RTN","VPRSDAQ",39,0)
 ; Expects context variables from ^DDEGET [DFN, DSTRT, DSTOP, DMAX]
"RTN","VPRSDAQ",40,0)
 ;
"RTN","VPRSDAQ",41,0)
PROBLEMS ; -- Problem List
"RTN","VPRSDAQ",42,0)
 N ID,VPRSTS,VPRPROB,VPRN,X
"RTN","VPRSDAQ",43,0)
 S VPRSTS=$G(FILTER("status")) ;default = all problems
"RTN","VPRSDAQ",44,0)
 D LIST^GMPLUTL2(.VPRPROB,DFN,VPRSTS)
"RTN","VPRSDAQ",45,0)
 S VPRN=0 F  S VPRN=$O(VPRPROB(VPRN)) Q:(VPRN<1)!(VPRN>DMAX)  D
"RTN","VPRSDAQ",46,0)
 . S X=$P(VPRPROB(VPRN),U,6) I X,(X<DSTRT)!(X>DSTOP) Q  ;last updated
"RTN","VPRSDAQ",47,0)
 . S DLIST(VPRN)=+VPRPROB(VPRN)
"RTN","VPRSDAQ",48,0)
 Q
"RTN","VPRSDAQ",49,0)
 ;
"RTN","VPRSDAQ",50,0)
ALLERGYS ; -- Allergies/Adverse Reactions
"RTN","VPRSDAQ",51,0)
 N GMRA,VPRN,ID
"RTN","VPRSDAQ",52,0)
 S VPRN=0,GMRA="0^0^111^0^1"
"RTN","VPRSDAQ",53,0)
 I $L($T(EN2^GMRADPT)) D EN2^GMRADPT I 1
"RTN","VPRSDAQ",54,0)
 E  D EN1^GMRADPT
"RTN","VPRSDAQ",55,0)
 I 'GMRAL Q  ;D NKA^VPRDJ02 Q
"RTN","VPRSDAQ",56,0)
 S ID=0 F  S ID=+$O(GMRAL(ID)) Q:ID<1  S VPRN=VPRN+1,DLIST(VPRN)=ID Q:VPRN'<DMAX
"RTN","VPRSDAQ",57,0)
 Q
"RTN","VPRSDAQ",58,0)
 ;
"RTN","VPRSDAQ",59,0)
VISITS ; -- Visits
"RTN","VPRSDAQ",60,0)
 N IDT,BEG,END,ID,VPRN,VAINDT,VADMVT,VAERR
"RTN","VPRSDAQ",61,0)
 S BEG=DSTRT,END=DSTOP D IDT^VPRDVSIT
"RTN","VPRSDAQ",62,0)
 S VPRN=0,IDT=BEG
"RTN","VPRSDAQ",63,0)
 F  S IDT=$O(^AUPNVSIT("AA",DFN,IDT)) Q:IDT<1!(IDT>END)  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",64,0)
 . S ID=0 F  S ID=$O(^AUPNVSIT("AA",DFN,IDT,ID)) Q:ID<1  D
"RTN","VPRSDAQ",65,0)
 .. I $P($G(^AUPNVSIT(ID,0)),U,7)="H" D  Q:$G(VADMVT)
"RTN","VPRSDAQ",66,0)
 ... S VAINDT=(9999999-$P(IDT,"."))_"."_$P(IDT,".",2)
"RTN","VPRSDAQ",67,0)
 ... D ADM^VADPT2
"RTN","VPRSDAQ",68,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=ID
"RTN","VPRSDAQ",69,0)
 Q
"RTN","VPRSDAQ",70,0)
 ;
"RTN","VPRSDAQ",71,0)
ADM ; -- Admissions (via Visits)
"RTN","VPRSDAQ",72,0)
 N IDT,BEG,END,ID,VPRN,VAINDT,VADMVT,VAERR S VPRN=0
"RTN","VPRSDAQ",73,0)
 S BEG=DSTRT,END=DSTOP D IDT^VPRDVSIT
"RTN","VPRSDAQ",74,0)
 S IDT=BEG F  S IDT=$O(^AUPNVSIT("AAH",DFN,IDT)) Q:IDT<1!(IDT>END)  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",75,0)
 . S ID=0 F  S ID=$O(^AUPNVSIT("AAH",DFN,IDT,ID)) Q:ID<1  D
"RTN","VPRSDAQ",76,0)
 .. S VAINDT=(9999999-$P(IDT,"."))_"."_$P(IDT,".",2)
"RTN","VPRSDAQ",77,0)
 .. D ADM^VADPT2 Q:'$G(VADMVT)
"RTN","VPRSDAQ",78,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=VADMVT_"~"_ID
"RTN","VPRSDAQ",79,0)
 Q
"RTN","VPRSDAQ",80,0)
 ;
"RTN","VPRSDAQ",81,0)
DOCUMENT ; -- Text Integration Utilities
"RTN","VPRSDAQ",82,0)
 N VPRY,VPRI,VPRN
"RTN","VPRSDAQ",83,0)
 D LIST^TIUVPR(.VPRY,DFN,38,DSTRT,DSTOP)
"RTN","VPRSDAQ",84,0)
 S VPRN=0,VPRI="COUNT"
"RTN","VPRSDAQ",85,0)
 F  S VPRI=$O(@VPRY@(VPRI),-1) Q:VPRI<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",86,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=+VPRI
"RTN","VPRSDAQ",87,0)
 K @VPRY
"RTN","VPRSDAQ",88,0)
 Q
"RTN","VPRSDAQ",89,0)
 ;
"RTN","VPRSDAQ",90,0)
ADVDIR ; -- Adv Directive (alerts)
"RTN","VPRSDAQ",91,0)
 N I,AD,TIUD,CNT,STS,NXT
"RTN","VPRSDAQ",92,0)
 D:$G(DFN) ENCOVER^TIUPP3(DFN)
"RTN","VPRSDAQ",93,0)
 ; ^TMP = IEN^Acronym^Category Name^Optional Subject^Date/Time^Optional Addendum
"RTN","VPRSDAQ",94,0)
 ; put AD in Ref D/T order
"RTN","VPRSDAQ",95,0)
 S I=0 F  S I=$O(^TMP("TIUPPCV",$J,I)) Q:I<1  S AD=$G(^(I)) I $P(AD,U,2)="D" S TIUD($P(AD,U,5))=AD
"RTN","VPRSDAQ",96,0)
 Q:'$O(TIUD(0))  ;no AD's for patient
"RTN","VPRSDAQ",97,0)
 ; get latest AD, ck if in/active
"RTN","VPRSDAQ",98,0)
 S I=+$O(TIUD(""),-1),AD=$G(TIUD(I)),STS="A",NXT=""
"RTN","VPRSDAQ",99,0)
 I AD["RESCIND"!($L($P(AD,U,6))) D  ;inactive
"RTN","VPRSDAQ",100,0)
 . N ADD,%DT,X,Y S ADD=$P(AD,U,6),STS="I"
"RTN","VPRSDAQ",101,0)
 . S X=$P(AD,"addendum ",2),X=$P(X,")")
"RTN","VPRSDAQ",102,0)
 . I $L(X) S %DT="TX" D ^%DT S:Y>0 NXT=Y ;end=addendum d/t
"RTN","VPRSDAQ",103,0)
 S CNT=1,DLIST(CNT)=+AD_U_STS_U_NXT,NXT=$P(AD,U,5)
"RTN","VPRSDAQ",104,0)
 ; add remaining AD's as inactive, using next AD's Ref D/T as its end
"RTN","VPRSDAQ",105,0)
 S STS="I" F  S I=$O(TIUD(I),-1) Q:I<1  S AD=$G(TIUD(I)) D
"RTN","VPRSDAQ",106,0)
 . S CNT=CNT+1,DLIST(CNT)=+AD_U_STS_U_NXT
"RTN","VPRSDAQ",107,0)
 . S NXT=$P(AD,U,5)
"RTN","VPRSDAQ",108,0)
 Q
"RTN","VPRSDAQ",109,0)
 ;
"RTN","VPRSDAQ",110,0)
CW ; -- Crisis/Warning notes (alerts)
"RTN","VPRSDAQ",111,0)
 N I,X,CNT
"RTN","VPRSDAQ",112,0)
 D:$G(DFN) ENCOVER^TIUPP3(DFN)
"RTN","VPRSDAQ",113,0)
 S (I,CNT)=0
"RTN","VPRSDAQ",114,0)
 F  S I=$O(^TMP("TIUPPCV",$J,I)) Q:I<1  S X=$G(^(I)) I $P(X,U,2)="C"!($P(X,U,2)="W") S CNT=CNT+1,DLIST(CNT)=$P(X,U,1,2)
"RTN","VPRSDAQ",115,0)
 Q
"RTN","VPRSDAQ",116,0)
 ;
"RTN","VPRSDAQ",117,0)
LRAP ; -- LR Anatomic Pathology reports [expects LRDFN]
"RTN","VPRSDAQ",118,0)
 N SUB,IDT,VPRN,CTR S VPRN=0
"RTN","VPRSDAQ",119,0)
 D RR^LR7OR1(DFN,,DSTRT,DSTOP,"AP",,,DMAX)
"RTN","VPRSDAQ",120,0)
 S SUB="" F  S SUB=$O(^TMP("LRRR",$J,DFN,SUB)) Q:SUB=""  D
"RTN","VPRSDAQ",121,0)
 . S IDT=0 F  S IDT=$O(^TMP("LRRR",$J,DFN,SUB,IDT)) Q:IDT<1  I $O(^(IDT,0)) D
"RTN","VPRSDAQ",122,0)
 .. Q:$O(^LR(LRDFN,SUB,IDT,.05,0))        ;report in TIU
"RTN","VPRSDAQ",123,0)
 .. Q:'$P($G(^LR(LRDFN,SUB,IDT,0)),U,11)  ;not final results
"RTN","VPRSDAQ",124,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=IDT_","_LRDFN_"~"_SUB
"RTN","VPRSDAQ",125,0)
 K ^TMP("LRRR",$J,DFN)
"RTN","VPRSDAQ",126,0)
 Q
"RTN","VPRSDAQ",127,0)
 ;
"RTN","VPRSDAQ",128,0)
LRMI ; -- LR Microbiology reports [expects LRDFN]
"RTN","VPRSDAQ",129,0)
 N IDT,VPRN,CTR S VPRN=0
"RTN","VPRSDAQ",130,0)
 D RR^LR7OR1(DFN,,DSTRT,DSTOP,"MI",,,DMAX)
"RTN","VPRSDAQ",131,0)
 S IDT=0 F  S IDT=$O(^TMP("LRRR",$J,DFN,"MI",IDT)) Q:IDT<1  I $O(^(IDT,0)) D
"RTN","VPRSDAQ",132,0)
 . Q:'$P($G(^LR(LRDFN,"MI",IDT,0)),U,3)  ;not final results
"RTN","VPRSDAQ",133,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=IDT_","_LRDFN_"~MI"
"RTN","VPRSDAQ",134,0)
 K ^TMP("LRRR",$J,DFN)
"RTN","VPRSDAQ",135,0)
 Q
"RTN","VPRSDAQ",136,0)
 ;
"RTN","VPRSDAQ",137,0)
ORDERS(DG) ; -- Orders by Display Group
"RTN","VPRSDAQ",138,0)
 N ORDG,ORIGVIEW,ORKID,ORLIST,VPRI,VPRN,ORDER,X3,X4
"RTN","VPRSDAQ",139,0)
 S DG=$G(DG,"ALL"),ORDG=+$O(^ORD(100.98,"B",DG,0))
"RTN","VPRSDAQ",140,0)
 ; return original view, child orders for Lab
"RTN","VPRSDAQ",141,0)
 S ORIGVIEW=2,ORKID=$S(DG="CH":1,DG="LAB":1,1:0)
"RTN","VPRSDAQ",142,0)
 D EN^ORQ1(DFN_";DPT(",ORDG,6,,DSTRT,DSTOP,,,,ORKID) S VPRN=0
"RTN","VPRSDAQ",143,0)
 S VPRI=0 F  S VPRI=$O(^TMP("ORR",$J,ORLIST,VPRI)) Q:VPRI<1  S ORDER=$G(^(VPRI)) D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",144,0)
 . I $P($P(ORDER,U),";",2)>1 Q  ;skip order actions
"RTN","VPRSDAQ",145,0)
 . I $O(^OR(100,+ORDER,2,0)) Q  ;skip parent orders
"RTN","VPRSDAQ",146,0)
 . S ORDER=+ORDER,X3=$G(^OR(100,ORDER,3)),X4=$G(^(4))
"RTN","VPRSDAQ",147,0)
 . Q:$P(X3,U,3)=13  I X4["P",$P(X3,U,3)=1!($P(X3,U,3)=12) Q  ;cancelled
"RTN","VPRSDAQ",148,0)
 . Q:$P(X3,U,3)=14              ;lapsed
"RTN","VPRSDAQ",149,0)
 . I DG="RX",'$$RX(ORDER) Q     ;skip non-PS in RX group
"RTN","VPRSDAQ",150,0)
 . I DG="LAB",$$BB(ORDER) Q     ;skip blood bank in Lab
"RTN","VPRSDAQ",151,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=ORDER
"RTN","VPRSDAQ",152,0)
 K ^TMP("ORR",$J)
"RTN","VPRSDAQ",153,0)
 Q
"RTN","VPRSDAQ",154,0)
 ;
"RTN","VPRSDAQ",155,0)
RX(ORIFN) ; -- is order really a med? (non-PS order in display group)
"RTN","VPRSDAQ",156,0)
 N X,Y,PKG S Y=0
"RTN","VPRSDAQ",157,0)
 S X=$P($G(^OR(100,+$G(ORIFN),0)),U,14),PKG=$$GET1^DIQ(9.4,+X_",",1)
"RTN","VPRSDAQ",158,0)
 I $E(PKG,1,2)="PS" S Y=1
"RTN","VPRSDAQ",159,0)
 Q Y
"RTN","VPRSDAQ",160,0)
 ;
"RTN","VPRSDAQ",161,0)
BB(ORIFN) ; -- return 1 or 0, if order is for Blood Bank
"RTN","VPRSDAQ",162,0)
 N X,Y,DG S Y=0
"RTN","VPRSDAQ",163,0)
 S X=$P($G(^OR(100,+$G(ORIFN),0)),U,11),DG=$P($G(^ORD(100.98,+X,0)),U,3)
"RTN","VPRSDAQ",164,0)
 I DG="BB"!(DG?1"VB".E) S Y=1
"RTN","VPRSDAQ",165,0)
 Q Y
"RTN","VPRSDAQ",166,0)
 ;
"RTN","VPRSDAQ",167,0)
NONORD ; -- Other orders: not Lab, Rad, or Med
"RTN","VPRSDAQ",168,0)
 N ORDG,ORPKG,ORIGVIEW,ORLIST,VPRI,VPRN,ORDER,X
"RTN","VPRSDAQ",169,0)
 S ORDG=+$O(^ORD(100.98,"B","ALL",0)) D ORPKG ;get list of pkgs to exclude
"RTN","VPRSDAQ",170,0)
 S ORIGVIEW=2 ;get original view of order
"RTN","VPRSDAQ",171,0)
 D EN^ORQ1(DFN_";DPT(",ORDG,6,,DSTRT,DSTOP) S VPRN=0
"RTN","VPRSDAQ",172,0)
 S VPRI=0 F  S VPRI=$O(^TMP("ORR",$J,ORLIST,VPRI)) Q:VPRI<1  S ORDER=$G(^(VPRI)) D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",173,0)
 . I $P($P(ORDER,U),";",2)>1 Q         ;skip order actions
"RTN","VPRSDAQ",174,0)
 . Q:$P($G(^OR(100,+ORDER,3)),U,3)=14  ;skip lapsed orders
"RTN","VPRSDAQ",175,0)
 . S X=+$P($G(^OR(100,+ORDER,0)),U,14)
"RTN","VPRSDAQ",176,0)
 . I $D(ORPKG(X)) Q                    ;skip Lab,Rad,Med
"RTN","VPRSDAQ",177,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=+ORDER
"RTN","VPRSDAQ",178,0)
 K ^TMP("ORR",$J)
"RTN","VPRSDAQ",179,0)
 Q
"RTN","VPRSDAQ",180,0)
 ;
"RTN","VPRSDAQ",181,0)
ORPKG ; -- get list of pkgs to exclude
"RTN","VPRSDAQ",182,0)
 N NMSP,X
"RTN","VPRSDAQ",183,0)
 F NMSP="LR","RA","PSG","PSIV","PSJ","PSO","PSH" D
"RTN","VPRSDAQ",184,0)
 . S X=+$$FIND1^DIC(9.4,,"QX",NMSP,"C")
"RTN","VPRSDAQ",185,0)
 . S:X>0 ORPKG(X)=""
"RTN","VPRSDAQ",186,0)
 Q
"RTN","VPRSDAQ",187,0)
 ;
"RTN","VPRSDAQ",188,0)
CONSULTS ; -- Consult/Request Tracking
"RTN","VPRSDAQ",189,0)
 N VPRN,VPRX,GMRCDA,GMRCGRP,GMRCSEX,TITLE
"RTN","VPRSDAQ",190,0)
 D OER^GMRCSLM1(DFN,"",DSTRT,DSTOP,"") S VPRN=0
"RTN","VPRSDAQ",191,0)
 F  S VPRN=$O(^TMP("GMRCR",$J,"CS",VPRN)) Q:VPRN<1!(VPRN>DMAX)  D
"RTN","VPRSDAQ",192,0)
 . S VPRX=$G(^TMP("GMRCR",$J,"CS",VPRN,0)) Q:+VPRX<1
"RTN","VPRSDAQ",193,0)
 . S DLIST(VPRN)=+VPRX
"RTN","VPRSDAQ",194,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","VPRSDAQ",195,0)
 Q
"RTN","VPRSDAQ",196,0)
 ;
"RTN","VPRSDAQ",197,0)
CPROCS ; -- Clinical Procedures
"RTN","VPRSDAQ",198,0)
 N VPRN,VPRX,I,ID S VPRN=0
"RTN","VPRSDAQ",199,0)
 D MDPS1^VPRDJ03(DFN,DSTRT,DSTOP,DMAX) ;gets ^TMP("MDHSP",$J)
"RTN","VPRSDAQ",200,0)
 S I=0 F  S I=$O(^TMP("MDHSP",$J,I)) Q:I<1  S VPRX=$G(^(I)) I $P(VPRX,U,3)="PR702" D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",201,0)
 . S ^TMP("MDHSP",$J,"IEN",+$P(VPRX,U,2))=I
"RTN","VPRSDAQ",202,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=+$P(VPRX,U,2)
"RTN","VPRSDAQ",203,0)
 ;K ^TMP("MDHSP",$J)
"RTN","VPRSDAQ",204,0)
 Q
"RTN","VPRSDAQ",205,0)
 ;
"RTN","VPRSDAQ",206,0)
SURGERYS ; -- Surgeries
"RTN","VPRSDAQ",207,0)
 N VPRY,VPRN
"RTN","VPRSDAQ",208,0)
 D LIST^SROESTV(.VPRY,DFN,DSTRT,DSTOP,DMAX,1)
"RTN","VPRSDAQ",209,0)
 S VPRN=0 F  S VPRN=$O(@VPRY@(VPRN)) Q:VPRN<1  D
"RTN","VPRSDAQ",210,0)
 . Q:'$O(@VPRY@(VPRN,0))  ;no documents yet (so no enc#)
"RTN","VPRSDAQ",211,0)
 . S DLIST(VPRN)=+$G(@VPRY@(VPRN))
"RTN","VPRSDAQ",212,0)
 K @VPRY
"RTN","VPRSDAQ",213,0)
 Q
"RTN","VPRSDAQ",214,0)
 ;
"RTN","VPRSDAQ",215,0)
EXAMS ; -- V Exams (Physical Exams)
"RTN","VPRSDAQ",216,0)
 N FNUM S FNUM=9000010.13 G PXRM
"RTN","VPRSDAQ",217,0)
 ;
"RTN","VPRSDAQ",218,0)
HFACTORS ; -- V Health Factors (Health Concerns)
"RTN","VPRSDAQ",219,0)
 N FNUM S FNUM=9000010.23 G PXRM
"RTN","VPRSDAQ",220,0)
 ;
"RTN","VPRSDAQ",221,0)
CPT ; -- V CPT (Procedures)
"RTN","VPRSDAQ",222,0)
 N FNUM S FNUM=9000010.18 G PXRM
"RTN","VPRSDAQ",223,0)
 ;
"RTN","VPRSDAQ",224,0)
POV ; -- V POV (Diagnosis)
"RTN","VPRSDAQ",225,0)
 N FNUM S FNUM=9000010.07 G PXRM
"RTN","VPRSDAQ",226,0)
 ;
"RTN","VPRSDAQ",227,0)
PXRM ; -- Search PXRM index
"RTN","VPRSDAQ",228,0)
 N VPRSTART,VPRSTOP,VPRIDT,VPRN,ID
"RTN","VPRSDAQ",229,0)
 S VPRSTART=DSTRT,VPRSTOP=DSTOP,VPRN=0
"RTN","VPRSDAQ",230,0)
 D SORT^VPRDJ09 ;sort ^PXRMINDX into ^TMP("VPRPX",$J,IDT)
"RTN","VPRSDAQ",231,0)
 S VPRIDT=0 F  S VPRIDT=$O(^TMP("VPRPX",$J,VPRIDT)) Q:VPRIDT<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",232,0)
 . S ID=0 F  S ID=$O(^TMP("VPRPX",$J,VPRIDT,ID)) Q:ID<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",233,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=ID_U_$G(^TMP("VPRPX",$J,VPRIDT,ID))
"RTN","VPRSDAQ",234,0)
 .. ; DLIST(#) = ien ^ .01 ^ date ^ [coding system]
"RTN","VPRSDAQ",235,0)
 K ^TMP("VPRPX",$J)
"RTN","VPRSDAQ",236,0)
 Q
"RTN","VPRSDAQ",237,0)
 ;
"RTN","VPRSDAQ",238,0)
HFM ; -- V Health Factors, for Family History
"RTN","VPRSDAQ",239,0)
 N ITEM,DATE,DA,X,VPRN S VPRN=0
"RTN","VPRSDAQ",240,0)
 S ITEM=0 F  S ITEM=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM)) Q:ITEM<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",241,0)
 . S X=$P($G(^AUTTHF(+ITEM,0)),U) I X'["FAMILY HISTORY",X'["FAMILY HX" Q
"RTN","VPRSDAQ",242,0)
 . S DATE=DSTRT F  S DATE=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM,DATE)) Q:DATE<1!(DATE>DSTOP)  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",243,0)
 .. S DA=0 F  S DA=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM,DATE,DA)) Q:DA<1  S VPRN=VPRN+1,DLIST(VPRN)=DA_U_ITEM Q:VPRN'<DMAX
"RTN","VPRSDAQ",244,0)
 Q
"RTN","VPRSDAQ",245,0)
 ;
"RTN","VPRSDAQ",246,0)
HFS ; -- V Health Factors, for Social History
"RTN","VPRSDAQ",247,0)
 N ITEM,DATE,DA,VPRN S VPRN=0
"RTN","VPRSDAQ",248,0)
 S ITEM=0 F  S ITEM=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM)) Q:ITEM<1  I $$SOCHIST(ITEM) D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",249,0)
 . S DATE=DSTRT F  S DATE=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM,DATE)) Q:DATE<1!(DATE>DSTOP)  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",250,0)
 .. S DA=0 F  S DA=$O(^PXRMINDX(9000010.23,"PI",+$G(DFN),ITEM,DATE,DA)) Q:DA<1  S VPRN=VPRN+1,DLIST(VPRN)=DA_U_ITEM Q:VPRN'<DMAX
"RTN","VPRSDAQ",251,0)
 Q
"RTN","VPRSDAQ",252,0)
 ;
"RTN","VPRSDAQ",253,0)
SOCHIST(IEN) ; -- find social history factors
"RTN","VPRSDAQ",254,0)
 N X S X=$P($G(^AUTTHF(+IEN,0)),U)
"RTN","VPRSDAQ",255,0)
 I (X["TOBACCO")!(X["SMOK") Q 1
"RTN","VPRSDAQ",256,0)
 ;I (X["LIVES")!(X["LIVING") Q 1
"RTN","VPRSDAQ",257,0)
 ;I (X["RELIGIO")!(X["SPIRIT") Q 1
"RTN","VPRSDAQ",258,0)
 Q 0
"RTN","VPRSDAQ",259,0)
 ;
"RTN","VPRSDAQ",260,0)
WVPL ; -- Women's Health Pregnancy Log, for Social History
"RTN","VPRSDAQ",261,0)
 N DA,X0
"RTN","VPRSDAQ",262,0)
 S DA=$O(^WV(790.05,"C",DFN,""),-1) Q:'DA  ;last entry
"RTN","VPRSDAQ",263,0)
 S X0=$G(^WV(790.05,DA,0))
"RTN","VPRSDAQ",264,0)
 ; status=YES, future due date (allow past 14 days)
"RTN","VPRSDAQ",265,0)
 I $P(X0,U,3),$P(X0,U,4)'<$$FMADD^XLFDT(DT,-14) S DLIST(1)=DA
"RTN","VPRSDAQ",266,0)
 Q
"RTN","VPRSDAQ",267,0)
 ;
"RTN","VPRSDAQ",268,0)
IMMS ; -- Immunizations
"RTN","VPRSDAQ",269,0)
 N FNUM,VPRSTART,VPRSTOP,VPRIDT,VPRN,ID
"RTN","VPRSDAQ",270,0)
 S FNUM=9000010.11,VPRSTART=DSTRT,VPRSTOP=DSTOP,VPRN=0
"RTN","VPRSDAQ",271,0)
 D SORT^VPRDJ09 ;sort ^PXRMINDX into ^TMP("VPRPX",$J,IDT)
"RTN","VPRSDAQ",272,0)
 S VPRIDT=0 F  S VPRIDT=$O(^TMP("VPRPX",$J,VPRIDT)) Q:VPRIDT<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",273,0)
 . S ID=0 F  S ID=$O(^TMP("VPRPX",$J,VPRIDT,ID)) Q:ID<1  D    Q:VPRN'<DMAX
"RTN","VPRSDAQ",274,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=ID
"RTN","VPRSDAQ",275,0)
 K ^TMP("VPRPX",$J)
"RTN","VPRSDAQ",276,0)
 Q
"RTN","VPRSDAQ",277,0)
 ;
"RTN","VPRSDAQ",278,0)
VITALS ; -- GMR Vital Measurements
"RTN","VPRSDAQ",279,0)
 N GMRVSTR,VPRIDT,VPRTYP,ID,VPRN
"RTN","VPRSDAQ",280,0)
 S GMRVSTR="BP;T;R;P;HT;WT;CVP;CG;PO2;PN"
"RTN","VPRSDAQ",281,0)
 S GMRVSTR(0)=DSTRT_U_DSTOP_U_DMAX_"^1"
"RTN","VPRSDAQ",282,0)
 D EN1^GMRVUT0 S VPRN=0
"RTN","VPRSDAQ",283,0)
 S VPRIDT=0 F  S VPRIDT=$O(^UTILITY($J,"GMRVD",VPRIDT)) Q:VPRIDT<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",284,0)
 . S VPRTYP="" F  S VPRTYP=$O(^UTILITY($J,"GMRVD",VPRIDT,VPRTYP)) Q:VPRTYP=""  D
"RTN","VPRSDAQ",285,0)
 .. S ID=$O(^UTILITY($J,"GMRVD",VPRIDT,VPRTYP,0)) Q:'ID
"RTN","VPRSDAQ",286,0)
 .. S VPRN=VPRN+1,DLIST(VPRN)=ID
"RTN","VPRSDAQ",287,0)
 .. S ^TMP("VPRGMV",$J,ID)=$G(^UTILITY($J,"GMRVD",VPRIDT,VPRTYP,ID))
"RTN","VPRSDAQ",288,0)
 K ^UTILITY($J,"GMRVD")
"RTN","VPRSDAQ",289,0)
 Q
"RTN","VPRSDAQ",290,0)
 ;
"RTN","VPRSDAQ",291,0)
APPTS ; -- Appointments
"RTN","VPRSDAQ",292,0)
 N VPRX,VPRNUM,VPRDT,VPRN
"RTN","VPRSDAQ",293,0)
 S VPRX(1)=DSTRT_";"_DSTOP,VPRX(4)=DFN
"RTN","VPRSDAQ",294,0)
 S VPRX("FLDS")="1;2;3;10;11",VPRX("SORT")="P"
"RTN","VPRSDAQ",295,0)
 ; appointments
"RTN","VPRSDAQ",296,0)
 S VPRX(3)="R;I;NS;NSR;NT" ;no cancelled appt's
"RTN","VPRSDAQ",297,0)
 S VPRNUM=$$SDAPI^SDAMA301(.VPRX),(VPRDT,VPRN)=0
"RTN","VPRSDAQ",298,0)
 F  S VPRDT=$O(^TMP($J,"SDAMA301",DFN,VPRDT)) Q:VPRDT<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",299,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=VPRDT_","_DFN ;^TMP($J,"SDAMA301",DFN,VPRDT)
"RTN","VPRSDAQ",300,0)
 ;K ^TMP($J,"SDAMA301",DFN)
"RTN","VPRSDAQ",301,0)
 Q
"RTN","VPRSDAQ",302,0)
 ;
"RTN","VPRSDAQ",303,0)
SCHADMS ; -- Scheduled Admissions
"RTN","VPRSDAQ",304,0)
 N VPRA,VPRN S VPRN=0
"RTN","VPRSDAQ",305,0)
 S VPRA=0 F  S VPRA=$O(^DGS(41.1,"B",DFN,VPRA)) Q:VPRA<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",306,0)
 . S VPRX=$G(^DGS(41.1,VPRA,0))
"RTN","VPRSDAQ",307,0)
 . S X=$P(VPRX,U,2) Q:X<DSTRT!(X>DSTOP)  ;out of date range
"RTN","VPRSDAQ",308,0)
 . Q:$P(VPRX,U,13)  ;Q:$P(VPRX,U,17)     ;cancelled or admitted
"RTN","VPRSDAQ",309,0)
 . S VPRN=VPRN+1,DLIST(VPRN)=VPRA
"RTN","VPRSDAQ",310,0)
 Q
"RTN","VPRSDAQ",311,0)
 ;
"RTN","VPRSDAQ",312,0)
INS ; -- Insurance
"RTN","VPRSDAQ",313,0)
 N NUM,I,VPRDT,VPRSTS,VPRX
"RTN","VPRSDAQ",314,0)
 S VPRSTS=$G(FILTER("status"),"RB"),VPRDT=DT
"RTN","VPRSDAQ",315,0)
 I VPRSTS["A" S VPRDT="" ;no date if requesting inactive policies
"RTN","VPRSDAQ",316,0)
 S:$G(DFN) NUM=$$INSUR^IBBAPI(DFN,VPRDT,VPRSTS,.VPRX,"*") Q:NUM<1
"RTN","VPRSDAQ",317,0)
 S I=0 F  S I=$O(VPRX("IBBAPI","INSUR",I)) Q:I<1  S DLIST(I)=I
"RTN","VPRSDAQ",318,0)
 M VPRINS=VPRX("IBBAPI","INSUR")
"RTN","VPRSDAQ",319,0)
 Q
"RTN","VPRSDAQ",320,0)
 ;
"RTN","VPRSDAQ",321,0)
PRF ; -- Patient Record Flags
"RTN","VPRSDAQ",322,0)
 N NUM,I,IEN
"RTN","VPRSDAQ",323,0)
 S:$G(DFN) NUM=$$GETACT^DGPFAPI(DFN,"VPRF")
"RTN","VPRSDAQ",324,0)
 S I=0 F  S I=$O(VPRF(I)) Q:I<1  I $G(VPRF(I,"CATEGORY"))["NATIONAL" D
"RTN","VPRSDAQ",325,0)
 . S IEN=+$G(VPRF(I,"FLAG")) Q:IEN<1
"RTN","VPRSDAQ",326,0)
 . S DLIST(I)=IEN_"~"_DFN,VPRF("IDX",IEN)=I
"RTN","VPRSDAQ",327,0)
 Q
"RTN","VPRSDAQ",328,0)
 ;
"RTN","VPRSDAQ",329,0)
PTF ; -- PTF DXLS via ^PXRMINDX(45,"ICD","PNI",DFN,"DXLS",ICD,DATE,DA)
"RTN","VPRSDAQ",330,0)
 N VPRSTART,VPRSTOP,VPRIDT,VPRN,ID,X,P80
"RTN","VPRSDAQ",331,0)
 S VPRSTART=DSTRT,VPRSTOP=DSTOP,VPRN=0
"RTN","VPRSDAQ",332,0)
 D PTF^VPRDJ09 ;sort ^PXRMINDX into ^TMP("VPRPX",$J,IDT)
"RTN","VPRSDAQ",333,0)
 S VPRIDT=0 F  S VPRIDT=$O(^TMP("VPRPX",$J,VPRIDT)) Q:VPRIDT<1  D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",334,0)
 . S ID=0 F  S ID=$O(^TMP("VPRPX",$J,VPRIDT,ID)) Q:ID<1  I ID["DXLS" D  Q:VPRN'<DMAX
"RTN","VPRSDAQ",335,0)
 .. S X=$G(^TMP("VPRPX",$J,VPRIDT,ID)),P80=$$CODEBA^ICDEX($P(X,U),80)
"RTN","VPRSDAQ",336,0)
 .. S:P80>0 VPRN=VPRN+1,DLIST(VPRN)=+ID_U_P80_U_$P(X,U,2,3)
"RTN","VPRSDAQ",337,0)
 .. ; DLIST(#) = ien ^ ICD ptr ^ date ^ [coding system]
"RTN","VPRSDAQ",338,0)
 K ^TMP("VPRPX",$J)
"RTN","VPRSDAQ",339,0)
 Q
"RTN","VPRSDAQ",340,0)
 ;
"RTN","VPRSDAQ",341,0)
FIM ; -- Functional Independence Measurements
"RTN","VPRSDAQ",342,0)
 N VPRS,VPRN,VPRY,ADM,VPRCNT,RMIMTIME
"RTN","VPRSDAQ",343,0)
 D PRM^RMIMRP(.VPRSITE) Q:'$O(VPRSITE(1))
"RTN","VPRSDAQ",344,0)
 S DFN=+$G(DFN) Q:DFN<1
"RTN","VPRSDAQ",345,0)
 S VPRCNT=0
"RTN","VPRSDAQ",346,0)
 S VPRS=1 F  S VPRS=$O(VPRSITE(VPRS)) Q:VPRS<1  D
"RTN","VPRSDAQ",347,0)
 . S VPRN=DFN_U_VPRSITE(VPRS)
"RTN","VPRSDAQ",348,0)
 . D LC^RMIMRP(.VPRY,VPRN) Q:VPRY(1)<1
"RTN","VPRSDAQ",349,0)
 . S VPRN=1 F  S VPRN=$O(VPRY(VPRN)) Q:VPRN<1  D  Q:VPRCNT'<DMAX
"RTN","VPRSDAQ",350,0)
 .. S ADM=$$DATE($P(VPRY(VPRN),U,4)) Q:ADM<DSTRT  Q:ADM>DSTOP
"RTN","VPRSDAQ",351,0)
 .. S VPRCNT=VPRCNT+1,DLIST(VPRCNT)=+VPRY(VPRN)
"RTN","VPRSDAQ",352,0)
 Q
"RTN","VPRSDAQ",353,0)
 ;
"RTN","VPRSDAQ",354,0)
DATE(X) ; -- Return internal form of date X
"RTN","VPRSDAQ",355,0)
 N %DT,Y
"RTN","VPRSDAQ",356,0)
 S %DT="" D ^%DT S:Y<1 Y=X
"RTN","VPRSDAQ",357,0)
 Q Y
"RTN","VPRSDAR")
0^3^B16670259^B9382651
"RTN","VPRSDAR",1,0)
VPRSDAR ;SLC/MKB -- SDA Radiology utilities ;8/6/18  12:21
"RTN","VPRSDAR",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRSDAR",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","VPRSDAR",4,0)
 ;
"RTN","VPRSDAR",5,0)
 ; External References          DBIA#
"RTN","VPRSDAR",6,0)
 ; -------------------          -----
"RTN","VPRSDAR",7,0)
 ; ^OR(100                       5771
"RTN","VPRSDAR",8,0)
 ; ^RADPT                   2480,2588
"RTN","VPRSDAR",9,0)
 ; ^RARPT                        5605
"RTN","VPRSDAR",10,0)
 ; DIQ                           2056
"RTN","VPRSDAR",11,0)
 ; RAO7PC1                  2043,2265
"RTN","VPRSDAR",12,0)
 ; RAO7PC3                       2877
"RTN","VPRSDAR",13,0)
 ;
"RTN","VPRSDAR",14,0)
PRE ; -- PreProcessing for VPR RAD ORDER
"RTN","VPRSDAR",15,0)
 ;  Expects DFN, DSTRT, DSTOP, DMAX from EN^DDEGET
"RTN","VPRSDAR",16,0)
 N BEG,END,MAX,RAORD
"RTN","VPRSDAR",17,0)
 S BEG=$G(DSTRT),END=$G(DSTOP),MAX=$G(DMAX)_"P"
"RTN","VPRSDAR",18,0)
 I $G(ID) D  ;reset for one order
"RTN","VPRSDAR",19,0)
 . S RAORD=+$G(^OR(100,+ID,4)) S:'DFN DFN=+$P($G(^(0)),U,2)
"RTN","VPRSDAR",20,0)
 . S IDT=$O(^RADPT("AO",RAORD,DFN,0))
"RTN","VPRSDAR",21,0)
 . S:IDT (BEG,END)=9999999.9999-IDT
"RTN","VPRSDAR",22,0)
 K ^TMP($J,"RAE1") D EN1^RAO7PC1(DFN,BEG,END,MAX)
"RTN","VPRSDAR",23,0)
 Q
"RTN","VPRSDAR",24,0)
 ;
"RTN","VPRSDAR",25,0)
POST ; -- PostProcessing for VPR RAD ORDER
"RTN","VPRSDAR",26,0)
 K ^TMP($J,"RAE1",DFN),^TMP($J,"RAE2",DFN)
"RTN","VPRSDAR",27,0)
 K VPRAE1,VPRAE2,RARPT,RAPROC,ORPK
"RTN","VPRSDAR",28,0)
 Q
"RTN","VPRSDAR",29,0)
 ;
"RTN","VPRSDAR",30,0)
ONE(RAID) ; -- ID Processing for each VPR RAD RESULT (RAID = #75.1 ien)
"RTN","VPRSDAR",31,0)
 ;  Returns VPRAE1 = ^TMP($J,"RAE1",DFN,Exam ID)
"RTN","VPRSDAR",32,0)
 ;          VPRAE2 = $NA(^TMP($J,"RAE2",DFN,caseIEN,procedureName))
"RTN","VPRSDAR",33,0)
 ;          RARPT  = Report #74 IEN
"RTN","VPRSDAR",34,0)
 ;          RAPROC = Procedure name
"RTN","VPRSDAR",35,0)
 ;          RAID   = #70.03 IEN string
"RTN","VPRSDAR",36,0)
 ;
"RTN","VPRSDAR",37,0)
 N IDT,CASE,EXAM,TYPE
"RTN","VPRSDAR",38,0)
 S IDT=+$O(^RADPT("AO",+$G(RAID),DFN,0)),CASE=+$O(^(IDT,0))
"RTN","VPRSDAR",39,0)
 I CASE<1 S DDEOUT=1 Q
"RTN","VPRSDAR",40,0)
 S EXAM=IDT_"-"_CASE K RARPT
"RTN","VPRSDAR",41,0)
 ; get [1st] exam node
"RTN","VPRSDAR",42,0)
 S VPRAE1=$G(^TMP($J,"RAE1",DFN,EXAM)),STS=$P(VPRAE1,U,3)
"RTN","VPRSDAR",43,0)
 I STS="No Report"!(STS="Deleted")!(STS["Draft")!(STS["Released/Not") S DDEOUT=1 Q
"RTN","VPRSDAR",44,0)
 S RARPT=+$P(VPRAE1,U,5) I RARPT<1 S DDEOUT=1 Q
"RTN","VPRSDAR",45,0)
 ; get report details for [1st] exam/case, save array name for reference
"RTN","VPRSDAR",46,0)
 K ^TMP($J,"RAE2") D EN30^RAO7PC1(RAID)
"RTN","VPRSDAR",47,0)
 I '$D(^TMP($J,"RAE2",DFN,CASE)) S DDEOUT=1 Q
"RTN","VPRSDAR",48,0)
 S VPRAE2=$Q(^TMP($J,"RAE2",DFN)),RAID=CASE_","_IDT_","_DFN
"RTN","VPRSDAR",49,0)
 ; get procedure for DocumentName, list of report iens if examset
"RTN","VPRSDAR",50,0)
 S TYPE=$G(^TMP($J,"RAE1",DFN,EXAM,"CPRS"))
"RTN","VPRSDAR",51,0)
 I +TYPE=0 S RAPROC=$P(VPRAE1,U)    ;1 case/report
"RTN","VPRSDAR",52,0)
 I +TYPE=2 S RAPROC=$P(TYPE,U,2)    ;1 report (print set)
"RTN","VPRSDAR",53,0)
 I +TYPE=1 S RAPROC=$P(TYPE,U,2) D  ;exam set
"RTN","VPRSDAR",54,0)
 . N RAE1,RPT S RARPT(CASE)=RARPT_";RA"
"RTN","VPRSDAR",55,0)
 . F  S CASE=$O(^TMP($J,"RAE2",DFN,CASE)) Q:CASE<1  D
"RTN","VPRSDAR",56,0)
 .. S EXAM=IDT_"-"_CASE
"RTN","VPRSDAR",57,0)
 .. S RAE1=$G(^TMP($J,"RAE1",DFN,EXAM)),STS=$P(RAE1,U,3)
"RTN","VPRSDAR",58,0)
 .. Q:STS="No Report"!(STS="Deleted")!(STS["Draft")!(STS["Released/Not")
"RTN","VPRSDAR",59,0)
 .. S RPT=+$P(RAE1,U,5) S:RPT RARPT(CASE)=RPT_";RA"
"RTN","VPRSDAR",60,0)
 Q
"RTN","VPRSDAR",61,0)
 ;
"RTN","VPRSDAR",62,0)
ABN() ; -- return "A" if any report for exam(s) is abnormal, else null
"RTN","VPRSDAR",63,0)
 N X,Y,CASE S Y=""
"RTN","VPRSDAR",64,0)
 I $D(RARPT)<9 D  Q Y
"RTN","VPRSDAR",65,0)
 . S Y=$S($P(VPRAE1,U,4)="Y":"A",$P(VPRAE1,U,9)="Y":"A",1:"")
"RTN","VPRSDAR",66,0)
 S CASE=0 F  S CASE=$O(^TMP($J,"RAE2",DFN,CASE)) Q:CASE<1  D  Q:$L(Y)
"RTN","VPRSDAR",67,0)
 . S X=$Q(^TMP($J,"RAE2",DFN,CASE))
"RTN","VPRSDAR",68,0)
 . S:$P(@X,U,2)="Y" Y="A"
"RTN","VPRSDAR",69,0)
 Q Y
"RTN","VPRSDAR",70,0)
 ;
"RTN","VPRSDAR",71,0)
 ; -- for Documents container:
"RTN","VPRSDAR",72,0)
 ;
"RTN","VPRSDAR",73,0)
RPTS ; -- find patient's radiology reports
"RTN","VPRSDAR",74,0)
 N VPRN,VPRXID,STS,RARPT
"RTN","VPRSDAR",75,0)
 S DFN=+$G(DFN) Q:DFN<1
"RTN","VPRSDAR",76,0)
 K ^TMP($J,"RAE1") D EN1^RAO7PC1(DFN,DSTRT,DSTOP,DMAX_"P")
"RTN","VPRSDAR",77,0)
 S VPRN=0 ; VPRXID = invdate.time-caseIEN
"RTN","VPRSDAR",78,0)
 S VPRXID="" F  S VPRXID=$O(^TMP($J,"RAE1",DFN,VPRXID)) Q:VPRXID=""  D
"RTN","VPRSDAR",79,0)
 . S STS=$P($G(^TMP($J,"RAE1",DFN,VPRXID)),U,3),RARPT=+$P($G(^(VPRXID)),U,5)
"RTN","VPRSDAR",80,0)
 . Q:STS="No Report"!(STS="Deleted")!(STS["Draft")!(STS["Released/Not")
"RTN","VPRSDAR",81,0)
 . Q:RARPT<1  Q:$D(RARPT(RARPT))  ;already have report, for sets
"RTN","VPRSDAR",82,0)
 . S VPRN=+$G(VPRN)+1,DLIST(VPRN)=RARPT_"~"_VPRXID
"RTN","VPRSDAR",83,0)
 . S RARPT(+RARPT)=""
"RTN","VPRSDAR",84,0)
 K ^TMP($J,"RAE1")
"RTN","VPRSDAR",85,0)
 Q
"RTN","VPRSDAR",86,0)
 ;
"RTN","VPRSDAR",87,0)
RPT1 ; -- ID Processing for each VPR RAD REPORT
"RTN","VPRSDAR",88,0)
 ;  Returns VPRXID = Exam-Case ID
"RTN","VPRSDAR",89,0)
 ;          VPRAE2 = $NA(^TMP($J,"RAE2",DFN,caseIEN,procedureName))
"RTN","VPRSDAR",90,0)
 ;          VPRAE3 = $NA(^TMP($J,"RAE3",DFN,caseIEN,procedureName))
"RTN","VPRSDAR",91,0)
 ;          RAPROC = Procedure name
"RTN","VPRSDAR",92,0)
 ;
"RTN","VPRSDAR",93,0)
 N RA0,X
"RTN","VPRSDAR",94,0)
 S VPRXID=$P(DIEN,"~",2),DIEN=+$P(DIEN,"~")
"RTN","VPRSDAR",95,0)
 S RA0=$G(^RARPT(DIEN,0)) S:DFN<1 DFN=+$P(RA0,U,2)
"RTN","VPRSDAR",96,0)
 I 'VPRXID D
"RTN","VPRSDAR",97,0)
 . N I S VPRXID=9999999.9999-$P(RA0,U,3),I=0
"RTN","VPRSDAR",98,0)
 . F  S I=$O(^RADPT(DFN,"DT",VPRXID,"P",I)) Q:I<1  I $P($G(^(I,0)),U,17)=DIEN S VPRXID=VPRXID_"-"_I Q
"RTN","VPRSDAR",99,0)
 I $L(VPRXID,"-")<2 S DDEOUT=1 Q
"RTN","VPRSDAR",100,0)
 S X=DFN_U_$TR(VPRXID,"-","^") D
"RTN","VPRSDAR",101,0)
 . N DFN,RACNT,RAMDIV,RAWHOVER,RAPRTSET
"RTN","VPRSDAR",102,0)
 . K ^TMP($J,"RAE2"),^TMP($J,"RAE3")
"RTN","VPRSDAR",103,0)
 . D EN3^RAO7PC1(X),EN3^RAO7PC3(X)
"RTN","VPRSDAR",104,0)
 S VPRAE2=$Q(^TMP($J,"RAE2",DFN)),VPRAE3=$Q(^TMP($J,"RAE3",DFN))
"RTN","VPRSDAR",105,0)
 ; get [ordered] procedure for document name
"RTN","VPRSDAR",106,0)
 I $D(^TMP($J,"RAE3",DFN,"PRINT_SET")) S RAPROC=$G(^("ORD"))
"RTN","VPRSDAR",107,0)
 E  S RAPROC=$QS(VPRAE3,5)
"RTN","VPRSDAR",108,0)
 Q
"RTN","VPRSDAR",109,0)
 ;
"RTN","VPRSDAR",110,0)
VNUM(DFN,EXAMID) ; -- return Visit# for patient, examID
"RTN","VPRSDAR",111,0)
 N I,IDT,IENS,Y
"RTN","VPRSDAR",112,0)
 S I=+$P(EXAMID,"-",2),IDT=$P(EXAMID,"-"),IENS=I_","_IDT_","_DFN_","
"RTN","VPRSDAR",113,0)
 S Y=$$GET1^DIQ(70.03,IENS,27,"I")
"RTN","VPRSDAR",114,0)
 Q Y
"RTN","VPRSR")
0^4^B1588116^B1400443
"RTN","VPRSR",1,0)
VPRSR ;SLC/MKB -- Surgery interface ;10/25/18  15:29
"RTN","VPRSR",2,0)
 ;;1.0;VIRTUAL PATIENT RECORD;**8,10**;Sep 01, 2011;Build 16
"RTN","VPRSR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","VPRSR",4,0)
 ;
"RTN","VPRSR",5,0)
 ; Supported by DBIA #4750
"RTN","VPRSR",6,0)
 ;
"RTN","VPRSR",7,0)
 ; External References          DBIA#
"RTN","VPRSR",8,0)
 ; -------------------          -----
"RTN","VPRSR",9,0)
 ; DIQ                           2056
"RTN","VPRSR",10,0)
 ; SROESTV                       3533
"RTN","VPRSR",11,0)
 ;
"RTN","VPRSR",12,0)
 ; ---------------- Update Triggers ----------------
"RTN","VPRSR",13,0)
 ;
"RTN","VPRSR",14,0)
NEW(IEN,DFN,STS) ; -- new surgery request [from SROERR]
"RTN","VPRSR",15,0)
 Q  ;don't want until completed
"RTN","VPRSR",16,0)
 S IEN=+$G(IEN),DFN=+$G(DFN) Q:DFN<1
"RTN","VPRSR",17,0)
 D POST^VPRHS(DFN,"Procedure",IEN_";130")
"RTN","VPRSR",18,0)
 Q
"RTN","VPRSR",19,0)
 ;
"RTN","VPRSR",20,0)
UPD(IEN,DFN,STS) ; -- updated surgery request [from SROERR0]
"RTN","VPRSR",21,0)
 S IEN=+$G(IEN),DFN=+$G(DFN) Q:DFN<1  Q:$G(STS)'["COMPLETED"
"RTN","VPRSR",22,0)
 N VPRSR,I,SRDOC,VST
"RTN","VPRSR",23,0)
 D ONE^SROESTV("VPRSR",IEN)
"RTN","VPRSR",24,0)
 S I=$O(VPRSR(IEN,0)),SRDOC=+$G(VPRSR(IEN,I)) Q:'SRDOC
"RTN","VPRSR",25,0)
 S VST=$$GET1^DIQ(8925,SRDOC,.03,"I")
"RTN","VPRSR",26,0)
 D:VST POST^VPRHS(DFN,"Procedure",IEN_";130",,VST)
"RTN","VPRSR",27,0)
 Q
"RTN","VPRSR",28,0)
 ;
"RTN","VPRSR",29,0)
DEL(IEN,DFN) ; -- delete surgery request [from SROERR]
"RTN","VPRSR",30,0)
 S IEN=+$G(IEN),DFN=+$G(DFN) Q:DFN<1
"RTN","VPRSR",31,0)
 D POST^VPRHS(DFN,"Procedure",IEN_";130","@")
"RTN","VPRSR",32,0)
 Q
"VER")
8.0^22.2
"BLD",9472,6)
^12
**END**
**END**

