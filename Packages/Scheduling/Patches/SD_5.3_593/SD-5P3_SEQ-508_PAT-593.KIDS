Released SD*5.3*593 SEQ #508
Extracted from mail message
**KIDS**:SD*5.3*593^

**INSTALL NAME**
SD*5.3*593
"BLD",8837,0)
SD*5.3*593^SCHEDULING^0^3131001^y
"BLD",8837,1,0)
^^2^2^3120227^
"BLD",8837,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",8837,1,2,0)
included in this patch.
"BLD",8837,4,0)
^9.64PA^^
"BLD",8837,6)
4^
"BLD",8837,6.3)
13
"BLD",8837,"ABPKG")
n
"BLD",8837,"INID")
^
"BLD",8837,"INIT")
EN^SC593PST
"BLD",8837,"KRN",0)
^9.67PA^779.2^20
"BLD",8837,"KRN",.4,0)
.4
"BLD",8837,"KRN",.401,0)
.401
"BLD",8837,"KRN",.402,0)
.402
"BLD",8837,"KRN",.403,0)
.403
"BLD",8837,"KRN",.5,0)
.5
"BLD",8837,"KRN",.84,0)
.84
"BLD",8837,"KRN",3.6,0)
3.6
"BLD",8837,"KRN",3.8,0)
3.8
"BLD",8837,"KRN",9.2,0)
9.2
"BLD",8837,"KRN",9.8,0)
9.8
"BLD",8837,"KRN",9.8,"NM",0)
^9.68A^17^17
"BLD",8837,"KRN",9.8,"NM",1,0)
SCRPW14^^0^B36855976
"BLD",8837,"KRN",9.8,"NM",2,0)
SCRPW15^^0^B68454595
"BLD",8837,"KRN",9.8,"NM",3,0)
SCRPW20^^0^B69405288
"BLD",8837,"KRN",9.8,"NM",4,0)
SCRPW22^^0^B57142560
"BLD",8837,"KRN",9.8,"NM",5,0)
SCRPW23^^0^B56596794
"BLD",8837,"KRN",9.8,"NM",6,0)
SCRPW24^^0^B79566588
"BLD",8837,"KRN",9.8,"NM",7,0)
SCRPW27^^0^B63466890
"BLD",8837,"KRN",9.8,"NM",8,0)
SCRPW29^^0^B76811710
"BLD",8837,"KRN",9.8,"NM",9,0)
SCRPW40^^0^B74686227
"BLD",8837,"KRN",9.8,"NM",10,0)
SCRPW45^^0^B59142095
"BLD",8837,"KRN",9.8,"NM",11,0)
SCRPW46^^0^B82059518
"BLD",8837,"KRN",9.8,"NM",12,0)
SCRPW47^^0^B65269594
"BLD",8837,"KRN",9.8,"NM",13,0)
SCRPW57^^0^B30255024
"BLD",8837,"KRN",9.8,"NM",14,0)
SCMSVDG1^^0^B6087884
"BLD",8837,"KRN",9.8,"NM",15,0)
SCMSVUT1^^0^B69624796
"BLD",8837,"KRN",9.8,"NM",16,0)
SCRPWICD^^0^B396688
"BLD",8837,"KRN",9.8,"NM",17,0)
SC593PST^^0^B614440
"BLD",8837,"KRN",9.8,"NM","B","SC593PST",17)

"BLD",8837,"KRN",9.8,"NM","B","SCMSVDG1",14)

"BLD",8837,"KRN",9.8,"NM","B","SCMSVUT1",15)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW14",1)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW15",2)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW20",3)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW22",4)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW23",5)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW24",6)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW27",7)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW29",8)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW40",9)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW45",10)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW46",11)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW47",12)

"BLD",8837,"KRN",9.8,"NM","B","SCRPW57",13)

"BLD",8837,"KRN",9.8,"NM","B","SCRPWICD",16)

"BLD",8837,"KRN",19,0)
19
"BLD",8837,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",8837,"KRN",19,"NM",1,0)
SCRPW DVM DX FREQUENCY^^0
"BLD",8837,"KRN",19,"NM",2,0)
SCRPW DVM IP DX FREQUENCY^^0
"BLD",8837,"KRN",19,"NM","B","SCRPW DVM DX FREQUENCY",1)

"BLD",8837,"KRN",19,"NM","B","SCRPW DVM IP DX FREQUENCY",2)

"BLD",8837,"KRN",19.1,0)
19.1
"BLD",8837,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8837,"KRN",101,0)
101
"BLD",8837,"KRN",409.61,0)
409.61
"BLD",8837,"KRN",771,0)
771
"BLD",8837,"KRN",779.2,0)
779.2
"BLD",8837,"KRN",870,0)
870
"BLD",8837,"KRN",8989.51,0)
8989.51
"BLD",8837,"KRN",8989.52,0)
8989.52
"BLD",8837,"KRN",8994,0)
8994
"BLD",8837,"KRN","B",.4,.4)

"BLD",8837,"KRN","B",.401,.401)

"BLD",8837,"KRN","B",.402,.402)

"BLD",8837,"KRN","B",.403,.403)

"BLD",8837,"KRN","B",.5,.5)

"BLD",8837,"KRN","B",.84,.84)

"BLD",8837,"KRN","B",3.6,3.6)

"BLD",8837,"KRN","B",3.8,3.8)

"BLD",8837,"KRN","B",9.2,9.2)

"BLD",8837,"KRN","B",9.8,9.8)

"BLD",8837,"KRN","B",19,19)

"BLD",8837,"KRN","B",19.1,19.1)

"BLD",8837,"KRN","B",101,101)

"BLD",8837,"KRN","B",409.61,409.61)

"BLD",8837,"KRN","B",771,771)

"BLD",8837,"KRN","B",779.2,779.2)

"BLD",8837,"KRN","B",870,870)

"BLD",8837,"KRN","B",8989.51,8989.51)

"BLD",8837,"KRN","B",8989.52,8989.52)

"BLD",8837,"KRN","B",8994,8994)

"BLD",8837,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8837,"QUES",0)
^9.62^^
"BLD",8837,"REQB",0)
^9.611^11^10
"BLD",8837,"REQB",1,0)
LEX*2.0*80^1
"BLD",8837,"REQB",2,0)
ICD*18.0*57^1
"BLD",8837,"REQB",3,0)
DG*5.3*850^1
"BLD",8837,"REQB",4,0)
SD*5.3*171^1
"BLD",8837,"REQB",5,0)
SD*5.3*409^1
"BLD",8837,"REQB",6,0)
SD*5.3*442^1
"BLD",8837,"REQB",7,0)
SD*5.3*466^1
"BLD",8837,"REQB",8,0)
SD*5.3*474^1
"BLD",8837,"REQB",9,0)
SD*5.3*556^1
"BLD",8837,"REQB",11,0)
SD*5.3*576^1
"BLD",8837,"REQB","B","DG*5.3*850",3)

"BLD",8837,"REQB","B","ICD*18.0*57",2)

"BLD",8837,"REQB","B","LEX*2.0*80",1)

"BLD",8837,"REQB","B","SD*5.3*171",4)

"BLD",8837,"REQB","B","SD*5.3*409",5)

"BLD",8837,"REQB","B","SD*5.3*442",6)

"BLD",8837,"REQB","B","SD*5.3*466",7)

"BLD",8837,"REQB","B","SD*5.3*474",8)

"BLD",8837,"REQB","B","SD*5.3*556",9)

"BLD",8837,"REQB","B","SD*5.3*576",11)

"INIT")
EN^SC593PST
"KRN",19,8315,-1)
0^1
"KRN",19,8315,0)
SCRPW DVM DX FREQUENCY^Most Frequent 50 ICD Diagnosis Codes (OP7)^^R^^^^^^^^SCHEDULING
"KRN",19,8315,1,0)
^19.06^2^2^3131001^^^^
"KRN",19,8315,1,1,0)
Option for listing the 50 most frequent diagnoses with associated provider
"KRN",19,8315,1,2,0)
type frequency in a format that matches the Austin OP7 report.
"KRN",19,8315,25)
SCRPW57
"KRN",19,8315,"U")
MOST FREQUENT 50 ICD DIAGNOSIS
"KRN",19,10595,-1)
0^2
"KRN",19,10595,0)
SCRPW DVM IP DX FREQUENCY^Most Frequent 50 IP ICD Diagnosis Codes (IP7)^^R^^^^^^^^SCHEDULING^^1^1
"KRN",19,10595,1,0)
^19.06^3^3^3131001^^^
"KRN",19,10595,1,1,0)
Option for listing the 50 most frequent inpatient diagnoses with
"KRN",19,10595,1,2,0)
associated provider type frequency in a format that matches the Austin IP7
"KRN",19,10595,1,3,0)
report.
"KRN",19,10595,15)
K SDSTA
"KRN",19,10595,20)
S SDSTA=8
"KRN",19,10595,25)
SCRPW57
"KRN",19,10595,"U")
MOST FREQUENT 50 IP ICD DIAGNO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,20,0)
^9.402P^^
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^2930813^2960613
"PKG",48,22,1,"PAH",1,0)
593^3131001^2501
"PKG",48,22,1,"PAH",1,1,0)
^^2^2^3131001
"PKG",48,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",48,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","SC593PST")
0^17^B614440^n/a
"RTN","SC593PST",1,0)
SC593PST ;HINES/LAI - POST INIT ROUTINE FOR PATCH 593;2/27/2012
"RTN","SC593PST",2,0)
 ;;5.3;Scheduling;**593**;Aug 13, 1993;Build 13
"RTN","SC593PST",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","SC593PST",4,0)
 ;
"RTN","SC593PST",5,0)
 ; This post-init routine modifies the narrative description
"RTN","SC593PST",6,0)
 ; for error codes 500 and 5000 in file 409.76.
"RTN","SC593PST",7,0)
 ;
"RTN","SC593PST",8,0)
EN N DA,DR,DIE
"RTN","SC593PST",9,0)
 S SCDESC="Diagnosis code (ICD) is missing or invalid"
"RTN","SC593PST",10,0)
 S DA="" F I="500","5000" S DA=$O(^SD(409.76,"B",I,"")) Q:'DA  D
"RTN","SC593PST",11,0)
 .L +^SD(409.76,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","SC593PST",12,0)
 .S DIE="^SD(409.76,",DR="11///^S X=SCDESC" D ^DIE
"RTN","SC593PST",13,0)
 .L -^SD(409.76,DA)
"RTN","SC593PST",14,0)
 K DA,DR,DIE,SCDESC,I
"RTN","SC593PST",15,0)
 Q
"RTN","SC593PST",16,0)
 ;
"RTN","SCMSVDG1")
0^14^B6087884^B6097699
"RTN","SCMSVDG1",1,0)
SCMSVDG1 ;ALB/ESD - HL7 DG1 Segment Validation ;05/08/95
"RTN","SCMSVDG1",2,0)
 ;;5.3;Scheduling;**44,57,68,77,85,95,66,593**;Aug 13, 1993;Build 13
"RTN","SCMSVDG1",3,0)
 ;
"RTN","SCMSVDG1",4,0)
 ;
"RTN","SCMSVDG1",5,0)
EN(DG1ARRY,HLQ,HLFS,ENCPTR,VALERR,ENCDT) ;
"RTN","SCMSVDG1",6,0)
 ; Entry point to return the HL7 DG1 (Outpatient Diagnosis) validation segment
"RTN","SCMSVDG1",7,0)
 ;
"RTN","SCMSVDG1",8,0)
 ;  Input:  DG1ARRY - Array of DG1 Segments
"RTN","SCMSVDG1",9,0)
 ;              HLQ - HL7 null variable
"RTN","SCMSVDG1",10,0)
 ;             HLFS - HL7 field separator
"RTN","SCMSVDG1",11,0)
 ;           ENCPTR - Outpatient Encounter IEN (file #409.68)
"RTN","SCMSVDG1",12,0)
 ;           VALERR - The array name to put error messages in
"RTN","SCMSVDG1",13,0)
 ;            ENCDT - The date of the encounter
"RTN","SCMSVDG1",14,0)
 ;
"RTN","SCMSVDG1",15,0)
 ; Output:  1 if DG1 passed validity check
"RTN","SCMSVDG1",16,0)
 ;          Error message if DG1 failed validity check in form of:
"RTN","SCMSVDG1",17,0)
 ;          -1^"xxx failed validity check" (xxx=element in DG1 segment)
"RTN","SCMSVDG1",18,0)
 ;
"RTN","SCMSVDG1",19,0)
 ; NOTE:  This validity check will pass if at least ONE DG1 segment in 
"RTN","SCMSVDG1",20,0)
 ;        the DG1 array passes the validity checks.
"RTN","SCMSVDG1",21,0)
 ;
"RTN","SCMSVDG1",22,0)
 ;        A check for occasion of service (procedure which does not 
"RTN","SCMSVDG1",23,0)
 ;        require a diagnosis) is contained in this routine.
"RTN","SCMSVDG1",24,0)
 ;
"RTN","SCMSVDG1",25,0)
 ;
"RTN","SCMSVDG1",26,0)
 N DG1SEG,I,J,MSG,PROCARRY,VALID,X,Z,DATA,CNT,SCSETID,SEG,PRIOR
"RTN","SCMSVDG1",27,0)
 S MSG="-1^Element in DG1 segment failed validity check"
"RTN","SCMSVDG1",28,0)
 S (I,PRIOR)=0,X="",PROCARRY="PROCS",DG1ARRY=$G(DG1ARRY),SEG="DG1",(CNT,SCSETID)=1
"RTN","SCMSVDG1",29,0)
 S:(DG1ARRY="") DG1ARRY="^TMP(""VAFHL"",$J,""DIAGNOSIS"")"
"RTN","SCMSVDG1",30,0)
 ;
"RTN","SCMSVDG1",31,0)
 ;- Check for occasion of service and number od DX's found greater then zero.
"RTN","SCMSVDG1",32,0)
 ;  If 00s and NO DX's, kill DG1 array.  If 00S and there are DX's, continue
"RTN","SCMSVDG1",33,0)
 ;  processing DG1 segment.
"RTN","SCMSVDG1",34,0)
 N SDCNT,SDDXY,QUIT
"RTN","SCMSVDG1",35,0)
 I ($$CHKOCC(ENCPTR)) D SET^SDCO4(ENCPTR) I 'SDCNT D  G ENQ
"RTN","SCMSVDG1",36,0)
 . K @DG1ARRY
"RTN","SCMSVDG1",37,0)
 . Q
"RTN","SCMSVDG1",38,0)
 ;
"RTN","SCMSVDG1",39,0)
 F  S I=+$O(@DG1ARRY@(I)) Q:'I  D  Q:$D(QUIT)
"RTN","SCMSVDG1",40,0)
 . S J="",VALID=1
"RTN","SCMSVDG1",41,0)
 . F  S J=$O(@DG1ARRY@(I,J)) Q:J=""  D  Q:$D(QUIT)
"RTN","SCMSVDG1",42,0)
 .. S DG1SEG=$G(@DG1ARRY@(I,J)),DG1SEG=$$CONVERT^SCMSVUT0(DG1SEG,HLFS,HLQ)
"RTN","SCMSVDG1",43,0)
 .. D VALIDATE^SCMSVUT0(SEG,DG1SEG,"0036",VALERR,.CNT)
"RTN","SCMSVDG1",44,0)
 .. I $G(@VALERR@(SEG,CNT-1))="0036" S QUIT=1 Q
"RTN","SCMSVDG1",45,0)
 .. F Z=1,2,3,4,16 DO  ;;;*** SWITCHED THIS FROM 6 TO 16 NEED TO TEST
"RTN","SCMSVDG1",46,0)
 ... S DATA=$P(DG1SEG,HLFS,Z)
"RTN","SCMSVDG1",47,0)
 ... I Z=16,DATA=1 S PRIOR=PRIOR+1
"RTN","SCMSVDG1",48,0)
 ... D VALIDATE^SCMSVUT0(SEG,DATA,$P($T(@(Z)),";",3),VALERR,.CNT)
"RTN","SCMSVDG1",49,0)
 ... Q
"RTN","SCMSVDG1",50,0)
 .. Q
"RTN","SCMSVDG1",51,0)
 . Q
"RTN","SCMSVDG1",52,0)
 ;
"RTN","SCMSVDG1",53,0)
 I $D(QUIT) G ENQ
"RTN","SCMSVDG1",54,0)
 D VALIDATE^SCMSVUT0(SEG,PRIOR,"5100",VALERR,.CNT)
"RTN","SCMSVDG1",55,0)
 I '$D(VALID) D VALIDATE^SCMSVUT0(SEG,"","0036",VALERR,.CNT)
"RTN","SCMSVDG1",56,0)
 ;
"RTN","SCMSVDG1",57,0)
ENQ Q $S($D(@VALERR@(SEG)):MSG,1:1)
"RTN","SCMSVDG1",58,0)
 ;
"RTN","SCMSVDG1",59,0)
 ;
"RTN","SCMSVDG1",60,0)
CHKOCC(ENCPTR) ; Occasion of Service Check
"RTN","SCMSVDG1",61,0)
 ;
"RTN","SCMSVDG1",62,0)
 ;         Input:  ENCPTR - Ptr to outpatient encounter file
"RTN","SCMSVDG1",63,0)
 ;
"RTN","SCMSVDG1",64,0)
 ;        Output:  0 if location is not an occasion of service clinic
"RTN","SCMSVDG1",65,0)
 ;                 1 if location is an occasion of service clinic
"RTN","SCMSVDG1",66,0)
 ;
"RTN","SCMSVDG1",67,0)
 ;
"RTN","SCMSVDG1",68,0)
 N ENC,LOC,STOP
"RTN","SCMSVDG1",69,0)
 S ENC=$G(^SCE(+ENCPTR,0))
"RTN","SCMSVDG1",70,0)
 S LOC=$P(ENC,"^",4),STOP=$P($G(^SC(+LOC,0)),"^",7)
"RTN","SCMSVDG1",71,0)
 Q $$EX^SDCOU2(STOP,+ENC)
"RTN","SCMSVDG1",72,0)
 ;
"RTN","SCMSVDG1",73,0)
 ;
"RTN","SCMSVDG1",74,0)
 ;- DG1 data elements validated
"RTN","SCMSVDG1",75,0)
 ;
"RTN","SCMSVDG1",76,0)
1 ;;0035;HL7 SEGMENT NAME 
"RTN","SCMSVDG1",77,0)
2 ;;5150;HL7 SEQUENTIAL NUMBER (SET ID) 
"RTN","SCMSVDG1",78,0)
3 ;;5030;DIAGNOSIS CODING METHOD 
"RTN","SCMSVDG1",79,0)
4 ;;5000;DIAGNOSIS CODE (ICD) 
"RTN","SCMSVDG1",80,0)
16 ;;5100;DIAGNOSIS PRIORITY 
"RTN","SCMSVUT1")
0^15^B69624796^B68410445
"RTN","SCMSVUT1",1,0)
SCMSVUT1 ;ALB/JLU - validation utility routine;06/19/99 ; 4/30/03 11:58am
"RTN","SCMSVUT1",2,0)
 ;;5.3;Scheduling;**66,143,180,239,247,258,296,295,321,341,387,459,394,442,593**;AUG 13,1993;Build 13
"RTN","SCMSVUT1",3,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","SCMSVUT1",4,0)
 ; Reference to $$SYS^ICDEX supported by ICR #5747
"RTN","SCMSVUT1",5,0)
 ;06/19/99 ACS - Added CPT Modifier API calls to PROCCOD(DATA)
"RTN","SCMSVUT1",6,0)
 ;
"RTN","SCMSVUT1",7,0)
SEGERR(DATA,HLFS) ;
"RTN","SCMSVUT1",8,0)
 ;INPUT DATA - This is a check for the segment errors of null
"RTN","SCMSVUT1",9,0)
 ;      HLFS - The string separator character
"RTN","SCMSVUT1",10,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",11,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",12,0)
 I $L(DATA,HLFS)'>2 Q 0
"RTN","SCMSVUT1",13,0)
 Q 1
"RTN","SCMSVUT1",14,0)
 ;
"RTN","SCMSVUT1",15,0)
DODA(DATA) ;
"RTN","SCMSVUT1",16,0)
 ;INPUT   DATA - The FM date of death.
"RTN","SCMSVUT1",17,0)
 ;
"RTN","SCMSVUT1",18,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",19,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",20,0)
 N %DT,X,Y
"RTN","SCMSVUT1",21,0)
 S %DT="T",%DT(0)="-NOW",X=DATA
"RTN","SCMSVUT1",22,0)
 D ^%DT
"RTN","SCMSVUT1",23,0)
 Q $S(Y=-1:0,1:1)
"RTN","SCMSVUT1",24,0)
 ;
"RTN","SCMSVUT1",25,0)
DODB(DATA,ENCDT) ;
"RTN","SCMSVUT1",26,0)
 ;INPUT   DATA - The FM date of death
"RTN","SCMSVUT1",27,0)
 ;       ENCDT - The FM date of encounter
"RTN","SCMSVUT1",28,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",29,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",30,0)
 N %DT,X,Y
"RTN","SCMSVUT1",31,0)
 S %DT="T",%DT(0)=ENCDT,X=DATA
"RTN","SCMSVUT1",32,0)
 D ^%DT
"RTN","SCMSVUT1",33,0)
 Q $S(Y=-1:0,1:1)
"RTN","SCMSVUT1",34,0)
 ;
"RTN","SCMSVUT1",35,0)
DODL(DATA,ENCDT) ;
"RTN","SCMSVUT1",36,0)
 ;INPUT  DATA - The FM date of death
"RTN","SCMSVUT1",37,0)
 ;      ENCDT - The FM date of the encounter
"RTN","SCMSVUT1",38,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",39,0)
 I '$D(ENCDT) Q 0
"RTN","SCMSVUT1",40,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",41,0)
 I ENCDT<DATA Q 1
"RTN","SCMSVUT1",42,0)
 I ENCDT=DATA Q 1
"RTN","SCMSVUT1",43,0)
 N X1,X2,X
"RTN","SCMSVUT1",44,0)
 S X1=ENCDT,X2=DATA
"RTN","SCMSVUT1",45,0)
 D ^%DTC
"RTN","SCMSVUT1",46,0)
 I X>14 Q 0
"RTN","SCMSVUT1",47,0)
 Q 1
"RTN","SCMSVUT1",48,0)
 ;
"RTN","SCMSVUT1",49,0)
HOME(DATA) ;
"RTN","SCMSVUT1",50,0)
 ;INPUT   DATA - THe homeless indicator to be validated.
"RTN","SCMSVUT1",51,0)
 ;
"RTN","SCMSVUT1",52,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",53,0)
 I DATA'=1,DATA'=0 Q 0
"RTN","SCMSVUT1",54,0)
 Q 1
"RTN","SCMSVUT1",55,0)
 ;
"RTN","SCMSVUT1",56,0)
POW(DATA) ;
"RTN","SCMSVUT1",57,0)
 ;INPUT  DATA - The POW indicatort to be validated.
"RTN","SCMSVUT1",58,0)
 ;
"RTN","SCMSVUT1",59,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",60,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",61,0)
 I DATA'="N",DATA'="U",DATA'="Y" Q 0
"RTN","SCMSVUT1",62,0)
 Q 1
"RTN","SCMSVUT1",63,0)
 ;
"RTN","SCMSVUT1",64,0)
TYPINS(DATA) ;
"RTN","SCMSVUT1",65,0)
 ;INPUT  DATA - Type if insurance indicator to be validated.
"RTN","SCMSVUT1",66,0)
 ;
"RTN","SCMSVUT1",67,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",68,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",69,0)
 I DATA?.A Q 0
"RTN","SCMSVUT1",70,0)
 I DATA>-1,(DATA<13) Q 1
"RTN","SCMSVUT1",71,0)
 Q 0
"RTN","SCMSVUT1",72,0)
 ;
"RTN","SCMSVUT1",73,0)
PATCLSS(DATA) ;
"RTN","SCMSVUT1",74,0)
 ;INPUT  DATA - the patient's class
"RTN","SCMSVUT1",75,0)
 ;
"RTN","SCMSVUT1",76,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",77,0)
 I ("^O^I^")'[("^"_DATA_"^") Q 0
"RTN","SCMSVUT1",78,0)
 Q 1
"RTN","SCMSVUT1",79,0)
 ;
"RTN","SCMSVUT1",80,0)
POV(DATA) ;
"RTN","SCMSVUT1",81,0)
 ;
"RTN","SCMSVUT1",82,0)
 ;INPUT DATA - the purpose of visit.
"RTN","SCMSVUT1",83,0)
 ;SD*5.3*394 - Correction for addition POV.
"RTN","SCMSVUT1",84,0)
 ;
"RTN","SCMSVUT1",85,0)
 N VAR
"RTN","SCMSVUT1",86,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",87,0)
 I $L(DATA)'=4 Q 0
"RTN","SCMSVUT1",88,0)
 I DATA?.A Q 0
"RTN","SCMSVUT1",89,0)
 S VAR=$E(DATA,1,2)
"RTN","SCMSVUT1",90,0)
 I VAR<1!(VAR>4) Q 0
"RTN","SCMSVUT1",91,0)
 S VAR=$E(DATA,3,4)
"RTN","SCMSVUT1",92,0)
 I VAR<1!(VAR=10) Q 0
"RTN","SCMSVUT1",93,0)
 Q 1
"RTN","SCMSVUT1",94,0)
 ;
"RTN","SCMSVUT1",95,0)
COMPGEN(DATA) ;
"RTN","SCMSVUT1",96,0)
 ;INPUT DATA - checking computer generated.
"RTN","SCMSVUT1",97,0)
 ;
"RTN","SCMSVUT1",98,0)
 N VAR
"RTN","SCMSVUT1",99,0)
 S VAR=$E(DATA,3,4)
"RTN","SCMSVUT1",100,0)
 I VAR=10 Q 0
"RTN","SCMSVUT1",101,0)
 Q 1
"RTN","SCMSVUT1",102,0)
 ;
"RTN","SCMSVUT1",103,0)
LOCVIS(DATA) ;
"RTN","SCMSVUT1",104,0)
 ;INPUT DATA - Location of visit
"RTN","SCMSVUT1",105,0)
 ;
"RTN","SCMSVUT1",106,0)
 I DATA'=1,DATA'=6 Q 0
"RTN","SCMSVUT1",107,0)
 Q 1
"RTN","SCMSVUT1",108,0)
 ;
"RTN","SCMSVUT1",109,0)
FACNMBR(DATA) ;
"RTN","SCMSVUT1",110,0)
 ;INPUT DATA - The facility number
"RTN","SCMSVUT1",111,0)
 ;
"RTN","SCMSVUT1",112,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",113,0)
 I DATA'?3N.AN Q 0
"RTN","SCMSVUT1",114,0)
 I '$D(^DIC(4,"D",DATA)) Q 0
"RTN","SCMSVUT1",115,0)
 Q 1
"RTN","SCMSVUT1",116,0)
 ;
"RTN","SCMSVUT1",117,0)
FACACT(DATA,ENCDT,DIV) ;
"RTN","SCMSVUT1",118,0)
 ;INPUT DATA - The active flag of the facility number.
"RTN","SCMSVUT1",119,0)
 ;
"RTN","SCMSVUT1",120,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",121,0)
 I '$D(ENCDT) Q 0
"RTN","SCMSVUT1",122,0)
 I '$D(DIV) Q 0
"RTN","SCMSVUT1",123,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",124,0)
 N SITE
"RTN","SCMSVUT1",125,0)
 I DIV]"" S SITE=$$SITE^VASITE(ENCDT,DIV)
"RTN","SCMSVUT1",126,0)
 I DIV']"" S SITE=$$SITE^VASITE(ENCDT)
"RTN","SCMSVUT1",127,0)
 I DATA'=$P(SITE,U,3) Q 0
"RTN","SCMSVUT1",128,0)
 Q 1
"RTN","SCMSVUT1",129,0)
 ;
"RTN","SCMSVUT1",130,0)
ENCDT(DATA,XMTFLG) ;
"RTN","SCMSVUT1",131,0)
 ;INPUT DATA - The date/time of the encounter
"RTN","SCMSVUT1",132,0)
 ;    XMTFLG - Flag to check $$OKTOXMIT^SCDXFU04(DATA)
"RTN","SCMSVUT1",133,0)
 ;
"RTN","SCMSVUT1",134,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",135,0)
 S XMTFLG=$G(XMTFLG,0)
"RTN","SCMSVUT1",136,0)
 N %DT,X,Y
"RTN","SCMSVUT1",137,0)
 S %DT="T"
"RTN","SCMSVUT1",138,0)
 S X=DATA
"RTN","SCMSVUT1",139,0)
 D ^%DT
"RTN","SCMSVUT1",140,0)
 I Y=-1 Q 0
"RTN","SCMSVUT1",141,0)
 I XMTFLG Q 1
"RTN","SCMSVUT1",142,0)
 N VAR
"RTN","SCMSVUT1",143,0)
 S VAR=$$OKTOXMIT^SCDXFU04(DATA)
"RTN","SCMSVUT1",144,0)
 I +VAR<4&(VAR'<0) Q 1  ;SD*5.3*247
"RTN","SCMSVUT1",145,0)
 Q 0
"RTN","SCMSVUT1",146,0)
 ;
"RTN","SCMSVUT1",147,0)
UNIQNMBR(DATA) ;
"RTN","SCMSVUT1",148,0)
 ;INPUT DATA - The unique number from PCE for the encounter
"RTN","SCMSVUT1",149,0)
 ;
"RTN","SCMSVUT1",150,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",151,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",152,0)
 I DATA=-1 Q 0
"RTN","SCMSVUT1",153,0)
 I DATA=0 Q 0
"RTN","SCMSVUT1",154,0)
 Q 1
"RTN","SCMSVUT1",155,0)
 ;
"RTN","SCMSVUT1",156,0)
SEGCHK(DATA,HLFS) ;
"RTN","SCMSVUT1",157,0)
 ;INPUT DATA - The segment to be checked.
"RTN","SCMSVUT1",158,0)
 ;      HLFS - The HL7 field separator
"RTN","SCMSVUT1",159,0)
 ;
"RTN","SCMSVUT1",160,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",161,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",162,0)
 I $L(DATA,HLFS)'>2 Q 0
"RTN","SCMSVUT1",163,0)
 Q 1
"RTN","SCMSVUT1",164,0)
 ;
"RTN","SCMSVUT1",165,0)
SEQNBR(DATA,SEQNBR) ;
"RTN","SCMSVUT1",166,0)
 ;INPUT DATA - The sequence number to be checked.
"RTN","SCMSVUT1",167,0)
 ;     SEQNBR - This is the previous seq number to compare to
"RTN","SCMSVUT1",168,0)
 ;
"RTN","SCMSVUT1",169,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",170,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",171,0)
 I +DATA'=+SEQNBR Q 0
"RTN","SCMSVUT1",172,0)
 S SEQNBR=SEQNBR+1
"RTN","SCMSVUT1",173,0)
 Q 1
"RTN","SCMSVUT1",174,0)
 ;
"RTN","SCMSVUT1",175,0)
DCODMTHD(DATA) ;
"RTN","SCMSVUT1",176,0)
 ;INPUT DATA - This is the coding method to be checked.
"RTN","SCMSVUT1",177,0)
 ;
"RTN","SCMSVUT1",178,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",179,0)
 I (DATA'="I9"),(DATA'="I10") Q 0
"RTN","SCMSVUT1",180,0)
 Q 1
"RTN","SCMSVUT1",181,0)
 ;
"RTN","SCMSVUT1",182,0)
DIAGCOD(DATA,ENCDT) ;
"RTN","SCMSVUT1",183,0)
 ;INPUT DATA - This is the diagnosis code
"RTN","SCMSVUT1",184,0)
 ;     ENCDT - This is the encounter date
"RTN","SCMSVUT1",185,0)
 ;
"RTN","SCMSVUT1",186,0)
 N VAR
"RTN","SCMSVUT1",187,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",188,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",189,0)
 ;
"RTN","SCMSVUT1",190,0)
 Q +$P($$ICDDX^ICDEX(DATA,ENCDT,+$$SYS^ICDEX("DIAG",ENCDT,"I"),"E"),"^",10)
"RTN","SCMSVUT1",191,0)
 ;
"RTN","SCMSVUT1",192,0)
PRIOR(DATA) ;
"RTN","SCMSVUT1",193,0)
 ;INPUT DATA - The priority of the diagnosis found
"RTN","SCMSVUT1",194,0)
 ;
"RTN","SCMSVUT1",195,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",196,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",197,0)
 I DATA=1 Q 1
"RTN","SCMSVUT1",198,0)
 Q 0
"RTN","SCMSVUT1",199,0)
 ;
"RTN","SCMSVUT1",200,0)
ELIGCODM(DATA) ;
"RTN","SCMSVUT1",201,0)
 ;INPUT DATA - The eligibility code
"RTN","SCMSVUT1",202,0)
 ;A CHECK FOR MISSING
"RTN","SCMSVUT1",203,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",204,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",205,0)
 I '$D(^DIC(8.1,DATA,0)) Q 0
"RTN","SCMSVUT1",206,0)
 Q 1
"RTN","SCMSVUT1",207,0)
 ;
"RTN","SCMSVUT1",208,0)
ELIGINCV(DATA) ;
"RTN","SCMSVUT1",209,0)
 ;INPUT DATA - Contains the eligibility code in the first piece and
"RTN","SCMSVUT1",210,0)
 ;the veteran status in the second.
"RTN","SCMSVUT1",211,0)
 ;
"RTN","SCMSVUT1",212,0)
 ;the following quit is to stop this edit check.
"RTN","SCMSVUT1",213,0)
 ;Per Austin 9/97 this is not needed.
"RTN","SCMSVUT1",214,0)
 Q 1
"RTN","SCMSVUT1",215,0)
 N VET,ELIG
"RTN","SCMSVUT1",216,0)
 S VET=$P(DATA,U,2)
"RTN","SCMSVUT1",217,0)
 S ELIG=$P(DATA,U,1)
"RTN","SCMSVUT1",218,0)
 I VET=1&((ELIG<1)!(ELIG>18)) Q 0
"RTN","SCMSVUT1",219,0)
 I VET=1,ELIG>5,ELIG<15 Q 0
"RTN","SCMSVUT1",220,0)
 I VET=0,ELIG<6 Q 0
"RTN","SCMSVUT1",221,0)
 I VET=0,ELIG=11 Q 0
"RTN","SCMSVUT1",222,0)
 I VET=0,ELIG>14,ELIG'=19 Q 0
"RTN","SCMSVUT1",223,0)
 Q 1
"RTN","SCMSVUT1",224,0)
 ;
"RTN","SCMSVUT1",225,0)
ELIGINCS(DATA) ;
"RTN","SCMSVUT1",226,0)
 ;INPUT DATA - Eligibility code
"RTN","SCMSVUT1",227,0)
 ;
"RTN","SCMSVUT1",228,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",229,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",230,0)
 I '$D(^DIC(8.1,DATA,0)) Q 0
"RTN","SCMSVUT1",231,0)
 I +$P(^DIC(8.1,DATA,0),U,7) Q 0
"RTN","SCMSVUT1",232,0)
 Q 1
"RTN","SCMSVUT1",233,0)
 ;
"RTN","SCMSVUT1",234,0)
VETSTAT(DATA) ;
"RTN","SCMSVUT1",235,0)
 ;INPUT DATA - The veteran status indicator
"RTN","SCMSVUT1",236,0)
 ;
"RTN","SCMSVUT1",237,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",238,0)
 I DATA'=0,DATA'=1 Q 0
"RTN","SCMSVUT1",239,0)
 Q 1
"RTN","SCMSVUT1",240,0)
 ;
"RTN","SCMSVUT1",241,0)
VETPOW(DATA,DFN) ;
"RTN","SCMSVUT1",242,0)
 ;INPUT DATA - veteran status to check with POW status.
"RTN","SCMSVUT1",243,0)
 ;       DFN - The DFN of the patient.
"RTN","SCMSVUT1",244,0)
 ;
"RTN","SCMSVUT1",245,0)
 N VAR,POW
"RTN","SCMSVUT1",246,0)
 I DATA=0 Q 1
"RTN","SCMSVUT1",247,0)
 S VAR=$G(^DPT(DFN,.52))
"RTN","SCMSVUT1",248,0)
 S POW=$S(VAR]"":$P(VAR,U,5),1:VAR)
"RTN","SCMSVUT1",249,0)
 I POW="" Q 1
"RTN","SCMSVUT1",250,0)
 I POW="Y"!(POW="N")!(POW="U") Q 1
"RTN","SCMSVUT1",251,0)
 Q 0
"RTN","SCMSVUT1",252,0)
 ;
"RTN","SCMSVUT1",253,0)
NMBRDEP(DATA) ;
"RTN","SCMSVUT1",254,0)
 ;INPUT DATA - the number of dependents
"RTN","SCMSVUT1",255,0)
 ;
"RTN","SCMSVUT1",256,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",257,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",258,0)
 I DATA="XX" Q 1
"RTN","SCMSVUT1",259,0)
 I DATA'?1.2N Q 0
"RTN","SCMSVUT1",260,0)
 I +DATA>99!(+DATA<0) Q 0
"RTN","SCMSVUT1",261,0)
 Q 1
"RTN","SCMSVUT1",262,0)
 ;
"RTN","SCMSVUT1",263,0)
PATINC(DATA) ;
"RTN","SCMSVUT1",264,0)
 ;INPUT DATA - The patient's income
"RTN","SCMSVUT1",265,0)
 ;
"RTN","SCMSVUT1",266,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",267,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",268,0)
 I DATA<0 Q 0
"RTN","SCMSVUT1",269,0)
 I DATA'?.N.1".".N Q 0
"RTN","SCMSVUT1",270,0)
 Q 1
"RTN","SCMSVUT1",271,0)
 ;
"RTN","SCMSVUT1",272,0)
MEANSTST(DATA) ;
"RTN","SCMSVUT1",273,0)
 ;INPUT DATA - The means test indicator
"RTN","SCMSVUT1",274,0)
 ;
"RTN","SCMSVUT1",275,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",276,0)
 S DATA=","_DATA_","
"RTN","SCMSVUT1",277,0)
 ; ** SD*296, added 'U' means test indicator to allowed list.
"RTN","SCMSVUT1",278,0)
 I ",AS,AN,N,X,C,G,U,"'[DATA Q 0
"RTN","SCMSVUT1",279,0)
 Q 1
"RTN","SCMSVUT1",280,0)
 ;
"RTN","SCMSVUT1",281,0)
DEPMEANS(DATA) ;
"RTN","SCMSVUT1",282,0)
 ;INPUT DATA - This variable contains the number of dependents in the
"RTN","SCMSVUT1",283,0)
 ;             first peice and the means test indicator in the second.
"RTN","SCMSVUT1",284,0)
 ;
"RTN","SCMSVUT1",285,0)
 N MT,DEP
"RTN","SCMSVUT1",286,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",287,0)
 S DEP=$P(DATA,U,1)
"RTN","SCMSVUT1",288,0)
 S MT=","_$P(DATA,U,2)_","
"RTN","SCMSVUT1",289,0)
 I DEP="XX",(",AS,N,X,U,"'[MT) Q 0
"RTN","SCMSVUT1",290,0)
 Q 1
"RTN","SCMSVUT1",291,0)
 ;
"RTN","SCMSVUT1",292,0)
CLASSQUE(DATA) ;
"RTN","SCMSVUT1",293,0)
 ;INPUT DATA - Classification question value.
"RTN","SCMSVUT1",294,0)
 ;
"RTN","SCMSVUT1",295,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",296,0)
 I DATA'=1,DATA'=0,DATA'="" Q 0
"RTN","SCMSVUT1",297,0)
 Q 1
"RTN","SCMSVUT1",298,0)
 ;
"RTN","SCMSVUT1",299,0)
CLAQUETY(DATA) ;
"RTN","SCMSVUT1",300,0)
 ;INPUT DATA - Outpatient classification type to be checked.
"RTN","SCMSVUT1",301,0)
 ;
"RTN","SCMSVUT1",302,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",303,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",304,0)
 I '$D(^SD(409.41,DATA,0)) Q 0
"RTN","SCMSVUT1",305,0)
 Q 1
"RTN","SCMSVUT1",306,0)
 ;
"RTN","SCMSVUT1",307,0)
CLAVET(DATA,DFN,TYPE,ENCPTR) ; SD*5.3*341 added parameter ENCPTR
"RTN","SCMSVUT1",308,0)
 ;INPUT DATA - Classification question information to compare to VET
"RTN","SCMSVUT1",309,0)
 ;             status
"RTN","SCMSVUT1",310,0)
 ;       DFN - The patient to compare this info to.
"RTN","SCMSVUT1",311,0)
 ;      TYPE - The classification type.
"RTN","SCMSVUT1",312,0)
 ;    ENCPTR - Pointer to Outpatient Encounter
"RTN","SCMSVUT1",313,0)
 ;
"RTN","SCMSVUT1",314,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",315,0)
 I '$D(DFN) Q 0
"RTN","SCMSVUT1",316,0)
 I '$D(TYPE) Q 0  ; SD*5.3*341
"RTN","SCMSVUT1",317,0)
 N VET,SDELG0,SDDT  ; SD*5.3*341
"RTN","SCMSVUT1",318,0)
 S ENCPTR=$G(ENCPTR)  ; SD*5.3*341 added this plus next 3 lines
"RTN","SCMSVUT1",319,0)
 S SDDT=+$G(^SCE(ENCPTR,0)) S:'SDDT SDDT=$$DT^XLFDT()
"RTN","SCMSVUT1",320,0)
 S SDELG0=$$EL^SDCO22(DFN,ENCPTR)
"RTN","SCMSVUT1",321,0)
 S VET=$P(SDELG0,U,5)
"RTN","SCMSVUT1",322,0)
 I VET="Y",DATA'=1,DATA'=0,DATA'="" Q 0
"RTN","SCMSVUT1",323,0)
 ;This edit check is per a mail message from austin
"RTN","SCMSVUT1",324,0)
 I TYPE=4,VET'="Y",DATA'="","^A^B^C^D^"'[("^"_($P($G(^DIC(21,+$P($G(^DPT(DFN,.32)),"^",3),0)),"^",3))_"^") Q 0
"RTN","SCMSVUT1",325,0)
 I VET'="Y",DATA'="" Q $$SCR^SDCO21(TYPE,DFN,SDDT,ENCPTR)  ; SD*5.3*341
"RTN","SCMSVUT1",326,0)
 Q 1
"RTN","SCMSVUT1",327,0)
 ;
"RTN","SCMSVUT1",328,0)
STPCOD(DATA) ;
"RTN","SCMSVUT1",329,0)
 ;INPUT DATA - stop code data to be checked
"RTN","SCMSVUT1",330,0)
 ;
"RTN","SCMSVUT1",331,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",332,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",333,0)
 I '$D(^DIC(40.7,"C",DATA)) Q 0
"RTN","SCMSVUT1",334,0)
 Q 1
"RTN","SCMSVUT1",335,0)
 ;
"RTN","SCMSVUT1",336,0)
ACTSTP(DATA,ENCDT) ;
"RTN","SCMSVUT1",337,0)
 ;INPUT  DATA - IEN of the stop code to be checked.
"RTN","SCMSVUT1",338,0)
 ;      ENCDT - the encounter date in question
"RTN","SCMSVUT1",339,0)
 ;
"RTN","SCMSVUT1",340,0)
 N STPCOD,%DT,X,Y
"RTN","SCMSVUT1",341,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",342,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",343,0)
 S STPCOD=$G(^DIC(40.7,DATA,0))
"RTN","SCMSVUT1",344,0)
 I STPCOD="" Q 0
"RTN","SCMSVUT1",345,0)
 I '$P(STPCOD,U,3) Q 1
"RTN","SCMSVUT1",346,0)
 S %DT(0)="-"_$P(STPCOD,U,3),%DT="T",X=ENCDT
"RTN","SCMSVUT1",347,0)
 D ^%DT
"RTN","SCMSVUT1",348,0)
 Q $S(Y=-1:0,1:1)
"RTN","SCMSVUT1",349,0)
 ;
"RTN","SCMSVUT1",350,0)
SERCON(DATA) ;
"RTN","SCMSVUT1",351,0)
 ;INPUT DATA - Service connection to be checked, missing or invalid
"RTN","SCMSVUT1",352,0)
 ;
"RTN","SCMSVUT1",353,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",354,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",355,0)
 I DATA'=1,DATA'=0 Q 0
"RTN","SCMSVUT1",356,0)
 Q 1
"RTN","SCMSVUT1",357,0)
 ;
"RTN","SCMSVUT1",358,0)
SCPER(DATA) ;
"RTN","SCMSVUT1",359,0)
 ;INPUT DATA - Service connected % to be tested
"RTN","SCMSVUT1",360,0)
 ;
"RTN","SCMSVUT1",361,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",362,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",363,0)
 I DATA'?.N.1".".N Q 0
"RTN","SCMSVUT1",364,0)
 Q 1
"RTN","SCMSVUT1",365,0)
 ;
"RTN","SCMSVUT1",366,0)
PRDSER(DATA) ;
"RTN","SCMSVUT1",367,0)
 ;INPUT DATA - period of service to be tested.
"RTN","SCMSVUT1",368,0)
 ;
"RTN","SCMSVUT1",369,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",370,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",371,0)
 I '$D(^DIC(21,"D",DATA)) Q 0
"RTN","SCMSVUT1",372,0)
 Q 1
"RTN","SCMSVUT1",373,0)
 ;
"RTN","SCMSVUT1",374,0)
VIETSER1(DATA) ;
"RTN","SCMSVUT1",375,0)
 ;INPUT DATA - Vietnam service to be checked
"RTN","SCMSVUT1",376,0)
 ;
"RTN","SCMSVUT1",377,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",378,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",379,0)
 I DATA'="Y",DATA'="N",DATA'="U" Q 0
"RTN","SCMSVUT1",380,0)
 Q 1
"RTN","SCMSVUT1",381,0)
 ;
"RTN","SCMSVUT1",382,0)
VIETSER2(DATA,DFN) ;
"RTN","SCMSVUT1",383,0)
 ;INPUT DATA - Vietnam service to be checked against vet status
"RTN","SCMSVUT1",384,0)
 ;
"RTN","SCMSVUT1",385,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",386,0)
 N VAR
"RTN","SCMSVUT1",387,0)
 S VAR=$G(^DPT(DFN,"VET"))
"RTN","SCMSVUT1",388,0)
 I DATA="",VAR'="Y" Q 1
"RTN","SCMSVUT1",389,0)
 I (DATA="Y"!(DATA="N")!(DATA="U")),VAR="Y" Q 1
"RTN","SCMSVUT1",390,0)
 Q 0
"RTN","SCMSVUT1",391,0)
 ;
"RTN","SCMSVUT1",392,0)
ACTPRD(DATA) ;
"RTN","SCMSVUT1",393,0)
 ;INPUT DATA - period of serivce indicator to be check to ensure active
"RTN","SCMSVUT1",394,0)
 ;
"RTN","SCMSVUT1",395,0)
 N VAR
"RTN","SCMSVUT1",396,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",397,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",398,0)
 S VAR=+$O(^DIC(21,"D",DATA,0))
"RTN","SCMSVUT1",399,0)
 S VAR=$P($G(^DIC(21,VAR,0)),U,8)
"RTN","SCMSVUT1",400,0)
 I VAR Q 0
"RTN","SCMSVUT1",401,0)
 Q 1
"RTN","SCMSVUT1",402,0)
 ;
"RTN","SCMSVUT1",403,0)
PCODMTHD(DATA) ;
"RTN","SCMSVUT1",404,0)
 ;INPUT DATA - The coding method to be checked.
"RTN","SCMSVUT1",405,0)
 ;
"RTN","SCMSVUT1",406,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",407,0)
 I DATA'="C4" Q 0
"RTN","SCMSVUT1",408,0)
 Q 1
"RTN","SCMSVUT1",409,0)
 ;
"RTN","SCMSVUT1",410,0)
PROCCOD(DATA,ENCDT) ;
"RTN","SCMSVUT1",411,0)
 ;INPUT DATA - The procedure code to be checked.
"RTN","SCMSVUT1",412,0)
 ;This call makes the assumption that leading zeros are intact in the 
"RTN","SCMSVUT1",413,0)
 ;input.
"RTN","SCMSVUT1",414,0)
 ;
"RTN","SCMSVUT1",415,0)
 N VAR
"RTN","SCMSVUT1",416,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",417,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",418,0)
 I $$CPT^ICPTCOD(DATA,ENCDT,1)'>0 Q 0
"RTN","SCMSVUT1",419,0)
 Q 1
"RTN","SCMSVUT1",420,0)
 ;
"RTN","SCMSVUT1",421,0)
PROVCLS(DATA) ;
"RTN","SCMSVUT1",422,0)
 ;INPUT DATA - The practitioner class to be checked.
"RTN","SCMSVUT1",423,0)
 ;
"RTN","SCMSVUT1",424,0)
 N INACT S INACT=""
"RTN","SCMSVUT1",425,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",426,0)
 I DATA="" Q 0
"RTN","SCMSVUT1",427,0)
 I $$CODE2TXT^XUA4A72(DATA)']"" Q 0
"RTN","SCMSVUT1",428,0)
 S INACT=$P($$IEN2DATA^XUA4A72($$VCLK^XUA4A72(DATA)),U,5)  ;SD*5.3*442
"RTN","SCMSVUT1",429,0)
 I INACT'="" I ENCDT>INACT Q 0  ;SD*5.3*442
"RTN","SCMSVUT1",430,0)
 Q 1
"RTN","SCMSVUT1",431,0)
 ;
"RTN","SCMSVUT1",432,0)
ERI(DATA) ;
"RTN","SCMSVUT1",433,0)
 ;INPUT  DATA - The Emergency Response indicator to be validated.
"RTN","SCMSVUT1",434,0)
 ;
"RTN","SCMSVUT1",435,0)
 I '$D(DATA) Q 0
"RTN","SCMSVUT1",436,0)
 I DATA="" Q 1
"RTN","SCMSVUT1",437,0)
 I DATA'="K" Q 0
"RTN","SCMSVUT1",438,0)
 Q 1
"RTN","SCMSVUT1",439,0)
 ;
"RTN","SCRPW14")
0^1^B36855976^B34780614
"RTN","SCRPW14",1,0)
SCRPW14 ;RENO/KEITH - Encounter Activity Report ;06/10/99
"RTN","SCRPW14",2,0)
 ;;5.3;Scheduling;**139,144,180,593**;AUG 13, 1993;Build 13
"RTN","SCRPW14",3,0)
 ;06/10/99 ACS Added cpt modifiers to the report
"RTN","SCRPW14",4,0)
 ;
"RTN","SCRPW14",5,0)
 N DIC,DIR,DTOUT,DUOUT,X,Y,SD,ZTSAVE,%DT,SDDIV,SDI
"RTN","SCRPW14",6,0)
 D TITL^SCRPW50("Encounter Activity Report") G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW14",7,0)
 D SUBT^SCRPW50("*** Date Range Selection ***")
"RTN","SCRPW14",8,0)
 S Y=$$IMP^SCRPWICD(30) S SD("I10DTI")=Y X ^DD("DD") S SD("I10DTE")=Y
"RTN","SCRPW14",9,0)
FDT W ! S %DT="AEPX",%DT("A")="Beginning date: ",%DT(0)="-TODAY" D ^%DT G:X=U!$D(DTOUT)!(X="") EXIT
"RTN","SCRPW14",10,0)
 G:Y<1 FDT S SD("BDT")=Y X ^DD("DD") S SD("PBDT")=Y W !
"RTN","SCRPW14",11,0)
LDT S %DT("A")="Ending date: " D ^%DT G:X=U!$D(DTOUT)!(X="") EXIT
"RTN","SCRPW14",12,0)
 I Y<SD("BDT") W !!,$C(7),"Ending date must be after beginning date!",! G LDT
"RTN","SCRPW14",13,0)
 G:Y<1 LDT S SD("EDT")=Y X ^DD("DD") S SD("PEDT")=Y,SD("EDT")=SD("EDT")_".999999"
"RTN","SCRPW14",14,0)
 I (SD("BDT")<SD("I10DTI")),(SD("EDT")'<SD("I10DTI")) D  G FDT
"RTN","SCRPW14",15,0)
 . W !!,$C(7),"Beginning and Ending dates must both be prior to "_SD("I10DTE")_" (ICD-9) or both be on or after "_SD("I10DTE")_" (ICD-10)."
"RTN","SCRPW14",16,0)
CATE D SUBT^SCRPW50("*** Report Category Selection ***")
"RTN","SCRPW14",17,0)
 W ! S DIR(0)="S^C:CLINIC;P:PROVIDER;S:STOP CODE",DIR("A")="Select category for report output" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT S SD("CAT")=Y D STAT G:'$D(SD("STAT")) EXIT
"RTN","SCRPW14",18,0)
 D SUBT^SCRPW50("*** Report Format Selection ***")
"RTN","SCRPW14",19,0)
 W ! S DIR(0)="S^D:DETAILED;S:SUMMARY",DIR("A")="Select report format",DIR("B")="SUMMARY" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT S SD("FMT")=Y
"RTN","SCRPW14",20,0)
 I SD("FMT")="S" W ! S DIR(0)="S^A:ALPHABETIC;E:ENCOUNTER TOTALS;V:VISIT TOTALS;U:UNIQUE TOTALS",DIR("A")="Select report order",DIR("B")="ALPHABETIC" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT S SD("ORD")=Y G QUE
"RTN","SCRPW14",21,0)
 S SD("ORD")="A" D LIST(SD("CAT")) G:'$D(SD("LIST")) EXIT
"RTN","SCRPW14",22,0)
QUE D SUBT^SCRPW50("*** Selected Report Parameters ***")
"RTN","SCRPW14",23,0)
 W !!,"You have selected the following report parameters:",! D PVIEW^SCRPW15(0)
"RTN","SCRPW14",24,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="OK",DIR("B")="YES" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT G:'Y EXIT
"RTN","SCRPW14",25,0)
 F SDI="SDDIV","SDDIV(","SD(","SDL(" S ZTSAVE(SDI)=""
"RTN","SCRPW14",26,0)
 W ! D EN^XUTMDEVQ("RPT^SCRPW14","OPT. ACTIVITY REPORT",.ZTSAVE)
"RTN","SCRPW14",27,0)
 ;
"RTN","SCRPW14",28,0)
EXIT D END^SCRPW50 Q
"RTN","SCRPW14",29,0)
 ;
"RTN","SCRPW14",30,0)
STAT ;Prompt for encounter statuses to include
"RTN","SCRPW14",31,0)
 D SUBT^SCRPW50("*** Encounter Status Selection ***")
"RTN","SCRPW14",32,0)
 K SD("STAT") W !!,"Choose as many of the following statuses",!,"as you wish to include in the report:",!
"RTN","SCRPW14",33,0)
 W !?10,"CHECKED IN",!?10,"CHECKED OUT",!?10,"NO ACTION TAKEN",!?10,"INPATIENT APPOINTMENT",!?10,"NON-COUNT",!?10,"ACTION REQUIRED",! N DIC,I S DIC="^SD(409.63,",DIC(0)="AEMQ",DIC("B")="CHECKED OUT"
"RTN","SCRPW14",34,0)
 S DIC("S")="I Y<4!(Y=8!(Y=12!(Y=14)))",DIC("A")="Select encounter status: " F I=1:1 D ^DIC Q:$D(DTOUT)!$D(DUOUT)  S:Y>0 SD("STAT",$P(Y,U))="" K DIC("B") Q:X=""&(I>1)
"RTN","SCRPW14",35,0)
 Q
"RTN","SCRPW14",36,0)
 ;
"RTN","SCRPW14",37,0)
LIST(X) ;Get list for detail
"RTN","SCRPW14",38,0)
 ;Output: SD("LIST",ifn)=name
"RTN","SCRPW14",39,0)
 W ! N DIC S DIC=$S(X="C":"^SC(",X="P":"^VA(200,",1:"^DIC(40.7,"),DIC(0)="AEMQ" S:X="S" DIC("S")="I $L($P(^(0),U,2))=3"
"RTN","SCRPW14",40,0)
 F  D ^DIC Q:$D(DTOUT)!$D(DUOUT)!(X="")  S:Y>0 SD("LIST",$P(Y,U))=$P(Y,U,2)
"RTN","SCRPW14",41,0)
 W ! Q
"RTN","SCRPW14",42,0)
 ;
"RTN","SCRPW14",43,0)
RPT ;Print report
"RTN","SCRPW14",44,0)
 N %,X,Y,SDQ,SDTIT,SDI,DFN,SDIVN,SDMD,SDOUT,SDSTOP,SDX
"RTN","SCRPW14",45,0)
 N SDCH,SDCH0,SDCL,SDCOL,SDD,SDD0,SDDET,SDDT,SDFFS,SDLINE,SDN,SDOE,SDOE0,SDOED,SDOED0,SDP,SDPI,SDP0,SDPAGE,SDPG,SDPNOW,SDPR,SDPT,SDR,SDS,SDSC,SDSV,SDT,SDT1,SDT2,SDTOT,SDTOT1,SDTOT2,SDUN,SDVP,SDVP0,SDVS,SDLIST,SDRPVS,SDRPUN,SDRPEN
"RTN","SCRPW14",46,0)
 K ^TMP("SCRPW",$J) S (SDOUT,SDSTOP)=0,SDMD=$O(SDDIV("")),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW14",47,0)
 S SDDT=SD("BDT") F  S SDDT=$O(^SCE("B",SDDT)) Q:'SDDT!(SDDT>SD("EDT"))!SDOUT  S SDOE=0 F  S SDOE=$O(^SCE("B",SDDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0) S SDIV=$P(SDOE0,U,11) D:SDIV EVAL
"RTN","SCRPW14",48,0)
 G:SDOUT EXIT G ^SCRPW15
"RTN","SCRPW14",49,0)
 ;
"RTN","SCRPW14",50,0)
STOP ;Check for stop task request
"RTN","SCRPW14",51,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW14",52,0)
 ;
"RTN","SCRPW14",53,0)
EVAL ;Evaluate encounter
"RTN","SCRPW14",54,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP Q:SDOUT
"RTN","SCRPW14",55,0)
 I '$P(SDOE0,U,6),$$DIV(SDIV),$D(SD("STAT",+$P(SDOE0,U,12))) K SDS I $$CAT(.SDS) D SRT(SDIV) D:SDMD SRT(0) S SDS=0 F  S SDS=$O(SDS(SDS)) Q:'SDS  D SET
"RTN","SCRPW14",56,0)
 Q
"RTN","SCRPW14",57,0)
 ;
"RTN","SCRPW14",58,0)
DIV(SDIV) ;Evaluate division
"RTN","SCRPW14",59,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW14",60,0)
 ;
"RTN","SCRPW14",61,0)
SRT(SDIV) ;Set report total for summary format
"RTN","SCRPW14",62,0)
 Q:SD("FMT")="D"  S SDRPEN(SDIV)=$G(SDRPEN(SDIV))+1,^TMP("SCRPW",$J,SDIV,"RPT","PT",+$P(SDOE0,U,2),+$P(SDDT,"."))="" Q
"RTN","SCRPW14",63,0)
 ;
"RTN","SCRPW14",64,0)
SET ;Set global for a division
"RTN","SCRPW14",65,0)
 D SET1(SDIV) D:SDMD SET1(0) Q:SD("FMT")="S"
"RTN","SCRPW14",66,0)
 K SDLIST D GETDX^SDOE(SDOE,"SDLIST")
"RTN","SCRPW14",67,0)
 S SDOED=0 F  S SDOED=$O(SDLIST(SDOED)) Q:'SDOED  S SDOED0=SDLIST(SDOED) D:$L(SDOED0) DSET(SDIV) D:SDMD DSET(0)
"RTN","SCRPW14",68,0)
 K SDLIST D GETCPT^SDOE(SDOE,"SDLIST")
"RTN","SCRPW14",69,0)
 S SDVP=0 F  S SDVP=$O(SDLIST(SDVP)) Q:'SDVP  S SDVP0=SDLIST(SDVP) I $L(SDVP0) D PSET(SDIV) D:SDMD PSET(0)
"RTN","SCRPW14",70,0)
 Q
"RTN","SCRPW14",71,0)
 ;
"RTN","SCRPW14",72,0)
SET1(SDIV) S ^TMP("SCRPW",$J,SDIV,1,SDS,"ENC")=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"ENC"))+1,^TMP("SCRPW",$J,SDIV,1,SDS,"PT",+$P(SDOE0,U,2),+$P(SDDT,"."))=""
"RTN","SCRPW14",73,0)
 Q
"RTN","SCRPW14",74,0)
 ;
"RTN","SCRPW14",75,0)
DSET(SDIV) S SDD=+$P(SDOED0,U),SDR=$S($P(SDOED0,U,12)="P":"PRI",1:"SEC"),^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,SDR)=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,SDR))+1 Q
"RTN","SCRPW14",76,0)
 ;
"RTN","SCRPW14",77,0)
PSET(SDIV) ;
"RTN","SCRPW14",78,0)
 I SD("CAT")="P",'$$OLD^SDOEUT(SDOE) S SDPR=$P($G(^AUPNVCPT(SDVP,12)),U,4) Q:'$D(SD("LIST",+SDPR))
"RTN","SCRPW14",79,0)
 ;S SDP=+$P(SDVP0,U),SDQ=$P(SDVP0,U,16) S:'SDQ SDQ=1 S ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP)=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP))+SDQ Q
"RTN","SCRPW14",80,0)
 ;SDP=procedure pointer, SDQ=procedure quantity
"RTN","SCRPW14",81,0)
 S SDP=+$P(SDVP0,U)
"RTN","SCRPW14",82,0)
 S SDQ=$P(SDVP0,U,16)
"RTN","SCRPW14",83,0)
 S:'SDQ SDQ=1
"RTN","SCRPW14",84,0)
 ; add quantity to total quantity for current procedure
"RTN","SCRPW14",85,0)
 S ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP)=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP))+SDQ
"RTN","SCRPW14",86,0)
 ;
"RTN","SCRPW14",87,0)
 ;Loop through modifiers and add to ^TMP array
"RTN","SCRPW14",88,0)
 N SDMODN,SDMOD
"RTN","SCRPW14",89,0)
 S SDMODN=0
"RTN","SCRPW14",90,0)
 F  S SDMODN=+$O(SDLIST(SDVP,1,SDMODN)) Q:'SDMODN  D
"RTN","SCRPW14",91,0)
 .S SDMOD=$P(SDLIST(SDVP,1,SDMODN,0),"^")
"RTN","SCRPW14",92,0)
 .;add modifier quantity to array
"RTN","SCRPW14",93,0)
 .S:SDMOD ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP,SDMOD)=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP,SDMOD))+SDQ
"RTN","SCRPW14",94,0)
 Q
"RTN","SCRPW14",95,0)
 ;
"RTN","SCRPW14",96,0)
CAT(SDS) ;Determine if encounter fits category
"RTN","SCRPW14",97,0)
 ;Required input: SDS array to return list
"RTN","SCRPW14",98,0)
 ;Output: SDS(ifn) array=list of category ifns to tally
"RTN","SCRPW14",99,0)
 I SD("CAT")="C" S SDCL=$P(SDOE0,U,4) Q:SDCL<1 0  S:SD("FMT")="S"!$D(SD("LIST",+SDCL)) SDS(SDCL)="" Q $D(SDS)
"RTN","SCRPW14",100,0)
 I SD("CAT")="P" D CATP Q $D(SDS)
"RTN","SCRPW14",101,0)
 I SD("CAT")="S" D CATS Q $D(SDS)
"RTN","SCRPW14",102,0)
 Q 0
"RTN","SCRPW14",103,0)
 ;
"RTN","SCRPW14",104,0)
CATP ;Get providers
"RTN","SCRPW14",105,0)
 K SDLIST D GETPRV^SDOE(SDOE,"SDLIST")
"RTN","SCRPW14",106,0)
 S SDPI=0 F  S SDPI=$O(SDLIST(SDPI))  Q:'SDPI  S SDP=$P(SDLIST(SDPI),U) S:SD("FMT")="S"!$D(SD("LIST",SDP)) SDS(SDP)=""
"RTN","SCRPW14",107,0)
 Q
"RTN","SCRPW14",108,0)
 ;
"RTN","SCRPW14",109,0)
CATS ;Get stop codes
"RTN","SCRPW14",110,0)
 S SDSC=+$P(SDOE0,U,3) S:SD("FMT")="S"!$D(SD("LIST",SDSC)) SDS(SDSC)=""
"RTN","SCRPW14",111,0)
 S SDCH=0 F  S SDCH=$O(^SCE("APAR",SDOE,SDCH)) Q:'SDCH  S SDCH0=$$GETOE^SDOE(SDCH) I $P(SDCH0,U,8)=4 S SDSC=+$P(SDCH0,U,3) S:SD("FMT")="S"!$D(SD("LIST",SDSC)) SDS(SDSC)=""
"RTN","SCRPW14",112,0)
 Q
"RTN","SCRPW15")
0^2^B68454595^B67718404
"RTN","SCRPW15",1,0)
SCRPW15 ;RENO/KEITH - Encounter Activity Report (Cont.) ;06/19/99
"RTN","SCRPW15",2,0)
 ;;5.3;Scheduling;**139,144,166,180,295,593**;AUG 13, 1993;Build 13
"RTN","SCRPW15",3,0)
 ;06/19/99 ACS - Added CPT modifiers to the report
"RTN","SCRPW15",4,0)
 ;06/19/99 ACS - Added CPT modifier API calls
"RTN","SCRPW15",5,0)
 ;
"RTN","SCRPW15",6,0)
 N LINEFLAG
"RTN","SCRPW15",7,0)
 S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""!SDOUT  D DCAL
"RTN","SCRPW15",8,0)
 S SDLINE="",$P(SDLINE,"-",81)="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),(SDPAGE,SDFFS)=1
"RTN","SCRPW15",9,0)
 S SDIV="" F  S SDIV=$O(SDDIV(SDIV)) Q:'SDIV  S SDIV(SDDIV(SDIV))=SDIV
"RTN","SCRPW15",10,0)
 I 'SDDIV,$P(SDDIV,U,2)'="ALL DIVISIONS" S SDIV($P(SDDIV,U,2))=$$PRIM^VASITE()
"RTN","SCRPW15",11,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:$L(SDX) SDIV(SDX)=SDI
"RTN","SCRPW15",12,0)
 D:$E(IOST)="C" DISP0^SCRPW23 I '$O(^TMP("SCRPW",$J,0)) S SDIV=0 D DHDR^SCRPW40(2,.SDT) D HDR() Q:SDOUT  S SDX="No activity found within selected report parameters!" W !!?(80-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW15",13,0)
 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW15",14,0)
 S SDI=0,SDI=$O(^TMP("SCRPW",$J,SDI)),SDMD=$O(^TMP("SCRPW",$J,SDI))
"RTN","SCRPW15",15,0)
 G:SDOUT EXIT I SDMD S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW15",16,0)
 ;
"RTN","SCRPW15",17,0)
 I $E(IOST)="C",'$G(SDOUT) N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW15",18,0)
EXIT K SD,SDDIV G EXIT^SCRPW14
"RTN","SCRPW15",19,0)
 ;
"RTN","SCRPW15",20,0)
DCAL ;Calculate numbers for a division
"RTN","SCRPW15",21,0)
 D STOP^SCRPW14 Q:SDOUT
"RTN","SCRPW15",22,0)
 S SDS=0 F  S SDS=$O(^TMP("SCRPW",$J,SDIV,1,SDS)) Q:'SDS  D S1 S ^TMP("SCRPW",$J,SDIV,1,SDS,"VIS")=SDVS(SDIV),^TMP("SCRPW",$J,SDIV,1,SDS,"UNIQ")=SDUN(SDIV),^TMP("SCRPW",$J,SDIV,2,$$ORD(),SDS)=""
"RTN","SCRPW15",23,0)
 S (SDRPVS(SDIV),SDRPUN(SDIV),DFN)=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,"RPT","PT",DFN)) Q:'DFN  S SDRPUN(SDIV)=SDRPUN(SDIV)+1,SDDT=0 F  S SDDT=$O(^TMP("SCRPW",$J,SDIV,"RPT","PT",DFN,SDDT)) Q:'SDDT  S SDRPVS(SDIV)=SDRPVS(SDIV)+1
"RTN","SCRPW15",24,0)
 Q
"RTN","SCRPW15",25,0)
 ;
"RTN","SCRPW15",26,0)
DPRT(SDIV) ;Print report for a division
"RTN","SCRPW15",27,0)
 S:SD("FMT")="D" SDDET=1 D T3 S SDPAGE=1 I '$D(^TMP("SCRPW",$J,SDIV)) S SDX="No activity found for this division!" D HDR() Q:SDOUT  W !!?(80-$L(SDX)\2),SDX Q
"RTN","SCRPW15",28,0)
 D HDR() Q:SDOUT
"RTN","SCRPW15",29,0)
 S SDSV="" F  S SDSV=$O(^TMP("SCRPW",$J,SDIV,2,SDSV),$S(SD("ORD")="A":1,1:-1)) Q:SDSV=""!SDOUT  S SDS=0 F  S SDS=$O(^TMP("SCRPW",$J,SDIV,2,SDSV,SDS)) Q:'SDS!SDOUT  D PRT
"RTN","SCRPW15",30,0)
 Q:SDOUT  I SD("FMT")="S" D RTOT Q
"RTN","SCRPW15",31,0)
 Q:SDOUT  D:SD("FMT")="D" NONE Q
"RTN","SCRPW15",32,0)
 ;
"RTN","SCRPW15",33,0)
S1 S (SDVS(SDIV),SDUN(SDIV),SDPT)=0 F  S SDPT=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PT",SDPT)) Q:'SDPT  S SDUN(SDIV)=SDUN(SDIV)+1,SDDT=0 F  S SDDT=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PT",SDPT,SDDT)) Q:'SDDT  S SDVS(SDIV)=SDVS(SDIV)+1
"RTN","SCRPW15",34,0)
 Q:SD("FMT")="S"
"RTN","SCRPW15",35,0)
 S SDD=0 F  S SDD=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD)) Q:'SDD  S SDTOT=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,"PRI"))+$G(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,"SEC")),^TMP("SCRPW",$J,SDIV,1,SDS,"DXTOT",SDTOT,SDD)=""
"RTN","SCRPW15",36,0)
 S SDP=0 F  S SDP=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP)) Q:'SDP  S SDTOT=^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDP),^TMP("SCRPW",$J,SDIV,1,SDS,"PROCTOT",SDTOT,SDP)=""
"RTN","SCRPW15",37,0)
 Q
"RTN","SCRPW15",38,0)
 ;
"RTN","SCRPW15",39,0)
ORD() ;Produce sort value
"RTN","SCRPW15",40,0)
 Q:SD("ORD")="V" SDVS(SDIV)  Q:SD("ORD")="U" SDUN(SDIV)  Q:SD("ORD")="E" ^TMP("SCRPW",$J,SDIV,1,SDS,"ENC")  Q $$SNAME()
"RTN","SCRPW15",41,0)
 ;
"RTN","SCRPW15",42,0)
HDR(SDPG) ;Print page header
"RTN","SCRPW15",43,0)
 D STOP^SCRPW14 Q:SDOUT
"RTN","SCRPW15",44,0)
 I $E(IOST)="C",'SDFFS N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW15",45,0)
 S:$G(SDPG) SDPAGE=+SDPG W:'SDFFS $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE,!?22,"<*>  ENCOUNTER ACTIVITY REPORT  <*>"
"RTN","SCRPW15",46,0)
 N SDI S SDI=0 F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(80-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW15",47,0)
 I SDPAGE=1 W !,SDLINE D PVIEW(15,1)
"RTN","SCRPW15",48,0)
 W !,SDLINE,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1,SDFFS=0
"RTN","SCRPW15",49,0)
 Q:'$D(^TMP("SCRPW",$J,SDIV))
"RTN","SCRPW15",50,0)
 Q:$G(SDPG)["N"  I SD("FMT")="D",SDPAGE>2 W !,$S(SD("CAT")="C":"Clinic: ",SD("CAT")="P":"Provider: ",1:"Stop Code: "),$$SNAME(),"  (cont.)",! Q
"RTN","SCRPW15",51,0)
 W !,$S(SD("CAT")="C":"Clinic",SD("CAT")="P":"Provider",1:"Stop Code"),?40,"Encounters",?59,"Visits",?73,"Uniques",!,"------------------------------------",?40,"----------",?55,"----------",?70,"----------"
"RTN","SCRPW15",52,0)
 Q
"RTN","SCRPW15",53,0)
 ;
"RTN","SCRPW15",54,0)
RTOT ;Print report total
"RTN","SCRPW15",55,0)
 D:$Y>(IOSL-5) HDR() Q:SDOUT  W !!,"====================================",?40,"==========",?55,"==========",?70,"==========",!!,"REPORT TOTAL:",?40,$J(SDRPEN(SDIV),10),?55,$J(SDRPVS(SDIV),10),?70,$J(SDRPUN(SDIV),10) Q
"RTN","SCRPW15",56,0)
 ;
"RTN","SCRPW15",57,0)
T3 K SDTIT D DHDR^SCRPW40(1,.SDTIT) Q
"RTN","SCRPW15",58,0)
 ;
"RTN","SCRPW15",59,0)
PVIEW(SDCOL,SDSKIP) ;Print report parameters
"RTN","SCRPW15",60,0)
 ;Required input: SDCOL=column to position output
"RTN","SCRPW15",61,0)
 ;Required input: SDSKIP=1 to skip division data on output
"RTN","SCRPW15",62,0)
 D:'$G(SDSKIP) PDIV W !?SDCOL,"    Activity date range: " S Y=SD("BDT") X ^DD("DD") W Y," to " S Y=$P(SD("EDT"),".") X ^DD("DD") W Y
"RTN","SCRPW15",63,0)
 W !?(SDCOL+8),"Report category: ",$S(SD("CAT")="C":"CLINIC",SD("CAT")="P":"PROVIDER",1:"STOP CODE")," perspective",!?(SDCOL+10),"Output format: ",$S(SD("FMT")="S":"SUMMARY",1:"DETAIL")
"RTN","SCRPW15",64,0)
 I SD("FMT")="S" W !?(SDCOL+8),"Collation order: ",$S(SD("ORD")="A":"ALPHABETIC",SD("ORD")="E":"by ENCOUNTER TOTAL",SD("ORD")="V":"by VISIT TOTAL",1:"by UNIQUE TOTAL")
"RTN","SCRPW15",65,0)
 W !?(SDCOL+7),"Encounter status: " S X=$O(SD("STAT",0)) W $P(^SD(409.63,X,0),U) F  S X=$O(SD("STAT",X)) Q:'X  W !?(SDCOL+25),$P(^SD(409.63,X,0),U)
"RTN","SCRPW15",66,0)
 Q
"RTN","SCRPW15",67,0)
 ;
"RTN","SCRPW15",68,0)
PDIV I 'SDDIV W !?SDCOL,"Medical Center Division: ",$P(SDDIV,U,2) Q
"RTN","SCRPW15",69,0)
 N SDI S SDI=0 F  S SDI=$O(SDDIV(SDI)) Q:'SDI  W !?SDCOL,"Medical Center Division: ",SDDIV(SDI)
"RTN","SCRPW15",70,0)
 Q
"RTN","SCRPW15",71,0)
 ;
"RTN","SCRPW15",72,0)
SNAME() ;Produce item name
"RTN","SCRPW15",73,0)
 Q:SD("CAT")="C" $P($G(^SC(SDS,0),"UNKNOWN"),U)  Q:SD("CAT")="P" $P($G(^VA(200,SDS,0),"UNKNOWN"),U)
"RTN","SCRPW15",74,0)
 N X S X=$G(^DIC(40.7,SDS,0),"UNKNOWN^UNKNOWN"),X=$P(X,U,2)_" - "_$P(X,U) Q X
"RTN","SCRPW15",75,0)
 ;
"RTN","SCRPW15",76,0)
PRT ;Print data
"RTN","SCRPW15",77,0)
 I SD("FMT")="D",'$G(SDDET) D HDR(1) Q:SDOUT
"RTN","SCRPW15",78,0)
 D:$Y>(IOSL-4) HDR() Q:SDOUT  K SDDET W !,$$SNAME(),?40,$J(^TMP("SCRPW",$J,SDIV,1,SDS,"ENC"),10),?55,$J(^TMP("SCRPW",$J,SDIV,1,SDS,"VIS"),10),?70,$J(^TMP("SCRPW",$J,SDIV,1,SDS,"UNIQ"),10) I SD("FMT")="D" D DX Q:SDOUT  D PROC
"RTN","SCRPW15",79,0)
 Q
"RTN","SCRPW15",80,0)
 ;
"RTN","SCRPW15",81,0)
DX ;Print diagnosis information
"RTN","SCRPW15",82,0)
 D DXHD I '$D(^TMP("SCRPW",$J,SDIV,1,SDS,"DX")) W !!,"(No diagnosis information identified)" Q
"RTN","SCRPW15",83,0)
 S (SDT,SDTOT,SDTOT1,SDTOT2)="" F  S SDT=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"DXTOT",SDT),-1) Q:SDT=""!SDOUT  S SDD=0 F  S SDD=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"DXTOT",SDT,SDD)) Q:'SDD!SDOUT  D DX1
"RTN","SCRPW15",84,0)
 Q:SDOUT
"RTN","SCRPW15",85,0)
 W !,"====================================",?40,"==========",?55,"==========",?70,"==========",!,"TOTAL:",?40,$J(SDTOT1,10),?55,$J(SDTOT2,10),?70,$J(SDTOT,10) Q
"RTN","SCRPW15",86,0)
 ;
"RTN","SCRPW15",87,0)
DX1 ;
"RTN","SCRPW15",88,0)
 N SDDIAG,DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C36|"
"RTN","SCRPW15",89,0)
 D:$Y>(IOSL-6) HDR(),DXHD Q:SDOUT
"RTN","SCRPW15",90,0)
 S SDD0=$$ICDDX^SCRPWICD(SDD) S SDDIAG=$P(SDD0,U,2)_"  "_$P(SDD0,U,4)
"RTN","SCRPW15",91,0)
 S SDT1=+$G(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,"PRI"))
"RTN","SCRPW15",92,0)
 S SDT2=+$G(^TMP("SCRPW",$J,SDIV,1,SDS,"DX",SDD,"SEC"))
"RTN","SCRPW15",93,0)
 S SDTOT1=SDTOT1+SDT1 S SDTOT2=SDTOT2+SDT2 S SDTOT=SDTOT+SDT1+SDT2
"RTN","SCRPW15",94,0)
 K ^UTILITY($J,"W") S X=SDDIAG D ^DIWP
"RTN","SCRPW15",95,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) W !,$E(^UTILITY($J,"W",DIWL,SDL2,0),1,36)
"RTN","SCRPW15",96,0)
 W ?40,$J(SDT1,10),?55,$J(SDT2,10),?70,$J((SDT1+SDT2),10)
"RTN","SCRPW15",97,0)
 Q
"RTN","SCRPW15",98,0)
 ;
"RTN","SCRPW15",99,0)
DXHD ;Diagnosis sub-header
"RTN","SCRPW15",100,0)
 Q:SDOUT  W !!,"Diagnosis",?43,"Primary",?56,"Secondary",?75,"Total",!,"------------------------------------",?40,"----------",?55,"----------",?70,"----------" Q
"RTN","SCRPW15",101,0)
 ;
"RTN","SCRPW15",102,0)
PROC ;Print procedure information
"RTN","SCRPW15",103,0)
 D:$Y>(IOSL-8) HDR() Q:SDOUT  D PROCHD I '$D(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC")) W !!?12,"(No procedure information identified)" Q
"RTN","SCRPW15",104,0)
 S (SDT,SDTOT)="" F  S SDT=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROCTOT",SDT),-1) Q:SDT=""!SDOUT  S SDP=0 F  S SDP=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROCTOT",SDT,SDP)) Q:'SDP!SDOUT  D PROC1
"RTN","SCRPW15",105,0)
 Q:SDOUT
"RTN","SCRPW15",106,0)
 W !?12,"===================================",?55,"==========",!?12,"PROCEDURE TOTAL:",?55,$J(SDTOT,10) Q
"RTN","SCRPW15",107,0)
 ;
"RTN","SCRPW15",108,0)
PROC1 ;D:$Y>(IOSL-6) HDR(),PROCHD Q:SDOUT  S SDP0=^ICPT(SDP,0),SDTOT=SDTOT+SDT W !?12,$P(SDP0,U),?18,$P(SDP0,U,2),?55,$J(SDT,10) Q
"RTN","SCRPW15",109,0)
 N CPTCODE,CPTTEXT,SDMOD,SDMODQTY
"RTN","SCRPW15",110,0)
 D:$Y>(IOSL-6) HDR(),PROCHD Q:SDOUT
"RTN","SCRPW15",111,0)
 S SDP0=$$CPT^ICPTCOD(SDP,,1)
"RTN","SCRPW15",112,0)
 Q:SDP0'>0
"RTN","SCRPW15",113,0)
 S CPTCODE=$P(SDP0,U,2)
"RTN","SCRPW15",114,0)
 S CPTTEXT=$P(SDP0,U,3)
"RTN","SCRPW15",115,0)
 S SDTOT=SDTOT+SDT
"RTN","SCRPW15",116,0)
 ;print procedure, desc, quantity
"RTN","SCRPW15",117,0)
 I LINEFLAG W !
"RTN","SCRPW15",118,0)
 W !?12,CPTCODE,?18,CPTTEXT,?55,$J(SDT,10)
"RTN","SCRPW15",119,0)
 S LINEFLAG=1
"RTN","SCRPW15",120,0)
 ;build array to hold ranked modifiers
"RTN","SCRPW15",121,0)
 K ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",2)
"RTN","SCRPW15",122,0)
 S SDMOD=""
"RTN","SCRPW15",123,0)
 S SDPROC=SDP
"RTN","SCRPW15",124,0)
 F  S SDMOD=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDPROC,SDMOD)) Q:SDMOD=""  D
"RTN","SCRPW15",125,0)
 . S SDMODQTY=$G(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",SDPROC,SDMOD))
"RTN","SCRPW15",126,0)
 . S ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",2,SDMODQTY,SDMOD)=""
"RTN","SCRPW15",127,0)
 . Q
"RTN","SCRPW15",128,0)
 ; loop through ranked modifiers
"RTN","SCRPW15",129,0)
 S SDMODQTY=""
"RTN","SCRPW15",130,0)
 F  S SDMODQTY=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",2,SDMODQTY),-1) Q:SDMODQTY=""  D
"RTN","SCRPW15",131,0)
 . S SDMOD=""
"RTN","SCRPW15",132,0)
 . F  S SDMOD=$O(^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",2,SDMODQTY,SDMOD),-1) Q:SDMOD=""  D
"RTN","SCRPW15",133,0)
 .. D:$Y>(IOSL-6) HDR(),PROCHD Q:SDOUT
"RTN","SCRPW15",134,0)
 .. N MODINFO,MODCODE,MODTEXT,SDMQTY2
"RTN","SCRPW15",135,0)
 .. S MODINFO=$$MOD^ICPTMOD(SDMOD,"I",,1)
"RTN","SCRPW15",136,0)
 .. I +MODINFO'>0 Q
"RTN","SCRPW15",137,0)
 .. S MODCODE=$P(MODINFO,"^",2)
"RTN","SCRPW15",138,0)
 .. ; format for printing
"RTN","SCRPW15",139,0)
 .. S MODCODE=$S($L(MODCODE)=1:"  "_MODCODE,1:" "_MODCODE)
"RTN","SCRPW15",140,0)
 .. S MODTEXT=$E($P(MODINFO,"^",3),1,32)
"RTN","SCRPW15",141,0)
 .. ;print modifier, desc, and quantity
"RTN","SCRPW15",142,0)
 .. S SDMQTY2="-"_SDMODQTY
"RTN","SCRPW15",143,0)
 .. W !,?13,"-",MODCODE,?18,MODTEXT,?55,$J(SDMQTY2,10)
"RTN","SCRPW15",144,0)
 .. Q
"RTN","SCRPW15",145,0)
 . S LINEFLAG=1
"RTN","SCRPW15",146,0)
 . Q
"RTN","SCRPW15",147,0)
 K ^TMP("SCRPW",$J,SDIV,1,SDS,"PROC",2)
"RTN","SCRPW15",148,0)
 Q
"RTN","SCRPW15",149,0)
 ;
"RTN","SCRPW15",150,0)
PROCHD S LINEFLAG=0 Q:SDOUT  W !!?12,"Procedures/Modifiers",?60,"Total",!?12,"--------------------------------------",?55,"----------" Q
"RTN","SCRPW15",151,0)
 ;
"RTN","SCRPW15",152,0)
NONE ;List items with no activity
"RTN","SCRPW15",153,0)
 S SDS=0 F  S SDS=$O(SD("LIST",SDS)) Q:'SDS!SDOUT  I '$D(^TMP("SCRPW",$J,SDIV,1,SDS)) S SDN=1 D HDR("1N") Q
"RTN","SCRPW15",154,0)
 I $G(SDN) S SDS=0 F  S SDS=$O(SD("LIST",SDS)) Q:'SDS!SDOUT  I '$D(^TMP("SCRPW",$J,SDIV,1,SDS)) D:$Y>(IOSL-4) HDR("N") Q:SDOUT  D NO1
"RTN","SCRPW15",155,0)
 Q
"RTN","SCRPW15",156,0)
 ;
"RTN","SCRPW15",157,0)
NO1 W !!,"No activity found for ",$S(SD("CAT")="C":"clinic",SD("CAT")="P":"provider",1:"stop code"),": ",$$SNAME() Q
"RTN","SCRPW20")
0^3^B69405288^B64415761
"RTN","SCRPW20",1,0)
SCRPW20 ;RENO/KEITH - ACRP Ad Hoc Report ;15 Nov 98  4:31 PM
"RTN","SCRPW20",2,0)
 ;;5.3;Scheduling;**144,171,593**;AUG 13, 1993;Build 13
"RTN","SCRPW20",3,0)
 I $E(IOST)'="C" D  Q
"RTN","SCRPW20",4,0)
 .N SDX S SDX="Your current terminal type is "_IOST_"." W !?(IOM-$L(SDX)\2),SDX
"RTN","SCRPW20",5,0)
 .S SDX="This option requires a CRT terminal type!" W !!?(IOM-$L(SDX)\2),SDX,! Q
"RTN","SCRPW20",6,0)
 K ^TMP("SCRPW",$J),SDPAR D BLD^SCRPW21 N DIR,X,Y,SDOUT,T S (SDREV,SDOUT)=0,T="~"
"RTN","SCRPW20",7,0)
 F SDTAG="INTRO","FMT","PERS","LIM","ORD","XPF","REVIEW" D @SDTAG Q:SDOUT!SDREV
"RTN","SCRPW20",8,0)
 G:SDOUT EXIT^SCRPW27 D SAVT^SCRPW21(.SDPAR)
"RTN","SCRPW20",9,0)
QUE N ZTSAVE S ZTSAVE("SDPAR(")="" D MAR^SCRPW29,EN^XUTMDEVQ("RPT^SCRPW26","ACRP Ad Hoc Report",.ZTSAVE) G EXIT^SCRPW27
"RTN","SCRPW20",10,0)
 ;
"RTN","SCRPW20",11,0)
INTRO K SDBOT S (SDTOP,SDBOT(1))="A C R P   A d   H o c   R e p o r t" D DISP^SCRPW23(SDTOP,.SDBOT),INTRO^SCRPW26
"RTN","SCRPW20",12,0)
 I $$REST^SCRPW22() H 1 S SDREV=1 G REVIEW
"RTN","SCRPW20",13,0)
 Q:SDOUT  I '$O(^SDD(409.91,0)) W !! K DIR S DIR(0)="E" S X=$$DIR^SCRPW23(.DIR,0)
"RTN","SCRPW20",14,0)
 Q
"RTN","SCRPW20",15,0)
FMT ;Get format parameters
"RTN","SCRPW20",16,0)
 S SDS1="F",(SDOUT,SDNUL)=0,SDBOT(1)="Report format selection",SDBOT(2)="Report format parameters determine the appearance of the report."
"RTN","SCRPW20",17,0)
 D DISP^SCRPW23("R E P O R T   F O R M A T",.SDBOT)
"RTN","SCRPW20",18,0)
 F SDTAG="F1","F2","F3","F4","F5","F6" D @SDTAG Q:SDOUT
"RTN","SCRPW20",19,0)
 G:$$VF^SCRPW29() FMT I SDREV G:$$VP^SCRPW29() PERS
"RTN","SCRPW20",20,0)
 Q
"RTN","SCRPW20",21,0)
PERS ;Prompt for perspective
"RTN","SCRPW20",22,0)
 K SDBOT S SDS1="P",(SDOUT,SDNUL)=0,SDBOT(1)="Report perspective selection",SDBOT(2)="The element selected for this parameter will determine how the statistics will",SDBOT(3)="be organized and sub-totaled."
"RTN","SCRPW20",23,0)
 D DISP^SCRPW23("R E P O R T   P E R S P E C T I V E",.SDBOT)
"RTN","SCRPW20",24,0)
 D P1 G:$$VP^SCRPW29() PERS Q
"RTN","SCRPW20",25,0)
LIM ;Prompt for limitations
"RTN","SCRPW20",26,0)
 K SDBOT S SDS1="L",(SDOUT,SDNUL)=0
"RTN","SCRPW20",27,0)
 S SDBOT(1)="Report limitation selection",SDBOT(2)="Limiting factors determine which encounter records to count.  Multiple limiting",SDBOT(3)="factors can be chosen and specified to only include (or exclude) specific data."
"RTN","SCRPW20",28,0)
 D DISP^SCRPW23("R E P O R T   L I M I T A T I O N S",.SDBOT)
"RTN","SCRPW20",29,0)
 F SDTAG="L1","L2" D @SDTAG Q:SDOUT
"RTN","SCRPW20",30,0)
 G:$$VL^SCRPW29() LIM Q
"RTN","SCRPW20",31,0)
ORD ;Prompt for print order
"RTN","SCRPW20",32,0)
 K SDBOT S SDS1="O",(SDOUT,SDNUL)=0,SDBOT(1)="Report print order selection",SDBOT(2)="This parameter determines the order in which the report will be printed."
"RTN","SCRPW20",33,0)
 D DISP^SCRPW23("R E P O R T   P R I N T   O R D E R",.SDBOT)
"RTN","SCRPW20",34,0)
 K DIR D DIRB1^SCRPW23("O",1,"ALPHABETIC") S DIR("A")="Select report print order",DIR(0)="S^A:ALPHABETIC;E:ENCOUNTER TOTAL;V:VISIT TOTAL;U:UNIQUE TOTAL",DIR("?")="Specify the order to print elements of selected perspective."
"RTN","SCRPW20",35,0)
 S SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("O",1)=SDX Q:SDOUT
"RTN","SCRPW20",36,0)
 D DESC^SCRPW22 Q:SDOUT  G:$$VO^SCRPW29() ORD Q
"RTN","SCRPW20",37,0)
 ;
"RTN","SCRPW20",38,0)
XY(X) ;Maintain $X, $Y
"RTN","SCRPW20",39,0)
 ;Required input: X=screen handling variable to write
"RTN","SCRPW20",40,0)
 N DX,DY S DX=$X,DY=$Y W X X SDXY Q ""
"RTN","SCRPW20",41,0)
 ;
"RTN","SCRPW20",42,0)
XPF ;Extra print fields
"RTN","SCRPW20",43,0)
 D PF^SCRPW29 Q
"RTN","SCRPW20",44,0)
 ;
"RTN","SCRPW20",45,0)
REVIEW ;Review selected parameters
"RTN","SCRPW20",46,0)
 D REVSCR,REV0 Q
"RTN","SCRPW20",47,0)
 ;
"RTN","SCRPW20",48,0)
REVSCR K SDBOT S SDTOP="S e l e c t e d   R e p o r t   P a r a m e t e r s",SDBOT(1)="Parameters selected for ACRP Ad Hoc Report",SDBOT(2)="These parameters will determine the appearance and data contained in the output."
"RTN","SCRPW20",49,0)
 D DISP^SCRPW23(SDTOP,.SDBOT) Q
"RTN","SCRPW20",50,0)
 ;
"RTN","SCRPW20",51,0)
VERS ;Verify segments
"RTN","SCRPW20",52,0)
 W ! F SDX="VF","VP","VL","VO" S SDX="$$"_SDX_"^SCRPW29(1)" I @(SDX)
"RTN","SCRPW20",53,0)
 Q
"RTN","SCRPW20",54,0)
 ;
"RTN","SCRPW20",55,0)
REV0 N SDERR S SDREV=1,SDOUT=0 D PLIST^SCRPW22(0,15) S SDOUT=0
"RTN","SCRPW20",56,0)
REV1 D VERS W:SDOUT ! S SDOUT=0 W !?32,$$XY(IORVON)," Report action ",$$XY(IORVOFF)
"RTN","SCRPW20",57,0)
 K DIR S DIR("A")="Select report action",DIR(0)="S^C:CONTINUE;E:EDIT PARAMETERS;R:RE-DISPLAY PARAMETERS;P:PRINT PARAMETERS;Q:QUIT",DIR("B")="CONTINUE",SDACT=$P($$DIR^SCRPW23(.DIR,0),U)
"RTN","SCRPW20",58,0)
 I $D(DTOUT)!$D(DUOUT)!(SDACT="Q") S SDOUT=1 Q
"RTN","SCRPW20",59,0)
 I SDACT="P" N ZTSAVE S ZTSAVE("SDPAR(")="" W ! D EN^XUTMDEVQ("PPAR^SCRPW27","ACRP Ad Hoc Report Parameters",.ZTSAVE) G REV1
"RTN","SCRPW20",60,0)
 G:SDACT="R" REVIEW
"RTN","SCRPW20",61,0)
 I SDACT="C" D  Q:'SDOUT  S SDOUT=0 S SDERR="" G REV1
"RTN","SCRPW20",62,0)
 . S SDOUT=0 D VERS
"RTN","SCRPW20",63,0)
 . I SDOUT W !!,"Required information missing. Unable to continue with queuing!" H 3 Q
"RTN","SCRPW20",64,0)
 . S SDOUT=$$VERICD^SCRPW29(.SDERR)
"RTN","SCRPW20",65,0)
 . I SDOUT W:$G(SDERR)]"" !!,SDERR W !!,"Unable to continue with queuing!" H 3 Q
"RTN","SCRPW20",66,0)
 F  S (SDOUT,SDNUL)=0 W !!?31,$$XY(IORVON)," Re-edit actions ",$$XY(IORVOFF) D RDIR S SDACT=$P($$DIR^SCRPW23(.DIR,0),U) Q:SDOUT!SDNUL  D REV2,REVSCR Q:SDOUT!SDNUL
"RTN","SCRPW20",67,0)
 S (SDOUT,SDNUL)=0 G REV1
"RTN","SCRPW20",68,0)
 ;
"RTN","SCRPW20",69,0)
RDIR K DIR S DIR("A")="Select section to re-edit",DIR(0)="SO^F:FORMAT;P:PERSPECTIVE;L:LIMITATIONS;O:ORDER;"_$$PFC^SCRPW29()_"A:ALL SECTIONS;E:EXIT FROM RE-EDIT" Q
"RTN","SCRPW20",70,0)
 ;
"RTN","SCRPW20",71,0)
REV2 I SDACT="E" S SDNUL=1 Q
"RTN","SCRPW20",72,0)
 D @($S(SDACT="F":"FMT",SDACT="P":"PERS",SDACT="L":"LIM",SDACT="O":"ORD",SDACT="X":"XPF",1:"REV3")) Q
"RTN","SCRPW20",73,0)
 ;
"RTN","SCRPW20",74,0)
REV3 F SDACT="FMT","PERS","LIM","ORD","XPF" D @SDACT Q:SDOUT
"RTN","SCRPW20",75,0)
 Q
"RTN","SCRPW20",76,0)
 ;
"RTN","SCRPW20",77,0)
F1 K DIR D DIRB1^SCRPW23("F",1,"SUMMARY") S DIR("A")="Select report format",DIR(0)="S^D:DETAILED;S:SUMMARY",DIR("?",1)="DETAILED format allows the listing of encounters, visits or uniques and ranked"
"RTN","SCRPW20",78,0)
 S DIR("?",2)="lists of diagnoses and procedures for selected items in the selected",DIR("?",3)="perspective.  SUMMARY format provides subtotals of encounters, visits and"
"RTN","SCRPW20",79,0)
 S DIR("?",4)="uniques for all items in a selected perspective and allows subtotals to be",DIR("?")="compared to the same date range in the previous year.",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",1)=SDX D PFR^SCRPW29 Q
"RTN","SCRPW20",80,0)
 ;
"RTN","SCRPW20",81,0)
F2 I $P(SDPAR("F",1),U)="S" W ! K DIR D DIRB1^SCRPW23("F",2,"NO") S DIR("A")="Compare data to same date range for the previous year",DIR(0)="Y",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",2)=SDX
"RTN","SCRPW20",82,0)
 Q
"RTN","SCRPW20",83,0)
 ;
"RTN","SCRPW20",84,0)
F3 Q:$P(SDPAR("F",1),U)="S"  K DIR D DIRB1^SCRPW23("F",3)
"RTN","SCRPW20",85,0)
 S DIR("A")="Select type of detail",DIR(0)="S^E:ENCOUNTER/VISIT/UNIQUE LIST;D:DIAGNOSIS/PROCEDURE RANKING;B:BOTH ACTIVITY & DX/PROC. LISTS",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",3)=SDX D PFR^SCRPW29 Q
"RTN","SCRPW20",86,0)
 ;
"RTN","SCRPW20",87,0)
F4 Q:$P(SDPAR("F",1),U)="S"  Q:"BE"'[$P(SDPAR("F",3),U)
"RTN","SCRPW20",88,0)
 K DIR D DIRB1^SCRPW23("F",4) S DIR("A")="List activity by",DIR(0)="S^E:ENCOUNTER;V:VISIT;U:UNIQUE",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",4)=SDX D PFR^SCRPW29 Q
"RTN","SCRPW20",89,0)
 ;
"RTN","SCRPW20",90,0)
F5 Q:$P(SDPAR("F",1),U)="S"  Q:"BD"'[$P(SDPAR("F",3),U)  K DIR
"RTN","SCRPW20",91,0)
 W ! D DIRB1^SCRPW23("F",5,50) S DIR("A")="Limit Dx/procedure list to most frequent",DIR(0)="N^1:999:0",DIR("?")="Specify how many of the most frequent items to list.",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",5)=SDX Q
"RTN","SCRPW20",92,0)
 ;
"RTN","SCRPW20",93,0)
F6 K DIR W ! D DIRB1^SCRPW23("F",6,"FORMATTED TEXT") S DIR("A")="Produce output as",DIR(0)="S^F:FORMATTED TEXT;D:DELIMITED VALUES FOR EXPORT TO SPREADSHEET",SDX=$$DIR^SCRPW23(.DIR,0) S:$L(SDX) SDPAR("F",6)=SDX Q
"RTN","SCRPW20",94,0)
 ;
"RTN","SCRPW20",95,0)
P1 K DIR,SDPAR("X") D DIRB1^SCRPW23("P",1) S DIR("A")="Select report perspective",DIR("?")="Specify the element to be used for report subtotals." S SDNUL=0,SDS1="P",SDS2=1 D CAT^SCRPW22($S(SDREV:"E",1:"A")) Q:SDOUT
"RTN","SCRPW20",96,0)
 Q
"RTN","SCRPW20",97,0)
 ;
"RTN","SCRPW20",98,0)
L1 N %DT,SDS1,I10DTI,I10DTE D SUBT^SCRPW50("*** Date Range Selection ***")
"RTN","SCRPW20",99,0)
 S Y=$$IMP^SCRPWICD(30) S I10DTI=Y X ^DD("DD") S I10DTE=Y
"RTN","SCRPW20",100,0)
FDT W ! S %DT="AEPX",%DT("A")="Beginning date: ",%DT(0)="-TODAY" D DIRB1^SCRPW23("L",1) S:$D(DIR("B")) %DT("B")=DIR("B") D ^%DT I X=U!($D(DTOUT)) S SDOUT=1 Q
"RTN","SCRPW20",101,0)
 G:Y<1 FDT K:Y>$G(SDPAR("L",2)) SDPAR("L",2) S SDS1=Y X ^DD("DD") S SDPAR("L",1)=SDS1_U_Y
"RTN","SCRPW20",102,0)
LDT W ! S %DT("A")="   Ending date: " D DIRB1^SCRPW23("L",2) S:$D(DIR("B")) %DT("B")=DIR("B") D ^%DT I X=U!($D(DTOUT)) S SDOUT=1 Q
"RTN","SCRPW20",103,0)
 I Y<$P(SDPAR("L",1),U) W !!,$C(7),"Ending date must be after beginning date!" G LDT
"RTN","SCRPW20",104,0)
 S SDS1=Y X ^DD("DD") S SDPAR("L",2)=SDS1_U_Y
"RTN","SCRPW20",105,0)
 I ($P(SDPAR("L",1),U,1)<I10DTI),($P(SDPAR("L",2),U,1)'<I10DTI) D  G FDT
"RTN","SCRPW20",106,0)
 . W !!,$C(7),"Beginning and Ending dates must both be prior to "_I10DTE_" (ICD-9) or both be on or after "_I10DTE_" (ICD-10)."
"RTN","SCRPW20",107,0)
 Q
"RTN","SCRPW20",108,0)
 ;
"RTN","SCRPW20",109,0)
L2 I SDREV D AED^SCRPW22("L") Q
"RTN","SCRPW20",110,0)
L2A S SDS1="L",SDS2=$O(SDPAR(SDS1,""),-1),SDNUL=0 F  Q:SDOUT!SDNUL  S SDS2=SDS2+1 D:'$D(SDPAR(SDS1,SDS2)) L3
"RTN","SCRPW20",111,0)
 Q
"RTN","SCRPW20",112,0)
L3 S SDX="Select "_$S(SDS2=3:"additional",1:"another")_" output limiting factor:  (optional)" W !!?(80-$L(SDX)\2),$$XY(IORVON),SDX,$$XY(IORVOFF) D LDIR,CAT^SCRPW22("A") Q
"RTN","SCRPW20",113,0)
 ;
"RTN","SCRPW20",114,0)
LDIR K DIR S DIR("A")="Select limiting factor",DIR("?")="Specify elements to be used to restrict the scope of data returned." Q
"RTN","SCRPW22")
0^4^B57142560^B52632683
"RTN","SCRPW22",1,0)
SCRPW22 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;03 Aug 98  9:36 PM
"RTN","SCRPW22",2,0)
 ;;5.3;Scheduling;**144,593**;AUG 13, 1993;Build 13
"RTN","SCRPW22",3,0)
PLIST(C,SDLP,SDTEMP) ;Display parameter list
"RTN","SCRPW22",4,0)
 ;Required input: C=column to format left margin
"RTN","SCRPW22",5,0)
 ;Required input: SDLP=number of lines to print on a page
"RTN","SCRPW22",6,0)
 ;Optional input: SDTEMP=array of template information to print
"RTN","SCRPW22",7,0)
 N SDI,SDII,SDS1,SDS2,SDX,SDX1,SDX2,SDL S (SDOUT,SDL)=0
"RTN","SCRPW22",8,0)
 D PHD(" R E P O R T   F O R M A T ") Q:SDOUT  D D1("F","") Q:SDOUT
"RTN","SCRPW22",9,0)
 D PHD(" R E P O R T   P E R S P E C T I V E ") Q:SDOUT  D D2("Perspective","P",1) Q:SDOUT
"RTN","SCRPW22",10,0)
 D PHD(" R E P O R T   L I M I T A T I O N S ") Q:SDOUT  D D1("L",2) Q:SDOUT
"RTN","SCRPW22",11,0)
 S SDS1="L",SDS2=2 F  S SDS2=$O(SDPAR(SDS1,SDS2)) Q:'SDS2!SDOUT  D:SDL>SDLP WAIT Q:SDOUT  W ! S SDL=SDL+1 D D2("Addl. limitation",SDS1,SDS2)
"RTN","SCRPW22",12,0)
 Q:SDOUT  D PHD(" R E P O R T   P R I N T   O R D E R ") Q:SDOUT  D D1("O","")
"RTN","SCRPW22",13,0)
 I $D(SDPAR("PF")) D PHD(" A D D I T I O N A L   P R I N T   F I E L D S ") Q:SDOUT
"RTN","SCRPW22",14,0)
 F SDS2=2,1 S SDS3=0 F  S SDS3=$O(SDPAR("PF",SDS2,SDS3)) Q:'SDS3  S SDX=SDPAR("PF",SDS2,SDS3) D:SDL>SDLP WAIT Q:SDOUT  W !?(C+36-$L($P(SDX,U,2))),$P(SDX,U,2),": ",$E($P(SDX,U,3),1,(42+C)) S SDL=SDL+1
"RTN","SCRPW22",15,0)
 Q:SDOUT  D:SDL>SDLP WAIT Q:SDOUT  D:$D(SDTEMP)>1 PHD(" T E M P L A T E   I N F O R M A T I O N "),PTMP Q:SDOUT
"RTN","SCRPW22",16,0)
 D:SDL>SDLP WAIT Q:SDOUT  W ! S SDL=SDL+1 D:SDL>SDLP WAIT Q:SDOUT  W ! S SDL=SDL+1 F SDI=1:1:IOM W "-"
"RTN","SCRPW22",17,0)
 I $E(IOST)="C" D WAIT
"RTN","SCRPW22",18,0)
 Q
"RTN","SCRPW22",19,0)
 ;
"RTN","SCRPW22",20,0)
PTMP N SDI S SDI=0 F  S SDI=$O(SDTEMP(SDI)) Q:'SDI!SDOUT  S SDX=$P(SDTEMP(SDI),U),SDX1=$P(SDTEMP(SDI),U,2) D D2P
"RTN","SCRPW22",21,0)
 Q
"RTN","SCRPW22",22,0)
 ;
"RTN","SCRPW22",23,0)
D1(SDI,SDE) S SDII="" F  S SDII=$O(SDPAR(SDI,SDII)) Q:SDII=""!(SDE&(SDII>SDE))  S SDX=$P($T(@SDI+SDII),";;",2) D:SDL>SDLP WAIT Q:SDOUT  W !?(C+36-$L(SDX)),SDX,": ",$E($P(SDPAR(SDI,SDII),U,2),1,(42+C)) S SDL=SDL+1
"RTN","SCRPW22",24,0)
 Q
"RTN","SCRPW22",25,0)
 ;
"RTN","SCRPW22",26,0)
D2(SDTX,SDS1,SDS2) N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C"_(42+C)_"|"
"RTN","SCRPW22",27,0)
 Q:'$D(SDPAR(SDS1,SDS2))  S SDX=SDTX_" category",SDX1=$P(SDPAR(SDS1,SDS2),U,2) D D2P Q:SDOUT
"RTN","SCRPW22",28,0)
 Q:'$D(SDPAR(SDS1,SDS2,1))  S SDX=SDTX_" sub-category",SDX1=$P(SDPAR(SDS1,SDS2,1),U,2) D D2P Q:SDOUT
"RTN","SCRPW22",29,0)
 Q:'$D(SDPAR(SDS1,SDS2,2))  S SDX2=$P(SDPAR(SDS1,SDS2,2),U) D:SDL>SDLP WAIT Q:SDOUT  S SDX1=$O(SDPAR(SDS1,SDS2,4,"")) Q:SDX1=""
"RTN","SCRPW22",30,0)
 S SDX=$S(SDS1="P":"Detail",$P(SDPAR(SDS1,SDS2,3),U)="I":"Include",1:"Exclude")_" "_$S("LN"[SDX2:"list",1:"range - from") D D2P Q:SDOUT
"RTN","SCRPW22",31,0)
 I SDX2="R" S SDX="to",SDX1=$O(SDPAR(SDS1,SDS2,4,SDX1)) Q:SDX1=""  D D2P Q
"RTN","SCRPW22",32,0)
 F  S SDX1=$O(SDPAR(SDS1,SDS2,4,SDX1)) Q:SDX1=""!SDOUT  D:SDL>SDLP WAIT Q:SDOUT  D
"RTN","SCRPW22",33,0)
 . K ^UTILITY($J,"W") S X=SDX1 D ^DIWP
"RTN","SCRPW22",34,0)
 . F SDL2=1:1:^UTILITY($J,"W",DIWL) D  S SDL=SDL+1 D:SDL>SDLP WAIT Q:SDOUT
"RTN","SCRPW22",35,0)
 . . W !?(38+C),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(42+C))
"RTN","SCRPW22",36,0)
 Q
"RTN","SCRPW22",37,0)
 ;
"RTN","SCRPW22",38,0)
D2P N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C"_(42+C)_"|"
"RTN","SCRPW22",39,0)
 D:SDL>SDLP WAIT Q:SDOUT
"RTN","SCRPW22",40,0)
 K ^UTILITY($J,"W") S X=SDX1 D ^DIWP
"RTN","SCRPW22",41,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) D  S SDL=SDL+1 D:SDL>SDLP WAIT Q:SDOUT
"RTN","SCRPW22",42,0)
 . I SDL2=1 W !?(C+36-$L(SDX)),SDX,": ",$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(42+C)) I 1
"RTN","SCRPW22",43,0)
 . E  W !?(38+C),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(42+C))
"RTN","SCRPW22",44,0)
 Q
"RTN","SCRPW22",45,0)
 ;
"RTN","SCRPW22",46,0)
F ;Format captions
"RTN","SCRPW22",47,0)
 ;;Report output format
"RTN","SCRPW22",48,0)
 ;;Compare data to previous year
"RTN","SCRPW22",49,0)
 ;;Type of detail
"RTN","SCRPW22",50,0)
 ;;List activity detail by
"RTN","SCRPW22",51,0)
 ;;Limit Dx/Proc. list to most frequent
"RTN","SCRPW22",52,0)
 ;;Produce output as
"RTN","SCRPW22",53,0)
L ;Limitation captions
"RTN","SCRPW22",54,0)
 ;;Starting date
"RTN","SCRPW22",55,0)
 ;;Ending date
"RTN","SCRPW22",56,0)
O ;Order caption
"RTN","SCRPW22",57,0)
 ;;Output order
"RTN","SCRPW22",58,0)
 ;;Report descriptive title
"RTN","SCRPW22",59,0)
 ;
"RTN","SCRPW22",60,0)
XY(X) ;Maintain $X, $Y
"RTN","SCRPW22",61,0)
 ;Required input: X=screen handling variable to write
"RTN","SCRPW22",62,0)
 S:'$D(SDXY) SDXY=^%ZOSF("XY") N DX,DY S DX=$X,DY=$Y W X X SDXY Q ""
"RTN","SCRPW22",63,0)
 ;
"RTN","SCRPW22",64,0)
PHD(SDH) ;Parameter header
"RTN","SCRPW22",65,0)
 ;Required input: SDH=header value
"RTN","SCRPW22",66,0)
 W ! S SDL=SDL+1 D:(SDL+1)>SDLP WAIT Q:SDOUT
"RTN","SCRPW22",67,0)
 W ! S SDL=SDL+1
"RTN","SCRPW22",68,0)
 F  W "-" Q:$X>(IOM-3-$L(SDH)\2)
"RTN","SCRPW22",69,0)
 W " ",SDH," " F  W "-" Q:$X>(IOM-1)
"RTN","SCRPW22",70,0)
 W ! S SDL=SDL+1 D:SDL>SDLP WAIT Q
"RTN","SCRPW22",71,0)
 ;
"RTN","SCRPW22",72,0)
WAIT I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S:'Y SDOUT=1 W:'SDOUT $$XY(IOELALL),$$XY(IOCUU) S SDL=0 Q
"RTN","SCRPW22",73,0)
 D HDR^SCRPW29("Report Parameters Selected") S SDL=0 Q
"RTN","SCRPW22",74,0)
 ;
"RTN","SCRPW22",75,0)
CAT(SDA) ;Enter edit perspective and limitation categories
"RTN","SCRPW22",76,0)
 ;Required entry: SDA="A" for add or "E" for edit
"RTN","SCRPW22",77,0)
 K SDPAR("X") M:SDA="E" SDPAR("X")=SDPAR(SDS1) I SDS1="L",SDA="E" S SDSEL=$P(SDPAR(SDS1,SDS2),U)_$P(SDPAR(SDS1,SDS2,1),U) G CAT1
"RTN","SCRPW22",78,0)
 S (SDSEL,SDX)=$$DIR^SCRPW23(.DIR,1,"","","O") Q:SDOUT!SDNUL
"RTN","SCRPW22",79,0)
 I SDA="E",SDX'=SDPAR(SDS1,SDS2) K SDPAR("X",SDS2)
"RTN","SCRPW22",80,0)
 S SDPAR("X",SDS2)=SDX
"RTN","SCRPW22",81,0)
 K SDEXE D PRMT("X",SDS2) S SDX=$$DIR^SCRPW23(.DIR,2,$G(SDEXE),$P(SDPAR("X",SDS2),U)) G:SDOUT!SDNUL CATQ
"RTN","SCRPW22",82,0)
 I SDA="E",SDX'=$G(SDPAR("X",SDS2,1)) D
"RTN","SCRPW22",83,0)
 .F SDI=1:1:6 K SDPAR("X",SDS2,SDI)
"RTN","SCRPW22",84,0)
 .F SDI=4,5,6 K SDPAR(SDS1,SDS2,SDI)
"RTN","SCRPW22",85,0)
 .Q
"RTN","SCRPW22",86,0)
 S SDPAR("X",SDS2,1)=SDX,SDSEL=$P(SDSEL,U)_$P(SDX,U)
"RTN","SCRPW22",87,0)
 I SDS1="P",$P(SDPAR("F",1),U)="S" M SDPAR(SDS1)=SDPAR("X") Q
"RTN","SCRPW22",88,0)
CAT1 S SDACT=^TMP("SCRPW",$J,"ACT",SDSEL)
"RTN","SCRPW22",89,0)
 I SDS1="P" S SDLR="L",SDX=$$RL() G:SDOUT CATQ S SDPAR("X",SDS2,2)=SDX D RL^SCRPW23 S (SDOUT,SDNUL)=0 M:$D(SDPAR("X",SDS2,4)) SDPAR(SDS1)=SDPAR("X") G:'$D(SDPAR("X",SDS2,4)) CATQ D CATD Q
"RTN","SCRPW22",90,0)
 S SDLR=$P(SDACT,T,5),SDX=$$RL() G:SDOUT CATQ I SDA="E",SDX'=SDPAR("X",SDS2,2) F SDI=4,5 K SDPAR("X",SDS2,SDI)
"RTN","SCRPW22",91,0)
 S SDPAR("X",SDS2,2)=SDX D RL^SCRPW23,CATD S (SDOUT,SDNUL)=0 G:'$D(SDPAR("X",SDS2,4)) CATQ
"RTN","SCRPW22",92,0)
 K DIR D DIRB("X",SDS2,3) S DIR(0)="S^I:INCLUDE;E:EXCLUDE",DIR("A")="Include or exclude records in this category" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G CATQ
"RTN","SCRPW22",93,0)
 S SDPAR("X",SDS2,3)=Y_U_Y(0) M SDPAR(SDS1)=SDPAR("X") Q
"RTN","SCRPW22",94,0)
 ;
"RTN","SCRPW22",95,0)
CATD Q:'SDREV!($D(SDPAR(SDS1,SDS2,4)))!'$D(SDPAR(SDS1,SDS2))
"RTN","SCRPW22",96,0)
 W !!,$C(7),"Required ",$S($P(SDPAR(SDS1,SDS2,2),U)="L":"list",1:"range")," data missing.",!,$P(SDPAR(SDS1,SDS2),U,2),": ",$P(SDPAR(SDS1,SDS2,1),U,2)," element deleted!" H 3
"RTN","SCRPW22",97,0)
 K SDPAR(SDS1,SDS2) Q
"RTN","SCRPW22",98,0)
 ;
"RTN","SCRPW22",99,0)
CATQ W !!,"Required data missing!  "_$S(SDS1="P":"Perspective ",1:"Limitation item ")_$S(SDA="E":"changes ",1:"")_"not filed.",! H 2 S (SDOUT,SDNUL)=0 Q
"RTN","SCRPW22",100,0)
 ;
"RTN","SCRPW22",101,0)
RL() ;List or range?
"RTN","SCRPW22",102,0)
 ;Output: selector type
"RTN","SCRPW22",103,0)
 K DIR D DIRB("X",SDS2,2)
"RTN","SCRPW22",104,0)
 S DIR("A")="Limit this factor by",DIR("?")="Specify if a list or a range of items should be used to limit this element.",DIR(0)="S^"_$S(SDLR["L":"L:LIST;",1:"")_$S(SDLR["R":"R:RANGE;",1:"")_"N:NULL (NO DATA VALUE)"
"RTN","SCRPW22",105,0)
 Q $$DIR^SCRPW23(.DIR,0)
"RTN","SCRPW22",106,0)
 ;
"RTN","SCRPW22",107,0)
PRMT(SDS1,SDS2) ;Prompts for level DIR2
"RTN","SCRPW22",108,0)
 ;Required input: SDS1,SDS2=subscript to find responses
"RTN","SCRPW22",109,0)
 K DIR(0) D DIRB("X",SDS2,1) S DIR("A")="Select "_$P(SDPAR(SDS1,SDS2),U,2)_" category" Q
"RTN","SCRPW22",110,0)
 ;
"RTN","SCRPW22",111,0)
DIRB(SDS1,SDS2,SDS3) ;Get default value
"RTN","SCRPW22",112,0)
 ;Required input: SDS1,SDS2,SDS3=subscript value
"RTN","SCRPW22",113,0)
 S DIR("B")=$P($G(SDPAR(SDS1,SDS2,SDS3)),U,2) K:'$L(DIR("B")) DIR("B") Q
"RTN","SCRPW22",114,0)
 ;
"RTN","SCRPW22",115,0)
AED(SDS1) ;Add/edit/delete element categories
"RTN","SCRPW22",116,0)
 ;Required input: SDS1=global subscript to work with
"RTN","SCRPW22",117,0)
 N SDOUT S SDOUT=0 F  Q:SDOUT!SDNUL  D AED1
"RTN","SCRPW22",118,0)
 Q
"RTN","SCRPW22",119,0)
 ;
"RTN","SCRPW22",120,0)
AED1 I '$O(SDPAR(SDS1,2)) D A Q
"RTN","SCRPW22",121,0)
 W !!?28,$$XY(IORVON)," Limitation item action ",$$XY(IORVOFF) K DIR S DIR(0)="SO^A:ADD CATEGORY ITEMS;E:EDIT CATEGORY ITEMS;D:DELETE CATEGORY ITEMS",DIR("A")="Select edit action"
"RTN","SCRPW22",122,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!($G(X)="") S SDOUT=1 Q
"RTN","SCRPW22",123,0)
 D @Y Q
"RTN","SCRPW22",124,0)
 ;
"RTN","SCRPW22",125,0)
A ;Add items
"RTN","SCRPW22",126,0)
 D L2A^SCRPW20 Q
"RTN","SCRPW22",127,0)
 ;
"RTN","SCRPW22",128,0)
E ;Edit items
"RTN","SCRPW22",129,0)
 S SDX=$$ILIST("E") Q:'SDX!SDOUT  S SDS2=+SDX D CAT("E") Q
"RTN","SCRPW22",130,0)
 ;
"RTN","SCRPW22",131,0)
D ;Delete items
"RTN","SCRPW22",132,0)
 S SDX=$$ILIST("D") Q:'SDX!SDOUT  D DEL1 Q
"RTN","SCRPW22",133,0)
 ;
"RTN","SCRPW22",134,0)
DEL1 N DIR S DIR(0)="Y",DIR("A")="Ok to delete "_$P(SDX,U,2)_" item",DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW22",135,0)
 Q:'Y  K SDPAR(SDS1,$P(SDX,U)) Q
"RTN","SCRPW22",136,0)
 ;
"RTN","SCRPW22",137,0)
ILIST(SDY) ;List/select items
"RTN","SCRPW22",138,0)
 ;Required input: SDY="E" for edit, "D" for delete
"RTN","SCRPW22",139,0)
 N SDI,SDX,SDOUT,SDS2 S (SDI,SDOUT)=0,SDS2=2,SDX=""
"RTN","SCRPW22",140,0)
 W ! F  S SDS2=$O(SDPAR(SDS1,SDS2)) Q:'SDS2!SDOUT  S SDI=SDI+1 D ISET W !,SDI,". ",$P(SDI(SDI),U,2) D:'SDI#5 IL1
"RTN","SCRPW22",141,0)
 D:'SDOUT&SDI#5 IL1 Q SDX
"RTN","SCRPW22",142,0)
 ;
"RTN","SCRPW22",143,0)
ISET S SDI(SDI)=SDS2_U_$P(SDPAR(SDS1,SDS2),U,2)_": "_$P(SDPAR(SDS1,SDS2,1),U,2)_" ("_$P(SDPAR(SDS1,SDS2,2),U,2)_")" Q
"RTN","SCRPW22",144,0)
 ;
"RTN","SCRPW22",145,0)
IL1 W ! N DIR S DIR(0)="NO^1:"_SDI_":0",DIR("A")="Select item to "_$S(SDY="E":"edit",1:"delete") D ^DIR W ! I $D(DTOUT)!$D(DUOUT)!$G(Y) S SDOUT=1
"RTN","SCRPW22",146,0)
 S SDX=$G(SDI(+$G(Y))) Q
"RTN","SCRPW22",147,0)
 ;
"RTN","SCRPW22",148,0)
DESC ;Prompt for descriptive report title
"RTN","SCRPW22",149,0)
 K DIR D DIRB1^SCRPW23("O",2)
"RTN","SCRPW22",150,0)
 S DIR(0)="FO^1:80",DIR("A")="Report descriptive title (optional)",DIR("?")="Enter brief text describing the report (displayed at top of each page printed)."
"RTN","SCRPW22",151,0)
 W ! S SDX=$$DIR^SCRPW23(.DIR,0) I SDX=""!(SDX=U) K SDPAR("O",2) Q
"RTN","SCRPW22",152,0)
 S:$L(SDX) SDPAR("O",2)=SDX Q
"RTN","SCRPW22",153,0)
 ;
"RTN","SCRPW22",154,0)
REST() ;Select/restore template for editing
"RTN","SCRPW22",155,0)
 ;Ouput: 1=template restored, 0=template not restored
"RTN","SCRPW22",156,0)
 Q:'$O(^SDD(409.91,0)) 0
"RTN","SCRPW22",157,0)
 W ! K DIR S DIR(0)="YO",DIR("A")="Would you like to use parameters from an existing template" D ^DIR I $D(DUOUT)!$D(DTOUT) S SDOUT=1 Q 0
"RTN","SCRPW22",158,0)
 Q:'Y 0  W ! K SDPAR Q $$SELT^SCRPW21(.SDPAR)
"RTN","SCRPW23")
0^5^B56596794^B48856672
"RTN","SCRPW23",1,0)
SCRPW23 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;15 Jul 98  02:38PM
"RTN","SCRPW23",2,0)
 ;;5.3;Scheduling;**144,474,593**;AUG 13, 1993;Build 13
"RTN","SCRPW23",3,0)
DIRB(SDFL) ;Get default values for range
"RTN","SCRPW23",4,0)
 ;Required input: SDFL="F" for first, "L" for last
"RTN","SCRPW23",5,0)
 N SDX S SDX=$O(SDPAR("X",SDS2,$S(SDDV:5,1:4),""),$S(SDFL="F":1,1:-1)) Q $S(SDX=""!'SDDV:SDX,1:SDPAR("X",SDS2,5,SDX))
"RTN","SCRPW23",6,0)
 ;
"RTN","SCRPW23",7,0)
RL ;Prompt for range or list
"RTN","SCRPW23",8,0)
 N SDI,SDIRQ,SDCSYS X:$L($P(SDACT,T,9)) $P(SDACT,T,9) S SDDV=0 S:$P(SDACT,T,2)="D" SDDV=1,SDPAR("X",SDS2,6)="D"
"RTN","SCRPW23",9,0)
 I $P(SDPAR("X",SDS2,2),U)="N" D NULL Q
"RTN","SCRPW23",10,0)
 I ($P(SDACT,T,2)="P"),($P(SDACT,T,3)="^ICD9(") S SDCSYS=$$ICDSYS()
"RTN","SCRPW23",11,0)
 I $P(SDPAR("X",SDS2,2),U)="L" D LST Q
"RTN","SCRPW23",12,0)
RNG N SDR1,SDR2 D SUBT^SCRPW50("*** Item Range Selection ***")
"RTN","SCRPW23",13,0)
R1 W !!,"Start with:" S SDR1=$$SEL($P(SDACT,T,2),$$DIRB("F")) Q:SDOUT!SDNUL
"RTN","SCRPW23",14,0)
 S SDR2=$O(SDPAR("X",SDS2,$S(SDDV:5,1:4),""),-1) I $L(SDR2),$P(SDR1,U,$S(SDDV:1,1:2))]SDR2 F SDI=SDS1,"X" K SDPAR(SDI,SDS2,$S(SDDV:5,1:4),SDR2)
"RTN","SCRPW23",15,0)
R2 W !!,"End with:" S SDR2=$$SEL($P(SDACT,T,2),$$DIRB("L")) Q:SDOUT!SDNUL
"RTN","SCRPW23",16,0)
 I '$$RCOL() W !!,$C(7),"End value must collate after start value!" G R2
"RTN","SCRPW23",17,0)
 F SDX="SDR1","SDR2" S SDPAR("X",SDS2,4,$P(@SDX,U,2),$P(@SDX,U))=""
"RTN","SCRPW23",18,0)
 F SDX="SDR1","SDR2" S SDPAR("X",SDS2,5,$P(@SDX,U))=$P(@SDX,U,2)
"RTN","SCRPW23",19,0)
 Q
"RTN","SCRPW23",20,0)
 ;
"RTN","SCRPW23",21,0)
ICDSYS() ;Prompt for coding system.  (Structurally similar to $$RL^SCRPW22.)
"RTN","SCRPW23",22,0)
 N IEN,CSYS,I10DTI,I10DTE
"RTN","SCRPW23",23,0)
 I $D(SDPAR("X",SDS2,4)) D  I 1
"RTN","SCRPW23",24,0)
 . S IEN=$O(SDPAR("X",SDS2,5,"")) Q:IEN=""
"RTN","SCRPW23",25,0)
 . S CSYS=$$CSI^SCRPWICD(80,IEN)
"RTN","SCRPW23",26,0)
 E  I SDS1="P" D  I 1
"RTN","SCRPW23",27,0)
 . S Y=$$IMP^SCRPWICD(30) S I10DTI=Y X ^DD("DD") S I10DTE=Y
"RTN","SCRPW23",28,0)
 . K DIR S DIR(0)="S^9:ICD-9  (PRIOR TO "_I10DTE_");10:ICD-10 ("_I10DTE_" AND AFTER)"
"RTN","SCRPW23",29,0)
 . S DIR("A")="Select coding system" S DIR("B")=$S(DT'<I10DTI:"10",1:"9")
"RTN","SCRPW23",30,0)
 . D ^DIR K DIR S CSYS=$S($P(Y,U,1)="9":1,$P(Y,U,1)="10":30,1:$S(DT<I10DTI:1,1:30))
"RTN","SCRPW23",31,0)
 E  I SDS1="L" D  I 1
"RTN","SCRPW23",32,0)
 . S CSYS=$S($P(SDPAR("L",1),U,1)<$$IMP^SCRPWICD(30):1,1:30)
"RTN","SCRPW23",33,0)
 Q CSYS
"RTN","SCRPW23",34,0)
 ;
"RTN","SCRPW23",35,0)
RCOL() ;Determine range collation validity
"RTN","SCRPW23",36,0)
 ;Output: 1=valid, 0=invalid
"RTN","SCRPW23",37,0)
 I $P(SDR1,U,2)=+$P(SDR1,U,2),$P(SDR2,U,2)=+$P(SDR2,U,2) Q SDR1'>SDR2
"RTN","SCRPW23",38,0)
 I SDDV Q $P(SDR1,U)'>$P(SDR2,U)
"RTN","SCRPW23",39,0)
 Q $P(SDR1,U,2)']$P(SDR2,U,2)
"RTN","SCRPW23",40,0)
 ;
"RTN","SCRPW23",41,0)
NULL ;Set list for null value
"RTN","SCRPW23",42,0)
 S SDPAR("X",SDS2,4,"~~~NONE~~~","~~~NONE~~~")="",SDPAR("X",SDS2,5,"~~~NONE~~~")="~~~NONE~~~" Q
"RTN","SCRPW23",43,0)
 ;
"RTN","SCRPW23",44,0)
LST I $D(SDPAR("X",SDS2,4)) D LST1
"RTN","SCRPW23",45,0)
 D SUBT^SCRPW50("*** Item List Selection ***") W !
"RTN","SCRPW23",46,0)
 F I=1:1:$P(SDACT,T,6) S SDX=$$SEL($P(SDACT,T,2)) Q:SDOUT!SDNUL  D LST0
"RTN","SCRPW23",47,0)
 Q
"RTN","SCRPW23",48,0)
 ;
"RTN","SCRPW23",49,0)
LST0 I $D(SDPAR("X",SDS2,5,$P(SDX,U))) Q:$$LSD()
"RTN","SCRPW23",50,0)
 S SDPAR("X",SDS2,4,$P(SDX,U,2),$P(SDX,U))=""
"RTN","SCRPW23",51,0)
 S SDPAR("X",SDS2,5,$P(SDX,U))=$P(SDX,U,2)
"RTN","SCRPW23",52,0)
 Q
"RTN","SCRPW23",53,0)
 ;
"RTN","SCRPW23",54,0)
LSD() N DIR W !!,$C(7),$P(SDX,U,2)," is already selected." S DIR(0)="Y",DIR("A")="Do you want to delete it",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q 0
"RTN","SCRPW23",55,0)
 I Y D  W !,"   ...deleted." Q 1
"RTN","SCRPW23",56,0)
 .F SDI=SDS1,"X" K SDPAR(SDI,SDS2,5,$P(SDX,U)),SDPAR(SDI,SDS2,4,$P(SDX,U,2),$P(SDX,U))
"RTN","SCRPW23",57,0)
 .Q
"RTN","SCRPW23",58,0)
 Q 0
"RTN","SCRPW23",59,0)
 ;
"RTN","SCRPW23",60,0)
LST1 ;List existing item selections
"RTN","SCRPW23",61,0)
 N SDOUT,SDL,SDX S SDOUT=0,SDL=1,SDX="" W !,"Items currently selected:"
"RTN","SCRPW23",62,0)
 F  S SDX=$O(SDPAR("X",SDS2,4,SDX)) Q:SDX=""!SDOUT  S SDL=SDL+1 W !?5,SDX D:SDL>15 WAIT^SCRPW22
"RTN","SCRPW23",63,0)
 Q
"RTN","SCRPW23",64,0)
 ;
"RTN","SCRPW23",65,0)
SEL(SDTYP,SDIRB) ;Select items for list or range
"RTN","SCRPW23",66,0)
 ;Required input: SDTYP=type of data (D, P, F, N, T, C, PP, S)
"RTN","SCRPW23",67,0)
 ;Optional input: SDIRB=value for default prompt
"RTN","SCRPW23",68,0)
 N SDX S SDX="" D @SDTYP Q SDX
"RTN","SCRPW23",69,0)
 ;
"RTN","SCRPW23",70,0)
D ;Get date values
"RTN","SCRPW23",71,0)
 N DIR M DIR=SDIRQ S DIR(0)=$P(SDACT,T,4),DIR("A")="Select "_$P(SDACT,T) S:$L($G(SDIRB)) DIR("B")=SDIRB D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",72,0)
 I '$L(Y) S SDNUL=1 Q
"RTN","SCRPW23",73,0)
 S SDX=Y X ^DD("DD") S SDX=SDX_U_Y X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",74,0)
 ;
"RTN","SCRPW23",75,0)
P ;Get pointer values ;SD*5.3*474 added PSCRN to screen certain status types
"RTN","SCRPW23",76,0)
 N DIC M DIC=SDIRQ S DIC=$P(SDACT,T,3),DIC(0)="AEMQ",DIC("S")=$P(SDACT,T,4) K:'$L(DIC("S")) DIC("S") D PSCRN D ^DIC I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",77,0)
 I Y'>0 S SDNUL=1 Q
"RTN","SCRPW23",78,0)
 S SDX=Y X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",79,0)
 ;
"RTN","SCRPW23",80,0)
PSCRN ;screen out the 4 cancellation type status' SD*5.3*474
"RTN","SCRPW23",81,0)
 I DIC="^SD(409.63," S DIC("S")="I $P(^(0),U,2)'=""C"",$P(^(0),U,2)'=""CA"",$P(^(0),U,2)'=""PC"",$P(^(0),U,2)'=""PCA"""
"RTN","SCRPW23",82,0)
 I DIC="^ICD9(" S DIC("S")="I $$CSI^SCRPWICD(80,Y)="_SDCSYS
"RTN","SCRPW23",83,0)
 Q
"RTN","SCRPW23",84,0)
 ;
"RTN","SCRPW23",85,0)
F ;Get field values
"RTN","SCRPW23",86,0)
 N DIR M DIR=SDIRQ S DIR(0)=$P(SDACT,T,3) S:$L($G(SDIRB)) DIR("B")=SDIRB D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",87,0)
 I '$D(DIR("B")),X="" S SDNUL=1 Q
"RTN","SCRPW23",88,0)
 S SDX=Y_U_$G(Y(0)) X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",89,0)
 ;
"RTN","SCRPW23",90,0)
N ;Get number value
"RTN","SCRPW23",91,0)
 N DIR M DIR=SDIRQ S DIR(0)=$P(SDACT,T,4),DIR("A")="Select "_$P(SDACT,T) S:$L($G(SDIRB)) DIR("B")=SDIRB D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",92,0)
 I Y'?1.N S SDNUL=1 Q
"RTN","SCRPW23",93,0)
 S SDX=Y_U_Y X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",94,0)
 ;
"RTN","SCRPW23",95,0)
T ;Get text value
"RTN","SCRPW23",96,0)
 N DIR M DIR=SDIRQ S DIR(0)=$P(SDACT,T,4),DIR("A")="Select "_$P(SDACT,T) S:$L($G(SDIRB)) DIR("B")=SDIRB D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",97,0)
 I '$L(Y) S SDNUL=1 Q
"RTN","SCRPW23",98,0)
 S SDX=Y_U_Y X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",99,0)
 ;
"RTN","SCRPW23",100,0)
C ;Get computed value
"RTN","SCRPW23",101,0)
 D @($P(SDACT,T,4)) X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",102,0)
 ;
"RTN","SCRPW23",103,0)
PP ;Get pointer value from file multiple
"RTN","SCRPW23",104,0)
 N DIC M DIC=SDIRQ S DIC=$P($P(SDACT,T,3),";"),DIC(0)="AEMQ",DIC("B")=$P($G(SDIRB),";") K:'$L(DIC("B")) DIC("B") D ^DIC I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",105,0)
 I Y<1 S SDNUL=1 Q
"RTN","SCRPW23",106,0)
 S SDX=Y,DIC=DIC_+SDX_$P($P(SDACT,T,3),";",2),DIC("B")=$P($G(SDIRB),";",2) K:'$L(DIC("B")) DIC("B") D ^DIC I $D(DTOUT)!$D(DUOUT) S SDX="",SDOUT=1 Q
"RTN","SCRPW23",107,0)
 I Y<1 S SDX="",SDNUL=1 Q
"RTN","SCRPW23",108,0)
 S SDX=+SDX_";"_+Y_U_$P(SDX,U,2)_" / "_$P(Y,U,2) X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",109,0)
 ;
"RTN","SCRPW23",110,0)
S ;Get set-of-codes value
"RTN","SCRPW23",111,0)
 N DIR M DIR=SDIRQ X $P(SDACT,T,3) S DIR("A")="Select "_$P(SDACT,T) S:$L($G(SDIRB)) DIR("B")=SDIRB D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW23",112,0)
 I '$L(Y) S SDNUL=1 Q
"RTN","SCRPW23",113,0)
 S SDX=Y_U_Y(0) X:$L($P(SDACT,T,8)) $P(SDACT,T,8) Q
"RTN","SCRPW23",114,0)
 ;
"RTN","SCRPW23",115,0)
VCP(SDX) ;Validate Stop Code credit pair
"RTN","SCRPW23",116,0)
 ;Required input: SDX=6 digit numeric value
"RTN","SCRPW23",117,0)
 ;Output: 1=valid credit pair, 0=invalid credit pair
"RTN","SCRPW23",118,0)
 G:SDX'?6N VCPQ G:'$D(^DIC(40.7,"C",$E(SDX,1,3))) VCPQ G:'$D(^DIC(40.7,"C",$E(SDX,4,6)))&($E(SDX,4,6)'="000") VCPQ
"RTN","SCRPW23",119,0)
 Q 1
"RTN","SCRPW23",120,0)
 ;
"RTN","SCRPW23",121,0)
VCPQ W $C(7),"   ??",!,"This response must be a 6 digit numeric value",!,"that represents two valid stop codes!" Q 0
"RTN","SCRPW23",122,0)
 ;
"RTN","SCRPW23",123,0)
PLIST ;Print category list
"RTN","SCRPW23",124,0)
 N ZTSAVE D EN^XUTMDEVQ("PLST^SCRPW23","CATEGORY LIST",.ZTSAVE) Q
"RTN","SCRPW23",125,0)
PLST ;Print category list
"RTN","SCRPW23",126,0)
 D:'$D(^TMP("SCRPW",$J,"SEL")) BLD^SCRPW21
"RTN","SCRPW23",127,0)
 S I=0 F  S I=$O(^TMP("SCRPW",$J,"SEL",1,I)) Q:'I  S X1=$O(^TMP("SCRPW",$J,"SEL",1,I,"")) W !!,$P(^TMP("SCRPW",$J,"SEL",1,I,X1),"~") D PLST1
"RTN","SCRPW23",128,0)
 K I,II,X1,X2,^TMP("SCRPW",$J) Q
"RTN","SCRPW23",129,0)
 ;
"RTN","SCRPW23",130,0)
PLST1 S II=0 F  S II=$O(^TMP("SCRPW",$J,"SEL",2,X1,II)) Q:'II  S X2=$O(^TMP("SCRPW",$J,"SEL",2,X1,II,"")) W !?4,$P(^TMP("SCRPW",$J,"SEL",2,X1,II,X2),"~")
"RTN","SCRPW23",131,0)
 Q
"RTN","SCRPW23",132,0)
 ;
"RTN","SCRPW23",133,0)
DISP0 ;Return to full screen scrolling
"RTN","SCRPW23",134,0)
 Q:$E(IOST)'="C"
"RTN","SCRPW23",135,0)
 D ENS^%ZISS S SDRM=^%ZOSF("RM"),SDXY=^%ZOSF("XY"),(IOTM,IOBM)=0 W $$XY(IOSTBM,1),@IOF N DX,DY,X S (DX,DY)=0 X SDXY S X=IOM X SDRM Q
"RTN","SCRPW23",136,0)
 ;
"RTN","SCRPW23",137,0)
DISP(SDTOP,SDBOT) ;Create centered scrolling region
"RTN","SCRPW23",138,0)
 ;Required input: SDTOP=text to center at top of screen
"RTN","SCRPW23",139,0)
 ;Required input: SDBOT(n)=numbered array of text to display at bottom of screen
"RTN","SCRPW23",140,0)
 N X D DISP0 S X=0 X SDRM W $$XY(IORVON) F I=1:1:(78-$L(SDTOP)\2) W "-"
"RTN","SCRPW23",141,0)
 W " ",SDTOP," " F  W "-" Q:$X>79
"RTN","SCRPW23",142,0)
 W $$XY(IORVOFF) S IOTM=3 W $$XY(IOSTBM,1) S (C,I)="" F  S I=$O(SDBOT(I)) Q:I=""  S C=C+1
"RTN","SCRPW23",143,0)
 F  W ! Q:$Y>(IOSL-C)
"RTN","SCRPW23",144,0)
 S II=$O(SDBOT("")) Q:II=""  W $$XY(IORVON) F I=1:1:(78-$L(SDBOT(II))\2) W "-"
"RTN","SCRPW23",145,0)
 W " ",SDBOT(II)," " F  W "-" Q:$X>79
"RTN","SCRPW23",146,0)
 W $$XY(IORVOFF) F  S II=$O(SDBOT(II)) Q:II=""  W !,$E(SDBOT(II),1,80)
"RTN","SCRPW23",147,0)
 S IOBM=(IOSL-C-1) W $$XY(IOSTBM,1) Q
"RTN","SCRPW23",148,0)
 ;
"RTN","SCRPW23",149,0)
XY(X,SDI) ;Maintain $X, $Y
"RTN","SCRPW23",150,0)
 ;Required input: X=screen handling variable to write
"RTN","SCRPW23",151,0)
 ;Optional input: SDI=1 (to specify the use of indirection)
"RTN","SCRPW23",152,0)
 N DX,DY S DX=$X,DY=$Y
"RTN","SCRPW23",153,0)
 I $G(SDI) W @X X SDXY Q ""
"RTN","SCRPW23",154,0)
 W X X SDXY Q ""
"RTN","SCRPW23",155,0)
 ;
"RTN","SCRPW23",156,0)
DIR(DIR,SDLEV,SDEXE,SDS,SDO,SDPFL,SDA) ;Ask questions!
"RTN","SCRPW23",157,0)
 ;Required input: DIR array (pass by reference)
"RTN","SCRPW23",158,0)
 ;Required input: SDLEV=level to build DIR(0) for large sets
"RTN","SCRPW23",159,0)
 ;Optional input: SDEXE=code to execute prior to ^DIR
"RTN","SCRPW23",160,0)
 ;Optional input: SDS=subscript lookup value for level 2 (required for level 2)
"RTN","SCRPW23",161,0)
 ;Optional input: SDO="O" to indicate input is optional
"RTN","SCRPW23",162,0)
 ;Optional input: SDPFL=print field level (1,2) for print field prompts
"RTN","SCRPW23",163,0)
 ;Optional input: SDA=1 to force single item selection prompt
"RTN","SCRPW23",164,0)
 X:$L($G(SDEXE)) SDEXE I '$D(DIR(0)) D @("DIR"_SDLEV)
"RTN","SCRPW23",165,0)
 I '$G(SDA),$E(DIR(0))="S",$L(DIR(0),":")=2 Q $P($P(DIR(0),U,2),":")_U_$P(DIR(0),":",2)
"RTN","SCRPW23",166,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q ""
"RTN","SCRPW23",167,0)
 I X="" S SDNUL=1 Q ""
"RTN","SCRPW23",168,0)
 Q Y_U_$S($L($G(Y(0))):Y(0),1:Y)
"RTN","SCRPW23",169,0)
 ;
"RTN","SCRPW23",170,0)
DIR1 N X,I,II S X="",I=0 F  S I=$O(^TMP("SCRPW",$J,"SEL",1,I)) Q:'I  S II="" F  S II=$O(^TMP("SCRPW",$J,"SEL",1,I,II)) Q:II=""  S:$$PFL1() X=X_";"_II_":"_$P(^TMP("SCRPW",$J,"SEL",1,I,II),T)
"RTN","SCRPW23",171,0)
 S DIR(0)="S"_$G(SDO)_"^"_$E(X,2,245) Q
"RTN","SCRPW23",172,0)
 ;
"RTN","SCRPW23",173,0)
DIR2 N X,I,II S X="",I=0 F  S I=$O(^TMP("SCRPW",$J,"SEL",2,SDS,I)) Q:'I  S II="" F  S II=$O(^TMP("SCRPW",$J,"SEL",2,SDS,I,II)) Q:II=""  S:$$PFL2() X=X_";"_II_":"_$P(^TMP("SCRPW",$J,"SEL",2,SDS,I,II),T)
"RTN","SCRPW23",174,0)
 S DIR(0)="S"_$G(SDO)_"^"_$E(X,2,245) Q
"RTN","SCRPW23",175,0)
 ;
"RTN","SCRPW23",176,0)
PFL1() ;Print field level 1 evaluator
"RTN","SCRPW23",177,0)
 Q:'$G(SDPFL) 1
"RTN","SCRPW23",178,0)
 Q $P(^TMP("SCRPW",$J,"SEL",1,I,II),T,2)>(SDPFL-1)
"RTN","SCRPW23",179,0)
 ;
"RTN","SCRPW23",180,0)
PFL2() ;Print field level 2 evaluator
"RTN","SCRPW23",181,0)
 Q:'$G(SDPFL) 1
"RTN","SCRPW23",182,0)
 Q $P(^TMP("SCRPW",$J,"SEL",2,SDS,I,II),T,2)>(SDPFL-1)
"RTN","SCRPW23",183,0)
 ;
"RTN","SCRPW23",184,0)
DIRB1(S1,S2,SDEF) ;Set DIR("B")
"RTN","SCRPW23",185,0)
 ;Required input: S1, S2=subscript values
"RTN","SCRPW23",186,0)
 ;Optional input: SDEF=default value
"RTN","SCRPW23",187,0)
 S DIR("B")=$S($D(SDPAR(S1,S2)):$P(SDPAR(S1,S2),U,2),1:$G(SDEF))
"RTN","SCRPW23",188,0)
 K:'$L(DIR("B")) DIR("B") Q
"RTN","SCRPW24")
0^6^B79566588^B79827174
"RTN","SCRPW24",1,0)
SCRPW24 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;06/19/99
"RTN","SCRPW24",2,0)
 ;;5.3;Scheduling;**144,163,180,254,243,295,329,351,510,530,562,576,593**;AUG 13, 1993;Build 13
"RTN","SCRPW24",3,0)
 ;06/19/99 ACS - Added CPT modifier API calls
"RTN","SCRPW24",4,0)
 ;11/26/03 RLC - 329 fixes primary/secondary dx problem with report
"RTN","SCRPW24",5,0)
 ;
"RTN","SCRPW24",6,0)
APAC(SDX) ;Get all procedure codes
"RTN","SCRPW24",7,0)
 D APAC^SCRPW241(.SDX)
"RTN","SCRPW24",8,0)
 D NX Q
"RTN","SCRPW24",9,0)
 ;
"RTN","SCRPW24",10,0)
APOTR ;Transform procedure external value
"RTN","SCRPW24",11,0)
 D APOTR^SCRPW241(.SDX)
"RTN","SCRPW24",12,0)
 Q
"RTN","SCRPW24",13,0)
 ;
"RTN","SCRPW24",14,0)
APAP(SDX) ;Get ambulatory procedures (no E&M codes)
"RTN","SCRPW24",15,0)
 D APAP^SCRPW241(.SDX)
"RTN","SCRPW24",16,0)
 D NX Q
"RTN","SCRPW24",17,0)
 ;
"RTN","SCRPW24",18,0)
APEM(SDX) ;Get evaluation and management codes
"RTN","SCRPW24",19,0)
 D APEM^SCRPW241(.SDX)
"RTN","SCRPW24",20,0)
 D NX Q
"RTN","SCRPW24",21,0)
 ;
"RTN","SCRPW24",22,0)
CLCG(SDX) ;Get clinic group
"RTN","SCRPW24",23,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,31) I SDX,$D(^SD(409.67,SDX)) S SDX=SDX_U_$P(^SD(409.67,SDX,0),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",24,0)
 D NX Q
"RTN","SCRPW24",25,0)
 ;
"RTN","SCRPW24",26,0)
CLCN(SDX) ;Get clinic name
"RTN","SCRPW24",27,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=SDX_U_$P($G(^SC(SDX,0)),U) I $L($P(SDX,U,2)) S SDX(1)=SDX
"RTN","SCRPW24",28,0)
 D NX Q
"RTN","SCRPW24",29,0)
 ;
"RTN","SCRPW24",30,0)
CLCS(SDX) ;Get clinic service
"RTN","SCRPW24",31,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,8) D FST(.SDX,44,9) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",32,0)
 D NX Q
"RTN","SCRPW24",33,0)
 ;
"RTN","SCRPW24",34,0)
DXAD(SDX) ;Get all diagnoses
"RTN","SCRPW24",35,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0
"RTN","SCRPW24",36,0)
 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX S SDX=SDX_U_$P($$ICDDX^SCRPWICD(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",37,0)
 D NX Q
"RTN","SCRPW24",38,0)
 ;
"RTN","SCRPW24",39,0)
DXOTR ;Transform diagnosis external value
"RTN","SCRPW24",40,0)
 N ENCDT
"RTN","SCRPW24",41,0)
 S ENCDT=+$G(SDOE0)
"RTN","SCRPW24",42,0)
 I 'ENCDT D
"RTN","SCRPW24",43,0)
 .I '$G(SDOE) S ENCDT=$$NOW^XLFDT() Q
"RTN","SCRPW24",44,0)
 .N SDY
"RTN","SCRPW24",45,0)
 .D GETGEN^SDOE(SDOE,"SDY")
"RTN","SCRPW24",46,0)
 .S ENCDT=+$G(SDY(0))
"RTN","SCRPW24",47,0)
 .K SDY
"RTN","SCRPW24",48,0)
 S SDX=SDX_" "_$P($$ICDDX^SCRPWICD(+SDX,ENCDT),U,4) Q
"RTN","SCRPW24",49,0)
 ;
"RTN","SCRPW24",50,0)
DXGS(SDX,SDZ) ;Get GAF score
"RTN","SCRPW24",51,0)
 K SDX N SDI,SDY S SDY=$S(SDZ="H":$P($P(SDOE0,U),"."),1:DT)_.9999,SDY=9999999-SDY,SDY=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY))
"RTN","SCRPW24",52,0)
 I SDY S SDI=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY,""),-1) I SDI S SDX=+$P($G(^YSD(627.8,SDI,60)),U,3) I SDX S SDX(1)=SDX_U_SDX
"RTN","SCRPW24",53,0)
 D NX Q
"RTN","SCRPW24",54,0)
 ;
"RTN","SCRPW24",55,0)
DXGSQ(SDI) ;Set up GAF help text
"RTN","SCRPW24",56,0)
 S SDIRQ("?",1)="Specify a value representing the Global Assessment of Functioning (GAF) score."
"RTN","SCRPW24",57,0)
 I SDI="H" S SDIRQ("?")="Status as of the encounter date/time is used to determine 'historical' values."
"RTN","SCRPW24",58,0)
 I SDI="C" S SDIRQ("?")="Status as of the report run date is used to determine 'current' values."
"RTN","SCRPW24",59,0)
 Q
"RTN","SCRPW24",60,0)
 ;
"RTN","SCRPW24",61,0)
DXPD(SDX) ;Get primary diagnosis
"RTN","SCRPW24",62,0)
 ;SD*5.3*329 fixes problem of report not working for primary dx
"RTN","SCRPW24",63,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0
"RTN","SCRPW24",64,0)
 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($$ICDDX^SCRPWICD(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",65,0)
 D NX Q
"RTN","SCRPW24",66,0)
 ;
"RTN","SCRPW24",67,0)
DXSD(SDX) ;Get secondary diagnoses
"RTN","SCRPW24",68,0)
 ;SD*5.3*329 fixes problem of report not working for secondary dx
"RTN","SCRPW24",69,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0
"RTN","SCRPW24",70,0)
 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($$ICDDX^SCRPWICD(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",71,0)
 D NX Q
"RTN","SCRPW24",72,0)
 ;
"RTN","SCRPW24",73,0)
ENED(SDX,SDZ) ;Get enrollment date
"RTN","SCRPW24",74,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",75,0)
 D NX Q
"RTN","SCRPW24",76,0)
 ;
"RTN","SCRPW24",77,0)
ENEF(SDX,SDZ) ;Get enrollment effective date
"RTN","SCRPW24",78,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U,8) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",79,0)
 D NX Q
"RTN","SCRPW24",80,0)
 ;
"RTN","SCRPW24",81,0)
ENEP(SDX,SDZ) ;Get enrollment priority
"RTN","SCRPW24",82,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,7) D FST(.SDX,27.11,.07) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",83,0)
 D NX Q
"RTN","SCRPW24",84,0)
 ;
"RTN","SCRPW24",85,0)
ENES(SDX,SDZ) ;Get enrollment status
"RTN","SCRPW24",86,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,4),SDX=SDX_U_$$EXTERNAL^DILFD(27.11,.04,"F",SDX) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",87,0)
 D NX Q
"RTN","SCRPW24",88,0)
 ;
"RTN","SCRPW24",89,0)
ENFR(SDX,SDZ) ;Get enrollment facility received
"RTN","SCRPW24",90,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,6) I SDX S SDX=SDX_U_$P($G(^DIC(4,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",91,0)
 D NX Q
"RTN","SCRPW24",92,0)
 ;
"RTN","SCRPW24",93,0)
ENSE(SDX,SDZ) ;Get enrollment source of enrollment
"RTN","SCRPW24",94,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,3) D FST(.SDX,27.11,.03) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",95,0)
 D NX Q
"RTN","SCRPW24",96,0)
 ;
"RTN","SCRPW24",97,0)
ENQ(SDZ) ;Set up help text for enrollment
"RTN","SCRPW24",98,0)
 I SDZ="H" S SDIRQ("?")="Enrollment status as of the encounter date/time is used for 'historical' values."
"RTN","SCRPW24",99,0)
 I SDZ="C" S SDIRQ("?")="Enrollment status as of the report run date is used for 'current' values."
"RTN","SCRPW24",100,0)
 Q
"RTN","SCRPW24",101,0)
 ;
"RTN","SCRPW24",102,0)
OEAT(SDX) ;Get encounter appointment type
"RTN","SCRPW24",103,0)
 K SDX S SDX=$P(SDOE0,U,10) I SDX S SDX=SDX_U_$P($G(^SD(409.1,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",104,0)
 D NX Q
"RTN","SCRPW24",105,0)
 ;
"RTN","SCRPW24",106,0)
OEDV(SDX) ;Get encounter division
"RTN","SCRPW24",107,0)
 K SDX S SDX=$P(SDOE0,U,11) I SDX S SDX=SDX_U_$P($G(^DG(40.8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",108,0)
 D NX Q
"RTN","SCRPW24",109,0)
 ;
"RTN","SCRPW24",110,0)
OEEE(SDX) ;Get encounter eligibility
"RTN","SCRPW24",111,0)
 K SDX S SDX=$P(SDOE0,U,13) I SDX S SDX=SDX_U_$P($G(^DIC(8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",112,0)
 D NX Q
"RTN","SCRPW24",113,0)
 ;
"RTN","SCRPW24",114,0)
OEOP(SDX) ;Get encounter originating process type
"RTN","SCRPW24",115,0)
 K SDX S SDX=$P(SDOE0,U,8) D FST(.SDX,409.68,.08) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",116,0)
 D NX Q
"RTN","SCRPW24",117,0)
 ;
"RTN","SCRPW24",118,0)
OEPA(SDX) ;Get encounter patient
"RTN","SCRPW24",119,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L(VADM(1)) S SDX(1)=DFN_U_VADM(1)
"RTN","SCRPW24",120,0)
 D NX Q
"RTN","SCRPW24",121,0)
 ;
"RTN","SCRPW24",122,0)
OEES(SDX) ;Get encounter status
"RTN","SCRPW24",123,0)
 K SDX S SDX=$P(SDOE0,U,12) I SDX S SDX=SDX_U_$P($G(^SD(409.63,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",124,0)
 D NX Q
"RTN","SCRPW24",125,0)
 ;
"RTN","SCRPW24",126,0)
OETS(SDX) ;Get transmission status
"RTN","SCRPW24",127,0)
 K SDX S SDX(1)=$$STX^SCRPW8(SDOE,SDOE0) Q
"RTN","SCRPW24",128,0)
 ;
"RTN","SCRPW24",129,0)
TSQ(DIR) ;Set up DIR array for transmission status question
"RTN","SCRPW24",130,0)
 K DIR S DIR("A")="Select transmission status",DIR("?")="This value represents the transmission status of the encounter record."
"RTN","SCRPW24",131,0)
 S DIR(0)="SO^0:Not checked-out;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW24",132,0)
 Q
"RTN","SCRPW24",133,0)
 ;
"RTN","SCRPW24",134,0)
CLQ(DIR,SDZ) ;Set up DIR array for classification questions
"RTN","SCRPW24",135,0)
 K DIR S SDZ=$S(SDZ="A":"Agent Orange exposure",SDZ="I":"ionizing radiation exposure",SDZ="S":"service connected condition",1:"environmental contaminants exposure")
"RTN","SCRPW24",136,0)
 S DIR(0)="SO^1:YES;0:NO",DIR("A")="Treatment related to "_SDZ,DIR("?")="Indicates if treatment was related to "_SDZ Q
"RTN","SCRPW24",137,0)
 ;
"RTN","SCRPW24",138,0)
OECL(SDX,SDZ) ;Get classification values
"RTN","SCRPW24",139,0)
 K SDX N SDY S SDZ=$S(SDZ="A":1,SDZ="I":2,SDZ="S":3,SDZ="E":4,1:"") I SDZ D CLASK^SDCO2(SDOE,.SDY) S SDX=$P($G(SDY(SDZ)),U,2) I $L(SDX) S SDX(1)=$S(SDX=1:"1^YES",1:"0^NO")
"RTN","SCRPW24",140,0)
 D NX Q
"RTN","SCRPW24",141,0)
 ;
"RTN","SCRPW24",142,0)
OEOU(SDX) ;Get option used to create
"RTN","SCRPW24",143,0)
 K SDX S SDX=+$P(SDOE0,U,5),SDX=+$P($G(^AUPNVSIT(SDX,0)),U,24)
"RTN","SCRPW24",144,0)
 N SDY D GETS^DIQ(19,SDX,.01,"","SDY")
"RTN","SCRPW24",145,0)
 I 'SDX S SDX="0^UNKNOWN",SDX(1)=SDX    ;SD*576
"RTN","SCRPW24",146,0)
 I +SDX S SDX=SDX_U_SDY(19,SDX_",",.01) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",147,0)
 D NX Q
"RTN","SCRPW24",148,0)
 ;
"RTN","SCRPW24",149,0)
SUQ(DIR) ;Set up DIR() array for Scheduled/unscheduled question
"RTN","SCRPW24",150,0)
 K DIR S DIR("A")="Select outpatient activity type",DIR("?",1)="Only pre-scheduled appointments will be reflected as SCHEDULED.  All other",DIR("?",2)="types of activity (add/edits, registrations, walkins or unscheduled activity)"
"RTN","SCRPW24",151,0)
 S DIR("?")="will be reflected as UNSCHEDULED.",DIR(0)="SO^S:SCHEDULED;U:UNSCHEDULED" Q
"RTN","SCRPW24",152,0)
 ;
"RTN","SCRPW24",153,0)
OESU(SDX) ;Get scheduled/unscheduled status
"RTN","SCRPW24",154,0)
 N SDAP0 K SDX S SDX(1)=""
"RTN","SCRPW24",155,0)
 I $P(SDOE0,U,8)=1 D  Q:$L(SDX(1))
"RTN","SCRPW24",156,0)
 .S SDAP0=$G(^DPT(+$P(SDOE0,U,2),"S",+SDOE0,0))
"RTN","SCRPW24",157,0)
 .Q:$P(SDAP0,U,20)'=SDOE  Q:$P(SDAP0,U,7)=4
"RTN","SCRPW24",158,0)
 .S SDX(1)="S^SCHEDULED" Q
"RTN","SCRPW24",159,0)
 S SDX(1)="U^UNSCHEDULED" Q
"RTN","SCRPW24",160,0)
 ;
"RTN","SCRPW24",161,0)
PCPR(SDX,SDZ) ;Get primary care provider
"RTN","SCRPW24",162,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",163,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",164,0)
 D NX Q
"RTN","SCRPW24",165,0)
 ;
"RTN","SCRPW24",166,0)
PCTM(SDX,SDZ) ;Get priamry care team
"RTN","SCRPW24",167,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",168,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",169,0)
 D NX Q
"RTN","SCRPW24",170,0)
 ;
"RTN","SCRPW24",171,0)
PDPA(SDX) ;Get patient age
"RTN","SCRPW24",172,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I VADM(4)=+VADM(4) S SDX(1)=VADM(4)_U_VADM(4)
"RTN","SCRPW24",173,0)
 D NX Q
"RTN","SCRPW24",174,0)
 ;
"RTN","SCRPW24",175,0)
PDPS(SDX) ;Get patient sex
"RTN","SCRPW24",176,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L($P(VADM(5),U,2)) S SDX(1)=VADM(5)
"RTN","SCRPW24",177,0)
 D NX Q
"RTN","SCRPW24",178,0)
 ;
"RTN","SCRPW24",179,0)
PDSC(SDX) ;Get patient state/county
"RTN","SCRPW24",180,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L($P(VAPA(7),U,2)) S SDX(1)=$P(VAPA(5),U)_";"_$P(VAPA(7),U)_U_$P(VAPA(5),U,2)_" / "_$P(VAPA(7),U,2)
"RTN","SCRPW24",181,0)
 D NX Q
"RTN","SCRPW24",182,0)
 ;
"RTN","SCRPW24",183,0)
PDZC(SDX) ;Get patient zip code
"RTN","SCRPW24",184,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L(VAPA(6)) S SDX(1)=VAPA(6)_U_VAPA(6)
"RTN","SCRPW24",185,0)
 D NX Q
"RTN","SCRPW24",186,0)
 ;
"RTN","SCRPW24",187,0)
ENROL(SDATE)  ;Get enrollment record (most recent to encounter date)
"RTN","SCRPW24",188,0)
 ;SD/530 changed For loop and added check for zero node to eliminate undefined error
"RTN","SCRPW24",189,0)
 N SDY,SDI,X1,X2,X,%Y
"RTN","SCRPW24",190,0)
 S:SDATE#1=0 SDATE=SDATE+.9999 S SDI=0 F  S SDI=$O(^DGEN(27.11,"C",+$P(SDOE0,U,2),SDI)) Q:'SDI  D
"RTN","SCRPW24",191,0)
 .Q:'$D(^DGEN(27.11,SDI,0))
"RTN","SCRPW24",192,0)
 .I '$D(^DGEN(27.11,SDI,"U")) S SDY=$G(^DGEN(27.11,SDI,0)),SDY(+SDY)=SDY Q   ;SD*562
"RTN","SCRPW24",193,0)
 .S SDY=$G(^DGEN(27.11,SDI,0)),SDY($P($P(^DGEN(27.11,SDI,"U"),U,1),".",1))=SDY  ;SD/510 changed logic to use date/time entered
"RTN","SCRPW24",194,0)
 S SDI=$O(SDY(SDATE),-1) Q:'SDI ""  S X1=$P($P(SDOE0,U),"."),X2=SDI D ^%DTC Q SDY(SDI)
"RTN","SCRPW24",195,0)
 ;
"RTN","SCRPW24",196,0)
NX S:$D(SDX)<10 SDX(1)="~~~NONE~~~^~~~NONE~~~" Q
"RTN","SCRPW24",197,0)
 ;
"RTN","SCRPW24",198,0)
FST(SDX,SDFI,SDFE) ;Field set transform
"RTN","SCRPW24",199,0)
 Q:'$L(SDX)  N SDY,SDI D FIELD^DID(SDFI,SDFE,"","POINTER","SDY") S SDY=SDY("POINTER") F SDI=1:1:$L(SDY,";") I SDX=$P($P(SDY,";",SDI),":") S SDX=SDX_U_$P($P(SDY,";",SDI),":",2) Q
"RTN","SCRPW24",200,0)
 Q
"RTN","SCRPW27")
0^7^B63466890^B60723820
"RTN","SCRPW27",1,0)
SCRPW27 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;03 Aug 98  9:06 PM
"RTN","SCRPW27",2,0)
 ;;5.3;Scheduling;**144,593**;AUG 13, 1993;Build 13
"RTN","SCRPW27",3,0)
PRT ;Print ACRP Ad Hoc Report
"RTN","SCRPW27",4,0)
 D:$E(IOST)="C" DISP0^SCRPW23 S SDOUT=0 G:$P(SDPAR("F",6),U)="F" PFT G PDF^SCRPW28
"RTN","SCRPW27",5,0)
 ;
"RTN","SCRPW27",6,0)
HIN ;Header initialization
"RTN","SCRPW27",7,0)
 D NOW^%DTC S SDHIN=1,Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDPAGE=1,SDLINE="",$P(SDLINE,"-",(IOM+1))="",SDPBDT=$P($G(SDPAR("L",1)),U,2),SDPEDT=$P($G(SDPAR("L",2)),U,2),SDTITLX=$P($G(SDPAR("O",2)),U)
"RTN","SCRPW27",8,0)
 Q
"RTN","SCRPW27",9,0)
 ;
"RTN","SCRPW27",10,0)
PFT ;Print as formatted text
"RTN","SCRPW27",11,0)
 S SDCOL=$S(SDF(2):0,IOM=80:3,1:29) F SDR="RPAR","RPRT","RDET" D @SDR Q:SDOUT
"RTN","SCRPW27",12,0)
 I $E(IOST)="C",'SDOUT D  N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW27",13,0)
 .F  Q:$Y>(IOSL-2)  W !
"RTN","SCRPW27",14,0)
 .Q
"RTN","SCRPW27",15,0)
 G EXIT
"RTN","SCRPW27",16,0)
 ;
"RTN","SCRPW27",17,0)
PPAR ;Print parameters only
"RTN","SCRPW27",18,0)
 D RPAR K:$D(ZTQUEUED) SDPNOW,SDPAGE,SDLINE,SDPBDT,SDPEDT,SDTITLX Q
"RTN","SCRPW27",19,0)
 ;
"RTN","SCRPW27",20,0)
RPAR ;Print report parameters
"RTN","SCRPW27",21,0)
 D:$E(IOST)'="C" HDR^SCRPW29("Report Parameters Selected") Q:SDOUT  D PLIST^SCRPW22((IOM-80\2),$S($E(IOST)="C":15,1:(IOSL-10))) Q
"RTN","SCRPW27",22,0)
 ;
"RTN","SCRPW27",23,0)
RPRT ;Print formatted report
"RTN","SCRPW27",24,0)
 W @IOF N DX,DY S (DX,DY)=0 X SDXY
"RTN","SCRPW27",25,0)
 S SDPAGE=1,SDS1="" D HDR^SCRPW29("Report Summary") Q:SDOUT  I '$D(^TMP("SCRPW",$J,"RPT",1)) S SDX="No data found within selected parameters." W !!?(IOM-$L(SDX)\2),SDX S SDOUT=1 Q
"RTN","SCRPW27",26,0)
 D HD1^SCRPW29 S SDORDV=""
"RTN","SCRPW27",27,0)
 F  S SDORDV=$O(^TMP("SCRPW",$J,"MASTER",SDORDV),$S(SDORD="ALP":1,1:-1)) Q:SDORDV=""!SDOUT  D RPRT0
"RTN","SCRPW27",28,0)
 Q:SDOUT  D RPRT1("TOT",1,1) Q
"RTN","SCRPW27",29,0)
 ;
"RTN","SCRPW27",30,0)
RPRT0 S SDS1="" F  S SDS1=$O(^TMP("SCRPW",$J,"MASTER",SDORDV,SDS1)) Q:SDS1=""!SDOUT  S SDS2="" F  S SDS2=$O(^TMP("SCRPW",$J,"MASTER",SDORDV,SDS1,SDS2)) Q:SDS2=""!SDOUT  D RPRT1("RPT",SDS1,SDS2)
"RTN","SCRPW27",31,0)
 Q
"RTN","SCRPW27",32,0)
 ;
"RTN","SCRPW27",33,0)
RPRT1(SDRPT,SDS1,SDS2) N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C42|"
"RTN","SCRPW27",34,0)
 K SDX S SDX=$S(SDRPT="TOT":"REPORT TOTAL:",$G(SDPAR("P",1,6))="D":SDS2,1:SDS1)
"RTN","SCRPW27",35,0)
 S SDX(0)=+$G(^TMP("SCRPW",$J,SDRPT,1,SDS1,SDS2,"ENC")),SDX(1)=+$G(^TMP("SCRPW",$J,SDRPT,1,SDS1,SDS2,"VIS")),SDX(2)=+$G(^TMP("SCRPW",$J,SDRPT,1,SDS1,SDS2,"UNI"))
"RTN","SCRPW27",36,0)
 I SDCOL=0 S SDX(3)=+$G(^TMP("SCRPW",$J,SDRPT,2,SDS1,SDS2,"ENC")),SDX(4)=+$G(^TMP("SCRPW",$J,SDRPT,2,SDS1,SDS2,"VIS")),SDX(5)=+$G(^TMP("SCRPW",$J,SDRPT,2,SDS1,SDS2,"UNI"))
"RTN","SCRPW27",37,0)
 I SDCOL=0 F SDI=6,7,8 D CALC(SDI)
"RTN","SCRPW27",38,0)
 D:$Y>(IOSL-6) HDR^SCRPW29("Report Summary"),HD1^SCRPW29 Q:SDOUT
"RTN","SCRPW27",39,0)
 I SDRPT="TOT" W !?(SDCOL),"==========================================  ========  ========  ========  " W:SDCOL=0 "========  ========  ========  ========  ========  ========"
"RTN","SCRPW27",40,0)
 K ^UTILITY($J,"W") S X=SDX D ^DIWP
"RTN","SCRPW27",41,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) W !?(SDCOL),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,42)
"RTN","SCRPW27",42,0)
 S SDI="" F  S SDI=$O(SDX(SDI)) Q:SDI=""!SDOUT  W ?(SDCOL+44+(10*SDI)),$S(SDX(SDI)="N/A":$J(SDX(SDI),8),1:$J(SDX(SDI),8,$S(SDI<6:0,SDX(SDI)'<100000:0,SDX(SDI)'<10000:1,1:2)))
"RTN","SCRPW27",43,0)
 Q
"RTN","SCRPW27",44,0)
 ;
"RTN","SCRPW27",45,0)
CALC(SDI) ;Calculate % change
"RTN","SCRPW27",46,0)
 S SDX(SDI)=$S(SDX(SDI-3)<1:"N/A",1:SDX(SDI-6)-SDX(SDI-3)*100/SDX(SDI-3))
"RTN","SCRPW27",47,0)
 ;
"RTN","SCRPW27",48,0)
RDET Q:SDOUT!(SDF(1)="S")  S SDS1="" F  S SDS1=$O(^TMP("SCRPW",$J,"RPT",1,SDS1)) Q:SDOUT!(SDS1="")  S SDS2="" F  S SDS2=$O(^TMP("SCRPW",$J,"RPT",1,SDS1,SDS2)) Q:SDOUT!(SDS2="")  D RDET1
"RTN","SCRPW27",49,0)
 Q
"RTN","SCRPW27",50,0)
 ;
"RTN","SCRPW27",51,0)
RDET1 S SDENC=^TMP("SCRPW",$J,"RPT",1,SDS1,SDS2,"ENC"),SDVIS=^TMP("SCRPW",$J,"RPT",1,SDS1,SDS2,"VIS"),SDUNI=^TMP("SCRPW",$J,"RPT",1,SDS1,SDS2,"UNI")
"RTN","SCRPW27",52,0)
 S SDPTX(1)="Detail of "_$P(SDPAR("P",1,1),U,2)_": "_$S($G(SDPAR("P",1,6))="D":SDS2,1:SDS1),SDPTX(2)="Encounters: "_SDENC_"    Visits: "_SDVIS_"    Uniques: "_SDUNI D HDR^SCRPW29("Report Detail"),HD2^SCRPW29 Q:SDOUT
"RTN","SCRPW27",53,0)
 D:"EB"[SDF(3) DPTL Q:SDOUT  D:"DB"[SDF(3) DDXP Q
"RTN","SCRPW27",54,0)
 ;
"RTN","SCRPW27",55,0)
DSV(SDPER) ;Encrypt detail sort values
"RTN","SCRPW27",56,0)
 N SDX S SDX=$G(^TMP("SCRPW",$J,"DSV",$P(SDPER,U,2),$P(SDPER,U))) Q:SDX SDX
"RTN","SCRPW27",57,0)
 S (SDX,^TMP("SCRPW",$J,"DSV",0))=$G(^TMP("SCRPW",$J,"DSV",0))+1
"RTN","SCRPW27",58,0)
 S ^TMP("SCRPW",$J,"DSV",$P(SDPER,U,2),$P(SDPER,U))=SDX Q SDX
"RTN","SCRPW27",59,0)
 ;
"RTN","SCRPW27",60,0)
DPTL ;Detail patient list
"RTN","SCRPW27",61,0)
 N SDDSV S SDDSV=$$DSV(SDS2_"^"_SDS1)
"RTN","SCRPW27",62,0)
 S SDCOL=$S($D(SDPAR("PF")):0,IOM=80:0,1:26) D DPHD^SCRPW29
"RTN","SCRPW27",63,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM)) Q:SDOUT!(SDPNAM="")  S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM,DFN)) Q:SDOUT!'DFN  D DPTL1
"RTN","SCRPW27",64,0)
 Q
"RTN","SCRPW27",65,0)
 ;
"RTN","SCRPW27",66,0)
DPTL1 S SDI=0 I SDF(4)="U" D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DPHD^SCRPW29 Q:SDOUT  W !?(SDCOL+19),SDPNAM,?(SDCOL+51),$P($G(^DPT(DFN,0)),U,9) D APFP^SCRPW29 S SDI=SDI+1 Q
"RTN","SCRPW27",67,0)
 S SDT=0 F  S SDT=$O(^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM,DFN,SDT)) Q:SDOUT!'SDT  D DPTL2
"RTN","SCRPW27",68,0)
 Q
"RTN","SCRPW27",69,0)
 ;
"RTN","SCRPW27",70,0)
DPTL2 I SDF(4)="V" D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DPHD^SCRPW29 Q:SDOUT  W !?(SDCOL+13),SDPNAM,?(SDCOL+45),$P($G(^DPT(DFN,0)),U,9) S Y=SDT X ^DD("DD") W ?(SDCOL+57),Y D APFP^SCRPW29 S SDI=SDI+1 Q
"RTN","SCRPW27",71,0)
 S SDDT=0 F  S SDDT=$O(^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM,DFN,SDT,SDDT)) Q:SDOUT!'SDDT  S SDOE=0 F  S SDOE=$O(^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM,DFN,SDT,SDDT,SDOE)) Q:SDOUT!'SDOE  D DPTL3
"RTN","SCRPW27",72,0)
 Q
"RTN","SCRPW27",73,0)
 ;
"RTN","SCRPW27",74,0)
DPTL3 D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DPHD^SCRPW29 Q:SDOUT
"RTN","SCRPW27",75,0)
 S SDCL=^TMP("SCRPW",$J,"DET",SDDSV,SDPNAM,DFN,SDT,SDDT,SDOE),SDCL=$P($G(^SC(SDCL,0)),U),Y=SDDT X ^DD("DD")
"RTN","SCRPW27",76,0)
 W !?(SDCOL),$E(SDPNAM,1,18),?(SDCOL+20),$P($G(^DPT(DFN,0)),U,9) W ?(SDCOL+32),$P(Y,":",1,2),?(SDCOL+52),$E(SDCL,1,28) D APFP^SCRPW29 S SDI=SDI+1 Q
"RTN","SCRPW27",77,0)
 ;
"RTN","SCRPW27",78,0)
DDXP ;Detail dx/procedure lists
"RTN","SCRPW27",79,0)
 I $Y>(IOSL-10) D HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("D") Q:SDOUT  G DDXP0
"RTN","SCRPW27",80,0)
 W:SDF(3)="B" !! D DDPH^SCRPW29("D")
"RTN","SCRPW27",81,0)
DDXP0 I '$D(^TMP("SCRPW",$J,"RPTTDX",1,SDS1,SDS2)) W !!,"No diagnoses found for this detail item." G DAPP
"RTN","SCRPW27",82,0)
 K SDTCT S SDQT="",SDCT=0
"RTN","SCRPW27",83,0)
 F  S SDQT=$O(^TMP("SCRPW",$J,"RPTTDX",1,SDS1,SDS2,SDQT),-1) Q:SDOUT!(SDQT="")!(SDCT>(SDF(5)-1))  S SDS3="" F  S SDS3=$O(^TMP("SCRPW",$J,"RPTTDX",1,SDS1,SDS2,SDQT,SDS3)) Q:SDOUT!(SDS3="")!(SDCT>(SDF(5)-1))  D DDXP1
"RTN","SCRPW27",84,0)
 Q:SDOUT  D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("D") Q:SDOUT
"RTN","SCRPW27",85,0)
 W !?(SDCOL),"==========================================",?(SDCOL+46),"==========",?(SDCOL+61),"==========",?(SDCOL+76),"==========",!?(SDCOL),"TOTAL:",?(SDCOL+46),$J(SDTCT(1),10),?(SDCOL+61),$J(SDTCT(2),10),?(SDCOL+76),$J(SDTCT(3),10)
"RTN","SCRPW27",86,0)
 ;
"RTN","SCRPW27",87,0)
DAPP I $Y>(IOSL-10) D HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("P") Q:SDOUT  G DAPP0
"RTN","SCRPW27",88,0)
 W !! D DDPH^SCRPW29("P")
"RTN","SCRPW27",89,0)
DAPP0 I '$D(^TMP("SCRPW",$J,"RPTTAP",1,SDS1,SDS2)) W !!,"No procedures found for this detail item." Q
"RTN","SCRPW27",90,0)
 K SDTCT S SDQT="",SDCT=0
"RTN","SCRPW27",91,0)
 F  S SDQT=$O(^TMP("SCRPW",$J,"RPTTAP",1,SDS1,SDS2,SDQT),-1) Q:SDOUT!(SDQT="")!(SDCT>(SDF(5)-1))  S SDS3="" F  S SDS3=$O(^TMP("SCRPW",$J,"RPTTAP",1,SDS1,SDS2,SDQT,SDS3)) Q:SDOUT!(SDS3="")!(SDCT>(SDF(5)-1))  D DAPP1
"RTN","SCRPW27",92,0)
 Q:SDOUT  D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("A") Q:SDOUT  W !?(SDCOL+13),"======================================",?(SDCOL+56),"==========",!?(SDCOL+13),"TOTAL:",?(SDCOL+56),$J(SDTCT(1),10)
"RTN","SCRPW27",93,0)
 Q
"RTN","SCRPW27",94,0)
 ;
"RTN","SCRPW27",95,0)
DDXP1 D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("D") Q:SDOUT  F SDI=1,2,3 S SDICT(SDI)=+$P(^TMP("SCRPW",$J,"RPTDX",1,SDS1,SDS2,SDS3),U,SDI),SDTCT(SDI)=$G(SDTCT(SDI))+SDICT(SDI)
"RTN","SCRPW27",96,0)
 N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C42|" K ^UTILITY($J,"W") S X=SDS3 D ^DIWP
"RTN","SCRPW27",97,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) W !?(SDCOL),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,42)
"RTN","SCRPW27",98,0)
 W ?(SDCOL+46),$J(SDICT(1),10),?(SDCOL+61),$J(SDICT(2),10),?(SDCOL+76),$J(SDICT(3),10) S SDCT=SDCT+1 Q
"RTN","SCRPW27",99,0)
 ;
"RTN","SCRPW27",100,0)
DAPP1 D:$Y>(IOSL-6) HDR^SCRPW29("Report Detail"),HD2^SCRPW29,DDPH^SCRPW29("A") Q:SDOUT  S SDICT(1)=^TMP("SCRPW",$J,"RPTAP",1,SDS1,SDS2,SDS3),SDTCT(1)=$G(SDTCT(1))+SDICT(1)
"RTN","SCRPW27",101,0)
 W !?(SDCOL+13),SDS3,?(SDCOL+56),$J(SDICT(1),10) S SDCT=SDCT+1 Q
"RTN","SCRPW27",102,0)
 ;
"RTN","SCRPW27",103,0)
EXIT D DISP0^SCRPW23,KVA^VADPT,KILL^%ZISS S X=IOM X ^%ZOSF("RM")
"RTN","SCRPW27",104,0)
 K %,%DT,%Y,C,DFN,DIC,DIR,DTOUT,DUOUT,I,II,S1,S2,SD,SDA,SDACT,SDATE,SDBOT,SDCL,SDCOL,SDCT,SDDT,SDDV,SDE,SDEDT,SDEF,SDENC,SDEXE,SDF,SDFE,SDFI,SDFL
"RTN","SCRPW27",105,0)
 K SDFOUND,SDH,SDI,SDICT,SDII,SDIRB,SDIRQ,SDISP,SDL,SDLEV,SDLINE,SDLP,SDLR,SDNUL,SDO,SDOE,SDOE0,SDOCH,SDOUT,SDP,SDPAGE,SDPAR,SDPBDT,SDPER,SDPNAM
"RTN","SCRPW27",106,0)
 K SDPNOW,SDPTX,SDQT,SDR,SDR1,SDR2,SDREV,SDRPT,SDS,SDS1,SDS2,SDS3,SDDSC1,SDSC2,SDSEL,SDT,SDTAG,SDTCT,SDTITL,SDTITLX,SDTOP,SDTX,SDTYP,SDU,SDUNI
"RTN","SCRPW27",107,0)
 K SDAPFM,SDD,SDPFL,SDIII,S0,SDLPX,SDHIN,SDV,SDVIS,SDX,SDX1,SDX2,SDY,SDYR,SDZ,T,X,X1,X2,Y,ZTSAVE,SDSTOP,SDXY,SDTEMP,SDRM,D0,DINUM,SDNEW,SDOECH
"RTN","SCRPW27",108,0)
 K SDOECH,SDORD,SDORDV,SDS4,SDTOT,^TMP("SCRPW",$J)
"RTN","SCRPW27",109,0)
 Q
"RTN","SCRPW29")
0^8^B76811710^B54910145
"RTN","SCRPW29",1,0)
SCRPW29 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;03 Aug 98  8:56 PM
"RTN","SCRPW29",2,0)
 ;;5.3;Scheduling;**144,593**;AUG 13, 1993;Build 13
"RTN","SCRPW29",3,0)
 ;
"RTN","SCRPW29",4,0)
XY(X) ;Maintain $X, $Y
"RTN","SCRPW29",5,0)
 ;Required input: X=screen handling
"RTN","SCRPW29",6,0)
 N DX,DY S DX=$X,DY=$Y W X X SDXY Q ""
"RTN","SCRPW29",7,0)
 ;
"RTN","SCRPW29",8,0)
MAR ;Margin note
"RTN","SCRPW29",9,0)
 I $G(SDPAR("F",2))!$D(SDPAR("PF")),$P(SDPAR("F",6),U)="F" W !,"This report requires 132 column output!",!
"RTN","SCRPW29",10,0)
 Q
"RTN","SCRPW29",11,0)
 ;
"RTN","SCRPW29",12,0)
PFC() ;Print field choice
"RTN","SCRPW29",13,0)
 Q $S('$D(SDPAR("F",3)):"","EB"[$P(SDPAR("F",3),U):"X:ADDL. PRINT FIELDS;",1:"")
"RTN","SCRPW29",14,0)
 ;
"RTN","SCRPW29",15,0)
PF ;Print fields prompter
"RTN","SCRPW29",16,0)
 Q:SDOUT!'$D(SDPAR("F",3))  Q:SDOUT!("EB"'[$P(SDPAR("F",3),U))
"RTN","SCRPW29",17,0)
 K SDBOT S SDBOT(1)="Additional print field selection",SDBOT(2)="Additional print fields that are selected will be included in the output of",SDBOT(3)="encounter, visit, or unique patient detail lists,"
"RTN","SCRPW29",18,0)
 D DISP^SCRPW23("A D D I T I O N A L   P R I N T   F I E L D S",.SDBOT)
"RTN","SCRPW29",19,0)
 S SDD=$P($G(SDPAR("F",4)),U) Q:SDOUT!(SDD="")  S SDD=$S(SDD="E":1,1:2),SDS1="PF",(SDOUT,SDNUL)=0
"RTN","SCRPW29",20,0)
 D PFL S SDS1="PF" F  Q:SDOUT!SDNUL  D PF1
"RTN","SCRPW29",21,0)
 Q
"RTN","SCRPW29",22,0)
 ;
"RTN","SCRPW29",23,0)
PF1 W !!?10,$$XY(IORVON),"Select additional print fields for patient detail:  (optional)",$$XY(IORVOFF)
"RTN","SCRPW29",24,0)
 K DIR S DIR("A")="Specify additional print field",DIR("?")="These fields will be included in the patient detail list output."
"RTN","SCRPW29",25,0)
 S S1=$$DIR^SCRPW23(.DIR,1,"","","O",SDD) Q:SDOUT!SDNUL
"RTN","SCRPW29",26,0)
 K DIR S DIR("A")="Select "_$P(S1,U,2)_" category",S2=$$DIR^SCRPW23(.DIR,2,"",$P(S1,U),"O",SDD,1) Q:SDOUT  I SDNUL S SDNUL=0 Q
"RTN","SCRPW29",27,0)
 S SDSEL=$P(S1,U)_$P(S2,U) G:$D(SDPAR("PFX",SDSEL)) PFD
"RTN","SCRPW29",28,0)
 S SDS2=$P(^TMP("SCRPW",$J,"ACT",SDSEL),T,11),SDS3=$O(SDPAR(SDS1,SDS2,""),-1)+1,SDPAR(SDS1,SDS2,SDS3)=SDSEL_U_$P(S1,U,2)_U_$P(S2,U,2),SDPAR("PFX",SDSEL,SDS2,SDS3)=""
"RTN","SCRPW29",29,0)
 Q
"RTN","SCRPW29",30,0)
 ;
"RTN","SCRPW29",31,0)
PFD N DIR S DIR(0)="Y",DIR("A")="This item is already selected as a print field, do you want to delete it",DIR("B")="NO" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SCRPW29",32,0)
 I Y S S1=$O(SDPAR("PFX",SDSEL,"")),S2=$O(SDPAR("PFX",SDSEL,S1,"")) K SDPAR("SDX",SDSEL),SDPAR("PF",S1,S2) W !,"deleted..."
"RTN","SCRPW29",33,0)
 Q
"RTN","SCRPW29",34,0)
 ;
"RTN","SCRPW29",35,0)
PFL ;List print field selections
"RTN","SCRPW29",36,0)
 Q:SDOUT!'$D(SDPAR("PF"))  N SDOUT,SDI,SDX S (SDI,SDOUT)=0 W !!,"Additional print fields currently selected:"
"RTN","SCRPW29",37,0)
 F S1=2,1 S S2=0 F  S S2=$O(SDPAR("PF",S1,S2)) Q:SDOUT!'S2  S SDI=SDI+1 D:SDI#10=0 WAIT Q:SDOUT  S SDX=SDPAR("PF",S1,S2) W !,$J($P(SDX,U,2)_": ",30),$P(SDX,U,3)
"RTN","SCRPW29",38,0)
 Q:SDOUT  D WAIT Q
"RTN","SCRPW29",39,0)
 ;
"RTN","SCRPW29",40,0)
WAIT N DIR S DIR(0)="E" W ! D ^DIR S:'Y SDOUT=1 W ! Q
"RTN","SCRPW29",41,0)
 ;
"RTN","SCRPW29",42,0)
PFR ;Remove print fields per parameter re-edits
"RTN","SCRPW29",43,0)
 I $P($G(SDPAR("F",1)),U)="S"!($P($G(SDPAR("F",3)),U)="D") K SDPAR("PF"),SDPAR("PFX") Q
"RTN","SCRPW29",44,0)
 Q:SDOUT!($P($G(SDPAR("F",4)),U)="E")
"RTN","SCRPW29",45,0)
 S S2=0 F  S S2=$O(SDPAR("PF",1,S2)) Q:SDOUT!'S2  S SDSEL=$P(SDPAR("PF",1,S2),U) K SDPAR("PFX",SDSEL),SDPAR("PF",1,S2)
"RTN","SCRPW29",46,0)
 Q
"RTN","SCRPW29",47,0)
 ;
"RTN","SCRPW29",48,0)
APFP ;Addl. print fields print
"RTN","SCRPW29",49,0)
 N SDC,SDC1,SDII,SDIII,S1,S2,SDX,SDY,SDACT,SDOE0 S SDII=0,SDC=$S(SDF(4)="E":81,SDF(4)="V":70,1:63) D:'SDI APF(2) D APF(1) W:$D(SDPAR("PF")) ! Q
"RTN","SCRPW29",50,0)
 ;
"RTN","SCRPW29",51,0)
APF(S1) ;Addl. print field
"RTN","SCRPW29",52,0)
 S S2=0 F  S S2=$O(SDPAR("PF",S1,S2)) Q:SDOUT!'S2  S SDY=SDPAR("PF",S1,S2),SDACT=^TMP("SCRPW",$J,"ACT",$P(SDY,U)) D:$Y>(IOSL-4) HDR1 Q:SDOUT  W:SDII ! W ?(SDC),$P(SDACT,T),": " S SDII=SDII+1 D APF1
"RTN","SCRPW29",53,0)
 Q
"RTN","SCRPW29",54,0)
 ;
"RTN","SCRPW29",55,0)
APF1 N DIWL,DIWF,SDL2
"RTN","SCRPW29",56,0)
 K SDX S SDOE0=$$OE0() X $P(SDACT,T,7) S SDIII=0,SDX="",SDC1=SDC+2+$L($P(SDACT,T))
"RTN","SCRPW29",57,0)
 S DIWL=1 S DIWF="C"_(51-(SDC1-SDC)+(81-SDC))_"|"
"RTN","SCRPW29",58,0)
 F  S SDX=$O(SDX(SDX)) Q:SDOUT!(SDX="")  D:$Y>(IOSL-2) HDR1 Q:SDOUT  D
"RTN","SCRPW29",59,0)
 . K ^UTILITY($J,"W") S X=$P(SDX(SDX),U,2) D ^DIWP
"RTN","SCRPW29",60,0)
 . F SDL2=1:1:^UTILITY($J,"W",DIWL) D  S SDIII=SDIII+1
"RTN","SCRPW29",61,0)
 . . W:SDIII ! W ?(SDC1),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(51-(SDC1-SDC)+(81-SDC)))
"RTN","SCRPW29",62,0)
 Q
"RTN","SCRPW29",63,0)
 ;
"RTN","SCRPW29",64,0)
OE0() ;Get encounter node
"RTN","SCRPW29",65,0)
 Q:SDOUT!("UV"[SDF(4)) U_DFN_U
"RTN","SCRPW29",66,0)
 Q $$GETOE^SDOE(SDOE)
"RTN","SCRPW29",67,0)
 ;
"RTN","SCRPW29",68,0)
HDR1 D HDR("Report Detail"),HD2,DPHD S SDI=0,(SDII,SDIII)=1 Q
"RTN","SCRPW29",69,0)
 ;
"RTN","SCRPW29",70,0)
VF(SDISP) ;Verify format parameters
"RTN","SCRPW29",71,0)
 N SDX,SDI,SDV S SDX=$G(SDPAR("F",1)) I '$L(SDX) S SDV="Format" G VQ
"RTN","SCRPW29",72,0)
 G @("VF"_$P(SDX,U))
"RTN","SCRPW29",73,0)
 ;
"RTN","SCRPW29",74,0)
VFD K SDPAR("F",2) F SDI=3,6 S SDV=$D(SDPAR("F",SDI)) Q:'SDV
"RTN","SCRPW29",75,0)
 I 'SDV S SDV="Format" G VQ
"RTN","SCRPW29",76,0)
 S SDV=$P(SDPAR("F",3),U) I "EB"[SDV,'$D(SDPAR("F",4)) S SDV="Format" G VQ
"RTN","SCRPW29",77,0)
 I "DB"[SDV,'$D(SDPAR("F",5)) S SDV="Format" G VQ
"RTN","SCRPW29",78,0)
 Q 0
"RTN","SCRPW29",79,0)
 ;
"RTN","SCRPW29",80,0)
VFS F SDI=3,4,5 K SDPAR("F",SDI)
"RTN","SCRPW29",81,0)
 F SDI=2,6 S SDV=$D(SDPAR("F",SDI)) Q:'SDV
"RTN","SCRPW29",82,0)
 I 'SDV S SDV="Format" G VQ
"RTN","SCRPW29",83,0)
 Q 0
"RTN","SCRPW29",84,0)
 ;
"RTN","SCRPW29",85,0)
VP(SDISP) ;Verify perspective parameters
"RTN","SCRPW29",86,0)
 I '$D(SDPAR("P",1)) S SDV="Perspective" G VQ
"RTN","SCRPW29",87,0)
 I $P(SDPAR("F",1),U)="D",'$D(SDPAR("P",1,4)) S SDV="Perspective" G VQ
"RTN","SCRPW29",88,0)
 Q 0
"RTN","SCRPW29",89,0)
 ;
"RTN","SCRPW29",90,0)
VL(SDISP) ;Verify limitation parameters
"RTN","SCRPW29",91,0)
 N SDI,SDV F SDI=1,2 S SDV=$D(SDPAR("L",SDI)) Q:'SDV
"RTN","SCRPW29",92,0)
 I 'SDV S SDV="Limitation" G VQ
"RTN","SCRPW29",93,0)
 Q 0
"RTN","SCRPW29",94,0)
 ;
"RTN","SCRPW29",95,0)
VO(SDISP) ;Verify output order parameter
"RTN","SCRPW29",96,0)
 I '$D(SDPAR("O",1)) S SDV="Order" G VQ
"RTN","SCRPW29",97,0)
 Q 0
"RTN","SCRPW29",98,0)
 ;
"RTN","SCRPW29",99,0)
VQ ;Prompt for re-edit
"RTN","SCRPW29",100,0)
 ;Required input: SDV=validation area
"RTN","SCRPW29",101,0)
 I $G(SDISP) W !,$C(7),$$XY(IORVON)," ",SDV," parameters are incomplete.",$$XY(IORVOFF) S SDOUT=1 Q 0
"RTN","SCRPW29",102,0)
 N DIR S DIR(0)="Y",DIR("A")=SDV_" parameters are incomplete.  Re-edit",DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT)!'$G(Y) S SDOUT=1 Q 0
"RTN","SCRPW29",103,0)
 Q 1
"RTN","SCRPW29",104,0)
 ;
"RTN","SCRPW29",105,0)
 ; Verify diagnoses specified as Report Perspective or Report Limitations have a valid / common
"RTN","SCRPW29",106,0)
 ; code set (ICD-9-CM / ICD-10-CM) that matches the Report Limitation date range.
"RTN","SCRPW29",107,0)
VERICD(ICDERR) ;
"RTN","SCRPW29",108,0)
 N SDX,SDI,SDV,I10DTI,I10DTE,CSYS
"RTN","SCRPW29",109,0)
 ;
"RTN","SCRPW29",110,0)
 ; Retrieve the ICD-10 implementation date.
"RTN","SCRPW29",111,0)
 S Y=$$IMP^SCRPWICD(30) S I10DTI=Y X ^DD("DD") S I10DTE=Y
"RTN","SCRPW29",112,0)
 ; 
"RTN","SCRPW29",113,0)
 ; Find the expected diagnosis code set given the Report Limitation date range.
"RTN","SCRPW29",114,0)
 S CSYS=$S($P(SDPAR("L",1),U,1)<I10DTI:1,1:30)
"RTN","SCRPW29",115,0)
 ;
"RTN","SCRPW29",116,0)
 ; If diagnoses are specified for the Report Perspective, find the code set of the first diagnosis.
"RTN","SCRPW29",117,0)
 ; (All the diagnoses should / must always be of the same code set.)
"RTN","SCRPW29",118,0)
 ; Throw an error if the code set does not match the expected code set.
"RTN","SCRPW29",119,0)
 ; The error is described as a Report Limitation date range error simply because the Report Perspective is entered first.
"RTN","SCRPW29",120,0)
 D
"RTN","SCRPW29",121,0)
 . S SDX=$P($G(SDPAR("P",1)),U,1) Q:SDX'="DX"
"RTN","SCRPW29",122,0)
 . S SDX=$P($G(SDPAR("P",1,1)),U,1) Q:(SDX'="PD")&(SDX'="SD")&(SDX'="AD")
"RTN","SCRPW29",123,0)
 . S SDX=$P($G(SDPAR("P",1,2)),U,1) Q:(SDX="N")
"RTN","SCRPW29",124,0)
 . S SDX=$O(SDPAR("P",1,5,"")) Q:SDX=""
"RTN","SCRPW29",125,0)
 . S SDX=$$CSI^SCRPWICD(80,SDX) Q:SDX=""  Q:SDX=CSYS
"RTN","SCRPW29",126,0)
 . S:SDX=1 ICDERR="The Report Limitation dates must be before "_I10DTE_" to match the (ICD-9-CM) diagnoses specified in the Report Perspective."
"RTN","SCRPW29",127,0)
 . S:SDX=30 ICDERR="The Report Limitation dates must be on or after "_I10DTE_" to match the (ICD-10-CM) diagnoses specified in the Report Perspective."
"RTN","SCRPW29",128,0)
 ;
"RTN","SCRPW29",129,0)
 Q:$G(ICDERR)]"" 1
"RTN","SCRPW29",130,0)
 ;
"RTN","SCRPW29",131,0)
 ; If diagnoses are specified for the Report Limitations, find the code set of the first diagnosis in each set of diagnoses.
"RTN","SCRPW29",132,0)
 ; (All the diagnoses in a set should / must always be of the same code set.) 
"RTN","SCRPW29",133,0)
 ; Throw an error if the code set does not match the expected code set.
"RTN","SCRPW29",134,0)
 S SDI=2
"RTN","SCRPW29",135,0)
 F  S SDI=$O(SDPAR("L",SDI)) Q:SDI=""  D  Q:$G(SDV)]""
"RTN","SCRPW29",136,0)
 . S SDX=$P(SDPAR("L",SDI),U,1) Q:SDX'="DX"
"RTN","SCRPW29",137,0)
 . S SDX=$P(SDPAR("L",SDI,1),U,1) Q:(SDX'="PD")&(SDX'="SD")&(SDX'="AD")
"RTN","SCRPW29",138,0)
 . S SDX=$P(SDPAR("L",SDI,2),U,1) Q:(SDX="N")
"RTN","SCRPW29",139,0)
 . S SDX=$O(SDPAR("L",SDI,5,"")) Q:SDX=""
"RTN","SCRPW29",140,0)
 . S SDX=$$CSI^SCRPWICD(80,SDX) Q:SDX=""  Q:SDX=CSYS
"RTN","SCRPW29",141,0)
 . S ICDERR="All Report Limitation diagnoses must be ("_$S(CSYS=30:"ICD-10-CM",1:"ICD-9-CM")_") to match the report dates."
"RTN","SCRPW29",142,0)
 ;
"RTN","SCRPW29",143,0)
 Q:$G(ICDERR)]"" 1
"RTN","SCRPW29",144,0)
 ;
"RTN","SCRPW29",145,0)
 Q 0
"RTN","SCRPW29",146,0)
 ;
"RTN","SCRPW29",147,0)
DDPH(SDI) ;Detail dx/procedure header
"RTN","SCRPW29",148,0)
 Q:SDOUT  N SDX S SDX=$E(SDF(5)) I $L(SDF(5))>1 F SDII=2:1:$L(SDF(5)) S SDX=SDX_" "_$E(SDF(5),SDII)
"RTN","SCRPW29",149,0)
 S SDX="D E T A I L   O F   T O P   "_SDX_$S(SDI="D":"   D I A G N O S I S E S",1:"   P R O C E D U R E S")
"RTN","SCRPW29",150,0)
 W !?(IOM-$L(SDX)\2),SDX,!?(IOM-$L(SDX)\2),$E(SDLINE,1,$L(SDX))
"RTN","SCRPW29",151,0)
 I SDI="D" W !?(SDCOL),"Diagnosis",?(SDCOL+49),"Primary",?(SDCOL+62),"Secondary",?(SDCOL+81),"Total"
"RTN","SCRPW29",152,0)
 I SDI="D" W !?(SDCOL),"------------------------------------------",?(SDCOL+46),"----------",?(SDCOL+61),"----------",?(SDCOL+76),"----------"
"RTN","SCRPW29",153,0)
 I SDI="P" W !?(SDCOL+13),"Procedures",?(SDCOL+61),"Total",!?(SDCOL+13),"--------------------------------------",?(SDCOL+56),"----------"
"RTN","SCRPW29",154,0)
 Q
"RTN","SCRPW29",155,0)
 ;
"RTN","SCRPW29",156,0)
DPHD ;Detail patient subheader
"RTN","SCRPW29",157,0)
 Q:SDOUT  N SDX S SDX="D E T A I L   O F   P A T I E N T   "_$S(SDF(4)="E":"E N C O U N T E R S",SDF(4)="V":"V I S I T S",1:"U N I Q U E S")
"RTN","SCRPW29",158,0)
 W !?(IOM-$L(SDX)\2),SDX,!?(IOM-$L(SDX)\2),$E(SDLINE,1,$L(SDX))
"RTN","SCRPW29",159,0)
 I SDF(4)="E" W !?(SDCOL),"Patient:",?(SDCOL+20),"SSN:",?(SDCOL+32),"Date:",?(SDCOL+52),"Location:" D APFH(81) W !?(SDCOL),$E(SDLINE,1,18),?(SDCOL+20),$E(SDLINE,1,10),?(SDCOL+32),$E(SDLINE,1,18),?(SDCOL+52),$E(SDLINE,1,28) D APFL(81)
"RTN","SCRPW29",160,0)
 I SDF(4)="V" W !?(SDCOL+13),"Patient:",?(SDCOL+45),"SSN:",?(SDCOL+57),"Date:" D APFH(70) W !?(SDCOL+13),$E(SDLINE,1,30),?(SDCOL+45),$E(SDLINE,1,10),?(SDCOL+57),$E(SDLINE,1,11) D APFL(70)
"RTN","SCRPW29",161,0)
 I SDF(4)="U" W !?(SDCOL+19),"Patient:",?(SDCOL+51),"SSN:" D APFH(63) W !?(SDCOL+19),$E(SDLINE,1,30),?(SDCOL+51),$E(SDLINE,1,10) D APFL(63)
"RTN","SCRPW29",162,0)
 Q
"RTN","SCRPW29",163,0)
 ;
"RTN","SCRPW29",164,0)
APFH(SDC) ;Addl. print field subheader
"RTN","SCRPW29",165,0)
 Q:SDOUT!'$D(SDPAR("PF"))  W ?(SDC),"Additional print fields:" Q
"RTN","SCRPW29",166,0)
 ;
"RTN","SCRPW29",167,0)
APFL(SDC) ;Addl. print field subheader, cont.
"RTN","SCRPW29",168,0)
 Q:SDOUT!'$D(SDPAR("PF"))  W ?(SDC),$E(SDLINE,1,51) Q
"RTN","SCRPW29",169,0)
 ;
"RTN","SCRPW29",170,0)
HD1 ;Subheader for summary
"RTN","SCRPW29",171,0)
 Q:SDOUT  I SDCOL=0 W !?77,"Prior",?87,"Prior",?97,"Prior",?105,"Percent",?115,"Percent",?125,"Percent"
"RTN","SCRPW29",172,0)
 I SDCOL=0 W !?78,"Year",?88,"Year",?98,"Year",?106,"Change",?116,"Change",?126,"Change"
"RTN","SCRPW29",173,0)
 W !?(SDCOL),$P(SDPAR("P",1,1),U,2),":",?(SDCOL+44),"Encount.",?(SDCOL+56),"Visits",?(SDCOL+65),"Uniques"
"RTN","SCRPW29",174,0)
 I SDCOL=0 W ?74,"Encount.",?86,"Visits",?95,"Uniques",?104,"Encount.",?116,"Visits",?125,"Uniques"
"RTN","SCRPW29",175,0)
 W !?(SDCOL),"------------------------------------------  --------  --------  --------  " W:SDCOL=0 "--------  --------  --------  --------  --------  --------" Q
"RTN","SCRPW29",176,0)
 ;
"RTN","SCRPW29",177,0)
HD2 Q:SDOUT  N SDI F SDI=1,2 W !?(IOM-$L(SDPTX(SDI))\2),SDPTX(SDI)
"RTN","SCRPW29",178,0)
 W !,SDLINE Q
"RTN","SCRPW29",179,0)
 ;
"RTN","SCRPW29",180,0)
HDR(SDTITL) ;Print report header
"RTN","SCRPW29",181,0)
 I $E(IOST)="C",SDPAGE>1 N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW29",182,0)
 D STOP^SCRPW26 Q:SDOUT  I '$L($G(SDXY)) S SDXY=^%ZOSF("XY")
"RTN","SCRPW29",183,0)
 D:'$G(SDHIN) HIN^SCRPW27 W:SDPAGE>1 @IOF N DX,DY S (DX,DY)=0 X SDXY
"RTN","SCRPW29",184,0)
 W SDLINE,!?(IOM-28\2),"<*>  ACRP AD HOC REPORT  <*>" I $L(SDTITLX) W !?(IOM-$L(SDTITLX)\2),SDTITLX
"RTN","SCRPW29",185,0)
 W !?(IOM-$L(SDTITL)\2),SDTITL,!,SDLINE,! I $L(SDPBDT),$L(SDPEDT) W "For date range: ",SDPBDT," to ",SDPEDT,!
"RTN","SCRPW29",186,0)
 W "Date printed: ",SDPNOW,?(IOM-7-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW40")
0^9^B74686227^B69722600
"RTN","SCRPW40",1,0)
SCRPW40 ;RENO/KEITH - Diagnosis/Procedure Frequency Report ;06/22/99
"RTN","SCRPW40",2,0)
 ;;5.3;Scheduling;**144,180,556,593**;AUG 13, 1993;Build 13
"RTN","SCRPW40",3,0)
 ;06/22/99 ACS - Added CPT modifiers to the report
"RTN","SCRPW40",4,0)
 ;06/22/99 ACS - Added CPT modifier API calls
"RTN","SCRPW40",5,0)
 ;04/13/08 - Updating to replace calls to unsupported/deleted ICD9 fields with API calls
"RTN","SCRPW40",6,0)
 ;
"RTN","SCRPW40",7,0)
 N SDDIV,SD,%DT,X,Y,DIR,SDX,LINEFLAG
"RTN","SCRPW40",8,0)
 D TITL^SCRPW50("Outpatient Diagnosis/Procedure Frequency Report")
"RTN","SCRPW40",9,0)
 I '$$DIVA^SCRPW17(.SDDIV) S SDOUT=1 G EXIT
"RTN","SCRPW40",10,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW40",11,0)
 S Y=$$IMP^SCRPWICD(30) S SD("I10DTI")=Y X ^DD("DD") S SD("I10DTE")=Y
"RTN","SCRPW40",12,0)
BDT W ! S %DT="AEPX",%DT(0)=2961001,%DT("A")="Beginning date: " D ^%DT I Y<1 S SDOUT=1 G EXIT
"RTN","SCRPW40",13,0)
 S SD("BDT")=Y
"RTN","SCRPW40",14,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT I Y<1 S SDOUT=1 G EXIT
"RTN","SCRPW40",15,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","SCRPW40",16,0)
 S SD("EDT")=Y_.999999
"RTN","SCRPW40",17,0)
 I (SD("BDT")<SD("I10DTI")),(SD("EDT")'<SD("I10DTI")) D  G BDT
"RTN","SCRPW40",18,0)
 . W !!,$C(7),"Beginning and Ending dates must both be prior to "_SD("I10DTE")_" (ICD-9) or both be on or after "_SD("I10DTE")_" (ICD-10)."
"RTN","SCRPW40",19,0)
 D SUBT^SCRPW50("**** Report Format Selection ****")
"RTN","SCRPW40",20,0)
 K DIR S DIR(0)="S^D:DIAGNOSIS FREQUENCY;P:PROCEDURE FREQUENCY;B:BOTH DIAGNOSIS AND PROCEDURE",DIR("A")="Specify the type of report to print",DIR("?")="This determines the type of lists returned by the report."
"RTN","SCRPW40",21,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW40",22,0)
 S SD("TYPE")=Y
"RTN","SCRPW40",23,0)
 K DIR S DIR(0)="N^1:99999:0",DIR("A")="Limit list to most frequent",DIR("B")=50,DIR("?")="Enter the quantity of the most frequent items to list."
"RTN","SCRPW40",24,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW40",25,0)
 S SD("FREQ")=Y
"RTN","SCRPW40",26,0)
 W ! N ZTSAVE S ZTSAVE("SDDIV")="",ZTSAVE("SDDIV(")="",ZTSAVE("SD(")="" D EN^XUTMDEVQ("START^SCRPW40","Outpatient Diagnosis/Procedure Frequency Report",.ZTSAVE) S SDOUT=1 G EXIT
"RTN","SCRPW40",27,0)
 ;
"RTN","SCRPW40",28,0)
START ;Print report
"RTN","SCRPW40",29,0)
 S (SDOUT,SDSTOP)=0 K ^TMP("SCRPW",$J) S SDI=$O(SDDIV("")),SDI=$O(SDDIV(SDI)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDI=1 S SDDIV("MULT")=SDI
"RTN","SCRPW40",30,0)
 S SDT=SD("BDT") F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!(SDT>SD("EDT"))!SDOUT  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I '$P(SDOE0,U,6),$P(SDOE0,U,2),$P(SDOE0,U,4),$$DIV() D EVAL
"RTN","SCRPW40",31,0)
 G:SDOUT EXIT S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D ORD
"RTN","SCRPW40",32,0)
 D STOP G:SDOUT EXIT D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDPAGE=1,SDLINE="",$P(SDLINE,"-",(IOM+1))="",SDFF=0
"RTN","SCRPW40",33,0)
 S Y=SD("BDT") X ^DD("DD") S SDPBDT=Y,Y=$P(SD("EDT"),".") X ^DD("DD") S SDPEDT=Y,SDT(1)="<*>  OUTPATIENT "_$S(SD("TYPE")="D":"DIAGNOSIS",SD("TYPE")="P":"PROCEDURE",1:"DIAGNOSIS/PROCEDURE")_" FREQUENCY REPORT  <*>"
"RTN","SCRPW40",34,0)
 S SDT(2)="For the "_SD("FREQ")_" most frequent "_$S(SD("TYPE")="D":"diagnoses",SD("TYPE")="P":"procedures",1:"diagnoses and procedures")
"RTN","SCRPW40",35,0)
 S SDIV="" F  S SDIV=$O(SDDIV(SDIV)) Q:'SDIV  S SDIV(SDDIV(SDIV))=SDIV
"RTN","SCRPW40",36,0)
 I 'SDDIV,$P(SDDIV,U,2)'="ALL DIVISIONS" S SDIV($P(SDDIV,U,2))=$$PRIM^VASITE()
"RTN","SCRPW40",37,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:$L(SDX) SDIV(SDX)=SDI
"RTN","SCRPW40",38,0)
 D:$E(IOST)="C" DISP0^SCRPW23 I '$O(^TMP("SCRPW",$J,0)) S SDIV=0 D DHDR(2,.SDT) D HDR Q:SDOUT  S SDX="No activity found within selected report parameters!" W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW40",39,0)
 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW40",40,0)
 S SDI=0,SDI=$O(^TMP("SCRPW",$J,SDI)),SDDIV("MULT")=$O(^TMP("SCRPW",$J,SDI))
"RTN","SCRPW40",41,0)
 G:SDOUT EXIT I SDDIV("MULT") S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW40",42,0)
 ;
"RTN","SCRPW40",43,0)
EXIT I $E(IOST)="C",'$G(SDOUT) N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW40",44,0)
 K %,%DT,C,DIR,DIVN,DTOUT,DUOUT,SD,SDCT,SDDIV,SDDX,SDDX0,SDDXC,SDDXN,SDFF,SDI,SDII,SDIV,SDIVN,SDLINE,SDLIST,SDOE,SDOE0
"RTN","SCRPW40",45,0)
 K SDX,SDORD,SDOUT,SDPAGE,SDPBDT,SDPEDT,SDPNOW,SDPR,SDPR0,SDPRC,SDPRN,SDPROC,SDPS,SDQT,SDSTOP,SDT,SDTOT,X,Y D END^SCRPW50 Q
"RTN","SCRPW40",46,0)
 ;
"RTN","SCRPW40",47,0)
DIV() ;Check division
"RTN","SCRPW40",48,0)
 Q:'SDDIV 1  Q $D(SDDIV(+$P(SDOE0,U,11)))
"RTN","SCRPW40",49,0)
 ;
"RTN","SCRPW40",50,0)
STOP ;Check for stop task request
"RTN","SCRPW40",51,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW40",52,0)
 ;
"RTN","SCRPW40",53,0)
EVAL ;Evaluate encounter
"RTN","SCRPW40",54,0)
 S SDSTOP=SDSTOP+1 D:SDSTOP#3000=0 STOP Q:SDOUT
"RTN","SCRPW40",55,0)
 S SDIV=+$P(SDOE0,U,11) D:"DB"[SD("TYPE") DX D:"PB"[SD("TYPE") PROC Q
"RTN","SCRPW40",56,0)
 ;
"RTN","SCRPW40",57,0)
DX ;Get diagnoses
"RTN","SCRPW40",58,0)
 N SDLIST,SDI D GETDX^SDOE(SDOE,"SDLIST")
"RTN","SCRPW40",59,0)
 S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D DX1(SDIV) D:SDDIV("MULT") DX1(0)
"RTN","SCRPW40",60,0)
 Q
"RTN","SCRPW40",61,0)
 ;
"RTN","SCRPW40",62,0)
DX1(SDIV) S SDDX=+SDLIST(SDI),SDPS=$S($P(SDLIST(SDI),U,12)="P":"PRI",1:"SEC")
"RTN","SCRPW40",63,0)
 F SDPS=SDPS,"QTY" S ^TMP("SCRPW",$J,SDIV,"DX",1,SDDX,SDPS)=$G(^TMP("SCRPW",$J,SDIV,"DX",1,SDDX,SDPS))+1
"RTN","SCRPW40",64,0)
 Q
"RTN","SCRPW40",65,0)
 ;
"RTN","SCRPW40",66,0)
PROC ;Get procedures
"RTN","SCRPW40",67,0)
 N SDLIST,SDI D GETCPT^SDOE(SDOE,"SDLIST")
"RTN","SCRPW40",68,0)
 S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D PROC1(SDIV) D:SDDIV("MULT") PROC1(0)
"RTN","SCRPW40",69,0)
 Q
"RTN","SCRPW40",70,0)
 ;
"RTN","SCRPW40",71,0)
PROC1(SDIV) S SDPROC=+SDLIST(SDI),SDQT=$P(SDLIST(SDI),U,16) S:'SDQT SDQT=1
"RTN","SCRPW40",72,0)
 S ^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,"ENC")=$G(^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,"ENC"))+1
"RTN","SCRPW40",73,0)
 S ^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,"QTY")=$G(^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,"QTY"))+SDQT
"RTN","SCRPW40",74,0)
 ;
"RTN","SCRPW40",75,0)
 ;set encounter and modifier quantity
"RTN","SCRPW40",76,0)
 N SDMOD,SDMODN
"RTN","SCRPW40",77,0)
 S SDMODN=0
"RTN","SCRPW40",78,0)
 F  S SDMODN=$O(SDLIST(SDI,1,SDMODN)) Q:SDMODN=""  D
"RTN","SCRPW40",79,0)
 . S SDMOD=$G(SDLIST(SDI,1,SDMODN,0))
"RTN","SCRPW40",80,0)
 . Q:SDMOD=""
"RTN","SCRPW40",81,0)
 . S ^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,SDMOD,"ENC")=+1
"RTN","SCRPW40",82,0)
 . S ^TMP("SCRPW",$J,SDIV,"PROC",1,SDPROC,SDMOD,"QTY")=+SDQT
"RTN","SCRPW40",83,0)
 . Q
"RTN","SCRPW40",84,0)
 Q
"RTN","SCRPW40",85,0)
 ;
"RTN","SCRPW40",86,0)
ORD ;Determine list order
"RTN","SCRPW40",87,0)
 S SDI="" F  S SDI=$O(^TMP("SCRPW",$J,SDIV,SDI)) Q:SDI=""  S SDII=0 F  S SDII=$O(^TMP("SCRPW",$J,SDIV,SDI,1,SDII)) Q:'SDII  S ^TMP("SCRPW",$J,SDIV,SDI,2,$$ORDV(),SDII)=""
"RTN","SCRPW40",88,0)
 Q
"RTN","SCRPW40",89,0)
 ;
"RTN","SCRPW40",90,0)
ORDV() Q ^TMP("SCRPW",$J,SDIV,SDI,1,SDII,"QTY")
"RTN","SCRPW40",91,0)
 ;
"RTN","SCRPW40",92,0)
DPRT(SDIV) ;Print report for a division
"RTN","SCRPW40",93,0)
 ;Required input: SDIV=division ifn (or '0' for summary)
"RTN","SCRPW40",94,0)
 S C=(IOM-80\2) D DHDR(3,.SDT) I '$D(^TMP("SCRPW",$J,SDIV)) S SDPAGE=1 D HDR Q:SDOUT  S SDX="No activity found for this date range!" W !!?(IOM-$L(SDX)\2),SDX Q
"RTN","SCRPW40",95,0)
 I $D(^TMP("SCRPW",$J,SDIV,"DX")) D DXPRT Q:SDOUT
"RTN","SCRPW40",96,0)
 I $D(^TMP("SCRPW",$J,SDIV,"PROC")) D PRPRT
"RTN","SCRPW40",97,0)
 Q
"RTN","SCRPW40",98,0)
 ;
"RTN","SCRPW40",99,0)
DXPRT ;Print diagnosis list
"RTN","SCRPW40",100,0)
 N SDTOT S SDPAGE=1 D HDR Q:SDOUT  D DXHD S (SDCT,SDORD)="" F  S SDORD=$O(^TMP("SCRPW",$J,SDIV,"DX",2,SDORD),-1) Q:SDORD=""!SDOUT!(SDCT>(SD("FREQ")-1))  D DXP1
"RTN","SCRPW40",101,0)
 Q:SDOUT  D:$Y>(IOSL-4) HDR,DXHD Q:SDOUT
"RTN","SCRPW40",102,0)
 W !?(C),$E(SDLINE,1,7),?(C+9),$E(SDLINE,1,35),?(C+46),$E(SDLINE,1,10),?(C+58),$E(SDLINE,1,10),?(C+70),$E(SDLINE,1,10)
"RTN","SCRPW40",103,0)
 W !?(C),"TOTAL:",?(C+46),$J(SDTOT("PRI"),9,0),?(C+58),$J(SDTOT("SEC"),9,0),?(C+70),$J(SDTOT("QTY"),9,0)
"RTN","SCRPW40",104,0)
 Q
"RTN","SCRPW40",105,0)
 ;
"RTN","SCRPW40",106,0)
DXP1 S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDIV,"DX",2,SDORD,SDI)) Q:'SDI!SDOUT!(SDCT>(SD("FREQ")-1))  S SDDX0=$$ICDDX^SCRPWICD(SDI) I $L(SDDX0) S SDDXC=$P(SDDX0,U,2),SDDXN=$P(SDDX0,U,4) D DXP2
"RTN","SCRPW40",107,0)
 Q
"RTN","SCRPW40",108,0)
 ;
"RTN","SCRPW40",109,0)
DXP2 N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C35|"
"RTN","SCRPW40",110,0)
 F SDII="PRI","SEC","QTY" S SDDX(SDII)=+$G(^TMP("SCRPW",$J,SDIV,"DX",1,SDI,SDII))
"RTN","SCRPW40",111,0)
 D:$Y>(IOSL-4) HDR,DXHD Q:SDOUT  S SDCT=SDCT+1
"RTN","SCRPW40",112,0)
 K ^UTILITY($J,"W") S X=SDDXN D ^DIWP
"RTN","SCRPW40",113,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) D
"RTN","SCRPW40",114,0)
 . I SDL2=1 W !?(C),SDDXC,?(C+9),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,35) I 1
"RTN","SCRPW40",115,0)
 . E  W !,?(C+9),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,35)
"RTN","SCRPW40",116,0)
 W ?(C+46),$J(SDDX("PRI"),9,0),?(C+58),$J(SDDX("SEC"),9,0),?(C+70),$J(SDDX("QTY"),9,0)
"RTN","SCRPW40",117,0)
 F SDII="PRI","SEC","QTY" S SDTOT(SDII)=$G(SDTOT(SDII))+SDDX(SDII)
"RTN","SCRPW40",118,0)
 Q
"RTN","SCRPW40",119,0)
 ;
"RTN","SCRPW40",120,0)
PRPRT N SDTOT S C=(IOM-62\2),SDPAGE=1 D HDR Q:SDOUT  D PRHD S (SDCT,SDORD)="" F  S SDORD=$O(^TMP("SCRPW",$J,SDIV,"PROC",2,SDORD),-1) Q:SDORD=""!SDOUT!(SDCT>(SD("FREQ")-1))  D PRP1
"RTN","SCRPW40",121,0)
 Q:SDOUT  D:$Y>(IOSL-4) HDR,PRHD Q:SDOUT
"RTN","SCRPW40",122,0)
 W !?(C),$E(SDLINE,1,6),?(C+8),$E(SDLINE,1,28),?(C+38),$E(SDLINE,1,10),?(C+50),$E(SDLINE,1,10),!?(C),"PROCEDURE TOTAL:",?(C+38),$J(SDTOT("ENC"),9,0),?(C+50),$J(SDTOT("QTY"),9,0)
"RTN","SCRPW40",123,0)
 Q
"RTN","SCRPW40",124,0)
 ;
"RTN","SCRPW40",125,0)
PRP1 ;S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDIV,"PROC",2,SDORD,SDI)) Q:'SDI!SDOUT!(SDCT>(SD("FREQ")-1))  S SDPR0=$G(^ICPT(SDI,0)) I $L(SDPR0) S SDPRC=$P(SDPR0,U),SDPRN=$P(SDPR0,U,2) D PRP2
"RTN","SCRPW40",126,0)
 N CPTINFO
"RTN","SCRPW40",127,0)
 S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDIV,"PROC",2,SDORD,SDI)) Q:'SDI!SDOUT!(SDCT>(SD("FREQ")-1))  D 
"RTN","SCRPW40",128,0)
 . S CPTINFO=$$CPT^ICPTCOD(SDI,,1)
"RTN","SCRPW40",129,0)
 . Q:CPTINFO'>0
"RTN","SCRPW40",130,0)
 . S SDPRC=$P(CPTINFO,U,2)
"RTN","SCRPW40",131,0)
 . S SDPRN=$P(CPTINFO,U,3)
"RTN","SCRPW40",132,0)
 . D PRP2
"RTN","SCRPW40",133,0)
 . Q
"RTN","SCRPW40",134,0)
 Q
"RTN","SCRPW40",135,0)
 ;
"RTN","SCRPW40",136,0)
PRP2 F SDII="ENC","QTY" S SDPR(SDII)=+$G(^TMP("SCRPW",$J,SDIV,"PROC",1,SDI,SDII))
"RTN","SCRPW40",137,0)
 D:$Y>(IOSL-4) HDR,PRHD Q:SDOUT  S SDCT=SDCT+1
"RTN","SCRPW40",138,0)
 ; skip a line in the report if printing next cpt code on same page
"RTN","SCRPW40",139,0)
 I LINEFLAG W !
"RTN","SCRPW40",140,0)
 W !?(C),SDPRC,?(C+8),SDPRN,?(C+38),$J(SDPR("ENC"),9,0),?(C+50),$J(SDPR("QTY"),9,0)
"RTN","SCRPW40",141,0)
 S LINEFLAG=1
"RTN","SCRPW40",142,0)
 F SDII="ENC","QTY" S SDTOT(SDII)=$G(SDTOT(SDII))+SDPR(SDII)
"RTN","SCRPW40",143,0)
 ;
"RTN","SCRPW40",144,0)
 ;rank and print the modifiers
"RTN","SCRPW40",145,0)
 D START^SCRPW401($NA(^TMP("SCRPW",$J,SDIV,"PROC",1,SDI)))
"RTN","SCRPW40",146,0)
 Q
"RTN","SCRPW40",147,0)
 ;
"RTN","SCRPW40",148,0)
PRHD ;Print procedure subheader
"RTN","SCRPW40",149,0)
 S LINEFLAG=0 Q:SDOUT  W !!?(C),"CODE",!?(C),"NUMBER",?(C+8),"PROCEDURE/MODIFIER",?(C+38),"ENCOUNTERS",?(C+52),"QUANTITY",!?(C),$E(SDLINE,1,6),?(C+8),$E(SDLINE,1,28),?(C+38),$E(SDLINE,1,10),?(C+50),$E(SDLINE,1,10)
"RTN","SCRPW40",150,0)
 Q
"RTN","SCRPW40",151,0)
 ;
"RTN","SCRPW40",152,0)
DXHD ;Print diagnosis subheader
"RTN","SCRPW40",153,0)
 Q:SDOUT  W !!?(C),"CODE",?(C+49),"PRIMARY",?(C+59),"SECONDARY",?(C+75),"TOTAL",!?(C),"NUMBER",?(C+9),"DIAGNOSIS",?(C+47),"DIAGNOSIS",?(C+59),"DIAGNOSIS",?(C+71),"FREQUENCY"
"RTN","SCRPW40",154,0)
 W !?(C),$E(SDLINE,1,7),?(C+9),$E(SDLINE,1,35),?(C+46),$E(SDLINE,1,10),?(C+58),$E(SDLINE,1,10),?(C+70),$E(SDLINE,1,10) Q
"RTN","SCRPW40",155,0)
 ;
"RTN","SCRPW40",156,0)
HDR ;Print report header
"RTN","SCRPW40",157,0)
 I $E(IOST)="C",SDFF N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW40",158,0)
 D STOP Q:SDOUT
"RTN","SCRPW40",159,0)
 I SDFF!($E(IOST)="C") W $$XY^SCRPW50(IOF,1,0)
"RTN","SCRPW40",160,0)
 I $X W $$XY^SCRPW50("",0,0)
"RTN","SCRPW40",161,0)
 N SDI W SDLINE S SDI=0 F  S SDI=$O(SDT(SDI)) Q:'SDI  W !?(IOM-$L(SDT(SDI))\2),SDT(SDI)
"RTN","SCRPW40",162,0)
 W !,SDLINE,!,"For date range: ",SDPBDT," to ",SDPEDT,!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDFF=1 Q
"RTN","SCRPW40",163,0)
 ;
"RTN","SCRPW40",164,0)
DHDR(SDI,SDT) ;Set up division subheaders
"RTN","SCRPW40",165,0)
 ;Required input: SDI=array number to start with
"RTN","SCRPW40",166,0)
 ;Required input: SDT=array to store subheaders in (pass by reference)
"RTN","SCRPW40",167,0)
 S SDT(SDI)=$S('SDIV:"Summary for "_$P(SDDIV,U,2),SDDIV!($P(SDDIV,U,2)="ALL DIVISIONS"):"For division: "_SDIVN,1:"For facility: "_SDIVN)
"RTN","SCRPW40",168,0)
 I 'SDIV,$P(SDDIV,U,2)="SELECTED DIVISIONS" N SDIVN S SDIVN="" D  Q
"RTN","SCRPW40",169,0)
 .F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDT(SDI)="Division: "_SDIVN
"RTN","SCRPW40",170,0)
 .Q
"RTN","SCRPW40",171,0)
 I 'SDIV,$P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW40",172,0)
 .N SDIV S SDIV=0 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:'SDIV  S SDI=SDI+1,SDT(SDI)="Division: "_$P($G(^DG(40.8,SDIV,0)),U)
"RTN","SCRPW40",173,0)
 .Q
"RTN","SCRPW40",174,0)
 Q
"RTN","SCRPW45")
0^10^B59142095^B55025168
"RTN","SCRPW45",1,0)
SCRPW45 ;RENO/KEITH - Outpatient Diagnosis/Procedure Search ;15 Jul 98  02:38PM
"RTN","SCRPW45",2,0)
 ;;5.3;Scheduling;**144,351,409,593**;AUG 13, 1993;Build 13
"RTN","SCRPW45",3,0)
 N SD,SDDIV,SDPAR,SDCRI,DIR,%DT
"RTN","SCRPW45",4,0)
 D TITL^SCRPW50("Outpatient Diagnosis/Procedure Search ")
"RTN","SCRPW45",5,0)
 G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW45",6,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW45",7,0)
 S Y=$$IMP^SCRPWICD(30) S SD("I10DTI")=Y X ^DD("DD") S SD("I10DTE")=Y
"RTN","SCRPW45",8,0)
BDT W ! S %DT="AEPX",%DT(0)=2961001,%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT S SD("BDT")=Y X ^DD("DD") S SD("PBDT")=Y
"RTN","SCRPW45",9,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT
"RTN","SCRPW45",10,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","SCRPW45",11,0)
 ;S SD("EDT")=Y_.999999 X ^DD("DD") S SD("PEDT")=Y,(SDOUT,SDNUL)=0 F SDI=1:1:26 D PAR Q:SDOUT!SDNUL
"RTN","SCRPW45",12,0)
 S SD("EDT")=Y_.999999 X ^DD("DD") S SD("PEDT")=Y
"RTN","SCRPW45",13,0)
 I (SD("BDT")<SD("I10DTI")),(SD("EDT")'<SD("I10DTI")) D  G BDT
"RTN","SCRPW45",14,0)
 . W !!,$C(7),"Beginning and Ending dates must both be prior to "_SD("I10DTE")_" (ICD-9) or both be on or after "_SD("I10DTE")_" (ICD-10)."
"RTN","SCRPW45",15,0)
 S (SDOUT,SDNUL)=0 F SDI=1:1:26 D PAR Q:SDOUT!SDNUL
"RTN","SCRPW45",16,0)
 G:SDOUT!'$D(SDPAR) EXIT S SDNUL=0 F  D CRI Q:SDOUT!SDNUL
"RTN","SCRPW45",17,0)
 G:SDOUT!'$D(SDCRI) EXIT
"RTN","SCRPW45",18,0)
 D SUBT^SCRPW50("**** Report Detail Format Selection ****")
"RTN","SCRPW45",19,0)
 K DIR S DIR(0)="S^P:PATIENT;V:VISIT;E:ENCOUNTER",DIR("A")="Specify the level of detail desired",DIR("B")="PATIENT",DIR("?")="This determines what type of detail list will be printed."
"RTN","SCRPW45",20,0)
 W ! D ^DIR G:$D(DUOUT)!$D(DTOUT) EXIT S SDFMT=Y_U_Y(0),SDD=$S(Y="E":1,1:2)
"RTN","SCRPW45",21,0)
 K DIR S DIR(0)="Y",DIR("A")="Include additional print fields in the report",DIR("B")="NO" W ! D ^DIR G:$D(DUOUT)!$D(DTOUT) EXIT
"RTN","SCRPW45",22,0)
 I Y D BLD^SCRPW21 S (SDOUT,SDNUL)=0,T="~" F  Q:SDOUT!SDNUL  D APF
"RTN","SCRPW45",23,0)
 G:SDOUT EXIT D PDIS^SCRPW46 G:SDOUT EXIT
"RTN","SCRPW45",24,0)
QUE N ZTSAVE F SDI="SDFMT","SDAPF(","SD(","SDDIV(","SDDIV","SDPAR(","SDCRI(" S ZTSAVE(SDI)=""
"RTN","SCRPW45",25,0)
 W ! D EN^XUTMDEVQ("START^SCRPW46","Outpatient Diagnosis/Procedure Search",.ZTSAVE)
"RTN","SCRPW45",26,0)
EXIT G EXIT^SCRPW47
"RTN","SCRPW45",27,0)
 ;
"RTN","SCRPW45",28,0)
PAR ;Select report search criteria
"RTN","SCRPW45",29,0)
 S SDVAR=$C(SDI+64)
"RTN","SCRPW45",30,0)
 D SUBT^SCRPW50("**** Report Search Criteria Selection (Element '"_SDVAR_"') ****")
"RTN","SCRPW45",31,0)
 K DIR S DIR(0)="SO^DL:DIAGNOSIS LIST;DR:DIAGNOSIS RANGE;PL:PROCEDURE LIST;PR:PROCEDURE RANGE",DIR("A")="Specify criteria type for search element '"_SDVAR_"'"
"RTN","SCRPW45",32,0)
 S DIR("?")="Select the type of data to search for with element '"_SDVAR_"'." W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW45",33,0)
 I X="" S SDNUL=1 Q
"RTN","SCRPW45",34,0)
 S SDSEL=Y,SDSEL(0)=Y(0) N DIC S DIC(0)="AEMQZ",DIC=$S(SDSEL["D":"^ICD9(",1:"^ICPT(")
"RTN","SCRPW45",35,0)
 S:DIC="^ICD9(" DIC("S")="I $$CSI^SCRPWICD(80,Y)="_$S(SD("BDT")<SD("I10DTI"):1,1:30)
"RTN","SCRPW45",36,0)
 D:SDSEL["L" LIST D:SDSEL["R" RANGE S SDNUL=0
"RTN","SCRPW45",37,0)
 G:'$D(SDPAR(SDVAR)) PAR S SDPAR(SDVAR)=SDSEL_U_SDSEL(0),SD("LIST",$E(SDSEL),$E(SDSEL,2))=""
"RTN","SCRPW45",38,0)
 Q
"RTN","SCRPW45",39,0)
 ;
"RTN","SCRPW45",40,0)
LIST W ! F  D  Q:SDNUL!SDOUT
"RTN","SCRPW45",41,0)
 .D ^DIC I $D(DUOUT)!$D(DTOUT) S SDOUT=1 Q
"RTN","SCRPW45",42,0)
 .I X="" S SDNUL=1 Q
"RTN","SCRPW45",43,0)
 .I Y>0 D
"RTN","SCRPW45",44,0)
 ..S Y(0)=$S(SDSEL["D":$P($$ICDDX^SCRPWICD(+Y),"^",2,99),1:$P($$CPT^ICPTCOD(+Y,,1),"^",2,99))
"RTN","SCRPW45",45,0)
 ..S SDPAR(SDVAR,$P(Y,U))=$P(Y(0),U)_" "_$P(Y(0),U,$S(SDSEL["D":3,1:2))
"RTN","SCRPW45",46,0)
 Q
"RTN","SCRPW45",47,0)
 ;
"RTN","SCRPW45",48,0)
RANGE W ! S DIC("A")="From "_$S(SDSEL["D":"ICD DIAGNOSIS: ",1:"CPT CODE: ")
"RTN","SCRPW45",49,0)
 D ^DIC I $D(DUOUT)!$D(DTOUT) S SDOUT=1 Q
"RTN","SCRPW45",50,0)
 I X="" S SDNUL=1 Q
"RTN","SCRPW45",51,0)
 Q:Y<1
"RTN","SCRPW45",52,0)
 S Y(0)=$S(SDSEL["D":$P($$ICDDX^SCRPWICD(+Y),"^",2,99),1:$P($$CPT^ICPTCOD(+Y,,1),"^",2,99))
"RTN","SCRPW45",53,0)
 S S1=$P(Y(0),U)_" "_$P(Y(0),U,$S(SDSEL["D":3,1:2)),SDPAR(SDVAR,S1)=$P(Y,U),DIC("A")="To "_$P(DIC("A")," ",2,99)
"RTN","SCRPW45",54,0)
R2 W ! D ^DIC I $D(DUOUT)!$D(DTOUT) S SDOUT=1 Q
"RTN","SCRPW45",55,0)
 I X=""!(Y<1) S SDNUL=1 K SDPAR(SDVAR) Q
"RTN","SCRPW45",56,0)
 S Y(0)=$S(SDSEL["D":$P($$ICDDX^SCRPWICD(+Y),"^",2,99),1:$P($$CPT^ICPTCOD(+Y,,1),"^",2,99))
"RTN","SCRPW45",57,0)
 S S2=$P(Y(0),U)_" "_$P(Y(0),U,$S(SDSEL["D":3,1:2))
"RTN","SCRPW45",58,0)
 I S1]S2 W !!,$C(7),"Ending value must collate after beginning value!",! G R2
"RTN","SCRPW45",59,0)
 S SDPAR(SDVAR,S2)=$P(Y,U) Q
"RTN","SCRPW45",60,0)
 ;
"RTN","SCRPW45",61,0)
CRI ;Prompt for element combination criteria
"RTN","SCRPW45",62,0)
 D SUBT^SCRPW50("**** Search Element Combination Criteria ****")
"RTN","SCRPW45",63,0)
 W !!,"  Specify letter combinations that represent how the search elements selected",!,"  above will be applied in evaluating patient activity (eg. ""ABC"" or ""ABC'D""):"
"RTN","SCRPW45",64,0)
 F SDII=1:1 D CRI1 Q:SDOUT!SDNUL
"RTN","SCRPW45",65,0)
 Q
"RTN","SCRPW45",66,0)
 ;
"RTN","SCRPW45",67,0)
CRI1 K DIR S DIR(0)="F"_$S(SDII=1:"",1:"O")_"^1:40",DIR("A")=$S(SDII=1:"IF",1:"OR")
"RTN","SCRPW45",68,0)
 S DIR("?",1)="Enter a string that represents the method which represents how the selected",DIR("?",2)="search criteria items will be applied during evaluation (eg. ""AB"" indicates"
"RTN","SCRPW45",69,0)
 S DIR("?",3)="that element 'A' and 'B' must be true for data to be returned.  The apostrophy",DIR("?",4)="""'"" may be used to negate (or exclude) a sort item.  For example, ""A'B"""
"RTN","SCRPW45",70,0)
 S DIR("?")="will return data where element 'A' is true and element 'B' is not true."
"RTN","SCRPW45",71,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW45",72,0)
 I X="" S SDNUL=1 Q
"RTN","SCRPW45",73,0)
 I $E(X)="&" W $C(7),"  ?? Invalid!" G CRI1
"RTN","SCRPW45",74,0)
 F  S SDC=$E(Y,$L(Y)) Q:SDC'="'"  S Y=$E(Y,1,($L(Y)-1))
"RTN","SCRPW45",75,0)
 I '$L(Y)!$TR($TR(Y,"'",""),"&","")="" W $C(7),"No criteria selected!" G CRI1
"RTN","SCRPW45",76,0)
 I Y["'&" W $C(7),"  ??  The value ""'&"" is incorrect syntax!" G CRI1
"RTN","SCRPW45",77,0)
 I Y["''" W $C(7),"  ??  Character ""'"" appears redundantly!" G CRI1
"RTN","SCRPW45",78,0)
 I Y["&&" W $C(7),"  ??  Character ""&"" appears redundantly!" G CRI1
"RTN","SCRPW45",79,0)
 I Y="" W $C(7),"No criteria selected!" G CRI1
"RTN","SCRPW45",80,0)
 S SDBAD=0,SDSTR="",SDRESP=Y,SDR=$TR(Y,"&","") F SDIII=1:1:$L(SDR) S SDC=$E(SDR,SDIII) D  Q:SDBAD
"RTN","SCRPW45",81,0)
 .I "&'"'[SDC,$L(SDR,SDC)>2 W $C(7),"  ??  Element '"_SDC_"' appears redundantly!" S SDBAD=1 Q
"RTN","SCRPW45",82,0)
 .I SDC'="'",'$D(SDPAR(SDC)) W $C(7),"  ??  Character '"_SDC_"' is not recognized!" S SDBAD=1 Q
"RTN","SCRPW45",83,0)
 .S SDSTR=SDSTR_SDC_$S(SDC'="'":"&",1:"")
"RTN","SCRPW45",84,0)
 .Q
"RTN","SCRPW45",85,0)
 G:SDBAD CRI1
"RTN","SCRPW45",86,0)
 S SDSTR=$E(SDSTR,1,($L(SDSTR)-1)) D STR(SDSTR,.SDTX) M SDCRI(SDSTR)=SDTX W "  ",$S(SDII=1:"If ",1:"Or "),SDTX(1) S SDIII=1 F  S SDIII=$O(SDTX(SDIII)) Q:'SDIII  W !?4,SDTX(SDIII)
"RTN","SCRPW45",87,0)
 Q
"RTN","SCRPW45",88,0)
 ;
"RTN","SCRPW45",89,0)
STR(SDSTR,SDTX) ;Convert combine logic into output text string
"RTN","SCRPW45",90,0)
 ;Required input: SDSTR=combine logic string
"RTN","SCRPW45",91,0)
 ;Required input: SDTX=array (pass by reference) to return text
"RTN","SCRPW45",92,0)
 N SDI,SDEXE,SDX
"RTN","SCRPW45",93,0)
 F SDI=1:1:$L(SDSTR) S SDX(SDI)=$$STR1($E(SDSTR,SDI))
"RTN","SCRPW45",94,0)
 S SDOXE(2)="S SDLTH=75",SDLTH=71-$L(SDSTR) D WRAP(.SDX,.SDTX,,.SDOXE,SDLTH,"")
"RTN","SCRPW45",95,0)
 Q
"RTN","SCRPW45",96,0)
 ;
"RTN","SCRPW45",97,0)
STR1(SDX) ;Convert to text (cont.)
"RTN","SCRPW45",98,0)
 ;Required input: SDX=character to transform
"RTN","SCRPW45",99,0)
 Q:SDX="&" "and "  Q:SDX="'" "not "
"RTN","SCRPW45",100,0)
 Q $P(SDPAR(SDX),U,2)_" '"_SDX_"' "
"RTN","SCRPW45",101,0)
 ;
"RTN","SCRPW45",102,0)
APF ;Select additional print fields
"RTN","SCRPW45",103,0)
 D SUBT^SCRPW50("Select additional print fields for patient detail:  (optional)")
"RTN","SCRPW45",104,0)
 K DIR S DIR("A")="Specify additional print field",DIR("?")="These fields will be included in the patient detail list output."
"RTN","SCRPW45",105,0)
 S S1=$$DIR^SCRPW23(.DIR,1,"","","O",SDD) Q:SDOUT!SDNUL
"RTN","SCRPW45",106,0)
 K DIR S DIR("A")="Select "_$P(S1,U,2)_" category",S2=$$DIR^SCRPW23(.DIR,2,"",$P(S1,U),"O",SDD,1) Q:SDOUT  I SDNUL S SDNUL=0 Q
"RTN","SCRPW45",107,0)
 S SDSEL=$P(S1,U)_$P(S2,U) G:$D(SDAPF("PFX",SDSEL)) PFD
"RTN","SCRPW45",108,0)
 S SDS1=$P(^TMP("SCRPW",$J,"ACT",SDSEL),T,11),SDS2=$O(SDAPF(SDS1,""),-1)+1,SDAPF(SDS1,SDS2)=SDSEL_U_$P(S1,U,2)_U_$P(S2,U,2),SDAPF("PFX",SDSEL,SDS1,SDS2)=""
"RTN","SCRPW45",109,0)
 Q
"RTN","SCRPW45",110,0)
 ;
"RTN","SCRPW45",111,0)
PFD N DIR S DIR(0)="Y",DIR("A")="This item is already selected as a print field, do you want to delete it",DIR("B")="NO" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SCRPW45",112,0)
 I Y S S1=$O(SDAPF("PFX",SDSEL,"")),S2=$O(SDAPF("PFX",SDSEL,S1,"")) K SDAPF("SDX",SDSEL),SDAPF("PF",S1,S2) W !,"deleted..."
"RTN","SCRPW45",113,0)
 Q
"RTN","SCRPW45",114,0)
 ;
"RTN","SCRPW45",115,0)
WRAP(SDITX,SDOTX,SDIXE,SDOXE,SDLTH,SDUJC) ;Text wrapper
"RTN","SCRPW45",116,0)
 ;Required input: SDITX=array (passed by reference) of text to be reformatted
"RTN","SCRPW45",117,0)
 ;Required input: SDOTX=array (passed by reference) to return reformatted text
"RTN","SCRPW45",118,0)
 ;Optional input: SDIXE=array (passed by reference) where SDIXE(n) is code to be executed prior to processing node SDITX(n)
"RTN","SCRPW45",119,0)
 ;Optional input: SDOXE=array (passed by reference) where SDOXE(n) is code to be executed prior to creating node SDOTX(n)
"RTN","SCRPW45",120,0)
 ;Optional input: SDLTH=line length, if not defined, SDLTH=IOM
"RTN","SCRPW45",121,0)
 ;Optional input: SDUJC=value (0-5 characters) to be inserted when values are joined, if undefined AQKUJC=" "
"RTN","SCRPW45",122,0)
 ;Output: Reformats values found in SDITX() array into wraparound text in SDOTX() of SDLTH length (10-255) characters
"RTN","SCRPW45",123,0)
 ;
"RTN","SCRPW45",124,0)
 N SDUI,SDUII,X,X1,X2,X3,X4,Y,Y1,Y2,SDLAST,SDUIII,SDUIV,SDTXB
"RTN","SCRPW45",125,0)
 Q:$D(SDITX)'>1  S:'$D(SDUJC) SDUJC=" " S:$G(SDLTH)<10!($G(SDLTH)>255) SDLTH=IOM K SDOTX S SDUJC=$E(SDUJC,1,5),SDUI="",SDUII=1,SDOTX(1)="",SDLAST=$O(SDITX(""),-1) D POX
"RTN","SCRPW45",126,0)
 F  S SDUI=$O(SDITX(SDUI)) Q:SDUI']""  I $L(SDITX(SDUI)) D PIX S X=SDITX(SDUI)_$S(SDUI'=SDLAST:SDUJC,1:"") D MOVE
"RTN","SCRPW45",127,0)
 Q
"RTN","SCRPW45",128,0)
 ;
"RTN","SCRPW45",129,0)
PIX I $D(SDIXE(SDUI)) X SDIXE(SDUI)
"RTN","SCRPW45",130,0)
 Q
"RTN","SCRPW45",131,0)
 ;
"RTN","SCRPW45",132,0)
POX I $D(SDOXE(SDUII)) X SDOXE(SDUII)
"RTN","SCRPW45",133,0)
 Q
"RTN","SCRPW45",134,0)
MOVE S X1=$L(X) Q:'X1  S X2=$L(X," "),Y=SDOTX(SDUII),Y1=$L(Y),Y2=SDLTH-Y1 I 'Y2 D INCR G MOVE
"RTN","SCRPW45",135,0)
 I X1'>Y2 S SDOTX(SDUII)=SDOTX(SDUII)_X Q
"RTN","SCRPW45",136,0)
MOVE1 I X'[" ",X1'>SDLTH D:Y1 INCR S SDOTX(SDUII)=X Q
"RTN","SCRPW45",137,0)
MOVE2 I X'[" ",X1>SDLTH D:Y1 INCR S SDOTX(SDUII)=$E(X,1,SDLTH),X=$E(X,(SDLTH+1),999) G MOVE
"RTN","SCRPW45",138,0)
 S X3=$L($P(X," ")) I X3=Y2 S SDOTX(SDUII)=SDOTX(SDUII)_$P(X," "),X=$P(X," ",2,999) G MOVE
"RTN","SCRPW45",139,0)
 I X3>Y2,X3'>SDLTH D INCR G MOVE
"RTN","SCRPW45",140,0)
 I X3>SDLTH D:Y1 INCR S SDOTX(SDUII)=$E(X,1,SDLTH),X=$E(X,(SDLTH+1),999) G MOVE
"RTN","SCRPW45",141,0)
MOVE3 K SDTXB F SDUIII=1:1:X2 S X4=999-$L($P(X," ",1,SDUIII)),SDTXB(X4,SDUIII)=""
"RTN","SCRPW45",142,0)
 S SDUIII=$O(SDTXB(998-Y2)),SDUIV=$O(SDTXB(SDUIII,0)),SDOTX(SDUII)=SDOTX(SDUII)_$E(X,1,($L($P(X," ",1,SDUIV))+1)),X=$P(X," ",(SDUIV+1),999) G MOVE
"RTN","SCRPW45",143,0)
 Q
"RTN","SCRPW45",144,0)
 ;
"RTN","SCRPW45",145,0)
INCR S SDUII=SDUII+1,SDOTX(SDUII)="" D POX Q
"RTN","SCRPW46")
0^11^B82059518^B82053568
"RTN","SCRPW46",1,0)
SCRPW46 ;RENO/KEITH/MLR - Outpatient Diagnosis/Procedure Search (cont.) ;9/27/00 10:29am
"RTN","SCRPW46",2,0)
 ;;5.3;Scheduling;**144,180,199,295,324,351,593**;AUG 13, 1993;Build 13
"RTN","SCRPW46",3,0)
 ;  *199* 
"RTN","SCRPW46",4,0)
 ;  - Creation of Division subscript in ^TMP after DFN to capture,
"RTN","SCRPW46",5,0)
 ;    display, & count multi-divisional patients in Summary Section.
"RTN","SCRPW46",6,0)
 ;  - Filtering out on Sub-header those Division names not having
"RTN","SCRPW46",7,0)
 ;    patients meeting search criteria.
"RTN","SCRPW46",8,0)
 ;
"RTN","SCRPW46",9,0)
PDIS ;Parameter display
"RTN","SCRPW46",10,0)
 D SUBT^SCRPW50("**** Report Parameters Selected ****")
"RTN","SCRPW46",11,0)
 W ! D PD1^SCRPW47(0) S SDOUT=0
"RTN","SCRPW46",12,0)
 ;
"RTN","SCRPW46",13,0)
PDIS1 K DIR
"RTN","SCRPW46",14,0)
 S DIR(0)="S^C:CONTINUE;R:RE-DISPLAY PARAMETERS;P:PRINT PARAMETERS;Q:QUIT"
"RTN","SCRPW46",15,0)
 S DIR("A")="Select report action"
"RTN","SCRPW46",16,0)
 S DIR("B")="CONTINUE"
"RTN","SCRPW46",17,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW46",18,0)
 Q:Y="C"  G:Y="R" PDIS I Y="Q" S SDOUT=1 Q
"RTN","SCRPW46",19,0)
 N ZTSAVE
"RTN","SCRPW46",20,0)
 F SDI="SDDIV","SDDIV(","SD(","SDPAR(","SDCRI(","SDFMT","SDAPF(" S ZTSAVE(SDI)=""
"RTN","SCRPW46",21,0)
 W ! D EN^XUTMDEVQ("PPRT^SCRPW46","Print Report Parameters",.ZTSAVE)
"RTN","SCRPW46",22,0)
 G PDIS1
"RTN","SCRPW46",23,0)
 ;
"RTN","SCRPW46",24,0)
PPRT ;Print report parameters
"RTN","SCRPW46",25,0)
 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW46",26,0)
 S SDTIT(1)="<*>  OUTPATIENT DIAGNOSTIC/PROCEDURE CODE SEARCH  <*>"
"RTN","SCRPW46",27,0)
 S SDTIT(2)="Report Search Parameters" D HINI,HDR
"RTN","SCRPW46",28,0)
 D:'SDOUT PD1^SCRPW47(0) I $E(IOST)="P",$D(ZTQUEUED) G EXIT^SCRPW47
"RTN","SCRPW46",29,0)
 Q  ;PPRT
"RTN","SCRPW46",30,0)
 ;
"RTN","SCRPW46",31,0)
STOP ;Check for stop task request
"RTN","SCRPW46",32,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW46",33,0)
 ;
"RTN","SCRPW46",34,0)
HINI ;Initialize header variables
"RTN","SCRPW46",35,0)
 S SDLINE="",$P(SDLINE,"-",(IOM+1))=""
"RTN","SCRPW46",36,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDPAGE=1,SDFF=0 Q
"RTN","SCRPW46",37,0)
 ;
"RTN","SCRPW46",38,0)
HDR ;Print report header
"RTN","SCRPW46",39,0)
 I $E(IOST)="C",SDFF N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW46",40,0)
 D STOP Q:SDOUT
"RTN","SCRPW46",41,0)
 I SDFF!('SDFF&($E(IOST)="C")) W $$XY^SCRPW50(IOF,1,0)
"RTN","SCRPW46",42,0)
 I $X W $$XY^SCRPW50("",0,0)
"RTN","SCRPW46",43,0)
 N SDI W SDLINE S SDI=0
"RTN","SCRPW46",44,0)
 F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW46",45,0)
 W !,SDLINE,!,"For date range: ",SD("PBDT")," to ",SD("PEDT")
"RTN","SCRPW46",46,0)
 W !,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE
"RTN","SCRPW46",47,0)
 W !,SDLINE S SDPAGE=SDPAGE+1,SDFF=1
"RTN","SCRPW46",48,0)
 Q  ;HDR
"RTN","SCRPW46",49,0)
 ;
"RTN","SCRPW46",50,0)
DHDR(SDIV,SDI,SDTIT) ;Set up division subheaders
"RTN","SCRPW46",51,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW46",52,0)
 ;Required input: SDI=array number to start with
"RTN","SCRPW46",53,0)
 ;Required input: SDTIT=array to store subheaders in (pass by reference)
"RTN","SCRPW46",54,0)
 D  ;
"RTN","SCRPW46",55,0)
 . I 'SDIV S SDTIT(SDI)="Summary for "_$P(SDDIV,U,2) Q
"RTN","SCRPW46",56,0)
 . I SDDIV,($P(SDDIV,U,2)="ALL DIVISIONS") S SDTIT(SDI)="For division: "_SDIVN_" "_SDIVL(SDIVN) Q  ; SD*5.3*324
"RTN","SCRPW46",57,0)
 . S SDTIT(SDI)="For facility: "_SDIVN Q
"RTN","SCRPW46",58,0)
 ;S SDTIT(SDI)=$S('SDIV:"Summary for "_$P(SDDIV,U,2),SDDIV!($P(SDDIV,U,2)="ALL DIVISIONS"):"For division: "_SDIVN_" "_SDIVL(SDIVN),1:"For facility: "_SDIVN)
"RTN","SCRPW46",59,0)
 ;
"RTN","SCRPW46",60,0)
 I 'SDIV,$P(SDDIV,U,2)="SELECTED DIVISIONS" N SDIVN S SDIVN="" D  Q
"RTN","SCRPW46",61,0)
 .F  S SDIVN=$O(SDDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)="Division: "_SDDIV(SDIVN)
"RTN","SCRPW46",62,0)
 .Q
"RTN","SCRPW46",63,0)
 ;
"RTN","SCRPW46",64,0)
 I 'SDIV,$P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW46",65,0)
 .N SDIV S SDIV=0 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:'SDIV  D
"RTN","SCRPW46",66,0)
 .. Q:'$D(^TMP("SCRPW",$J,SDIV,2))
"RTN","SCRPW46",67,0)
 .. S SDI=SDI+1
"RTN","SCRPW46",68,0)
 .. S SDTIT(SDI)="Division: "_$P($G(^DG(40.8,SDIV,0)),U)_"  "_SDIV
"RTN","SCRPW46",69,0)
 .Q
"RTN","SCRPW46",70,0)
 Q
"RTN","SCRPW46",71,0)
 ;
"RTN","SCRPW46",72,0)
START ;Print report
"RTN","SCRPW46",73,0)
 K ^TMP("SCRPW",$J) S (SDOUT,SDSTOP)=0,SDMD="",SDMD=$O(SDDIV(SDMD)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW46",74,0)
 ;Iterate through list of patient encounters
"RTN","SCRPW46",75,0)
 S DFN=0 F  S DFN=$O(^SCE("ADFN",DFN)) Q:'DFN  K SDPDIV S SDSTOP=SDSTOP+1 D:SDSTOP#100=0 STOP Q:SDOUT  D
"RTN","SCRPW46",76,0)
 .S SDT=SD("BDT") F  S SDT=$O(^SCE("ADFN",DFN,SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  D
"RTN","SCRPW46",77,0)
 ..S SDOE=0 F  S SDOE=$O(^SCE("ADFN",DFN,SDT,SDOE)) Q:'SDOE!SDOUT  D
"RTN","SCRPW46",78,0)
 ...S SDOE0=$$GETOE^SDOE(SDOE) S SDIV=$P(SDOE0,"^",11) Q:'SDIV!$P(SDOE0,"^",6)!'$$DIV()  S SDPDIV(SDIV)=""
"RTN","SCRPW46",79,0)
 ...;Build initial patient diagnosis/procedure lists
"RTN","SCRPW46",80,0)
 ...I $D(SD("LIST","D")) K SDLIST D GETDX^SDOE(SDOE,"SDLIST") S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D
"RTN","SCRPW46",81,0)
 ....S SDDX=$P(SDLIST(SDI),"^") S:SDDX ^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDDX)=""
"RTN","SCRPW46",82,0)
 ....Q
"RTN","SCRPW46",83,0)
 ...I $D(SD("LIST","P")) K SDLIST D GETCPT^SDOE(SDOE,"SDLIST") S SDI=0 F  S SDI=$O(SDLIST(SDI)) Q:'SDI  D
"RTN","SCRPW46",84,0)
 ....S SDCPT=$P(SDLIST(SDI),"^") S:SDCPT ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDCPT)=""
"RTN","SCRPW46",85,0)
 ....;Loop through modifiers and add to CPT array
"RTN","SCRPW46",86,0)
 .... N SDMODN,SDMOD  ; SDMODN=modifier node, SDMOD=mod pointer
"RTN","SCRPW46",87,0)
 .... S SDMODN=0
"RTN","SCRPW46",88,0)
 .... F  S SDMODN=+$O(SDLIST(SDI,1,SDMODN)) Q:'SDMODN  D
"RTN","SCRPW46",89,0)
 ..... S SDMOD=$P(SDLIST(SDI,1,SDMODN,0),"^",1)
"RTN","SCRPW46",90,0)
 ..... S:SDMOD ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDCPT,SDMOD)=""
"RTN","SCRPW46",91,0)
 ..... Q
"RTN","SCRPW46",92,0)
 .... Q
"RTN","SCRPW46",93,0)
 ...S:$P(SDFMT,"^")="E" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT",SDT,SDOE)=SDOE0
"RTN","SCRPW46",94,0)
 ...S:$P(SDFMT,"^")="V" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT",$P(SDT,"."))=""
"RTN","SCRPW46",95,0)
 ...S:$P(SDFMT,"^")="P" ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")=""
"RTN","SCRPW46",96,0)
 ...Q
"RTN","SCRPW46",97,0)
 ..Q
"RTN","SCRPW46",98,0)
 .I '$D(^TMP("SCRPW",$J,0,0,DFN)) D  Q
"RTN","SCRPW46",99,0)
 ..N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  K ^TMP("SCRPW",$J,SDIV,1,DFN)
"RTN","SCRPW46",100,0)
 ..Q
"RTN","SCRPW46",101,0)
 .;Build text lists for Diagnosis ranges if necessary
"RTN","SCRPW46",102,0)
 .I $D(SD("LIST","D","R")) D
"RTN","SCRPW46",103,0)
 .. N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:'SDIV  D
"RTN","SCRPW46",104,0)
 ... S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDI)) Q:'SDI  D
"RTN","SCRPW46",105,0)
 ....S SDX=$$ICDDX^SCRPWICD(SDI,+SDOE0),SDX=$P(SDX,"^",2)_" "_$P(SDX,"^",4)
"RTN","SCRPW46",106,0)
 .... S:$L(SDX)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"DXR",SDX)=SDI
"RTN","SCRPW46",107,0)
 .;Building text list for Procedure ranges
"RTN","SCRPW46",108,0)
 .I $D(SD("LIST","P","R")) S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)) Q:'SDI  D
"RTN","SCRPW46",109,0)
 ..; SDI=CPT pointer, SDI2=mod ptr, SDX=CPT+desc, SDX2=mod+desc
"RTN","SCRPW46",110,0)
 ..; get CPT and description and build array entry
"RTN","SCRPW46",111,0)
 .. N CPTINFO,CPTCODE,CPTTEXT
"RTN","SCRPW46",112,0)
 .. S CPTINFO=$$CPT^ICPTCOD(SDI,+SDOE0,1)
"RTN","SCRPW46",113,0)
 .. Q:CPTINFO'>0
"RTN","SCRPW46",114,0)
 .. S CPTCODE=$P(CPTINFO,"^",2)
"RTN","SCRPW46",115,0)
 .. S CPTTEXT=$P(CPTINFO,"^",3)
"RTN","SCRPW46",116,0)
 .. S SDX=CPTCODE_" "_CPTTEXT
"RTN","SCRPW46",117,0)
 .. S:$L(SDX)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDX)=SDI
"RTN","SCRPW46",118,0)
 ..;
"RTN","SCRPW46",119,0)
 ..; loop through mods in CPT array and call API to get mod code/desc
"RTN","SCRPW46",120,0)
 .. S SDI2="" F  S SDI2=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI,SDI2)) Q:'SDI2  D
"RTN","SCRPW46",121,0)
 ... N MODINFO,MODCODE,MODTEXT
"RTN","SCRPW46",122,0)
 ... S MODINFO=$$MOD^ICPTMOD(SDI2,"I",+SDOE0,1)
"RTN","SCRPW46",123,0)
 ... Q:MODINFO'>0
"RTN","SCRPW46",124,0)
 ... S MODCODE=$P(MODINFO,"^",2)
"RTN","SCRPW46",125,0)
 ... S MODTEXT=$P(MODINFO,"^",3)
"RTN","SCRPW46",126,0)
 ... S SDX2=MODCODE_" "_MODTEXT
"RTN","SCRPW46",127,0)
 ... ; add mod code/desc to array
"RTN","SCRPW46",128,0)
 ... S:$L(SDX2)>1 ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDX,SDX2)=SDI2
"RTN","SCRPW46",129,0)
 ... Q
"RTN","SCRPW46",130,0)
 ..Q
"RTN","SCRPW46",131,0)
 .;Iterate through criteria combine logic
"RTN","SCRPW46",132,0)
 .;Loop through secondary Division (SDIV) for multiple division episodes
"RTN","SCRPW46",133,0)
 . N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",134,0)
 .. S SDCRI="" F  S SDCRI=$O(SDCRI(SDCRI)) Q:SDCRI=""  D
"RTN","SCRPW46",135,0)
 ... S SDCL=$TR($TR(SDCRI,"'",""),"&","") F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI) D:'$D(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC))
"RTN","SCRPW46",136,0)
 ....;Build list of true items for each criteria element
"RTN","SCRPW46",137,0)
 .... S SDZ=$P(SDPAR(SDC),"^")
"RTN","SCRPW46",138,0)
 .... I SDZ="DL" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DX",SDI)) Q:'SDI  D
"RTN","SCRPW46",139,0)
 ..... S:$D(SDPAR(SDC,SDI)) ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=""
"RTN","SCRPW46",140,0)
 ..... Q
"RTN","SCRPW46",141,0)
 .... I SDZ="DR" S SDR1="",SDR1=$O(SDPAR(SDC,SDR1)),SDR2=$O(SDPAR(SDC,SDR1)),SDI="" D
"RTN","SCRPW46",142,0)
 ..... F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"DXR",SDI)) Q:SDI=""  D
"RTN","SCRPW46",143,0)
 ...... I SDR1']SDI,SDI']SDR2 S ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=""  Q
"RTN","SCRPW46",144,0)
 ..... Q
"RTN","SCRPW46",145,0)
 .... I SDZ="PL" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)) Q:'SDI  D
"RTN","SCRPW46",146,0)
 ..... I $D(SDPAR(SDC,SDI)) M ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPT",SDI)
"RTN","SCRPW46",147,0)
 ..... Q
"RTN","SCRPW46",148,0)
 .... I SDZ="PR" S SDR1="",SDR1=$O(SDPAR(SDC,SDR1)),SDR2=$O(SDPAR(SDC,SDR1)),SDI="" D
"RTN","SCRPW46",149,0)
 ..... F  S SDI=$O(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDI)) Q:SDI=""  D
"RTN","SCRPW46",150,0)
 ...... I SDR1']SDI,SDI']SDR2 M ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC,SDI)=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CPTR",SDI)
"RTN","SCRPW46",151,0)
 ......Q
"RTN","SCRPW46",152,0)
 .....Q
"RTN","SCRPW46",153,0)
 ....S ^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC)=($D(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC))>0)_U_SDZ
"RTN","SCRPW46",154,0)
 .... Q
"RTN","SCRPW46",155,0)
 ...;Apply criteria combine logic
"RTN","SCRPW46",156,0)
 ...N A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z
"RTN","SCRPW46",157,0)
 ...F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI),@SDC=$P(^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC),"^")
"RTN","SCRPW46",158,0)
 ...;If combine logic is "true", move items to final list
"RTN","SCRPW46",159,0)
 ...I @SDCRI F SDI=1:1:$L(SDCL) S SDC=$E(SDCL,SDI),SDX=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC) D
"RTN","SCRPW46",160,0)
 ....I SDX M ^TMP("SCRPW",$J,0,1,DFN,SDIV,$P(SDX,"^",2))=^TMP("SCRPW",$J,0,0,DFN,SDIV,"CRI",SDC)
"RTN","SCRPW46",161,0)
 ....Q
"RTN","SCRPW46",162,0)
 ...Q
"RTN","SCRPW46",163,0)
 .I '$D(^TMP("SCRPW",$J,0,1,DFN)) D  Q
"RTN","SCRPW46",164,0)
 ..S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  K ^TMP("SCRPW",$J,SDIV,1,DFN)
"RTN","SCRPW46",165,0)
 ..Q
"RTN","SCRPW46",166,0)
 .;Move item ifn lists to text lists
"RTN","SCRPW46",167,0)
 .N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",168,0)
 .. S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"DL",SDI)) Q:'SDI  D
"RTN","SCRPW46",169,0)
 ... S SDX=$$ICDDX^SCRPWICD(SDI,+SDOE0),SDX=$P(SDX,"^",2)_" "_$P(SDX,"^",4) S:$L(SDX)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"DR",SDX)=$G(SDT)
"RTN","SCRPW46",170,0)
 ... Q
"RTN","SCRPW46",171,0)
 .N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",172,0)
 .. S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"PL",SDI)) Q:'SDI  D
"RTN","SCRPW46",173,0)
 ... N CPTINFO,CPTCODE,CPTTEXT
"RTN","SCRPW46",174,0)
 ... S CPTINFO=$$CPT^ICPTCOD(SDI,+SDOE0,1)
"RTN","SCRPW46",175,0)
 ... Q:CPTINFO'>0
"RTN","SCRPW46",176,0)
 ... S CPTCODE=$P(CPTINFO,"^",2)
"RTN","SCRPW46",177,0)
 ... S CPTTEXT=$P(CPTINFO,"^",3)
"RTN","SCRPW46",178,0)
 ... S SDX=CPTCODE_" "_CPTTEXT
"RTN","SCRPW46",179,0)
 ... S:$L(SDX)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"PR",SDX)=""
"RTN","SCRPW46",180,0)
 ... ;
"RTN","SCRPW46",181,0)
 ... ;loop through mods in CPT array and call API to get mod code/desc
"RTN","SCRPW46",182,0)
 ... S SDI2=""
"RTN","SCRPW46",183,0)
 ... F  S SDI2=$O(^TMP("SCRPW",$J,0,1,DFN,SDIV,"PL",SDI,SDI2)) Q:'SDI2  D
"RTN","SCRPW46",184,0)
 .... N MODINFO,MODCODE,MODTEXT
"RTN","SCRPW46",185,0)
 .... S MODINFO=$$MOD^ICPTMOD(SDI2,"I",+SDOE0,1)
"RTN","SCRPW46",186,0)
 .... Q:MODINFO'>0
"RTN","SCRPW46",187,0)
 .... S MODCODE=$P(MODINFO,"^",2)
"RTN","SCRPW46",188,0)
 .... S MODTEXT=$P(MODINFO,"^",3)
"RTN","SCRPW46",189,0)
 .... S SDX2=MODCODE_" "_MODTEXT
"RTN","SCRPW46",190,0)
 .... ; add mod code/desc to array
"RTN","SCRPW46",191,0)
 .... S:$L(SDX2)>1 ^TMP("SCRPW",$J,0,1,DFN,SDIV,"PR",SDX,SDX2)=""
"RTN","SCRPW46",192,0)
 .... Q 
"RTN","SCRPW46",193,0)
 ...Q
"RTN","SCRPW46",194,0)
 . ; delete procedure list array
"RTN","SCRPW46",195,0)
 . N SDIV S SDIV="" F  S SDIV=$O(SDPDIV(SDIV)) Q:SDIV=""  D
"RTN","SCRPW46",196,0)
 ..;Merge activity list
"RTN","SCRPW46",197,0)
 .. M ^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")=^TMP("SCRPW",$J,SDIV,0,DFN,SDIV,"ACT")
"RTN","SCRPW46",198,0)
 ..;Kill scratch list, merge to summary global if multidivisional
"RTN","SCRPW46",199,0)
 ..I SDMD,SDFMT'="P" M ^TMP("SCRPW",$J,0,1,DFN,SDIV,"ACT")=^TMP("SCRPW",$J,SDIV,1,DFN,SDIV,"ACT")
"RTN","SCRPW46",200,0)
 ..;Delete scratch levels and arrays after merge
"RTN","SCRPW46",201,0)
 .. K ^TMP("SCRPW",$J,0,1,DFN,"DL")
"RTN","SCRPW46",202,0)
 .. K ^TMP("SCRPW",$J,0,1,DFN,"PL")
"RTN","SCRPW46",203,0)
 ..Q
"RTN","SCRPW46",204,0)
 .Q
"RTN","SCRPW46",205,0)
 ;Delete 0,0 scratch level prior to printing
"RTN","SCRPW46",206,0)
 K ^TMP("SCRPW",$J,0,0)
"RTN","SCRPW46",207,0)
 G:SDOUT EXIT^SCRPW47 G ^SCRPW47
"RTN","SCRPW46",208,0)
 ;
"RTN","SCRPW46",209,0)
DIV() ;Check division
"RTN","SCRPW46",210,0)
 Q:'SDDIV 1  Q $D(SDDIV(+SDIV))
"RTN","SCRPW47")
0^12^B65269594^B59210931
"RTN","SCRPW47",1,0)
SCRPW47 ;RENO/KEITH/MLR - Outpatient Diagnosis/Procedure Code Search (cont.) ;9/29/00 12:34pm
"RTN","SCRPW47",2,0)
 ;;5.3;Scheduling;**144,180,199,593**;AUG 13, 1993;Build 13
"RTN","SCRPW47",3,0)
 ;;07/22/99 ACS - Added CPT modifiers to the report
"RTN","SCRPW47",4,0)
 ;  *199*
"RTN","SCRPW47",5,0)
 ;   - Summary section correction (multiple divisions)
"RTN","SCRPW47",6,0)
 ;   - Addition of Secondary Division subscript variable: DIV0
"RTN","SCRPW47",7,0)
 ;   - Displaying only divisions with matching criterial in subheader
"RTN","SCRPW47",8,0)
 ;
"RTN","SCRPW47",9,0)
 N SDIV S SDIV=""
"RTN","SCRPW47",10,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""!SDOUT  D
"RTN","SCRPW47",11,0)
 . S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,1,DFN)) Q:'DFN!SDOUT  D
"RTN","SCRPW47",12,0)
 .. S (DIV1,DIV0)=0 F  S DIV0=$O(^TMP("SCRPW",$J,SDIV,1,DFN,DIV0)) Q:'DIV0  D
"RTN","SCRPW47",13,0)
 ...; Screening "DR" or "PR" levels (SDZ) prior to setting print level
"RTN","SCRPW47",14,0)
 ...; Note:  Patient must have valid Diagnosis or Procedure to print
"RTN","SCRPW47",15,0)
 ... Q:$G(^TMP("SCRPW",$J,0,1,DFN,DIV0,SDZ))=""
"RTN","SCRPW47",16,0)
 ... S SDSTOP=SDSTOP+1 D:SDSTOP#1000=0 STOP Q:SDOUT
"RTN","SCRPW47",17,0)
 ... S SDPT0=$G(^DPT(DFN,0)),SDPTNA=$P(SDPT0,U)
"RTN","SCRPW47",18,0)
 ... S:$L(SDPTNA) ^TMP("SCRPW",$J,SDIV,2,SDPTNA,DFN,DIV0)=$P(SDPT0,U,9)
"RTN","SCRPW47",19,0)
 ;
"RTN","SCRPW47",20,0)
 G:SDOUT EXIT
"RTN","SCRPW47",21,0)
 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW47",22,0)
 K SDTIT
"RTN","SCRPW47",23,0)
 S SDTIT(1)="<*>  OUTPATIENT DIAGNOSIS/PROCEDURE CODE SEARCH  <*>"
"RTN","SCRPW47",24,0)
 D HINI^SCRPW46,BLD^SCRPW21
"RTN","SCRPW47",25,0)
 S SDTIT(2)="Report Parameters Selected"
"RTN","SCRPW47",26,0)
 D HDR G:SDOUT EXIT D PD1(0) G:SDOUT EXIT
"RTN","SCRPW47",27,0)
 ;if no data in file, exit from program
"RTN","SCRPW47",28,0)
 I '$D(^TMP("SCRPW",$J,0,1)) D  G EXIT
"RTN","SCRPW47",29,0)
 . K SDTIT(2) D HDR G:SDOUT EXIT
"RTN","SCRPW47",30,0)
 . S SDX="No activity found within selected report parameters!"
"RTN","SCRPW47",31,0)
 . W !!?(IOM-$L(SDX)\2),SDX
"RTN","SCRPW47",32,0)
 . Q
"RTN","SCRPW47",33,0)
 ;
"RTN","SCRPW47",34,0)
 I $P(SDDIV,U,2)="SELECTED DIVISIONS" D
"RTN","SCRPW47",35,0)
 . S SDI=0 F  S SDI=$O(SDDIV(SDI)) Q:'SDI  S SDIVL(SDDIV(SDI))=SDI
"RTN","SCRPW47",36,0)
 ;
"RTN","SCRPW47",37,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW47",38,0)
 . S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,0,SDI)) Q:'SDI  D
"RTN","SCRPW47",39,0)
 .. S SDX=$P($G(^DG(40.8,SDI,0)),U)
"RTN","SCRPW47",40,0)
 .. S:'$L(SDX) SDX="***UNKNOWN***"
"RTN","SCRPW47",41,0)
 .. S SDIVL(SDX)=SDI
"RTN","SCRPW47",42,0)
 ;
"RTN","SCRPW47",43,0)
 S:'$D(SDIVL) SDIVL($P(SDDIV,U,2))=$P(SDDIV,U)
"RTN","SCRPW47",44,0)
 D:$E(IOST)="C" DISP0^SCRPW23 S SDCOL=$S(IOM=80:0,1:26)
"RTN","SCRPW47",45,0)
 S SDIVN=""
"RTN","SCRPW47",46,0)
 F  S SDIVN=$O(SDIVL(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIVL(SDIVN))
"RTN","SCRPW47",47,0)
 G:SDOUT EXIT S SDMD=0,SDMD=$O(^TMP("SCRPW",$J,SDMD)),SDMD=$O(^TMP("SCRPW",$J,SDMD)) D:SDMD DPRT(0)
"RTN","SCRPW47",48,0)
 I $E(IOST)="C",'SDOUT W ! N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW47",49,0)
 ;
"RTN","SCRPW47",50,0)
EXIT D END^SCRPW50
"RTN","SCRPW47",51,0)
 K %,%H,%I,%DT,DFN,DIC,DIR,DTOUT,DUOUT,S1,S2,SD,SDACT,SDAPF,SDBAD,SDC
"RTN","SCRPW47",52,0)
 K SDC1,SDCL,SDCOL,SDCPT,SDCRI,SDCT,SDD,SDDIV,SDDX,SDEXE,SDF,SDFF
"RTN","SCRPW47",53,0)
 K SDI,SDI2,SDII,SDIII,SDITX,SDIV,SDIVL,SDIVN,SDIXE,SDL,SDL1,SDLAB
"RTN","SCRPW47",54,0)
 K SDLAST,SDLF,SDLINE,SDLIST,SDLOC,SDLTH,SDMD,SDNUL,SDOE,SDOE0,SDOTX
"RTN","SCRPW47",55,0)
 K SDOUT,SDOXE,SDP,SDPAGE,SDPAR,SDPDIV,SDPNAM,SDPNOW,SDPT0,SDPTNA,SDR
"RTN","SCRPW47",56,0)
 K SDR1,SDR2,SDSEL,SDSSN,SDSTOP,SDSTR,SDT,SDTIT,SDTX,SDTXB,SDTY,SDUI
"RTN","SCRPW47",57,0)
 K SDUII,SDUIII,SDUIV,SDUJC,SDRESP,SDS1,SDS2,SDV,SDVAL,SDVAR,SDX,SDX2
"RTN","SCRPW47",58,0)
 K SDFMT,SDY,SDZ,X,X1,X2,X3,X4,Y,Z
"RTN","SCRPW47",59,0)
 Q  ;EXIT
"RTN","SCRPW47",60,0)
 ;
"RTN","SCRPW47",61,0)
HDR D HDR^SCRPW46 Q
"RTN","SCRPW47",62,0)
 ;
"RTN","SCRPW47",63,0)
HD1 ;Report subheader
"RTN","SCRPW47",64,0)
 Q:SDOUT
"RTN","SCRPW47",65,0)
 W !?(SDCOL),"Patient/Division:",?(SDCOL+26),"SSN:"
"RTN","SCRPW47",66,0)
 W ?(SDCOL+38),$S('$D(SD("LIST","P")):"Diagnoses:",'$D(SD("LIST","D")):"Procedures/Modifiers:",1:"Diagnoses/Procedures:")
"RTN","SCRPW47",67,0)
 W !?(SDCOL),$E(SDLINE,1,24),?(SDCOL+26),$E(SDLINE,1,10)
"RTN","SCRPW47",68,0)
 W ?(SDCOL+38),$E(SDLINE,1,42)
"RTN","SCRPW47",69,0)
 Q  ;HD1
"RTN","SCRPW47",70,0)
 ;
"RTN","SCRPW47",71,0)
STOP ;Check for stop task request
"RTN","SCRPW47",72,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW47",73,0)
 ;
"RTN","SCRPW47",74,0)
DPRT(SDV) ;Print report for a division
"RTN","SCRPW47",75,0)
 ;Required input: SDV=division ifn or '0' for summary
"RTN","SCRPW47",76,0)
 S SDIV=SDV  ;copying division #
"RTN","SCRPW47",77,0)
 D DHDR^SCRPW46(SDV,2,.SDTIT) S SDPAGE=1 D HDR Q:SDOUT
"RTN","SCRPW47",78,0)
 I '$D(^TMP("SCRPW",$J,SDV,2)) D
"RTN","SCRPW47",79,0)
 . S SDX="No activity found within selected report parameters for this division!"
"RTN","SCRPW47",80,0)
 . W !!?(IOM-$L(SDX)\2),SDX Q
"RTN","SCRPW47",81,0)
 D HD1 S (SDCT,SDDCT,DIVB)=0,(SDPNAM,SDPNAM2)="",SDF=$P(SDFMT,U)
"RTN","SCRPW47",82,0)
 F  S SDPNAM=$O(^TMP("SCRPW",$J,SDV,2,SDPNAM)) Q:SDPNAM=""!SDOUT  D
"RTN","SCRPW47",83,0)
 . S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDV,2,SDPNAM,DFN)) Q:'DFN!SDOUT  D
"RTN","SCRPW47",84,0)
 .. S SDCT=SDCT+1,DIV0=0
"RTN","SCRPW47",85,0)
 .. F  S DIV0=$O(^TMP("SCRPW",$J,SDV,2,SDPNAM,DFN,DIV0)) Q:DIV0=""  D
"RTN","SCRPW47",86,0)
 ... S SDDCT=SDDCT+1,SDSSN=^TMP("SCRPW",$J,SDV,2,SDPNAM,DFN,DIV0)
"RTN","SCRPW47",87,0)
 ... S SDPNAM2=SDPNAM_" "_DIV0
"RTN","SCRPW47",88,0)
 ... D DPRT1 W !
"RTN","SCRPW47",89,0)
 W !?(SDCOL),$E(SDLINE,1,80)
"RTN","SCRPW47",90,0)
 W !?(SDCOL),"TOTAL PATIENTS IDENTIFIED: ",SDCT
"RTN","SCRPW47",91,0)
 I SDV=0 W !?(SDCOL),"MULTI-DIVISION PATIENTS:   ",SDDCT-SDCT
"RTN","SCRPW47",92,0)
 Q
"RTN","SCRPW47",93,0)
 ;
"RTN","SCRPW47",94,0)
DPRT1 ;Prints name & ss# of line detail
"RTN","SCRPW47",95,0)
 D:$Y>(IOSL-6) HDR,HD1 Q:SDOUT
"RTN","SCRPW47",96,0)
 W !?(SDCOL),$E(SDPNAM2,1,24)
"RTN","SCRPW47",97,0)
 W ?(SDCOL+26),SDSSN
"RTN","SCRPW47",98,0)
 S SDLF=0
"RTN","SCRPW47",99,0)
 ;
"RTN","SCRPW47",100,0)
 D  ;Calling print format modules
"RTN","SCRPW47",101,0)
 . D PATIENT
"RTN","SCRPW47",102,0)
 . I SDF="V" D VISIT Q
"RTN","SCRPW47",103,0)
 . I SDF="E" D ENCNTR Q
"RTN","SCRPW47",104,0)
 . Q
"RTN","SCRPW47",105,0)
 Q  ;DPRT1
"RTN","SCRPW47",106,0)
 ;
"RTN","SCRPW47",107,0)
PATIENT ;Prints Patient Diagnosis/Procedures for all Types of Detail
"RTN","SCRPW47",108,0)
 N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C42|"
"RTN","SCRPW47",109,0)
 F SDI="DR","PR" I $D(^TMP("SCRPW",$J,0,1,DFN,DIV0,SDI)) D  Q:SDOUT
"RTN","SCRPW47",110,0)
 . S SDII="" F  S SDII=$O(^TMP("SCRPW",$J,0,1,DFN,DIV0,SDI,SDII)) Q:SDII=""!SDOUT  D
"RTN","SCRPW47",111,0)
 .. D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW47",112,0)
 .. D
"RTN","SCRPW47",113,0)
 ... W:SDLF ! Q
"RTN","SCRPW47",114,0)
 ... I DIV1'=DIV0 S DIV1=DIV0 W ! Q
"RTN","SCRPW47",115,0)
 ... Q
"RTN","SCRPW47",116,0)
 .. K ^UTILITY($J,"W") S X=$S(SDI="DR":"Dx: ",1:"Proc.: ")_SDII D ^DIWP S SDLF=1
"RTN","SCRPW47",117,0)
 .. F SDL2=1:1:^UTILITY($J,"W",DIWL) W:SDL2>1 ! W ?(SDCOL+38),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,42)
"RTN","SCRPW47",118,0)
 ..; print mod and desc for current CPT (SDII)
"RTN","SCRPW47",119,0)
 ..; SDII2 = modifier and description
"RTN","SCRPW47",120,0)
 .. I $D(^TMP("SCRPW",$J,0,1,DFN,DIV0,SDI,SDII)) D
"RTN","SCRPW47",121,0)
 ... N SDII2 S SDII2=""
"RTN","SCRPW47",122,0)
 ... F  S SDII2=$O(^TMP("SCRPW",$J,0,1,DFN,DIV0,SDI,SDII,SDII2)) Q:'SDII2  D
"RTN","SCRPW47",123,0)
 .... D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW47",124,0)
 .... W !,?(SDCOL+47),"-",$E(SDII2,1,32)
"RTN","SCRPW47",125,0)
 .. Q
"RTN","SCRPW47",126,0)
 . Q
"RTN","SCRPW47",127,0)
 S SDI=0 F  S SDI=$O(SDAPF(2,SDI)) Q:'SDI!SDOUT  S SDOE0=U_DFN_U,SDY=SDAPF(2,SDI) D APF(SDY,SDOE0,5)
"RTN","SCRPW47",128,0)
 ;
"RTN","SCRPW47",129,0)
 Q  ;PATIENT
"RTN","SCRPW47",130,0)
 ;
"RTN","SCRPW47",131,0)
VISIT ;Printing Type of Detail: Visits
"RTN","SCRPW47",132,0)
 S SDT=0
"RTN","SCRPW47",133,0)
 F  S SDT=$O(^TMP("SCRPW",$J,0,1,DFN,DIV0,"ACT",SDT)) Q:'SDT!SDOUT  D
"RTN","SCRPW47",134,0)
 . D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW47",135,0)
 . S Y=SDT X ^DD("DD") W !?(SDCOL+10),"Visit: ",Y Q
"RTN","SCRPW47",136,0)
 ;
"RTN","SCRPW47",137,0)
 Q  ;VISIT
"RTN","SCRPW47",138,0)
 ;
"RTN","SCRPW47",139,0)
ENCNTR ;Printing Type of Detail: ENCOUNTER
"RTN","SCRPW47",140,0)
 S SDT=0
"RTN","SCRPW47",141,0)
 F  S SDT=$O(^TMP("SCRPW",$J,0,1,DFN,DIV0,"ACT",SDT)) Q:'SDT!SDOUT  D
"RTN","SCRPW47",142,0)
 . S SDOE=0 F  S SDOE=$O(^TMP("SCRPW",$J,0,1,DFN,DIV0,"ACT",SDT,SDOE)) Q:'SDOE!SDOUT  D
"RTN","SCRPW47",143,0)
 .. D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT
"RTN","SCRPW47",144,0)
 .. S SDOE0=^TMP("SCRPW",$J,0,1,DFN,DIV0,"ACT",SDT,SDOE)
"RTN","SCRPW47",145,0)
 .. S SDLOC=$P($G(^SC(+$P(SDOE0,U,4),0)),U)
"RTN","SCRPW47",146,0)
 .. S Y=SDT X ^DD("DD") W !?(SDCOL+10),"Encounter: ",$P(Y,":",1,2)
"RTN","SCRPW47",147,0)
 .. W ?(SDCOL+40),SDLOC
"RTN","SCRPW47",148,0)
 .. S SDI=0 F  S SDI=$O(SDAPF(1,SDI)) Q:'SDI!SDOUT  S SDY=SDAPF(1,SDI) D APF(SDY,SDOE0,$S($D(SDAPF(2)):15,1:25))
"RTN","SCRPW47",149,0)
 .. Q
"RTN","SCRPW47",150,0)
 Q  ;ENCNTR
"RTN","SCRPW47",151,0)
 ;
"RTN","SCRPW47",152,0)
APF(SDY,SDOE0,SDC) ;Print additional print fields
"RTN","SCRPW47",153,0)
 ;Required input: SDY=action acronym^major category^minor category
"RTN","SCRPW47",154,0)
 ;Required input: SDOE0=zeroeth node of OUTPATIENT ENCOUNTER record
"RTN","SCRPW47",155,0)
 ;Required input: SDC=column to begin output
"RTN","SCRPW47",156,0)
 N SDACT,SDX,SDI
"RTN","SCRPW47",157,0)
 D:$Y>(IOSL-4) HDR,HD1 Q:SDOUT  W !?(SDCOL+SDC),$P(SDY,U,3),":"
"RTN","SCRPW47",158,0)
 S SDACT=^TMP("SCRPW",$J,"ACT",$P(SDY,U)),SDLF=0,SDC1=SDC+2+$L($P(SDY,U,3))
"RTN","SCRPW47",159,0)
 K SDX X $P(SDACT,"~",7) S SDX="" F  S SDX=$O(SDX(SDX)) Q:SDX=""!SDOUT  D
"RTN","SCRPW47",160,0)
 .D:$Y>(IOSL-3) HDR,HD1 Q:SDOUT  W:SDLF ! W ?(SDCOL+SDC1),$E($P(SDX(SDX),U,2),1,(80-SDC1)) S SDLF=1
"RTN","SCRPW47",161,0)
 .Q
"RTN","SCRPW47",162,0)
 Q
"RTN","SCRPW47",163,0)
 ;
"RTN","SCRPW47",164,0)
PD1(SDI) ;Print parameters
"RTN","SCRPW47",165,0)
 ;Required input: SDI=0 for all division selections or division ifn
"RTN","SCRPW47",166,0)
 N SDLF,C S C=(IOM-80\2),SDLF=0 I SDI D PDP("Report for",SDDIV(SDI),1) Q:SDOUT
"RTN","SCRPW47",167,0)
 I 'SDI D PDP("Report for",SDDIV,2) Q:SDOUT  D
"RTN","SCRPW47",168,0)
 .F  S SDI=$O(SDDIV(SDI)) Q:'SDI!SDOUT  D PDP("Division",SDDIV(SDI),1)
"RTN","SCRPW47",169,0)
 Q:SDOUT  D PDP("Beginning date",SD("PBDT"),1,0,1) Q:SDOUT  D PDP("Ending date",SD("PEDT"),1) Q:SDOUT
"RTN","SCRPW47",170,0)
 S SDI="" F  S SDI=$O(SDPAR(SDI)) Q:SDI=""!SDOUT  D
"RTN","SCRPW47",171,0)
 .D PDP("Search element '"_SDI_"'",SDPAR(SDI),2,0,1) Q:SDOUT  S SDTY=$P(SDPAR(SDI),U)
"RTN","SCRPW47",172,0)
 .I SDTY["L" S SDLAB=$S(SDTY["D":"Diagnosis",1:"Procedure") S SDII=0 F  S SDII=$O(SDPAR(SDI,SDII)) Q:'SDII  D PDP(SDLAB,SDPAR(SDI,SDII),1) Q:SDOUT
"RTN","SCRPW47",173,0)
 .I SDTY["R" S SDVAL=$O(SDPAR(SDI,"")) D PDP("From",SDVAL,1) Q:SDOUT  S SDVAL=$O(SDPAR(SDI,SDVAL)) D PDP("To",SDVAL,1)
"RTN","SCRPW47",174,0)
 .Q
"RTN","SCRPW47",175,0)
 S SDI="" F  S SDI=$O(SDCRI(SDI)) Q:SDI=""!SDOUT  D
"RTN","SCRPW47",176,0)
 .D PDP("Combine logic",SDI,1,0,1) Q:SDOUT  M SDITX=SDCRI(SDI) D WRAP^SCRPW45(.SDITX,.SDOTX,,,60,"") S SDII="" F  S SDII=$O(SDOTX(SDII)) Q:SDII=""!SDOUT  D
"RTN","SCRPW47",177,0)
 ..S SDLF=SDLF+1 I $E(IOST)="C",SDLF#18=0 D WAIT Q:SDOUT
"RTN","SCRPW47",178,0)
 ..I $Y>(IOSL-3),$E(IOST)="P" D HDR Q:SDOUT
"RTN","SCRPW47",179,0)
 ..S SDX=SDOTX(SDII) W !?(IOM-$L(SDX)\2),SDX
"RTN","SCRPW47",180,0)
 ..Q
"RTN","SCRPW47",181,0)
 .Q
"RTN","SCRPW47",182,0)
 D PDP("Type of detail",SDFMT,2,0,1) Q:SDOUT
"RTN","SCRPW47",183,0)
 S SDIII=0 F SDI=2,1 S SDII=0 F  S SDII=$O(SDAPF(SDI,SDII)) Q:'SDII!SDOUT  D
"RTN","SCRPW47",184,0)
 .D PDP("Additional print fields",SDAPF(SDI,SDII),3,SDIII,'SDIII) S SDIII=1
"RTN","SCRPW47",185,0)
 D:$E(IOST)="C" WAIT Q
"RTN","SCRPW47",186,0)
 ;
"RTN","SCRPW47",187,0)
PDP(SDT,SDX,SDP,SDL,SDL1) ;Print parameter display line
"RTN","SCRPW47",188,0)
 ;Required input: SDT=parameter title
"RTN","SCRPW47",189,0)
 ;Required input: SDX=parameter value
"RTN","SCRPW47",190,0)
 ;Required input: SDP=$P of SDX to print
"RTN","SCRPW47",191,0)
 ;Optional input: SDL=1 to suppress title and do line feed
"RTN","SCRPW47",192,0)
 ;Optional input: SDL1=1 to do additional line feed
"RTN","SCRPW47",193,0)
 N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C"_(IOM\2+1)_"|"
"RTN","SCRPW47",194,0)
 S SDLF=SDLF+1 I $E(IOST)="C",SDLF#18=0 D WAIT Q:SDOUT
"RTN","SCRPW47",195,0)
 I $Y>(IOSL-3),$E(IOST)="P" D HDR Q:SDOUT
"RTN","SCRPW47",196,0)
 I $G(SDL1) W ! S SDLF=SDLF+1 I $E(IOST)="C",SDLF#18=0 D WAIT Q:SDOUT
"RTN","SCRPW47",197,0)
 W ! W:'$G(SDL) $J(SDT,(IOM-6\2)),":"
"RTN","SCRPW47",198,0)
 K ^UTILITY($J,"W") S X=$P(SDX,U,SDP) D ^DIWP
"RTN","SCRPW47",199,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) D  S SDLF=SDLF+1 I $E(IOST)="C",SDLF#18=0 D WAIT Q:SDOUT
"RTN","SCRPW47",200,0)
 . I SDL2=1 W ?(IOM\2-1),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(IOM\2+1)) I 1
"RTN","SCRPW47",201,0)
 . E  W !,?(IOM\2-1),$E(^UTILITY($J,"W",DIWL,SDL2,0),1,(IOM\2+1))
"RTN","SCRPW47",202,0)
 Q
"RTN","SCRPW47",203,0)
 ;
"RTN","SCRPW47",204,0)
WAIT ;Do CRT pause
"RTN","SCRPW47",205,0)
 N DIR W ! S DIR(0)="E" D ^DIR S SDOUT=Y'=1 W ! Q
"RTN","SCRPW57")
0^13^B30255024^B28798675
"RTN","SCRPW57",1,0)
SCRPW57 ;RENO/KEITH - Most Frequent 50 ICD Diagnosis Codes (OP7) or (IP7) ;5/6/03 1:18pm
"RTN","SCRPW57",2,0)
 ;;5.3;Scheduling;**144,295,466,593**;AUG 13, 1993;Build 13
"RTN","SCRPW57",3,0)
 S SDSTA=$G(SDSTA,2)
"RTN","SCRPW57",4,0)
 D RQUE^SCRPW50("START^SCRPW57","Most Frequent 50 ICD Diagnosis Codes "_$S(SDSTA=2:"(OP7)",1:"(IP7)"),1) Q
"RTN","SCRPW57",5,0)
 ;
"RTN","SCRPW57",6,0)
START ;Print report
"RTN","SCRPW57",7,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDT=SD("FYD")
"RTN","SCRPW57",8,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) I $$VALID() D SET(SDIV) D:SDMD SET(0)
"RTN","SCRPW57",9,0)
 G:SDOUT EXIT S (SDVCT,SDIV)=""
"RTN","SCRPW57",10,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP,DLIST Q:SDOUT  D
"RTN","SCRPW57",11,0)
 .S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN)) Q:'DFN  D
"RTN","SCRPW57",12,0)
 ..S SDDX=0 F  S SDDX=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX)) Q:'SDDX  S SDPT="" F  S SDPT=$O(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDPT)) Q:SDPT=""  D
"RTN","SCRPW57",13,0)
 ...S $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT),U,2)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT)),U,2)+1
"RTN","SCRPW57",14,0)
 ...S:$D(^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDPT,"P")) $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT),U)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDPT)),U)+1
"RTN","SCRPW57",15,0)
 ...Q
"RTN","SCRPW57",16,0)
 ..Q
"RTN","SCRPW57",17,0)
 .S SDDX=0 F  S SDDX=$O(^TMP("SCRPW",$J,SDIV,0,SDDX)) Q:'SDDX  S SDI=^TMP("SCRPW",$J,SDIV,0,SDDX),^TMP("SCRPW",$J,SDIV,1,SDI,SDDX)=""
"RTN","SCRPW57",18,0)
 .Q
"RTN","SCRPW57",19,0)
 G:SDOUT EXIT S SDLINE="",$P(SDLINE,"-",(IOM+1))="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDTIT(1)="<*>  MOST FREQUENT 50 ICD DIAGNOSIS CODES "_$S(SDSTA=2:"(OP7)",1:"(IP7)")_"  <*>",SDPG=0 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW57",20,0)
 I '$D(^TMP("SCRPW",$J)) S SDPAGE=1,SDX="No activity found within report parameters." D HDR G:SDOUT EXIT W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW57",21,0)
 G:SDOUT EXIT S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D DPRT(SDIV(SDIVN))
"RTN","SCRPW57",22,0)
 G:SDOUT EXIT D:SDVCT>1 DPRT(0)
"RTN","SCRPW57",23,0)
EXIT I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW57",24,0)
 K ^TMP("SCRPW",$J),%,%H,%I,DIR,DFN,SD,SDDX,SDDXP,SDDIV,SDFL,SDI,SDII,SDIII,SDIV,SDIVN,SDLINE,SDMD,SDOE,SDOE0,SDOUT,SDPAGE,SDPG,SDPNOW,SDDIAG,SDPRTY,SDPT,SDPTN,SDPTV,SDSTOP,SDT,SDTIT,SDV,SDVCT,SDX,X,Y,SDSTA Q
"RTN","SCRPW57",25,0)
 ;
"RTN","SCRPW57",26,0)
DPRT(SDV) ;Print division
"RTN","SCRPW57",27,0)
 ;Required input: SDV=division ifn or '0' for combined divisions
"RTN","SCRPW57",28,0)
 I SDV S SDTIT(2)="For "_$S(SDDIV["DIVISIONS":"division",1:"facility")_": "_SDIVN
"RTN","SCRPW57",29,0)
 I 'SDV S SDTIT(2)="Report for: "_$P(SDDIV,U,2) D
"RTN","SCRPW57",30,0)
 .S SDI=2,SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  S SDI=SDI+1,SDTIT(SDI)=$J("Division: ",$L(SDIVN))_SDIVN
"RTN","SCRPW57",31,0)
 .Q
"RTN","SCRPW57",32,0)
 S SDPAGE=1 D HDR Q:SDOUT  S (SDI,SDII)="" F  S SDI=$O(^TMP("SCRPW",$J,SDV,1,SDI),-1) Q:SDI=""!SDOUT!(SDII>49)  S SDDX="" F  S SDDX=$O(^TMP("SCRPW",$J,SDV,1,SDI,SDDX)) Q:SDDX=""!SDOUT!(SDII>49)  D PLINE
"RTN","SCRPW57",33,0)
 Q
"RTN","SCRPW57",34,0)
 ;
"RTN","SCRPW57",35,0)
PLINE ;Print output line
"RTN","SCRPW57",36,0)
 N DIWL,DIWF,SDL2 S DIWL=1 S DIWF="C38|"
"RTN","SCRPW57",37,0)
 D:$Y>(IOSL-8) HDR Q:SDOUT  D HD1
"RTN","SCRPW57",38,0)
 S SDDIAG=$$ICDDX^SCRPWICD(SDDX),SDDIAG=$P(SDDIAG,U,2)_"  "_$P(SDDIAG,U,4),SDII=SDII+1
"RTN","SCRPW57",39,0)
 K ^UTILITY($J,"W") S X=SDDIAG D ^DIWP
"RTN","SCRPW57",40,0)
 F SDL2=1:1:^UTILITY($J,"W",DIWL) D
"RTN","SCRPW57",41,0)
 .I SDL2=1 W !,$J(SDII,3),?6,$E(^UTILITY($J,"W",DIWL,SDL2,0),1,38) I 1
"RTN","SCRPW57",42,0)
 .E  W !,?6,$E(^UTILITY($J,"W",DIWL,SDL2,0),1,38)
"RTN","SCRPW57",43,0)
 D  W !
"RTN","SCRPW57",44,0)
 .S (SDFL,SDPT)="" F  S SDPT=$O(^TMP("SCRPW",$J,SDV,0,SDDX,SDPT)) Q:SDPT=""!SDOUT  D
"RTN","SCRPW57",45,0)
 ..I $Y>(IOSL-3) D HDR,HD1 Q:SDOUT  S SDFL=1
"RTN","SCRPW57",46,0)
 ..S SDPTV=^TMP("SCRPW",$J,SDV,0,SDDX,SDPT)
"RTN","SCRPW57",47,0)
 ..S SDPTN=$$CODE2TXT^XUA4A72(SDPT),SDPTN=$P(SDPT,"V",2)_"  "_$P(SDPTN,U,2)
"RTN","SCRPW57",48,0)
 ..W:SDFL ! W ?46,$E(SDPTN,1,38) D  S SDFL=SDFL+1
"RTN","SCRPW57",49,0)
 ...F SDIII=1:1:4 W ?(86+(12*(SDIII-1))),$J($P(SDPTV,U,SDIII),10,0)
"RTN","SCRPW57",50,0)
 ..Q
"RTN","SCRPW57",51,0)
 .Q
"RTN","SCRPW57",52,0)
 Q
"RTN","SCRPW57",53,0)
 ;
"RTN","SCRPW57",54,0)
HDR ;Print header
"RTN","SCRPW57",55,0)
 I $E(IOST)="C",SDPG N DIR S DIR(0)="E" W ! D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW57",56,0)
 D STOP Q:SDOUT  W:SDPG!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SCRPW57",57,0)
 N SDI S SDI=0 W SDLINE F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(IOM-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW57",58,0)
 W !,SDLINE,!,"For Fiscal Year activity through ",SD("PEDT"),!,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1,SDPG=1 Q
"RTN","SCRPW57",59,0)
 ;
"RTN","SCRPW57",60,0)
HD1 ;Print subheader
"RTN","SCRPW57",61,0)
 Q:SDOUT  W !?87,"Prim. Dx.",?103,"Total",?111,"Prim. Dx.",?127,"Total",!,"Rank  ICD Diagnosis code",?48,"Provider Type",?89,"Uniques",?101,"Uniques",?110,"Encounters",?122,"Encounters"
"RTN","SCRPW57",62,0)
 N SDI W !,"----",?6,$E(SDLINE,1,38),?46,$E(SDLINE,1,38) F SDI=0:1:3 W ?(86+(12*SDI)),$E(SDLINE,1,10)
"RTN","SCRPW57",63,0)
 Q
"RTN","SCRPW57",64,0)
 ;
"RTN","SCRPW57",65,0)
DLIST ;Create alphabetic list of divisions found
"RTN","SCRPW57",66,0)
 Q:'SDIV  S SDX=$P($G(^DG(40.8,SDIV,0)),U) S:'$L(SDX) SDX="*** UNKNOWN ***" S SDIV(SDX)=SDIV,SDVCT=SDVCT+1 Q
"RTN","SCRPW57",67,0)
 ;
"RTN","SCRPW57",68,0)
VALID() ;Check encounter record
"RTN","SCRPW57",69,0)
 Q 1
"RTN","SCRPW57",70,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW57",71,0)
 I SDIV,$$DIV(),$P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,7),$P(SDOE0,U,12)=SDSTA Q 1
"RTN","SCRPW57",72,0)
 Q 0
"RTN","SCRPW57",73,0)
 ;
"RTN","SCRPW57",74,0)
DIV() ;Check division
"RTN","SCRPW57",75,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW57",76,0)
 ;
"RTN","SCRPW57",77,0)
STOP ;Check for stop task request
"RTN","SCRPW57",78,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW57",79,0)
 ;
"RTN","SCRPW57",80,0)
SET(SDIV) ;Set division lists
"RTN","SCRPW57",81,0)
 ;Required input: SDIV=division ifn or '0' for summary
"RTN","SCRPW57",82,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#2000=0 D STOP^SCRPW40 Q:SDOUT
"RTN","SCRPW57",83,0)
 N SDDIAG,SDPRTY,SDI,SDII,SDIII,SDX S DFN=$P(SDOE0,U,2)
"RTN","SCRPW57",84,0)
 D GETDX^SDOE(SDOE,"SDDIAG"),PROV^SCRPW50(SDOE,.SDPRTY)
"RTN","SCRPW57",85,0)
 S SDI=0 F  S SDI=$O(SDDIAG(SDI)) Q:'SDI  S SDDX=$P(SDDIAG(SDI),U),SDDXP=$S($P(SDDIAG(SDI),U,12)="P":"P",1:"S") I SDDX D
"RTN","SCRPW57",86,0)
 .S ^TMP("SCRPW",$J,SDIV,0,SDDX)=$G(^TMP("SCRPW",$J,SDIV,0,SDDX))+1
"RTN","SCRPW57",87,0)
 .S SDII=0 F  S SDII=$O(SDPRTY(SDII)) Q:'SDII  S SDX=SDPRTY(SDII) I $L(SDX) D
"RTN","SCRPW57",88,0)
 ..S $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX),U,4)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX)),U,4)+1 D
"RTN","SCRPW57",89,0)
 ...S:SDDXP="P" $P(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX),U,3)=$P($G(^TMP("SCRPW",$J,SDIV,0,SDDX,SDX)),U,3)+1
"RTN","SCRPW57",90,0)
 ...S ^TMP("SCRPW",$J,SDIV,0,"LIST",DFN,SDDX,SDX,SDDXP)=""
"RTN","SCRPW57",91,0)
 ...Q
"RTN","SCRPW57",92,0)
 ..Q
"RTN","SCRPW57",93,0)
 .Q
"RTN","SCRPW57",94,0)
 Q
"RTN","SCRPW57",95,0)
 ;
"RTN","SCRPWICD")
0^16^B396688^n/a
"RTN","SCRPWICD",1,0)
SCRPWICD ;HINES/LAI - Ambulatory Care Reporting - ICD Code API Wrappers;2/15/2012
"RTN","SCRPWICD",2,0)
 ;;5.3;Scheduling;**593**;AUG 13, 1993;Build 13
"RTN","SCRPWICD",3,0)
 ; Reference to $$IMP^ICDEX supported by ICR #5747
"RTN","SCRPWICD",4,0)
 ; Reference to $$CSI^ICDEX supported by ICR #5747
"RTN","SCRPWICD",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","SCRPWICD",6,0)
 ;
"RTN","SCRPWICD",7,0)
 Q
"RTN","SCRPWICD",8,0)
 ;
"RTN","SCRPWICD",9,0)
 ; Coding System Implementation Date
"RTN","SCRPWICD",10,0)
IMP(CSYS) Q $$IMP^ICDEX($G(CSYS))
"RTN","SCRPWICD",11,0)
 ;
"RTN","SCRPWICD",12,0)
 ; Diagnosis Code Info
"RTN","SCRPWICD",13,0)
ICDDX(IEN,CDT) Q $$ICDDX^ICDEX($G(IEN),$P($G(CDT),".",1),$$CSI(80,$G(IEN)),"I")
"RTN","SCRPWICD",14,0)
 ;
"RTN","SCRPWICD",15,0)
 ; Coding system for IEN
"RTN","SCRPWICD",16,0)
CSI(FILE,IEN) Q $$CSI^ICDEX($G(FILE),$G(IEN))
"RTN","SCRPWICD",17,0)
 ;
"VER")
8.0^22.0
"BLD",8837,6)
^508
**END**
**END**

