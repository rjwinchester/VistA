EMERGENCY Released SD*5.3*683 SEQ #568
Extracted from mail message
**KIDS**:SD*5.3*683^

**INSTALL NAME**
SD*5.3*683
"BLD",10324,0)
SD*5.3*683^SCHEDULING^0^3180212^y
"BLD",10324,4,0)
^9.64PA^^
"BLD",10324,6.3)
2
"BLD",10324,"KRN",0)
^9.67PA^779.2^20
"BLD",10324,"KRN",.4,0)
.4
"BLD",10324,"KRN",.401,0)
.401
"BLD",10324,"KRN",.402,0)
.402
"BLD",10324,"KRN",.403,0)
.403
"BLD",10324,"KRN",.5,0)
.5
"BLD",10324,"KRN",.84,0)
.84
"BLD",10324,"KRN",3.6,0)
3.6
"BLD",10324,"KRN",3.8,0)
3.8
"BLD",10324,"KRN",9.2,0)
9.2
"BLD",10324,"KRN",9.8,0)
9.8
"BLD",10324,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10324,"KRN",9.8,"NM",1,0)
SDEC31^^0^B26336338
"BLD",10324,"KRN",9.8,"NM","B","SDEC31",1)

"BLD",10324,"KRN",19,0)
19
"BLD",10324,"KRN",19.1,0)
19.1
"BLD",10324,"KRN",101,0)
101
"BLD",10324,"KRN",409.61,0)
409.61
"BLD",10324,"KRN",771,0)
771
"BLD",10324,"KRN",779.2,0)
779.2
"BLD",10324,"KRN",870,0)
870
"BLD",10324,"KRN",8989.51,0)
8989.51
"BLD",10324,"KRN",8989.52,0)
8989.52
"BLD",10324,"KRN",8994,0)
8994
"BLD",10324,"KRN","B",.4,.4)

"BLD",10324,"KRN","B",.401,.401)

"BLD",10324,"KRN","B",.402,.402)

"BLD",10324,"KRN","B",.403,.403)

"BLD",10324,"KRN","B",.5,.5)

"BLD",10324,"KRN","B",.84,.84)

"BLD",10324,"KRN","B",3.6,3.6)

"BLD",10324,"KRN","B",3.8,3.8)

"BLD",10324,"KRN","B",9.2,9.2)

"BLD",10324,"KRN","B",9.8,9.8)

"BLD",10324,"KRN","B",19,19)

"BLD",10324,"KRN","B",19.1,19.1)

"BLD",10324,"KRN","B",101,101)

"BLD",10324,"KRN","B",409.61,409.61)

"BLD",10324,"KRN","B",771,771)

"BLD",10324,"KRN","B",779.2,779.2)

"BLD",10324,"KRN","B",870,870)

"BLD",10324,"KRN","B",8989.51,8989.51)

"BLD",10324,"KRN","B",8989.52,8989.52)

"BLD",10324,"KRN","B",8994,8994)

"BLD",10324,"QUES",0)
^9.62^^
"BLD",10324,"REQB",0)
^9.611^1^1
"BLD",10324,"REQB",1,0)
SD*5.3*627^1
"BLD",10324,"REQB","B","SD*5.3*627",1)

"MBREQ")
0
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,20,0)
^9.402P^^
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^3051119^2960613
"PKG",48,22,1,"PAH",1,0)
683^3180212
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDEC31")
0^1^B26336338^B25481973
"RTN","SDEC31",1,0)
SDEC31 ;ALB/SAT - VISTA SCHEDULING RPCS ;JAN 15, 2016
"RTN","SDEC31",2,0)
 ;;5.3;Scheduling;**627,683**;Aug 13, 1993;Build 2
"RTN","SDEC31",3,0)
 ;
"RTN","SDEC31",4,0)
 Q
"RTN","SDEC31",5,0)
 ;
"RTN","SDEC31",6,0)
NOSHOW(SDECY,SDECAPTID,SDECNS,USERIEN,SDECDATE)  ;Sets appointment noshow flag in SDEC APPOINTMENT file
"RTN","SDEC31",7,0)
 ;NOSHOW(SDECY,SDECAPTID,SDECNS,USERIEN,SDECDATE)  external parameter tag is in SDEC
"RTN","SDEC31",8,0)
 ;Called by SDEC NOSHOW
"RTN","SDEC31",9,0)
 ;SDECAPTID - (required) Appointment ID - Pointer to SDEC APPOINTMENT file
"RTN","SDEC31",10,0)
 ;SDECNS    - (required) Cancel flag  1=YES (Set NOSHOW); 0=NO (Cancel NOSHOW)
"RTN","SDEC31",11,0)
 ;USERIEN   - (optional) User that entered NoShow pointer to NEW PERSON
"RTN","SDEC31",12,0)
 ;                       default to current user
"RTN","SDEC31",13,0)
 ;SDECDATE  - (optional) Date/Time that No-show was entered in external format
"RTN","SDEC31",14,0)
 ;                      default to NOW.
"RTN","SDEC31",15,0)
 ;Calls CANCEL^SDEC08 to set noshow data in ^DPT
"RTN","SDEC31",16,0)
 ;Returns error code in recordset field ERRORID
"RTN","SDEC31",17,0)
 ;
"RTN","SDEC31",18,0)
 N SDECNOD,DFN,SDECSTART,SDECID,SDECI,SDECZ,SDECERR,SDECMSG,SDFDA,SDECIENS
"RTN","SDEC31",19,0)
 N SDECNOEV,%DT,X,Y,SDECOE
"RTN","SDEC31",20,0)
 S SDECNOEV=1 ;Don't execute protocol
"RTN","SDEC31",21,0)
 ;
"RTN","SDEC31",22,0)
 S SDECI=0
"RTN","SDEC31",23,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC31",24,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC31",25,0)
 S ^TMP("SDEC",$J,SDECI)="I00020ERRORID^T00030ERRORTEXT"_$C(30)
"RTN","SDEC31",26,0)
 S SDECI=SDECI+1
"RTN","SDEC31",27,0)
 ;validate SDEC appointment ID
"RTN","SDEC31",28,0)
 I '+SDECAPTID D ERR(0,"SDEC31: Invalid Appointment ID") Q
"RTN","SDEC31",29,0)
 I '$D(^SDEC(409.84,SDECAPTID,0)) D ERR(0,"SDEC31: Invalid Appointment ID") Q
"RTN","SDEC31",30,0)
 ;validate cancel flag
"RTN","SDEC31",31,0)
 S SDECNS=$G(SDECNS)
"RTN","SDEC31",32,0)
 S SDECNS=$S(SDECNS="YES":1,SDECNS=1:1,SDECNS="NO":0,SDECNS=0:0,1:"")
"RTN","SDEC31",33,0)
 I SDECNS="" D ERR(0,"SDEC31: Invalid No Show value") Q
"RTN","SDEC31",34,0)
 ;validate user IEN (optional)
"RTN","SDEC31",35,0)
 S USERIEN=$G(USERIEN)
"RTN","SDEC31",36,0)
 I USERIEN'="" I '$D(^VA(200,+USERIEN,0)) S USERIEN=""
"RTN","SDEC31",37,0)
 I USERIEN="" S USERIEN=DUZ
"RTN","SDEC31",38,0)
 ;validate cancel date/time (optional)
"RTN","SDEC31",39,0)
 S SDECDATE=$G(SDECDATE)
"RTN","SDEC31",40,0)
 I SDECDATE'="" S %DT="T" S X=SDECDATE D ^%DT S SDECDATE=Y I Y=-1 S SDECDATE=""
"RTN","SDEC31",41,0)
 I $G(SDECDATE)="" S SDECDATE=$$NOW^XLFDT
"RTN","SDEC31",42,0)
 TSTART
"RTN","SDEC31",43,0)
 ;
"RTN","SDEC31",44,0)
 ;Edit SDEC APPOINTMENT entry NOSHOW field
"RTN","SDEC31",45,0)
 S SDECNOD=^SDEC(409.84,SDECAPTID,0)
"RTN","SDEC31",46,0)
 ;I SDECNOD="" D ERR(0,"SDEC31: Invalid Appointment ID") Q
"RTN","SDEC31",47,0)
 S DFN=$P(SDECNOD,U,5)
"RTN","SDEC31",48,0)
 S SDECSTART=$P(SDECNOD,U)
"RTN","SDEC31",49,0)
 ;
"RTN","SDEC31",50,0)
 D SDECNOS(SDECAPTID,SDECNS,USERIEN,SDECDATE)
"RTN","SDEC31",51,0)
 I $D(SDECMSG("DIERR")) S SDECMSG=$G(SDECMSG("DIERR",1,"TEXT",1)) D ERR(0,"SDEC31: "_SDECMSG) Q
"RTN","SDEC31",52,0)
 ;
"RTN","SDEC31",53,0)
 S SDCL=$P(SDECNOD,U,7) ;RESOURCEID
"RTN","SDEC31",54,0)
 I SDCL]"",$D(^SDEC(409.831,SDCL,0)) D  I $G(SDECZ)]"" S SDECERR="SDEC31: APNOSHO Returned: "_SDECZ D ERR(0,SDECERR) Q
"RTN","SDEC31",55,0)
 . S SDECNOD=^SDEC(409.831,SDCL,0)
"RTN","SDEC31",56,0)
 . S SDCL=$P(SDECNOD,U,4) ;HOSPITAL LOCATION
"RTN","SDEC31",57,0)
 . I SDCL]"",$D(^SC(SDCL,0)) D APNOSHO(.SDECZ,SDCL,DFN,SDECSTART,SDECNS,USERIEN,SDECDATE,SDECAPTID)
"RTN","SDEC31",58,0)
 ;*zeb+2 683 2/6/18 fix action required in PCE after no-show from GUI
"RTN","SDEC31",59,0)
 S SDECOE=$P($G(^DPT(DFN,"S",SDECSTART,0)),"^",20)
"RTN","SDEC31",60,0)
 I SDECOE D EN^SDCODEL(SDECOE,0)
"RTN","SDEC31",61,0)
 ;
"RTN","SDEC31",62,0)
 TCOMMIT
"RTN","SDEC31",63,0)
 S SDECI=SDECI+1
"RTN","SDEC31",64,0)
 S ^TMP("SDEC",$J,SDECI)="1^"_$C(30)
"RTN","SDEC31",65,0)
 S SDECI=SDECI+1
"RTN","SDEC31",66,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC31",67,0)
 Q
"RTN","SDEC31",68,0)
 ;
"RTN","SDEC31",69,0)
APNOSHO(SDECZ,SDCL,DFN,SDT,SDECNS,USERIEN,SDECCDT,SDAPID)  ;
"RTN","SDEC31",70,0)
 ; update file 2 info
"RTN","SDEC31",71,0)
 ;Set noshow for patient DFN in clinic SDCL
"RTN","SDEC31",72,0)
 ;at time SDT
"RTN","SDEC31",73,0)
 N SDECC,%H,SDECIEN,SDRTYP
"RTN","SDEC31",74,0)
 N SDECIENS,SDFDA,SDECMSG,IEN
"RTN","SDEC31",75,0)
 S %H=$H D YMD^%DTC
"RTN","SDEC31",76,0)
 ;
"RTN","SDEC31",77,0)
 S SDECIENS=SDT_","_DFN_","
"RTN","SDEC31",78,0)
 I +SDECNS D
"RTN","SDEC31",79,0)
 . S SDFDA(2.98,SDECIENS,3)="N"
"RTN","SDEC31",80,0)
 . S SDFDA(2.98,SDECIENS,14)=USERIEN
"RTN","SDEC31",81,0)
 . S SDFDA(2.98,SDECIENS,15)=SDECCDT
"RTN","SDEC31",82,0)
 E  D
"RTN","SDEC31",83,0)
 . S SDFDA(2.98,SDECIENS,3)=""
"RTN","SDEC31",84,0)
 . S SDFDA(2.98,SDECIENS,14)=""
"RTN","SDEC31",85,0)
 . S SDFDA(2.98,SDECIENS,15)=""
"RTN","SDEC31",86,0)
 K SDECIEN
"RTN","SDEC31",87,0)
 D UPDATE^DIE("","SDFDA","SDECIEN","SDECMSG")
"RTN","SDEC31",88,0)
 S SDECZ=$G(SDECMSG("DIERR",1,"TEXT",1))
"RTN","SDEC31",89,0)
 S SDRTYP=$$GET1^DIQ(409.84,SDAPID_",",.22,"I")
"RTN","SDEC31",90,0)
 I $P(SDRTYP,";",2)="GMR(123," D
"RTN","SDEC31",91,0)
 .S IEN=$$SCIEN^SDECU2(DFN,SDCL,SDT)
"RTN","SDEC31",92,0)
 .D NOSHOW^SDCNSLT(SDCL,SDT,DFN,$P(SDRTYP,";",1),IEN)     ;,AUTO,NSDIE,NSDA)
"RTN","SDEC31",93,0)
 Q
"RTN","SDEC31",94,0)
 ;
"RTN","SDEC31",95,0)
SDECNOS(SDECAPTID,SDECNS,USERIEN,SDECDATE) ;
"RTN","SDEC31",96,0)
 ;
"RTN","SDEC31",97,0)
 N SDFDA,SDECIENS
"RTN","SDEC31",98,0)
 S SDECIENS=SDECAPTID_","
"RTN","SDEC31",99,0)
 S SDFDA(409.84,SDECIENS,.1)=SDECNS ;NOSHOW
"RTN","SDEC31",100,0)
 S SDFDA(409.84,SDECIENS,.101)=$S(+SDECNS:SDECDATE,1:"")  ;NOSHOW DATE
"RTN","SDEC31",101,0)
 S SDFDA(409.84,SDECIENS,.102)=$S(+SDECNS:USERIEN,1:"")   ;NOSHOW USER
"RTN","SDEC31",102,0)
 D FILE^DIE("","SDFDA","SDECMSG")
"RTN","SDEC31",103,0)
 ;
"RTN","SDEC31",104,0)
 Q
"RTN","SDEC31",105,0)
 ;
"RTN","SDEC31",106,0)
NOSEVT(SDECPAT,SDECSTART,SDECSC) ;EP Called by SDEC NOSHOW APPOINTMENT event
"RTN","SDEC31",107,0)
 ;when appointments NOSHOW via PIMS interface.
"RTN","SDEC31",108,0)
 ;Propagates NOSHOW to SDECAPPT and raises refresh event to running GUI clients
"RTN","SDEC31",109,0)
 ;
"RTN","SDEC31",110,0)
 Q:+$G(SDECNOEV)
"RTN","SDEC31",111,0)
 Q:'+$G(SDECSC)
"RTN","SDEC31",112,0)
 ;Q:$G(SDATA("AFTER","STATUS"))["AUTO RE-BOOK"
"RTN","SDEC31",113,0)
 N SDECSTAT,SDECFOUND,SDECRES
"RTN","SDEC31",114,0)
 S SDECSTAT=1
"RTN","SDEC31",115,0)
 ;S:$G(SDATA("BEFORE","STATUS"))["NO-SHOW" SDECSTAT=0
"RTN","SDEC31",116,0)
 S SDECFOUND=0
"RTN","SDEC31",117,0)
 I $D(^SDEC(409.831,"ALOC",SDECSC)) S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0)) S SDECFOUND=$$NOSEVT1(SDECRES,SDECSTART,SDECPAT,SDECSTAT)
"RTN","SDEC31",118,0)
 I SDECFOUND D NOSEVT3(SDECRES) Q
"RTN","SDEC31",119,0)
 Q
"RTN","SDEC31",120,0)
 ;
"RTN","SDEC31",121,0)
NOSEVT1(SDECRES,SDECSTART,SDECPAT,SDECSTAT) ;
"RTN","SDEC31",122,0)
 ;Get appointment id in SDECAPT
"RTN","SDEC31",123,0)
 ;If found, call SDECNOS(SDECAPPT) and return 1
"RTN","SDEC31",124,0)
 ;else return 0
"RTN","SDEC31",125,0)
 N SDECFOUND,SDECAPPT
"RTN","SDEC31",126,0)
 S SDECFOUND=0
"RTN","SDEC31",127,0)
 Q:'+$G(SDECRES) SDECFOUND
"RTN","SDEC31",128,0)
 Q:'$D(^SDEC(409.84,"ARSRC",SDECRES,SDECSTART)) SDECFOUND
"RTN","SDEC31",129,0)
 S SDECAPPT=0 F  S SDECAPPT=$O(^SDEC(409.84,"ARSRC",SDECRES,SDECSTART,SDECAPPT)) Q:'+SDECAPPT  D  Q:SDECFOUND
"RTN","SDEC31",130,0)
 . S SDECNOD=$G(^SDEC(409.84,SDECAPPT,0)) Q:SDECNOD=""
"RTN","SDEC31",131,0)
 . I $P(SDECNOD,U,5)=SDECPAT,$P(SDECNOD,U,12)="" S SDECFOUND=1 Q
"RTN","SDEC31",132,0)
 I SDECFOUND,+$G(SDECAPPT) D SDECNOS(SDECAPPT,SDECSTAT)
"RTN","SDEC31",133,0)
 Q SDECFOUND
"RTN","SDEC31",134,0)
 ;
"RTN","SDEC31",135,0)
NOSEVT3(SDECRES) ;
"RTN","SDEC31",136,0)
 ;Call RaiseEvent to notify GUI clients
"RTN","SDEC31",137,0)
 ;
"RTN","SDEC31",138,0)
 Q
"RTN","SDEC31",139,0)
 N SDECRESN
"RTN","SDEC31",140,0)
 S SDECRESN=$G(^SDEC(409.831,SDECRES,0))
"RTN","SDEC31",141,0)
 Q:SDECRESN=""
"RTN","SDEC31",142,0)
 S SDECRESN=$P(SDECRESN,"^")
"RTN","SDEC31",143,0)
 ;D EVENT^BMXMEVN("SDEC SCHEDULE",SDECRESN)
"RTN","SDEC31",144,0)
 Q
"RTN","SDEC31",145,0)
 ;
"RTN","SDEC31",146,0)
 ;
"RTN","SDEC31",147,0)
ERR(SDECERID,ERRTXT) ;Error processing
"RTN","SDEC31",148,0)
 S:'+$G(SDECI) SDECI=999999
"RTN","SDEC31",149,0)
 S SDECI=SDECI+1
"RTN","SDEC31",150,0)
 TROLLBACK
"RTN","SDEC31",151,0)
 S ^TMP("SDEC",$J,SDECI)=SDECERID_"^"_ERRTXT_$C(30)
"RTN","SDEC31",152,0)
 S SDECI=SDECI+1
"RTN","SDEC31",153,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC31",154,0)
 Q
"RTN","SDEC31",155,0)
 ;
"RTN","SDEC31",156,0)
ETRAP ;EP Error trap entry
"RTN","SDEC31",157,0)
 D ^%ZTER
"RTN","SDEC31",158,0)
 I '$D(SDECI) N SDECI S SDECI=999999
"RTN","SDEC31",159,0)
 S SDECI=SDECI+1
"RTN","SDEC31",160,0)
 D ERR(0,"SDEC31 Error")
"RTN","SDEC31",161,0)
 Q
"RTN","SDEC31",162,0)
 ;
"RTN","SDEC31",163,0)
IMHERE(SDECRES) ;I'm Here
"RTN","SDEC31",164,0)
 ;IMHERE(SDECRES)  external parameter tag is in SDEC
"RTN","SDEC31",165,0)
 ;Entry point for SDEC IM HERE remote procedure
"RTN","SDEC31",166,0)
 ; Returns a simple value to client.  Used to establish continued existence
"RTN","SDEC31",167,0)
 ; of the client to the server; resets the server READ timeout.
"RTN","SDEC31",168,0)
 S SDECRES=1
"RTN","SDEC31",169,0)
 Q
"RTN","SDEC31",170,0)
 ;
"VER")
8.0^22.2
"BLD",10324,6)
^568
**END**
**END**

