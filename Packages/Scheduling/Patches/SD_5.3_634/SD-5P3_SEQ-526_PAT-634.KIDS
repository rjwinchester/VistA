Released SD*5.3*634 SEQ #526
Extracted from mail message
**KIDS**:SD*5.3*634^

**INSTALL NAME**
SD*5.3*634
"BLD",9945,0)
SD*5.3*634^SCHEDULING^0^3150403^y
"BLD",9945,1,0)
^^14^14^3150403^
"BLD",9945,1,1,0)
In preparation for the VA's transition from Internet Protocol version 4 
"BLD",9945,1,2,0)
(IPv4) to Internet Protocol version 6 (IPv6), the Patient Appointment 
"BLD",9945,1,3,0)
Information Transmission (PAIT) package will require modifications to 
"BLD",9945,1,4,0)
make it IPv6 ready.
"BLD",9945,1,5,0)
 
"BLD",9945,1,6,0)
IPv6 is the latest version of the Internet Protocol (IP), the 
"BLD",9945,1,7,0)
communications protocol that provides an identification and location 
"BLD",9945,1,8,0)
system for computers on networks and routes traffic across the Internet. 
"BLD",9945,1,9,0)
IPv6 was developed by the Internet Engineering Task Force (IETF) to deal 
"BLD",9945,1,10,0)
with the long-anticipated problem of IPv4 address exhaustion. IPv6 is 
"BLD",9945,1,11,0)
intended to replace IPv4.
"BLD",9945,1,12,0)
 
"BLD",9945,1,13,0)
VistA is only compatible with IPv4 currently and this effort is to 
"BLD",9945,1,14,0)
prepare for IPv6 compatibility.
"BLD",9945,4,0)
^9.64PA^^
"BLD",9945,6.3)
3
"BLD",9945,"ABPKG")
n
"BLD",9945,"KRN",0)
^9.67PA^779.2^20
"BLD",9945,"KRN",.4,0)
.4
"BLD",9945,"KRN",.401,0)
.401
"BLD",9945,"KRN",.402,0)
.402
"BLD",9945,"KRN",.403,0)
.403
"BLD",9945,"KRN",.5,0)
.5
"BLD",9945,"KRN",.84,0)
.84
"BLD",9945,"KRN",3.6,0)
3.6
"BLD",9945,"KRN",3.8,0)
3.8
"BLD",9945,"KRN",9.2,0)
9.2
"BLD",9945,"KRN",9.8,0)
9.8
"BLD",9945,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9945,"KRN",9.8,"NM",1,0)
SDRPA04^^0^B41686935
"BLD",9945,"KRN",9.8,"NM","B","SDRPA04",1)

"BLD",9945,"KRN",19,0)
19
"BLD",9945,"KRN",19.1,0)
19.1
"BLD",9945,"KRN",101,0)
101
"BLD",9945,"KRN",409.61,0)
409.61
"BLD",9945,"KRN",771,0)
771
"BLD",9945,"KRN",779.2,0)
779.2
"BLD",9945,"KRN",870,0)
870
"BLD",9945,"KRN",8989.51,0)
8989.51
"BLD",9945,"KRN",8989.52,0)
8989.52
"BLD",9945,"KRN",8994,0)
8994
"BLD",9945,"KRN","B",.4,.4)

"BLD",9945,"KRN","B",.401,.401)

"BLD",9945,"KRN","B",.402,.402)

"BLD",9945,"KRN","B",.403,.403)

"BLD",9945,"KRN","B",.5,.5)

"BLD",9945,"KRN","B",.84,.84)

"BLD",9945,"KRN","B",3.6,3.6)

"BLD",9945,"KRN","B",3.8,3.8)

"BLD",9945,"KRN","B",9.2,9.2)

"BLD",9945,"KRN","B",9.8,9.8)

"BLD",9945,"KRN","B",19,19)

"BLD",9945,"KRN","B",19.1,19.1)

"BLD",9945,"KRN","B",101,101)

"BLD",9945,"KRN","B",409.61,409.61)

"BLD",9945,"KRN","B",771,771)

"BLD",9945,"KRN","B",779.2,779.2)

"BLD",9945,"KRN","B",870,870)

"BLD",9945,"KRN","B",8989.51,8989.51)

"BLD",9945,"KRN","B",8989.52,8989.52)

"BLD",9945,"KRN","B",8994,8994)

"BLD",9945,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9945,"QUES",0)
^9.62^^
"BLD",9945,"REQB",0)
^9.611^1^1
"BLD",9945,"REQB",1,0)
SD*5.3*491^2
"BLD",9945,"REQB","B","SD*5.3*491",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
634^3150403
"PKG",16,22,1,"PAH",1,1,0)
^^14^14^3150403
"PKG",16,22,1,"PAH",1,1,1,0)
In preparation for the VA's transition from Internet Protocol version 4 
"PKG",16,22,1,"PAH",1,1,2,0)
(IPv4) to Internet Protocol version 6 (IPv6), the Patient Appointment 
"PKG",16,22,1,"PAH",1,1,3,0)
Information Transmission (PAIT) package will require modifications to 
"PKG",16,22,1,"PAH",1,1,4,0)
make it IPv6 ready.
"PKG",16,22,1,"PAH",1,1,5,0)
 
"PKG",16,22,1,"PAH",1,1,6,0)
IPv6 is the latest version of the Internet Protocol (IP), the 
"PKG",16,22,1,"PAH",1,1,7,0)
communications protocol that provides an identification and location 
"PKG",16,22,1,"PAH",1,1,8,0)
system for computers on networks and routes traffic across the Internet. 
"PKG",16,22,1,"PAH",1,1,9,0)
IPv6 was developed by the Internet Engineering Task Force (IETF) to deal 
"PKG",16,22,1,"PAH",1,1,10,0)
with the long-anticipated problem of IPv4 address exhaustion. IPv6 is 
"PKG",16,22,1,"PAH",1,1,11,0)
intended to replace IPv4.
"PKG",16,22,1,"PAH",1,1,12,0)
 
"PKG",16,22,1,"PAH",1,1,13,0)
VistA is only compatible with IPv4 currently and this effort is to 
"PKG",16,22,1,"PAH",1,1,14,0)
prepare for IPv6 compatibility.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDRPA04")
0^1^B41686935^B41493577
"RTN","SDRPA04",1,0)
SDRPA04 ;BP-OIFO/ESW - SDRPA00 continuation PAIT - REPAIR ;11/2/04 11:47am  ; 5/31/07 5:29pm
"RTN","SDRPA04",2,0)
 ;;5.3;Scheduling;**376,491,634**;Aug 13, 1993;Build 3
"RTN","SDRPA04",3,0)
 ;SD/491 - not to error out while repairing with acks having received
"RTN","SDRPA04",4,0)
 Q
"RTN","SDRPA04",5,0)
MSGT(CRUNID,SDPEN,SDFIN,SDTOT,SDSTOP) ;create completion messages
"RTN","SDRPA04",6,0)
 ;CRUNID - current run number
"RTN","SDRPA04",7,0)
 ;SDPEN  - pendings
"RTN","SDRPA04",8,0)
 ;SDFIN  - finals
"RTN","SDRPA04",9,0)
 ;SDTOT  - total
"RTN","SDRPA04",10,0)
 ;SDSTOP - task stop flag
"RTN","SDRPA04",11,0)
 N SDB,SDTRF
"RTN","SDRPA04",12,0)
 I '$D(SDTOT) S SDTOT=SDPEN+SDFIN
"RTN","SDRPA04",13,0)
 N SFF S SFF=0
"RTN","SDRPA04",14,0)
 I +SDTOT=0 S (SDPEN,SDFIN)=0,SFF=1
"RTN","SDRPA04",15,0)
 I '$D(SDPEN),'$D(SDFIN) S (SDPEN,SDFIN)="undetermined",SFF=1
"RTN","SDRPA04",16,0)
 N SDB,SDTRF
"RTN","SDRPA04",17,0)
 S SDB=SDTOT\5000 I SDTOT-(5000*SDB)>0 S SDB=SDB+1 ;# of batches
"RTN","SDRPA04",18,0)
 N NOW S NOW=$$NOW^XLFDT S SDTRF=$$FMTE^XLFDT(NOW,2),SDTRF=$P(SDTRF,":",1,2)
"RTN","SDRPA04",19,0)
 N DA,DIE,DR D
"RTN","SDRPA04",20,0)
 .S DA=CRUNID,DIE=409.6,DR="1.3///"_SDTOT_";1.4///"_SDB_";1.5///"_NOW D ^DIE
"RTN","SDRPA04",21,0)
 D CLEAN(CRUNID)
"RTN","SDRPA04",22,0)
 N SDS,SDSTAT,SDIP,SDAR,SDAP,SDMT,SDMS,SD870
"RTN","SDRPA04",23,0)
 ;SDS - STATION #
"RTN","SDRPA04",24,0)
 ;SDSTAT - SD-PAIT STATUS
"RTN","SDRPA04",25,0)
 ;SDIP   - IP ADDRESS
"RTN","SDRPA04",26,0)
 ;SDAR   - COMMIT ACK RECEIVED
"RTN","SDRPA04",27,0)
 ;SDAP   - COMMIT ACK PROCESSED
"RTN","SDRPA04",28,0)
 ;SDMT   - MESSAGES (BATCHES) TO SEND
"RTN","SDRPA04",29,0)
 ;SDMS   - MESSAGES (BATCHES) SENT
"RTN","SDRPA04",30,0)
 S SD870=$O(^HLCS(870,"B","SD-PAIT",""))
"RTN","SDRPA04",31,0)
 N ARRAY D GETS^DIQ(870,SD870_",","4;5;6;7;8;400.01","I","ARRAY")
"RTN","SDRPA04",32,0)
 N SD87 S SD87=SD870_","
"RTN","SDRPA04",33,0)
 S SDSTAT=ARRAY(870,SD87,4,"I")
"RTN","SDRPA04",34,0)
 S SDAR=ARRAY(870,SD87,5,"I")
"RTN","SDRPA04",35,0)
 S SDAP=ARRAY(870,SD87,6,"I")
"RTN","SDRPA04",36,0)
 S SDMS=ARRAY(870,SD87,7,"I")
"RTN","SDRPA04",37,0)
 S SDMT=ARRAY(870,SD87,8,"I")
"RTN","SDRPA04",38,0)
 S SDIP=ARRAY(870,SD87,400.01,"I")
"RTN","SDRPA04",39,0)
 S SDS=$P($$SITE^VASITE(),"^",3)
"RTN","SDRPA04",40,0)
 ;S SDS=$E($O(^SDWL(409.6,"AMSG","")),1,3)
"RTN","SDRPA04",41,0)
 N SDBT,STSK,SDSL ; Starting and Last scanned date
"RTN","SDRPA04",42,0)
 S SDBT=$P(^SDWL(409.6,CRUNID,0),U),SDSL=$P(^SDWL(409.6,CRUNID,0),U,4)
"RTN","SDRPA04",43,0)
 S STSK=$P(^SDWL(409.6,CRUNID,0),U,2)
"RTN","SDRPA04",44,0)
 S SDBT=$$FMTE^XLFDT(SDBT,2),SDSL=$$FMTE^XLFDT(SDSL,2)
"RTN","SDRPA04",45,0)
MSG ;send mail message
"RTN","SDRPA04",46,0)
 N SDAMX,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDRPA04",47,0)
 S XMSUB=$G(SDS)_" - PAIT BACKGROUND JOB"
"RTN","SDRPA04",48,0)
 S XMY("G.SD-PAIT")=""
"RTN","SDRPA04",49,0)
 S XMY("S.SD-PAIT-SERVER@FORUM.DOMAIN.EXT")=""
"RTN","SDRPA04",50,0)
 S XMTEXT="SDAMX("
"RTN","SDRPA04",51,0)
 S DUZ=""
"RTN","SDRPA04",52,0)
 S XMDUZ="POSTMASTER"
"RTN","SDRPA04",53,0)
 S SDAMX(1)=""
"RTN","SDRPA04",54,0)
 S SDAMX(2)="The PAIT job has completed - TASK #: "_STSK_" Log #: "_CRUNID_" on "_SDTRF
"RTN","SDRPA04",55,0)
 S SDAMX(3)="Started: "_SDBT_"                        Last Scanned: "_SDSL
"RTN","SDRPA04",56,0)
 S SDAMX(4)="Pending appointments: "_$J(SDPEN,10)
"RTN","SDRPA04",57,0)
 S SDAMX(5)="Final appointments:   "_$J(SDFIN,10)
"RTN","SDRPA04",58,0)
 S SDAMX(6)="                       ----------"
"RTN","SDRPA04",59,0)
 S SDAMX(7)="Total appointments:   "_$J(SDTOT,10)_"   Number of batches: "_SDB
"RTN","SDRPA04",60,0)
 S SDAMX(8)=""
"RTN","SDRPA04",61,0)
 S SDAMX(9)="Fac Log Bch Appt #  Date finished   IP Address  "
"RTN","SDRPA04",62,0)
 S SDAMX(10)="Gen  Sent Com R Com P  Status"
"RTN","SDRPA04",63,0)
 S SDAMX(11)="------------------------------------------------------------------------------"
"RTN","SDRPA04",64,0)
 S SDAMX(12)=SDS_"|"_$J(CRUNID,3)_"|"_$J(SDB,3)_"|"_$J(SDTOT,7)_"|"_SDTRF_"|"_$E(SDIP,1,39)_"|"
"RTN","SDRPA04",65,0)
 S SDAMX(13)=$J(SDMT,4)_"|"_$J(SDMS,4)_"|"_$J(SDAR,4)_"|"_$J(SDAP,4)_"| "_SDSTAT
"RTN","SDRPA04",66,0)
 S SDAMX(14)=""
"RTN","SDRPA04",67,0)
 I $G(SDSTOP) S XMY("VHACIONHD@DOMAIN.EXT")="" D  D ^XMD Q
"RTN","SDRPA04",68,0)
 .S SDAMX(15)="WARNING: TASK STOPPED BY USER, NEEDS TO BE RESTARTED."
"RTN","SDRPA04",69,0)
 .S SDAMX(16)="Initiate a Remedy ticket TO FOLLOW UP."
"RTN","SDRPA04",70,0)
 I 'SFF I SDMT>0!(SDB=0) D  D ^XMD K ^TMP("SDDPT",$J) Q
"RTN","SDRPA04",71,0)
 .I (SDMT-SDMS)=0 D  Q
"RTN","SDRPA04",72,0)
 ..S SDAMX(15)="SUCCESS: Transmission completed."
"RTN","SDRPA04",73,0)
 .I (SDMT-SDMS)<SDB!(SDB=1&(SDMT-SDMS)'<SDB)&(SDSTAT'["Shutdown") D  Q
"RTN","SDRPA04",74,0)
 ..S SDAMX(15)="WARNING: "_(SDMT-SDMS)_" out of "_SDB_" batches still have to be transmitted,"
"RTN","SDRPA04",75,0)
 ..S SDAMX(16)="please verify with the HL7 System Monitor."
"RTN","SDRPA04",76,0)
 .S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",77,0)
 .I SDB>0 I (SDMT-SDMS)'<SDB D  Q
"RTN","SDRPA04",78,0)
 ..S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",79,0)
 ..I SDSTAT["Shutdown" D
"RTN","SDRPA04",80,0)
 ...S SDAMX(15)="SD-PAIT Logical Link has to be started, initiate Remedy ticket for Scheduling PAIT."
"RTN","SDRPA04",81,0)
 ..E  S SDAMX(15)="Initiate a Remedy ticket for Interface Engine - communication problem."
"RTN","SDRPA04",82,0)
 I SFF D  D ^XMD K ^TMP("SDDPT",$J) Q
"RTN","SDRPA04",83,0)
 .S SDAMX(15)="WARNING!!!: Transmission of run#: "_CRUNID_" has been repaired, you may restart."
"RTN","SDRPA04",84,0)
 .I SDB>0 I (SDMT-SDMS)'<SDB D
"RTN","SDRPA04",85,0)
 ..S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",86,0)
 ..I SDSTAT["Shutdown" D  Q
"RTN","SDRPA04",87,0)
 ...S SDAMX(16)="SD-PAIT Logical Link has to be started, initiate Remedy ticket for Scheduling PAIT."
"RTN","SDRPA04",88,0)
 ..S SDAMX(16)="Initiate a Remedy ticket for Interface Engine - communication problem."
"RTN","SDRPA04",89,0)
 Q
"RTN","SDRPA04",90,0)
CLEAN(CRUNID) ;housekeeping
"RTN","SDRPA04",91,0)
 ;clean up batches previous to current one by checking for "AE",("S" or "R") xref and
"RTN","SDRPA04",92,0)
 ;deleting if entry in xref exists
"RTN","SDRPA04",93,0)
 ;RUN  :  run #           (ien of multiple entry)
"RTN","SDRPA04",94,0)
 ;V1   :  previous run #  (ien of multiple entry)  
"RTN","SDRPA04",95,0)
 ;V2   :  ien           (ien in multiple)
"RTN","SDRPA04",96,0)
 N V1,V2,V3,ZNODE,DIK
"RTN","SDRPA04",97,0)
 S V1=CRUNID F  S V1=$O(^SDWL(409.6,V1),-1) Q:'V1  D
"RTN","SDRPA04",98,0)
 .F V3="R","S" S V2=0 F  S V2=$O(^SDWL(409.6,"AE",V3,V1,V2)) Q:'V2  D
"RTN","SDRPA04",99,0)
 ..S ZNODE=$G(^SDWL(409.6,V1,1,V2,0))
"RTN","SDRPA04",100,0)
 ..S ^XTMP("SDRPA-"_$P(ZNODE,"^",3),0)=$$HTFM^XLFDT($H+7,1)_U_$$HTFM^XLFDT($H,1)
"RTN","SDRPA04",101,0)
 ..S DIK="^SDWL(409.6,"_V1_",1,"
"RTN","SDRPA04",102,0)
 ..S DA(1)=V1,DA=V2 D ^DIK
"RTN","SDRPA04",103,0)
 ..S ^XTMP("SDRPA-"_$P(ZNODE,"^",3),"CLEAN",+$P(ZNODE,"^",4),0)=ZNODE ;diagnostics
"RTN","SDRPA04",104,0)
 Q
"RTN","SDRPA04",105,0)
RPAIT(RUN) ;
"RTN","SDRPA04",106,0)
 ;RUN - run number - entry ^SDWL(409.6,RUN,0) to be repaired
"RTN","SDRPA04",107,0)
 Q:+$G(RUN)'>1
"RTN","SDRPA04",108,0)
 W !,"The repairing in progress...",!
"RTN","SDRPA04",109,0)
 N SDE,SDEB,SDFE,SDLSD,SDRCNT,ZTSK
"RTN","SDRPA04",110,0)
 S SDE=$G(^SDWL(409.6,RUN,0)) Q:SDE=""
"RTN","SDRPA04",111,0)
 S ZTSK=$P(SDE,"^",2) D STAT^%ZTLOAD I ZTSK(1)=1!(ZTSK(1)=2) W !,"Task "_ZTSK_"is still active!" Q
"RTN","SDRPA04",112,0)
 S SDEB=+$P(SDE,"^",3) ; last batch # submitted to HL7
"RTN","SDRPA04",113,0)
 S SDRCNT=$O(^SDWL(409.6,RUN,1,999999999),-1) ;last entry
"RTN","SDRPA04",114,0)
 I SDEB=0 S SDFE=0 S $P(^SDWL(409.6,RUN,0),U,4)=$P(^SDWL(409.6,RUN-1,0),U,4)
"RTN","SDRPA04",115,0)
 I +SDEB>0 D
"RTN","SDRPA04",116,0)
 .S SDFE=SDRCNT+1 F  S SDFE=$O(^SDWL(409.6,RUN,1,SDFE),-1) I $P(^SDWL(409.6,RUN,1,SDFE,0),U,3)'>SDEB&($P(^SDWL(409.6,RUN,1,SDFE,0),U,3)'="") Q  ; SD/491
"RTN","SDRPA04",117,0)
 .N SDLSD1 S SDLSD1=$P(^SDWL(409.6,RUN,1,SDFE,0),U,7) ;retrieve the last used creation date of HL7 created 
"RTN","SDRPA04",118,0)
 .N SDLSD2 S SDLSD2=$P($G(^SDWL(409.6,RUN,1,SDFE+1,0)),U,7)
"RTN","SDRPA04",119,0)
 .S SDLSD=$P(SDE,U,4) ; last scanned date
"RTN","SDRPA04",120,0)
 .I SDLSD="" D
"RTN","SDRPA04",121,0)
 ..S $P(^SDWL(409.6,RUN,0),U,4)=$S(SDLSD2>SDLSD1:SDLSD1,1:SDLSD1-1)
"RTN","SDRPA04",122,0)
 .E  S $P(^SDWL(409.6,RUN,0),U,4)=SDLSD-1
"RTN","SDRPA04",123,0)
 N SDS,DIK F SDS=SDFE+1:1:SDRCNT I $D(^SDWL(409.6,RUN,1,SDS,0)) D EVAL(RUN,SDS) S DIK="^SDWL(409.6,"_RUN_",1,",DA(1)=RUN,DA=SDS D ^DIK
"RTN","SDRPA04",124,0)
 S SDB=+$P($G(^SDWL(409.6,RUN,2,0)),U,3)
"RTN","SDRPA04",125,0)
 S NOW=$$NOW^XLFDT,SDFE=5000*SDB
"RTN","SDRPA04",126,0)
 S $P(^SDWL(409.6,RUN,0),U,5)=SDFE
"RTN","SDRPA04",127,0)
 S $P(^SDWL(409.6,RUN,0),U,6)=SDB
"RTN","SDRPA04",128,0)
 S $P(^SDWL(409.6,RUN,0),U,7)=NOW
"RTN","SDRPA04",129,0)
 D MSGT(RUN,,,SDFE)
"RTN","SDRPA04",130,0)
 W !!,"The last run number has been repaired, you may ONE TIME QUEUE the next one.",!
"RTN","SDRPA04",131,0)
 Q
"RTN","SDRPA04",132,0)
EVAL(RUN,SDS) ;
"RTN","SDRPA04",133,0)
 ;evaluate if to update any 'S' or 'R' Retention Flags for
"RTN","SDRPA04",134,0)
 ;the previous entry if exists.
"RTN","SDRPA04",135,0)
 N SDSTR,DFN,SDDT S SDSTR=^SDWL(409.6,RUN,1,SDS,0)
"RTN","SDRPA04",136,0)
 S DFN=+SDSTR,SDDT=$P(SDSTR,"^",2)
"RTN","SDRPA04",137,0)
 Q:SDDT=""
"RTN","SDRPA04",138,0)
 ;find a prior entry SDRUN
"RTN","SDRPA04",139,0)
 N SDRUN S SDRUN=$O(^SDWL(409.6,"AC",DFN,SDDT,RUN),-1) Q:SDRUN=""
"RTN","SDRPA04",140,0)
 N SDSQ S SDSQ=$O(^SDWL(409.6,"AC",DFN,SDDT,SDRUN,""))
"RTN","SDRPA04",141,0)
 N SDSTRP S SDSTRP=^SDWL(409.6,SDRUN,1,SDSQ,0)
"RTN","SDRPA04",142,0)
 N SDRET S SDRET=$P(SDSTRP,"^",5)
"RTN","SDRPA04",143,0)
 I SDRET="S"!(SDRET="R") N DIC D
"RTN","SDRPA04",144,0)
 .S SDRET="Y",DIC="^SDWL(409.6,"_SDRUN_",1,",DA(1)=SDRUN,DA=SDSQ,DIE=DIC,DR="4///"_SDRET D ^DIE
"RTN","SDRPA04",145,0)
 Q
"VER")
8.0^22.0
"BLD",9945,6)
^526
**END**
**END**

