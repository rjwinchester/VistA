Released SD*5.3*641 SEQ #539
Extracted from mail message
**KIDS**:SD*5.3*641^

**INSTALL NAME**
SD*5.3*641
"BLD",10063,0)
SD*5.3*641^SCHEDULING^0^3160223^y
"BLD",10063,1,0)
^^8^8^3160223^^
"BLD",10063,1,1,0)
This patch release includes two bug fixes:
"BLD",10063,1,2,0)
 
"BLD",10063,1,3,0)
1. Fixes an issue that caused patient's Date of Death warning message not
"BLD",10063,1,4,0)
   always showing when changing to a different patient in the Appointment
"BLD",10063,1,5,0)
   Management.
"BLD",10063,1,6,0)
 
"BLD",10063,1,7,0)
2. Fixes an issue that prevented clinic's telephone number from printing
"BLD",10063,1,8,0)
   an extra character on a scheduling letter.
"BLD",10063,4,0)
^9.64PA^^
"BLD",10063,6.3)
4
"BLD",10063,"ABPKG")
n
"BLD",10063,"KRN",0)
^9.67PA^779.2^20
"BLD",10063,"KRN",.4,0)
.4
"BLD",10063,"KRN",.401,0)
.401
"BLD",10063,"KRN",.402,0)
.402
"BLD",10063,"KRN",.403,0)
.403
"BLD",10063,"KRN",.5,0)
.5
"BLD",10063,"KRN",.84,0)
.84
"BLD",10063,"KRN",3.6,0)
3.6
"BLD",10063,"KRN",3.8,0)
3.8
"BLD",10063,"KRN",9.2,0)
9.2
"BLD",10063,"KRN",9.8,0)
9.8
"BLD",10063,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10063,"KRN",9.8,"NM",1,0)
SDAM10^^0^B9911529
"BLD",10063,"KRN",9.8,"NM",2,0)
SDCP^^0^B26248762
"BLD",10063,"KRN",9.8,"NM",3,0)
SDLT^^0^B28779463
"BLD",10063,"KRN",9.8,"NM","B","SDAM10",1)

"BLD",10063,"KRN",9.8,"NM","B","SDCP",2)

"BLD",10063,"KRN",9.8,"NM","B","SDLT",3)

"BLD",10063,"KRN",19,0)
19
"BLD",10063,"KRN",19.1,0)
19.1
"BLD",10063,"KRN",101,0)
101
"BLD",10063,"KRN",409.61,0)
409.61
"BLD",10063,"KRN",771,0)
771
"BLD",10063,"KRN",779.2,0)
779.2
"BLD",10063,"KRN",870,0)
870
"BLD",10063,"KRN",8989.51,0)
8989.51
"BLD",10063,"KRN",8989.52,0)
8989.52
"BLD",10063,"KRN",8994,0)
8994
"BLD",10063,"KRN","B",.4,.4)

"BLD",10063,"KRN","B",.401,.401)

"BLD",10063,"KRN","B",.402,.402)

"BLD",10063,"KRN","B",.403,.403)

"BLD",10063,"KRN","B",.5,.5)

"BLD",10063,"KRN","B",.84,.84)

"BLD",10063,"KRN","B",3.6,3.6)

"BLD",10063,"KRN","B",3.8,3.8)

"BLD",10063,"KRN","B",9.2,9.2)

"BLD",10063,"KRN","B",9.8,9.8)

"BLD",10063,"KRN","B",19,19)

"BLD",10063,"KRN","B",19.1,19.1)

"BLD",10063,"KRN","B",101,101)

"BLD",10063,"KRN","B",409.61,409.61)

"BLD",10063,"KRN","B",771,771)

"BLD",10063,"KRN","B",779.2,779.2)

"BLD",10063,"KRN","B",870,870)

"BLD",10063,"KRN","B",8989.51,8989.51)

"BLD",10063,"KRN","B",8989.52,8989.52)

"BLD",10063,"KRN","B",8994,8994)

"BLD",10063,"QDEF")
^^^^NO^^^^^^YES
"BLD",10063,"QUES",0)
^9.62^^
"BLD",10063,"REQB",0)
^9.611^2^2
"BLD",10063,"REQB",1,0)
SD*5.3*635^2
"BLD",10063,"REQB",2,0)
SD*5.3*491^2
"BLD",10063,"REQB","B","SD*5.3*491",2)

"BLD",10063,"REQB","B","SD*5.3*635",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
641^3160223
"PKG",16,22,1,"PAH",1,1,0)
^^8^8^3160223
"PKG",16,22,1,"PAH",1,1,1,0)
This patch release includes two bug fixes:
"PKG",16,22,1,"PAH",1,1,2,0)
 
"PKG",16,22,1,"PAH",1,1,3,0)
1. Fixes an issue that caused patient's Date of Death warning message not
"PKG",16,22,1,"PAH",1,1,4,0)
   always showing when changing to a different patient in the Appointment
"PKG",16,22,1,"PAH",1,1,5,0)
   Management.
"PKG",16,22,1,"PAH",1,1,6,0)
 
"PKG",16,22,1,"PAH",1,1,7,0)
2. Fixes an issue that prevented clinic's telephone number from printing
"PKG",16,22,1,"PAH",1,1,8,0)
   an extra character on a scheduling letter.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDAM10")
0^1^B9911529^B8926237
"RTN","SDAM10",1,0)
SDAM10 ;ALB/MJK - Appt Mgt (Patient cont.);3/18/05 3:51pm
"RTN","SDAM10",2,0)
 ;;5.3;Scheduling;**189,258,403,478,491,641**;Aug 13, 1993;Build 4
"RTN","SDAM10",3,0)
 ;
"RTN","SDAM10",4,0)
HDR ; -- list screen header
"RTN","SDAM10",5,0)
 ;   input:       SDFN := ifn of pat
"RTN","SDAM10",6,0)
 ;  output:  VALMHDR() := hdr array
"RTN","SDAM10",7,0)
 ;
"RTN","SDAM10",8,0)
 N VAERR,VA,X
"RTN","SDAM10",9,0)
 S DFN=SDFN D PID^VADPT
"RTN","SDAM10",10,0)
 S VALMHDR(1)=$E($P("Patient: "_$G(^DPT(SDFN,0)),U),1,46)_" ("_VA("BID")_")"  ;for proper display of patient name for SD*5.3*189
"RTN","SDAM10",11,0)
 S X=$P($$FMT^SDUTL2(SDFN),U,2),X=$S(X["GMT":X,X]"":"MT: "_X,1:"")
"RTN","SDAM10",12,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,VALMHDR(1),47,15)  ;repositioned header to display clinic or patient name properly for SD*5.3*189
"RTN","SDAM10",13,0)
 S X=$S($D(^DPT(SDFN,.1)):"Ward: "_^(.1),1:"Outpatient")
"RTN","SDAM10",14,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,VALMHDR(1),81-$L(X),$L(X))
"RTN","SDAM10",15,0)
 Q
"RTN","SDAM10",16,0)
 ;
"RTN","SDAM10",17,0)
PAT ; -- change pat
"RTN","SDAM10",18,0)
 K TMP ;SD/478
"RTN","SDAM10",19,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","SDAM10",20,0)
 K X I $D(XQORNOD(0)) S X=$P($P(XQORNOD(0),U,4),"=",2)
"RTN","SDAM10",21,0)
 N SDUP
"RTN","SDAM10",22,0)
 I $D(X),X="" R !!,"Select Patient: ",X:DTIME
"RTN","SDAM10",23,0)
 D RT^SDAMEX S DIC="^DPT(",DIC(0)="EMQ" D ^DIC K DIC G PAT:X["?"
"RTN","SDAM10",24,0)
PAT1 S %=1 I Y>0 W !,"   ...OK" D YN^DICN I %=0 W "   Answer with 'Yes' or 'No'" G PAT1
"RTN","SDAM10",25,0)
 I %'=1 S Y=-1
"RTN","SDAM10",26,0)
 I Y<0 D  G PATQ
"RTN","SDAM10",27,0)
 .I $G(DFN)>0,SDAMTYP="P" S VALMSG=$C(7)_"Patient has not been changed."
"RTN","SDAM10",28,0)
 .I $G(DFN)'>0,SDAMTYP="P" S VALMSG=$C(7)_"Patient has not been selected."
"RTN","SDAM10",29,0)
 .I SDAMTYP="C" S VALMSG=$C(7)_"View of clinic remains in affect."
"RTN","SDAM10",30,0)
 .W !!,$G(VALMSG) H 1
"RTN","SDAM10",31,0)
 I SDAMTYP'="P" D CHGCAP^VALM("NAME","Clinic") S SDAMTYP="P"
"RTN","SDAM10",32,0)
 ;S (DFN,SDFN)=+Y K SDCLN,VADM D DEM^VADPT D BLD^SDAM1 ;SD/491
"RTN","SDAM10",33,0)
 S (DFN,SDFN)=+Y K SDCLN,VADM D DEM^VADPT
"RTN","SDAM10",34,0)
 I +VADM(6) D  G:SDUP="^" PAT   ;SD*641 - Display DoD if exists.
"RTN","SDAM10",35,0)
 . W !!,"WARNING ",VADM(7),!!
"RTN","SDAM10",36,0)
 . R "Press Return to Continue or ^ to Quit: ",SDUP:DTIME
"RTN","SDAM10",37,0)
 D BLD^SDAM1
"RTN","SDAM10",38,0)
PATQ Q
"RTN","SDAM10",39,0)
 ;
"RTN","SDAM10",40,0)
INIT ; -- init bld vars
"RTN","SDAM10",41,0)
 K VALMHDR,SDDA,^TMP("SDAMIDX",$J)
"RTN","SDAM10",42,0)
 D CLEAN^VALM10
"RTN","SDAM10",43,0)
 S VALMBG=1,(VALMCNT,SDACNT)=0,BL="",$P(BL," ",30)="",SDMAX=100
"RTN","SDAM10",44,0)
 S SDAMDD=$P(^DD(2.98,3,0),U,3)
"RTN","SDAM10",45,0)
 ; -- format vars     |- column -| |- width -|
"RTN","SDAM10",46,0)
 S X=VALMDDF("APPT#"),AC=$P(X,U,2),AW=$P(X,U,3) ; A for appt
"RTN","SDAM10",47,0)
 S X=VALMDDF("DATE"),XC=$P(X,U,2),XW=$P(X,U,3) ;  X for date
"RTN","SDAM10",48,0)
 S X=VALMDDF("NAME"),NC=$P(X,U,2),NW=$P(X,U,3) ;  N for name
"RTN","SDAM10",49,0)
 S X=VALMDDF("STAT"),SC=$P(X,U,2),SW=$P(X,U,3) ;  S for status
"RTN","SDAM10",50,0)
 S X=VALMDDF("TIME"),TC=$P(X,U,2),TW=$P(X,U,3) ;  T for time
"RTN","SDAM10",51,0)
 S (CC,CW)="",X=$G(VALMDDF("CONSULT")) I X'="" S CC=$P(X,U,2),CW=$P(X,U,3) ;  C for Consult ;SD/478
"RTN","SDAM10",52,0)
 Q
"RTN","SDAM10",53,0)
 ;
"RTN","SDAM10",54,0)
LARGE ; -- too large note
"RTN","SDAM10",55,0)
 W !!?5,*7,"Note: Ending Date was changed to '",$$FDATE^VALM1(SDEND),"' because"
"RTN","SDAM10",56,0)
 W !?11,"too many appointments met date range criteria." D PAUSE^VALM1
"RTN","SDAM10",57,0)
 Q
"RTN","SDAM10",58,0)
 ;
"RTN","SDAM10",59,0)
NUL ; -- set nul message
"RTN","SDAM10",60,0)
 I '$O(^TMP("SDAM",$J,0)) D SET^SDAM1(" "),SET^SDAM1("    No appointments meet criteria.")
"RTN","SDAM10",61,0)
 Q
"RTN","SDAM10",62,0)
 ;
"RTN","SDCP")
0^2^B26248762^B26039984
"RTN","SDCP",1,0)
SDCP ;BSN/GRR - CLINIC LIST ;15 MAR 1999 4:10 PM
"RTN","SDCP",2,0)
 ;;5.3;Scheduling;**140,171,187,354,622,635,641**;Aug 13, 1993;Build 4
"RTN","SDCP",3,0)
 D ASK2^SDDIV G:Y<0 END S VAUTNI=1 D CLINIC^VAUTOMA G:Y<0 END
"RTN","SDCP",4,0)
QUE N ZTSAVE F Y="VAUTD","VAUTD(","VAUTC","VAUTC(" S ZTSAVE(Y)=""
"RTN","SDCP",5,0)
 D EN^XUTMDEVQ("START^SDCP","Clinic Profile",.ZTSAVE) Q
"RTN","SDCP",6,0)
 ;
"RTN","SDCP",7,0)
START ;Print report
"RTN","SDCP",8,0)
 ; SD*5.3*622 - SDPRTTOF helps prevent double printing of Header
"RTN","SDCP",9,0)
 N SDPRTTOF S SDPRTTOF=1
"RTN","SDCP",10,0)
 S END=0 D:'$D(DT) DT^SDUTL
"RTN","SDCP",11,0)
 S Y=DT D DTS^SDUTL S PDATE=Y,SCN=0 D TOF G:'VAUTC SOME
"RTN","SDCP",12,0)
 F  S SCN=$O(^SC("B",SCN)) Q:SCN=""!(END)  S SC=$O(^SC("B",SCN,0)) D:$$CHECK() SET0,SETSL,PRT
"RTN","SDCP",13,0)
 G END
"RTN","SDCP",14,0)
 ;
"RTN","SDCP",15,0)
SOME F  S SCN=$O(VAUTC(SCN)) Q:SCN=""!(END)  S SC=+VAUTC(SCN) D:$$CHECK() SET0,SETSL,PRT
"RTN","SDCP",16,0)
 G END
"RTN","SDCP",17,0)
 ;
"RTN","SDCP",18,0)
END W ! I $E(IOST)="C",'$G(END,1) N DIR S DIR(0)="E" D ^DIR
"RTN","SDCP",19,0)
 K ABBR,ALV,C,DAYS,DIC,DIPH,DOW,END,HCDB,I,J,L,LOC,LOP,M,NAME,ODM,PC,PDATE,POP,SC,SCSC,SDSC,SDMX,SDNO,SDNO,SDC,SDCR,SCSC,SCN,SDIN,SDPR,SDRE,STCD,STDAT,X,Y,SD,SDCNT,VAUTC,VAUTD,VAUTNI,STRING,SDPTI Q
"RTN","SDCP",20,0)
 ;
"RTN","SDCP",21,0)
SET0 S STRING=^SC(SC,0)
"RTN","SDCP",22,0)
 S NAME=$P(STRING,U,1),ABBR=$P(STRING,U,2),LOC=$P(STRING,U,11),(STCD,SDSC)=$P(STRING,U,7),SDCR=$P(STRING,U,18),SDCNT=$P(STRING,U,17)
"RTN","SDCP",23,0)
 S:$D(^SC(SC,"SDP")) SDMX=$P(^SC(SC,"SDP"),U,2) S SDPTI=$G(^SC(SC,"PA")) Q
"RTN","SDCP",24,0)
 ;
"RTN","SDCP",25,0)
SETSL S (LOP,HCDB,ALV,PC,ODM,DIPH,STDAT,STRING)="",STCD=$S(STCD="":" ",1:STCD),STCD=$S('$D(^DIC(40.7,+STCD,0)):"",1:$P(^(0),U,2)),SDSC=$S($D(^DIC(40.7,+SDSC,0)):'$P(^(0),U,3)!($P(^(0),U,3)>DT),1:0)
"RTN","SDCP",26,0)
 S SDPR=$S('$D(^SC(SC,"SDPROT")):"NO",'$L($P(^("SDPROT"),U)):"NO",1:"YES")
"RTN","SDCP",27,0)
 S SDCR=$S(SDCR="":" ",1:SDCR),SDCR=$S('$D(^DIC(40.7,+SDCR,0)):"",1:$P(^(0),U,2))
"RTN","SDCP",28,0)
 I $D(^SC(SC,"SL")) S STRING=^("SL"),LOP=$P(STRING,U,1),HCDB=$P(STRING,U,3),ALV=$S($P(STRING,U,2)["V":"YES",1:"NO")
"RTN","SDCP",29,0)
 I  S PC=$S($P(STRING,U,5)]"":$P(^SC($P(STRING,U,5),0),U,1),1:""),ODM=$P(STRING,U,7),DIPH=$S($P(STRING,U,6)=4:15,$P(STRING,U,6)=3:20,$P(STRING,U,6)=1:60,$P(STRING,U,6)=2:30,1:10)
"RTN","SDCP",30,0)
 S STDAT=$O(^SC(SC,"T",0)) S:STDAT<1 STDAT="UNKNOWN"
"RTN","SDCP",31,0)
 K DOW F L=0:1:6 F M=DT-.1:0 S M=$O(^SC(SC,"T"_L,M)) Q:M=""  I $D(^(M,1)) S:^(1)]"" DOW(L+1)="" Q:^(1)]""  K DOW(L+1)
"RTN","SDCP",32,0)
 F L=DT-.1:0 S L=$O(^SC(SC,"T",L)) Q:L=""  S X=L D DW^%DTC I '$D(DOW(Y+1)),$D(^SC(SC,"OST",L,1)),^(1)["[" S DOW(Y+1)=""
"RTN","SDCP",33,0)
 S DAYS="" F M=1:1:7 I $D(DOW(M)) S DAYS=DAYS_$S(DAYS'="":",",1:"")_$P("SU^MO^TU^WE^TH^FR^SA",U,M)
"RTN","SDCP",34,0)
 Q
"RTN","SDCP",35,0)
 ;
"RTN","SDCP",36,0)
L(SDT,SDCOL,SDVAL) ;Print field label
"RTN","SDCP",37,0)
 ;Input: SDT=field label
"RTN","SDCP",38,0)
 ;Input: SDCOL=column to line up to
"RTN","SDCP",39,0)
 ;Input: SDVAL=field value
"RTN","SDCP",40,0)
 W ?(SDCOL-$L(SDT)-2),SDT,": ",SDVAL Q
"RTN","SDCP",41,0)
 ;
"RTN","SDCP",42,0)
PRT I $Y+13>IOSL D:IOSL<25 SEEND:$E(IOST,1,2)="C-" Q:END  D TOF
"RTN","SDCP",43,0)
 S SDNO="" W ! D L("Clinic",19,NAME),L("Abbr.",62,ABBR)
"RTN","SDCP",44,0)
 S SDPRTTOF=1   ; SD*5.3*622 - SDPRTTOF helps prevent double Headers
"RTN","SDCP",45,0)
 ; SD*5.3*641 - get 1st piece of 99 node
"RTN","SDCP",46,0)
 W ! D L("Location",19,$E(LOC,1,30)),L("Telephone",62,$S($D(^SC(SC,99)):$P($G(^SC(SC,99)),U),1:""))
"RTN","SDCP",47,0)
 ; SD*5.3*622 - add new field telephone extension
"RTN","SDCP",48,0)
 W ! D L("Telephone Ext.",19,$S($D(^SC(SC,99.1)):^SC(SC,99.1),1:""))
"RTN","SDCP",49,0)
 ; SD*5.3*635 - add new fields #60-62
"RTN","SDCP",50,0)
 N DIWL,DIWF K ^UTILITY($J,"W") S DIWL=1,DIWF="C55" S X=$P(SDPTI,U) D ^DIWP
"RTN","SDCP",51,0)
 W ! D L("Pat Friendly Name",19,$G(^UTILITY($J,"W",1,1,0)))
"RTN","SDCP",52,0)
 I $G(^UTILITY($J,"W",1,2,0))'="" W ! D L(" ",19,$G(^UTILITY($J,"W",1,2,0)))
"RTN","SDCP",53,0)
 K ^UTILITY($J,"W") W ! D L("Direct Pat Schlng",19,$S($P(SDPTI,U,2)="N":"NO",$P(SDPTI,U,2)="Y":"YES",1:""))
"RTN","SDCP",54,0)
 D L("Display Clin Appt To Patients",62,$S($P(SDPTI,U,3)="N":"NO",$P(SDPTI,U,3)="Y":"YES",1:""))
"RTN","SDCP",55,0)
 W ! D L("Days clinic meets",19,DAYS) I 'SDNO S Y=STDAT D:STDAT'="UNKNOWN" DTS^SDUTL
"RTN","SDCP",56,0)
 D L("Start date",62,$S(STDAT="UNKNOWN":"UNKNOWN",1:Y))
"RTN","SDCP",57,0)
 W ! D L("Increments",19,DIPH_" Minutes"),L("Hour display begins",62,$S(HCDB="":"8 AM",HCDB<13:HCDB_" AM",1:HCDB-12_" PM"))
"RTN","SDCP",58,0)
 W ! D L("Appt. length",19,LOP_" Minutes"),L("Variable length appts.",62,ALV)
"RTN","SDCP",59,0)
 W ! D L("Stop Code",19,STCD),L("Maximum overbooks per day",62,ODM)
"RTN","SDCP",60,0)
 W ! D L("Credit Stop Code",19,SDCR),L("Non-count clinic",62,$S(SDCNT="Y":"YES",1:"NO"))
"RTN","SDCP",61,0)
 W ! D L("Prohibit access",19,SDPR),L("Maximum days for future booking",62,$G(SDMX))
"RTN","SDCP",62,0)
 I PC]"" W ! D L("Principal clinic",19,PC)
"RTN","SDCP",63,0)
 I $D(^SC(SC,"I")) S SDRE=+$P(^("I"),U,2),SDIN=+^("I") I SDRE'=SDIN D:SDIN'>DT&(SDRE=0!(SDRE>DT)) INACT
"RTN","SDCP",64,0)
 I 'SDNO,$D(SDIN),SDIN>DT,SDRE'=SDIN W !!,?4,"**** Clinic will be inactive ",$S(SDRE:"from ",1:"as of ") S Y=SDIN D DTS^SDUTL W Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"")," ****" K SDIN,SDRE
"RTN","SDCP",65,0)
 I 'SDSC W !!,?4,"*** INVALID OR INACTIVE STOP CODE ASSIGNED TO THIS CLINIC ***"
"RTN","SDCP",66,0)
 Q
"RTN","SDCP",67,0)
 ;
"RTN","SDCP",68,0)
INACT S Y=SDIN D DTS^SDUTL W !!,?4,"**** Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"")," ****" K SDIN,SDRE S SDNO=1
"RTN","SDCP",69,0)
 Q
"RTN","SDCP",70,0)
 ;
"RTN","SDCP",71,0)
SEEND W ! N DIR S DIR(0)="E" D ^DIR S END=Y'=1 Q:END
"RTN","SDCP",72,0)
 ; SD*5.3*622 - SDPRTTOF helps prevent double printing of Header
"RTN","SDCP",73,0)
TOF I SDPRTTOF W @IOF,?22,"CLINIC PROFILES AS OF: ",PDATE,! S SDPRTTOF=0 Q
"RTN","SDCP",74,0)
 ;
"RTN","SDCP",75,0)
CHECK() ;Check location for inclusion
"RTN","SDCP",76,0)
 I $D(^SC(SC,0)),($P(^(0),U,3)="C"),$S(VAUTD:1,$D(VAUTD(+$P(^(0),U,15))):1,'$P(^(0),U,15)&($D(VAUTD($O(^DG(40.8,0))))):1,1:0) Q 1
"RTN","SDCP",77,0)
 Q 0
"RTN","SDCP",78,0)
 ;
"RTN","SDCP",79,0)
 ;
"RTN","SDCP",80,0)
PAUSE(LINE) ;
"RTN","SDCP",81,0)
 N Y S Y=1
"RTN","SDCP",82,0)
 I $E(IOST,1,2)="C-",(LINE+5)>IOSL D PAUSE^VALM1 S LINE=0
"RTN","SDCP",83,0)
 S LINE=LINE+1
"RTN","SDCP",84,0)
 Q Y
"RTN","SDLT")
0^3^B28779463^B28750556
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ;14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330,398,523,441,555,622,641**;Aug 13, 1993;Build 4
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ; 01/21/16  SD*5.3*641  HSI        Print 1st piece of 99 node
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 N Z0,X
"RTN","SDLT",16,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",17,0)
PRT S DFN=$P(A,U,1)  ;SD*523
"RTN","SDLT",18,0)
 I $D(SDNOSH) I $D(^DPT(DFN,.1)) S POP=1 Q:POP  ;SD/523
"RTN","SDLT",19,0)
 S Y=DT D DTS^SDUTL
"RTN","SDLT",20,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",21,0)
 K SDFIRST
"RTN","SDLT",22,0)
 ;S SDFIRST=0
"RTN","SDLT",23,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",24,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",25,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",26,0)
 N DPTNAME
"RTN","SDLT",27,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",28,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",29,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",30,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",31,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",32,0)
 N B
"RTN","SDLT",33,0)
 ; SD*5.3*622 - re-arrange display of clinic name
"RTN","SDLT",34,0)
 ;S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",35,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL="   Clinic:  "_SDCL D FORM ; SD*5.3*622 end changes
"RTN","SDLT",36,0)
 ;
"RTN","SDLT",37,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",38,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",39,0)
 ; SD*5.3*622 - add more detail for appointment and format it
"RTN","SDLT",40,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3))
"RTN","SDLT",41,0)
 W:'$D(B) !?5,"Date/Time: ",?17,DOW,?$L(DOW)+19,$J(SDDAT,12)
"RTN","SDLT",42,0)
 I '$D(B),$D(SDC) W ?22,$J(SDT0,9),!?5,SDCL
"RTN","SDLT",43,0)
 ; get default provider if defined for a given clinic, print it on the
"RTN","SDLT",44,0)
 ; letter only if we have a YES on file, same for clinic location
"RTN","SDLT",45,0)
 ; skip printing the provider label if the field is empty in file #44
"RTN","SDLT",46,0)
 N J,SDLOC,SDPROV,SDPRNM,SDTEL,SDTELEXT
"RTN","SDLT",47,0)
 S SDLOC=$P($G(^SC(+SDC,0)),"^",11) ; physical location of the clinic
"RTN","SDLT",48,0)
 S SDTEL=$G(^SC(+SDC,99))        ; telephone number of clinic
"RTN","SDLT",49,0)
 S SDTELEXT="" I SDTEL]"",$G(^SC(+SDC,99.1))]"" D
"RTN","SDLT",50,0)
 .S SDTELEXT=^SC(+SDC,99.1)  ; telephone ext of clinic
"RTN","SDLT",51,0)
 ; get default provider, if any
"RTN","SDLT",52,0)
 F J=0:0 S J=$O(^SC(+SDC,"PR",J)) Q:'J>0  I $P($G(^SC(+SDC,"PR",J,0)),U,2)=1 S SDPROV=+$P(^SC(+SDC,"PR",J,0),U,1)
"RTN","SDLT",53,0)
 I $D(SDC),'$D(B),$P($G(^VA(407.5,SDLET,3)),U,2)="Y" D
"RTN","SDLT",54,0)
 .W:SDLOC]"" !?6,"Location:  "_SDLOC
"RTN","SDLT",55,0)
 I $D(SDC),'$D(B),SDTEL]"" D
"RTN","SDLT",56,0)
 .W !?5,"Telephone:  ",$P(SDTEL,U)
"RTN","SDLT",57,0)
 .W:SDTELEXT]"" "   Telephone Ext.:  ",SDTELEXT
"RTN","SDLT",58,0)
 I $D(SDPROV) D
"RTN","SDLT",59,0)
 .I $D(SDC),SDPROV>0 S SDPRNM=$P(^VA(200,SDPROV,0),U,1)
"RTN","SDLT",60,0)
 .I $D(SDC),'$D(B),$P($G(^VA(407.5,SDLET,3)),U,1)="Y" W:SDPRNM]"" !?6,"Provider:  "_$G(SDPRNM)
"RTN","SDLT",61,0)
 ; call handler for LAB, XRAY, and EKG tests
"RTN","SDLT",62,0)
 I $D(B) D TST
"RTN","SDLT",63,0)
 I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",64,0)
 ; SD*5.3*622 end changes
"RTN","SDLT",65,0)
 Q
"RTN","SDLT",66,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",67,0)
 N Z5,I,X
"RTN","SDLT",68,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",69,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",70,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",71,0)
 D ADDR Q
"RTN","SDLT",72,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN)
"RTN","SDLT",73,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",74,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",75,0)
 D ADD^VADPT D
"RTN","SDLT",76,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",77,0)
 .N SDIENS,X
"RTN","SDLT",78,0)
 .I $D(VAPA(5)) S SDIENS=+VAPA(5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(5),U,2)=X
"RTN","SDLT",79,0)
 .I $D(VAPA(17)) S SDIENS=+VAPA(17)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(17),U,2)=X
"RTN","SDLT",80,0)
 .K SDIENS Q
"RTN","SDLT",81,0)
 N SDCCACT1,SDCCACT2,LL
"RTN","SDLT",82,0)
 S SDCCACT1=VAPA(12),SDCCACT2=$P($G(VAPA(22,2)),"^",3)
"RTN","SDLT",83,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",84,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",85,0)
 .F LL=1:1:3 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",86,0)
 .;if country is blank display as USA
"RTN","SDLT",87,0)
 .I (VAPA(25)="")!($P(VAPA(25),"^",2)="UNITED STATES")  D  ;display city,state,zip
"RTN","SDLT",88,0)
 ..W !,?12,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDLT",89,0)
 .E  D  ;display postal code,city,province
"RTN","SDLT",90,0)
 ..W !,?12,VAPA(24)_" "_VAPA(4)_" "_VAPA(23)
"RTN","SDLT",91,0)
 .W:($P(VAPA(25),"^",2)'="UNITED STATES") !,?12,$P(VAPA(25),U,2) ;display country
"RTN","SDLT",92,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",93,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",94,0)
 .F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",95,0)
 .I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDLT",96,0)
 ..W !,?12,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDLT",97,0)
 .E  D
"RTN","SDLT",98,0)
 ..W !,?12,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDLT",99,0)
 .W:($P(VAPA(28),"^",2)'="UNITED STATES") !?12,$P(VAPA(28),U,2)
"RTN","SDLT",100,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",101,0)
 ;
"RTN","SDLT",102,0)
 ;
"RTN","SDLT",103,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",104,0)
 N SDX
"RTN","SDLT",105,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",106,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDLT",107,0)
 ;
"RTN","SDLT",108,0)
BADADD ;Print patients with a Bad Address Indicator
"RTN","SDLT",109,0)
 I '$D(^TMP($J,"BADADD")) Q
"RTN","SDLT",110,0)
 N SDHDR,SDHDR1
"RTN","SDLT",111,0)
 W @IOF,$TR($J("",IOM)," ","*")
"RTN","SDLT",112,0)
 S SDHDR="BAD ADDRESS INDICATOR LIST" W !,?(IOM-$L(SDHDR)/2),SDHDR,!
"RTN","SDLT",113,0)
 S SDHDR1="** THE LETTER FOR THESE PATIENT(S) DID NOT PRINT DUE TO A BAD ADDRESS INDICATOR."
"RTN","SDLT",114,0)
 W !,"Last 4",!,"of SSN",?10,"Patient Name",!
"RTN","SDLT",115,0)
 W $TR($J("",IOM)," ","*")
"RTN","SDLT",116,0)
 N SDNAM,SDDFN
"RTN","SDLT",117,0)
 S SDNAM="" F  S SDNAM=$O(^TMP($J,"BADADD",SDNAM)) Q:SDNAM=""  D
"RTN","SDLT",118,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"BADADD",SDNAM,SDDFN)) Q:'SDDFN  D
"RTN","SDLT",119,0)
 . . W !,$$LAST4(SDDFN),?10,SDNAM
"RTN","SDLT",120,0)
 W !!,SDHDR1
"RTN","SDLT",121,0)
 Q
"RTN","SDLT",122,0)
 ;
"RTN","SDLT",123,0)
TST ; SD*5.3*622 - handle scheduled tests
"RTN","SDLT",124,0)
 W !
"RTN","SDLT",125,0)
 W:($L(SDCL)=3&($E(SDCL,1,3)="LAB")) ?1,SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",126,0)
 W:($L(SDCL)=4&($E(SDCL,1,4)="XRAY")) SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",127,0)
 W:($L(SDCL)=3&($E(SDCL,1,3)="EKG")) ?1,SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",128,0)
 Q  ; SD*5.3*622 - end of changes
"VER")
8.0^22.0
"BLD",10063,6)
^539
**END**
**END**

