EMERGENCY Released SD*5.3*719 SEQ #578
Extracted from mail message
**KIDS**:SD*5.3*719^

**INSTALL NAME**
SD*5.3*719
"BLD",11162,0)
SD*5.3*719^SCHEDULING^0^3181115^y
"BLD",11162,4,0)
^9.64PA^^
"BLD",11162,6)
1^
"BLD",11162,6.3)
3
"BLD",11162,"ABPKG")
n
"BLD",11162,"KRN",0)
^9.67PA^779.2^20
"BLD",11162,"KRN",.4,0)
.4
"BLD",11162,"KRN",.401,0)
.401
"BLD",11162,"KRN",.402,0)
.402
"BLD",11162,"KRN",.403,0)
.403
"BLD",11162,"KRN",.5,0)
.5
"BLD",11162,"KRN",.84,0)
.84
"BLD",11162,"KRN",3.6,0)
3.6
"BLD",11162,"KRN",3.8,0)
3.8
"BLD",11162,"KRN",9.2,0)
9.2
"BLD",11162,"KRN",9.8,0)
9.8
"BLD",11162,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11162,"KRN",9.8,"NM",1,0)
SDCNP1^^0^B33773499
"BLD",11162,"KRN",9.8,"NM","B","SDCNP1",1)

"BLD",11162,"KRN",19,0)
19
"BLD",11162,"KRN",19.1,0)
19.1
"BLD",11162,"KRN",101,0)
101
"BLD",11162,"KRN",409.61,0)
409.61
"BLD",11162,"KRN",771,0)
771
"BLD",11162,"KRN",779.2,0)
779.2
"BLD",11162,"KRN",870,0)
870
"BLD",11162,"KRN",8989.51,0)
8989.51
"BLD",11162,"KRN",8989.52,0)
8989.52
"BLD",11162,"KRN",8994,0)
8994
"BLD",11162,"KRN","B",.4,.4)

"BLD",11162,"KRN","B",.401,.401)

"BLD",11162,"KRN","B",.402,.402)

"BLD",11162,"KRN","B",.403,.403)

"BLD",11162,"KRN","B",.5,.5)

"BLD",11162,"KRN","B",.84,.84)

"BLD",11162,"KRN","B",3.6,3.6)

"BLD",11162,"KRN","B",3.8,3.8)

"BLD",11162,"KRN","B",9.2,9.2)

"BLD",11162,"KRN","B",9.8,9.8)

"BLD",11162,"KRN","B",19,19)

"BLD",11162,"KRN","B",19.1,19.1)

"BLD",11162,"KRN","B",101,101)

"BLD",11162,"KRN","B",409.61,409.61)

"BLD",11162,"KRN","B",771,771)

"BLD",11162,"KRN","B",779.2,779.2)

"BLD",11162,"KRN","B",870,870)

"BLD",11162,"KRN","B",8989.51,8989.51)

"BLD",11162,"KRN","B",8989.52,8989.52)

"BLD",11162,"KRN","B",8994,8994)

"BLD",11162,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",11162,"QUES",0)
^9.62^^
"BLD",11162,"REQB",0)
^9.611^1^1
"BLD",11162,"REQB",1,0)
SD*5.3*682^1
"BLD",11162,"REQB","B","SD*5.3*682",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
719^3181115^520881758
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDCNP1")
0^1^B33773499^B33715154
"RTN","SDCNP1",1,0)
SDCNP1 ;ALB/LDB - CANCEL APPOINTMENT (cont.) ; 5/25/12 11:42am
"RTN","SDCNP1",2,0)
 ;;5.3;Scheduling;**398,467,478,554,597,682,719**;Aug 13, 1993;Build 3
"RTN","SDCNP1",3,0)
 ;
"RTN","SDCNP1",4,0)
 ;SD/467 - EWL Open Matched Entry with rebook
"RTN","SDCNP1",5,0)
NOPE W !,*7,$S(CNT:CNT_" Appointment"_$S(CNT>1:"s",1:"")_" cancelled",1:"NOTHING CANCELLED")
"RTN","SDCNP1",6,0)
 N SDCLNK S SDCLNK=$G(SC) ; Hold value of SC for EWL Notification call
"RTN","SDCNP1",7,0)
 S SDCNT=CNT,SDA=1,SDCNT1=0 I CNT,$S('$D(^DPT(DFN,.35)):1,'$P(^(.35),U):1,1:0) S (SDA,X8)=0 D ASK G:X8="^" END
"RTN","SDCNP1",8,0)
 ;no rebooking to take place; open EWL entries only if applicable
"RTN","SDCNP1",9,0)
 I $D(DFN)>0 D EWL(DFN) ;SD/467
"RTN","SDCNP1",10,0)
 I SDA,SDCNT W !,*7,"NO AUTO-REBOOKING --Patient has died."
"RTN","SDCNP1",11,0)
 I 'SDA,SDCNT S A=DFN D LOOP1^SDCNP1A,LET,CANQ^SDAMC(DFN,$G(SDCLNK)) K SDCLNK
"RTN","SDCNP1",12,0)
 ;Calls subroutine CANQ to display wait list message if applicable. - PATCH SD*5.3*597
"RTN","SDCNP1",13,0)
END K:'$D(DIROUT) DFN D END^SDCNP Q:$D(DIROUT)  G RD^SDCNP
"RTN","SDCNP1",14,0)
 ;Remove AUTO-REBOOK quit at ASK line, SD*5.3*682
"RTN","SDCNP1",15,0)
ASK Q
"RTN","SDCNP1",16,0)
 S (SDCTR,SDCTRL)=0,%=2 W !!,"DO YOU WISH TO REBOOK ANY APPOINTMENT(S) THAT YOU HAVE CANCELLED" D YN^DICN S ALS=% D:'% REASK G:'% ASK I %-1 S CNT=0 S:%<0 X8="^" D  Q
"RTN","SDCNP1",17,0)
 .W !,"OK"
"RTN","SDCNP1",18,0)
 W !!,"PLEASE NOTE THAT YOU MUST ENTER A DEVICE TO AUTO-REBOOK",!
"RTN","SDCNP1",19,0)
ZIS S %ZIS("A")="DEVICE TO OUTPUT REBOOKED APPT(S). :",%ZIS="QN" D ^%ZIS I POP S X8="^" Q
"RTN","SDCNP1",20,0)
 S L=0 F  S L=$O(^UTILITY($J,"SDCNP",L)) Q:'L  I $P(^(L),U,4)="*** JUST CANCELLED ***" S ^UTILITY($J,"SDCNP1",DFN,$P(^(L),"^",2),$P(^(L),"^"))=^(L)
"RTN","SDCNP1",21,0)
 D SDLST
"RTN","SDCNP1",22,0)
LST S B=0 F  S B=$O(^UTILITY($J,"SDCNP2",DFN,B)) Q:'B  W !!,$J($S(B\1=B:"("_$J(B,2)_") ",1:""),5) S AT=$S($P(^(B),"^",2)'?.N:1,1:0),Y=$P($P(^(B),"^"),".") D DT^SDM0 S X=$P(^(B),"^") X ^DD("FUNC",2,1) W " ",$J(X,8) S Z1(B)="" D MORE Q:SDCTRL
"RTN","SDCNP1",23,0)
 D WH
"RTN","SDCNP1",24,0)
 I B>0 G:SDCTRL&(A8']"") NOPE1 G:SDCTRL DEL
"RTN","SDCNP1",25,0)
 Q
"RTN","SDCNP1",26,0)
SDLST S L1=0 S Z5=0 F  S Z5=$O(^UTILITY($J,"SDCNP1",DFN,Z5)) Q:'Z5  F Z6=0:0 S Z7=Z6,Z6=$O(^UTILITY($J,"SDCNP1",DFN,Z5,Z6)) I Z6="" S L1=L1+1,^UTILITY($J,"SDCNP2",DFN,L1)=Z7_"^"_Z5_"^"_$P(^(Z7),"^",3,6) Q
"RTN","SDCNP1",27,0)
 Q
"RTN","SDCNP1",28,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP2",B),"^",2) G OVR
"RTN","SDCNP1",29,0)
 S S5=^UTILITY($J,"SDCNP2",DFN,B) W " (",$P(S5,"^",6)," MINUTES)  ",$S($D(^SC($P(S5,"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(S5,"^",3) S M1=$P(^SC($P(S5,"^",2),"SDP"),"^",4) W !,?41,"Max days for rebooking= ",M1
"RTN","SDCNP1",30,0)
OVR I SDCTR>20,$O(^UTILITY($J,"SDCNP2",B))>0 S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP1",31,0)
 Q
"RTN","SDCNP1",32,0)
WH W !!,"SELECT APPOINTMENT(S) TO BE REBOOKED" W:B>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",A8:DTIME I '$T!(A8="^") S SDCTRL=1,A8="",X8="^" Q
"RTN","SDCNP1",33,0)
 I A8["?" X SDMSG G WH
"RTN","SDCNP1",34,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  D MTCH
"RTN","SDCNP1",35,0)
 I SDERR G LST
"RTN","SDCNP1",36,0)
DEL1 S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK2^SDCNP1A Q:SDERR  F Z9=SDDI:1:$S(SDDM:SDDM,1:SDDI) D:SDDI REBK I 'SDDI S SDERR=1 Q
"RTN","SDCNP1",37,0)
 G:SDERR LST Q:A8["^"!(A8="")  S SDERR=0 D ^SDCNP1A Q:X8="^"
"RTN","SDCNP1",38,0)
 D:MAX QUE
"RTN","SDCNP1",39,0)
 D NOPE1
"RTN","SDCNP1",40,0)
 Q 
"RTN","SDCNP1",41,0)
LET ;
"RTN","SDCNP1",42,0)
 S %=2 W !!,"DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT(S)" D YN^DICN S ANS="Y" D:'% REASK G:'% LET Q:(%-1)
"RTN","SDCNP1",43,0)
 I $$BADADR^DGUTL3(+DFN) D  Q  ;display, don't print BAI list
"RTN","SDCNP1",44,0)
 . W *7,!,"** THIS PATIENT HAS BEEN FLAGGED WITH A BAD ADDRESS INDICATOR, NO LETTER"
"RTN","SDCNP1",45,0)
 . W !,"WILL BE PRINTED."
"RTN","SDCNP1",46,0)
 . S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1",47,0)
QUE2 ;S DGPGM="SDLET^SDCNP1A",DGVAR="SDCL#^DUZ^DFN^DT^A^SDWH" D ZIS^DGUTQ D:POP CLOSE^DGUTQ Q:POP  D SDLET^SDCNP1A Q
"RTN","SDCNP1",48,0)
 S %ZIS="MQ" K IO("Q") D ^%ZIS Q:POP  ;SD/478
"RTN","SDCNP1",49,0)
 I $D(IO("Q")) D  D:IO'=IO(0) NOTELTR D ^%ZISC W @IOF Q  ;SD/478
"RTN","SDCNP1",50,0)
 .S ZTRTN="SDLET^SDCNP1A" F ZTS="SDCL(","DUZ","DFN","DT","A","SDWH","AUTO(" S ZTSAVE(ZTS)=""  ;SD/478
"RTN","SDCNP1",51,0)
 .K ZTS D ^%ZTLOAD  ;SD/478
"RTN","SDCNP1",52,0)
 D:IO'=IO(0) NOTELTR D SDLET^SDCNP1A,^%ZISC W @IOF  ;SD/478
"RTN","SDCNP1",53,0)
 Q  ;SD/478
"RTN","SDCNP1",54,0)
NOTELTR I ANS["Y",$G(ALS)=1 S:$D(CNDIE) @(CNDIE_CNDA_",1,CNINDX,0)")="CANCEL APPOINTMENT AUTO REBOOK letter printed." K CNDIE,CNDA,CNINDX ;SD/478 CANCEL APPT AUTO REBOOK LETTER PRINTED.
"RTN","SDCNP1",55,0)
 I ANS["Y" S:$D(CNDIE) @(CNDIE_CNDA_",1,CNINDX,0)")="CANCEL APPOINTMENT letter printed." K CNDIE,CNDA,CNINDX ;SD/478 CANCEL APPT LETTER IS PRINTED.
"RTN","SDCNP1",56,0)
 Q
"RTN","SDCNP1",57,0)
QUE I IO'=IO(0) S DGPGM="^SDCNP2",DGVAR="SDCL#^NDATE^A^GDATE^DT^DUZ",IOP=IO,X="NOW" D Q1^DGUTQ Q
"RTN","SDCNP1",58,0)
 U IO I IO=IO(0),$E(IOST,1,2)="C-" S SDIO=1 D ^SDCNP2 Q
"RTN","SDCNP1",59,0)
NOPE1 W @IOF,!,*7,$S(SDCNT1:SDCNT1_" Appointment"_$S(SDCNT1>1:"s",1:"")_" rebooked",1:"NOTHING REBOOKED") Q
"RTN","SDCNP1",60,0)
REBK K ^UTILITY($J,"SDCNP") S ^UTILITY($J,"SDCNP2","REBK",DFN,Z9)=^UTILITY($J,"SDCNP2",DFN,Z9)
"RTN","SDCNP1",61,0)
 Q
"RTN","SDCNP1",62,0)
 F A9=SDDI,SDDM Q:'SDDM&(SDDI-A9)  I '$D(Z1(A9)) S SDERR=1 W !,*7,"There is no appointment number ",A9
"RTN","SDCNP1",63,0)
 Q
"RTN","SDCNP1",64,0)
REASK W !,"ANSWER (Y)ES OR (N)O" Q
"RTN","SDCNP1",65,0)
CLRK S $P(^DPT(DFN,"S",S,0),"^",19)=$P(SDNODE,"^",7),$P(^DPT(DFN,"S",S,0),"^",18)=$P(SDNODE,"^",6) Q
"RTN","SDCNP1",66,0)
MTCH Q:SDDH?1N.N!(SDDH?1.N1"-".N)  S SDERR=1 X SDMSG
"RTN","SDCNP1",67,0)
 Q
"RTN","SDCNP1",68,0)
EWL(DFN) ;
"RTN","SDCNP1",69,0)
 I '$D(^UTILITY($J,"SDCNP1")) I '$D(^UTILITY($J,"SDCNP")) Q
"RTN","SDCNP1",70,0)
 ;call to EWL to open and optionally close EWL entry with rebooked appointment
"RTN","SDCNP1",71,0)
 N SDFRB,SDT,SC,SDREB K ^TMP("SDWLREB",$J),^TMP($J,"SDWPL"),^TMP($J,"APPT")
"RTN","SDCNP1",72,0)
 I $D(^UTILITY($J,"SDCNP1")) S SDFRB="^UTILITY($J,""SDCNP1"")"  D REB I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB Q
"RTN","SDCNP1",73,0)
 E  S SDFRB="^UTILITY($J,""SDCNP"")" D CAN I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB
"RTN","SDCNP1",74,0)
 Q
"RTN","SDCNP1",75,0)
REB I $D(^UTILITY($J,"SDCNP1")) F  S SDFRB=$Q(@SDFRB) Q:SDFRB'["SDCNP1"  S SDT=$P(@SDFRB,U),SC=$P(@SDFRB,U,2),SDREB=0 D
"RTN","SDCNP1",76,0)
 .;N NN F NN=1:1 Q:'$D(^UTILITY($J,"SDCNP","REBK",DFN,NN))  I $P($G(^UTILITY($J,"SDCNP2","REBK",DFN,NN)),U)=SDT S SDREB=1 Q
"RTN","SDCNP1",77,0)
 .N RBFLG,SDTRB D REBOOK^SDWLREB(DFN,SDT,SC,.RBFLG,.SDTRB)
"RTN","SDCNP1",78,0)
 .I $E(RBFLG,1,2)'="CC" Q  ;not canceled by clinic
"RTN","SDCNP1",79,0)
 .I RBFLG="CCR" S SDREB=1 D DISREB^SDWLREB(DFN,SDTRB,SC)
"RTN","SDCNP1",80,0)
 .D OPENEWL^SDWLREB(DFN,SDT,SC,SDREB) K ^TMP($J,"APPT"),^TMP($J,"SDWLPL")
"RTN","SDCNP1",81,0)
 Q
"RTN","SDCNP1",82,0)
CAN I $D(^UTILITY($J,"SDCNP")) F  S SDFRB=$Q(@SDFRB) Q:SDFRB'["SDCNP"  I @SDFRB["CANCELLED" S SDT=$P(@SDFRB,U),SC=$P(@SDFRB,U,2),SDREB=0 D
"RTN","SDCNP1",83,0)
 .N RBFLG,SDTRB D REBOOK^SDWLREB(DFN,SDT,SC,.RBFLG,.SDTRB)
"RTN","SDCNP1",84,0)
 .I $E(RBFLG,1,2)'="CC" Q  ;not canceled by clinic
"RTN","SDCNP1",85,0)
 .I RBFLG="CCR" S SDREB=1 D DISREB^SDWLREB(DFN,SDTRB,SC)
"RTN","SDCNP1",86,0)
 .D OPENEWL^SDWLREB(DFN,SDT,SC,SDREB) K ^TMP($J,"APPT"),^TMP($J,"SDWLPL")
"RTN","SDCNP1",87,0)
 Q
"VER")
8.0^22.2
"BLD",11162,6)
^578
**END**
**END**

