Released SD*5.3*728 SEQ #589
Extracted from mail message
**KIDS**:SD*5.3*728^

**INSTALL NAME**
SD*5.3*728
"BLD",11500,0)
SD*5.3*728^SCHEDULING^0^3190606^y
"BLD",11500,1,0)
^^3^3^3190605^
"BLD",11500,1,1,0)
SD*5.3*728 provides Fiscal Year 2020 updates to the CLINIC STOP (#40.7)
"BLD",11500,1,2,0)
file as requested by the Office of Finance, Managerial Cost Accounting
"BLD",11500,1,3,0)
Office (MCAO).
"BLD",11500,4,0)
^9.64PA^^
"BLD",11500,6.3)
2
"BLD",11500,"INIT")
POST^SD53FY20
"BLD",11500,"KRN",0)
^9.67PA^1.5^24
"BLD",11500,"KRN",.4,0)
.4
"BLD",11500,"KRN",.401,0)
.401
"BLD",11500,"KRN",.402,0)
.402
"BLD",11500,"KRN",.403,0)
.403
"BLD",11500,"KRN",.5,0)
.5
"BLD",11500,"KRN",.84,0)
.84
"BLD",11500,"KRN",1.5,0)
1.5
"BLD",11500,"KRN",1.6,0)
1.6
"BLD",11500,"KRN",1.61,0)
1.61
"BLD",11500,"KRN",1.62,0)
1.62
"BLD",11500,"KRN",3.6,0)
3.6
"BLD",11500,"KRN",3.8,0)
3.8
"BLD",11500,"KRN",9.2,0)
9.2
"BLD",11500,"KRN",9.8,0)
9.8
"BLD",11500,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11500,"KRN",9.8,"NM",1,0)
SD53FY20^^0^B107270057
"BLD",11500,"KRN",9.8,"NM","B","SD53FY20",1)

"BLD",11500,"KRN",19,0)
19
"BLD",11500,"KRN",19.1,0)
19.1
"BLD",11500,"KRN",101,0)
101
"BLD",11500,"KRN",409.61,0)
409.61
"BLD",11500,"KRN",771,0)
771
"BLD",11500,"KRN",779.2,0)
779.2
"BLD",11500,"KRN",870,0)
870
"BLD",11500,"KRN",8989.51,0)
8989.51
"BLD",11500,"KRN",8989.52,0)
8989.52
"BLD",11500,"KRN",8994,0)
8994
"BLD",11500,"KRN","B",.4,.4)

"BLD",11500,"KRN","B",.401,.401)

"BLD",11500,"KRN","B",.402,.402)

"BLD",11500,"KRN","B",.403,.403)

"BLD",11500,"KRN","B",.5,.5)

"BLD",11500,"KRN","B",.84,.84)

"BLD",11500,"KRN","B",1.5,1.5)

"BLD",11500,"KRN","B",1.6,1.6)

"BLD",11500,"KRN","B",1.61,1.61)

"BLD",11500,"KRN","B",1.62,1.62)

"BLD",11500,"KRN","B",3.6,3.6)

"BLD",11500,"KRN","B",3.8,3.8)

"BLD",11500,"KRN","B",9.2,9.2)

"BLD",11500,"KRN","B",9.8,9.8)

"BLD",11500,"KRN","B",19,19)

"BLD",11500,"KRN","B",19.1,19.1)

"BLD",11500,"KRN","B",101,101)

"BLD",11500,"KRN","B",409.61,409.61)

"BLD",11500,"KRN","B",771,771)

"BLD",11500,"KRN","B",779.2,779.2)

"BLD",11500,"KRN","B",870,870)

"BLD",11500,"KRN","B",8989.51,8989.51)

"BLD",11500,"KRN","B",8989.52,8989.52)

"BLD",11500,"KRN","B",8994,8994)

"BLD",11500,"QUES",0)
^9.62^^
"BLD",11500,"REQB",0)
^9.611^1^1
"BLD",11500,"REQB",1,0)
SD*5.3*696^2
"BLD",11500,"REQB","B","SD*5.3*696",1)

"INIT")
POST^SD53FY20
"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
728^3190606
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3190606
"PKG",16,22,1,"PAH",1,1,1,0)
SD*5.3*728 provides Fiscal Year 2020 updates to the CLINIC STOP (#40.7)
"PKG",16,22,1,"PAH",1,1,2,0)
file as requested by the Office of Finance, Managerial Cost Accounting
"PKG",16,22,1,"PAH",1,1,3,0)
Office (MCAO).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SD53FY20")
0^1^B107270057^n/a
"RTN","SD53FY20",1,0)
SD53FY20 ;ALB/TXH - FY20 STOP CODE UPDATES;05/29/19
"RTN","SD53FY20",2,0)
 ;;5.3;Scheduling;**728**;AUG 13, 1993;Build 2
"RTN","SD53FY20",3,0)
 ;
"RTN","SD53FY20",4,0)
 ; Post-init routine updating stop codes in CLINIC STOP file (#40.7)
"RTN","SD53FY20",5,0)
 ; for FY20 updates - effective 10/01/2019.
"RTN","SD53FY20",6,0)
 ;
"RTN","SD53FY20",7,0)
 Q
"RTN","SD53FY20",8,0)
 ;
"RTN","SD53FY20",9,0)
POST ; Update stop codes in Clinic Stop file 40.7
"RTN","SD53FY20",10,0)
 ;
"RTN","SD53FY20",11,0)
 D BMES^XPDUTL("SD*5.3*728 Post-Install starts...")
"RTN","SD53FY20",12,0)
 D:$P($T(NEW+1),";;",2)'="QUIT" ADD      ; add new stop code
"RTN","SD53FY20",13,0)
 D:$P($T(OFF+1),";;",2)'="QUIT" INACT    ; inactivate
"RTN","SD53FY20",14,0)
 D:$P($T(CHG+1),";;",2)'="QUIT" CHGNM    ; change name
"RTN","SD53FY20",15,0)
 D:$P($T(RT+1),";;",2)'="QUIT" CHGRT     ; change restriction data
"RTN","SD53FY20",16,0)
 D MES^XPDUTL("SD*5.3*728 Post-Install is complete."),MES^XPDUTL("")
"RTN","SD53FY20",17,0)
 K SDIEN,%H,%I,DIC,X,Y
"RTN","SD53FY20",18,0)
 ; 
"RTN","SD53FY20",19,0)
 Q
"RTN","SD53FY20",20,0)
 ;
"RTN","SD53FY20",21,0)
ADD ; Add new stop code
"RTN","SD53FY20",22,0)
 ; SDREC is in format: 
"RTN","SD53FY20",23,0)
 ;   ;;stop code name^code #^restriction type^restriction date^CDR
"RTN","SD53FY20",24,0)
 ;
"RTN","SD53FY20",25,0)
 N SDI,SDREC,SDCODE,SDNM,SDRESTYP,SDFDA,SDADDERR,SDIEN,SDCDR,SDRESIN,SDRESEX
"RTN","SD53FY20",26,0)
 D BMES^XPDUTL(">>> Adding stop code to the CLINIC STOP (#40.7) file...")
"RTN","SD53FY20",27,0)
 D BMES^XPDUTL("    [NOTE: These Stop Codes CANNOT be used UNTIL 10/01/2019]")
"RTN","SD53FY20",28,0)
 ;
"RTN","SD53FY20",29,0)
 ; load all new entries
"RTN","SD53FY20",30,0)
 F SDI=1:1 S SDREC=$P($T(NEW+SDI),";;",2) Q:SDREC="QUIT"  D
"RTN","SD53FY20",31,0)
 . S SDCODE=$P(SDREC,U,2)   ;code
"RTN","SD53FY20",32,0)
 . S SDNM=$P(SDREC,U)       ;name
"RTN","SD53FY20",33,0)
 . S SDRESTYP=$P(SDREC,U,3) ;restriction type
"RTN","SD53FY20",34,0)
 . S (SDRESIN,SDRESEX)=""
"RTN","SD53FY20",35,0)
 . ; restriction date
"RTN","SD53FY20",36,0)
 . I +$P(SDREC,U,4) D
"RTN","SD53FY20",37,0)
 . . S X=$P(SDREC,U,4)
"RTN","SD53FY20",38,0)
 . . S %DT="FTX"
"RTN","SD53FY20",39,0)
 . . D ^%DT
"RTN","SD53FY20",40,0)
 . . I Y<0 S SDRESIN="" Q
"RTN","SD53FY20",41,0)
 . . S SDRESIN=Y
"RTN","SD53FY20",42,0)
 . . D DD^%DT
"RTN","SD53FY20",43,0)
 . . S SDRESEX=Y
"RTN","SD53FY20",44,0)
 . S SDCDR=$P(SDREC,U,5)    ;CDR #
"RTN","SD53FY20",45,0)
 . ;
"RTN","SD53FY20",46,0)
 . ; check if code already exists in file 40.7
"RTN","SD53FY20",47,0)
 . S SDIEN=$$FIND1^DIC(40.7,"","MX",SDCODE,"","","SDADDERR")
"RTN","SD53FY20",48,0)
 . ; quit if error
"RTN","SD53FY20",49,0)
 . I $D(SDADDERR) D  Q
"RTN","SD53FY20",50,0)
 . . D BMES^XPDUTL("       >> ... Unable to add stop code "_SDCODE_" "_SDNM_" to file.")
"RTN","SD53FY20",51,0)
 . . D MES^XPDUTL("        >> ... "_$G(SDADDERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",52,0)
 . . D MES^XPDUTL("        >> ... Please contact support for assistance...")
"RTN","SD53FY20",53,0)
 . . K SDADDERR
"RTN","SD53FY20",54,0)
 . ;
"RTN","SD53FY20",55,0)
 . ; If code already exists, update it.
"RTN","SD53FY20",56,0)
 . I SDIEN D  Q
"RTN","SD53FY20",57,0)
 . . K SDADDERR
"RTN","SD53FY20",58,0)
 . . S SDFDA(40.7,SDIEN_",",.01)=SDNM
"RTN","SD53FY20",59,0)
 . . S SDFDA(40.7,SDIEN_",",1)=SDCODE
"RTN","SD53FY20",60,0)
 . . S SDFDA(40.7,SDIEN_",",4)=SDCDR
"RTN","SD53FY20",61,0)
 . . S SDFDA(40.7,SDIEN_",",5)=SDRESTYP
"RTN","SD53FY20",62,0)
 . . S SDFDA(40.7,SDIEN_",",6)=SDRESIN
"RTN","SD53FY20",63,0)
 . . D FILE^DIE(,"SDFDA","SDADDERR")
"RTN","SD53FY20",64,0)
 . . ; check if error
"RTN","SD53FY20",65,0)
 . . I '$D(SDADDERR) D  Q
"RTN","SD53FY20",66,0)
 . . . D BMES^XPDUTL("     >> Stop Code "_SDCODE_" "_SDNM_" already exists.")
"RTN","SD53FY20",67,0)
    . . I $D(SDADDERR) D
"RTN","SD53FY20",68,0)
    . . . D BMES^XPDUTL("         ... Unable to add stop code "_SDCODE_" "_SDNM_" to file.")
"RTN","SD53FY20",69,0)
    . . . D MES^XPDUTL("         ... "_$G(SDADDERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",70,0)
    . . . D MES^XPDUTL("         ... Please contact support for assistance.")
"RTN","SD53FY20",71,0)
    . . . K SDADDERR
"RTN","SD53FY20",72,0)
 . ; if code does not exist, add new entry
"RTN","SD53FY20",73,0)
 . ; set field values of new entry
"RTN","SD53FY20",74,0)
 . S SDFDA(40.7,"+1,",.01)=SDNM
"RTN","SD53FY20",75,0)
 . S SDFDA(40.7,"+1,",1)=SDCODE
"RTN","SD53FY20",76,0)
 . S SDFDA(40.7,"+1,",4)=SDCDR
"RTN","SD53FY20",77,0)
 . S SDFDA(40.7,"+1,",5)=SDRESTYP
"RTN","SD53FY20",78,0)
 . S SDFDA(40.7,"+1,",6)=SDRESIN
"RTN","SD53FY20",79,0)
 . ; add new entry
"RTN","SD53FY20",80,0)
 . D UPDATE^DIE("E","SDFDA","","SDADDERR")
"RTN","SD53FY20",81,0)
 . ; check if error
"RTN","SD53FY20",82,0)
 . I '$D(SDADDERR) D
"RTN","SD53FY20",83,0)
 . . D BMES^XPDUTL("    >> Stop Code "_SDCODE_" "_SDNM_" added to file.")
"RTN","SD53FY20",84,0)
 . I $D(SDADDERR) D
"RTN","SD53FY20",85,0)
 . . D BMES^XPDUTL("    >> ... Unable to add stop code "_SDCODE_" "_SDNM_" to file.")
"RTN","SD53FY20",86,0)
 . . D MES^XPDUTL("    >> ... "_$G(SDADDERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",87,0)
 . . D MES^XPDUTL("    >> ... Please contact support for assistance.")
"RTN","SD53FY20",88,0)
 . . ; clean out error array b4 processing next code
"RTN","SD53FY20",89,0)
 . . K SDADDERR
"RTN","SD53FY20",90,0)
 ;
"RTN","SD53FY20",91,0)
 D BMES^XPDUTL(">>> Add new stop codes complete.")
"RTN","SD53FY20",92,0)
 D MES^XPDUTL("")
"RTN","SD53FY20",93,0)
 ;
"RTN","SD53FY20",94,0)
 Q
"RTN","SD53FY20",95,0)
 ;
"RTN","SD53FY20",96,0)
INACT ; Inactivate stop code
"RTN","SD53FY20",97,0)
 ; SDREC is in format: ;;code #^^inactivation date (in FileMan format)
"RTN","SD53FY20",98,0)
 ;
"RTN","SD53FY20",99,0)
 N SDI,SDREC,SDCODE,SDEXDT,SDINDT,SDNM,SDINTERR
"RTN","SD53FY20",100,0)
 D BMES^XPDUTL(">>> Inactivating stop codes in CLINIC STOP (#40.7) file...")
"RTN","SD53FY20",101,0)
 D BMES^XPDUTL("  [NOTE: These Stop Codes CANNOT be used AFTER the indicated inactivation date.]")
"RTN","SD53FY20",102,0)
 ;
"RTN","SD53FY20",103,0)
 ; load entries w/ inactivate date
"RTN","SD53FY20",104,0)
 F SDI=1:1 S SDREC=$P($T(OFF+SDI),";;",2) Q:SDREC="QUIT"  D
"RTN","SD53FY20",105,0)
 . S SDCODE=$P(SDREC,U)  ;code
"RTN","SD53FY20",106,0)
 . ; get inactivate date and validate date passed in
"RTN","SD53FY20",107,0)
 . I +$P(SDREC,U,3) D
"RTN","SD53FY20",108,0)
 . . S X=$P(SDREC,U,3)
"RTN","SD53FY20",109,0)
 . . S %DT="FTX"
"RTN","SD53FY20",110,0)
 . . D ^%DT
"RTN","SD53FY20",111,0)
 . . Q:Y<0
"RTN","SD53FY20",112,0)
 . . S SDINDT=Y
"RTN","SD53FY20",113,0)
 . . D DD^%DT
"RTN","SD53FY20",114,0)
 . . S SDEXDT=Y
"RTN","SD53FY20",115,0)
 . . ; check if code already exists
"RTN","SD53FY20",116,0)
 . . S SDIEN=$$FIND1^DIC(40.7,"","MX",SDCODE,"","","SDINTERR")
"RTN","SD53FY20",117,0)
 . . ; quit if unable to find code in 40.7
"RTN","SD53FY20",118,0)
 . . I 'SDIEN D  Q
"RTN","SD53FY20",119,0)
 . . . D BMES^XPDUTL("    >> ... Unable to find stop code: "_SDCODE)
"RTN","SD53FY20",120,0)
 . . . D MES^XPDUTL("    >> ... Please contact support for assistance.")
"RTN","SD53FY20",121,0)
 . . ; check if error
"RTN","SD53FY20",122,0)
 . . I $D(SDINTERR) D  Q
"RTN","SD53FY20",123,0)
 . . . D BMES^XPDUTL("    >> ... Unable to inactivate stop code "_SDCODE)
"RTN","SD53FY20",124,0)
 . . . D MES^XPDUTL("    >> ... "_$G(SDINTERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",125,0)
 . . . D MES^XPDUTL("    >> ... Please contact support for assistance...")
"RTN","SD53FY20",126,0)
 . . . ; clean out error array b4 processing next code
"RTN","SD53FY20",127,0)
 . . . K SDINTERR
"RTN","SD53FY20",128,0)
 . . ; if no error, check if active
"RTN","SD53FY20",129,0)
 . . I $D(^DIC(40.7,SDIEN,0)) I $P(^(0),U,3)="" D
"RTN","SD53FY20",130,0)
 . . . S SDNM=$P($G(^DIC(40.7,SDIEN,0)),U)   ;code name
"RTN","SD53FY20",131,0)
 . . . ; set field value
"RTN","SD53FY20",132,0)
 . . . K SDFDA
"RTN","SD53FY20",133,0)
 . . . S SDFDA(40.7,SDIEN_",",2)=SDINDT
"RTN","SD53FY20",134,0)
 . . . D FILE^DIE(,"SDFDA","SDINTERR")
"RTN","SD53FY20",135,0)
 . . . ; check if error
"RTN","SD53FY20",136,0)
 . . . I $D(SDINTERR) D  Q
"RTN","SD53FY20",137,0)
 . . . . D BMES^XPDUTL("    >> ... Unable to inactivate stop code: "_SDCODE)
"RTN","SD53FY20",138,0)
 . . . . D MES^XPDUTL("    >> ... "_$G(SDINTERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",139,0)
 . . . . D MES^XPDUTL("     >> ... Please contact support for assistance.")
"RTN","SD53FY20",140,0)
 . . . . ; clean out error array b4 processing next code
"RTN","SD53FY20",141,0)
 . . . . K SDINTERR
"RTN","SD53FY20",142,0)
 . . . I '$D(SDINTERR) D
"RTN","SD53FY20",143,0)
 . . . . D BMES^XPDUTL("     >> Inactivated: "_+SDCODE_"   "_SDNM_" as of "_SDEXDT)
"RTN","SD53FY20",144,0)
 ;
"RTN","SD53FY20",145,0)
 D BMES^XPDUTL(">>> Inactivation complete.")
"RTN","SD53FY20",146,0)
 D MES^XPDUTL("")
"RTN","SD53FY20",147,0)
 K %,%DT,%H,%I,DIC,X,Y
"RTN","SD53FY20",148,0)
 ;
"RTN","SD53FY20",149,0)
 Q
"RTN","SD53FY20",150,0)
 ;
"RTN","SD53FY20",151,0)
CHGNM ; Change code names
"RTN","SD53FY20",152,0)
 ; SDREC is in format: ;;code name^code #^^new code name
"RTN","SD53FY20",153,0)
 ;
"RTN","SD53FY20",154,0)
 N SDI,SDCODE,SDIEN,SDNEWNM,SDNM,SDREC,SDCHGERR
"RTN","SD53FY20",155,0)
 D BMES^XPDUTL(">>> Changing code names in CLINIC STOP (#40.7) file...")
"RTN","SD53FY20",156,0)
 ;
"RTN","SD53FY20",157,0)
 ; load entries
"RTN","SD53FY20",158,0)
 F SDI=1:1 S SDREC=$P($T(CHG+SDI),";;",2) Q:SDREC="QUIT"  D
"RTN","SD53FY20",159,0)
 . S SDNM=$P(SDREC,U)      ;current name
"RTN","SD53FY20",160,0)
 . S SDCODE=$P(SDREC,U,2)  ;code
"RTN","SD53FY20",161,0)
 . S SDNEWNM=$P(SDREC,U,4) ;new name
"RTN","SD53FY20",162,0)
 . ; check if code already exists
"RTN","SD53FY20",163,0)
 . S SDIEN=$$FIND1^DIC(40.7,"","MX",SDCODE,"","","SDCHGERR")
"RTN","SD53FY20",164,0)
 . ; check if error
"RTN","SD53FY20",165,0)
 . I $D(SDCHGERR) D  Q
"RTN","SD53FY20",166,0)
 . . D BMES^XPDUTL("    >> ... Unable to inactivate stop code: "_SDCODE)
"RTN","SD53FY20",167,0)
 . . D MES^XPDUTL("    >> ... "_$G(SDCHGERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",168,0)
 . . D MES^XPDUTL("    >> ... Please contact support for assistance...")
"RTN","SD53FY20",169,0)
 . . ; clean out error array b4 processing next code
"RTN","SD53FY20",170,0)
 . . K SDCHGERR
"RTN","SD53FY20",171,0)
 . ; quit if no entry in file
"RTN","SD53FY20",172,0)
 . I 'SDIEN D  Q
"RTN","SD53FY20",173,0)
 . . D BMES^XPDUTL("    >> ... Unable to find stop code: "_SDCODE)
"RTN","SD53FY20",174,0)
 . . D MES^XPDUTL("    >> ... Please contact support for assistance.")
"RTN","SD53FY20",175,0)
 . ; check if code is active
"RTN","SD53FY20",176,0)
 . I $D(^DIC(40.7,SDIEN,0)) I $P(^(0),U,3)="" D
"RTN","SD53FY20",177,0)
 . . K SDFDA
"RTN","SD53FY20",178,0)
 . . S SDFDA(40.7,SDIEN_",",.01)=SDNEWNM
"RTN","SD53FY20",179,0)
 . . D FILE^DIE(,"SDFDA","SDCHGERR")
"RTN","SD53FY20",180,0)
 . . ; check if error
"RTN","SD53FY20",181,0)
 . . I $D(SDCHGERR) D  Q
"RTN","SD53FY20",182,0)
 . . . D BMES^XPDUTL("    >> ... Unable to change name for stop code: "_SDCODE)
"RTN","SD53FY20",183,0)
 . . . D MES^XPDUTL("    >> ... "_$G(SDCHGERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",184,0)
 . . . D MES^XPDUTL("    >> ... Please contact support for assistance.")
"RTN","SD53FY20",185,0)
 . . . ; clean out error array b4 processing next code
"RTN","SD53FY20",186,0)
 . . . K SDCHGERR
"RTN","SD53FY20",187,0)
 . . I '$D(SDCHGERR) D
"RTN","SD53FY20",188,0)
 . . . D BMES^XPDUTL("    >> Stop Code "_SDCODE_" name changed from: "_SDNM)
"RTN","SD53FY20",189,0)
 . . . D MES^XPDUTL("                                    to: "_SDNEWNM)
"RTN","SD53FY20",190,0)
 . . . I SDNM=SDNEWNM D
"RTN","SD53FY20",191,0)
 . . . . D BMES^XPDUTL("       Stop Code "_SDCODE_" name has already changed.")
"RTN","SD53FY20",192,0)
 ;
"RTN","SD53FY20",193,0)
 D BMES^XPDUTL(">>> Changing code names complete.")
"RTN","SD53FY20",194,0)
 D MES^XPDUTL("")
"RTN","SD53FY20",195,0)
 ;
"RTN","SD53FY20",196,0)
 Q
"RTN","SD53FY20",197,0)
 ;
"RTN","SD53FY20",198,0)
CHGRT ; Change restriction data
"RTN","SD53FY20",199,0)
 ; SDREC is in format: ;;code name^code #^restriction type^restriction date
"RTN","SD53FY20",200,0)
 N SDI,SDREC,SDNM,SDNUM,SDRTERR,SDIEN,SDOLDRT,SDRD,SDRT,SDX,SDINDT,SDEXRD,SDRDEX,SDRDIN
"RTN","SD53FY20",201,0)
 D BMES^XPDUTL(">>> Changing restriction data in CLINIC STOP (#40.7) file...")
"RTN","SD53FY20",202,0)
 ; load new entry
"RTN","SD53FY20",203,0)
 F SDI=1:1 S SDREC=$P($T(RT+SDI),";;",2) Q:SDREC="QUIT"  D
"RTN","SD53FY20",204,0)
 . S SDNM=$P(SDREC,U)       ; code name
"RTN","SD53FY20",205,0)
 . S SDNUM=$P(SDREC,U,2)    ; code #
"RTN","SD53FY20",206,0)
 . S SDRT=$P(SDREC,U,3)     ; restriction type
"RTN","SD53FY20",207,0)
 . S SDRD=$P(SDREC,U,4)     ; restriction date
"RTN","SD53FY20",208,0)
 . ;
"RTN","SD53FY20",209,0)
 . ; check if code already exists and get code IEN
"RTN","SD53FY20",210,0)
 . S SDIEN=$$FIND1^DIC(40.7,"","MX",SDNUM,"","","SDRTERR")
"RTN","SD53FY20",211,0)
 . ; check if error
"RTN","SD53FY20",212,0)
 . I $D(SDRTERR) D  Q
"RTN","SD53FY20",213,0)
 . . D BMES^XPDUTL("    >> ... Unable to inactivate stop code: "_SDNUM)
"RTN","SD53FY20",214,0)
 . . D MES^XPDUTL("    >> ... "_$G(SDRTERR("DIERR",1,"TEXT",1))_".")
"RTN","SD53FY20",215,0)
 . . D MES^XPDUTL("    >> ... Please contact support for assistance...")
"RTN","SD53FY20",216,0)
 . . ; clean out error array b4 processing next code
"RTN","SD53FY20",217,0)
 . . K SDRTERR
"RTN","SD53FY20",218,0)
 . I 'SDIEN D  Q
"RTN","SD53FY20",219,0)
 . . D BMES^XPDUTL("    >> ... Unable to find stop code: "_SDNUM)
"RTN","SD53FY20",220,0)
 . . D MES^XPDUTL("    >> ... Please contact support for assistance.")
"RTN","SD53FY20",221,0)
 . ; find current restriction type and date
"RTN","SD53FY20",222,0)
 . I $D(^DIC(40.7,SDIEN,0)) I $P(^(0),U,3)="" D
"RTN","SD53FY20",223,0)
 . . S SDOLDRT=$P(^DIC(40.7,SDIEN,0),U,6)  ; old restriction type
"RTN","SD53FY20",224,0)
 . . S SDEXRD=""
"RTN","SD53FY20",225,0)
 . . S X=$P(^DIC(40.7,SDIEN,0),U,7)  ; old restriction date
"RTN","SD53FY20",226,0)
 . . S %DT="FTX" D ^%DT Q:Y<0
"RTN","SD53FY20",227,0)
 . . S SDINDT=Y D DD^%DT S SDEXRD=Y
"RTN","SD53FY20",228,0)
 . ; set field value
"RTN","SD53FY20",229,0)
 . ; new restriction date
"RTN","SD53FY20",230,0)
 . S X=SDRD
"RTN","SD53FY20",231,0)
 . S %DT="FTX"
"RTN","SD53FY20",232,0)
 . D ^%DT
"RTN","SD53FY20",233,0)
 . I Y<0 S SDRDIN="" Q
"RTN","SD53FY20",234,0)
 . S SDRDIN=Y
"RTN","SD53FY20",235,0)
 . D DD^%DT
"RTN","SD53FY20",236,0)
 . S SDRDEX=Y
"RTN","SD53FY20",237,0)
 . ;
"RTN","SD53FY20",238,0)
 . K SDFDA
"RTN","SD53FY20",239,0)
 . S SDFDA(40.7,SDIEN_",",5)=SDRT
"RTN","SD53FY20",240,0)
 . S SDFDA(40.7,SDIEN_",",6)=SDRDIN  ; save internal dt
"RTN","SD53FY20",241,0)
 . D FILE^DIE(,"SDFDA","SDRTERR")
"RTN","SD53FY20",242,0)
 . I SDOLDRT'=SDRT D
"RTN","SD53FY20",243,0)
 . . D BMES^XPDUTL("    >> Stop Code "_SDNUM_" restriction type changed from: "_SDOLDRT)
"RTN","SD53FY20",244,0)
 . . D MES^XPDUTL("                                                to: "_SDRT)
"RTN","SD53FY20",245,0)
 . E  D
"RTN","SD53FY20",246,0)
 . . D BMES^XPDUTL("    >> Stop Code "_SDNUM_" restriction type changed from: "_SDOLDRT)
"RTN","SD53FY20",247,0)
 . . D MES^XPDUTL("                                                to: "_SDRT)
"RTN","SD53FY20",248,0)
 . . D BMES^XPDUTL("                     restriction type has already changed.")
"RTN","SD53FY20",249,0)
 . I SDEXRD'=SDRDEX D
"RTN","SD53FY20",250,0)
 . . D BMES^XPDUTL("    >>               restriction date changed from: "_SDEXRD)
"RTN","SD53FY20",251,0)
 . . D MES^XPDUTL("                                                to: "_SDRDEX)
"RTN","SD53FY20",252,0)
 . E  D
"RTN","SD53FY20",253,0)
 . . D BMES^XPDUTL("    >>               restriction date changed from: "_SDEXRD)
"RTN","SD53FY20",254,0)
 . . D MES^XPDUTL("                                                to: "_SDRDEX)
"RTN","SD53FY20",255,0)
 . . D BMES^XPDUTL("                     restriction date has already changed.")
"RTN","SD53FY20",256,0)
 D BMES^XPDUTL(">>> Changing restriction data complete.")
"RTN","SD53FY20",257,0)
 D MES^XPDUTL("")
"RTN","SD53FY20",258,0)
 K %,%DT,%H,%I,DIC,X,Y,SDFDA
"RTN","SD53FY20",259,0)
 Q
"RTN","SD53FY20",260,0)
 ;
"RTN","SD53FY20",261,0)
NEW ; codes to add - ;;stop code name^code #^restriction type^restriction date^CDR
"RTN","SD53FY20",262,0)
 ;;CARDIAC ECHO^391^E^
"RTN","SD53FY20",263,0)
 ;;AMB ECG MONITORING^392^E^
"RTN","SD53FY20",264,0)
 ;;QUIT
"RTN","SD53FY20",265,0)
 ;
"RTN","SD53FY20",266,0)
OFF ; codes to be inactivated - ;;code #^^inactive date
"RTN","SD53FY20",267,0)
 ;;QUIT
"RTN","SD53FY20",268,0)
 ;
"RTN","SD53FY20",269,0)
CHG ; Code name changes - ;;code name^code #^^new code name
"RTN","SD53FY20",270,0)
 ;;PACEMAKER^311^^CIED DEVICES
"RTN","SD53FY20",271,0)
 ;;DIABETIC RETINAL SCREENING^718^^EYE TELE SCREENING
"RTN","SD53FY20",272,0)
 ;;QUIT
"RTN","SD53FY20",273,0)
 ;
"RTN","SD53FY20",274,0)
RT ; Change Restriction - ;;stop code name^CODE #^rest type^rest date
"RTN","SD53FY20",275,0)
 ;;QUIT
"VER")
8.0^22.2
"BLD",11500,6)
^589
**END**
**END**

