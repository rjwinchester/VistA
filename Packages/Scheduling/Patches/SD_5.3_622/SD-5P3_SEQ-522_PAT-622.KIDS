Released SD*5.3*622 SEQ #522
Extracted from mail message
**KIDS**:SD*5.3*622^

**INSTALL NAME**
SD*5.3*622
"BLD",9571,0)
SD*5.3*622^SCHEDULING^0^3150217^y
"BLD",9571,1,0)
^^1^1^3140919^^
"BLD",9571,1,1,0)
Build for Scheduling Enhancement #4
"BLD",9571,4,0)
^9.64PA^44^2
"BLD",9571,4,44,0)
44
"BLD",9571,4,44,2,0)
^9.641^44^1
"BLD",9571,4,44,2,44,0)
HOSPITAL LOCATION  (File-top level)
"BLD",9571,4,44,2,44,1,0)
^9.6411^99.1^1
"BLD",9571,4,44,2,44,1,99.1,0)
TELEPHONE EXTENSION
"BLD",9571,4,44,222)
y^n^p^^^^n^^n
"BLD",9571,4,44,224)
 
"BLD",9571,4,407.5,0)
407.5
"BLD",9571,4,407.5,2,0)
^9.641^407.5^1
"BLD",9571,4,407.5,2,407.5,0)
LETTER  (File-top level)
"BLD",9571,4,407.5,2,407.5,1,0)
^9.6411^5^2
"BLD",9571,4,407.5,2,407.5,1,4,0)
PRINT DEFAULT PROVIDER?
"BLD",9571,4,407.5,2,407.5,1,5,0)
PRINT CLINIC LOCATION?
"BLD",9571,4,407.5,222)
y^n^p^^^^n^^n
"BLD",9571,4,407.5,224)
 
"BLD",9571,4,"APDD",44,44)
 
"BLD",9571,4,"APDD",44,44,99.1)
 
"BLD",9571,4,"APDD",407.5,407.5)
 
"BLD",9571,4,"APDD",407.5,407.5,4)
 
"BLD",9571,4,"APDD",407.5,407.5,5)
 
"BLD",9571,4,"B",44,44)
 
"BLD",9571,4,"B",407.5,407.5)
 
"BLD",9571,6.3)
30
"BLD",9571,"ABPKG")
n
"BLD",9571,"INID")
^y
"BLD",9571,"INIT")
POST^SD53622P
"BLD",9571,"KRN",0)
^9.67PA^779.2^20
"BLD",9571,"KRN",.4,0)
.4
"BLD",9571,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",.401,0)
.401
"BLD",9571,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",.402,0)
.402
"BLD",9571,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9571,"KRN",.402,"NM",1,0)
SDB    FILE #44^44^0
"BLD",9571,"KRN",.402,"NM","B","SDB    FILE #44",1)
 
"BLD",9571,"KRN",.403,0)
.403
"BLD",9571,"KRN",.5,0)
.5
"BLD",9571,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",.84,0)
.84
"BLD",9571,"KRN",3.6,0)
3.6
"BLD",9571,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",3.8,0)
3.8
"BLD",9571,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",9.2,0)
9.2
"BLD",9571,"KRN",9.8,0)
9.8
"BLD",9571,"KRN",9.8,"NM",0)
^9.68A^282^7
"BLD",9571,"KRN",9.8,"NM",272,0)
SDNACT^^0^B29097285
"BLD",9571,"KRN",9.8,"NM",277,0)
SDLT^^0^B28750556
"BLD",9571,"KRN",9.8,"NM",278,0)
SDLTE^^0^B2437046
"BLD",9571,"KRN",9.8,"NM",279,0)
SDCP^^0^B22827962
"BLD",9571,"KRN",9.8,"NM",280,0)
SDM0^^0^B92285197
"BLD",9571,"KRN",9.8,"NM",281,0)
SDM1A^^0^B78000980
"BLD",9571,"KRN",9.8,"NM",282,0)
SDMM1^^0^B15878644
"BLD",9571,"KRN",9.8,"NM","B","SDCP",279)
 
"BLD",9571,"KRN",9.8,"NM","B","SDLT",277)
 
"BLD",9571,"KRN",9.8,"NM","B","SDLTE",278)
 
"BLD",9571,"KRN",9.8,"NM","B","SDM0",280)
 
"BLD",9571,"KRN",9.8,"NM","B","SDM1A",281)
 
"BLD",9571,"KRN",9.8,"NM","B","SDMM1",282)
 
"BLD",9571,"KRN",9.8,"NM","B","SDNACT",272)
 
"BLD",9571,"KRN",19,0)
19
"BLD",9571,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",19.1,0)
19.1
"BLD",9571,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",101,0)
101
"BLD",9571,"KRN",101,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",409.61,0)
409.61
"BLD",9571,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",771,0)
771
"BLD",9571,"KRN",771,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",779.2,0)
779.2
"BLD",9571,"KRN",870,0)
870
"BLD",9571,"KRN",870,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",8989.51,0)
8989.51
"BLD",9571,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",9571,"KRN",8989.52,0)
8989.52
"BLD",9571,"KRN",8994,0)
8994
"BLD",9571,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",9571,"KRN","B",.4,.4)
 
"BLD",9571,"KRN","B",.401,.401)
 
"BLD",9571,"KRN","B",.402,.402)
 
"BLD",9571,"KRN","B",.403,.403)
 
"BLD",9571,"KRN","B",.5,.5)
 
"BLD",9571,"KRN","B",.84,.84)
 
"BLD",9571,"KRN","B",3.6,3.6)
 
"BLD",9571,"KRN","B",3.8,3.8)
 
"BLD",9571,"KRN","B",9.2,9.2)
 
"BLD",9571,"KRN","B",9.8,9.8)
 
"BLD",9571,"KRN","B",19,19)
 
"BLD",9571,"KRN","B",19.1,19.1)
 
"BLD",9571,"KRN","B",101,101)
 
"BLD",9571,"KRN","B",409.61,409.61)
 
"BLD",9571,"KRN","B",771,771)
 
"BLD",9571,"KRN","B",779.2,779.2)
 
"BLD",9571,"KRN","B",870,870)
 
"BLD",9571,"KRN","B",8989.51,8989.51)
 
"BLD",9571,"KRN","B",8989.52,8989.52)
 
"BLD",9571,"KRN","B",8994,8994)
 
"BLD",9571,"QUES",0)
^9.62^^
"BLD",9571,"REQB",0)
^9.611^5^5
"BLD",9571,"REQB",1,0)
SD*5.3*621^1
"BLD",9571,"REQB",2,0)
SD*5.3*327^1
"BLD",9571,"REQB",3,0)
SD*5.3*354^1
"BLD",9571,"REQB",4,0)
SD*5.3*555^1
"BLD",9571,"REQB",5,0)
SD*5.3*568^1
"BLD",9571,"REQB","B","SD*5.3*327",2)
 
"BLD",9571,"REQB","B","SD*5.3*354",3)
 
"BLD",9571,"REQB","B","SD*5.3*555",4)
 
"BLD",9571,"REQB","B","SD*5.3*568",5)
 
"BLD",9571,"REQB","B","SD*5.3*621",1)
 
"FIA",44)
HOSPITAL LOCATION
"FIA",44,0)
^SC(
"FIA",44,0,0)
44I
"FIA",44,0,1)
y^n^p^^^^n^^n
"FIA",44,0,10)
 
"FIA",44,0,11)
 
"FIA",44,0,"RLRO")
 
"FIA",44,0,"VR")
5.3^SD
"FIA",44,44)
1
"FIA",44,44,99.1)
 
"FIA",407.5)
LETTER
"FIA",407.5,0)
^VA(407.5,
"FIA",407.5,0,0)
407.5I
"FIA",407.5,0,1)
y^n^p^^^^n^^n
"FIA",407.5,0,10)
 
"FIA",407.5,0,11)
 
"FIA",407.5,0,"RLRO")
 
"FIA",407.5,0,"VR")
5.3^SD
"FIA",407.5,407.5)
1
"FIA",407.5,407.5,4)
 
"FIA",407.5,407.5,5)
 
"INIT")
POST^SD53622P
"KRN",.402,485,-1)
0^1
"KRN",.402,485,0)
SDB^3150217.1728^^44^^^3150217
"KRN",.402,485,"%D",0)
^^1^1^2970819^
"KRN",.402,485,"%D",1,0)
 
"KRN",.402,485,"DIAB",1,1,44.03,0)
ALL
"KRN",.402,485,"DIAB",1,1,44.04,0)
ALL
"KRN",.402,485,"DR",1,44)
.01;1;2504//Y;9;2502;S:X'["Y" Y="@05";2502.5;@05;S:$S('$D(^DG(43,1,"GL")):1,$D(^DG(43,1,"GL"))&('$P(^DG(43,1,"GL"),"^",2)):1,1:0) Y="@10";3.5//^S X=+$O(^DG(40.8,0)),X=$S($D(^(X,0)):$P(^(0),"^"),1:"");@10;8;2507//REGULAR;2802;99;
"KRN",.402,485,"DR",1,44,1)
S:X="" $P(^SC(DA,99.1),"^",1)="",Y="@15";99.1;@15;2000;2000.5//YES;2508;2509;2510;2511;24;2600;2801;2700;30;2001;2002;S:+$O(^SC(DA,"ST",0))>0 Y="@25";1914;Q;@25;2003;2005;1918.5;2503;2500;S:X'="Y" Y="@30";2501;Q;@30;10;1916;1918;
"KRN",.402,485,"DR",1,44,2)
1910;1912;Q;I '$D(SDLA) S SDLA=X;1913;S:+$O(^SC(DA,"ST",0))>0 Y="@99";1917//4;@99;
"KRN",.402,485,"DR",2,44.03)
.01
"KRN",.402,485,"DR",2,44.04)
.01
"KRN",.402,485,"DR",2,44.1)
.01;.02;
"KRN",.402,485,"DR",2,44.11)
.01;.02;
"KRN",.402,485,"ROU")
^SDBT
"KRN",.402,485,"ROUOLD")
SDBT
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,20,0)
^9.402P^^
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^2930813^2960613
"PKG",48,22,1,"PAH",1,0)
622^3150217
"PKG",48,22,1,"PAH",1,1,0)
^^1^1^3150217
"PKG",48,22,1,"PAH",1,1,1,0)
Build for Scheduling Enhancement #4
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SD53622P")
0^^B6649230^n/a
"RTN","SD53622P",1,0)
SD53622P ;ALB/CR - SD*5.3*622 INSTALL UTILITY ;10/15/14
"RTN","SD53622P",2,0)
 ;;5.3;Scheduling;**622**;Aug 13, 1993;Build 30
"RTN","SD53622P",3,0)
 ; -------------------------------------------------------------------
"RTN","SD53622P",4,0)
 ; utility to create a mail group used by the Clinic Inactivation
"RTN","SD53622P",5,0)
 ; option. Sites will need to populate the mail group with the users
"RTN","SD53622P",6,0)
 ; tasked with taking action to complete a clinic inactivation.
"RTN","SD53622P",7,0)
 ; -------------------------------------------------------------------
"RTN","SD53622P",8,0)
 ; ICR #1146 - allows Mailman API use of $$MG^XMBGRP
"RTN","SD53622P",9,0)
 ;
"RTN","SD53622P",10,0)
 ; post-install
"RTN","SD53622P",11,0)
POST N SDIEN,SDDUZ,SDGROUP,SDSELF,SDTEXT,SDTYPE,SDQUIET,SDXMY
"RTN","SD53622P",12,0)
 S SDGROUP="SD CLINIC INACTIVATE REMINDER"
"RTN","SD53622P",13,0)
 S SDSELF=0  ; don't allow self-enrollment
"RTN","SD53622P",14,0)
 S SDTYPE=0  ; public group (default)
"RTN","SD53622P",15,0)
 S SDQUIET=1 ; silent flag (default)
"RTN","SD53622P",16,0)
 S SDXMY(.5)="" ; use Postmaster as the first member of the group
"RTN","SD53622P",17,0)
 ;
"RTN","SD53622P",18,0)
 ; group description
"RTN","SD53622P",19,0)
 S SDTEXT(1)="This mail group is organized to inform Scheduling users"
"RTN","SD53622P",20,0)
 S SDTEXT(2)="whenever a clinic is inactivated either on the current"
"RTN","SD53622P",21,0)
 S SDTEXT(3)="date or on a future date. If this group is not populated"
"RTN","SD53622P",22,0)
 S SDTEXT(4)="with the corresponding users, or if it is deleted, the"
"RTN","SD53622P",23,0)
 S SDTEXT(5)="clinic inactivation messages will error out. The routine"
"RTN","SD53622P",24,0)
 S SDTEXT(6)="SDNACT needs this mail group in order to work properly."
"RTN","SD53622P",25,0)
 ;
"RTN","SD53622P",26,0)
 S SDIEN=$$FIND1^DIC(3.8,"","X",SDGROUP,"B")
"RTN","SD53622P",27,0)
 S SDDUZ=$S(+$G(DUZ)>0:DUZ,1:.5) ; group organizer, otherwise Postmaster
"RTN","SD53622P",28,0)
 I $G(SDIEN)>0 D  Q
"RTN","SD53622P",29,0)
 . D BMES^XPDUTL("The mail group "_SDGROUP_" exists.")
"RTN","SD53622P",30,0)
 . D MES^XPDUTL("Please make sure that is is populated.")
"RTN","SD53622P",31,0)
 ;
"RTN","SD53622P",32,0)
 I $G(SDIEN)=0 D
"RTN","SD53622P",33,0)
 . D BMES^XPDUTL("The mail group "_SDGROUP_" needs to be created. Please wait...")
"RTN","SD53622P",34,0)
 ;
"RTN","SD53622P",35,0)
 S SDIEN=$$MG^XMBGRP(SDGROUP,SDTYPE,SDDUZ,SDSELF,.SDXMY,.SDTEXT,SDQUIET)
"RTN","SD53622P",36,0)
 I $G(SDIEN)>0 D  Q
"RTN","SD53622P",37,0)
 . D BMES^XPDUTL("  ******************************")
"RTN","SD53622P",38,0)
 . D MES^XPDUTL("  Mail group "_SDGROUP_" created.")
"RTN","SD53622P",39,0)
 . D MES^XPDUTL("  After the patch installation, please add other members from Scheduling.")
"RTN","SD53622P",40,0)
 . D MES^XPDUTL("  ******************************")
"RTN","SD53622P",41,0)
 E  D BMES^XPDUTL("  Unable to create new mail group")
"RTN","SD53622P",42,0)
 Q
"RTN","SDCP")
0^279^B22827962^B21063819
"RTN","SDCP",1,0)
SDCP ;BSN/GRR - CLINIC LIST ; 15 MAR 1999  4:10 PM
"RTN","SDCP",2,0)
 ;;5.3;Scheduling;**140,171,187,354,622**;Aug 13, 1993;Build 30
"RTN","SDCP",3,0)
 D ASK2^SDDIV G:Y<0 END S VAUTNI=1 D CLINIC^VAUTOMA G:Y<0 END
"RTN","SDCP",4,0)
QUE N ZTSAVE F Y="VAUTD","VAUTD(","VAUTC","VAUTC(" S ZTSAVE(Y)=""
"RTN","SDCP",5,0)
 D EN^XUTMDEVQ("START^SDCP","Clinic Profile",.ZTSAVE) Q
"RTN","SDCP",6,0)
 ;
"RTN","SDCP",7,0)
START ;Print report
"RTN","SDCP",8,0)
 ; SD*5.3*622 - SDPRTTOF helps prevent double printing of Header
"RTN","SDCP",9,0)
 N SDPRTTOF S SDPRTTOF=1
"RTN","SDCP",10,0)
 S END=0 D:'$D(DT) DT^SDUTL
"RTN","SDCP",11,0)
 S Y=DT D DTS^SDUTL S PDATE=Y,SCN=0 D TOF G:'VAUTC SOME
"RTN","SDCP",12,0)
 F  S SCN=$O(^SC("B",SCN)) Q:SCN=""!(END)  S SC=$O(^SC("B",SCN,0)) D:$$CHECK() SET0,SETSL,PRT
"RTN","SDCP",13,0)
 G END
"RTN","SDCP",14,0)
 ;
"RTN","SDCP",15,0)
SOME F  S SCN=$O(VAUTC(SCN)) Q:SCN=""!(END)  S SC=+VAUTC(SCN) D:$$CHECK() SET0,SETSL,PRT
"RTN","SDCP",16,0)
 G END
"RTN","SDCP",17,0)
 ;
"RTN","SDCP",18,0)
END W ! I $E(IOST)="C",'$G(END,1) N DIR S DIR(0)="E" D ^DIR
"RTN","SDCP",19,0)
 K ABBR,ALV,C,DAYS,DIC,DIPH,DOW,END,HCDB,I,J,L,LOC,LOP,M,NAME,ODM,PC,PDATE,POP,SC,SCSC,SDSC,SDMX,SDNO,SDNO,SDC,SDCR,SCSC,SCN,SDIN,SDPR,SDRE,STCD,STDAT,X,Y,SD,SDCNT,VAUTC,VAUTD,VAUTNI,STRING Q
"RTN","SDCP",20,0)
 ;
"RTN","SDCP",21,0)
SET0 S STRING=^SC(SC,0)
"RTN","SDCP",22,0)
 S NAME=$P(STRING,U,1),ABBR=$P(STRING,U,2),LOC=$P(STRING,U,11),(STCD,SDSC)=$P(STRING,U,7),SDCR=$P(STRING,U,18),SDCNT=$P(STRING,U,17)
"RTN","SDCP",23,0)
 S:$D(^SC(SC,"SDP")) SDMX=$P(^SC(SC,"SDP"),U,2) Q
"RTN","SDCP",24,0)
 ;
"RTN","SDCP",25,0)
SETSL S (LOP,HCDB,ALV,PC,ODM,DIPH,STDAT,STRING)="",STCD=$S(STCD="":" ",1:STCD),STCD=$S('$D(^DIC(40.7,+STCD,0)):"",1:$P(^(0),U,2)),SDSC=$S($D(^DIC(40.7,+SDSC,0)):'$P(^(0),U,3)!($P(^(0),U,3)>DT),1:0)
"RTN","SDCP",26,0)
 S SDPR=$S('$D(^SC(SC,"SDPROT")):"NO",'$L($P(^("SDPROT"),U)):"NO",1:"YES")
"RTN","SDCP",27,0)
 S SDCR=$S(SDCR="":" ",1:SDCR),SDCR=$S('$D(^DIC(40.7,+SDCR,0)):"",1:$P(^(0),U,2))
"RTN","SDCP",28,0)
 I $D(^SC(SC,"SL")) S STRING=^("SL"),LOP=$P(STRING,U,1),HCDB=$P(STRING,U,3),ALV=$S($P(STRING,U,2)["V":"YES",1:"NO")
"RTN","SDCP",29,0)
 I  S PC=$S($P(STRING,U,5)]"":$P(^SC($P(STRING,U,5),0),U,1),1:""),ODM=$P(STRING,U,7),DIPH=$S($P(STRING,U,6)=4:15,$P(STRING,U,6)=3:20,$P(STRING,U,6)=1:60,$P(STRING,U,6)=2:30,1:10)
"RTN","SDCP",30,0)
 S STDAT=$O(^SC(SC,"T",0)) S:STDAT<1 STDAT="UNKNOWN"
"RTN","SDCP",31,0)
 K DOW F L=0:1:6 F M=DT-.1:0 S M=$O(^SC(SC,"T"_L,M)) Q:M=""  I $D(^(M,1)) S:^(1)]"" DOW(L+1)="" Q:^(1)]""  K DOW(L+1)
"RTN","SDCP",32,0)
 F L=DT-.1:0 S L=$O(^SC(SC,"T",L)) Q:L=""  S X=L D DW^%DTC I '$D(DOW(Y+1)),$D(^SC(SC,"OST",L,1)),^(1)["[" S DOW(Y+1)=""
"RTN","SDCP",33,0)
 S DAYS="" F M=1:1:7 I $D(DOW(M)) S DAYS=DAYS_$S(DAYS'="":",",1:"")_$P("SU^MO^TU^WE^TH^FR^SA",U,M)
"RTN","SDCP",34,0)
 Q
"RTN","SDCP",35,0)
 ;
"RTN","SDCP",36,0)
L(SDT,SDCOL,SDVAL) ;Print field label
"RTN","SDCP",37,0)
 ;Input: SDT=field label
"RTN","SDCP",38,0)
 ;Input: SDCOL=column to line up to
"RTN","SDCP",39,0)
 ;Input: SDVAL=field value
"RTN","SDCP",40,0)
 W ?(SDCOL-$L(SDT)-2),SDT,": ",SDVAL Q
"RTN","SDCP",41,0)
 ;
"RTN","SDCP",42,0)
PRT I $Y+12>IOSL D:IOSL<25 SEEND:$E(IOST,1,2)="C-" Q:END  D TOF
"RTN","SDCP",43,0)
 S SDNO="" W ! D L("Clinic",19,NAME),L("Abbr.",62,ABBR)
"RTN","SDCP",44,0)
 S SDPRTTOF=1   ; SD*5.3*622 - SDPRTTOF helps prevent double Headers
"RTN","SDCP",45,0)
 W ! D L("Location",19,$E(LOC,1,30)),L("Telephone",62,$S($D(^SC(SC,99)):^SC(SC,99),1:""))
"RTN","SDCP",46,0)
 ; SD*5.3*622 - add new field telephone extension
"RTN","SDCP",47,0)
 W ! D L("Telephone Ext.",19,$S($D(^SC(SC,99.1)):^SC(SC,99.1),1:""))
"RTN","SDCP",48,0)
 W ! D L("Days clinic meets",19,DAYS) I 'SDNO S Y=STDAT D:STDAT'="UNKNOWN" DTS^SDUTL
"RTN","SDCP",49,0)
 D L("Start date",62,$S(STDAT="UNKNOWN":"UNKNOWN",1:Y))
"RTN","SDCP",50,0)
 W ! D L("Increments",19,DIPH_" Minutes"),L("Hour display begins",62,$S(HCDB="":"8 AM",HCDB<13:HCDB_" AM",1:HCDB-12_" PM"))
"RTN","SDCP",51,0)
 W ! D L("Appt. length",19,LOP_" Minutes"),L("Variable length appts.",62,ALV)
"RTN","SDCP",52,0)
 W ! D L("Stop Code",19,STCD),L("Maximum overbooks per day",62,ODM)
"RTN","SDCP",53,0)
 W ! D L("Credit Stop Code",19,SDCR),L("Non-count clinic",62,$S(SDCNT="Y":"YES",1:"NO"))
"RTN","SDCP",54,0)
 W ! D L("Prohibit access",19,SDPR),L("Maximum days for future booking",62,$G(SDMX))
"RTN","SDCP",55,0)
 I PC]"" W ! D L("Principal clinic",19,PC)
"RTN","SDCP",56,0)
 I $D(^SC(SC,"I")) S SDRE=+$P(^("I"),U,2),SDIN=+^("I") I SDRE'=SDIN D:SDIN'>DT&(SDRE=0!(SDRE>DT)) INACT
"RTN","SDCP",57,0)
 I 'SDNO,$D(SDIN),SDIN>DT,SDRE'=SDIN W !!,?4,"**** Clinic will be inactive ",$S(SDRE:"from ",1:"as of ") S Y=SDIN D DTS^SDUTL W Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"")," ****" K SDIN,SDRE
"RTN","SDCP",58,0)
 I 'SDSC W !!,?4,"*** INVALID OR INACTIVE STOP CODE ASSIGNED TO THIS CLINIC ***"
"RTN","SDCP",59,0)
 Q
"RTN","SDCP",60,0)
 ;
"RTN","SDCP",61,0)
INACT S Y=SDIN D DTS^SDUTL W !!,?4,"**** Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"")," ****" K SDIN,SDRE S SDNO=1
"RTN","SDCP",62,0)
 Q
"RTN","SDCP",63,0)
 ;
"RTN","SDCP",64,0)
SEEND W ! N DIR S DIR(0)="E" D ^DIR S END=Y'=1 Q:END
"RTN","SDCP",65,0)
 ; SD*5.3*622 - SDPRTTOF helps prevent double printing of Header
"RTN","SDCP",66,0)
TOF I SDPRTTOF W @IOF,?22,"CLINIC PROFILES AS OF: ",PDATE,! S SDPRTTOF=0 Q
"RTN","SDCP",67,0)
 ;
"RTN","SDCP",68,0)
CHECK() ;Check location for inclusion
"RTN","SDCP",69,0)
 I $D(^SC(SC,0)),($P(^(0),U,3)="C"),$S(VAUTD:1,$D(VAUTD(+$P(^(0),U,15))):1,'$P(^(0),U,15)&($D(VAUTD($O(^DG(40.8,0))))):1,1:0) Q 1
"RTN","SDCP",70,0)
 Q 0
"RTN","SDCP",71,0)
 ;
"RTN","SDCP",72,0)
 ;
"RTN","SDCP",73,0)
PAUSE(LINE) ;
"RTN","SDCP",74,0)
 N Y S Y=1
"RTN","SDCP",75,0)
 I $E(IOST,1,2)="C-",(LINE+5)>IOSL D PAUSE^VALM1 S LINE=0
"RTN","SDCP",76,0)
 S LINE=LINE+1
"RTN","SDCP",77,0)
 Q Y
"RTN","SDLT")
0^277^B28750556^B17520984
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ; 14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330,398,523,441,555,622**;Aug 13, 1993;Build 30
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ;
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 N Z0,X
"RTN","SDLT",16,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",17,0)
PRT S DFN=$P(A,U,1)  ;SD*523
"RTN","SDLT",18,0)
 I $D(SDNOSH) I $D(^DPT(DFN,.1)) S POP=1 Q:POP  ;SD/523
"RTN","SDLT",19,0)
 S Y=DT D DTS^SDUTL
"RTN","SDLT",20,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",21,0)
 K SDFIRST
"RTN","SDLT",22,0)
 ;S SDFIRST=0
"RTN","SDLT",23,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",24,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",25,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",26,0)
 N DPTNAME
"RTN","SDLT",27,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",28,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",29,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",30,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",31,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",32,0)
 N B
"RTN","SDLT",33,0)
 ; SD*5.3*622 - re-arrange display of clinic name
"RTN","SDLT",34,0)
 ;S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",35,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL="   Clinic:  "_SDCL D FORM ; SD*5.3*622 end changes
"RTN","SDLT",36,0)
 ;
"RTN","SDLT",37,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",38,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",39,0)
 ; SD*5.3*622 - add more detail for appointment and format it
"RTN","SDLT",40,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3))
"RTN","SDLT",41,0)
 W:'$D(B) !?5,"Date/Time: ",?17,DOW,?$L(DOW)+19,$J(SDDAT,12)
"RTN","SDLT",42,0)
 I '$D(B),$D(SDC) W ?22,$J(SDT0,9),!?5,SDCL
"RTN","SDLT",43,0)
 ; get default provider if defined for a given clinic, print it on the
"RTN","SDLT",44,0)
 ; letter only if we have a YES on file, same for clinic location
"RTN","SDLT",45,0)
 ; skip printing the provider label if the field is empty in file #44
"RTN","SDLT",46,0)
 N J,SDLOC,SDPROV,SDPRNM,SDTEL,SDTELEXT
"RTN","SDLT",47,0)
 S SDLOC=$P($G(^SC(+SDC,0)),"^",11) ; physical location of the clinic
"RTN","SDLT",48,0)
 S SDTEL=$G(^SC(+SDC,99))        ; telephone number of clinic
"RTN","SDLT",49,0)
 S SDTELEXT="" I SDTEL]"",$G(^SC(+SDC,99.1))]"" D
"RTN","SDLT",50,0)
 .S SDTELEXT=^SC(+SDC,99.1)  ; telephone ext of clinic
"RTN","SDLT",51,0)
 ; get default provider, if any
"RTN","SDLT",52,0)
 F J=0:0 S J=$O(^SC(+SDC,"PR",J)) Q:'J>0  I $P($G(^SC(+SDC,"PR",J,0)),U,2)=1 S SDPROV=+$P(^SC(+SDC,"PR",J,0),U,1)
"RTN","SDLT",53,0)
 I $D(SDC),'$D(B),$P($G(^VA(407.5,SDLET,3)),U,2)="Y" D
"RTN","SDLT",54,0)
 .W:SDLOC]"" !?6,"Location:  "_SDLOC
"RTN","SDLT",55,0)
 I $D(SDC),'$D(B),SDTEL]"" D
"RTN","SDLT",56,0)
 .W !?5,"Telephone:  ",SDTEL
"RTN","SDLT",57,0)
 .W:SDTELEXT]"" "   Telephone Ext.:  ",SDTELEXT
"RTN","SDLT",58,0)
 I $D(SDPROV) D
"RTN","SDLT",59,0)
 .I $D(SDC),SDPROV>0 S SDPRNM=$P(^VA(200,SDPROV,0),U,1)
"RTN","SDLT",60,0)
 .I $D(SDC),'$D(B),$P($G(^VA(407.5,SDLET,3)),U,1)="Y" W:SDPRNM]"" !?6,"Provider:  "_$G(SDPRNM)
"RTN","SDLT",61,0)
 ; call handler for LAB, XRAY, and EKG tests
"RTN","SDLT",62,0)
 I $D(B) D TST
"RTN","SDLT",63,0)
 I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",64,0)
 ; SD*5.3*622 end changes
"RTN","SDLT",65,0)
 Q
"RTN","SDLT",66,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",67,0)
 N Z5,I,X
"RTN","SDLT",68,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",69,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",70,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",71,0)
 D ADDR Q
"RTN","SDLT",72,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN)
"RTN","SDLT",73,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",74,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",75,0)
 D ADD^VADPT D
"RTN","SDLT",76,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",77,0)
 .N SDIENS,X
"RTN","SDLT",78,0)
 .I $D(VAPA(5)) S SDIENS=+VAPA(5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(5),U,2)=X
"RTN","SDLT",79,0)
 .I $D(VAPA(17)) S SDIENS=+VAPA(17)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(17),U,2)=X
"RTN","SDLT",80,0)
 .K SDIENS Q
"RTN","SDLT",81,0)
 N SDCCACT1,SDCCACT2,LL
"RTN","SDLT",82,0)
 S SDCCACT1=VAPA(12),SDCCACT2=$P($G(VAPA(22,2)),"^",3)
"RTN","SDLT",83,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",84,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",85,0)
 .F LL=1:1:3 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",86,0)
 .;if country is blank display as USA
"RTN","SDLT",87,0)
 .I (VAPA(25)="")!($P(VAPA(25),"^",2)="UNITED STATES")  D  ;display city,state,zip
"RTN","SDLT",88,0)
 ..W !,?12,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDLT",89,0)
 .E  D  ;display postal code,city,province
"RTN","SDLT",90,0)
 ..W !,?12,VAPA(24)_" "_VAPA(4)_" "_VAPA(23)
"RTN","SDLT",91,0)
 .W:($P(VAPA(25),"^",2)'="UNITED STATES") !,?12,$P(VAPA(25),U,2) ;display country
"RTN","SDLT",92,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",93,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",94,0)
 .F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",95,0)
 .I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDLT",96,0)
 ..W !,?12,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDLT",97,0)
 .E  D
"RTN","SDLT",98,0)
 ..W !,?12,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDLT",99,0)
 .W:($P(VAPA(28),"^",2)'="UNITED STATES") !?12,$P(VAPA(28),U,2)
"RTN","SDLT",100,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",101,0)
 ;
"RTN","SDLT",102,0)
 ;
"RTN","SDLT",103,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",104,0)
 N SDX
"RTN","SDLT",105,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",106,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDLT",107,0)
 ;
"RTN","SDLT",108,0)
BADADD ;Print patients with a Bad Address Indicator
"RTN","SDLT",109,0)
 I '$D(^TMP($J,"BADADD")) Q
"RTN","SDLT",110,0)
 N SDHDR,SDHDR1
"RTN","SDLT",111,0)
 W @IOF,$TR($J("",IOM)," ","*")
"RTN","SDLT",112,0)
 S SDHDR="BAD ADDRESS INDICATOR LIST" W !,?(IOM-$L(SDHDR)/2),SDHDR,!
"RTN","SDLT",113,0)
 S SDHDR1="** THE LETTER FOR THESE PATIENT(S) DID NOT PRINT DUE TO A BAD ADDRESS INDICATOR."
"RTN","SDLT",114,0)
 W !,"Last 4",!,"of SSN",?10,"Patient Name",!
"RTN","SDLT",115,0)
 W $TR($J("",IOM)," ","*")
"RTN","SDLT",116,0)
 N SDNAM,SDDFN
"RTN","SDLT",117,0)
 S SDNAM="" F  S SDNAM=$O(^TMP($J,"BADADD",SDNAM)) Q:SDNAM=""  D
"RTN","SDLT",118,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"BADADD",SDNAM,SDDFN)) Q:'SDDFN  D
"RTN","SDLT",119,0)
 . . W !,$$LAST4(SDDFN),?10,SDNAM
"RTN","SDLT",120,0)
 W !!,SDHDR1
"RTN","SDLT",121,0)
 Q
"RTN","SDLT",122,0)
 ;
"RTN","SDLT",123,0)
TST ; SD*5.3*622 - handle scheduled tests
"RTN","SDLT",124,0)
 W !
"RTN","SDLT",125,0)
 W:($L(SDCL)=3&($E(SDCL,1,3)="LAB")) ?1,SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",126,0)
 W:($L(SDCL)=4&($E(SDCL,1,4)="XRAY")) SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",127,0)
 W:($L(SDCL)=3&($E(SDCL,1,3)="EKG")) ?1,SDCL_" SCHEDULED:  "_DOW_"  "_$J(SDDAT,12)_"  "_$J(SDT0,5)
"RTN","SDLT",128,0)
 Q  ; SD*5.3*622 - end of changes
"RTN","SDLTE")
0^278^B2437046^B2395827
"RTN","SDLTE",1,0)
SDLTE ;ALB/LDB - ENTER/EDIT SCHEDULING LETTERS ; 10 DEC 88 11:00 AM
"RTN","SDLTE",2,0)
 ;;5.3;Scheduling;**622**;Aug 13, 1993;Build 30
"RTN","SDLTE",3,0)
RD S DIC=407.6,DIC("A")="SELECT TYPE OF LETTER: ",DIC(0)="AEQMZ" D ^DIC G:+Y'>0 EXIT S T=+Y S (DIC,DLAYGO)=407.5,DIC(0)="AQELM",DIC("A")="SELECT LETTER: ",DIC("S")="I $P(^(0),""^"",2)="_""""_$P(^VA(407.6,+T,0),"^")_""""
"RTN","SDLTE",4,0)
 S DIC("DR")="1////"_$P(^VA(407.6,+T,0),"^") D ^DIC G:Y'>0 EXIT S SDLT=+Y,DA=SDLT,DIE=407.5,DR=".01;1;2;3;4;5",DR(2,407.52)=".01",DR(2,407.53)=".01" D ^DIE G:$D(Y) EXIT D EXIT W !! G RD
"RTN","SDLTE",5,0)
EXIT K DA,DIC,DIE,DR,SDLT,T,X,Y Q
"RTN","SDM0")
0^280^B92285197^B90223264
"RTN","SDM0",1,0)
SDM0 ;SF/GFT - MAKE APPOINTMENT ;11 Jun 2001  5:20 PM
"RTN","SDM0",2,0)
 ;;5.3;Scheduling;**140,167,206,186,223,237,241,384,334,547,621,622**;Aug 13, 1993;Build 30
"RTN","SDM0",3,0)
 I $D(SDXXX) S SDOK=1 Q
"RTN","SDM0",4,0)
 N SDSRTY,SDDATE,SDSDATE,SDDATE2,SDSRFU,SDDMAX,SDONCE
"RTN","SDM0",5,0)
 ;Prompt for scheduling request type
"RTN","SDM0",6,0)
M N SDHX,SDXF,SDXD
"RTN","SDM0",7,0)
 Q:'$$SRTY(.SDSRTY)  S:SDSRTY SDDATE=DT
"RTN","SDM0",8,0)
 ;  SD*5.3*622 - let user see desired date
"RTN","SDM0",9,0)
 I $D(SDDATE) S Y=SDDATE,SDDATE2=$$FMTE^XLFDT(Y) W !!,"APPOINTMENT DESIRED DATE:  "_SDDATE2 W ! H 3
"RTN","SDM0",10,0)
 ;Calculate appointment follow-up indicator
"RTN","SDM0",11,0)
 S SDSRFU=$$PTFU(DFN,SC)
"RTN","SDM0",12,0)
 ;Determine maximum days for scheduling
"RTN","SDM0",13,0)
 S SDMAX(1)=$P($G(^SC(+SC,"SDP")),U,2) S:'SDMAX(1) SDMAX(1)=365
"RTN","SDM0",14,0)
 S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDM0",15,0)
 ;Prompt for desired date
"RTN","SDM0",16,0)
 Q:'$$DDATE(.SDDATE,SDSRTY,.SDMAX)
"RTN","SDM0",17,0)
 ;If date and time, schedule appt. directly
"RTN","SDM0",18,0)
 W ! I SDDATE#1 S SDSDATE=SDDATE,SDDATE=SDDATE\1 G ^SDM1
"RTN","SDM0",19,0)
 S (X,Y)=SDDATE K SDHX
"RTN","SDM0",20,0)
 ;Find first available after specified date
"RTN","SDM0",21,0)
 I X="F"!(X="f") D SUP,DT1 G NEXT
"RTN","SDM0",22,0)
 ;Find next available appointment
"RTN","SDM0",23,0)
 I SDSRTY,SDDATE D SUP S SDSTRTDT=SDDATE D OVR^SDMULT0 G NEXT
"RTN","SDM0",24,0)
 ;
"RTN","SDM0",25,0)
EN S:$L(X)=1 X=$TR(X,"tnN","TTT") S:X="NOW" X="T" I X?.A!(+X=X),X<13,X'?1"T".E S X=X_" 1"
"RTN","SDM0",26,0)
 D  Q:Y<1
"RTN","SDM0",27,0)
 .N %DT
"RTN","SDM0",28,0)
 .S %DT="T" D ^%DT
"RTN","SDM0",29,0)
 .I Y<1 W !!,"Unable to evaluate date value """_X_""".",!
"RTN","SDM0",30,0)
 .Q
"RTN","SDM0",31,0)
 S:$S($D(DUZ)'[0:1,1:0) ^DISV(DUZ_U_+SC)=Y
"RTN","SDM0",32,0)
DISP S IOF=$S('$D(IOF):"!#",IOF']"":"!#",1:IOF) W @IOF S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),SDAV=0
"RTN","SDM0",33,0)
 I $D(SDINA),Y'<SDINA,SDRE>Y!('SDRE) S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY D PAUSE^VALM1 Q:'SDRE
"RTN","SDM0",34,0)
 S:Y#100=0 Y=Y+1 S X=Y D D:$E(X,4,5) S (SDX,X1)=X,X2=1 D C^%DTC S X=SDX K SDX G:SDAV ^SDM1 Q
"RTN","SDM0",35,0)
 ;
"RTN","SDM0",36,0)
NEXT D SET I $S('$D(FND):1,'FND:1,1:0) D  G EN
"RTN","SDM0",37,0)
 .K ^DISV($S($D(DUZ)'[0:DUZ,1:0)_U_+SC)
"RTN","SDM0",38,0)
 .I '$O(^SC(+SC,"ST",SDDATE-1)) S (X,Y)=SDDATE Q
"RTN","SDM0",39,0)
 .W $C(7),!?6,"No open slots found in the date range "
"RTN","SDM0",40,0)
 .W $$FMTE^XLFDT(SDDATE)," to ",$$FMTE^XLFDT(SDDMAX),"!",!
"RTN","SDM0",41,0)
 .H 3 S (X,Y)=SDDATE
"RTN","SDM0",42,0)
 .Q
"RTN","SDM0",43,0)
 S (X,Y)=SDAPP K SDXXX G DISP
"RTN","SDM0",44,0)
 ; SD*5.3*622 - display clinic name all the time
"RTN","SDM0",45,0)
D W #!?36,$P(^SC(+SC,0),U,1) S:$O(^SC(+SC,"T",0))>X X=+$O(^(0)) D DOW S I=Y+32,D=Y S SDXF=0 D WM I SDXF D WMH
"RTN","SDM0",46,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,+$E(X,4,5)) ;28
"RTN","SDM0",47,0)
 ;SD*5.3*547 next line don't allow past dates to be added to pattern if prior to date DOW was added
"RTN","SDM0",48,0)
W I '$D(^SC(+SC,"ST",X,1)) S DWFLG=1,POP=0,XDT=X D DOWCHK K DWFLG,XDT G L:POP
"RTN","SDM0",49,0)
 I '$D(^SC(+SC,"ST",X,1)) S Y=D#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDM0",50,0)
 S SDHX=X,SDAV=1 D:X>SM WM I SDXF<2 D WMH
"RTN","SDM0",51,0)
 I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) W !,$E(^SC(+SC,"ST",X,1),1,80) S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDM0",52,0)
 I $Y>18 W ! Q
"RTN","SDM0",53,0)
L K POP
"RTN","SDM0",54,0)
 S X=X+1,D=D+1
"RTN","SDM0",55,0)
 I $D(SDINA),X>SDINA,SDRE>X!('SDRE) D:'SDAV NOAV S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,?8,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE  D DIFF
"RTN","SDM0",56,0)
 G W:X'>X1 S X2=X-X1 D C^%DTC
"RTN","SDM0",57,0)
 I $D(SDINA),X>SDINA,SDRE>X!('SDRE) D:'SDAV NOAV S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,?8,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE
"RTN","SDM0",58,0)
 G X1:D<I W ! D:'SDAV MNTH Q
"RTN","SDM0",59,0)
 ;
"RTN","SDM0",60,0)
NOAV W !,"No availability found between date chosen and inactivate date!" Q
"RTN","SDM0",61,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G W
"RTN","SDM0",62,0)
 ;
"RTN","SDM0",63,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00"
"RTN","SDM0",64,0)
 S SDXF=SDXF+1 I $E(X,6,7)>20 D
"RTN","SDM0",65,0)
 . S SDXD=$O(^SC(+SC,"ST",X-1)) Q:SDXD=""
"RTN","SDM0",66,0)
 . I $E(SDXD,4,5)'=$E(X,4,5) S SDXF=0
"RTN","SDM0",67,0)
 D:SDXF DT
"RTN","SDM0",68,0)
 Q
"RTN","SDM0",69,0)
WMH ;Write month heading lines
"RTN","SDM0",70,0)
 W !!," TIME",?SI+SI-1 F Y=STARTDAY:1:65\(SI+SI)+STARTDAY W $E("|"_$S('Y:0,1:(Y-1#12+1))_"                 ",1,SI+SI)
"RTN","SDM0",71,0)
 W !," DATE",?SI+SI-1,"|" K J F Y=0:1:6 I $D(^SC(+SC,"T"_Y)) S J(Y)=""
"RTN","SDM0",72,0)
 F Y=1:1:65\(SI+SI) W $J("|",SI+SI)
"RTN","SDM0",73,0)
 S SDXF=2
"RTN","SDM0",74,0)
 Q
"RTN","SDM0",75,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDM0",76,0)
 ;
"RTN","SDM0",77,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDM0",78,0)
 ;
"RTN","SDM0",79,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDM0",80,0)
MORDIS I '$D(SDHX) W *7," ??" G ADT^SDM1
"RTN","SDM0",81,0)
 S SDXF=0,X1=SDHX,X2=1 D C^%DTC
"RTN","SDM0",82,0)
MORD2 I $D(SDINA),SDINA'>X,SDRE>X!('SDRE) S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL W *7,!,"Clinic is inactivated as of ",Y S Y=SDHY K SDHY G ADT^SDM1
"RTN","SDM0",83,0)
 G EN
"RTN","SDM0",84,0)
INPAT S SDI=$O(^DGPM("ATID1",DFN,9999999-X)) I SDI>0 D I1
"RTN","SDM0",85,0)
 S:'$D(SDINP) SDINP="" K SDI,SDI1 Q
"RTN","SDM0",86,0)
I1 F SDI1=0:0 S SDI1=$O(^DGPM("ATID1",DFN,SDI,SDI1)) Q:SDI1'>0  I $D(^DGPM(SDI1,0)) S SDX=^(0) I $S($P(SDX,U,17)']"":1,+^DGPM($P(SDX,U,17),0)>X!(+^DGPM($P(SDX,U,17),0)=0):1,1:0) S SDINP="I" Q
"RTN","SDM0",87,0)
 Q
"RTN","SDM0",88,0)
 ;
"RTN","SDM0",89,0)
SUP ;Set up variables for availability search
"RTN","SDM0",90,0)
 S SDNEXT=1,SDCT=1,G1=+SC,SDC(1)=SC,FND=0,SDAV=0 K SDC1
"RTN","SDM0",91,0)
 D SAVE S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","SDM0",92,0)
 Q
"RTN","SDM0",93,0)
 ;
"RTN","SDM0",94,0)
SET S I1="" F I=0:0 S I1=$O(SDZ(I1)) Q:I1']""  S @I1=SDZ(I1)
"RTN","SDM0",95,0)
 K SDZ Q
"RTN","SDM0",96,0)
SAVE K SDZ F I="SDDIF","STR","SC","DFN","SL","SI","HSI","SB" S Z="SDZ("_""""_I_""")" S:$D(@I) @Z=@I
"RTN","SDM0",97,0)
 Q
"RTN","SDM0",98,0)
MNTH W !," *** No availability found for one full calendar month",!,"  Search stopped at " S Y=X D DTS^SDUTL W Y," ***",! Q
"RTN","SDM0",99,0)
DIFF S X1=SDRE,X2=X D ^%DTC S D=D+X,X=SDRE,X1=X\100_28 Q
"RTN","SDM0",100,0)
 ;
"RTN","SDM0",101,0)
SRTY(SDSRTY) ;Prompt for scheduling request type
"RTN","SDM0",102,0)
 ;Input: SDSRTY=variable to return user response (pass by reference)
"RTN","SDM0",103,0)
 ;Output: '1' if successful, '0' otherwise
"RTN","SDM0",104,0)
 ;
"RTN","SDM0",105,0)
 I $G(DFN)<1 S SDSRTY="M" Q 1  ;patient not defined
"RTN","SDM0",106,0)
 I $G(SDMM)=1 S SDSRTY="M" Q 1  ;multiple appointment booking
"RTN","SDM0",107,0)
 N DIR,DTOUT,DUOUT
"RTN","SDM0",108,0)
 S DIR(0)="Y"
"RTN","SDM0",109,0)
 S DIR("A")="IS THIS A 'NEXT AVAILABLE' APPOINTMENT REQUEST"
"RTN","SDM0",110,0)
 S DIR("?")="Answer 'yes' if scheduling to the next available appointment is desired."
"RTN","SDM0",111,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","SDM0",112,0)
 S SDSRTY=Y,SDSRTY(0)=$$TXRT^SDM1A(.SDSRTY) Q 1
"RTN","SDM0",113,0)
 ;
"RTN","SDM0",114,0)
PTFU(DFN,SC)    ;Determine if this is a follow-up (return to clinic within 24 months)
"RTN","SDM0",115,0)
 ;Input: DFN=patient ifn
"RTN","SDM0",116,0)
 ;Input: SC=clinic ifn
"RTN","SDM0",117,0)
 ;Output: '1' if seen within 24 months, '0' otherwise
"RTN","SDM0",118,0)
 ;
"RTN","SDM0",119,0)
 Q:'DFN!'SC 0  ;variable check
"RTN","SDM0",120,0)
 N SDBDT,SDT,SDX,SDY,SDZ,SDCP,SDCP1,SC0,SDENC,SDCT
"RTN","SDM0",121,0)
 ;set up variables
"RTN","SDM0",122,0)
 S SDBDT=(DT-20000)+.24,SDT=DT_.999999,(SDCT,SDY)=0
"RTN","SDM0",123,0)
 S SC0=$G(^SC(+SC,0)),SDX=$$CPAIR^SCRPW71(SC0,.SDCP)  ;get credit pair for this clinic
"RTN","SDM0",124,0)
 ;Iterate through encounters
"RTN","SDM0",125,0)
 W !!,"Calculating follow-up status"
"RTN","SDM0",126,0)
 F  S SDT=$O(^SCE("ADFN",DFN,SDT),-1) Q:SDT<SDBDT!SDY  D
"RTN","SDM0",127,0)
 .S SDENC=0 F  S SDENC=$O(^SCE("ADFN",DFN,SDT,SDENC)) Q:'SDENC!SDY  D
"RTN","SDM0",128,0)
 ..S SDENC0=$G(^SCE(SDENC,0))  ;get encounter node
"RTN","SDM0",129,0)
 ..Q:$P(SDENC0,U,6)  ;parent encounters only
"RTN","SDM0",130,0)
 ..S SDX=$P(SDENC0,U,4) Q:'SDX  ;get clinic
"RTN","SDM0",131,0)
 ..S SC0=$G(^SC(SDX,0))
"RTN","SDM0",132,0)
 ..S SDX=$$CPAIR^SCRPW71(SC0,.SDCP1)  ;get credit pair for encounter
"RTN","SDM0",133,0)
 ..S SDY=SDCP=SDCP1  ;compare credit pairs
"RTN","SDM0",134,0)
 ..S SDCT=SDCT+1 W:SDCT#10=0 "."
"RTN","SDM0",135,0)
 ..Q
"RTN","SDM0",136,0)
 .Q
"RTN","SDM0",137,0)
 Q SDY
"RTN","SDM0",138,0)
 ;
"RTN","SDM0",139,0)
DDATE(SDDATE,SDSRTY,SDMAX) ;Desired date selection
"RTN","SDM0",140,0)
 ;Input: SDDATE=variable to return date selection (pass by reference)
"RTN","SDM0",141,0)
 ;Input: SDSRTY=variable to return request type
"RTN","SDM0",142,0)
 ;Input: SDMAX=variable to return max. days to sched. (pass by ref.)
"RTN","SDM0",143,0)
 ;Output: '1' for success, otherwise '0'
"RTN","SDM0",144,0)
 ;
"RTN","SDM0",145,0)
 Q:SDSRTY 1
"RTN","SDM0",146,0)
 W !!?2,"Select one of the following:",!
"RTN","SDM0",147,0)
 W !?5,"'F'",?20,"for First available following a specified date"
"RTN","SDM0",148,0)
 W !?5,"Date",?20,"(or date computation such as 'T+2M') for a desired date"
"RTN","SDM0",149,0)
 I DFN>0 W !?5,"Date/time",?20,"to schedule a specific appointment - Note: PAST dates",!?20,"must include the Year in the input."  ;added note SD*5.3*547
"RTN","SDM0",150,0)
 W !?5,"'?'",?20,"for detailed help"
"RTN","SDM0",151,0)
DASK N DIR,X,Y,SDX,DTOUT,DUOUT
"RTN","SDM0",152,0)
 ;
"RTN","SDM0",153,0)
 ;BP OIFO/TEH PATCH SD*5.3*384 ; SD*5.3*547 added note to help text
"RTN","SDM0",154,0)
 ;
"RTN","SDM0",155,0)
 S DIR(0)="F^1:30"
"RTN","SDM0",156,0)
 S DIR("A")="ENTER THE DATE DESIRED FOR THIS APPOINTMENT"
"RTN","SDM0",157,0)
 S DIR("?",1)="  Enter the date that is desired for this appointment."
"RTN","SDM0",158,0)
 S DIR("?",2)="  NOTE: PAST dates must include the Year in the input."
"RTN","SDM0",159,0)
 S DIR("?",3)=""
"RTN","SDM0",160,0)
 S DIR("?",4)="  You may enter 'F' to find the first available slot after a specified date."
"RTN","SDM0",161,0)
 S DIR("?",5)="  You will be prompted for begin and end dates for this search."
"RTN","SDM0",162,0)
 S DIR("?",6)=""
"RTN","SDM0",163,0)
 S DIR("?",7)="  A date may be entered to begin the display of clinic availability at the"
"RTN","SDM0",164,0)
 I DFN<1 S DIR("?")="  requested date."
"RTN","SDM0",165,0)
 I DFN>0 D
"RTN","SDM0",166,0)
 .S DIR("?",8)="  requested date."
"RTN","SDM0",167,0)
 .S DIR("?",9)=""
"RTN","SDM0",168,0)
 .S DIR("?",10)="  The entry of a date/time will result in the scheduling of an appointment at"
"RTN","SDM0",169,0)
 .S DIR("?")="  that time, if possible."
"RTN","SDM0",170,0)
 .Q
"RTN","SDM0",171,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT) 0
"RTN","SDM0",172,0)
 I Y=" " S SDX=$G(^DISV(DUZ_U_+SC)) I SDX?7N S (X,Y)=SDX
"RTN","SDM0",173,0)
 I $L(Y)=1,"fF"[Y D  Q 1
"RTN","SDM0",174,0)
 .W "    First available"
"RTN","SDM0",175,0)
 .S (SDDATE,SDSRTY)=$TR(Y,"f","F")
"RTN","SDM0",176,0)
 .Q
"RTN","SDM0",177,0)
 N %DT,SDX,SDI,POP
"RTN","SDM0",178,0)
 S SDX="N^n^NOW^now^Now" F SDI=1:1:5 S:X=$P(SDX,U,SDI) X="T"
"RTN","SDM0",179,0)
 S %DT="EFT" D ^%DT
"RTN","SDM0",180,0)
 G:Y<1 DASK S SDDATE=Y
"RTN","SDM0",181,0)
 I DFN<1 S SDDATE=SDDATE\1
"RTN","SDM0",182,0)
 ;SD*5.3*621 - check if desired date if prior to DOB and if clinic schedule is available.
"RTN","SDM0",183,0)
 I DFN>0 S POP=0 D DDCHK I POP G DASK
"RTN","SDM0",184,0)
 I DFN>0,Y'<DT,(Y\1)>SDMAX D  G DASK
"RTN","SDM0",185,0)
 .W !,$C(7)
"RTN","SDM0",186,0)
 .W "Scheduling cannot be more than ",SDMAX(1)," days in the future"
"RTN","SDM0",187,0)
 .Q
"RTN","SDM0",188,0)
 Q 1
"RTN","SDM0",189,0)
 ;
"RTN","SDM0",190,0)
DDCHK ;SD*5.3*621 - check if desired date if prior to DOB and if clinic schedule is available.
"RTN","SDM0",191,0)
 N X
"RTN","SDM0",192,0)
 S X=SDDATE D AVCHK^SDM1 I POP Q
"RTN","SDM0",193,0)
 D AVCHK1^SDM1
"RTN","SDM0",194,0)
 Q
"RTN","SDM0",195,0)
 ;
"RTN","SDM0",196,0)
DOWCHK ;SD*5.3*547 check if date is prior to date DOW was added to pattern
"RTN","SDM0",197,0)
 S (DY,DYW)="" S:'$D(DWFLG) DWFLG=0
"RTN","SDM0",198,0)
 I '$D(^SC(+SC,"ST",$P(XDT,"."),1)) D  Q:DWFLG  I POP D DWWRT Q
"RTN","SDM0",199,0)
 .S DY=$$DOW^XLFDT($P(XDT,"."))
"RTN","SDM0",200,0)
 .S DYW=$E(DY,1,2),DYW=$TR(DYW,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SDM0",201,0)
 .S PCDT=$P(XDT,"."),CT=0,POP=1
"RTN","SDM0",202,0)
 .F  S PCDT=$O(^SC(+SC,"ST",PCDT),-1) Q:'PCDT!('POP)!(CT>30)  D
"RTN","SDM0",203,0)
 ..S CT=CT+1
"RTN","SDM0",204,0)
 ..Q:'$D(^SC(+SC,"ST",PCDT,0))
"RTN","SDM0",205,0)
 ..Q:'$D(^SC(+SC,"ST",PCDT,1))
"RTN","SDM0",206,0)
 ..Q:$E($G(^SC(+SC,"ST",PCDT,1)),1,2)'=DYW
"RTN","SDM0",207,0)
 ..I $E($G(^SC(+SC,"ST",PCDT,1)),1,2)=DYW S POP=0 Q
"RTN","SDM0",208,0)
 .Q
"RTN","SDM0",209,0)
 K PCDT,CT,DY,DYW
"RTN","SDM0",210,0)
 Q
"RTN","SDM0",211,0)
 ;
"RTN","SDM0",212,0)
DWWRT ;added SD*5.3*547
"RTN","SDM0",213,0)
 S DY=$TR(DY,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SDM0",214,0)
 W *7,!!,"That date is prior to the date ",DY," was added to the"
"RTN","SDM0",215,0)
 W !,"availability pattern for this clinic.",!!
"RTN","SDM0",216,0)
 K DY,DYW,PCDT,CT
"RTN","SDM0",217,0)
 Q
"RTN","SDM0",218,0)
 ;
"RTN","SDM0",219,0)
1 S SDNEXT="",SDCT=0 G RD^SDMULT
"RTN","SDM0",220,0)
DT1 S FND=0,%DT(0)=-SDMAX,%DT="AEF",%DT("A")="  START SEARCH FOR NEXT AVAILABLE FROM WHAT DATE: " D ^%DT K %DT G:"^"[X 1:$S('$D(SDNEXT):1,'SDNEXT:1,1:0),END^SDMULT0 G:Y<0 DT S (SDDATE,SDSTRTDT)=+Y
"RTN","SDM0",221,0)
LIM W !,"  ENTER LATEST DATE TO CHECK FOR 1ST AVAILABLE SLOT: " S Y=SDMAX D DT^DIQ R "// ",X:DTIME G:X["^"!'($T) END^SDMULT0 I X']"" G OVR^SDMULT0
"RTN","SDM0",222,0)
 I X?.E1"?" W !,"  The latest date for future bookings for ",$P(SDC(1),"^",2)," is: " S Y=SDMAX D DTS^SDUTL W Y,!,"  If you enter a date here, it must be less than this date to further limit the",!,"  search" G LIM
"RTN","SDM0",223,0)
 S %DT="EF",%DT(0)=-SDMAX D ^%DT K %DT G:Y<0!(Y<SDSTRTDT) LIM S:Y>0 (SDDMAX,SDMAX)=+Y
"RTN","SDM0",224,0)
 G OVR^SDMULT0
"RTN","SDM1A")
0^281^B78000980^B59582269
"RTN","SDM1A",1,0)
SDM1A ;SF/GFT,ALB/TMP - MAKE APPOINTMENT ;8/18/05 12:57pm;6/22/09 6:16pm
"RTN","SDM1A",2,0)
 ;;5.3;Scheduling;**26,94,155,206,168,223,241,263,327,478,446,544,621,622**;Aug 13, 1993;Build 30
"RTN","SDM1A",3,0)
OK I $D(SDMLT) D ^SDM4 Q:X="^"!(SDMADE=2)
"RTN","SDM1A",4,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S,^DPT(DFN,"S",SD,0)=SC,^SC(SC,"S",SD,0)=SD S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDM1A",5,0)
S1 L +^SC(SC,"S",SD,1):$G(DILOCKTM,5) W:'$T "Another user is editing this record.  Trying again.",! G:'$T S1 F SDY=1:1 I '$D(^SC(SC,"S",SD,1,SDY)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(SDY,0)=DFN_U_(+SL)_"^^^^"_$G(DUZ)_U_DT L -^SC(SC,"S",SD,1) Q
"RTN","SDM1A",6,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,"OB")
"RTN","SDM1A",7,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",8,0)
 S SDINP=$$INP^SDAM2(DFN,SD)
"RTN","SDM1A",9,0)
 ;-- added sub-category
"RTN","SDM1A",10,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:"")
"RTN","SDM1A",11,0)
 S ^DPT(DFN,"S",SD,0)=SC_"^"_$$STATUS(SC,SDINP,SD)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_U_$G(SD17)_"^"_$G(DUZ)_U_DT_"^^^^^"_$G(SDXSCAT)_U_$P($G(SDSRTY),U,2)_U_$$NAVA^SDMANA(SC,SD,$P($G(SDSRTY),U,2)) ;544 added DUZ
"RTN","SDM1A",12,0)
 S ^DPT(DFN,"S",SD,1)=$G(SDDATE)_U_$G(SDSRFU)
"RTN","SDM1A",13,0)
 I $D(SDMULT) S SDCLNCND=^SC(SC,0),STPCOD=$P(SDCLNCND,U,7),TMPYCLNC=SC_U_$P(SDCLNCND,U) D A^SDCNSLT ;SD/478 MULTI CLINIC OPTION SELECTED
"RTN","SDM1A",14,0)
 ;xref DATE APPT. MADE field
"RTN","SDM1A",15,0)
 D
"RTN","SDM1A",16,0)
 .N DIV,DA,DIK
"RTN","SDM1A",17,0)
 .S DA=SD,DA(1)=DFN,DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDM1A",18,0)
 .Q
"RTN","SDM1A",19,0)
 K:$D(^DPT(DFN,"S",SD,"R")) ^("R") K:$D(^DPT("ASDCN",SC,SD,DFN)) ^(DFN)
"RTN","SDM1A",20,0)
 S SDRT="A",SDTTM=SD,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDM1A",21,0)
 W !,"   ",+SL,"-MINUTE APPOINTMENT MADE" K SDINP
"RTN","SDM1A",22,0)
 ;confirm request type & follow-up indicator
"RTN","SDM1A",23,0)
 I $D(SDSRTY(0)) D CONF(.SDSRTY,.SDSRFU,DFN,SD,SC) W !
"RTN","SDM1A",24,0)
 I $P(SD,".")'>DT,$D(^DPT(DFN,.321)) D EN1^SDM3
"RTN","SDM1A",25,0)
 ;Wait List SD*5.3*263
"RTN","SDM1A",26,0)
 ;I '$D(SDWLLIST) D ^SDWLR ;replaced with sd/372, see below
"RTN","SDM1A",27,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDM1A",28,0)
 ;get appointment
"RTN","SDM1A",29,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDM1A",30,0)
 D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDM1A",31,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDM1A",32,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDM1A",33,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDM1A",34,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDM1A",35,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDM1A",36,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDM1A",37,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDM1A",38,0)
 ..F  N SDR D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDM1A",39,0)
 ;CREATE 120 FLAG IF APPLICABLE; appt created 
"RTN","SDM1A",40,0)
FLG N SDST S SDST=$G(^TMP($J,"APPT",1)) I +SDST>0 D
"RTN","SDM1A",41,0)
 .Q  ; sd/446
"RTN","SDM1A",42,0)
 .N SDT,SDDES,SDPAR,SDDES1,SDT1 S SDPAR=0 S SDT=+SDST,SDDES=$P(SDST,U,17) I SDDES="" S SDDES=DT ; today's date if no desired date
"RTN","SDM1A",43,0)
 .S X=SDT D H^%DTC S SDT1=%H
"RTN","SDM1A",44,0)
 .S X=SDDES D H^%DTC S SDDES1=%H
"RTN","SDM1A",45,0)
 .I SDT1-SDDES1>120 N SD120,SD120A S SD120=1,SD120A=1  D
"RTN","SDM1A",46,0)
 ..; CREATE ewl eN SDPR S SDPR=$S(SDDES=DT:"A",1:"F") entry with 120 flag
"RTN","SDM1A",47,0)
 ..N SDPR S SDPR=$S(SDDES=DT:"A",1:"F") ;10
"RTN","SDM1A",48,0)
 ..N SDWLIN S SDWLIN=+$P(SDST,U,15) ;2
"RTN","SDM1A",49,0)
 ..N SDWLSCPR S SDWLSCPR=0 I +$P(SDST,U,10)=11 S SDWLSCPR=1 ;15
"RTN","SDM1A",50,0)
 ..N SC,SDWLSCL S SC=+$P(SDST,U,2) D
"RTN","SDM1A",51,0)
 ...I $D(^SDWL(409.32,"B",SC)) S SDWLSCL=$O(^SDWL(409.32,"B",SC,"")) Q  ;8
"RTN","SDM1A",52,0)
 ...;create 409.32 entry
"RTN","SDM1A",53,0)
 ...N DA,DIC S DIC(0)="LX",X=SC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDM1A",54,0)
 ...S SDWLSCL=DA
"RTN","SDM1A",55,0)
 ...S DIE="^SDWL(409.32,"
"RTN","SDM1A",56,0)
 ...S DR=".02////^S X=SDWLIN" D ^DIE
"RTN","SDM1A",57,0)
 ...S DR="1////^S X=DT"
"RTN","SDM1A",58,0)
 ...S DR=DR_";2////^S X=DUZ"
"RTN","SDM1A",59,0)
 ...D ^DIE S SDPAR=1
"RTN","SDM1A",60,0)
 ..N DA S DIC(0)="LX",(X,SDWLDFN)=+$P(SDST,U,4),X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDM1A",61,0)
 ..F  L +^SDWL(409.3,DA):$G(DILOCKTM,5) Q:$T  D
"RTN","SDM1A",62,0)
 ...I '$T W !,"Unable to acquire a lock on the Wait List file" Q
"RTN","SDM1A",63,0)
 ..; Update EWL variables.
"RTN","SDM1A",64,0)
 ..S SDWLDA=DA D EN^SDWLE11 ; get enrollee both SDWLDA and SDWLDFN have to be
"RTN","SDM1A",65,0)
 ..N SDWLCM S SDWLCM=" > 120 days; appt created"
"RTN","SDM1A",66,0)
 ..N SDWLSCPG S SDWLSCPG=$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":$P(^(.3),U,2),1:"")
"RTN","SDM1A",67,0)
 ..S DR="1////^S X=DT"
"RTN","SDM1A",68,0)
 ..S DR=DR_";2////^S X=SDWLIN"
"RTN","SDM1A",69,0)
 ..S DR=DR_";4////^S X=4"
"RTN","SDM1A",70,0)
 ..S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDM1A",71,0)
 ..S DR=DR_";9////^S X=DUZ"
"RTN","SDM1A",72,0)
 ..S DR=DR_";10////^S X=SDPR"
"RTN","SDM1A",73,0)
 ..S DR=DR_";11////^S X=2" ; by patient for this entry to avoid asking for provider
"RTN","SDM1A",74,0)
 ..S DR=DR_";14////^S X=SDWLSCPG"
"RTN","SDM1A",75,0)
 ..S DR=DR_";15////^S X=SDWLSCPR"
"RTN","SDM1A",76,0)
 ..S DR=DR_";22////^S X=SDDES"
"RTN","SDM1A",77,0)
 ..S DR=DR_";23////^S X=""O"""
"RTN","SDM1A",78,0)
 ..S DR=DR_";25////^S X=SDWLCM"
"RTN","SDM1A",79,0)
 ..S DR=DR_";36////^S X=SD120"
"RTN","SDM1A",80,0)
 ..S DR=DR_";39////^S X=SD120A"
"RTN","SDM1A",81,0)
 ..S DIE="^SDWL(409.3,"
"RTN","SDM1A",82,0)
 ..D ^DIE
"RTN","SDM1A",83,0)
 ..L -^SDWL(409.3,DA)
"RTN","SDM1A",84,0)
 ..D MESS^SDWL120(SDWLDFN,SC,SDT,SDPAR)
"RTN","SDM1A",85,0)
 ;continue appointment entry process
"RTN","SDM1A",86,0)
ORD S %=2 W !,"WANT PATIENT NOTIFIED OF LAB,X-RAY, OR EKG STOPS" D YN^DICN I '% W !,"  Enter YES to notify patient on appt. letter of LAB, X-RAY, or EKG stops" G ORD
"RTN","SDM1A",87,0)
 I '(%-1) D ORDY^SDM3
"RTN","SDM1A",88,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDM1A",89,0)
 S TMPD=D I $L(D)>150 D MSG^SDMM G OTHER ;SD/478
"RTN","SDM1A",90,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDM1A",91,0)
 I $L($G(^SC(SC,"S",SD,1,SDY,0)))+$L(D)+$L(DT)+$S($D(DUZ):$L(DUZ),1:0)>250 D MSG^SDMM G OTHER  ; sd/446
"RTN","SDM1A",92,0)
 ;S $P(^(0),"^",4)=D,$P(^(0),U,6,7)=$S($D(DUZ):DUZ,1:"")_U_DT ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,0)
"RTN","SDM1A",93,0)
 S $P(^(0),"^",4)=D ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,0) 544 moved DUZ&DT to tag S1.  
"RTN","SDM1A",94,0)
 D:$D(TMP) LINK^SDCNSLT(SC,SDY,SD,CNSLTLNK) ;SD/478
"RTN","SDM1A",95,0)
 D:$D(TMP) EDITCS^SDCNSLT(SD,TMPD,TMPYCLNC,CNSLTLNK) ;SD/478
"RTN","SDM1A",96,0)
 K TMP  ;SD/478
"RTN","SDM1A",97,0)
XR I $S('$D(^SC(SC,"RAD")):1,^("RAD")="Y":0,^("RAD")=1:0,1:1) S %=2 W !,"WANT PREVIOUS X-RAY RESULTS SENT TO CLINIC" D YN^DICN G:'% HXR I '(%-1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",98,0)
SDMM S SDEMP=0 I COLLAT=7 S:SDEC'=SDCOL SDEMP=SDCOL G OV
"RTN","SDM1A",99,0)
 D ELIG^VADPT I $O(VAEL(1,0))>0 D ELIG^SDM4:"369"[SDAPTYP S SDEMP=$S(SDDECOD:SDDECOD,1:SDEMP)
"RTN","SDM1A",100,0)
OV Q:$D(SDZM)  K SDQ1,SDEC,SDCOL I +SDEMP S $P(^SC(SC,"S",SD,1,SDY,0),"^",10)=+SDEMP
"RTN","SDM1A",101,0)
 S SDMADE=1 D EVT
"RTN","SDM1A",102,0)
LET ; SD*5.3*622 - help user print the PRE-APPT letter for a patient
"RTN","SDM1A",103,0)
 ; check for a PRE-APPT letter defined and if none, don't issue a device prompt
"RTN","SDM1A",104,0)
 N SDFN ; new SDFN to see the patient prompt next time
"RTN","SDM1A",105,0)
 S %=2 W !!,"WANT TO PRINT THE PRE-APPOINTMENT LETTER" D YN^DICN I %=0 W !,"RESPOND YES (Y) OR NO (N)" G:'% LET
"RTN","SDM1A",106,0)
 I (%=2)!(%=-1) Q
"RTN","SDM1A",107,0)
 I $P($G(^SC(SC,"LTR")),U,2)="" D  Q
"RTN","SDM1A",108,0)
 . W $C(7),!!,"PATIENT "_$P(^DPT(DFN,0),U,1)," ",$P(^(0),U,9)," HAS FUTURE APPTS., but"
"RTN","SDM1A",109,0)
 . W !,$P(^SC(SC,0),U,1)_" is not assigned a PRE-APPOINTMENT LETTER",!
"RTN","SDM1A",110,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","SDM1A",111,0)
 ;
"RTN","SDM1A",112,0)
 ; pre-define letter type (P), the division, date for appt, etc.
"RTN","SDM1A",113,0)
 S (SDBD,SDED)=SDTTM,L0="P",SD9=0,VAUTNALL=1,VAUTNI=2,S1="P",SDLT=1,SDV1=1,SDFORM=""
"RTN","SDM1A",114,0)
 S L2=$S(L0="P":"^SDL1",1:"^SDL1"),J=SDBD
"RTN","SDM1A",115,0)
 S (A,SDFN,S)=DFN,L="^SDL1",SDCL=+$P(^SC(SC,0),U,1),SDC=SC,SDX=SDTTM
"RTN","SDM1A",116,0)
 S SDLET=$P(^SC(SC,"LTR"),U,2) ; letter IEN
"RTN","SDM1A",117,0)
 S SDLET1=SDLET
"RTN","SDM1A",118,0)
 I SDY["DPT(" S SDAMTYP="P",SDFN=+SDY
"RTN","SDM1A",119,0)
 I SDY["SC(" S SDAMTYP="C",SDCLN=+SDY
"RTN","SDM1A",120,0)
 ; prepare to queue the letter if the user so desires
"RTN","SDM1A",121,0)
 N %ZIS,POP,ZTDESC,ZTRTN,ZTSAVE
"RTN","SDM1A",122,0)
 S %ZIS("B")="",POP=0,%ZIS="MQ" D ^%ZIS Q:POP
"RTN","SDM1A",123,0)
 I $D(IO("Q")) S ZTRTN="QUE^SDM1A",ZTDESC="PRINT PRE-APPT LETTER",ZTSAVE("*")="" D ^%ZTLOAD,HOME^%ZIS K IO("Q") Q
"RTN","SDM1A",124,0)
 D QUE ; print right away without getting into the queue
"RTN","SDM1A",125,0)
 D HOME^%ZIS
"RTN","SDM1A",126,0)
 Q
"RTN","SDM1A",127,0)
 ;
"RTN","SDM1A",128,0)
QUE ; execute whether by queue or immediate print request
"RTN","SDM1A",129,0)
 U IO
"RTN","SDM1A",130,0)
 D PRT^SDLT,WRAPP^SDLT
"RTN","SDM1A",131,0)
 ; if there are x-ray, lab, or ekg appts, print them too
"RTN","SDM1A",132,0)
 S SDATA=$G(^DPT(DFN,"S",SDX,0))
"RTN","SDM1A",133,0)
 I $D(SDATA) F B=3,4,5 D
"RTN","SDM1A",134,0)
 . S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG")
"RTN","SDM1A",135,0)
 . S SDX=$P($G(SDATA),U,B)
"RTN","SDM1A",136,0)
 . S SC=SDCL Q:$G(SDX)=""  D FORM^SDLT
"RTN","SDM1A",137,0)
 ;
"RTN","SDM1A",138,0)
 D REST^SDLT
"RTN","SDM1A",139,0)
 D ^%ZISC
"RTN","SDM1A",140,0)
 Q  ; SD*5.3*622 - end of changes
"RTN","SDM1A",141,0)
 ;
"RTN","SDM1A",142,0)
HXR W !,"  Enter YES to have previous XRAY results sent to the clinic" G XR
"RTN","SDM1A",143,0)
 Q
"RTN","SDM1A",144,0)
CS S SDCS=+$P(^SC(+SC,0),"^",7) I $S('$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE STOP CODE!!!",!!
"RTN","SDM1A",145,0)
 S SDCS=+$P(^SC(+SC,0),"^",18) I $S('SDCS:0,'$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE CREDIT STOP CODE!!!",!!
"RTN","SDM1A",146,0)
 K SDCS Q
"RTN","SDM1A",147,0)
STATUS(SDCL,SDINP,SDT) ; -- determine status for NEW appts
"RTN","SDM1A",148,0)
 Q $S(SDINP]"":SDINP,$$CHK(.SDCL,.SDT):"NT",1:"")
"RTN","SDM1A",149,0)
CHK(SDCL,SDT) ; -- should appt be NT'ed
"RTN","SDM1A",150,0)
 ; -- non-count clinic check := don't NT appt
"RTN","SDM1A",151,0)
 ; -- appt update executed   := need to NT appt
"RTN","SDM1A",152,0)
 ; -- otherwise              := don't NT appt
"RTN","SDM1A",153,0)
 Q $S($P($G(^SC(SDCL,0)),U,17)="Y":0,$D(^SDD(409.65,"AUPD",$P(SDT,"."))):1,1:0)
"RTN","SDM1A",154,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM1A",155,0)
 D MAKE^SDAMEVT(DFN,SD,SC,SDY,0)
"RTN","SDM1A",156,0)
 Q
"RTN","SDM1A",157,0)
REQ(SDT) ; -- which is required check in(CI) or out(CO)
"RTN","SDM1A",158,0)
 Q $S($$REQDT()>SDT:"CI",1:"CO")
"RTN","SDM1A",159,0)
REQDT() ; -- co required date
"RTN","SDM1A",160,0)
 Q $S($P(^DG(43,1,"SCLR"),U,23):$P(^("SCLR"),U,23),1:2931001)
"RTN","SDM1A",161,0)
COCMP(DFN,SDT) ; -- date CO completed
"RTN","SDM1A",162,0)
 Q $P($G(^SCE(+$P($G(^DPT(DFN,"S",SDT,0)),U,20),0)),U,7)
"RTN","SDM1A",163,0)
CI(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",164,0)
 N C
"RTN","SDM1A",165,0)
 I '$$CHK(.SDCL,.SDT) G CIQ
"RTN","SDM1A",166,0)
 I $$REQ(SDT)'="CI" G CIQ
"RTN","SDM1A",167,0)
 I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",168,0)
 I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'$P(C,U,3) S $P(^(0),U,2)="NT"
"RTN","SDM1A",169,0)
CIQ Q
"RTN","SDM1A",170,0)
CO(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",171,0)
 N DFN,C
"RTN","SDM1A",172,0)
 I '$$CHK(.SDCL,.SDT) G COQ
"RTN","SDM1A",173,0)
 I $$REQ(.SDT)'="CO" D  G COQ
"RTN","SDM1A",174,0)
 .I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",175,0)
 .I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'C S $P(^(0),U,2)="NT"
"RTN","SDM1A",176,0)
 S DFN=+^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",177,0)
 D UPD(.DFN,.SDT,$$COCMP(.DFN,.SDT),$S(SDACT="SET":X,1:""))
"RTN","SDM1A",178,0)
COQ Q
"RTN","SDM1A",179,0)
UPD(DFN,SDT,SDCOCMP,SDCODT) ; -- update status
"RTN","SDM1A",180,0)
 N Y
"RTN","SDM1A",181,0)
 I $D(^DPT(DFN,"S",SDT,0)) S Y=$P(^(0),U,2) D
"RTN","SDM1A",182,0)
 .I 'SDCOCMP!('SDCODT) S:Y="" $P(^DPT(DFN,"S",SDT,0),U,2)="NT" Q
"RTN","SDM1A",183,0)
 .S:Y="NT" $P(^DPT(DFN,"S",SDT,0),U,2)=""
"RTN","SDM1A",184,0)
 Q
"RTN","SDM1A",185,0)
OE(SDOE,SDACT) ; -- called by x-ref on co completed field(#.07) in ^SCE
"RTN","SDM1A",186,0)
 N Y S Y=^SCE(SDOE,0)
"RTN","SDM1A",187,0)
 I $P(Y,U,8)'=1 G OEQ
"RTN","SDM1A",188,0)
 I $$REQ(+Y)'="CO" G OEQ
"RTN","SDM1A",189,0)
 I '$$CANT(+$P(Y,U,2),+Y,SDOE),'$$CHK(+$P(Y,U,4),+Y) G OEQ
"RTN","SDM1A",190,0)
 D UPD(+$P(Y,U,2),+Y,$S(SDACT="SET":X,1:""),$P($G(^SC(+$P(Y,U,4),"S",+Y,1,+$P(Y,U,9),"C")),U,3))
"RTN","SDM1A",191,0)
OEQ Q
"RTN","SDM1A",192,0)
CONF(SDSRTY,SDSRFU,DFN,SDT,SC) ;Confirm scheduling request type
"RTN","SDM1A",193,0)
 ;Input: SDSRTY=request type
"RTN","SDM1A",194,0)
 ;Input: SDSRFU=follow-up indicator
"RTN","SDM1A",195,0)
 ;Input: DFN=patient ien
"RTN","SDM1A",196,0)
 ;Input: SDT=appointment date/time
"RTN","SDM1A",197,0)
 ;Input: SC=clinic ifn
"RTN","SDM1A",198,0)
 N DIR,DIE,DA,DR,SDX,SDY,X,Y
"RTN","SDM1A",199,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM1A",200,0)
 S DIR("A")="THIS APPOINTMENT IS MARKED AS '"_SDSRTY(0)_"', IS THIS CORRECT"
"RTN","SDM1A",201,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",202,0)
 I 'Y S SDX='SDSRTY,SDX(0)=$$TXRT(.SDX) W !!,"THIS APPOINTMENT HAS NOW BEEN MARKED AS '"_$S('SDSRTY:"",1:"NOT ")_"NEXT AVAILABLE'."
"RTN","SDM1A",203,0)
 ;S DIR("A")="THIS APPOINTMENT IS DEFINED AS '"_$S(SDSRFU:"FOLLOW-UP",1:"OTHER THAN FOLLOW-UP")_"', OK"
"RTN","SDM1A",204,0)
 ;W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",205,0)
 ;I 'Y S SDY='SDSRFU W "  (changed)"
"RTN","SDM1A",206,0)
 Q:'$D(SDX)  S DR=""
"RTN","SDM1A",207,0)
 I $D(SDX) S DR="25///^S X=$P(SDX,U,2);26///^S X=$$NAVA^SDMANA(SC,SDT,$P(SDX,U,2))"
"RTN","SDM1A",208,0)
 ;I $D(SDY) S:$L(DR) DR=DR_";" S DR=DR_"26///^S X=SDY"
"RTN","SDM1A",209,0)
 S DA=SDT,DA(1)=DFN
"RTN","SDM1A",210,0)
 S DIE="^DPT(DA(1),""S""," D ^DIE
"RTN","SDM1A",211,0)
 Q
"RTN","SDM1A",212,0)
TXRT(SDSRTY)    ;Transform request type
"RTN","SDM1A",213,0)
 ;Input: SDSRTY=variable to return request type (pass by reference)
"RTN","SDM1A",214,0)
 ;Output: external text for SDSRTY(0)
"RTN","SDM1A",215,0)
 I SDSRTY S SDSRTY=SDSRTY_U_"N" Q "NEXT AVAILABLE"
"RTN","SDM1A",216,0)
 S SDSRTY=SDSRTY_U_"O" Q "NOT NEXT AVAILABLE"
"RTN","SDM1A",217,0)
CANT(DFN,SDT,SDOE) ;Determine if clinic appt. has been marked "NT"
"RTN","SDM1A",218,0)
 ;Output: '1' if appt. points to encounter and is marked "NT", otherwise '0'
"RTN","SDM1A",219,0)
 N SDAPP S SDAPP=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDM1A",220,0)
 Q:$P(SDAPP,U,20)'=SDOE 0
"RTN","SDM1A",221,0)
 Q $P(SDAPP,U,2)="NT"
"RTN","SDM1A",222,0)
 ; -- Variable doc for above tags
"RTN","SDM1A",223,0)
 ;     SDCL := file 44 ien
"RTN","SDM1A",224,0)
 ;      SDT := appt date/time
"RTN","SDM1A",225,0)
 ;      DFN := file 2 ien
"RTN","SDM1A",226,0)
 ;     SDDA := ^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",227,0)
 ;    SDACT := current x-ref action 'set' or 'kill' 
"RTN","SDM1A",228,0)
 ;  SDCOCMP := check out completed date
"RTN","SDM1A",229,0)
 ;   SDCODT := check out date/time
"RTN","SDM1A",230,0)
 ;     SDOE := Outpatient Encounter ien
"RTN","SDM1A",231,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM1A",232,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDMM1")
0^282^B15878644^B15400257
"RTN","SDMM1",1,0)
SDMM1 ;ALB/GRR - MULTIPLE BOOKINGS ; 2/7/05 8:16am
"RTN","SDMM1",2,0)
 ;;5.3;Scheduling;**28,206,168,327,622**;Aug 13, 1993;Build 30
"RTN","SDMM1",3,0)
MAKE S (SDX3,X,SD)=Y,SM=0 D DOW^SDM0 I $D(^DPT(DFN,"S",X)) S I=^(X,0) I $P(I,"^",2)'["C" W !,"PATIENT ALREADY HAS APPOINTMENT ON ",$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(X,4,5))," ",$E(X,6,7)," AT THAT TIME" Q
"RTN","SDMM1",4,0)
 S SDX7=X D SDFT^SDMM S X=SDX7 I $P(SDX3,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 Q
"RTN","SDMM1",5,0)
S S SDNOT=0 I '$D(^SC(SC,"ST",$P(X,"."),1)) S SS=$O(^SC(+SC,"T"_Y,X)) G X:'SS,X:^(SS,1)="" S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDMM1",6,0)
SC S POP=0,SD=X D SC^SDM1 I SDLOCK W ! D DT W " HAS BEEN LOCKED BY ANOTHER USER - APPT NOT BOOKED" L  Q
"RTN","SDMM1",7,0)
 G X:POP,OK:SM#9=0 S SDY=Y,Y=X
"RTN","SDMM1",8,0)
 ;
"RTN","SDMM1",9,0)
 D OB I SDNOT=0 Q  ; check overbook/keys...quit if not ok
"RTN","SDMM1",10,0)
 S SM=9 G SC
"RTN","SDMM1",11,0)
 ;
"RTN","SDMM1",12,0)
OK S ^SC(SC,"ST",$P(X,"."),1)=S,^SC(SC,"S",X,0)=X S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDMM1",13,0)
S1 L ^SC(SC,"S",X,1):5 G:'$T S1 F Y=1:1 I '$D(^SC(SC,"S",X,1,Y)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(Y,0)=DFN_U_(+SL)_U_U_D_U_U_$S($D(DUZ):DUZ,1:"")_U_DT_U_U_U_$S(+SDEMP:+SDEMP,1:"") S SDY=Y L  Q
"RTN","SDMM1",14,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,"OB")
"RTN","SDMM1",15,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,X,DFN)=""
"RTN","SDMM1",16,0)
 S SDINP=$$INP^SDAM2(DFN,X)
"RTN","SDMM1",17,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:""),^DPT(DFN,"S",X,0)=SC_"^"_$$STATUS^SDM1A(SC,SDINP,X)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_"^^^"_DT_"^^^^^^M^0",SDMADE=1
"RTN","SDMM1",18,0)
 ; SD*5.3*622 - set desired date for appointment
"RTN","SDMM1",19,0)
 I SDZ>1 S ^DPT(DFN,"S",SD,1)=$P($G(SD),".",1)
"RTN","SDMM1",20,0)
 E  S ^DPT(DFN,"S",SD,1)=SDDATE
"RTN","SDMM1",21,0)
 D XRDT(DFN,X)  ;xref DATE APPT. MADE field
"RTN","SDMM1",22,0)
 K:$D(^DPT("ASDCN",SC,X,DFN)) ^(DFN) K:$D(^DPT(DFN,"S",X,"R")) ^("R")
"RTN","SDMM1",23,0)
 S SDRT="A",SDTTM=X,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDMM1",24,0)
 L  W !,"APPOINTMENT MADE ON " S Y=X D DT^DIQ
"RTN","SDMM1",25,0)
 ;check for open EWL entries and create TMP($J,"APPT";SD/327
"RTN","SDMM1",26,0)
 N SDEV,SD D EN^SDWLEVAL(DFN,.SDEV) S SD=X I SDEV D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDMM1",27,0)
 D EVT
"RTN","SDMM1",28,0)
 Q
"RTN","SDMM1",29,0)
 ;
"RTN","SDMM1",30,0)
XRDT(DFN,X) ;cross reference DATE APPT. MADE field
"RTN","SDMM1",31,0)
 ;Input: DFN=patient ifn
"RTN","SDMM1",32,0)
 ;Input: X=appointment date
"RTN","SDMM1",33,0)
 N DIK,DA,DIV S DA=X,DA(1)=DFN
"RTN","SDMM1",34,0)
 S DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDMM1",35,0)
 Q
"RTN","SDMM1",36,0)
 ;
"RTN","SDMM1",37,0)
NOOB S SDMES="NO OPEN SLOTS ON "
"RTN","SDMM1",38,0)
WRTER W !,SDMES D DT W:SDNOT " AT THAT TIME" S SDNOT=0 Q
"RTN","SDMM1",39,0)
DT W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(X,4,5))," ",$E(X,6,7) Q
"RTN","SDMM1",40,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMM1",41,0)
 ;
"RTN","SDMM1",42,0)
X L  I SDZ=1 W !,*7,"CLINIC DOES NOT MEET THEN!!" S SDERRFT=1 Q
"RTN","SDMM1",43,0)
 S SDMES="CLINIC DOES NOT MEET ON " G WRTER
"RTN","SDMM1",44,0)
 ;
"RTN","SDMM1",45,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDMM1",46,0)
 N D,SI,SC,SL,COLLAT D MAKE^SDAMEVT(DFN,SDTTM,SDSC,SDPL,0)
"RTN","SDMM1",47,0)
 Q
"RTN","SDMM1",48,0)
 ;
"RTN","SDMM1",49,0)
OB ; check for overbook keys
"RTN","SDMM1",50,0)
 N %,D,I,S,ST
"RTN","SDMM1",51,0)
 S SDNOT=1
"RTN","SDMM1",52,0)
 I '$D(^XUSEC("SDOB",DUZ)),'$D(^XUSEC("SDMOB",DUZ)) D NOOB G OBQ ; user has neither key
"RTN","SDMM1",53,0)
 S I=$P(SD,".",1),(S,ST)=$P(SL,U,7) ; counter of OBs for day = ST
"RTN","SDMM1",54,0)
 I ST F D=I-.01:0 S D=$O(^SC(SC,"S",D)) Q:$P(D,".",1)-I  F %=0:0 S %=$O(^SC(SC,"S",D,1,%)) Q:'%  I $P(^(%,0),"^",9)'["C",$D(^("OB")) S ST=ST-1
"RTN","SDMM1",55,0)
 I ST<1 D  G OBQ
"RTN","SDMM1",56,0)
 . I '$D(^XUSEC("SDMOB",DUZ)) W !,*7,"ONLY "_S_" OVERBOOK"_$E("S",S>1)_" ALLOWED PER DAY!!" D NOOB Q
"RTN","SDMM1",57,0)
 . S MXOK=$$DIR("WILL EXCEED MAXIMUM ALLOWABLE OVERBOOKS FOR "_$$FMTE^XLFDT(Y)_", OK","YES")
"RTN","SDMM1",58,0)
 . I 'MXOK S SM=9,SDNOT=0 Q
"RTN","SDMM1",59,0)
 . I MXOK S S=^SC(SC,"ST",I,1),SM=9,MXOK=""
"RTN","SDMM1",60,0)
 I '$D(^XUSEC("SDOB",DUZ)) D NOOB G OBQ
"RTN","SDMM1",61,0)
 I '$$DIR($$FMTE^XLFDT(Y)_" WILL BE AN OVERBOOK, OK","NO") S SM=9,SDNOT=0
"RTN","SDMM1",62,0)
OBQ Q
"RTN","SDMM1",63,0)
 ;
"RTN","SDMM1",64,0)
DIR(TEXT,DEF) ; reader processor
"RTN","SDMM1",65,0)
 ; Input:  TEXT as text of read
"RTN","SDMM1",66,0)
 ;         DEF as default response (if any)
"RTN","SDMM1",67,0)
 ;
"RTN","SDMM1",68,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SDMM1",69,0)
 S DIR(0)="Y",DIR("A")=TEXT
"RTN","SDMM1",70,0)
 I $G(DEF)]"" S DIR("B")=DEF
"RTN","SDMM1",71,0)
 D ^DIR
"RTN","SDMM1",72,0)
 W:'Y !
"RTN","SDMM1",73,0)
 Q Y
"RTN","SDNACT")
0^272^B29097285^B20033650
"RTN","SDNACT",1,0)
SDNACT ;ALB/TMP - INACTIVATE A CLINIC ;9/16/10  17:38
"RTN","SDNACT",2,0)
 ;;5.3;Scheduling;**63,380,549,568,622**;Aug 13, 1993;Build 30
"RTN","SDNACT",3,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDNACT",4,0)
 S SDAY="Sun^Mon^Tues^Wednes^Thurs^Fri^Satur",SDZQ=1
"RTN","SDNACT",5,0)
 D DT^DICRW S DIC="^SC(",DIC(0)="AEMZQ",DIC("A")="Select CLINIC NAME: ",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))"
"RTN","SDNACT",6,0)
 D TURNON^DIAUTL(44,".01;8;2502;2503;2505;2506")
"RTN","SDNACT",7,0)
 D ^DIC K DIC("A"),DIC("S") G:Y<0 END S SC=+Y,SDX="",SDX1=9999999
"RTN","SDNACT",8,0)
 N SDRES S SDRES=$$CLNCK^SDUTL2(SC,0)
"RTN","SDNACT",9,0)
 I 'SDRES D
"RTN","SDNACT",10,0)
 .W !,?5,"WARNING:     Clinic's Stop Code ",$P(SDRES,U,2)
"RTN","SDNACT",11,0)
 .W !,?5,"Recommend:   Clinic be corrected."
"RTN","SDNACT",12,0)
 I $D(^SC(SC,"I")),+^("I")'=0,+^("I")'>DT,+$P(^("I"),"^",2)'>0 W *7,!,"This clinic was inactivated effective: " S Y=+^("I") D DTS^SDUTL W Y G END
"RTN","SDNACT",13,0)
 I $D(^SC(SC,"I")),+^("I")>DT G CHECK
"RTN","SDNACT",14,0)
 I $D(^SC(SC,"I")),+^("I")'>DT,+$P(^("I"),"^",2)'<DT W !,*7,"Clinic is already inactive until " S Y=+$P(^("I"),"^",2) D DTS^SDUTL W Y G END
"RTN","SDNACT",15,0)
D S %DT="AEFX",%DT("A")="Enter Date Clinic is to be Inactivated: " D ^%DT K %DT G:Y'>0 END S SDDATE=Y I Y<DT W "??",!,*7,"Inactivate date must be greater than or equal to today's date" G D
"RTN","SDNACT",16,0)
 I SDX<9999999,Y>SDX1,SDX1 W "??",!,*7,"Inactivate date must be < reactivate date" G D
"RTN","SDNACT",17,0)
 S POP=0 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"S",I)) Q:'I!(POP)!(SDDATE'<SDX1&(SDX1))  F I1=0:0 S I1=$O(^SC(SC,"S",I,1,I1)) Q:'I1  I $P(^(I1,0),"^",9)'="C" S POP=1 Q
"RTN","SDNACT",18,0)
 I POP W *7,!,"Can't inactivate the clinic - appointments exist beyond " S Y=SDDATE D DT^DIQ G END
"RTN","SDNACT",19,0)
 I SDX'="" D CHG1 G OVR
"RTN","SDNACT",20,0)
 K SDN S ^SC(SC,"I")="",X=SDDATE D DOW^SDM0 S SDN(Y)=SDDATE F I=1:1:6 S X2=1,X1=X D C^%DTC,DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",21,0)
 F I=0:1:6 S J=$O(^SC(SC,"T"_I,SDN(I))) D GOT
"RTN","SDNACT",22,0)
OVR F I=SDDATE-.0001:0 S I=$O(^SC(SC,"ST",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",23,0)
 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"T",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",24,0)
 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"OST",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",25,0)
 S DIE="^SC(",DA=SC,DR="2505///^S X=SDDATE" D ^DIE  ;SD*549 use FM API to update field so Audit Trail functions properly
"RTN","SDNACT",26,0)
 W !!,"Clinic will be inactivated effective " N SDDT S Y=SDDATE D DTS^SDUTL W Y S SDDT=Y D QUE G END ; SD*5.3*622 - call mail delivery
"RTN","SDNACT",27,0)
 ;
"RTN","SDNACT",28,0)
CHECK W *7,!,"This clinic is to be inactivated as of " S SDX=+^("I"),Y=SDX D DTS^SDUTL W Y S SDX1=+$P(^("I"),"^",2),Y=SDX1 I Y D DTS^SDUTL W " and reactivated as of ",Y ;NAKED REFERENCE - ^SC(DFN,"I")
"RTN","SDNACT",29,0)
 S %=1 W !,"Do you want to change the inactivate date" D YN^DICN I '% W !,"RESPOND YES OR NO" G CHECK
"RTN","SDNACT",30,0)
 G D:'(%-1),END:(%<0),DEL
"RTN","SDNACT",31,0)
 ;
"RTN","SDNACT",32,0)
DEL S %=2 W !,"Do you want to delete the inactivate date" D YN^DICN I '% W !,"RESPOND YES (Y) OR NO (N)" G DEL
"RTN","SDNACT",33,0)
 G:(%-1) END
"RTN","SDNACT",34,0)
 I '$D(^SC(SC,"SL")) W !,*7,"Cannot Delete - 'SL' node doesn't exist" G END
"RTN","SDNACT",35,0)
 G ^SDNACT1
"RTN","SDNACT",36,0)
CHG1 K SDN S X1=SDDATE,X2=6 D C^%DTC S SDNL=X,X=SDDATE D DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",37,0)
 F I=1:1:6 S X1=X,X2=1 D C^%DTC,DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",38,0)
 S X1=SDX,X2=6 D C^%DTC S SDOL=X,X1=SDX,X2=-1 D C^%DTC
"RTN","SDNACT",39,0)
 F I=0:0 S X2=1,X1=X D C^%DTC Q:X>SDOL  D DOW^SDM0 S:$D(^SC(SC,"T"_Y))&($O(^SC(SC,"T"_Y,0))'=9999999) ^SC(SC,"T"_Y,SDN(Y),1)=$S($D(^SC(SC,"T"_Y,X,1)):^(1),1:""),^(0)=SDN(Y) D A1,A
"RTN","SDNACT",40,0)
 I SDDATE<SDX F I=0:1:6 F J=SDNL:0 S J=$O(^SC(SC,"T"_I,J)) Q:'J!(J'<SDX)  K ^SC(SC,"T"_I,J)
"RTN","SDNACT",41,0)
 Q
"RTN","SDNACT",42,0)
A1 S:'$D(^SC(SC,"T"_Y,9999999,1)) ^(1)="",^(0)=9999999 K:(SDN(Y)-X) ^SC(SC,"T"_Y,X)
"RTN","SDNACT",43,0)
 Q
"RTN","SDNACT",44,0)
A I $O(^SC(SC,"T"_Y,SDN(Y)))>0 S SD=$O(^SC(SC,"T"_Y,SDN(Y))) S:^SC(SC,"T"_Y,SD,1)]"" ^SC(SC,"T"_Y,SDN(Y),1)=^SC(SC,"T"_Y,SD,1),^(0)=SDN(Y),^SC(SC,"T"_Y,SD,1)=""
"RTN","SDNACT",45,0)
 I SDX'>SDDATE,$O(^SC(SC,"ST",SDX-.1))>0 F Z=SDX-.1:0 S Z=$O(^SC(SC,"ST",Z)) Q:'Z!(SDX1&(Z'<SDX1))  K ^SC(SC,"ST",Z)
"RTN","SDNACT",46,0)
 K SD,Z Q
"RTN","SDNACT",47,0)
GOT S SD=$O(^SC(SC,"T"_I,0))
"RTN","SDNACT",48,0)
 I J>0,SD'=9999999 S ^SC(SC,"T"_I,SDN(I),1)=^SC(SC,"T"_I,J,1),^(0)=SDN(I) K ^SC(SC,"T"_I,J) F J1=J:0 S J1=$O(^SC(SC,"T"_I,J1)) Q:'J1  K ^SC(SC,"T"_I,J1)
"RTN","SDNACT",49,0)
 S ^SC(SC,"T"_I,9999999,1)="",^(0)=9999999
"RTN","SDNACT",50,0)
 Q
"RTN","SDNACT",51,0)
END K A,DA,CNT,D0,DH,DO,DOW,I,I1,J,J1,POP,SC,SD,SD0,SDAY,SDEL,SDDATE,SDFSW,SDN,SDNL,SDOL,SDREACT,SI,SL,STARTDAY,SDX,SDX1,SDZQ,X,X1,X2,Y,Z,DIE,DR,DIC Q
"RTN","SDNACT",52,0)
 ;
"RTN","SDNACT",53,0)
MAIL ; SD*5.3*622 - send bulletin to advise of clinic inactivation date
"RTN","SDNACT",54,0)
 N SDNAME,SDMYARR,SDTEXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","SDNACT",55,0)
 S XMSUB="CLINIC INACTIVATED"
"RTN","SDNACT",56,0)
 S XMY("G.SD CLINIC INACTIVATE REMINDER")=""
"RTN","SDNACT",57,0)
 S XMDUZ=.5
"RTN","SDNACT",58,0)
 S XMY(DUZ)="",XMY(XMDUZ)=""
"RTN","SDNACT",59,0)
 S SDMYARR("FILE")=200
"RTN","SDNACT",60,0)
 S SDMYARR("FIELD")=.01
"RTN","SDNACT",61,0)
 S SDMYARR("IENS")=DUZ
"RTN","SDNACT",62,0)
 S SDNAME=$$BLDNAME^XLFNAME(.SDMYARR) ; covered by IA #3065
"RTN","SDNACT",63,0)
 ;
"RTN","SDNACT",64,0)
 S SDTEXT(1)="CLINIC NAME:   "_$$GET1^DIQ(44,+SC,.01,"E")
"RTN","SDNACT",65,0)
 S SDTEXT(2)="INACTIVATION DATE:   "_SDDT
"RTN","SDNACT",66,0)
 S SDTEXT(3)=" "
"RTN","SDNACT",67,0)
 S SDTEXT(4)="Clinic inactivated by "_SDNAME_" on "_SDDT
"RTN","SDNACT",68,0)
 S SDTEXT(5)=" "
"RTN","SDNACT",69,0)
 S SDTEXT(6)="Please perform the following steps immediately:"
"RTN","SDNACT",70,0)
 S SDTEXT(7)=" "
"RTN","SDNACT",71,0)
 S SDTEXT(8)="1. Add at least 2 Z's (UPPERCASE) in front of the clinic name"
"RTN","SDNACT",72,0)
 S SDTEXT(9)="2. Validate that the Clinic Scheduling Grid has been removed"
"RTN","SDNACT",73,0)
 S SDTEXT(10)=" "
"RTN","SDNACT",74,0)
 S XMTEXT="SDTEXT("
"RTN","SDNACT",75,0)
 D ^XMD
"RTN","SDNACT",76,0)
 Q
"RTN","SDNACT",77,0)
 ;
"RTN","SDNACT",78,0)
QUE ; leave job to TaskMan for dates in the future, otherwise deliver
"RTN","SDNACT",79,0)
 ; message immediately for an inactivation date equal to the current
"RTN","SDNACT",80,0)
 ; date
"RTN","SDNACT",81,0)
 N SDDTH,SDTQ,Y,ZTRTN,ZTIO,ZTSAVE,ZTDESC,ZTDTH
"RTN","SDNACT",82,0)
 S SDTQ=DT
"RTN","SDNACT",83,0)
 I $D(^SC(SC,"I")) D
"RTN","SDNACT",84,0)
 . S SDDT=$P(^SC(+SC,"I"),"^",1)
"RTN","SDNACT",85,0)
 . I SDDT=SDTQ S Y=DT D DTS^SDUTL S SDDT=Y D MAIL Q
"RTN","SDNACT",86,0)
 . I SDDT<SDTQ Q  ; don't care for dates on the past
"RTN","SDNACT",87,0)
 . I SDDT>SDTQ D
"RTN","SDNACT",88,0)
 .. S SDDTH=$$FMTH^XLFDT(SDDT+.0100) ; queue at 1 am on desired date
"RTN","SDNACT",89,0)
 .. S ZTDTH=SDDTH
"RTN","SDNACT",90,0)
 .. S Y=SDDT D DTS^SDUTL S SDDT=Y
"RTN","SDNACT",91,0)
 .. S ZTDESC="CLINIC INACTIVATION REMINDER QUEUE"
"RTN","SDNACT",92,0)
 .. S ZTRTN="QUE^SDNACT"
"RTN","SDNACT",93,0)
 .. S ZTIO="NULL"
"RTN","SDNACT",94,0)
 .. S ZTSAVE("*")=""
"RTN","SDNACT",95,0)
 .. D ^%ZTLOAD
"RTN","SDNACT",96,0)
 Q  ; SD*5.3*622 - end of changes
"VER")
8.0^22.0
"^DD",44,44,99.1,0)
TELEPHONE EXTENSION^F^^99.1;1^K:$L(X)>26!($L(X)<1) X
"^DD",44,44,99.1,3)
Answer must be 1-26 characters in length.
"^DD",44,44,99.1,21,0)
^.001^1^1^3140908^^
"^DD",44,44,99.1,21,1,0)
Clinic telephone extension number where patients can call directly.
"^DD",44,44,99.1,"DT")
3140908
"^DD",407.5,407.5,4,0)
PRINT DEFAULT PROVIDER?^S^Y:YES;^3;1^Q
"^DD",407.5,407.5,4,3)
Enter 'Y' to print the Default Provider on the letter.
"^DD",407.5,407.5,4,21,0)
^^2^2^3140926^
"^DD",407.5,407.5,4,21,1,0)
This field controls the printing of the clinic default provider on a 
"^DD",407.5,407.5,4,21,2,0)
Scheduling letter regardless of its type.
"^DD",407.5,407.5,4,"DT")
3140926
"^DD",407.5,407.5,5,0)
PRINT CLINIC LOCATION?^S^Y:YES;^3;2^Q
"^DD",407.5,407.5,5,3)
Enter 'Y' to print the physical location of the clinic on a letter.
"^DD",407.5,407.5,5,21,0)
^^2^2^3140926^
"^DD",407.5,407.5,5,21,1,0)
This field controls the printing of the clinic physical location for a 
"^DD",407.5,407.5,5,21,2,0)
Scheduling letter regardless of its type.
"^DD",407.5,407.5,5,"DT")
3140926
"BLD",9571,6)
^522
**END**
**END**

