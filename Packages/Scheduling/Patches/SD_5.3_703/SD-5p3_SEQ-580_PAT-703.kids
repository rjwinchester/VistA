Released SD*5.3*703 SEQ #580
Extracted from mail message
**KIDS**:SD*5.3*703^

**INSTALL NAME**
SD*5.3*703
"BLD",10373,0)
SD*5.3*703^SCHEDULING^0^3180725^y
"BLD",10373,1,0)
^^3^3^3180627^
"BLD",10373,1,1,0)
This patch will include code changes for several routines for three NSR's 
"BLD",10373,1,2,0)
that were approved by the Software Modification Waiver Committee 
"BLD",10373,1,3,0)
associated with Scheduling Package in VistA.
"BLD",10373,4,0)
^9.64PA^^
"BLD",10373,6)
2^
"BLD",10373,6.3)
5
"BLD",10373,"KRN",0)
^9.67PA^779.2^20
"BLD",10373,"KRN",.4,0)
.4
"BLD",10373,"KRN",.4,"NM",0)
^9.68A^^
"BLD",10373,"KRN",.401,0)
.401
"BLD",10373,"KRN",.402,0)
.402
"BLD",10373,"KRN",.403,0)
.403
"BLD",10373,"KRN",.5,0)
.5
"BLD",10373,"KRN",.84,0)
.84
"BLD",10373,"KRN",3.6,0)
3.6
"BLD",10373,"KRN",3.8,0)
3.8
"BLD",10373,"KRN",9.2,0)
9.2
"BLD",10373,"KRN",9.8,0)
9.8
"BLD",10373,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10373,"KRN",9.8,"NM",1,0)
SDAL^^0^B32624315
"BLD",10373,"KRN",9.8,"NM",2,0)
SDAL0^^0^B37916524
"BLD",10373,"KRN",9.8,"NM",3,0)
SDAMOCP1^^0^B21120628
"BLD",10373,"KRN",9.8,"NM",4,0)
SDCLAV0^^0^B10221725
"BLD",10373,"KRN",9.8,"NM","B","SDAL",1)

"BLD",10373,"KRN",9.8,"NM","B","SDAL0",2)

"BLD",10373,"KRN",9.8,"NM","B","SDAMOCP1",3)

"BLD",10373,"KRN",9.8,"NM","B","SDCLAV0",4)

"BLD",10373,"KRN",19,0)
19
"BLD",10373,"KRN",19,"NM",0)
^9.68A^^
"BLD",10373,"KRN",19.1,0)
19.1
"BLD",10373,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",10373,"KRN",101,0)
101
"BLD",10373,"KRN",101,"NM",0)
^9.68A^^
"BLD",10373,"KRN",409.61,0)
409.61
"BLD",10373,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",10373,"KRN",771,0)
771
"BLD",10373,"KRN",771,"NM",0)
^9.68A^^
"BLD",10373,"KRN",779.2,0)
779.2
"BLD",10373,"KRN",870,0)
870
"BLD",10373,"KRN",8989.51,0)
8989.51
"BLD",10373,"KRN",8989.52,0)
8989.52
"BLD",10373,"KRN",8994,0)
8994
"BLD",10373,"KRN","B",.4,.4)

"BLD",10373,"KRN","B",.401,.401)

"BLD",10373,"KRN","B",.402,.402)

"BLD",10373,"KRN","B",.403,.403)

"BLD",10373,"KRN","B",.5,.5)

"BLD",10373,"KRN","B",.84,.84)

"BLD",10373,"KRN","B",3.6,3.6)

"BLD",10373,"KRN","B",3.8,3.8)

"BLD",10373,"KRN","B",9.2,9.2)

"BLD",10373,"KRN","B",9.8,9.8)

"BLD",10373,"KRN","B",19,19)

"BLD",10373,"KRN","B",19.1,19.1)

"BLD",10373,"KRN","B",101,101)

"BLD",10373,"KRN","B",409.61,409.61)

"BLD",10373,"KRN","B",771,771)

"BLD",10373,"KRN","B",779.2,779.2)

"BLD",10373,"KRN","B",870,870)

"BLD",10373,"KRN","B",8989.51,8989.51)

"BLD",10373,"KRN","B",8989.52,8989.52)

"BLD",10373,"KRN","B",8994,8994)

"BLD",10373,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",10373,"QUES",0)
^9.62^^
"BLD",10373,"REQB",0)
^9.611^3^3
"BLD",10373,"REQB",1,0)
SD*5.3*509^2
"BLD",10373,"REQB",2,0)
SD*5.3*618^2
"BLD",10373,"REQB",3,0)
SD*5.3*496^2
"BLD",10373,"REQB","B","SD*5.3*496",3)

"BLD",10373,"REQB","B","SD*5.3*509",1)

"BLD",10373,"REQB","B","SD*5.3*618",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930824
"PKG",16,22,1,"PAH",1,0)
703^3180725^11969
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3180725
"PKG",16,22,1,"PAH",1,1,1,0)
This patch will include code changes for several routines for three NSR's 
"PKG",16,22,1,"PAH",1,1,2,0)
that were approved by the Software Modification Waiver Committee 
"PKG",16,22,1,"PAH",1,1,3,0)
associated with Scheduling Package in VistA.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDAL")
0^1^B32624315^B32575250
"RTN","SDAL",1,0)
SDAL ;ALB/GRR,MJK,SCM/GXT - APPOINTMENT LIST ;29 Jun 99  04:11PM  ; Compiled JUNE 27, 2018 2:54 PM
"RTN","SDAL",2,0)
 ;;5.3;Scheduling;**37,46,106,171,177,80,266,491,572,618,703**;Aug 13, 1993;Build 5
"RTN","SDAL",3,0)
EN W ! S SDEND=1 D ASK2^SDDIV G:Y<0 END
"RTN","SDAL",4,0)
 W ! S VAUTNI=1 D NCOUNT^SDAL0 I SDCONC=U G END
"RTN","SDAL",5,0)
 W ! D NCLINIC^SDAL0 G:Y<0 END
"RTN","SDAL",6,0)
RD1 W ! N %DT K DIC("S") S %DT("A")="For date: ",%DT="AEX" D ^%DT
"RTN","SDAL",7,0)
 I (X["^")!(Y<0) K %,VAUTD,VAUTC,X,Y Q
"RTN","SDAL",8,0)
 S SDD=Y
"RTN","SDAL",9,0)
 N DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","SDAL",10,0)
 S DIR("A")="Include Primary Care assignment information in the output"
"RTN","SDAL",11,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) K SDD,VAUTC,VAUTD,X,Y Q
"RTN","SDAL",12,0)
 W ! S SDPCMM=Y
"RTN","SDAL",13,0)
N K SDX,SDX1 R !,"Number of copies: 1// ",M:DTIME S:M="" M=1
"RTN","SDAL",14,0)
 I M["^" K M,SDD,VAUTC,VAUTD,X,Y Q
"RTN","SDAL",15,0)
 I (M'?.N)!((M'>0)!($L(M)>3)) W !,"ENTER A WHOLE NUMBER TO SELECT THE # OF COPIES OF THE APPOINTMENT LIST THAT ARE NEEDED- (1-999)" G N
"RTN","SDAL",16,0)
 S SDCOPY=M
"RTN","SDAL",17,0)
 ; -- specify device
"RTN","SDAL",18,0)
 W ! N %ZIS K IO("Q") S %ZIS="QMP" D ^%ZIS G END:POP
"RTN","SDAL",19,0)
 S SDBC=$$BARQ(+IOST(0),IOM) I SDBC="^" G END
"RTN","SDAL",20,0)
 I $D(IO("Q")) D QUE W:$D(ZTSK) "   (Task#: ",ZTSK,")" G END
"RTN","SDAL",21,0)
 ;
"RTN","SDAL",22,0)
START U IO N CNT,SDCLAR,SDCOUNT S (SDCOUNT,CNT)=0
"RTN","SDAL",23,0)
 ;SET UP A TEMP ARRAY -SDCLAR- WITH CLASSIFICATION ABBREVIATIONS
"RTN","SDAL",24,0)
 F  S CNT=$O(^SD(409.41,CNT)) Q:CNT'>0  D
"RTN","SDAL",25,0)
 .S SDCLAR(CNT)=$P(^SD(409.41,CNT,0),U,7)
"RTN","SDAL",26,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDAL",27,0)
 S SDASH="",$P(SDASH,"_",IOM+1)="" S SDBC=+$G(SDBC),SDCOPY=$S($D(SDCOPY):+SDCOPY,$D(M):+M,1:1)
"RTN","SDAL",28,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2)
"RTN","SDAL",29,0)
 I SDBC S SDBC=$S(IOM<120:0,1:$$BARC^SDAMU(+IOST(0),.SDBCON,.SDBCOFF))
"RTN","SDAL",30,0)
 S (SDEND,SD1,PCNT)=0,Y=DT D D^DIQ S SDNT=Y,Y=SDD,X=Y D D^DIQ S SDPD=Y D DW^%DTC S SDPD=X_" "_SDPD
"RTN","SDAL",31,0)
 ;if user has selected 'all' clinics, populate VAUTC with all uncancelled TYPE=C clinics from ^SC
"RTN","SDAL",32,0)
 I VAUTC=1 S SDIEN=0 F  S SDIEN=$O(^SC(SDIEN)) Q:+SDIEN=0  D
"RTN","SDAL",33,0)
 . I $P(^SC(SDIEN,0),"^",3)="C",$G(^SC(SDIEN,"ST",SDD,1))'["CANCELLED" D
"RTN","SDAL",34,0)
 .. S SDNAME=$P(^SC(SDIEN,0),"^",1) I $G(SDNAME)]"" S VAUTC(SDNAME)=SDIEN
"RTN","SDAL",35,0)
 ;-------------CALL TO SDAPI^SDAMA301 TO RETRIEVE APPT DATA------------------
"RTN","SDAL",36,0)
 K ^TMP($J,"SDAMA301") N SDARRAY,SDIEN,SDNAME,SDERR,SDCL,SDDFN,SDDT,SDRESULT
"RTN","SDAL",37,0)
 S SDARRAY(1)=SDD_";"_SDD,SDARRAY(3)="I;R;NT",SDARRAY("FLDS")="4;6;7;8;10;19;20;21"
"RTN","SDAL",38,0)
 ;if user has selected clinics, build clinic filter list
"RTN","SDAL",39,0)
 I VAUTC'=1 D  I $L(SDARRAY(2)) S SDARRAY(2)=$E(SDARRAY(2),1,$L(SDARRAY(2))-1) ;remove last ';' from end
"RTN","SDAL",40,0)
 . S SD="" F  S SD=$O(VAUTC(SD)) Q:SD']""  S SC=$G(VAUTC(SD)) I $G(SC)]"" S SDARRAY(2)=$G(SDARRAY(2))_SC_";"
"RTN","SDAL",41,0)
 ;call SDAPI to retrieve appointment data
"RTN","SDAL",42,0)
 S SDRESULT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDAL",43,0)
 ;if error returned from SDAPI, display on report and quit
"RTN","SDAL",44,0)
 I SDRESULT<0 S SDERR=$$SDAPIERR^SDAMUTDT() I $L(SDERR) S SC=0 S SDPAGE=1 D HED W !!,SDERR,! D:$E(IOST,1,2)="C-" OUT^SDUTL D EXIT Q
"RTN","SDAL",45,0)
 ;if appts returned from SDAPI, sort output by clinic, appt d/t, patient
"RTN","SDAL",46,0)
 I SDRESULT>0 D
"RTN","SDAL",47,0)
 . S SDCL=0 F  S SDCL=$O(^TMP($J,"SDAMA301",SDCL)) Q:'SDCL  D
"RTN","SDAL",48,0)
 .. S SDDFN=0 F  S SDDFN=$O(^TMP($J,"SDAMA301",SDCL,SDDFN)) Q:'SDDFN  D
"RTN","SDAL",49,0)
 ... S SDDT=0 F  S SDDT=$O(^TMP($J,"SDAMA301",SDCL,SDDFN,SDDT)) Q:'SDDT  D
"RTN","SDAL",50,0)
 .... ;SD*618 Add patient's name to be one of the sort filter (Patient's Name~DFN)
"RTN","SDAL",51,0)
 .... S SDPNDFN=$P(^DPT(SDDFN,0),U,1)_"~"_SDDFN
"RTN","SDAL",52,0)
 .... M ^TMP($J,"SDAMA301","S",SDCL,SDDT,SDPNDFN)=^TMP($J,"SDAMA301",SDCL,SDDFN,SDDT)
"RTN","SDAL",53,0)
 ;---------------------------------------------------------------------------
"RTN","SDAL",54,0)
LOOPA ;if no error returned from SDAPI, start looping through clinics in VAUTC (sorted by name)
"RTN","SDAL",55,0)
 I SDRESULT'<0 S SD=0 F  S SD=$O(VAUTC(SD)) Q:SD']""!SDEND  D CLIN
"RTN","SDAL",56,0)
 G:SDEND END
"RTN","SDAL",57,0)
OVER ;S PCNT=PCNT+1 I PCNT<SDCOPY,SDCOUNT S VAUTC=0 G LOOPA
"RTN","SDAL",58,0)
 S PCNT=PCNT+1 I PCNT<SDCOPY,SDCOUNT G LOOPA
"RTN","SDAL",59,0)
END I $G(SDCOUNT)="" G EXIT
"RTN","SDAL",60,0)
 I SDCOUNT=0 S SDPCT="No activity found for this date!" S SDPAGE=1,SC=0 D HED W !!?$L(SDPCT)\2,SDPCT,!
"RTN","SDAL",61,0)
 I $E(IOST,1,2)="C-" D:'$G(SDEND)&$G(SDCOUNT) OUT^SDUTL W @IOF
"RTN","SDAL",62,0)
EXIT K %,%H,%H,A,ALL,DFN,DIC,I,INC,K,M,PCNT,POP,PT,SC,SD,SD1
"RTN","SDAL",63,0)
 K SDCC,SDCONC,SDCP,SDD,SDEM1,SDDIF,SDDIF1,SDEA,SDEC,SDEDT
"RTN","SDAL",64,0)
 K SDEM,SDEND,SDFLG,SDFS,SDIN,SDNT,DTOUT,DUOUT,ZTQUEUED,ZTSTOP
"RTN","SDAL",65,0)
 K DIRUT,SDCOPY,SDPAGE,SDPCT,SDPNOW,SDPT0,SDOI,SDPD,SDREV
"RTN","SDAL",66,0)
 K SDT,SDX,SDXX,SDZ,VADAT,VADATE,VAUTC,VAUTNI,VAUTSTR,VAUTVB
"RTN","SDAL",67,0)
 K VAUTD,VAQK,X,Y,Y1,Y2,Z,SDCLAR,SDPNDFN,SDZDFN
"RTN","SDAL",68,0)
 K SDBC,SDBCON,SDBCOFF,SDASH,SDPCMM,^TMP($J,"SDAMA301")
"RTN","SDAL",69,0)
 D CLOSE^DGUTQ Q
"RTN","SDAL",70,0)
 ;
"RTN","SDAL",71,0)
CLIN ;process each clinic IEN from VAUTC array
"RTN","SDAL",72,0)
 S (SDFLG,SC)=0 S SC=$G(VAUTC(SD)) I $G(SC)>0,$D(^SC(SC,0)) D LOOP^SDAL0
"RTN","SDAL",73,0)
 Q
"RTN","SDAL",74,0)
 ;
"RTN","SDAL",75,0)
BARQ(TTYPE,MARGIN) ;
"RTN","SDAL",76,0)
 N ON,OFF,Y
"RTN","SDAL",77,0)
 I MARGIN<120 S Y=0 G BARCQ
"RTN","SDAL",78,0)
 I '$$BARC^SDAMU(.TTYPE,.ON,.OFF) S Y=0 G BARCQ
"RTN","SDAL",79,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="SHOULD BARCODES BE PRINTED ON LIST(S)"
"RTN","SDAL",80,0)
 D ^DIR K DIR S:$D(DIRUT) Y="^"
"RTN","SDAL",81,0)
BARCQ Q Y
"RTN","SDAL",82,0)
 ;
"RTN","SDAL",83,0)
QUE ;Queue output
"RTN","SDAL",84,0)
 N ZTDESC,ZTSAVE,ZTRTN
"RTN","SDAL",85,0)
 K ZTSK,IO("Q")
"RTN","SDAL",86,0)
 S ZTDESC="Appointment Lists",ZTRTN="START^SDAL"
"RTN","SDAL",87,0)
 F X="VAUTD(","VAUTC(","SDCOPY","SDD","SDBC","VAUTD","VAUTC","SDCONC","SDPCMM" S ZTSAVE(X)=""
"RTN","SDAL",88,0)
 D ^%ZTLOAD
"RTN","SDAL",89,0)
 Q
"RTN","SDAL",90,0)
 ;
"RTN","SDAL",91,0)
STOP ;Check for stop task request
"RTN","SDAL",92,0)
 S:$D(ZTQUEUED) (SDEND,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SDAL",93,0)
 ;
"RTN","SDAL",94,0)
HED ;Print report header
"RTN","SDAL",95,0)
 I SD1,$E(IOST)="C" D OUT^SDUTL Q:SDEND
"RTN","SDAL",96,0)
 D STOP Q:SDEND
"RTN","SDAL",97,0)
 S SDCOUNT=SDCOUNT+1,SD1=1
"RTN","SDAL",98,0)
 W:SDCOUNT>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SDAL",99,0)
 W:SC "Appointments for ",$P(^SC(SC,0),"^",1)," clinic on ",SDPD
"RTN","SDAL",100,0)
 ;SD*572 added following naked reference logic
"RTN","SDAL",101,0)
 I 'SC D
"RTN","SDAL",102,0)
 .I VAUTC W "Appointments for ALL clinics for ",SDPD Q
"RTN","SDAL",103,0)
 .S CT=0,SNAM=""
"RTN","SDAL",104,0)
 .F  S SNAM=$O(VAUTC(SNAM)) Q:SNAM=""  S CT=CT+1,SC=$G(VAUTC(SNAM))
"RTN","SDAL",105,0)
 .I CT=1 W "Appointments for ",$P(^SC(SC,0),U,1)," clinic on ",SDPD D INACT
"RTN","SDAL",106,0)
 .I CT>1!(CT<1) W "Appointments for Selected clinics for ",SDPD
"RTN","SDAL",107,0)
 .K CT,SNAM,SC
"RTN","SDAL",108,0)
 W !,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!
"RTN","SDAL",109,0)
 ;NSR# 20180330 - updated for SSN to be "Last 4 SSN" starting in column 41 versus column 44
"RTN","SDAL",110,0)
 W !," Appt.",?11,"Patient Name",?41,"SSN",?53,"Lab",?62,"X-Ray",?73,"EKG"
"RTN","SDAL",111,0)
 W !," Time",?53,"Time",?62,"Time",?73,"Time",!,?15,"Other Information",?40,"Ward Location",!,?41,"Room-Bed"
"RTN","SDAL",112,0)
 W !,SDASH S SDPAGE=SDPAGE+1
"RTN","SDAL",113,0)
 D:SDBC PAINT(SC,SDD)
"RTN","SDAL",114,0)
 Q
"RTN","SDAL",115,0)
 ;
"RTN","SDAL",116,0)
PAINT(CLINIC,DATE) ; -- paint header barcodes
"RTN","SDAL",117,0)
 ; input:  CLINIC := clinic ifn
"RTN","SDAL",118,0)
 ;           DATE := appt date only
"RTN","SDAL",119,0)
 ;
"RTN","SDAL",120,0)
 W !?10,"Date",?45,"Clinic#",?85,"No",?110,"Yes",!
"RTN","SDAL",121,0)
 D BARC(10,$E(DATE,4,7)_$E(DATE,2,3))
"RTN","SDAL",122,0)
 D BARC(45,"%"_CLINIC_"$")
"RTN","SDAL",123,0)
 D BARC(85,"N"),BARC(110,"Y")
"RTN","SDAL",124,0)
 W !!!!,SDASH
"RTN","SDAL",125,0)
 Q
"RTN","SDAL",126,0)
 ;
"RTN","SDAL",127,0)
BARC(TAB,X) ; --print barcode
"RTN","SDAL",128,0)
 ; input: TAB := tab position
"RTN","SDAL",129,0)
 ;          X := string to print
"RTN","SDAL",130,0)
 ;
"RTN","SDAL",131,0)
 W *13,?TAB W @SDBCON,X,@SDBCOFF
"RTN","SDAL",132,0)
 Q
"RTN","SDAL",133,0)
 ;
"RTN","SDAL",134,0)
INACT ;SD*572 if single clinic selected check if inactive on selected date
"RTN","SDAL",135,0)
 I $D(^SC(SC,"I")) I SDD=$P($G(^("I")),U,1)!(SDD>$P($G(^("I")),U,1)),'$P($G(^("I")),U,2) S SDPCT="Clinic Inactive on this date!" Q
"RTN","SDAL",136,0)
 I $D(^SC(SC,"I")) I SDD=$P($G(^("I")),U,1)!(SDD>$P($G(^("I")),U,1))&(SDD<$P($G(^("I")),U,2)) S SDPCT="Clinic Inactive on this date!" Q
"RTN","SDAL",137,0)
 S SDPCT="No Clinic Availability on this date!"
"RTN","SDAL",138,0)
 Q
"RTN","SDAL",139,0)
 ;
"RTN","SDAL0")
0^2^B37916524^B37381989
"RTN","SDAL0",1,0)
SDAL0 ;ALB/GRR,TMP,MJK,GXT - APPOINTMENT LIST (CONTINUED FROM SDAL) ;13 Jun 18  08:18AM
"RTN","SDAL0",2,0)
 ;;5.3;Scheduling;**28,37,106,149,171,177,193,305,373,266,572,618,703**;Aug 13, 1993;Build 5
"RTN","SDAL0",3,0)
LOOP I 'VAUTC,$G(^SC(SC,"ST",SDD,1))["CANCELLED"  D  Q
"RTN","SDAL0",4,0)
 .S SDPAGE=1 D HED^SDAL
"RTN","SDAL0",5,0)
 .S SDPCT="Clinic cancelled for this date!"
"RTN","SDAL0",6,0)
 .W !!?(IOM-$L(SDPCT)\2),SDPCT
"RTN","SDAL0",7,0)
 I $$CHECK(),$$NCHECK(),$$ACTIVE() D
"RTN","SDAL0",8,0)
 .S SDPAGE=1 D HED^SDAL Q:SDEND  S SDPCT=0,SDFLG=1   ;SD*572 set flag
"RTN","SDAL0",9,0)
 .;loop through sorted appointment data for the clinic
"RTN","SDAL0",10,0)
 .N SDT,SDDFN,SDDATA,SDDATAC S SDT="" F  S SDT=$O(^TMP($J,"SDAMA301","S",SC,SDT)) Q:'SDT  D
"RTN","SDAL0",11,0)
 ..S SDDFN="" F  S SDDFN=$O(^TMP($J,"SDAMA301","S",SC,SDT,SDDFN)) Q:(SDDFN="")!SDEND  D
"RTN","SDAL0",12,0)
 ...;store appt data and comments for later reference
"RTN","SDAL0",13,0)
 ...;SD*618 Patient's name added to one of the sort filter (Patient's name~DFN)
"RTN","SDAL0",14,0)
 ...S SDDATA=$G(^TMP($J,"SDAMA301","S",SC,SDT,SDDFN)),SDDATAC=$G(^(SDDFN,"C"))
"RTN","SDAL0",15,0)
 ...D MORE
"RTN","SDAL0",16,0)
 .W ! D CCLK Q:SDEND
"RTN","SDAL0",17,0)
 .I 'SDPCT S SDPCT="No activity found for this clinic date!" W !!?(IOM-$L(SDPCT)\2),SDPCT
"RTN","SDAL0",18,0)
 S SDPAGE=1 Q
"RTN","SDAL0",19,0)
 ;
"RTN","SDAL0",20,0)
PTL N SDAPPT
"RTN","SDAL0",21,0)
 S DFN=+$P(SDDATA,"^",4),SDOI=$G(SDDATAC)
"RTN","SDAL0",22,0)
 S SDAPPT=""
"RTN","SDAL0",23,0)
 D ^VAUQWK,GETA
"RTN","SDAL0",24,0)
 I ($Y+7>IOSL) D HED^SDAL Q:SDEND
"RTN","SDAL0",25,0)
 I '$D(SDFS) S SDFS=1,X=PT D TM^SDROUT0 W !,$J(X,8)
"RTN","SDAL0",26,0)
 N SDCLY D CL^SDCO21(DFN,SDT,"",.SDCLY)
"RTN","SDAL0",27,0)
 N SDY S SDY=$Y
"RTN","SDAL0",28,0)
 W ! D:SDBC BARC^SDAL(85,$P(VAQK(2),"^"))
"RTN","SDAL0",29,0)
 ;check for Combat Vet
"RTN","SDAL0",30,0)
 N SDCV
"RTN","SDAL0",31,0)
 S SDCV=$$CVEDT^DGCV(DFN,$G(SDD))
"RTN","SDAL0",32,0)
 S SDCV=$P(SDCV,U,3)
"RTN","SDAL0",33,0)
 ;NSR# 20180330 replaces Social Security Number (nine digits) from the Appointment List with only the last four digits of the patient's Social Security Number.
"RTN","SDAL0",34,0)
 ;Patch SD*5.3*703
"RTN","SDAL0",35,0)
 W !?3,$S($G(SDCV)=1:"(CV)",1:""),?9,$S($P(SDDATA,"^",7)="Y":"*",1:""),?10,$S(VAQK(1)]"":VAQK(1),1:"UNKNOWN PATIENT"),?41,$S(VAQK(2)]"":$E(VAQK(2),6,9),1:"")
"RTN","SDAL0",36,0)
 S INC=0 F SDZ=3,4,5 S X=SDZ(SDZ) D:X]"" TM^SDROUT0 S INC=SDZ#3*8+3 W ?48+INC,$J(X,8) W:INC<16 "  "
"RTN","SDAL0",37,0)
 I VAQK(12)]"" W !,?41,VAQK(12) W:VAQK(13)]"" !,?41,VAQK(13)
"RTN","SDAL0",38,0)
 W:SDOI]"" !,?15,SDOI W:SDEM]"" !,?15,SDEM,$S($D(SDCP):$P(^SC(SDCP,0),"^"),1:$P(^SC(SC,0),"^")),!,?15,SDEM1
"RTN","SDAL0",39,0)
 W !,?10,"Phone #: ",$P($G(^DPT(DFN,.13)),"^",1) ;Phone Number [Residence]
"RTN","SDAL0",40,0)
 S SDX="" F I=7:1:9 I VAQK(I) S SDX=1 Q
"RTN","SDAL0",41,0)
 ;Primary Care information
"RTN","SDAL0",42,0)
 I +$G(SDPCMM) D TDATA^SDPPTEM(DFN,"",SDD,"P",15)
"RTN","SDAL0",43,0)
 ;; GAF SCORE CHECK
"RTN","SDAL0",44,0)
 N SDGAF,SDGAFST
"RTN","SDAL0",45,0)
 ;use Appt Type here since COLLATERAL VISIT field not supported by encapsulation API
"RTN","SDAL0",46,0)
 I $$MHCLIN^SDUTL2(SC),'($$COLLAT^SDUTL2(+VAQK(6))!$P($P(SDDATA,"^",10),";",2)["COLLATERAL OF VET") D
"RTN","SDAL0",47,0)
 . S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^")
"RTN","SDAL0",48,0)
 . W:SDGAFST !,?15,"** New GAF Score Required **"
"RTN","SDAL0",49,0)
 ;;
"RTN","SDAL0",50,0)
 I $O(SDCLY(0))  D
"RTN","SDAL0",51,0)
 .N PCL
"RTN","SDAL0",52,0)
 .S PCL=0
"RTN","SDAL0",53,0)
 .W !,?15,"** Required for facility workload credit => "
"RTN","SDAL0",54,0)
 .F  S PCL=$O(SDCLY(PCL)) Q:'PCL  D
"RTN","SDAL0",55,0)
 ..  W " ",SDCLAR(PCL)," "
"RTN","SDAL0",56,0)
 ..  I (SDCLAR(PCL)="SC")&($G(^DPT(DFN,0))]"") D
"RTN","SDAL0",57,0)
 ...  K SDELAR
"RTN","SDAL0",58,0)
 ...  S VAROOT="SDELAR"
"RTN","SDAL0",59,0)
 ...  D ELIG^VADPT
"RTN","SDAL0",60,0)
 ...  Q:'$P($G(SDELAR(3)),"^")
"RTN","SDAL0",61,0)
 ...  W $P(SDELAR(3),"^",2),"% "
"RTN","SDAL0",62,0)
 ...  K SDELAR,VAROOT
"RTN","SDAL0",63,0)
 .W "**"
"RTN","SDAL0",64,0)
 I $P(VAQK(11),"^",2)]"" W !,?15,"Means Test: ** ",$P(VAQK(11),"^",2)," **" W "   Last Test: ",$$FDATE^SDUL1($P($$LST^DGMTU(DFN),U,2))
"RTN","SDAL0",65,0)
 S SDCOPS=$$LST^DGMTU(DFN,DT,2) I +SDCOPS W !,?15,"Co-Pay Status: ","**"_$P(SDCOPS,U,3)_"**"," Last Test: ",$$FDATE^SDUL1($P(SDCOPS,U,2)) K SDCOPS
"RTN","SDAL0",66,0)
 I $D(^DIC(8,+VAQK(6),0)),$P(^(0),U,9)=13 W !,?15,"** COLLATERAL **" G Q
"RTN","SDAL0",67,0)
 I +$P(SDDATA,"^",8)]"" D  I V W !,?15,"** COLLATERAL **" G Q
"RTN","SDAL0",68,0)
 .S V=+$P(SDDATA,"^",8),V=$S($D(^DIC(8,+V,0)):$P(^(0),"^",9)=13,1:0)
"RTN","SDAL0",69,0)
 ;use Appt Type here since COLLATERAL VISIT field not supported by encapsulation API
"RTN","SDAL0",70,0)
 I $P($P(SDDATA,"^",10),";",2)["COLLATERAL OF VET" W !,?15,"** COLLATERAL VISIT **"
"RTN","SDAL0",71,0)
 I +$P($G(SDDATA),"^",8)=0 S V=0
"RTN","SDAL0",72,0)
Q I SDBC,(SDY+5)>$Y F I=1:1 Q:(SDY+5)'>$Y  W !
"RTN","SDAL0",73,0)
 I SDBC W !?9,$E(SDASH,9,255)
"RTN","SDAL0",74,0)
 S SDPCT=SDPCT+1 K V,SDX,SDMT,VAQK Q
"RTN","SDAL0",75,0)
 ;
"RTN","SDAL0",76,0)
GETA K SDCP S SDZ(3)=$P($G(SDDATA),"^",21),SDZ(4)=$P($G(SDDATA),"^",20),SDZ(5)=$P($G(SDDATA),"^",19)
"RTN","SDAL0",77,0)
 S SDEM="",SDEC=+VAQK(6) Q:'SDEC
"RTN","SDAL0",78,0)
 S SDXX=$S('$D(^DIC(8,SDEC,0)):1,$P(^(0),"^",5)'="Y":1,$P(^(0),"^",4)=4:0,$P(^(0),"^",4)=5:0,1:1) Q:SDXX
"RTN","SDAL0",79,0)
 I $D(^SC(SC,"SL")),$P(^("SL"),U,5)]"",$D(^SC($P(^("SL"),U,5),0)) S SDCP=$P(^SC(SC,"SL"),U,5)
"RTN","SDAL0",80,0)
 S SDCP=$S($D(SDCP):SDCP,1:SC) I $D(^DPT(DFN,"DE","B",SDCP)),VAQK(12)']"" S SDEA=$O(^DPT(DFN,"DE","B",SDCP,0)) I $D(^DPT(DFN,"DE",+SDEA,0)),$P(^(0),"^",2)']"",$O(^(1,0))'="" D CKCED
"RTN","SDAL0",81,0)
 Q
"RTN","SDAL0",82,0)
 ;
"RTN","SDAL0",83,0)
MORE K SDFS S PT=SDT D PTL
"RTN","SDAL0",84,0)
 Q
"RTN","SDAL0",85,0)
 ;
"RTN","SDAL0",86,0)
CCLK S SDCC=0 F  S SDCC=$O(^SC(SC,"C",SDD,1,SDCC)) Q:'SDCC!SDEND  S SDPT0=$G(^DPT(+^(SDCC,0),0)) I $L(SDPT0) D
"RTN","SDAL0",87,0)
 .I ($Y+4>IOSL) D HED^SDAL Q:SDEND  W !
"RTN","SDAL0",88,0)
 .W !,"CHART REQUEST: ",$P(SDPT0,"^",1),?34,$P(SDPT0,"^",9)
"RTN","SDAL0",89,0)
 Q
"RTN","SDAL0",90,0)
 ;
"RTN","SDAL0",91,0)
CKCED S A=0 F  S A=$O(^DPT(DFN,"DE",SDEA,1,A)) Q:'A  I $P(^DPT(DFN,"DE",SDEA,1,A,0),"^",3)']"" D ENR Q
"RTN","SDAL0",92,0)
 Q
"RTN","SDAL0",93,0)
 ;
"RTN","SDAL0",94,0)
ENR S SDEDT=$P(^(0),"^",1)\1,SDDIF=DT-SDEDT,SDREV=$P(^(0),"^",5),SDDIF1=$S(SDREV:DT-SDREV,1:"") ;NAKED REFERENCE - ^DPT(DFN,"DE",SDEA,1,A,0)
"RTN","SDAL0",95,0)
 I $P(^DPT(DFN,"DE",SDEA,1,A,0),"^",2)="O",$S(SDDIF1']""&(SDDIF>10000):1,SDDIF1>10000:1,1:0) S SDEM="PATIENT HAS BEEN ENROLLED IN ",SDEM1="FOR MORE THAN 1 YEAR, PLEASE RE-EVALUATE"
"RTN","SDAL0",96,0)
 Q
"RTN","SDAL0",97,0)
 ;
"RTN","SDAL0",98,0)
CHECK() I $D(^SC(SC,0)),$P(^(0),"^",3)="C",$S(VAUTD:1,$D(VAUTD(+$P(^(0),"^",15))):1,'$P(^(0),"^",15)&$D(VAUTD(+$O(^DG(40.8,0)))):1,1:0)
"RTN","SDAL0",99,0)
 I $T,$D(^SC(SC,"ST",SDD,1)),^(1)'["**CANCELLED",$S('$D(^SC(SC,"I")):1,+^("I")'>0:1,+^("I")>SDD:1,+^("I")'>SDD&(+$P(^("I"),"^",2)>SDD!(+$P(^("I"),"^",2)=0)):0,1:1) Q 1
"RTN","SDAL0",100,0)
 Q 0
"RTN","SDAL0",101,0)
 ;
"RTN","SDAL0",102,0)
NCOUNT ;COUNT, NON-COUNT, or BOTH FOR CLINIC SELECTION
"RTN","SDAL0",103,0)
 W !,"Count, Non Count, or Both: C//" R SDCONC:DTIME
"RTN","SDAL0",104,0)
 I '$T!(SDCONC="") S SDCONC="C" Q
"RTN","SDAL0",105,0)
 Q:SDCONC=U
"RTN","SDAL0",106,0)
 I $L(SDCONC)=1,$E(SDCONC)="?" W !,"Type C, N or B" G NCOUNT
"RTN","SDAL0",107,0)
 I $E(SDCONC,1,2)="??" D  G NCOUNT
"RTN","SDAL0",108,0)
 . W !!,"Choosing ""C"" will limit the selection to COUNT clinics."
"RTN","SDAL0",109,0)
 . W !,"         ""N"" will limit the selection to NON COUNT clinics."
"RTN","SDAL0",110,0)
 . W !,"         ""B"" will give BOTH count and non count clinics.",!
"RTN","SDAL0",111,0)
 S SDCONC=$E(SDCONC),SDCONC=$TR(SDCONC,"bcn","BCN")
"RTN","SDAL0",112,0)
 I "BCN"'[SDCONC W !,"C, N or B" G NCOUNT
"RTN","SDAL0",113,0)
 Q
"RTN","SDAL0",114,0)
 ;
"RTN","SDAL0",115,0)
NCHECK() ;EXTEND $T LOGIC COUNT, NO COUNT,or BOTH  
"RTN","SDAL0",116,0)
 N NOC S NOC=$P($G(^SC(SC,0)),U,17)
"RTN","SDAL0",117,0)
 I SDCONC="B" Q 1
"RTN","SDAL0",118,0)
 I SDCONC="C"&(NOC="N") Q 1
"RTN","SDAL0",119,0)
 I SDCONC="N"&(NOC="Y") Q 1
"RTN","SDAL0",120,0)
 Q 0
"RTN","SDAL0",121,0)
 ;
"RTN","SDAL0",122,0)
NCLINIC ;SCREEN CLINICS
"RTN","SDAL0",123,0)
 N NOCC
"RTN","SDAL0",124,0)
 I SDCONC="B" S NOCC="&1"
"RTN","SDAL0",125,0)
 I SDCONC="N" S NOCC="&($P(^(0),U,17)=""Y"")"
"RTN","SDAL0",126,0)
 I SDCONC="C" S NOCC="&($P(^(0),U,17)=""N"")"
"RTN","SDAL0",127,0)
 S DIC="^SC(",DIC("S")="I $P(^(0),U,3)=""C""&'$G(^(""OOS""))"_NOCC_"&$S(VAUTD:1,$D(VAUTD(+$P(^(0),U,15))):1,'+$P(^(0),U,15)&$D(VAUTD(+$O(^DG(40.8,0)))):1,1:0)",VAUTSTR="clinic",VAUTVB="VAUTC" G FIRST^VAUTOMA
"RTN","SDAL0",128,0)
 ;
"RTN","SDAL0",129,0)
ACTIVE() ;Determine if clinic has activity to print
"RTN","SDAL0",130,0)
 ;Output: '1' if activity or selected clinic, '0' otherwise
"RTN","SDAL0",131,0)
 Q:'VAUTC 1  ;selected clinics
"RTN","SDAL0",132,0)
 Q:$O(^SC(SC,"C",SDD,1,0)) 1  ;chart request list
"RTN","SDAL0",133,0)
 ;if clinic has no appts, return 0
"RTN","SDAL0",134,0)
 S SDX=1 I '$D(^TMP($J,"SDAMA301",SC)) S SDX=0
"RTN","SDAL0",135,0)
 Q SDX
"RTN","SDAMOCP1")
0^3^B21120628^B18032029
"RTN","SDAMOCP1",1,0)
SDAMOCP1 ;IOFO BAY PINES/TEH,GXT - Detail Print for Cancelled Statistics;6/15/92  ; Compiled JUNE 13, 2018 8:00:50
"RTN","SDAMOCP1",2,0)
 ;;5.3;Scheduling;**487,496,703**;Aug 13, 1993;Build 5
"RTN","SDAMOCP1",3,0)
 ;
"RTN","SDAMOCP1",4,0)
HDR ;Report Header
"RTN","SDAMOCP1",5,0)
 ;
"RTN","SDAMOCP1",6,0)
 N SDSTOP
"RTN","SDAMOCP1",7,0)
 I SDPAGE>1,$E(IOST,1,2)="C-" D PAUSE^VALM1 I 'Y S SDSTOP=1 Q
"RTN","SDAMOCP1",8,0)
HDR1 W @IOF
"RTN","SDAMOCP1",9,0)
 W !,?50,"Cancelled Clinic Report - Detail"
"RTN","SDAMOCP1",10,0)
 W !,?50,"Date Range: ",$$FDATE^VALM1(SDBEG)_" to "_$$FDATE^VALM1(SDEND)
"RTN","SDAMOCP1",11,0)
 D NOW^%DTC
"RTN","SDAMOCP1",12,0)
 W !,?54,"Run Date: ",$E($$FDTTM^VALM1(%),1,14)
"RTN","SDAMOCP1",13,0)
 W !,?62,"Page: ",SDPAGE S SDPAGE=SDPAGE+1
"RTN","SDAMOCP1",14,0)
 W !,"Division"
"RTN","SDAMOCP1",15,0)
 W !,SDASH,!
"RTN","SDAMOCP1",16,0)
 ;NSR #20180328 Stop Code added to Canceled Clinic Report
"RTN","SDAMOCP1",17,0)
 ;Patch SD*5.3*703
"RTN","SDAMOCP1",18,0)
 W "Status",?8,"Patient",?30,"SSN",?39,"Appt Date",?57,"Clinic",?88,"STOP",?95,"Cancel Date",?112,"User",!
"RTN","SDAMOCP1",19,0)
 W SDASH
"RTN","SDAMOCP1",20,0)
 Q
"RTN","SDAMOCP1",21,0)
 ;
"RTN","SDAMOCP1",22,0)
BLD ;Build output from ^TMP global
"RTN","SDAMOCP1",23,0)
 ;
"RTN","SDAMOCP1",24,0)
 N SDTOT,SDTOTT,SDCL,SDDATE,SDUSER,SDCDT
"RTN","SDAMOCP1",25,0)
 D HDR
"RTN","SDAMOCP1",26,0)
 I IOST["P-" K DIRUT
"RTN","SDAMOCP1",27,0)
 S (SDSTOP,SDTOTT,SDFLG)=0,SDDV="" F  S SDDV=$O(^TMP("SDAMCD",$J,SDDV)) Q:SDDV=""!(SDSTOP)  D CHK D
"RTN","SDAMOCP1",28,0)
 .S SDDVNM=$P($G(^DG(40.8,SDDV,0)),U) W !,SDDVNM
"RTN","SDAMOCP1",29,0)
 .S SDCR="" F  S SDCR=$O(^TMP("SDAMCD",$J,SDDV,SDCR)) Q:SDCR=""!($D(DIRUT))  S SDTOT(SDCR)=0 D  W !!,"SUBTOTAL:",$J(SDTOT(SDCR),4),!
"RTN","SDAMOCP1",30,0)
 ..S SDCL="" F  S SDCL=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL)) Q:SDCL=""!($D(DIRUT))  D 
"RTN","SDAMOCP1",31,0)
 ...S SDDATE="" F  S SDDATE=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE)) Q:SDDATE=""!($D(DIRUT))  D
"RTN","SDAMOCP1",32,0)
 ....S SDDFN="" F  S SDDFN=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN)) Q:SDDFN=""!($D(DIRUT))  D
"RTN","SDAMOCP1",33,0)
 .....S SDDATA=$G(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN))
"RTN","SDAMOCP1",34,0)
 .....S Y=$P(SDDATA,";",2) D DD^%DT S SDAPDT=Y
"RTN","SDAMOCP1",35,0)
 .....D GETS^DIQ(2,SDDFN_",",".01;.09",,"SDRES","SDMES") S SDNM=$E($G(SDRES(2,SDDFN_",",.01)),1,20),SDSSN=$E($G(SDRES(2,SDDFN_",",.09)),6,9)
"RTN","SDAMOCP1",36,0)
 .....S Y=$P(SDDATA,U,14) D DD^%DT S SDCDT=Y S SDUSER=$P(SDDATA,U,12)
"RTN","SDAMOCP1",37,0)
 .....S SDUSERNM=$$GET1^DIQ(200,SDUSER_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",38,0)
 .....;NSR #20180328 Stop Code added to Canceled Clinic Report
"RTN","SDAMOCP1",39,0)
 .....;Patch SD*5.3*703
"RTN","SDAMOCP1",40,0)
 .....N STP,STPCDE S STP=$P($G(^SC(SDCL,0)),U,7),STPCDE=$P($G(^DIC(40.7,STP,0)),U,2)
"RTN","SDAMOCP1",41,0)
 .....S SDCLNM=$$GET1^DIQ(44,SDCL_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",42,0)
 .....;NSR #20180328 Stop Code added to Canceled Clinic Report
"RTN","SDAMOCP1",43,0)
 .....;Patch SD*5.3*703
"RTN","SDAMOCP1",44,0)
 .....W !,SDCR,?8,$E(SDNM,1,22),?30,SDSSN,?39,$$FMTE^XLFDT($P(SDDATA,";",2),"2M"),?57,$E(SDCLNM,1,28),?88,STPCDE,?95,$$FMTE^XLFDT($P(SDDATA,U,14),"2M"),?112,$E(SDUSERNM,1,26)
"RTN","SDAMOCP1",45,0)
 .....K SDRES,SDMES ;SD/496
"RTN","SDAMOCP1",46,0)
 .....D CHK I $D(DIRUT) Q 
"RTN","SDAMOCP1",47,0)
 .....S SDTOT(SDCR)=$G(SDTOT(SDCR))+1,SDTOTT=SDTOTT+1
"RTN","SDAMOCP1",48,0)
 W !!,"TOTAL CANCELLATIONS:",$J(SDTOTT,14)
"RTN","SDAMOCP1",49,0)
 W !!,"End of Report!"
"RTN","SDAMOCP1",50,0)
 K SDUSERNM,SDSSN,SDAPDT,SDCLNM,SDRES,SDNM,SDCR,SDDDATE,SDDFN,SDDATA,SDDVNM,SDCLNM
"RTN","SDAMOCP1",51,0)
 I IOST["P-" S DIRUT=1
"RTN","SDAMOCP1",52,0)
BLDQ Q
"RTN","SDAMOCP1",53,0)
 ;
"RTN","SDAMOCP1",54,0)
MCTOT ;
"RTN","SDAMOCP1",55,0)
 N SDFLG,SDDV,SDNXT
"RTN","SDAMOCP1",56,0)
 S SDFLG=1,SDDV="" D HDR F  S SDDV=$O(^TMP("SDAMS",$J,SDDV)) Q:SDDV=""  D  Q:SDSTOP
"RTN","SDAMOCP1",57,0)
 .W !,$P($G(^DG(40.8,SDDV,0)),U)
"RTN","SDAMOCP1",58,0)
 .K SDTOT,SDCNT D TOTAL
"RTN","SDAMOCP1",59,0)
 .W ?124,$J(SDTOT,8)
"RTN","SDAMOCP1",60,0)
 .D CHK Q:SDSTOP
"RTN","SDAMOCP1",61,0)
 .S SDNXT=$O(^TMP("SDAMS",$J,SDDV)) W:SDNXT'="" !,SDASH
"RTN","SDAMOCP1",62,0)
 .K SDTOT,SDCNT
"RTN","SDAMOCP1",63,0)
 W !,SDTDASH,!,"TOTAL" F SDI=1:1:11 S SDCNT(SDI)=+$G(SDAT("SDAMS",$J,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",64,0)
 D CNT
"RTN","SDAMOCP1",65,0)
 W ?124,$J(SDTOT,8) K SDTOT,SDCNT D CHK I SDSTOP G MCTOTQ
"RTN","SDAMOCP1",66,0)
 W !! D LEGEND
"RTN","SDAMOCP1",67,0)
MCTOTQ Q
"RTN","SDAMOCP1",68,0)
CNT ;Place no-show/no-show auto rebook & cancel/cancel auto-rebook together
"RTN","SDAMOCP1",69,0)
 S SDCNT(4)=+$G(SDCNT(4))+(+$G(SDCNT(6))),SDCNT(13)=+$G(SDCI(+SDCL,4))+(+$G(SDCI(+SDCL,6)))
"RTN","SDAMOCP1",70,0)
 S SDCNT(5)=+$G(SDCNT(5))+(+$G(SDCNT(7))),SDCNT(14)=+$G(SDCI(+SDCL,5))+(+$G(SDCI(+SDCL,7)))
"RTN","SDAMOCP1",71,0)
 F SDI=1,2,3,4,13,6,5,14,7,8 D
"RTN","SDAMOCP1",72,0)
 .W ?$$COL(SDI),$J($S($D(SDCNT(SDI)):SDCNT(SDI),1:0),$$LEN(SDI))
"RTN","SDAMOCP1",73,0)
 Q
"RTN","SDAMOCP1",74,0)
 ;
"RTN","SDAMOCP1",75,0)
CHK ;Check to pause on screen
"RTN","SDAMOCP1",76,0)
 N SDY
"RTN","SDAMOCP1",77,0)
 I $E(IOST,1,2)="C-",($Y+8)>IOSL D PAUSE^VALM1 S SDY=Y D:SDY HDR1 I 'SDY S SDSTOP=1 Q
"RTN","SDAMOCP1",78,0)
 I ($Y+8)>IOSL D HDR1
"RTN","SDAMOCP1",79,0)
 Q
"RTN","SDAMOCP1",80,0)
TOTAL ;Totals
"RTN","SDAMOCP1",81,0)
 F SDI=1:1:11 S SDCNT(SDI)=+$G(SDCL("SDAMS",$J,SDDV,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",82,0)
 D CNT
"RTN","SDAMOCP1",83,0)
 K SDCNT
"RTN","SDAMOCP1",84,0)
 Q
"RTN","SDAMOCP1",85,0)
 ;
"RTN","SDAMOCP1",86,0)
LEGEND ;Legend on bottom of output
"RTN","SDAMOCP1",87,0)
 ;
"RTN","SDAMOCP1",88,0)
 W !,?5,"o CI=Checked In ; RB=Rebooked"
"RTN","SDAMOCP1",89,0)
 W !,?5,"o 'Cancelled' appointments only reflect appointments cancelled using 'Cancel Clinic Availability'."
"RTN","SDAMOCP1",90,0)
 W !,?5,"o 'Checked-In' does not include no-shows or cancelled appointments that have been checked in."
"RTN","SDAMOCP1",91,0)
 Q
"RTN","SDAMOCP1",92,0)
 ;
"RTN","SDAMOCP1",93,0)
COL(SDI) ;Column placement of appt. status
"RTN","SDAMOCP1",94,0)
 ;
"RTN","SDAMOCP1",95,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",96,0)
 ;output - column placement
"RTN","SDAMOCP1",97,0)
 Q $S(SDI=1:34,SDI=2:48,SDI=3:63,SDI=4:81,SDI=5:97,SDI=6:92,SDI=7:108,SDI=8:114,SDI=13:87,SDI=14:103)
"RTN","SDAMOCP1",98,0)
 ;
"RTN","SDAMOCP1",99,0)
LEN(SDI) ;Length of column
"RTN","SDAMOCP1",100,0)
 ;
"RTN","SDAMOCP1",101,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",102,0)
 ;output - length of column
"RTN","SDAMOCP1",103,0)
 Q $S(SDI=1:10,SDI=2:11,SDI=3:15,SDI=4:5,SDI=6:4,SDI=5:5,SDI=7:4,SDI=8:9,SDI=13:4,SDI=14:4)
"RTN","SDAMOCP1",104,0)
 ;
"RTN","SDCLAV0")
0^4^B10221725^B9891276
"RTN","SDCLAV0",1,0)
SDCLAV0 ;ALB/LDB,GXT - OUTPUT PATTERNS (cont.) ; 06 JUN 2018 10:14 AM
"RTN","SDCLAV0",2,0)
 ;;5.3;Scheduling;**184,439,490,517,529,509,703**;Aug 13, 1993;Build 5
"RTN","SDCLAV0",3,0)
 ;SD/517 CHANGED FOR LOOPS
"RTN","SDCLAV0",4,0)
 I 'VAUTC S SDC=0 F  S SDC=$O(VAUTC(SDC)) Q:'SDC  S SDV=VAUTC(SDC) D:VAUTD!($D(VAUTD(+$P(^SC(SDC,0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",5,0)
 I VAUTC S SDC=0 F  S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^(SDC,0),"^",3)="C" D:VAUTD!($D(VAUTD(+$P(^(0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",6,0)
 I $D(^UTILITY($J,"SDNMS")) D S2^SDCLAV1
"RTN","SDCLAV0",7,0)
 ;following line commented off per SD*529
"RTN","SDCLAV0",8,0)
 ;S DGTCH="CLINIC AVAILABILITY REPORT^CLINIC^PAGE#" D:$E(IOST,1,2)="P-" TP^DGUTL K SDBD,SDCI,SDED D END^SDCLAV Q
"RTN","SDCLAV0",9,0)
 D END^SDCLAV Q
"RTN","SDCLAV0",10,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV0",11,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC
"RTN","SDCLAV0",12,0)
 Q
"RTN","SDCLAV0",13,0)
NM ;called by SDCLAV1 - SD/517 CHANGED FOR LOOP
"RTN","SDCLAV0",14,0)
 S SDAP1=0 F  S SDAP1=$O(^SC(SDC,"S",SDAP,1,SDAP1)) Q:'SDAP1  D NM1
"RTN","SDCLAV0",15,0)
 K M1,SDN1,SDN2,SDN3,SDC3,SDAP1  ; SD*5.3*439 added Kill of local vars
"RTN","SDCLAV0",16,0)
 Q
"RTN","SDCLAV0",17,0)
NM1 I '$D(^SC(SDC,"S",SDAP,1,SDAP1,0)) N POP S POP=0,(SDN1,SDN2,SDN3)="" D CHECK,KILL Q  ;added SD/517
"RTN","SDCLAV0",18,0)
 I $P(^SC(SDC,"S",SDAP,1,SDAP1,0),U,1)="" D SETUTL Q   ;SD*509
"RTN","SDCLAV0",19,0)
 ;NSR #20180316 SSN REDUCTION - Clinic Availability Report
"RTN","SDCLAV0",20,0)
 ;SD*5.3*703
"RTN","SDCLAV0",21,0)
 S SDN1=+^SC(SDC,"S",SDAP,1,SDAP1,0),M1=$P(^(0),"^",2),SDC3=$P(^(0),"^",9),SDN2=$P(^DPT(+SDN1,0),"^"),SDN3=$P(^(0),"^",9),SDN3=$S(SDN3="":"UNKNOWN",1:"*****"_$E(SDN3,6,9)) I $D(SDCI) D NM2 Q 
"RTN","SDCLAV0",22,0)
 ; SD*5.3*439 added quit if clinic in "S" node not = to selected clinic
"RTN","SDCLAV0",23,0)
 I '$D(SDCI),$D(^DPT(SDN1,"S",SDAP,0)),$P(^(0),"^",2)'["C",$P(^(0),"^",2)'="N",$P(^(0),"^",2)'="NA" Q:$P(^(0),U,1)'=SDC  D NM2 Q
"RTN","SDCLAV0",24,0)
 Q
"RTN","SDCLAV0",25,0)
 ;SD*5.3*490 do not display appts prior to clinic start date
"RTN","SDCLAV0",26,0)
NM2 Q:$P(SDAP,".",1)<$O(^SC(SDC,"T",0))  ;SD*5.3*490
"RTN","SDCLAV0",27,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_$S(($P(^DPT(SDN1,"S",SDAP,0),"^",2)["C"):"^*",SDC3="C":"^*",($P(^(0),"^",2)="N"):"^**",($P(^(0),"^",2)="NA"):"^**",1:"")
"RTN","SDCLAV0",28,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) $P(^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3),"^",3)=$S($P(^DPT(SDN1,"S",SDAP,0),"^",7)=4:"***",1:"")
"RTN","SDCLAV0",29,0)
 Q
"RTN","SDCLAV0",30,0)
 ;
"RTN","SDCLAV0",31,0)
CHECK ;Added SD/517
"RTN","SDCLAV0",32,0)
 N SDIEN,NODE,NODE0,HDFN,HDNAM,HDSN,POP
"RTN","SDCLAV0",33,0)
 S SDIEN=0,NODE="",HDAP1=SDAP1
"RTN","SDCLAV0",34,0)
 F  S SDIEN=$O(^SCE("B",SDAP,SDIEN)) Q:'SDIEN  D
"RTN","SDCLAV0",35,0)
 .S NODE=^SCE(SDIEN,0)
"RTN","SDCLAV0",36,0)
 .Q:$P(NODE,U,4)'=SDC
"RTN","SDCLAV0",37,0)
 .S HDFN=$P(NODE,U,2),HDNAM=$P(^DPT(HDFN,0),U),HDSN=$P(^(0),U,9)
"RTN","SDCLAV0",38,0)
 .Q:$D(^UTILITY($J,"SDNMS",D,SDV,SDAP,HDNAM,HDSN))
"RTN","SDCLAV0",39,0)
 .S POP=0 D CHECK1 Q:POP
"RTN","SDCLAV0",40,0)
 .S SDN1=$P(NODE,U,2),SDN2=$P(^DPT(SDN1,0),U),SDN3=$P(^DPT(SDN1,0),U,9),M1="",SDC3=""
"RTN","SDCLAV0",41,0)
 .D NM2
"RTN","SDCLAV0",42,0)
 Q
"RTN","SDCLAV0",43,0)
 ;
"RTN","SDCLAV0",44,0)
CHECK1 ;Added SD/517
"RTN","SDCLAV0",45,0)
 S HDAP1=$O(^SC(SDC,"S",SDAP,1,HDAP1)) Q:'HDAP1
"RTN","SDCLAV0",46,0)
 Q:'$D(^SC(SDC,"S",SDAP,1,HDAP1,0))  S NODE0=^(0)
"RTN","SDCLAV0",47,0)
 I $P(NODE0,U,1)=HDFN S POP=1 Q
"RTN","SDCLAV0",48,0)
 Q
"RTN","SDCLAV0",49,0)
 ;
"RTN","SDCLAV0",50,0)
KILL K SDIEN,NODE,NODE0,POP,HDFN,HDNAM,HDSN,HDAP1  ;added SD/517
"RTN","SDCLAV0",51,0)
 Q
"RTN","SDCLAV0",52,0)
 ;
"RTN","SDCLAV0",53,0)
SETUTL ;SD*509 set Utility for null DFN, corrupt node will be deleted in SDCLAV1
"RTN","SDCLAV0",54,0)
 S (SDN1,SDN2,SDN3)="UNKNOWN",M1=0
"RTN","SDCLAV0",55,0)
 S ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_"^"_SDC_"^"_SDAP1
"RTN","SDCLAV0",56,0)
 Q
"RTN","SDCLAV0",57,0)
 ;
"VER")
8.0^22.2
"BLD",10373,6)
^580
**END**
**END**

