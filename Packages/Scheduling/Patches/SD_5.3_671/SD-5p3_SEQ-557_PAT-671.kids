Released SD*5.3*671 SEQ #557
Extracted from mail message
**KIDS**:SD*5.3*671^

**INSTALL NAME**
SD*5.3*671
"BLD",10348,0)
SD*5.3*671^SCHEDULING^0^3171107^y
"BLD",10348,4,0)
^9.64PA^409.85^1
"BLD",10348,4,409.85,0)
409.85
"BLD",10348,4,409.85,222)
y^n^f^^^^n
"BLD",10348,4,"B",409.85,409.85)

"BLD",10348,6)
11^
"BLD",10348,6.3)
25
"BLD",10348,"ABPKG")
n
"BLD",10348,"INIT")
POST^SDEC671
"BLD",10348,"KRN",0)
^9.67PA^779.2^20
"BLD",10348,"KRN",.4,0)
.4
"BLD",10348,"KRN",.401,0)
.401
"BLD",10348,"KRN",.402,0)
.402
"BLD",10348,"KRN",.403,0)
.403
"BLD",10348,"KRN",.5,0)
.5
"BLD",10348,"KRN",.84,0)
.84
"BLD",10348,"KRN",3.6,0)
3.6
"BLD",10348,"KRN",3.8,0)
3.8
"BLD",10348,"KRN",9.2,0)
9.2
"BLD",10348,"KRN",9.8,0)
9.8
"BLD",10348,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",10348,"KRN",9.8,"NM",1,0)
SDECAR^^0^B90430673
"BLD",10348,"KRN",9.8,"NM",2,0)
SDECAR2^^0^B191968590
"BLD",10348,"KRN",9.8,"NM",3,0)
SDECHL7^^0^B3330551
"BLD",10348,"KRN",9.8,"NM",4,0)
SDHL7^^0^B103204707
"BLD",10348,"KRN",9.8,"NM",5,0)
SDHL7BLD^^0^B15632226
"BLD",10348,"KRN",9.8,"NM",6,0)
SDEC07^^0^B187944035
"BLD",10348,"KRN",9.8,"NM",7,0)
SDECELG^^0^B3245996
"BLD",10348,"KRN",9.8,"NM",8,0)
SDECEPT^^0^B129602604
"BLD",10348,"KRN",9.8,"NM",9,0)
SDEC55A^^0^B80956414
"BLD",10348,"KRN",9.8,"NM",10,0)
SDM2^^0^B24069088
"BLD",10348,"KRN",9.8,"NM",11,0)
SDECU2^^0^B12464546
"BLD",10348,"KRN",9.8,"NM",12,0)
SDEC25^^0^B115273682
"BLD",10348,"KRN",9.8,"NM","B","SDEC07",6)

"BLD",10348,"KRN",9.8,"NM","B","SDEC25",12)

"BLD",10348,"KRN",9.8,"NM","B","SDEC55A",9)

"BLD",10348,"KRN",9.8,"NM","B","SDECAR",1)

"BLD",10348,"KRN",9.8,"NM","B","SDECAR2",2)

"BLD",10348,"KRN",9.8,"NM","B","SDECELG",7)

"BLD",10348,"KRN",9.8,"NM","B","SDECEPT",8)

"BLD",10348,"KRN",9.8,"NM","B","SDECHL7",3)

"BLD",10348,"KRN",9.8,"NM","B","SDECU2",11)

"BLD",10348,"KRN",9.8,"NM","B","SDHL7",4)

"BLD",10348,"KRN",9.8,"NM","B","SDHL7BLD",5)

"BLD",10348,"KRN",9.8,"NM","B","SDM2",10)

"BLD",10348,"KRN",19,0)
19
"BLD",10348,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",10348,"KRN",19,"NM",1,0)
SDECRPC^^0
"BLD",10348,"KRN",19,"NM","B","SDECRPC",1)

"BLD",10348,"KRN",19.1,0)
19.1
"BLD",10348,"KRN",101,0)
101
"BLD",10348,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",10348,"KRN",101,"NM",1,0)
SD RECEIVE OR^^0
"BLD",10348,"KRN",101,"NM",2,0)
SD EVSEND OR^^0
"BLD",10348,"KRN",101,"NM","B","SD EVSEND OR",2)

"BLD",10348,"KRN",101,"NM","B","SD RECEIVE OR",1)

"BLD",10348,"KRN",409.61,0)
409.61
"BLD",10348,"KRN",771,0)
771
"BLD",10348,"KRN",779.2,0)
779.2
"BLD",10348,"KRN",870,0)
870
"BLD",10348,"KRN",8989.51,0)
8989.51
"BLD",10348,"KRN",8989.52,0)
8989.52
"BLD",10348,"KRN",8994,0)
8994
"BLD",10348,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",10348,"KRN",8994,"NM",1,0)
SDEC GETPRER^^0
"BLD",10348,"KRN",8994,"NM",2,0)
SDEC ELIG RETURN^^0
"BLD",10348,"KRN",8994,"NM","B","SDEC ELIG RETURN",2)

"BLD",10348,"KRN",8994,"NM","B","SDEC GETPRER",1)

"BLD",10348,"KRN","B",.4,.4)

"BLD",10348,"KRN","B",.401,.401)

"BLD",10348,"KRN","B",.402,.402)

"BLD",10348,"KRN","B",.403,.403)

"BLD",10348,"KRN","B",.5,.5)

"BLD",10348,"KRN","B",.84,.84)

"BLD",10348,"KRN","B",3.6,3.6)

"BLD",10348,"KRN","B",3.8,3.8)

"BLD",10348,"KRN","B",9.2,9.2)

"BLD",10348,"KRN","B",9.8,9.8)

"BLD",10348,"KRN","B",19,19)

"BLD",10348,"KRN","B",19.1,19.1)

"BLD",10348,"KRN","B",101,101)

"BLD",10348,"KRN","B",409.61,409.61)

"BLD",10348,"KRN","B",771,771)

"BLD",10348,"KRN","B",779.2,779.2)

"BLD",10348,"KRN","B",870,870)

"BLD",10348,"KRN","B",8989.51,8989.51)

"BLD",10348,"KRN","B",8989.52,8989.52)

"BLD",10348,"KRN","B",8994,8994)

"BLD",10348,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",10348,"QUES",0)
^9.62^^
"BLD",10348,"REQB",0)
^9.611^1^1
"BLD",10348,"REQB",1,0)
SD*5.3*669^1
"BLD",10348,"REQB","B","SD*5.3*669",1)

"FIA",409.85)
SDEC APPT REQUEST
"FIA",409.85,0)
^SDEC(409.85,
"FIA",409.85,0,0)
409.85P
"FIA",409.85,0,1)
y^n^f^^^^n
"FIA",409.85,0,10)

"FIA",409.85,0,11)

"FIA",409.85,0,"RLRO")

"FIA",409.85,0,"VR")
5.3^SD
"FIA",409.85,409.85)
0
"FIA",409.85,409.851)
0
"FIA",409.85,409.852)
0
"FIA",409.85,409.8544)
0
"FIA",409.85,409.8545)
0
"FIA",409.85,409.8548)
0
"INIT")
POST^SDEC671
"IX",409.85,409.85,"AC",0)
409.85^AC^Index by CREATE DATE and ORIGINATING USER^R^^R^IR^I^409.85^^^^^S
"IX",409.85,409.85,"AC",.1,0)
^^2^2^3160607
"IX",409.85,409.85,"AC",.1,1,0)
This cross reference is used to sort by CREATE DATE and
"IX",409.85,409.85,"AC",.1,2,0)
ORIGINATING USER.
"IX",409.85,409.85,"AC",1)
S ^SDEC(409.85,"AC",X(1),X(2),DA)=""
"IX",409.85,409.85,"AC",2)
K ^SDEC(409.85,"AC",X(1),X(2),DA)
"IX",409.85,409.85,"AC",2.5)
K ^SDEC(409.85,"AC")
"IX",409.85,409.85,"AC",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"AC",11.1,1,0)
1^F^409.85^9.5^^1^F
"IX",409.85,409.85,"AC",11.1,2,0)
2^F^409.85^9^^2^F
"IX",409.85,409.85,"AD",0)
409.85^AD^Sort by DATE ENTERED and ENTERED BY USER of PATIENT CONTACTS^R^^R^IR^W^409.8544^^^^^S
"IX",409.85,409.85,"AD",.1,0)
^^3^3^3160607
"IX",409.85,409.85,"AD",.1,1,0)
This cross reference sorts the whole SDEC APPT REQUEST file by the
"IX",409.85,409.85,"AD",.1,2,0)
DATE ENTERED and ENTERED BY USER of the PATIENT CONTACTS multiple
"IX",409.85,409.85,"AD",.1,3,0)
field #44.
"IX",409.85,409.85,"AD",1)
S ^SDEC(409.85,"AD",X(1),X(2),DA(1),DA)=""
"IX",409.85,409.85,"AD",2)
K ^SDEC(409.85,"AD",X(1),X(2),DA(1),DA)
"IX",409.85,409.85,"AD",2.5)
K ^SDEC(409.85,"AD")
"IX",409.85,409.85,"AD",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"AD",11.1,1,0)
1^F^409.8544^.01^^1^F
"IX",409.85,409.85,"AD",11.1,2,0)
2^F^409.8544^2^^2^F
"IX",409.85,409.85,"E",0)
409.85^E^Index by CURRENT STATUS and CREATE DATE.^R^^R^IR^I^409.85^^^^^S
"IX",409.85,409.85,"E",.1,0)
^^1^1^3160506
"IX",409.85,409.85,"E",.1,1,0)
This cross reference is used to sort by CURRENT STATUS and CREATE DATE.
"IX",409.85,409.85,"E",1)
S ^SDEC(409.85,"E",X(1),X(2),DA)=""
"IX",409.85,409.85,"E",2)
K ^SDEC(409.85,"E",X(1),X(2),DA)
"IX",409.85,409.85,"E",2.5)
K ^SDEC(409.85,"E")
"IX",409.85,409.85,"E",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"E",11.1,1,0)
1^F^409.85^23^^1^F
"IX",409.85,409.85,"E",11.1,2,0)
2^F^409.85^1^^2^F
"IX",409.85,409.85,"GC",0)
409.85^GC^SORT BY CLINIC AND ORIGINATING DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GC",.1,0)
^^2^2^3170510
"IX",409.85,409.85,"GC",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ SPECIFIC 
"IX",409.85,409.85,"GC",.1,2,0)
CLINIC field (#8) and the CREATE DATE field (#1).
"IX",409.85,409.85,"GC",1)
S ^SDEC(409.85,"GC",X(1),X(2),DA)=""
"IX",409.85,409.85,"GC",2)
K ^SDEC(409.85,"GC",X(1),X(2),DA)
"IX",409.85,409.85,"GC",2.5)
K ^SDEC(409.85,"GC")
"IX",409.85,409.85,"GC",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"GC",11.1,1,0)
1^F^409.85^8^^1^F
"IX",409.85,409.85,"GC",11.1,2,0)
2^F^409.85^1^^2^F
"IX",409.85,409.85,"GCC",0)
409.85^GCC^SORT BY CLINIC AND CID/PREFERRED DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GCC",.1,0)
^^2^2^3170510
"IX",409.85,409.85,"GCC",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ SPECIFIC 
"IX",409.85,409.85,"GCC",.1,2,0)
CLINIC field (#8) and the CID PREFERRED DATE OF APPT field (#22).
"IX",409.85,409.85,"GCC",1)
S ^SDEC(409.85,"GCC",X(1),X(2),DA)=""
"IX",409.85,409.85,"GCC",2)
K ^SDEC(409.85,"GCC",X(1),X(2),DA)
"IX",409.85,409.85,"GCC",2.5)
K ^SDEC(409.85,"GCC")
"IX",409.85,409.85,"GCC",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"GCC",11.1,1,0)
1^F^409.85^8^^1^F
"IX",409.85,409.85,"GCC",11.1,2,0)
2^F^409.85^22^^2^F
"IX",409.85,409.85,"GS",0)
409.85^GS^SORT BY REQ SERVICE/SPECIALTY ID AND ORIGINATING DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GS",.1,0)
^^2^2^3170510
"IX",409.85,409.85,"GS",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ 
"IX",409.85,409.85,"GS",.1,2,0)
SERVICE/SPECIALTY field (#8.5) and the CREATE DATE field (#1).
"IX",409.85,409.85,"GS",1)
S ^SDEC(409.85,"GS",X(1),X(2),DA)=""
"IX",409.85,409.85,"GS",2)
K ^SDEC(409.85,"GS",X(1),X(2),DA)
"IX",409.85,409.85,"GS",2.5)
K ^SDEC(409.85,"GS")
"IX",409.85,409.85,"GS",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"GS",11.1,1,0)
1^F^409.85^8.5^^1^F
"IX",409.85,409.85,"GS",11.1,2,0)
2^F^409.85^1^^2^F
"IX",409.85,409.85,"GSA",0)
409.85^GSA^SORT BY REQ SERVICE/SPECIALTY, SVC CONNECTED, AND CREATE DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GSA",.1,0)
^^5^5^3170510
"IX",409.85,409.85,"GSA",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ 
"IX",409.85,409.85,"GSA",.1,2,0)
SERVICE/SPECIALTY field (#8.5), SERVICE CONNECTED, and the CREATE DATE 
"IX",409.85,409.85,"GSA",.1,3,0)
field (#1).
"IX",409.85,409.85,"GSA",.1,4,0)
SERVICE CONNECTED is the SERVICE CONNECTED? field (#.301) in the PATIENT 
"IX",409.85,409.85,"GSA",.1,5,0)
file (#2).
"IX",409.85,409.85,"GSA",1)
S ^SDEC(409.85,"GSA",X(1),X(2),X(3),DA)=""
"IX",409.85,409.85,"GSA",2)
K ^SDEC(409.85,"GSA",X(1),X(2),X(3),DA)
"IX",409.85,409.85,"GSA",2.5)
K ^SDEC(409.85,"GSA")
"IX",409.85,409.85,"GSA",11.1,0)
^.114IA^3^3
"IX",409.85,409.85,"GSA",11.1,1,0)
1^F^409.85^8.5^^1^F
"IX",409.85,409.85,"GSA",11.1,2,0)
2^C^^^^2^F
"IX",409.85,409.85,"GSA",11.1,2,1.5)
N DFN S DFN=$P($G(^SDEC(409.85,DA,0)),U,1) S X=$P($G(^DPT(+DFN,.3)),U,1) S:X="" X=0
"IX",409.85,409.85,"GSA",11.1,3,0)
3^F^409.85^1^^3^F
"IX",409.85,409.85,"GSB",0)
409.85^GSB^SORT BY REQ SERVICE/SPECIALTY, SVC CONNECTED PRIORITY, AND CREATE DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GSB",.1,0)
^^3^3^3170510
"IX",409.85,409.85,"GSB",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ 
"IX",409.85,409.85,"GSB",.1,2,0)
SERVICE/SPECIALTY field (#8.5), SERVICE CONNECTED PRIORITY field (#15), 
"IX",409.85,409.85,"GSB",.1,3,0)
and the CREATE DATE field (#1).
"IX",409.85,409.85,"GSB",1)
S ^SDEC(409.85,"GSB",X(1),X(2),X(3),DA)=""
"IX",409.85,409.85,"GSB",2)
K ^SDEC(409.85,"GSB",X(1),X(2),X(3),DA)
"IX",409.85,409.85,"GSB",2.5)
K ^SDEC(409.85,"GSB")
"IX",409.85,409.85,"GSB",11.1,0)
^.114IA^3^3
"IX",409.85,409.85,"GSB",11.1,1,0)
1^F^409.85^8.5^^1^F
"IX",409.85,409.85,"GSB",11.1,2,0)
2^F^409.85^15^^2^F
"IX",409.85,409.85,"GSB",11.1,3,0)
3^F^409.85^1^^3^F
"IX",409.85,409.85,"GSC",0)
409.85^GSC^SORT BY REQ SERVICE/SPECIALTY ID AND CID/PREFERRED DATE OF APPT^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GSC",.1,0)
^^3^3^3170510
"IX",409.85,409.85,"GSC",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ 
"IX",409.85,409.85,"GSC",.1,2,0)
SERVICE/SPECIALTY field (#8.5) and the CID/PREFERRED DATE OF APPT field 
"IX",409.85,409.85,"GSC",.1,3,0)
(#22).
"IX",409.85,409.85,"GSC",1)
S ^SDEC(409.85,"GSC",X(1),X(2),DA)=""
"IX",409.85,409.85,"GSC",2)
K ^SDEC(409.85,"GSC",X(1),X(2),DA)
"IX",409.85,409.85,"GSC",2.5)
K ^SDEC(409.85,"GSC")
"IX",409.85,409.85,"GSC",11.1,0)
^.114IA^2^2
"IX",409.85,409.85,"GSC",11.1,1,0)
1^F^409.85^8.5^^1^F
"IX",409.85,409.85,"GSC",11.1,2,0)
2^F^409.85^22^^2^F
"IX",409.85,409.85,"GSP",0)
409.85^GSP^SORT BY REQ SERVICE/SPECIALTY, ENROLLMENT PRIORITY, AND CREATE DATE^R^^R^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GSP",.1,0)
^^7^7^3170510
"IX",409.85,409.85,"GSP",.1,1,0)
This xref is used to sort Appointment Request entries by the REQ 
"IX",409.85,409.85,"GSP",.1,2,0)
SERVICE/SPECIALTY field (#8.5), Patient's ENROLLMENT PRIORITY, and the 
"IX",409.85,409.85,"GSP",.1,3,0)
CREATE DATE field (#1).
"IX",409.85,409.85,"GSP",.1,4,0)
The Patient's ENROLLMENT PRIORITY comes from the ENROLLMENT PRIORITY 
"IX",409.85,409.85,"GSP",.1,5,0)
field (#.07) of the PATIENT ENROLLMENT file (#27.11).
"IX",409.85,409.85,"GSP",.1,6,0)
The CURRENT ENROLLMENT field (#27.01) of the PATIENT file (#2) contains 
"IX",409.85,409.85,"GSP",.1,7,0)
the pointer into the PATIENT ENROLLMENT FILE.
"IX",409.85,409.85,"GSP",1)
S ^SDEC(409.85,"GSP",X(1),X(2),X(3),DA)=""
"IX",409.85,409.85,"GSP",2)
K ^SDEC(409.85,"GSP",X(1),X(2),X(3),DA)
"IX",409.85,409.85,"GSP",2.5)
K ^SDEC(409.85,"GSP")
"IX",409.85,409.85,"GSP",11.1,0)
^.114IA^3^3
"IX",409.85,409.85,"GSP",11.1,1,0)
1^F^409.85^8.5^^1^F
"IX",409.85,409.85,"GSP",11.1,2,0)
2^C^^^^2^F
"IX",409.85,409.85,"GSP",11.1,2,1.5)
N DFN,PCE S DFN=$P($G(^SDEC(409.85,DA,0)),U,1),PCE=$P($G(^DPT(+DFN,"ENR")),U,1),X=+$P($G(^DGEN(27.11,+PCE,0)),U,7)
"IX",409.85,409.85,"GSP",11.1,3,0)
3^F^409.85^1^^3^F
"KRN",19,2921747,-1)
0^1
"KRN",19,2921747,0)
SDECRPC^CLINICAL SCHEDULING PROCEDURE CALLS^^B^^^^^^^^
"KRN",19,2921747,1,0)
^19.06^2^2^3170711^^^^
"KRN",19,2921747,1,1,0)
This option hosts RPCs in the SDEC namespace.  CLINICAL SCHEDULING users 
"KRN",19,2921747,1,2,0)
must have access to this option in order to use CLINICAL SCHEDULING.
"KRN",19,2921747,99.1)
64281,43176
"KRN",19,2921747,"RPC",0)
^19.05P^204^204
"KRN",19,2921747,"RPC",1,0)
SDEC ACCGPTYG
"KRN",19,2921747,"RPC",2,0)
SDEC ACCGROUP
"KRN",19,2921747,"RPC",3,0)
SDEC ACCTYPE
"KRN",19,2921747,"RPC",4,0)
SDEC ADDACCG
"KRN",19,2921747,"RPC",5,0)
SDEC ADDACCTY
"KRN",19,2921747,"RPC",6,0)
SDEC ADDAGI
"KRN",19,2921747,"RPC",7,0)
SDEC ADDRES
"KRN",19,2921747,"RPC",8,0)
SDEC ADDRESU
"KRN",19,2921747,"RPC",9,0)
SDEC ADDRG
"KRN",19,2921747,"RPC",10,0)
SDEC ADDRGI
"KRN",19,2921747,"RPC",11,0)
SDEC APBLKALL
"KRN",19,2921747,"RPC",12,0)
SDEC APBLKOV
"KRN",19,2921747,"RPC",13,0)
SDEC APPADD
"KRN",19,2921747,"RPC",14,0)
SDEC APPDEL
"KRN",19,2921747,"RPC",15,0)
SDEC APPTEVLG
"KRN",19,2921747,"RPC",16,0)
SDEC APPTLETR
"KRN",19,2921747,"RPC",17,0)
SDEC APPTYPES
"KRN",19,2921747,"RPC",18,0)
SDEC AVADD
"KRN",19,2921747,"RPC",19,0)
SDEC AVDEL
"KRN",19,2921747,"RPC",20,0)
SDEC AVDELDT
"KRN",19,2921747,"RPC",21,0)
SDEC CANCKOUT
"KRN",19,2921747,"RPC",22,0)
SDEC CANREAS
"KRN",19,2921747,"RPC",23,0)
SDEC CHECKIN
"KRN",19,2921747,"RPC",24,0)
SDEC CHECKOUT
"KRN",19,2921747,"RPC",25,0)
SDEC CLINALL
"KRN",19,2921747,"RPC",26,0)
SDEC CLINCAN
"KRN",19,2921747,"RPC",27,0)
SDEC CLINDIS
"KRN",19,2921747,"RPC",28,0)
SDEC CLINDISW
"KRN",19,2921747,"RPC",29,0)
SDEC CLINLET
"KRN",19,2921747,"RPC",30,0)
SDEC CLINLETW
"KRN",19,2921747,"RPC",31,0)
SDEC CLINPROV
"KRN",19,2921747,"RPC",32,0)
SDEC CLINSET
"KRN",19,2921747,"RPC",33,0)
SDEC CLINSTOP
"KRN",19,2921747,"RPC",34,0)
SDEC COPYAPPT
"KRN",19,2921747,"RPC",35,0)
SDEC CPCANC
"KRN",19,2921747,"RPC",36,0)
SDEC CPSTAT
"KRN",19,2921747,"RPC",37,0)
SDEC CRSCHED
"KRN",19,2921747,"RPC",38,0)
SDEC CSLOTSCH
"KRN",19,2921747,"RPC",39,0)
SDEC CURFACG
"KRN",19,2921747,"RPC",40,0)
SDEC CVARAPPT
"KRN",19,2921747,"RPC",41,0)
SDEC DELAG
"KRN",19,2921747,"RPC",42,0)
SDEC DELAGI
"KRN",19,2921747,"RPC",43,0)
SDEC DELRESGP
"KRN",19,2921747,"RPC",44,0)
SDEC DELRGI
"KRN",19,2921747,"RPC",45,0)
SDEC DELRU
"KRN",19,2921747,"RPC",46,0)
SDEC EDITAPPT
"KRN",19,2921747,"RPC",47,0)
SDEC EHRPT
"KRN",19,2921747,"RPC",48,0)
SDEC GETFAC
"KRN",19,2921747,"RPC",49,0)
SDEC GETREGA
"KRN",19,2921747,"RPC",50,0)
SDEC HLTHSUMM
"KRN",19,2921747,"RPC",51,0)
SDEC HOLIDAY
"KRN",19,2921747,"RPC",52,0)
SDEC HOSPLOC
"KRN",19,2921747,"RPC",53,0)
SDEC IMHERE
"KRN",19,2921747,"RPC",54,0)
SDEC NEWPERS
"KRN",19,2921747,"RPC",55,0)
SDEC NOSHOPAT
"KRN",19,2921747,"RPC",56,0)
SDEC NOSHOW
"KRN",19,2921747,"RPC",57,0)
SDEC OVBOOK
"KRN",19,2921747,"RPC",58,0)
SDEC PATAPPTD
"KRN",19,2921747,"RPC",59,0)
SDEC PATAPPTH
"KRN",19,2921747,"RPC",60,0)
SDEC PROVALL
"KRN",19,2921747,"RPC",61,0)
SDEC PROVCLIN
"KRN",19,2921747,"RPC",62,0)
SDEC PTLOOKRS
"KRN",19,2921747,"RPC",63,0)
SDEC PWH
"KRN",19,2921747,"RPC",64,0)
SDEC RAISEVNT
"KRN",19,2921747,"RPC",65,0)
SDEC REBKCLIN
"KRN",19,2921747,"RPC",66,0)
SDEC REBKLIST
"KRN",19,2921747,"RPC",67,0)
SDEC REBKNEXT
"KRN",19,2921747,"RPC",68,0)
SDEC REGEVENT
"KRN",19,2921747,"RPC",69,0)
SDEC RESGPUSR
"KRN",19,2921747,"RPC",70,0)
SDEC RESGRPUS
"KRN",19,2921747,"RPC",71,0)
SDEC RESLETRF
"KRN",19,2921747,"RPC",72,0)
SDEC RESLETRS
"KRN",19,2921747,"RPC",73,0)
SDEC RESOURCE
"KRN",19,2921747,"RPC",74,0)
SDEC RESUSER
"KRN",19,2921747,"RPC",75,0)
SDEC SCHUSR
"KRN",19,2921747,"RPC",76,0)
SDEC SEARCHAV
"KRN",19,2921747,"RPC",77,0)
SDEC SETFAC
"KRN",19,2921747,"RPC",78,0)
SDEC SETRBOOK
"KRN",19,2921747,"RPC",79,0)
SDEC SPACEBAR
"KRN",19,2921747,"RPC",80,0)
SDEC SUSRINFO
"KRN",19,2921747,"RPC",81,0)
SDEC SVSPALL
"KRN",19,2921747,"RPC",82,0)
SDEC SYSSTAT
"KRN",19,2921747,"RPC",83,0)
SDEC TPBLKOV
"KRN",19,2921747,"RPC",84,0)
SDEC UNDOCANA
"KRN",19,2921747,"RPC",85,0)
SDEC UNREGEV
"KRN",19,2921747,"RPC",86,0)
SDEC WAITLIST
"KRN",19,2921747,"RPC",87,0)
SDEC WLCLOSE
"KRN",19,2921747,"RPC",88,0)
SDEC WLGET
"KRN",19,2921747,"RPC",89,0)
SDEC WLSET
"KRN",19,2921747,"RPC",90,0)
SDEC PREFGET
"KRN",19,2921747,"RPC",91,0)
SDEC PREFGETV
"KRN",19,2921747,"RPC",92,0)
SDEC PREFSET
"KRN",19,2921747,"RPC",93,0)
SDEC FAPPTGET
"KRN",19,2921747,"RPC",94,0)
SDEC RECAPGET
"KRN",19,2921747,"RPC",95,0)
SDEC RECDSET
"KRN",19,2921747,"RPC",96,0)
SDEC RECGET
"KRN",19,2921747,"RPC",97,0)
SDEC RECPRGET
"KRN",19,2921747,"RPC",98,0)
SDEC RECSET
"KRN",19,2921747,"RPC",99,0)
SDEC REQGET
"KRN",19,2921747,"RPC",100,0)
SDEC PCSTGET
"KRN",19,2921747,"RPC",101,0)
SDEC PCST2GET
"KRN",19,2921747,"RPC",102,0)
SDEC PCSGET
"KRN",19,2921747,"RPC",103,0)
SDEC PTSET
"KRN",19,2921747,"RPC",104,0)
SDEC PTINQ
"KRN",19,2921747,"RPC",105,0)
SDEC SUMMGET
"KRN",19,2921747,"RPC",106,0)
SDEC SUMMAGET
"KRN",19,2921747,"RPC",107,0)
SDEC APPIDGET
"KRN",19,2921747,"RPC",108,0)
SDEC FACLIST
"KRN",19,2921747,"RPC",109,0)
SDEC CGET
"KRN",19,2921747,"RPC",110,0)
SDEC ETHGET
"KRN",19,2921747,"RPC",111,0)
SDEC ETHCMGET
"KRN",19,2921747,"RPC",112,0)
SDEC RACEGET
"KRN",19,2921747,"RPC",113,0)
SDEC REP1GET
"KRN",19,2921747,"RPC",114,0)
SDEC WLPCSET
"KRN",19,2921747,"RPC",115,0)
SDEC APPSDGET
"KRN",19,2921747,"RPC",116,0)
SDEC WLOPEN
"KRN",19,2921747,"RPC",117,0)
SDEC ARCLOSE
"KRN",19,2921747,"RPC",118,0)
SDEC ARDGET
"KRN",19,2921747,"RPC",119,0)
SDEC ARGET
"KRN",19,2921747,"RPC",120,0)
SDEC ARMRTGET
"KRN",19,2921747,"RPC",121,0)
SDEC ARMRTSET
"KRN",19,2921747,"RPC",122,0)
SDEC AROPEN
"KRN",19,2921747,"RPC",123,0)
SDEC ARPCSET
"KRN",19,2921747,"RPC",124,0)
SDEC ARSET
"KRN",19,2921747,"RPC",125,0)
SDEC HIDE
"KRN",19,2921747,"RPC",126,0)
SDEC PRIV
"KRN",19,2921747,"RPC",127,0)
SDEC WLHIDE
"KRN",19,2921747,"RPC",128,0)
SDECAR ARAPPT
"KRN",19,2921747,"RPC",129,0)
SDECAR ARMRTC
"KRN",19,2921747,"RPC",130,0)
SDECDEV DEVICE
"KRN",19,2921747,"RPC",131,0)
SDECDIS DISABIL
"KRN",19,2921747,"RPC",132,0)
SDECIDX GETREC
"KRN",19,2921747,"RPC",133,0)
SDECIDX RECCNT
"KRN",19,2921747,"RPC",134,0)
SDECLK LOCK
"KRN",19,2921747,"RPC",135,0)
SDECLK UNLOCK
"KRN",19,2921747,"RPC",136,0)
SDECLOC PRIVLOC
"KRN",19,2921747,"RPC",137,0)
SDECLOC UPDPRIV
"KRN",19,2921747,"RPC",138,0)
SDECRMG RECCNT
"KRN",19,2921747,"RPC",139,0)
SDECRMG RMG
"KRN",19,2921747,"RPC",140,0)
SDECRMG2 URGENCY
"KRN",19,2921747,"RPC",141,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,2921747,"RPC",142,0)
DG CHK BS5 XREF ARRAY
"KRN",19,2921747,"RPC",143,0)
ORPRF HASFLG
"KRN",19,2921747,"RPC",144,0)
ORPRF GETFLG
"KRN",19,2921747,"RPC",145,0)
ORWPT DIEDON
"KRN",19,2921747,"RPC",146,0)
ORWPT ID INFO
"KRN",19,2921747,"RPC",147,0)
ORWPT LAST5
"KRN",19,2921747,"RPC",148,0)
ORWPT LAST5 RPL
"KRN",19,2921747,"RPC",149,0)
ORWU USERINFO
"KRN",19,2921747,"RPC",150,0)
SD VSE FILTER RPC
"KRN",19,2921747,"RPC",151,0)
SD VSE REPORT RPC
"KRN",19,2921747,"RPC",152,0)
SDEC APPSLOTS
"KRN",19,2921747,"RPC",154,0)
SDEC NETLOC
"KRN",19,2921747,"RPC",155,0)
SDEC NOAVAIL
"KRN",19,2921747,"RPC",156,0)
SDECAPP GETYPE
"KRN",19,2921747,"RPC",157,0)
SDECAR ARMULT
"KRN",19,2921747,"RPC",158,0)
SDECAR AUDITGET
"KRN",19,2921747,"RPC",159,0)
SDECCAP CAN
"KRN",19,2921747,"RPC",160,0)
SDECCAP GET
"KRN",19,2921747,"RPC",161,0)
SDECCAP SET
"KRN",19,2921747,"RPC",162,0)
SDECWL AUDITGET
"KRN",19,2921747,"RPC",163,0)
ROR LIST STATES
"KRN",19,2921747,"RPC",164,0)
XUS SIGNON SETUP
"KRN",19,2921747,"RPC",165,0)
XUS GET VISITOR
"KRN",19,2921747,"RPC",166,0)
XUS SET VISITOR
"KRN",19,2921747,"RPC",167,0)
XUS AV CODE
"KRN",19,2921747,"RPC",168,0)
SDEC01 CLINICS
"KRN",19,2921747,"RPC",169,0)
SDEC57 OBM
"KRN",19,2921747,"RPC",170,0)
SDECAR3 AREDIT
"KRN",19,2921747,"RPC",171,0)
SDECDEM MARITAL
"KRN",19,2921747,"RPC",172,0)
SDECDEM RELIGION
"KRN",19,2921747,"RPC",173,0)
SDECDEM ZIPLINK
"KRN",19,2921747,"RPC",174,0)
SDECDEV DEV
"KRN",19,2921747,"RPC",175,0)
SDECDEV PRINT
"KRN",19,2921747,"RPC",176,0)
SDECRMGP GETRMGUP
"KRN",19,2921747,"RPC",177,0)
SDECRMGP PUTRMGUP
"KRN",19,2921747,"RPC",178,0)
SDECU4 GETFONT
"KRN",19,2921747,"RPC",179,0)
SDECU4 PUTFONT
"KRN",19,2921747,"RPC",180,0)
ORWU CLINLOC
"KRN",19,2921747,"RPC",181,0)
XUS GET USER INFO
"KRN",19,2921747,"RPC",182,0)
XUS GET CCOW TOKEN
"KRN",19,2921747,"RPC",183,0)
ORWPT SHARE
"KRN",19,2921747,"RPC",184,0)
ORWPT TOP
"KRN",19,2921747,"RPC",185,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,2921747,"RPC",186,0)
SDEC EP CLASSIFICATION
"KRN",19,2921747,"RPC",187,0)
SDEC EP CPT
"KRN",19,2921747,"RPC",188,0)
SDEC EP DEMOGRAPHICS
"KRN",19,2921747,"RPC",189,0)
SDEC EP DIAGNOSIS
"KRN",19,2921747,"RPC",190,0)
SDEC EP EVENT LOG
"KRN",19,2921747,"RPC",191,0)
SDEC EP PROVIDER
"KRN",19,2921747,"RPC",192,0)
SDEC EP PT INFO
"KRN",19,2921747,"RPC",193,0)
SDEC EP STOP CODE
"KRN",19,2921747,"RPC",194,0)
SDEC EP WAIT TIME
"KRN",19,2921747,"RPC",195,0)
SDEC APPT STATUS
"KRN",19,2921747,"RPC",196,0)
SDEC ELIGIBILITY
"KRN",19,2921747,"RPC",197,0)
SDEC CONTACT DISPLAY
"KRN",19,2921747,"RPC",198,0)
SDEC CONTACT MULTI-DISPLAY
"KRN",19,2921747,"RPC",199,0)
SDEC CONTACT NEW
"KRN",19,2921747,"RPC",200,0)
SDEC CONTACT SEQUENCE
"KRN",19,2921747,"RPC",201,0)
SDEC CONTACT STOP CODE
"KRN",19,2921747,"RPC",202,0)
SDEC CONTACT UPDATE
"KRN",19,2921747,"RPC",203,0)
SDEC GETPRER
"KRN",19,2921747,"RPC",204,0)
SDEC ELIG RETURN
"KRN",19,2921747,"U")
CLINICAL SCHEDULING PROCEDURE 
"KRN",101,8116,-1)
0^1
"KRN",101,8116,0)
SD RECEIVE OR^Receive Appointment Request from OE/RR^^A^^^^^^^^
"KRN",101,8116,1,0)
^^1^1^3170509^
"KRN",101,8116,1,1,0)
This protocol receives return to clinic appointment requests from OE/RR.
"KRN",101,8116,20)
D EN^SDHL7(.XQORMSG)
"KRN",101,8116,99)
64582,63764
"KRN",101,8117,-1)
0^2
"KRN",101,8117,0)
SD EVSEND OR^Scheduled Appointment Send to OR^^X^^^^^^^^
"KRN",101,8117,1,0)
^^3^3^3170509^
"KRN",101,8117,1,1,0)
This protocol sends scheduled appointment information to OE/RR. 
"KRN",101,8117,1,2,0)
Specifically, appointments scheduled due to the receipt of an appointment 
"KRN",101,8117,1,3,0)
scheduling request received from OE/RR.
"KRN",101,8117,10,0)
^101.01PA^7^7
"KRN",101,8117,99)
64582,63764
"KRN",8994,4208,-1)
0^1
"KRN",8994,4208,0)
SDEC GETPRER^GETPRER^SDECAR2^1
"KRN",8994,4208,1,0)
^^2^2^3170701^
"KRN",8994,4208,1,1,0)
RETURNS ALL ENTRIES IN THE PREREQUISITE MULTIPLE FROM THE SDEC APPT 
"KRN",8994,4208,1,2,0)
REQUEST FILE
"KRN",8994,4208,2,0)
^8994.02A^1^1
"KRN",8994,4208,2,1,0)
ARIEN^1^^1^1
"KRN",8994,4208,2,1,1,0)
^^1^1^3170701^
"KRN",8994,4208,2,1,1,1,0)
SDEC APPT REQUEST IEN
"KRN",8994,4208,2,"B","ARIEN",1)

"KRN",8994,4208,2,"PARAMSEQ",1,1)

"KRN",8994,4208,3,0)
^^2^2^3170701^
"KRN",8994,4208,3,1,0)
DELIMITED STRING (^) OF ALL ENTRIES IN THE PREREQUISITE MULTIPLE IN THE 
"KRN",8994,4208,3,2,0)
SDEC APPT REQUEST FILE FOR THE GIVEN IEN
"KRN",8994,4209,-1)
0^2
"KRN",8994,4209,0)
SDEC ELIG RETURN^ELIG^SDECELG^1^R
"KRN",8994,4209,1,0)
^^2^2^3170711^
"KRN",8994,4209,1,1,0)
Returns eligibility information from ELIGIBILITY (#8) and MAS ELIGIBILITY
"KRN",8994,4209,1,2,0)
(#8.1) file, for the passed in IEN.
"KRN",8994,4209,2,0)
^8994.02A^3^3
"KRN",8994,4209,2,1,0)
PTIEN^1^14^1^1
"KRN",8994,4209,2,1,1,0)
^^1^1^3170711^
"KRN",8994,4209,2,1,1,1,0)
Patient IEN from the Patient (#2) file.
"KRN",8994,4209,2,2,0)
CLIEN^1^14^1^2
"KRN",8994,4209,2,2,1,0)
^^1^1^3170711^
"KRN",8994,4209,2,2,1,1,0)
Clinic IEN from the Hospital Location (#44) file.
"KRN",8994,4209,2,3,0)
ADT^1^14^1^3
"KRN",8994,4209,2,3,1,0)
^^1^1^3170711^
"KRN",8994,4209,2,3,1,1,0)
Appointment date/time from Hospital Loction (#44).
"KRN",8994,4209,2,"B","ADT",3)

"KRN",8994,4209,2,"B","CLIEN",2)

"KRN",8994,4209,2,"B","PTIEN",1)

"KRN",8994,4209,2,"PARAMSEQ",1,1)

"KRN",8994,4209,2,"PARAMSEQ",2,2)

"KRN",8994,4209,2,"PARAMSEQ",3,3)

"KRN",8994,4209,3,0)
^^2^2^3170711^
"KRN",8994,4209,3,1,0)
Eligibility Code information from Eligibility Code (#8) and MAS
"KRN",8994,4209,3,2,0)
Eligibility Code (8.1) file.
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
671^3171107^520736675
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","SDEC07")
0^6^B187944035^B186068449
"RTN","SDEC07",1,0)
SDEC07 ;ALB/SAT - VISTA SCHEDULING RPCS ;10:29 AM  26 Jun 2017
"RTN","SDEC07",2,0)
 ;;5.3;Scheduling;**627,642,651,658,665,669,671**;Aug 13, 1993;Build 25
"RTN","SDEC07",3,0)
 ;
"RTN","SDEC07",4,0)
 ;Reference is made to ICR #4837
"RTN","SDEC07",5,0)
 Q
"RTN","SDEC07",6,0)
 ;
"RTN","SDEC07",7,0)
APPADD(SDECY,SDECSTART,SDECEND,DFN,SDECRES,SDECLEN,SDECNOTE,SDECATID,SDECCR,SDMRTC,SDDDT,SDREQBY,SDLAB,PROVIEN,SDID,SDAPTYP,SDSVCP,SDSVCPR,SDCL,SDEKG,SDXRAY,APPTYPE,EESTAT,OVB,SDPARENT,SDEL) ;ADD NEW APPOINTMENT
"RTN","SDEC07",8,0)
 ;
"RTN","SDEC07",9,0)
 N SDAPPTYP
"RTN","SDEC07",10,0)
 N SDECERR,SDECIEN,SDECDEP,SDECI,SDECJ,SDECAPPTI,SDECDJ,SDECRESD,SDECRNOD,SDECC,SDECERR,SDECWKIN
"RTN","SDEC07",11,0)
 N SDECNOEV,SDECDEV,SDECDERR,SDECTMP,SAVESTRT,SDAREQ0
"RTN","SDEC07",12,0)
 N %DT,X,Y,DGQUIET,OBM,RET
"RTN","SDEC07",13,0)
 S SDECNOEV=1 ;Don't execute SDEC ADD APPOINTMENT protocol
"RTN","SDEC07",14,0)
 K ^TMP("SDEC07",$J)
"RTN","SDEC07",15,0)
 S SDECERR=0
"RTN","SDEC07",16,0)
 S SDECI=0
"RTN","SDEC07",17,0)
 S SDECY="^TMP(""SDEC07"","_$J_")"
"RTN","SDEC07",18,0)
 S ^TMP("SDEC07",$J,SDECI)="I00020APPOINTMENTID^T00020ERRORID"_$C(30)
"RTN","SDEC07",19,0)
 S SDECI=SDECI+1
"RTN","SDEC07",20,0)
 ;Check input data for errors
"RTN","SDEC07",21,0)
 S SDAREQ0=$G(^SDEC(409.85,+$P(SDAPTYP,"|",2),0))
"RTN","SDEC07",22,0)
 I $P(SDAREQ0,U,5)="RTC",$P(SDAREQ0,U,17)="C" D ERR(SDECI+1,"SDEC07 Error: This RTC request has been closed.") Q
"RTN","SDEC07",23,0)
 S SAVESTRT=SDECSTART         ;MGH save date/time for consult request
"RTN","SDEC07",24,0)
 S:SDECSTART["@0000" SDECSTART=$P(SDECSTART,"@")
"RTN","SDEC07",25,0)
 S:SDECEND["@0000" SDECEND=$P(SDECEND,"@")
"RTN","SDEC07",26,0)
 S %DT="RXT",X=SDECSTART D ^%DT S SDECSTART=Y
"RTN","SDEC07",27,0)
 I SDECSTART=-1 D ERR(SDECI+1,"SDEC07 Error: Invalid Start Time") Q
"RTN","SDEC07",28,0)
 S %DT="RXT",X=SDECEND D ^%DT S SDECEND=Y
"RTN","SDEC07",29,0)
 I SDECEND=-1 D ERR(SDECI+1,"SDEC07 Error: Invalid End Time") Q
"RTN","SDEC07",30,0)
 I $L(SDECEND,".")=1 D ERR(SDECI+1,"SDEC07 Error: Invalid End Time") Q
"RTN","SDEC07",31,0)
 I SDECSTART>SDECEND S SDECTMP=SDECEND,SDECEND=SDECSTART,SDECSTART=SDECTMP
"RTN","SDEC07",32,0)
 S DFN=$G(DFN)
"RTN","SDEC07",33,0)
 I DFN="" D ERR(SDECI+1,"SDEC07: Patient ID required.") Q
"RTN","SDEC07",34,0)
 I '$D(^DPT(DFN,0)) D ERR(SDECI+1,"SDEC07 Error: Invalid Patient ID") Q
"RTN","SDEC07",35,0)
 L +^DPT(DFN):3 I '$T D ERR(SDECI+1,"Patient is being edited. Try again later.") Q   ;alb/sat 665
"RTN","SDEC07",36,0)
 ;Validate Resource
"RTN","SDEC07",37,0)
 S SDECERR=0 K SDECRESD
"RTN","SDEC07",38,0)
 S SDECRES=$G(SDECRES)
"RTN","SDEC07",39,0)
 I +SDECRES,'$D(^SDEC(409.831,SDECRES,0)) D ERR(SDECI+1,"SDEC07 Error: Invalid Resource ID") Q
"RTN","SDEC07",40,0)
 I '+SDECRES,'$D(^SDEC(409.831,"B",SDECRES)) D ERR(SDECI+1,"SDEC07 Error: Invalid Resource ID") Q
"RTN","SDEC07",41,0)
 S SDECRESD=$S(+SDECRES:+SDECRES,1:$O(^SDEC(409.831,"B",SDECRES,0)))
"RTN","SDEC07",42,0)
 S SDECRNOD=$G(^SDEC(409.831,SDECRESD,0))
"RTN","SDEC07",43,0)
 I SDECRNOD="" D ERR(SDECI+1,"SDEC07 Error: Unable to add appointment -- invalid Resource entry.") Q
"RTN","SDEC07",44,0)
 S SDECWKIN=0
"RTN","SDEC07",45,0)
 S SDECATID=$G(SDECATID)
"RTN","SDEC07",46,0)
 I SDECATID="WALKIN" S SDECWKIN=1
"RTN","SDEC07",47,0)
 I SDECATID'?.N&(SDECATID'="WALKIN") S SDECATID=""
"RTN","SDEC07",48,0)
 ;validate appointment length - if passed in, must be 5-120
"RTN","SDEC07",49,0)
 S SDECLEN=$G(SDECLEN)
"RTN","SDEC07",50,0)
 ;I SDECLEN'="",(+SDECLEN<5)!(SDECLEN>120) D ERR(SDECI+1,"SDEC07 Error: Appointment length must be between 5 - 120.") Q
"RTN","SDEC07",51,0)
 ;validate MTRC flag (optional)
"RTN","SDEC07",52,0)
 S SDMRTC=$$UP^XLFSTR($G(SDMRTC))
"RTN","SDEC07",53,0)
 S SDMRTC=$S(SDMRTC="TRUE":1,1:0)
"RTN","SDEC07",54,0)
 ;validate desired date of appt (optional)
"RTN","SDEC07",55,0)
 S SDDDT=$G(SDDDT)
"RTN","SDEC07",56,0)
 I SDDDT'="" S %DT="" S X=$P(SDDDT,"@",1) D ^%DT S SDDDT=Y I Y=-1 S SDDDT=""
"RTN","SDEC07",57,0)
 I SDDDT="",SDECATID'="WALKIN" S SDDDT=$P(SDECSTART,".",1)
"RTN","SDEC07",58,0)
 ;validate requested by
"RTN","SDEC07",59,0)
 S SDREQBY=$$UP^XLFSTR($G(SDREQBY))
"RTN","SDEC07",60,0)
 I SDREQBY'="" S SDREQBY=$S(SDREQBY="PROVIDER":1,SDREQBY="PATIENT":2,1:0)
"RTN","SDEC07",61,0)
 ;validate lab date/time (optional)
"RTN","SDEC07",62,0)
 S SDLAB=$G(SDLAB)
"RTN","SDEC07",63,0)
 I SDLAB'="" S %DT="T" S X=SDLAB D ^%DT S SDLAB=Y I Y=-1 S SDLAB=""
"RTN","SDEC07",64,0)
 ;validate EKG date/time (optional)
"RTN","SDEC07",65,0)
 S SDEKG=$G(SDEKG)
"RTN","SDEC07",66,0)
 I SDEKG'="" S %DT="T" S X=SDEKG D ^%DT S SDEKG=Y I Y=-1 S SDEKG=""
"RTN","SDEC07",67,0)
 ;validate XRAY date/time (optional)
"RTN","SDEC07",68,0)
 S SDXRAY=$G(SDXRAY)
"RTN","SDEC07",69,0)
 I SDXRAY'="" S %DT="T" S X=SDXRAY D ^%DT S SDXRAY=Y I Y=-1 S SDXRAY=""
"RTN","SDEC07",70,0)
 ;validate provider
"RTN","SDEC07",71,0)
 I '$D(^VA(200,+$G(PROVIEN),0)) S PROVIEN=""
"RTN","SDEC07",72,0)
 S SDID=$G(SDID)
"RTN","SDEC07",73,0)
 ;validate clinic
"RTN","SDEC07",74,0)
 S SDCL=$G(SDCL)
"RTN","SDEC07",75,0)
 I SDCL'="" I '$D(^SC(SDCL,0)) S SDCL=""
"RTN","SDEC07",76,0)
 I SDCL="" S SDCL=$$GET1^DIQ(409.831,SDECRESD_",",.04,"I")   ;clinic ID   ;support for single HOSPITAL LOCATION in SDEC RESOURCE
"RTN","SDEC07",77,0)
 S OVB=+$G(OVB)  ;alb/sat 665
"RTN","SDEC07",78,0)
 I 'OVB S OBM=$$OBM1^SDEC57(SDCL,SDECSTART,SDMRTC,,+SDECWKIN) I OBM'="",+OBM'=1 S SDECAPPTID=0 D ERR(SDECI+1,"OBM"_OBM) Q   ;alb/sat 658 check if overbook ;alb/sat 665 clear SDECAPPTID
"RTN","SDEC07",79,0)
 ;validate appt request type (required)
"RTN","SDEC07",80,0)
 S SDAPTYP=$G(SDAPTYP)
"RTN","SDEC07",81,0)
 I SDAPTYP'="" D
"RTN","SDEC07",82,0)
 .I $P(SDAPTYP,"|",1)="E" I '$D(^SDWL(409.3,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",83,0)
 .I $P(SDAPTYP,"|",1)="R" I '$D(^SD(403.5,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",84,0)
 .I $P(SDAPTYP,"|",1)="C" I '$D(^GMR(123,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""  ;ICR 4837
"RTN","SDEC07",85,0)
 .I $P(SDAPTYP,"|",1)="A" I '$D(^SDEC(409.85,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",86,0)
 .;I SDAPTYP="" D ERR(SDECI+1,"SDEC07 Error: Invalid appointment request type.") Q   ;support for multiple HOSPITAL LOCATIONs are implemented in SDEC RESOURCE
"RTN","SDEC07",87,0)
 I SDCL="" D
"RTN","SDEC07",88,0)
 .S:$P(SDAPTYP,"|",1)="E" SDCL=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",13.2,"I")
"RTN","SDEC07",89,0)
 .S:$P(SDAPTYP,"|",1)="R" SDCL=$$GET1^DIQ(403.5,$P(SDAPTYP,"|",2)_",",4.5,"I")
"RTN","SDEC07",90,0)
 .S:$P(SDAPTYP,"|",1)="C" SDCL=$P($G(^GMR(123,+$P(SDAPTYP,"|",2),0)),U,4)       ;ICR 4837 ICR states 'Zero node read into variable'
"RTN","SDEC07",91,0)
 .S:$P(SDAPTYP,"|",1)="A" SDCL=$$GET1^DIQ(409.85,$P(SDAPTYP,"|",2)_",",8,"I")
"RTN","SDEC07",92,0)
 I SDCL="" D ERR(SDECI+1,"SDEC07 Error: Invalid clinic ID.") Q
"RTN","SDEC07",93,0)
 I $$INACTIVE^SDEC32(SDCL) D ERR(SDECI+1,"SDEC07 Error: "_$$GET1^DIQ(44,SDCL_",",.01)_" is an inactive clinic.") Q
"RTN","SDEC07",94,0)
 ;validate service connected
"RTN","SDEC07",95,0)
 S SDSVCPR=$G(SDSVCPR)
"RTN","SDEC07",96,0)
 I SDSVCPR'="" S:(+SDSVCPR<0)!(+SDSVCPR>100) SDSVCPR=""
"RTN","SDEC07",97,0)
 S SDSVCP=$G(SDSVCP)
"RTN","SDEC07",98,0)
 S SDSVCP=$S(SDSVCP=0:0,SDSVCP="NO":0,SDSVCP=1:1,SDSVCP="YES":1,1:"")
"RTN","SDEC07",99,0)
 ;validate note
"RTN","SDEC07",100,0)
 S SDECNOTE=$G(SDECNOTE) S:SDECNOTE'="" SDECNOTE=$TR($E(SDECNOTE,1,150),"^"," ")   ;alb/sat 658 - only use 1st 150 characters
"RTN","SDEC07",101,0)
 ;validate APPTYPE
"RTN","SDEC07",102,0)
 S APPTYPE=$G(APPTYPE) I APPTYPE'="",'$D(^SD(409.1,+APPTYPE,0)) S APPTYPE=""
"RTN","SDEC07",103,0)
 ;validate Patient Status (EESTAT)
"RTN","SDEC07",104,0)
 S EESTAT=$G(EESTAT)
"RTN","SDEC07",105,0)
 I EESTAT="" D
"RTN","SDEC07",106,0)
 .I $P(SDAPTYP,"|",1)="E" S EESTAT=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",27,"I")
"RTN","SDEC07",107,0)
 .I $P(SDAPTYP,"|",1)="A" S EESTAT=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",.02,"I")
"RTN","SDEC07",108,0)
 S EESTAT=$S(EESTAT="N":"N",EESTAT="NEW":"N",EESTAT="E":"E",EESTAT="ESTABLISHED":"E",1:"")
"RTN","SDEC07",109,0)
 ;validate OVB (overbook)
"RTN","SDEC07",110,0)
 S OVB=+$G(OVB)
"RTN","SDEC07",111,0)
 I 'OVB D
"RTN","SDEC07",112,0)
 .D OVBOOK^SDEC(.RET,SDCL,SDECSTART,SDECRES)
"RTN","SDEC07",113,0)
 D
"RTN","SDEC07",114,0)
 .S SDAPPTYP=+APPTYPE
"RTN","SDEC07",115,0)
 .I 'SDAPPTYP D
"RTN","SDEC07",116,0)
 ..I $P(SDAPTYP,"|",1)="E" S SDAPPTYP=$$GET1^DIQ(409.3,+$P(SDAPTYP,"|",2)_",",8.7,"I")
"RTN","SDEC07",117,0)
 ..I $P(SDAPTYP,"|",1)="A" S SDAPPTYP=$$GET1^DIQ(409.85,+$P(SDAPTYP,"|",2)_",",8.7,"I")
"RTN","SDEC07",118,0)
 ..I $P(SDAPTYP,"|",1)="C",+APPTYPE S SDAPPTYP=+APPTYPE
"RTN","SDEC07",119,0)
 .S:'SDAPPTYP SDAPPTYP=$O(^SD(409.1,"B","REGULAR",0))
"RTN","SDEC07",120,0)
 ;Lock SDEC node
"RTN","SDEC07",121,0)
 L +^SDEC(409.84,DFN):5 I '$T D ERR(SDECI+1,"Another user is working with this patient's record.  Please try again later") Q
"RTN","SDEC07",122,0)
 ;
"RTN","SDEC07",123,0)
 ;TSTART
"RTN","SDEC07",124,0)
 S SDECAPPTID=$$SDECADD(SDECSTART,SDECEND,DFN,SDECRESD,SDECATID,SDDDT,SDID,SDAPTYP,PROVIEN,SDCL,SDECNOTE,SAVESTRT,SDECRES,SDAPPTYP,EESTAT,1,+SDECLEN)  ;alb/sat 665 add SDECLEN
"RTN","SDEC07",125,0)
 I 'SDECAPPTID D ERR(SDECI+1,"SDEC07 Error: Unable to add appointment to SDEC APPOINTMENT file.") Q
"RTN","SDEC07",126,0)
 ;Save the Appointment and start a new transaction that will get rolled back if there's an error
"RTN","SDEC07",127,0)
 ;TCOMMIT
"RTN","SDEC07",128,0)
 ;TSTART
"RTN","SDEC07",129,0)
 ; call chart request
"RTN","SDEC07",130,0)
 S SDECDEV=""  ;$$GET1^DIQ(9009020.2,$$DIV^SDECU,.05) I SDECDEV="" S SDECDERR="SDEC07 Error: No file room printer is defined for the chart request."
"RTN","SDEC07",131,0)
 I SDECATID="WALKIN",$G(SDECCR),$G(SDECDEV)'="" S DGQUIET=1 D WISD^SDECRT(DFN,$P(SDECSTART,"."),"",SDECDEV)
"RTN","SDEC07",132,0)
 I SDECNOTE]"" D SDECWP(SDECAPPTID,SDECNOTE)
"RTN","SDEC07",133,0)
 ;
"RTN","SDEC07",134,0)
 ;Create Appointment in VistA ;TODO: have this call APPVISTA^SDEC07B
"RTN","SDEC07",135,0)
 I +SDCL,$D(^SC(SDCL,0)) D  I +SDECERR D ERR(SDECI+1,$P(SDECERR,U,2))
"RTN","SDEC07",136,0)
 . S SDECC("PAT")=DFN
"RTN","SDEC07",137,0)
 . S SDECC("CLN")=SDCL
"RTN","SDEC07",138,0)
 . S SDECC("TYP")=$S(+SDECWKIN:4,SDAPPTYP=1:1,1:3)   ;3 for scheduled appts, 4 for walkins
"RTN","SDEC07",139,0)
 . S SDECC("COL")=$S(SDAPPTYP=7:1,1:"")   ;collateral visit if appointment type is COLLATERAL OF VET.
"RTN","SDEC07",140,0)
 . S SDECC("APT")=SDAPPTYP
"RTN","SDEC07",141,0)
 . S SDECC("ADT")=SDECSTART
"RTN","SDEC07",142,0)
 . S SDECC("LEN")=SDECLEN
"RTN","SDEC07",143,0)
 . S SDECC("OI")=$E($G(SDECNOTE),1,150) ;File 44 has 150 character limit on OTHER field
"RTN","SDEC07",144,0)
 . S SDECC("OI")=$TR(SDECC("OI"),";"," ") ;No semicolons allowed
"RTN","SDEC07",145,0)
 . S SDECC("OI")=$$STRIP(SDECC("OI")) ;Strip control characters from note
"RTN","SDEC07",146,0)
 . S SDECC("RES")=SDECRESD
"RTN","SDEC07",147,0)
 . S SDECC("USR")=DUZ
"RTN","SDEC07",148,0)
 . S SDECC("MTR")=$G(SDMRTC)
"RTN","SDEC07",149,0)
 . S SDECC("DDT")=SDDDT
"RTN","SDEC07",150,0)
 . S SDECC("REQ")=SDREQBY
"RTN","SDEC07",151,0)
 . S SDECC("LAB")=SDLAB
"RTN","SDEC07",152,0)
 . S SDECC("XRA")=SDXRAY
"RTN","SDEC07",153,0)
 . S SDECC("EKG")=SDEKG
"RTN","SDEC07",154,0)
 . S SDECC("OVB")=+OVB
"RTN","SDEC07",155,0)
 . S SDECC("ELG")=SDEL
"RTN","SDEC07",156,0)
 . S:$P(SDAPTYP,"|",1)="C" SDECC("CON")=$P(SDAPTYP,"|",2)
"RTN","SDEC07",157,0)
 . S SDECERR=$$MAKE^SDEC07B(.SDECC)
"RTN","SDEC07",158,0)
 . Q:SDECERR
"RTN","SDEC07",159,0)
 . ;Update Clinic availability
"RTN","SDEC07",160,0)
 . D AVUPDT(SDCL,SDECSTART,SDECLEN)
"RTN","SDEC07",161,0)
 . ;L
"RTN","SDEC07",162,0)
 . Q
"RTN","SDEC07",163,0)
 ;update wait list
"RTN","SDEC07",164,0)
 I $P(SDAPTYP,"|",1)="E" D EWL^SDEC07A($P(SDAPTYP,"|",2),SDECSTART,SDCL,SDSVCPR,SDSVCP,,SDAPPTYP)  ;alb/sat 658 do not pass note
"RTN","SDEC07",165,0)
 ;update appt request
"RTN","SDEC07",166,0)
 I $P(SDAPTYP,"|",1)="A" D
"RTN","SDEC07",167,0)
 .D UPDATE^SDECAR2($P(SDAPTYP,"|",2),SDECSTART,SDCL,SDSVCPR,SDSVCP,,SDAPPTYP)  ;alb/sat 658 do not pass note
"RTN","SDEC07",168,0)
 .I $G(SDMRTC),$G(SDPARENT) D AR433^SDECAR2(SDPARENT,SDECAPPTID_"~"_$P(SDAPTYP,"|",2))
"RTN","SDEC07",169,0)
 .D:$G(SDPARENT) AR438^SDECAR2($P(SDAPTYP,"|",2),SDPARENT)
"RTN","SDEC07",170,0)
 ;
"RTN","SDEC07",171,0)
 ;Return Recordset
"RTN","SDEC07",172,0)
 ;TCOMMIT
"RTN","SDEC07",173,0)
 L -^SDEC(409.84,DFN)
"RTN","SDEC07",174,0)
 L -^DPT(DFN)
"RTN","SDEC07",175,0)
 S SDECI=SDECI+1
"RTN","SDEC07",176,0)
 S ^TMP("SDEC07",$J,SDECI)=SDECAPPTID_"^"_$G(SDECDERR)_$C(30)
"RTN","SDEC07",177,0)
 S SDECI=SDECI+1
"RTN","SDEC07",178,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC07",179,0)
 Q
"RTN","SDEC07",180,0)
 ;
"RTN","SDEC07",181,0)
STRIP(SDECZ) ;Replace control characters with spaces
"RTN","SDEC07",182,0)
 N SDECI
"RTN","SDEC07",183,0)
 F SDECI=1:1:$L(SDECZ) I (32>$A($E(SDECZ,SDECI))) S SDECZ=$E(SDECZ,1,SDECI-1)_" "_$E(SDECZ,SDECI+1,999)
"RTN","SDEC07",184,0)
 Q SDECZ
"RTN","SDEC07",185,0)
 ;
"RTN","SDEC07",186,0)
 ;ADD SDEC APPOINTMENT ENTRY
"RTN","SDEC07",187,0)
SDECADD(SDECSTART,SDECEND,DFN,SDECRESD,SDECATID,SDDDT,SDID,SDAPTYP,PROVIEN,SDCL,SDECNOTE,SAVESTRT,SDECRES,SDAPPTYP,EESTAT,SDF,SDECLEN) ;alb/sat 665 add SDECLEN
"RTN","SDEC07",188,0)
 ;SDF       - (optional) flags
"RTN","SDEC07",189,0)
 ;                       1. called from GUI (update consult only if called from GUI)
"RTN","SDEC07",190,0)
 ;Returns ien in SDECAPPT or 0 if failed
"RTN","SDEC07",191,0)
 ;called from SDEC APPADD rpc and from VistA via SDM1A
"RTN","SDEC07",192,0)
 ;Create entry in SDEC APPOINTMENT
"RTN","SDEC07",193,0)
 N SDIEN,SDECAPPTID,SDECFDA,SDECIEN,SDECMSG,SL,X
"RTN","SDEC07",194,0)
 S SDECSTART=$G(SDECSTART)
"RTN","SDEC07",195,0)
 S SAVESTRT=$G(SAVESTRT),SDECRES=$G(SDECRES)         ;MGH save date/time for consult request
"RTN","SDEC07",196,0)
 S DFN=$G(DFN)
"RTN","SDEC07",197,0)
 S SDECRESD=$G(SDECRESD)
"RTN","SDEC07",198,0)
 S SDECATID=$G(SDECATID)
"RTN","SDEC07",199,0)
 S SDDDT=$G(SDDDT)
"RTN","SDEC07",200,0)
 S SDID=$G(SDID)
"RTN","SDEC07",201,0)
 S SDAPTYP=$G(SDAPTYP)
"RTN","SDEC07",202,0)
 S SDAPPTYP=$G(SDAPPTYP)
"RTN","SDEC07",203,0)
 S PROVIEN=$G(PROVIEN)
"RTN","SDEC07",204,0)
 S SDCL=$G(SDCL)
"RTN","SDEC07",205,0)
 S SDECEND=$G(SDECEND)
"RTN","SDEC07",206,0)
 ;alb/sat 665 begin modification
"RTN","SDEC07",207,0)
 S SDECLEN=$G(SDECLEN)
"RTN","SDEC07",208,0)
 I SDECLEN="",SDECEND="" S SDECLEN=+$G(^SC(SDCL,"SL")) S:'+SDECLEN SDECLEN=30 S SDECEND=$$FMADD^XLFDT(SDECSTART,,,+SDECLEN)   ;no length or end date/time
"RTN","SDEC07",209,0)
 I SDECLEN="",SDECEND'="" S SDECLEN=$$FMDIFF^XLFDT(SDECEND,SDECSTART,2)\60  ;no length
"RTN","SDEC07",210,0)
 I SDECLEN'="",SDECEND="" S SDECEND=$$FMADD^XLFDT(SDECSTART,,,+SDECLEN)  ;no end date/time
"RTN","SDEC07",211,0)
 ;alb/sat 665 end modification
"RTN","SDEC07",212,0)
 S SDECNOTE=$G(SDECNOTE)
"RTN","SDEC07",213,0)
 S SDF=$G(SDF,0)
"RTN","SDEC07",214,0)
 I PROVIEN="" D
"RTN","SDEC07",215,0)
 .S PROVIEN=$$GET1^DIQ(44,SDCL_",",16,"I")
"RTN","SDEC07",216,0)
 S SDIEN=$$APPTGET^SDECUTL(DFN,SDECSTART,SDCL)
"RTN","SDEC07",217,0)
 S SDIEN=$S(SDIEN'="":SDIEN_",",1:"+1,")
"RTN","SDEC07",218,0)
 S SDECFDA(409.84,SDIEN,.01)=SDECSTART
"RTN","SDEC07",219,0)
 S SDECFDA(409.84,SDIEN,.02)=SDECEND
"RTN","SDEC07",220,0)
 S SDECFDA(409.84,SDIEN,.05)=DFN
"RTN","SDEC07",221,0)
 S:+SDAPPTYP SDECFDA(409.84,SDIEN,.06)=SDAPPTYP
"RTN","SDEC07",222,0)
 ;S:SDECATID?.N SDECFDA(409.84,SDIEN,.06)=SDECATID
"RTN","SDEC07",223,0)
 S SDECFDA(409.84,SDIEN,.07)=SDECRESD
"RTN","SDEC07",224,0)
 S SDECFDA(409.84,SDIEN,.08)=$G(DUZ)
"RTN","SDEC07",225,0)
 S SDECFDA(409.84,SDIEN,.09)=$P($$NOW^XLFDT,".",1)
"RTN","SDEC07",226,0)
 S SDECFDA(409.84,SDIEN,.1)=""
"RTN","SDEC07",227,0)
 S SDECFDA(409.84,SDIEN,.101)=""
"RTN","SDEC07",228,0)
 S SDECFDA(409.84,SDIEN,.102)=""
"RTN","SDEC07",229,0)
 S SDECFDA(409.84,SDIEN,.11)=""
"RTN","SDEC07",230,0)
 S SDECFDA(409.84,SDIEN,.12)=""
"RTN","SDEC07",231,0)
 S SDECFDA(409.84,SDIEN,.121)=""
"RTN","SDEC07",232,0)
 S SDECFDA(409.84,SDIEN,.122)=""
"RTN","SDEC07",233,0)
 S:SDECATID="WALKIN" SDECFDA(409.84,SDIEN,.13)="y"
"RTN","SDEC07",234,0)
 S:PROVIEN'="" SDECFDA(409.84,SDIEN,.16)=PROVIEN
"RTN","SDEC07",235,0)
 S SDECFDA(409.84,SDIEN,.17)=""
"RTN","SDEC07",236,0)
 S:$G(SDECLEN)'="" SDECFDA(409.84,SDIEN,.18)=SDECLEN
"RTN","SDEC07",237,0)
 S SDECFDA(409.84,SDIEN,.2)=SDDDT
"RTN","SDEC07",238,0)
 S:$G(SDID)'="" SDECFDA(409.84,SDIEN,.21)=SDID
"RTN","SDEC07",239,0)
 S:SDAPTYP'="" SDECFDA(409.84,SDIEN,.22)=$P(SDAPTYP,"|",2)_";"_$S($P(SDAPTYP,"|",1)="E":"SDWL(409.3,",$P(SDAPTYP,"|",1)="C":"GMR(123,",$P(SDAPTYP,"|",1)="R":"SD(403.5,",$P(SDAPTYP,"|",1)="A":"SDEC(409.85,",1:"")
"RTN","SDEC07",240,0)
 S:$G(EESTAT)'="" SDECFDA(409.84,SDIEN,.23)=EESTAT
"RTN","SDEC07",241,0)
 K SDECIEN,SDECMSG
"RTN","SDEC07",242,0)
 D UPDATE^DIE("","SDECFDA","SDECIEN","SDECMSG")
"RTN","SDEC07",243,0)
 S SDECAPPTID=$S(SDIEN'="+1,":+SDIEN,1:+$G(SDECIEN(1)))
"RTN","SDEC07",244,0)
 K SDECMSG
"RTN","SDEC07",245,0)
 I SDECNOTE="" D WP^DIE(409.84,$S(+$G(SDECAPPTID):SDECAPPTID_",",1:SDIEN_","),1,"","@","SDECMSG")
"RTN","SDEC07",246,0)
 I SDECNOTE'="" N ARR D WP^SDECUTL(.ARR,SDECNOTE) D WP^DIE(409.84,$S(+$G(SDECAPPTID):SDECAPPTID_",",1:SDIEN_","),1,"","ARR","SDECMSG")
"RTN","SDEC07",247,0)
 I SDECAPPTID'="" D
"RTN","SDEC07",248,0)
 .I $P(SDAPTYP,"|",1)="C",SDF D
"RTN","SDEC07",249,0)
 ..D REQSET^SDEC07A($P(SDAPTYP,"|",2),PROVIEN,"",1,"",SDECNOTE,SAVESTRT,SDECRES)   ;MGH added 3 parameters to this call
"RTN","SDEC07",250,0)
 Q SDECAPPTID
"RTN","SDEC07",251,0)
 ;
"RTN","SDEC07",252,0)
SDECWP(SDECAPPTID,SDECNOTE) ;
"RTN","SDEC07",253,0)
 ;Add WP field
"RTN","SDEC07",254,0)
 I SDECNOTE]"" S SDECNOTE(.5)=SDECNOTE,SDECNOTE=""
"RTN","SDEC07",255,0)
 I $D(SDECNOTE(0)) S SDECNOTE(.5)=SDECNOTE(0) K SDECNOTE(0)
"RTN","SDEC07",256,0)
 I $D(SDECNOTE(.5)) D
"RTN","SDEC07",257,0)
 . D WP^DIE(409.84,SDECAPPTID_",",1,"","SDECNOTE","SDECMSG")
"RTN","SDEC07",258,0)
 Q
"RTN","SDEC07",259,0)
 ;
"RTN","SDEC07",260,0)
ADDEVT(DFN,SDECSTART,SDECSC,SDCLA) ;EP
"RTN","SDEC07",261,0)
 ;Called by SDEC ADD APPOINTMENT protocol
"RTN","SDEC07",262,0)
 ;SDECSC=IEN of clinic in ^SC
"RTN","SDEC07",263,0)
 ;SDCLA=IEN for ^SC(SDECSC,"S",SDECSTART,1,SDCLA). Use to get Length & Note
"RTN","SDEC07",264,0)
 ;
"RTN","SDEC07",265,0)
 N SDECNOD,SDECLEN,SDECAPPTID,SDECNODP,SDECWKIN,SDECRES
"RTN","SDEC07",266,0)
 Q:+$G(SDECNOEV)
"RTN","SDEC07",267,0)
 I $D(^SDEC(409.831,"ALOC",SDECSC)) S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0))
"RTN","SDEC07",268,0)
 Q:'+$G(SDECRES)
"RTN","SDEC07",269,0)
 S SDECNOD=$G(^SC(SDECSC,"S",SDECSTART,1,SDCLA,0))
"RTN","SDEC07",270,0)
 Q:SDECNOD=""
"RTN","SDEC07",271,0)
 S SDECNODP=$G(^DPT(DFN,"S",SDECSTART,0))
"RTN","SDEC07",272,0)
 S SDECWKIN=""
"RTN","SDEC07",273,0)
 S:$P(SDECNODP,U,7)=4 SDECWKIN="WALKIN" ;Purpose of Visit field of DPT Appointment subfile
"RTN","SDEC07",274,0)
 S SDECLEN=$P(SDECNOD,U,2)
"RTN","SDEC07",275,0)
 Q:'+SDECLEN
"RTN","SDEC07",276,0)
 S SDECEND=$$FMADD^XLFDT(SDECSTART,0,0,SDECLEN,0)
"RTN","SDEC07",277,0)
 S SDECAPPTID=$$SDECADD(SDECSTART,SDECEND,DFN,SDECRES,SDECWKIN,,,,,SDECSC,,,,,,1,+SDECLEN)  ;alb/sat 665 add SDECLEN
"RTN","SDEC07",278,0)
 Q:'+SDECAPPTID
"RTN","SDEC07",279,0)
 S SDECNOTE=$P(SDECNOD,U,4)
"RTN","SDEC07",280,0)
 I SDECNOTE]"" D SDECWP(SDECAPPTID,SDECNOTE)
"RTN","SDEC07",281,0)
 D ADDEVT3(SDECRES)
"RTN","SDEC07",282,0)
 Q
"RTN","SDEC07",283,0)
 ;
"RTN","SDEC07",284,0)
ADDEVT3(SDECRES) ;
"RTN","SDEC07",285,0)
 ;Call RaiseEvent to notify GUI clients
"RTN","SDEC07",286,0)
 Q
"RTN","SDEC07",287,0)
 ;
"RTN","SDEC07",288,0)
ERR(SDECI,SDECERR) ;Error processing
"RTN","SDEC07",289,0)
 S SDECI=SDECI+1
"RTN","SDEC07",290,0)
 S SDECERR=$TR(SDECERR,"^","~")
"RTN","SDEC07",291,0)
 S ^TMP("SDEC07",$J,SDECI)=$G(SDECAPPTID,0)_"^"_SDECERR_$C(30)
"RTN","SDEC07",292,0)
 S SDECI=SDECI+1
"RTN","SDEC07",293,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC07",294,0)
 L
"RTN","SDEC07",295,0)
 Q
"RTN","SDEC07",296,0)
 ;
"RTN","SDEC07",297,0)
ETRAP ;EP Error trap entry
"RTN","SDEC07",298,0)
 D ^%ZTER
"RTN","SDEC07",299,0)
 I '$D(SDECI) N SDECI S SDECI=999999
"RTN","SDEC07",300,0)
 S SDECI=SDECI+1
"RTN","SDEC07",301,0)
 D ERR(SDECI,"SDEC07 Error")
"RTN","SDEC07",302,0)
 Q
"RTN","SDEC07",303,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDEC07",304,0)
 ;
"RTN","SDEC07",305,0)
DOW N SDTMP S SDTMP=$E(X,1,3),Y=$E(X,4,5),Y=Y>2&'(SDTMP#4)+$E("144025036146",Y)
"RTN","SDEC07",306,0)
 F SDTMP=SDTMP:-1:281 S Y=SDTMP#4=1+1+Y
"RTN","SDEC07",307,0)
 S Y=$E(X,6,7)+Y#7
"RTN","SDEC07",308,0)
 Q
"RTN","SDEC07",309,0)
 ;
"RTN","SDEC07",310,0)
AVUPDT(SDCL,SDECSTART,SDECLEN) ;Update Clinic availability
"RTN","SDEC07",311,0)
 ;SEE SDM1
"RTN","SDEC07",312,0)
 N %,ABORT,SDNOT,Y,DFN,SDVAL
"RTN","SDEC07",313,0)
 N SL,STARTDAY,X,SC,SB,HSI,SI,STR,SDDIF,SDMAX,SDDATE,SDDMAX,SDSDATE,CCXN,MXOK,COV,SDPROG
"RTN","SDEC07",314,0)
 N X1,SDEDT,X2,SD,SM,SS,S,SDLOCK,ST,I,SDECINC
"RTN","SDEC07",315,0)
 S Y=SDCL   ;,DFN=DFN  ;renamed SDECPATID to DFN
"RTN","SDEC07",316,0)
 S SL=$G(^SC(+Y,"SL")),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SC=Y,SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDEC07",317,0)
 ;Determine maximum days for scheduling
"RTN","SDEC07",318,0)
 S SDMAX(1)=$P($G(^SC(+SC,"SDP")),U,2) S:'SDMAX(1) SDMAX(1)=365
"RTN","SDEC07",319,0)
 S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDEC07",320,0)
 S SDDATE=SDECSTART
"RTN","SDEC07",321,0)
 S SDSDATE=SDDATE,SDDATE=SDDATE\1
"RTN","SDEC07",322,0)
1 ;L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDEC07",323,0)
 ;Q:$D(SDXXX)
"RTN","SDEC07",324,0)
 S CCXN=0 K MXOK,COV,SDPROT Q:$G(DFN)<0  S SC=+SC
"RTN","SDEC07",325,0)
 S X1=DT,SDEDT=365 S:$D(^SC(SC,"SDP")) SDEDT=$P(^SC(SC,"SDP"),"^",2)
"RTN","SDEC07",326,0)
 S X2=SDEDT D C^%DTC S SDEDT=X
"RTN","SDEC07",327,0)
 S Y=SDECSTART
"RTN","SDEC07",328,0)
EN1 S (X,SD)=Y,SM=0 D DOW
"RTN","SDEC07",329,0)
S I '$D(^SC(SC,"ST",$P(SD,"."),1)) S SS=+$O(^SC(+SC,"T"_Y,SD)) Q:SS'>0  Q:^(SS,1)=""  S ^SC(+SC,"ST",$P(SD,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(SD,".")
"RTN","SDEC07",330,0)
 S S=SDECLEN
"RTN","SDEC07",331,0)
 ;Check if SDECLEN evenly divisible by appointment length
"RTN","SDEC07",332,0)
 S SDVAL=$P(SL,U)
"RTN","SDEC07",333,0)
 I SDECLEN<SDVAL S SDECLEN=SDVAL
"RTN","SDEC07",334,0)
 I SDECLEN#SDVAL'=0 D
"RTN","SDEC07",335,0)
 . S SDECINC=SDECLEN\SDVAL
"RTN","SDEC07",336,0)
 . S SDECINC=SDECINC+1
"RTN","SDEC07",337,0)
 . S SDECLEN=SDVAL*SDECINC
"RTN","SDEC07",338,0)
 S SL=S_U_$P(SL,U,2,99)
"RTN","SDEC07",339,0)
SC S SDLOCK=$S('$D(SDLOCK):1,1:SDLOCK+1) Q:SDLOCK>9
"RTN","SDEC07",340,0)
 L +^SC(SC,"ST",$P(SD,"."),1):5 G:'$T SC
"RTN","SDEC07",341,0)
 S SDLOCK=0,S=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDEC07",342,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDEC07",343,0)
 I (I<1!'$F(S,"["))&(S'["CAN") L -^SC(SC,"ST",$P(SD,"."),1) Q
"RTN","SDEC07",344,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDEC07",345,0)
 ;
"RTN","SDEC07",346,0)
SP I ST+ST>$L(S),$L(S)<80 S S=S_" " G SP
"RTN","SDEC07",347,0)
 S SDNOT=1
"RTN","SDEC07",348,0)
 S ABORT=0
"RTN","SDEC07",349,0)
 F I=ST+ST:SDDIF:SS-SDDIF D  Q:ABORT
"RTN","SDEC07",350,0)
 . S ST=$E(S,I+1) S:ST="" ST=" "
"RTN","SDEC07",351,0)
 . S Y=$E(STR,$F(STR,ST)-2)
"RTN","SDEC07",352,0)
 . I S["CAN"!(ST="X"&($D(^SC(+SC,"ST",$P(SD,"."),"CAN")))) S ABORT=1 Q
"RTN","SDEC07",353,0)
 . I Y="" S ABORT=1 Q
"RTN","SDEC07",354,0)
 . S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDEC07",355,0)
 . Q
"RTN","SDEC07",356,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S
"RTN","SDEC07",357,0)
 L -^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDEC07",358,0)
 Q
"RTN","SDEC07",359,0)
 ;
"RTN","SDEC07",360,0)
ERROR ;
"RTN","SDEC07",361,0)
 D ERR1("Error")
"RTN","SDEC07",362,0)
 Q
"RTN","SDEC07",363,0)
 ;
"RTN","SDEC07",364,0)
ERR1(SDECERR) ;Error processing
"RTN","SDEC07",365,0)
 S SDECI=SDECI+1
"RTN","SDEC07",366,0)
 S ^TMP("SDEC07",$J,SDECI)=SDECERR_$C(30)
"RTN","SDEC07",367,0)
 S SDECI=SDECI+1
"RTN","SDEC07",368,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC25")
0^12^B115273682^B108318139
"RTN","SDEC25",1,0)
SDEC25 ;ALB/SAT - VISTA SCHEDULING RPCS ;MAY 15, 2017
"RTN","SDEC25",2,0)
 ;;5.3;Scheduling;**627,665,671**;Aug 13, 1993;Build 25
"RTN","SDEC25",3,0)
 ;
"RTN","SDEC25",4,0)
 Q
"RTN","SDEC25",5,0)
 ;
"RTN","SDEC25",6,0)
CHECKIN(SDECY,SDECAPTID,SDECCDT,SDECCC,SDECPRV,SDECROU,SDECVCL,SDECVFM,SDECOG,SDECCR,SDECPCC,SDECWHF) ;Check in appointment
"RTN","SDEC25",7,0)
 ;CHECKIN(SDECY,SDECAPTID,SDECCDT,SDECCC,SDECPRV,SDECROU,SDECVCL,SDECVFM,SDECOG,SDECCR,SDECPCC,SDECWHF)
"RTN","SDEC25",8,0)
 ;  external parameter tag is in SDEC
"RTN","SDEC25",9,0)
 ;
"RTN","SDEC25",10,0)
 ; INPUT: SDECAPTID - (required) Appointment ID
"RTN","SDEC25",11,0)
 ;        SDECCDT   - (optional) Check-in date/time
"RTN","SDEC25",12,0)
 ;                               "@" - indicates delete check-in
"RTN","SDEC25",13,0)
 ;        SDECCC    - (????????) Clinic Stop pointer to CLINIC STOP file
"RTN","SDEC25",14,0)
 ;        SDECPRV   - (optional) Provider pointer to NEW PERSON file
"RTN","SDEC25",15,0)
 ;                               default to current user
"RTN","SDEC25",16,0)
 ;        SDECROU   - (optional) Print Routing Slip flag, valid values:
"RTN","SDEC25",17,0)
 ;                                 0=false   1=true
"RTN","SDEC25",18,0)
 ;        SDECVCL   - (????????) Clinic pointer to HOSPITAL LOCATION
"RTN","SDEC25",19,0)
 ;        SDECVFM   - FORM
"RTN","SDEC25",20,0)
 ;        SDECOG    - OUTGUIDE FLAG
"RTN","SDEC25",21,0)
 ;        SDECCR    - Generate Chart request upon check-in? (1-Yes, otherwise no)
"RTN","SDEC25",22,0)
 ;        SDECPCC   - ien of PWH Type in HEALTH SUMMARY PWH TYPE file ^APCHPWHT
"RTN","SDEC25",23,0)
 ;        SDECWHF   - Print Patient Wellness Handout flag
"RTN","SDEC25",24,0)
 ;
"RTN","SDEC25",25,0)
ENDBG ;
"RTN","SDEC25",26,0)
 N BSDVSTN,EMSG
"RTN","SDEC25",27,0)
 N SDECNOD,SDECPATID,SDECSTART,DIK,DA,SDECID,SDECI,SDECZ,SDECIENS,SDECVEN
"RTN","SDEC25",28,0)
 N SDECNOEV,SDECCAN,SDECR1,%DT,X,Y
"RTN","SDEC25",29,0)
 S SDECNOEV=1 ;Don't execute protocol
"RTN","SDEC25",30,0)
 S SDECCAN=0
"RTN","SDEC25",31,0)
 ;
"RTN","SDEC25",32,0)
 S SDECI=0
"RTN","SDEC25",33,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC25",34,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC25",35,0)
 S ^TMP("SDEC",$J,0)="T00020ERRORID^T00150MESSAGE"_$C(30)
"RTN","SDEC25",36,0)
 ;validate SDEC appointment ID
"RTN","SDEC25",37,0)
 I '+$G(SDECAPTID) D ERR("SDEC25: Invalid Appointment ID") Q
"RTN","SDEC25",38,0)
 I '$D(^SDEC(409.84,+SDECAPTID,0)) D ERR("SDEC25: Invalid Appointment ID") Q
"RTN","SDEC25",39,0)
 ;validate checkin date/time (required)
"RTN","SDEC25",40,0)
 S SDECCDT=$G(SDECCDT)
"RTN","SDEC25",41,0)
 S:SDECCDT="@" SDECCAN=1
"RTN","SDEC25",42,0)
 I 'SDECCAN,SDECCDT'="" S %DT="T" S X=SDECCDT D ^%DT S SDECCDT=Y I Y=-1 S SDECCDT=""
"RTN","SDEC25",43,0)
 I SDECCDT="" D ERR("SDEC25: Invalid Check-In Time") Q
"RTN","SDEC25",44,0)
 ;validate clinic stop code
"RTN","SDEC25",45,0)
 S SDECCC=$G(SDECCC)
"RTN","SDEC25",46,0)
 I SDECCC'="" I '$D(^DIC(40.7,SDECCC,0)) S SDECCC=""
"RTN","SDEC25",47,0)
 ;validate provider (optional)
"RTN","SDEC25",48,0)
 S SDECPRV=$G(SDECPRV)
"RTN","SDEC25",49,0)
 I SDECPRV'="" I '$D(^VA(200,+SDECPRV,0)) S SDECPRV=""
"RTN","SDEC25",50,0)
 ;I SDECPRV="" S SDECPRV=DUZ
"RTN","SDEC25",51,0)
 ;I SDECPRV="" S SDECPRV=""
"RTN","SDEC25",52,0)
 ;validate routine slip flag (optional)
"RTN","SDEC25",53,0)
 S SDECROU=$$UP^XLFSTR($G(SDECROU))
"RTN","SDEC25",54,0)
 S SDECROU=$S(SDECROU=1:"true",SDECROU="TRUE":"true",1:0)
"RTN","SDEC25",55,0)
 ;validate clinic
"RTN","SDEC25",56,0)
 S SDECVCL=$G(SDECVCL)
"RTN","SDEC25",57,0)
 I SDECVCL'="" I '$D(^SC(SDECVCL,0)) S SDECVCL=""
"RTN","SDEC25",58,0)
 I SDECCC="",SDECVCL'="" S SDECCC=$P($G(^SC(SDECVCL,0)),U,7)   ;get clinic stop from 44
"RTN","SDEC25",59,0)
 ;
"RTN","SDEC25",60,0)
 S SDECNOD=^SDEC(409.84,SDECAPTID,0)
"RTN","SDEC25",61,0)
 S DFN=$P(SDECNOD,U,5)
"RTN","SDEC25",62,0)
 S SDECPATID=$P(SDECNOD,U,5)
"RTN","SDEC25",63,0)
 S SDECSTART=$P(SDECNOD,U)
"RTN","SDEC25",64,0)
 ;
"RTN","SDEC25",65,0)
 S SDECR1=$P(SDECNOD,U,7) ;RESOURCEID
"RTN","SDEC25",66,0)
 ;if resourceId is not null AND there is a valid resource record
"RTN","SDEC25",67,0)
 I SDECR1]"",$D(^SDEC(409.831,SDECR1,0)) D  I +$G(SDECZ) D ERR($P(SDECZ,U,2)) Q
"RTN","SDEC25",68,0)
 . S SDECNOD=^SDEC(409.831,SDECR1,0)
"RTN","SDEC25",69,0)
 . S SDECSC1=$P(SDECNOD,U,4) ;HOSPITAL LOCATION
"RTN","SDEC25",70,0)
 . ;Hospital Location is required for CHECKIN
"RTN","SDEC25",71,0)
 . ;I 'SDECSC1]"",'$D(^SC(+SDECSC1,0)) D ERR("SDEC25: Clinic not defined for this Resource: "_$P(SDECNOD,U,1)_" ("_SDECSC1_")") Q
"RTN","SDEC25",72,0)
 . I 'SDECSC1]"",'$D(^SC(+SDECSC1,0)) D ERR("Clinic not defined for this Resource: "_$P(SDECNOD,U,1)_" ("_SDECSC1_")") Q
"RTN","SDEC25",73,0)
 . ;Checkin SDEC APPOINTMENT entry
"RTN","SDEC25",74,0)
 . D SDECCHK(SDECAPTID,$S(SDECCAN:"",1:SDECCDT)) ; sets field .03 (Checkin), in file 409.84
"RTN","SDEC25",75,0)
 . ;Process cancel checkin
"RTN","SDEC25",76,0)
 . I $G(SDECCAN) D CANCHKIN(SDECPATID,SDECSC1,SDECSTART) Q
"RTN","SDEC25",77,0)
 . D APCHK(.SDECZ,SDECSC1,SDECPATID,SDECCDT,SDECSTART)
"RTN","SDEC25",78,0)
 . I $G(SDECPRV) S DIE="^SDEC(409.84,",DA=SDECAPTID,DR=".16///"_SDECPRV D ^DIE
"RTN","SDEC25",79,0)
 ;
"RTN","SDEC25",80,0)
 S SDECI=SDECI+1
"RTN","SDEC25",81,0)
 S ^TMP("SDEC",$J,SDECI)="0^"_$S($G(EMSG)'="":EMSG,1:"")_$C(30)
"RTN","SDEC25",82,0)
 S SDECI=SDECI+1
"RTN","SDEC25",83,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC25",84,0)
 Q
"RTN","SDEC25",85,0)
 ;
"RTN","SDEC25",86,0)
SDECCHK(SDECAPTID,SDECCDT) ;
"RTN","SDEC25",87,0)
 N SDECFDA,SDECMSG
"RTN","SDEC25",88,0)
 S SDECIENS=SDECAPTID_","
"RTN","SDEC25",89,0)
 S SDECFDA(409.84,SDECIENS,.03)=SDECCDT
"RTN","SDEC25",90,0)
 S SDECFDA(409.84,SDECIENS,.04)=$S(SDECCDT'="":$$NOW^XLFDT,1:"")
"RTN","SDEC25",91,0)
 D FILE^DIE("","SDECFDA","SDECMSG")
"RTN","SDEC25",92,0)
 Q
"RTN","SDEC25",93,0)
 ;
"RTN","SDEC25",94,0)
APCHK(SDECZ,SDECSC1,SDECDFN,SDECCDT,SDECSTART)         ;
"RTN","SDEC25",95,0)
 ;Checkin appointment for patient SDECDFN in clinic SDECSC1
"RTN","SDEC25",96,0)
 ;at time SDECSD
"RTN","SDEC25",97,0)
 N APTN,BSDMSG,SDECC
"RTN","SDEC25",98,0)
 S SDECC("PAT")=SDECPATID
"RTN","SDEC25",99,0)
 S SDECC("HOS LOC")=SDECSC1
"RTN","SDEC25",100,0)
 S SDECC("CLINIC CODE")=SDECCC
"RTN","SDEC25",101,0)
 S SDECC("PROVIDER")=SDECPRV
"RTN","SDEC25",102,0)
 S SDECC("APPT DATE")=SDECSTART
"RTN","SDEC25",103,0)
 S SDECC("CDT")=SDECCDT
"RTN","SDEC25",104,0)
 S SDECC("USR")=DUZ
"RTN","SDEC25",105,0)
 ;find IEN in ^SC multiple or null
"RTN","SDEC25",106,0)
 S APTN=$$FIND^SDAM2(SDECC("PAT"),SDECC("APPT DATE"),SDECC("HOS LOC"))
"RTN","SDEC25",107,0)
 ;
"RTN","SDEC25",108,0)
 ;Required by NEW API:
"RTN","SDEC25",109,0)
 S SDECC("SRV CAT")="A"
"RTN","SDEC25",110,0)
 S SDECC("TIME RANGE")=-1
"RTN","SDEC25",111,0)
 S SDECC("VISIT DATE")=SDECCDT
"RTN","SDEC25",112,0)
 S SDECC("SITE")=$G(DUZ(2))
"RTN","SDEC25",113,0)
 S SDECC("VISIT TYPE")="V"
"RTN","SDEC25",114,0)
 S SDECC("CLN")=SDECC("HOS LOC")
"RTN","SDEC25",115,0)
 S SDECC("ADT")=SDECC("APPT DATE")
"RTN","SDEC25",116,0)
 ;
"RTN","SDEC25",117,0)
 ;Set up SDECVEN array containing VEN EHP CLINIC, VEN EHP FORM, OUTGUIDE FLAG
"RTN","SDEC25",118,0)
 ;These values come from input param
"RTN","SDEC25",119,0)
 S SDECVEN("CLINIC")=SDECVCL
"RTN","SDEC25",120,0)
 S SDECVEN("FORM")=SDECVFM
"RTN","SDEC25",121,0)
 S SDECVEN("OUTGUIDE")=SDECOG
"RTN","SDEC25",122,0)
 ;
"RTN","SDEC25",123,0)
 N SDECOUT
"RTN","SDEC25",124,0)
 D GETVISIT^SDECAPI4(.SDECC,.SDECOUT)
"RTN","SDEC25",125,0)
 ;K SDECC
"RTN","SDEC25",126,0)
 ;I SDECOUT(0)=1 S BSDVSTN=$O(SDECOUT(0))         ;if match found, set visit IEN
"RTN","SDEC25",127,0)
 ;D VISIT^SDECV(SDECC("HOS LOC"),SDECC("APPT DATE"),APTN,SDECC("PAT"),SDECC("CLINIC CODE"),SDECC("PROVIDER"),,.BSDMSG,.BSDVSTN,.SDECC)   ;replace GETVISIT^SDECAPI4 to make sure all visit data is updated
"RTN","SDEC25",128,0)
 Q
"RTN","SDEC25",129,0)
 ;
"RTN","SDEC25",130,0)
CANCHKIN(DFN,SDCL,SDT) ; Logic to cancel a checkin if the checkin date/time is passed in as '@'
"RTN","SDEC25",131,0)
 ; input:  DFN := ifn of patient
"RTN","SDEC25",132,0)
 ;        SDCL := clinic#
"RTN","SDEC25",133,0)
 ;         SDT := appt d/t
"RTN","SDEC25",134,0)
 ;
"RTN","SDEC25",135,0)
 N SDDA
"RTN","SDEC25",136,0)
 S SDDA=$$FIND(DFN,SDT,SDCL)
"RTN","SDEC25",137,0)
 ;I 'SDDA D ERR("SDEC25: Could not locate appointment in database or appointment is cancelled.") Q
"RTN","SDEC25",138,0)
 I 'SDDA D ERR("Could not locate appointment in database or appointment is cancelled.") Q
"RTN","SDEC25",139,0)
 N SDATA,SDCIHDL,X S SDATA=SDDA_U_DFN_U_SDT_U_SDCL,SDCIHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDEC25",140,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDEC25",141,0)
 S FDA(44.003,SDDA_","_SDT_","_SDCL_",",309)="" D FILE^DIE(,"FDA","ERR")
"RTN","SDEC25",142,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDEC25",143,0)
 D CHKEVTD(DFN,SDT,SDCL)
"RTN","SDEC25",144,0)
 K FDA,ERR
"RTN","SDEC25",145,0)
 Q
"RTN","SDEC25",146,0)
 ;
"RTN","SDEC25",147,0)
FIND(DFN,SDT,SDCL) ; -- return appt ifn for pat
"RTN","SDEC25",148,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDEC25",149,0)
 ;                 SDT := appt d/t
"RTN","SDEC25",150,0)
 ;                SDCL := ifn of clinic
"RTN","SDEC25",151,0)
 ;  output: [returned] := ifn if pat has appt on date/time
"RTN","SDEC25",152,0)
 ;
"RTN","SDEC25",153,0)
 N Y
"RTN","SDEC25",154,0)
 S Y=0 F  S Y=$O(^SC(SDCL,"S",SDT,1,Y)) Q:'Y  I $D(^(Y,0)),DFN=+^(0),$D(^DPT(+DFN,"S",SDT,0)),$$VALID(DFN,SDCL,SDT,Y) Q
"RTN","SDEC25",155,0)
 Q Y
"RTN","SDEC25",156,0)
 ;
"RTN","SDEC25",157,0)
VALID(DFN,SDCL,SDT,SDDA) ; -- return valid appt.
"RTN","SDEC25",158,0)
 ; **NOTE:  For speed consideration the ^SC and ^DPT nodes must be
"RTN","SDEC25",159,0)
 ;          check to see they exist prior to calling this entry point.
"RTN","SDEC25",160,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDEC25",161,0)
 ;                 SDT := appt d/t
"RTN","SDEC25",162,0)
 ;                SDCL := ifn of clinic
"RTN","SDEC25",163,0)
 ;                SDDA := ifn of appt
"RTN","SDEC25",164,0)
 ;  output: [returned] := 1 for valid appt., 0 for not valid
"RTN","SDEC25",165,0)
 Q $S($P(^SC(SDCL,"S",SDT,1,SDDA,0),U,9)'="C":1,$P(^DPT(DFN,"S",SDT,0),U,2)["C":1,1:0)
"RTN","SDEC25",166,0)
 ;
"RTN","SDEC25",167,0)
CHKEVT(SDECPAT,SDECSTART,SDECSC) ;EP Called by SDEC CHECKIN APPOINTMENT event
"RTN","SDEC25",168,0)
 ;when appointments CHECKIN via PIMS interface.
"RTN","SDEC25",169,0)
 ;Propagates CHECKIN to SDECAPPT and raises refresh event to running GUI clients
"RTN","SDEC25",170,0)
 ;
"RTN","SDEC25",171,0)
 Q:+$G(SDECNOEV)
"RTN","SDEC25",172,0)
 Q:'+$G(SDECSC)
"RTN","SDEC25",173,0)
 N SDECSTAT,SDECFOUND,SDECRES
"RTN","SDEC25",174,0)
 S SDECSTAT=""
"RTN","SDEC25",175,0)
 S:$G(SDATA("AFTER","STATUS"))["CHECKED IN" SDECSTAT=$P(SDATA("AFTER","STATUS"),"^",4)
"RTN","SDEC25",176,0)
 S SDECFOUND=0
"RTN","SDEC25",177,0)
 I $D(^SDEC(409.831,"ALOC",SDECSC)) S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0)) S SDECFOUND=$$CHKEVT1(SDECRES,SDECSTART,SDECPAT,SDECSTAT)
"RTN","SDEC25",178,0)
 I SDECFOUND D CHKEVT3(SDECRES) Q
"RTN","SDEC25",179,0)
 Q
"RTN","SDEC25",180,0)
 ;
"RTN","SDEC25",181,0)
CHKEVT1(SDECRES,SDECSTART,SDECPAT,SDECSTAT) ;
"RTN","SDEC25",182,0)
 ;Get appointment id in SDECAPT
"RTN","SDEC25",183,0)
 ;If found, call SDECNOS(SDECAPPT) and return 1
"RTN","SDEC25",184,0)
 ;else return 0
"RTN","SDEC25",185,0)
 N SDECFOUND,SDECAPPT
"RTN","SDEC25",186,0)
 S SDECFOUND=0
"RTN","SDEC25",187,0)
 Q:'+$G(SDECRES) SDECFOUND
"RTN","SDEC25",188,0)
 Q:'$D(^SDEC(409.84,"ARSRC",SDECRES,SDECSTART)) SDECFOUND
"RTN","SDEC25",189,0)
 S SDECAPPT=0 F  S SDECAPPT=$O(^SDEC(409.84,"ARSRC",SDECRES,SDECSTART,SDECAPPT)) Q:'+SDECAPPT  D  Q:SDECFOUND
"RTN","SDEC25",190,0)
 . S SDECNOD=$G(^SDEC(409.84,SDECAPPT,0)) Q:SDECNOD=""
"RTN","SDEC25",191,0)
 . I $P(SDECNOD,U,5)=SDECPAT,$P(SDECNOD,U,12)="" S SDECFOUND=1 Q
"RTN","SDEC25",192,0)
 I SDECFOUND,+$G(SDECAPPT) D SDECCHK(SDECAPPT,SDECSTAT)
"RTN","SDEC25",193,0)
 Q SDECFOUND
"RTN","SDEC25",194,0)
 ;
"RTN","SDEC25",195,0)
CHKEVT3(SDECRES) ;
"RTN","SDEC25",196,0)
 ;Call RaiseEvent to notify GUI clients
"RTN","SDEC25",197,0)
 ;
"RTN","SDEC25",198,0)
 Q
"RTN","SDEC25",199,0)
 N SDECRESN
"RTN","SDEC25",200,0)
 S SDECRESN=$G(^SDEC(409.831,SDECRES,0))
"RTN","SDEC25",201,0)
 Q:SDECRESN=""
"RTN","SDEC25",202,0)
 S SDECRESN=$P(SDECRESN,"^")
"RTN","SDEC25",203,0)
 ;D EVENT^SDEC23("SCHEDULE-"_SDECRESN,"","","")
"RTN","SDEC25",204,0)
 ;D EVENT^BMXMEVN("SDEC SCHEDULE",SDECRESN)
"RTN","SDEC25",205,0)
 Q
"RTN","SDEC25",206,0)
 ;
"RTN","SDEC25",207,0)
CHKEVTD(SDECPAT,SDECSTART,SDECSC) ;EP Called by SDEC CHECKIN APPOINTMENT event
"RTN","SDEC25",208,0)
 ;when  an appointment CHECKIN is deleted via.
"RTN","SDEC25",209,0)
 ;Deletes CHECKIN to and raises refresh event to running GUI clients
"RTN","SDEC25",210,0)
 ;
"RTN","SDEC25",211,0)
 ;
"RTN","SDEC25",212,0)
 Q:+$G(SDECNOEV)
"RTN","SDEC25",213,0)
 Q:'+$G(SDECSC)
"RTN","SDEC25",214,0)
 N SDECSTAT,SDECFOUND,SDECRES
"RTN","SDEC25",215,0)
 S SDECSTAT=""
"RTN","SDEC25",216,0)
 S:$G(SDATA("AFTER","STATUS"))'="CHECKED IN" SDECSTAT=$P(SDATA("AFTER","STATUS"),"^",4)
"RTN","SDEC25",217,0)
 I SDECSTAT="" S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0))
"RTN","SDEC25",218,0)
 I SDECRES D CHKEVT3(SDECRES) Q
"RTN","SDEC25",219,0)
 S SDECFOUND=0
"RTN","SDEC25",220,0)
 ;
"RTN","SDEC25",221,0)
 ;I $D(^SDEC(409.831,"ALOC",SDECSC)) S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0)) S SDECFOUND=$$CHKEVT1(SDECRES,SDECSTART,SDECPAT,SDECSTAT)
"RTN","SDEC25",222,0)
 ;I SDECFOUND D CHKEVT3(SDECRES) Q
"RTN","SDEC25",223,0)
 Q
"RTN","SDEC25",224,0)
 ;
"RTN","SDEC25",225,0)
 ;CHECK OUT APPOINTMENT - RPC
"RTN","SDEC25",226,0)
CHECKOUT(SDECY,DFN,SDT,SDCODT,SDECAPTID,VPRV) ;Check Out appointment
"RTN","SDEC25",227,0)
 ;CHECKOUT(SDECY,DFN,SDT,SDCODT,SDECAPTID,VPRV)  external parameter tag is in SDEC
"RTN","SDEC25",228,0)
 ; Returns   SDECY
"RTN","SDEC25",229,0)
 ; Input  -- DFN      Patient file IEN
"RTN","SDEC25",230,0)
 ;           SDT      Appointment Date/Time in FM format
"RTN","SDEC25",231,0)
 ;           SDCODT   Date/Time of Check Out FM FORMAT [REQUIRED]
"RTN","SDEC25",232,0)
 ;           SDECAPTID - Appointment ID
"RTN","SDEC25",233,0)
 ;           VPRV      - V Provider
"RTN","SDEC25",234,0)
 ;SETUP ERROR TRACKING
"RTN","SDEC25",235,0)
 N APIERR,CNT,ERR,%DT,X,Y
"RTN","SDEC25",236,0)
 N SDCL,SDASK,SDCOACT,SDCOALBF,SDDA,SDLNE,SDQUIET
"RTN","SDEC25",237,0)
 N SDECI,SDECNOD,RPCPERM
"RTN","SDEC25",238,0)
 S SDECI=0
"RTN","SDEC25",239,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC25",240,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC25",241,0)
 S ^TMP("SDEC",$J,0)="T00020ERRORID"_$C(30)
"RTN","SDEC25",242,0)
 S RPCPERM=""
"RTN","SDEC25",243,0)
 S RPCPERM=$$KCHK^XUSRB("SD SUPERVISOR",DUZ) I RPCPERM=0 D ERR("THE SD SUPERVISOR KEY IS REQUIRED TO PERFORM THIS ACTION.") Q
"RTN","SDEC25",244,0)
 I '+SDECAPTID D ERR("Invalid Appointment ID.") Q
"RTN","SDEC25",245,0)
 I '$D(^SDEC(409.84,SDECAPTID,0)) D ERR("Invalid Appointment ID.") Q
"RTN","SDEC25",246,0)
 ;INITIALIZE VARIABLES
"RTN","SDEC25",247,0)
 S %DT="T"
"RTN","SDEC25",248,0)
 S X=SDT
"RTN","SDEC25",249,0)
 D ^%DT   ; GET FM FORMAT FOR APPOINTMENT DATE/TIME
"RTN","SDEC25",250,0)
 S SDT=Y
"RTN","SDEC25",251,0)
 S X=SDCODT
"RTN","SDEC25",252,0)
 D ^%DT   ; GET FM FORMAT FOR CHECKOUT DATE/TIME
"RTN","SDEC25",253,0)
 ;ChecOut time cannot be in the future
"RTN","SDEC25",254,0)
 S SDCODT=Y
"RTN","SDEC25",255,0)
 I SDCODT>$$HTFM^XLFDT($H) D ERR("Check Out time cannot be in the future.") Q
"RTN","SDEC25",256,0)
 ;
"RTN","SDEC25",257,0)
 ;appointment record
"RTN","SDEC25",258,0)
 S SDECNOD=^SDEC(409.84,SDECAPTID,0)
"RTN","SDEC25",259,0)
 ;make sure CHECKOUT time is after CHECKIN time
"RTN","SDEC25",260,0)
 I SDCODT'>$P(SDECNOD,U,3) D ERR("Check Out time must be at least 1 minute after the Check In time of "_$TR($$FMTE^XLFDT($P(SDECNOD,U,3)),"@"," ")_".") Q   ;alb/sat 665
"RTN","SDEC25",261,0)
 ;Hospital Location of RESOURCE
"RTN","SDEC25",262,0)
 S SDECRES=$P(SDECNOD,U,7) ;RESOURCEID
"RTN","SDEC25",263,0)
 S SDECNOD=^SDEC(409.831,SDECRES,0)
"RTN","SDEC25",264,0)
 S SDCL=$P(SDECNOD,U,4) ;HOSPITAL LOCATION
"RTN","SDEC25",265,0)
 ;
"RTN","SDEC25",266,0)
 S SDDA=0
"RTN","SDEC25",267,0)
 S SDASK=0
"RTN","SDEC25",268,0)
 S SDCOALBF=""
"RTN","SDEC25",269,0)
 S SDCOACT="CO"
"RTN","SDEC25",270,0)
 S SDLNE=""
"RTN","SDEC25",271,0)
 S SDQUIET=1
"RTN","SDEC25",272,0)
 K APIERR
"RTN","SDEC25",273,0)
 S APIERR=0
"RTN","SDEC25",274,0)
 D CO^SDEC25A(DFN,SDT,SDCL,SDDA,SDASK,SDCODT,SDCOACT,SDLNE,.SDCOALBF,SDECAPTID,SDQUIET,VPRV,.APIERR) ;Appt Check Out
"RTN","SDEC25",275,0)
 ;ERROR(S) FOUND
"RTN","SDEC25",276,0)
 I APIERR>0 D
"RTN","SDEC25",277,0)
 . S CNT=""
"RTN","SDEC25",278,0)
 . F  S CNT=$O(APIERR(CNT)) Q:CNT=""  S ERR=APIERR(CNT) S SDECI=SDECI+1 D ERR(ERR)
"RTN","SDEC25",279,0)
 ;NO ERROR
"RTN","SDEC25",280,0)
 I APIERR<1 D
"RTN","SDEC25",281,0)
 . S SDECI=SDECI+1
"RTN","SDEC25",282,0)
 . S ^TMP("SDEC",$J,SDECI)="0"_$C(30)
"RTN","SDEC25",283,0)
 . S SDECI=SDECI+1
"RTN","SDEC25",284,0)
 . S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC25",285,0)
 Q
"RTN","SDEC25",286,0)
 ;
"RTN","SDEC25",287,0)
 ;CHECK OUT APPOINTMENT - RPC
"RTN","SDEC25",288,0)
CANCKOUT(SDECY,SDECAPTID) ;Cancel Check Out appointment
"RTN","SDEC25",289,0)
 ;CANCKOUT(SDECY,SDECAPTID)  external parameter tag is in SDEC
"RTN","SDEC25",290,0)
 ; Returns   SDECY
"RTN","SDEC25",291,0)
 ; Input  -- SDECAPTID - Appointment ID
"RTN","SDEC25",292,0)
 N APS,DA,DFN,DIE,DR,RES
"RTN","SDEC25",293,0)
 N SDCL,SDN,SDOE,SDT,SDV
"RTN","SDEC25",294,0)
 N SDECI,SDECNOD,RPCPERM
"RTN","SDEC25",295,0)
 S SDECI=0
"RTN","SDEC25",296,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC25",297,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC25",298,0)
 S ^TMP("SDEC",$J,0)="T00020ERRORID"_$C(30)
"RTN","SDEC25",299,0)
 S RPCPERM=""
"RTN","SDEC25",300,0)
 S RPCPERM=$$KCHK^XUSRB("SD SUPERVISOR",DUZ) I RPCPERM=0 D ERR("THE SD SUPERVISOR KEY IS REQUIRED TO PERFORM THIS ACTION.") Q
"RTN","SDEC25",301,0)
 I '+SDECAPTID D ERR("Invalid Appointment ID.") Q
"RTN","SDEC25",302,0)
 I '$D(^SDEC(409.84,SDECAPTID,0)) D ERR("Invalid Appointment ID.") Q
"RTN","SDEC25",303,0)
 S SDECNOD=^SDEC(409.84,SDECAPTID,0)
"RTN","SDEC25",304,0)
 S APS=$P(SDECNOD,U,19)
"RTN","SDEC25",305,0)
 S DFN=$P(SDECNOD,U,5)
"RTN","SDEC25",306,0)
 S SDT=$P(SDECNOD,U)
"RTN","SDEC25",307,0)
 S RES=$P(SDECNOD,U,7)
"RTN","SDEC25",308,0)
 S SDCL=$P(^SDEC(409.831,RES,0),U,4)
"RTN","SDEC25",309,0)
 I $P(SDECNOD,U,14)="" D ERR("Appointment is not Checked Out.") Q
"RTN","SDEC25",310,0)
 ; ^SDECAPPT: update piece 8: Data Entry Clerk; clear piece 14: CHECKOUT;
"RTN","SDEC25",311,0)
 S DIE="^SDEC(409.84,"
"RTN","SDEC25",312,0)
 S DA=SDECAPTID
"RTN","SDEC25",313,0)
 S DR=".14////@;.08///"_DUZ
"RTN","SDEC25",314,0)
 D ^DIE
"RTN","SDEC25",315,0)
 ; ^SC file 44: clear piece C;3: CHECKED OUT; clear piece C;4: CHECK OUT USER; clear C;6: CHECK OUT ENTERED
"RTN","SDEC25",316,0)
 S DIE="^SC("_SDCL_",""S"","_SDT_",1,"
"RTN","SDEC25",317,0)
 S DA(2)=SDCL,DA(1)=SDT,(DA,SDN)=$$SCIEN^SDECU2(DFN,SDCL,SDT)
"RTN","SDEC25",318,0)
 S DR="303///@;304///@;306///@"
"RTN","SDEC25",319,0)
 D ^DIE
"RTN","SDEC25",320,0)
 ; ^AUPNVSIT file 9000010: clear piece 18: CHECK OUT DATE&TIME
"RTN","SDEC25",321,0)
 S SDOE=$$GETAPT^SDVSIT2(DFN,SDT,SDCL)
"RTN","SDEC25",322,0)
 S SDV=$$GET1^DIQ(409.68,SDOE,.05,"I")
"RTN","SDEC25",323,0)
 I +SDV D
"RTN","SDEC25",324,0)
 . S DIE="^AUPNVSIT(",DA=SDV
"RTN","SDEC25",325,0)
 . S DR=".18///@"
"RTN","SDEC25",326,0)
 . D ^DIE
"RTN","SDEC25",327,0)
 ; ^SCE file 409.68: Set piece 12 back to CHECKED IN, pointer to APPOINTMENT STATUS file 409.63; clear piece 7: CHECK OUT PROCESS COMPLETION
"RTN","SDEC25",328,0)
 I +APS D
"RTN","SDEC25",329,0)
 . S DIE=409.68,DA=SDOE,DR=".07///@;.12///"_APS_";101///"_DUZ_";102///"_$$NOW^XLFDT
"RTN","SDEC25",330,0)
 . D ^DIE
"RTN","SDEC25",331,0)
 S SDECI=SDECI+1
"RTN","SDEC25",332,0)
 S ^TMP("SDEC",$J,SDECI)="0"_$C(30)
"RTN","SDEC25",333,0)
 S SDECI=SDECI+1
"RTN","SDEC25",334,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC25",335,0)
 Q
"RTN","SDEC25",336,0)
 ;
"RTN","SDEC25",337,0)
CANAPPT(SDECAPTID)  ;external call to cancel check out in SDEC APPOINTMENT called by SDCODEL for VistA Delete Check Out
"RTN","SDEC25",338,0)
 N APS,DA,DIE,DR,DFN,RES,SDCL,SDT
"RTN","SDEC25",339,0)
 N SDECNOD
"RTN","SDEC25",340,0)
 I '+$G(SDECAPTID) Q
"RTN","SDEC25",341,0)
 I '$D(^SDEC(409.84,+SDECAPTID,0)) Q
"RTN","SDEC25",342,0)
 S SDECNOD=^SDEC(409.84,SDECAPTID,0)
"RTN","SDEC25",343,0)
 S APS=$P(SDECNOD,U,19)
"RTN","SDEC25",344,0)
 S DFN=$P(SDECNOD,U,5)
"RTN","SDEC25",345,0)
 S SDT=$P(SDECNOD,U)
"RTN","SDEC25",346,0)
 S RES=$P(SDECNOD,U,7)
"RTN","SDEC25",347,0)
 S SDCL=$P(^SDEC(409.831,RES,0),U,4)
"RTN","SDEC25",348,0)
 I $P(SDECNOD,U,14)="" Q
"RTN","SDEC25",349,0)
 ; ^SDEC(409.84: update piece 8: Data Entry Clerk; clear piece 14: CHECKOUT;
"RTN","SDEC25",350,0)
 S DIE="^SDEC(409.84,"
"RTN","SDEC25",351,0)
 S DA=SDECAPTID
"RTN","SDEC25",352,0)
 S DR=".14////@;.08///"_DUZ
"RTN","SDEC25",353,0)
 D ^DIE
"RTN","SDEC25",354,0)
 Q
"RTN","SDEC25",355,0)
 ;
"RTN","SDEC25",356,0)
ERROR ;
"RTN","SDEC25",357,0)
 D ERR("VISTA Error")
"RTN","SDEC25",358,0)
 Q
"RTN","SDEC25",359,0)
 ;
"RTN","SDEC25",360,0)
ERR(ERRNO) ;Error processing
"RTN","SDEC25",361,0)
 S SDECI=SDECI+1
"RTN","SDEC25",362,0)
 S ^TMP("SDEC",$J,SDECI)=ERRNO_$C(30)
"RTN","SDEC25",363,0)
 S SDECI=SDECI+1
"RTN","SDEC25",364,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC25",365,0)
 Q
"RTN","SDEC55A")
0^9^B80956414^B79593054
"RTN","SDEC55A",1,0)
SDEC55A ;ALB/SAT - VISTA SCHEDULING RPCS ;NOV 05, 2015
"RTN","SDEC55A",2,0)
 ;;5.3;Scheduling;**627,671**;Aug 13, 1993;Build 25
"RTN","SDEC55A",3,0)
 ;
"RTN","SDEC55A",4,0)
 Q
"RTN","SDEC55A",5,0)
 ;
"RTN","SDEC55A",6,0)
APPSDGET(SDECY,MAXREC,LASTSUB,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,SDIEN)  ;GET appointment data from SDEC APPOINTMENT file 409.84
"RTN","SDEC55A",7,0)
 ;APPSDGET(.SDECY,MAXREC,LASTSUB,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,SDIEN)  external parameter tag is in SDEC
"RTN","SDEC55A",8,0)
 ;INPUT:
"RTN","SDEC55A",9,0)
 ; 1. MAXREC = (optional) Max records returned default to all
"RTN","SDEC55A",10,0)
 ; 2. LASTSUB = (optional) last subscripts from previous call
"RTN","SDEC55A",11,0)
 ; 3. SDBEG = (optional) Begin Date range in external format
"RTN","SDEC55A",12,0)
 ;                    Default to all dates
"RTN","SDEC55A",13,0)
 ; 4. SDEND = (optional) End Date range in external format
"RTN","SDEC55A",14,0)
 ;                    Default to all dates
"RTN","SDEC55A",15,0)
 ; 5. NOTEFLG = (optional) 1=do NOT return NOTE text
"RTN","SDEC55A",16,0)
 ;                      0=return NOTE text
"RTN","SDEC55A",17,0)
 ; 6. SDRES = (optional) Resource ID pointer to SDEC RESOURCE file
"RTN","SDEC55A",18,0)
 ;                    Default to all resources
"RTN","SDEC55A",19,0)
 ; 7. DFN = (optional) pointer to PATIENT file 2
"RTN","SDEC55A",20,0)
 ;                  Default to all patients
"RTN","SDEC55A",21,0)
 ; 8. SDID = (optional) external ID (free-text)
"RTN","SDEC55A",22,0)
 ;                   Default to all external IDs
"RTN","SDEC55A",23,0)
 ; 9. SDIEN = (optional) pointer to SDEC APPOINTMENT file 409.84
"RTN","SDEC55A",24,0)
 ;RETURN:
"RTN","SDEC55A",25,0)
 ; Successful Return:
"RTN","SDEC55A",26,0)
 ; Global Array in which each array entry contains data from the
"RTN","SDEC55A",27,0)
 ; SDEC APPOINTMENT file 409.84.
"RTN","SDEC55A",28,0)
 ; Data is separated by ^:
"RTN","SDEC55A",29,0)
 ; 1. IEN - pointer to SDEC APPOINTMENT file
"RTN","SDEC55A",30,0)
 ; 2. DATE1 - STARTTIME in external format   .01
"RTN","SDEC55A",31,0)
 ; 3. DATE2 - ENDTIME in external format     .02
"RTN","SDEC55A",32,0)
 ; 4. CHECKIN_TIME - CHECKIN date/time in external format   .03
"RTN","SDEC55A",33,0)
 ; 5. DATE - CHECK IN TIME ENTERED - date/time in external format   .04
"RTN","SDEC55A",34,0)
 ; 6. DFN - Patient ID      .05
"RTN","SDEC55A",35,0)
 ; 7. NAME - Patient NAME   .05
"RTN","SDEC55A",36,0)
 ; 8. SDEC_ACCESS_TYPE_IEN - <not used>
"RTN","SDEC55A",37,0)
 ; 9. SDEC_ACCESS_TYPE_NAME - <not used>
"RTN","SDEC55A",38,0)
 ; 10. RESOURCEID - Pointer to the SDEC RESOURCE file
"RTN","SDEC55A",39,0)
 ; 11. RESOURCE_NAME - NAME from SDEC RESOURCE file
"RTN","SDEC55A",40,0)
 ; 12. USERIEN - DATA ENTRY CLERK id pointer to NEW PERSON file
"RTN","SDEC55A",41,0)
 ; 13. USERNAME - DATA ENTRY CLERK name from NEW PERSON file
"RTN","SDEC55A",42,0)
 ; 14. DATE3 - DATE APPT MADE in external format
"RTN","SDEC55A",43,0)
 ; 15. NOSHOW - NOSHOW flag 1=YES; 0=NO default to no
"RTN","SDEC55A",44,0)
 ; 16. DATE4 - NOSHOW DATETIME in external format
"RTN","SDEC55A",45,0)
 ; 17. USERIEN1 - NOSHOW BY USER id pointer to NEW PERSON file
"RTN","SDEC55A",46,0)
 ; 18. USERNAME1 - NOSHOW BY USER name from NEW PERSON file
"RTN","SDEC55A",47,0)
 ; 19. DATE5 - REBOOK DATETIME in external format
"RTN","SDEC55A",48,0)
 ; 20. DATE6 - CANCEL DATETIME in external format
"RTN","SDEC55A",49,0)
 ; 21. USERIEN2 - CANCELLED BY USER id pointer to NEW PERSON file
"RTN","SDEC55A",50,0)
 ; 22. USERNAME2 - CANCELLED BY USER name from NEW PERSON file
"RTN","SDEC55A",51,0)
 ; 23. CANCELLATION_REASONS_IEN - CANCELLATION REASON id pointer
"RTN","SDEC55A",52,0)
 ;                            to CANCELLATION REASONS file 409.2
"RTN","SDEC55A",53,0)
 ; 24. CANCELLATION_REASONS_NAME - CANCELLATION REASON name from
"RTN","SDEC55A",54,0)
 ;                            CANCELLATION REASONS file
"RTN","SDEC55A",55,0)
 ; 25. WALKIN - WALKIN flag y=YES; n=NO default to NO
"RTN","SDEC55A",56,0)
 ; 26. CHECKOUT - CHECKOUT date/time in external format
"RTN","SDEC55A",57,0)
 ; 27. V_PROVIDER_IEN - V PROVIDER IEN id pointer to
"RTN","SDEC55A",58,0)
 ;                      V PROVIDER file
"RTN","SDEC55A",59,0)
 ; 28. V_PROVIDER_NAME - V PROVIDER name from V PROVIDER FILE
"RTN","SDEC55A",60,0)
 ; 29. PROVIEN - PROVIDER id pointer to NEW PERSON file
"RTN","SDEC55A",61,0)
 ; 30. PROVNAME - PROVIDER name from NEW PERSON file
"RTN","SDEC55A",62,0)
 ; 31. STATUS - STATUS set of codes
"RTN","SDEC55A",63,0)
 ;              valid values in external form are:
"RTN","SDEC55A",64,0)
 ;                NO-SHOW
"RTN","SDEC55A",65,0)
 ;                CLINIC
"RTN","SDEC55A",66,0)
 ;                NO-SHOW & AUTO RE-BOOK
"RTN","SDEC55A",67,0)
 ;                CANCELLED BY CLINIC & AUTO RE-BOOK
"RTN","SDEC55A",68,0)
 ;                INPATIENT APPOINTMENT
"RTN","SDEC55A",69,0)
 ;                CANCELLED BY PATIENT
"RTN","SDEC55A",70,0)
 ;                CANCELLED BY PATIENT & AUTO-REBOOK
"RTN","SDEC55A",71,0)
 ;                NO ACTION TAKEN
"RTN","SDEC55A",72,0)
 ; 32. APPTLEN - LENGTH OF APPT numeric 5-120
"RTN","SDEC55A",73,0)
 ; 33. APPT_STAT_IEN - PREV APPT STATUS id pointer to
"RTN","SDEC55A",74,0)
 ;                     APPOINTMENT STATUS file 409.63
"RTN","SDEC55A",75,0)
 ; 34. APPT_STAT_NAME - PREV APPT STATUS name from
"RTN","SDEC55A",76,0)
 ;                      APPOINTMENT STATUS file
"RTN","SDEC55A",77,0)
 ; 35. DAPTDT - DESIRED DATE OF APPOINTMENT in external format
"RTN","SDEC55A",78,0)
 ; 36. SDID - EXTERNAL ID free-text
"RTN","SDEC55A",79,0)
 ; 37. SDAPTYP - APPT REQUEST TYPE - variable pointer pointer
"RTN","SDEC55A",80,0)
 ;               to one of these files:
"RTN","SDEC55A",81,0)
 ;                SD WAIT LIST - E|<WL IEN> E|123
"RTN","SDEC55A",82,0)
 ;                REQUEST/CONSULTATION - C|<CONSULT IEN> C|123
"RTN","SDEC55A",83,0)
 ;                RECALL REMINDERS - R|^<RECALL IEN> R|123
"RTN","SDEC55A",84,0)
 ; 38. NOTE - NOTE free-text converted from Word Processing
"RTN","SDEC55A",85,0)
 ;            field. May contain Carriage return/line feed
"RTN","SDEC55A",86,0)
 ;            characters
"RTN","SDEC55A",87,0)
 ; 39. EESTAT - Patient Status  N=NEW  E=ESTABLISHED
"RTN","SDEC55A",88,0)
 ; 40. APPTTYPE_IEN - pointer to the APPOINTMENT TYPE file
"RTN","SDEC55A",89,0)
 ; 41. APPTTYPE_NAME - name from the APPOINTMENT TYPE file
"RTN","SDEC55A",90,0)
 ;
"RTN","SDEC55A",91,0)
 N SD1,SD2,SDAPP,SDECI,SDI,SDJ,SDTMP,X,Y,%DT
"RTN","SDEC55A",92,0)
 S SDECY="^TMP(""SDEC55A"","_$J_",""APPSDGET"")"
"RTN","SDEC55A",93,0)
 K @SDECY
"RTN","SDEC55A",94,0)
 S SDECI=0
"RTN","SDEC55A",95,0)
 ;              1         2           3           4                  5          6         7
"RTN","SDEC55A",96,0)
 S SDTMP="T00030IEN^T00030DATE1^T00030DATE2^T00030CHECKIN_TIME^T00030DATE^T00030DFN^T00030NAME"
"RTN","SDEC55A",97,0)
 ;                     8                          9                           10               11
"RTN","SDEC55A",98,0)
 S SDTMP=SDTMP_"^T00030SDEC_ACCESS_TYPE_IEN^T00030SDEC_ACCESS_TYPE_NAME^T00030RESOURCEID^T00030RESOURCE_NAME"
"RTN","SDEC55A",99,0)
 ;                     12            13             14          15           16          17             18
"RTN","SDEC55A",100,0)
 S SDTMP=SDTMP_"^T00030USERIEN^T00030USERNAME^T00030DATE3^T00030NOSHOW^T00030DATE4^T00030USERIEN1^T00030USERNAME1"
"RTN","SDEC55A",101,0)
 ;                     19          20          21             22              23
"RTN","SDEC55A",102,0)
 S SDTMP=SDTMP_"^T00030DATE5^T00030DATE6^T00030USERIEN2^T00030USERNAME2^T00030CANCELLATION_REASONS_IEN"
"RTN","SDEC55A",103,0)
 ;                     24                              25           26             27                   28
"RTN","SDEC55A",104,0)
 S SDTMP=SDTMP_"^T00030CANCELLATION_REASONS_NAME^T00030WALKIN^T00030CHECKOUT^T00030V_PROVIDER_IEN^T00030V_PROVIDER_NAME"
"RTN","SDEC55A",105,0)
 ;                     29            30             31           32            33                  34
"RTN","SDEC55A",106,0)
 S SDTMP=SDTMP_"^T00030PROVIEN^T00030PROVNAME^T00030STATUS^T00030APPTLEN^T00030APPT_STAT_IEN^T00030APPT_STAT_NAME"
"RTN","SDEC55A",107,0)
 ;                     35           36         37            38
"RTN","SDEC55A",108,0)
 S SDTMP=SDTMP_"^T00030DAPTDT^T00030SDID^T00030SDAPTYP^T00200NOTE^T00030EESTAT^T00030APPTTYPE_IEN^T00030APPTTYPE_NAME"
"RTN","SDEC55A",109,0)
 S @SDECY@(SDECI)=SDTMP_$C(30)
"RTN","SDEC55A",110,0)
 ;validate MAXREC - optional
"RTN","SDEC55A",111,0)
 S MAXREC=$G(MAXREC)
"RTN","SDEC55A",112,0)
 I MAXREC'="" I '+MAXREC S MAXREC=""
"RTN","SDEC55A",113,0)
 ;validate LASTSUB - optional
"RTN","SDEC55A",114,0)
 S LASTSUB=$G(LASTSUB)
"RTN","SDEC55A",115,0)
 S SD1=$P(LASTSUB,"|",1),SD2=$P(LASTSUB,"|",2)
"RTN","SDEC55A",116,0)
 I SD2'="" I SDID="" S SD1=SD1-.0001
"RTN","SDEC55A",117,0)
 ;validate SDBEG - optional
"RTN","SDEC55A",118,0)
 S SDBEG=$G(SDBEG)
"RTN","SDEC55A",119,0)
 I $G(SDBEG)'="" S %DT="" S X=$P($G(SDBEG),"@",1) D ^%DT S SDBEG=Y I Y=-1 D ERR1^SDECERR(-1,"Invalid begin date/time.",SDECI,SDECY) Q
"RTN","SDEC55A",120,0)
 I SDBEG="" S SDBEG=1000101
"RTN","SDEC55A",121,0)
 ;validate SDEND - optional
"RTN","SDEC55A",122,0)
 S SDEND=$G(SDEND)
"RTN","SDEC55A",123,0)
 I $G(SDEND)'="" S %DT="" S X=$P($G(SDEND),"@",1) D ^%DT S SDEND=Y_".2359" I Y=-1 D ERR1^SDECERR(-1,"Invalid end date/time.",SDECI,SDECY) Q
"RTN","SDEC55A",124,0)
 I SDEND="" S SDEND=9991231.2359
"RTN","SDEC55A",125,0)
 ;validate NOTEFLG - optional
"RTN","SDEC55A",126,0)
 S NOTEFLG=$S($G(NOTEFLG)=1:1,1:0)
"RTN","SDEC55A",127,0)
 ;validate SDRES -optional
"RTN","SDEC55A",128,0)
 S SDRES=$G(SDRES)
"RTN","SDEC55A",129,0)
 I SDRES'="" I '$D(^SDEC(409.831,SDRES,0)) D ERR1^SDECERR(-1,"Invalid resource ID.",SDECI,SDECY) Q
"RTN","SDEC55A",130,0)
 ;validate DFN -optional
"RTN","SDEC55A",131,0)
 S DFN=$G(DFN)
"RTN","SDEC55A",132,0)
 I DFN'="" I '$D(^DPT(DFN,0)) D ERR1^SDECERR(-1,"Invalid patient ID.",SDECI,SDECY) Q
"RTN","SDEC55A",133,0)
 ;validate SDID - optional
"RTN","SDEC55A",134,0)
 S SDID=$G(SDID)
"RTN","SDEC55A",135,0)
 ;validate SDIEN - optional
"RTN","SDEC55A",136,0)
 S SDIEN=$G(SDIEN)
"RTN","SDEC55A",137,0)
 I SDIEN'="",'$D(^SDEC(409.84,SDIEN,0)) D ERR1^SDECERR(-1,"Invalid ID.",SDECI,SDECY) Q
"RTN","SDEC55A",138,0)
 I SDIEN'="" D GET1(SDIEN,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,.SDECI,SDECY)
"RTN","SDEC55A",139,0)
 G:SDIEN'="" GETX
"RTN","SDEC55A",140,0)
 ;look in external id xref AEX
"RTN","SDEC55A",141,0)
 I SDID'="" D
"RTN","SDEC55A",142,0)
 .S SDAPP=$S(SD1'="":SD1,1:0) F  S SDAPP=$O(^SDEC(409.84,"AEX",SDID,SDAPP)) Q:SDAPP'>0  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDAPP Q
"RTN","SDEC55A",143,0)
 ..D GET1(SDAPP,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,.SDECI,SDECY)
"RTN","SDEC55A",144,0)
 G:SDID'="" GETX
"RTN","SDEC55A",145,0)
 ;look in patient xref CPAT
"RTN","SDEC55A",146,0)
 I DFN'="" D
"RTN","SDEC55A",147,0)
 .S SDAPP=$S(SD1'="":SD1,1:0) F  S SDAPP=$O(^SDEC(409.84,"CPAT",DFN,SDAPP)) Q:SDAPP'>0  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDAPP Q
"RTN","SDEC55A",148,0)
 ..D GET1(SDAPP,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,.SDECI,SDECY)
"RTN","SDEC55A",149,0)
 G:DFN'="" GETX
"RTN","SDEC55A",150,0)
 ;look in resource xref ARSRC
"RTN","SDEC55A",151,0)
 I SDRES'="" D
"RTN","SDEC55A",152,0)
 .S SDI=$S(SD1'="":SD1,1:SDBEG) F  S SDI=$O(^SDEC(409.84,"ARSRC",SDRES,SDI)) Q:SDI'>0  Q:SDI>SDEND  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDI_"|"_SDAPP Q
"RTN","SDEC55A",153,0)
 ..S SDAPP=$S(SD2'="":SD2,1:0) S SD2=0 F  S SDAPP=$O(^SDEC(409.84,"ARSRC",SDRES,SDI,SDAPP)) Q:SDAPP'>0  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDI_"|"_SDAPP Q
"RTN","SDEC55A",154,0)
 ...D GET1(SDAPP,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,.SDECI,SDECY)
"RTN","SDEC55A",155,0)
 G:SDRES'="" GETX
"RTN","SDEC55A",156,0)
 ;look in start time xref B
"RTN","SDEC55A",157,0)
 S SDI=$S(SD1'="":SD1,1:SDBEG) F  S SDI=$O(^SDEC(409.84,"B",SDI)) Q:SDI'>0  Q:SDI>SDEND  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDI_"|"_SDAPP Q
"RTN","SDEC55A",158,0)
 .S SDAPP=$S(SD2'="":SD2,1:0) S SD2=0 F  S SDAPP=$O(^SDEC(409.84,"B",SDI,SDAPP)) Q:SDAPP'>0  D  I +MAXREC,SDECI>=MAXREC S LASTSUB=SDI_"|"_SDAPP Q
"RTN","SDEC55A",159,0)
 ..D GET1(SDAPP,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,.SDECI,SDECY)
"RTN","SDEC55A",160,0)
GETX  S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDEC55A",161,0)
 Q
"RTN","SDEC55A",162,0)
GET1(SDAPP,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,SDECI,SDECY) ;get 1 appointment record
"RTN","SDEC55A",163,0)
 ;INPUT:
"RTN","SDEC55A",164,0)
 ; SDAPP - appointment ID pointer to SDEC APPOINTMENT file 409.84
"RTN","SDEC55A",165,0)
 N SDA,SDDATA,SDNOTE,SDRET,SDTYP,SDX,SDY
"RTN","SDEC55A",166,0)
 S SDBEG=$G(SDBEG)
"RTN","SDEC55A",167,0)
 S SDEND=$G(SDEND)
"RTN","SDEC55A",168,0)
 S NOTEFLG=$G(NOTEFLG)
"RTN","SDEC55A",169,0)
 S SDRES=$G(SDRES)
"RTN","SDEC55A",170,0)
 S DFN=$G(DFN)
"RTN","SDEC55A",171,0)
 S SDID=$G(SDID)
"RTN","SDEC55A",172,0)
 S SDECI=$G(SDECI)
"RTN","SDEC55A",173,0)
 S SDECY=$G(SDECY)
"RTN","SDEC55A",174,0)
 D GETS^DIQ(409.84,SDAPP_",",".01:.23","IE","SDDATA")
"RTN","SDEC55A",175,0)
 S SDA="SDDATA(409.84,"""_SDAPP_","")"
"RTN","SDEC55A",176,0)
 S $P(SDRET,U,1)=SDAPP           ;ien
"RTN","SDEC55A",177,0)
 S $P(SDRET,U,2)=@SDA@(.01,"E")  ;start time
"RTN","SDEC55A",178,0)
 Q:(SDBEG'="")&($P(@SDA@(.01,"I"),".",1)<$P(SDBEG,".",1))
"RTN","SDEC55A",179,0)
 S $P(SDRET,U,3)=@SDA@(.02,"E")  ;end time
"RTN","SDEC55A",180,0)
 Q:(SDEND'="")&($P(@SDA@(.02,"I"),".",1)>$P(SDEND,".",1))
"RTN","SDEC55A",181,0)
 S $P(SDRET,U,4)=@SDA@(.03,"E")  ;check in time
"RTN","SDEC55A",182,0)
 S $P(SDRET,U,5)=@SDA@(.04,"E")  ;check in time entered
"RTN","SDEC55A",183,0)
 S $P(SDRET,U,6)=@SDA@(.05,"I")  ;patient ID
"RTN","SDEC55A",184,0)
 Q:(DFN'="")&($P(SDRET,U,6)'=DFN)
"RTN","SDEC55A",185,0)
 S $P(SDRET,U,7)=@SDA@(.05,"E")  ;patient NAME
"RTN","SDEC55A",186,0)
 S ($P(SDRET,U,40),$P(SDRET,U,8))=@SDA@(.06,"I")  ;appointment type ID
"RTN","SDEC55A",187,0)
 S ($P(SDRET,U,41),$P(SDRET,U,9))=@SDA@(.06,"E")  ;appointment type NAME
"RTN","SDEC55A",188,0)
 S $P(SDRET,U,10)=@SDA@(.07,"I")  ;resource ID
"RTN","SDEC55A",189,0)
 Q:(SDRES'="")&($P(SDRET,U,10)'=SDRES)
"RTN","SDEC55A",190,0)
 S $P(SDRET,U,11)=@SDA@(.07,"E")  ;resource NAME
"RTN","SDEC55A",191,0)
 S $P(SDRET,U,12)=@SDA@(.08,"I")  ;data entry clerk ID
"RTN","SDEC55A",192,0)
 S $P(SDRET,U,13)=@SDA@(.08,"E")  ;data entry clerk NAME
"RTN","SDEC55A",193,0)
 S $P(SDRET,U,14)=@SDA@(.09,"E")  ;date appointment made
"RTN","SDEC55A",194,0)
 S $P(SDRET,U,15)=@SDA@(.1,"E")   ;noshow flag
"RTN","SDEC55A",195,0)
 S $P(SDRET,U,16)=@SDA@(.101,"E") ;no show date time
"RTN","SDEC55A",196,0)
 S $P(SDRET,U,17)=@SDA@(.102,"I") ;no show by user ID
"RTN","SDEC55A",197,0)
 S $P(SDRET,U,18)=@SDA@(.102,"E") ;no show by user NAME
"RTN","SDEC55A",198,0)
 S $P(SDRET,U,19)=@SDA@(.11,"E") ;rebook date time
"RTN","SDEC55A",199,0)
 S $P(SDRET,U,20)=@SDA@(.12,"E") ;cancel date time
"RTN","SDEC55A",200,0)
 S $P(SDRET,U,21)=@SDA@(.121,"I") ;cancelled by user ID
"RTN","SDEC55A",201,0)
 S $P(SDRET,U,22)=@SDA@(.121,"E") ;cancelled by user NAME
"RTN","SDEC55A",202,0)
 S $P(SDRET,U,23)=@SDA@(.122,"I") ;cancellation reason ID
"RTN","SDEC55A",203,0)
 S $P(SDRET,U,24)=@SDA@(.122,"E") ;cancellation reason NAME
"RTN","SDEC55A",204,0)
 S $P(SDRET,U,25)=@SDA@(.13,"E")  ;walk-in
"RTN","SDEC55A",205,0)
 S $P(SDRET,U,26)=@SDA@(.14,"E")  ;check-out date/time
"RTN","SDEC55A",206,0)
 S $P(SDRET,U,27)=@SDA@(.15,"I")  ;v provider ID
"RTN","SDEC55A",207,0)
 S $P(SDRET,U,28)=@SDA@(.15,"E")  ;v provider NAME
"RTN","SDEC55A",208,0)
 S $P(SDRET,U,29)=@SDA@(.16,"I")  ;provider ID
"RTN","SDEC55A",209,0)
 S $P(SDRET,U,30)=@SDA@(.16,"E")  ;provider NAME
"RTN","SDEC55A",210,0)
 S $P(SDRET,U,31)=@SDA@(.17,"E")  ;status
"RTN","SDEC55A",211,0)
 S $P(SDRET,U,32)=@SDA@(.18,"E")  ;length of appt
"RTN","SDEC55A",212,0)
 S $P(SDRET,U,33)=@SDA@(.19,"I")  ;prev appt status ID
"RTN","SDEC55A",213,0)
 S $P(SDRET,U,34)=@SDA@(.19,"E")  ;prev appt status NAME
"RTN","SDEC55A",214,0)
 S $P(SDRET,U,35)=@SDA@(.2,"E")   ;desired date of appointment
"RTN","SDEC55A",215,0)
 S $P(SDRET,U,36)=@SDA@(.21,"E")  ;external id
"RTN","SDEC55A",216,0)
 Q:(SDID'="")&($P(SDRET,U,36)'=SDID)
"RTN","SDEC55A",217,0)
 S SDX=@SDA@(.22,"I") S SDY=$P(SDX,";",2)
"RTN","SDEC55A",218,0)
 S SDTYP=$S(SDY="SDWL(409.3,":"E|",SDY="GMR(123,":"C|",SDY="SD(403.5,":"R|",SDY="SDEC(409.85,":"A|",1:"")_$P(SDX,";",1)  ;appt request type
"RTN","SDEC55A",219,0)
 S $P(SDRET,U,37)=SDTYP
"RTN","SDEC55A",220,0)
 ;
"RTN","SDEC55A",221,0)
 N SDECIEN
"RTN","SDEC55A",222,0)
 S SDNOTE=""
"RTN","SDEC55A",223,0)
 I 'NOTEFLG I $D(^SDEC(409.84,SDAPP,1)) D
"RTN","SDEC55A",224,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.84,SDAPP,1,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC55A",225,0)
 . . S SDNOTE=SDNOTE_$G(^SDEC(409.84,SDAPP,1,SDECIEN,0))
"RTN","SDEC55A",226,0)
 . . S SDNOTE=SDNOTE_$C(13)_$C(10)
"RTN","SDEC55A",227,0)
 S $P(SDRET,U,38)=SDNOTE
"RTN","SDEC55A",228,0)
 S $P(SDRET,U,39)=@SDA@(.23,"E")  ;patient status
"RTN","SDEC55A",229,0)
 S SDECI=SDECI+1 S @SDECY@(SDECI)=SDRET_$C(30)
"RTN","SDEC55A",230,0)
 K SDDATA
"RTN","SDEC55A",231,0)
 Q
"RTN","SDEC671")
0^^B40695301^n/a
"RTN","SDEC671",1,0)
SDEC671 ;OAK/MKO-POST INSTALL FOR SD*5.3*671 ;12:33 PM  23 Jun 2017
"RTN","SDEC671",2,0)
 ;;5.3;Scheduling;**671**;Aug 13, 1993;Build 25
"RTN","SDEC671",3,0)
 Q
"RTN","SDEC671",4,0)
 ;
"RTN","SDEC671",5,0)
POST ;Entry point for Post InstalL
"RTN","SDEC671",6,0)
 D ADDPROT
"RTN","SDEC671",7,0)
 D TRANSFER
"RTN","SDEC671",8,0)
 D POST2
"RTN","SDEC671",9,0)
 Q
"RTN","SDEC671",10,0)
 ;
"RTN","SDEC671",11,0)
ADDPROT ;Link OR and SD protocols
"RTN","SDEC671",12,0)
 N RET
"RTN","SDEC671",13,0)
 D BMES^XPDUTL("Adding Protocol 'OR RECEIVE' to the protocol 'SD EVSEND OR'.")
"RTN","SDEC671",14,0)
 S RET=$$ADD^XPDPROT("SD EVSEND OR","OR RECEIVE","",1)
"RTN","SDEC671",15,0)
 D:'RET MES^XPDUTL("ERROR: "_$P(RET,"^",2)_" **")
"RTN","SDEC671",16,0)
 ;
"RTN","SDEC671",17,0)
 D BMES^XPDUTL("Adding Protocol 'OCX ORDER CHECK HL7 RECIEVE' to the protocol 'SD EVSEND OR'.")
"RTN","SDEC671",18,0)
 S RET=$$ADD^XPDPROT("SD EVSEND OR","OCX ORDER CHECK HL7 RECIEVE","",1)
"RTN","SDEC671",19,0)
 D:'RET MES^XPDUTL("ERROR: "_$P(RET,"^",2)_" **")
"RTN","SDEC671",20,0)
 ;
"RTN","SDEC671",21,0)
 I $$PATCH^XPDUTL("OR*3.0*434") D
"RTN","SDEC671",22,0)
 .D BMES^XPDUTL("Adding Protocol 'SD RECEIVE OR' to the protocol 'OR EVSEND SD'.")
"RTN","SDEC671",23,0)
 .S RET=$$ADD^XPDPROT("OR EVSEND SD","SD RECEIVE OR","",1)
"RTN","SDEC671",24,0)
 .D:'RET MES^XPDUTL("ERROR: "_$P(RET,"^",2)_" **")
"RTN","SDEC671",25,0)
 Q
"RTN","SDEC671",26,0)
 ;
"RTN","SDEC671",27,0)
TRANSFER ;Copy data from File #409.85 to #409.86
"RTN","SDEC671",28,0)
 N PATCH,STUS
"RTN","SDEC671",29,0)
 S PATCH=$O(^XPD(9.7,"B","SD*5.3*671",""),-1) I PATCH>0 D
"RTN","SDEC671",30,0)
 .S STUS=$$GET1^DIQ(9,7,PATCH,.02,"I")
"RTN","SDEC671",31,0)
 .I STUS=3 D BMES^XPDUTL("POST-INIT routine has already run!")
"RTN","SDEC671",32,0)
 Q:$G(STUS)=3
"RTN","SDEC671",33,0)
 I $G(^XTMP("SDEC671")) D
"RTN","SDEC671",34,0)
 .D BMES^XPDUTL("POST-INIT routine already started, PLEASE refer to patch instructions to restart!")
"RTN","SDEC671",35,0)
 Q:$G(^XTMP("SDEC671"))
"RTN","SDEC671",36,0)
 N CA85,CDT85,CLM85,CN85,CR85,CU85,DFN85
"RTN","SDEC671",37,0)
 S ^XTMP("SDEC671")=""
"RTN","SDEC671",38,0)
 ;
"RTN","SDEC671",39,0)
 ;Loop through entries in file #409.85
"RTN","SDEC671",40,0)
 S DFN85=0 F  S DFN85=$O(^SDEC(409.85,"B",DFN85)) Q:DFN85'>0  D
"RTN","SDEC671",41,0)
 .S IEN85="" F  S IEN85=$O(^SDEC(409.85,"B",DFN85,IEN85)) Q:IEN85=""  D
"RTN","SDEC671",42,0)
 ..N FDA,SEQ,MSG,DIERR,DIMSG,R85
"RTN","SDEC671",43,0)
 ..S R85=$G(^SDEC(409.85,IEN85,0)) Q:R85=""
"RTN","SDEC671",44,0)
 ..Q:$P($G(R85),"^",17)'="O"  ;Current status (#23)
"RTN","SDEC671",45,0)
 ..Q:DFN85'=$P(R85,"^")
"RTN","SDEC671",46,0)
 ..Q:$O(^SDEC(409.85,IEN85,4,0))'>0  ;Patient contact multiple (#44)
"RTN","SDEC671",47,0)
 ..;
"RTN","SDEC671",48,0)
 ..;Set FDA for top level fields of File #409.86
"RTN","SDEC671",49,0)
 ..S FDA(409.86,"+1,",.01)=DFN85 ;Patient
"RTN","SDEC671",50,0)
 ..S FDA(409.86,"+1,",1)=$P(R85,"^",9) ;Req specific clinic (#8,P44) -> Clinic
"RTN","SDEC671",51,0)
 ..S FDA(409.86,"+1,",2)=$P(R85,"^",16) ;CID/Preferred Date of Appt (#22) -> Preferred date
"RTN","SDEC671",52,0)
 ..S FDA(409.86,"+1,",2.1)=$P(R85,"^",5) ;Request type (#4) -> Request type
"RTN","SDEC671",53,0)
 ..S FDA(409.86,"+1,",2.2)=1 ;Sequence
"RTN","SDEC671",54,0)
 ..S FDA(409.86,"+1,",1.1)=$P(R85,"^",4) ;Req service/specialty (#8.5,P40.7) -> Service
"RTN","SDEC671",55,0)
 ..;
"RTN","SDEC671",56,0)
 ..;Loop through PATIENT CONTACT multiple (#44) of File #409.85 and set FDA array
"RTN","SDEC671",57,0)
 ..;for the DATE/TIME of CONTACT multiple (#3) of File #409.86
"RTN","SDEC671",58,0)
 ..S SEQ=1
"RTN","SDEC671",59,0)
 ..S CN85="" F  S CN85=$O(^SDEC(409.85,IEN85,4,CN85)) Q:CN85'>0  D
"RTN","SDEC671",60,0)
 ...S CR85=$G(^SDEC(409.85,IEN85,4,CN85,0)) Q:CR85=""
"RTN","SDEC671",61,0)
 ...S CDT85=$P(CR85,"^") Q:CDT85=""  ;Date entered (#.01)
"RTN","SDEC671",62,0)
 ...S CU85=$P(CR85,"^",2) Q:CU85=""  ;Entered by user (#2,P200)
"RTN","SDEC671",63,0)
 ...S CA85=$P(CR85,"^",3) Q:CA85=""  ;Action (#3)
"RTN","SDEC671",64,0)
 ...S CLM85="" I CA85="M" S CA85="C",CLM85=1
"RTN","SDEC671",65,0)
 ...;
"RTN","SDEC671",66,0)
 ...S SEQ=SEQ+1
"RTN","SDEC671",67,0)
 ...S IENS="+"_SEQ_",+1,"
"RTN","SDEC671",68,0)
 ...S FDA(409.863,IENS,.01)=$P(CR85,"^")
"RTN","SDEC671",69,0)
 ...S FDA(409.863,IENS,1)=CA85 ;Contact type
"RTN","SDEC671",70,0)
 ...S:SEQ=2 FDA(409.863,IENS,2)=$P(R85,"^",18) ;Comments from top level #409.85,25 -> Comments
"RTN","SDEC671",71,0)
 ...S FDA(409.863,IENS,3)=CLM85 ;Left message
"RTN","SDEC671",72,0)
 ...S FDA(409.863,IENS,4)=SEQ-1 ;Sequence
"RTN","SDEC671",73,0)
 ...S FDA(409.863,IENS,5)=CU85 ;User entered contact
"RTN","SDEC671",74,0)
 ...S FDA(409.863,IENS,6)=CDT85 ;Date/time entered
"RTN","SDEC671",75,0)
 ..;
"RTN","SDEC671",76,0)
 ..S ^XTMP("SDEC671")=DFN85_"^"_IEN85
"RTN","SDEC671",77,0)
 ..D UPDATE^DIE("","FDA","","MSG")
"RTN","SDEC671",78,0)
 Q
"RTN","SDEC671",79,0)
 ;
"RTN","SDEC671",80,0)
RESTART ;Copy data from File #409.85 to #409.86
"RTN","SDEC671",81,0)
 N CA85,CDT85,CLM85,CN85,CR85,CU85,DFN85
"RTN","SDEC671",82,0)
 ;
"RTN","SDEC671",83,0)
 ;Loop through entries in file #409.85
"RTN","SDEC671",84,0)
 I '$G(^XTMP("SDEC671")) S $P(^XTMP("SDEC671"),"^",1)=0
"RTN","SDEC671",85,0)
 S DFN85=$P(^XTMP("SDEC671"),"^",1) F  S DFN85=$O(^SDEC(409.85,"B",DFN85)) Q:DFN85'>0  D
"RTN","SDEC671",86,0)
 .S IEN85="" F  S IEN85=$O(^SDEC(409.85,"B",DFN85,IEN85)) Q:IEN85=""  D
"RTN","SDEC671",87,0)
 ..N FDA,SEQ,MSG,DIERR,DIMSG,R85
"RTN","SDEC671",88,0)
 ..S R85=$G(^SDEC(409.85,IEN85,0)) Q:R85=""
"RTN","SDEC671",89,0)
 ..Q:$P($G(R85),"^",17)'="O"  ;Current status (#23)
"RTN","SDEC671",90,0)
 ..Q:DFN85'=$P(R85,"^")
"RTN","SDEC671",91,0)
 ..Q:$O(^SDEC(409.85,IEN85,4,0))'>0  ;Patient contact multiple (#44)
"RTN","SDEC671",92,0)
 ..;
"RTN","SDEC671",93,0)
 ..;Set FDA for top level fields of File #409.86
"RTN","SDEC671",94,0)
 ..S FDA(409.86,"+1,",.01)=DFN85 ;Patient
"RTN","SDEC671",95,0)
 ..S FDA(409.86,"+1,",1)=$P(R85,"^",9) ;Req specific clinic (#8,P44) -> Clinic
"RTN","SDEC671",96,0)
 ..S FDA(409.86,"+1,",2)=$P(R85,"^",16) ;CID/Preferred Date of Appt (#22) -> Preferred date
"RTN","SDEC671",97,0)
 ..S FDA(409.86,"+1,",2.1)=$P(R85,"^",5) ;Request type (#4) -> Request type
"RTN","SDEC671",98,0)
 ..S FDA(409.86,"+1,",2.2)=1 ;Sequence
"RTN","SDEC671",99,0)
 ..S FDA(409.86,"+1,",1.1)=$P(R85,"^",4) ;Req service/specialty (#8.5,P40.7) -> Service
"RTN","SDEC671",100,0)
 ..;
"RTN","SDEC671",101,0)
 ..;Loop through PATIENT CONTACT multiple (#44) of File #409.85 and set FDA array
"RTN","SDEC671",102,0)
 ..;for the DATE/TIME of CONTACT multiple (#3) of File #409.86
"RTN","SDEC671",103,0)
 ..S SEQ=1
"RTN","SDEC671",104,0)
 ..S CN85="" F  S CN85=$O(^SDEC(409.85,IEN85,4,CN85)) Q:CN85'>0  D
"RTN","SDEC671",105,0)
 ...S CR85=$G(^SDEC(409.85,IEN85,4,CN85,0)) Q:CR85=""
"RTN","SDEC671",106,0)
 ...S CDT85=$P(CR85,"^") Q:CDT85=""  ;Date entered (#.01)
"RTN","SDEC671",107,0)
 ...S CU85=$P(CR85,"^",2) Q:CU85=""  ;Entered by user (#2,P200)
"RTN","SDEC671",108,0)
 ...S CA85=$P(CR85,"^",3) Q:CA85=""  ;Action (#3)
"RTN","SDEC671",109,0)
 ...S CLM85="" I CA85="M" S CA85="C",CLM85=1
"RTN","SDEC671",110,0)
 ...;
"RTN","SDEC671",111,0)
 ...S SEQ=SEQ+1
"RTN","SDEC671",112,0)
 ...S IENS="+"_SEQ_",+1,"
"RTN","SDEC671",113,0)
 ...S FDA(409.863,IENS,.01)=$P(CR85,"^")
"RTN","SDEC671",114,0)
 ...S FDA(409.863,IENS,1)=CA85 ;Contact type
"RTN","SDEC671",115,0)
 ...S:SEQ=2 FDA(409.863,IENS,2)=$P(R85,"^",18) ;Comments from top level #409.85,25 -> Comments
"RTN","SDEC671",116,0)
 ...S FDA(409.863,IENS,3)=CLM85 ;Left message
"RTN","SDEC671",117,0)
 ...S FDA(409.863,IENS,4)=SEQ-1 ;Sequence
"RTN","SDEC671",118,0)
 ...S FDA(409.863,IENS,5)=CU85 ;User entered contact
"RTN","SDEC671",119,0)
 ...S FDA(409.863,IENS,6)=CDT85 ;Date/time entered
"RTN","SDEC671",120,0)
 ..;
"RTN","SDEC671",121,0)
 ..S ^XTMP("SDEC671")=DFN85_"^"_IEN85
"RTN","SDEC671",122,0)
 ..D UPDATE^DIE("","FDA","","MSG")
"RTN","SDEC671",123,0)
 Q
"RTN","SDEC671",124,0)
 ;
"RTN","SDEC671",125,0)
POST2 ;
"RTN","SDEC671",126,0)
 N PAT84,ST84,APP84,IEN84,CL84P,CL84,DFN84,PAT0,STA
"RTN","SDEC671",127,0)
 S J=0
"RTN","SDEC671",128,0)
 ;
"RTN","SDEC671",129,0)
 S ADT84="" F  S ADT84=$O(^SDEC(409.84,"B",ADT84)) Q:ADT84'>0  D
"RTN","SDEC671",130,0)
 .S IEN84="" F  S IEN84=$O(^SDEC(409.84,"B",ADT84,IEN84)) Q:IEN84=""  D
"RTN","SDEC671",131,0)
 ..S PAT84="" S PAT84=^SDEC(409.84,IEN84,0) Q:PAT84=""
"RTN","SDEC671",132,0)
 ..Q:$P($G(PAT84),"^",5)=""
"RTN","SDEC671",133,0)
 ..Q:$P($G(PAT84),"^",3)'=""  ;Quit if cancel d/t entered
"RTN","SDEC671",134,0)
 ..Q:$P($G(PAT84),"^",4)'=""
"RTN","SDEC671",135,0)
 ..Q:$P($G(PAT84),"^",12)'=""
"RTN","SDEC671",136,0)
 ..Q:$P($G(PAT84),"^",14)'=""  ;Quit if checkout d/t entered
"RTN","SDEC671",137,0)
 ..S ST84="" S ST84=$P($G(PAT84),"^",17)
"RTN","SDEC671",138,0)
 ..S DFN84="" S DFN84=$P($G(PAT84),"^",5) Q:DFN84=""
"RTN","SDEC671",139,0)
 ..S CL84P="" S CL84P=$P($G(PAT84),"^",7) Q:CL84P=""
"RTN","SDEC671",140,0)
 ..S CL84="" S CL84=$$GET1^DIQ(409.831,CL84P,.04,"I") Q:CL84=""
"RTN","SDEC671",141,0)
 ..S PAT0="" S PAT0=$G(^DPT(DFN84,0)) Q:PAT0=""
"RTN","SDEC671",142,0)
 ..S STA="" S STA=$$STATUS^SDAM1(DFN84,ADT84,CL84,PAT0)
"RTN","SDEC671",143,0)
 ..I ($P(STA,";",1)=11)!($P(STA,";",1)=3) D DEL
"RTN","SDEC671",144,0)
 ..Q
"RTN","SDEC671",145,0)
 Q
"RTN","SDEC671",146,0)
 ;
"RTN","SDEC671",147,0)
DEL ;
"RTN","SDEC671",148,0)
 N REC2
"RTN","SDEC671",149,0)
 S REC2=$G(^DPT(DFN84,"S",ADT84,0))
"RTN","SDEC671",150,0)
 Q:$P(REC2,"^",1)=CL84
"RTN","SDEC671",151,0)
 W !,IEN84_"   "_ADT84_"  "_$P(^DPT(DFN84,0),"^",1)
"RTN","SDEC671",152,0)
 S J=J+1 S ^XTMP("673SDEC",J)=IEN84_"   "_ADT84_"  "_$P(^DPT(DFN84,0),"^",1)
"RTN","SDEC671",153,0)
 S DIK="^SDEC(409.84,",DA=IEN84 D ^DIK
"RTN","SDEC671",154,0)
 Q
"RTN","SDECAR")
0^1^B90430673^B92353393
"RTN","SDECAR",1,0)
SDECAR ;ALB/SAT - VISTA SCHEDULING RPCS ;3:43 PM  19 Jun 2017
"RTN","SDECAR",2,0)
 ;;5.3;Scheduling;**627,642,671**;Aug 13, 1993;Build 25
"RTN","SDECAR",3,0)
 ;
"RTN","SDECAR",4,0)
 Q
"RTN","SDECAR",5,0)
 ;
"RTN","SDECAR",6,0)
ARCLOSE(RET,INP) ;Appointment Request Close
"RTN","SDECAR",7,0)
 ;ARCLOSE(RET,INP...)  external parameter tag in SDEC
"RTN","SDECAR",8,0)
 ; INP - Input parameters array
"RTN","SDECAR",9,0)
 ;     INP(1) - Request ID - Pointer to SDEC APPT REQUEST file
"RTN","SDECAR",10,0)
 ;     INP(2) - Disposition
"RTN","SDECAR",11,0)
 ;     INP(3) - User Id - Pointer to NEW PERSON file
"RTN","SDECAR",12,0)
 ;     INP(4) - Date Dispositioned in external form
"RTN","SDECAR",13,0)
 N MI,ARDISP,ARDISPBY,ARDISPDT,ARFDA,ARIEN,ARMSG,ARRET
"RTN","SDECAR",14,0)
 S RET="I00020ERRORID^T00256ERRORTEXT"_$C(30)
"RTN","SDECAR",15,0)
 ;validate IEN
"RTN","SDECAR",16,0)
 S ARIEN=$G(INP(1)) I ARIEN="" S RET=RET_"-1^Missing IEN"_$C(30,31) Q
"RTN","SDECAR",17,0)
 ;validate DISPOSITION
"RTN","SDECAR",18,0)
 S ARDISP=$G(INP(2))
"RTN","SDECAR",19,0)
 ;MC:MRTC PARENT CLOSED
"RTN","SDECAR",20,0)
 I (ARDISP'="D"),(ARDISP'="NC"),(ARDISP'="SA"),(ARDISP'="CC"),(ARDISP'="NN"),(ARDISP'="ER"),(ARDISP'="TR"),(ARDISP'="CL"),(ARDISP'="MC") D
"RTN","SDECAR",21,0)
 .S:ARDISP="DEATH" ARDISP="D"
"RTN","SDECAR",22,0)
 .S:ARDISP="REMOVED/NON-VA CARE" ARDISP="NC"
"RTN","SDECAR",23,0)
 .S:ARDISP="REMOVED/SCHEDULED-ASSIGNED" ARDISP="SA"
"RTN","SDECAR",24,0)
 .S:ARDISP="REMOVED/VA CONTRACT CARE" ARDISP="CC"
"RTN","SDECAR",25,0)
 .S:ARDISP="REMOVED/NO LONGER NECESSARY" ARDISP="NN"
"RTN","SDECAR",26,0)
 .S:ARDISP="ENTERED IN ERROR" ARDISP="ER"
"RTN","SDECAR",27,0)
 .S:ARDISP="TRANSFERRED TO EWL" ARDISP="TR"
"RTN","SDECAR",28,0)
 .S:ARDISP="CHANGED CLINIC" ARDISP="CL"
"RTN","SDECAR",29,0)
 .S:ARDISP="MRTC PARENT CLOSED" ARDISP="MC"
"RTN","SDECAR",30,0)
 I ARDISP="" S RET=RET_"-1^Missing value for DISPOSITION"_$C(30,31) Q
"RTN","SDECAR",31,0)
 I (ARDISP'="D"),(ARDISP'="NC"),(ARDISP'="SA"),(ARDISP'="CC"),(ARDISP'="NN"),(ARDISP'="ER"),(ARDISP'="TR"),(ARDISP'="CL"),(ARDISP'="MC") D
"RTN","SDECAR",32,0)
 .S RET=RET_"-1^Invalid value for DISPOSITION"_$C(30,31) Q
"RTN","SDECAR",33,0)
 ;validate DISPOSITIONED BY
"RTN","SDECAR",34,0)
 S ARDISPBY=$G(INP(3),DUZ)
"RTN","SDECAR",35,0)
 I '+ARDISPBY S ARDISPBY=$O(^VA(200,"B",ARDISPBY,0))
"RTN","SDECAR",36,0)
 I '$D(^VA(200,+ARDISPBY,0)) S RET=RET_"-1^Invalid 'DISPOSITIONED BY' user"_$C(30,31) Q
"RTN","SDECAR",37,0)
 ;validate DATE DISPOSITIONED
"RTN","SDECAR",38,0)
 S ARDISPDT=$G(INP(4),DT) I ARDISPDT'="" S %DT="" S X=ARDISPDT D ^%DT S ARDISPDT=Y
"RTN","SDECAR",39,0)
 I Y=-1 S RET=RET_"-1^Invalid 'DATE DISPOSITIONED'"_$C(30,31) Q
"RTN","SDECAR",40,0)
 S ARFDA=$NA(ARFDA($$FNUM,ARIEN_","))
"RTN","SDECAR",41,0)
 S @ARFDA@(19)=ARDISPDT
"RTN","SDECAR",42,0)
 S @ARFDA@(20)=ARDISPBY
"RTN","SDECAR",43,0)
 S @ARFDA@(21)=ARDISP
"RTN","SDECAR",44,0)
 S @ARFDA@(23)="C"
"RTN","SDECAR",45,0)
 D UPDATE^DIE("","ARFDA","ARRET","ARMSG")
"RTN","SDECAR",46,0)
 I $D(ARMSG("DIERR")) D
"RTN","SDECAR",47,0)
 . F MI=1:1:$G(ARMSG("DIERR")) S RET=RET_"-1^"_$G(ARMSG("DIERR",MI,"TEXT",1))_$C(30)
"RTN","SDECAR",48,0)
 S RET=RET_$C(31)
"RTN","SDECAR",49,0)
 I $D(ARMSG("DIERR")) Q
"RTN","SDECAR",50,0)
 ;SEND HL7 TO CPRS IF RTC REQUEST
"RTN","SDECAR",51,0)
 I $P(^SDEC(409.85,ARIEN,0),U,5)="RTC" D
"RTN","SDECAR",52,0)
 .I ARDISP="SA" D ARDISP^SDECHL7(ARIEN,"")
"RTN","SDECAR",53,0)
 .I ARDISP="MC" D ARDISP^SDECHL7(ARIEN,"")
"RTN","SDECAR",54,0)
 .I ARDISP'="SA"&(ARDISP'="MC") D ARDISP^SDECHL7(ARIEN,1)
"RTN","SDECAR",55,0)
 .I $D(^TMP($J,"REJECT",ARIEN)) D
"RTN","SDECAR",56,0)
 ..S RET="-2^"_^TMP(SDHL7IN("ORDER IEN"))
"RTN","SDECAR",57,0)
 Q
"RTN","SDECAR",58,0)
 ;
"RTN","SDECAR",59,0)
AROPEN(RET,ARAPP,ARIEN,ARDDT) ;SET Appointment Request Open/re-open
"RTN","SDECAR",60,0)
 ;AROPEN(RET,ARAPP,ARIEN,ARDDT)  external parameter tag in SDEC
"RTN","SDECAR",61,0)
 ;INPUT:
"RTN","SDECAR",62,0)
 ;     ARAPP - (required if no ARIEN) Appointment ID pointer to
"RTN","SDECAR",63,0)
 ;    SDEC APPOINTMENT file 409.84
"RTN","SDECAR",64,0)
 ;     ARIEN - (required if no ARAPP) Request ID - Pointer to
"RTN","SDECAR",65,0)
 ;                    SDEC APPOINTMENT REQUEST file
"RTN","SDECAR",66,0)
 ;     ARDDT - (optional) Desired Date of appointment in external format
"RTN","SDECAR",67,0)
 N SDART,SDECI,SDQ,ARFDA,ARMSG,X,Y,%DT
"RTN","SDECAR",68,0)
 S RET="^TMP(""SDECAR"","_$J_",""AROPEN"")"
"RTN","SDECAR",69,0)
 K @RET
"RTN","SDECAR",70,0)
 S (SDECI,SDQ)=0
"RTN","SDECAR",71,0)
 S @RET@(SDECI)="T00030ERRORID^T00030ERRTEXT"_$C(30)
"RTN","SDECAR",72,0)
 ;validate ARAPP (required if ARIEN not passed it)
"RTN","SDECAR",73,0)
 S ARAPP=$G(ARAPP)
"RTN","SDECAR",74,0)
 I ARAPP'="" I $D(^SDEC(409.84,ARAPP,0)) D
"RTN","SDECAR",75,0)
 .S SDART=$$GET1^DIQ(409.84,ARAPP_",",.22,"I")
"RTN","SDECAR",76,0)
 .I $P(SDART,";",2)'="SDEC(409.85," S SDECI=SDECI+1 S @RET@(SDECI)="-1^Not a Requested appointment."_$C(30),SDQ=1 Q
"RTN","SDECAR",77,0)
 .I $G(ARIEN)'="",ARIEN'=$P(SDART,";",1) S SDECI=SDECI+1 S @RET@(SDECI)="-1^Appointment Request does not match item passed in."_$C(30),SDQ=1 Q
"RTN","SDECAR",78,0)
 .S ARIEN=$P(SDART,";",1)
"RTN","SDECAR",79,0)
 G:SDQ ARX
"RTN","SDECAR",80,0)
 ;validate ARIEN
"RTN","SDECAR",81,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",82,0)
 I ARIEN="" S SDECI=SDECI+1 S @RET@(SDECI)="-1^Appointment Request ID or Appointment ID is required."_$C(30,31) Q
"RTN","SDECAR",83,0)
 I '$D(^SDEC(409.85,ARIEN,0)) S SDECI=SDECI+1 S @RET@(SDECI)="-1^Invalid Appt Request ID."_$C(30,31) Q
"RTN","SDECAR",84,0)
 ;validate ARDDT
"RTN","SDECAR",85,0)
 S ARDDT=$P($G(ARDDT),"@",1)
"RTN","SDECAR",86,0)
 I $G(ARDDT)'="" S %DT="" S X=ARDDT D ^%DT I Y=-1 S SDECI=SDECI+1 S @RET@(SDECI)="-1^Invalid desired date of appointment."_$C(30,31) Q
"RTN","SDECAR",87,0)
 S ARFDA=$NA(ARFDA(409.85,ARIEN_","))
"RTN","SDECAR",88,0)
 S @ARFDA@(19)=""
"RTN","SDECAR",89,0)
 S @ARFDA@(20)=""
"RTN","SDECAR",90,0)
 S @ARFDA@(21)=""
"RTN","SDECAR",91,0)
 S:ARDDT'="" @ARFDA@(22)=ARDDT
"RTN","SDECAR",92,0)
 S @ARFDA@(23)="OPEN"
"RTN","SDECAR",93,0)
 D UPDATE^DIE("E","ARFDA","ARRET","ARMSG")
"RTN","SDECAR",94,0)
 I $D(ARMSG("DIERR")) D
"RTN","SDECAR",95,0)
 . F MI=1:1:$G(ARMSG("DIERR")) S SDECI=SDECI+1 S @RET@(SDECI)="-1^"_$G(ARMSG("DIERR",MI,"TEXT",1))_$C(30)
"RTN","SDECAR",96,0)
 I '$D(ARMSG("DIERR")) S SDECI=SDECI+1 S @RET@(SDECI)="0^"_ARIEN_$C(30)
"RTN","SDECAR",97,0)
ARX S @RET@(SDECI)=@RET@(SDECI)_$C(31)
"RTN","SDECAR",98,0)
 Q
"RTN","SDECAR",99,0)
 ;
"RTN","SDECAR",100,0)
FNUM(RET) ;file number
"RTN","SDECAR",101,0)
 S RET=409.85
"RTN","SDECAR",102,0)
 Q RET
"RTN","SDECAR",103,0)
 ;
"RTN","SDECAR",104,0)
ARPCSET(SDECY,INP,ARIEN) ;SET update patient contacts in SDEC APPT REQUEST file
"RTN","SDECAR",105,0)
 ;ARSETPC(SDECY,INP,ARIEN)  external parameter tag in SDEC
"RTN","SDECAR",106,0)
 ;  INP = Patient Contacts separated by ::
"RTN","SDECAR",107,0)
 ;            Each :: piece has the following ~~ pieces:  (same as theyare passed into SDEC ARLSET)
"RTN","SDECAR",108,0)
 ;            1) = (required)    DATE ENTERED external date/time
"RTN","SDECAR",109,0)
 ;            2) = (optional)    PC ENTERED BY USER ID or NAME - Pointer to NEW PERSON file or NAME
"RTN","SDECAR",110,0)
 ;            4) = (optional)    ACTION - valid values are:
"RTN","SDECAR",111,0)
 ;                               CALLED   MESSAGE LEFT   LETTER
"RTN","SDECAR",112,0)
 ;            5) = (optional)    PATIENT PHONE Free-Text 4-20 characters
"RTN","SDECAR",113,0)
 ;            6) = NOT USED (optional) Comment 1-160 characters
"RTN","SDECAR",114,0)
 ;  ARIEN = (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR",115,0)
 N SDECI,SDTMP,ARMSG1
"RTN","SDECAR",116,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""ARSETPC"")"
"RTN","SDECAR",117,0)
 K @SDECY
"RTN","SDECAR",118,0)
 S SDECI=0
"RTN","SDECAR",119,0)
 S @SDECY@(SDECI)="T00030RETURNCODE^T00030TEXT"_$C(30)
"RTN","SDECAR",120,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",121,0)
 I (ARIEN="")!('$D(^SDEC(409.85,ARIEN,0))) D ERR1^SDECERR(-1,"Invalid wait list ID "_ARIEN_".",SDECI,SDECY) Q
"RTN","SDECAR",122,0)
 D AR23^SDECAR2(INP,ARIEN)
"RTN","SDECAR",123,0)
 I $D(ARMSG1) D ERR1^SDECERR(-1,"Error storing patient contacts.",SDECI,SDECY) Q
"RTN","SDECAR",124,0)
 S SDECI=SDECI+1 S @SDECY@(SDECI)="0^SUCCESS"_$C(30,31)
"RTN","SDECAR",125,0)
 Q
"RTN","SDECAR",126,0)
 ;
"RTN","SDECAR",127,0)
ARDGET(SDECY) ;get values for disposition field of SDEC APPT REQUEST file
"RTN","SDECAR",128,0)
 ;ARDGET(SDECY)  external parameter tag is in SDEC
"RTN","SDECAR",129,0)
 ;INPUT: none
"RTN","SDECAR",130,0)
 ;RETURN:
"RTN","SDECAR",131,0)
 ; Successful Return:
"RTN","SDECAR",132,0)
 ;  Global array containing a list of the valid DISPOSITION values in which
"RTN","SDECAR",133,0)
 ;  each array entry contains the disposition text.
"RTN","SDECAR",134,0)
 ; Caught Exception Return:
"RTN","SDECAR",135,0)
 ;   A single entry in the Global Array in the format "-1^<error text>"
"RTN","SDECAR",136,0)
 ;   "T00020RETURNCODE^T00100TEXT"
"RTN","SDECAR",137,0)
 ; Unexpected Exception Return:
"RTN","SDECAR",138,0)
 ;     Handled by the RPC Broker.
"RTN","SDECAR",139,0)
 ;     M errors are trapped by the use of M and Kernel error handling.
"RTN","SDECAR",140,0)
 ;     The RPC execution stops and the RPC Broker sends the error generated
"RTN","SDECAR",141,0)
 ;     text back to the client.
"RTN","SDECAR",142,0)
 N SDI,SDX,SDXI,SDECI,DIERR,SDMSG
"RTN","SDECAR",143,0)
 S SDECI=0
"RTN","SDECAR",144,0)
 K ^TMP("SDEC",$J)
"RTN","SDECAR",145,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDECAR",146,0)
 ; data header
"RTN","SDECAR",147,0)
 S @SDECY@(SDECI)="T00030TEXT"_$C(30)
"RTN","SDECAR",148,0)
 S SDX=$$GET1^DID(409.85,21,"","POINTER","","MSG")
"RTN","SDECAR",149,0)
 F SDI=1:1:$L(SDX,";") D
"RTN","SDECAR",150,0)
 .S SDXI=$P(SDX,";",SDI)
"RTN","SDECAR",151,0)
 .Q:SDXI=""
"RTN","SDECAR",152,0)
 .S SDECI=SDECI+1 S @SDECY@(SDECI)=$P(SDXI,":",2)_$C(30)
"RTN","SDECAR",153,0)
 S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDECAR",154,0)
 Q
"RTN","SDECAR",155,0)
 ;
"RTN","SDECAR",156,0)
ARMRTGET(SDECY,ARIEN) ;GET number of entries and values in MRTC CALC PREF DATES
"RTN","SDECAR",157,0)
 ;ARMRTGET(SDECY,ARIEN)
"RTN","SDECAR",158,0)
 ;INPUT:
"RTN","SDECAR",159,0)
 ; ARIEN - (required) pointer to SDEC APPT REQUEST file
"RTN","SDECAR",160,0)
 ;RETURN:
"RTN","SDECAR",161,0)
 ; 1st entry contains a count of the number of dates in MRTC CALC PREF DATES
"RTN","SDECAR",162,0)
 ; 2-n entry contains each date
"RTN","SDECAR",163,0)
 N ARDATA,SDC,SDECI,SDI
"RTN","SDECAR",164,0)
 S SDC=0
"RTN","SDECAR",165,0)
 S SDECI=1  ;save position 1 for count in SDC
"RTN","SDECAR",166,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""ARMRTGET"")"
"RTN","SDECAR",167,0)
 K @SDECY
"RTN","SDECAR",168,0)
 ; data header
"RTN","SDECAR",169,0)
 S @SDECY@(0)="T00030ERRORCODE^T00030MESSAGE"_$C(30)
"RTN","SDECAR",170,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",171,0)
 I ARIEN="" S @SDECY@(1)="-1^SDEC APPT REQUEST id is required." Q
"RTN","SDECAR",172,0)
 I '$D(^SDEC(409.85,+ARIEN,0)) S @SDECY@(1)="-1^Invalid SDEC APPT REQUEST id." Q
"RTN","SDECAR",173,0)
 D GETS^DIQ(409.85,+ARIEN,"43.5*","E","ARDATA")
"RTN","SDECAR",174,0)
 S SDI=0 F  S SDI=$O(ARDATA(409.851,SDI)) Q:SDI=""  D
"RTN","SDECAR",175,0)
 .S SDC=SDC+1
"RTN","SDECAR",176,0)
 .S SDECI=SDECI+1 S @SDECY@(SDECI)=ARDATA(409.851,SDI,.01,"E")_$C(30)
"RTN","SDECAR",177,0)
 S @SDECY@(1)=SDC_$C(30)
"RTN","SDECAR",178,0)
 S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDECAR",179,0)
 Q
"RTN","SDECAR",180,0)
 ;
"RTN","SDECAR",181,0)
ARMULT(SDECY,ARIEN,MULT) ;SET MULT APPTS MADE multiple in SDEC APPT REQUEST file. All entries are removed and replaced by the values in MULT
"RTN","SDECAR",182,0)
 ;INPUT:
"RTN","SDECAR",183,0)
 ; ARIEN - (required) pointer to SDEC APPT REQUEST file (usualy a parent request)
"RTN","SDECAR",184,0)
 ; MULT - (optional) list of child pointers to SDEC APPOINTMENT and/or
"RTN","SDECAR",185,0)
 ;                    SDEC APPT REQUEST files separated by pipe
"RTN","SDECAR",186,0)
 ;        each pipe piece contains the following ~ pieces:
"RTN","SDECAR",187,0)
 ;     1. (optional) Appointment Id pointer to SDEC APPOINTMENT
"RTN","SDECAR",188,0)
 ;                   file 409.84
"RTN","SDECAR",189,0)
 ;     2. (optional) Request Id pointer to SDEC APPT REQUEST
"RTN","SDECAR",190,0)
 ;                   file 409.85
"RTN","SDECAR",191,0)
 ;RETURN:
"RTN","SDECAR",192,0)
 ; ERRORCODE^MESSAGE
"RTN","SDECAR",193,0)
 ;
"RTN","SDECAR",194,0)
 N MULT1,SDI
"RTN","SDECAR",195,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""ARMRTSET"")"
"RTN","SDECAR",196,0)
 K @SDECY
"RTN","SDECAR",197,0)
 ; data header
"RTN","SDECAR",198,0)
 S @SDECY@(0)="T00030ERRORCODE^T00030MESSAGE"_$C(30)
"RTN","SDECAR",199,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",200,0)
 I ARIEN="" S @SDECY@(1)="-1^SDEC APPT REQUEST id is required." Q
"RTN","SDECAR",201,0)
 I '$D(^SDEC(409.85,+ARIEN,0)) S @SDECY@(1)="-1^Invalid SDEC APPT REQUEST id." Q
"RTN","SDECAR",202,0)
 S MULT=$G(MULT)
"RTN","SDECAR",203,0)
 D MT1(ARIEN)
"RTN","SDECAR",204,0)
 I MULT="" S @SDECY@(0)=@SDECY@(0)_$C(31) Q   ;nothing to do
"RTN","SDECAR",205,0)
 F SDI=1:1:$L(MULT,"|") D
"RTN","SDECAR",206,0)
 .S MULT1=$TR($P(MULT,"|",SDI),"^","~")
"RTN","SDECAR",207,0)
 .D AR433^SDECAR2(ARIEN,MULT1)
"RTN","SDECAR",208,0)
 S @SDECY@(1)="0^SUCCESS"_$C(30,31)
"RTN","SDECAR",209,0)
 Q
"RTN","SDECAR",210,0)
ARMRTSET(SDECY,ARIEN,MRTC) ;SET MRTC CALC PREF DATES dates - clears the multiple and sets the new ones that are passed into MRTC
"RTN","SDECAR",211,0)
 ;ARMRTSET(SDECY,ARIEN,MRTC)
"RTN","SDECAR",212,0)
 ;INPUT:
"RTN","SDECAR",213,0)
 ; ARIEN - (required) pointer to SDEC APPT REQUEST file
"RTN","SDECAR",214,0)
 ; MRTC  - (optional) MRTC calculated preferred dates separated by pipe|:
"RTN","SDECAR",215,0)
 ;                    Each date can be in external format with no time.
"RTN","SDECAR",216,0)
 ;RETURN:
"RTN","SDECAR",217,0)
 ; ERRORCODE^MESSAGE
"RTN","SDECAR",218,0)
 N SDI,MRTC1
"RTN","SDECAR",219,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""ARMRTSET"")"
"RTN","SDECAR",220,0)
 K @SDECY
"RTN","SDECAR",221,0)
 ; data header
"RTN","SDECAR",222,0)
 S @SDECY@(0)="T00030ERRORCODE^T00030MESSAGE"_$C(30)
"RTN","SDECAR",223,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",224,0)
 I ARIEN="" S @SDECY@(1)="-1^SDEC APPT REQUEST id is required." Q
"RTN","SDECAR",225,0)
 I '$D(^SDEC(409.85,+ARIEN,0)) S @SDECY@(1)="-1^Invalid SDEC APPT REQUEST id." Q
"RTN","SDECAR",226,0)
 S MRTC=$G(MRTC)
"RTN","SDECAR",227,0)
 I MRTC="" S @SDECY@(1)="0"_$C(30,31) Q  ;not an error, just nothing to do
"RTN","SDECAR",228,0)
 D MT(ARIEN)
"RTN","SDECAR",229,0)
 D AR435^SDECAR2(MRTC,ARIEN)
"RTN","SDECAR",230,0)
 S @SDECY@(1)="0"_$C(30,31)
"RTN","SDECAR",231,0)
 Q
"RTN","SDECAR",232,0)
MT(ARIEN) ; clear out existing MRTC CALC PREF DATES
"RTN","SDECAR",233,0)
 N DA,DIK,SDI
"RTN","SDECAR",234,0)
 S SDI=0 F  S SDI=$O(^SDEC(409.85,ARIEN,5,SDI)) Q:SDI'>0  D
"RTN","SDECAR",235,0)
 .S DIK="^SDEC(409.85,"_ARIEN_",5,"
"RTN","SDECAR",236,0)
 .S DA=SDI
"RTN","SDECAR",237,0)
 .S DA(1)=ARIEN
"RTN","SDECAR",238,0)
 .D ^DIK
"RTN","SDECAR",239,0)
 Q
"RTN","SDECAR",240,0)
MT1(ARIEN) ; clear out existing MULT APPTS MADE
"RTN","SDECAR",241,0)
 N DA,DIK,SDI
"RTN","SDECAR",242,0)
 S SDI=0 F  S SDI=$O(^SDEC(409.85,ARIEN,2,SDI)) Q:SDI'>0  D
"RTN","SDECAR",243,0)
 .S DIK="^SDEC(409.85,"_ARIEN_",2,"
"RTN","SDECAR",244,0)
 .S DA=SDI
"RTN","SDECAR",245,0)
 .S DA(1)=ARIEN
"RTN","SDECAR",246,0)
 .D ^DIK
"RTN","SDECAR",247,0)
 Q
"RTN","SDECAR",248,0)
 ;
"RTN","SDECAR",249,0)
ARMRTC(RET,ARIEN) ;GET the number of MRTC appointments made for this request
"RTN","SDECAR",250,0)
 ;INPUT:
"RTN","SDECAR",251,0)
 ;  ARIEN - (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR",252,0)
 ;RETURN
"RTN","SDECAR",253,0)
 ;  Global array with 1 entry containing the count of appointments made under the COUNT header
"RTN","SDECAR",254,0)
 N SDC,SDECI,SDI
"RTN","SDECAR",255,0)
 S RET="^TMP(""SDECAR1"","_$J_",""ARMRTC"")"
"RTN","SDECAR",256,0)
 K @RET
"RTN","SDECAR",257,0)
 S (SDC,SDECI)=0
"RTN","SDECAR",258,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",259,0)
 I '$D(^SDEC(409.85,ARIEN,0)) S @RET@(1)="-1^Invalid ID"_$C(30,31) Q
"RTN","SDECAR",260,0)
 S @RET@(SDECI)="T00030COUNT"_$C(30)
"RTN","SDECAR",261,0)
 S @RET@(1)=$$MRTC(ARIEN)_$C(30,31)
"RTN","SDECAR",262,0)
 Q
"RTN","SDECAR",263,0)
MRTC(ARIEN) ;
"RTN","SDECAR",264,0)
 N SDC,SDI
"RTN","SDECAR",265,0)
 S SDC=0
"RTN","SDECAR",266,0)
 S SDI=0 F  S SDI=$O(^SDEC(409.85,ARIEN,2,SDI)) Q:SDI'>0  D
"RTN","SDECAR",267,0)
 .S SDC=SDC+1
"RTN","SDECAR",268,0)
 Q SDC
"RTN","SDECAR",269,0)
 ;
"RTN","SDECAR",270,0)
ARAPPT(SDECY,SDAPPT) ;GET appointment request for given SDEC APPOINTMENT id
"RTN","SDECAR",271,0)
 ;INPUT:
"RTN","SDECAR",272,0)
 ;  SDAPPT - (required) pointer to SDEC APPOINTMENT file 409.84
"RTN","SDECAR",273,0)
 ;RETURN
"RTN","SDECAR",274,0)
 ;  Global array with 1 entry containing the REQUEST TYPE and IEN of the associated appointment separated by pipe |:
"RTN","SDECAR",275,0)
 ;    1. Request Type - A  APPT
"RTN","SDECAR",276,0)
 ;                      C  Consult
"RTN","SDECAR",277,0)
 ;                      E  EWL
"RTN","SDECAR",278,0)
 ;                      R  Recall
"RTN","SDECAR",279,0)
 ;    2. IEN - pointer to either the SDEC APPT REQUEST, REQUEST/CONSULTATION, SD WAIT LIST, or RECALL REMINDERS file
"RTN","SDECAR",280,0)
 ;
"RTN","SDECAR",281,0)
 N SDECI,SDTYP,SDX,SDY
"RTN","SDECAR",282,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""ARAPPT"")"
"RTN","SDECAR",283,0)
 K @SDECY
"RTN","SDECAR",284,0)
 S SDECI=0
"RTN","SDECAR",285,0)
 S @SDECY@(SDECI)="T00030SDAPTYP"_$C(30)
"RTN","SDECAR",286,0)
 S SDAPPT=$G(SDAPPT)
"RTN","SDECAR",287,0)
 I SDAPPT="" S @SDECY@(1)="-1^SDEC APPOINTMENT id is required."_$C(30,31) Q
"RTN","SDECAR",288,0)
 I '$D(^SDEC(409.84,+SDAPPT,0)) S @SDECY@(1)="-1^Invalid SDEC APPOINTMENT ID."_$C(30,31) Q
"RTN","SDECAR",289,0)
 S SDX=$$GET1^DIQ(409.84,SDAPPT_",",.22,"I")
"RTN","SDECAR",290,0)
 S SDY=$P(SDX,";",2)
"RTN","SDECAR",291,0)
 S SDTYP=$S(SDY="SDWL(409.3,":"E|",SDY="GMR(123,":"C|",SDY="SD(403.5,":"R|",SDY="SDEC(409.85,":"A|",1:"")_$P(SDX,";",1)  ;appt request type
"RTN","SDECAR",292,0)
 S SDECI=SDECI+1 S @SDECY@(SDECI)=SDTYP_$C(30,31)
"RTN","SDECAR",293,0)
 Q
"RTN","SDECAR",294,0)
 ;
"RTN","SDECAR",295,0)
AUDITGET(SDECY,ARIEN) ;GET entries from VS AUDIT field of SDEC APPT REQUEST file 409.85
"RTN","SDECAR",296,0)
 N ARDATA,SDECI,SDI,SDTMP,SDX
"RTN","SDECAR",297,0)
 S SDECY="^TMP(""SDECAR"","_$J_",""AUDITGET"")"
"RTN","SDECAR",298,0)
 K @SDECY
"RTN","SDECAR",299,0)
 S SDECI=0
"RTN","SDECAR",300,0)
 S SDTMP="T00030IEN^T00030ID^T00030DATE^T00030USERIEN^T00030USERNAME"
"RTN","SDECAR",301,0)
 S SDTMP=SDTMP_"^T00030CLINIEN^T00030CLINNAME^T00030STOPIEN^T00030STOPNAME"
"RTN","SDECAR",302,0)
 S @SDECY@(SDECI)=SDTMP_$C(30)
"RTN","SDECAR",303,0)
 ;validate ARIEN
"RTN","SDECAR",304,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR",305,0)
 I '+$D(^SDEC(409.85,+ARIEN,0)) S @SDECY@(1)="-1^Invalid SDEC APPT REQUEST id."_$C(30,31) Q
"RTN","SDECAR",306,0)
 S SDI=0 F  S SDI=$O(^SDEC(409.85,+ARIEN,6,SDI)) Q:SDI'>0  D
"RTN","SDECAR",307,0)
 .K ARDATA
"RTN","SDECAR",308,0)
 .D GETS^DIQ(409.8545,SDI_","_ARIEN_",","**","IE","ARDATA")
"RTN","SDECAR",309,0)
 .S SDX="ARDATA(409.8545,"""_SDI_","_ARIEN_","")"
"RTN","SDECAR",310,0)
 .S SDTMP=ARIEN_U_SDI_U_@SDX@(.01,"E")_U_@SDX@(1,"I")_U_@SDX@(1,"E")
"RTN","SDECAR",311,0)
 .S SDTMP=SDTMP_U_@SDX@(2,"I")_U_@SDX@(2,"E")_U_@SDX@(3,"I")_U_@SDX@(3,"E")
"RTN","SDECAR",312,0)
 .S SDECI=SDECI+1 S @SDECY@(SDECI)=SDTMP_$C(30)
"RTN","SDECAR",313,0)
 S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDECAR",314,0)
 Q
"RTN","SDECAR2")
0^2^B191968590^B158474911
"RTN","SDECAR2",1,0)
SDECAR2 ;ALB/SAT/JSM - VISTA SCHEDULING RPCS ;10:57 AM  3 Jul 2017
"RTN","SDECAR2",2,0)
 ;;5.3;Scheduling;**627,642,658,671**;Aug 13, 1993;Build 25
"RTN","SDECAR2",3,0)
 ;
"RTN","SDECAR2",4,0)
 Q
"RTN","SDECAR2",5,0)
 ;
"RTN","SDECAR2",6,0)
ARSET(RET,INP) ;Appointment Request Set
"RTN","SDECAR2",7,0)
 ;ARSET(RET,INP...)  external parameter tag in SDEC
"RTN","SDECAR2",8,0)
 ;  INP(1)  = (integer)  Wait List IEN point to
"RTN","SDECAR2",9,0)
 ;                       SDEC APPT REQUEST file 409.85.
"RTN","SDECAR2",10,0)
 ;                       If null, a new entry will be added
"RTN","SDECAR2",11,0)
 ;  INP(2)  = (text)     DFN Pointer to the PATIENT file 2
"RTN","SDECAR2",12,0)
 ;  INP(3)  = (date)     Originating Date/time in external date form
"RTN","SDECAR2",13,0)
 ;  INP(4)  = (text)     Institution name NAME field from the INSTITUTION file
"RTN","SDECAR2",14,0)
 ;  INP(5)  = (text)     Request Type
"RTN","SDECAR2",15,0)
 ;  INP(6)  = (text)     REQ Specific Clinic name - NAME field in file 44
"RTN","SDECAR2",16,0)
 ;  INP(7)  = (text)     Originating User name  - NAME field in NEW PERSON file 200
"RTN","SDECAR2",17,0)
 ;  INP(8)  = (text)     Priority - 'ASAP' or 'FUTURE'
"RTN","SDECAR2",18,0)
 ;  INP(9)  = (text)     Request By - 'PROVIDER' or 'PATIENT'
"RTN","SDECAR2",19,0)
 ;  INP(10) = (text)     Provider name  - NAME field in NEW PERSON file200
"RTN","SDECAR2",20,0)
 ;  INP(11) = (date)     Desired Date of appointment in external format.
"RTN","SDECAR2",21,0)
 ;  INP(12) = (text)     comment must be 1-60 characters
"RTN","SDECAR2",22,0)
 ;  INP(13) = (text)     ENROLLMENT PRIORITY - Valid Values are:
"RTN","SDECAR2",23,0)
 ;                                             GROUP 1
"RTN","SDECAR2",24,0)
 ;                                             GROUP 2
"RTN","SDECAR2",25,0)
 ;                                             GROUP 3
"RTN","SDECAR2",26,0)
 ;                                             GROUP 4
"RTN","SDECAR2",27,0)
 ;                                             GROUP 5
"RTN","SDECAR2",28,0)
 ;                                             GROUP 6
"RTN","SDECAR2",29,0)
 ;                                             GROUP 7
"RTN","SDECAR2",30,0)
 ;                                             GROUP 8
"RTN","SDECAR2",31,0)
 ;  INP(14) = (text)     MULTIPLE APPOINTMENT RTC      NO; YES
"RTN","SDECAR2",32,0)
 ;  INP(15) = (integer)  MULT APPT RTC INTERVAL integer between 1-365
"RTN","SDECAR2",33,0)
 ;  INP(16) = (integer)  MULT APPT NUMBER integer between 1-100
"RTN","SDECAR2",34,0)
 ;  INP(17) = Patient Contacts separated by ::
"RTN","SDECAR2",35,0)
 ;            Each :: piece has the following ~~ pieces:
"RTN","SDECAR2",36,0)
 ;            1) = (date)    DATE ENTERED external date/time
"RTN","SDECAR2",37,0)
 ;            2) = (text)    PC ENTERED BY USER ID or NAME - Pointer toNEW PERSON file or NAME
"RTN","SDECAR2",38,0)
 ;            4) = (optional) ACTION - valid values are:
"RTN","SDECAR2",39,0)
 ;                             CALLED
"RTN","SDECAR2",40,0)
 ;                             MESSAGE LEFT
"RTN","SDECAR2",41,0)
 ;                             LETTER
"RTN","SDECAR2",42,0)
 ;            5) = (optional) PATIENT PHONE Free-Text 4-20 characters
"RTN","SDECAR2",43,0)
 ;            6) = NOT USED (optional) Comment 1-160 characters
"RTN","SDECAR2",44,0)
 ;  INP(18) = (optional) SERVICE CONNECTED PRIORITY valid values are NO YES
"RTN","SDECAR2",45,0)
 ;  INP(19) = (optional) SERVICE CONNECTED PERCENTAGE = numeric 0-100
"RTN","SDECAR2",46,0)
 ;  INP(20) = (optional) MRTC calculated preferred dates separated by pipe |:
"RTN","SDECAR2",47,0)
 ;                       Each date can be in external format with no time.
"RTN","SDECAR2",48,0)
 ;  INP(21) = (optional) CLINIC STOP pointer to CLINIC STOP file 40.7
"RTN","SDECAR2",49,0)
 ;                       used to populate the REQ SERVICE/SPECIALTY field in 409.85
"RTN","SDECAR2",50,0)
 ;  INP(22) = (optional) Appointment Type ID pointer to APPOINTMENT TYPE file 409.1
"RTN","SDECAR2",51,0)
 ;  INP(23) = (optional) Patient Status
"RTN","SDECAR2",52,0)
 ;                          N = NEW
"RTN","SDECAR2",53,0)
 ;                          E = ESTABLISHED
"RTN","SDECAR2",54,0)
 ;  INP(24) = (optional) MULT APPTS MADE
"RTN","SDECAR2",55,0)
 ;                    list of child pointers to SDEC APPOINTMENT and/orSDEC APPT REQUEST files separated by pipe
"RTN","SDECAR2",56,0)
 ;                    each pipe piece contains the following ~ pieces:
"RTN","SDECAR2",57,0)
 ;                1. Appointment Id pointer to SDEC APPOINTMENT file 409.84
"RTN","SDECAR2",58,0)
 ;                2. Request Id pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",59,0)
 ;  INP(25) = (optional) PARENT REQUEST pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",60,0)
 ;  INP(26) = (optional) NLT (No later than) [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",61,0)
 ;  INP(27) = (optional) PREREQ (Prerequisites) [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",62,0)
 ;  INP(28) = (optional) ORDER IEN [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",63,0)
 N X,Y,%DT
"RTN","SDECAR2",64,0)
 N DFN,MI,ARAPTYP,ARIEN,ARORIGDT,ARORIGDTI,ARINST,ARINSTI,ARTYPE,ARTEAM,ARPOS,ARSRVSP,ARCLIN
"RTN","SDECAR2",65,0)
 N ARUSER,ARPRIO,ARREQBY,ARPROV,ARDAPTDT,ARCOMM,AREESTAT,AREDT,ARQUIT
"RTN","SDECAR2",66,0)
 N FNUM,FDA,ARNEW,ARRET,ARMSG,ARDATA,ARERR,ARHOSN,AUDF,SDREC
"RTN","SDECAR2",67,0)
 N ARMAI,ARMAN,ARMAR,ARPARENT,ARPATTEL,ARENPRI,ARSTOP,ARSVCCON,ARSVCCOP
"RTN","SDECAR2",68,0)
 S (ARQUIT,AUDF)=0
"RTN","SDECAR2",69,0)
 S FNUM=$$FNUM^SDECAR
"RTN","SDECAR2",70,0)
 S RET="I00020ERRORID^T00030ERRORTEXT"_$C(30)
"RTN","SDECAR2",71,0)
 ; Use MERGE instead of SET so we can know if values were actually specified or not.
"RTN","SDECAR2",72,0)
 ; This way, if a value is null, we will delete any previous value,
"RTN","SDECAR2",73,0)
 ; but if it is missing, then we will just ignore it.
"RTN","SDECAR2",74,0)
 M ARIEN=INP(1)
"RTN","SDECAR2",75,0)
 S DFN=$G(INP(2))
"RTN","SDECAR2",76,0)
 I '+DFN S RET=RET_"-1^Invalid Patient ID."_$C(30,31) Q
"RTN","SDECAR2",77,0)
 I '$D(^DPT(DFN,0)) S RET=RET_"-1^Invalid Patient ID"_$C(30,31) Q
"RTN","SDECAR2",78,0)
 S AREDT=$P($G(INP(3)),":",1,2)
"RTN","SDECAR2",79,0)
 S %DT="TX" S X=AREDT D ^%DT S AREDT=Y
"RTN","SDECAR2",80,0)
 I Y=-1 S RET=RET_"-1^Invalid Origination date."_$C(30,31) Q
"RTN","SDECAR2",81,0)
 S ARORIGDT=$P(AREDT,".",1)
"RTN","SDECAR2",82,0)
 S ARINST=$G(INP(4)) I ARINST'="" D
"RTN","SDECAR2",83,0)
 .I '+ARINST S ARINST=$O(^DIC(4,"B",ARINST,0))
"RTN","SDECAR2",84,0)
 M ARTYPE=INP(5)
"RTN","SDECAR2",85,0)
 S ARCLIN=$G(INP(6))
"RTN","SDECAR2",86,0)
 I ARCLIN'="" D
"RTN","SDECAR2",87,0)
 .I +ARCLIN=ARCLIN D
"RTN","SDECAR2",88,0)
 ..I '$D(^SC(+ARCLIN,0)) S RET=RET_"-1^"_ARCLIN_" is an invalid Clinic ID."_$C(30,31) S ARQUIT=1 Q
"RTN","SDECAR2",89,0)
 ..;S ARCLIN=$$GET1^DIQ(44,ARCLIN_",",.01)
"RTN","SDECAR2",90,0)
 .I '(+ARCLIN=ARCLIN) D
"RTN","SDECAR2",91,0)
 ..S ARCLIN=$O(^SC("B",ARCLIN,0))
"RTN","SDECAR2",92,0)
 ..I ARCLIN="" S RET=RET_"-1^"_ARCLIN_" is an invalid Clinic Name."_$C(30,31) S ARQUIT=1 Q
"RTN","SDECAR2",93,0)
 Q:ARQUIT=1
"RTN","SDECAR2",94,0)
 S ARUSER=$G(INP(7))
"RTN","SDECAR2",95,0)
 I ARUSER'="" I '+ARUSER S ARUSER=$O(^VA(200,"B",ARUSER,0))
"RTN","SDECAR2",96,0)
 I ARUSER="" S ARUSER=DUZ
"RTN","SDECAR2",97,0)
 S ARREQBY=$G(INP(9)) I ARREQBY'="" D
"RTN","SDECAR2",98,0)
 .S ARREQBY=$S(ARREQBY="PATIENT":2,ARREQBY="PROVIDER":1,1:"")
"RTN","SDECAR2",99,0)
 S ARPROV=$G(INP(10)) I ARPROV'="" I '+ARPROV S ARPROV=$O(^VA(200,"B",ARPROV,0))
"RTN","SDECAR2",100,0)
 S ARDAPTDT=INP(11)
"RTN","SDECAR2",101,0)
 S %DT="" S X=$P($G(ARDAPTDT),"@",1) D ^%DT S ARPRIO=$S(Y=$P($$NOW^XLFDT,".",1):"A",1:"F")
"RTN","SDECAR2",102,0)
 S ARDAPTDT=Y
"RTN","SDECAR2",103,0)
 I Y=-1 S ARDAPTDT=""   ;S RET=RET_"-1^Invalid Desired Date."_$C(30,31)Q
"RTN","SDECAR2",104,0)
 S (INP(12),ARCOMM)=$TR($G(INP(12)),"^"," ")   ;alb/sat 658
"RTN","SDECAR2",105,0)
 S ARENPRI=$G(INP(13)) D
"RTN","SDECAR2",106,0)
 .S:ARENPRI'="" ARENPRI=$S(ARENPRI="GROUP 1":1,ARENPRI="GROUP 2":2,ARENPRI="GROUP3":3,ARENPRI="GROUP4":4,ARENPRI="GROUP 5":5,ARENPRI="GROUP 6":6,ARENPRI="GROUP 7":7,ARENPRI="GROUP 8":8,1:ARENPRI)
"RTN","SDECAR2",107,0)
 S ARMAR=$G(INP(14)) I ARMAR'="" S ARMAR=$S(ARMAR="YES":1,1:0)
"RTN","SDECAR2",108,0)
 M ARMAI=INP(15)
"RTN","SDECAR2",109,0)
 M ARMAN=INP(16)
"RTN","SDECAR2",110,0)
 S ARSVCCON=$G(INP(18)) S:ARSVCCON'="" ARSVCCON=$S(ARSVCCON="YES":1,1:0)
"RTN","SDECAR2",111,0)
 M ARSVCCOP=INP(19) I $G(ARSVCCOP)'="" S ARSVCCOP=+$G(ARSVCCOP) S:(+ARSVCCOP<0)!(+ARSVCCOP>100) ARSVCCOP=""
"RTN","SDECAR2",112,0)
 S ARSTOP=$G(INP(21))
"RTN","SDECAR2",113,0)
 I ARSTOP'="",ARCLIN'="" S RET=RET_"-1^Cannot include both Clinic and Service."_$C(30,31) Q
"RTN","SDECAR2",114,0)
 S ARAPTYP=+$G(INP(22)) I +ARAPTYP,'$D(^SD(409.1,ARAPTYP,0)) S ARAPTYP=""
"RTN","SDECAR2",115,0)
 S ARPARENT=+$G(INP(25)) I +ARPARENT,'$D(^SDEC(409.85,+ARPARENT,0)) S ARPARENT=""
"RTN","SDECAR2",116,0)
 S ARNLT=+$G(INP(26))
"RTN","SDECAR2",117,0)
 S ARPRER=$G(INP(27))
"RTN","SDECAR2",118,0)
 S ARORDN=+$G(INP(28))
"RTN","SDECAR2",119,0)
 ;CHECK FOR MISSING NLT,PREREQ,ORDER IEN ON MULTIPLE APPT REQUESTS
"RTN","SDECAR2",120,0)
 I +ARPARENT>0&(+$G(INP(26))=0) D
"RTN","SDECAR2",121,0)
 .S ARNLT=$P($G(^SDEC(409.85,+ARPARENT,7)),U,2)
"RTN","SDECAR2",122,0)
 I +ARPARENT>0&($G(INP(27))="") D
"RTN","SDECAR2",123,0)
 .N PRIEN,PR
"RTN","SDECAR2",124,0)
 .S PRIEN=0 F  S PRIEN=$O(^SDEC(409.85,+ARPARENT,8,PRIEN)) Q:PRIEN'>0  D
"RTN","SDECAR2",125,0)
 ..S PR=$P($G(^SDEC(409.85,+ARPARENT,8,PRIEN,0)),"^") Q:PR=""
"RTN","SDECAR2",126,0)
 ..S ARPRER=$S(ARPRER'="":ARPRER_";"_PR,1:PR)
"RTN","SDECAR2",127,0)
 I +ARPARENT>0&(+$G(INP(28))=0) D
"RTN","SDECAR2",128,0)
 .S ARORDN=$P($G(^SDEC(409.85,+ARPARENT,7)),U,1)
"RTN","SDECAR2",129,0)
 ;
"RTN","SDECAR2",130,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR2",131,0)
 S ARNEW=ARIEN=""
"RTN","SDECAR2",132,0)
 I ARNEW D
"RTN","SDECAR2",133,0)
 . S AUDF=1
"RTN","SDECAR2",134,0)
 . S FDA=$NA(FDA(FNUM,"+1,"))
"RTN","SDECAR2",135,0)
 . S @FDA@(.01)=+DFN   ;$S(+DFN:$P($G(^DPT(DFN,0)),U),1:DFN)
"RTN","SDECAR2",136,0)
 . ;This handles the date/time coming in as "8/27/2014 12:00:00 AM"
"RTN","SDECAR2",137,0)
 . S:$G(ARORIGDT)'="" @FDA@(1)=ARORIGDT
"RTN","SDECAR2",138,0)
 . S:$G(ARINST)'="" @FDA@(2)=+ARINST
"RTN","SDECAR2",139,0)
 . S:$G(ARTYPE)'="" @FDA@(4)=$S(ARTYPE="APPOINTMENT":"APPT",ARTYPE="MOBILE":"MOBILE",1:ARTYPE)
"RTN","SDECAR2",140,0)
 . S:$G(ARCLIN)'="" @FDA@(8)=+ARCLIN
"RTN","SDECAR2",141,0)
 . S:$G(ARSTOP)'="" @FDA@(8.5)=+ARSTOP
"RTN","SDECAR2",142,0)
 . S:+ARAPTYP @FDA@(8.7)=+ARAPTYP
"RTN","SDECAR2",143,0)
 . S:$G(ARUSER)'="" @FDA@(9)=+ARUSER
"RTN","SDECAR2",144,0)
 . S:$G(AREDT)'="" @FDA@(9.5)=AREDT
"RTN","SDECAR2",145,0)
 . S:$G(ARPRIO)'="" @FDA@(10)=ARPRIO
"RTN","SDECAR2",146,0)
 . S:$G(ARENPRI)'="" @FDA@(10.5)=ARENPRI
"RTN","SDECAR2",147,0)
 . S:$G(ARREQBY)'="" @FDA@(11)=ARREQBY
"RTN","SDECAR2",148,0)
 . S:$G(ARPROV)'="" @FDA@(12)=+ARPROV
"RTN","SDECAR2",149,0)
 . S:$G(ARSVCCOP)'="" @FDA@(14)=ARSVCCOP
"RTN","SDECAR2",150,0)
 . S:$G(ARSVCCON)'="" @FDA@(15)=+ARSVCCON
"RTN","SDECAR2",151,0)
 . S:$G(ARDAPTDT)'="" @FDA@(22)=ARDAPTDT
"RTN","SDECAR2",152,0)
 . S:$G(ARNLT)'="" @FDA@(47)=ARNLT
"RTN","SDECAR2",153,0)
 . D FDAPRER(.FDA,ARPRER,"+1")
"RTN","SDECAR2",154,0)
 . S:$G(ARORDN)'="" @FDA@(46)=ARORDN
"RTN","SDECAR2",155,0)
 . S @FDA@(23)="O"
"RTN","SDECAR2",156,0)
 . S:$G(ARCOMM)'="" @FDA@(25)=ARCOMM
"RTN","SDECAR2",157,0)
 . S:$G(ARMAR)'="" @FDA@(41)=ARMAR
"RTN","SDECAR2",158,0)
 . I +ARMAR,$G(ARMAI)'="" S @FDA@(42)=ARMAI
"RTN","SDECAR2",159,0)
 . I +ARMAR,$G(ARMAN)'="" S @FDA@(43)=ARMAN
"RTN","SDECAR2",160,0)
 . S:$G(INP(23))'="" @FDA@(.02)=$S(INP(23)="N":"N",INP(23)="NEW":"N",INP(23)="E":"E",INP(23)="ESTABLISHED":"E",1:"")
"RTN","SDECAR2",161,0)
 . S:+ARPARENT @FDA@(43.8)=+ARPARENT
"RTN","SDECAR2",162,0)
 E  D
"RTN","SDECAR2",163,0)
 . S ARIEN=ARIEN_"," ; Append the comma for both
"RTN","SDECAR2",164,0)
 . K ARDATA,ARERR
"RTN","SDECAR2",165,0)
 . D GETS^DIQ(FNUM,ARIEN,"*","IE","ARDATA","ARERR")
"RTN","SDECAR2",166,0)
 . I $D(ARERR) M ARMSG=ARERR K FDA Q
"RTN","SDECAR2",167,0)
 . S FDA=$NA(FDA(FNUM,ARIEN))
"RTN","SDECAR2",168,0)
 . I $D(ARORIGDT) D
"RTN","SDECAR2",169,0)
 . . S ARORIGDT=$P(ARORIGDT,"@",1) S %DT="" S X=ARORIGDT D ^%DT S ARORIGDTI=Y
"RTN","SDECAR2",170,0)
 . . I ARORIGDTI'=ARDATA(FNUM,ARIEN,1,"I") S @FDA@(1)=$S(ARORIGDT="":"@",1:ARORIGDT)
"RTN","SDECAR2",171,0)
 . I $D(ARINST),ARINST'=ARDATA(FNUM,ARIEN,2,"I") S @FDA@(2)=+ARINST
"RTN","SDECAR2",172,0)
 . I $D(ARTYPE),ARTYPE'=ARDATA(FNUM,ARIEN,4,"E") S @FDA@(4)=$S(ARTYPE="APPOINTMENT":"APPT",ARTYPE="MOBILE":"MOBILE",1:ARTYPE)
"RTN","SDECAR2",173,0)
 . I ARCLIN'="",ARCLIN'=ARDATA(FNUM,ARIEN,8,"I") S @FDA@(8)=+ARCLIN,AUDF=1 S:ARDATA(FNUM,ARIEN,8.5,"I")'="" @FDA@(8.5)="@"
"RTN","SDECAR2",174,0)
 . I ARSTOP'="",ARSTOP'=ARDATA(FNUM,ARIEN,8.5,"I") S @FDA@(8.5)=+ARSTOP,AUDF=1 S:ARDATA(FNUM,ARIEN,8,"I")'="" @FDA@(8)="@"
"RTN","SDECAR2",175,0)
 . S:+ARAPTYP @FDA@(8.7)=+ARAPTYP
"RTN","SDECAR2",176,0)
 . I $D(ARUSER),ARUSER'=ARDATA(FNUM,ARIEN,9,"I") S @FDA@(9)=+ARUSER
"RTN","SDECAR2",177,0)
 . I $D(AREDT),AREDT'=$G(ARDATA(FNUM,ARIEN,9.5,"I")) S @FDA@(9.5)=AREDT
"RTN","SDECAR2",178,0)
 . I $D(ARPRIO),ARPRIO'=ARDATA(FNUM,ARIEN,10,"I") S @FDA@(10)=$S(ARPRIO="":"@",1:ARPRIO)
"RTN","SDECAR2",179,0)
 . I $D(ARENPRI),ARENPRI'=ARDATA(FNUM,ARIEN,10.5,"E") S @FDA@(10.5)=ARENPRI
"RTN","SDECAR2",180,0)
 . I $D(ARREQBY),ARREQBY'=ARDATA(FNUM,ARIEN,11,"I") S @FDA@(11)=$S(ARREQBY="":"@",1:ARREQBY)
"RTN","SDECAR2",181,0)
 . I $D(ARPROV),ARPROV'=ARDATA(FNUM,ARIEN,12,"I") S @FDA@(12)=+ARPROV
"RTN","SDECAR2",182,0)
 . I $D(ARSVCCOP),ARSVCCOP'=$G(ARDATA(FNUM,ARIEN,14,"I")) S @FDA@(14)=ARSVCCOP
"RTN","SDECAR2",183,0)
 . I $D(ARSVCCON),ARSVCCON'=ARDATA(FNUM,ARIEN,15,"E") S @FDA@(15)=+ARSVCCON
"RTN","SDECAR2",184,0)
 . I $D(ARDAPTDT),ARDAPTDT'=ARDATA(FNUM,ARIEN,22,"I") S @FDA@(22)=$S(ARDAPTDT="":"@",1:ARDAPTDT)
"RTN","SDECAR2",185,0)
 . I $D(ARCOMM),ARCOMM'=ARDATA(FNUM,ARIEN,25,"I") S @FDA@(25)=$S(ARCOMM="":"@",1:ARCOMM)
"RTN","SDECAR2",186,0)
 . S:$G(ARMAR)'="" @FDA@(41)=ARMAR
"RTN","SDECAR2",187,0)
 . S:$G(ARMAI)'="" @FDA@(42)=ARMAI
"RTN","SDECAR2",188,0)
 . S:$G(ARMAN)'="" @FDA@(43)=ARMAN
"RTN","SDECAR2",189,0)
 . S:$G(ARNLT)'="" @FDA@(47)=ARNLT
"RTN","SDECAR2",190,0)
 . D DELPRER(+ARIEN)
"RTN","SDECAR2",191,0)
 . D FDAPRER(.FDA,ARPRER,+ARIEN)
"RTN","SDECAR2",192,0)
 . S:$G(ARORDN)'="" @FDA@(46)=ARORDN
"RTN","SDECAR2",193,0)
 . S:$G(INP(23))'="" @FDA@(.02)=$S(INP(23)="N":"N",INP(23)="NEW":"N",INP(23)="E":"E",INP(23)="ESTABLISHED":"E",1:"")
"RTN","SDECAR2",194,0)
 . S:+ARPARENT @FDA@(43.8)=+ARPARENT
"RTN","SDECAR2",195,0)
 ; Only call UPDATE^DIE if there are any array entries in FDA
"RTN","SDECAR2",196,0)
 D:$D(FDA)>9 UPDATE^DIE("","FDA","ARRET","ARMSG")
"RTN","SDECAR2",197,0)
 I $D(ARMSG) D
"RTN","SDECAR2",198,0)
 . F MI=1:1:$G(ARMSG("DIERR")) S RET=RET_"-1^"_$G(ARMSG("DIERR",MI,"TEXT",1))_$C(30)
"RTN","SDECAR2",199,0)
 . S RET=RET_$C(31)
"RTN","SDECAR2",200,0)
 Q:$D(ARMSG)
"RTN","SDECAR2",201,0)
 S ARINSTI=$P($G(^SDEC(409.85,$S(+ARIEN:ARIEN,1:ARRET(1)),0)),U,3)
"RTN","SDECAR2",202,0)
 I $G(INP(17))'="" D AR23(INP(17),$S(+ARIEN:ARIEN,1:ARRET(1)))   ;patient contacts
"RTN","SDECAR2",203,0)
 I +ARMAR,$G(INP(20))'="" D AR435(INP(20),$S(+ARIEN:ARIEN,1:ARRET(1)))   ;MRTC CALC PREF DATES
"RTN","SDECAR2",204,0)
 I +AUDF D ARAUD($S(+ARIEN:+ARIEN,1:ARRET(1)),ARCLIN,ARSTOP)   ;VS AUDIT
"RTN","SDECAR2",205,0)
 I $G(INP(24))'="" N SDI F SDI=1:1:$L(INP(24),"|") S SDREC=$P(INP(24),"|",SDI) D AR433($S(+ARIEN:+ARIEN,1:ARRET(1)),SDREC)
"RTN","SDECAR2",206,0)
 I +ARPARENT D AR433(+ARPARENT,"~"_$S(+ARIEN:+ARIEN,1:ARRET(1)))
"RTN","SDECAR2",207,0)
 I +$G(ARRET(1)) S RET=RET_ARRET(1)_U_$C(30,31)
"RTN","SDECAR2",208,0)
 E  S RET=RET_+ARIEN_U_$C(30,31)
"RTN","SDECAR2",209,0)
 Q
"RTN","SDECAR2",210,0)
 ;
"RTN","SDECAR2",211,0)
FDAPRER(FDA,ARPRER,ARIEN) ;Setup the FDA array for the PREREQUISITE multiple (#48)
"RTN","SDECAR2",212,0)
 N ASEQ,DELIM,PC,PR
"RTN","SDECAR2",213,0)
 Q:$G(ARPRER)=""
"RTN","SDECAR2",214,0)
 S DELIM=";",ASEQ=80
"RTN","SDECAR2",215,0)
 F PC=1:1:$L(ARPRER,DELIM) D
"RTN","SDECAR2",216,0)
 .S PR=$P(ARPRER,DELIM,PC) Q:PR=""
"RTN","SDECAR2",217,0)
 .S ASEQ=ASEQ+1,FDA(409.8548,"+"_ASEQ_","_ARIEN_",",.01)=PR
"RTN","SDECAR2",218,0)
 Q
"RTN","SDECAR2",219,0)
 ;
"RTN","SDECAR2",220,0)
DELPRER(ARIEN) ;Delete all entries in the PREREQUISITE multiple (#48)
"RTN","SDECAR2",221,0)
 N DIK,DA
"RTN","SDECAR2",222,0)
 Q:$G(ARIEN)'=+$G(ARIEN)  Q:ARIEN'>0
"RTN","SDECAR2",223,0)
 S DIK="^SDEC(409.85,"_ARIEN_",8,",DA(1)=ARIEN
"RTN","SDECAR2",224,0)
 S DA=0 F  S DA=$O(^SDEC(409.85,ARIEN,8,DA)) Q:DA'>0  D ^DIK
"RTN","SDECAR2",225,0)
 Q
"RTN","SDECAR2",226,0)
 ;
"RTN","SDECAR2",227,0)
GETPRER(RET,ARIEN) ;Return the values in the PREREQUISITE multiple (#48)
"RTN","SDECAR2",228,0)
 N CC,PR
"RTN","SDECAR2",229,0)
 I $G(^SDEC(409.85,+$G(ARIEN),0))="" S RET="-1^Invalid SDEC APPT REQUEST id "_$G(ARIEN) Q
"RTN","SDECAR2",230,0)
 S RET=""
"RTN","SDECAR2",231,0)
 S CC=0 F  S CC=$O(^SDEC(409.85,ARIEN,8,CC)) Q:CC'>0  D
"RTN","SDECAR2",232,0)
 .S PR=$P($G(^SDEC(409.85,ARIEN,8,CC,0)),U,1) Q:PR=""
"RTN","SDECAR2",233,0)
 .S RET=$S(RET'="":RET_U_PR,1:PR)
"RTN","SDECAR2",234,0)
 Q
"RTN","SDECAR2",235,0)
 ;
"RTN","SDECAR2",236,0)
ARAUD(ARIEN,ARCLIN,ARSTOP,DATE,USER) ;populate VS AUDIT multiple field 45
"RTN","SDECAR2",237,0)
 ; ARIEN   - (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",238,0)
 ; ARCLIN  - (optional) pointer to HOSPITAL LOCATION file 44
"RTN","SDECAR2",239,0)
 ; ARSTOP  - (optional) pointer to CLINIC STOP file
"RTN","SDECAR2",240,0)
 ; DATE    - (optional) date/time in fileman format
"RTN","SDECAR2",241,0)
 N SDFDA,SDP,SDPN
"RTN","SDECAR2",242,0)
 S ARIEN=$G(ARIEN) Q:ARIEN=""
"RTN","SDECAR2",243,0)
 S ARCLIN=$G(ARCLIN)
"RTN","SDECAR2",244,0)
 S ARSTOP=$G(ARSTOP)
"RTN","SDECAR2",245,0)
 S SDP=$O(^SDEC(409.85,ARIEN,6,9999999),-1)
"RTN","SDECAR2",246,0)
 I +SDP S SDPN=^SDEC(409.85,ARIEN,6,SDP,0) I $P(SDPN,U,3)=ARCLIN,$P(SDPN,U,4)=ARSTOP Q
"RTN","SDECAR2",247,0)
 S DATE=$G(DATE) S:DATE="" DATE=$E($$NOW^XLFDT,1,12)
"RTN","SDECAR2",248,0)
 S USER=$G(USER) S:USER="" USER=DUZ
"RTN","SDECAR2",249,0)
 S SDFDA(409.8545,"+1,"_ARIEN_",",.01)=DATE
"RTN","SDECAR2",250,0)
 S SDFDA(409.8545,"+1,"_ARIEN_",",1)=USER
"RTN","SDECAR2",251,0)
 S:ARCLIN'="" SDFDA(409.8545,"+1,"_ARIEN_",",2)=ARCLIN
"RTN","SDECAR2",252,0)
 S:ARSTOP'="" SDFDA(409.8545,"+1,"_ARIEN_",",3)=ARSTOP
"RTN","SDECAR2",253,0)
 D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",254,0)
 Q
"RTN","SDECAR2",255,0)
 ;
"RTN","SDECAR2",256,0)
AR433(ARIEN,SDEC) ;set MULT APPTS MADE
"RTN","SDECAR2",257,0)
 ;INPUT:
"RTN","SDECAR2",258,0)
 ;  ARIEN  = (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",259,0)
 ;  SDEC   = (required) child pointers to SDEC APPOINTMENT and SDEC APPTREQUEST file separated by pipe
"RTN","SDECAR2",260,0)
 ;                    each pipe piece contains the following ~ pieces:
"RTN","SDECAR2",261,0)
 ;                1. Appointment Id pointer to SDEC APPOINTMENT file 409.84
"RTN","SDECAR2",262,0)
 ;                2. Request Id pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",263,0)
 N SDAPP,SDFDA,SDI,SDIEN
"RTN","SDECAR2",264,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR2",265,0)
 Q:'$D(^SDEC(409.85,ARIEN,0))
"RTN","SDECAR2",266,0)
 S SDEC=$G(SDEC)
"RTN","SDECAR2",267,0)
 F SDI=1:1:$L(SDEC,"|") D
"RTN","SDECAR2",268,0)
 .K SDFDA
"RTN","SDECAR2",269,0)
 .S SDAPP=$P(SDEC,"|",SDI)
"RTN","SDECAR2",270,0)
 .I $P(SDAPP,"~",2)="",$P(SDAPP,"~",1)'="" S $P(SDAPP,"~",2)=$P($$GET1^DIQ(409.84,+SDAPP_",",.22,"I"),";",1)
"RTN","SDECAR2",271,0)
 .Q:$P(SDAPP,"~",2)=""
"RTN","SDECAR2",272,0)
 .S SDIEN=$O(^SDEC(409.85,ARIEN,2,"B",$P(SDAPP,"~",2),0))
"RTN","SDECAR2",273,0)
 .S SDIEN=$S(SDIEN'="":SDIEN,1:"+1")
"RTN","SDECAR2",274,0)
 .I $D(^SDEC(409.85,+$P(SDAPP,"~",2),0)) S SDFDA(409.852,SDIEN_","_ARIEN_",",.01)=+$P(SDAPP,"~",2)
"RTN","SDECAR2",275,0)
 .I $D(^SDEC(409.84,+$P(SDAPP,"~",1),0)) S SDFDA(409.852,SDIEN_","_ARIEN_",",.02)=+$P(SDAPP,"~",1)
"RTN","SDECAR2",276,0)
 .D:$D(SDFDA) UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",277,0)
 Q
"RTN","SDECAR2",278,0)
AR433D(SDEC) ;delete MULT APPTS MADE
"RTN","SDECAR2",279,0)
 ;INPUT:
"RTN","SDECAR2",280,0)
 ;  SDEC   = (required) pointers to SDEC APPOINTMENT file 409.84 separated by pipe
"RTN","SDECAR2",281,0)
 N ARIEN,DFN,DIEN,SDAPP,SDFDA,SDI,SDJ,SDTYP
"RTN","SDECAR2",282,0)
 S SDEC=$G(SDEC)
"RTN","SDECAR2",283,0)
 F SDI=1:1:$L(SDEC,"|") D
"RTN","SDECAR2",284,0)
 .S SDAPP=$P(SDEC,"|",SDI)
"RTN","SDECAR2",285,0)
 .Q:'$D(^SDEC(409.84,SDAPP,0))
"RTN","SDECAR2",286,0)
 .S DFN=$$GET1^DIQ(409.84,SDAPP_",",.05,"I")
"RTN","SDECAR2",287,0)
 .S SDTYP=$$GET1^DIQ(409.84,SDAPP_",",.22,"I"),DIEN=$P(SDTYP,";",1)
"RTN","SDECAR2",288,0)
 .I $P(SDTYP,";",2)="SDEC(409.85," S ARIEN="" F  S ARIEN=$O(^SDEC(409.85,"B",DFN,ARIEN)) Q:ARIEN=""  D  ; alb/jsm 658
"RTN","SDECAR2",289,0)
 ..S SDJ="" F  S SDJ=$O(^SDEC(409.85,ARIEN,2,"B",DIEN,SDJ)) Q:SDJ=""  D
"RTN","SDECAR2",290,0)
 ...S SDFDA(409.852,SDJ_","_ARIEN_",",.01)="@"
"RTN","SDECAR2",291,0)
 ...D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",292,0)
 Q
"RTN","SDECAR2",293,0)
AR438(ARIEN,SDPARENT,SDEC) ;set PARENT REQUEST field 43.8; set as child in MULTAPPTS MADE in parent request
"RTN","SDECAR2",294,0)
 N SDFDA
"RTN","SDECAR2",295,0)
 I $G(SDPARENT)'="" S SDFDA(409.85,ARIEN_",",43.8)=SDPARENT D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",296,0)
 Q
"RTN","SDECAR2",297,0)
 ;
"RTN","SDECAR2",298,0)
AR435(SDDT,ARIEN) ;set dates into MRTC CALC PREF DATES multiple field 43.5
"RTN","SDECAR2",299,0)
 ;INPUT:
"RTN","SDECAR2",300,0)
 ; ARIEN - Requested date ID pointer to SDEC REQUESTED APPT file 409.85
"RTN","SDECAR2",301,0)
 ; SDDT  - MRTC calculated preferred dates separated by pipe |:
"RTN","SDECAR2",302,0)
 ;         Each date can be in external format with no time.
"RTN","SDECAR2",303,0)
 N SDI,SDJ,SDFDA,X,Y,%DT
"RTN","SDECAR2",304,0)
 F SDI=1:1:$L(SDDT,"|") D
"RTN","SDECAR2",305,0)
 .S %DT="" S X=$P($P(SDDT,"|",SDI),"@",1) D ^%DT S SDJ=Y
"RTN","SDECAR2",306,0)
 .Q:SDJ=-1
"RTN","SDECAR2",307,0)
 .Q:$O(^SDEC(409.85,ARIEN,5,"B",SDJ,0))   ;don't add duplicates
"RTN","SDECAR2",308,0)
 .S SDFDA(409.851,"+1,"_ARIEN_",",.01)=SDJ
"RTN","SDECAR2",309,0)
 .D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",310,0)
 Q
"RTN","SDECAR2",311,0)
 ;
"RTN","SDECAR2",312,0)
WLACT(NAME) ;
"RTN","SDECAR2",313,0)
 N ACTIVE,H
"RTN","SDECAR2",314,0)
 S ACTIVE=""
"RTN","SDECAR2",315,0)
 S H="" F  S H=$O(^DIC(40.7,"B",NAME,H)) Q:H=""  D  Q:ACTIVE'=""
"RTN","SDECAR2",316,0)
 .I $P(^DIC(40.7,H,0),U,3)'="",$P(^DIC(40.7,H,0),U,3)<$$NOW^XLFDT() Q
"RTN","SDECAR2",317,0)
 .S ACTIVE=H
"RTN","SDECAR2",318,0)
 Q ACTIVE
"RTN","SDECAR2",319,0)
 ;
"RTN","SDECAR2",320,0)
AR23(INP17,ARI) ;Patient Contacts
"RTN","SDECAR2",321,0)
 N STR17,ARASD,ARASDH,ARDATA1,ARERR1,ARI1,ARIENS,ARIENS1,ARRET1,FDA
"RTN","SDECAR2",322,0)
 N ARDT,ARUSR,X,Y,%DT
"RTN","SDECAR2",323,0)
 S ARIENS=ARI_","
"RTN","SDECAR2",324,0)
 F ARI1=1:1:$L(INP17,"::") D
"RTN","SDECAR2",325,0)
 .S STR17=$P(INP17,"::",ARI1)
"RTN","SDECAR2",326,0)
 .K FDA
"RTN","SDECAR2",327,0)
 .S %DT="T" S X=$P($P(STR17,"~~",1),":",1,2) D ^%DT S ARASD=Y
"RTN","SDECAR2",328,0)
 .I (ARASD=-1)!(ARASD="") Q
"RTN","SDECAR2",329,0)
 .S ARDT=$P($P(STR17,"~~",1),":",1,2)
"RTN","SDECAR2",330,0)
 .S ARASDH=""   ;$O(^SDEC(409.85,ARI,4,"B",ARASD,0))
"RTN","SDECAR2",331,0)
 .S ARIENS1=$S(ARASDH'="":ARASDH,1:"+1")_","_ARIENS
"RTN","SDECAR2",332,0)
 .S FDA=$NA(FDA(409.8544,ARIENS1))
"RTN","SDECAR2",333,0)
 .I ARASDH'="" D
"RTN","SDECAR2",334,0)
 ..D GETS^DIQ(409.8544,ARIENS1,"*","IE","ARDATA1","ARERR1")
"RTN","SDECAR2",335,0)
 ..I $P(STR17,"~~",1)'="" S @FDA@(.01)=ARDT ;DATE ENTERED external date/time
"RTN","SDECAR2",336,0)
 ..I $P(STR17,"~~",2)'="" S ARUSR=$P(STR17,"~~",2) S @FDA@(2)=$S(ARUSR="":"@",+ARUSR:$P($G(^VA(200,ARUSR,0)),U,1),1:ARUSER)  ;PC ENTERED BY USER
"RTN","SDECAR2",337,0)
 ..I $P(STR17,"~~",4)'="" S @FDA@(3)=$P(STR17,"~~",4)     ;ACTION  C=Called; M=Message Left; L=LETTER
"RTN","SDECAR2",338,0)
 ..I $P(STR17,"~~",5)'="" S @FDA@(4)=$P(STR17,"~~",5)     ;PATIENT PHONE
"RTN","SDECAR2",339,0)
 ..;I $P(STR17,"~~",6)'="" S @FDA@(5)=$E($P(STR17,"~~",6),1,160)     ;COMMENT
"RTN","SDECAR2",340,0)
 .I ARASDH="" D
"RTN","SDECAR2",341,0)
 ..I $P(STR17,"~~",1)'="" S @FDA@(.01)=ARDT ;DATE ENTERED external date/time
"RTN","SDECAR2",342,0)
 ..I $P(STR17,"~~",2)'="" S ARUSR=$P(STR17,"~~",2) S @FDA@(2)=$S(ARUSR="":"@",+ARUSR:$P($G(^VA(200,ARUSR,0)),U,1),1:ARUSR)     ;PC ENTERED BY USER
"RTN","SDECAR2",343,0)
 ..I $P(STR17,"~~",4)'="" S @FDA@(3)=$P(STR17,"~~",4)     ;ACTION  C=Called; M=Message Left; L=LETTER
"RTN","SDECAR2",344,0)
 ..I $P(STR17,"~~",5)'="" S @FDA@(4)=$P(STR17,"~~",5)     ;PATIENT PHONE
"RTN","SDECAR2",345,0)
 ..;I $P(STR17,"~~",6)'="" S @FDA@(5)=$E($P(STR17,"~~",6),1,160)     ;COMMENT
"RTN","SDECAR2",346,0)
 .D:$D(@FDA) UPDATE^DIE("E","FDA","ARRET1","ARMSG1")
"RTN","SDECAR2",347,0)
 Q
"RTN","SDECAR2",348,0)
UPDATE(ARIEN,APPDT,SDCL,SVCP,SVCPR,NOTE,SDAPPTYP) ;update REQ APPT REQUEST at apointment add
"RTN","SDECAR2",349,0)
 ;INPUT:
"RTN","SDECAR2",350,0)
 ;  ARIEN = Appt Request pointer to SD WAIT LIST file 409.85
"RTN","SDECAR2",351,0)
 ;  APPDT = Appointment date/time (Scheduled Date of appt) in fm format
"RTN","SDECAR2",352,0)
 ;  SDCL  = Clinic ID pointer to HOSPITAL LOCATION file 44
"RTN","SDECAR2",353,0)
 ;  SVCP  = Service Connected Percentage numeric 0-100
"RTN","SDECAR2",354,0)
 ;  SVCPR = Service Connected Priority  0:NO  1:YES
"RTN","SDECAR2",355,0)
 ;  NOTE  = Comment only 1st 60 characters are used
"RTN","SDECAR2",356,0)
 ;  SDAPPTYP = (optional) Appointment type ID pointer to APPOINTMENT TYPE file 409.1
"RTN","SDECAR2",357,0)
 ;
"RTN","SDECAR2",358,0)
 ;all input must be verified by calling routine
"RTN","SDECAR2",359,0)
 N SDDIV,SDFDA,SDSN,SDMSG
"RTN","SDECAR2",360,0)
 S:+$G(SDAPPTYP) SDFDA(409.85,ARIEN_",",8.7)=SDAPPTYP
"RTN","SDECAR2",361,0)
 S SDFDA(409.85,ARIEN_",",13)=APPDT                     ;SCHEDULED DATEOF APPT       = APPDT  (SDECSTART)
"RTN","SDECAR2",362,0)
 S SDFDA(409.85,ARIEN_",",13.1)=$P($$NOW^XLFDT,".",1)   ;DATE APPT. MADE= TODAY
"RTN","SDECAR2",363,0)
 S SDFDA(409.85,ARIEN_",",13.2)=SDCL                    ;APPT CLINIC= SDCL   (SDECSCD)
"RTN","SDECAR2",364,0)
 S SDFDA(409.85,ARIEN_",",13.3)=$P($G(^SC(SDCL,0)),U,4) ;APPT INSTITUTION             = Get from 44 using SDCL
"RTN","SDECAR2",365,0)
 S SDFDA(409.85,ARIEN_",",13.4)=$P($G(^SC(SDCL,0)),U,7) ;APPT STOP CODE= Get from 44 using SDCL
"RTN","SDECAR2",366,0)
 S SDDIV=$P($G(^SC(SDCL,0)),U,15)
"RTN","SDECAR2",367,0)
 S SDSN=$S(SDDIV'="":$P($G(^DG(40.8,SDDIV,0)),U,2),1:"")
"RTN","SDECAR2",368,0)
 S SDFDA(409.85,ARIEN_",",13.6)=SDSN                    ;APPT STATION NMBER
"RTN","SDECAR2",369,0)
 S SDFDA(409.85,ARIEN_",",13.7)=DUZ                     ;APPT CLERK= Current User
"RTN","SDECAR2",370,0)
 S SDFDA(409.85,ARIEN_",",13.8)="R"                     ;APPT STATUS= R:Scheduled/Kept
"RTN","SDECAR2",371,0)
 S:SVCP'="" SDFDA(409.85,ARIEN_",",14)=SVCP                      ;SERVICE CONNECTED PERCENTAGE = SVCP   (SDSVCP)
"RTN","SDECAR2",372,0)
 S:SVCPR'="" SDFDA(409.85,ARIEN_",",15)=SVCPR                     ;SERVICE CONNECTED PRIORITY   = SVCPR  (SDSVCPR)
"RTN","SDECAR2",373,0)
 S:$G(NOTE)'="" SDFDA(409.85,ARIEN_",",25)=NOTE
"RTN","SDECAR2",374,0)
 D UPDATE^DIE("","SDFDA","","SDMSG")
"RTN","SDECAR2",375,0)
 Q
"RTN","SDECELG")
0^7^B3245996^B1142489
"RTN","SDECELG",1,0)
SDECELG ;SPFO/DMR SCHEDULING ENHANCEMENTS VSE API
"RTN","SDECELG",2,0)
 ;;5.3;Scheduling;**669,671**;Aug 13 1993;Build 25
"RTN","SDECELG",3,0)
 ;
"RTN","SDECELG",4,0)
 ;This API gets the all patient eligibility
"RTN","SDECELG",5,0)
 ;
"RTN","SDECELG",6,0)
 Q
"RTN","SDECELG",7,0)
START(RRN,DFN) ;
"RTN","SDECELG",8,0)
 S (NM,NM2,MECN,VET,VET1,ELGN,REO,RRN)=""
"RTN","SDECELG",9,0)
 ;
"RTN","SDECELG",10,0)
 S ELGN=0 F  S ELGN=$O(^DPT(DFN,"E",ELGN)) Q:ELGN="B"!(ELGN="")  D
"RTN","SDECELG",11,0)
 .S NM="" S NM=$P(^DIC(8,ELGN,0),"^",1)
"RTN","SDECELG",12,0)
 .Q:NM=""  S MECN="" S MECN=$P($G(^DIC(8,ELGN,0)),"^",9)
"RTN","SDECELG",13,0)
 .Q:'$G(MECN)  S NM2="" S NM2=$P(^DIC(8.1,MECN,0),"^",1)
"RTN","SDECELG",14,0)
 .Q:'$D(NM2)  S (VET,VET1)="" S VET=$P(^DIC(8.1,MECN,0),"^",5)
"RTN","SDECELG",15,0)
 .Q:'$D(VET)  S VET1=$S(VET="N":"NON-VETERAN",VET="Y":"VETERAN")
"RTN","SDECELG",16,0)
 .S REO=":"_ELGN_"^"_NM_"^"_NM2_"^"_VET1
"RTN","SDECELG",17,0)
 .S RRN=RRN_REO
"RTN","SDECELG",18,0)
 .Q
"RTN","SDECELG",19,0)
 K NM,NM2,MECN,VET,VET1,ELGN,REO
"RTN","SDECELG",20,0)
 Q
"RTN","SDECELG",21,0)
ELIG(RTN,PTIEN,CLIEN,ADT) ;
"RTN","SDECELG",22,0)
 N NM1,NM3,MECN1,VET2,VET3,ELIG1,HLAP0,HLAPIEN
"RTN","SDECELG",23,0)
 S RTN=""
"RTN","SDECELG",24,0)
 ;
"RTN","SDECELG",25,0)
 S ECODE=""
"RTN","SDECELG",26,0)
 S HLAPIEN=+$$FIND^SDAM2(PTIEN,ADT,CLIEN) I HLAPIEN'="" D
"RTN","SDECELG",27,0)
 .S HLAP0=$G(^SC(CLIEN,"S",ADT,1,HLAPIEN,0))
"RTN","SDECELG",28,0)
 .I HLAP0'="" D
"RTN","SDECELG",29,0)
 ..S ECODE=$P($G(HLAP0),"^",10)
"RTN","SDECELG",30,0)
 I ECODE="" S ECODE=$P(^DPT(PTIEN,.36),"^")
"RTN","SDECELG",31,0)
 ;
"RTN","SDECELG",32,0)
 S NM1="" S NM1=$P(^DIC(8,ECODE,0),"^",1) Q:NM1=""  D
"RTN","SDECELG",33,0)
 .Q:NM1=""  S MECN1="" S MECN1=$P($G(^DIC(8,ECODE,0)),"^",9)
"RTN","SDECELG",34,0)
 .Q:'$G(MECN1)  S NM3="" S NM3=$P(^DIC(8.1,MECN1,0),"^",1)
"RTN","SDECELG",35,0)
 .Q:'$D(NM3)  S (VET2,VET3)="" S VET2=$P(^DIC(8.1,MECN1,0),"^",5)
"RTN","SDECELG",36,0)
 .Q:'$D(VET2)  S VET3=$S(VET2="N":"NON-VETERAN",VET2="Y":"VETERAN")
"RTN","SDECELG",37,0)
 .S RTN=":"_ECODE_"^"_NM1_"^"_NM3_"^"_VET3
"RTN","SDECELG",38,0)
 .Q
"RTN","SDECELG",39,0)
 Q
"RTN","SDECEPT")
0^8^B129602604^B134242125
"RTN","SDECEPT",1,0)
SDECEPT ;SPFO/RT SCHEDULING ENHANCEMENTS VSE EP API
"RTN","SDECEPT",2,0)
 ;;5.3;Scheduling;**669,671**;Aug 13 1993;Build 25
"RTN","SDECEPT",3,0)
 ;
"RTN","SDECEPT",4,0)
 ;The API provides Extended Profile Appt info the VS Gui.
"RTN","SDECEPT",5,0)
 ;INPUT - DFN required
"RTN","SDECEPT",6,0)
 ;        APP appointment date/time required
"RTN","SDECEPT",7,0)
 Q
"RTN","SDECEPT",8,0)
 ;
"RTN","SDECEPT",9,0)
INIT ;
"RTN","SDECEPT",10,0)
 S (PAT0,PAM0,CLIEN,HLF0,HLAPIEN,HLAP0)=""
"RTN","SDECEPT",11,0)
 ;
"RTN","SDECEPT",12,0)
 ; PAT0=Global location 0 from Patient file
"RTN","SDECEPT",13,0)
 ; PAM0=Global location 0 from Patient Appointment Multiple
"RTN","SDECEPT",14,0)
 ; CLIEN=Clinic IEN
"RTN","SDECEPT",15,0)
 ; HLF0=Global location 0 from Hospital Location File
"RTN","SDECEPT",16,0)
 ; HLAPIEN=Hospital Location Appointment Multiple IEN
"RTN","SDECEPT",17,0)
 ; HLAP0=Global location 0 from Hospital Appointment Multiple
"RTN","SDECEPT",18,0)
 ;
"RTN","SDECEPT",19,0)
 ; SET HELPERS
"RTN","SDECEPT",20,0)
 S U="^"
"RTN","SDECEPT",21,0)
 ;
"RTN","SDECEPT",22,0)
 S PAT0=$G(^DPT(DFN,0))
"RTN","SDECEPT",23,0)
 S PAM0=$G(^DPT(DFN,"S",ADT,0)) I PAM0'="" D
"RTN","SDECEPT",24,0)
 .S CLIEN=$P($G(PAM0),U,1) I CLIEN'="" D
"RTN","SDECEPT",25,0)
 ..S HLF0=$G(^SC(CLIEN,0))
"RTN","SDECEPT",26,0)
 ..S HLAPIEN=+$$FIND^SDAM2(DFN,ADT,CLIEN) I HLAPIEN'="" D
"RTN","SDECEPT",27,0)
 ...S HLAP0=$G(^SC(CLIEN,"S",ADT,1,HLAPIEN,0))
"RTN","SDECEPT",28,0)
 Q
"RTN","SDECEPT",29,0)
 ;
"RTN","SDECEPT",30,0)
GETDEM(RET,DFN,ADT) ;
"RTN","SDECEPT",31,0)
 ; REQUIRE DFN AND APPOINTMENT DATE TIME
"RTN","SDECEPT",32,0)
 Q:'$G(DFN)
"RTN","SDECEPT",33,0)
 Q:'$G(ADT)
"RTN","SDECEPT",34,0)
 ;
"RTN","SDECEPT",35,0)
 D INIT
"RTN","SDECEPT",36,0)
 ;
"RTN","SDECEPT",37,0)
 ; INITIALIZE VARIABLES
"RTN","SDECEPT",38,0)
 S (PATN,RSSN,SSN,LAB,XRAY,EKG,PCODE,POV,ATIEN)=""
"RTN","SDECEPT",39,0)
 S (PAMAT,CCODE,COLL,CLN,LOA,OTH,ECODE,EGIL,PAMSC)=""
"RTN","SDECEPT",40,0)
 S (ENROLC,STAT)=""
"RTN","SDECEPT",41,0)
 ;
"RTN","SDECEPT",42,0)
 ;PATN=Patient Name - Patient File [0,1]
"RTN","SDECEPT",43,0)
 ;RSSN=Raw Social Securty Number  - Patient File [0,9]
"RTN","SDECEPT",44,0)
 ;SSN=Formatted Social Security Number
"RTN","SDECEPT",45,0)
 ;STAT=Status Patient Appointment Multiple - CURRENT STATUS (2.98,100)
"RTN","SDECEPT",46,0)
 ;LAB=Date/Time of Labs - PATIENT/APPOINTMENT MULTIPLE [0,3]
"RTN","SDECEPT",47,0)
 ;XRAY=Date/Time of x-ray - PATIENT/APPOINTMENT MULTIPLE [0,4]
"RTN","SDECEPT",48,0)
 ;EKG=Date/Time of EKG - PATIENT/APPOINTMENT MULTIPLE [0,5]
"RTN","SDECEPT",49,0)
 ;PCODE=Purpose of Visit Code - PATIENT/APPOINTMENT MULTIPLE [0,7]
"RTN","SDECEPT",50,0)
 ;POV=Purpose of Visit
"RTN","SDECEPT",51,0)
 ;ATIEN=Appointment Type IEN - PATIENT/APPOINTMENT MULTIPLE [0,16]
"RTN","SDECEPT",52,0)
 ;PAMAT=Patient Appointment Multiple Appointment Type
"RTN","SDECEPT",53,0)
 ;CCODE=Collateral Code - PATIENT/APPOINTMENT MULTIPLE [0,11]
"RTN","SDECEPT",54,0)
 ;COLL=Collateral Yes or No
"RTN","SDECEPT",55,0)
 ;CLN=Clinic Name - Hospital Location File [0,1]
"RTN","SDECEPT",56,0)
 ;LOA=Length of Appointment - Hospital Location Appointment Multiple [0,2]
"RTN","SDECEPT",57,0)
 ;ECODE=Eligibility Code - Hospital Location Appointment Multiple [0,10]
"RTN","SDECEPT",58,0)
 ;EGIL=Eligibility of Appointment
"RTN","SDECEPT",59,0)
 ;OCODE=Overbook Code - Hospital Location Appointment Multiple [QB]
"RTN","SDECEPT",60,0)
 ;OVB=Overbook
"RTN","SDECEPT",61,0)
 ;PATEN0=Patient Enrollment Clinic - Patient File Enrollment Clinic Multiple [B]
"RTN","SDECEPT",62,0)
 ;ENROLC=Enrolled in Clinic Yes/No
"RTN","SDECEPT",63,0)
 ;ERCNUM=Enrolled Clinic Number 
"RTN","SDECEPT",64,0)
 ;LPNUM=Loop Number 
"RTN","SDECEPT",65,0)
 ; 
"RTN","SDECEPT",66,0)
 ; -PATIENT FILE GLOBAL LOCATION 0
"RTN","SDECEPT",67,0)
 I PAT0'="" D
"RTN","SDECEPT",68,0)
 .S PATN=$P($G(PAT0),U,1)
"RTN","SDECEPT",69,0)
 .S RSSN=$P($G(PAT0),U,9) I RSSN'="" D
"RTN","SDECEPT",70,0)
 ..S SSN=$E(RSSN,1,3)_"-"_$E(RSSN,4,5)_"-"_$E(RSSN,6,9)
"RTN","SDECEPT",71,0)
 ;
"RTN","SDECEPT",72,0)
 ; -PATIENT/APPOINTMENT MULTIPLE GLOBAL LOCATION 0
"RTN","SDECEPT",73,0)
 I PAM0'="" D
"RTN","SDECEPT",74,0)
 .S STAT=$$STATUS^SDAM1(DFN,ADT,CLIEN,PAM0) I STAT'="" D
"RTN","SDECEPT",75,0)
 ..S STAT=$P(STAT,";",2)
"RTN","SDECEPT",76,0)
 .S LAB=$P($G(PAM0),U,3)
"RTN","SDECEPT",77,0)
 .S XRAY=$P($G(PAM0),U,4)
"RTN","SDECEPT",78,0)
 .S EKG=$P($G(PAM0),U,5)
"RTN","SDECEPT",79,0)
 .S PCODE=$P($G(PAM0),U,7) I PCODE'="" D
"RTN","SDECEPT",80,0)
 ..S POV=$S(PCODE=1:"C&P",PCODE=2:"10-10",PCODE=3:"SCHEDULED",PCODE=4:"UNSCHEDULED",1:"UNKNOWN")
"RTN","SDECEPT",81,0)
 .S ATIEN=$P($G(PAM0),U,16) I ATIEN'="" D
"RTN","SDECEPT",82,0)
 ..S PAMAT=$$GET1^DIQ(409.1,ATIEN,.01)
"RTN","SDECEPT",83,0)
 .S CCODE=$P($G(PAM0),U,11)
"RTN","SDECEPT",84,0)
 .S COLL="No" I CCODE=1 S COLL="Yes"
"RTN","SDECEPT",85,0)
 ;
"RTN","SDECEPT",86,0)
 ; -HOSPITAL LOCATION FILE GLOBAL LOCATION 0
"RTN","SDECEPT",87,0)
 I HLF0'="" D
"RTN","SDECEPT",88,0)
 .S CLN=$P($G(HLF0),U,1)
"RTN","SDECEPT",89,0)
 ;
"RTN","SDECEPT",90,0)
 ; -HOSPITAL LOCATION/APPOINTMENT/PATIENT MULTIPLE GLOBAL LOCATION 0
"RTN","SDECEPT",91,0)
 I HLAP0'="" D
"RTN","SDECEPT",92,0)
 .S LOA=+$P($G(HLAP0),U,2)
"RTN","SDECEPT",93,0)
 .S OTH=$P($G(HLAP0),U,4)
"RTN","SDECEPT",94,0)
 .S ECODE=$P($G(HLAP0),U,10) I ECODE'="" D
"RTN","SDECEPT",95,0)
 ..S EGIL=$$GET1^DIQ(8,ECODE,.01)
"RTN","SDECEPT",96,0)
 .I ECODE="" S EGIL=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),U)
"RTN","SDECEPT",97,0)
 ;
"RTN","SDECEPT",98,0)
 ; -HOSPITAL LOCATION/APPOINTMENT/PATIENT MULTIPLE GLOBAL LOCATION OB
"RTN","SDECEPT",99,0)
 S OCODE=$G(^SC(CLIEN,"S",ADT,1,HLAPIEN,"OB"))
"RTN","SDECEPT",100,0)
 S OVB="" I OCODE="O" S OVB="OVERBOOK"
"RTN","SDECEPT",101,0)
 ;
"RTN","SDECEPT",102,0)
 ; -PATIENT FILE ENROLLMENT CLINIC MULTIPLE
"RTN","SDECEPT",103,0)
 S ENROLC="No"
"RTN","SDECEPT",104,0)
 S LPNUM=0 F  S LPNUM=$O(^DPT(DFN,"DE",LPNUM)) Q:LPNUM=""  D
"RTN","SDECEPT",105,0)
 .S ERCNUM=$P($G(^DPT(DFN,"DE",LPNUM,0)),"^",1)
"RTN","SDECEPT",106,0)
 .Q:ERCNUM'=CLIEN
"RTN","SDECEPT",107,0)
 .I $P($G(^DPT(DFN,"DE",LPNUM,0)),"^",2)="" D
"RTN","SDECEPT",108,0)
 ..S ENROLC="Yes"
"RTN","SDECEPT",109,0)
 ..Q
"RTN","SDECEPT",110,0)
 ;
"RTN","SDECEPT",111,0)
 ; -CONVERT DATES TO EXTERNAL
"RTN","SDECEPT",112,0)
 S Y=ADT D D^DIQ S ADT=Y
"RTN","SDECEPT",113,0)
 I LAB'="" S Y=LAB D D^DIQ S LAB=Y
"RTN","SDECEPT",114,0)
 I XRAY'="" S Y=XRAY D D^DIQ S XRAY=Y
"RTN","SDECEPT",115,0)
 I EKG'="" S Y=EKG D D^DIQ S EKG=Y
"RTN","SDECEPT",116,0)
 ;
"RTN","SDECEPT",117,0)
 S RET=PATN_U_CLN_U_SSN_U_ADT_U_STAT_U_POV_U_LOA_U_PAMAT_U_LAB_U_EGIL_U_XRAY_U_OVB_U_EKG_U_COLL_U_OTH_U_ENROLC
"RTN","SDECEPT",118,0)
 ;
"RTN","SDECEPT",119,0)
 D EXIT
"RTN","SDECEPT",120,0)
 Q
"RTN","SDECEPT",121,0)
 ;
"RTN","SDECEPT",122,0)
GETEVT(RET,DFN,ADT) ;
"RTN","SDECEPT",123,0)
 ; REQUIRE DFN AND APPOINTMENT DATE TIME
"RTN","SDECEPT",124,0)
 Q:'$G(DFN)
"RTN","SDECEPT",125,0)
 Q:'$G(ADT)
"RTN","SDECEPT",126,0)
 ;
"RTN","SDECEPT",127,0)
 D INIT
"RTN","SDECEPT",128,0)
 ;
"RTN","SDECEPT",129,0)
 ; INITIALIZE VARIABLES
"RTN","SDECEPT",130,0)
 S (AMUIEN,AMU,AMD,HLAPC,CID,CIUIEN,CIUN,COD,COUIEN,CREAC)=""
"RTN","SDECEPT",131,0)
 S (COUN,COED,NCD,NCUIEN,NCUN,CANREA,RBD,CANREM,AMUN)=""
"RTN","SDECEPT",132,0)
 ;
"RTN","SDECEPT",133,0)
 ;AMUIEN=Appointment Made User IEN - Hospital Location Appointment Multiple [0,6]
"RTN","SDECEPT",134,0)
 ;AMUN=Appointment Made User Name - New Person File Field .01
"RTN","SDECEPT",135,0)
 ;AMD=Appointment Made Date - Hospital Location Appointment Multiple [0,7]
"RTN","SDECEPT",136,0)
 ;HLAPC=Global location C from Hospital Location Appointment Multiple
"RTN","SDECEPT",137,0)
 ;CID=Check-in Date - Hospital Location Appointment Multiple [C,1]
"RTN","SDECEPT",138,0)
 ;CIUIEN=Check-in User IEN - Hospital Location Appointment Multiple [C,2]
"RTN","SDECEPT",139,0)
 ;CIUN=Check-in User Name - New Person File Field .01
"RTN","SDECEPT",140,0)
 ;COD=Check Out Date - Hospital Location Appointment Multiple [C,3]
"RTN","SDECEPT",141,0)
 ;COUIEN=Check Out User IEN - Hospital Location Appointment Multiple [C,4]
"RTN","SDECEPT",142,0)
 ;COUN=Check Out User Name - New Person File Field .01
"RTN","SDECEPT",143,0)
 ;COED=Check Out Entered Date - Hospital Location Appointment Multiple [C,3]
"RTN","SDECEPT",144,0)
 ;NCD=No-Show/Cancel Date - PATIENT/APPOINTMENT MULTIPLE [0,14]
"RTN","SDECEPT",145,0)
 ;NCUIEN=No-Show/Cancel User IEN - PATIENT/APPOINTMENT MULTIPLE [0,12]
"RTN","SDECEPT",146,0)
 ;NCUN=No-Show/Cancel User Name - New Person File Field .01
"RTN","SDECEPT",147,0)
 ;CREAC=Cancel Reason Code - PATIENT/APPOINTMENT MULTIPLE [0,15]
"RTN","SDECEPT",148,0)
 ;CANREA=Cancel Reason - CANCELLATION REASONS [0,1]
"RTN","SDECEPT",149,0)
 ;RBD=Rebook Date - PATIENT/APPOINTMENT MULTIPLE [0,10]
"RTN","SDECEPT",150,0)
 ;CANREM=Cancel Remarks - PATIENT/APPOINTMENT MULTIPLE [R,1]
"RTN","SDECEPT",151,0)
 ;
"RTN","SDECEPT",152,0)
 ; -HOSPITAL LOCATION/APPOINTMENT/PATIENT MULTIPLE GLOBAL LOCATION 0
"RTN","SDECEPT",153,0)
 I HLAP0'="" D
"RTN","SDECEPT",154,0)
 .S AMUIEN=$P($G(HLAP0),U,6) I AMUIEN'="" D
"RTN","SDECEPT",155,0)
 ..S AMUN=$$GET1^DIQ(200,AMUIEN,.01,"E")
"RTN","SDECEPT",156,0)
 .S AMD=$P($G(HLAP0),U,7)
"RTN","SDECEPT",157,0)
 ;
"RTN","SDECEPT",158,0)
 ; -HOSPITAL LOCATION/APPOINTMENT/PATIENT MULTIPLE GLOBAL LOCATION C
"RTN","SDECEPT",159,0)
 S HLAPC=$G(^SC(CLIEN,"S",ADT,1,HLAPIEN,"C")) I HLAPC'="" D
"RTN","SDECEPT",160,0)
 .S CID=$P($G(HLAPC),U,1) I CID'="" D
"RTN","SDECEPT",161,0)
 ..S CIUIEN=$P($G(HLAPC),U,2) I CIUIEN'="" D
"RTN","SDECEPT",162,0)
 ...S CIUN=$$GET1^DIQ(200,CIUIEN,.01,"E")
"RTN","SDECEPT",163,0)
 .S COD=$P($G(HLAPC),U,3) I COD'="" D
"RTN","SDECEPT",164,0)
 ..S COUIEN=$P($G(HLAPC),U,4) I COUIEN'="" D
"RTN","SDECEPT",165,0)
 ...S COUN=$$GET1^DIQ(200,COUIEN,.01,"E")
"RTN","SDECEPT",166,0)
 ..S COED=$P($G(HLAPC),U,6)
"RTN","SDECEPT",167,0)
 ;
"RTN","SDECEPT",168,0)
 ; -PATIENT/APPOINTMENT MULTIPLE GLOBAL LOCATION 0
"RTN","SDECEPT",169,0)
 I PAM0'="" D
"RTN","SDECEPT",170,0)
 .S NCD=$P($G(PAM0),U,14) I NCD'="" D
"RTN","SDECEPT",171,0)
 ..S NCUIEN=$P($G(PAM0),U,12) I NCUIEN'="" D
"RTN","SDECEPT",172,0)
 ...S NCUN=$$GET1^DIQ(200,NCUIEN,.01,"E")
"RTN","SDECEPT",173,0)
 .S CREAC=$P($G(PAM0),U,15) I NCUIEN'="" D
"RTN","SDECEPT",174,0)
 ..S CANREA=$$GET1^DIQ(409.2,CREAC,.01)
"RTN","SDECEPT",175,0)
 .S RBD=$P($G(PAM0),U,10)
"RTN","SDECEPT",176,0)
 I AMUN="" D
"RTN","SDECEPT",177,0)
 .S AMUIEN=$P($G(PAM0),U,18) I AMUIEN'="" D
"RTN","SDECEPT",178,0)
 ..S AMUN=$$GET1^DIQ(200,AMUIEN,.01,"E")
"RTN","SDECEPT",179,0)
 I AMD="" D
"RTN","SDECEPT",180,0)
 .S AMD=$P($G(PAM0),U,19)
"RTN","SDECEPT",181,0)
 ;
"RTN","SDECEPT",182,0)
 ; -PATIENT/APPOINTMENT MULTIPLE GLOBAL LOCATION R
"RTN","SDECEPT",183,0)
 S PAMR=$G(^DPT(DFN,"S",ADT,"R")) I PAMR'="" D
"RTN","SDECEPT",184,0)
 .S CANREM=$P($G(PAMR),U,1)
"RTN","SDECEPT",185,0)
 ;
"RTN","SDECEPT",186,0)
 ; -CONVERT DATES TO EXTERNAL
"RTN","SDECEPT",187,0)
 I AMD'="" S Y=AMD D D^DIQ S AMD=Y
"RTN","SDECEPT",188,0)
 I CID'="" S Y=CID D D^DIQ S CID=Y
"RTN","SDECEPT",189,0)
 I COD'="" S Y=COD D D^DIQ S COD=Y
"RTN","SDECEPT",190,0)
 I COED'="" S Y=COED D D^DIQ S COED=Y
"RTN","SDECEPT",191,0)
 I NCD'="" S Y=NCD D D^DIQ S NCD=Y
"RTN","SDECEPT",192,0)
 ;
"RTN","SDECEPT",193,0)
 S RET=AMD_U_AMUN_U_CID_U_CIUN_U_COD_U_COUN_U_COED_U_NCD_U_NCUN_U_CANREA_U_CANREM_U_RBD
"RTN","SDECEPT",194,0)
 ;
"RTN","SDECEPT",195,0)
 D EXIT
"RTN","SDECEPT",196,0)
 Q
"RTN","SDECEPT",197,0)
 ;
"RTN","SDECEPT",198,0)
GETWT(RET,DFN,ADT) ;
"RTN","SDECEPT",199,0)
 ; REQUIRE DFN AND APPOINTMENT DATE TIME
"RTN","SDECEPT",200,0)
 Q:'$G(DFN)
"RTN","SDECEPT",201,0)
 Q:'$G(ADT)
"RTN","SDECEPT",202,0)
 ;
"RTN","SDECEPT",203,0)
 D INIT
"RTN","SDECEPT",204,0)
 ;
"RTN","SDECEPT",205,0)
 S (REQTC,REQT,NATCODE,NAT,AMD,PAM1,CID,FUVCODE,FUV,CWT1,CWT2)=""
"RTN","SDECEPT",206,0)
 ;
"RTN","SDECEPT",207,0)
 ;REQTC=Request Type Code - Patient File Appointment Multiple [0,25]
"RTN","SDECEPT",208,0)
 ;REQT=Request Type
"RTN","SDECEPT",209,0)
 ;NATCODE=Next Available Type Code - Patient File Appointment Multiple [0,26]
"RTN","SDECEPT",210,0)
 ;NAT=Next Available Type
"RTN","SDECEPT",211,0)
 ;AMD=Appointment Made Date - Patient File Appointment Multiple [0,19]
"RTN","SDECEPT",212,0)
 ;PAM1=Global Location 1 of the Patient File Appointment Multiple
"RTN","SDECEPT",213,0)
 ;CID=Clinic Indicated Date/Preferred Date - Patient File Appointment Multiple [1,1]
"RTN","SDECEPT",214,0)
 ;FUVCODE=Follow-Up Visit Code 1=Yes 0=No - Patient File Appointment Multiple [1,2]
"RTN","SDECEPT",215,0)
 ;FUV=Follow-Up Visit
"RTN","SDECEPT",216,0)
 ;CWT1=Clinic Wait Time 1
"RTN","SDECEPT",217,0)
 ;CWT2=Clinic Wait Time 2
"RTN","SDECEPT",218,0)
 ;
"RTN","SDECEPT",219,0)
 ; -PATIENT/APPOINTMENT MULTIPLE GLOBAL LOCATION 0
"RTN","SDECEPT",220,0)
 I PAM0'="" D
"RTN","SDECEPT",221,0)
 .S REQTC=$P($G(PAM0),U,25) I REQTC'="" D
"RTN","SDECEPT",222,0)
 ..I REQTC="N" S REQT="'NEXT AVAILABLE' APPT."
"RTN","SDECEPT",223,0)
 ..I REQTC="C" S REQT="OTHER THAN 'NEXT AVA.' (CLINICIAN REQ.)"
"RTN","SDECEPT",224,0)
 ..I REQTC="P" S REQT="OTHER THAN 'NEXT AVA.' (PATIENT REQ.)"
"RTN","SDECEPT",225,0)
 ..I REQTC="W" S REQT="WALKIN APPT."
"RTN","SDECEPT",226,0)
 ..I REQTC="M" S REQT="MULTIPLE APPT. BOOKING"
"RTN","SDECEPT",227,0)
 ..I REQTC="A" S REQT="AUTO REBOOK"
"RTN","SDECEPT",228,0)
 ..I REQTC="O" S REQT="OTHER THAN 'NEXT AVA.' APPT."
"RTN","SDECEPT",229,0)
 .S NATCODE=$P($G(PAM0),U,26) I NATCODE'="" D
"RTN","SDECEPT",230,0)
 ..I NATCODE=0 S NAT="NOT INDICATED TO BE A 'NEXT AVA.' APPT."
"RTN","SDECEPT",231,0)
 ..I NATCODE=1 S NAT="'NEXT AVA.' APPT. INDICATED BY USER"
"RTN","SDECEPT",232,0)
 ..I NATCODE=3 S NAT="'NEXT AVA.' APPT. INDICATED BY CALCULATION"
"RTN","SDECEPT",233,0)
 ..I NATCODE=4 S NAT="'NEXT AVA.' APPT. INDICATED BY USER & CALCULATION"
"RTN","SDECEPT",234,0)
 .S AMD=$P($G(PAM0),U,19)
"RTN","SDECEPT",235,0)
 ;
"RTN","SDECEPT",236,0)
 ; -PATIENT/APPOINTMENT MULTIPLE GLOBAL LOCATION 1
"RTN","SDECEPT",237,0)
 S PAM1=$G(^DPT(DFN,"S",ADT,1)) I PAM1'="" D
"RTN","SDECEPT",238,0)
 .S CID=$P($G(PAM1),U,1)
"RTN","SDECEPT",239,0)
 .S FUVCODE=$P($G(PAM1),U,2)
"RTN","SDECEPT",240,0)
 .S FUV="No" I FUVCODE=1 S FUV="Yes"
"RTN","SDECEPT",241,0)
 ;
"RTN","SDECEPT",242,0)
 ; CALULATE WAIT TIMES
"RTN","SDECEPT",243,0)
 S (X,X1,X2)=""
"RTN","SDECEPT",244,0)
 I AMD'="" D
"RTN","SDECEPT",245,0)
 .S X1=ADT S X2=AMD D ^%DTC S CWT1=X
"RTN","SDECEPT",246,0)
 I CID'="" D
"RTN","SDECEPT",247,0)
 .S X1=ADT S X2=CID D ^%DTC S CWT2=X
"RTN","SDECEPT",248,0)
 ;
"RTN","SDECEPT",249,0)
 ; -CONVERT DATES TO EXTERNAL
"RTN","SDECEPT",250,0)
 I CID'="" S Y=CID D D^DIQ S CID=Y
"RTN","SDECEPT",251,0)
 ;
"RTN","SDECEPT",252,0)
 S RET=REQT_U_NAT_U_CID_U_FUV_U_CWT1_U_CWT2
"RTN","SDECEPT",253,0)
 ;
"RTN","SDECEPT",254,0)
 D EXIT
"RTN","SDECEPT",255,0)
 Q
"RTN","SDECEPT",256,0)
 ;
"RTN","SDECEPT",257,0)
 ;STATUS, LAST ADMIT/LODGER DATE, LAST DISCHARGE/LODGER DATE
"RTN","SDECEPT",258,0)
INP ;
"RTN","SDECEPT",259,0)
 Q:'$G(DFN)
"RTN","SDECEPT",260,0)
 ;
"RTN","SDECEPT",261,0)
 S (LADMT,LDIS,DNUM,STAT,SDST,SDSTA,REN,A)=""
"RTN","SDECEPT",262,0)
 I '$D(^DGPM("C",DFN)) S LSTAT="NO INPT./LOD. ACT." Q
"RTN","SDECEPT",263,0)
 ;
"RTN","SDECEPT",264,0)
 S VAIP("D")="L",VAIP("L")="" D INP^DGPMV10
"RTN","SDECEPT",265,0)
 S A=$S("^3^5^"[("^"_+DGPMVI(2)_"^"):0,1:+DGPMVI(2)),SDST=$S('A:"IN",1:"")_"ACTIVE ",SDSTA=$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"LODGER",1:"INPATIENT")
"RTN","SDECEPT",266,0)
 S STAT="" S STAT=SDST_SDSTA
"RTN","SDECEPT",267,0)
 S LADMT="" S LADMT=$P($G(DGPMVI(13,1)),"^",2)
"RTN","SDECEPT",268,0)
 S DNUM="" S DNUM=$G(DGPMV1(17)) I DNUM'="" D
"RTN","SDECEPT",269,0)
 .S LDIS="" S LDIS=$$GET1^DIQ(405,DNUM,.01)
"RTN","SDECEPT",270,0)
 Q
"RTN","SDECEPT",271,0)
GETPTIN(RET,DFN,ADT) ;
"RTN","SDECEPT",272,0)
 ;REQUIRE DFN AND APPOINTMENT DATE TIME
"RTN","SDECEPT",273,0)
 Q:'$G(DFN)
"RTN","SDECEPT",274,0)
 Q:'$G(ADT)
"RTN","SDECEPT",275,0)
 ;
"RTN","SDECEPT",276,0)
 D INIT
"RTN","SDECEPT",277,0)
 ;
"RTN","SDECEPT",278,0)
 S (DOB,RSSN,SSN,SEX,MARSIEN,MARS,RELGP,PAT36,PELIG,POS,SADDR1,SWASIAC)=""
"RTN","SDECEPT",279,0)
 S (SADDR2,SADDR3,CITY,STATEN,STATE,CNTY,ADDR,PHN,CPHN,PGER,EMAIL,RADEXC)=""
"RTN","SDECEPT",280,0)
 S (RADEX,STAT,POW,LADMT,AOEXLC,AOEXL,LDIS,CMBTVC,CMBTV,CMBTVED,PROJ112)=""
"RTN","SDECEPT",281,0)
 S (PROCODE,SWASIA,PAT36,PAT11,PAT13,PAT36,PAT52,PAT321,PAT322,POWCODE)=""
"RTN","SDECEPT",282,0)
 S (RELGPN,PELIGN,POSN)=""
"RTN","SDECEPT",283,0)
 ;
"RTN","SDECEPT",284,0)
 ;DOB=Date Of Birth - Patient File [0,3]
"RTN","SDECEPT",285,0)
 ;RSSN=Raw Social Security Number - Patient File [0,9]
"RTN","SDECEPT",286,0)
 ;SSN=Formatted Social Security Number
"RTN","SDECEPT",287,0)
 ;SEX=Male or Female - Patient File [0,2]
"RTN","SDECEPT",288,0)
 ;MARSIEN=Marital Status IEN - Patient File [0,5] 
"RTN","SDECEPT",289,0)
 ;MARS=Marital Status - Marital Status File (11) Field .01
"RTN","SDECEPT",290,0)
 ;RELGPN=Religious Preference IEN - Patient File [0,8]
"RTN","SDECEPT",291,0)
 ;RELGP=Religious Preference - file 13 field .01 (Name)
"RTN","SDECEPT",292,0)
 ;PELIGN=Preimary Eligibility IEN - Patient File [.36,1]
"RTN","SDECEPT",293,0)
 ;PELIG=Primary Eligibility - File 8 field .01 (name) 
"RTN","SDECEPT",294,0)
 ;POSN=Period of Servic IEN
"RTN","SDECEPT",295,0)
 ;POS=Period of Service - File 21 Field .01 (Name)
"RTN","SDECEPT",296,0)
 ;SADDR1=Street Address 1 - Patient File [.11,1]
"RTN","SDECEPT",297,0)
 ;SADDR2=Street Address 2 - Patient File [.11,2]
"RTN","SDECEPT",298,0)
 ;SADDR3=Street Address 2 - Patient File [.11,3]
"RTN","SDECEPT",299,0)
 ;CITY=City - Patient File [.11,4]
"RTN","SDECEPT",300,0)
 ;STATEN=State IEN - Patient File [.11,5]
"RTN","SDECEPT",301,0)
 ;STATE=State - State File (5) Field .01
"RTN","SDECEPT",302,0)
 ;CNTYIEN=Country IEN - Patient File [.11,10]
"RTN","SDECEPT",303,0)
 ;CNTY=Country - Country Code File (779.004) Field .01
"RTN","SDECEPT",304,0)
 ;ADDR=Address
"RTN","SDECEPT",305,0)
 ;PHN=Phone Number - Patient File [.13,1]
"RTN","SDECEPT",306,0)
 ;CPHN=Cell Phone Number - Patient File [.13,4]
"RTN","SDECEPT",307,0)
 ;PGER=Pager Number - Patient File [.13,5]
"RTN","SDECEPT",308,0)
 ;EMAIL=Email Address - Patient File [.13,3]
"RTN","SDECEPT",309,0)
 ;RADEXC=Radiation Exposure CODE Y=Yes N=No U=Unknown - Patient File [.321,3]
"RTN","SDECEPT",310,0)
 ;RADEX=Radiation Exposure
"RTN","SDECEPT",311,0)
 ;
"RTN","SDECEPT",312,0)
 ;STAT=Status ???
"RTN","SDECEPT",313,0)
 ;
"RTN","SDECEPT",314,0)
 ;POWCODE=Prisoner Of War CODE Y=Yes N=No U=Unknown - Patient File [.52,5]
"RTN","SDECEPT",315,0)
 ;POW=Prisoner Of War
"RTN","SDECEPT",316,0)
 ;
"RTN","SDECEPT",317,0)
 ;LADMT=Last Admit/Lodger Date ???
"RTN","SDECEPT",318,0)
 ;
"RTN","SDECEPT",319,0)
 ;AOEXLC=Agent Orange Exposure Location CODE K=Korean DMZ V=Vietnam O=Other - Patient File [.321,13]
"RTN","SDECEPT",320,0)
 ;AOEXL=Agent Orange Exposure Location
"RTN","SDECEPT",321,0)
 ;
"RTN","SDECEPT",322,0)
 ;LDIS=Last Discharge/Lodger Date ???
"RTN","SDECEPT",323,0)
 ;
"RTN","SDECEPT",324,0)
 ;CMBTVC=Combat Veteran CODE Y=Yes N=No - Patient File [.52,11]
"RTN","SDECEPT",325,0)
 ;CMBTV=Combat Veteran
"RTN","SDECEPT",326,0)
 ;CMBTVED=Combat Veteran End Date - Patient File [.52,14]
"RTN","SDECEPT",327,0)
 ;PROCODE=Project 112/SHAD CODE 0=No 1=Yes - Patient File [.321,15]
"RTN","SDECEPT",328,0)
 ;PROJ112=Project 112/SHAD
"RTN","SDECEPT",329,0)
 ;SWASIAC=SW Asia Conditions Code Y=Yes N=No U=Unknown - Patient File [.322,13]
"RTN","SDECEPT",330,0)
 ;SWASIA=SW Asia Conditions
"RTN","SDECEPT",331,0)
 ; 
"RTN","SDECEPT",332,0)
 ; -PATIENT FILE GLOBAL LOCATION 0
"RTN","SDECEPT",333,0)
 I PAT0'="" D
"RTN","SDECEPT",334,0)
 .S DOB=$P($G(PAT0),U,3)
"RTN","SDECEPT",335,0)
 .S RSSN=$P($G(PAT0),U,9) I RSSN'="" D
"RTN","SDECEPT",336,0)
 ..S SSN=$E(RSSN,1,3)_"-"_$E(RSSN,4,5)_"-"_$E(RSSN,6,9)
"RTN","SDECEPT",337,0)
 .S SEXCODE=$P($G(PAT0),U,2) I SEXCODE'="" D
"RTN","SDECEPT",338,0)
 ..I SEXCODE="M" S SEX="Male"
"RTN","SDECEPT",339,0)
 ..I SEXCODE="F" S SEX="Female"
"RTN","SDECEPT",340,0)
 .S MARSIEN=$P($G(PAT0),U,5) I MARSIEN'="" D
"RTN","SDECEPT",341,0)
 ..S MARS=$$GET1^DIQ(11,MARSIEN,.01)
"RTN","SDECEPT",342,0)
 .S RELGPN=$P($G(PAT0),U,8) I RELGPN'="" D
"RTN","SDECEPT",343,0)
 ..S RELGP=$$GET1^DIQ(13,RELGPN,.01)
"RTN","SDECEPT",344,0)
 ;
"RTN","SDECEPT",345,0)
 ; -PATIENT FILE GLOBAL LOCATION .11
"RTN","SDECEPT",346,0)
 S PAT11=$G(^DPT(DFN,.11)) I PAT11'="" D
"RTN","SDECEPT",347,0)
 .S SADDR1=$P($G(PAT11),U,1)
"RTN","SDECEPT",348,0)
 .S SADDR2=$P($G(PAT11),U,2)
"RTN","SDECEPT",349,0)
 .S SADDR3=$P($G(PAT11),U,3)
"RTN","SDECEPT",350,0)
 .S CITY=$P($G(PAT11),U,4)
"RTN","SDECEPT",351,0)
 .S STATEN=$P($G(PAT11),U,5) I STATEN'="" D
"RTN","SDECEPT",352,0)
 ..S STATE=$$GET1^DIQ(5,STATEN,.01)
"RTN","SDECEPT",353,0)
 .S ZCODE=$P($G(PAT11),U,6)
"RTN","SDECEPT",354,0)
 .S CNTYIEN=$P($G(PAT11),U,10) I CNTYIEN'="" D
"RTN","SDECEPT",355,0)
 ..S CNTY=$$GET1^DIQ(779.004,CNTYIEN,.01)
"RTN","SDECEPT",356,0)
 .S SADDR=SADDR1 I SADDR2'="" D
"RTN","SDECEPT",357,0)
 ..S SADDR=SADDR1_" "_SADDR2 I SADDR3'="" D
"RTN","SDECEPT",358,0)
 ...S SADDR=SADDR1_" "_SADDR2_" "_SADDR3
"RTN","SDECEPT",359,0)
 .S ADDR=SADDR_" "_CITY_", "_STATE_" "_ZCODE_" "_CNTY
"RTN","SDECEPT",360,0)
 ;
"RTN","SDECEPT",361,0)
 ; -PATIENT FILE GLOBAL LOCATION .13
"RTN","SDECEPT",362,0)
 S PAT13=$G(^DPT(DFN,.13)) I PAT13'="" D
"RTN","SDECEPT",363,0)
 .S PHN=$P($G(PAT13),U,1)
"RTN","SDECEPT",364,0)
 .S CPHN=$P($G(PAT13),U,4)
"RTN","SDECEPT",365,0)
 .S PGER=$P($G(PAT13),U,5)
"RTN","SDECEPT",366,0)
 .S EMAIL=$P($G(PAT13),U,3)
"RTN","SDECEPT",367,0)
 ;
"RTN","SDECEPT",368,0)
 ; -PATIENT FILE GLOBAL LOCATION .36
"RTN","SDECEPT",369,0)
 S PAT36=$G(^DPT(DFN,.36)) I PAT36'="" D
"RTN","SDECEPT",370,0)
 .S PELIGN=$P($G(PAT36),U,1) I PELIGN'="" D
"RTN","SDECEPT",371,0)
 ..S PELIG=$$GET1^DIQ(8,PELIGN,.01)
"RTN","SDECEPT",372,0)
 ;
"RTN","SDECEPT",373,0)
 ; -PATIENT FILE GLOBAL LOCATION .52
"RTN","SDECEPT",374,0)
 S PAT52=$G(^DPT(DFN,.52)) I PAT52'="" D
"RTN","SDECEPT",375,0)
 .S POWCODE=$P($G(PAT52),U,5) I POWCODE'="" D
"RTN","SDECEPT",376,0)
 ..I POWCODE="Y" S POW="Yes"
"RTN","SDECEPT",377,0)
 ..I POWCODE="N" S POW="No"
"RTN","SDECEPT",378,0)
 ..I POWCODE="U" S POW="Unknown"
"RTN","SDECEPT",379,0)
 .S CMBTVC=$P($G(PAT52),U,11) I CMBTVC'="" D
"RTN","SDECEPT",380,0)
 ..S CMBTV="No"
"RTN","SDECEPT",381,0)
 ..I CMBTVC="Y" S CMBTV="Yes"
"RTN","SDECEPT",382,0)
 .S CMBTVED=$P($G(PAT52),U,14) I CMBTV="No" D
"RTN","SDECEPT",383,0)
 ..S CMBTVED="N/A"
"RTN","SDECEPT",384,0)
 ;
"RTN","SDECEPT",385,0)
 ; -PATIENT FILE GLOBAL LOCATION .321
"RTN","SDECEPT",386,0)
 S PAT321=$G(^DPT(DFN,.52)) I PAT321'="" D
"RTN","SDECEPT",387,0)
 .S RADEXC=$P($G(PAT321),U,3) I RADEXC'="" D
"RTN","SDECEPT",388,0)
 ..I RADEXC="Y" S RADEX="Yes"
"RTN","SDECEPT",389,0)
 ..I RADEXC="N" S RADEX="No"
"RTN","SDECEPT",390,0)
 ..I RADEXC="U" S RADEX="Unknown"
"RTN","SDECEPT",391,0)
 .S AOEXLC=$P($G(PAT321),U,13) I AOEXLC'="" D
"RTN","SDECEPT",392,0)
 ..I AOEXLC="K" S AOEXL="Korean DMZ"
"RTN","SDECEPT",393,0)
 ..I AOEXLC="V" S AOEXL="Vietnam"
"RTN","SDECEPT",394,0)
 ..I AOEXLC="O" S AOEXL="Other (Not Korean DMZ or Vietnam)"
"RTN","SDECEPT",395,0)
 .S PROCODE=$P($G(PAT321),U,15) I PROCODE'="" D
"RTN","SDECEPT",396,0)
 ..I PROCODE=2 S PROJ112="No"
"RTN","SDECEPT",397,0)
 ..I PROCODE=1 S PROJ112="Yes"
"RTN","SDECEPT",398,0)
 ;
"RTN","SDECEPT",399,0)
 ; -PATIENT FILE GLOBAL LOCATION .322
"RTN","SDECEPT",400,0)
 S PAT322=$G(^DPT(DFN,.52)) I PAT322'="" D
"RTN","SDECEPT",401,0)
 .S SWASIAC=$P($G(PAT322),U,13) I SWASIAC'="" D
"RTN","SDECEPT",402,0)
 ..I SWASIAC="Y" S SWASIA="Yes"
"RTN","SDECEPT",403,0)
 ..I SWASIAC="N" S SWASIA="No"
"RTN","SDECEPT",404,0)
 ..I SWASIAC="U" S SWASIA="Unknown"
"RTN","SDECEPT",405,0)
 ;
"RTN","SDECEPT",406,0)
 ; -CONVERT DATES TO EXTERNAL
"RTN","SDECEPT",407,0)
 I DOB'="" S Y=DOB D D^DIQ S DOB=Y
"RTN","SDECEPT",408,0)
 ;
"RTN","SDECEPT",409,0)
 ; -PERIOD OF SERVICE
"RTN","SDECEPT",410,0)
 S (POSN,POS)="" S POSN=$$GET1^DIQ(2,DFN_",",.323,"I") I POSN'="" S POS=$$GET1^DIQ(21,POSN,.01,"E")
"RTN","SDECEPT",411,0)
 ;
"RTN","SDECEPT",412,0)
 ; -GET STAT, LADMT, LDIS
"RTN","SDECEPT",413,0)
 D INP
"RTN","SDECEPT",414,0)
 ; 
"RTN","SDECEPT",415,0)
 S RET=DOB_U_SSN_U_SEX_U_MARS_U_RELGP_U_PELIG_U_POS_U_ADDR_U_PHN_U_CPHN_U_PGER_U_EMAIL_U_RADEX_U_STAT_U_POW_U_LADMT_U_AOEXL_U_LDIS_U_CMBTV_U_CMBTVED_U_PROJ112_U_SWASIA
"RTN","SDECEPT",416,0)
 ;
"RTN","SDECEPT",417,0)
 D EXIT
"RTN","SDECEPT",418,0)
 Q
"RTN","SDECEPT",419,0)
 ;
"RTN","SDECEPT",420,0)
EXIT ;
"RTN","SDECEPT",421,0)
 K PAT0,PAM0,CLIEN,HLF0,HLAPIEN,HLAP0,RSSN,PAMS,PCODE,ATIEN,CCODE,ECODE,PAMSC
"RTN","SDECEPT",422,0)
 K AMUIEN,AMU,HLAPC,CIUIEN,COUIEN,NCUIEN,PAT36,SADDR1,SWASIAC,SADDR2,SADDR3
"RTN","SDECEPT",423,0)
 K CITY,STATEN,STATE,CNTY,RADEXC,AOEXLC,CMBTVC,PROCODE,PAT36,PAT11,PAT13,PAT52
"RTN","SDECEPT",424,0)
 K PAT321,PAT322,ENROLC
"RTN","SDECEPT",425,0)
 Q
"RTN","SDECHL7")
0^3^B3330551^n/a
"RTN","SDECHL7",1,0)
SDECHL7 ;TUS/STAFF - VSE HL7 MESSAGING ;4:17 PM  29 Jun 2017
"RTN","SDECHL7",2,0)
 ;;5.3;Scheduling;**671**;Aug 13, 1993;Build 25
"RTN","SDECHL7",3,0)
 ;
"RTN","SDECHL7",4,0)
 Q
"RTN","SDECHL7",5,0)
 ;
"RTN","SDECHL7",6,0)
ARDISP(ARIEN,DISPOTN) ;
"RTN","SDECHL7",7,0)
 Q:(ARIEN?.N)=0
"RTN","SDECHL7",8,0)
 N SDHL7IN,RET,PRIEN,PR
"RTN","SDECHL7",9,0)
 S (SDHL7IN,RET)=""
"RTN","SDECHL7",10,0)
 S AREQ0=^SDEC(409.85,ARIEN,0)
"RTN","SDECHL7",11,0)
 S AREQ3=^SDEC(409.85,ARIEN,3)
"RTN","SDECHL7",12,0)
 S AREQ7=^SDEC(409.85,ARIEN,7)
"RTN","SDECHL7",13,0)
 S SDHL7IN("REQ FILE IEN")=ARIEN
"RTN","SDECHL7",14,0)
 ;PARTIAL
"RTN","SDECHL7",15,0)
 I $P(AREQ3,U,5)>0 S SDHL7IN("PARTIAL")=1
"RTN","SDECHL7",16,0)
 ;APPT TYPE
"RTN","SDECHL7",17,0)
 S APTYPEN=$P(AREQ0,U,6) I APTYPEN'="" D
"RTN","SDECHL7",18,0)
 .S SDHL7IN("APPT TYPE")=$$GET1^DIQ(409.1,APTYPEN,.01,"E")
"RTN","SDECHL7",19,0)
 ;CLINIC
"RTN","SDECHL7",20,0)
 S CLIEN=$P(AREQ0,U,9) I CLIEN'="" D
"RTN","SDECHL7",21,0)
 .S SDHL7IN("CLINIC")=CLIEN_U_$$GET1^DIQ(44,CLIEN,.01,"E")
"RTN","SDECHL7",22,0)
 ;COMMENT
"RTN","SDECHL7",23,0)
 S COMMENT=$P(AREQ0,U,18) I COMMENT'="" D
"RTN","SDECHL7",24,0)
 .S SDHL7IN("COMMENT")=COMMENT
"RTN","SDECHL7",25,0)
 ;DISPOSITIONED BY
"RTN","SDECHL7",26,0)
 S SDHL7IN("DISPOSITION BY")=DUZ_U_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","SDECHL7",27,0)
 ;MULTIPLE APPOINTMENT INFO
"RTN","SDECHL7",28,0)
 S SDHL7IN("NUMBER APPT")=$S(+$P(AREQ3,U,3)>0:$P(AREQ3,U,3),1:1)
"RTN","SDECHL7",29,0)
 I +$P(AREQ3,U,2)>0 D
"RTN","SDECHL7",30,0)
 .S SDHL7IN("INTERVAL")="Q"_+$P(AREQ3,U,2)_"D"
"RTN","SDECHL7",31,0)
 ;DISCONTINUE
"RTN","SDECHL7",32,0)
 I DISPOTN=1 D
"RTN","SDECHL7",33,0)
 .S SDHL7IN("DISCONTINUE")=1
"RTN","SDECHL7",34,0)
 ;#NLT#
"RTN","SDECHL7",35,0)
 S SDHL7IN("NLT")=$P(AREQ7,U,2)
"RTN","SDECHL7",36,0)
 ;ORDER IEN
"RTN","SDECHL7",37,0)
 S SDHL7IN("ORDER IEN")=$P(AREQ7,U)
"RTN","SDECHL7",38,0)
 ;PATIENT
"RTN","SDECHL7",39,0)
 S PATIEN=$P($G(AREQ0),U,1)
"RTN","SDECHL7",40,0)
 S SDHL7IN("PATIENT")=PATIEN_U_$$GET1^DIQ(2,PATIEN,.01,"E")
"RTN","SDECHL7",41,0)
 ;PREREQ
"RTN","SDECHL7",42,0)
 S PRIEN=0 F  S PRIEN=$O(^SDEC(409.85,ARIEN,8,PRIEN)) Q:PRIEN'>0  D
"RTN","SDECHL7",43,0)
 .S PR=$P($G(^SDEC(409.85,ARIEN,8,PRIEN,0)),U) Q:PR=""
"RTN","SDECHL7",44,0)
 .S SDHL7IN("PREREQ",PRIEN)=PR
"RTN","SDECHL7",45,0)
 ;RTC DATE
"RTN","SDECHL7",46,0)
 S SDHL7IN("RTC DATE")=$P($G(AREQ0),U,16)
"RTN","SDECHL7",47,0)
 D EN^SDHL7BLD(.SDHL7IN)
"RTN","SDECHL7",48,0)
 Q
"RTN","SDECU2")
0^11^B12464546^B12359142
"RTN","SDECU2",1,0)
SDECU2 ;ALB/SAT - VISTA SCHEDULING RPCS ;MAR 15, 2017
"RTN","SDECU2",2,0)
 ;;5.3;Scheduling;**627,658,671**;Aug 13, 1993;Build 25
"RTN","SDECU2",3,0)
 ;
"RTN","SDECU2",4,0)
 Q
"RTN","SDECU2",5,0)
 ;
"RTN","SDECU2",6,0)
SCIEN(PAT,CLINIC,DATE) ;PEP; returns ien for appt in ^SC
"RTN","SDECU2",7,0)
 NEW X,IEN
"RTN","SDECU2",8,0)
 S X=0 F  S X=$O(^SC(CLINIC,"S",DATE,1,X)) Q:'X  Q:$G(IEN)  D
"RTN","SDECU2",9,0)
 . Q:$P($G(^SC(CLINIC,"S",DATE,1,X,0)),U,9)="C"  ;cancelled
"RTN","SDECU2",10,0)
 . I +$G(^SC(CLINIC,"S",DATE,1,X,0))=PAT S IEN=X
"RTN","SDECU2",11,0)
 Q $G(IEN)
"RTN","SDECU2",12,0)
 ;
"RTN","SDECU2",13,0)
CI(PAT,CLINIC,DATE,SDIEN) ;PEP; -- returns 1 if appt already checked-in
"RTN","SDECU2",14,0)
 NEW X
"RTN","SDECU2",15,0)
 S X=$G(SDIEN)   ;ien sent in call
"RTN","SDECU2",16,0)
 I 'X S X=$$SCIEN(PAT,CLINIC,DATE) I 'X Q 0
"RTN","SDECU2",17,0)
 S X=$P($G(^SC(CLINIC,"S",DATE,1,X,"C")),U)
"RTN","SDECU2",18,0)
 Q $S(X:1,1:0)
"RTN","SDECU2",19,0)
 ;
"RTN","SDECU2",20,0)
APPTYP(PAT,DATE) ;PEP; -- returns type of appt (scheduled or walk-in)
"RTN","SDECU2",21,0)
 NEW X S X=$P($G(^DPT(PAT,"S",DATE,0)),U,7)
"RTN","SDECU2",22,0)
 Q $S(X=3:"SCHED",X=4:"WALK-IN",1:"??")
"RTN","SDECU2",23,0)
 ;
"RTN","SDECU2",24,0)
CO(PAT,CLINIC,DATE,SDIEN) ;PEP; -- returns 1 if appt already checked-out
"RTN","SDECU2",25,0)
 NEW X
"RTN","SDECU2",26,0)
 S X=$G(SDIEN)   ;ien sent in call
"RTN","SDECU2",27,0)
 I 'X S X=$$SCIEN(PAT,CLINIC,DATE) I 'X Q 0
"RTN","SDECU2",28,0)
 S X=$P($G(^SC(CLINIC,"S",DATE,1,X,"C")),U,3)
"RTN","SDECU2",29,0)
 Q $S(X:1,1:0)
"RTN","SDECU2",30,0)
 ;
"RTN","SDECU2",31,0)
GETVST(PAT,DATE) ;PEP; returns visit ien for appt date and patient
"RTN","SDECU2",32,0)
 NEW X
"RTN","SDECU2",33,0)
 I ('PAT)!('DATE) Q 0
"RTN","SDECU2",34,0)
 S X=$G(^DPT(PAT,"S",DATE,0)) I 'X Q 0   ;appt node
"RTN","SDECU2",35,0)
 S X=$P(X,U,20) I 'X Q 0                 ;outpt encounter ptr
"RTN","SDECU2",36,0)
 S X=$G(^SCE(X,0)) I 'X Q 0              ;outpt encounter node
"RTN","SDECU2",37,0)
 I $P(X,U,2)'=PAT Q 0                    ;patient ptr
"RTN","SDECU2",38,0)
 Q $P(X,U,5)                             ;visit ptr
"RTN","SDECU2",39,0)
 ;
"RTN","SDECU2",40,0)
FLAGS(DFN,FNUM) ;get PRF flags
"RTN","SDECU2",41,0)
 ;INPUT:
"RTN","SDECU2",42,0)
 ; DFN  - Patient ID
"RTN","SDECU2",43,0)
 ; FNUM - PRF Flag file ID  26.15=PRF NATIONAL FLAG  26.11=PRF LOCAL FLAG
"RTN","SDECU2",44,0)
 ;RETURN:
"RTN","SDECU2",45,0)
 ;  Each | piece contains the following ;; pieces:
"RTN","SDECU2",46,0)
 ;   1. PRFAID   - PRF Assignment ID pointer to PRF ASSIGNMENT file (#26.13)
"RTN","SDECU2",47,0)
 ;   2. PRFSTAT  - PRF Assignment Status 0=INACTIVE 1=ACTIVE
"RTN","SDECU2",48,0)
 ;   3. PRFLID   - PRF Local Flag ID pointer to PRF LOCAL FLAG file (#26.11)
"RTN","SDECU2",49,0)
 ;   4. PRFLNAME - PRF Local Flag name
"RTN","SDECU2",50,0)
 ;   5. PRFLSTAT - PRF Local Flag status  0=INACTIVE 1=ACTIVE
"RTN","SDECU2",51,0)
 ;
"RTN","SDECU2",52,0)
 N PRFAID,PRFID,PRFLST,RET,STAT
"RTN","SDECU2",53,0)
 S RET=""
"RTN","SDECU2",54,0)
 S DFN=$G(DFN)
"RTN","SDECU2",55,0)
 Q:DFN="" ""
"RTN","SDECU2",56,0)
 Q:'$D(^DPT(DFN,0)) ""
"RTN","SDECU2",57,0)
 S FNUM=$G(FNUM)
"RTN","SDECU2",58,0)
 Q:(FNUM'=26.15)&(FNUM'=26.11) ""
"RTN","SDECU2",59,0)
 D FLST(.PRFLIST,FNUM)
"RTN","SDECU2",60,0)
 S PRFID="" F  S PRFID=$O(PRFLIST(PRFID)) Q:PRFID=""  D
"RTN","SDECU2",61,0)
 .S PRFAID="" F  S PRFAID=$O(^DGPF(26.13,"AFLAG",PRFID,DFN,PRFAID)) Q:PRFAID=""  D
"RTN","SDECU2",62,0)
 ..S STAT="" S STAT=$$GET1^DIQ(26.13,PRFAID_",",.03,"I") Q:STAT'=1
"RTN","SDECU2",63,0)
 ..S RET=RET_$S(RET'="":"|",1:"")_PRFAID_";;"_STAT_";;"_+PRFID_";;"_$P(PRFLIST(PRFID),U,1)_";;"_$P(PRFLIST(PRFID),U,2)
"RTN","SDECU2",64,0)
 Q RET
"RTN","SDECU2",65,0)
FLST(PRFLIST,FNUM)  ;build flag list
"RTN","SDECU2",66,0)
 N PRFID,PRFN
"RTN","SDECU2",67,0)
 K PRFLIST
"RTN","SDECU2",68,0)
 S PRFN="" F  S PRFN=$O(^DGPF(FNUM,"B",PRFN)) Q:PRFN=""  D
"RTN","SDECU2",69,0)
 .S PRFID="" F  S PRFID=$O(^DGPF(FNUM,"B",PRFN,PRFID)) Q:PRFID=""  D
"RTN","SDECU2",70,0)
 ..S PRFLIST(PRFID_";DGPF("_FNUM_",")=$$GET1^DIQ(FNUM,PRFID_",",.01)_U_$$GET1^DIQ(FNUM,PRFID_",",.02,"I")
"RTN","SDECU2",71,0)
 Q
"RTN","SDECU2",72,0)
 ;
"RTN","SDECU2",73,0)
GAF(DFN) ;determine if GAF score needed
"RTN","SDECU2",74,0)
 N GAF,GAFR
"RTN","SDECU2",75,0)
 S GAFR=""
"RTN","SDECU2",76,0)
 S GAF=$$NEWGAF^SDUTL2(DFN)
"RTN","SDECU2",77,0)
 S:GAF="" GAF=-1
"RTN","SDECU2",78,0)
 S $P(GAFR,"|",1)=$S(+GAF:"New GAF Required",1:"No new GAF required")
"RTN","SDECU2",79,0)
 ;S $P(GAFR,"|",2)=$P(GAF,U,2)   ;alb/sat 658 removed 4 lines
"RTN","SDECU2",80,0)
 ;S $P(GAFR,"|",3)=$$FMTE^XLFDT($P(GAF,U,3))
"RTN","SDECU2",81,0)
 ;S $P(GAFR,"|",4)=$P(GAF,U,4)
"RTN","SDECU2",82,0)
 ;S $P(GAFR,"|",5)=$P($G(^VA(200,+$P(GAF,U,4),0)),U,1)
"RTN","SDECU2",83,0)
 Q GAFR
"RTN","SDECU2",84,0)
 ;
"RTN","SDECU2",85,0)
ETH(DFN,PETH,PETHN) ;get ethnicity list
"RTN","SDECU2",86,0)
 ;INPUT:
"RTN","SDECU2",87,0)
 ;  DFN = Patient ID pointer to PATIENT file
"RTN","SDECU2",88,0)
 ;RETURN:
"RTN","SDECU2",89,0)
 ;   PETH   - Patient Ethnicity list separated by pipe |
"RTN","SDECU2",90,0)
 ;               Pointer to ETHNICITY file 10.2
"RTN","SDECU2",91,0)
 ;   PETHN  - Patient Ethnicity names separated by pipe |
"RTN","SDECU2",92,0)
 N SDI,SDID
"RTN","SDECU2",93,0)
 S (PETH,PETHN)=""
"RTN","SDECU2",94,0)
 S SDI=0 F  S SDI=$O(^DPT(DFN,.06,SDI)) Q:SDI'>0  D
"RTN","SDECU2",95,0)
 .S SDID=$P($G(^DPT(DFN,.06,SDI,0)),U,1)
"RTN","SDECU2",96,0)
 .S PETH=$S(PETH'="":PETH_"|",1:"")_SDID
"RTN","SDECU2",97,0)
 .S PETHN=$S(PETHN'="":PETHN_"|",1:"")_$P($G(^DIC(10.2,SDID,0)),U,1)
"RTN","SDECU2",98,0)
 Q
"RTN","SDECU2",99,0)
RACELST(DFN,RACEIEN,RACENAM) ;get list of race information for given patient
"RTN","SDECU2",100,0)
 ;INPUT:
"RTN","SDECU2",101,0)
 ;  DFN = Patient ID pointer to PATIENT file
"RTN","SDECU2",102,0)
 ;RETURN:
"RTN","SDECU2",103,0)
 ;   RACEIEN  - Patient race list separated by pipe |
"RTN","SDECU2",104,0)
 ;               Pointer to RACE file 10
"RTN","SDECU2",105,0)
 ;   RACENAM  - Patient race names separated by pipe |
"RTN","SDECU2",106,0)
 N SDI,SDID
"RTN","SDECU2",107,0)
 S (RACEIEN,RACENAM)=""
"RTN","SDECU2",108,0)
 S SDI=0 F  S SDI=$O(^DPT(DFN,.02,SDI)) Q:SDI'>0  D
"RTN","SDECU2",109,0)
 .S SDID=$P($G(^DPT(DFN,.02,SDI,0)),U,1)
"RTN","SDECU2",110,0)
 .S RACEIEN=$S(RACEIEN'="":RACEIEN_"|",1:"")_SDID
"RTN","SDECU2",111,0)
 .S RACENAM=$S(RACENAM'="":RACENAM_"|",1:"")_$P($G(^DIC(10,SDID,0)),U,1)
"RTN","SDECU2",112,0)
 Q
"RTN","SDHL7")
0^4^B103204707^n/a
"RTN","SDHL7",1,0)
SDHL7 ;SLC/AGP - RTC Order HL7 receiver;11:53 AM  19 Jun 2017
"RTN","SDHL7",2,0)
 ;;5.3;Scheduling;**671**;Aug 13, 1993;Build 25
"RTN","SDHL7",3,0)
 ;
"RTN","SDHL7",4,0)
 ;RESULT("REQ FILE IEN")=0 REQUEST IEN if defined then the user is trying to modify or discontinue the order before scheduling disposition it.
"RTN","SDHL7",5,0)
 ;RESULT("APPT TYPE")="followup" Generic HL7 type for appointment type.Should be modify in the future when VSE and CPRS have more time to work on it
"RTN","SDHL7",6,0)
 ;RESULT("CHANGE")=1 If defined the REQ IEN (REQ FILE IEN) should be defined the user change the order before scheduling disposition it.
"RTN","SDHL7",7,0)
 ;RESULT("CLINIC")="240^20 MINUTE" file 44 IEN^entry .01 field
"RTN","SDHL7",8,0)
 ;RESULT("COMMENT")="This is the new comment field"
"RTN","SDHL7",9,0)
 ;RESULT("DISCONTINUE")=1 If defined the REQ IEN (REQ FILE IEN) should be defined the user discontinue the order before scheduling disposition it.
"RTN","SDHL7",10,0)
 ;RESULT("ENTERED BY")="10000000195^PULEO,ANTHONY" the person who entere
"RTN","SDHL7",11,0)
 ;RESULT("INTERVAL")="Q7D" only defined if the number of appointments in greater then 1
"RTN","SDHL7",12,0)
 ;RESULT("MSG ID")="" ID to track rejection ORDER IEN^ACTION (S03, S05,S01)
"RTN","SDHL7",13,0)
 ;RESULT("NEW ORDER")=1 this is the request of a new RTC order being placed in CPRS.
"RTN","SDHL7",14,0)
 ;RESULT("NLT")=1 If this is a No Later Than appointment request
"RTN","SDHL7",15,0)
 ;RESULT("NUMBER APPT")=4 total number of appointment requested
"RTN","SDHL7",16,0)
 ;RESULT("ORDER IEN")=14524362 IEN from file 100
"RTN","SDHL7",17,0)
 ;RESULT("PATIENT")="346^RECORD, THREE"
"RTN","SDHL7",18,0)
 ;RESULT("PREREQ,1)="LAB" user can select prereq in CPRS. It is up to scheduling if they want to use this information
"RTN","SDHL7",19,0)
 ;RESULT("PREREQ",2)="XRAY"
"RTN","SDHL7",20,0)
 ;RESULT("PREREQ",3)="VITALS"
"RTN","SDHL7",21,0)
 ;RESULT("RTC DATE")=20170524 Requested date for the Return To Clinic appointment
"RTN","SDHL7",22,0)
 ;RESULT("SIGNED BY")="10000000195^PULEO,ANTHONY" the person who signedthe order, file 200 IEN^entry .01 field
"RTN","SDHL7",23,0)
 ;
"RTN","SDHL7",24,0)
 ;if RESULT("REJECTION ERROR") is defined. It means CPRS rejected the message update. The user should be aware of the error message
"RTN","SDHL7",25,0)
 ;so the data should cann be cleanup
"RTN","SDHL7",26,0)
 ;
"RTN","SDHL7",27,0)
 ;TODO: WIRE UP RESULT("REJECTION ERROR") TO REPORT BACK TO THE GUI
"RTN","SDHL7",28,0)
 ;
"RTN","SDHL7",29,0)
EN(MSG) ; -- main entry point for OR RECEIVE where MSG contains HL7 msg
"RTN","SDHL7",30,0)
 N ACTION,AIG,AIL,ARQ,DATE,ENTER,ERROR,FREQ,FAILMSA,HASMSA,INST,MSH,NODE,NUM,NXT,PAT,RESULT,SDMSG,X,PID,PV1,SEG,SIGN
"RTN","SDHL7",31,0)
 S ERROR=""
"RTN","SDHL7",32,0)
 S SDMSG=$S($L($G(MSG)):MSG,1:"MSG") ; MSG="NAME" or MSG(#)=message
"RTN","SDHL7",33,0)
 I '$O(@SDMSG@(0)) S ERROR="Missing HL7 message" Q
"RTN","SDHL7",34,0)
 S MSH=0 F  S MSH=$O(@SDMSG@(MSH)) Q:MSH'>0  Q:$E(@SDMSG@(MSH),1,3)="MSH"
"RTN","SDHL7",35,0)
 I 'MSH S ERROR="Missing or invalid MSH segment" Q
"RTN","SDHL7",36,0)
 S X=0,FAILMSA=0,HASMSA=0 F  S X=$O(@SDMSG@(X)) Q:X'>0!(ERROR'="")!(HASMSA=1)  D
"RTN","SDHL7",37,0)
 .S SEG=$P(@SDMSG@(X),"|"),NODE=$P(@SDMSG@(X),"|",2,99)
"RTN","SDHL7",38,0)
 .I SEG="MSA" S HASMSA=1
"RTN","SDHL7",39,0)
 .S SEG=SEG_"(.RESULT,X,NODE,.ERROR)"
"RTN","SDHL7",40,0)
 .D @SEG
"RTN","SDHL7",41,0)
 I FAILMSA=1 D REJECT(.RESULT) G ENX
"RTN","SDHL7",42,0)
 I HASMSA=1 G ENX
"RTN","SDHL7",43,0)
 I ERROR'="" D SENDFAIL(.ERROR,.RESULT) G ENX
"RTN","SDHL7",44,0)
 ;HANDLE REJECTION ERRORS
"RTN","SDHL7",45,0)
 I $D(RESULT("REJECTION ERROR")) S ^TMP($J,"REJECT",RESULT("REQ FILE IEN"))=RESULT("REJECTION ERROR") G ENX
"RTN","SDHL7",46,0)
 ;DISCONTINUE REQUEST
"RTN","SDHL7",47,0)
 I $G(RESULT("DISCONTINUE"))=1 D VALDDIS(.RESULT,.ERROR)
"RTN","SDHL7",48,0)
 I ERROR="" D DISCONT(.RESULT,.ERROR)
"RTN","SDHL7",49,0)
 I ERROR'=""  D SENDFAIL(.ERROR,.RESULT) G ENX
"RTN","SDHL7",50,0)
 ;NEW OR CHANGE REQUEST
"RTN","SDHL7",51,0)
 I $G(RESULT("DISCONTINUE"))'=1 D VALIDATE(.RESULT,.ERROR)
"RTN","SDHL7",52,0)
 I ERROR="" D SAVEREC(.RESULT,.ERROR)
"RTN","SDHL7",53,0)
 I ERROR'="" D SENDFAIL(.ERROR,.RESULT) G ENX
"RTN","SDHL7",54,0)
 D SENDOK(.RESULT)
"RTN","SDHL7",55,0)
ENX ;
"RTN","SDHL7",56,0)
 Q
"RTN","SDHL7",57,0)
 ;
"RTN","SDHL7",58,0)
MSA(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",59,0)
 I $P(SEG,"|")'="AR" Q
"RTN","SDHL7",60,0)
 S RESULT("REJECTION ERROR")=$P(SEG,"|",2) S FAILMSA=1
"RTN","SDHL7",61,0)
 Q
"RTN","SDHL7",62,0)
 ;
"RTN","SDHL7",63,0)
MSH(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",64,0)
 S RESULT("MSG ID")=$P(SEG,"|",9)
"RTN","SDHL7",65,0)
 S RESULT("MSG DATE/TIME")=$$HL7TFM^XLFDT($P(SEG,"|",6),"L")
"RTN","SDHL7",66,0)
 Q
"RTN","SDHL7",67,0)
 ;
"RTN","SDHL7",68,0)
ARQ(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",69,0)
 S RESULT("ORDER IEN")=+$P(SEG,"|"),RESULT("REQ FILE IEN")=+$P(SEG,"|",2)
"RTN","SDHL7",70,0)
 S RESULT("APPT TYPE")=$P($P(SEG,"|",5),U,2)
"RTN","SDHL7",71,0)
 S ACTION=$P(SEG,"|",6) S RESULT($S(ACTION="S05":"DISCONTINUE",ACTION="S03":"CHANGE",1:"NEW ORDER"))=1
"RTN","SDHL7",72,0)
 S DATE=$P(SEG,"|",8),TIME=$P(SEG,"|",9)
"RTN","SDHL7",73,0)
 I TIME="T" S RESULT("NLT")=1
"RTN","SDHL7",74,0)
 S RESULT("RTC DATE")=$$HL7TFM^XLFDT($S(TIME="T":$P(DATE,U,2),1:$P(DATE,U)),"L")
"RTN","SDHL7",75,0)
 S FREQ=$P(SEG,"|",10),NUM=$P(SEG,"|",11)
"RTN","SDHL7",76,0)
 S RESULT("NUMBER APPT")=NUM I NUM>0 S RESULT("INTERVAL")=+$E(FREQ,2,3)
"RTN","SDHL7",77,0)
 S RESULT("SIGNED BY")=$P(SEG,"|",12)
"RTN","SDHL7",78,0)
 S RESULT("ENTERED BY")=$P(SEG,"|",16)
"RTN","SDHL7",79,0)
 Q
"RTN","SDHL7",80,0)
 ;
"RTN","SDHL7",81,0)
AIL(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",82,0)
 S RESULT("CLINIC")=$P(SEG,"|",3)
"RTN","SDHL7",83,0)
 Q
"RTN","SDHL7",84,0)
AIG(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",85,0)
 N INST,NODE
"RTN","SDHL7",86,0)
 S RESULT("PREREQ",$P(SEG,"|"))=$P($P(SEG,"|",2),U,2)
"RTN","SDHL7",87,0)
 S INST=0 F  S INST=$O(@SDMSG@(X,INST)) Q:INST'>0  D
"RTN","SDHL7",88,0)
 .S NODE=$P(@SDMSG@(X,INST),"|",2,99)
"RTN","SDHL7",89,0)
 .S RESULT("PREREQ",$P(NODE,"|"))=$P($P(NODE,"|",2),U,2)
"RTN","SDHL7",90,0)
 Q
"RTN","SDHL7",91,0)
 ;
"RTN","SDHL7",92,0)
NTE(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",93,0)
 S RESULT("COMMENT")=$$UNESC($P(SEG,"|",3))
"RTN","SDHL7",94,0)
 Q
"RTN","SDHL7",95,0)
 ;
"RTN","SDHL7",96,0)
PID(RESULT,X,SEG,ERROR) ;
"RTN","SDHL7",97,0)
 S RESULT("PATIENT")=$P(SEG,"|",3)_U_$P(SEG,"|",5)
"RTN","SDHL7",98,0)
 Q
"RTN","SDHL7",99,0)
 ;
"RTN","SDHL7",100,0)
PV1(RESULT,X,SEG,ERROR) ; -- Gets Patient location info.
"RTN","SDHL7",101,0)
 ;    may not be needed for scheduling
"RTN","SDHL7",102,0)
 ;PV1="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||||||||||||||"_$G(VISIT)
"RTN","SDHL7",103,0)
 Q
"RTN","SDHL7",104,0)
 ;
"RTN","SDHL7",105,0)
FMDATE(Y) ; -- Convert HL7 date/time to FM format
"RTN","SDHL7",106,0)
 Q $$HL7TFM^XLFDT(Y)
"RTN","SDHL7",107,0)
 ;
"RTN","SDHL7",108,0)
 ;
"RTN","SDHL7",109,0)
REJECT(RESULT) ;
"RTN","SDHL7",110,0)
 ; SHOW TO USER
"RTN","SDHL7",111,0)
 ; RESULT("REJECTION ERROR")
"RTN","SDHL7",112,0)
 Q
"RTN","SDHL7",113,0)
 ;
"RTN","SDHL7",114,0)
VALIDATE(RESULT,ERROR) ;
"RTN","SDHL7",115,0)
 S (RTCD,SBIEN,PATIEN,ORDIEN,CLNIEN,NUMAPP,CHGREQ,EBIEN)=""
"RTN","SDHL7",116,0)
 ;RTC DATE VALIDATION
"RTN","SDHL7",117,0)
 S RTCD=$G(RESULT("RTC DATE"))
"RTN","SDHL7",118,0)
 I RTCD="" S ERROR="An RTC Date is requried" Q
"RTN","SDHL7",119,0)
 I (RTCD?7N)=0 S ERROR="RTC Date must be an internal date" Q
"RTN","SDHL7",120,0)
 ;SIGNED BY VALIDATION
"RTN","SDHL7",121,0)
 S SBIEN=$P($G(RESULT("SIGNED BY")),"^",1)
"RTN","SDHL7",122,0)
 I SBIEN="" S ERROR="An IEN is required as the first piece of Signed By" Q
"RTN","SDHL7",123,0)
 I (SBIEN?1N.N)=0 S ERROR="The Signed By IEN is must be a number" Q
"RTN","SDHL7",124,0)
 ;ENTERED BY VALIDATION
"RTN","SDHL7",125,0)
 S EBIEN=$P($G(RESULT("ENTERED BY")),"^",1)
"RTN","SDHL7",126,0)
 I EBIEN="" S ERROR="An IEN is required as the first piece of Entered By" Q
"RTN","SDHL7",127,0)
 I (EBIEN?1N.N)=0 S ERROR="The Entered By IEN is must be a number" Q
"RTN","SDHL7",128,0)
 ;PATIENT VALIDATION
"RTN","SDHL7",129,0)
 S PATIEN=$P($G(RESULT("PATIENT")),"^",1)
"RTN","SDHL7",130,0)
 I PATIEN="" S ERROR="An IEN is required as the first piece of Patient" Q
"RTN","SDHL7",131,0)
 I (PATIEN?1N.N)=0 S ERROR="Patient IEN must be a number" Q
"RTN","SDHL7",132,0)
 ;CLINIC VALIDATION
"RTN","SDHL7",133,0)
 S CLNIEN=$P($G(RESULT("CLINIC")),"^",1)
"RTN","SDHL7",134,0)
 I CLNIEN="" S ERROR="An IEN is required as the first piece of Clinic" Q
"RTN","SDHL7",135,0)
 I (CLNIEN?1N.N)=0 S ERROR=ERROR_"An Clinic IEN must be a number"_"^"
"RTN","SDHL7",136,0)
 ;ORDER IEN VALIDATION
"RTN","SDHL7",137,0)
 S ORDIEN=$P($G(RESULT("ORDER IEN")),"^",1)
"RTN","SDHL7",138,0)
 I ORDIEN="" S ERROR="An IEN is required as the first piece of Order" Q
"RTN","SDHL7",139,0)
 I (ORDIEN?1N.N)=0 S ERROR="An Order IEN must be a number" Q
"RTN","SDHL7",140,0)
 ;MULTIPLE APPOINTMENT VALIDATION
"RTN","SDHL7",141,0)
 S NUMAPP=$G(RESULT("NUMBER APPT"))
"RTN","SDHL7",142,0)
 S INTERV=$G(RESULT("INTERVAL"))
"RTN","SDHL7",143,0)
 I NUMAPP'="" D
"RTN","SDHL7",144,0)
 .I (NUMAPP?1N.N)=0 D
"RTN","SDHL7",145,0)
 ..S ERROR="If set, the Number Appt variable must be a number"
"RTN","SDHL7",146,0)
 .I +NUMAPP>1 D
"RTN","SDHL7",147,0)
 ..I +INTERV=0 D
"RTN","SDHL7",148,0)
 ...S ERROR="A Multiple Appointment Request must have a numeric Interval"
"RTN","SDHL7",149,0)
 I ERROR'="" Q
"RTN","SDHL7",150,0)
 ;NO LATER THAN VALIDATION
"RTN","SDHL7",151,0)
 I $G(RESULT("NLT"))'="" D
"RTN","SDHL7",152,0)
 .I $G(RESULT("NLT"))'=1&($G(RESULT("NLT"))'=0) S ERROR="If set, NLT must be a 1 or 0" Q
"RTN","SDHL7",153,0)
 ;COMMENT VALIDATION
"RTN","SDHL7",154,0)
 I $L($G(RESULT("COMMENT")))>75 S ERROR="Comment is greater than 75 characters" Q
"RTN","SDHL7",155,0)
 ;CHANGE VALIDATION
"RTN","SDHL7",156,0)
 S CHGREQ=$G(RESULT("CHANGE"))
"RTN","SDHL7",157,0)
 I CHGREQ'="",CHGREQ'=1,CHGREQ'=0 S ERROR="If set, Change must be a 1 or 0"
"RTN","SDHL7",158,0)
 I CHGREQ=1 D
"RTN","SDHL7",159,0)
 .;REQEUST IEN VALIDATION
"RTN","SDHL7",160,0)
 .S REQIEN=$G(RESULT("REQ FILE IEN"))
"RTN","SDHL7",161,0)
 .I REQIEN="" D
"RTN","SDHL7",162,0)
 ..S ERROR="If change is set to 1, then a Request IEN is required" Q
"RTN","SDHL7",163,0)
 .I (REQIEN?1N.N)=0 D
"RTN","SDHL7",164,0)
 ..S ERROR="Request IEN must be a number" Q
"RTN","SDHL7",165,0)
 I ERROR'="" Q
"RTN","SDHL7",166,0)
 Q
"RTN","SDHL7",167,0)
 ;
"RTN","SDHL7",168,0)
VALDDIS(RESULT,ERROR) ; VALIDATE A DISCONTINUE REQUEST
"RTN","SDHL7",169,0)
 ;REQEUST IEN VALIDATION
"RTN","SDHL7",170,0)
 S REQIEN=$G(RESULT("REQ FILE IEN"))
"RTN","SDHL7",171,0)
 I REQIEN="" S ERROR="If disconintue is set to 1, then a Request IEN isrequired" Q
"RTN","SDHL7",172,0)
 I (REQIEN?1N.N)=0 S ERROR="Request IEN must be a number" Q
"RTN","SDHL7",173,0)
 ;ENTERED BY VALIDATION
"RTN","SDHL7",174,0)
 S EBIEN=$P($G(RESULT("ENTERED BY")),"^",1)
"RTN","SDHL7",175,0)
 I EBIEN="" S ERROR="A Entered By IEN is required" Q
"RTN","SDHL7",176,0)
 I (EBIEN?1N.N)=0 S ERROR="The Entered By IEN must be a number" Q
"RTN","SDHL7",177,0)
 Q
"RTN","SDHL7",178,0)
 ;
"RTN","SDHL7",179,0)
DISCONT(RESULT,ERROR) ;
"RTN","SDHL7",180,0)
 ;SETUP
"RTN","SDHL7",181,0)
 S U="^"
"RTN","SDHL7",182,0)
 ;
"RTN","SDHL7",183,0)
 N ARCINP,ARCRET,APPTIEN,ARCLE
"RTN","SDHL7",184,0)
 ;;DISCONTINUE REQUEST
"RTN","SDHL7",185,0)
 S (APPTIEN,ARCRET,ARCLE)=""
"RTN","SDHL7",186,0)
 S APPTIEN=$G(RESULT("REQ FILE IEN"))
"RTN","SDHL7",187,0)
 I +APPTIEN>0 D
"RTN","SDHL7",188,0)
 .I $G(RESULT("DISCONTINUE"))=1 D
"RTN","SDHL7",189,0)
 ..S ARCINP(1)=APPTIEN
"RTN","SDHL7",190,0)
 ..S ARCINP(2)="REMOVED/NO LONGER NECESSARY"
"RTN","SDHL7",191,0)
 ..S ARCINP(3)=$P($G(RESULT("ENTERED BY")),U,1)
"RTN","SDHL7",192,0)
 ..S ARCINP(4)=DT
"RTN","SDHL7",193,0)
 ..D ARCLOSE^SDECAR(.ARCRET,.ARCINP)
"RTN","SDHL7",194,0)
 ;CHECK FOR ARCLOSE ERRORS
"RTN","SDHL7",195,0)
 S ARCLE=$P(ARCRET,$C(30),2)
"RTN","SDHL7",196,0)
 I $P(ARCLE,U,1)=-1 S ERROR=$P(ARCLE,U,2)
"RTN","SDHL7",197,0)
 Q
"RTN","SDHL7",198,0)
 ;
"RTN","SDHL7",199,0)
SAVEREC(RESULT,ERROR) ;
"RTN","SDHL7",200,0)
 ;SETUP
"RTN","SDHL7",201,0)
 S U="^"
"RTN","SDHL7",202,0)
 ;
"RTN","SDHL7",203,0)
 ;NEW/CHANGE REQUEST
"RTN","SDHL7",204,0)
 Q:$G(RESULT("NEW ORDER"))'=1&($G(RESULT("CHANGE"))'=1)
"RTN","SDHL7",205,0)
 N ARINP,APPTCHG,PTIEN,SDATE,DDDT,MARDDS,COUNT,ATYPIEN,STCREC,SCPER,SETRET,ARSETE
"RTN","SDHL7",206,0)
 S (APPTCHG,PTIEN,SDATE,DDDT,MARDDS,COUNT,ATYPIEN,STCREC,SCPER,SETRET,ARSETE)=""
"RTN","SDHL7",207,0)
 S APPTCHG=$G(RESULT("CHANGE"))
"RTN","SDHL7",208,0)
 I APPTCHG=1 D
"RTN","SDHL7",209,0)
 .S ARINP(1)=APPTIEN
"RTN","SDHL7",210,0)
 ;PATIENT
"RTN","SDHL7",211,0)
 S PTIEN=$P($G(RESULT("PATIENT")),U,1)
"RTN","SDHL7",212,0)
 S ARINP(2)=PTIEN
"RTN","SDHL7",213,0)
 ;ENTERED DATE TIME
"RTN","SDHL7",214,0)
 S Y=DT X ^DD("DD") S ARINP(3)=Y
"RTN","SDHL7",215,0)
 ;REQUEST TYPE
"RTN","SDHL7",216,0)
 S ARINP(5)="RTC"
"RTN","SDHL7",217,0)
 ;CLINIC
"RTN","SDHL7",218,0)
 S ARINP(6)=$P($G(RESULT("CLINIC")),U,1)
"RTN","SDHL7",219,0)
 ;ENTERED BY
"RTN","SDHL7",220,0)
 S ARINP(7)=$P($G(RESULT("ENTERED BY")),U,1)
"RTN","SDHL7",221,0)
 ;PRIORITY
"RTN","SDHL7",222,0)
 S ARINP(8)="FUTURE" I $G(RESULT("RTC DATE"))=DT D
"RTN","SDHL7",223,0)
 .S ARINP(8)="ASAP"
"RTN","SDHL7",224,0)
 ;REQUESTED BY
"RTN","SDHL7",225,0)
 S ARINP(9)="PROVIDER"
"RTN","SDHL7",226,0)
 ;PROVIDER
"RTN","SDHL7",227,0)
 S ARINP(10)=$P($G(RESULT("SIGNED BY")),U,1)
"RTN","SDHL7",228,0)
 ;RTC DATE
"RTN","SDHL7",229,0)
 S RTCDTI=$G(RESULT("RTC DATE"))
"RTN","SDHL7",230,0)
 S Y=RTCDTI X ^DD("DD") S ARINP(11)=Y
"RTN","SDHL7",231,0)
 ;COMMENTS
"RTN","SDHL7",232,0)
 S ARINP(12)=$G(RESULT("COMMENT"))
"RTN","SDHL7",233,0)
 I $G(RESULT("NLT"))=1 D
"RTN","SDHL7",234,0)
 .S ARINP(12)="#NLT#"_$G(RESULT("COMMENT"))
"RTN","SDHL7",235,0)
 ;ENROLLMENT GROUP
"RTN","SDHL7",236,0)
 S PCE="" S PCE=$P($G(^DPT(PTIEN,"ENR")),U,1) I PCE'="" D
"RTN","SDHL7",237,0)
 .S ARINP(13)=$$GET1^DIQ(27.11,PCE,.07,"E")
"RTN","SDHL7",238,0)
 ;MULTIPLE APPOINTMENT REQUEST
"RTN","SDHL7",239,0)
 S ARINP(14)="NO" ;DEFAULT
"RTN","SDHL7",240,0)
 S ARINP(20)=""   ;DEFAULT
"RTN","SDHL7",241,0)
 I $G(RESULT("NUMBER APPT"))'="" D
"RTN","SDHL7",242,0)
 .I $G(RESULT("NUMBER APPT"))>1 D
"RTN","SDHL7",243,0)
 ..S ARINP(14)="YES"
"RTN","SDHL7",244,0)
 ..S ARINP(15)=$G(RESULT("INTERVAL"))
"RTN","SDHL7",245,0)
 ..S ARINP(16)=$G(RESULT("NUMBER APPT"))
"RTN","SDHL7",246,0)
 ..S DDDT=$G(RESULT("RTC DATE"))
"RTN","SDHL7",247,0)
 ..F I=1:1:$G(RESULT("NUMBER APPT")) D
"RTN","SDHL7",248,0)
 ...S X1=DDDT,X2=RESULT("INTERVAL") D C^%DTC S SDATE=X
"RTN","SDHL7",249,0)
 ...S MARDDS=MARDDS_$S(MARDDS="":SDATE,1:"|"_SDATE)
"RTN","SDHL7",250,0)
 ...S ARINP(20)=MARDDS
"RTN","SDHL7",251,0)
 ;SERVICE CONNECTED
"RTN","SDHL7",252,0)
 S SCPER=$P($G(^DPT(PTIEN,.3)),"^",2)
"RTN","SDHL7",253,0)
 I SCPER'="" D
"RTN","SDHL7",254,0)
 .S ARINP(19)=SCPER
"RTN","SDHL7",255,0)
 .I SCPER>49 D
"RTN","SDHL7",256,0)
 ..S ARINP(18)="YES"
"RTN","SDHL7",257,0)
 ..S ATYPIEN=$O(^SD(409.1,"B","SERVICE CONNECTED",ATYPIEN))
"RTN","SDHL7",258,0)
 E  S ARINP(18)="NO" S ATYPIEN=$O(^SD(409.1,"B","REGULAR",ATYPIEN))
"RTN","SDHL7",259,0)
 I ATYPIEN'="" D
"RTN","SDHL7",260,0)
 .S ARINP(22)=ATYPIEN
"RTN","SDHL7",261,0)
 ;CLINIC STOP CODE
"RTN","SDHL7",262,0)
 D GETSTC^SDECCON(STCREC,$P($G(RESULT("CLINIC")),U,1))
"RTN","SDHL7",263,0)
 I STCREC'="" D
"RTN","SDHL7",264,0)
 .S ARINP(21)=$P($G(STCREC),U,1)
"RTN","SDHL7",265,0)
 ;ESTABLISHED PATIENT
"RTN","SDHL7",266,0)
 S ARINP(23)="E"
"RTN","SDHL7",267,0)
 ;NO LATER THAN
"RTN","SDHL7",268,0)
 I $G(RESULT("NLT"))'="" D
"RTN","SDHL7",269,0)
 .S ARINP(26)=$G(RESULT("NLT"))
"RTN","SDHL7",270,0)
 ;ORDER IEN
"RTN","SDHL7",271,0)
 I $G(RESULT("ORDER IEN"))'="" D
"RTN","SDHL7",272,0)
 .S ARINP(28)=RESULT("ORDER IEN")
"RTN","SDHL7",273,0)
 ;PREREQ
"RTN","SDHL7",274,0)
 I $D(RESULT("PREREQ")) D
"RTN","SDHL7",275,0)
 .N PR,CC
"RTN","SDHL7",276,0)
 .S PREREQ=""
"RTN","SDHL7",277,0)
 .S CC=0 F  S CC=$O(RESULT("PREREQ",CC)) Q:CC'>0  D
"RTN","SDHL7",278,0)
 ..S PR=$G(RESULT("PREREQ",CC)) Q:PR=""
"RTN","SDHL7",279,0)
 ..S PREREQ=$S(PREREQ'="":PREREQ_";"_PR,1:PR)
"RTN","SDHL7",280,0)
 .S ARINP(27)=PREREQ
"RTN","SDHL7",281,0)
 ;CREATE THE APPOINTMENT REQUEST
"RTN","SDHL7",282,0)
 D ARSET^SDECAR2(.SETRET,.ARINP)
"RTN","SDHL7",283,0)
 ;CHECK FOR ARSET ERRORS
"RTN","SDHL7",284,0)
 S ARSETE=$P(SETRET,$C(30),2)
"RTN","SDHL7",285,0)
 I $P(ARSETE,U,1)="-1" S ERROR=$P(ARSETE,U,2) Q
"RTN","SDHL7",286,0)
 ;GET ARIEN
"RTN","SDHL7",287,0)
 S RESULT("REQ FILE IEN")=+ARSETE
"RTN","SDHL7",288,0)
 Q
"RTN","SDHL7",289,0)
 ;
"RTN","SDHL7",290,0)
SENDFAIL(ERROR,RESULT) ;
"RTN","SDHL7",291,0)
 ;S ORV("XQY0")="" D ERROR^OERR(ERROR,.SDMSG,.ORV)
"RTN","SDHL7",292,0)
 ;Q:ORTYPE="ORR"  Q:'$L($G(ORNMSP))
"RTN","SDHL7",293,0)
 N SDEMSG
"RTN","SDHL7",294,0)
 ;N ORVP,ORTS S:'$G(ORDUZ) ORDUZ=PAT_";DPT(" D:'$G(ORVP) PID
"RTN","SDHL7",295,0)
 S SDEMSG(1)="MSH|^~\&|SCHEDULING|"_$G(DUZ(2))_"|ORDER ENTRY|"_DUZ(2)_"|"_$$FMTHL7^XLFDT($$NOW^XLFDT)_"||SRM|"_RESULT("MSG ID")
"RTN","SDHL7",296,0)
 S SDEMSG(2)="MSA|AR|"_$P(ERROR,$C(30,31))_"|||207^"_$P(ERROR,$C(30,31))
"RTN","SDHL7",297,0)
 S OREMSG(3)="ERR|^^^"
"RTN","SDHL7",298,0)
 D MSG^XQOR("SD EVSEND OR",.SDEMSG)
"RTN","SDHL7",299,0)
 Q
"RTN","SDHL7",300,0)
 ;
"RTN","SDHL7",301,0)
SENDOK(RESULT) ;
"RTN","SDHL7",302,0)
 N SDMSG
"RTN","SDHL7",303,0)
 S SDMSG(1)="MSH|^~\&|SCHEDULING|"_$G(DUZ(2))_"|ORDER ENTRY|"_DUZ(2)_"|"_$$FMTHL7^XLFDT($$NOW^XLFDT)_"||SRM|"_RESULT("MSG ID")
"RTN","SDHL7",304,0)
 S SDMSG(2)="MSA|AA|OK^"_$G(RESULT("REQ FILE IEN"))_"|||"
"RTN","SDHL7",305,0)
 D MSG^XQOR("SD EVSEND OR",.SDMSG)
"RTN","SDHL7",306,0)
 Q
"RTN","SDHL7",307,0)
 ;
"RTN","SDHL7",308,0)
 ;TODO: GET ANTHONY'S HELP TO FORMAT MESSAGE TO SEND STATUS (SCHEDULED,DISPOSITION,TRANSFERED,ETC...) UPDATE TO CPRS
"RTN","SDHL7",309,0)
UPSTAT(ORDIEN,STATUS) ;
"RTN","SDHL7",310,0)
 Q:ORDIEN=""
"RTN","SDHL7",311,0)
 Q:STATUS=""
"RTN","SDHL7",312,0)
 N SDMSG
"RTN","SDHL7",313,0)
 S SDMSG(1)="MSH|^~\&|SCHEDULING|"_$G(DUZ(2))_"|ORDER ENTRY|"_DUZ(2)_"|"_$$FMTHL7^XLFDT($$NOW^XLFDT)_"||SRM|"_RESULT("MSG ID")
"RTN","SDHL7",314,0)
 S SDMSG(2)="MSA|AA|OK^"_$G(RESULT("REQ FILE IEN"))_"|||"
"RTN","SDHL7",315,0)
 D MSG^XQOR("SD EVSEND OR",.SDMSG)
"RTN","SDHL7",316,0)
 Q
"RTN","SDHL7",317,0)
 ;
"RTN","SDHL7",318,0)
UNESC(STR) ;
"RTN","SDHL7",319,0)
 ;ICR 4922
"RTN","SDHL7",320,0)
 Q $$ESC^ORHLESC(STR)
"RTN","SDHL7BLD")
0^5^B15632226^n/a
"RTN","SDHL7BLD",1,0)
SDHL7BLD ;SLC/AGP - RTC Order HL7 sender;11:53 AM  19 Jun 2017
"RTN","SDHL7BLD",2,0)
 ;;5.3;Scheduling;**671**;Aug 13, 1993;Build 25
"RTN","SDHL7BLD",3,0)
 ;
"RTN","SDHL7BLD",4,0)
 ;INPUTS("REQ FILE IEN")=89 <=
"RTN","SDHL7BLD",5,0)
 ;INPUTS("APPT TYPE")="followup"
"RTN","SDHL7BLD",6,0)
 ;INPUTS("CLINIC")="240^20 MINUTE" <=
"RTN","SDHL7BLD",7,0)
 ;INPUTS("COMMENT")="This is the new comment field"
"RTN","SDHL7BLD",8,0)
 ;INPUTS("DISPOSITION BY")="10000000195^PULEO,ANTHONY" <= this is set if the order is disposition or discontinue
"RTN","SDHL7BLD",9,0)
 ;INPUTS("INTERVAL")="Q7D"
"RTN","SDHL7BLD",10,0)
 ;INPUTS("DISCONTINUE")=1 <= this is set if the order is discontinue
"RTN","SDHL7BLD",11,0)
 ;INPUTS("NLT")=1
"RTN","SDHL7BLD",12,0)
 ;INPUTS("NUMBER APPT")=4 <=
"RTN","SDHL7BLD",13,0)
 ;INPUTS("ORDER IEN")=14524362 <=
"RTN","SDHL7BLD",14,0)
 ;INPUTS("PATIENT")="346^RECORD, THREE" <=
"RTN","SDHL7BLD",15,0)
 ;INPUTS("PREREQ",2)="XRAY"
"RTN","SDHL7BLD",16,0)
 ;INPUTS("PREREQ",3)="VITALS"
"RTN","SDHL7BLD",17,0)
 ;INPUTS("RTC DATE")=20170524 <=
"RTN","SDHL7BLD",18,0)
 ;INPUTS("PARTIAL")=1
"RTN","SDHL7BLD",19,0)
 ;
"RTN","SDHL7BLD",20,0)
 Q
"RTN","SDHL7BLD",21,0)
 ;
"RTN","SDHL7BLD",22,0)
EN(INPUTS) ; -- main entry point for sending a
"RTN","SDHL7BLD",23,0)
 N INC,MSG,LS
"RTN","SDHL7BLD",24,0)
 I $G(INPUTS("ORDER IEN")) S LS=$$LOCK1^ORX2($G(INPUTS("ORDER IEN"))) Q:'LS
"RTN","SDHL7BLD",25,0)
 S INC=0
"RTN","SDHL7BLD",26,0)
 S INC=INC+1,MSG(INC)=$$MSH(.INPUTS)
"RTN","SDHL7BLD",27,0)
 S INC=INC+1,MSG(INC)=$$PID(.INPUTS)
"RTN","SDHL7BLD",28,0)
 S INC=INC+1,MSG(INC)=$$PV1(.INPUTS)
"RTN","SDHL7BLD",29,0)
 S INC=INC+1,MSG(INC)=$$SCH(.INPUTS)
"RTN","SDHL7BLD",30,0)
 S INC=INC+1,MSG(INC)=$$AIL(.INPUTS)
"RTN","SDHL7BLD",31,0)
 I $D(INPUTS("PREREQ")) S INC=INC+1 D AIG(.INPUTS,.MSG,INC)
"RTN","SDHL7BLD",32,0)
 I $G(INPUTS("COMMENT"))'="" S INC=INC+1,MSG(INC)=$$NTE(.INPUTS)
"RTN","SDHL7BLD",33,0)
ENX ;
"RTN","SDHL7BLD",34,0)
 I $G(SDZTEST) M SDZTEST=MSG Q  ;testing only
"RTN","SDHL7BLD",35,0)
 D MSG^XQOR("SD EVSEND OR",.MSG)
"RTN","SDHL7BLD",36,0)
 D UNLK1^ORX2($G(INPUTS("ORDER IEN")))
"RTN","SDHL7BLD",37,0)
 Q
"RTN","SDHL7BLD",38,0)
 ;
"RTN","SDHL7BLD",39,0)
MSH(INPUTS) ;
"RTN","SDHL7BLD",40,0)
 N TYPE
"RTN","SDHL7BLD",41,0)
 S TYPE=$S($G(INPUTS("DISCONTINUE"))=1:"S15",1:"S12")
"RTN","SDHL7BLD",42,0)
 Q "MSH|^~\&|SCHEDULING|"_$G(DUZ(2))_"|ORDER ENTRY|"_DUZ(2)_"|"_$$FMTHL7^XLFDT($$NOW^XLFDT)_"||SRM|"_INPUTS("ORDER IEN")_"^"_TYPE
"RTN","SDHL7BLD",43,0)
 ;
"RTN","SDHL7BLD",44,0)
PID(INPUTS) ;
"RTN","SDHL7BLD",45,0)
 Q "PID|||"_$P(INPUTS("PATIENT"),U)_"||"_$P(INPUTS("PATIENT"),U,2)
"RTN","SDHL7BLD",46,0)
 ;
"RTN","SDHL7BLD",47,0)
SCH(INPUTS) ;
"RTN","SDHL7BLD",48,0)
 N STR,TYPE
"RTN","SDHL7BLD",49,0)
 S TYPE=$S($G(INPUTS("DISCONTINUE"))=1:"S15",1:"S12")_U_$S($D(INPUTS("PARTIAL")):"PARTIAL",1:"")
"RTN","SDHL7BLD",50,0)
 S STR="SCH|"_INPUTS("REQ FILE IEN")_"|"_INPUTS("ORDER IEN")_"||||"_TYPE_"||"_$$FMTHL7^XLFDT(INPUTS("RTC DATE"))_"|"_$S($G(INPUTS("NLT"))=1:"T",1:"")_"|"
"RTN","SDHL7BLD",51,0)
 S STR=STR_$G(INPUTS("INTERVAL"))_"|"_INPUTS("NUMBER APPT")_"^|||||"_INPUTS("DISPOSITION BY")_"|"
"RTN","SDHL7BLD",52,0)
 S STR=STR_"|||||"_INPUTS("REQ FILE IEN")_"|"_INPUTS("ORDER IEN")
"RTN","SDHL7BLD",53,0)
 Q STR
"RTN","SDHL7BLD",54,0)
 ;
"RTN","SDHL7BLD",55,0)
AIL(INPUTS,X,SEG,ERRARR) ;
"RTN","SDHL7BLD",56,0)
 Q "AIL|||"_INPUTS("CLINIC")
"RTN","SDHL7BLD",57,0)
 ;
"RTN","SDHL7BLD",58,0)
AIG(INPUTS,MSG,X) ;
"RTN","SDHL7BLD",59,0)
 N CNT,INC,FIRST,NUM
"RTN","SDHL7BLD",60,0)
 S CNT=0,INC=0,FIRST=1,NUM=0
"RTN","SDHL7BLD",61,0)
 F  S INC=$O(INPUTS("PREREQ",INC)) Q:INC'>0  D
"RTN","SDHL7BLD",62,0)
 .S CNT=CNT+1
"RTN","SDHL7BLD",63,0)
 .I FIRST=1 S MSG(X)="AIG|"_CNT_"|"_U_INPUTS("PREREQ",INC)_U_U_U_U_"|||||||||||",FIRST=0 Q
"RTN","SDHL7BLD",64,0)
 .S NUM=NUM+1,MSG(X,NUM)="AIG|"_CNT_"|"_U_INPUTS("PREREQ",INC)_U_U_U_U_"|||||||||||"
"RTN","SDHL7BLD",65,0)
 Q
"RTN","SDHL7BLD",66,0)
 ;
"RTN","SDHL7BLD",67,0)
NTE(INPUTS) ;
"RTN","SDHL7BLD",68,0)
 Q "NTE|6|P|"_$$ESC(INPUTS("COMMENT"))
"RTN","SDHL7BLD",69,0)
 ;
"RTN","SDHL7BLD",70,0)
PV1(INPUTS) ; -- Gets Patient location info.
"RTN","SDHL7BLD",71,0)
 ;
"RTN","SDHL7BLD",72,0)
 N PATRB,PATTYPE,STR,WARD
"RTN","SDHL7BLD",73,0)
 S WARD=+$G(^DPT(+INPUTS("PATIENT"),.1))
"RTN","SDHL7BLD",74,0)
 S PATTYPE=$S(WARD>0:"I",1:"O")
"RTN","SDHL7BLD",75,0)
 S PATRB=$S(PATTYPE="I":$P($G(^DPT(+INPUTS("PATIENT"),.101)),U),1:"")
"RTN","SDHL7BLD",76,0)
 S STR="PV1||"_PATTYPE_"|"_$S(WARD>0:WARD,1:+$G(INPUTS("CLINIC")))_$S($L(PATRB):U_PATRB,1:"")_"||||||||||||||||"
"RTN","SDHL7BLD",77,0)
 Q STR
"RTN","SDHL7BLD",78,0)
 ;
"RTN","SDHL7BLD",79,0)
ERROR ; -- Sends a DE reply to current msg
"RTN","SDHL7BLD",80,0)
 ; Uses ORVP, ORNMSP, ORDUZ, ORIFN, ORERR, and PKGIFN
"RTN","SDHL7BLD",81,0)
 N ORV S ORV("XQY0")="" D ERROR(ORERR,.SDMSG,.ORV)
"RTN","SDHL7BLD",82,0)
 Q:ORTYPE="ORR"  Q:'$L($G(ORNMSP))
"RTN","SDHL7BLD",83,0)
 N OREMSG,ORVP,ORTS S:'$G(ORDUZ) ORDUZ=DUZ D:'$G(ORVP) PID
"RTN","SDHL7BLD",84,0)
 S OREMSG(1)=$$MSH^ORMBLD("ORR",ORNMSP),OREMSG(2)=$$PID^ORMBLD($G(ORVP))
"RTN","SDHL7BLD",85,0)
 S OREMSG(3)="ORC|DE|"_$S($G(ORIFN):ORIFN_"^OR",1:"")_"|"_$S($L($G(PKGIFN)):PKGIFN_U_ORNMSP,1:"")_"|||||||"_ORDUZ_"||||||"_ORERR
"RTN","SDHL7BLD",86,0)
 D MSG^XQOR("OR EVSEND "_ORNMSP,.OREMSG)
"RTN","SDHL7BLD",87,0)
 Q
"RTN","SDHL7BLD",88,0)
 ;
"RTN","SDHL7BLD",89,0)
TEST(INPUTS) ; -- Build/display HL7 msgs w/o sending
"RTN","SDHL7BLD",90,0)
 K SDZTEST S SDZTEST=1 D EN(.INPUTS) ; leaves msg in SDZTEST() on exit
"RTN","SDHL7BLD",91,0)
 Q
"RTN","SDHL7BLD",92,0)
 ;
"RTN","SDHL7BLD",93,0)
ESC(STR) ;
"RTN","SDHL7BLD",94,0)
 ;ICR 4922
"RTN","SDHL7BLD",95,0)
 Q $$ESC^ORHLESC(STR)
"RTN","SDM2")
0^10^B24069088^B24545266
"RTN","SDM2",1,0)
SDM2 ;SF/GFT - MAKE APPOINTMENT ; 07 Jan 2000  6:30 PM
"RTN","SDM2",2,0)
 ;;5.3;Scheduling;**32,132,168,356,434,467,478,671**;Aug 13, 1993;Build 25
"RTN","SDM2",3,0)
 ;
"RTN","SDM2",4,0)
 ;SD/467 - call EWL to open its entry if matching appointment is canceled
"RTN","SDM2",5,0)
 W *7,!,"PATIENT ALREADY HAS APPOINTMENT "
"RTN","SDM2",6,0)
 N SDATA,SDCMHDL ; for evt dvr
"RTN","SDM2",7,0)
 ;Patch SD*5.3*671 take away prompt to cancel appointment when patient has a appointment in same clinic added ';' before Read
"RTN","SDM2",8,0)
 I $D(^DPT(DFN,"S",SD,0)),$P(^(0),"^",2)'["C" S S=SD,I=+^(0) D FLEN W "(",APL," MINUTES) THEN" D IN W !,"CANCEL THAT APPOINTMENT OR SELECT A NEW DATE/TIME." Q
"RTN","SDM2",9,0)
 ;,PROT G:$D(SDPROT) ^SDM1 R ".",!,"  DO YOU WANT TO CANCEL IT? ",X:DTIME S X=$$UP^XLFSTR(X) D:X?1"Y".A STAT G CAN:X?1"Y".A W "??",*7 G ^SDM1
"RTN","SDM2",10,0)
SDAY S %=2 W "ON THE SAME DAY (" D AT,IN W ") ...OK" D YN^DICN I '% W !,"RESPOND YES OR NO",!,"PATIENT ALREADY HAS APPOINTMENT " G SDAY
"RTN","SDM2",11,0)
 G ^SDM1:(%-1),PRECAN^SDM1
"RTN","SDM2",12,0)
 ;
"RTN","SDM2",13,0)
CAN Q:'$D(^SC(I,"SL"))  S SCI=I,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDM2",14,0)
 S SD17=$P(^DPT(DFN,"S",S,0),"^") K ^SC("ARAD",I,S,DFN) S (DA,SDSY)=0 F SDSX=0:0 S SDSX=$O(^SC(I,"S",S,1,SDSX)) Q:'SDSX  Q:'$D(^(SDSX,0))  D C Q:SDSY&(DA)
"RTN","SDM2",15,0)
 I $D(^DPT("ASDPSD","B",DIV,$P(S,"."),DFN)) D CK1
"RTN","SDM2",16,0)
 G OUT:'SDSY S SL1=$P(^SC(I,"S",S,1,SDSY,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDM2",17,0)
 S SDRT="D",SDTTM=SD,SDPL=SDSY,SDSC=I D RT^SDUTL
"RTN","SDM2",18,0)
 I I'=SC D
"RTN","SDM2",19,0)
 .W !
"RTN","SDM2",20,0)
 .I $$BADADR^DGUTL3(DFN)>0 D  Q
"RTN","SDM2",21,0)
 ..W !!,"**BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED.**",!!
"RTN","SDM2",22,0)
 .S DIR("A")="DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT"
"RTN","SDM2",23,0)
 .S DIR("A",1)="THIS IS THE ONLY OPPORTUNITY.",DIR("B")="YES"
"RTN","SDM2",24,0)
 .S DIR(0)="Y" D ^DIR W ! K DIR
"RTN","SDM2",25,0)
 .Q:(Y'=1)
"RTN","SDM2",26,0)
 .N SDWH,A,SC,SDCL S SDWH="P",A=+DFN,SDCL(1)=I_"^"_S N DFN
"RTN","SDM2",27,0)
 .S %ZIS("A")="Device for cancellation letter: ",%ZIS("B")=""
"RTN","SDM2",28,0)
 .N I,S,SDHX,SDP
"RTN","SDM2",29,0)
 .D ^%ZIS Q:POP  U IO
"RTN","SDM2",30,0)
 .D SDLET^SDCNP1A
"RTN","SDM2",31,0)
 .D ^%ZISC
"RTN","SDM2",32,0)
 N SCSNOD,SCLNK,SCSRV,SCGMR,SCSTPCOD
"RTN","SDM2",33,0)
 S SCSNOD=^SC(I,"S",S,1,SDSY,0),SCLNK=$P($G(^SC(I,"S",S,1,SDSY,"CONS")),U),SDADM="" S:'$D(STPCOD) STPCOD=$P($G(^SC(I,0)),U,7) K TMPD ;SD/478
"RTN","SDM2",34,0)
 I SCLNK'="" K ^SC("AWAS1",SCLNK) S SCSRV=$P($G(^GMR(123,SCLNK,0)),U,5),SCGMR=0 F  S SCGMR=$O(^GMR(123.5,SCSRV,688,SCGMR)) Q:'+SCGMR  S SCSTPCOD=$P(^GMR(123.5,SCSRV,688,SCGMR,0),U) I STPCOD=SCSTPCOD D
"RTN","SDM2",35,0)
 .S TMP=1 S:'$D(CNSLTLNK) CNSLTLNK=SCLNK Q  ;SD/478
"RTN","SDM2",36,0)
 K ^SC(I,"S",S,1,SDSY)
"RTN","SDM2",37,0)
 I '$D(^SC(I,"ST",$P(SD,"."),1)) G OUT
"RTN","SDM2",38,0)
 S SD1(1)=^SC(I,"SL"),SD1=$P(SD1(1),"^",3),SB1=$S(SD1:SD1,1:8)-1/100,SD1=$P(SD1(1),"^",6),HSI1=$S(SD1:SD1,1:4),SI1=$S(SD1="":4,SD1<3:4,SD1:SD1,1:4),SDDIF1=$S(HSI1<3:8/HSI1,1:2) K SD1
"RTN","SDM2",39,0)
 S S=^SC(I,"ST",$P(SD,"."),1),SDQ=SD#1-SB1*100,ST=SDQ#1*SI1\.6+($P(SDQ,".")*SI1),SS=SL1*HSI1/60
"RTN","SDM2",40,0)
 I SDQ'<1 F I=ST+ST:SDDIF1 S SDQ=$E(STR,$F(STR,$E(S,I+1))) Q:SDQ=""  S S=$E(S,1,I)_SDQ_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDM2",41,0)
 S ^(1)=S K SL1,SB1,SDDIF1,HSI1,SI1,SDQ ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDM2",42,0)
OUT D EVT Q:$D(SDNSF)  D CANCEL^SDCNSLT W *7,!,"APPOINTMENT IN ",$P(^SC(SCI,0),"^",1)," CANCELLED!" S X=SD D DOW^SDM1 W !,"APPOINTMENT NOW BEING MADE IN ",$P(^SC(SC,0),"^",1) K SCI G S^SDM1  ;SD/478
"RTN","SDM2",43,0)
 ;
"RTN","SDM2",44,0)
C I +^SC(I,"S",S,1,SDSX,0)=DFN,$P(^(0),"^",9)'["C" S SDSY=SDSX Q
"RTN","SDM2",45,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=SDSX Q  ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDSX,"OB")
"RTN","SDM2",46,0)
 ;
"RTN","SDM2",47,0)
AT W "AT ",$E(S_0,9,10),":",$E(S_"000",11,12) Q
"RTN","SDM2",48,0)
IN W:SC-I&$D(^SC(I,0)) " IN ",$P(^(0),U,1) Q
"RTN","SDM2",49,0)
PROT K SDPROT
"RTN","SDM2",50,0)
 I $D(^SC(I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(I,"SDPRIV",DUZ)) D  Q
"RTN","SDM2",51,0)
 .W !!,*7,">>> Access to ",$$CNAM(I)," is prohibited!"
"RTN","SDM2",52,0)
 .W !,"    Only users with a special code may access this clinic.",!
"RTN","SDM2",53,0)
 .S SDPROT=""
"RTN","SDM2",54,0)
 ;
"RTN","SDM2",55,0)
 I $$CODT^SDCOU(DFN,SD,I) D  Q
"RTN","SDM2",56,0)
 .W !?5,*7,">>> A check out date has been entered for this appointment!"
"RTN","SDM2",57,0)
 .W !?5,"    Please enter another date and time.   Thank you.",!
"RTN","SDM2",58,0)
 .S SDPROT=""
"RTN","SDM2",59,0)
 Q
"RTN","SDM2",60,0)
 ;
"RTN","SDM2",61,0)
CNAM(SDCL) ;Return clinic name
"RTN","SDM2",62,0)
 ;Input: SDCL=clinic ien
"RTN","SDM2",63,0)
 N SDX
"RTN","SDM2",64,0)
 S SDX=$P($G(^SC(+SDCL,0)),U)
"RTN","SDM2",65,0)
 Q $S($L(SDX):SDX,1:"this clinic")
"RTN","SDM2",66,0)
 ;
"RTN","SDM2",67,0)
FLEN S APL="" I $D(^SC(I,"S",SD)) F ZL=0:0 S ZL=$O(^SC(I,"S",SD,1,ZL)) Q:ZL=""  I +^(ZL,0)=DFN S APL=$P(^SC(I,"S",SD,1,ZL,0),"^",2)
"RTN","SDM2",68,0)
 Q
"RTN","SDM2",69,0)
 ;
"RTN","SDM2",70,0)
DISP G ^SDM1 ; LINE TAG IS NO LONGER USED
"RTN","SDM2",71,0)
 ;W !?4 K S F SDQ=Y:0 S SDQ=$N(^SC(SC,"S",SDQ)) Q:Y+1<SDQ!(SDQ<0)  F I=0:0 S I=$N(^SC(SC,"S",SDQ,1,I)) Q:I'>0  Q:'$D(^(I,0))  S ST=$S($P(^(0),U,4)="":"BLANK",1:"'"_$E($P(^(0),U,4),1,28)_"'"),S(ST)=$S($D(S(ST)):S(ST)+1,1:1)
"RTN","SDM2",72,0)
 ;I '$D(S) W "NO APPNT'S SCHEDULED YET" G ^SDM1
"RTN","SDM2",73,0)
 ;W "'OTHER' TYPES ALREADY SCHEDULED:   ",!
"RTN","SDM2",74,0)
 ;S S=0 F I=0:1 S S=$N(S(S)) G ^SDM1:S=-1 W:$X+$L(S)>72 ! W S,": ",S(S),"     "
"RTN","SDM2",75,0)
CK1 S SDZ=0 F SD1=$P(S,"."):0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDZ=1 Q
"RTN","SDM2",76,0)
 Q:SDZ  F SD1=2,4 I $D(^SC("AAS",SD1,$P(S,"."),DFN)) S SDZ=1 Q
"RTN","SDM2",77,0)
 Q:SDZ  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDM2",78,0)
 Q:SDZ  K ^DPT("ASDPSD","B",DIV,$P(S,"."),DFN) Q
"RTN","SDM2",79,0)
STAT N X S SDCMHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,SD,I,"",SDCMHDL),NOW^%DTC
"RTN","SDM2",80,0)
 S $P(^DPT(DFN,"S",SD,0),"^",2)="C",$P(^(0),"^",14)=$E(%,1,12) S:$D(DUZ) $P(^(0),"^",12)=DUZ S ^DPT("ASDCN",+^(0),SD,DFN)=""
"RTN","SDM2",81,0)
 K ^TMP("SDWLREB",$J),^TMP($J,"SDWLPL") N SC S SC=+^DPT(DFN,"S",SD,0) D OPENEWL^SDWLREB(DFN,SD,SC,0) K ^TMP($J,"SDWLP")
"RTN","SDM2",82,0)
 I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB ; SD/467
"RTN","SDM2",83,0)
 Q
"RTN","SDM2",84,0)
 ;
"RTN","SDM2",85,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM2",86,0)
 ; -- cancel event
"RTN","SDM2",87,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCMHDL)
"RTN","SDM2",88,0)
 Q
"VER")
8.0^22.2
"^DD",409.85,409.85,0)
FIELD^NL^48^43
"^DD",409.85,409.85,0,"DDA")
N
"^DD",409.85,409.85,0,"DT")
3171107
"^DD",409.85,409.85,0,"IX","B",409.85,.01)

"^DD",409.85,409.85,0,"IX","C",409.85,2)

"^DD",409.85,409.85,0,"IX","SC",409.85,8)

"^DD",409.85,409.85,0,"IX","SCC",409.85,8)

"^DD",409.85,409.85,0,"NM","SDEC APPT REQUEST")

"^DD",409.85,409.85,0,"PT",409.84,.22)

"^DD",409.85,409.85,0,"PT",409.85,43.8)

"^DD",409.85,409.85,0,"PT",409.852,.01)

"^DD",409.85,409.85,0,"VRPK")
SD
"^DD",409.85,409.85,.01,0)
PATIENT^RP2^DPT(^0;1^Q
"^DD",409.85,409.85,.01,1,0)
^.1
"^DD",409.85,409.85,.01,1,1,0)
409.85^B
"^DD",409.85,409.85,.01,1,1,1)
S ^SDEC(409.85,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.85,.01,1,1,2)
K ^SDEC(409.85,"B",$E(X,1,30),DA)
"^DD",409.85,409.85,.01,3)
Enter the name of the patient for this Appt Request.
"^DD",409.85,409.85,.01,21,0)
^.001^2^2^3150423^^
"^DD",409.85,409.85,.01,21,1,0)
This is the name of the patient that is to be on the SDEC APPT REQUEST 
"^DD",409.85,409.85,.01,21,2,0)
list.
"^DD",409.85,409.85,.01,23,0)
^.001^2^2^3150423^^^
"^DD",409.85,409.85,.01,23,1,0)
The patient selection is from the PATIENT file #2.
"^DD",409.85,409.85,.01,23,2,0)
The SDEC APPT REQUEST is 'this' file #409.85.
"^DD",409.85,409.85,.01,"DT")
3150625
"^DD",409.85,409.85,.02,0)
PATIENT STATUS^Sa^N:NEW;E:ESTABLISHED;^0;7^Q
"^DD",409.85,409.85,.02,3)
Enter N or NEW if the patient is a new patient. Enter E or ESTABLISHED if this patient has been seen in the past 24 months.
"^DD",409.85,409.85,.02,21,0)
^.001^3^3^3150803^^
"^DD",409.85,409.85,.02,21,1,0)
This field represents the status of the patient in regards to being a 
"^DD",409.85,409.85,.02,21,2,0)
'NEW' or 'ESTABLISHED' patient.
"^DD",409.85,409.85,.02,21,3,0)
An ESTABLISHED patient has been seen within the past 24 months.
"^DD",409.85,409.85,.02,"AUDIT")
y
"^DD",409.85,409.85,.02,"AX")

"^DD",409.85,409.85,.02,"DT")
3161102
"^DD",409.85,409.85,1,0)
CREATE DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,1,3)
Enter the date the request was made.
"^DD",409.85,409.85,1,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,1,21,1,0)
This field represents the date that the appointment request was made.
"^DD",409.85,409.85,1,"DT")
3150625
"^DD",409.85,409.85,2,0)
INSTITUTION^R*P4'^DIC(4,^0;3^S DIC("S")="I $P(^(0),U,11)=""N"",$$TF^XUAF4(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",409.85,409.85,2,1,0)
^.1
"^DD",409.85,409.85,2,1,1,0)
409.85^C
"^DD",409.85,409.85,2,1,1,1)
S ^SDEC(409.85,"C",$E(X,1,30),DA)=""
"^DD",409.85,409.85,2,1,1,2)
K ^SDEC(409.85,"C",$E(X,1,30),DA)
"^DD",409.85,409.85,2,1,1,"%D",0)
^^2^2^3150418^
"^DD",409.85,409.85,2,1,1,"%D",1,0)
This xref is used to speed up the lookup of Appointment Requests by 
"^DD",409.85,409.85,2,1,1,"%D",2,0)
INSTITUTION.
"^DD",409.85,409.85,2,1,1,"DT")
3150418
"^DD",409.85,409.85,2,3)
Select an Institution
"^DD",409.85,409.85,2,12)
Only allow a National/Medical Institution.
"^DD",409.85,409.85,2,12.1)
S DIC("S")="I $P(^(0),U,11)=""N"",$$TF^XUAF4(+Y)"
"^DD",409.85,409.85,2,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,2,21,1,0)
This field represents the Institution assigned to identify the specific 
"^DD",409.85,409.85,2,21,2,0)
location.
"^DD",409.85,409.85,2,"DT")
3150418
"^DD",409.85,409.85,4,0)
REQUEST TYPE^RS^APPT:APPOINTMENT;MOBILE:MOBILE;W2VA:WELCOME TO VA;RTC:RETURN TO CLINIC;^0;5^Q
"^DD",409.85,409.85,4,3)
Select an appointment request type
"^DD",409.85,409.85,4,21,0)
^.001^3^3^3170605^^^^
"^DD",409.85,409.85,4,21,1,0)
This field represents the type of appointment request that being 
"^DD",409.85,409.85,4,21,2,0)
requested.
"^DD",409.85,409.85,4,21,3,0)
.
"^DD",409.85,409.85,4,"DT")
3170605
"^DD",409.85,409.85,8,0)
REQ SPECIFIC CLINIC^RP44'a^SC(^0;9^Q
"^DD",409.85,409.85,8,1,0)
^.1
"^DD",409.85,409.85,8,1,1,0)
409.85^SC^MUMPS
"^DD",409.85,409.85,8,1,1,1)
I $D(X) S ^SDEC(409.85,"SC",$P(^SC(X,0),U,1),DA)=""
"^DD",409.85,409.85,8,1,1,2)
K ^SDEC(409.85,"SC",$P(^SC(X,0),U,1),DA)
"^DD",409.85,409.85,8,1,1,"%D",0)
^^1^1^3150418^
"^DD",409.85,409.85,8,1,1,"%D",1,0)
Sort and Lookup Appointment Request by Clinic name.
"^DD",409.85,409.85,8,1,1,"DT")
3150418
"^DD",409.85,409.85,8,1,2,0)
409.85^SCC^MUMPS
"^DD",409.85,409.85,8,1,2,1)
I $D(X) S ^SDEC(409.85,"SCC",$P(^SDEC(409.85,DA,0),U,1),X,DA)=""
"^DD",409.85,409.85,8,1,2,2)
K ^SDEC(409.85,"SCC",$P(^SDEC(409.85,DA,0),U,1),X,DA)
"^DD",409.85,409.85,8,1,2,"%D",0)
^^1^1^3150418^
"^DD",409.85,409.85,8,1,2,"%D",1,0)
Sort/Lookup Appointment Request by Specific Clinic.
"^DD",409.85,409.85,8,1,2,"DT")
3150418
"^DD",409.85,409.85,8,3)
Select a clinic
"^DD",409.85,409.85,8,21,0)
^^4^4^3150423^
"^DD",409.85,409.85,8,21,1,0)
This field represents the clinic that this appointment request is for.
"^DD",409.85,409.85,8,21,2,0)
 
"^DD",409.85,409.85,8,21,3,0)
If the patient has been assigned to the APPT REQUEST list, enter the
"^DD",409.85,409.85,8,21,4,0)
clinic that the patient is waiting for an appointment.
"^DD",409.85,409.85,8,"AUDIT")
y
"^DD",409.85,409.85,8,"AX")

"^DD",409.85,409.85,8,"DT")
3161102
"^DD",409.85,409.85,8.5,0)
REQ SERVICE/SPECIALTY^*P40.7'a^DIC(40.7,^0;4^S DIC("S")="I ($P(^(0),U,3)="""")!($P($P(^(0),U,3),""."",1)>$P($$NOW^XLFDT,""."",1))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",409.85,409.85,8.5,3)
Select a CLINIC STOP
"^DD",409.85,409.85,8.5,12)
Allow only active CLINIC STOP entries.
"^DD",409.85,409.85,8.5,12.1)
S DIC("S")="I ($P(^(0),U,3)="""")!($P($P(^(0),U,3),""."",1)>$P($$NOW^XLFDT,""."",1))"
"^DD",409.85,409.85,8.5,21,0)
^.001^2^2^3150429^^
"^DD",409.85,409.85,8.5,21,1,0)
This field represents the CLINIC STOP code (also referred to as 
"^DD",409.85,409.85,8.5,21,2,0)
SERVICE/SPECIALTY) that is associated with this appointment.
"^DD",409.85,409.85,8.5,"AUDIT")
y
"^DD",409.85,409.85,8.5,"AX")

"^DD",409.85,409.85,8.5,"DT")
3161102
"^DD",409.85,409.85,8.7,0)
REQ APPOINTMENT TYPE^P409.1'a^SD(409.1,^0;6^Q
"^DD",409.85,409.85,8.7,3)
Select an appointment type.
"^DD",409.85,409.85,8.7,21,0)
^^1^1^3150522^
"^DD",409.85,409.85,8.7,21,1,0)
This field represents the appointment type for this request.
"^DD",409.85,409.85,8.7,"AUDIT")
y
"^DD",409.85,409.85,8.7,"AX")

"^DD",409.85,409.85,8.7,"DT")
3161102
"^DD",409.85,409.85,9,0)
ORIGINATING USER^P200'^VA(200,^0;10^Q
"^DD",409.85,409.85,9,3)
Select a user
"^DD",409.85,409.85,9,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,9,21,1,0)
This is the user that entered this appointment request.
"^DD",409.85,409.85,9,"DT")
3150418
"^DD",409.85,409.85,9.5,0)
DATE/TIME ENTERED^D^^3;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,9.5,3)
Enter a date. Time is optional.
"^DD",409.85,409.85,9.5,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,9.5,21,1,0)
This is the Date and optional Time that this appointment request entry 
"^DD",409.85,409.85,9.5,21,2,0)
was entered.
"^DD",409.85,409.85,9.5,"DT")
3150418
"^DD",409.85,409.85,10,0)
PRIORITY^RS^A:ASAP;F:FUTURE;^0;11^Q
"^DD",409.85,409.85,10,3)
Enter A or ASAP to set the priority as 'As Soon As Possible'. Enter F or FUTURE to set the priority as Future.
"^DD",409.85,409.85,10,21,0)
^^7^7^3150423^
"^DD",409.85,409.85,10,21,1,0)
This represents the appointment priority. 
"^DD",409.85,409.85,10,21,2,0)
 
"^DD",409.85,409.85,10,21,3,0)
Future indicates that the patient needs an appointment in the 
"^DD",409.85,409.85,10,21,4,0)
future and a desired date will be entered by the user.  ASAP indicates 
"^DD",409.85,409.85,10,21,5,0)
that the patient needs an appointment before the currently next available 
"^DD",409.85,409.85,10,21,6,0)
appointment (as soon as a slot opens).  The desired date for ASAP will be 
"^DD",409.85,409.85,10,21,7,0)
set by the system as the current date.
"^DD",409.85,409.85,10,"DT")
3150418
"^DD",409.85,409.85,10.5,0)
ENROLLMENT PRIORITY^S^1:GROUP 1;2:GROUP 2;3:GROUP 3;4:GROUP 4;5:GROUP 5;6:GROUP 6;7:GROUP 7;8:GROUP 8;^0;25^Q
"^DD",409.85,409.85,10.5,3)
Select an enrollment priority.
"^DD",409.85,409.85,10.5,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,10.5,21,1,0)
The ENROLLMENT PRIORITY field represents the appointment Enrollment 
"^DD",409.85,409.85,10.5,21,2,0)
Priority.
"^DD",409.85,409.85,10.5,"DT")
3150418
"^DD",409.85,409.85,11,0)
REQUESTED BY^RSa^1:PROVIDER;2:PATIENT;^0;12^Q
"^DD",409.85,409.85,11,3)
Enter 1 or PROVIDER if the requestor was a provider. Enter 2 or PATIENT if the requestor was the patient.
"^DD",409.85,409.85,11,21,0)
^.001^2^2^3150423^^
"^DD",409.85,409.85,11,21,1,0)
This field identifies who requested the appointment - the patient or a 
"^DD",409.85,409.85,11,21,2,0)
provider.
"^DD",409.85,409.85,11,"AUDIT")
y
"^DD",409.85,409.85,11,"AX")

"^DD",409.85,409.85,11,"DT")
3161102
"^DD",409.85,409.85,12,0)
PROVIDER^P200'a^VA(200,^0;13^Q
"^DD",409.85,409.85,12,3)
Select the provider that requested the patient's appointment.
"^DD",409.85,409.85,12,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,12,21,1,0)
This field represents the provider that requested the appointment if the 
"^DD",409.85,409.85,12,21,2,0)
appointment was requested by a provider.
"^DD",409.85,409.85,12,"AUDIT")
y
"^DD",409.85,409.85,12,"AX")

"^DD",409.85,409.85,12,"DT")
3161102
"^DD",409.85,409.85,13,0)
SCHEDULED DATE OF APPT^D^^0;23^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,13,3)
Enter the date and optional time of the scheduled appointment for this request.
"^DD",409.85,409.85,13,21,0)
^^3^3^3150423^
"^DD",409.85,409.85,13,21,1,0)
This is the appointment date and optional time scheduled for the patient.
"^DD",409.85,409.85,13,21,2,0)
This appointment may be used as a reason for closing 'this' appointment 
"^DD",409.85,409.85,13,21,3,0)
request.
"^DD",409.85,409.85,13,23,0)
^.001^1^1^3150423^^^^
"^DD",409.85,409.85,13,23,1,0)
This is a date/time of the scheduled appointment related to this entry.
"^DD",409.85,409.85,13,"DT")
3150418
"^DD",409.85,409.85,13.1,0)
DATE APPT. MADE^D^^SDAPT;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,13.1,3)
Enter the date that the appointment was made.
"^DD",409.85,409.85,13.1,21,0)
^.001^1^1^3150423^^^^
"^DD",409.85,409.85,13.1,21,1,0)
This is the date the appointment was created.
"^DD",409.85,409.85,13.1,23,0)
^.001^2^2^3150423^^^^
"^DD",409.85,409.85,13.1,23,1,0)
The Appointment Creation Date. It corresponds to the DATE APPT. MADE 
"^DD",409.85,409.85,13.1,23,2,0)
field (#20) of the APPOINTMENT multiple (#1900) in the PATIENT file (#2).
"^DD",409.85,409.85,13.1,"DT")
3150423
"^DD",409.85,409.85,13.2,0)
APPT CLINIC^P44'^SC(^SDAPT;2^Q
"^DD",409.85,409.85,13.2,3)
Select the clinic that this appointment is scheduled for.
"^DD",409.85,409.85,13.2,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,13.2,21,1,0)
This is the clinic this appointment was created for.
"^DD",409.85,409.85,13.2,23,0)
^.001^1^1^3150423^^^
"^DD",409.85,409.85,13.2,23,1,0)
Pointer to the HOSPITAL LOCATION file (#44) of the related appointment.
"^DD",409.85,409.85,13.2,"DT")
3150418
"^DD",409.85,409.85,13.3,0)
APPT INSTITUTION^P4'^DIC(4,^SDAPT;3^Q
"^DD",409.85,409.85,13.3,3)
Select an Institution.
"^DD",409.85,409.85,13.3,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,13.3,21,1,0)
This is the institution the clinic appointment belongs to.
"^DD",409.85,409.85,13.3,23,0)
^.001^2^2^3150423^^^^
"^DD",409.85,409.85,13.3,23,1,0)
A pointer from the HOSPITAL LOCATION file of the scheduled appointment to 
"^DD",409.85,409.85,13.3,23,2,0)
the INSTITUTION file (#4).
"^DD",409.85,409.85,13.3,"DT")
3150418
"^DD",409.85,409.85,13.4,0)
APPT STOP CODE^P40.7'^DIC(40.7,^SDAPT;4^Q
"^DD",409.85,409.85,13.4,3)
Select a CLINIC STOP code.
"^DD",409.85,409.85,13.4,21,0)
^^3^3^3150423^
"^DD",409.85,409.85,13.4,21,1,0)
This is the stop code/specialty of a clinic associated with the patient 
"^DD",409.85,409.85,13.4,21,2,0)
appointment. This may be different that the STOP CODE defined in the REQ 
"^DD",409.85,409.85,13.4,21,3,0)
SERVICE/SPECIALTY field.
"^DD",409.85,409.85,13.4,23,0)
^.001^2^2^3150423^^^
"^DD",409.85,409.85,13.4,23,1,0)
This is the primary STOP CODE Number pointer to the CLINIC STOP file 
"^DD",409.85,409.85,13.4,23,2,0)
(#40.7).
"^DD",409.85,409.85,13.4,"DT")
3150418
"^DD",409.85,409.85,13.5,0)
APPT CREDIT STOP CODE^P40.7'^DIC(40.7,^SDAPT;5^Q
"^DD",409.85,409.85,13.5,3)
Select a CLINIC STOP code.
"^DD",409.85,409.85,13.5,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,13.5,21,1,0)
This is the credit stop code optionally assigned to the HOSPITAL LOCATION 
"^DD",409.85,409.85,13.5,21,2,0)
file associated with the scheduled appointment.
"^DD",409.85,409.85,13.5,23,0)
^.001^4^4^3150423^^^
"^DD",409.85,409.85,13.5,23,1,0)
This is the secondary (optional) Stop Code Number pointer to the CLINIC 
"^DD",409.85,409.85,13.5,23,2,0)
STOP file (#40.7).
"^DD",409.85,409.85,13.5,23,3,0)
This stop code is assigned to the HOSPITAL LOCATION file associated with 
"^DD",409.85,409.85,13.5,23,4,0)
the scheduled appointment.
"^DD",409.85,409.85,13.5,"DT")
3150418
"^DD",409.85,409.85,13.6,0)
APPT STATION NUMBER^F^^SDAPT;6^K:$L(X)>6!($L(X)<3) X
"^DD",409.85,409.85,13.6,3)
Answer must be 3-6 characters in length.
"^DD",409.85,409.85,13.6,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,13.6,21,1,0)
This is the 3-digit station number assigned to the facility plus up to 3 
"^DD",409.85,409.85,13.6,21,2,0)
optional modifiers.
"^DD",409.85,409.85,13.6,23,0)
^.001^2^2^3150423^^^
"^DD",409.85,409.85,13.6,23,1,0)
This is the STATION NUMBER field (#99) of the INSTITUTION file (#4) 
"^DD",409.85,409.85,13.6,23,2,0)
associated with the scheduled appointment.
"^DD",409.85,409.85,13.6,"DT")
3150418
"^DD",409.85,409.85,13.7,0)
APPT CLERK^P200'^VA(200,^SDAPT;7^Q
"^DD",409.85,409.85,13.7,3)
Select an Appt Clerk
"^DD",409.85,409.85,13.7,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,13.7,21,1,0)
This is the person who assigned the appointment to the REQUEST entry.
"^DD",409.85,409.85,13.7,23,0)
^^2^2^3150423^
"^DD",409.85,409.85,13.7,23,1,0)
This is a pointer to the NEW PERSON file and it represents a person who 
"^DD",409.85,409.85,13.7,23,2,0)
entered the scheduled appointment into the Appointment Request.
"^DD",409.85,409.85,13.7,"DT")
3150418
"^DD",409.85,409.85,13.8,0)
APPT STATUS^S^R:Scheduled/Kept;I:Inpatient;NS:No-Show;NSR:No_Show, Rescheduled;CP:Canceled by Patient;CPR:Canceled by Patient, Rescheduled;CC:Canceled by Clinic;CCR:Canceled by Clinic, Rescheduled;NT:No Action Taken;^SDAPT;8^Q
"^DD",409.85,409.85,13.8,3)
Select an Appt Status
"^DD",409.85,409.85,13.8,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,13.8,21,1,0)
This field identifies the status of the appointment that is associated 
"^DD",409.85,409.85,13.8,21,2,0)
with this appointment request.
"^DD",409.85,409.85,13.8,"DT")
3150418
"^DD",409.85,409.85,14,0)
SERVICE CONNECTED PERCENTAGE^NJ3,0^^SC;1^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.85,409.85,14,3)
Type a number between 0 and 100, 0 decimal digits.
"^DD",409.85,409.85,14,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,14,21,1,0)
The SERVICE CONNECTED PERCENTAGE is used to determine the service 
"^DD",409.85,409.85,14,21,2,0)
connected priority.
"^DD",409.85,409.85,14,"DT")
3150418
"^DD",409.85,409.85,15,0)
SERVICE CONNECTED PRIORITY^S^0:NO;1:YES;^SC;2^Q
"^DD",409.85,409.85,15,3)
Enter 0 or NO if the appointment does not get a Service Connected Priority. Enter 1 or YES if the appointment DOES get a Service Connected Priority.
"^DD",409.85,409.85,15,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,15,21,1,0)
This field represents whether the appointment has a Service Connected 
"^DD",409.85,409.85,15,21,2,0)
Priority.
"^DD",409.85,409.85,15,"DT")
3150418
"^DD",409.85,409.85,19,0)
DATE DISPOSITIONED^D^^DIS;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,19,3)
Enter a date.
"^DD",409.85,409.85,19,21,0)
^.001^2^2^3150423^^
"^DD",409.85,409.85,19,21,1,0)
This represents the date that the patient is dispositioned from the 
"^DD",409.85,409.85,19,21,2,0)
Appointment Request list.
"^DD",409.85,409.85,19,"DT")
3150423
"^DD",409.85,409.85,20,0)
DISPOSITIONED BY^P200'^VA(200,^DIS;2^Q
"^DD",409.85,409.85,20,3)
Select a user/provider
"^DD",409.85,409.85,20,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,20,21,1,0)
This represents the user who dispositioned the patient from the 
"^DD",409.85,409.85,20,21,2,0)
appointment request list.
"^DD",409.85,409.85,20,"DT")
3150418
"^DD",409.85,409.85,21,0)
DISPOSITION^S^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;TR:TRANSFERRED TO EWL;CL:CHANGED CLINIC;MC:MRTC PARENT CLOSED;^DIS;3^Q
"^DD",409.85,409.85,21,3)
Select a disposition
"^DD",409.85,409.85,21,21,0)
^.001^2^2^3160105^^
"^DD",409.85,409.85,21,21,1,0)
This field represents the reason this patient has been dispositioned from 
"^DD",409.85,409.85,21,21,2,0)
this appointment Request.
"^DD",409.85,409.85,21,"DT")
3160105
"^DD",409.85,409.85,21.1,0)
DISPOSITION CLOSED BY CLEANUP^S^Y:YES;N:NO;^DIS;4^Q
"^DD",409.85,409.85,21.1,3)
Enter Yes if Disposition was due to Open Request being Closed with Cleanup Utility.  Otherwise enter No.
"^DD",409.85,409.85,21.1,21,0)
^^2^2^3161207^
"^DD",409.85,409.85,21.1,21,1,0)
Enter Yes if Disposition is related to Open Request becoming Closed due 
"^DD",409.85,409.85,21.1,21,2,0)
to the running of Cleanup Utility.  Otherwise enter No.
"^DD",409.85,409.85,21.1,"DT")
3161207
"^DD",409.85,409.85,22,0)
CID/PREFERRED DATE OF APPT^RD^^0;16^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.85,22,3)
Enter the CID/Preferred Date of this appointment.
"^DD",409.85,409.85,22,21,0)
^^8^8^3150423^
"^DD",409.85,409.85,22,21,1,0)
This CID/PREFERRED DATE OF APPT field represents the date that the 
"^DD",409.85,409.85,22,21,2,0)
patient or provider has requested for the appointment.
"^DD",409.85,409.85,22,21,3,0)
 
"^DD",409.85,409.85,22,21,4,0)
 
"^DD",409.85,409.85,22,21,5,0)
If the priority is ASAP, this is the date the patient is placed on the
"^DD",409.85,409.85,22,21,6,0)
REQUEST List (SCHEDULING).
"^DD",409.85,409.85,22,21,7,0)
If the priority is FUTURE, the user enters the date that the 
"^DD",409.85,409.85,22,21,8,0)
patient/provider is requesting that the appointment is to be scheduled.
"^DD",409.85,409.85,22,"DT")
3150423
"^DD",409.85,409.85,23,0)
CURRENT STATUS^Sa^O:OPEN;C:CLOSED;^0;17^Q
"^DD",409.85,409.85,23,3)
Enter O or OPEN if the APPT Request entry is open. Enter C or CLOSED if the APPT Request entry is closed.
"^DD",409.85,409.85,23,21,0)
^^3^3^3150804^
"^DD",409.85,409.85,23,21,1,0)
This field represents the current status of this appointment request.
"^DD",409.85,409.85,23,21,2,0)
If the APPT Request entry is dispositioned, the status = 
"^DD",409.85,409.85,23,21,3,0)
CLOSED, otherwise, the APPT Request entry status = OPEN.
"^DD",409.85,409.85,23,"AUDIT")
y
"^DD",409.85,409.85,23,"DT")
3161208
"^DD",409.85,409.85,25,0)
COMMENTS^Fa^^0;18^K:$L(X)>80!($L(X)<1) X
"^DD",409.85,409.85,25,3)
Answer must be 1-80 characters in length.
"^DD",409.85,409.85,25,21,0)
^.001^7^7^3160104^^
"^DD",409.85,409.85,25,21,1,0)
This Free Text field represents information related to the appointment 
"^DD",409.85,409.85,25,21,2,0)
request.
"^DD",409.85,409.85,25,21,3,0)
 
"^DD",409.85,409.85,25,21,4,0)
 
"^DD",409.85,409.85,25,21,5,0)
example: see progress note date 5/01/02 this would direct the scheduling 
"^DD",409.85,409.85,25,21,6,0)
clerk to a note that may contain lab, xray orders that need to be 
"^DD",409.85,409.85,25,21,7,0)
completed prior to the appointment.
"^DD",409.85,409.85,25,"AUDIT")
y
"^DD",409.85,409.85,25,"AX")

"^DD",409.85,409.85,25,"DT")
3161102
"^DD",409.85,409.85,41,0)
MULTIPLE APPOINTMENT RTC^S^0:NO;1:YES;^3;1^Q
"^DD",409.85,409.85,41,3)
Select 1 or YES if multiple appointments are needed. Select 0 or NO if multiple appointments are not needed.
"^DD",409.85,409.85,41,21,0)
^^7^7^3150423^
"^DD",409.85,409.85,41,21,1,0)
This field represents that Multiple Appointments need to be made.
"^DD",409.85,409.85,41,21,2,0)
 
"^DD",409.85,409.85,41,21,3,0)
If set to NO (0 zero), Multiple Appointment (Return to Clinic) are not 
"^DD",409.85,409.85,41,21,4,0)
scheduled.
"^DD",409.85,409.85,41,21,5,0)
 
"^DD",409.85,409.85,41,21,6,0)
If set to YES (1), Multiple Appointment (Return to Clinic) could be 
"^DD",409.85,409.85,41,21,7,0)
scheduled.
"^DD",409.85,409.85,41,"DT")
3150418
"^DD",409.85,409.85,42,0)
MULT APPT RTC INTERVAL^NJ3,0^^3;2^K:+X'=X!(X>365)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.85,409.85,42,3)
Type a number between 0 and 365, 0 decimal digits.
"^DD",409.85,409.85,42,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,42,21,1,0)
The MULT APPT RTC INTERVAL represents the number of Days between 
"^DD",409.85,409.85,42,21,2,0)
appointments.
"^DD",409.85,409.85,42,"DT")
3150418
"^DD",409.85,409.85,43,0)
MULT APPT NUMBER^NJ3,0^^3;3^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.85,409.85,43,3)
Type a number between 0 and 100, 0 decimal digits.
"^DD",409.85,409.85,43,21,0)
^^1^1^3150423^
"^DD",409.85,409.85,43,21,1,0)
This field represents the number of appointments that may be needed.
"^DD",409.85,409.85,43,"DT")
3150418
"^DD",409.85,409.85,43.3,0)
MULT APPTS MADE^409.852P^^2;0
"^DD",409.85,409.85,43.3,21,0)
^.001^2^2^3160105^^^
"^DD",409.85,409.85,43.3,21,1,0)
These are the MRTC Appointments that have been made for this appointment 
"^DD",409.85,409.85,43.3,21,2,0)
request.
"^DD",409.85,409.85,43.3,23,0)
^.001^1^1^3160105^^^
"^DD",409.85,409.85,43.3,23,1,0)
These appointments are pointers to the SDEC APPOINTMENT file 409.84.
"^DD",409.85,409.85,43.5,0)
MRTC CALC PREF DATES^409.851D^^5;0
"^DD",409.85,409.85,43.5,21,0)
^^2^2^3150423^
"^DD",409.85,409.85,43.5,21,1,0)
This multiple field holds the dates that are requested for multiple 
"^DD",409.85,409.85,43.5,21,2,0)
appointments.
"^DD",409.85,409.85,43.8,0)
PARENT REQUEST^P409.85'^SDEC(409.85,^3;5^Q
"^DD",409.85,409.85,43.8,3)
Select an appointment request
"^DD",409.85,409.85,43.8,21,0)
^^1^1^3160105^
"^DD",409.85,409.85,43.8,21,1,0)
This field represents the parent appointment request.
"^DD",409.85,409.85,43.8,"DT")
3160105
"^DD",409.85,409.85,44,0)
PATIENT CONTACT^409.8544D^^4;0
"^DD",409.85,409.85,44,21,0)
^.001^1^1^3150902^^^^
"^DD",409.85,409.85,44,21,1,0)
This multiple records the patient contact events.
"^DD",409.85,409.85,45,0)
VS AUDIT^409.8545DA^^6;0
"^DD",409.85,409.85,45,21,0)
^^2^2^3151201^
"^DD",409.85,409.85,45,21,1,0)
This multiple is like an audit trail for specific fields and is used by 
"^DD",409.85,409.85,45,21,2,0)
VistA Scheduling GUI.
"^DD",409.85,409.85,46,0)
ORDER ID^NJ11,0^^7;1^K:+X'=X!(X>99999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",409.85,409.85,46,3)
Type a number between 1 and 99999999999, 0 decimal digits.
"^DD",409.85,409.85,46,21,0)
^.001^1^1^3171107^^^
"^DD",409.85,409.85,46,21,1,0)
This field is the HL7 Message ID used for Return to Clinic orders.
"^DD",409.85,409.85,46,23,0)
^.001^1^1^3171107^^^
"^DD",409.85,409.85,46,23,1,0)
Message ID number from the ORDER (#100) file.
"^DD",409.85,409.85,46,"DT")
3170619
"^DD",409.85,409.85,47,0)
TIME SENSITIVE^S^0:NO;1:YES;^7;2^Q
"^DD",409.85,409.85,47,3)
Select 'YES' or 'NO'
"^DD",409.85,409.85,47,21,0)
^.001^1^1^3171107^^^
"^DD",409.85,409.85,47,21,1,0)
Used to indicate time sensitive Return to Clinic order.
"^DD",409.85,409.85,47,23,0)
^.001^1^1^3171107^^^
"^DD",409.85,409.85,47,23,1,0)
Set of codes '0' for 'NO' and '1' for 'YES'.
"^DD",409.85,409.85,47,"DT")
3171107
"^DD",409.85,409.85,48,0)
PREREQUISITE^409.8548^^8;0
"^DD",409.85,409.85,48,21,0)
^.001^1^1^3171107^^^^
"^DD",409.85,409.85,48,21,1,0)
A list of all prerequisites associated with this Return to Clinic order.
"^DD",409.85,409.85,48,23,0)
^.001^1^1^3171107^^^^
"^DD",409.85,409.85,48,23,1,0)
Free text field 1 to 80 characters.
"^DD",409.85,409.85,48,"DT")
3171107
"^DD",409.85,409.851,0)
MRTC CALC PREF DATES SUB-FIELD^^.01^1
"^DD",409.85,409.851,0,"DT")
3150418
"^DD",409.85,409.851,0,"IX","B",409.851,.01)

"^DD",409.85,409.851,0,"NM","MRTC CALC PREF DATES")

"^DD",409.85,409.851,0,"UP")
409.85
"^DD",409.85,409.851,.01,0)
MRTC CALC PREF DATES^MD^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.851,.01,1,0)
^.1
"^DD",409.85,409.851,.01,1,1,0)
409.851^B
"^DD",409.85,409.851,.01,1,1,1)
S ^SDEC(409.85,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.851,.01,1,1,2)
K ^SDEC(409.85,DA(1),5,"B",$E(X,1,30),DA)
"^DD",409.85,409.851,.01,3)
Enter a date
"^DD",409.85,409.851,.01,21,0)
^^2^2^3150423^
"^DD",409.85,409.851,.01,21,1,0)
This field represents one of the dates requested for one of the multiple 
"^DD",409.85,409.851,.01,21,2,0)
appointments.
"^DD",409.85,409.851,.01,"DT")
3150418
"^DD",409.85,409.852,0)
MULT APPTS MADE SUB-FIELD^^.02^2
"^DD",409.85,409.852,0,"DT")
3150511
"^DD",409.85,409.852,0,"IX","B",409.852,.01)

"^DD",409.85,409.852,0,"NM","MULT APPTS MADE")

"^DD",409.85,409.852,0,"UP")
409.85
"^DD",409.85,409.852,.01,0)
CHILD REQUEST^MP409.85'^SDEC(409.85,^0;1^Q
"^DD",409.85,409.852,.01,1,0)
^.1
"^DD",409.85,409.852,.01,1,1,0)
409.852^B
"^DD",409.85,409.852,.01,1,1,1)
S ^SDEC(409.85,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.852,.01,1,1,2)
K ^SDEC(409.85,DA(1),2,"B",$E(X,1,30),DA)
"^DD",409.85,409.852,.01,3)
Select an appointment request.
"^DD",409.85,409.852,.01,21,0)
^^3^3^3160105^
"^DD",409.85,409.852,.01,21,1,0)
 
"^DD",409.85,409.852,.01,21,2,0)
 
"^DD",409.85,409.852,.01,21,3,0)
This field represents a 'Child' appointment request.
"^DD",409.85,409.852,.01,23,0)
^^1^1^3160105^
"^DD",409.85,409.852,.01,23,1,0)
Pointer to the SDEC APPT REQUEST file 409.85.
"^DD",409.85,409.852,.01,"DT")
3160105
"^DD",409.85,409.852,.02,0)
MULT APPTS MADE^P409.84'^SDEC(409.84,^0;2^Q
"^DD",409.85,409.852,.02,3)
Select an appointment
"^DD",409.85,409.852,.02,21,0)
^^2^2^3160105^
"^DD",409.85,409.852,.02,21,1,0)
This field represents one of the Multiple Appointments that have been 
"^DD",409.85,409.852,.02,21,2,0)
made based on this appointment request.
"^DD",409.85,409.852,.02,23,0)
^^1^1^3160105^
"^DD",409.85,409.852,.02,23,1,0)
Pointer to SDEC APPOINTMENT file 409.84.
"^DD",409.85,409.852,.02,"DT")
3160105
"^DD",409.85,409.8544,0)
PATIENT CONTACT SUB-FIELD^^4^4
"^DD",409.85,409.8544,0,"DT")
3150902
"^DD",409.85,409.8544,0,"IX","B",409.8544,.01)

"^DD",409.85,409.8544,0,"NM","PATIENT CONTACT")

"^DD",409.85,409.8544,0,"UP")
409.85
"^DD",409.85,409.8544,.01,0)
DATE ENTERED^D^^0;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.8544,.01,1,0)
^.1
"^DD",409.85,409.8544,.01,1,1,0)
409.8544^B
"^DD",409.85,409.8544,.01,1,1,1)
S ^SDEC(409.85,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.8544,.01,1,1,2)
K ^SDEC(409.85,DA(1),4,"B",$E(X,1,30),DA)
"^DD",409.85,409.8544,.01,3)
Enter the date and optional time that this patient was contacted.
"^DD",409.85,409.8544,.01,21,0)
^.001^3^3^3150423^^^^
"^DD",409.85,409.8544,.01,21,1,0)
This DATE ENTERED field represents the Date that an attempt was made to 
"^DD",409.85,409.8544,.01,21,2,0)
contact the patient regarding 'this' appointment REQUEST.
"^DD",409.85,409.8544,.01,21,3,0)
The time can also be optionally entered.
"^DD",409.85,409.8544,.01,"DT")
3150422
"^DD",409.85,409.8544,2,0)
ENTERED BY USER^P200'^VA(200,^0;2^Q
"^DD",409.85,409.8544,2,3)
Select a user/provider
"^DD",409.85,409.8544,2,21,0)
^^2^2^3150423^
"^DD",409.85,409.8544,2,21,1,0)
This ENTERED BY USER field represents the user/provider that made an 
"^DD",409.85,409.8544,2,21,2,0)
attempt to contact the patient regarding this appointment request.
"^DD",409.85,409.8544,2,"DT")
3150418
"^DD",409.85,409.8544,3,0)
ACTION^S^C:CALLED;M:MESSAGE LEFT;L:LETTER;^0;3^Q
"^DD",409.85,409.8544,3,3)
Select an action.
"^DD",409.85,409.8544,3,21,0)
^.001^5^5^3150423^^
"^DD",409.85,409.8544,3,21,1,0)
The ACTION field represents the attempt that was made to contact the 
"^DD",409.85,409.8544,3,21,2,0)
patient regarding 'this' appointment.
"^DD",409.85,409.8544,3,21,3,0)
C = Called
"^DD",409.85,409.8544,3,21,4,0)
M = Message Left
"^DD",409.85,409.8544,3,21,5,0)
L = Letter
"^DD",409.85,409.8544,3,"DT")
3150418
"^DD",409.85,409.8544,4,0)
PATIENT PHONE^F^^0;4^K:$L(X)>20!($L(X)<4) X
"^DD",409.85,409.8544,4,3)
Answer must be 4-20 characters in length.
"^DD",409.85,409.8544,4,21,0)
^.001^1^1^3150423^^
"^DD",409.85,409.8544,4,21,1,0)
This is the phone number used to contact the patient.
"^DD",409.85,409.8544,4,"DT")
3150418
"^DD",409.85,409.8545,0)
VS AUDIT SUB-FIELD^^3^4
"^DD",409.85,409.8545,0,"DT")
3151201
"^DD",409.85,409.8545,0,"IX","B",409.8545,.01)

"^DD",409.85,409.8545,0,"NM","VS AUDIT")

"^DD",409.85,409.8545,0,"UP")
409.85
"^DD",409.85,409.8545,.01,0)
DATE EDITED^MD^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",409.85,409.8545,.01,1,0)
^.1
"^DD",409.85,409.8545,.01,1,1,0)
409.8545^B
"^DD",409.85,409.8545,.01,1,1,1)
S ^SDEC(409.85,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.8545,.01,1,1,2)
K ^SDEC(409.85,DA(1),6,"B",$E(X,1,30),DA)
"^DD",409.85,409.8545,.01,3)
Enter a date and time
"^DD",409.85,409.8545,.01,21,0)
^.001^2^2^3151201^^
"^DD",409.85,409.8545,.01,21,1,0)
This is the Date/Time in which the edits represented by this entry were 
"^DD",409.85,409.8545,.01,21,2,0)
made.
"^DD",409.85,409.8545,.01,"DT")
3151201
"^DD",409.85,409.8545,1,0)
EDITED BY^P200'^VA(200,^0;2^Q
"^DD",409.85,409.8545,1,3)
Enter a user
"^DD",409.85,409.8545,1,21,0)
^^1^1^3151201^
"^DD",409.85,409.8545,1,21,1,0)
This is the user that edited the current VS AUDIT entry.
"^DD",409.85,409.8545,1,"DT")
3151201
"^DD",409.85,409.8545,2,0)
REQ SPECIFIC CLINIC^P44'^SC(^0;3^Q
"^DD",409.85,409.8545,2,3)
Select a clinic
"^DD",409.85,409.8545,2,21,0)
^^1^1^3151201^
"^DD",409.85,409.8545,2,21,1,0)
This field represents the clinic that this appointment request is for.
"^DD",409.85,409.8545,2,"DT")
3151201
"^DD",409.85,409.8545,3,0)
REQ SERVICE/SPECIALTY^P40.7'^DIC(40.7,^0;4^Q
"^DD",409.85,409.8545,3,3)
Select a CLINIC STOP
"^DD",409.85,409.8545,3,21,0)
^^2^2^3151201^
"^DD",409.85,409.8545,3,21,1,0)
This field represents the CLINIC STOP code (also referred to as 
"^DD",409.85,409.8545,3,21,2,0)
SERVICE/SPECIALTY) that is associated with this appointment request.
"^DD",409.85,409.8545,3,"DT")
3151201
"^DD",409.85,409.8548,0)
PREREQUISITE SUB-FIELD^^.01^1
"^DD",409.85,409.8548,0,"DT")
3171107
"^DD",409.85,409.8548,0,"IX","B",409.8548,.01)

"^DD",409.85,409.8548,0,"NM","PREREQUISITE")

"^DD",409.85,409.8548,0,"UP")
409.85
"^DD",409.85,409.8548,.01,0)
PREREQUISITE^MFJ80^^0;1^K:$L(X)>80!($L(X)<1) X
"^DD",409.85,409.8548,.01,1,0)
^.1
"^DD",409.85,409.8548,.01,1,1,0)
409.8548^B
"^DD",409.85,409.8548,.01,1,1,1)
S ^SDEC(409.85,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",409.85,409.8548,.01,1,1,2)
K ^SDEC(409.85,DA(1),8,"B",$E(X,1,30),DA)
"^DD",409.85,409.8548,.01,3)
Answer must be 1-80 characters in length.
"^DD",409.85,409.8548,.01,21,0)
^.001^1^1^3171107^^^^
"^DD",409.85,409.8548,.01,21,1,0)
Any appointment prerequisite associated with this Return to Clinic order.
"^DD",409.85,409.8548,.01,23,0)
^.001^1^1^3171107^^^^
"^DD",409.85,409.8548,.01,23,1,0)
Free text field 1 to 80 characters.
"^DD",409.85,409.8548,.01,"DT")
3171107
"^DIC",409.85,409.85,0)
SDEC APPT REQUEST^409.85
"^DIC",409.85,409.85,0,"GL")
^SDEC(409.85,
"^DIC",409.85,409.85,"%",0)
^1.005^^0
"^DIC",409.85,409.85,"%D",0)
^^3^3^3150423^
"^DIC",409.85,409.85,"%D",1,0)
This file contains the SDEC Appt Request entries for the Appointment 
"^DIC",409.85,409.85,"%D",2,0)
Scheduling application.
"^DIC",409.85,409.85,"%D",3,0)
Each entry represents a unique appointment request.
"^DIC",409.85,"B","SDEC APPT REQUEST",409.85)

"BLD",10348,6)
^557
**END**
**END**

