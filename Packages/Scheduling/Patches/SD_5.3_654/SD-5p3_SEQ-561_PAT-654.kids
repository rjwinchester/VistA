Released SD*5.3*654 SEQ #561
Extracted from mail message
**KIDS**:SD*5.3*654^

**INSTALL NAME**
SD*5.3*654
"BLD",10730,0)
SD*5.3*654^SCHEDULING^0^3170922^y
"BLD",10730,1,0)
^^9^9^3170922^
"BLD",10730,1,1,0)
This patch release addresses the following issues:
"BLD",10730,1,2,0)
 
"BLD",10730,1,3,0)
1. Fixes an issue that could prevent date sent fields from updating when 
"BLD",10730,1,4,0)
   displaying patient's recall letter or card on the computer screen.
"BLD",10730,1,5,0)
2. Fixes an issue where warning message would not create in MailMan for
"BLD",10730,1,6,0)
   patient with Bad Address Indicator.
"BLD",10730,1,7,0)
3. Fixes an incorrect word in the MailMan message for patients with Bad
"BLD",10730,1,8,0)
   Address.
"BLD",10730,1,9,0)
4. Fixes incorrect Canadian address format.
"BLD",10730,4,0)
^9.64PA^^
"BLD",10730,6.3)
5
"BLD",10730,"ABPKG")
n
"BLD",10730,"KRN",0)
^9.67PA^779.2^20
"BLD",10730,"KRN",.4,0)
.4
"BLD",10730,"KRN",.401,0)
.401
"BLD",10730,"KRN",.402,0)
.402
"BLD",10730,"KRN",.403,0)
.403
"BLD",10730,"KRN",.5,0)
.5
"BLD",10730,"KRN",.84,0)
.84
"BLD",10730,"KRN",3.6,0)
3.6
"BLD",10730,"KRN",3.8,0)
3.8
"BLD",10730,"KRN",9.2,0)
9.2
"BLD",10730,"KRN",9.8,0)
9.8
"BLD",10730,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10730,"KRN",9.8,"NM",1,0)
SDRRTSK^^0^B25995311
"BLD",10730,"KRN",9.8,"NM",2,0)
SDRRTSK1^^0^B17550007
"BLD",10730,"KRN",9.8,"NM",3,0)
SDRRRECL^^0^B146201896
"BLD",10730,"KRN",9.8,"NM",4,0)
SDRRRECP^^0^B109867057
"BLD",10730,"KRN",9.8,"NM","B","SDRRRECL",3)

"BLD",10730,"KRN",9.8,"NM","B","SDRRRECP",4)

"BLD",10730,"KRN",9.8,"NM","B","SDRRTSK",1)

"BLD",10730,"KRN",9.8,"NM","B","SDRRTSK1",2)

"BLD",10730,"KRN",19,0)
19
"BLD",10730,"KRN",19.1,0)
19.1
"BLD",10730,"KRN",101,0)
101
"BLD",10730,"KRN",409.61,0)
409.61
"BLD",10730,"KRN",771,0)
771
"BLD",10730,"KRN",779.2,0)
779.2
"BLD",10730,"KRN",870,0)
870
"BLD",10730,"KRN",8989.51,0)
8989.51
"BLD",10730,"KRN",8989.52,0)
8989.52
"BLD",10730,"KRN",8994,0)
8994
"BLD",10730,"KRN","B",.4,.4)

"BLD",10730,"KRN","B",.401,.401)

"BLD",10730,"KRN","B",.402,.402)

"BLD",10730,"KRN","B",.403,.403)

"BLD",10730,"KRN","B",.5,.5)

"BLD",10730,"KRN","B",.84,.84)

"BLD",10730,"KRN","B",3.6,3.6)

"BLD",10730,"KRN","B",3.8,3.8)

"BLD",10730,"KRN","B",9.2,9.2)

"BLD",10730,"KRN","B",9.8,9.8)

"BLD",10730,"KRN","B",19,19)

"BLD",10730,"KRN","B",19.1,19.1)

"BLD",10730,"KRN","B",101,101)

"BLD",10730,"KRN","B",409.61,409.61)

"BLD",10730,"KRN","B",771,771)

"BLD",10730,"KRN","B",779.2,779.2)

"BLD",10730,"KRN","B",870,870)

"BLD",10730,"KRN","B",8989.51,8989.51)

"BLD",10730,"KRN","B",8989.52,8989.52)

"BLD",10730,"KRN","B",8994,8994)

"BLD",10730,"QDEF")
^^^^NO^^^^^^YES
"BLD",10730,"QUES",0)
^9.62^^
"BLD",10730,"REQB",0)
^9.611^1^1
"BLD",10730,"REQB",1,0)
SD*5.3*643^2
"BLD",10730,"REQB","B","SD*5.3*643",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
654^3170922
"PKG",16,22,1,"PAH",1,1,0)
^^9^9^3170922
"PKG",16,22,1,"PAH",1,1,1,0)
This patch release addresses the following issues:
"PKG",16,22,1,"PAH",1,1,2,0)
 
"PKG",16,22,1,"PAH",1,1,3,0)
1. Fixes an issue that could prevent date sent fields from updating when 
"PKG",16,22,1,"PAH",1,1,4,0)
   displaying patient's recall letter or card on the computer screen.
"PKG",16,22,1,"PAH",1,1,5,0)
2. Fixes an issue where warning message would not create in MailMan for
"PKG",16,22,1,"PAH",1,1,6,0)
   patient with Bad Address Indicator.
"PKG",16,22,1,"PAH",1,1,7,0)
3. Fixes an incorrect word in the MailMan message for patients with Bad
"PKG",16,22,1,"PAH",1,1,8,0)
   Address.
"PKG",16,22,1,"PAH",1,1,9,0)
4. Fixes incorrect Canadian address format.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDRRRECL")
0^3^B146201896^B102965608
"RTN","SDRRRECL",1,0)
SDRRRECL ;10N20/MAH - Recall Reminder Manual Printing;09/20/2004
"RTN","SDRRRECL",2,0)
 ;;5.3;Scheduling;**536,561,569,579,654**;Aug 13, 1993;Build 5
"RTN","SDRRRECL",3,0)
 ;;This routine is called from SDRRLRP 
"RTN","SDRRRECL",4,0)
 ;;If the site has set TYPE OF NOTIFICATION to LETTER this routine
"RTN","SDRRRECL",5,0)
 ;;will run.
"RTN","SDRRRECL",6,0)
 ;
"RTN","SDRRRECL",7,0)
 ; SD*654
"RTN","SDRRRECL",8,0)
 ; - do not update date if letter printed to a computer screen.
"RTN","SDRRRECL",9,0)
 ; - adds missing var DFN when calling $$BADADR^DGUTL3 and
"RTN","SDRRRECL",10,0)
 ;   quits updating date and printing ltr if bad addr.
"RTN","SDRRRECL",11,0)
 ; - changes word 'card' to 'letter' in the message.
"RTN","SDRRRECL",12,0)
 ; - fixes incomplete Canadian address.
"RTN","SDRRRECL",13,0)
 ;
"RTN","SDRRRECL",14,0)
 K TYPE
"RTN","SDRRRECL",15,0)
MEN ;SET UP WHAT ARE THEY WOULD LIKE TO PRINT FOR LETTERS
"RTN","SDRRRECL",16,0)
 K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","SDRRRECL",17,0)
 S DIR(0)="SO^1:Print Letters by Clinic;2:Print Letters by Provider;3:Print Letters by Team;4:Print a Letter by Patient;5:Print Letters for Nonresponsive Patients"
"RTN","SDRRRECL",18,0)
 W ! S DIR("A")="Please select what you are looking for"
"RTN","SDRRRECL",19,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRRECL",20,0)
 I Q=1 G EN
"RTN","SDRRRECL",21,0)
 I Q=2 G EN1
"RTN","SDRRRECL",22,0)
 I Q=3 G EN3
"RTN","SDRRRECL",23,0)
 I Q=4 G EN4
"RTN","SDRRRECL",24,0)
 I Q=5 G EN5
"RTN","SDRRRECL",25,0)
 Q
"RTN","SDRRRECL",26,0)
EN ;PRINT BY CLINIC
"RTN","SDRRRECL",27,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y G:Y<0 QUIT
"RTN","SDRRRECL",28,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",29,0)
 D SELDT G:Y<0 QUIT  ;SD*561 quit if no date range entered
"RTN","SDRRRECL",30,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Clinic",ZTRTN="DQD^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",31,0)
DQD K ^TMP($J)
"RTN","SDRRRECL",32,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"E",DIV,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",33,0)
 .S TIME=""
"RTN","SDRRRECL",34,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",35,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",36,0)
 .S DFN=+DTA
"RTN","SDRRRECL",37,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",38,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",39,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",40,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",41,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",42,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",43,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECL",44,0)
 .;        - quit updating date and printing ltr if bad addr
"RTN","SDRRRECL",45,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECL",46,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",47,0)
 ..S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",48,0)
 ..D ^XMD
"RTN","SDRRRECL",49,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",50,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",51,0)
 .; SD*654 - do not update date if displaying to a computer screen.
"RTN","SDRRRECL",52,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",53,0)
 .D PR
"RTN","SDRRRECL",54,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",55,0)
 ;;done and tested
"RTN","SDRRRECL",56,0)
QUIT K ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,DIV,EDT,PR,SDT,FAST,TIME,ACC
"RTN","SDRRRECL",57,0)
 K LINE,LETTER,MESSAGE,TEST,DOD,CLINIC,FAIL,TEAM,LAB,SDRR,Q,%DT,%ZIS,CHECK,VA,ZTDESC,ZTIO,ZTRTN,ZTSAVE,STATE Q
"RTN","SDRRRECL",58,0)
 D KVAR^VADPT
"RTN","SDRRRECL",59,0)
 Q
"RTN","SDRRRECL",60,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRRECL",61,0)
 S EDT=Y Q
"RTN","SDRRRECL",62,0)
PR S LETTER=0
"RTN","SDRRRECL",63,0)
 ; SD*579 - Add date printed and last 4
"RTN","SDRRRECL",64,0)
 S PRNDT=$TR($$FMTE^XLFDT(DT,"5DF")," ","0")
"RTN","SDRRRECL",65,0)
 S LAST4=$E($P(VA("BID"),U),1,4)
"RTN","SDRRRECL",66,0)
 W @IOF
"RTN","SDRRRECL",67,0)
 W !,?65,PRNDT
"RTN","SDRRRECL",68,0)
 W !,?65,$E(PN,1)_LAST4
"RTN","SDRRRECL",69,0)
 F L=1:1:9 W !
"RTN","SDRRRECL",70,0)
 ;
"RTN","SDRRRECL",71,0)
 ; SD*579 - Fix suffix listed problem
"RTN","SDRRRECL",72,0)
 S PNAME=$$NAMEFMT^XLFNAME(PN,"G","")
"RTN","SDRRRECL",73,0)
 W !?20,PNAME
"RTN","SDRRRECL",74,0)
 D ADDR
"RTN","SDRRRECL",75,0)
 I $D(MESSAGE) W !!!!!,?25,MESSAGE
"RTN","SDRRRECL",76,0)
 ; SD*569 - Adjust the tab starting position
"RTN","SDRRRECL",77,0)
 I TIME'="" W !!!!?2,TIME
"RTN","SDRRRECL",78,0)
 I LAB'="" W !!!!!,?2,"*"_LAB
"RTN","SDRRRECL",79,0)
 W !!!
"RTN","SDRRRECL",80,0)
 S:'$D(MESSAGE) LETTER=$O(^SD(403.52,"B",DIV,LETTER))
"RTN","SDRRRECL",81,0)
 I LETTER>0 S LINE=0 F  S LINE=$O(^SD(403.52,LETTER,1,LINE)) Q:'LINE  W !,?2,$P(^SD(403.52,LETTER,1,LINE,0),"^",1)
"RTN","SDRRRECL",82,0)
 K MESSAGE,PRNDT,LAST4,PNAME
"RTN","SDRRRECL",83,0)
 Q
"RTN","SDRRRECL",84,0)
EN1 ;print letters by provider
"RTN","SDRRRECL",85,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Provider: " D ^DIC G:Y<0 QUIT S PR=+Y
"RTN","SDRRRECL",86,0)
 D SELDT G:Y<0 QUIT  ;SD*5.3*561 quit if no date range entered
"RTN","SDRRRECL",87,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Provider",ZTRTN="DQD1^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",88,0)
DQD1 K ^TMP($J)
"RTN","SDRRRECL",89,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",90,0)
 .; SD*579 - If entry not exist, kill x-refs and quit.
"RTN","SDRRRECL",91,0)
 .I '$D(^SD(403.5,D0)) D KXREF Q
"RTN","SDRRRECL",92,0)
 .S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",93,0)
 .I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",94,0)
 .I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",95,0)
 .I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",96,0)
 .S TIME=""
"RTN","SDRRRECL",97,0)
 .I $P($G(^SD(403.5,D0,0)),"^",9)>30 S TIME=$P($G(^SD(403.5,D0,0)),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",98,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",99,0)
 .S DFN=+DTA
"RTN","SDRRRECL",100,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",101,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",102,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",103,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",104,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",105,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",106,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECL",107,0)
 .;        - quit updating date and printing ltr if bad addr
"RTN","SDRRRECL",108,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECL",109,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",110,0)
 ..S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",111,0)
 ..D ^XMD
"RTN","SDRRRECL",112,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",113,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",114,0)
 .; SD*654 - do not update date if letter printed to a computer screen.
"RTN","SDRRRECL",115,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",116,0)
 .D PR
"RTN","SDRRRECL",117,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",118,0)
EN3 ;PRINT LETTER FOR A TEAM
"RTN","SDRRRECL",119,0)
 W ! S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",120,0)
 D SELDT G:Y<0 QUIT  ;SD*561 quit if no date range entered
"RTN","SDRRRECL",121,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Team",ZTRTN="DQD4^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",122,0)
DQD4 S PR=0 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  S D0=0 D
"RTN","SDRRRECL",123,0)
 .F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",124,0)
 ..; SD*579 - If entry not exist, kill x-refs and quit.
"RTN","SDRRRECL",125,0)
 ..I '$D(^SD(403.5,D0)) D KXREF Q
"RTN","SDRRRECL",126,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",127,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",128,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",129,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",130,0)
 ..S TIME=""
"RTN","SDRRRECL",131,0)
 ..I $P($G(^SD(403.5,D0,0)),"^",9)>30 S TIME=$P($G(^SD(403.5,D0,0)),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",132,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",133,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",134,0)
 ..Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)  ;SD*561 check selected date range
"RTN","SDRRRECL",135,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",136,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",137,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",138,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",139,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",140,0)
 ..; SD*654 - add missing var DFN
"RTN","SDRRRECL",141,0)
 ..;        - quit updating date and printing ltr if bad addr
"RTN","SDRRRECL",142,0)
 ..S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECL",143,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",144,0)
 ...S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",145,0)
 ...D ^XMD
"RTN","SDRRRECL",146,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",147,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",148,0)
 ..; SD*654 - do not update date if letter printed to a computer screen.
"RTN","SDRRRECL",149,0)
 ..I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",150,0)
 ..D PR
"RTN","SDRRRECL",151,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",152,0)
 ;done and tested
"RTN","SDRRRECL",153,0)
EN4 ;PRINT LETTER FOR ONE PATIENT
"RTN","SDRRRECL",154,0)
 K X W ! S DIC="^SD(403.5,",DIC(0)="AEQMZ",DIC("A")="Select Patient: " D ^DIC S D0=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",155,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",156,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",157,0)
 I '$D(^SD(403.5,"E",DIV,D0)) W *7,!!,?5,"**This patient does not have a recall reminder for the selected clinic**",!! G QUIT
"RTN","SDRRRECL",158,0)
 ;
"RTN","SDRRRECL",159,0)
 ; SD*654 - Check if it needs to quit before prompting for device
"RTN","SDRRRECL",160,0)
 S DFN=+$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",161,0)
 D DEM^VADPT
"RTN","SDRRRECL",162,0)
 S PN=$P(VADM(1),U)
"RTN","SDRRRECL",163,0)
 ; SD*654 - add missing var DFN
"RTN","SDRRRECL",164,0)
 ;        - quit updating date and printing ltr if bad addr
"RTN","SDRRRECL",165,0)
 S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  W !!,?5,"**This patient has been flagged with a Bad Address Indicator.**",!! G QUIT
"RTN","SDRRRECL",166,0)
 . S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",167,0)
 . S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_" "_VA("BID")
"RTN","SDRRRECL",168,0)
 . D ^XMD
"RTN","SDRRRECL",169,0)
 . K XMY,SMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",170,0)
 ; quit if DoD
"RTN","SDRRRECL",171,0)
 I $G(VADM(6),U)'="" W !!,?5,VADM(7),!! G QUIT
"RTN","SDRRRECL",172,0)
 ; quit if test pat
"RTN","SDRRRECL",173,0)
 I $$TESTPAT^VADPT(DFN) W !!,?5,"**You may have selected a test patient.**",!! G QUIT
"RTN","SDRRRECL",174,0)
 ; SD*654 - End
"RTN","SDRRRECL",175,0)
 ;
"RTN","SDRRRECL",176,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Patient",ZTRTN="DQD3^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",177,0)
DQD3 K ^TMP($J)
"RTN","SDRRRECL",178,0)
 S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",179,0)
 .; SD*569 - Quit if patient's clinic does not match the selected hospital location.
"RTN","SDRRRECL",180,0)
 .I $P(DTA,"^",2)'=DIV Q
"RTN","SDRRRECL",181,0)
 .S TIME=""
"RTN","SDRRRECL",182,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",183,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",184,0)
 .S DFN=+DTA
"RTN","SDRRRECL",185,0)
 .D ADD^VADPT
"RTN","SDRRRECL",186,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",187,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",188,0)
 .; SD*654 - do not update date if letter printed to a computer screen.
"RTN","SDRRRECL",189,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",190,0)
 .D PR
"RTN","SDRRRECL",191,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",192,0)
EN5 ;Print LETTERS for Nonresponsive
"RTN","SDRRRECL",193,0)
 S TEAM=""
"RTN","SDRRRECL",194,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:TEAM<0 QUIT
"RTN","SDRRRECL",195,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for Nonresponsive",ZTRTN="DQD5^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",196,0)
DQD5 N CHKDATE
"RTN","SDRRRECL",197,0)
 ;SD*5.3*561 remove extraneous write command following $O on next line
"RTN","SDRRRECL",198,0)
 S PR=0,CHKDATE=5 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  D
"RTN","SDRRRECL",199,0)
 .S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:'D0  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",200,0)
 ..; SD*579 - If entry not exist, kill x-refs and quit
"RTN","SDRRRECL",201,0)
 ..I '$D(^SD(403.5,D0)) D KXREF Q
"RTN","SDRRRECL",202,0)
 ..I $P($G(^SD(403.5,D0,0)),"^",10)="" QUIT
"RTN","SDRRRECL",203,0)
 ..; SD*569 - Prevent from printing more than ONE second letter.
"RTN","SDRRRECL",204,0)
 ..I $P($G(^SD(403.5,D0,0)),"^",13)'="" QUIT
"RTN","SDRRRECL",205,0)
 ..S RDATE=$P($G(^SD(403.5,D0,0)),"^",6) S CHECK=$$FMDIFF^XLFDT(RDATE,DT) I CHECK>CHKDATE K RDATE QUIT
"RTN","SDRRRECL",206,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",207,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",208,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",209,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",210,0)
 ..S TIME=""
"RTN","SDRRRECL",211,0)
 ..I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",212,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",213,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",214,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",215,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",216,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",217,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",218,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",219,0)
 ..; SD*654 - add missing var DFN
"RTN","SDRRRECL",220,0)
 ..;        - quit updating date and printing ltr if bad addr
"RTN","SDRRRECL",221,0)
 ..S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECL",222,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",223,0)
 ...S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",224,0)
 ...D ^XMD
"RTN","SDRRRECL",225,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",226,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",227,0)
 ..; SD*654 - do not update date if letter printed to a computer screen.
"RTN","SDRRRECL",228,0)
 ..I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",13)=DT
"RTN","SDRRRECL",229,0)
 ..D PR
"RTN","SDRRRECL",230,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",231,0)
 Q
"RTN","SDRRRECL",232,0)
 ;
"RTN","SDRRRECL",233,0)
KXREF ; SD*579 - kill x-refs if entry not exist
"RTN","SDRRRECL",234,0)
 S STR="BCDE"
"RTN","SDRRRECL",235,0)
 F I=1:1:$L(STR) D
"RTN","SDRRRECL",236,0)
 .S X=$E(STR,I,I)
"RTN","SDRRRECL",237,0)
 .S N3=0 F  S N3=$O(^SD(403.5,X,N3)) Q:N3'>0  D
"RTN","SDRRRECL",238,0)
 ..S N4=0 F  S N4=$O(^SD(403.5,X,N3,N4)) Q:N4'>0  D
"RTN","SDRRRECL",239,0)
 ...I N4=D0 K ^SD(403.5,X,N3,N4)
"RTN","SDRRRECL",240,0)
 K I,STR,X,N3,N4
"RTN","SDRRRECL",241,0)
 Q
"RTN","SDRRRECL",242,0)
 ;
"RTN","SDRRRECL",243,0)
ADDR ; SD*654 - Patient address
"RTN","SDRRRECL",244,0)
 ; Change state to abbr.
"RTN","SDRRRECL",245,0)
 N SDRRIENS,SDRRX
"RTN","SDRRRECL",246,0)
 I $D(VAPA(5)) S SDRRIENS=+VAPA(5)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(5),U,2)=SDRRX
"RTN","SDRRRECL",247,0)
 I $D(VAPA(17)) S SDRRIENS=+VAPA(17)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(17),U,2)=SDRRX
"RTN","SDRRRECL",248,0)
 K SDRRIENS,SDRRX
"RTN","SDRRRECL",249,0)
 ;
"RTN","SDRRRECL",250,0)
 N SDRRACT1,SDRRACT2,LL
"RTN","SDRRRECL",251,0)
 ; Check Confidential Address Indicator (0=Inactive,1=Active)
"RTN","SDRRRECL",252,0)
 S SDRRACT1=VAPA(12),SDRRACT2=$P($G(VAPA(22,2)),U,3)
"RTN","SDRRRECL",253,0)
 ; If Confidential address is not active, print regular address
"RTN","SDRRRECL",254,0)
 I ($G(SDRRACT1)=0)!($G(SDRRACT2)'="Y") D
"RTN","SDRRRECL",255,0)
 . F LL=1:1:3 W:VAPA(LL)]"" !,?20,VAPA(LL)
"RTN","SDRRRECL",256,0)
 . ; If country is blank, display as USA
"RTN","SDRRRECL",257,0)
 . I (VAPA(25)="")!($P(VAPA(25),U,2)="UNITED STATES") D
"RTN","SDRRRECL",258,0)
 . . ; Display city, state, zip
"RTN","SDRRRECL",259,0)
 . . W !?20,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDRRRECL",260,0)
 . E  D
"RTN","SDRRRECL",261,0)
 . . ; Display city, province, postal code
"RTN","SDRRRECL",262,0)
 . . W !?20,VAPA(4)_" "_VAPA(23)_"  "_VAPA(24)
"RTN","SDRRRECL",263,0)
 . ; Display country
"RTN","SDRRRECL",264,0)
 . W:($P(VAPA(25),U,2)'="UNITED STATES") !,?20,$P(VAPA(25),U,2)
"RTN","SDRRRECL",265,0)
 ; If Confidential address is active, print confidential address
"RTN","SDRRRECL",266,0)
 I $G(SDRRACT1)=1,$G(SDRRACT2)="Y" D
"RTN","SDRRRECL",267,0)
 . F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDRRRECL",268,0)
 . I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDRRRECL",269,0)
 . . W !,?20,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDRRRECL",270,0)
 . E  D
"RTN","SDRRRECL",271,0)
 . . W !,?20,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDRRRECL",272,0)
 . I ($P(VAPA(28),"^",2)'="UNITED STATES") W !?20,$P(VAPA(28),U,2)
"RTN","SDRRRECL",273,0)
 Q
"RTN","SDRRRECP")
0^4^B109867057^B69269047
"RTN","SDRRRECP",1,0)
SDRRRECP ;10N20/MAH - Recall Reminder Manual Printing;09/20/2004
"RTN","SDRRRECP",2,0)
 ;;5.3;Scheduling;**536,569,579,654**;Aug 13, 1993;Build 5
"RTN","SDRRRECP",3,0)
 ;;This routine is called from SDRRLRP 
"RTN","SDRRRECP",4,0)
 ;;If the site has set TYPE OF NOTIFICATION to CARDS this routine
"RTN","SDRRRECP",5,0)
 ;;will run.
"RTN","SDRRRECP",6,0)
 ;
"RTN","SDRRRECP",7,0)
 ; SD*654
"RTN","SDRRRECP",8,0)
 ; - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",9,0)
 ; - adds missing var DFN when calling $$BARADR^DGUTL3 and
"RTN","SDRRRECP",10,0)
 ;   quits printing if bad addr.
"RTN","SDRRRECP",11,0)
 ; - fixes incomplete Canadian address
"RTN","SDRRRECP",12,0)
 ;
"RTN","SDRRRECP",13,0)
 K TYPE
"RTN","SDRRRECP",14,0)
MEN ;SET UP WHAT ARE THEY WOULD LIKE TO PRINT FOR CARDS
"RTN","SDRRRECP",15,0)
 K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","SDRRRECP",16,0)
 S DIR(0)="SO^1:Print Cards by Division;2:Print Cards by Clinic;3:Print Cards by Provider;4:Print Cards by Team;5:Print a Card by Patient;6:Print Cards for Nonresponsive Patients"
"RTN","SDRRRECP",17,0)
 W ! S DIR("A")="Please select what you are looking for"
"RTN","SDRRRECP",18,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRRECP",19,0)
 I Q=1 G EN3
"RTN","SDRRRECP",20,0)
 I Q=2 G EN
"RTN","SDRRRECP",21,0)
 I Q=3 G EN2
"RTN","SDRRRECP",22,0)
 I Q=4 G EN1
"RTN","SDRRRECP",23,0)
 I Q=5 G EN4
"RTN","SDRRRECP",24,0)
 I Q=6 G EN5
"RTN","SDRRRECP",25,0)
 Q
"RTN","SDRRRECP",26,0)
 ;ALLK Q,Y,DIR
"RTN","SDRRRECP",27,0)
EN3 ;PRINT BY DIVISION
"RTN","SDRRRECP",28,0)
 S DIC="^DG(40.8,",DIC(0)="AEQMZ" D ^DIC G:Y<0 QUIT S DIV=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",29,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDSC="Print Recall Cards by Division",ZTRTN="DQD1^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",30,0)
DQD1 K ^TMP($J)
"RTN","SDRRRECP",31,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),"^",3)=DIV S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",32,0)
 .S TIME=""
"RTN","SDRRRECP",33,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",34,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",35,0)
 .S DFN=+DTA
"RTN","SDRRRECP",36,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",37,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",38,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",39,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",40,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",41,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT)
"RTN","SDRRRECP",42,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECP",43,0)
 .;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",44,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECP",45,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",46,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",47,0)
 ..D ^XMD
"RTN","SDRRRECP",48,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",49,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",50,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",51,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",52,0)
 .D PR
"RTN","SDRRRECP",53,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",54,0)
EN ;PRINT BY CLINIC
"RTN","SDRRRECP",55,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",56,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Clinic",ZTRTN="DQD^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",57,0)
DQD K ^TMP($J)
"RTN","SDRRRECP",58,0)
 S D0=0 F  S D0=$O(^SD(403.5,"E",DIV,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",59,0)
 .S TIME=""
"RTN","SDRRRECP",60,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",61,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",62,0)
 .S DFN=+DTA
"RTN","SDRRRECP",63,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",64,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",65,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",66,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",67,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",68,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT)
"RTN","SDRRRECP",69,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECP",70,0)
 .;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",71,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECP",72,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",73,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",74,0)
 ..D ^XMD
"RTN","SDRRRECP",75,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",76,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",77,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",78,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",79,0)
 .D PR
"RTN","SDRRRECP",80,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",81,0)
QUIT K ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,DIV,EDT,PR,SDT,TIME,LAB,Y,STATE,PNAME
"RTN","SDRRRECP",82,0)
 K DATE,DOD,X,Q,%DT,%ZIS,SDRR,VA,CHECK,ZTDESC,ZTDSC,ZTEAM,ZTIO,ZTRTN,ZTSAVE
"RTN","SDRRRECP",83,0)
 Q
"RTN","SDRRRECP",84,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRRECP",85,0)
 S EDT=Y Q
"RTN","SDRRRECP",86,0)
PR W @IOF F L=1:1:7 W !
"RTN","SDRRRECP",87,0)
 S PNAME=$$NAMEFMT^XLFNAME(PN,"G","")
"RTN","SDRRRECP",88,0)
 W !?20,PNAME
"RTN","SDRRRECP",89,0)
 D ADDR
"RTN","SDRRRECP",90,0)
 I TIME'="" W !!?45,TIME
"RTN","SDRRRECP",91,0)
 I LAB'="" W !!?45,LAB
"RTN","SDRRRECP",92,0)
 Q
"RTN","SDRRRECP",93,0)
EN1 ;PRINT BY TEAM
"RTN","SDRRRECP",94,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Team: " D ^DIC Q:Y<0  S ZTEAM=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",95,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Team",ZTRTN="DQT^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",96,0)
DQT K ^TMP($J)
"RTN","SDRRRECP",97,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),U,2)=+ZTEAM S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",98,0)
 .S TIME=""
"RTN","SDRRRECP",99,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",100,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",101,0)
 .S DFN=+DTA
"RTN","SDRRRECP",102,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",103,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",104,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",105,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",106,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",107,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT)
"RTN","SDRRRECP",108,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECP",109,0)
 .;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",110,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECP",111,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",112,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",113,0)
 ..D ^XMD
"RTN","SDRRRECP",114,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",115,0)
 ..D ^%ZISC G QUIT
"RTN","SDRRRECP",116,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",117,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",118,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",119,0)
 .D PR
"RTN","SDRRRECP",120,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",121,0)
EN2 ;PRINT BY PROV
"RTN","SDRRRECP",122,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Provider: " D ^DIC G:Y<0 QUIT S PR=+Y  D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",123,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Prov",ZTRTN="DQP^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",124,0)
DQP K ^TMP($J)
"RTN","SDRRRECP",125,0)
 S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",126,0)
 .S TIME=""
"RTN","SDRRRECP",127,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",128,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",129,0)
 .S DFN=+DTA
"RTN","SDRRRECP",130,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",131,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",132,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",133,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",134,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",135,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT)
"RTN","SDRRRECP",136,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECP",137,0)
 .;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",138,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECP",139,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",140,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",141,0)
 ..D ^XMD
"RTN","SDRRRECP",142,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",143,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",144,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",145,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",146,0)
 .D PR
"RTN","SDRRRECP",147,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",148,0)
EN4 ;PRINT BY Patient
"RTN","SDRRRECP",149,0)
 W ! S DIC="^SD(403.5,",DIC(0)="AEQMZ",DIC("A")="Select Patient: " D ^DIC G:Y<0 QUIT S D0=+Y
"RTN","SDRRRECP",150,0)
 ;
"RTN","SDRRRECP",151,0)
 ; SD*654 - Check if it needs to quit before prompting for device
"RTN","SDRRRECP",152,0)
 S DFN=+$G(^SD(403.5,D0,0))
"RTN","SDRRRECP",153,0)
 I $$TESTPAT^VADPT(DFN) W !!,?5,"**You may have selected a test patient.**",!! G QUIT  ; quit if test pat
"RTN","SDRRRECP",154,0)
 D DEM^VADPT
"RTN","SDRRRECP",155,0)
 S PN=$P(VADM(1),U)
"RTN","SDRRRECP",156,0)
 ; SD*654 - add missing var DFN
"RTN","SDRRRECP",157,0)
 ;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",158,0)
 S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  W !!,?5,"**This patient has been flagged with a Bad Address Indicator.**",!! G QUIT
"RTN","SDRRRECP",159,0)
 . S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",160,0)
 . S SDRR(1)="Bad Address - card will not be printed for:"_"    "_PN_"    "_VA("BID")
"RTN","SDRRRECP",161,0)
 . D ^XMD
"RTN","SDRRRECP",162,0)
 . K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",163,0)
 I $G(VADM(6),U)'="" W !!,?5,VADM(7),!! G QUIT  ; quit if DoD
"RTN","SDRRRECP",164,0)
 ; SD*654 - end
"RTN","SDRRRECP",165,0)
 ;
"RTN","SDRRRECP",166,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Prov",ZTRTN="DPP^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",167,0)
DPP K ^TMP($J)
"RTN","SDRRRECP",168,0)
 S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",169,0)
 .S TIME=""
"RTN","SDRRRECP",170,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",171,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",172,0)
 .S DFN=+DTA
"RTN","SDRRRECP",173,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",174,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",175,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",176,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",177,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",178,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",179,0)
 .D PR
"RTN","SDRRRECP",180,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",181,0)
EN5 ;PRINT BY NONRESPONSIVE PATIENTS
"RTN","SDRRRECP",182,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Team: " D ^DIC S ZTEAM=+Y G:Y<0 QUIT
"RTN","SDRRRECP",183,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Nonresponsive Recall Cards by Team",ZTRTN="DQDD^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",184,0)
DQDD K ^TMP($J)
"RTN","SDRRRECP",185,0)
 N CHKDATE
"RTN","SDRRRECP",186,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),U,2)=+ZTEAM S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",187,0)
 .I $P($G(^SD(403.5,D0,0)),"^",10)="" QUIT
"RTN","SDRRRECP",188,0)
 .; SD*569 - Prevent from printing more than ONE second card
"RTN","SDRRRECP",189,0)
 .I $P($G(^SD(403.5,D0,0)),"^",13)'="" QUIT
"RTN","SDRRRECP",190,0)
 .S CHKDATE=5 S RDATE=$P($G(^SD(403.5,D0,0)),"^",6) S CHECK=$$FMDIFF^XLFDT(RDATE,DT) I CHECK>CHKDATE K RDATE QUIT
"RTN","SDRRRECP",191,0)
 .S TIME=""
"RTN","SDRRRECP",192,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",193,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",194,0)
 .S DFN=+DTA
"RTN","SDRRRECP",195,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",196,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",197,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",198,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",199,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",200,0)
 .; SD*654 - add missing var DFN
"RTN","SDRRRECP",201,0)
 .;        - quit updating date and printing card if bad addr
"RTN","SDRRRECP",202,0)
 .S CHECK=$$BADADR^DGUTL3(DFN) I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D  Q
"RTN","SDRRRECP",203,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",204,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",205,0)
 ..D ^XMD
"RTN","SDRRRECP",206,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",207,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",208,0)
 .; SD*654 - do not update date if card printed to a computer screen.
"RTN","SDRRRECP",209,0)
 .I $E(IOST,1,2)'="C-" S $P(^SD(403.5,D0,0),"^",13)=DT
"RTN","SDRRRECP",210,0)
 .D PR
"RTN","SDRRRECP",211,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",212,0)
 Q
"RTN","SDRRRECP",213,0)
 ;
"RTN","SDRRRECP",214,0)
ADDR ; SD*654 Patient address
"RTN","SDRRRECP",215,0)
 ; Change state to abbr.
"RTN","SDRRRECP",216,0)
 N SDRRIENS,SDRRX
"RTN","SDRRRECP",217,0)
 I $D(VAPA(5)) S SDRRIENS=+VAPA(5)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(5),U,2)=SDRRX
"RTN","SDRRRECP",218,0)
 I $D(VAPA(17)) S SDRRIENS=+VAPA(17)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(17),U,2)=SDRRX
"RTN","SDRRRECP",219,0)
 K SDRRIENS,SDRRX
"RTN","SDRRRECP",220,0)
 ;
"RTN","SDRRRECP",221,0)
 N SDRRACT1,SDRRACT2,LL
"RTN","SDRRRECP",222,0)
 ; Check Confidential Address Indicator (0=Inactive,1=Active)
"RTN","SDRRRECP",223,0)
 S SDRRACT1=VAPA(12),SDRRACT2=$P($G(VAPA(22,2)),U,3)
"RTN","SDRRRECP",224,0)
 ; If Confidential address is not active, print regular address
"RTN","SDRRRECP",225,0)
 I ($G(SDRRACT1)=0)!($G(SDRRACT2)'="Y") D
"RTN","SDRRRECP",226,0)
 . F LL=1:1:3 W:VAPA(LL)]"" !,?20,VAPA(LL)
"RTN","SDRRRECP",227,0)
 . ; If country is blank, display as USA
"RTN","SDRRRECP",228,0)
 . I (VAPA(25)="")!($P(VAPA(25),U,2)="UNITED STATES") D
"RTN","SDRRRECP",229,0)
 . . ; Display city, state, zip
"RTN","SDRRRECP",230,0)
 . . W !?20,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDRRRECP",231,0)
 . E  D
"RTN","SDRRRECP",232,0)
 . . ; Display city, province, postal code
"RTN","SDRRRECP",233,0)
 . . W !?20,VAPA(4)_" "_VAPA(23)_"  "_VAPA(24)
"RTN","SDRRRECP",234,0)
 . ; Display country
"RTN","SDRRRECP",235,0)
 . W:($P(VAPA(25),U,2)'="UNITED STATES") !,?20,$P(VAPA(25),U,2)
"RTN","SDRRRECP",236,0)
 ; If Confidential address is active, print confidential address
"RTN","SDRRRECP",237,0)
 I $G(SDRRACT1)=1,$G(SDRRACT2)="Y" D
"RTN","SDRRRECP",238,0)
 . F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDRRRECP",239,0)
 . I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDRRRECP",240,0)
 . . W !,?20,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDRRRECP",241,0)
 . E  D
"RTN","SDRRRECP",242,0)
 . . W !,?20,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDRRRECP",243,0)
 . I ($P(VAPA(28),"^",2)'="UNITED STATES") W !?20,$P(VAPA(28),U,2)
"RTN","SDRRRECP",244,0)
 Q
"RTN","SDRRTSK")
0^1^B25995311^B16926080
"RTN","SDRRTSK",1,0)
SDRRTSK ;10N20/MAH - RECALL LETTER PRINT TASK ;09/05/17
"RTN","SDRRTSK",2,0)
 ;;5.3;Scheduling;**536,579,643,654**;Aug 13, 1993;Build 5
"RTN","SDRRTSK",3,0)
 ;THIS ROUTINE WILL PRINT LETTER FOR SELECTED METHOD OF PRINTING
"RTN","SDRRTSK",4,0)
 ;WILL LOOK AT CLINIC RECALL LOCATION
"RTN","SDRRTSK",5,0)
 ;
"RTN","SDRRTSK",6,0)
 ; SD*654
"RTN","SDRRTSK",7,0)
 ; - fixes incomplete Canadian address.
"RTN","SDRRTSK",8,0)
 ; - changes word 'card' to 'letter' in the message.
"RTN","SDRRTSK",9,0)
 ;
"RTN","SDRRTSK",10,0)
DATE ;lOOKS TO SEE HOW MANY DAYS IN ADVANCE TO PRINT LETTER
"RTN","SDRRTSK",11,0)
 Q:'$D(^SD(403.53,0))
"RTN","SDRRTSK",12,0)
 S CRP=0
"RTN","SDRRTSK",13,0)
 F  S CRP=$O(^SD(403.53,CRP)) Q:'CRP  D
"RTN","SDRRTSK",14,0)
 .S TYPE=$P($G(^SD(403.53,CRP,0)),"^",2)
"RTN","SDRRTSK",15,0)
 .Q:TYPE["C"
"RTN","SDRRTSK",16,0)
 .S DATE=$P($G(^SD(403.53,CRP,0)),"^",4) Q:DATE=""   ;IF NOT SET ROUTINE WILL QUIT
"RTN","SDRRTSK",17,0)
 .S X="T+"_DATE D ^%DT S (ZSDT,ZEDT)=Y K Y
"RTN","SDRRTSK",18,0)
 .S (PRT,TEAM)=0
"RTN","SDRRTSK",19,0)
 .F  S TEAM=$O(^SD(403.55,"C",CRP,TEAM)) Q:TEAM=""  S PRT=$P($G(^SD(403.55,TEAM,0)),"^",3) D
"RTN","SDRRTSK",20,0)
 ..Q:PRT=""
"RTN","SDRRTSK",21,0)
 ..S DA=PRT
"RTN","SDRRTSK",22,0)
 ..S DIC="^%ZIS(1,",DR=".01;1;3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","SDRRTSK",23,0)
 ..N IOP S IOP=$G(DPTR("3.5",DA,".01","I")) D ^%ZIS
"RTN","SDRRTSK",24,0)
 ..S PROV=0 F  S PROV=$O(^SD(403.54,"C",TEAM,PROV)) Q:PROV=""  D
"RTN","SDRRTSK",25,0)
 ...S (MESSAGE,D0,LETTER)=0 F  S D0=$O(^SD(403.5,"C",PROV,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRTSK",26,0)
 ....; SD*579 - Kill x-refs and quit if entry not exist
"RTN","SDRRTSK",27,0)
 ....I '$D(^SD(403.5,D0)) D KXREF Q
"RTN","SDRRTSK",28,0)
 ....S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRTSK",29,0)
 ....I CLINIC="" S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRTSK",30,0)
 ....I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC)) S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRTSK",31,0)
 ....I CLINIC'="",(FAIL=0) S ZDIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRTSK",32,0)
 ....S TIME=""
"RTN","SDRRTSK",33,0)
 ....I $P($G(^SD(403.5,D0,0)),"^",9)>45 S TIME=$P($G(^SD(403.5,D0,0)),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRTSK",34,0)
 ....S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRTSK",35,0)
 ....S DFN=+DTA
"RTN","SDRRTSK",36,0)
 ....;Q:$P(DTA,U,6)<ZSDT!($P(DTA,U,6)>ZEDT)
"RTN","SDRRTSK",37,0)
 ....Q:$P(DTA,U,6)>ZEDT     ;alb/sat 643
"RTN","SDRRTSK",38,0)
 ....Q:$P(DTA,U,10)'=""     ;alb/sat 643
"RTN","SDRRTSK",39,0)
 ....Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRTSK",40,0)
 ....D ADD^VADPT,DEM^VADPT
"RTN","SDRRTSK",41,0)
 ....S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRTSK",42,0)
 ....S PN=$P(VADM(1),U)
"RTN","SDRRTSK",43,0)
 ....I $G(VADM(6),U)'="" Q
"RTN","SDRRTSK",44,0)
 ....N CHECK
"RTN","SDRRTSK",45,0)
 ....I $$BADADR^DGUTL3(DFN) S CHECK=1 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRTSK",46,0)
 .....S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRTSK",47,0)
 .....S SDRR(1)="Bad Address - letter will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRTSK",48,0)
 .....D ^XMD
"RTN","SDRRTSK",49,0)
 .....K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRTSK",50,0)
 .....Q
"RTN","SDRRTSK",51,0)
 ....;ADDED THE DATE INFORMATION
"RTN","SDRRTSK",52,0)
 ....I '$D(CHECK) S $P(^SD(403.5,D0,0),"^",10)=DT   ;NEW CODE
"RTN","SDRRTSK",53,0)
 ....Q:$D(CHECK)
"RTN","SDRRTSK",54,0)
 ....U IO
"RTN","SDRRTSK",55,0)
 ....; SD*579 - Add date printed and last 4
"RTN","SDRRTSK",56,0)
 ....S PRNDT=$TR($$FMTE^XLFDT(DT,"5DF")," ","0")
"RTN","SDRRTSK",57,0)
 ....S LAST4=$E($P(VA("BID"),U),1,4)
"RTN","SDRRTSK",58,0)
 ....W @IOF
"RTN","SDRRTSK",59,0)
 ....W !,?65,PRNDT
"RTN","SDRRTSK",60,0)
 ....W !,?65,$E(PN,1)_LAST4
"RTN","SDRRTSK",61,0)
 ....F L=1:1:9 W !
"RTN","SDRRTSK",62,0)
 ....; SD*579 - Fix suffix problem
"RTN","SDRRTSK",63,0)
 ....S PNAME=$$NAMEFMT^XLFNAME(PN,"G","")
"RTN","SDRRTSK",64,0)
 ....W !?20,PNAME
"RTN","SDRRTSK",65,0)
 ....D ADDR  ; SD*654 fix incomplete addr
"RTN","SDRRTSK",66,0)
 ....I LETTER=0 W !!!!!,?25,MESSAGE
"RTN","SDRRTSK",67,0)
 ....I TIME'="" W !!!!?2,"**"_TIME
"RTN","SDRRTSK",68,0)
 ....I LAB'="" W !!!!!,?2,"*"_LAB
"RTN","SDRRTSK",69,0)
 ....W !!!
"RTN","SDRRTSK",70,0)
 ....S:'$D(MESSAGE) LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRTSK",71,0)
 ....I LETTER>0 S LINE=0 F  S LINE=$O(^SD(403.52,LETTER,1,LINE)) Q:'LINE  W !,?2,$P(^SD(403.52,LETTER,1,LINE,0),"^",1)
"RTN","SDRRTSK",72,0)
 ..D ^%ZISC
"RTN","SDRRTSK",73,0)
 K DPTR,DEVSB,DEVSB1,DIQ,DEVSB1,DA,DA1,DR
"RTN","SDRRTSK",74,0)
 K MESSAGE,LETTER,PRNDT,LAST4,PNAME
"RTN","SDRRTSK",75,0)
QUIT K DEV,PRT,ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,ZDIV,ZEDT,ZPR,ZSDT,FAST,TIME,ACC,LAB,STATE
"RTN","SDRRTSK",76,0)
 K LINE,LETTER,MESSAGE,TEST,CLINIC,DA,DATE,DEV1,DEVSB,DOD,FAIL,PROV,TEAM,X,PROV,TEAM,CRP,DATE,TYPE,SDRR,DPT,VA
"RTN","SDRRTSK",77,0)
 D KVAR^VADPT
"RTN","SDRRTSK",78,0)
 Q
"RTN","SDRRTSK",79,0)
 ;
"RTN","SDRRTSK",80,0)
KXREF ; SD*579 - If entry not exist, kill all the x-refs.
"RTN","SDRRTSK",81,0)
 S STR="BCDE"
"RTN","SDRRTSK",82,0)
 F I=1:1:$L(STR) D
"RTN","SDRRTSK",83,0)
 .S X=$E(STR,I,I)
"RTN","SDRRTSK",84,0)
 .S N3=0 F  S N3=$O(^SD(403.5,X,N3)) Q:N3'>0  D
"RTN","SDRRTSK",85,0)
 ..S N4=0 F  S N4=$O(^SD(403.5,X,N3,N4)) Q:N4'>0  D
"RTN","SDRRTSK",86,0)
 ...I N4=D0 K ^SD(403.5,X,N3,N4)
"RTN","SDRRTSK",87,0)
 K I,STR,X,N3,N4
"RTN","SDRRTSK",88,0)
 Q
"RTN","SDRRTSK",89,0)
 ;
"RTN","SDRRTSK",90,0)
ADDR ; SD*654 Patient address
"RTN","SDRRTSK",91,0)
 ; Change state to abbr.
"RTN","SDRRTSK",92,0)
 N SDRRIENS,SDRRX
"RTN","SDRRTSK",93,0)
 I $D(VAPA(5)) S SDRRIENS=+VAPA(5)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(5),U,2)=SDRRX
"RTN","SDRRTSK",94,0)
 I $D(VAPA(17)) S SDRRIENS=+VAPA(17)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(17),U,2)=SDRRX
"RTN","SDRRTSK",95,0)
 K SDRRIENS,SDRRX
"RTN","SDRRTSK",96,0)
 ;
"RTN","SDRRTSK",97,0)
 N SDRRACT1,SDRRACT2,LL
"RTN","SDRRTSK",98,0)
 ; Check Confidential Address Indicator (0=Inactive,1=Active)
"RTN","SDRRTSK",99,0)
 S SDRRACT1=VAPA(12),SDRRACT2=$P($G(VAPA(22,2)),U,3)
"RTN","SDRRTSK",100,0)
 ; If Confidential address is not active, print regular address
"RTN","SDRRTSK",101,0)
 I ($G(SDRRACT1)=0)!($G(SDRRACT2)'="Y") D
"RTN","SDRRTSK",102,0)
 . F LL=1:1:3 W:VAPA(LL)]"" !,?20,VAPA(LL)
"RTN","SDRRTSK",103,0)
 . ; If country is blank, display as USA
"RTN","SDRRTSK",104,0)
 . I (VAPA(25)="")!($P(VAPA(25),U,2)="UNITED STATES") D
"RTN","SDRRTSK",105,0)
 . . ; Display city, state, zip
"RTN","SDRRTSK",106,0)
 . . W !?20,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDRRTSK",107,0)
 . E  D
"RTN","SDRRTSK",108,0)
 . . ; Display city, province, postal code
"RTN","SDRRTSK",109,0)
 . . W !?20,VAPA(4)_" "_VAPA(23)_"  "_VAPA(24)
"RTN","SDRRTSK",110,0)
 . ; Display country
"RTN","SDRRTSK",111,0)
 . W:($P(VAPA(25),U,2)'="UNITED STATES") !,?20,$P(VAPA(25),U,2)
"RTN","SDRRTSK",112,0)
 ; If Confidential address is active, print confidential address
"RTN","SDRRTSK",113,0)
 I $G(SDRRACT1)=1,$G(SDRRACT2)="Y" D
"RTN","SDRRTSK",114,0)
 . F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDRRTSK",115,0)
 . I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDRRTSK",116,0)
 . . W !,?20,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDRRTSK",117,0)
 . E  D
"RTN","SDRRTSK",118,0)
 . . W !,?20,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDRRTSK",119,0)
 . I ($P(VAPA(28),"^",2)'="UNITED STATES") W !?20,$P(VAPA(28),U,2)
"RTN","SDRRTSK",120,0)
 Q
"RTN","SDRRTSK1")
0^2^B17550007^B9951175
"RTN","SDRRTSK1",1,0)
SDRRTSK1 ;10N20/MAH - Recall Reminder-Clinic Print Task ;09/07/17
"RTN","SDRRTSK1",2,0)
 ;;5.3;Scheduling;**536,579,643,654**;Aug 13, 1993;Build 5
"RTN","SDRRTSK1",3,0)
 ;;This routine is called from SDRR TASK JOB CARD
"RTN","SDRRTSK1",4,0)
 ;;and will be called if PARAM IS cards
"RTN","SDRRTSK1",5,0)
 ;
"RTN","SDRRTSK1",6,0)
 ; SD*654
"RTN","SDRRTSK1",7,0)
 ; - fixes incomplete Canadian address.
"RTN","SDRRTSK1",8,0)
 ;
"RTN","SDRRTSK1",9,0)
START Q:'$D(^SD(403.53,0))
"RTN","SDRRTSK1",10,0)
 S CRP=0
"RTN","SDRRTSK1",11,0)
 F  S CRP=$O(^SD(403.53,CRP)) Q:'CRP  D
"RTN","SDRRTSK1",12,0)
 .S TYPE=$P($G(^SD(403.53,CRP,0)),"^",2)
"RTN","SDRRTSK1",13,0)
 .Q:TYPE["L"
"RTN","SDRRTSK1",14,0)
 .S DATE=$P($G(^SD(403.53,CRP,0)),"^",4) Q:DATE=""  ;IF NOT SET ROUTINE WILL QUIT
"RTN","SDRRTSK1",15,0)
 .S X="T+"_DATE D ^%DT S (ZSDT,ZEDT)=Y K Y
"RTN","SDRRTSK1",16,0)
 .S (PRT,TEAM)=0
"RTN","SDRRTSK1",17,0)
 .F  S TEAM=$O(^SD(403.55,"C",CRP,TEAM)) Q:TEAM=""  S PRT=$P($G(^SD(403.55,TEAM,0)),"^",3) D
"RTN","SDRRTSK1",18,0)
 ..Q:PRT=""
"RTN","SDRRTSK1",19,0)
 ..S DA=PRT
"RTN","SDRRTSK1",20,0)
 ..S DIC="^%ZIS(1,",DR=".01;1;3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","SDRRTSK1",21,0)
 ..N IOP S IOP=$G(DPTR("3.5",DA,".01","I")) D ^%ZIS
"RTN","SDRRTSK1",22,0)
 ..S PROV=0 F  S PROV=$O(^SD(403.54,"C",TEAM,PROV)) Q:PROV=""  D
"RTN","SDRRTSK1",23,0)
 ...S D0=0 F  S D0=$O(^SD(403.5,"C",PROV,D0)) Q:D0=""  D
"RTN","SDRRTSK1",24,0)
 ....; SD*579 - if entry not exist, kill x-refs and quit
"RTN","SDRRTSK1",25,0)
 ....I '$D(^SD(403.5,D0)) D KXREF Q
"RTN","SDRRTSK1",26,0)
 ....S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRTSK1",27,0)
 ....S TIME=""
"RTN","SDRRTSK1",28,0)
 ....I $P($G(^SD(403.5,D0,0)),"^",9)>45 S TIME=$P($G(^SD(403.5,D0,0)),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRTSK1",29,0)
 ....S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRTSK1",30,0)
 ....S DFN=+DTA
"RTN","SDRRTSK1",31,0)
 ....;Q:$P(DTA,U,6)<ZSDT!($P(DTA,U,6)>ZEDT)
"RTN","SDRRTSK1",32,0)
 ....Q:$P(DTA,U,6)>ZEDT     ;alb/sat 643
"RTN","SDRRTSK1",33,0)
 ....Q:$P(DTA,U,10)'=""     ;alb/sat 643
"RTN","SDRRTSK1",34,0)
 ....Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRTSK1",35,0)
 ....D ADD^VADPT,DEM^VADPT
"RTN","SDRRTSK1",36,0)
 ....S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRTSK1",37,0)
 ....S PN=$P(VADM(1),U)
"RTN","SDRRTSK1",38,0)
 ....I $G(VADM(6),U)'="" Q
"RTN","SDRRTSK1",39,0)
 ....N CHECK
"RTN","SDRRTSK1",40,0)
 ....I $$BADADR^DGUTL3(DFN) S CHECK=1 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRTSK1",41,0)
 .....S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRTSK1",42,0)
 .....S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRTSK1",43,0)
 .....D ^XMD
"RTN","SDRRTSK1",44,0)
 .....K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRTSK1",45,0)
 .....Q
"RTN","SDRRTSK1",46,0)
 .....;ADDED THE DATE INFORMATION
"RTN","SDRRTSK1",47,0)
 ....I '$D(CHECK) S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRTSK1",48,0)
 ....Q:$D(CHECK)
"RTN","SDRRTSK1",49,0)
 ....U IO
"RTN","SDRRTSK1",50,0)
 ....W @IOF F L=1:1:7 W !
"RTN","SDRRTSK1",51,0)
 ....S PNAME=$$NAMEFMT^XLFNAME(PN,"G","")
"RTN","SDRRTSK1",52,0)
 ....W !?20,PNAME
"RTN","SDRRTSK1",53,0)
 ....D ADDR ; SD*654 fix incomplete addr
"RTN","SDRRTSK1",54,0)
 ....I TIME'="" W !!?45,TIME
"RTN","SDRRTSK1",55,0)
 ....I LAB'="" W !,?45,LAB
"RTN","SDRRTSK1",56,0)
 ..D ^%ZISC
"RTN","SDRRTSK1",57,0)
 K DPTR,DEVSB,DEVSB1,DIQ,DEVSB1,DA,DA1,DR
"RTN","SDRRTSK1",58,0)
QUIT K DEV,PRT,ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,ZDIV,ZEDT,ZPR,ZSDT,FAST,TIME,ACC,TYPE,PTN,CRP,STATE,PNAME
"RTN","SDRRTSK1",59,0)
 K LINE,LETTER,MESSAGE,TEST,CLINIC,DA,DATE,DEV1,DEVSB,DOD,FAIL,PROV,TEAM,X,DPT,LAB,SDRR,VA,LAB,DPT,SDRR,VA
"RTN","SDRRTSK1",60,0)
 D KVAR^VADPT
"RTN","SDRRTSK1",61,0)
 Q
"RTN","SDRRTSK1",62,0)
 ;
"RTN","SDRRTSK1",63,0)
KXREF ; SD*579 - If entry does not exist, kill all the x-refs.
"RTN","SDRRTSK1",64,0)
 S STR="BCDE"
"RTN","SDRRTSK1",65,0)
 F I=1:1:$L(STR) D
"RTN","SDRRTSK1",66,0)
 .S X=$E(STR,I,I)
"RTN","SDRRTSK1",67,0)
 .S N3=0 F  S N3=$O(^SD(403.5,X,N3)) Q:N3'>0  D
"RTN","SDRRTSK1",68,0)
 ..S N4=0 F  S N4=$O(^SD(403.5,X,N3,N4)) Q:N4'>0  D
"RTN","SDRRTSK1",69,0)
 ...I N4=D0 K ^SD(403.5,X,N3,N4)
"RTN","SDRRTSK1",70,0)
 K I,STR,X,N3,N4
"RTN","SDRRTSK1",71,0)
 Q
"RTN","SDRRTSK1",72,0)
 ;
"RTN","SDRRTSK1",73,0)
ADDR ; SD*654 Patient address
"RTN","SDRRTSK1",74,0)
 ; Change state to abbr.
"RTN","SDRRTSK1",75,0)
 N SDRRIENS,SDRRX
"RTN","SDRRTSK1",76,0)
 I $D(VAPA(5)) S SDRRIENS=+VAPA(5)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(5),U,2)=SDRRX
"RTN","SDRRTSK1",77,0)
 I $D(VAPA(17)) S SDRRIENS=+VAPA(17)_",",SDRRX=$$GET1^DIQ(5,SDRRIENS,1),$P(VAPA(17),U,2)=SDRRX
"RTN","SDRRTSK1",78,0)
 K SDRRIENS,SDRRX
"RTN","SDRRTSK1",79,0)
 ;
"RTN","SDRRTSK1",80,0)
 N SDRRACT1,SDRRACT2,LL
"RTN","SDRRTSK1",81,0)
 ; Check Confidential Address Indicator (0=Inactive,1=Active)
"RTN","SDRRTSK1",82,0)
 S SDRRACT1=VAPA(12),SDRRACT2=$P($G(VAPA(22,2)),U,3)
"RTN","SDRRTSK1",83,0)
 ; If Confidential address is not active, print regular address
"RTN","SDRRTSK1",84,0)
 I ($G(SDRRACT1)=0)!($G(SDRRACT2)'="Y") D
"RTN","SDRRTSK1",85,0)
 . F LL=1:1:3 W:VAPA(LL)]"" !,?20,VAPA(LL)
"RTN","SDRRTSK1",86,0)
 . ; If country is blank, display as USA
"RTN","SDRRTSK1",87,0)
 . I (VAPA(25)="")!($P(VAPA(25),U,2)="UNITED STATES") D
"RTN","SDRRTSK1",88,0)
 . . ; Display city, state, zip
"RTN","SDRRTSK1",89,0)
 . . W !?20,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDRRTSK1",90,0)
 . E  D
"RTN","SDRRTSK1",91,0)
 . . ; Display city, province, postal code
"RTN","SDRRTSK1",92,0)
 . . W !?20,VAPA(4)_" "_VAPA(23)_"  "_VAPA(24)
"RTN","SDRRTSK1",93,0)
 . ; Display country
"RTN","SDRRTSK1",94,0)
 . W:($P(VAPA(25),U,2)'="UNITED STATES") !,?20,$P(VAPA(25),U,2)
"RTN","SDRRTSK1",95,0)
 ; If Confidential address is active, print confidential address
"RTN","SDRRTSK1",96,0)
 I $G(SDRRACT1)=1,$G(SDRRACT2)="Y" D
"RTN","SDRRTSK1",97,0)
 . F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDRRTSK1",98,0)
 . I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDRRTSK1",99,0)
 . . W !,?20,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDRRTSK1",100,0)
 . E  D
"RTN","SDRRTSK1",101,0)
 . . W !,?20,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDRRTSK1",102,0)
 . I ($P(VAPA(28),"^",2)'="UNITED STATES") W !?20,$P(VAPA(28),U,2)
"RTN","SDRRTSK1",103,0)
 Q
"VER")
8.0^22.2
"BLD",10730,6)
^561
**END**
**END**

