Released SD*5.3*639 SEQ #529
Extracted from mail message
**KIDS**:SD*5.3*639^

**INSTALL NAME**
SD*5.3*639
"BLD",10031,0)
SD*5.3*639^SCHEDULING^0^3151027^y
"BLD",10031,1,0)
^^2^2^3151027^^
"BLD",10031,1,1,0)
This patch stops sending appointment data for bi-monthly transmission 
"BLD",10031,1,2,0)
from VistA to the Austin Information Technology Center (AITC).
"BLD",10031,4,0)
^9.64PA^^
"BLD",10031,6.3)
7
"BLD",10031,"INID")
^n
"BLD",10031,"INIT")
EN^SDRPSTOP
"BLD",10031,"KRN",0)
^9.67PA^779.2^20
"BLD",10031,"KRN",.4,0)
.4
"BLD",10031,"KRN",.401,0)
.401
"BLD",10031,"KRN",.402,0)
.402
"BLD",10031,"KRN",.403,0)
.403
"BLD",10031,"KRN",.5,0)
.5
"BLD",10031,"KRN",.84,0)
.84
"BLD",10031,"KRN",3.6,0)
3.6
"BLD",10031,"KRN",3.8,0)
3.8
"BLD",10031,"KRN",9.2,0)
9.2
"BLD",10031,"KRN",9.8,0)
9.8
"BLD",10031,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10031,"KRN",9.8,"NM",1,0)
SDRPA00^^0^B92057935
"BLD",10031,"KRN",9.8,"NM",2,0)
SDRPA09^^0^B7507225
"BLD",10031,"KRN",9.8,"NM",3,0)
SDRPA04^^0^B43965670
"BLD",10031,"KRN",9.8,"NM","B","SDRPA00",1)

"BLD",10031,"KRN",9.8,"NM","B","SDRPA04",3)

"BLD",10031,"KRN",9.8,"NM","B","SDRPA09",2)

"BLD",10031,"KRN",19,0)
19
"BLD",10031,"KRN",19.1,0)
19.1
"BLD",10031,"KRN",101,0)
101
"BLD",10031,"KRN",409.61,0)
409.61
"BLD",10031,"KRN",771,0)
771
"BLD",10031,"KRN",779.2,0)
779.2
"BLD",10031,"KRN",870,0)
870
"BLD",10031,"KRN",8989.51,0)
8989.51
"BLD",10031,"KRN",8989.52,0)
8989.52
"BLD",10031,"KRN",8994,0)
8994
"BLD",10031,"KRN","B",.4,.4)

"BLD",10031,"KRN","B",.401,.401)

"BLD",10031,"KRN","B",.402,.402)

"BLD",10031,"KRN","B",.403,.403)

"BLD",10031,"KRN","B",.5,.5)

"BLD",10031,"KRN","B",.84,.84)

"BLD",10031,"KRN","B",3.6,3.6)

"BLD",10031,"KRN","B",3.8,3.8)

"BLD",10031,"KRN","B",9.2,9.2)

"BLD",10031,"KRN","B",9.8,9.8)

"BLD",10031,"KRN","B",19,19)

"BLD",10031,"KRN","B",19.1,19.1)

"BLD",10031,"KRN","B",101,101)

"BLD",10031,"KRN","B",409.61,409.61)

"BLD",10031,"KRN","B",771,771)

"BLD",10031,"KRN","B",779.2,779.2)

"BLD",10031,"KRN","B",870,870)

"BLD",10031,"KRN","B",8989.51,8989.51)

"BLD",10031,"KRN","B",8989.52,8989.52)

"BLD",10031,"KRN","B",8994,8994)

"BLD",10031,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10031,"QUES",0)
^9.62^^
"BLD",10031,"REQB",0)
^9.611^2^1
"BLD",10031,"REQB",2,0)
SD*5.3*634^2
"BLD",10031,"REQB","B","SD*5.3*634",2)

"INIT")
EN^SDRPSTOP
"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
639^3151027
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3151027
"PKG",16,22,1,"PAH",1,1,1,0)
This patch stops sending appointment data for bi-monthly transmission 
"PKG",16,22,1,"PAH",1,1,2,0)
from VistA to the Austin Information Technology Center (AITC).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDRPA00")
0^1^B92057935^B83224590
"RTN","SDRPA00",1,0)
SDRPA00 ;BP-OIFO/OWAIN,ESW - Patient Appointment Information Transmission  ;11/2/04 11:09am;2/24/08 11:25am
"RTN","SDRPA00",2,0)
 ;;5.3;Scheduling;**290,333,349,376,491,639**;Aug 13,1993;Build 7
"RTN","SDRPA00",3,0)
 ;SD/491 - calling SRPA03 instead of SDRPA04  (dupl)
"RTN","SDRPA00",4,0)
 ;SD/639 - disable manual and tasked entries
"RTN","SDRPA00",5,0)
 Q
"RTN","SDRPA00",6,0)
EN ;manual entry
"RTN","SDRPA00",7,0)
 ; SD*639 Disable Manual Startup PAIT Transmission option
"RTN","SDRPA00",8,0)
 D BMES^XPDUTL("This Manual Startup PAIT Transmission option has been placed Out of Order")
"RTN","SDRPA00",9,0)
 D MES^XPDUTL("by SD*5.3*639.")
"RTN","SDRPA00",10,0)
 D MES^XPDUTL("")
"RTN","SDRPA00",11,0)
 Q
"RTN","SDRPA00",12,0)
 ;
"RTN","SDRPA00",13,0)
 N SDI,Y,ZTSK,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE,RUNID,REC
"RTN","SDRPA00",14,0)
 I '$$RUNCK^SDRPA02() W !,"You attempted to start PAIT outside the authorized transmission dates.",!,"Job has been terminated.",! Q
"RTN","SDRPA00",15,0)
 S RUNID=$O(^SDWL(409.6,":"),-1)
"RTN","SDRPA00",16,0)
 I RUNID S ZTSK=$P(^SDWL(409.6,RUNID,0),"^",2) D STAT^%ZTLOAD I ZTSK(1)=1!(ZTSK(1)=2) W !,"A task is currently active." Q
"RTN","SDRPA00",17,0)
 K ZTSK N SDCON S SDCON=1
"RTN","SDRPA00",18,0)
 S %DT("A")="Queue to run:  "
"RTN","SDRPA00",19,0)
 S %DT="AEFXR" W ! D ^%DT S DT=Y D:Y'=-1  Q:'SDCON
"RTN","SDRPA00",20,0)
 .S ZTDTH=Y,ZTRTN="START^SDRPA00",ZTIO=""
"RTN","SDRPA00",21,0)
 .S ZTDESC="PAIT"
"RTN","SDRPA00",22,0)
 .I RUNID I $P(^SDWL(409.6,RUNID,0),U,7)="" S SDCON=0 D
"RTN","SDRPA00",23,0)
 ..W !,"The previous run errored out, not repaired!",!,"Please address a problem and use SD-PAIT REPAIR to fix the run."
"RTN","SDRPA00",24,0)
 .Q:'SDCON
"RTN","SDRPA00",25,0)
 .F SDI=1:1:20 D ^%ZTLOAD Q:$G(ZTSK)
"RTN","SDRPA00",26,0)
 .I $G(ZTSK) W !,"Task # "_ZTSK_" queued!"
"RTN","SDRPA00",27,0)
 I '$G(ZTSK) W !!,"Task not queued, check Taskman",! Q
"RTN","SDRPA00",28,0)
 W !!,"Task number: ",ZTSK,!
"RTN","SDRPA00",29,0)
 Q
"RTN","SDRPA00",30,0)
START ;Tasked entry
"RTN","SDRPA00",31,0)
 ; SD*639 Disable Taskman PAIT Transmission option
"RTN","SDRPA00",32,0)
 D BMES^XPDUTL("This Taskman PAIT Transmission option has been placed Out of Order")
"RTN","SDRPA00",33,0)
 D MES^XPDUTL("by SD*5.3*639.")
"RTN","SDRPA00",34,0)
 D MES^XPDUTL("")
"RTN","SDRPA00",35,0)
 Q
"RTN","SDRPA00",36,0)
 ;
"RTN","SDRPA00",37,0)
 N SDOUT,DFN,DFNEND,SDCNT,SDCNT0,RUNID,RUNDT,SDPREV,FIRST,SDDAM,TODAY,SD6A,SD8A,SD68,RUNIDP,SDPR,ZTSKN
"RTN","SDRPA00",38,0)
 I '$$RUNCK^SDRPA02() Q  ;check scheduling
"RTN","SDRPA00",39,0)
 I $G(ZTSK)="" D  Q
"RTN","SDRPA00",40,0)
 . W !,"NOT AN INTERACTIVE OPTION...schedule through TaskMan",!!
"RTN","SDRPA00",41,0)
 S ZTSKN=ZTSK
"RTN","SDRPA00",42,0)
 S SDPR=$O(^SDWL(409.6,":"),-1) ;previous run
"RTN","SDRPA00",43,0)
 I SDPR N SD1 S SD1=0 D  Q:SD1  ;finish if task is still running
"RTN","SDRPA00",44,0)
 .I $P(^SDWL(409.6,SDPR,0),U,7)'="" Q  ; previous task finished
"RTN","SDRPA00",45,0)
 .N ZTSK
"RTN","SDRPA00",46,0)
 .S ZTSK=$P(^SDWL(409.6,SDPR,0),"^",2) D STAT^%ZTLOAD I ZTSK(1)=1!(ZTSK(1)=2) S SD1=1
"RTN","SDRPA00",47,0)
 .;send message
"RTN","SDRPA00",48,0)
 .N SDAMX,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDRPA00",49,0)
 .S XMSUB="PAIT BACKGROUND JOB"
"RTN","SDRPA00",50,0)
 .S XMY("G.SD-PAIT")=""
"RTN","SDRPA00",51,0)
 .S XMTEXT="SDAMX("
"RTN","SDRPA00",52,0)
 .S XMDUZ="POSTMASTER"
"RTN","SDRPA00",53,0)
 .S SDAMX(1)="The PAIT requested task has been terminated."
"RTN","SDRPA00",54,0)
 .S SDAMX(2)="The previous task #: "_ZTSK_" run #: "_SDPR_" has not been completed."
"RTN","SDRPA00",55,0)
 .I SD1=1 S SDAMX(3)="It is still running.",SDAMX(4)=""
"RTN","SDRPA00",56,0)
 .E  S SD1=2 D
"RTN","SDRPA00",57,0)
 ..S SDAMX(3)="The previous run errored out, not repaired!"
"RTN","SDRPA00",58,0)
 ..S SDAMX(4)="Address a problem and use option SD-PAIT REPAIR to fix the run."
"RTN","SDRPA00",59,0)
 .D ^XMD
"RTN","SDRPA00",60,0)
 S DIC=409.6,DIC(0)="X"
"RTN","SDRPA00",61,0)
 D NOW^%DTC S TODAY=X
"RTN","SDRPA00",62,0)
 K DO D FILE^DICN
"RTN","SDRPA00",63,0)
 S DA=+Y,DIE=DIC,DR="1///"_ZTSK D ^DIE
"RTN","SDRPA00",64,0)
 ;send START message
"RTN","SDRPA00",65,0)
 D STMES
"RTN","SDRPA00",66,0)
 S (SDOUT,SDCNT)=0
"RTN","SDRPA00",67,0)
 K ^TMP("SDDPT",$J)
"RTN","SDRPA00",68,0)
 N CRUNID S CRUNID=$O(^SDWL(409.6,"AD",ZTSK,""))
"RTN","SDRPA00",69,0)
 S RUNDT=$P(^SDWL(409.6,CRUNID,0),"^")
"RTN","SDRPA00",70,0)
 I SDPR=0 S SDPREV=3020831,FIRST=1 ;first run
"RTN","SDRPA00",71,0)
 E  S SDPREV=$P(^SDWL(409.6,SDPR,0),U,4),FIRST=0 ;
"RTN","SDRPA00",72,0)
 N SDFIN,SDPEN,SDF,SDTR S (RUNID,SDFIN,SDPEN,SDTR,SDF)=0
"RTN","SDRPA00",73,0)
 S SDDAM=SDPREV ;creation date
"RTN","SDRPA00",74,0)
 D NOW^%DTC S TODAY=X
"RTN","SDRPA00",75,0)
 F  S SDDAM=$O(^DPT("ASADM",SDDAM)) Q:SDDAM=""  Q:SDDAM=TODAY!SDOUT  D
"RTN","SDRPA00",76,0)
 .N DFN S DFN=0
"RTN","SDRPA00",77,0)
 .F  S DFN=$O(^DPT("ASADM",SDDAM,DFN)) Q:+DFN'=DFN!SDOUT  D
"RTN","SDRPA00",78,0)
 ..N SDADT S SDADT=0 ;appt date/time
"RTN","SDRPA00",79,0)
 ..S SDADT=0
"RTN","SDRPA00",80,0)
 ..F  S SDADT=$O(^DPT("ASADM",SDDAM,DFN,SDADT)) Q:+SDADT'=SDADT!SDOUT  D
"RTN","SDRPA00",81,0)
 ...I SDADT'>3030000 Q  ;only appointment scheduled for 2003 and later; sd/491
"RTN","SDRPA00",82,0)
 ...I SDDAM'=$$GET1^DIQ(2.98,SDADT_","_DFN_",",20,"I") Q  ;compare creation dates
"RTN","SDRPA00",83,0)
 ...; Check for 'stop task' request
"RTN","SDRPA00",84,0)
 ...S SDCNT=SDCNT+1 I SDCNT#500=0 S SDOUT=$$S^%ZTLOAD I SDOUT D  N SDBCID,SDMCID,SDSTOP D SNDS19^SDRPA07(ZTSK,.SDBCID,.SDMCID) S SDSTOP=1 D MSGT^SDRPA04(CRUNID,SDPEN,SDFIN,,SDSTOP) K ^TMP("SDDPT",$J) Q
"RTN","SDRPA00",85,0)
 ....N DA,DIE,DR,SDD,SDLAST D
"RTN","SDRPA00",86,0)
 ....S SDLAST=$O(^SDWL(409.6,CRUNID,1,"B"),-1) S SDD=$P(^SDWL(409.6,CRUNID,1,SDLAST,0),U,7)-1
"RTN","SDRPA00",87,0)
 ....S DA=CRUNID,DIE=409.6,DR="1.2///"_SDD D ^DIE
"RTN","SDRPA00",88,0)
 ...N SDCL,SDSTAT,SDSTTY
"RTN","SDRPA00",89,0)
 ...S SDCL=$$GET1^DIQ(2.98,SDADT_","_DFN_",",.01,"I")
"RTN","SDRPA00",90,0)
 ...Q:SDCL=""  ; If this happens, there's something wrong.
"RTN","SDRPA00",91,0)
 ...;
"RTN","SDRPA00",92,0)
 ...; Check status.
"RTN","SDRPA00",93,0)
 ...; Appoinment made only before Sep 1, 2003
"RTN","SDRPA00",94,0)
 ...; If it is not the first run, send but don't create a pending file
"RTN","SDRPA00",95,0)
 ...; Otherwise add to pending file.
"RTN","SDRPA00",96,0)
 ...D NOW^%DTC N STODAY S STODAY=X
"RTN","SDRPA00",97,0)
 ...S SDSTAT=$$STATUS^SDRPA05(DFN,SDADT,SDCL,STODAY,1)
"RTN","SDRPA00",98,0)
 ...I $P(SDSTAT,"^")=0 Q
"RTN","SDRPA00",99,0)
 ...N SDCLL S SDCLL=$P(SDSTAT,U,6) I SDCLL'="" S SDCL=SDCLL ;assign a new clinic if from matching non count with encounter
"RTN","SDRPA00",100,0)
 ...S SDSTTY=$P(SDSTAT,U,2),SD6A=$P(SDSTAT,U,3),SD8A=$P(SDSTAT,U,4)
"RTN","SDRPA00",101,0)
 ...I SDSTTY="F" Q:'$$GT90DAYS(SDDAM,3030831)  ; pending and final from 09/01/2003, previously 90 days
"RTN","SDRPA00",102,0)
 ...I SDSTTY="F",SD6A="NM",SD8A="NC" Q  ; skip non-count if not matching count and scheduled date already expired
"RTN","SDRPA00",103,0)
 ...N SDCOA,SDMSHA S SDCOA=$P(SDSTAT,U,5) S SDMSHA=$P(SDSTAT,U)
"RTN","SDRPA00",104,0)
 ...N SDCE Q:'$$DPT^SDRPA08(DFN,.SDCE)  ; Create demographic node of ^TMP file. Quit if this failed.
"RTN","SDRPA00",105,0)
 ...N DIC,DA,X,SDRET D
"RTN","SDRPA00",106,0)
 ....N SDRET S SDRET=$S(SDSTTY="F":"N",1:"Y")
"RTN","SDRPA00",107,0)
 ....S DIC="^SDWL(409.6,"_CRUNID_",1,",DA(1)=CRUNID,DIC("P")=409.69,DIC(0)="X"
"RTN","SDRPA00",108,0)
 ....K DO S X=DFN D FILE^DICN
"RTN","SDRPA00",109,0)
 ....S DA=+Y,DIE=DIC,DR="1///"_SDADT_";4///"_SDRET_";5///"_SD6A_";6///"_SDDAM_";8///"_SD8A_";9////"_SDCL D ^DIE
"RTN","SDRPA00",110,0)
 ....Q
"RTN","SDRPA00",111,0)
 ...D APPT^SDRPA08(DFN,SDADT,$$DTCONV^SDRPA08(SDDAM),SDCL,SDSTAT)
"RTN","SDRPA00",112,0)
 ...S SDFF=$P(SDSTAT,"^",4) D STAT(SDSTTY,SDFF,.SDFIN,.SDPEN,.SDF)
"RTN","SDRPA00",113,0)
 ...S SDTR=SDTR+1 I SDTR=5000 D SNDS19^SDRPA07(ZTSK,.SDBCID,.SDMCID) K ^TMP("SDDPT",$J) S SDTR=0
"RTN","SDRPA00",114,0)
 Q:SDOUT
"RTN","SDRPA00",115,0)
 N SDD S SDD=$O(^DPT("ASADM",TODAY),-1) ;enter the last scanned day
"RTN","SDRPA00",116,0)
 S DA=CRUNID,DIE=409.6,DR="1.2///"_SDD D ^DIE
"RTN","SDRPA00",117,0)
 ; scan the previous runs
"RTN","SDRPA00",118,0)
 S RUNID=0
"RTN","SDRPA00",119,0)
 F  S RUNID=$O(^SDWL(409.6,RUNID)) Q:+RUNID=CRUNID!SDOUT  D
"RTN","SDRPA00",120,0)
 .N APPTID,SDADT,REC
"RTN","SDRPA00",121,0)
 .S APPTID=0
"RTN","SDRPA00",122,0)
 .;scanning only appointments that were sent as 'pending'
"RTN","SDRPA00",123,0)
 .F  S APPTID=$O(^SDWL(409.6,"AE","Y",RUNID,APPTID)) Q:APPTID=""!SDOUT  S REC=$G(^SDWL(409.6,RUNID,1,APPTID,0)) D
"RTN","SDRPA00",124,0)
 ..IF REC="" K ^SDWL(409.6,"AE","Y",RUNID,APPTID) Q  ;anticipate
"RTN","SDRPA00",125,0)
 ..S DFN=$P(REC,"^"),SDADT=$P(REC,"^",2)
"RTN","SDRPA00",126,0)
 ..;evaluate SDADT - appt date/time for possible removal from sending
"RTN","SDRPA00",127,0)
 ..I SDADT'>3030000 N DIK S DIK="^SDWL(409.6,"_RUNID_",1,",DA(1)=RUNID,DA=APPTID D ^DIK ;delete entry; not to be sent; sd/491
"RTN","SDRPA00",128,0)
 ..; Check for 'stop task'
"RTN","SDRPA00",129,0)
 ..S SDCNT=SDCNT+1 I SDCNT#500=0 S SDOUT=$$S^%ZTLOAD I SDOUT N SDBCID,SDMCID,SDSTOP D SNDS19^SDRPA07(ZTSK,.SDBCID,.SDMCID) S SDSTOP=1 D MSGT^SDRPA04(CRUNID,SDPEN,SDFIN,,SDSTOP) K ^TMP("SDDPT",$J) Q  ;
"RTN","SDRPA00",130,0)
 ..N SDCL,SDCLO,SDCE,SDSTAT,SDREJ,SDDAM,SDDAMO
"RTN","SDRPA00",131,0)
 ..S SDCLO=$P(REC,"^",10)
"RTN","SDRPA00",132,0)
 ..S SDREJ=$P(REC,"^",8),SDDAMO=$P(REC,"^",7) ;esw
"RTN","SDRPA00",133,0)
 ..I SDDAMO="" D
"RTN","SDRPA00",134,0)
 ...N SDD S SDD=9999999 F  S SDD=$O(^DPT("ASADM",SDD),-1) Q:SDD'>0  I $D(^DPT("ASADM",SDD,DFN,SDADT)) S SDDAMO=SDD Q
"RTN","SDRPA00",135,0)
 ..Q:SDDAMO=""  ;cannot determine what was original creation date
"RTN","SDRPA00",136,0)
 ..;evaluate if the same creation date
"RTN","SDRPA00",137,0)
 ..S SDDAM=$$GET1^DIQ(2.98,SDADT_","_DFN_",",20,"I")
"RTN","SDRPA00",138,0)
 ..S SDCL=$$GET1^DIQ(2.98,SDADT_","_DFN_",",.01,"I")
"RTN","SDRPA00",139,0)
 ..Q:SDCL=""  ;
"RTN","SDRPA00",140,0)
 ..I SDCLO="" S SDCLO=SDCL
"RTN","SDRPA00",141,0)
 ..I SDDAM'?7N!(SDDAM'>3020831) S SDDAM=SDDAMO ; need to finalize the previously sent
"RTN","SDRPA00",142,0)
 ..; Check status. If it is a termination, continue.
"RTN","SDRPA00",143,0)
 ..Q:$D(^TMP("SDDPT",$J,DFN,SDADT))  ; overridden to be process next time
"RTN","SDRPA00",144,0)
 ..;anothercross reference entry will be created; do not need to quit
"RTN","SDRPA00",145,0)
 ..;Q:$D(^SDWL(409.6,"AC",DFN,SDADT,+$G(CRUNID)))  ;see above
"RTN","SDRPA00",146,0)
 ..S SDSTAT=""
"RTN","SDRPA00",147,0)
 ..I SDDAM'=SDDAMO!(SDCL'=SDCLO) D
"RTN","SDRPA00",148,0)
 ...; create CT status; the current SDADT has different creation date
"RTN","SDRPA00",149,0)
 ...S SDSTAT="S15"_U_"F"_U_"CT"_U_U_U_U_U S SDDAM=SDDAMO,SDCL=SDCLO
"RTN","SDRPA00",150,0)
 ..I SDSTAT="" D NOW^%DTC N SDTODAY S SDTODAY=X S SDSTAT=$$STATUS^SDRPA05(DFN,SDADT,SDCL,SDTODAY,0)
"RTN","SDRPA00",151,0)
 ..I $P(SDSTAT,"^")=0 Q
"RTN","SDRPA00",152,0)
 ..N SDCOA,SDMSHA S SDCOA=$P(SDSTAT,U,5) S SDMSHA=$P(SDSTAT,U),SD6A=$P(SDSTAT,U,3),SD8A=$P(SDSTAT,U,4)
"RTN","SDRPA00",153,0)
 ..N SDCLL S SDCLL=$P(SDSTAT,U,6) I SDCLL'="" S SDCL=SDCLL
"RTN","SDRPA00",154,0)
 ..S SDSTTY=$P(SDSTAT,U,2)
"RTN","SDRPA00",155,0)
 ..I SDSTTY="P"&(SDREJ="") Q  ;do not send in pending status if not rejected ;esw
"RTN","SDRPA00",156,0)
 ..N SDCE Q:'$$DPT^SDRPA08(DFN,.SDCE)  ; Create demographic node of ^TMP file. Quit if this failed.
"RTN","SDRPA00",157,0)
 ..N DIC,DA,X D
"RTN","SDRPA00",158,0)
 ...N SDRET S SDRET=$S(SDSTTY="F":"N",1:"Y")
"RTN","SDRPA00",159,0)
 ...S DIC="^SDWL(409.6,"_CRUNID_",1,",DA(1)=CRUNID,DIC("P")=409.69,DIC(0)="X"
"RTN","SDRPA00",160,0)
 ...K DO S X=DFN D FILE^DICN
"RTN","SDRPA00",161,0)
 ...S DA=+Y,DIE=DIC,DA=+Y,DR="1///"_SDADT_";4///"_SDRET_";5///"_SD6A_";6///"_SDDAM_";8///"_SD8A_";9////"_SDCL D ^DIE
"RTN","SDRPA00",162,0)
 ..N DIC,DA D
"RTN","SDRPA00",163,0)
 ...; not rejected can be sent only as 'S'- sent as final
"RTN","SDRPA00",164,0)
 ...N SDRET S SDRET=$S(SDREJ'="":"R",1:"S") ; indicates that it was: R - sent as rejected, S - sent as final
"RTN","SDRPA00",165,0)
 ...S DIC="^SDWL(409.6,"_RUNID_",1,",DA(1)=RUNID
"RTN","SDRPA00",166,0)
 ...S DA=APPTID,DIE=DIC,DR="4////"_SDRET D ^DIE
"RTN","SDRPA00",167,0)
 ..D APPT^SDRPA08(DFN,SDADT,$$DTCONV^SDRPA08(SDDAM),SDCL,SDSTAT)
"RTN","SDRPA00",168,0)
 ..S SDFF=$P(SDSTAT,"^",4) D STAT(SDSTTY,SDFF,.SDFIN,.SDPEN,.SDF)
"RTN","SDRPA00",169,0)
 ..S SDTR=SDTR+1 I SDTR=5000 D SNDS19^SDRPA07(ZTSK,.SDBCID,.SDMCID) K ^TMP("SDDPT",$J) S SDTR=0
"RTN","SDRPA00",170,0)
 .Q
"RTN","SDRPA00",171,0)
 Q:SDOUT
"RTN","SDRPA00",172,0)
 I $O(^TMP("SDDPT",$J,"")) D SNDS19^SDRPA07(ZTSK,.SDBCID,.SDMCID)
"RTN","SDRPA00",173,0)
 K ^TMP("SDDPT",$J)
"RTN","SDRPA00",174,0)
 D MSGT^SDRPA04(CRUNID,SDPEN,SDFIN)
"RTN","SDRPA00",175,0)
 Q
"RTN","SDRPA00",176,0)
STMES ;generate start message
"RTN","SDRPA00",177,0)
 N SDS,SD870,SD87
"RTN","SDRPA00",178,0)
 S SD870=$O(^HLCS(870,"B","SD-PAIT",""))
"RTN","SDRPA00",179,0)
 N ARRAY D GETS^DIQ(870,SD870_",",4,"I","ARRAY")
"RTN","SDRPA00",180,0)
 N SD87 S SD87=SD870_","
"RTN","SDRPA00",181,0)
 S SDSTAT=ARRAY(870,SD87,4,"I")
"RTN","SDRPA00",182,0)
 D NOW^%DTC
"RTN","SDRPA00",183,0)
 N SDDT,SDST S SDDT=%
"RTN","SDRPA00",184,0)
 S SDST=$P($$SITE^VASITE(),"^",3)
"RTN","SDRPA00",185,0)
 N SDAMX,XMSUB,CMY,XMTEXT,XMDUZ
"RTN","SDRPA00",186,0)
 S XMSUB=$G(SDST)_" - PAIT START JOB"
"RTN","SDRPA00",187,0)
 S XMY("G.SD-PAIT")=""
"RTN","SDRPA00",188,0)
 S XMY("S.SD-PAIT-SERVER@FORUM.DOMAIN.EXT")=""
"RTN","SDRPA00",189,0)
 S XMTEXT="SDAMX("
"RTN","SDRPA00",190,0)
 S XMDUZ="POSTMASTER"
"RTN","SDRPA00",191,0)
 S SDAMX(1)="The PAIT job has started - TASK #: "_ZTSK
"RTN","SDRPA00",192,0)
 S SDAMX(2)="Site   Started       SD-PAIT status    Task #"
"RTN","SDRPA00",193,0)
 S SDAMX(3)=SDST_"  |"_SDDT_" |"_SDSTAT_"    |"_ZTSK
"RTN","SDRPA00",194,0)
 ;
"RTN","SDRPA00",195,0)
 I SDSTAT="Shutdown" S XMY("VHACIONHD@DOMAIN.EXT")="" D
"RTN","SDRPA00",196,0)
 .S SDAMX(4)=" Please start a REMEDY ticket for station "_SDST
"RTN","SDRPA00",197,0)
 .S SDAMX(5)="SD-PAIT Logical Link has to be started."
"RTN","SDRPA00",198,0)
 .S SDAMX(6)="Refer the ticket to Scheduling PAIT."
"RTN","SDRPA00",199,0)
 .S SDAMX(7)=""
"RTN","SDRPA00",200,0)
 D ^XMD
"RTN","SDRPA00",201,0)
 Q
"RTN","SDRPA00",202,0)
 ;
"RTN","SDRPA00",203,0)
GT90DAYS(X1,X2) ; Date is older than Sep 1st 2003, see specs.
"RTN","SDRPA00",204,0)
 ; X1 - creation date. More efficient to have it set at the top instead of every time this subroutine is called.
"RTN","SDRPA00",205,0)
 ; X2 - comparison date, now sent as Sep 1 2003, both in Vista format cyymmdd
"RTN","SDRPA00",206,0)
 D ^%DTC
"RTN","SDRPA00",207,0)
 Q X>0  ;
"RTN","SDRPA00",208,0)
STAT(SDSTTY,SDFF,SDFIN,SDPEN,SDF) ;summarize pending and finals
"RTN","SDRPA00",209,0)
 I SDSTTY="F" S SDFIN=SDFIN+1 Q
"RTN","SDRPA00",210,0)
 I SDSTTY="P" S SDPEN=SDPEN+1 I SDFF="F" S SDF=SDF+1
"RTN","SDRPA00",211,0)
 Q
"RTN","SDRPA04")
0^3^B43965670^B41686935
"RTN","SDRPA04",1,0)
SDRPA04 ;BP-OIFO/ESW - SDRPA00 continuation PAIT - REPAIR ;11/2/04 11:47am  ; 5/31/07 5:29pm
"RTN","SDRPA04",2,0)
 ;;5.3;Scheduling;**376,491,634,639**;Aug 13, 1993;Build 7
"RTN","SDRPA04",3,0)
 ;SD/491 - not to error out while repairing with acks having received
"RTN","SDRPA04",4,0)
 ;SD*639 Disable SD-PAIT REPAIR option
"RTN","SDRPA04",5,0)
 Q
"RTN","SDRPA04",6,0)
MSGT(CRUNID,SDPEN,SDFIN,SDTOT,SDSTOP) ;create completion messages
"RTN","SDRPA04",7,0)
 ;CRUNID - current run number
"RTN","SDRPA04",8,0)
 ;SDPEN  - pendings
"RTN","SDRPA04",9,0)
 ;SDFIN  - finals
"RTN","SDRPA04",10,0)
 ;SDTOT  - total
"RTN","SDRPA04",11,0)
 ;SDSTOP - task stop flag
"RTN","SDRPA04",12,0)
 N SDB,SDTRF
"RTN","SDRPA04",13,0)
 I '$D(SDTOT) S SDTOT=SDPEN+SDFIN
"RTN","SDRPA04",14,0)
 N SFF S SFF=0
"RTN","SDRPA04",15,0)
 I +SDTOT=0 S (SDPEN,SDFIN)=0,SFF=1
"RTN","SDRPA04",16,0)
 I '$D(SDPEN),'$D(SDFIN) S (SDPEN,SDFIN)="undetermined",SFF=1
"RTN","SDRPA04",17,0)
 N SDB,SDTRF
"RTN","SDRPA04",18,0)
 S SDB=SDTOT\5000 I SDTOT-(5000*SDB)>0 S SDB=SDB+1 ;# of batches
"RTN","SDRPA04",19,0)
 N NOW S NOW=$$NOW^XLFDT S SDTRF=$$FMTE^XLFDT(NOW,2),SDTRF=$P(SDTRF,":",1,2)
"RTN","SDRPA04",20,0)
 N DA,DIE,DR D
"RTN","SDRPA04",21,0)
 .S DA=CRUNID,DIE=409.6,DR="1.3///"_SDTOT_";1.4///"_SDB_";1.5///"_NOW D ^DIE
"RTN","SDRPA04",22,0)
 D CLEAN(CRUNID)
"RTN","SDRPA04",23,0)
 N SDS,SDSTAT,SDIP,SDAR,SDAP,SDMT,SDMS,SD870
"RTN","SDRPA04",24,0)
 ;SDS - STATION #
"RTN","SDRPA04",25,0)
 ;SDSTAT - SD-PAIT STATUS
"RTN","SDRPA04",26,0)
 ;SDIP   - IP ADDRESS
"RTN","SDRPA04",27,0)
 ;SDAR   - COMMIT ACK RECEIVED
"RTN","SDRPA04",28,0)
 ;SDAP   - COMMIT ACK PROCESSED
"RTN","SDRPA04",29,0)
 ;SDMT   - MESSAGES (BATCHES) TO SEND
"RTN","SDRPA04",30,0)
 ;SDMS   - MESSAGES (BATCHES) SENT
"RTN","SDRPA04",31,0)
 S SD870=$O(^HLCS(870,"B","SD-PAIT",""))
"RTN","SDRPA04",32,0)
 N ARRAY D GETS^DIQ(870,SD870_",","4;5;6;7;8;400.01","I","ARRAY")
"RTN","SDRPA04",33,0)
 N SD87 S SD87=SD870_","
"RTN","SDRPA04",34,0)
 S SDSTAT=ARRAY(870,SD87,4,"I")
"RTN","SDRPA04",35,0)
 S SDAR=ARRAY(870,SD87,5,"I")
"RTN","SDRPA04",36,0)
 S SDAP=ARRAY(870,SD87,6,"I")
"RTN","SDRPA04",37,0)
 S SDMS=ARRAY(870,SD87,7,"I")
"RTN","SDRPA04",38,0)
 S SDMT=ARRAY(870,SD87,8,"I")
"RTN","SDRPA04",39,0)
 S SDIP=ARRAY(870,SD87,400.01,"I")
"RTN","SDRPA04",40,0)
 S SDS=$P($$SITE^VASITE(),"^",3)
"RTN","SDRPA04",41,0)
 ;S SDS=$E($O(^SDWL(409.6,"AMSG","")),1,3)
"RTN","SDRPA04",42,0)
 N SDBT,STSK,SDSL ; Starting and Last scanned date
"RTN","SDRPA04",43,0)
 S SDBT=$P(^SDWL(409.6,CRUNID,0),U),SDSL=$P(^SDWL(409.6,CRUNID,0),U,4)
"RTN","SDRPA04",44,0)
 S STSK=$P(^SDWL(409.6,CRUNID,0),U,2)
"RTN","SDRPA04",45,0)
 S SDBT=$$FMTE^XLFDT(SDBT,2),SDSL=$$FMTE^XLFDT(SDSL,2)
"RTN","SDRPA04",46,0)
MSG ;send mail message
"RTN","SDRPA04",47,0)
 N SDAMX,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDRPA04",48,0)
 S XMSUB=$G(SDS)_" - PAIT BACKGROUND JOB"
"RTN","SDRPA04",49,0)
 S XMY("G.SD-PAIT")=""
"RTN","SDRPA04",50,0)
 S XMY("S.SD-PAIT-SERVER@FORUM.DOMAIN.EXT")=""
"RTN","SDRPA04",51,0)
 S XMTEXT="SDAMX("
"RTN","SDRPA04",52,0)
 S DUZ=""
"RTN","SDRPA04",53,0)
 S XMDUZ="POSTMASTER"
"RTN","SDRPA04",54,0)
 S SDAMX(1)=""
"RTN","SDRPA04",55,0)
 S SDAMX(2)="The PAIT job has completed - TASK #: "_STSK_" Log #: "_CRUNID_" on "_SDTRF
"RTN","SDRPA04",56,0)
 S SDAMX(3)="Started: "_SDBT_"                        Last Scanned: "_SDSL
"RTN","SDRPA04",57,0)
 S SDAMX(4)="Pending appointments: "_$J(SDPEN,10)
"RTN","SDRPA04",58,0)
 S SDAMX(5)="Final appointments:   "_$J(SDFIN,10)
"RTN","SDRPA04",59,0)
 S SDAMX(6)="                       ----------"
"RTN","SDRPA04",60,0)
 S SDAMX(7)="Total appointments:   "_$J(SDTOT,10)_"   Number of batches: "_SDB
"RTN","SDRPA04",61,0)
 S SDAMX(8)=""
"RTN","SDRPA04",62,0)
 S SDAMX(9)="Fac Log Bch Appt #  Date finished   IP Address  "
"RTN","SDRPA04",63,0)
 S SDAMX(10)="Gen  Sent Com R Com P  Status"
"RTN","SDRPA04",64,0)
 S SDAMX(11)="------------------------------------------------------------------------------"
"RTN","SDRPA04",65,0)
 S SDAMX(12)=SDS_"|"_$J(CRUNID,3)_"|"_$J(SDB,3)_"|"_$J(SDTOT,7)_"|"_SDTRF_"|"_$E(SDIP,1,39)_"|"
"RTN","SDRPA04",66,0)
 S SDAMX(13)=$J(SDMT,4)_"|"_$J(SDMS,4)_"|"_$J(SDAR,4)_"|"_$J(SDAP,4)_"| "_SDSTAT
"RTN","SDRPA04",67,0)
 S SDAMX(14)=""
"RTN","SDRPA04",68,0)
 I $G(SDSTOP) S XMY("VHACIONHD@DOMAIN.EXT")="" D  D ^XMD Q
"RTN","SDRPA04",69,0)
 .S SDAMX(15)="WARNING: TASK STOPPED BY USER, NEEDS TO BE RESTARTED."
"RTN","SDRPA04",70,0)
 .S SDAMX(16)="Initiate a Remedy ticket TO FOLLOW UP."
"RTN","SDRPA04",71,0)
 I 'SFF I SDMT>0!(SDB=0) D  D ^XMD K ^TMP("SDDPT",$J) Q
"RTN","SDRPA04",72,0)
 .I (SDMT-SDMS)=0 D  Q
"RTN","SDRPA04",73,0)
 ..S SDAMX(15)="SUCCESS: Transmission completed."
"RTN","SDRPA04",74,0)
 .I (SDMT-SDMS)<SDB!(SDB=1&(SDMT-SDMS)'<SDB)&(SDSTAT'["Shutdown") D  Q
"RTN","SDRPA04",75,0)
 ..S SDAMX(15)="WARNING: "_(SDMT-SDMS)_" out of "_SDB_" batches still have to be transmitted,"
"RTN","SDRPA04",76,0)
 ..S SDAMX(16)="please verify with the HL7 System Monitor."
"RTN","SDRPA04",77,0)
 .S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",78,0)
 .I SDB>0 I (SDMT-SDMS)'<SDB D  Q
"RTN","SDRPA04",79,0)
 ..S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",80,0)
 ..I SDSTAT["Shutdown" D
"RTN","SDRPA04",81,0)
 ...S SDAMX(15)="SD-PAIT Logical Link has to be started, initiate Remedy ticket for Scheduling PAIT."
"RTN","SDRPA04",82,0)
 ..E  S SDAMX(15)="Initiate a Remedy ticket for Interface Engine - communication problem."
"RTN","SDRPA04",83,0)
 I SFF D  D ^XMD K ^TMP("SDDPT",$J) Q
"RTN","SDRPA04",84,0)
 .S SDAMX(15)="WARNING!!!: Transmission of run#: "_CRUNID_" has been repaired, you may restart."
"RTN","SDRPA04",85,0)
 .I SDB>0 I (SDMT-SDMS)'<SDB D
"RTN","SDRPA04",86,0)
 ..S XMY("VHACIONHD@DOMAIN.EXT")=""
"RTN","SDRPA04",87,0)
 ..I SDSTAT["Shutdown" D  Q
"RTN","SDRPA04",88,0)
 ...S SDAMX(16)="SD-PAIT Logical Link has to be started, initiate Remedy ticket for Scheduling PAIT."
"RTN","SDRPA04",89,0)
 ..S SDAMX(16)="Initiate a Remedy ticket for Interface Engine - communication problem."
"RTN","SDRPA04",90,0)
 Q
"RTN","SDRPA04",91,0)
CLEAN(CRUNID) ;housekeeping
"RTN","SDRPA04",92,0)
 ;clean up batches previous to current one by checking for "AE",("S" or "R") xref and
"RTN","SDRPA04",93,0)
 ;deleting if entry in xref exists
"RTN","SDRPA04",94,0)
 ;RUN  :  run #           (ien of multiple entry)
"RTN","SDRPA04",95,0)
 ;V1   :  previous run #  (ien of multiple entry)  
"RTN","SDRPA04",96,0)
 ;V2   :  ien           (ien in multiple)
"RTN","SDRPA04",97,0)
 N V1,V2,V3,ZNODE,DIK
"RTN","SDRPA04",98,0)
 S V1=CRUNID F  S V1=$O(^SDWL(409.6,V1),-1) Q:'V1  D
"RTN","SDRPA04",99,0)
 .F V3="R","S" S V2=0 F  S V2=$O(^SDWL(409.6,"AE",V3,V1,V2)) Q:'V2  D
"RTN","SDRPA04",100,0)
 ..S ZNODE=$G(^SDWL(409.6,V1,1,V2,0))
"RTN","SDRPA04",101,0)
 ..S ^XTMP("SDRPA-"_$P(ZNODE,"^",3),0)=$$HTFM^XLFDT($H+7,1)_U_$$HTFM^XLFDT($H,1)
"RTN","SDRPA04",102,0)
 ..S DIK="^SDWL(409.6,"_V1_",1,"
"RTN","SDRPA04",103,0)
 ..S DA(1)=V1,DA=V2 D ^DIK
"RTN","SDRPA04",104,0)
 ..S ^XTMP("SDRPA-"_$P(ZNODE,"^",3),"CLEAN",+$P(ZNODE,"^",4),0)=ZNODE ;diagnostics
"RTN","SDRPA04",105,0)
 Q
"RTN","SDRPA04",106,0)
RPAIT(RUN) ;
"RTN","SDRPA04",107,0)
 ; SD*639 Disable SD-PAIT REPAIR option
"RTN","SDRPA04",108,0)
 D BMES^XPDUTL("This SD-PAIT REPAIR option has been placed Out of Order")
"RTN","SDRPA04",109,0)
 D MES^XPDUTL("by SD*5.3*639.")
"RTN","SDRPA04",110,0)
 D MES^XPDUTL("")
"RTN","SDRPA04",111,0)
 Q
"RTN","SDRPA04",112,0)
 ;
"RTN","SDRPA04",113,0)
 ;RUN - run number - entry ^SDWL(409.6,RUN,0) to be repaired
"RTN","SDRPA04",114,0)
 Q:+$G(RUN)'>1
"RTN","SDRPA04",115,0)
 W !,"The repairing in progress...",!
"RTN","SDRPA04",116,0)
 N SDE,SDEB,SDFE,SDLSD,SDRCNT,ZTSK
"RTN","SDRPA04",117,0)
 S SDE=$G(^SDWL(409.6,RUN,0)) Q:SDE=""
"RTN","SDRPA04",118,0)
 S ZTSK=$P(SDE,"^",2) D STAT^%ZTLOAD I ZTSK(1)=1!(ZTSK(1)=2) W !,"Task "_ZTSK_"is still active!" Q
"RTN","SDRPA04",119,0)
 S SDEB=+$P(SDE,"^",3) ; last batch # submitted to HL7
"RTN","SDRPA04",120,0)
 S SDRCNT=$O(^SDWL(409.6,RUN,1,999999999),-1) ;last entry
"RTN","SDRPA04",121,0)
 I SDEB=0 S SDFE=0 S $P(^SDWL(409.6,RUN,0),U,4)=$P(^SDWL(409.6,RUN-1,0),U,4)
"RTN","SDRPA04",122,0)
 I +SDEB>0 D
"RTN","SDRPA04",123,0)
 .S SDFE=SDRCNT+1 F  S SDFE=$O(^SDWL(409.6,RUN,1,SDFE),-1) I $P(^SDWL(409.6,RUN,1,SDFE,0),U,3)'>SDEB&($P(^SDWL(409.6,RUN,1,SDFE,0),U,3)'="") Q  ; SD/491
"RTN","SDRPA04",124,0)
 .N SDLSD1 S SDLSD1=$P(^SDWL(409.6,RUN,1,SDFE,0),U,7) ;retrieve the last used creation date of HL7 created 
"RTN","SDRPA04",125,0)
 .N SDLSD2 S SDLSD2=$P($G(^SDWL(409.6,RUN,1,SDFE+1,0)),U,7)
"RTN","SDRPA04",126,0)
 .S SDLSD=$P(SDE,U,4) ; last scanned date
"RTN","SDRPA04",127,0)
 .I SDLSD="" D
"RTN","SDRPA04",128,0)
 ..S $P(^SDWL(409.6,RUN,0),U,4)=$S(SDLSD2>SDLSD1:SDLSD1,1:SDLSD1-1)
"RTN","SDRPA04",129,0)
 .E  S $P(^SDWL(409.6,RUN,0),U,4)=SDLSD-1
"RTN","SDRPA04",130,0)
 N SDS,DIK F SDS=SDFE+1:1:SDRCNT I $D(^SDWL(409.6,RUN,1,SDS,0)) D EVAL(RUN,SDS) S DIK="^SDWL(409.6,"_RUN_",1,",DA(1)=RUN,DA=SDS D ^DIK
"RTN","SDRPA04",131,0)
 S SDB=+$P($G(^SDWL(409.6,RUN,2,0)),U,3)
"RTN","SDRPA04",132,0)
 S NOW=$$NOW^XLFDT,SDFE=5000*SDB
"RTN","SDRPA04",133,0)
 S $P(^SDWL(409.6,RUN,0),U,5)=SDFE
"RTN","SDRPA04",134,0)
 S $P(^SDWL(409.6,RUN,0),U,6)=SDB
"RTN","SDRPA04",135,0)
 S $P(^SDWL(409.6,RUN,0),U,7)=NOW
"RTN","SDRPA04",136,0)
 D MSGT(RUN,,,SDFE)
"RTN","SDRPA04",137,0)
 W !!,"The last run number has been repaired, you may ONE TIME QUEUE the next one.",!
"RTN","SDRPA04",138,0)
 Q
"RTN","SDRPA04",139,0)
EVAL(RUN,SDS) ;
"RTN","SDRPA04",140,0)
 ;evaluate if to update any 'S' or 'R' Retention Flags for
"RTN","SDRPA04",141,0)
 ;the previous entry if exists.
"RTN","SDRPA04",142,0)
 N SDSTR,DFN,SDDT S SDSTR=^SDWL(409.6,RUN,1,SDS,0)
"RTN","SDRPA04",143,0)
 S DFN=+SDSTR,SDDT=$P(SDSTR,"^",2)
"RTN","SDRPA04",144,0)
 Q:SDDT=""
"RTN","SDRPA04",145,0)
 ;find a prior entry SDRUN
"RTN","SDRPA04",146,0)
 N SDRUN S SDRUN=$O(^SDWL(409.6,"AC",DFN,SDDT,RUN),-1) Q:SDRUN=""
"RTN","SDRPA04",147,0)
 N SDSQ S SDSQ=$O(^SDWL(409.6,"AC",DFN,SDDT,SDRUN,""))
"RTN","SDRPA04",148,0)
 N SDSTRP S SDSTRP=^SDWL(409.6,SDRUN,1,SDSQ,0)
"RTN","SDRPA04",149,0)
 N SDRET S SDRET=$P(SDSTRP,"^",5)
"RTN","SDRPA04",150,0)
 I SDRET="S"!(SDRET="R") N DIC D
"RTN","SDRPA04",151,0)
 .S SDRET="Y",DIC="^SDWL(409.6,"_SDRUN_",1,",DA(1)=SDRUN,DA=SDSQ,DIE=DIC,DR="4///"_SDRET D ^DIE
"RTN","SDRPA04",152,0)
 Q
"RTN","SDRPA09")
0^2^B7507225^B6442115
"RTN","SDRPA09",1,0)
SDRPA09 ;BP-OIFO/SWO,ESW - rejection utility ;12/16/03 8:25am [2/19/04 5:24pm]
"RTN","SDRPA09",2,0)
 ;;5.3;Scheduling;**333,639**;Aug 13, 1993;Build 7
"RTN","SDRPA09",3,0)
 ;Rejection processing of all batches from the first run
"RTN","SDRPA09",4,0)
 ;
"RTN","SDRPA09",5,0)
 ;
"RTN","SDRPA09",6,0)
SELECT ;Select Batch Control Id  for the rejection process
"RTN","SDRPA09",7,0)
 ; SD*639 Disable Manual Batch Reject option
"RTN","SDRPA09",8,0)
 D BMES^XPDUTL("This Manual Batch Reject option has been placed Out of Order")
"RTN","SDRPA09",9,0)
 D MES^XPDUTL("by SD*5.3*639.")
"RTN","SDRPA09",10,0)
 D MES^XPDUTL("")
"RTN","SDRPA09",11,0)
 Q
"RTN","SDRPA09",12,0)
 ;
"RTN","SDRPA09",13,0)
 N SDPT,SDAR,DIC,Y,SDBM,SDBS,SDOUT S SDPT=0,SDOUT=1 N % S %=0 F  Q:(%=1!(SDOUT=0))  S DIC="409.6",DIC(0)="QEAMZ",DIC("A")="Select running date:" D ^DIC Q:Y<1  S SDPT=+Y D  Q:SDOUT=0
"RTN","SDRPA09",14,0)
 .S SDPT=+Y
"RTN","SDRPA09",15,0)
 .I SDPT>0 W !,"Correct Running Date? " S %=1 D YN^DICN D:(%=1)  Q:Y<1
"RTN","SDRPA09",16,0)
 ..N DA S DIR(0)="409.7,.01" F  D ^DIR S SDB=+Y Q:'SDB  D 
"RTN","SDRPA09",17,0)
 ...I $D(^SDWL(409.6,SDPT,2,"B",SDB)) S SDBS=$O(^SDWL(409.6,SDPT,2,"B",SDB,"")) D  Q
"RTN","SDRPA09",18,0)
 ....I $P(^SDWL(409.6,SDPT,2,SDBS,0),"^",5)'="" W !,"Batch already Acknowledged!" Q
"RTN","SDRPA09",19,0)
 ....S SDBM=$P(^SDWL(409.6,SDPT,2,SDBS,0),"^",3),SDAR(SDBM)=SDB
"RTN","SDRPA09",20,0)
 ...I '$D(^SDWL(409.6,SDPT,2,"B",SDB)) W !,"Non existing batch control ID from this run!" Q
"RTN","SDRPA09",21,0)
 ..I '$O(SDAR("")) W !,"No Batches Selected, OK to quit? " S %=1 D YN^DICN S SDOUT=0 Q
"RTN","SDRPA09",22,0)
 Q:'$D(SDAR)
"RTN","SDRPA09",23,0)
QUE W !!,"This job has been tasked"
"RTN","SDRPA09",24,0)
 N ZTSAVE,IOP S IOP=0 F X="SDPT","SDAR(","IOP" S ZTSAVE(X)=""
"RTN","SDRPA09",25,0)
 ; IA #1519
"RTN","SDRPA09",26,0)
 W ! D EN^XUTMDEVQ("STRT^SDRPA09","Whole Batch Rejection Report",.ZTSAVE) S SDOUT=0 Q
"RTN","SDRPA09",27,0)
 Q
"RTN","SDRPA09",28,0)
STRT ;Tasked Entry
"RTN","SDRPA09",29,0)
 N BATCHID0,SDB,V4
"RTN","SDRPA09",30,0)
 S SDB="" F  S SDB=$O(SDAR(SDB)) Q:SDB=""  S BATCHID0=SDAR(SDB) D AR(SDB) D  D MSG^SDRPA06(BATCHID0,3,SDPT,SDB)
"RTN","SDRPA09",31,0)
 .S V4=$O(^SDWL(409.6,SDPT,2,"B",BATCHID0,""))
"RTN","SDRPA09",32,0)
 .S DA=V4,DA(1)=SDPT,DIE="^SDWL(409.6,"_SDPT_",2,",DR=".04///"_$$NOW^XLFDT_";.05///"_"MR"
"RTN","SDRPA09",33,0)
 .D ^DIE K DIE
"RTN","SDRPA09",34,0)
 Q
"RTN","SDRPA09",35,0)
AR(BATCH) ;whole batch rejection
"RTN","SDRPA09",36,0)
 ;BATCH  :  originating batch number
"RTN","SDRPA09",37,0)
 ;V1     :  sequence #  (individual message number in batch)
"RTN","SDRPA09",38,0)
 ;V2     :  run #       (ien of multiple entry)
"RTN","SDRPA09",39,0)
 ;V3     :  ien         (ien in multiple)
"RTN","SDRPA09",40,0)
 N DA,DIE,DR,V1,V2,V3,ZNODE
"RTN","SDRPA09",41,0)
 S V1=0
"RTN","SDRPA09",42,0)
 F  S V1=$O(^SDWL(409.6,"AMSG",BATCH,V1)) Q:'V1  D
"RTN","SDRPA09",43,0)
 . S V2=$O(^SDWL(409.6,"AMSG",BATCH,V1,"")) Q:'V2
"RTN","SDRPA09",44,0)
 . S V3=0 F  S V3=$O(^SDWL(409.6,"AMSG",BATCH,V1,V2,V3)) Q:'V3  D
"RTN","SDRPA09",45,0)
 .. S ZNODE=$G(^SDWL(409.6,V2,1,V3,0)) Q:ZNODE=""
"RTN","SDRPA09",46,0)
 .. ;4TH PIECE IS MESSAGE NUMBER
"RTN","SDRPA09",47,0)
 .. S DA=V3,DA(1)=V2,DIE="^SDWL(409.6,"_V2_",1,"
"RTN","SDRPA09",48,0)
 .. S DR="7///R" D ^DIE
"RTN","SDRPA09",49,0)
 .. I $D(^SDWL(409.6,"AE","Y",V2,V3)) Q
"RTN","SDRPA09",50,0)
 .. I $D(^SDWL(409.6,"AE","N",V2,V3)) D
"RTN","SDRPA09",51,0)
 ... S DR="4///Y" D ^DIE
"RTN","SDRPA09",52,0)
 Q
"RTN","SDRPSTOP")
0^^B10384441^n/a
"RTN","SDRPSTOP",1,0)
SDRPSTOP ;ALB/TXH - STOP PAIT HL7 TRANSMISSIONS;07/09/15
"RTN","SDRPSTOP",2,0)
 ;;5.3;Scheduling;**639**;AUG 13, 1993;Build 7
"RTN","SDRPSTOP",3,0)
 ;
"RTN","SDRPSTOP",4,0)
 ; This post-init routine 
"RTN","SDRPSTOP",5,0)
 ; - disable the SD-PAIT Logical Link
"RTN","SDRPSTOP",6,0)
 ; - unschedule the PAIT transmission task
"RTN","SDRPSTOP",7,0)
 ; - place PAIT options Out of Order
"RTN","SDRPSTOP",8,0)
 ; - inactivate PAIT related HL7 Application Parameters
"RTN","SDRPSTOP",9,0)
 ;
"RTN","SDRPSTOP",10,0)
 Q
"RTN","SDRPSTOP",11,0)
 ;
"RTN","SDRPSTOP",12,0)
EN ; Entry Point
"RTN","SDRPSTOP",13,0)
 D BMES^XPDUTL("SD*5.3*639 Post-Init Started...")
"RTN","SDRPSTOP",14,0)
 D LOGLNK
"RTN","SDRPSTOP",15,0)
 D DELETE
"RTN","SDRPSTOP",16,0)
 D OPTOUT
"RTN","SDRPSTOP",17,0)
 D INACT
"RTN","SDRPSTOP",18,0)
 D BMES^XPDUTL("SD*5.3*639 Post-Init Finished.")
"RTN","SDRPSTOP",19,0)
 D MES^XPDUTL(" ")
"RTN","SDRPSTOP",20,0)
 Q
"RTN","SDRPSTOP",21,0)
 ;
"RTN","SDRPSTOP",22,0)
LOGLNK ; Disable the SD-PAIT Logical Link
"RTN","SDRPSTOP",23,0)
 ;
"RTN","SDRPSTOP",24,0)
 D BMES^XPDUTL("* Disabling SD-PAIT Logical Link...")
"RTN","SDRPSTOP",25,0)
 N SDLNK,SDMCL,DA,DR
"RTN","SDRPSTOP",26,0)
 S SDLNK="SD-PAIT"
"RTN","SDRPSTOP",27,0)
 S SDMCL=$O(^HLCS(870,"B",SDLNK,""))
"RTN","SDRPSTOP",28,0)
 I SDMCL="" D MES^XPDUTL("     "_SDLNK_" not found. It's okay.") Q
"RTN","SDRPSTOP",29,0)
 ; get AUTOSTART disabled and set SHUTDOWN LLP to YES.
"RTN","SDRPSTOP",30,0)
 N DIE S DIE="^HLCS(870,",DA=SDMCL,DR="4.5///0;14///1"
"RTN","SDRPSTOP",31,0)
 D ^DIE
"RTN","SDRPSTOP",32,0)
 D MES^XPDUTL("  Done.")
"RTN","SDRPSTOP",33,0)
 Q
"RTN","SDRPSTOP",34,0)
 ;
"RTN","SDRPSTOP",35,0)
DELETE ; Remove the PAIT transmission task in Option Schedule
"RTN","SDRPSTOP",36,0)
 ;
"RTN","SDRPSTOP",37,0)
 ; IA #6121 Remove Scheduled options from #19.2
"RTN","SDRPSTOP",38,0)
 ; IA #2051 Database Server API: Lookup Utilities (DIC)
"RTN","SDRPSTOP",39,0)
 ;
"RTN","SDRPSTOP",40,0)
 D BMES^XPDUTL("* Removing PAIT Transmission Task...")
"RTN","SDRPSTOP",41,0)
 N SDRPTSK,SDOPT,DA,DIK
"RTN","SDRPSTOP",42,0)
 S SDRPTSK="SD-PAIT TASKED TRANSMISSION"
"RTN","SDRPSTOP",43,0)
 S SDOPT=$O(^DIC(19,"B",SDRPTSK,""))
"RTN","SDRPSTOP",44,0)
 I SDOPT="" D MES^XPDUTL("     "_SDRPTSK_" not found. It's okay.") Q
"RTN","SDRPSTOP",45,0)
 S DA="" F  S DA=$O(^DIC(19.2,"B",SDOPT,DA)) Q:'+DA  D
"RTN","SDRPSTOP",46,0)
 . S ^XTMP("SDRPTSK",$J,0)=$$FMADD^XLFDT(DT+90)_"^"_DT_"^copy of SD-PAIT TASKED TRANSMISSION in #19.2^"_DA
"RTN","SDRPSTOP",47,0)
 . M ^XTMP("SDRPTSK",$J,"DIC",19.2,DA)=^DIC(19.2,DA)
"RTN","SDRPSTOP",48,0)
 . S DIK="^DIC(19.2,"
"RTN","SDRPSTOP",49,0)
 . D ^DIK
"RTN","SDRPSTOP",50,0)
 D MES^XPDUTL("  Done.")
"RTN","SDRPSTOP",51,0)
 Q
"RTN","SDRPSTOP",52,0)
 ;
"RTN","SDRPSTOP",53,0)
OPTOUT ; Set options out of order
"RTN","SDRPSTOP",54,0)
 ;
"RTN","SDRPSTOP",55,0)
 ; IA #1157 OUT^XPDMENU(OPT,TXT)
"RTN","SDRPSTOP",56,0)
 ;
"RTN","SDRPSTOP",57,0)
 D BMES^XPDUTL("* Placing the following PAIT options out of order...")
"RTN","SDRPSTOP",58,0)
 N SDMCN,SDOPT,SDTXT,OPTMSG
"RTN","SDRPSTOP",59,0)
 S SDTXT="This functionality is now accomplished by CDW/VSSC."
"RTN","SDRPSTOP",60,0)
 F SDMCN=1:1 S SDOPT=$P($TEXT(OPTLIST+SDMCN),";;",2) Q:SDOPT="$$END"!(SDOPT="")  D
"RTN","SDRPSTOP",61,0)
 . D OUT^XPDMENU(SDOPT,SDTXT)  ;Mark option out-of-order
"RTN","SDRPSTOP",62,0)
 . S OPTMSG="    "_SDOPT
"RTN","SDRPSTOP",63,0)
 . D MES^XPDUTL(OPTMSG)
"RTN","SDRPSTOP",64,0)
 D MES^XPDUTL("  Done.")
"RTN","SDRPSTOP",65,0)
 Q
"RTN","SDRPSTOP",66,0)
 ; 
"RTN","SDRPSTOP",67,0)
INACT ; Make PAIT related HL7 APPLICATION PARAMETERs inactive
"RTN","SDRPSTOP",68,0)
 ;
"RTN","SDRPSTOP",69,0)
 D BMES^XPDUTL("* Inactivating PAIT HL7 Application Parameter...")
"RTN","SDRPSTOP",70,0)
 N SDMCN,SDPARA,SDIEN,INACT,SDMSG1,INACTMG
"RTN","SDRPSTOP",71,0)
 F SDMCN=1:1 S SDPARA=$P($TEXT(NAME771+SDMCN),";;",2) Q:SDPARA="$$END"!(SDPARA="")  D
"RTN","SDRPSTOP",72,0)
 . S SDIEN=$O(^HL(771,"B",SDPARA,"")) D
"RTN","SDRPSTOP",73,0)
 . . I SDIEN="" S SDMSG1="     "_SDPARA_" not found. It's okay." D MES^XPDUTL(SDMSG1) Q
"RTN","SDRPSTOP",74,0)
 . . N DIE S DIE="^HL(771,",DA=SDIEN,DR="2///i"
"RTN","SDRPSTOP",75,0)
 . . D ^DIE
"RTN","SDRPSTOP",76,0)
 . . S INACTMG="     "_SDPARA
"RTN","SDRPSTOP",77,0)
 . . D MES^XPDUTL(INACTMG)
"RTN","SDRPSTOP",78,0)
 D MES^XPDUTL("  Done.")
"RTN","SDRPSTOP",79,0)
 Q
"RTN","SDRPSTOP",80,0)
 ;
"RTN","SDRPSTOP",81,0)
OPTLIST ; PAIT options
"RTN","SDRPSTOP",82,0)
 ;;SD-PAIT MANUAL BATCH REJECT
"RTN","SDRPSTOP",83,0)
 ;;SD-PAIT MANUAL TRANSMISSION
"RTN","SDRPSTOP",84,0)
 ;;SD-PAIT TASKED TRANSMISSION
"RTN","SDRPSTOP",85,0)
 ;;SD-PAIT REPAIR
"RTN","SDRPSTOP",86,0)
 ;;$$END
"RTN","SDRPSTOP",87,0)
 ;
"RTN","SDRPSTOP",88,0)
NAME771 ; HL7 Application Parameter
"RTN","SDRPSTOP",89,0)
 ;;SD-AAC-PAIT
"RTN","SDRPSTOP",90,0)
 ;;SD-SITE-PAIT
"RTN","SDRPSTOP",91,0)
 ;;$$END
"VER")
8.0^22.0
"BLD",10031,6)
^529
**END**
**END**

