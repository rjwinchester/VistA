Released PRC*5.1*180 SEQ #158
Extracted from mail message
**KIDS**:PRC*5.1*180^

**INSTALL NAME**
PRC*5.1*180
"BLD",7358,0)
PRC*5.1*180^IFCAP^0^3130925^y
"BLD",7358,1,0)
^^6^6^3130723^^
"BLD",7358,1,1,0)
 
"BLD",7358,1,2,0)
1. Add new sub authority to Authority 3.
"BLD",7358,1,3,0)
 
"BLD",7358,1,4,0)
2. Amendment for Delivery Date with Document transmission to FMS
"BLD",7358,1,5,0)
 
"BLD",7358,1,6,0)
3. Daily 1358 record entry cannot be entered
"BLD",7358,4,0)
^9.64PA^^
"BLD",7358,6.3)
5
"BLD",7358,"ABPKG")
n
"BLD",7358,"INID")
^y
"BLD",7358,"INIT")
START^PRCS180P
"BLD",7358,"KRN",0)
^9.67PA^779.2^20
"BLD",7358,"KRN",.4,0)
.4
"BLD",7358,"KRN",.401,0)
.401
"BLD",7358,"KRN",.402,0)
.402
"BLD",7358,"KRN",.403,0)
.403
"BLD",7358,"KRN",.5,0)
.5
"BLD",7358,"KRN",.84,0)
.84
"BLD",7358,"KRN",3.6,0)
3.6
"BLD",7358,"KRN",3.8,0)
3.8
"BLD",7358,"KRN",9.2,0)
9.2
"BLD",7358,"KRN",9.8,0)
9.8
"BLD",7358,"KRN",9.8,"NM",0)
^9.68A^17^16
"BLD",7358,"KRN",9.8,"NM",1,0)
PRCS180P^^0^B1476210
"BLD",7358,"KRN",9.8,"NM",3,0)
PRCFFMOM^^0^B87570061
"BLD",7358,"KRN",9.8,"NM",4,0)
PRCHAMU^^0^B58833091
"BLD",7358,"KRN",9.8,"NM",5,0)
PRCHDAM1^^0^B14059439
"BLD",7358,"KRN",9.8,"NM",6,0)
PRCHDAM3^^0^B18726324
"BLD",7358,"KRN",9.8,"NM",7,0)
PRCHPAM2^^0^B15193629
"BLD",7358,"KRN",9.8,"NM",8,0)
PRCHPAM4^^0^B18748994
"BLD",7358,"KRN",9.8,"NM",9,0)
PRCHDSP4^^0^B15007147
"BLD",7358,"KRN",9.8,"NM",10,0)
PRCHDSP6^^0^B20078350
"BLD",7358,"KRN",9.8,"NM",11,0)
PRCHDP5^^0^B14699380
"BLD",7358,"KRN",9.8,"NM",12,0)
PRCHDP7^^0^B21640570
"BLD",7358,"KRN",9.8,"NM",13,0)
PRCSUT3^^0^B17626422
"BLD",7358,"KRN",9.8,"NM",14,0)
PRCEAU^^0^B21310781
"BLD",7358,"KRN",9.8,"NM",15,0)
PRCEDRE0^^0^B17139039
"BLD",7358,"KRN",9.8,"NM",16,0)
PRCELIQ^^0^B31991788
"BLD",7358,"KRN",9.8,"NM",17,0)
PRCESOM^^0^B63270948
"BLD",7358,"KRN",9.8,"NM","B","PRCEAU",14)

"BLD",7358,"KRN",9.8,"NM","B","PRCEDRE0",15)

"BLD",7358,"KRN",9.8,"NM","B","PRCELIQ",16)

"BLD",7358,"KRN",9.8,"NM","B","PRCESOM",17)

"BLD",7358,"KRN",9.8,"NM","B","PRCFFMOM",3)

"BLD",7358,"KRN",9.8,"NM","B","PRCHAMU",4)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDAM1",5)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDAM3",6)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDP5",11)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDP7",12)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDSP4",9)

"BLD",7358,"KRN",9.8,"NM","B","PRCHDSP6",10)

"BLD",7358,"KRN",9.8,"NM","B","PRCHPAM2",7)

"BLD",7358,"KRN",9.8,"NM","B","PRCHPAM4",8)

"BLD",7358,"KRN",9.8,"NM","B","PRCS180P",1)

"BLD",7358,"KRN",9.8,"NM","B","PRCSUT3",13)

"BLD",7358,"KRN",19,0)
19
"BLD",7358,"KRN",19.1,0)
19.1
"BLD",7358,"KRN",101,0)
101
"BLD",7358,"KRN",409.61,0)
409.61
"BLD",7358,"KRN",771,0)
771
"BLD",7358,"KRN",779.2,0)
779.2
"BLD",7358,"KRN",870,0)
870
"BLD",7358,"KRN",8989.51,0)
8989.51
"BLD",7358,"KRN",8989.52,0)
8989.52
"BLD",7358,"KRN",8994,0)
8994
"BLD",7358,"KRN","B",.4,.4)

"BLD",7358,"KRN","B",.401,.401)

"BLD",7358,"KRN","B",.402,.402)

"BLD",7358,"KRN","B",.403,.403)

"BLD",7358,"KRN","B",.5,.5)

"BLD",7358,"KRN","B",.84,.84)

"BLD",7358,"KRN","B",3.6,3.6)

"BLD",7358,"KRN","B",3.8,3.8)

"BLD",7358,"KRN","B",9.2,9.2)

"BLD",7358,"KRN","B",9.8,9.8)

"BLD",7358,"KRN","B",19,19)

"BLD",7358,"KRN","B",19.1,19.1)

"BLD",7358,"KRN","B",101,101)

"BLD",7358,"KRN","B",409.61,409.61)

"BLD",7358,"KRN","B",771,771)

"BLD",7358,"KRN","B",779.2,779.2)

"BLD",7358,"KRN","B",870,870)

"BLD",7358,"KRN","B",8989.51,8989.51)

"BLD",7358,"KRN","B",8989.52,8989.52)

"BLD",7358,"KRN","B",8994,8994)

"BLD",7358,"QDEF")
^^^^^^^^^^YES
"BLD",7358,"QUES",0)
^9.62^^
"BLD",7358,"REQB",0)
^9.611^8^6
"BLD",7358,"REQB",2,0)
PRC*5.1*175^2
"BLD",7358,"REQB",3,0)
PRC*5.1*131^2
"BLD",7358,"REQB",5,0)
PRC*5.1*81^2
"BLD",7358,"REQB",6,0)
PRC*5.1*150^2
"BLD",7358,"REQB",7,0)
PRC*5.1*23^2
"BLD",7358,"REQB",8,0)
PRC*5.1*153^2
"BLD",7358,"REQB","B","PRC*5.1*131",3)

"BLD",7358,"REQB","B","PRC*5.1*150",6)

"BLD",7358,"REQB","B","PRC*5.1*153",8)

"BLD",7358,"REQB","B","PRC*5.1*175",2)

"BLD",7358,"REQB","B","PRC*5.1*23",7)

"BLD",7358,"REQB","B","PRC*5.1*81",5)

"INIT")
START^PRCS180P
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
180^3130925
"PKG",455,22,1,"PAH",1,1,0)
^^6^6^3130925
"PKG",455,22,1,"PAH",1,1,1,0)
 
"PKG",455,22,1,"PAH",1,1,2,0)
1. Add new sub authority to Authority 3.
"PKG",455,22,1,"PAH",1,1,3,0)
 
"PKG",455,22,1,"PAH",1,1,4,0)
2. Amendment for Delivery Date with Document transmission to FMS
"PKG",455,22,1,"PAH",1,1,5,0)
 
"PKG",455,22,1,"PAH",1,1,6,0)
3. Daily 1358 record entry cannot be entered
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","PRCEAU")
0^14^B21310781^B19778588
"RTN","PRCEAU",1,0)
PRCEAU ;WISC/CLH/LDB/BGJ-CREATE/EDIT AUTHORIZATIONS-CONTROL POINTS ; 15 Apr 93  1:20 PM
"RTN","PRCEAU",2,0)
V ;;5.1;IFCAP;**23,180**;Oct 20, 2000;Build 5
"RTN","PRCEAU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEAU",4,0)
 ;
"RTN","PRCEAU",5,0)
 ;PRC*5.1*180 RGB 10/22/12  Added switch PRCE424 coming from 1358 processing
"RTN","PRCEAU",6,0)
 ;to insure new entry check (EN1^PRCSUT3) uses file 424, not file 410.
"RTN","PRCEAU",7,0)
 ;
"RTN","PRCEAU",8,0)
 ;Enter new or edit old authorizations
"RTN","PRCEAU",9,0)
 N AMT,PRC,PRCF,DIC,DIR,DLAYGO,DIE,DA,DR,Y,X,PODA,TRDA,ER,TIME,IN,ABAL,ACT,AUDA,BAL,BAL1,BAL2,Z,X,Y
"RTN","PRCEAU",10,0)
 ;S PRCF("X")="S" D ^PRCFSITE Q:'%
"RTN","PRCEAU",11,0)
 D EN3^PRCSUT Q:'$D(PRC("CP"))
"RTN","PRCEAU",12,0)
 ;look up obligation number
"RTN","PRCEAU",13,0)
GO S DIC="^PRCS(410," D OROBL^PRCS58OB(DIC,.PRC,.Y) G EXIT:Y<0 S PRCRI(410)=+Y
"RTN","PRCEAU",14,0)
EN0 K DIR,AMT,PRCF,PODA,TRDA,ER,TIME,IN,ABAL,ACT,AUDA,BAL,BAL1,BAL2,Z,X,Y
"RTN","PRCEAU",15,0)
 D NODE^PRCS58OB(PRCRI(410),.TRNODE) S PODA=$P($G(TRNODE(10)),U,3)
"RTN","PRCEAU",16,0)
 G:'$G(PODA) GO
"RTN","PRCEAU",17,0)
EN ;when and poda and site variables are defined
"RTN","PRCEAU",18,0)
 S BAL=$$BAL^PRCH58(PODA)
"RTN","PRCEAU",19,0)
 D NOW^%DTC S TIME=% K Y
"RTN","PRCEAU",20,0)
 K Y S DIR("?")=" ",DIR(0)="SOA^1:CREATE;2:EDIT",DIR("A")="Would you like to EDIT or CREATE an Authorization: ",DIR("?",1)="If you want to EDIT an existing authorization type 'E'"
"RTN","PRCEAU",21,0)
 S DIR("?",2)="If you want to CREATE a NEW authorization type 'C'",DIR("?",3)="OR press <RETURN>" D ^DIR K DIR G:Y["^"!(Y="") GO I Y=2 D  G EN0
"RTN","PRCEAU",22,0)
  . S DIC="^PRC(424," S DIC(0)="AEMNQ" S DIC("S")="I $P($P(^(0),U),""-"",1,2)=(PRC(""SITE"")_""-""_$P($G(TRNODE(4)),U,5)),$P(^(0),U,3)=""AU""" D ^DIC K DIC("S") Q:Y<0
"RTN","PRCEAU",23,0)
  . S (AUDA,DA)=+Y,AUDA0=$P(Y,U,2),DIE=DIC
"RTN","PRCEAU",24,0)
  . L +^PRC(424,DA):3 E  S X="Another user is editing this entry. Try later." D MSG^PRCFQ Q
"RTN","PRCEAU",25,0)
  . D BALDIS^PRCEAU1 W ?35,"Authorization balance: ","$" S Y=$FN($P($G(^PRC(424,+AUDA,0)),U,5),",P",2) W $$LBF1^PRCFU(Y,14),!
"RTN","PRCEAU",26,0)
  . K DIR S DIR(0)="L^1:6",DIR("A",1)="   1 Edit authorization",DIR("A",2)="   2 Mark authorization as COMPLETE"
"RTN","PRCEAU",27,0)
  . S DIR("A",3)="   3 ZERO out authorization",DIR("A",4)="   4 Reopen Authorization",DIR("A",5)="   5 Enter/Edit COMMENTS",DIR("A",6)="   6 QUIT"
"RTN","PRCEAU",28,0)
  . S DIR("A")="Select ACTION",DIR("?")="^D HLP^PRCEAU0" D ^DIR
"RTN","PRCEAU",29,0)
  . Q:'Y
"RTN","PRCEAU",30,0)
  . K FINAL S ACT=Y F JJ=1:1 S I=$P(ACT,",",JJ) Q:I=""  D  Q:$D(FINAL)
"RTN","PRCEAU",31,0)
    .. Q:I=6
"RTN","PRCEAU",32,0)
    .. I I<4,$P($G(^PRC(424,AUDA,0)),U,9) W !,"This authorization has been marked as completed",!,"and must first be reopened to continue." S FINAL=1 Q
"RTN","PRCEAU",33,0)
    .. I I=1 N ACT,I D ADJ^PRCEAU1 Q
"RTN","PRCEAU",34,0)
    .. I "23"[I N ACT,I D ZERO^PRCEAU1 Q
"RTN","PRCEAU",35,0)
    .. I I=4,'$P(^PRC(424,AUDA,0),U,9) W !,"This authorization is not marked as complete yet.",$C(7) H 3 Q
"RTN","PRCEAU",36,0)
    .. I I=4 S FINAL=1 N ACT,I D OPN^PRCEAU1 K FINAL Q
"RTN","PRCEAU",37,0)
    .. S DR="1.1" D ^DIE Q
"RTN","PRCEAU",38,0)
    .. Q
"RTN","PRCEAU",39,0)
 S (X,Z)=PRC("SITE")_"-"_$P($G(TRNODE(4)),U,5)
"RTN","PRCEAU",40,0)
 D WAIT^PRCFYN S PRCE424=1 K MSG D EN1^PRCSUT3 K PRCE424 I $D(MSG),MSG'="" S X=MSG D MSG^PRCFQ K MSG G EXIT   ;PRC*5.1*180
"RTN","PRCEAU",41,0)
 S DIC="^PRC(424,",DLAYGO=424,DIC(0)="LXZ" D ^DIC I Y<0 S X="Unable to create an new entry.  Contact Application Coordinator.*" D MSG^PRCFQ G EXIT   ;PRC*5.1*180
"RTN","PRCEAU",42,0)
 W !,"This entry has been assigned transaction number: ",$P(X,"-",3),"."
"RTN","PRCEAU",43,0)
 S DIE=DIC,(AUDA,DA)=+Y,AUDA0=Y(0)
"RTN","PRCEAU",44,0)
 D NOW^%DTC S TIME=% K Y
"RTN","PRCEAU",45,0)
 D BALDIS^PRCEAU1
"RTN","PRCEAU",46,0)
AMT ;looping area for authorization amount
"RTN","PRCEAU",47,0)
 G:$D(DIRUT) EN0 K DIR S DIR(0)="N^.01:999999999.99:2",DIR("A")="AUTHORIZATION AMOUNT",DIR("?")="enter the amount of this authorization or '^' to QUIT" D ^DIR
"RTN","PRCEAU",48,0)
 I $D(DIRUT)!(Y<.01) D AMTMSG,AMTDEL G EN0
"RTN","PRCEAU",49,0)
 ;   no MAIL for create authorization
"RTN","PRCEAU",50,0)
 ;D BUL^PRCEAU0
"RTN","PRCEAU",51,0)
 I Y>(+BAL-$P(BAL,U,3)) D  G EN0
"RTN","PRCEAU",52,0)
  . W $C(7),!,"This amount will EXCEED obligation balances by $",$FN((+BAL-$P(BAL,U,3))-Y,",",2),"."
"RTN","PRCEAU",53,0)
  . W !!?20,"SERVICE BALANCE: $",$FN(+BAL-$P(BAL,U,3),",",2),!! H 3
"RTN","PRCEAU",54,0)
  . W !!,"This authorization cannot be entered until Fiscal has obligated ",!,"the increase adjustment." K DIR,DIC
"RTN","PRCEAU",55,0)
  . D ASK^PRCEADJ,ADJMSG,AMTDEL
"RTN","PRCEAU",56,0)
EN1 S BAL1=+Y,DR=".02////^S X=PODA;.03////^S X=""AU"";.07////^S X=TIME;.08////^S X=DUZ;.05////^S X=BAL1;.12////^S X=BAL1;.13////^S X=BAL1;.1;1.1"
"RTN","PRCEAU",57,0)
 D ^DIE
"RTN","PRCEAU",58,0)
 I $D(Y) D DEL^PRCEAU0 G EN0
"RTN","PRCEAU",59,0)
 Q:'$D(^PRC(424,AUDA,0))  S X(1)=0
"RTN","PRCEAU",60,0)
 D LREC^PRCEAU0 G EN0
"RTN","PRCEAU",61,0)
EXIT L:$D(AUDA) -^PRC(424,AUDA) K DIK,DIRUT,DIROUT,TRNODE,DTOUT,DUOUT Q
"RTN","PRCEAU",62,0)
AMTMSG S X="----Amount missing - authorization deleted----" D MSG^PRCFQ Q
"RTN","PRCEAU",63,0)
ADJMSG S X="Authorization deleted pending adjustment action by Fiscal.." D MSG^PRCFQ Q
"RTN","PRCEAU",64,0)
AMTDEL S DA=AUDA,DIK="^PRC(424," D ^DIK Q
"RTN","PRCEDRE0")
0^15^B17139039^B15690544
"RTN","PRCEDRE0",1,0)
PRCEDRE0 ;WISC/LDB-ENTER/EDIT DAILY RECORD CONT ; 06/09/93  1:24 PM
"RTN","PRCEDRE0",2,0)
 ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCEDRE0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEDRE0",4,0)
 ;Called from PRCEDRE and PRCEDRE1 to increase authorization amount
"RTN","PRCEDRE0",5,0)
 ;
"RTN","PRCEDRE0",6,0)
 ;PRC*5.1*180 RGB 10/22/12  Added switch PRCE424 coming from 1358 processing
"RTN","PRCEDRE0",7,0)
 ;to insure new entry check (EN1^PRCSUT3) uses file 424, not file 410.
"RTN","PRCEDRE0",8,0)
 ;
"RTN","PRCEDRE0",9,0)
AMTOVR W $C(7),!,"This amount exceeds the authorization balance by $",$FN((AAMT-ABAL),",P",2)
"RTN","PRCEDRE0",10,0)
 W !!,"The available authorization balance is $",$FN(ABAL,",P",2)
"RTN","PRCEDRE0",11,0)
 W $C(7),!!,"This daily record amount cannot be entered until an",!,"increase has been made to the authorization."
"RTN","PRCEDRE0",12,0)
 K DIR N X,Y S PRCADJ=0,DIR("A")="Would you like to increase the authorization amount at this time by $"_$FN((ABAL-AAMT),",-",2),DIR(0)="Y0",DIR("B")="NO" D ^DIR I 'Y S PRCADJ=1 Q
"RTN","PRCEDRE0",13,0)
 W !!,"Checking the available obligation balance . . ."
"RTN","PRCEDRE0",14,0)
 S BAL=$$BAL^PRCH58(PODA)
"RTN","PRCEDRE0",15,0)
 I $P(BAL,U,3)+AAMT-ABAL>+BAL D  Q
"RTN","PRCEDRE0",16,0)
 . W !,"This authorization amount will exceed the obligation balance by $",$FN($P(BAL,U,3)+AAMT-ABAL-BAL,",P",2) S PRCADJ=2 D ASK^PRCEADJ
"RTN","PRCEDRE0",17,0)
 . W !,"This daily record cannot be posted until Fiscal has obligated"
"RTN","PRCEDRE0",18,0)
 . W !,"the increase adjustment."
"RTN","PRCEDRE0",19,0)
 S PRCADJ=0,AAMT1=AAMT,AAMT=(AAMT-ABAL) D ADJ S AAMT=AAMT1 Q:PRCADJ
"RTN","PRCEDRE0",20,0)
 S $P(^PRC(424,AUDA,0),U,5)=ABAL+(AAMT-ABAL),$P(^(0),U,12)=$P(^(0),U,12)+(AAMT-ABAL) D BALUP^PRCH58(PODA,(AAMT-ABAL)) Q
"RTN","PRCEDRE0",21,0)
ADJ ;Called to make adjustment entry in 424.1 for authorization adjustment
"RTN","PRCEDRE0",22,0)
 K DIC S DLAYGO=424.1,DIC="^PRC(424.1,",DIC(0)="L",X=""""_$P(AUDA0,U)_"-"_0_"""",DIC("DR")=".011////^S X=""A"";.02////^S X=AUDA;.03////^S X=AAMT;.04///^S X=""NOW"";05////^S X=DUZ"
"RTN","PRCEDRE0",23,0)
 D ^DIC S:Y<0 PRCADJ=1 K DIC,X,Y
"RTN","PRCEDRE0",24,0)
 Q
"RTN","PRCEDRE0",25,0)
 ;WISC/PLT - add authorization from daily actvity option
"RTN","PRCEDRE0",26,0)
AU(PRC424) ;add an authorization record called from PRCEDRE
"RTN","PRCEDRE0",27,0)
 S PRC424=""
"RTN","PRCEDRE0",28,0)
 D YN^PRC0A(.X,.Y,"Add an authorization","","YES") G EXIT:Y'=1
"RTN","PRCEDRE0",29,0)
 N AMT,PRCF,DIC,DIR,DLAYGO,DIE,DA,DR,Y,X,TRDA,ER,TIME,IN,ABAL,ACT,AUDA,BAL1,BAL2,Z,X,Y
"RTN","PRCEDRE0",30,0)
 D NOW^%DTC S TIME=% K Y
"RTN","PRCEDRE0",31,0)
 S (X,Z)=PRC("SITE")_"-"_$P($G(TRNODE(4)),U,5)
"RTN","PRCEDRE0",32,0)
 D WAIT^PRCFYN S PRCE424=1 K MSG D EN1^PRCSUT3 K PRCE424 I $D(MSG),MSG'="" S X=MSG D MSG^PRCFQ K MSG G EXIT   ;PRC*5.1*180
"RTN","PRCEDRE0",33,0)
 S DIC="^PRC(424,",DLAYGO=424,DIC(0)="LXZ" D ^DIC I Y<0 S X="Unable to create an new entry.  Contact Application Coordinator.*" D MSG^PRCFQ K MSG G EXIT    ;PRC*5.1*180
"RTN","PRCEDRE0",34,0)
 W !,"This entry has been assigned transaction number: ",$P(X,"-",3),"."
"RTN","PRCEDRE0",35,0)
 S DIE=DIC,(AUDA,DA)=+Y,AUDA0=Y(0)
"RTN","PRCEDRE0",36,0)
 D NOW^%DTC S TIME=% K Y
"RTN","PRCEDRE0",37,0)
 D BALDIS^PRCEAU1
"RTN","PRCEDRE0",38,0)
AMT ;ask authorization amount
"RTN","PRCEDRE0",39,0)
 G:$D(DIRUT) EXIT K DIR S DIR(0)="N^.01:999999999.99:2",DIR("A")="AUTHORIZATION AMOUNT",DIR("?")="enter the amount of this authorization or '^' to QUIT" D ^DIR
"RTN","PRCEDRE0",40,0)
 I $D(DIRUT)!(Y<.01) D AMTMSG,AMTDEL G EXIT
"RTN","PRCEDRE0",41,0)
 ;balance alert message
"RTN","PRCEDRE0",42,0)
 D BUL^PRCEAU0
"RTN","PRCEDRE0",43,0)
 I Y>(+BAL-$P(BAL,U,3)) D  G EXIT
"RTN","PRCEDRE0",44,0)
  . W $C(7),!,"This amount will EXCEED obligation balances by $",$FN((+BAL-$P(BAL,U,3))-Y,",",2),"."
"RTN","PRCEDRE0",45,0)
  . W !!?20,"SERVICE BALANCE: $",$FN(+BAL-$P(BAL,U,3),",",2),!! H 3
"RTN","PRCEDRE0",46,0)
  . W !!,"This authorization cannot be entered until CP/Fiscal have increased ",!,"and obligated the adjustment." K DIR,DIC
"RTN","PRCEDRE0",47,0)
  . D ADJMSG,AMTDEL
"RTN","PRCEDRE0",48,0)
EN1 S BAL1=+Y,DR=".02////^S X=PODA;.03////^S X=""AU"";.07////^S X=TIME;.08////^S X=DUZ;.05////^S X=BAL1;.12////^S X=BAL1;.13////^S X=BAL1;.1;1.1"
"RTN","PRCEDRE0",49,0)
 D ^DIE
"RTN","PRCEDRE0",50,0)
 I $D(Y) D DEL^PRCEAU0 G EXIT
"RTN","PRCEDRE0",51,0)
 Q:'$D(^PRC(424,AUDA,0))  S X(1)=0
"RTN","PRCEDRE0",52,0)
 ;add record in file 424.1 and edit balance in file 442
"RTN","PRCEDRE0",53,0)
 D LREC^PRCEAU0 S:$D(^PRC(424,AUDA,0)) PRC424=AUDA
"RTN","PRCEDRE0",54,0)
EXIT L:$D(AUDA) -^PRC(424,AUDA) K DIK,DIRUT,DIROUT,TRNODE,DTOUT,DUOUT Q
"RTN","PRCEDRE0",55,0)
AMTMSG S X="----Amount missing - authorization deleted----" D MSG^PRCFQ Q
"RTN","PRCEDRE0",56,0)
ADJMSG S X="Authorization deleted pending adjustment action by CP/Fiscal.." D MSG^PRCFQ Q
"RTN","PRCEDRE0",57,0)
AMTDEL S DA=AUDA,DIK="^PRC(424," D ^DIK Q
"RTN","PRCELIQ")
0^16^B31991788^B30290050
"RTN","PRCELIQ",1,0)
PRCELIQ ;WISC/CLH/CTB-LIQUIDATE 1358 ;9/14/95  11:40 [1/27/99 3:19pm]
"RTN","PRCELIQ",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCELIQ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCELIQ",4,0)
 ;
"RTN","PRCELIQ",5,0)
 ;PRC*5.1*180 RGB 10/22/12  Added switch PRCE424 coming from 1358 processing
"RTN","PRCELIQ",6,0)
 ;to insure new entry check (EN1^PRCSUT3) uses file 424, not file 410.
"RTN","PRCELIQ",7,0)
 ;
"RTN","PRCELIQ",8,0)
EN K PO,PRCFA,PRC,X,X1,%,ER,Y,Z,CNT,IOINHI,IOINLOW,IOINORM,LD,LAMT,DIC,DIE,DR,DA
"RTN","PRCELIQ",9,0)
 S PRCF("X")="AS" D ^PRCFSITE Q:'%
"RTN","PRCELIQ",10,0)
 D LIQ^PRCH58LQ(.PRCFA,.Y,.ER,.PO)
"RTN","PRCELIQ",11,0)
 I 'ER G EXIT
"RTN","PRCELIQ",12,0)
EN1 ;entry point when obligation number defined
"RTN","PRCELIQ",13,0)
 K ^TMP($J,"PRCE","LIQ")
"RTN","PRCELIQ",14,0)
EN2 D SCREEN G EXIT:$D(OUT) S DIR("A")="Ok to post liquidation",DIR("B")="Yes",DIR(0)="YO" D ^DIR K DIR G:'Y EXIT
"RTN","PRCELIQ",15,0)
 S (X,Z)=$P(PO(0),"^") I '$D(^PRC(424,"C",PRCFA("PODA"))) W $C(7),!!,"This obligation has not yet established in the 1358 file." H 2 G EXIT
"RTN","PRCELIQ",16,0)
 S PRCE424=1 D EN1^PRCSUT3 K PRCE424 I $D(MSG),MSG'="" W !!,MSG K MSG G EXIT   ;PRC*5.1*180
"RTN","PRCELIQ",17,0)
 S X1=X,DLAYGO=424,DIC="^PRC(424,",DIC(0)="LXZ" D ^DIC K DLAYGO I Y<0 W !!,"YOU DO NOT HAVE THE RIGHT SECURITY ACCESS CODE FOR THIS FILE!!",$C(7) H 3 G EXIT
"RTN","PRCELIQ",18,0)
 W !!,"This 1358 Liquidation entry is assigned entry number ",X1,"."
"RTN","PRCELIQ",19,0)
 S ZX1=X1,DA=+Y
"RTN","PRCELIQ",20,0)
 S DIR(0)="D^"_$E($P($G(PO(12)),U,5),1,7)_":"_DT_".235959"_":EST",DIR("A")="LIQUIDATION DATE",DIR("?")="Enter liquidation date or '^' to quit "
"RTN","PRCELIQ",21,0)
 S DIR("B")=$$DATE^PRCH58 D ^DIR K DIR I $D(DIRUT) D DEL G OUT
"RTN","PRCELIQ",22,0)
 S LD=Y
"RTN","PRCELIQ",23,0)
R S DIR(0)="N^-999999999.99:999999999.99:2",DIR("A")="LIQUIDATION AMOUNT",DIR("?")="Enter the amount of this liquidation or '^' to QUIT"
"RTN","PRCELIQ",24,0)
 I $G(PRCFA("LIQAMT"))]"",+PRCFA("LIQAMT")'=0 S DIR("B")=PRCFA("LIQAMT")
"RTN","PRCELIQ",25,0)
 D ^DIR K DIR I $D(DIRUT) D DEL G OUT
"RTN","PRCELIQ",26,0)
 S LAMT=Y W "  $",$FN(LAMT,",",2)
"RTN","PRCELIQ",27,0)
 I ($P(PO(8),U,2)+LAMT)>+PO(8) D OVER G R
"RTN","PRCELIQ",28,0)
 I '$D(Y) S DIR(0)="Y",DIR("A")="OK to Post",DIR("B")="Yes",DIR("?")="Enter 'Yes' to POST, 'No' or an '^' to DELETE and quit" D ^DIR K DIR I $D(DIRUT)!('Y) D DEL G OUT
"RTN","PRCELIQ",29,0)
 S DIE="^PRC(424,",DR=".1;1.1;.02////^S X=PRCFA(""PODA"");.03////^S X=""L"";.04////^S X=LAMT;.07////^S X=LD;.08////^S X=DUZ;.15////^S X=$G(PRCFA(""TRDA""))" D ^DIE
"RTN","PRCELIQ",30,0)
 D WAIT^PRCFYN,POST^PRCH58LQ(.PRCFA,LAMT,.PO) S ^TMP($J,"PRCE","LIQ",ZX1)=LAMT,X="  ---POSTED---" D MSG^PRCFQ
"RTN","PRCELIQ",31,0)
 I $D(PRCFD("PAYMENT")) S ^TMP("PRCFDA",$J,"LIQ")=-LAMT_U_PRCFA("PODA")_U_ZX1_U_DA
"RTN","PRCELIQ",32,0)
OUT G:$D(PRCFD("PAYMENT")) EXIT W ! S DIR("A")="Would you like to enter another Liquidation for THIS OBLIGATION",DIR(0)="YO",DIR("B")="No"
"RTN","PRCELIQ",33,0)
 S DIR("?",1)="If you want to make further liquidations on this obligation",DIR("?")="enter (Y)es, <RETURN> or '^' to quit" D ^DIR K DIR I Y G EN2
"RTN","PRCELIQ",34,0)
 D SHOW
"RTN","PRCELIQ",35,0)
 S DIR("A")="Would you like to select another 1358 (obligation number)",DIR(0)="YO",DIR("?",1)="Enter yes to make liquidations on a different 1358 obligation"
"RTN","PRCELIQ",36,0)
 S DIR("?")="<RETURN> or '^' to quit",DIR("B")="Yes" D ^DIR K DIR I Y G EN
"RTN","PRCELIQ",37,0)
EXIT K DIRUT,DTOUT,DUOUT,DIRUT,DIROUT,%,^TMP($J,"PRCE","LIQ"),ZX1
"RTN","PRCELIQ",38,0)
 Q
"RTN","PRCELIQ",39,0)
SCREEN ;display balance data prior to posting
"RTN","PRCELIQ",40,0)
 K OUT S:'$D(CNT) CNT=0
"RTN","PRCELIQ",41,0)
 D HILO^PRCFQ W @IOF,IOINHI,"Post Liquidation to 1358",IOINLOW,?40,"Obligation #: ",IOINHI,$P(PO(0),"^")
"RTN","PRCELIQ",42,0)
 W !?20,IOINLOW,"Status: ",IOINHI,$S(+$P(PO(7),"^")>0:$P(^PRCD(442.3,$P(PO(7),"^"),0),"^"),1:"Unknown"),!!,IOINLOW,"Current amount obligated: ",IOINHI,"$ "_$FN($P(PO(8),U),",",2),IOINLOW
"RTN","PRCELIQ",43,0)
 W ?40,"   Authorization Balance: ",IOINHI,"$ "_$FN(+PO(8)-$P(PO(8),"^",3),",",2),IOINLOW,!!?41,"Unliquidated Balance: ",IOINHI,"$ "_$FN(+PO(8)-$P(PO(8),"^",2),",",2),IOINORM,!!
"RTN","PRCELIQ",44,0)
 S PRCUNLIQ=+PO(8)-(+$P(PO(8),U,2))
"RTN","PRCELIQ",45,0)
 S DIR(0)="YO",DIR("B")="No",DIR("A")="Do you wish to display/print the entire 1358"_$S($G(PRCOUNT)="":"",1:" again") D ^DIR K DIR I 'Y K PRCOUNT S OUT=""
"RTN","PRCELIQ",46,0)
 I Y S PRCSQ=1,DA=$P(PO(0),"^",12) D @$S($D(PRCFD("PAYMENT")):"EN1^PRCEFIS5",1:"^PRCEFIS5") K PRCSQ S PRCOUNT=1 G SCREEN
"RTN","PRCELIQ",47,0)
 K OUT
"RTN","PRCELIQ",48,0)
 Q
"RTN","PRCELIQ",49,0)
OVER ;over drawn notice
"RTN","PRCELIQ",50,0)
 N X
"RTN","PRCELIQ",51,0)
 S X=LAMT+$P(PO(8),U,2)-PO(8)
"RTN","PRCELIQ",52,0)
 W !,$C(7),"This amount EXCEEDS available funds by $ ",$FN(X,",",2),".",!
"RTN","PRCELIQ",53,0)
 S X="Liquidating an amount this large CANNOT occur until the responsible service has submitted and Fiscal obligates an increase adjustment." D MSG^PRCFQ
"RTN","PRCELIQ",54,0)
 Q:$P($G(PO(0)),U,3)=""  N MSG,XMSUB,XMDUZ,XMTEXT,CP,ZX S CP=+$P(PO(0),U,3)
"RTN","PRCELIQ",55,0)
 W !! S X="Control point being notified...." D MSG^PRCFQ W !!
"RTN","PRCELIQ",56,0)
 S MSG(1)="        ***    NOTICE   ***",MSG(2)=" ",MSG(3)="On "_$E(LD,4,5)_"/"_$E(LD,6,7)_"/"_$E(LD,2,3)_" Fiscal Service attempted to process a payment against"
"RTN","PRCELIQ",57,0)
 S MSG(4)="PAT#: "_$P($G(PO(0)),U)_" for $ "_$FN(LAMT,",",2)_".  The payment WAS NOT processed due to",MSG(5)="INSUFFICIENT FUNDS on the obligation."
"RTN","PRCELIQ",58,0)
 S MSG(6)=" ",MSG(7)="Review and take appropriate action on the above PAT Reference Number."
"RTN","PRCELIQ",59,0)
 S MSG(8)="Payment CANNOT be processed until action has been taken."
"RTN","PRCELIQ",60,0)
 S XMTEXT="MSG(",XMSUB="1358 PAYMENT NOT PROCESSED"
"RTN","PRCELIQ",61,0)
 S ZX=0 F  S ZX=$O(^PRC(420,PRC("SITE"),1,CP,1,ZX)) Q:'ZX  I $P($G(^(ZX,0)),U,2)<3 S XMY(ZX)="",XMY(ZX,1)="I"
"RTN","PRCELIQ",62,0)
 D:$O(XMY(0)) ^XMD
"RTN","PRCELIQ",63,0)
 Q
"RTN","PRCELIQ",64,0)
DEL S DIK="^PRC(424," D WAIT^PRCFYN,^DIK K DIK S X="Liquidation entry deleted*" D MSG^PRCFQ G EXIT
"RTN","PRCELIQ",65,0)
 ;
"RTN","PRCELIQ",66,0)
SHOW ;show all transactions posted
"RTN","PRCELIQ",67,0)
 N ZDA,ZTOT
"RTN","PRCELIQ",68,0)
 Q:'$D(^TMP($J,"PRCE","LIQ"))
"RTN","PRCELIQ",69,0)
 S ZTOT=0 W:$D(IOF) @IOF,!!,?27,"Obligation #:  ",$P(PO(0),"^")
"RTN","PRCELIQ",70,0)
 W !!,"Sequence #",?40,"Amount",!! S ZDA="" F  S ZDA=$O(^TMP($J,"PRCE","LIQ",ZDA)) Q:'ZDA  W ?6,$P(ZDA,"-",3),?36,$J(^TMP($J,"PRCE","LIQ",ZDA),10,2),! S ZTOT=ZTOT+^TMP($J,"PRCE","LIQ",ZDA)
"RTN","PRCELIQ",71,0)
 W !!,?29,"Total: ",$J(ZTOT,10,2),!!
"RTN","PRCELIQ",72,0)
 Q
"RTN","PRCESOM")
0^17^B63270948^B60435984
"RTN","PRCESOM",1,0)
PRCESOM ;WISC/SJG/ASU - CONTINUATION OF 1358 ADJUST OBLIAGTION PRCEADJ1 ;4/27/94  2:13 PM
"RTN","PRCESOM",2,0)
V ;;5.1;IFCAP;**148,153,180**;Oct 20, 2000;Build 5
"RTN","PRCESOM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCESOM",4,0)
 ;
"RTN","PRCESOM",5,0)
 ;PRC*5.1*180 RGB 10/22/12  Added switch PRCE424 coming from 1358 processing
"RTN","PRCESOM",6,0)
 ;to insure new entry check (EN1^PRCSUT3) uses file 424, not file 410.
"RTN","PRCESOM",7,0)
 ;
"RTN","PRCESOM",8,0)
 N TI,PRCFASYS,IOINLOW,IOINHI,IOINORM,DIR,AMT,OLDTT,CS,HASH,DIE,DR,LAUTH,LBAL,TAUTH,TBAL,DLAYGO
"RTN","PRCESOM",9,0)
 D SCREEN
"RTN","PRCESOM",10,0)
 S PRC("CP")=$P(TRNODE(0),"-",4)
"RTN","PRCESOM",11,0)
 S PRC("RBDT")=$P(TRNODE(0),U,11)
"RTN","PRCESOM",12,0)
 I $G(PRCRGS)<1 D OVCOM1^PRCFFU10 I PRCFA("OVCOM")=1!(PRCFA("OVCOM")=2) D REQFAIL^PRCFFU10,MSG G OUT
"RTN","PRCESOM",13,0)
 ; PRC*5.1*148 start
"RTN","PRCESOM",14,0)
 ; if Obligator is a requestor, violation to segregation of duties
"RTN","PRCESOM",15,0)
 I $P($G(TRNODE(7)),"^",1)=DUZ D  S Y=0 D MSG G OUT
"RTN","PRCESOM",16,0)
 . W !!,"You are the CP Clerk (Requestor) on this 1358 transaction."
"RTN","PRCESOM",17,0)
 . W !,"Per Segregation of Duties, the CP Clerk (Requestor)"
"RTN","PRCESOM",18,0)
 . W " is not permitted to "
"RTN","PRCESOM",19,0)
 . W $S($G(PRCFA("RETRAN")):"Rebuild/Retransmit",1:"Obligate")," the 1358."
"RTN","PRCESOM",20,0)
 . I '$G(PRCFA("RETRAN")) Q
"RTN","PRCESOM",21,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",22,0)
 . R X:DTIME Q
"RTN","PRCESOM",23,0)
 ; if Obligator is a approver, violation to segregation of duties
"RTN","PRCESOM",24,0)
 I $P($G(TRNODE(7)),"^",3)=DUZ D  S Y=0 D MSG G OUT
"RTN","PRCESOM",25,0)
 . W !!,"You are the Approver on this 1358 transaction."
"RTN","PRCESOM",26,0)
 . W !,"Per Segregation of Duties, the Approver is not permitted to "
"RTN","PRCESOM",27,0)
 . W $S($G(PRCFA("RETRAN")):"Rebuild/Retransmit",1:"Obligate")," the 1358."
"RTN","PRCESOM",28,0)
 . I '$G(PRCFA("RETRAN")) Q
"RTN","PRCESOM",29,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",30,0)
 . R X:DTIME Q
"RTN","PRCESOM",31,0)
 ; PRC*5.1*148 end
"RTN","PRCESOM",32,0)
 ;
"RTN","PRCESOM",33,0)
 D OKAY2^PRCFFU ; ask 'OK to continue?'
"RTN","PRCESOM",34,0)
 I 'Y!($D(DIRUT)) D MSG G OUT
"RTN","PRCESOM",35,0)
 S AMT=$P(TRNODE(4),U,8)
"RTN","PRCESOM",36,0)
K F I=7,9 S AMT(I)=$P(TRNODE(3),"^",I) S:AMT(I)<0 AMT(I)=-AMT(I) S AMT(I)=AMT(I)*100
"RTN","PRCESOM",37,0)
 S PRC("CP")=$P(TRNODE(0),"-",4)
"RTN","PRCESOM",38,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(+PO)
"RTN","PRCESOM",39,0)
 S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCESOM",40,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^",2)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCESOM",41,0)
 S PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCESOM",42,0)
 S PRCFA("PATNUM")=$P($P(PO(0),U),"-",2)
"RTN","PRCESOM",43,0)
 S PRCFA("PODA")=PODA
"RTN","PRCESOM",44,0)
 S PRCFA("REF")=$P(PO(0),U)
"RTN","PRCESOM",45,0)
 ; S PRCFA("SFC")=$P(PO(0),U,19)
"RTN","PRCESOM",46,0)
 S PRCFA("SYS")="FMS"
"RTN","PRCESOM",47,0)
 S PRCFA("TT")="SO"
"RTN","PRCESOM",48,0)
 I $D(GECSDATA),$G(GECSDATA(2100.1,GECSDATA,.01,"E"))[("AR-") S PRCFA("TT")="AR"
"RTN","PRCESOM",49,0)
EDIT ; 
"RTN","PRCESOM",50,0)
 I $G(PRCFA("ACCEDIT"))=1 D TAG33^PRCFFU9 ; sets PRCFA("PPT") & PRCFA("MOMREQ")
"RTN","PRCESOM",51,0)
 I $G(PRCFA("RETRAN"))=1 D TAG33^PRCFFU9 ; sets PRCFA("PPT") & PRCFA("MOMREQ")
"RTN","PRCESOM",52,0)
 ;
"RTN","PRCESOM",53,0)
 ; Compare adjustment to original 1358
"RTN","PRCESOM",54,0)
 N RETURN,ERFLAG,IDFLAG,TYPE
"RTN","PRCESOM",55,0)
 S RETURN=$$COMP^PRCFFU6(PRC442,PRC410,.RETURN)
"RTN","PRCESOM",56,0)
 S ERFLAG=$P(RETURN,U,1)
"RTN","PRCESOM",57,0)
 S IDFLAG=$P(RETURN,U,2)
"RTN","PRCESOM",58,0)
 S TYPE=$P(RETURN,U,2)
"RTN","PRCESOM",59,0)
 I ERFLAG D  Q 
"RTN","PRCESOM",60,0)
 . W !!,"  Cannot continue...one or more of the following fields have changed..."
"RTN","PRCESOM",61,0)
 . N LOOP S LOOP=""
"RTN","PRCESOM",62,0)
 . F  S LOOP=$O(PRCFA("CHG",LOOP)) Q:LOOP=""  I PRCFA("CHG",LOOP)]"" W !,?5,PRCFA("CHG",LOOP)
"RTN","PRCESOM",63,0)
 . K PRCFA("CHG")
"RTN","PRCESOM",64,0)
 . W !!,"  Please be sure that the VENDOR, FUND CONTROL POINT, BOC, and COST CENTER",!,"  fields are the same as the original 1358 obligation!"
"RTN","PRCESOM",65,0)
 . D MSG
"RTN","PRCESOM",66,0)
 . D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",67,0)
 . R X:DTIME
"RTN","PRCESOM",68,0)
 . D OUT
"RTN","PRCESOM",69,0)
 . Q
"RTN","PRCESOM",70,0)
 ;
"RTN","PRCESOM",71,0)
DT I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D  G DT1
"RTN","PRCESOM",72,0)
 . D RETRANM^PRCESOE2 ; get account & obligation processing dates
"RTN","PRCESOM",73,0)
 . S Y=PRCFA("OBLDATE")
"RTN","PRCESOM",74,0)
 S Y=PRC("RBDT") I Y<DT!'Y D NOW^%DTC S Y=X
"RTN","PRCESOM",75,0)
DT1 D D^PRCFQ ; convert date to external format
"RTN","PRCESOM",76,0)
 S %DT="AEX"
"RTN","PRCESOM",77,0)
 S %DT("A")="Select Obligation Processing Date: "
"RTN","PRCESOM",78,0)
 S %DT("B")=Y
"RTN","PRCESOM",79,0)
 W ! D ^%DT
"RTN","PRCESOM",80,0)
 K %DT
"RTN","PRCESOM",81,0)
 I Y<0 D MSG,OUT H 3 Q
"RTN","PRCESOM",82,0)
 S PRCFA("OBLDATE")=Y
"RTN","PRCESOM",83,0)
 S EXIT=0
"RTN","PRCESOM",84,0)
 D ENM^PRCESOE2
"RTN","PRCESOM",85,0)
 I EXIT D  H 3 Q
"RTN","PRCESOM",86,0)
 . D MSG
"RTN","PRCESOM",87,0)
 . D OUT
"RTN","PRCESOM",88,0)
 . D KILL^PRCESOE2
"RTN","PRCESOM",89,0)
 I PRC("RBDT")'<$P(^PRC(420,PRC("SITE"),0),"^",9),$P($$DATE^PRC0C(PRCFA("OBLDATE"),"I"),U,1,2)'=$P($$DATE^PRC0C(PRC("RBDT"),"I"),U,1,2) D MSG1^PRCFFUD G DT
"RTN","PRCESOM",90,0)
 D GENDIQ^PRCFFU7(442,+PO,".1;.07;.03;17","IEN","")
"RTN","PRCESOM",91,0)
 ;
"RTN","PRCESOM",92,0)
 D  I "^SO^AR^"'[("^"_$P(PRCFA("TT"),":",1)) D MSG S Y=1 G OUT
"RTN","PRCESOM",93,0)
 . N PRCFATT S PRCFATT=PRCFA("TT")
"RTN","PRCESOM",94,0)
 . D SOAR^PRC0E(PRCFA("PODA"),.PRCFATT,1) ; ask SO or AR, if appropriate
"RTN","PRCESOM",95,0)
 . S PRCFA("TT")=PRCFATT K PRCFATT
"RTN","PRCESOM",96,0)
 ;
"RTN","PRCESOM",97,0)
 I PRCFA("TT")="AR" D  I "EM"'[X D MSG S Y=1 G OUT
"RTN","PRCESOM",98,0)
 . N Y
"RTN","PRCESOM",99,0)
 . D SC^PRC0A("",.Y,"Label document action as: ","AOM^E:Original Entry;M:Modification Entry","M")
"RTN","PRCESOM",100,0)
 . I $E(Y)="E" S PRCFA("MOD")="E^0^Original Entry"
"RTN","PRCESOM",101,0)
 . I $E(Y)="M" S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCESOM",102,0)
 . S X=$E(Y)
"RTN","PRCESOM",103,0)
 . K Y
"RTN","PRCESOM",104,0)
 S X=0
"RTN","PRCESOM",105,0)
 I $G(PRCFA("RETRAN"))=1,"^SO^AR"[("^"_$E(PRCFA("TT"),1,2)),$P(PRCFA("GECS"),"^",1,2)'=($E(PRCFA("TT"),1,2)_"^"_$E(PRCFA("MOD"))) D  I X="^" D MSG,PAUSE^PRCFFERU S Y=1 G OUT
"RTN","PRCESOM",106,0)
 . S PRCFA("SIS")=$$GETTXNS^PRCFFERT(PO,PRC410,21) ; get other FMS txns for this adjustment
"RTN","PRCESOM",107,0)
 . S X=$$NEWCHK^PRCFFERT(PRCFA("TT"),$E(PRCFA("MOD")),PRCFA("SIS")) ; if selected txn exists, X will be DOCID
"RTN","PRCESOM",108,0)
 . I X=0 S PRCFA("RETRAN")=2 ; selected txn doesn't exist, create
"RTN","PRCESOM",109,0)
 . I X'=0 S X=$$SWITCH^PRCFFERT(X,21,.GECSDATA) ; is selected txn available?
"RTN","PRCESOM",110,0)
 ;
"RTN","PRCESOM",111,0)
GO ; Prompt use for final go-ahead for the document creation
"RTN","PRCESOM",112,0)
 D GO^PRCFFU
"RTN","PRCESOM",113,0)
 I 'Y!($D(DIRUT)) D MSG,OUT Q
"RTN","PRCESOM",114,0)
 ;
"RTN","PRCESOM",115,0)
ESIG ; Enter the Electronic Signature and away it goes!
"RTN","PRCESOM",116,0)
 W !,"The Electronic Signature must now be entered to generate the "_PRCFA("TYPE")_" Document.",!
"RTN","PRCESOM",117,0)
 D SIG^PRCFFU4
"RTN","PRCESOM",118,0)
 I $D(PRCFA("SIGFAIL")) K PRCFA("SIGFAIL") H 3 D MSG,OUT Q
"RTN","PRCESOM",119,0)
 ;
"RTN","PRCESOM",120,0)
 ; Check fund/year dictionary for FMS required fields
"RTN","PRCESOM",121,0)
 D EDIT^PRCFFU ; sets up PRCFMO array for req'd fields
"RTN","PRCESOM",122,0)
 ;
"RTN","PRCESOM",123,0)
 D EDIT410^PRCFFUD(OB,"O") ; edit running balance qtr & status in 410
"RTN","PRCESOM",124,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D SET1358^PRCFFERT ; do rebuild
"RTN","PRCESOM",125,0)
 ;
"RTN","PRCESOM",126,0)
STACK ; Create entry in GECS Stack File
"RTN","PRCESOM",127,0)
 D STACK^PRCFFU(1) ; CTL,BAT,DOC segments, (1) creates batch# for FMS doc
"RTN","PRCESOM",128,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G SEGS
"RTN","PRCESOM",129,0)
 ;
"RTN","PRCESOM",130,0)
UPDATE ; Update records in 442 and 410
"RTN","PRCESOM",131,0)
 W !!,"...updating obligation balances....please hold...",!!
"RTN","PRCESOM",132,0)
 D POADJ^PRCH58OB(.PO,PODA,.TRNODE,AMT)
"RTN","PRCESOM",133,0)
 D POADJ^PRCS58OB(.PRC,PODA,TRDA,AMT)
"RTN","PRCESOM",134,0)
 D:AMT>0 BULC^PRCH58(PODA)
"RTN","PRCESOM",135,0)
 D UPDATE^PRCFFU6(PRC442,PRC410) ; update node 22 of file 442
"RTN","PRCESOM",136,0)
 ;
"RTN","PRCESOM",137,0)
SEGS ; Use TMP($J to store remaining segments to be built
"RTN","PRCESOM",138,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOM",139,0)
 N FMSINT S FMSINT=+PO
"RTN","PRCESOM",140,0)
 S FMSMOD=$P(PRCFA("MOD"),U,1)
"RTN","PRCESOM",141,0)
 D NEW^PRCFFU1(FMSINT,PRCFA("TT"),FMSMOD) ; build segments
"RTN","PRCESOM",142,0)
 ;
"RTN","PRCESOM",143,0)
 ; Transfer nodes from TMP($J, into GECS Stack File
"RTN","PRCESOM",144,0)
 N LOOP S LOOP=0
"RTN","PRCESOM",145,0)
 F  S LOOP=$O(^TMP($J,"PRCMO",GECSFMS("DA"),LOOP)) Q:'LOOP  D SETCS^GECSSTAA(GECSFMS("DA"),^(LOOP))
"RTN","PRCESOM",146,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOM",147,0)
 ;
"RTN","PRCESOM",148,0)
TRANS ; Mark the document as queued for transmission
"RTN","PRCESOM",149,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCESOM",150,0)
 N P2 S P2=+PO
"RTN","PRCESOM",151,0)
 S $P(P2,"/",4)=+TRDA
"RTN","PRCESOM",152,0)
 S $P(P2,"/",5)=$P(PRCFA("ACCPD"),U)
"RTN","PRCESOM",153,0)
 S $P(P2,"/",6)=PRCFA("OBLDATE")
"RTN","PRCESOM",154,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),P2) ; save P2 as node 26 of 2100.1
"RTN","PRCESOM",155,0)
 ;
"RTN","PRCESOM",156,0)
POBAL ; Enter Obligation Data into Purchase Order Record
"RTN","PRCESOM",157,0)
 ; Log transaction into node 10 of file 442
"RTN","PRCESOM",158,0)
 D EN7^PRCFFU41(PRCFA("TT"),FMSMOD,PODATE,PRCFA("PATNUM"))
"RTN","PRCESOM",159,0)
 ;
"RTN","PRCESOM",160,0)
 ; Continue processing if this is not a rebuild
"RTN","PRCESOM",161,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G OUT
"RTN","PRCESOM",162,0)
Z S (X,Z)=$P(PO(0),U)
"RTN","PRCESOM",163,0)
 S %=1,PRCE424=1 D EN1^PRCSUT3 K PRCE424       ;PRC*5.1*180
"RTN","PRCESOM",164,0)
 I $D(MSG),MSG'="" W !!,MSG K MSG Q            ;PRC*5.1*180 
"RTN","PRCESOM",165,0)
 S DLAYGO=424
"RTN","PRCESOM",166,0)
 S DIC="^PRC(424,"
"RTN","PRCESOM",167,0)
 S DIC(0)="L"
"RTN","PRCESOM",168,0)
 D FILE^DICN
"RTN","PRCESOM",169,0)
 I Y<0 W !,"ERROR IN CREATING 424 RECORD",$C(7),!! Q
"RTN","PRCESOM",170,0)
 ;
"RTN","PRCESOM",171,0)
 S DIE="^PRC(424,"
"RTN","PRCESOM",172,0)
 S DA(1358)=+Y
"RTN","PRCESOM",173,0)
 D NOW^%DTC
"RTN","PRCESOM",174,0)
 S TI=%
"RTN","PRCESOM",175,0)
 S DA=DA(1358)
"RTN","PRCESOM",176,0)
 S DR=".02///^S X=PODA;.03///^S X=""A"";.06///^S X=$P(TRNODE(4),U,8);.07///^S X=TI;.08////^S X=DUZ;1.1////^S X=""ADJUSTMENT OBLIGATION"";.15////^S X=TRDA"
"RTN","PRCESOM",177,0)
 D ^DIE W "...adjustment completed..."
"RTN","PRCESOM",178,0)
 ;
"RTN","PRCESOM",179,0)
 ;Generate 1358 transaction message to OLCS. Messages will be generated
"RTN","PRCESOM",180,0)
 ;upon obligation of a new 1358 or an adjustment. Messages will not be
"RTN","PRCESOM",181,0)
 ;sent for a rebuild or retransmission to FMS. (PRC*5.1*153)
"RTN","PRCESOM",182,0)
 I $G(PRCFA("RETRAN"))=0 D OLCSMSG^PRCFDO
"RTN","PRCESOM",183,0)
 ;
"RTN","PRCESOM",184,0)
 G OUT
"RTN","PRCESOM",185,0)
 Q
"RTN","PRCESOM",186,0)
 ;
"RTN","PRCESOM",187,0)
SCREEN ;COMPARISON SCREEN
"RTN","PRCESOM",188,0)
 N CEILING,LAUTH,TAUTH,TBAL,LBAL,IOINHI,IOINLOW,IOINORM
"RTN","PRCESOM",189,0)
 D HILO^PRCFQ
"RTN","PRCESOM",190,0)
 S CEILING=$P(PO(8),U)
"RTN","PRCESOM",191,0)
 W @IOF,IOINLOW,"Adjustment Transaction # ",IOINHI,$P(TRNODE(0),"^")
"RTN","PRCESOM",192,0)
 W IOINLOW,"     1358 # ",IOINHI,$P(PO(0),"^")
"RTN","PRCESOM",193,0)
 W !!,IOINLOW,"Current amount obligated on 1358: ",IOINHI,"  $ ",$FN(CEILING,"P,",2)
"RTN","PRCESOM",194,0)
 S TBAL=$P(PO(8),U,3)
"RTN","PRCESOM",195,0)
 S TAUTH=CEILING-TBAL
"RTN","PRCESOM",196,0)
 W !!,IOINLOW," Total Authorizations: ",IOINHI," $ ",$J($FN(TAUTH,"P,",2),12)
"RTN","PRCESOM",197,0)
 S LBAL=$P(PO(8),U,2),LAUTH=CEILING-LBAL
"RTN","PRCESOM",198,0)
 W ?40,IOINLOW," Total Liquidations: ",IOINHI," $ ",$J($FN(LAUTH,",P",2),12)
"RTN","PRCESOM",199,0)
 W !,IOINLOW,"Authorization Balance: ",IOINHI," $ ",$J($FN(TBAL,"P,",2),12)
"RTN","PRCESOM",200,0)
 W ?40,IOINLOW,"Liquidation Balance: ",IOINHI," $ ",$J($FN(LBAL,"P,",2),12),!!
"RTN","PRCESOM",201,0)
 W IOINLOW,"Amount of Adjustment: ",IOINHI,$J($P(TRNODE(4),"^",8),0,2),!!,IOINORM
"RTN","PRCESOM",202,0)
 Q
"RTN","PRCESOM",203,0)
MSG W !
"RTN","PRCESOM",204,0)
 S X="No further processing is being taken on this 1358 adjustment obligation.  It has NOT been obligated.*"
"RTN","PRCESOM",205,0)
 D MSG^PRCFQ
"RTN","PRCESOM",206,0)
 Q
"RTN","PRCESOM",207,0)
OUT K DIRUT,DTOUT,DUOUT,DIROUT
"RTN","PRCESOM",208,0)
 QUIT
"RTN","PRCFFMOM")
0^3^B87570061^B80432218
"RTN","PRCFFMOM",1,0)
PRCFFMOM ;WOIFO/SJG/AS-ROUTINE TO PROCESS AMENDMENT OBLIGATIONS ;3/8/05
"RTN","PRCFFMOM",2,0)
V ;;5.1;IFCAP;**81,180**;Oct 20, 2000;Build 5
"RTN","PRCFFMOM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCFFMOM",4,0)
 ;
"RTN","PRCFFMOM",5,0)
 ;PRC*5.1*180 Added check for Delivery Date change to send document
"RTN","PRCFFMOM",6,0)
 ;            to FMS
"RTN","PRCFFMOM",7,0)
 ;
"RTN","PRCFFMOM",8,0)
 D ^PRCFSITE Q:'%  ; ask station
"RTN","PRCFFMOM",9,0)
 D OUT1 ; kill variables
"RTN","PRCFFMOM",10,0)
 ;
"RTN","PRCFFMOM",11,0)
 ; prompt for signature (E-Sig code for amendment)
"RTN","PRCFFMOM",12,0)
 S MESSAGE=""
"RTN","PRCFFMOM",13,0)
 D ESIG^PRCUESIG(DUZ,.MESSAGE)
"RTN","PRCFFMOM",14,0)
 I MESSAGE<1 D  G OUT1 ; exit if bad response
"RTN","PRCFFMOM",15,0)
 . I (MESSAGE=0)!(MESSAGE=-3) W !,$C(7),"  SIGNATURE CODE FAILURE " R X:3 ;3 TRIES or NO SIG ON FILE
"RTN","PRCFFMOM",16,0)
 . I (MESSAGE=-1)!(MESSAGE=-2) Q  ;ARROWED OUT or TIMED OUT
"RTN","PRCFFMOM",17,0)
 ;
"RTN","PRCFFMOM",18,0)
START ; get PO#
"RTN","PRCFFMOM",19,0)
 K PRCFA
"RTN","PRCFFMOM",20,0)
 K DIC("A")
"RTN","PRCFFMOM",21,0)
 S D="E"
"RTN","PRCFFMOM",22,0)
 S DIC=443.6
"RTN","PRCFFMOM",23,0)
 S DIC("S")="I +^(0)=PRC(""SITE"") S FSO=$O(^PRC(443.6,""D"",+Y,0)) I FSO=26!(FSO=31)!(FSO=36)!(FSO=45)!(FSO=71)"
"RTN","PRCFFMOM",24,0)
 S DIC("A")="Select Purchase Order Number: "
"RTN","PRCFFMOM",25,0)
 S DIC(0)="AEQZ"
"RTN","PRCFFMOM",26,0)
 D IX^DIC
"RTN","PRCFFMOM",27,0)
 K DIC("S"),DIC("A")
"RTN","PRCFFMOM",28,0)
 K FSO
"RTN","PRCFFMOM",29,0)
 G:+Y<0 OUT1
"RTN","PRCFFMOM",30,0)
 S FLG=0
"RTN","PRCFFMOM",31,0)
 S PO=Y,PO(0)=Y(0)
"RTN","PRCFFMOM",32,0)
 S PRCFA("PODA")=+Y
"RTN","PRCFFMOM",33,0)
 S PRCFPODA=+Y
"RTN","PRCFFMOM",34,0)
 I '$D(^PRC(443.6,+PO,6)) D NOA G OUT1 ; PO has no amendments
"RTN","PRCFFMOM",35,0)
 I $P(^PRC(443.6,+PO,6,0),"^",4)<0 D NOA G OUT1 ; PO has no amendments
"RTN","PRCFFMOM",36,0)
 I '$$VERIFY^PRCHES5(PRCFPODA) D MSG1 G OUT1 ; tampered PO
"RTN","PRCFFMOM",37,0)
 ;
"RTN","PRCFFMOM",38,0)
 ; get amendment #
"RTN","PRCFFMOM",39,0)
AMEND S DIC="^PRC(443.6,"_+PO_",6,"
"RTN","PRCFFMOM",40,0)
 S DIC("A")="Select AMENDMENT: "
"RTN","PRCFFMOM",41,0)
 S DIC(0)="AEMNZQ"
"RTN","PRCFFMOM",42,0)
 D ^DIC
"RTN","PRCFFMOM",43,0)
 K DIC("A")
"RTN","PRCFFMOM",44,0)
 G:Y<0 OUT1
"RTN","PRCFFMOM",45,0)
 S PO(6)=Y(0)
"RTN","PRCFFMOM",46,0)
 S PO(6,1)=^PRC(443.6,+PO,6,+Y,1)
"RTN","PRCFFMOM",47,0)
 S PRCFA("AMEND#")=+Y
"RTN","PRCFFMOM",48,0)
 S PRCFAA=+Y
"RTN","PRCFFMOM",49,0)
 ;
"RTN","PRCFFMOM",50,0)
DESC ; verify amendment is complete
"RTN","PRCFFMOM",51,0)
 I $$CHKAMEN^PRCFFU(+PO,PRCFAA) W !,?15,"Return Amendment to A&MM.",! G START
"RTN","PRCFFMOM",52,0)
 I $P($G(PO(6,1)),U,2)="" D  G START
"RTN","PRCFFMOM",53,0)
 . W ! D EN^DDIOL("This amendment is still awaiting signature by A&MM!")
"RTN","PRCFFMOM",54,0)
 . W !
"RTN","PRCFFMOM",55,0)
 ;
"RTN","PRCFFMOM",56,0)
 ; set up variables used in this option
"RTN","PRCFFMOM",57,0)
 S PRCFA("RETRAN")=0
"RTN","PRCFFMOM",58,0)
 S D0=+PO
"RTN","PRCFFMOM",59,0)
 S D1=+Y
"RTN","PRCFFMOM",60,0)
 S PRCHPO=PRCFPODA
"RTN","PRCFFMOM",61,0)
 S PRCHAM=PRCFAA
"RTN","PRCFFMOM",62,0)
 D ^PRCHSF3 ; sets up PRCH("AM") array
"RTN","PRCFFMOM",63,0)
 D ^PRCHDAM ; display amendment info
"RTN","PRCFFMOM",64,0)
 D DT442^PRCFFUD1(PRCFPODA,PO(0),443.6,PRCFA("AMEND#")) ; set up PRC array
"RTN","PRCFFMOM",65,0)
RETRAN ; Entry point for rebuild/transmit
"RTN","PRCFFMOM",66,0)
 S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCFFMOM",67,0)
 ;
"RTN","PRCFFMOM",68,0)
 ; check amendment record for availability
"RTN","PRCFFMOM",69,0)
 L +^PRC(443.6,PRCFPODA):1
"RTN","PRCFFMOM",70,0)
 I $T=0 D  G OUT1
"RTN","PRCFFMOM",71,0)
 . W $C(7),!
"RTN","PRCFFMOM",72,0)
 . D EN^DDIOL("This amendment is being obligated by another user!")
"RTN","PRCFFMOM",73,0)
 ;
"RTN","PRCFFMOM",74,0)
 I 'PRCFA("RETRAN"),$O(^PRC(443.6,PRCFPODA,6,PRCFAA,3,"AC",32,0)) N P2237 S P2237=$P(^PRC(443.6,PRCFPODA,0),U,12) I P2237>0 I '$$VERIFY^PRCSC2(P2237) D MSG1 G OUT1 ; tampered PO
"RTN","PRCFFMOM",75,0)
 ;
"RTN","PRCFFMOM",76,0)
 I PRCFA("RETRAN") D DT442^PRCFFUD1(PRCFPODA,PO(0),442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",77,0)
 ;
"RTN","PRCFFMOM",78,0)
 I $G(PRCRGS)<1 D OVCOM^PRCFFU10 I PRCFA("OVCOM")=1!(PRCFA("OVCOM")=2) D POFAIL^PRCFFU10,MSG G OUT1
"RTN","PRCFFMOM",79,0)
 ;
"RTN","PRCFFMOM",80,0)
 S PCP=+$P(PO(0),U,3)
"RTN","PRCFFMOM",81,0)
 S $P(PCP,U,2)=$S($D(^PRC(420,PRC("SITE"),1,+PCP,0)):$P(^(0),U,12),1:"")
"RTN","PRCFFMOM",82,0)
APP W !
"RTN","PRCFFMOM",83,0)
 D OKAM^PRCFFU I 'Y!($D(DIRUT)) G AMEND ; ask OK to amend?
"RTN","PRCFFMOM",84,0)
 D SC^PRCFFUA1 ; display FCP, cost ctr, PO/Req#
"RTN","PRCFFMOM",85,0)
 D CPBAL^PRCFFUA1 ; display cost & balances
"RTN","PRCFFMOM",86,0)
 D GET^PRCFFUA1 ; display amended (BOC) info
"RTN","PRCFFMOM",87,0)
 S FATAL=0
"RTN","PRCFFMOM",88,0)
 D OK^PRCFFUA ; ask if above BOC info is correct
"RTN","PRCFFMOM",89,0)
 S SAVEY=Y
"RTN","PRCFFMOM",90,0)
 I Y D  S Y=SAVEY K SAVEY I FATAL=1 D MSG10^PRCFFUA3 G APP1
"RTN","PRCFFMOM",91,0)
 . D GETBOC^PRCFFUA4
"RTN","PRCFFMOM",92,0)
 . D CHKBOC^PRCFFUA4
"RTN","PRCFFMOM",93,0)
 I 'Y!($D(DIRUT)) D  I FISCEDIT G RETRAN
"RTN","PRCFFMOM",94,0)
 .S FISCEDIT=0
"RTN","PRCFFMOM",95,0)
 .I $D(DIRUT) D MSG9^PRCFFUA3 Q
"RTN","PRCFFMOM",96,0)
 .I 'Y D MSG8^PRCFFUA3,POAM^PRCFFUA Q
"RTN","PRCFFMOM",97,0)
 .Q
"RTN","PRCFFMOM",98,0)
 D KILL^PRCFFUA
"RTN","PRCFFMOM",99,0)
APP1 I FATAL=1 G:PRCFA("RETRAN")=0 START Q:PRCFA("RETRAN")=1
"RTN","PRCFFMOM",100,0)
 I $D(^PRC(443.6,+PO,6)),$P(PO(6,1),"^",5)'="" D   I 'Y!($D(DIRUT)) G OUT1
"RTN","PRCFFMOM",101,0)
 . W !
"RTN","PRCFFMOM",102,0)
 . D OKAPP^PRCFFU ; amendment approved, ask 'continue?'
"RTN","PRCFFMOM",103,0)
PRT W !
"RTN","PRCFFMOM",104,0)
 D OKPRT^PRCFFU S:Y FLG=1 ; print amendment
"RTN","PRCFFMOM",105,0)
 S PRCFA("AMEND#")=PRCFAA
"RTN","PRCFFMOM",106,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(+PO)
"RTN","PRCFFMOM",107,0)
 S PRCFA("IDES")="Purchase Order Amendment Obligation"
"RTN","PRCFFMOM",108,0)
 S PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCFFMOM",109,0)
 S PRCFA("PODA")=PRCFPODA
"RTN","PRCFFMOM",110,0)
 S PRCFA("REF")=$P(PO(0),U)
"RTN","PRCFFMOM",111,0)
 ; the following line commented out in PRC*5*179
"RTN","PRCFFMOM",112,0)
 ; S PRCFA("SFC")=$P(PO(0),U,19)
"RTN","PRCFFMOM",113,0)
 S PRCFA("SYS")="FMS"
"RTN","PRCFFMOM",114,0)
 S PRCFA("TT")=$S(PRCFA("MP")=2:"SO",1:"MO")
"RTN","PRCFFMOM",115,0)
 I $D(GECSDATA),$E($G(GECSDATA(2100.1,GECSDATA,.01,"E")),1,3)="AR-" S PRCFA("TT")="AR"
"RTN","PRCFFMOM",116,0)
PRT1 I PRCFA("MP")=2&(PRCFA("TT")="SO") D  G:ACCEDIT=1 PRT1
"RTN","PRCFFMOM",117,0)
 . W !
"RTN","PRCFFMOM",118,0)
 . D EN^PRCFFU16(+PO)
"RTN","PRCFFMOM",119,0)
PRT11 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D  G PRT2
"RTN","PRCFFMOM",120,0)
 . D RETRANM^PRCFFMO2
"RTN","PRCFFMOM",121,0)
 . S Y=PRCFA("OBLDATE")
"RTN","PRCFFMOM",122,0)
 S Y=$$DTOBL^PRCFFUD1(PRC("RBDT"),PRC("AMENDT"))
"RTN","PRCFFMOM",123,0)
PRT2 D D^PRCFQ
"RTN","PRCFFMOM",124,0)
 S %DT="AEX"
"RTN","PRCFFMOM",125,0)
 S %DT("A")="Select Obligation Processing Date: "
"RTN","PRCFFMOM",126,0)
 S %DT("B")=Y
"RTN","PRCFFMOM",127,0)
 W !
"RTN","PRCFFMOM",128,0)
 D ^%DT
"RTN","PRCFFMOM",129,0)
 K %DT
"RTN","PRCFFMOM",130,0)
 I Y<0 D MSG H 3 G OUT1
"RTN","PRCFFMOM",131,0)
 S PRCFA("OBLDATE")=Y
"RTN","PRCFFMOM",132,0)
 S EXIT=0
"RTN","PRCFFMOM",133,0)
 D ENM^PRCFFMO2
"RTN","PRCFFMOM",134,0)
 I EXIT D MSG,KILL^PRCFFMO2 H 3 G OUT1
"RTN","PRCFFMOM",135,0)
 I PRC("RBDT")'<$P(^PRC(420,PRC("SITE"),0),"^",9),$P($$DATE^PRC0C(PRCFA("OBLDATE"),"I"),U,1,2)'=$P($$DATE^PRC0C(PRC("RBDT"),"I"),U,1,2) D MSG1^PRCFFUD G PRT11
"RTN","PRCFFMOM",136,0)
 D GENDIQ^PRCFFU7(442,+PO,".1;.07;.03;17","IEN","")
"RTN","PRCFFMOM",137,0)
EDIT ; Get budget/accounting elements
"RTN","PRCFFMOM",138,0)
 N PARAM
"RTN","PRCFFMOM",139,0)
 S PARAM=+$P(PO(0),U,3)_"^"_PRC("FY")_"^"_PRCFA("BBFY")
"RTN","PRCFFMOM",140,0)
 S PRCFMO=$$ACC^PRC0C(PRC("SITE"),PARAM)
"RTN","PRCFFMOM",141,0)
 S IDFLAG="I"
"RTN","PRCFFMOM",142,0)
 S XRBLD=0
"RTN","PRCFFMOM",143,0)
 I PRCFA("RETRAN")=1 D EN^PRCFFUB ; if selected transaction to rebuild is a 'X' decrease or cancel, set XRBLD=1, set to 2 if it is the 'E'
"RTN","PRCFFMOM",144,0)
 ;
"RTN","PRCFFMOM",145,0)
 ; determine the correct transaction type if this is not an MO document
"RTN","PRCFFMOM",146,0)
 I PRCFA("TT")'="MO",XRBLD=0 D  I "^AR^SO^"'[("^"_$P(PRCFA("TT"),":",1)) D MSG,OUT1 Q
"RTN","PRCFFMOM",147,0)
 . N PRCFATT S PRCFATT=PRCFA("TT")
"RTN","PRCFFMOM",148,0)
 . D SOAR^PRC0E(PRCFA("PODA"),.PRCFATT,1) ; ask SO or AR, if appropriate
"RTN","PRCFFMOM",149,0)
 . S PRCFA("TT")=PRCFATT K PRCFATT
"RTN","PRCFFMOM",150,0)
 ;
"RTN","PRCFFMOM",151,0)
 I PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^")="AR",PRCFA("TT")="AR" D
"RTN","PRCFFMOM",152,0)
 . I $P(PRCFA("GECS"),"^",2)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCFFMOM",153,0)
 . I $P(PRCFA("GECS"),"^",2)="M" S PRCFA("MOD")="M^1^Modification Document"
"RTN","PRCFFMOM",154,0)
 ;
"RTN","PRCFFMOM",155,0)
 I PRCFA("TT")="AR",XRBLD=0 D  I "EM"'[X D MSG,OUT1 Q
"RTN","PRCFFMOM",156,0)
 . S X="M"
"RTN","PRCFFMOM",157,0)
 . I PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^",2)="E" S X="E"
"RTN","PRCFFMOM",158,0)
 . D SC^PRC0A("",.Y,"Label document action as: ","AOM^E:Original Document;M:Modification Document",X)
"RTN","PRCFFMOM",159,0)
 . I $E(Y)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCFFMOM",160,0)
 . I $E(Y)="M" S PRCFA("MOD")="M^1^Modification Document"
"RTN","PRCFFMOM",161,0)
 . S X=$E(Y)
"RTN","PRCFFMOM",162,0)
 . K Y
"RTN","PRCFFMOM",163,0)
 ;
"RTN","PRCFFMOM",164,0)
 ; check to see if transaction type or document type changed
"RTN","PRCFFMOM",165,0)
 S X=0
"RTN","PRCFFMOM",166,0)
 I XRBLD=0,$G(PRCFA("RETRAN"))=1,"^SO^AR"[("^"_$E(PRCFA("TT"),1,2)),$P(PRCFA("GECS"),"^",1,2)'=($E(PRCFA("TT"),1,2)_"^"_$E(PRCFA("MOD"))) D  I X="^" D MSG,PAUSE^PRCFFERU G OUT1
"RTN","PRCFFMOM",167,0)
 . S PRCFA("SIS")=$$GETTXNS^PRCFFERT(PO,PRCFA("AMEND#"),2) ; get other txns for this amendment
"RTN","PRCFFMOM",168,0)
 . S X=$$NEWCHK^PRCFFERT(PRCFA("TT"),$E(PRCFA("MOD"),1),PRCFA("SIS")) ; does selected txn exist?
"RTN","PRCFFMOM",169,0)
 . I X=0 S PRCFA("RETRAN")=2 ; txn doesn't exist, create
"RTN","PRCFFMOM",170,0)
 . I X'=0 S X=$$SWITCH^PRCFFERT(X,2,.GECSDATA) ; replace current GECSDATA values with values belonging to selected txn-- returns '^' if not switched
"RTN","PRCFFMOM",171,0)
 ;
"RTN","PRCFFMOM",172,0)
GO ; Prompt user for for final go-ahead for approval
"RTN","PRCFFMOM",173,0)
 D GO^PRCFFU
"RTN","PRCFFMOM",174,0)
 I 'Y!($D(DIRUT)) D MSG,OUT1 Q
"RTN","PRCFFMOM",175,0)
ESIG W !,"The Electronic Signature must now be entered to generate the "_PRCFA("TYPE")_" Document.",!
"RTN","PRCFFMOM",176,0)
 D SIG^PRCFFU4
"RTN","PRCFFMOM",177,0)
 I $D(PRCFA("SIGFAIL")) K PRCFA("SIGFAIL") H 3 G OUT1
"RTN","PRCFFMOM",178,0)
 S DA=PRCFA("PODA")
"RTN","PRCFFMOM",179,0)
 D REMOVE^PRCHES14(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",180,0)
 S MESSAGE="" ; value not used but variable is needed by next call
"RTN","PRCFFMOM",181,0)
 D ENCODE^PRCHES14(PRCFA("PODA"),PRCFA("AMEND#"),DUZ,.MESSAGE)
"RTN","PRCFFMOM",182,0)
 ;
"RTN","PRCFFMOM",183,0)
 D DT442^PRCFFUD1(PRCFA("PODA"),"",442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",184,0)
 S PRCOAMT=+^PRC(442,PRCFA("PODA"),0)
"RTN","PRCFFMOM",185,0)
 S $P(PRCOAMT,"^",2)=+$P(^PRC(442,PRCFA("PODA"),0),"^",3)
"RTN","PRCFFMOM",186,0)
 S $P(PRCOAMT,"^",3)=PRC("FYQDT")
"RTN","PRCFFMOM",187,0)
 S $P(PRCOAMT,"^",5)=-$P(^PRC(442,PRCFA("PODA"),0),"^",$P(PRCFMO,"^",12)="N"+15)
"RTN","PRCFFMOM",188,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G TRANS1
"RTN","PRCFFMOM",189,0)
TRANS W !!,"...copying amendment information back to Purchase Order file...",! D WAIT^DICD
"RTN","PRCFFMOM",190,0)
 S ERFLAG=""
"RTN","PRCFFMOM",191,0)
 S PRCFA("DLVDATE")=$P(^PRC(442,PRCFA("PODA"),0),"^",10)
"RTN","PRCFFMOM",192,0)
 D CHECK^PRCHAMYA(PRCFA("PODA"),PRCFA("AMEND#"),.ERFLAG)
"RTN","PRCFFMOM",193,0)
 I ERFLAG W !!,"...ERROR IN COPYING AMENDMENT INFORMATION BACK TO PURCHASE ORDER FILE..." G OUT1
"RTN","PRCFFMOM",194,0)
TRANS1 D DT442^PRCFFUD1(PRCFA("PODA"),"",442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",195,0)
 ;  transmit amendment from IFCAP to DynaMed   **81**
"RTN","PRCFFMOM",196,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 D
"RTN","PRCFFMOM",197,0)
 . ; No DynaMed interface if rebuild/retransmit
"RTN","PRCFFMOM",198,0)
 . I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 Q
"RTN","PRCFFMOM",199,0)
 . D ENT^PRCVPOU(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",200,0)
 S PRCFA("OLDPODA")=PRCFA("PODA")
"RTN","PRCFFMOM",201,0)
 S PRCFA("OLDREF")=PRCFA("REF")
"RTN","PRCFFMOM",202,0)
 I PRCFA("RETRAN")>0 I XRBLD=1!(XRBLD=2) D GO^PRCFFUB H 3 Q  ; if rebuilding a 'dependent' transaction, finish work here
"RTN","PRCFFMOM",203,0)
 D LIST^PRCFFU7(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",204,0)
 I $P(^PRC(442,PRCFA("PODA"),0),U,20),($P(^PRC(442,PRCFA("PODA"),0),U,10)'=$P(^PRC(442,PRCFA("PODA"),0),U,20)) D       ;PRC*5.1*180 Check for Del Date change, if so, send doc to FMS
"RTN","PRCFFMOM",205,0)
 . S PRCFA("MOMREQ")=1,PRCFA("MOMNOTREQ")=0,PRCFA("ZERO")=""                      ;PRC*5.1*180 reset flag to send doc
"RTN","PRCFFMOM",206,0)
 I $G(PRCFA("RETRAN"))<1 D AMEND^PRCFFUD ; create entry in 410
"RTN","PRCFFMOM",207,0)
 I PRCFA("AUTHE") D FCP^PRCFFU11,PRINT G START
"RTN","PRCFFMOM",208,0)
 I 'PRCFA("MOMREQ") D MSG^PRCFFU8 G PRINT ; skip FMS transmit,fiscal updates
"RTN","PRCFFMOM",209,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D SETPO^PRCFFERT
"RTN","PRCFFMOM",210,0)
 I $G(PRCFA("ACCEDIT"))=1 D TAG33^PRCFFU9
"RTN","PRCFFMOM",211,0)
TRANS2 K PO
"RTN","PRCFFMOM",212,0)
 D ^PRCFFM1M
"RTN","PRCFFMOM",213,0)
 L -^PRC(443.6,PRCFA("PODA"))
"RTN","PRCFFMOM",214,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=0 D OUT1^PRCFFM1M G START
"RTN","PRCFFMOM",215,0)
 QUIT
"RTN","PRCFFMOM",216,0)
 ;
"RTN","PRCFFMOM",217,0)
PRINT ; Print out copy of Purchase Order Amendment
"RTN","PRCFFMOM",218,0)
 G:'FLG OUT1
"RTN","PRCFFMOM",219,0)
 S PRCHQ="^PRCHPAM"
"RTN","PRCFFMOM",220,0)
 S PRCHQ("DEST")="S8"
"RTN","PRCFFMOM",221,0)
 S D0=PRCFA("PODA")
"RTN","PRCFFMOM",222,0)
 S D1=PRCFA("AMEND#")
"RTN","PRCFFMOM",223,0)
 D ^PRCHQUE
"RTN","PRCFFMOM",224,0)
OUT1 K FATAL,FLG,%,%Y,DIC,I,J,K,P,PRCFA,PRCFAA,PRCFPODA,PRCFCHG,X,XRBLD,Y,Z
"RTN","PRCFFMOM",225,0)
 Q
"RTN","PRCFFMOM",226,0)
 ; Message processing
"RTN","PRCFFMOM",227,0)
NOA D NOA^PRCFFM3M Q
"RTN","PRCFFMOM",228,0)
MSG D MSG^PRCFFM3M Q
"RTN","PRCFFMOM",229,0)
MSG1 D MSG1^PRCFFM3M Q
"RTN","PRCHAMU")
0^4^B58833091^B54598370
"RTN","PRCHAMU",1,0)
PRCHAMU ;WISC/AKS-Modules helpful in amendments ;8/18/97  9:12
"RTN","PRCHAMU",2,0)
 ;;5.1;IFCAP;**21,117,175,180**;Oct 20, 2000;Build 5
"RTN","PRCHAMU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHAMU",4,0)
 ;Patch PRC*5.1*175 modifies cancel error switch used in template
"RTN","PRCHAMU",5,0)
 ;                  PRCHAMENDPRO to be PRCPROSW. 
"RTN","PRCHAMU",6,0)
 ;   
"RTN","PRCHAMU",7,0)
 ;Patch PRC*5.1*180 Ask Delivery Date field edit each time
"RTN","PRCHAMU",8,0)
 ;                  amendment process is used
"RTN","PRCHAMU",9,0)
 ;  
"RTN","PRCHAMU",10,0)
 W !,"Call at the appropriate entry point",$C(7)
"RTN","PRCHAMU",11,0)
 Q
"RTN","PRCHAMU",12,0)
 ;
"RTN","PRCHAMU",13,0)
GETPO ;get a valid PO
"RTN","PRCHAMU",14,0)
 ;the variable RETURN is either the PO/REQ# or null if no PO is selected
"RTN","PRCHAMU",15,0)
 N DIC,D,Y,X,TRANS,PRCHSTAT
"RTN","PRCHAMU",16,0)
 S DIC="^PRC(442,",DIC(0)="QEAMZ",D="C"
"RTN","PRCHAMU",17,0)
 S DIC("A")=$S($D(PRCHREQ):"REQUISITION NO.: ",1:"PURCHASE ORDER: ")
"RTN","PRCHAMU",18,0)
 S DIC("S")="I +$P(^(0),U)=PRC(""SITE"")"_$S($D(PRCHREQ):",$P(^(0),U,2)=8!($P(^(0),U,2)=25)",1:",$P(^(0),U,2)<8!($P(^(0),U,2)=25)!($P(^(0),U,2)=26)")
"RTN","PRCHAMU",19,0)
 I $G(PRCHAUTH)=1 S DIC("S")="I +$P(^(0),U)=PRC(""SITE""),($P($G(^(23)),U,11)=""P""!($P($G(^(23)),U,11)=""S""))"
"RTN","PRCHAMU",20,0)
 I $G(PRCHAUTH)=2 S DIC("S")="I +$P(^(0),U)=PRC(""SITE""),$P($G(^(23)),U,11)=""D"""
"RTN","PRCHAMU",21,0)
 D ^DIC K DIC I Y<0 S OUT=1 Q
"RTN","PRCHAMU",22,0)
 ;A time-out/up-arrow check before locking the record.
"RTN","PRCHAMU",23,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PRCHAMU",24,0)
 ; Locking the 442 entry i.e. selected by the user to amend. 
"RTN","PRCHAMU",25,0)
 ; This lock is released ONLY at one exit point in EXIT^PRCHMA routine.
"RTN","PRCHAMU",26,0)
 ;
"RTN","PRCHAMU",27,0)
 S PRCENTRY=+Y,OUT=0
"RTN","PRCHAMU",28,0)
 L +^PRC(442,PRCENTRY):1 E  W !!,?5," Someone else is already editing this amendment record." S PRCFL=1 Q
"RTN","PRCHAMU",29,0)
 S X=$S($D(^PRC(442,+Y,7)):$P($G(^PRCD(442.3,+^(7),0)),U,2),1:"")
"RTN","PRCHAMU",30,0)
 I X="" W !,$C(7),"Invalid Supply Status" Q
"RTN","PRCHAMU",31,0)
 I X<20 W !,$C(7),"    This order is not properly signed yet!!" Q
"RTN","PRCHAMU",32,0)
 I X=45 W !,$C(7),"This is a cancelled " W:$D(PRCHREQ) "requisition." W:'$D(PRCHREQ) "purchase order." Q
"RTN","PRCHAMU",33,0)
 I $G(PRCHAUTH)=1 S PCARD=$P($G(^PRC(442,+Y,23)),U,8) D  I $G(PRCHFG) K PCARD,PRCHFG Q
"RTN","PRCHAMU",34,0)
 . I '$D(^PRC(440.5,"C",DUZ,PCARD)) W !,?5,"You are not authorized to amend this purchase card order." S PRCHFG=1
"RTN","PRCHAMU",35,0)
 K PCARD,PRCHFG
"RTN","PRCHAMU",36,0)
 I $G(PRCHAUTH)=2 S PRCHAUCP=$P(^PRC(442,+Y,0),U,3) D  I $G(PRCHAUFG) K PRCHAUCP,PRCHAUFG Q
"RTN","PRCHAMU",37,0)
 . I '$D(^PRC(420,PRC("SITE"),1,+PRCHAUCP,1,DUZ)) D  S PRCHAUFG=1
"RTN","PRCHAMU",38,0)
 . . W !!,"You are not an authorized user for "_$P(PRCHAUCP," ",1,2)_" control point.",!
"RTN","PRCHAMU",39,0)
 K PRCHAUCP,PRCHAUFG
"RTN","PRCHAMU",40,0)
 I '$D(TRANSCMP) I X=40!(X=41) D  Q:$G(TRANS)=1
"RTN","PRCHAMU",41,0)
 .Q:($P(^PRC(442,+Y,0),"^",2)=2)!($P(^PRC(442,+Y,0),"^",2)=4)
"RTN","PRCHAMU",42,0)
 .W $C(7),!!,?5,"Purchase orders (Excluding CERTIFIED INVOICE and GUARANTEED DELIVERY)",!,?5,"with a status of 'Transaction Complete' cannot be amended."
"RTN","PRCHAMU",43,0)
 .S TRANS=1
"RTN","PRCHAMU",44,0)
 I X=50!(X=51) D  Q
"RTN","PRCHAMU",45,0)
 . W $C(7),!!,?5,"Reconciled Purchase Card orders cannot be amended."
"RTN","PRCHAMU",46,0)
 I X=28!(X=33) W $C(7),!,"Amendment not allowed until after order has been obligated!!" Q
"RTN","PRCHAMU",47,0)
 I $D(^PRC(443.6,+Y,0)) S PRCHAM=$O(^PRC(443.6,+Y,6,0)) I PRCHAM="" D  Q
"RTN","PRCHAMU",48,0)
 .W !!?5,"This record is not set-up properly, it is being cleaned-up."
"RTN","PRCHAMU",49,0)
 .W !?5,"Please RE-START the amendment process.",!
"RTN","PRCHAMU",50,0)
 .D DEL
"RTN","PRCHAMU",51,0)
 I $D(^PRC(443.6,+Y,0)) S PRCHAM=$O(^PRC(443.6,+Y,6,0)) Q:PRCHAM'>0  D  Q:$D(FIS)
"RTN","PRCHAMU",52,0)
 .I $P($G(^PRC(443.6,+Y,6,PRCHAM,1)),U,2)]"" D
"RTN","PRCHAMU",53,0)
 ..W !!,?5,"Pending Amendment: ",PRCHAM,"       Status: Pending Fiscal Action" S FIS=1
"RTN","PRCHAMU",54,0)
 D FMS
"RTN","PRCHAMU",55,0)
 I $G(STATUS)]"" I $E(STATUS,1)="R"!($E(STATUS,1)="E") D  K STATUS Q
"RTN","PRCHAMU",56,0)
 .W !!,?5,"One of the previous documents has been rejected by",!,?5,"FMS or has errored in transmission.",!,?5,"This purchase order cannot be amended at this time."
"RTN","PRCHAMU",57,0)
 I $D(^PRC(443.6,+Y,0)) I $D(^PRC(443.6,+Y,11)) W !!,"There is a pending Adjustment Voucher against this purchase order" Q
"RTN","PRCHAMU",58,0)
 I $D(^PRC(443.6,+Y,0)) W $C(7),!!,?5,"*** There is already an amendment pending for this purchase order. ***" S PRCHNEW=111 D  Q:%'=1!$D(DEL)
"RTN","PRCHAMU",59,0)
 .S %=1,%B="",%A="         Would you like to Edit it" D ^PRCFYN W !
"RTN","PRCHAMU",60,0)
 .I %=2 S %B="",%A="         Would you like to delete it" D ^PRCFYN W ! D
"RTN","PRCHAMU",61,0)
 ..D:%=1 DEL
"RTN","PRCHAMU",62,0)
 S PRCHPO=+Y
"RTN","PRCHAMU",63,0)
 Q
"RTN","PRCHAMU",64,0)
AMENDNO ;gets next valid amendment number to create
"RTN","PRCHAMU",65,0)
 ;
"RTN","PRCHAMU",66,0)
 N I,%,%A,%B,PRCHEX,PRCHEX1
"RTN","PRCHAMU",67,0)
 S PRCHAM=1
"RTN","PRCHAMU",68,0)
 I $D(^PRC(442,PRCHPO,6)) D
"RTN","PRCHAMU",69,0)
 .S I=0 F  S I=$O(^PRC(442,PRCHPO,6,I)) Q:'I  S PRCHAM=I+1
"RTN","PRCHAMU",70,0)
 W !!?5,"Amendment Number: ",PRCHAM
"RTN","PRCHAMU",71,0)
 I $D(^PRC(443.6,PRCHPO,0)) W ! Q
"RTN","PRCHAMU",72,0)
 W !!,"...copying Purchase Order into work file...",! D WAIT^DICD W !
"RTN","PRCHAMU",73,0)
 F I=0,1,7,12,23 S ^PRC(443.6,PRCHPO,I)=$G(^PRC(442,PRCHPO,I))
"RTN","PRCHAMU",74,0)
 S $P(^PRC(443.6,0),"^",3)=PRCHPO,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","PRCHAMU",75,0)
 S PRCHEX=$P(^PRC(443.6,PRCHPO,0),"^"),PRCHEX1=$P(PRCHEX,"-",2)
"RTN","PRCHAMU",76,0)
 S (^PRC(443.6,"B",PRCHEX,PRCHPO),^PRC(443.6,"E",PRCHEX1,PRCHPO))=""
"RTN","PRCHAMU",77,0)
 Q
"RTN","PRCHAMU",78,0)
 ;
"RTN","PRCHAMU",79,0)
INFO ; Ask for common information for amendments
"RTN","PRCHAMU",80,0)
 N DIE,DA,DR,FLGUP
"RTN","PRCHAMU",81,0)
 S ER=0,FLGUP=0,DIE="^PRC(443.6,",DA=PRCHPO,DR="[PRCHAMEND]"
"RTN","PRCHAMU",82,0)
 S:$D(PRCHAV) DR="[PRCHAMENDAV]"
"RTN","PRCHAMU",83,0)
 S:$G(PRCPROST)=90 DR="[PRCHAMENDPRO]"
"RTN","PRCHAMU",84,0)
 S:$G(PRCPROST)=6 DR="[PRCHAMENDPRO EDIT]"
"RTN","PRCHAMU",85,0)
 D ^DIE
"RTN","PRCHAMU",86,0)
 I $G(PRCPROSW)!'FLGUP S ER=1 Q     ;PRC*5.1*175    
"RTN","PRCHAMU",87,0)
 S DIE="^PRC(443.6,"_PRCHPO_",6,",DA=PRCHAM,DR="15///TODAY+4" D ^DIE
"RTN","PRCHAMU",88,0)
 I '$D(^PRC(443.6,PRCHPO,6,PRCHAM,1)) D  S ER=1 Q
"RTN","PRCHAMU",89,0)
 .W !,?5,"Can't continue without a Purchasing Agent !"
"RTN","PRCHAMU",90,0)
 ;S PRCHLC=$P(PRCH(0),U,14)
"RTN","PRCHAMU",91,0)
 Q
"RTN","PRCHAMU",92,0)
ASK ;Ask type amendment
"RTN","PRCHAMU",93,0)
 N PRCHREPO S PRCHREPO=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",32,0)) I PRCHREPO>0 S REPONUM=1 Q
"RTN","PRCHAMU",94,0)
 S ER=0 W !
"RTN","PRCHAMU",95,0)
 I '$G(PRCHAUTH) D
"RTN","PRCHAMU",96,0)
 . S DIC=$S($D(PRCHREQ):"^PRCD(441.6,",1:"^PRCD(442.2,")
"RTN","PRCHAMU",97,0)
 . S DIC("S")="I Y>19,($P(^(0),U,3)]"""")"
"RTN","PRCHAMU",98,0)
 . S DIC(0)="MQEAZ" D ^DIC K DIC
"RTN","PRCHAMU",99,0)
 I $G(PRCHAUTH) D
"RTN","PRCHAMU",100,0)
 . D:'$D(PRCHREQ) DIRPO^PRCHPCAR D:$D(PRCHREQ) DIRREQ^PRCHPCAR
"RTN","PRCHAMU",101,0)
 I Y<0 S ER=1 K PRCHVFLG Q
"RTN","PRCHAMU",102,0)
 I $D(PRCHREQ) D  G:ER ASK
"RTN","PRCHAMU",103,0)
 .I '$D(^PRCD(441.6,+Y,1)) D  S ER=1
"RTN","PRCHAMU",104,0)
 ..W !!?5,"Amendment Lines in 'Type of Requisition Amendment' file are not defined "
"RTN","PRCHAMU",105,0)
 I '$D(PRCHREQ) D  G:ER ASK
"RTN","PRCHAMU",106,0)
 .I '$D(^PRCD(442.2,+Y,1)) D  S ER=1
"RTN","PRCHAMU",107,0)
 ..W !!?5,"Amendment Lines in 'Type of Amendment' file are not defined "
"RTN","PRCHAMU",108,0)
 I $P($G(Y(0)),U,3)="" D
"RTN","PRCHAMU",109,0)
 . S Y(0)=$S($D(PRCHREQ):^PRCD(441.6,Y,0),1:^PRCD(442.2,Y,0))
"RTN","PRCHAMU",110,0)
 S PRCHAMDA=+Y,ROU=$P(Y(0),U,3),ROU=$TR(ROU,"~","^")
"RTN","PRCHAMU",111,0)
 S PRCHL1=$P(^PRCD(442.2,+Y,1),U),PRCHL2=$P(^(1),U,2)
"RTN","PRCHAMU",112,0)
 Q
"RTN","PRCHAMU",113,0)
UPDATE ;Update Delivery date, Original Delivery Date, Amendment status and
"RTN","PRCHAMU",114,0)
 ;Justification.
"RTN","PRCHAMU",115,0)
 ;;PRC*5.1*180   Ask Delivery date every time, regardless of amendment types. Replaces DELIVER=1 control set by certain amendment types which drove Delivery Date query
"RTN","PRCHAMU",116,0)
 S PRCHDT=$P(^PRC(443.6,PRCHPO,0),U,10)
"RTN","PRCHAMU",117,0)
 I $P($G(^PRC(442,PRCHPO,23)),"^",11)'="S" S DIE="^PRC(443.6,",DA=PRCHPO,DR=7 D ^DIE K DIE
"RTN","PRCHAMU",118,0)
 I PRCHDT,$P(^PRC(443.6,PRCHPO,0),U,20)="",$P(^(0),U,10)'=PRCHDT S $P(^(0),U,20)=PRCHDT
"RTN","PRCHAMU",119,0)
 K PRCHDT
"RTN","PRCHAMU",120,0)
 S POSTAT=+$G(^PRC(443.6,PRCHPO,7))
"RTN","PRCHAMU",121,0)
 S AMSTAT=$S(POSTAT=25:26,POSTAT=30:31,POSTAT=40:71,POSTAT=6:83,POSTAT=84:85,POSTAT=86:87,POSTAT=90:91,POSTAT=92:93,POSTAT=94:95,POSTAT=96:97,POSTAT=45:45,1:POSTAT)
"RTN","PRCHAMU",122,0)
 I $G(PRCHAUTH)=1,(AMSTAT=40!(AMSTAT=71)) S AMSTAT=83
"RTN","PRCHAMU",123,0)
 S AMSTAT=$P(^PRCD(442.3,AMSTAT,0),U)
"RTN","PRCHAMU",124,0)
 S DIE="^PRC(443.6,PRCHPO,6,",DA(1)=PRCHPO,DA=PRCHAM,DR="9//^S X=AMSTAT;16"
"RTN","PRCHAMU",125,0)
 N AAREPO S AAREPO=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",32,0))
"RTN","PRCHAMU",126,0)
 I $G(CAN)=1!(AAREPO>0) S DR=16
"RTN","PRCHAMU",127,0)
 I $G(PRCPROST)=90 S DR="16////Prosthetic order cancelled"
"RTN","PRCHAMU",128,0)
 I $G(PRCPROST)=6 S DR="16////Prosthetic Cost Changes"
"RTN","PRCHAMU",129,0)
 D ^DIE K DIE,AMSTAT,POSTAT
"RTN","PRCHAMU",130,0)
 QUIT
"RTN","PRCHAMU",131,0)
FMS ;Checking FMS documents status
"RTN","PRCHAMU",132,0)
 ;
"RTN","PRCHAMU",133,0)
 N N,CODE
"RTN","PRCHAMU",134,0)
 S N=0,STATUS="" F  S N=$O(^PRC(442,+Y,10,N)) Q:N'>0  D  Q:$E(STATUS,1)="R"!($E(STATUS,1)="E")
"RTN","PRCHAMU",135,0)
 .I $E(^PRC(442,+Y,10,N,0),1,2)="MO"!($E(^(0),1,2)="SO") D
"RTN","PRCHAMU",136,0)
 ..S CODE=$P($G(^PRC(442,+Y,10,N,0)),U,4)
"RTN","PRCHAMU",137,0)
 ..S STATUS=$$STATUS^GECSSGET(CODE)
"RTN","PRCHAMU",138,0)
 Q
"RTN","PRCHAMU",139,0)
DEL ;Delete this amendment
"RTN","PRCHAMU",140,0)
 N PO,EXPO,EXPO1,N,ZERO,REC,PAT,ITEM
"RTN","PRCHAMU",141,0)
 S PO=+Y
"RTN","PRCHAMU",142,0)
 S EXPO=$P(^PRC(443.6,PO,0),U),EXPO1=$P(EXPO,"-",2)
"RTN","PRCHAMU",143,0)
 S N=0 F  S N=$O(^PRC(441.7,"B",EXPO,N)) Q:N'>0  D
"RTN","PRCHAMU",144,0)
 .S REC=^PRC(441.7,N,0)
"RTN","PRCHAMU",145,0)
 .S PAT=$P(REC,U)
"RTN","PRCHAMU",146,0)
 .S ITEM=$P(REC,U,2)
"RTN","PRCHAMU",147,0)
 .I ITEM>0 K ^PRC(441.7,"AG",PAT,ITEM,N)
"RTN","PRCHAMU",148,0)
 .K ^PRC(441.7,"B",PAT,N)
"RTN","PRCHAMU",149,0)
 .K ^PRC(441.7,N,0)
"RTN","PRCHAMU",150,0)
 .S ZERO=^PRC(441.7,0)
"RTN","PRCHAMU",151,0)
 .S $P(ZERO,U,4)=$P(ZERO,U,4)-1
"RTN","PRCHAMU",152,0)
 .S:$P(ZERO,U,4)<1 $P(ZERO,U,4)=""
"RTN","PRCHAMU",153,0)
 .S ^PRC(441.7,0)=ZERO
"RTN","PRCHAMU",154,0)
 K ^PRC(443.6,"B",EXPO),^PRC(443.6,"C",PO),^PRC(443.6,"D",PO)
"RTN","PRCHAMU",155,0)
 K ^PRC(443.6,"E",EXPO1),^PRC(443.6,PO)
"RTN","PRCHAMU",156,0)
 S ZERO=^PRC(443.6,0)
"RTN","PRCHAMU",157,0)
 S $P(ZERO,U,4)=$P(ZERO,U,4)-1
"RTN","PRCHAMU",158,0)
 S:$P(ZERO,U,4)<1 $P(ZERO,U,4)=""
"RTN","PRCHAMU",159,0)
 S ^PRC(443.6,0)=ZERO
"RTN","PRCHAMU",160,0)
 S DEL=1
"RTN","PRCHAMU",161,0)
 QUIT
"RTN","PRCHAMU",162,0)
 ;
"RTN","PRCHAMU",163,0)
MSG ;This subroutine is called by PRCHMA
"RTN","PRCHAMU",164,0)
 ;Display message for 'Vendor Change'
"RTN","PRCHAMU",165,0)
 N AA
"RTN","PRCHAMU",166,0)
 S AA="NOTE: The vendor has been changed."
"RTN","PRCHAMU",167,0)
 S AA=AA_"  Please review LINE ITEM & FPDS information"
"RTN","PRCHAMU",168,0)
 S AA=AA_"        for any necessary changes."
"RTN","PRCHAMU",169,0)
 D EN^DDIOL(AA) W !
"RTN","PRCHAMU",170,0)
 QUIT
"RTN","PRCHAMU",171,0)
 ;
"RTN","PRCHAMU",172,0)
MSG1 ;This subroutine is called by PRCHMA
"RTN","PRCHAMU",173,0)
 ;Source code was changed to 2
"RTN","PRCHAMU",174,0)
 N AA
"RTN","PRCHAMU",175,0)
 S AA="NOTE: THE CONTRACT WILL BE REMOVED FROM ALL ITEMS"
"RTN","PRCHAMU",176,0)
 D EN^DDIOL(AA) W !
"RTN","PRCHAMU",177,0)
 QUIT
"RTN","PRCHAMU",178,0)
 ;
"RTN","PRCHAMU",179,0)
SOURCE ;This subroutine is called by PRCHMA
"RTN","PRCHAMU",180,0)
 ;Source code was changed to 2
"RTN","PRCHAMU",181,0)
 ;Remove contract number from $P2 and AC x-reference.
"RTN","PRCHAMU",182,0)
 KILL SCE
"RTN","PRCHAMU",183,0)
 N CONTRACT,ITEM S ITEM=0
"RTN","PRCHAMU",184,0)
 F  S ITEM=$O(^PRC(443.6,PRCHPO,2,ITEM)) Q:'ITEM  D
"RTN","PRCHAMU",185,0)
 .  S CONTRACT=$G(^PRC(443.6,PRCHPO,2,ITEM,2))
"RTN","PRCHAMU",186,0)
 .  S CONTRACT=$P(CONTRACT,U,2)
"RTN","PRCHAMU",187,0)
 .  Q:CONTRACT=""
"RTN","PRCHAMU",188,0)
 .  S $P(^PRC(443.6,PRCHPO,2,ITEM,2),U,2)=""
"RTN","PRCHAMU",189,0)
 .  KILL ^PRC(443.6,PRCHPO,2,"AC",CONTRACT,ITEM)
"RTN","PRCHAMU",190,0)
 ;
"RTN","PRCHAMU",191,0)
 QUIT
"RTN","PRCHDAM1")
0^5^B14059439^B13153064
"RTN","PRCHDAM1",1,0)
PRCHDAM1 ;WISC/DJM-PRINT AMENDMENT ;10/18/95  11:54 AM<<= NOT VERIFIED >
"RTN","PRCHDAM1",2,0)
V ;;5.1;IFCAP;**21,180**;Oct 20, 2000;Build 5
"RTN","PRCHDAM1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDAM1",4,0)
 ;
"RTN","PRCHDAM1",5,0)
 ;PRC*5.1*180 Add call to display amendment Delivery Date change
"RTN","PRCHDAM1",6,0)
 ;
"RTN","PRCHDAM1",7,0)
START(PRCHPO,PRCHAM) ;PRCHPO IS 443.6 INTERNAL ENTRY NUMBER FOR RECORD BEING AMENDED.
"RTN","PRCHDAM1",8,0)
 ;PRCHAM IS IEN AMENDMENT MULTIPLE WITHIN PRCHPO BEING AMENDED.
"RTN","PRCHDAM1",9,0)
 ;FIND OUT WHAT TYPES OF AMENDMENTS HAVE BEEN DONE TO BE ABLE TO
"RTN","PRCHDAM1",10,0)
 ;DETERMINE WHAT TO PRINT OUT.
"RTN","PRCHDAM1",11,0)
 N AMEND,GOTO
"RTN","PRCHDAM1",12,0)
 S AMEND=0 F  S AMEND=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND)) Q:AMEND'>0  S GOTO="E"_+AMEND_"^PRCHDAM1" D @GOTO
"RTN","PRCHDAM1",13,0)
 Q
"RTN","PRCHDAM1",14,0)
 ;
"RTN","PRCHDAM1",15,0)
E20 ;SHIP TO Edit PRINT
"RTN","PRCHDAM1",16,0)
 N FIELD,CHANGE,CHANGES,OLD,NEW,LCNT,DATA,SITE
"RTN","PRCHDAM1",17,0)
 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM1",18,0)
 S FIELD=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,0)) Q:FIELD'>0
"RTN","PRCHDAM1",19,0)
 S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,0)) Q:CHANGE'>0
"RTN","PRCHDAM1",20,0)
 S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDAM1",21,0)
 S SHIP=$P($P(CHANGES,U,3),";")
"RTN","PRCHDAM1",22,0)
 I SHIP=5.4 D
"RTN","PRCHDAM1",23,0)
 .S SITE=$P($G(^PRC(443.6,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(443.6,PRCHPO,0),U),"-"))
"RTN","PRCHDAM1",24,0)
 .S OLD=$P(^PRC(411,SITE,1,OLD,0),U)
"RTN","PRCHDAM1",25,0)
 .S NEW=$P(^PRC(443.6,PRCHPO,1),U,3),NEW=$P(^PRC(411,SITE,1,NEW,0),U)
"RTN","PRCHDAM1",26,0)
 .Q
"RTN","PRCHDAM1",27,0)
 I SHIP=5.3 D
"RTN","PRCHDAM1",28,0)
 .S NEW=$P(^PRC(443.6,PRCHPO,1),U,12),NEW=$P(^PRC(440.2,NEW,0),U),NEW=$P($P(^DPT(NEW,0),U),",",2)_" "_$P($P(^DPT(NEW,0),U),",")
"RTN","PRCHDAM1",29,0)
 .S OLD=$P(^PRC(440.2,OLD,0),U),OLD=$P($P(^DPT(OLD,0),U),",",2)_" "_$P($P(^DPT(OLD,0),U),",")
"RTN","PRCHDAM1",30,0)
 .Q
"RTN","PRCHDAM1",31,0)
 D LINE^PRCHDAM4(.LCNT,2) S DATA="Ship to location "_OLD_" has been changed to "_NEW_"."
"RTN","PRCHDAM1",32,0)
 D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM1",33,0)
 Q
"RTN","PRCHDAM1",34,0)
E21 ;LINE ITEM Add PRINT
"RTN","PRCHDAM1",35,0)
 N FIELD,CHANGE,CHANGES,OLD,ITEM,ITEM0,ITEM1,LCNT,DATA,I,UOP
"RTN","PRCHDAM1",36,0)
 S FIELD=0 K ITEM D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM1",37,0)
 F  S FIELD=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD)) Q:FIELD'>0  D
"RTN","PRCHDAM1",38,0)
 .S CHANGE=0 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM1",39,0)
 ..S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDAM1",40,0)
 ..S ITEM=$P(CHANGES,U,4) Q:$D(ITEM(ITEM))  S ITEM(ITEM)=1
"RTN","PRCHDAM1",41,0)
 ..S ITEM0=$G(^PRC(443.6,PRCHPO,2,ITEM,0))
"RTN","PRCHDAM1",42,0)
 ..I ITEM0="" Q
"RTN","PRCHDAM1",43,0)
 ..I $P(ITEM0,U,2)=0,$P(ITEM0,U,9)=0 Q
"RTN","PRCHDAM1",44,0)
 ..S ITEM1=$G(^PRC(443.6,PRCHPO,2,ITEM,1,1,0))
"RTN","PRCHDAM1",45,0)
 ..D LINE^PRCHDAM4(.LCNT,2) S DATA=" *ADDED THROUGH AMENDMENT*" D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM1",46,0)
 ..S DATA="Item No. "_$P(ITEM0,U)_"     Item Master File No. "
"RTN","PRCHDAM1",47,0)
 ..S DATA=DATA_$P(ITEM0,U,5)_"     BOC: "_+$P(ITEM0,U,4)
"RTN","PRCHDAM1",48,0)
 ..S DATA=DATA_"   CONTRACT: "_$P($G(^PRC(443.6,PRCHPO,2,ITEM,2)),U,2)
"RTN","PRCHDAM1",49,0)
 ..D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM1",50,0)
 ..D NEW^PRCHDAM4
"RTN","PRCHDAM1",51,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDAM1",52,0)
 ..S DATA="    Items per "_UOP_": "_$P(ITEM0,U,12)
"RTN","PRCHDAM1",53,0)
 ..F I=1:1:26-$L(DATA) S DATA=DATA_" "
"RTN","PRCHDAM1",54,0)
 ..S DATA=DATA_"NSN: "_$P(ITEM0,U,13) D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM1",55,0)
 ..I $P(ITEM0,U,6)]"" S DATA="    STK#: "_$P(ITEM0,U,6) D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM1",56,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDAM1",57,0)
 ..S DATA="    "_$P(ITEM0,U,2)_" "_UOP_" at $"_$J($P(ITEM0,U,9),12,4)_" = $"_$J($P(ITEM0,U,2)*$P(ITEM0,U,9),9,2)
"RTN","PRCHDAM1",58,0)
 ..D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM1",59,0)
 Q
"RTN","PRCHDAM1",60,0)
 ;
"RTN","PRCHDAM1",61,0)
E22 ;LINE ITEM Delete PRINT
"RTN","PRCHDAM1",62,0)
 G E22^PRCHDAM2
"RTN","PRCHDAM1",63,0)
 ;
"RTN","PRCHDAM1",64,0)
E23 ;LINE ITEM Edit PRINT
"RTN","PRCHDAM1",65,0)
 G E23^PRCHDAM2
"RTN","PRCHDAM1",66,0)
 ;
"RTN","PRCHDAM1",67,0)
E24 ;SOURCE CODE Edit PRINT
"RTN","PRCHDAM1",68,0)
 G E24^PRCHDAM4
"RTN","PRCHDAM1",69,0)
 ;
"RTN","PRCHDAM1",70,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDAM1",71,0)
 G E25^PRCHDAM3
"RTN","PRCHDAM1",72,0)
 ;
"RTN","PRCHDAM1",73,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDAM1",74,0)
 G E26^PRCHDAM3
"RTN","PRCHDAM1",75,0)
 ;
"RTN","PRCHDAM1",76,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDAM1",77,0)
 G E27^PRCHDAM3
"RTN","PRCHDAM1",78,0)
 ;
"RTN","PRCHDAM1",79,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDAM1",80,0)
 G E28^PRCHDAM3
"RTN","PRCHDAM1",81,0)
 ;
"RTN","PRCHDAM1",82,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDAM1",83,0)
 G E29^PRCHDAM3
"RTN","PRCHDAM1",84,0)
 ;
"RTN","PRCHDAM1",85,0)
E30 ;F.C.P. Edit PRINT
"RTN","PRCHDAM1",86,0)
 G E30^PRCHDAM4
"RTN","PRCHDAM1",87,0)
 ;
"RTN","PRCHDAM1",88,0)
E31 ;Change VENDOR PRINT
"RTN","PRCHDAM1",89,0)
 G E31^PRCHDAM4
"RTN","PRCHDAM1",90,0)
 ;
"RTN","PRCHDAM1",91,0)
E32 ;REPLACE P.O. NUMBER PRINT
"RTN","PRCHDAM1",92,0)
 G E32^PRCHDAM4
"RTN","PRCHDAM1",93,0)
 ;
"RTN","PRCHDAM1",94,0)
E33 ;PROMPT PAYMENT Edit PRINT
"RTN","PRCHDAM1",95,0)
 G E33^PRCHDAM5
"RTN","PRCHDAM1",96,0)
 ;
"RTN","PRCHDAM1",97,0)
E34 ;AUTHORITY Edit PRINT
"RTN","PRCHDAM1",98,0)
 G E34^PRCHDAM5
"RTN","PRCHDAM1",99,0)
 ;
"RTN","PRCHDAM1",100,0)
E35 ;F.O.B. Point PRINT
"RTN","PRCHDAM1",101,0)
 G E35^PRCHDAM5
"RTN","PRCHDAM1",102,0)
 ;
"RTN","PRCHDAM1",103,0)
E36 ;ITEM DISCOUNT Add/Edit PRINT
"RTN","PRCHDAM1",104,0)
 G E36^PRCHDAM6
"RTN","PRCHDAM1",105,0)
 ;
"RTN","PRCHDAM1",106,0)
E37 ;ITEM DISCOUNT Delete PRINT
"RTN","PRCHDAM1",107,0)
 G E37^PRCHDAM6
"RTN","PRCHDAM1",108,0)
 ;
"RTN","PRCHDAM1",109,0)
E98 ;DELIVERY DATE PRINT
"RTN","PRCHDAM1",110,0)
 G E98^PRCHDAM3       ;PRC*5.1*180 Call to display Delivery Date changes
"RTN","PRCHDAM1",111,0)
 Q
"RTN","PRCHDAM1",112,0)
E99 ;NET AMOUNT PRINT
"RTN","PRCHDAM1",113,0)
 Q
"RTN","PRCHDAM3")
0^6^B18726324^B15110052
"RTN","PRCHDAM3",1,0)
PRCHDAM3 ;WISC/DJM-PRINT AMENDMENT, ROUTINE #3 ;6/29/00  12:16
"RTN","PRCHDAM3",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCHDAM3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDAM3",4,0)
 ;
"RTN","PRCHDAM3",5,0)
 ;PRC*5.1*180 Add Amend to Delivery date display (98-7)
"RTN","PRCHDAM3",6,0)
 ;
"RTN","PRCHDAM3",7,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDAM3",8,0)
 N CHANGE,OLD,MIT,LCNT,DATA,SITE
"RTN","PRCHDAM3",9,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",10,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.04,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",11,0)
 .S SITE=$P($G(^PRC(443.6,PRCHPO,23)),U,7) S SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(443.6,PRCHPO,0),U),"-"))
"RTN","PRCHDAM3",12,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P($S($D(^PRC(411,SITE,4,OLD,0)):^(0),1:""),U)
"RTN","PRCHDAM3",13,0)
 .S MIT=$P(^PRC(443.6,PRCHPO,12),U,6),MIT=$P($S($D(^PRC(411,SITE,4,MIT,0)):^(0),1:""),U)
"RTN","PRCHDAM3",14,0)
 .D LINE^PRCHDAM4(.LCNT,2) S DATA="MAIL INVOICE to "_OLD_" has been  **AMENDED**  to become MAIL INVOICE to "_MIT
"RTN","PRCHDAM3",15,0)
 .D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",16,0)
 Q
"RTN","PRCHDAM3",17,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDAM3",18,0)
 N CHANGE,MOP,OLD,LCNT,DATA
"RTN","PRCHDAM3",19,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",20,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.02,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",21,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRCD(442.5,OLD,0),U)
"RTN","PRCHDAM3",22,0)
 .S MOP=$P(^PRC(443.6,PRCHPO,0),U,2),MOP=$P(^PRCD(442.5,MOP,0),U)
"RTN","PRCHDAM3",23,0)
 .D LINE^PRCHDAM4(.LCNT,2) S DATA="METHOD of PAYMENT of "_OLD D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",24,0)
 .S DATA="has been changed to "_MOP D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",25,0)
 Q
"RTN","PRCHDAM3",26,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDAM3",27,0)
 N CHANGE,CHANGES,AC,VAL,LCNT,DATA
"RTN","PRCHDAM3",28,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",29,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",30,0)
 .S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0)
"RTN","PRCHDAM3",31,0)
 .S AC=$P(CHANGES,U,4),VAL=$G(^PRC(443.6,PRCHPO,15,AC,0)) Q:VAL=""
"RTN","PRCHDAM3",32,0)
 .S AC=$P(VAL,U),VAL=$P($G(^PRC(442.7,+VAL,0)),U,2)
"RTN","PRCHDAM3",33,0)
 .D LINE^PRCHDAM4(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_", "_VAL_", has been ADDED"
"RTN","PRCHDAM3",34,0)
 .D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",35,0)
 Q
"RTN","PRCHDAM3",36,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDAM3",37,0)
 N CHANGE,CHANGES,AC,OLD,LCNT,DATA
"RTN","PRCHDAM3",38,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",39,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",40,0)
 .S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDAM3",41,0)
 .S AC=$P(CHANGES,U,4),OLD=$S(OLD>0:$P($G(^PRC(442.7,+OLD,0)),U,2),1:""),OLD=$S(OLD]"":", "_OLD_",",1:"")
"RTN","PRCHDAM3",42,0)
 .D LINE^PRCHDAM4(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_OLD D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",43,0)
 .S DATA="has been DELETED"
"RTN","PRCHDAM3",44,0)
 .D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",45,0)
 Q
"RTN","PRCHDAM3",46,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDAM3",47,0)
 N CHANGE,OLD,EST,LCNT,DATA,OBOC,OBOC1,FLAG
"RTN","PRCHDAM3",48,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",49,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,13,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",50,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$FN(OLD,"-",2)
"RTN","PRCHDAM3",51,0)
 .S EST=$P(^PRC(443.6,PRCHPO,0),U,13),EST=$FN(EST,"-",2)
"RTN","PRCHDAM3",52,0)
 .S (OBOC1,FLAG)=0 K OBOC
"RTN","PRCHDAM3",53,0)
 .F  S OBOC1=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,13.05,OBOC1)) Q:OBOC1'>0  D  Q:FLAG=1
"RTN","PRCHDAM3",54,0)
 ..S OBOC=+(^PRC(443.6,PRCHPO,6,PRCHAM,3,OBOC1,1,1,0)),FLAG=1
"RTN","PRCHDAM3",55,0)
 .I '$D(OBOC) S OBOC=+$P($G(^PRC(443.6,PRCHPO,23)),U)
"RTN","PRCHDAM3",56,0)
 .D LINE^PRCHDAM4(.LCNT,2)
"RTN","PRCHDAM3",57,0)
 .I OLD'>0 D
"RTN","PRCHDAM3",58,0)
 ..S DATA="**ADDED THROUGH AMENDMENT**" D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",59,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_EST_" has been added" D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",60,0)
 ..S DATA="BOC: "_+$P($G(^PRC(443.6,PRCHPO,23)),U) D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",61,0)
 ..Q
"RTN","PRCHDAM3",62,0)
 .I OLD>0 D
"RTN","PRCHDAM3",63,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_OLD_" has been changed" D DATA^PRCHDAM4(.LCNT,DATA) S DATA="to $"_EST D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",64,0)
 ..S DATA="BOC: "_OBOC_" has been changed to: "_+$P($G(^PRC(443.6,PRCHPO,23)),U) D DATA^PRCHDAM4(.LCNT,DATA)
"RTN","PRCHDAM3",65,0)
 ..Q
"RTN","PRCHDAM3",66,0)
 .D LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",67,0)
 .Q
"RTN","PRCHDAM3",68,0)
 Q
"RTN","PRCHDAM3",69,0)
E98 ;
"RTN","PRCHDAM3",70,0)
 ;Edit DELIVERY DATE           ;PRC*5.1*180 Display of Delivery Date amend
"RTN","PRCHDAM3",71,0)
 N CHANGE,DDATE,OLD,LCNT,DATA
"RTN","PRCHDAM3",72,0)
 S CHANGE=0 D LCNT^PRCHDAM4(.LCNT)
"RTN","PRCHDAM3",73,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,7,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDAM3",74,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDAM3",75,0)
 .S DDATE=$P(^PRC(443.6,PRCHPO,0),U,10)
"RTN","PRCHDAM3",76,0)
 .D LINE^PRCHDAM4(.LCNT,2) S DATA="DELIVERY DATE "_$$FMTE^XLFDT(OLD)_" has been changed to "_$$FMTE^XLFDT(DDATE) D DATA^PRCHDAM4(.LCNT,DATA),LCNT1^PRCHDAM4(LCNT)
"RTN","PRCHDAM3",77,0)
 Q
"RTN","PRCHDP5")
0^11^B14699380^B13761465
"RTN","PRCHDP5",1,0)
PRCHDP5 ;WISC/DJM-PRINT AMENDMENT ;6/29/00  12:18
"RTN","PRCHDP5",2,0)
V ;;5.1;IFCAP;**21,131,180**;Oct 20, 2000;Build 5
"RTN","PRCHDP5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDP5",4,0)
 ;
"RTN","PRCHDP5",5,0)
 ;PRC*5.1*180 Add call to display amendment Delivery Date change
"RTN","PRCHDP5",6,0)
 ;
"RTN","PRCHDP5",7,0)
START(PRCHPO,PRCHAM) ;PRCHPO IS 442 INTERNAL ENTRY NUMBER FOR RECORD BEING AMENDED.
"RTN","PRCHDP5",8,0)
 ;PRCHAM IS IEN OF AMENDMENT MULTIPLE WITHIN PRCHPO BEING AMENDED.
"RTN","PRCHDP5",9,0)
 ;FIND OUT WHAT TYPES OF AMENDMENTS HAVE BEEN DONE TO BE ABLE TO
"RTN","PRCHDP5",10,0)
 ;DETERMINE WHAT TO PRINT OUT FROM THE AMENDMENTS CHANGES MULTIPLE.
"RTN","PRCHDP5",11,0)
 N AMEND,GOTO
"RTN","PRCHDP5",12,0)
 S AMEND=0 F  S AMEND=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND)) Q:AMEND'>0  S GOTO="E"_+AMEND_"^PRCHDP5" D @GOTO
"RTN","PRCHDP5",13,0)
 ;D LCNT^PRCHDP9(.LCNT) S LCNTX=LCNT I LCNT>37 S LCNT=LCNT-52
"RTN","PRCHDP5",14,0)
 ;F  Q:LCNT'>41  S LCNT=LCNT-56,PRCHPGT=PRCHPGT+1
"RTN","PRCHDP5",15,0)
 ;S:LCNTX>37 PRCHPGT=PRCHPGT+1
"RTN","PRCHDP5",16,0)
 Q
"RTN","PRCHDP5",17,0)
 ;
"RTN","PRCHDP5",18,0)
E20 ;SHIP TO Edit PRINT
"RTN","PRCHDP5",19,0)
 N FIELD,CHANGE,CHANGES,OLD,NEW,LCNT,DATA,SITE
"RTN","PRCHDP5",20,0)
 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP5",21,0)
 S FIELD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,0)) Q:FIELD'>0
"RTN","PRCHDP5",22,0)
 S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,0)) Q:CHANGE'>0
"RTN","PRCHDP5",23,0)
 S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP5",24,0)
 S SHIP=$P($P(CHANGES,U,3),";")
"RTN","PRCHDP5",25,0)
 I SHIP=5.4 D
"RTN","PRCHDP5",26,0)
 .S SITE=$P($G(^PRC(442,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(442,PRCHPO,0),U),"-"))
"RTN","PRCHDP5",27,0)
 .S OLD=$P(^PRC(411,SITE,1,OLD,0),U)
"RTN","PRCHDP5",28,0)
 .S NEW=$P(^PRC(442,PRCHPO,1),U,3),NEW=$P(^PRC(411,SITE,1,NEW,0),U)
"RTN","PRCHDP5",29,0)
 .Q
"RTN","PRCHDP5",30,0)
 I SHIP=5.3 D
"RTN","PRCHDP5",31,0)
 .S NEW=$P(^PRC(442,PRCHPO,1),U,12),NEW=$P(^PRC(440.2,NEW,0),U),NEW=$P($P(^DPT(NEW,0),U),",",2)_" "_$P($P(^DPT(NEW,0),U),",")
"RTN","PRCHDP5",32,0)
 .S OLD=$P(^PRC(440.2,OLD,0),U),OLD=$P($P(^DPT(OLD,0),U),",",2)_" "_$P($P(^DPT(OLD,0),U),",")
"RTN","PRCHDP5",33,0)
 .Q
"RTN","PRCHDP5",34,0)
 D LINE^PRCHDP9(.LCNT,2) S DATA="Ship to location "_OLD_" has been changed to "_NEW_"."
"RTN","PRCHDP5",35,0)
 D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP5",36,0)
 Q
"RTN","PRCHDP5",37,0)
E21 ;LINE ITEM Add PRINT
"RTN","PRCHDP5",38,0)
 N FIELD,CHANGE,CHANGES,OLD,ITEM,ITEM0,ITEM1,LCNT,DATA,I,UOP
"RTN","PRCHDP5",39,0)
 S FIELD=0 K ITEM D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP5",40,0)
 F  S FIELD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD)) Q:FIELD'>0  D
"RTN","PRCHDP5",41,0)
 .S CHANGE=0 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP5",42,0)
 ..S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP5",43,0)
 ..S ITEM=$P(CHANGES,U,4) Q:$D(ITEM(ITEM))  S ITEM(ITEM)=1
"RTN","PRCHDP5",44,0)
 ..S ITEM0=$G(^PRC(442,PRCHPO,2,ITEM,0))
"RTN","PRCHDP5",45,0)
 ..I ITEM0="" Q
"RTN","PRCHDP5",46,0)
 ..I $P(ITEM0,U,2)=0,$P(ITEM0,U,9)=0 Q
"RTN","PRCHDP5",47,0)
 ..S ITEM1=$G(^PRC(442,PRCHPO,2,ITEM,1,1,0))
"RTN","PRCHDP5",48,0)
 ..D LINE^PRCHDP9(.LCNT,2) S DATA=" *ADDED THROUGH AMENDMENT*" D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP5",49,0)
 ..S DATA="Item No. "_$P(ITEM0,U)_"     Item Master File No. "
"RTN","PRCHDP5",50,0)
 ..S DATA=DATA_$P(ITEM0,U,5)_"     BOC: "_+$P(ITEM0,U,4)
"RTN","PRCHDP5",51,0)
 ..S DATA=DATA_"   CONTRACT: "_$P($G(^PRC(442,PRCHPO,2,ITEM,2)),U,2)
"RTN","PRCHDP5",52,0)
 ..D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP5",53,0)
 ..D NEW^PRCHDP7
"RTN","PRCHDP5",54,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDP5",55,0)
 ..S DATA="    Items per "_UOP_": "_$P(ITEM0,U,12)
"RTN","PRCHDP5",56,0)
 ..F I=1:1:26-$L(DATA) S DATA=DATA_" "
"RTN","PRCHDP5",57,0)
 ..S DATA=DATA_"NSN: "_$P(ITEM0,U,13) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP5",58,0)
 ..I $P(ITEM0,U,6)]"" S DATA="    STK#: "_$P(ITEM0,U,6) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP5",59,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDP5",60,0)
 ..S AMDQTY=$P(ITEM0,U,2),AMDVAL=$P(ITEM0,U,9) D NXTAMD^PRCHDP6
"RTN","PRCHDP5",61,0)
 ..S DATA="    "_AMDQTY_" "_UOP_" at $"_$J(AMDVAL,12,4)_" = $"_$J(AMDQTY*AMDVAL,9,2)
"RTN","PRCHDP5",62,0)
 ..K AMDQTY,ANDVAL
"RTN","PRCHDP5",63,0)
 ..D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP5",64,0)
 Q
"RTN","PRCHDP5",65,0)
 ;
"RTN","PRCHDP5",66,0)
E22 ;LINE ITEM Delete PRINT
"RTN","PRCHDP5",67,0)
 G E22^PRCHDP6 ;NOT ENOUGH ROOM IN THIS ROUTINE.
"RTN","PRCHDP5",68,0)
 ;
"RTN","PRCHDP5",69,0)
E23 ;LINE ITEM Edit PRINT
"RTN","PRCHDP5",70,0)
 G E23^PRCHDP6
"RTN","PRCHDP5",71,0)
 ;
"RTN","PRCHDP5",72,0)
E24 ;SOURCE CODE Edit PRINT
"RTN","PRCHDP5",73,0)
 G E24^PRCHDP8
"RTN","PRCHDP5",74,0)
 ;
"RTN","PRCHDP5",75,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDP5",76,0)
 G E25^PRCHDP7
"RTN","PRCHDP5",77,0)
 ;
"RTN","PRCHDP5",78,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDP5",79,0)
 G E26^PRCHDP7
"RTN","PRCHDP5",80,0)
 ;
"RTN","PRCHDP5",81,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDP5",82,0)
 G E27^PRCHDP7
"RTN","PRCHDP5",83,0)
 ;
"RTN","PRCHDP5",84,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDP5",85,0)
 G E28^PRCHDP7
"RTN","PRCHDP5",86,0)
 ;
"RTN","PRCHDP5",87,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDP5",88,0)
 G E29^PRCHDP7
"RTN","PRCHDP5",89,0)
 ;
"RTN","PRCHDP5",90,0)
E30 ;F.C.P. Edit PRINT
"RTN","PRCHDP5",91,0)
 G E30^PRCHDP8
"RTN","PRCHDP5",92,0)
 ;
"RTN","PRCHDP5",93,0)
E31 ;Change VENDOR PRINT
"RTN","PRCHDP5",94,0)
 G E31^PRCHDP8
"RTN","PRCHDP5",95,0)
 ;
"RTN","PRCHDP5",96,0)
E32 ;REPLACE P.O. NUMBER PRINT
"RTN","PRCHDP5",97,0)
 G E32^PRCHDP8
"RTN","PRCHDP5",98,0)
 ;
"RTN","PRCHDP5",99,0)
E33 ;PROMPT PAYMENT Edit PRINT
"RTN","PRCHDP5",100,0)
 G E33^PRCHDP8
"RTN","PRCHDP5",101,0)
 ;
"RTN","PRCHDP5",102,0)
E34 ;AUTHORITY Edit PRINT
"RTN","PRCHDP5",103,0)
 G E34^PRCHDP9
"RTN","PRCHDP5",104,0)
 ;
"RTN","PRCHDP5",105,0)
E35 ;F.O.B. Point PRINT
"RTN","PRCHDP5",106,0)
 G E35^PRCHDP9
"RTN","PRCHDP5",107,0)
 ;
"RTN","PRCHDP5",108,0)
E36 ;ITEM DISCOUNT Add/Edit PRINT
"RTN","PRCHDP5",109,0)
 G E36^PRCHDP9
"RTN","PRCHDP5",110,0)
 ;
"RTN","PRCHDP5",111,0)
E37 ;ITEM DISCOUNT Delete PRINT
"RTN","PRCHDP5",112,0)
 G E37^PRCHDP9
"RTN","PRCHDP5",113,0)
 ;
"RTN","PRCHDP5",114,0)
E98 ;DELIVERY DATE PRINT
"RTN","PRCHDP5",115,0)
 G E98^PRCHDP7       ;PRC*5.1*180 Call to display Delivery Date changes
"RTN","PRCHDP5",116,0)
 Q
"RTN","PRCHDP5",117,0)
E99 ;NET AMOUNT PRINT
"RTN","PRCHDP5",118,0)
 Q
"RTN","PRCHDP7")
0^12^B21640570^B17739691
"RTN","PRCHDP7",1,0)
PRCHDP7 ;WISC/DJM-PRINT AMENDMENT, ROUTINE #3 ;10/19/95  10:46 AM
"RTN","PRCHDP7",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCHDP7",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDP7",4,0)
 ;
"RTN","PRCHDP7",5,0)
 ;PRC*5.1*180 Add Amend to Delivery date display (98-7)
"RTN","PRCHDP7",6,0)
 ;
"RTN","PRCHDP7",7,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDP7",8,0)
 N CHANGE,OLD,MIT,LCNT,DATA,SITE
"RTN","PRCHDP7",9,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",10,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.04,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",11,0)
 .S SITE=$P($G(^PRC(442,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(442,PRCHPO,0),U),"-"))
"RTN","PRCHDP7",12,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P($S($D(^PRC(411,SITE,4,OLD,0)):^(0),1:""),U)
"RTN","PRCHDP7",13,0)
 .S MIT=$P(^PRC(442,PRCHPO,12),U,6),MIT=$P($S($D(^PRC(411,SITE,4,MIT,0)):^(0),1:""),U)
"RTN","PRCHDP7",14,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="MAIL INVOICE to "_OLD_" has been  **AMENDED**  to become MAIL INVOICE to "_MIT
"RTN","PRCHDP7",15,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",16,0)
 Q
"RTN","PRCHDP7",17,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDP7",18,0)
 N CHANGE,MOP,OLD,LCNT,DATA
"RTN","PRCHDP7",19,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",20,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.02,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",21,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRCD(442.5,OLD,0),U)
"RTN","PRCHDP7",22,0)
 .S MOP=$P(^PRC(442,PRCHPO,0),U,2),MOP=$P(^PRCD(442.5,MOP,0),U)
"RTN","PRCHDP7",23,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="METHOD of PAYMENT of "_OLD D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",24,0)
 .S DATA="has been changed to "_MOP D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",25,0)
 Q
"RTN","PRCHDP7",26,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDP7",27,0)
 N CHANGE,CHANGES,AC,VAL,LCNT,DATA
"RTN","PRCHDP7",28,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",29,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",30,0)
 .S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0)
"RTN","PRCHDP7",31,0)
 .S AC=$P(CHANGES,U,4),VAL=$G(^PRC(442,PRCHPO,15,AC,0)) Q:VAL=""
"RTN","PRCHDP7",32,0)
 .S AC=$P(VAL,U),VAL=$P($G(^PRC(442.7,+VAL,0)),U,2)
"RTN","PRCHDP7",33,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_", "_VAL_", has been ADDED"
"RTN","PRCHDP7",34,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",35,0)
 Q
"RTN","PRCHDP7",36,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDP7",37,0)
 N CHANGE,CHANGES,AC,OLD,LCNT,DATA
"RTN","PRCHDP7",38,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",39,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",40,0)
 .S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP7",41,0)
 .S AC=$P(CHANGES,U,4),OLD=$S(OLD>0:$P($G(^PRC(442.7,+OLD,0)),U,2),1:""),OLD=$S(OLD]"":", "_OLD_",",1:"")
"RTN","PRCHDP7",42,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_OLD D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",43,0)
 .S DATA="has been DELETED"
"RTN","PRCHDP7",44,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",45,0)
 Q
"RTN","PRCHDP7",46,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDP7",47,0)
 N CHANGE,OLD,EST,LCNT,DATA,OBOC,OBOC1,FLAG
"RTN","PRCHDP7",48,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",49,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,13,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",50,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$FN(OLD,"-",2)
"RTN","PRCHDP7",51,0)
 .S EST=$P(^PRC(442,PRCHPO,0),U,13),EST=$FN(EST,"-",2)
"RTN","PRCHDP7",52,0)
 .S (OBOC1,FLAG)=0 K OBOC
"RTN","PRCHDP7",53,0)
 .F  S OBOC1=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,13.05,OBOC1)) Q:OBOC1'>0  D  Q:FLAG=1
"RTN","PRCHDP7",54,0)
 ..S OBOC=+(^PRC(442,PRCHPO,6,PRCHAM,3,OBOC1,1,1,0)),FLAG=1
"RTN","PRCHDP7",55,0)
 .I '$D(OBOC) S OBOC=+$P($G(^PRC(442,PRCHPO,23)),U)
"RTN","PRCHDP7",56,0)
 .D LINE^PRCHDP9(.LCNT,2)
"RTN","PRCHDP7",57,0)
 .I OLD'>0 D
"RTN","PRCHDP7",58,0)
 ..S DATA="**ADDED THROUGH AMENDMENT**" D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",59,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_EST_" has been added" D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",60,0)
 ..S DATA="BOC: "_+$P($G(^PRC(442,PRCHPO,23)),U) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",61,0)
 ..Q
"RTN","PRCHDP7",62,0)
 .I OLD>0 D
"RTN","PRCHDP7",63,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_OLD_" has been changed" D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",64,0)
 ..S DATA="to $"_EST D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",65,0)
 ..S DATA="BOC: "_OBOC_" has been changed to: "_+$P($G(^PRC(442,PRCHPO,23)),U) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",66,0)
 ..Q
"RTN","PRCHDP7",67,0)
 .D LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",68,0)
 .Q
"RTN","PRCHDP7",69,0)
 Q
"RTN","PRCHDP7",70,0)
E98 ;
"RTN","PRCHDP7",71,0)
 ;Edit DELIVERY DATE           ;PRC*5.1*180 Display of Delivery Date amend
"RTN","PRCHDP7",72,0)
 N CHANGE,DDATE,OLD,LCNT,DATA
"RTN","PRCHDP7",73,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP7",74,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,7,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP7",75,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP7",76,0)
 .S DDATE=$P(^PRC(442,PRCHPO,0),U,10)
"RTN","PRCHDP7",77,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="DELIVERY DATE "_$$FMTE^XLFDT(OLD)_" has been changed to "_$$FMTE^XLFDT(DDATE) D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP7",78,0)
 Q
"RTN","PRCHDP7",79,0)
OLD ;GET ALL THE OLD DESCRIPTION FROM 'CHANGES' MULTIPLE AND SET INTO
"RTN","PRCHDP7",80,0)
 ;THE DISPLAY '^TMP($J,"W"' ARRAY.
"RTN","PRCHDP7",81,0)
 N LINE,DATA
"RTN","PRCHDP7",82,0)
 S LINE=1
"RTN","PRCHDP7",83,0)
 F  D:DES]""  Q:DES=""
"RTN","PRCHDP7",84,0)
 .S DATA=$E(DES,1,60) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",85,0)
 .S DES=$E(DES,61,255) Q:$L(DES)'<75  Q:LINE'>0
"RTN","PRCHDP7",86,0)
 .S LINE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,PRCHLN,1,LINE)) Q:LINE'>0
"RTN","PRCHDP7",87,0)
 .S DES=DES_$G(^PRC(442,PRCHPO,6,PRCHAM,3,PRCHLN,1,LINE,0))
"RTN","PRCHDP7",88,0)
 .Q
"RTN","PRCHDP7",89,0)
 Q
"RTN","PRCHDP7",90,0)
 ;
"RTN","PRCHDP7",91,0)
NEW ;GET ALL THE NEW DESCRIPTION FROM THE LINE ITEM MULTIPLE AND SET
"RTN","PRCHDP7",92,0)
 ;INTO THE DISPLAY '^TMP($J,"W"' ARRAY.
"RTN","PRCHDP7",93,0)
 N LINE,DATA
"RTN","PRCHDP7",94,0)
 S LINE=1
"RTN","PRCHDP7",95,0)
 F  D:ITEM1]""  Q:ITEM1=""
"RTN","PRCHDP7",96,0)
 .S DATA=$E(ITEM1,1,60) D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP7",97,0)
 .S ITEM1=$E(ITEM1,61,255) Q:$L(ITEM1)'<75  Q:LINE'>0
"RTN","PRCHDP7",98,0)
 .S LINE=$O(^PRC(442,PRCHPO,2,ITEM,1,LINE)) Q:LINE'>0
"RTN","PRCHDP7",99,0)
 .S ITEM1=ITEM1_$G(^PRC(442,PRCHPO,2,ITEM,1,LINE,0))
"RTN","PRCHDP7",100,0)
 .Q
"RTN","PRCHDP7",101,0)
 Q
"RTN","PRCHDSP4")
0^9^B15007147^B14050026
"RTN","PRCHDSP4",1,0)
PRCHDSP4 ;WISC/DJM-PRINT AMENDMENT ;6/29/00  12:19
"RTN","PRCHDSP4",2,0)
V ;;5.1;IFCAP;**21,180**;Oct 20, 2000;Build 5
"RTN","PRCHDSP4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDSP4",4,0)
 ;
"RTN","PRCHDSP4",5,0)
 ;PRC*5.1*180 Add call to display amendment Delivery Date change
"RTN","PRCHDSP4",6,0)
 ;
"RTN","PRCHDSP4",7,0)
START(PRCHPO,PRCHAM) ;PRCHPO IS 442 INTERNAL ENTRY NUMBER FOR RECORD BEING AMENDED.
"RTN","PRCHDSP4",8,0)
 ;PRCHAM IS IEN AMENDMENT MULTIPLE WITHIN PRCHPO BEING AMENDED.
"RTN","PRCHDSP4",9,0)
 ;FIND OUT WHAT TYPES OF AMENDMENTS HAVE BEEN DONE TO BE ABLE TO
"RTN","PRCHDSP4",10,0)
 ;DETERMINE WHAT TO PRINT OUT.
"RTN","PRCHDSP4",11,0)
 N AMEND,GOTO
"RTN","PRCHDSP4",12,0)
 S AMEND=0 F  S AMEND=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND)) Q:AMEND'>0  S GOTO="E"_+AMEND_"^PRCHDSP4" D @GOTO
"RTN","PRCHDSP4",13,0)
 D LCNT^PRCHPAM5(.LCNT) S LCNTX=LCNT I LCNT>37 S LCNT=LCNT-52
"RTN","PRCHDSP4",14,0)
 F  Q:LCNT'>41  S LCNT=LCNT-56,PRCHPGT=PRCHPGT+1
"RTN","PRCHDSP4",15,0)
 S:LCNTX>37 PRCHPGT=PRCHPGT+1
"RTN","PRCHDSP4",16,0)
 Q
"RTN","PRCHDSP4",17,0)
 ;
"RTN","PRCHDSP4",18,0)
E20 ;SHIP TO Edit PRINT
"RTN","PRCHDSP4",19,0)
 N FIELD,CHANGE,CHANGES,OLD,NEW,LCNT,DATA,SITE
"RTN","PRCHDSP4",20,0)
 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP4",21,0)
 S FIELD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,0)) Q:FIELD'>0
"RTN","PRCHDSP4",22,0)
 S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,0)) Q:CHANGE'>0
"RTN","PRCHDSP4",23,0)
 S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDSP4",24,0)
 S SHIP=$P($P(CHANGES,U,3),";")
"RTN","PRCHDSP4",25,0)
 I SHIP=5.4 D
"RTN","PRCHDSP4",26,0)
 .S SITE=$P($G(^PRC(442,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(442,PRCHPO,0),U),"-"))
"RTN","PRCHDSP4",27,0)
 .S OLD=$P(^PRC(411,SITE,1,OLD,0),U)
"RTN","PRCHDSP4",28,0)
 .S NEW=$P(^PRC(442,PRCHPO,1),U,3),NEW=$P(^PRC(411,SITE,1,NEW,0),U)
"RTN","PRCHDSP4",29,0)
 .Q
"RTN","PRCHDSP4",30,0)
 I SHIP=5.3 D
"RTN","PRCHDSP4",31,0)
 .S NEW=$P(^PRC(442,PRCHPO,1),U,12),NEW=$P(^PRC(440.2,NEW,0),U),NEW=$P($P(^DPT(NEW,0),U),",",2)_" "_$P($P(^DPT(NEW,0),U),",")
"RTN","PRCHDSP4",32,0)
 .S OLD=$P(^PRC(440.2,OLD,0),U),OLD=$P($P(^DPT(OLD,0),U),",",2)_" "_$P($P(^DPT(OLD,0),U),",")
"RTN","PRCHDSP4",33,0)
 .Q
"RTN","PRCHDSP4",34,0)
 D LINE^PRCHPAM5(.LCNT,2) S DATA="Ship to location "_OLD_" has been changed to "_NEW_"."
"RTN","PRCHDSP4",35,0)
 D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP4",36,0)
 Q
"RTN","PRCHDSP4",37,0)
E21 ;LINE ITEM Add PRINT
"RTN","PRCHDSP4",38,0)
 N FIELD,CHANGE,CHANGES,OLD,ITEM,ITEM0,ITEM1,LCNT,DATA,I,UOP
"RTN","PRCHDSP4",39,0)
 S FIELD=0 K ITEM D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP4",40,0)
 F  S FIELD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD)) Q:FIELD'>0  D
"RTN","PRCHDSP4",41,0)
 .S CHANGE=0 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP4",42,0)
 ..S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDSP4",43,0)
 ..S ITEM=$P(CHANGES,U,4) Q:$D(ITEM(ITEM))  S ITEM(ITEM)=1
"RTN","PRCHDSP4",44,0)
 ..S ITEM0=$G(^PRC(442,PRCHPO,2,ITEM,0))
"RTN","PRCHDSP4",45,0)
 ..I ITEM0="" Q
"RTN","PRCHDSP4",46,0)
 ..I $P(ITEM0,U,2)=0,$P(ITEM0,U,9)=0 Q
"RTN","PRCHDSP4",47,0)
 ..S ITEM1=$G(^PRC(442,PRCHPO,2,ITEM,1,1,0))
"RTN","PRCHDSP4",48,0)
 ..D LINE^PRCHPAM5(.LCNT,2) S DATA=" *ADDED THROUGH AMENDMENT*" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP4",49,0)
 ..S DATA="Item No. "_$P(ITEM0,U)_"     Item Master File No. "
"RTN","PRCHDSP4",50,0)
 ..S DATA=DATA_$P(ITEM0,U,5)_"     BOC: "_+$P(ITEM0,U,4)
"RTN","PRCHDSP4",51,0)
 ..S DATA=DATA_"   CONTRACT: "_$P($G(^PRC(442,PRCHPO,2,ITEM,2)),U,2)
"RTN","PRCHDSP4",52,0)
 ..D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP4",53,0)
 ..D NEW^PRCHDSP6
"RTN","PRCHDSP4",54,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDSP4",55,0)
 ..S DATA="    Items per "_UOP_": "_$P(ITEM0,U,12)
"RTN","PRCHDSP4",56,0)
 ..F I=1:1:26-$L(DATA) S DATA=DATA_" "
"RTN","PRCHDSP4",57,0)
 ..S DATA=DATA_"NSN: "_$P(ITEM0,U,13) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP4",58,0)
 ..I $P(ITEM0,U,6)]"" S DATA="    STK#: "_$P(ITEM0,U,6) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP4",59,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHDSP4",60,0)
 ..S DATA="    "_$P(ITEM0,U,2)_" "_UOP_" at $"_$J($P(ITEM0,U,9),12,4)_" = $"_$J($P(ITEM0,U,2)*$P(ITEM0,U,9),9,2)
"RTN","PRCHDSP4",61,0)
 ..D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP4",62,0)
 Q
"RTN","PRCHDSP4",63,0)
 ;
"RTN","PRCHDSP4",64,0)
E22 ;LINE ITEM Delete PRINT
"RTN","PRCHDSP4",65,0)
 G E22^PRCHDSP5 ;NOT ENOUGH ROOM IN THIS ROUTINE.
"RTN","PRCHDSP4",66,0)
 ;
"RTN","PRCHDSP4",67,0)
E23 ;LINE ITEM Edit PRINT
"RTN","PRCHDSP4",68,0)
 G E23^PRCHDSP5
"RTN","PRCHDSP4",69,0)
 ;
"RTN","PRCHDSP4",70,0)
E24 ;SOURCE CODE Edit PRINT
"RTN","PRCHDSP4",71,0)
 G E24^PRCHDSP7
"RTN","PRCHDSP4",72,0)
 ;
"RTN","PRCHDSP4",73,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDSP4",74,0)
 G E25^PRCHDSP6
"RTN","PRCHDSP4",75,0)
 ;
"RTN","PRCHDSP4",76,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDSP4",77,0)
 G E26^PRCHDSP6
"RTN","PRCHDSP4",78,0)
 ;
"RTN","PRCHDSP4",79,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDSP4",80,0)
 G E27^PRCHDSP6
"RTN","PRCHDSP4",81,0)
 ;
"RTN","PRCHDSP4",82,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDSP4",83,0)
 G E28^PRCHDSP6
"RTN","PRCHDSP4",84,0)
 ;
"RTN","PRCHDSP4",85,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDSP4",86,0)
 G E29^PRCHDSP6
"RTN","PRCHDSP4",87,0)
 ;
"RTN","PRCHDSP4",88,0)
E30 ;F.C.P. Edit PRINT
"RTN","PRCHDSP4",89,0)
 G E30^PRCHDSP7
"RTN","PRCHDSP4",90,0)
 ;
"RTN","PRCHDSP4",91,0)
E31 ;Change VENDOR PRINT
"RTN","PRCHDSP4",92,0)
 G E31^PRCHDSP7
"RTN","PRCHDSP4",93,0)
 ;
"RTN","PRCHDSP4",94,0)
E32 ;REPLACE P.O. NUMBER PRINT
"RTN","PRCHDSP4",95,0)
 G E32^PRCHDSP7
"RTN","PRCHDSP4",96,0)
 ;
"RTN","PRCHDSP4",97,0)
E33 ;PROMPT PAYMENT Edit PRINT
"RTN","PRCHDSP4",98,0)
 G E33^PRCHDSP7
"RTN","PRCHDSP4",99,0)
 ;
"RTN","PRCHDSP4",100,0)
E34 ;AUTHORITY Edit PRINT
"RTN","PRCHDSP4",101,0)
 G E34^PRCHDSP8
"RTN","PRCHDSP4",102,0)
 ;
"RTN","PRCHDSP4",103,0)
E35 ;F.O.B. Point PRINT
"RTN","PRCHDSP4",104,0)
 G E35^PRCHDSP8
"RTN","PRCHDSP4",105,0)
 ;
"RTN","PRCHDSP4",106,0)
E36 ;ITEM DISCOUNT Add/Edit PRINT
"RTN","PRCHDSP4",107,0)
 G E36^PRCHDSP8
"RTN","PRCHDSP4",108,0)
 ;
"RTN","PRCHDSP4",109,0)
E37 ;ITEM DISCOUNT Delete PRINT
"RTN","PRCHDSP4",110,0)
 G E37^PRCHDSP8
"RTN","PRCHDSP4",111,0)
 ;
"RTN","PRCHDSP4",112,0)
E98 ;DELIVERY DATE PRINT
"RTN","PRCHDSP4",113,0)
 G E98^PRCHDSP6       ;PRC*5.1*180 Call to display Delivery Date changes
"RTN","PRCHDSP4",114,0)
 Q
"RTN","PRCHDSP4",115,0)
E99 ;NET AMOUNT PRINT
"RTN","PRCHDSP4",116,0)
 Q
"RTN","PRCHDSP6")
0^10^B20078350^B16253538
"RTN","PRCHDSP6",1,0)
PRCHDSP6 ;WISC/DJM-PRINT AMENDMENT, ROUTINE #3 ;6/29/00  12:20
"RTN","PRCHDSP6",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCHDSP6",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDSP6",4,0)
 ;
"RTN","PRCHDSP6",5,0)
 ;PRC*5.1*180 Add Amend to Delivery date display (98-7)
"RTN","PRCHDSP6",6,0)
 ;
"RTN","PRCHDSP6",7,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHDSP6",8,0)
 N CHANGE,OLD,MIT,LCNT,DATA,SITE
"RTN","PRCHDSP6",9,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",10,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.04,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",11,0)
 .S SITE=$P($G(^PRC(442,PRCHPO,23)),U,7) S SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(442,PRCHPO,0),U),"-"))
"RTN","PRCHDSP6",12,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P($S($D(^PRC(411,SITE,4,OLD,0)):^(0),1:""),U)
"RTN","PRCHDSP6",13,0)
 .S MIT=$P(^PRC(442,PRCHPO,12),U,6),MIT=$P($S($D(^PRC(411,SITE,4,MIT,0)):^(0),1:""),U)
"RTN","PRCHDSP6",14,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="MAIL INVOICE to "_OLD_" has been  **AMENDED**  to become MAIL INVOICE to "_MIT
"RTN","PRCHDSP6",15,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",16,0)
 Q
"RTN","PRCHDSP6",17,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHDSP6",18,0)
 N CHANGE,MOP,OLD,LCNT,DATA
"RTN","PRCHDSP6",19,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",20,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.02,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",21,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRCD(442.5,OLD,0),U)
"RTN","PRCHDSP6",22,0)
 .S MOP=$P(^PRC(442,PRCHPO,0),U,2),MOP=$P(^PRCD(442.5,MOP,0),U)
"RTN","PRCHDSP6",23,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="METHOD of PAYMENT of "_OLD D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",24,0)
 .S DATA="has been changed to "_MOP D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",25,0)
 Q
"RTN","PRCHDSP6",26,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHDSP6",27,0)
 N CHANGE,CHANGES,AC,VAL,LCNT,DATA
"RTN","PRCHDSP6",28,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",29,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",30,0)
 .S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0)
"RTN","PRCHDSP6",31,0)
 .S AC=$P(CHANGES,U,4),VAL=$G(^PRC(442,PRCHPO,15,AC,0)) Q:VAL=""
"RTN","PRCHDSP6",32,0)
 .S AC=$P(VAL,U),VAL=$P($G(^PRC(442.7,+VAL,0)),U,2)
"RTN","PRCHDSP6",33,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_", "_VAL_", has been ADDED"
"RTN","PRCHDSP6",34,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",35,0)
 Q
"RTN","PRCHDSP6",36,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHDSP6",37,0)
 N CHANGE,CHANGES,AC,OLD,LCNT,DATA
"RTN","PRCHDSP6",38,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",39,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",40,0)
 .S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDSP6",41,0)
 .S AC=$P(CHANGES,U,4),OLD=$S(OLD>0:$P($G(^PRC(442.7,+OLD,0)),U,2),1:""),OLD=$S(OLD]"":", "_OLD_",",1:"")
"RTN","PRCHDSP6",42,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_OLD D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",43,0)
 .S DATA="has been DELETED"
"RTN","PRCHDSP6",44,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",45,0)
 Q
"RTN","PRCHDSP6",46,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHDSP6",47,0)
 N CHANGE,OLD,EST,LCNT,DATA,OBOC,OBOC1,FLAG
"RTN","PRCHDSP6",48,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",49,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,13,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",50,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$FN(OLD,"-",2)
"RTN","PRCHDSP6",51,0)
 .S EST=$P(^PRC(442,PRCHPO,0),U,13),EST=$FN(EST,"-",2)
"RTN","PRCHDSP6",52,0)
 .S (OBOC1,FLAG)=0 K OBOC
"RTN","PRCHDSP6",53,0)
 .F  S OBOC1=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,13.05,OBOC1)) Q:OBOC1'>0  D  Q:FLAG=1
"RTN","PRCHDSP6",54,0)
 .D LINE^PRCHPAM5(.LCNT,2)
"RTN","PRCHDSP6",55,0)
 .I OLD'>0 D
"RTN","PRCHDSP6",56,0)
 ..S DATA="**ADDED THROUGH AMENDMENT**" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",57,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_EST_" has been added" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",58,0)
 ..Q
"RTN","PRCHDSP6",59,0)
 .I OLD>0 D
"RTN","PRCHDSP6",60,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_OLD_" has been changed" D DATA^PRCHPAM5(.LCNT,DATA) S DATA="to $"_EST D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",61,0)
 ..Q
"RTN","PRCHDSP6",62,0)
 .D LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",63,0)
 .Q
"RTN","PRCHDSP6",64,0)
 Q
"RTN","PRCHDSP6",65,0)
 ;
"RTN","PRCHDSP6",66,0)
E98 ;
"RTN","PRCHDSP6",67,0)
 ;Edit DELIVERY DATE           ;PRC*5.1*180 Display of Delivery Date amend
"RTN","PRCHDSP6",68,0)
 N CHANGE,DDATE,OLD,LCNT,DATA
"RTN","PRCHDSP6",69,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHDSP6",70,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,7,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDSP6",71,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDSP6",72,0)
 .S DDATE=$P(^PRC(442,PRCHPO,0),U,10)
"RTN","PRCHDSP6",73,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="DELIVERY DATE "_$$FMTE^XLFDT(OLD)_" has been changed to "_$$FMTE^XLFDT(DDATE) D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHDSP6",74,0)
 Q
"RTN","PRCHDSP6",75,0)
OLD ;GET ALL THE OLD DESCRIPTION FROM 'CHANGES' MULTIPLE AND SET INTO
"RTN","PRCHDSP6",76,0)
 ;THE DISPLAY '^UTILITY($J,"AMD"' ARRAY.
"RTN","PRCHDSP6",77,0)
 N LINE,DATA
"RTN","PRCHDSP6",78,0)
 S LINE=1
"RTN","PRCHDSP6",79,0)
 F  D:DES]""  Q:DES=""
"RTN","PRCHDSP6",80,0)
 .S DATA=$E(DES,1,75) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",81,0)
 .S DES=$E(DES,76,255) Q:$L(DES)'<75  Q:LINE'>0
"RTN","PRCHDSP6",82,0)
 .S LINE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,PRCHLN,1,LINE)) Q:LINE'>0
"RTN","PRCHDSP6",83,0)
 .S DES=DES_$G(^PRC(442,PRCHPO,6,PRCHAM,3,PRCHLN,1,LINE,0))
"RTN","PRCHDSP6",84,0)
 .Q
"RTN","PRCHDSP6",85,0)
 Q
"RTN","PRCHDSP6",86,0)
 ;
"RTN","PRCHDSP6",87,0)
NEW ;GET ALL THE DESCRIPTION FROM THE LINE ITEM MULTIPLE AND SET
"RTN","PRCHDSP6",88,0)
 ;INTO THE DISPLAY '^UTILITY($J,"AMD"' ARRAY.
"RTN","PRCHDSP6",89,0)
 N LINE,DATA
"RTN","PRCHDSP6",90,0)
 S LINE=1
"RTN","PRCHDSP6",91,0)
 F  D:ITEM1]""  Q:ITEM1=""
"RTN","PRCHDSP6",92,0)
 .S DATA=$E(ITEM1,1,75) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHDSP6",93,0)
 .S ITEM1=$E(ITEM1,76,255) Q:$L(ITEM1)'<75  Q:LINE'>0
"RTN","PRCHDSP6",94,0)
 .S LINE=$O(^PRC(442,PRCHPO,2,ITEM,1,LINE)) Q:LINE'>0
"RTN","PRCHDSP6",95,0)
 .S ITEM1=ITEM1_$G(^PRC(442,PRCHPO,2,ITEM,1,LINE,0))
"RTN","PRCHDSP6",96,0)
 .Q
"RTN","PRCHDSP6",97,0)
 Q
"RTN","PRCHPAM2")
0^7^B15193629^B14245890
"RTN","PRCHPAM2",1,0)
PRCHPAM2 ;WISC/DJM-PRINT AMENDMENT ;6/29/00  12:20
"RTN","PRCHPAM2",2,0)
V ;;5.1;IFCAP;**21,180**;Oct 20, 2000;Build 5
"RTN","PRCHPAM2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHPAM2",4,0)
 ;
"RTN","PRCHPAM2",5,0)
 ;PRC*5.1*180 Add call to display amendment Delivery Date change
"RTN","PRCHPAM2",6,0)
 ;
"RTN","PRCHPAM2",7,0)
START(PRCHPO,PRCHAM) ;PRCHPO IS 443.6 INTERNAL ENTRY NUMBER FOR RECORD BEING AMENDED.
"RTN","PRCHPAM2",8,0)
 ;PRCHAM IS IEN AMENDMENT MULTIPLE WITHIN PRCHPO BEING AMENDED.
"RTN","PRCHPAM2",9,0)
 ;FIND OUT WHAT TYPES OF AMENDMENTS HAVE BEEN DONE TO BE ABLE TO
"RTN","PRCHPAM2",10,0)
 ;DETERMINE WHAT TO PRINT OUT.
"RTN","PRCHPAM2",11,0)
 N AMEND,GOTO
"RTN","PRCHPAM2",12,0)
 S AMEND=0 F  S AMEND=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND)) Q:AMEND'>0  S GOTO="E"_+AMEND_"^PRCHPAM2" D @GOTO
"RTN","PRCHPAM2",13,0)
 D LCNT^PRCHPAM5(.LCNT) S LCNTX=LCNT I LCNT>37 S LCNT=LCNT-52
"RTN","PRCHPAM2",14,0)
 F  Q:LCNT'>41  S LCNT=LCNT-56,PRCHPGT=PRCHPGT+1
"RTN","PRCHPAM2",15,0)
 S:LCNTX>37 PRCHPGT=PRCHPGT+1
"RTN","PRCHPAM2",16,0)
 Q
"RTN","PRCHPAM2",17,0)
 ;
"RTN","PRCHPAM2",18,0)
E20 ;SHIP TO Edit PRINT
"RTN","PRCHPAM2",19,0)
 N FIELD,CHANGE,CHANGES,OLD,NEW,LCNT,DATA,SITE
"RTN","PRCHPAM2",20,0)
 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM2",21,0)
 S FIELD=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,0)) Q:FIELD'>0
"RTN","PRCHPAM2",22,0)
 S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,0)) Q:CHANGE'>0
"RTN","PRCHPAM2",23,0)
 S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHPAM2",24,0)
 S SHIP=$P($P(CHANGES,U,3),";")
"RTN","PRCHPAM2",25,0)
 I SHIP=5.4 D
"RTN","PRCHPAM2",26,0)
 .S SITE=$P($G(^PRC(443.6,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(443.6,PRCHPO,0),U),"-"))
"RTN","PRCHPAM2",27,0)
 .S OLD=$P(^PRC(411,SITE,1,OLD,0),U)
"RTN","PRCHPAM2",28,0)
 .S NEW=$P(^PRC(443.6,PRCHPO,1),U,3),NEW=$P(^PRC(411,SITE,1,NEW,0),U)
"RTN","PRCHPAM2",29,0)
 .Q
"RTN","PRCHPAM2",30,0)
 I SHIP=5.3 D
"RTN","PRCHPAM2",31,0)
 .S NEW=$P(^PRC(443.6,PRCHPO,1),U,12),NEW=$P(^PRC(440.2,NEW,0),U),NEW=$P($P(^DPT(NEW,0),U),",",2)_" "_$P($P(^DPT(NEW,0),U),",")
"RTN","PRCHPAM2",32,0)
 .S OLD=$P(^PRC(440.2,OLD,0),U),OLD=$P($P(^DPT(OLD,0),U),",",2)_" "_$P($P(^DPT(OLD,0),U),",")
"RTN","PRCHPAM2",33,0)
 .Q
"RTN","PRCHPAM2",34,0)
 D LINE^PRCHPAM5(.LCNT,2) S DATA="Ship to location "_OLD_" has been changed to "_NEW_"."
"RTN","PRCHPAM2",35,0)
 D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM2",36,0)
 Q
"RTN","PRCHPAM2",37,0)
E21 ;LINE ITEM Add PRINT
"RTN","PRCHPAM2",38,0)
 N FIELD,CHANGE,CHANGES,OLD,ITEM,ITEM0,ITEM1,LCNT,DATA,I,UOP
"RTN","PRCHPAM2",39,0)
 S FIELD=0 K ITEM D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM2",40,0)
 F  S FIELD=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD)) Q:FIELD'>0  D
"RTN","PRCHPAM2",41,0)
 .S CHANGE=0 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM2",42,0)
 ..S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHPAM2",43,0)
 ..S ITEM=$P(CHANGES,U,4) Q:$D(ITEM(ITEM))  S ITEM(ITEM)=1
"RTN","PRCHPAM2",44,0)
 ..S ITEM0=$G(^PRC(443.6,PRCHPO,2,ITEM,0))
"RTN","PRCHPAM2",45,0)
 ..I ITEM0="" Q
"RTN","PRCHPAM2",46,0)
 ..I $P(ITEM0,U,2)=0,$P(ITEM0,U,9)=0 Q
"RTN","PRCHPAM2",47,0)
 ..S ITEM1=$G(^PRC(443.6,PRCHPO,2,ITEM,1,1,0))
"RTN","PRCHPAM2",48,0)
 ..D LINE^PRCHPAM5(.LCNT,2) S DATA=" *ADDED THROUGH AMENDMENT*" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM2",49,0)
 ..S DATA="Item No. "_$P(ITEM0,U)_"     Item Master File No. "
"RTN","PRCHPAM2",50,0)
 ..S DATA=DATA_$P(ITEM0,U,5)_"     BOC: "_+$P(ITEM0,U,4)
"RTN","PRCHPAM2",51,0)
 ..S DATA=DATA_"   CONTRACT: "_$P($G(^PRC(443.6,PRCHPO,2,ITEM,2)),U,2)
"RTN","PRCHPAM2",52,0)
 ..D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM2",53,0)
 ..D NEW^PRCHPAM5
"RTN","PRCHPAM2",54,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHPAM2",55,0)
 ..S DATA="    Items per "_UOP_": "_$P(ITEM0,U,12)
"RTN","PRCHPAM2",56,0)
 ..F I=1:1:26-$L(DATA) S DATA=DATA_" "
"RTN","PRCHPAM2",57,0)
 ..S DATA=DATA_"NSN: "_$P(ITEM0,U,13) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM2",58,0)
 ..I $P(ITEM0,U,6)]"" S DATA="    STK#: "_$P(ITEM0,U,6) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM2",59,0)
 ..S UOP=$S($P(ITEM0,U,3)>0:$P($G(^PRCD(420.5,$P(ITEM0,U,3),0)),U),1:"")
"RTN","PRCHPAM2",60,0)
 ..S DATA="    "_$P(ITEM0,U,2)_" "_UOP_" at $"_$J($P(ITEM0,U,9),12,4)_" = $"_$J($P(ITEM0,U,2)*$P(ITEM0,U,9),9,2)
"RTN","PRCHPAM2",61,0)
 ..D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM2",62,0)
 Q
"RTN","PRCHPAM2",63,0)
 ;
"RTN","PRCHPAM2",64,0)
E22 ;LINE ITEM Delete PRINT
"RTN","PRCHPAM2",65,0)
 G E22^PRCHPAM3 ;NOT ENOUGH ROOM IN THIS ROUTINE.
"RTN","PRCHPAM2",66,0)
 ;
"RTN","PRCHPAM2",67,0)
E23 ;LINE ITEM Edit PRINT
"RTN","PRCHPAM2",68,0)
 G E23^PRCHPAM3
"RTN","PRCHPAM2",69,0)
 ;
"RTN","PRCHPAM2",70,0)
E24 ;SOURCE CODE Edit PRINT
"RTN","PRCHPAM2",71,0)
 G E24^PRCHPAM5
"RTN","PRCHPAM2",72,0)
 ;
"RTN","PRCHPAM2",73,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHPAM2",74,0)
 G E25^PRCHPAM4
"RTN","PRCHPAM2",75,0)
 ;
"RTN","PRCHPAM2",76,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHPAM2",77,0)
 G E26^PRCHPAM4
"RTN","PRCHPAM2",78,0)
 ;
"RTN","PRCHPAM2",79,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHPAM2",80,0)
 G E27^PRCHPAM4
"RTN","PRCHPAM2",81,0)
 ;
"RTN","PRCHPAM2",82,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHPAM2",83,0)
 G E28^PRCHPAM4
"RTN","PRCHPAM2",84,0)
 ;
"RTN","PRCHPAM2",85,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHPAM2",86,0)
 G E29^PRCHPAM4
"RTN","PRCHPAM2",87,0)
 ;
"RTN","PRCHPAM2",88,0)
E30 ;F.C.P. Edit PRINT
"RTN","PRCHPAM2",89,0)
 G E30^PRCHPAM5
"RTN","PRCHPAM2",90,0)
 ;
"RTN","PRCHPAM2",91,0)
E31 ;Change VENDOR PRINT
"RTN","PRCHPAM2",92,0)
 G E31^PRCHPAM5
"RTN","PRCHPAM2",93,0)
 ;
"RTN","PRCHPAM2",94,0)
E32 ;REPLACE P.O. NUMBER PRINT
"RTN","PRCHPAM2",95,0)
 G E32^PRCHPAM5
"RTN","PRCHPAM2",96,0)
 ;
"RTN","PRCHPAM2",97,0)
E33 ;PROMPT PAYMENT Edit PRINT
"RTN","PRCHPAM2",98,0)
 G E33^PRCHPAM6
"RTN","PRCHPAM2",99,0)
 ;
"RTN","PRCHPAM2",100,0)
E34 ;AUTHORITY Edit PRINT
"RTN","PRCHPAM2",101,0)
 G E34^PRCHPAM6
"RTN","PRCHPAM2",102,0)
 ;
"RTN","PRCHPAM2",103,0)
E35 ;F.O.B. Point PRINT
"RTN","PRCHPAM2",104,0)
 G E35^PRCHPAM6
"RTN","PRCHPAM2",105,0)
 ;
"RTN","PRCHPAM2",106,0)
E36 ;ITEM DISCOUNT Add PRINT
"RTN","PRCHPAM2",107,0)
 G E36^PRCHPAM7
"RTN","PRCHPAM2",108,0)
 ;
"RTN","PRCHPAM2",109,0)
E37 ;ITEM DISCOUNT Delete PRINT
"RTN","PRCHPAM2",110,0)
 G E37^PRCHPAM7
"RTN","PRCHPAM2",111,0)
 ;
"RTN","PRCHPAM2",112,0)
E98 ;DELIVERY DATE PRINT
"RTN","PRCHPAM2",113,0)
 G E98^PRCHPAM4       ;PRC*5.1*180 Call to display Delivery Date changes
"RTN","PRCHPAM2",114,0)
 Q
"RTN","PRCHPAM2",115,0)
E99 ;NET AMOUNT PRINT
"RTN","PRCHPAM2",116,0)
 Q
"RTN","PRCHPAM4")
0^8^B18748994^B15124183
"RTN","PRCHPAM4",1,0)
PRCHPAM4 ;WISC/DJM-PRINT AMENDMENT, ROUTINE #3 ;6/29/00  12:21
"RTN","PRCHPAM4",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCHPAM4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHPAM4",4,0)
 ;
"RTN","PRCHPAM4",5,0)
 ;PRC*5.1*180 Add Amend to Delivery date display (98-7)
"RTN","PRCHPAM4",6,0)
 ;
"RTN","PRCHPAM4",7,0)
E25 ;Edit MAIL INVOICE TO PRINT
"RTN","PRCHPAM4",8,0)
 N CHANGE,OLD,MIT,LCNT,DATA,SITE
"RTN","PRCHPAM4",9,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",10,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.04,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",11,0)
 .S SITE=$P($G(^PRC(443.6,PRCHPO,23)),U,7),SITE=$S($G(SITE)]"":SITE,1:$P($P(^PRC(443.6,PRCHPO,0),U),"-"))
"RTN","PRCHPAM4",12,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P($S($D(^PRC(411,SITE,4,OLD,0)):^(0),1:""),U)
"RTN","PRCHPAM4",13,0)
 .S MIT=$P(^PRC(443.6,PRCHPO,12),U,6),MIT=$P($S($D(^PRC(411,SITE,4,MIT,0)):^(0),1:""),U)
"RTN","PRCHPAM4",14,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="MAIL INVOICE to "_OLD_" has been  **AMENDED**  to become MAIL INVOICE to "_MIT
"RTN","PRCHPAM4",15,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",16,0)
 Q
"RTN","PRCHPAM4",17,0)
E26 ;Edit METHOD OF PAYMENT PRINT
"RTN","PRCHPAM4",18,0)
 N CHANGE,MOP,OLD,LCNT,DATA
"RTN","PRCHPAM4",19,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",20,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.02,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",21,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRCD(442.5,OLD,0),U)
"RTN","PRCHPAM4",22,0)
 .S MOP=$P(^PRC(443.6,PRCHPO,0),U,2),MOP=$P(^PRCD(442.5,MOP,0),U)
"RTN","PRCHPAM4",23,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="METHOD of PAYMENT of "_OLD D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",24,0)
 .S DATA="has been changed to "_MOP D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",25,0)
 Q
"RTN","PRCHPAM4",26,0)
E27 ;ADMINISTRATIVE CERTIFICATION Add PRINT
"RTN","PRCHPAM4",27,0)
 N CHANGE,CHANGES,AC,VAL,LCNT,DATA
"RTN","PRCHPAM4",28,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",29,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",30,0)
 .S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0)
"RTN","PRCHPAM4",31,0)
 .S AC=$P(CHANGES,U,4),VAL=$G(^PRC(443.6,PRCHPO,15,AC,0)) Q:VAL=""
"RTN","PRCHPAM4",32,0)
 .S AC=$P(VAL,U),VAL=$P($G(^PRC(442.7,+VAL,0)),U,2)
"RTN","PRCHPAM4",33,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_", "_VAL_", has been ADDED"
"RTN","PRCHPAM4",34,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",35,0)
 Q
"RTN","PRCHPAM4",36,0)
E28 ;ADMINISTRATIVE CERTIFICATION Delete PRINT
"RTN","PRCHPAM4",37,0)
 N CHANGE,CHANGES,AC,OLD,LCNT,DATA
"RTN","PRCHPAM4",38,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",39,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,.01,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",40,0)
 .S CHANGES=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHPAM4",41,0)
 .S AC=$P(CHANGES,U,4),OLD=$S(OLD>0:$P($G(^PRC(442.7,+OLD,0)),U,2),1:""),OLD=$S(OLD]"":", "_OLD_",",1:"")
"RTN","PRCHPAM4",42,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="ADMINISTRATIVE CERTIFICATION "_AC_OLD D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",43,0)
 .S DATA="has been DELETED"
"RTN","PRCHPAM4",44,0)
 .D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",45,0)
 Q
"RTN","PRCHPAM4",46,0)
E29 ;EST. SHIPPING Edit PRINT
"RTN","PRCHPAM4",47,0)
 N CHANGE,OLD,EST,LCNT,DATA,OBOC,OBOC1,FLAG
"RTN","PRCHPAM4",48,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",49,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,13,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",50,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$FN(OLD,"-",2)
"RTN","PRCHPAM4",51,0)
 .S EST=$P(^PRC(443.6,PRCHPO,0),U,13),EST=$FN(EST,"-",2)
"RTN","PRCHPAM4",52,0)
 .S (OBOC1,FLAG)=0 K OBOC
"RTN","PRCHPAM4",53,0)
 .F  S OBOC1=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,13.05,OBOC1)) Q:OBOC1'>0  D  Q:FLAG=1
"RTN","PRCHPAM4",54,0)
 ..S OBOC=+(^PRC(443.6,PRCHPO,6,PRCHAM,3,OBOC1,1,1,0)),FLAG=1 Q
"RTN","PRCHPAM4",55,0)
 .I '$D(OBOC) S OBOC=+$P($G(^PRC(443.6,PRCHPO,23)),U)
"RTN","PRCHPAM4",56,0)
 .D LINE^PRCHPAM5(.LCNT,2)
"RTN","PRCHPAM4",57,0)
 .I OLD'>0 D
"RTN","PRCHPAM4",58,0)
 ..S DATA="**ADDED THROUGH AMENDMENT**" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",59,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_EST_" has been added" D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",60,0)
 ..S DATA="BOC: "_+$P($G(^PRC(443.6,PRCHPO,23)),U) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",61,0)
 ..Q
"RTN","PRCHPAM4",62,0)
 .I OLD>0 D
"RTN","PRCHPAM4",63,0)
 ..S DATA="Estimated Shipping and/or Handling of $"_OLD_" has been changed" D DATA^PRCHPAM5(.LCNT,DATA) S DATA="to $"_EST D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",64,0)
 ..S DATA="BOC: "_OBOC_" has been changed to: "+$P($G(^PRC(443.6,PRCHPO,23)),U) D DATA^PRCHPAM5(.LCNT,DATA)
"RTN","PRCHPAM4",65,0)
 ..Q
"RTN","PRCHPAM4",66,0)
 .D LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",67,0)
 .Q
"RTN","PRCHPAM4",68,0)
 Q
"RTN","PRCHPAM4",69,0)
E98 ;
"RTN","PRCHPAM4",70,0)
 ;Edit DELIVERY DATE           ;PRC*5.1*180 Display of Delivery Date amend
"RTN","PRCHPAM4",71,0)
 N CHANGE,DDATE,OLD,LCNT,DATA
"RTN","PRCHPAM4",72,0)
 S CHANGE=0 D LCNT^PRCHPAM5(.LCNT)
"RTN","PRCHPAM4",73,0)
 F  S CHANGE=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,"AC",AMEND,7,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHPAM4",74,0)
 .S OLD=^PRC(443.6,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHPAM4",75,0)
 .S DDATE=$P(^PRC(443.6,PRCHPO,0),U,10)
"RTN","PRCHPAM4",76,0)
 .D LINE^PRCHPAM5(.LCNT,2) S DATA="DELIVERY DATE "_$$FMTE^XLFDT(OLD)_" has been changed to "_$$FMTE^XLFDT(DDATE) D DATA^PRCHPAM5(.LCNT,DATA),LCNT1^PRCHPAM5(LCNT)
"RTN","PRCHPAM4",77,0)
 Q
"RTN","PRCS180P")
0^1^B1476210^n/a
"RTN","PRCS180P",1,0)
PRCS180P ;RB-POST INSTALL PRC*180 TO ADD 410.9 entry ;4-26-94/3:45 PM
"RTN","PRCS180P",2,0)
V ;;5.1;IFCAP;**180**;Oct 20, 2000;Build 5
"RTN","PRCS180P",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCS180P",4,0)
 Q
"RTN","PRCS180P",5,0)
START ;PRC*5.1*180 Updating file 410.9 [Authority of Request File] with new
"RTN","PRCS180P",6,0)
 ;            sub authority 'R', PC Patient-Centered Community Care
"RTN","PRCS180P",7,0)
A S DIC="^PRCS(410.9,",X="R"
"RTN","PRCS180P",8,0)
 S DLAYGO=410.9,DIC(0)="LXZ" D ^DIC S DA=+Y
"RTN","PRCS180P",9,0)
 S DESCRIP="PATIENT-CENTERED COMMUNITY CARE (PC3) CENTRALIZED ADMIN FEE",FMSCODE="3R"
"RTN","PRCS180P",10,0)
 S DIE="^PRCS(410.9,",DR=".02///^S X=DESCRIP;.03////3;.05///1;.06///0;.07///^S X=FMSCODE"
"RTN","PRCS180P",11,0)
 D ^DIE
"RTN","PRCS180P",12,0)
 D BMES^XPDUTL("Update of Authority of Request File *completed*:")
"RTN","PRCS180P",13,0)
 D MES^XPDUTL("  Added ==> R - PATIENT-CENTERED COMMUNITY CARE (PC3) CENTRALIZED ADMIN FEE")
"RTN","PRCS180P",14,0)
 K DIC,DIE,Y,DLAYGO,MREC,DA,DR,X,DLAYGO,DESCRIP,FMSCODE
"RTN","PRCS180P",15,0)
 Q
"RTN","PRCSUT3")
0^13^B17626422^B16423778
"RTN","PRCSUT3",1,0)
PRCSUT3 ;WISC/SAW/PLT/BGJ-TRANSACTION UTILITY PROGRAM ; 21 Apr 93  10:18 AM
"RTN","PRCSUT3",2,0)
V ;;5.1;IFCAP;**115,123,149,150,180**;Oct 20, 2000;Build 5
"RTN","PRCSUT3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSUT3",4,0)
 ;
"RTN","PRCSUT3",5,0)
 ;PRC*5.1*150 RGB 4/23/12  Control the node 0 counter for file 410
"RTN","PRCSUT3",6,0)
 ;kill (DIK) since DIK call does not handle descending file logic
"RTN","PRCSUT3",7,0)
 ;
"RTN","PRCSUT3",8,0)
 ;PRC*5.1*180 RGB 10/22/12  Added switch coming from IFCAP 1358 
"RTN","PRCSUT3",9,0)
 ;processing to insure new entry check uses file 424, not file 410.
"RTN","PRCSUT3",10,0)
 ;
"RTN","PRCSUT3",11,0)
EN ;CREATE NEW TRANSACTION NUMBER
"RTN","PRCSUT3",12,0)
 D EN1^PRCSUT K DA,DIC G W5:'$D(PRC("SITE")) Q
"RTN","PRCSUT3",13,0)
EN1 G:'$D(X) OUT1 S NODE=0,PIECE=2 I $D(PRCS("TYPE")) G:'X OUT1 S T(1)=$O(^DD(410.1,"B",PRCS("TYPE"),0)) G:'T(1)!('$D(^DD(410.1,+T(1),0))) OUT1
"RTN","PRCSUT3",14,0)
 S DIC="^PRCS(410.1,",MSG="",ZERSW=0
"RTN","PRCSUT3",15,0)
 ;I $D(^PRCS(410.1,"B",X)) S N="",N=$O(^PRCS(410.1,"B",X,N)),DA=N L +^PRCS410.1,N):15 G:$T=0 OUT1 S T=$P(^PRCS(410.1,N,NODE),"^",PIECE)+1 S:T<1 T=1 L -^PRCS(410.1,N))
"RTN","PRCSUT3",16,0)
 I $D(^PRCS(410.1,"B",X)) S N="",N=$O(^PRCS(410.1,"B",X,N)),DA=N S T=$P(^PRCS(410.1,N,NODE),"^",PIECE)+1 S:T<1 T=1
"RTN","PRCSUT3",17,0)
 I '$D(^PRCS(410.1,"B",X)) S T=1,DLAYGO=410.1,DIC="^PRCS(410.1,",DIC(0)="FLXZ" D ^DIC K DLAYGO G:Y<0 W4 S DA=+Y
"RTN","PRCSUT3",18,0)
 S HDA=DA
"RTN","PRCSUT3",19,0)
T S T="000"_T,T=$E(T,$L(T)-3,$L(T))
"RTN","PRCSUT3",20,0)
T1 I $D(REP),$G(PRCE424)'=1 S X=X_"-"_T I $D(^PRCS(410,"B",X)) S T=+T+1,X=$P(X,"-",1,4) G:T>9999 CANCK G T    ;PRC*5.1*180
"RTN","PRCSUT3",21,0)
 I '$D(REP),'$D(PRCS("TYPE")),$G(PRCE424)'=1 S X=Z,X=X_"-"_T I $D(^PRCS(410,"B",X)) S T=+T+1 G:T>9999 CANCK G T    ;PRC*5.1*180
"RTN","PRCSUT3",22,0)
 I ('$D(REP)&$D(PRCS("TYPE")))!($G(PRCE424)=1) S Z=X,X=X_"-"_T I $D(^PRC(424,"B",X)) S T=+T+1,X=Z G:T>9999 CER G T   ;PRC*5.1*180
"RTN","PRCSUT3",23,0)
TEX S DA=HDA L +^PRCS(410.1,DA):15 S $P(^PRCS(410.1,DA,NODE),U,PIECE)=+T,$P(^(0),U,3)=DT L -^PRCS(410.1,DA)
"RTN","PRCSUT3",24,0)
OUT K DA,DIC,N,NODE,PIECE,PRCS("TYPE"),PRCSL,T,Z,HDA Q
"RTN","PRCSUT3",25,0)
OUT1 S X="",Y=-1 D OUT Q
"RTN","PRCSUT3",26,0)
EN2 ;add record in file 410
"RTN","PRCSUT3",27,0)
 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="LXZ" D ^DIC K DLAYGO G:Y<0 W4
"RTN","PRCSUT3",28,0)
EN2A S DA=+Y S:'$D(T(2)) T(2)=""
"RTN","PRCSUT3",29,0)
 S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCSUT3",30,0)
 S PRCSAPP=$P(PRC("ACC"),"^",11)
"RTN","PRCSUT3",31,0)
 S ^PRCS(410,DA,0)=$P(^PRCS(410,DA,0),U)_"^^"_T(2)_"^^"_PRC("SITE"),^PRCS(410,DA,3)=PRC("CP")_"^"_PRCSAPP,$P(^(3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSUT3",32,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSUT3",33,0)
 S ^PRCS(410,"AN",$E(PRC("CP"),1,30),DA)=""
"RTN","PRCSUT3",34,0)
 D ERS410^PRC0G(DA_"^E")
"RTN","PRCSUT3",35,0)
 S:T(2)'="" ^PRCS(410,"H",$E(T(2),1,30),DA)=DUZ,$P(^PRCS(410,DA,11),"^",2)=DUZ,^PRCS(410,"K",+$P(PRC("CP")," "),DA)="",$P(^PRCS(410,DA,6),"^",4)=+$P(PRC("CP")," ") K PRCSAPP
"RTN","PRCSUT3",36,0)
EN2B S:$D(PRC("SST")) $P(^PRCS(410,DA,0),"^",10)=PRC("SST")
"RTN","PRCSUT3",37,0)
 D:$D(MYY) ERS410^PRC0G(DA_"^E") Q
"RTN","PRCSUT3",38,0)
EN3 ;INPUT TRANSFORM FOR REORDERING 410 FILE ENTRIES
"RTN","PRCSUT3",39,0)
 ;Add mod (PRC*149) to insure that the next ien used is not below 20,000,000. 
"RTN","PRCSUT3",40,0)
 ;Start back at closest ien to last realistic ien using for loop check to look for last used ien when next ien is below 20,000,000.
"RTN","PRCSUT3",41,0)
 Q:'$D(X)  I $D(^PRCS(410,"B",X)) Q
"RTN","PRCSUT3",42,0)
 N PRCSIEN
"RTN","PRCSUT3",43,0)
 L +^PRCS(410,0):$S($G(DILOCKTM)>10:DILOCKTM,1:10) I '$T W $C(7),"ANOTHER USER IS EDITING FILE 410 CONTROL NODE! Please retry in a minute." K X Q
"RTN","PRCSUT3",44,0)
 S PRCSIEN=$P(^PRCS(410,0),"^",3)-1
"RTN","PRCSUT3",45,0)
 I PRCSIEN<20000000!(PRCSIEN>97999999) D  S:PRCSIEN=20000000 PRCSIEN=97999999
"RTN","PRCSUT3",46,0)
 . F I=90000000:-10000000:20000000 I $O(^PRCS(410,I))-I>1000 S PRCSIEN=$O(^PRCS(410,I)) Q
"RTN","PRCSUT3",47,0)
 F PRCSIEN=PRCSIEN:-1 I '$D(^PRCS(410,PRCSIEN)) L +^PRCS(410,PRCSIEN):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T
"RTN","PRCSUT3",48,0)
 L -^PRCS(410,0)
"RTN","PRCSUT3",49,0)
 I PRCSIEN'>0 K X
"RTN","PRCSUT3",50,0)
 E  S DINUM=PRCSIEN
"RTN","PRCSUT3",51,0)
 L -^PRCS(410,PRCSIEN)
"RTN","PRCSUT3",52,0)
 Q
"RTN","PRCSUT3",53,0)
CANCK ;Look for cancelled activity when all seq used
"RTN","PRCSUT3",54,0)
 I ZERSW=0 S ZERSW=1,T=1 G T
"RTN","PRCSUT3",55,0)
CK0 S ZZH=Z,ZHOLD=Z
"RTN","PRCSUT3",56,0)
CK1 S ZZH=$O(^PRCS(410,"B",ZZH)),IEN410=0 G CER:ZZH](Z_"-9999")
"RTN","PRCSUT3",57,0)
CK2 S IEN410=$O(^PRCS(410,"B",ZZH,IEN410)) G CK1:IEN410=""
"RTN","PRCSUT3",58,0)
 I $P($G(^PRCS(410,IEN410,0)),U,2)'="CA" G CK2
"RTN","PRCSUT3",59,0)
 S PRCIENCT=$P(^PRCS(410,0),"^",3)+1      ;PRC*5.1*150
"RTN","PRCSUT3",60,0)
 S DA=IEN410,DIK="^PRCS(410," D ^DIK
"RTN","PRCSUT3",61,0)
 S $P(^PRCS(410,0),"^",3)=PRCIENCT K PRCIENCT     ;PRC*5.1*150
"RTN","PRCSUT3",62,0)
 S T=$P(ZZH,"-",5)
"RTN","PRCSUT3",63,0)
CKQ S Z=ZHOLD K DA,DIK,ZZH,ZHOLD,IEN410
"RTN","PRCSUT3",64,0)
 G T1
"RTN","PRCSUT3",65,0)
CER S MSG="No open sequence number found for "_Z_" for transaction"
"RTN","PRCSUT3",66,0)
 I $G(PRCRMPR)=1 S X="#"
"RTN","PRCSUT3",67,0)
 K DA,DIK,ZZH,IEN410
"RTN","PRCSUT3",68,0)
 G OUT
"RTN","PRCSUT3",69,0)
W1 S %=2 Q:T4'="O"  W !!,"Would you like to edit this request" D YN^DICN G W1:%=0 Q
"RTN","PRCSUT3",70,0)
W4 W !!,"Another user is accessing this file...  Try later.",$C(7) R:$E(IOST,1,2)="C-" X:5 G EXIT
"RTN","PRCSUT3",71,0)
W5 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5
"RTN","PRCSUT3",72,0)
EXIT K %,DA,DIC,DIE,DR,I,L,N,PRCS,PRCSAPP,PRCSDIC,PRC("FY"),PRCSL,PRCSY,PRC("QTR"),T,T1,T2,T3,T4,X,X1,Z,ZERSW Q
"VER")
8.0^22.0
"BLD",7358,6)
^158
**END**
**END**

