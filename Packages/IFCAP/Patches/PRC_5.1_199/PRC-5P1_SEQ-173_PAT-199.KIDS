EMERGENCY Released PRC*5.1*199 SEQ #173
Extracted from mail message
**KIDS**:PRC*5.1*199^

**INSTALL NAME**
PRC*5.1*199
"BLD",7588,0)
PRC*5.1*199^IFCAP^0^3170412^y
"BLD",7588,1,0)
^^4^4^3170410^
"BLD",7588,1,1,0)
1. FMS Exception Report not working due to Fileman date call.
"BLD",7588,1,2,0)
 
"BLD",7588,1,3,0)
2. Prosthetics GUI times out when entering order against FCP with multiple
"BLD",7588,1,4,0)
   Inventory Points attached.
"BLD",7588,4,0)
^9.64PA^^
"BLD",7588,6.3)
3
"BLD",7588,"ABPKG")
n
"BLD",7588,"KRN",0)
^9.67PA^779.2^20
"BLD",7588,"KRN",.4,0)
.4
"BLD",7588,"KRN",.401,0)
.401
"BLD",7588,"KRN",.402,0)
.402
"BLD",7588,"KRN",.403,0)
.403
"BLD",7588,"KRN",.5,0)
.5
"BLD",7588,"KRN",.84,0)
.84
"BLD",7588,"KRN",3.6,0)
3.6
"BLD",7588,"KRN",3.8,0)
3.8
"BLD",7588,"KRN",9.2,0)
9.2
"BLD",7588,"KRN",9.8,0)
9.8
"BLD",7588,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7588,"KRN",9.8,"NM",1,0)
PRCSREC1^^0^B13923369
"BLD",7588,"KRN",9.8,"NM",2,0)
PRCH410^^0^B56623729
"BLD",7588,"KRN",9.8,"NM","B","PRCH410",2)

"BLD",7588,"KRN",9.8,"NM","B","PRCSREC1",1)

"BLD",7588,"KRN",19,0)
19
"BLD",7588,"KRN",19.1,0)
19.1
"BLD",7588,"KRN",101,0)
101
"BLD",7588,"KRN",409.61,0)
409.61
"BLD",7588,"KRN",771,0)
771
"BLD",7588,"KRN",779.2,0)
779.2
"BLD",7588,"KRN",870,0)
870
"BLD",7588,"KRN",8989.51,0)
8989.51
"BLD",7588,"KRN",8989.52,0)
8989.52
"BLD",7588,"KRN",8994,0)
8994
"BLD",7588,"KRN","B",.4,.4)

"BLD",7588,"KRN","B",.401,.401)

"BLD",7588,"KRN","B",.402,.402)

"BLD",7588,"KRN","B",.403,.403)

"BLD",7588,"KRN","B",.5,.5)

"BLD",7588,"KRN","B",.84,.84)

"BLD",7588,"KRN","B",3.6,3.6)

"BLD",7588,"KRN","B",3.8,3.8)

"BLD",7588,"KRN","B",9.2,9.2)

"BLD",7588,"KRN","B",9.8,9.8)

"BLD",7588,"KRN","B",19,19)

"BLD",7588,"KRN","B",19.1,19.1)

"BLD",7588,"KRN","B",101,101)

"BLD",7588,"KRN","B",409.61,409.61)

"BLD",7588,"KRN","B",771,771)

"BLD",7588,"KRN","B",779.2,779.2)

"BLD",7588,"KRN","B",870,870)

"BLD",7588,"KRN","B",8989.51,8989.51)

"BLD",7588,"KRN","B",8989.52,8989.52)

"BLD",7588,"KRN","B",8994,8994)

"BLD",7588,"QDEF")
^^^^NO^^^^^^YES
"BLD",7588,"QUES",0)
^9.62^^
"BLD",7588,"REQB",0)
^9.611^1^1
"BLD",7588,"REQB",1,0)
PRC*5.1*192^2
"BLD",7588,"REQB","B","PRC*5.1*192",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
199^3170412
"PKG",455,22,1,"PAH",1,1,0)
^^4^4^3170412
"PKG",455,22,1,"PAH",1,1,1,0)
1. FMS Exception Report not working due to Fileman date call.
"PKG",455,22,1,"PAH",1,1,2,0)
 
"PKG",455,22,1,"PAH",1,1,3,0)
2. Prosthetics GUI times out when entering order against FCP with multiple
"PKG",455,22,1,"PAH",1,1,4,0)
   Inventory Points attached.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRCH410")
0^2^B56623729^B55006523
"RTN","PRCH410",1,0)
PRCH410 ;WISC/KMB/DXH/DGL - CREATE 2237 FROM PURCHASE CARD ORDER ; 4/4/00 7:56am
"RTN","PRCH410",2,0)
 ;;5.1;IFCAP;**123,171,181,186,192,199**;Oct 20, 2000;Build 3
"RTN","PRCH410",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCH410",4,0)
 ;
"RTN","PRCH410",5,0)
 ; prcsip is package-wide variable for inv pt that may or may not be
"RTN","PRCH410",6,0)
 ; passed to this routine
"RTN","PRCH410",7,0)
 ;
"RTN","PRCH410",8,0)
 ;PRC*5.1*181 Split the update for setting File 442, node 23 piece 23
"RTN","PRCH410",9,0)
 ;            (410 pointer) and piece 13 (sort group) into two sets,
"RTN","PRCH410",10,0)
 ;            410 pointer before the Sort Group query and Sort Group
"RTN","PRCH410",11,0)
 ;            after. This eliminates a user crashing at Sort Group
"RTN","PRCH410",12,0)
 ;            query and creating 2 410 entries due to missing 410 
"RTN","PRCH410",13,0)
 ;            pointer in file 442 that was not set due to Sort
"RTN","PRCH410",14,0)
 ;            Group query failure. 
"RTN","PRCH410",15,0)
 ;
"RTN","PRCH410",16,0)
 ;PRC*5.1*186 RGB 7/1/2014 Fix for 3 Remedy tickets:
"RTN","PRCH410",17,0)
 ;            INC752542 Fix duplicate entries in file 443 by changing 
"RTN","PRCH410",18,0)
 ;                      the direct field 1.5 and x-ref 'AC' set to 
"RTN","PRCH410",19,0)
 ;                      Fileman update of status field.
"RTN","PRCH410",20,0)
 ;            INC952389 Modify logic to insure when All/Delivery switch
"RTN","PRCH410",21,0)
 ;                      is set that the DO affects the Running Balance 
"RTN","PRCH410",22,0)
 ;                      report when auto obligated. Also, modified the
"RTN","PRCH410",23,0)
 ;                      EDI check in same area for logic clarity.
"RTN","PRCH410",24,0)
 ;
"RTN","PRCH410",25,0)
 ;PRC*5.1*192 RGB 12/16/15 Modify Delivery Order auto obligation file
"RTN","PRCH410",26,0)
 ;            410 set for net to field #92 to ensure Running Balance
"RTN","PRCH410",27,0)
 ;            reflects the net amount for order.
"RTN","PRCH410",28,0)
 ;PRC*5.1*199 Check PRCRMPR switch on GUI Prosthetics order filing to
"RTN","PRCH410",29,0)
 ;            skip inventory point selection query for FCPs linked to
"RTN","PRCH410",30,0)
 ;            multiple inventories. 
"RTN","PRCH410",31,0)
 ;
"RTN","PRCH410",32,0)
START ;
"RTN","PRCH410",33,0)
 N VV,ST,Y,Z,Z0,Z1,Z2,I,J,CCEN,ESTS,NET,SERV,EMER,COUNT,COUNT1,L,PDUZ,FY,QTR,CP,LOC,ADATE,TDATE,SDATE,LL,PC,PCREF,XDA
"RTN","PRCH410",34,0)
 N SCP,SGRP,COR,VEN,VEND
"RTN","PRCH410",35,0)
 Q:'$D(DA)  Q:+DA=0  S XDA=DA
"RTN","PRCH410",36,0)
 S Z0=$G(^PRC(442,XDA,0)),PRC("SITE")=$P(Z0,"-"),CP=$P(Z0,"^",3),SCP=$P(CP," "),PRC("SST")=$P($G(^PRC(442,XDA,23)),"^",7),PCREF=$P(Z0,"^"),PCREF=$P(PCREF,"-",2)
"RTN","PRCH410",37,0)
 S TDATE=$$DATE^PRC0C($P($G(^PRC(442,XDA,1)),"^",15),"I"),PRC("FY")=$E(TDATE,3,4),PRC("QTR")=$P(TDATE,"^",2),(TDATE,SDATE)=$P($$DATE^PRC0C("T","E"),"^",7)
"RTN","PRCH410",38,0)
 S CCEN=$P(Z0,"^",5),ESTS=$P(Z0,"^",13),ADATE=$P(Z0,"^",10)
"RTN","PRCH410",39,0)
 I CCEN'="" S CCEN=$E($P(^PRCD(420.1,CCEN,0),"^"),1,30)
"RTN","PRCH410",40,0)
 S Z1=$G(^PRC(442,XDA,1)),(VV,VEND)=$P(Z1,"^"),SERV=$P(Z1,"^",2),EMER=$P(Z1,"^",17),LOC=$P(Z1,"^",11),PDUZ=DUZ
"RTN","PRCH410",41,0)
 S ST="ST" S:EMER="Y" ST="EM"
"RTN","PRCH410",42,0)
 S PRC("CP")=+SCP
"RTN","PRCH410",43,0)
 I $G(PRCSIP) I '$O(^PRC(420,PRC("SITE"),1,PRC("CP"),7,"B",PRCSIP,0)) K PRCSIP ; Kill inventory point if not match FCP
"RTN","PRCH410",44,0)
 I '$G(PRCSIP) S J=0 F  S J=$O(^PRC(442,XDA,2,J)) Q:'J!($G(PRCSIP))  S K=0 F  S K=$O(^PRC(442,XDA,2,J,5,0)) Q:'K!($G(PRCSIP))  S PRCSIP=$P($G(^PRC(442,XDA,2,J,5,K,0)),U)
"RTN","PRCH410",45,0)
IP D:'$G(PRCSIP)&'$G(PRCRMPR) IP^PRCSUT     ;PRC*5.1*199
"RTN","PRCH410",46,0)
 I '$G(PRCSIP),'$G(PRCRMPR),$O(^PRC(420,PRC("SITE"),1,PRC("CP"),7,0)) D  I Y=0 G IP     ;PRC*5.1*199
"RTN","PRCH410",47,0)
 . K DIR S DIR("A")="** WARNING ** No inventory point selected - Continue anyway",DIR("B")="NO",DIR(0)="Y"
"RTN","PRCH410",48,0)
 . S DIR("?",1)="The FCP you entered has Inventory points associated with it, but none have been selected."
"RTN","PRCH410",49,0)
 . S DIR("?")="Press 'Y' to return to the inventory point prompt or 'N' to continue the order without one."
"RTN","PRCH410",50,0)
 . D ^DIR K DIR
"RTN","PRCH410",51,0)
 . I $E(X)="^"!(Y=1) W !,"No inventory point was attached.",! Q
"RTN","PRCH410",52,0)
 . Q
"RTN","PRCH410",53,0)
 S PC=$P($G(^PRC(442,XDA,23)),"^",8)
"RTN","PRCH410",54,0)
 S COUNT=$P($G(^PRC(442,XDA,2,0)),"^",4) I +COUNT'=0 D ITEM I $G(X)="#",$G(PRCRMPR)=1 Q
"RTN","PRCH410",55,0)
 S CDA=$P($G(^PRC(442,XDA,23)),"^",23)
"RTN","PRCH410",56,0)
 S:$G(PRCHPC)=3 CDA=$P($G(^PRC(442,XDA,13,0)),U,3)
"RTN","PRCH410",57,0)
 I CDA="" D REC Q:CDA=""
"RTN","PRCH410",58,0)
 S CCDA=CDA
"RTN","PRCH410",59,0)
SET ;set item data and vendor on record
"RTN","PRCH410",60,0)
 L +^PRCS(410,CDA):15 Q:'$T
"RTN","PRCH410",61,0)
 ;
"RTN","PRCH410",62,0)
 I VEND'="",$P($G(^PRC(440,VEND,0)),"^")'="SIMPLIFIED" S ^PRCS(410,CDA,2)=$G(^PRC(440,VEND,0))
"RTN","PRCH410",63,0)
 I $P($G(^PRC(440,+VEND,0)),"^")="SIMPLIFIED" S VEND="SIMPLIFIED" S:$P($G(^PRC(442,XDA,24)),"^",2)'="" VEND=$P($G(^PRC(442,XDA,24)),"^",2) S ^PRCS(410,CDA,2)=VEND
"RTN","PRCH410",64,0)
 S VEN=$P(^PRCS(410,CDA,2),"^")
"RTN","PRCH410",65,0)
 S COR=$P($G(^PRC(442,XDA,23)),"^",12),SGRP=$P($G(^PRC(442,XDA,23)),"^",13)
"RTN","PRCH410",66,0)
 S DA=CDA,DIE="^PRCS(410,",DR="3////4"_";"_"5///"_TDATE_";"_"7////"_SDATE_";"_"15////"_CP_";"_"15.5////"_CCEN_";"_"21////"_TDATE_";"_"12////"_VV D ^DIE
"RTN","PRCH410",67,0)
 S DR="1////O"_";"_"6.3////"_SERV_";"_"7.5////"_ST_";"_"40////"_DUZ_";"_"68////"_DUZ_";"_"8////"_COR D ^DIE
"RTN","PRCH410",68,0)
 S DR="46////^S X=LOC"_";"_"47////"_ADATE_";"_"48.1////"_ESTS_";"_"52///"_XDA_";"_"24///"_PCREF D ^DIE
"RTN","PRCH410",69,0)
 I $G(PRCSIP) S DR="4////^S X=PRCSIP" D ^DIE
"RTN","PRCH410",70,0)
 I PC="" S PC=9999999
"RTN","PRCH410",71,0)
 S DR="451////^S X=PC" D ^DIE
"RTN","PRCH410",72,0)
 I +COUNT'=0 F IT=1:1:COUNT D
"RTN","PRCH410",73,0)
 .S ^PRCS(410,CDA,"IT",IT,0)=BB(IT)
"RTN","PRCH410",74,0)
 .I +COUNT1'=0 F J=1:1:COUNT1 D
"RTN","PRCH410",75,0)
 ..S:$D(BB(IT,J)) ^PRCS(410,CDA,"IT",IT,1,J,0)=BB(IT,J)
"RTN","PRCH410",76,0)
 .I COUNT1="" S ^PRCS(410,CDA,"IT",IT,1,0)="^^1^1^"_TDATE_"^^"
"RTN","PRCH410",77,0)
 .F LL="AB","B" S ^PRCS(410,CDA,"IT",LL,IT,IT)=""
"RTN","PRCH410",78,0)
 .I $P(BB(IT),"^",4)'="" S ^PRCS(410,CDA,"IT","AG",$P(BB(IT),"^",4),IT)=""
"RTN","PRCH410",79,0)
 .S:+COUNT1'=0 ^PRCS(410,CDA,"IT",IT,1,0)="^410.03^"_COUNT1_"^"_COUNT1
"RTN","PRCH410",80,0)
 I $D(VEN) S ^PRCS(410,"E",$E(VEN,1,30),CDA)=""
"RTN","PRCH410",81,0)
 S ^PRCS(410,"AQ",1,CDA)="" S:COUNT'="" ^PRCS(410,CDA,"IT",0)="^410.02AI^"_COUNT_"^"_COUNT
"RTN","PRCH410",82,0)
 L +^PRC(442,XDA):$S(DILOCKTM>15:DILOCKTM,1:15) Q:'$T  S $P(^PRC(442,XDA,23),"^",23)=CDA L -^PRC(442,XDA)   ;PRC*5.1*181  Set 410 pointer prior to Sort Group query
"RTN","PRCH410",83,0)
 I '$G(PRCPROST),$G(RPUSE)'=1,$G(COMMENT)'="delivery",$G(PRCHPC)'="" S DA=CDA,DR=49 D ^DIE
"RTN","PRCH410",84,0)
 L -^PRCS(410,CDA)
"RTN","PRCH410",85,0)
 L +^PRC(442,XDA):15 Q:'$T  S $P(^PRC(442,XDA,23),"^",13)=$P($G(^PRCS(410,CDA,11)),"^") L -^PRC(442,XDA)
"RTN","PRCH410",86,0)
 S DA=XDA K DIE QUIT
"RTN","PRCH410",87,0)
ITEM ;
"RTN","PRCH410",88,0)
 F IT=1:1:COUNT D
"RTN","PRCH410",89,0)
 .F J=1,2,3,4,5,6,8 S $P(BB(IT),"^",J)=$P($G(^PRC(442,XDA,2,IT,0)),"^",J)
"RTN","PRCH410",90,0)
 .S $P(BB(IT),"^",7)=$P($G(^PRC(442,XDA,2,IT,0)),"^",9)
"RTN","PRCH410",91,0)
 .S COUNT1=$P($G(^PRC(442,XDA,2,IT,1,0)),"^",4) I +COUNT1'=0 F J=1:1:COUNT1 S BB(IT,J)=$G(^PRC(442,XDA,2,IT,1,J,0))
"RTN","PRCH410",92,0)
 QUIT
"RTN","PRCH410",93,0)
REC ;create skeleton 410 record
"RTN","PRCH410",94,0)
 S:$G(XDA)'="" PRC("CP")=$P($G(^PRC(442,XDA,0)),U,3)
"RTN","PRCH410",95,0)
 Q:+$G(PRC("CP"))=0
"RTN","PRCH410",96,0)
 S T(2)="",Z=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("QTR")_"-"_$P(PRC("CP")," ")
"RTN","PRCH410",97,0)
 S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(PRC("CP")," "),1)
"RTN","PRCH410",98,0)
 S X=$P(Z,"-",1,2)_"-"_$P(PRC("CP")," ")
"RTN","PRCH410",99,0)
 D EN1^PRCSUT3 Q:'$D(X)  Q:$G(X)="#"&($G(PRCRMPR)=1)  S X1=X D EN2^PRCSUT3 Q:$G(DA)=""  Q:'$D(X1)  S CDA=DA
"RTN","PRCH410",100,0)
 K X,T(2) QUIT
"RTN","PRCH410",101,0)
ESIG ;put ESIG on record, update due-ins
"RTN","PRCH410",102,0)
 N PRCHOBL     ;PRC*171 D.O. auto obligate flags
"RTN","PRCH410",103,0)
 S NET=$P($G(^PRC(442,PODA,0)),"^",16) L +^PRCS(410,DA):15 Q:'$T  F I=1,8 S $P(^PRCS(410,DA,4),"^",I)=NET  ;PRC*5.1*192
"RTN","PRCH410",104,0)
 I $D(PRCHDELV) D SWCHK   ;PRC*171 D.O. auto obligate check for EDI and All/Delivery flags on
"RTN","PRCH410",105,0)
 I $D(PRCHDELV),PRCHOBL=1 S $P(^PRCS(410,DA,4),"^",3)=NET,$P(^PRCS(410,DA,4),"^",4)=$P(^PRCS(410,DA,1),"^")   ;PRC*171 auto obligate sets for D.O. flag sets
"RTN","PRCH410",106,0)
 S:'$D(PRC("CP")) ZIP=$P(^PRC(442,PODA,0),"^",3),PRC("CP")=$P(ZIP," ") Q:PRC("CP")=""
"RTN","PRCH410",107,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",108,0)
 L -^PRCS(410,DA)
"RTN","PRCH410",109,0)
 D ERS410^PRC0G(DA_"^A")
"RTN","PRCH410",110,0)
 S MESSAGE="" D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCH410",111,0)
 S:'$D(PRC("CP")) ZIP=$P(^PRC(442,PODA,0),"^",3),PRC("CP")=$P(ZIP," ") Q:PRC("CP")=""
"RTN","PRCH410",112,0)
 D:'$D(PRC("FY")) FY^PRCH442
"RTN","PRCH410",113,0)
 N KTEMP S KTEMP=X
"RTN","PRCH410",114,0)
 S AA=PRC("SITE")_"^"_+PRC("CP")_"^"_PRC("FY")_"^"_PRC("QTR")_"^"_NET D EBAL^PRCSEZ(AA,"C") I $D(PRCHDELV),PRCHOBL=1 D EBAL^PRCSEZ(AA,"O")   ;PRC*171 auto obligate sets for D.O. flag sets
"RTN","PRCH410",115,0)
 S X=KTEMP
"RTN","PRCH410",116,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",117,0)
 W !,"Cost of this request: $",$J(X,0,2),!,"Current Control Point Balance: $",$J(BAL,0,2),!
"RTN","PRCH410",118,0)
 S PRCSN=$G(^PRCS(410,DA,0))
"RTN","PRCH410",119,0)
 ;PRC*5.1*186
"RTN","PRCH410",120,0)
 I $P(PRCSN,U,4)>1 D
"RTN","PRCH410",121,0)
 . S X=$P(PRCSN,U,1),DIC="^PRC(443,",DIC(0)="L",DLAYGO=443 D ^DIC K DIC,DLAYGO,X
"RTN","PRCH410",122,0)
 . S X=$O(^PRCD(442.3,"C",60,0)),PRCHSTS=X
"RTN","PRCH410",123,0)
 . S DIE="^PRC(443,",DR="1.5////^S X=PRCHSTS" D ^DIE K DR,DIE,PRCHSTS,X
"RTN","PRCH410",124,0)
 . S $P(^PRC(443,DA,0),U,11)=$P(PRCSN,U,6)
"RTN","PRCH410",125,0)
 I '$G(PRCHPHAM),$G(PRCHPC)'=1 D EN2^PRCPWI
"RTN","PRCH410",126,0)
 S PRCSINV=$P(^PRCS(410,DA,0),U,6)
"RTN","PRCH410",127,0)
 S DIE="^PRC(443,",DR="9///^S X=1;10///^S X=4;11////^S X=PRCSINV;13///^S X=""E"";3.7///^S X=5730;3.5///^S X=1;2////^S X=DUZ"
"RTN","PRCH410",128,0)
 D ^DIE K DIE,DR
"RTN","PRCH410",129,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",130,0)
 D ES1^PRCHG
"RTN","PRCH410",131,0)
 S PRCHSY(0)=^PRC(443,CDA,0) ;After Signature use 443 entry
"RTN","PRCH410",132,0)
 S PRCHS="",PRCHSY=DA,PRCHSP="" D LST1^PRCHNPO2
"RTN","PRCH410",133,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",134,0)
 S DA=CDA,DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCH410",135,0)
 K BAL,ZIP,PRCSN,X,MESSAGE QUIT
"RTN","PRCH410",136,0)
SWCHK ;CHECK EDI AND ALL/DEL FLAGS FOR DELIVERY ORDERS    ;PRC*171 D.O. auto obligate check for EDI and All/Delivery flags on
"RTN","PRCH410",137,0)
 N PRCHFUND,PRCEDICK,PRCVEND
"RTN","PRCH410",138,0)
 S PRCHOBL=0
"RTN","PRCH410",139,0)
 S PRCVEND=$P($G(^PRC(442,PODA,1)),U) S:PRCVEND'="" PRCEDICK=$P($G(^PRC(440,PRCVEND,3)),U,2)
"RTN","PRCH410",140,0)
 S PRCHFUND=$P(^PRC(442,PODA,0),U,3) Q:PRCHFUND=""  S PRCHFUND=+$P(PRCHFUND," ")
"RTN","PRCH410",141,0)
 I $P($G(^PRC(442,PODA,23)),U,11)="D"!$D(PRCHDELV) D
"RTN","PRCH410",142,0)
 . I $P($G(^PRC(420,PRC("SITE"),3)),U,2)'=""!($P($G(^PRC(420,PRC("SITE"),1,PRCHFUND,6)),U,2)'="") S PRCHOBL=1    ;PRC*5.1*186
"RTN","PRCH410",143,0)
 . I $P(^PRC(442,PODA,0),U,2)=26 S PRCHOBL=1
"RTN","PRCH410",144,0)
 I '$G(PRCHOBL) D
"RTN","PRCH410",145,0)
 . I ($P($G(^PRC(420,PRC("SITE"),1,PRCHFUND,6)),U)="Y")!($P($G(^PRC(420,PRC("SITE"),3)),U)="Y") S:PRCEDICK="Y" PRCHOBL=1   ;PRC*5.1*186
"RTN","PRCH410",146,0)
 Q
"RTN","PRCSREC1")
0^1^B13923369^B13474750
"RTN","PRCSREC1",1,0)
PRCSREC1 ;WISC/KMB-SEND FMS 820 REPORT ;12/28/99  13:31
"RTN","PRCSREC1",2,0)
V ;;5.1;IFCAP;**199**;Oct 20, 2000;Build 3
"RTN","PRCSREC1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCSREC1",4,0)
 ;
"RTN","PRCSREC1",5,0)
 ;PRC*5.1*199 Modify date call for header due to new % kill in ^DICRW call
"RTN","PRCSREC1",6,0)
 N LINE2,XMTEXT,XMDUZ,XMSUB,WHAT,YY,DELIM,TEMP,XMY
"RTN","PRCSREC1",7,0)
 S DELIM="TRANS #: ,TRANSACTION DATE: ,AMOUNT: ,COST CENTER: ,FY: ,QUARTER: ,"
"RTN","PRCSREC1",8,0)
 F YY=1:1:6 S WHAT(YY)=$P(DELIM,",",YY)
"RTN","PRCSREC1",9,0)
 ;
"RTN","PRCSREC1",10,0)
 S XMSUB="FMS TRANSACTION NOTIFICATION",XMDUZ=.5
"RTN","PRCSREC1",11,0)
 S LINE2=1 F YY=18,22,20,11,4,5 S SENDIT(LINE2+3)=WHAT(LINE2)_$P($G(^PRCF(423.6,RDA,1,LINE,0)),"^",YY),LINE2=LINE2+1
"RTN","PRCSREC1",12,0)
 S TEMP=$P(SENDIT(5),": "),X=$P(SENDIT(5),": ",2),X=$E(X,3,4)_"/"_$E(X,5,6)_"/"_$E(X,1,2) K %DT D ^%DT,DD^%DT S SENDIT(5)=TEMP_": "_Y
"RTN","PRCSREC1",13,0)
 S Y=RDATE D DD^%DT
"RTN","PRCSREC1",14,0)
 S SENDIT(1)="DATE: "_Y,SENDIT(2)=" STATION: "_STATION_"    CP: "_FCP
"RTN","PRCSREC1",15,0)
 S (SENDIT(3),SENDIT(9))="" S:$D(INFORM) SENDIT(10)=INFORM
"RTN","PRCSREC1",16,0)
 I $D(ERROR) D REGRET Q
"RTN","PRCSREC1",17,0)
 ;
"RTN","PRCSREC1",18,0)
 S USER=0 F  S USER=$O(^PRC(420,STATION,1,+FCP,1,USER)) Q:USER=""  I $P($G(^(USER,2)),"^")="Y" S XMY(USER)=""
"RTN","PRCSREC1",19,0)
 I $D(XMY) S XMTEXT="SENDIT(",XMDUZ=.5 D ^XMD
"RTN","PRCSREC1",20,0)
 K SENDIT QUIT
"RTN","PRCSREC1",21,0)
REGRET ;send error message and data to app coord
"RTN","PRCSREC1",22,0)
 S SENDIT(10)=ERROR,XMDUN="820 RECONCILIATION",XMTEXT="SENDIT("
"RTN","PRCSREC1",23,0)
 S USER=$P($G(^PRC(411,+STATION,9)),"^") Q:USER=""
"RTN","PRCSREC1",24,0)
 S XMY(USER)="" D ^XMD K SENDIT Q
"RTN","PRCSREC1",25,0)
EXCEPT ;
"RTN","PRCSREC1",26,0)
 ;this code generates a report of FMS trans. for CPs not
"RTN","PRCSREC1",27,0)
 ;activated by the site
"RTN","PRCSREC1",28,0)
 N EXCEPT,DIC,L,LEN,FLDS,BY
"RTN","PRCSREC1",29,0)
 S EXCEPT="" D WRITE S DIC="^PRCS(417.1,",BY="30;""FISCAL YEAR"",4,21",FLDS="[PRCSEXCE]",L=0
"RTN","PRCSREC1",30,0)
 S DHD="W ?0 D WRITE2^PRCSREC1"
"RTN","PRCSREC1",31,0)
 D EN1^DIP W !,"End of report" Q
"RTN","PRCSREC1",32,0)
FMSRPT ;
"RTN","PRCSREC1",33,0)
 ; this code generates a report of all FMS trans. for a CP
"RTN","PRCSREC1",34,0)
 D WRITE
"RTN","PRCSREC1",35,0)
 D EN1^PRCSUT Q:'$D(PRC("SITE"))  Q:Y<0
"RTN","PRCSREC1",36,0)
 N P,PRCSZ,Z1 S P=0,(PRCSZ,Z(0))=Z
"RTN","PRCSREC1",37,0)
 K IO("Q") S %ZIS("B")="HOME",%ZIS="MQ" D ^%ZIS Q:POP
"RTN","PRCSREC1",38,0)
 I $D(IO("Q")) S ZTDESC="FMS TRANSACTIONS REPORT",ZTRTN="BEGIN^PRCSFMS",ZTSAVE("Z*")="",ZTSAVE("P")="",ZTSAVE("PRCSZ")="",ZTSAVE("PRC*")="" D ^%ZTLOAD D ^%ZISC W !,"End of report." Q
"RTN","PRCSREC1",39,0)
 U IO D BEGIN^PRCSFMS D ^%ZISC W !,"End of report" Q
"RTN","PRCSREC1",40,0)
WRITE ;
"RTN","PRCSREC1",41,0)
 W !,"This report will generate a listing of FMS transactions",!
"RTN","PRCSREC1",42,0)
 I $D(EXCEPT) W "which are for control points not activated by your site.",!
"RTN","PRCSREC1",43,0)
 W !,"You may create the report for all entries,",!,"or for selected year and/or quarter.",!
"RTN","PRCSREC1",44,0)
 W !,"Enter fiscal year in the format '99'.",!
"RTN","PRCSREC1",45,0)
 Q
"RTN","PRCSREC1",46,0)
WRITE2 ;
"RTN","PRCSREC1",47,0)
 D NOW^PRCFQ W !,"FMS EXCEPTIONS REPORT",?45,%X,!       ;PRC*5.1*199
"RTN","PRCSREC1",48,0)
 W !,?3,"REFERENCE",?40,"TRANS DATE",?55,"AMOUNT",!,"STATION",?9,"BFY",?15,"AO",?21,"FUND",?33,"FCP/PROJECT",?47,"PROGRAM",?58,"B. OBJ. CLASS",?74,"JOB"
"RTN","PRCSREC1",49,0)
 S LEN="",$P(LEN,"-",IOM)="-" W !,LEN S LEN="" Q
"RTN","PRCSREC1",50,0)
CLEAR ;clear 417.1 entries which are earlier than a selected date
"RTN","PRCSREC1",51,0)
 N REC,REC1,SDATE
"RTN","PRCSREC1",52,0)
 W !!,"This option will purge all FMS Exceptions File Entries earlier",!,"than the date which you select.",!!
"RTN","PRCSREC1",53,0)
 S DIR("A")="Enter date from which entries should be deleted",DIR("?")="To remove records earlier than a certain date, enter that date"
"RTN","PRCSREC1",54,0)
 S DIR(0)="D^^" D ^DIR Q:+Y<1  S SDATE=+Y W "   ",Y(0)
"RTN","PRCSREC1",55,0)
 W !!,"Beginning File 417.1 cleanup.."
"RTN","PRCSREC1",56,0)
 S REC="" F  S REC=$O(^PRCS(417.1,"B",REC)) Q:REC=""  D
"RTN","PRCSREC1",57,0)
 .S REC1=$O(^PRCS(417.1,"B",REC,0)) Q:REC1=""
"RTN","PRCSREC1",58,0)
 .I +$P($G(^PRCS(417.1,REC1,0)),"^",22)<SDATE S DIK="^PRCS(417.1,",DA=REC1 D ^DIK K DA,DIK
"RTN","PRCSREC1",59,0)
 W !!,"End of processing"
"RTN","PRCSREC1",60,0)
 K %X     ;PRC*5.1*199
"RTN","PRCSREC1",61,0)
 Q
"VER")
8.0^22.0
"BLD",7588,6)
^173
**END**
**END**

