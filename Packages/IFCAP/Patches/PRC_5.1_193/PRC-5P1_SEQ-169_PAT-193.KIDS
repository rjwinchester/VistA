Released PRC*5.1*193 SEQ #169
Extracted from mail message
**KIDS**:PRC*5.1*193^

**INSTALL NAME**
PRC*5.1*193
"BLD",7580,0)
PRC*5.1*193^IFCAP^0^3160502^y
"BLD",7580,1,0)
^^2^2^3160328^^
"BLD",7580,1,1,0)
1. Modify the Annual IFCAP Purge process to be controlled by a
"BLD",7580,1,2,0)
   universal date process
"BLD",7580,4,0)
^9.64PA^^
"BLD",7580,6.3)
9
"BLD",7580,"ABPKG")
n
"BLD",7580,"KRN",0)
^9.67PA^779.2^20
"BLD",7580,"KRN",.4,0)
.4
"BLD",7580,"KRN",.401,0)
.401
"BLD",7580,"KRN",.402,0)
.402
"BLD",7580,"KRN",.403,0)
.403
"BLD",7580,"KRN",.5,0)
.5
"BLD",7580,"KRN",.84,0)
.84
"BLD",7580,"KRN",3.6,0)
3.6
"BLD",7580,"KRN",3.8,0)
3.8
"BLD",7580,"KRN",9.2,0)
9.2
"BLD",7580,"KRN",9.8,0)
9.8
"BLD",7580,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",7580,"KRN",9.8,"NM",1,0)
PRCGARCF^^0^B6742034
"BLD",7580,"KRN",9.8,"NM",2,0)
PRCG237Q^^0^B15950680
"BLD",7580,"KRN",9.8,"NM",3,0)
PRCG238Q^^0^B15097552
"BLD",7580,"KRN",9.8,"NM",4,0)
PRCG239Q^^0^B11630074
"BLD",7580,"KRN",9.8,"NM",5,0)
PRCGPUTL^^0^B3265914
"BLD",7580,"KRN",9.8,"NM",6,0)
PRCFACPR^^0^B9027343
"BLD",7580,"KRN",9.8,"NM","B","PRCFACPR",6)

"BLD",7580,"KRN",9.8,"NM","B","PRCG237Q",2)

"BLD",7580,"KRN",9.8,"NM","B","PRCG238Q",3)

"BLD",7580,"KRN",9.8,"NM","B","PRCG239Q",4)

"BLD",7580,"KRN",9.8,"NM","B","PRCGARCF",1)

"BLD",7580,"KRN",9.8,"NM","B","PRCGPUTL",5)

"BLD",7580,"KRN",19,0)
19
"BLD",7580,"KRN",19.1,0)
19.1
"BLD",7580,"KRN",101,0)
101
"BLD",7580,"KRN",409.61,0)
409.61
"BLD",7580,"KRN",771,0)
771
"BLD",7580,"KRN",779.2,0)
779.2
"BLD",7580,"KRN",870,0)
870
"BLD",7580,"KRN",8989.51,0)
8989.51
"BLD",7580,"KRN",8989.52,0)
8989.52
"BLD",7580,"KRN",8994,0)
8994
"BLD",7580,"KRN","B",.4,.4)

"BLD",7580,"KRN","B",.401,.401)

"BLD",7580,"KRN","B",.402,.402)

"BLD",7580,"KRN","B",.403,.403)

"BLD",7580,"KRN","B",.5,.5)

"BLD",7580,"KRN","B",.84,.84)

"BLD",7580,"KRN","B",3.6,3.6)

"BLD",7580,"KRN","B",3.8,3.8)

"BLD",7580,"KRN","B",9.2,9.2)

"BLD",7580,"KRN","B",9.8,9.8)

"BLD",7580,"KRN","B",19,19)

"BLD",7580,"KRN","B",19.1,19.1)

"BLD",7580,"KRN","B",101,101)

"BLD",7580,"KRN","B",409.61,409.61)

"BLD",7580,"KRN","B",771,771)

"BLD",7580,"KRN","B",779.2,779.2)

"BLD",7580,"KRN","B",870,870)

"BLD",7580,"KRN","B",8989.51,8989.51)

"BLD",7580,"KRN","B",8989.52,8989.52)

"BLD",7580,"KRN","B",8994,8994)

"BLD",7580,"QDEF")
^^^^^^^^^^YES
"BLD",7580,"QUES",0)
^9.62^^
"BLD",7580,"REQB",0)
^9.611^2^2
"BLD",7580,"REQB",1,0)
PRC*5.1*138^2
"BLD",7580,"REQB",2,0)
PRC*5.1*116^2
"BLD",7580,"REQB","B","PRC*5.1*116",2)

"BLD",7580,"REQB","B","PRC*5.1*138",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
193^3160502
"PKG",455,22,1,"PAH",1,1,0)
^^2^2^3160502
"PKG",455,22,1,"PAH",1,1,1,0)
1. Modify the Annual IFCAP Purge process to be controlled by a
"PKG",455,22,1,"PAH",1,1,2,0)
   universal date process
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PRCFACPR")
0^6^B9027343^B9176613
"RTN","PRCFACPR",1,0)
PRCFACPR ;WISC@ALTOONA/CTB-PURGE CODE SHEETS SYSTEM ;11-27-92/08:17
"RTN","PRCFACPR",2,0)
V ;;5.1;IFCAP;**116,193**;Oct 20, 2000;Build 9
"RTN","PRCFACPR",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCFACPR",4,0)
 ;
"RTN","PRCFACPR",5,0)
 ;PRC*5.1*193 Added universal date control query to process
"RTN","PRCFACPR",6,0)
 ;
"RTN","PRCFACPR",7,0)
 S PRCFASYS="FEE^FEN^RR^IRS^CLI^ISM^PRC"
"RTN","PRCFACPR",8,0)
EN I $D(ZTQUEUED) G SCHEDULE
"RTN","PRCFACPR",9,0)
A S U="^" F I=1:1 Q:$P($T(A+I),";",3)=""  W !,$P($T(A+I),";",3,99)
"RTN","PRCFACPR",10,0)
 ;;This routine will delete LOG Code Sheets from the Code Sheet file
"RTN","PRCFACPR",11,0)
 ;;and Batch and Transmission records from the LOG Transmission Record File.
"RTN","PRCFACPR",12,0)
 ;;It will delete all reference to these code sheets, batches and transmission
"RTN","PRCFACPR",13,0)
 ;;records, except references maintained in the Code Sheet History section of
"RTN","PRCFACPR",14,0)
 ;;the Purchase Order file.  Deletion is base on the transmission date of
"RTN","PRCFACPR",15,0)
 ;;the code sheet and date created for batch and transmission records.
"RTN","PRCFACPR",16,0)
 ;;
"RTN","PRCFACPR",17,0)
 S PRCF("X")="AS" D ^PRCFSITE G:'% OUT
"RTN","PRCFACPR",18,0)
 ;
"RTN","PRCFACPR",19,0)
DT ;SELECT FISCAL YEAR      PRC*5.1*193
"RTN","PRCFACPR",20,0)
 S PRCGOUT=$$PURGEDT^PRCGPUTL("",7)
"RTN","PRCFACPR",21,0)
 I PRCGPGDT'>0!PRCGOUT G OUT
"RTN","PRCFACPR",22,0)
 S Y=PRCGPGDT,PRCFA("KDATE")=Y,X1=Y
"RTN","PRCFACPR",23,0)
 ;
"RTN","PRCFACPR",24,0)
 D NOW^PRCFQ S X2=X S Y=X D D^PRCFQ S Y1=Y S Y=X1,X=X1 D D^PRCFQ S PRCFA("DATE")=Y
"RTN","PRCFACPR",25,0)
 W ! S %A="I will now delete all LOG code sheets and associated records which were"
"RTN","PRCFACPR",26,0)
 S %A(1)="transmitted before "_Y_" for station "_PRC("SITE")_".",%A(2)="OK to continue",%B="" S %=1 D ^PRCFYN G:%'=1 OUT
"RTN","PRCFACPR",27,0)
 W $C(7) S %A="ARE YOU SURE",%B="With a response of 'YES', I will begin deleting the code sheets and transmission records NOW." S %=2 D ^PRCFYN G:%'=1 OUT
"RTN","PRCFACPR",28,0)
 D NOW^PRCFQ S PRCFA("QTIME")=%X
"RTN","PRCFACPR",29,0)
 S PRCFQ("FORCEQ")="",PRCFA("QION")=ION,ZTSAVE("PRCFASYS")="",ZTDESC="PURGE CODE SHEET AND TRANSMISSION RECORDS",ZTRTN="DQ^PRCFACPS",ZTSAVE("PRCFA*")="",ZTSAVE("PRC*")="" D ^PRCFQ
"RTN","PRCFACPR",30,0)
OUT K %,%DT,%H,%I,D,DA,DIC,DIK,I,J,JX,K,PRCFA,TRANS,X,X1,X2,X3,Y,Y1,Z,ZERO,PRCGOUT,PRCGPGDT Q
"RTN","PRCFACPR",31,0)
SCHEDULE ;ENTRY POINT AS SCHEDULED OPTION
"RTN","PRCFACPR",32,0)
 S PRCFA("QTIME")="Recurring",PRCFA("QION")="N/A"
"RTN","PRCFACPR",33,0)
 S PRC("SITE")=0 F I=1:1 S PRC("SITE")=$O(^PRC(411,PRC("SITE"))) Q:'PRC("SITE")  I $D(^(PRC("SITE"),0)) S X=$P(^(0),"^",14) I X D C,DQ^PRCFACPS
"RTN","PRCFACPR",34,0)
 Q
"RTN","PRCFACPR",35,0)
C S X2=-(X) D NOW^PRCFQ S X1=X D C^%DTC S Y1=Y,(Y,PRCFA("KDATE"))=X D D^PRCFQ S PRCFA("DATE")=Y Q
"RTN","PRCG237Q")
0^2^B15950680^B17692851
"RTN","PRCG237Q",1,0)
PRCG237Q ;WISC/BGJ - IFCAP 442 FILE CLEANUP (QUEUE); 11/8/99 2:07pm ;9/20/00  13:00
"RTN","PRCG237Q",2,0)
V ;;5.1;IFCAP;**95,193**;Oct 20, 2000;Build 9
"RTN","PRCG237Q",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCG237Q",4,0)
 ;This routine is installed by patch PRC*5*237.
"RTN","PRCG237Q",5,0)
 ;This routine creates entries in file 443.1 for background processing
"RTN","PRCG237Q",6,0)
 ;by PurgeMaster.  Entries are created for file 442.  Routine PRCG237P
"RTN","PRCG237Q",7,0)
 ;will be utilized by PurgeMaster to actually purge the entries in file
"RTN","PRCG237Q",8,0)
 ;442.
"RTN","PRCG237Q",9,0)
 ;
"RTN","PRCG237Q",10,0)
 ;PRC*5.1*193 Added universal date control query to process
"RTN","PRCG237Q",11,0)
 ;
"RTN","PRCG237Q",12,0)
 W @IOF,!
"RTN","PRCG237Q",13,0)
 D MSG
"RTN","PRCG237Q",14,0)
 S %A="Are you ready to continue",%A(0)="!",%=1
"RTN","PRCG237Q",15,0)
 D ^PRCFYN Q:%'=1
"RTN","PRCG237Q",16,0)
 S PRCF("X")="AS" D ^PRCFSITE G OUT:'%
"RTN","PRCG237Q",17,0)
 D NOW^%DTC K %H,%,%I
"RTN","PRCG237Q",18,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCG237Q",19,0)
 S PFY=CFY-1700-1_"0930"
"RTN","PRCG237Q",20,0)
DT ;SELECT FISCAL YEAR      PRC*5.1*193
"RTN","PRCG237Q",21,0)
 S PRCGOUT=$$PURGEDT^PRCGPUTL("",7)
"RTN","PRCG237Q",22,0)
 I PRCGPGDT'>0!PRCGOUT G OUT
"RTN","PRCG237Q",23,0)
 W !! S %A="The archiving processing will go through date "_PRCGDOUT_" is this OK?" S %=1 D ^PRCFYN G OUT:%'=1
"RTN","PRCG237Q",24,0)
 W !! S %A="ARE YOU SURE" D ^PRCFYN I %'=1 W ?35,"I am confused, let's start over..." G DT
"RTN","PRCG237Q",25,0)
 S Y=PRCGPGDT,PRC("DATE")=Y
"RTN","PRCG237Q",26,0)
 ;
"RTN","PRCG237Q",27,0)
DQ ;
"RTN","PRCG237Q",28,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCG237Q",29,0)
 F I=1:1 S X=$T(LOAD+I) Q:$P(X,";",3)=""  D
"RTN","PRCG237Q",30,0)
 . S FILE(I)=$P(X,";",3),GLO(I)=$P(X,";",4),REF(I)=$P(X,";",5),ADDVAR(I)=$P(X,";",6)
"RTN","PRCG237Q",31,0)
 S N=0,TREC=0
"RTN","PRCG237Q",32,0)
 F  S N=$O(GLO(N)) Q:'N  D
"RTN","PRCG237Q",33,0)
 . S X="S REC(N)=$P("_GLO(N)_"0),U,4)" X X S TREC=TREC+REC(N)
"RTN","PRCG237Q",34,0)
 S OGET=TREC\1000+1
"RTN","PRCG237Q",35,0)
 S MESSAGE="CREATING PURGEMASTER ENTRIES FOR FILE CLEANUP"
"RTN","PRCG237Q",36,0)
 D BEGIN^PRCGU
"RTN","PRCG237Q",37,0)
 S LEVEL=0
"RTN","PRCG237Q",38,0)
 F  S LEVEL=$O(GLO(LEVEL)) Q:LEVEL=""  D
"RTN","PRCG237Q",39,0)
 . S GLO=GLO(LEVEL),REF=REF(LEVEL),ADDVAR=""
"RTN","PRCG237Q",40,0)
 . S:ADDVAR(LEVEL)]"" @("ADDVAR="_ADDVAR(LEVEL))
"RTN","PRCG237Q",41,0)
 . S NEXT=0
"RTN","PRCG237Q",42,0)
 . F  D  S XCOUNT=XCOUNT+COUNT D PERCENT^PRCGU Q:'NEXT
"RTN","PRCG237Q",43,0)
 . . S COUNT=0
"RTN","PRCG237Q",44,0)
 . . F  D  Q:'NEXT!(COUNT>LREC)
"RTN","PRCG237Q",45,0)
 . . . S GET=($S((LREC-COUNT)>OGET:OGET,1:(LREC-COUNT)+2))-1
"RTN","PRCG237Q",46,0)
 . . . I GET<1 S GET=1
"RTN","PRCG237Q",47,0)
 . . . D GET
"RTN","PRCG237Q",48,0)
 . . . Q:'NEXT
"RTN","PRCG237Q",49,0)
 . . . S COUNT=COUNT+ICOUNT
"RTN","PRCG237Q",50,0)
 . . . S Z="",ROUTINE=REF_"^PRCG237P",VARIABLE=BEGDA_"-"_ENDA_";"_PRC("SITE")
"RTN","PRCG237Q",51,0)
 . . . I ADDVAR]"" S VARIABLE=VARIABLE_";"_ADDVAR
"RTN","PRCG237Q",52,0)
 . . . D ADD^PRCGPM1(ROUTINE,VARIABLE,.Z)
"RTN","PRCG237Q",53,0)
 D CLN4406
"RTN","PRCG237Q",54,0)
 D END^PRCGU
"RTN","PRCG237Q",55,0)
 ;
"RTN","PRCG237Q",56,0)
OUT ;
"RTN","PRCG237Q",57,0)
 K A,ADDVAR,ATERM,BEGDA,BTIME,CFY,COUNT,CURSOR,DX,DY,ENDA,FILE,GET,GLO
"RTN","PRCG237Q",58,0)
 K HOURS,ICOUNT,LEVEL,LINE,LREC,MIN,NEXT,OGET,OUT,PERCENT,PFY,REC,REF
"RTN","PRCG237Q",59,0)
 K ROUTINE,RTIME,SEC,TIME,TREC,TTIME,VARIABLE,X,XCOUNT,XPOS,Y,Z,PRC
"RTN","PRCG237Q",60,0)
 K PRCGOUT,PRCGDOUT,PRCGPGDT     ;PRC*5.1*193
"RTN","PRCG237Q",61,0)
 D KILL^%ZISS
"RTN","PRCG237Q",62,0)
 Q
"RTN","PRCG237Q",63,0)
GET ;
"RTN","PRCG237Q",64,0)
 S (BEGDA,ENDA)=NEXT+1,ICOUNT=1
"RTN","PRCG237Q",65,0)
 S @("NEXT=$O("_GLO_"NEXT))")
"RTN","PRCG237Q",66,0)
 I 'NEXT S NEXT="" Q
"RTN","PRCG237Q",67,0)
 S BEGDA=NEXT,(NEXT,ENDA)=NEXT+GET,ICOUNT=ENDA-BEGDA+1
"RTN","PRCG237Q",68,0)
 Q
"RTN","PRCG237Q",69,0)
MSG ;
"RTN","PRCG237Q",70,0)
 S X="This will schedule records in file 442 for review in the "
"RTN","PRCG237Q",71,0)
 S X=X_"background by PurgeMaster (file 443.1 will be populated).  "
"RTN","PRCG237Q",72,0)
 S X=X_"Accounts Receivable documents in file 442 will be purged by "
"RTN","PRCG237Q",73,0)
 S X=X_"PurgeMaster based on the date that you will enter.  Any "
"RTN","PRCG237Q",74,0)
 S X=X_"document in file 442 without a P.O. DATE will also be purged "
"RTN","PRCG237Q",75,0)
 S X=X_"based on the date you enter and the date in the DATE P.O. "
"RTN","PRCG237Q",76,0)
 S X=X_"ASSIGNED field in file 442."
"RTN","PRCG237Q",77,0)
 D MSG^PRCFQ W !
"RTN","PRCG237Q",78,0)
 S X="The date you are about to enter MUST be confirmed with A&MM "
"RTN","PRCG237Q",79,0)
 S X=X_"or Fiscal staff.  FAILURE TO DO SO MAY RESULT IN DATA "
"RTN","PRCG237Q",80,0)
 S X=X_"CORRUPTION." D MSG^PRCFQ W $C(7),$C(7),$C(7)
"RTN","PRCG237Q",81,0)
 Q
"RTN","PRCG237Q",82,0)
CLN4406 ;add line to delete
"RTN","PRCG237Q",83,0)
 S MYHLD=0,MYCOUNT=0,THISCNT=0
"RTN","PRCG237Q",84,0)
 F  S MYHLD=$O(^PRC(443.1,MYHLD)) Q:'MYHLD  S MYCOUNT=MYHLD
"RTN","PRCG237Q",85,0)
 S LAST=MYCOUNT+1
"RTN","PRCG237Q",86,0)
 S X="START^PRCCL406"
"RTN","PRCG237Q",87,0)
 S THISCNT=$P(^PRC(443.1,0),U,4)
"RTN","PRCG237Q",88,0)
 S Y=""
"RTN","PRCG237Q",89,0)
 S:X'["^" X="^"_X
"RTN","PRCG237Q",90,0)
 I '$D(^PRC(443.1,LAST)) S ^PRC(443.1,LAST,0)=LAST_"^"_X_"^"_Y,$P(^PRC(443.1,0),"^",3,4)=(LAST_"^"_(THISCNT+1))
"RTN","PRCG237Q",91,0)
 K MYHLD,MYCOUNT,THISCNT
"RTN","PRCG237Q",92,0)
 Q
"RTN","PRCG237Q",93,0)
LOAD ;
"RTN","PRCG237Q",94,0)
 ;;442;^PRC(442,;442;PRC("DATE")
"RTN","PRCG237Q",95,0)
 ;;;
"RTN","PRCG238Q")
0^3^B15097552^B21013963
"RTN","PRCG238Q",1,0)
PRCG238Q ;WISC/BGJ-IFCAP 410 FILE CLEANUP (QUEUE) ;11/8/99
"RTN","PRCG238Q",2,0)
V ;;5.1;IFCAP;**193**;Oct 20, 2000;Build 9
"RTN","PRCG238Q",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCG238Q",4,0)
 ;This routine is installed by patch PRC*5*238.
"RTN","PRCG238Q",5,0)
 ;This routine creates entries in file 443.1 for background processing
"RTN","PRCG238Q",6,0)
 ;by PurgeMaster.  Entries are created for files 410, 410.1 and 443.
"RTN","PRCG238Q",7,0)
 ;Routine PRCG238P will be utilized by PurgeMaster to actually purge the
"RTN","PRCG238Q",8,0)
 ;entries in these files.
"RTN","PRCG238Q",9,0)
 ;
"RTN","PRCG238Q",10,0)
 ;PRC*5.1*193 Added universal date control query to process
"RTN","PRCG238Q",11,0)
 ;
"RTN","PRCG238Q",12,0)
 W @IOF,!
"RTN","PRCG238Q",13,0)
 D MSG
"RTN","PRCG238Q",14,0)
 S %A="Are you ready to continue",%A(0)="!",%=1
"RTN","PRCG238Q",15,0)
 D ^PRCFYN Q:%'=1
"RTN","PRCG238Q",16,0)
 S PRCF("X")="AS" D ^PRCFSITE G OUT:'%
"RTN","PRCG238Q",17,0)
 D NOW^%DTC K %H,%,%I
"RTN","PRCG238Q",18,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCG238Q",19,0)
 S PFY=CFY-1700-1_"0930"
"RTN","PRCG238Q",20,0)
 ;
"RTN","PRCG238Q",21,0)
DT ;Ask processing date     PRC*5.1*193
"RTN","PRCG238Q",22,0)
 S PRCGOUT=$$PURGEDT^PRCGPUTL("",7)
"RTN","PRCG238Q",23,0)
 I PRCGPGDT'>0!PRCGOUT G OUT
"RTN","PRCG238Q",24,0)
 W !! S %A="The archiving processing will go through date "_PRCGDOUT_" is this OK?" S %=1 D ^PRCFYN G OUT:%'=1
"RTN","PRCG238Q",25,0)
 W !! S %A="ARE YOU SURE" D ^PRCFYN I %'=1 W ?35,"I am confused, let's start over..." G DT
"RTN","PRCG238Q",26,0)
 S Y=PRCGPGDT,PRC("PERMDATE")=Y,PRC("TEMPDATE")=Y
"RTN","PRCG238Q",27,0)
 ;
"RTN","PRCG238Q",28,0)
DQ ;
"RTN","PRCG238Q",29,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCG238Q",30,0)
 F I=1:1 S X=$T(LOAD+I) Q:$P(X,";",3)=""  D
"RTN","PRCG238Q",31,0)
 . S FILE(I)=$P(X,";",3),GLO(I)=$P(X,";",4),REF(I)=$P(X,";",5),ADDVAR(I)=$P(X,";",6)
"RTN","PRCG238Q",32,0)
 S N=0,TREC=0
"RTN","PRCG238Q",33,0)
 F  S N=$O(GLO(N)) Q:'N  D
"RTN","PRCG238Q",34,0)
 . S X="S REC(N)=$P("_GLO(N)_"0),U,4)" X X S TREC=TREC+REC(N)
"RTN","PRCG238Q",35,0)
 S OGET=TREC\1000+1
"RTN","PRCG238Q",36,0)
 S MESSAGE="CREATING PURGEMASTER ENTRIES FOR FILE CLEANUP"
"RTN","PRCG238Q",37,0)
 D BEGIN^PRCGU
"RTN","PRCG238Q",38,0)
 S LEVEL=0
"RTN","PRCG238Q",39,0)
 F  S LEVEL=$O(GLO(LEVEL)) Q:LEVEL=""  D
"RTN","PRCG238Q",40,0)
 . S GLO=GLO(LEVEL),REF=REF(LEVEL),ADDVAR=""
"RTN","PRCG238Q",41,0)
 . S:ADDVAR(LEVEL)]"" @("ADDVAR="_ADDVAR(LEVEL))
"RTN","PRCG238Q",42,0)
 . S NEXT=0
"RTN","PRCG238Q",43,0)
 . F  D  S XCOUNT=XCOUNT+COUNT D PERCENT^PRCGU Q:'NEXT
"RTN","PRCG238Q",44,0)
 . . S COUNT=0
"RTN","PRCG238Q",45,0)
 . . F  D  Q:'NEXT!(COUNT>LREC)
"RTN","PRCG238Q",46,0)
 . . . S GET=($S((LREC-COUNT)>OGET:OGET,1:(LREC-COUNT)+2))-1
"RTN","PRCG238Q",47,0)
 . . . I GET<1 S GET=1
"RTN","PRCG238Q",48,0)
 . . . D GET
"RTN","PRCG238Q",49,0)
 . . . Q:'NEXT
"RTN","PRCG238Q",50,0)
 . . . S COUNT=COUNT+ICOUNT
"RTN","PRCG238Q",51,0)
 . . . S Z="",ROUTINE=REF_"^PRCG238P",VARIABLE=BEGDA_"-"_ENDA_";"_PRC("SITE")
"RTN","PRCG238Q",52,0)
 . . . I ADDVAR]"" S VARIABLE=VARIABLE_";"_ADDVAR
"RTN","PRCG238Q",53,0)
 . . . D ADD^PRCGPM1(ROUTINE,VARIABLE,.Z)
"RTN","PRCG238Q",54,0)
 D END^PRCGU
"RTN","PRCG238Q",55,0)
 ;
"RTN","PRCG238Q",56,0)
OUT ;
"RTN","PRCG238Q",57,0)
 K A,ADDVAR,ATERM,BEGDA,BTIME,CFY,COUNT,CURSOR,DX,DY,ENDA,FILE,GET,GLO
"RTN","PRCG238Q",58,0)
 K HOURS,ICOUNT,LEVEL,LINE,LREC,MIN,NEXT,OGET,OUT,PERCENT,PFY,REC,REF
"RTN","PRCG238Q",59,0)
 K ROUTINE,RTIME,SEC,TIME,TREC,TTIME,VARIABLE,X,XCOUNT,XPOS,Y,Z,PRC
"RTN","PRCG238Q",60,0)
 K PRCGOUT,PRCGDOUT,PRCGPGDT
"RTN","PRCG238Q",61,0)
 D KILL^%ZISS
"RTN","PRCG238Q",62,0)
 Q
"RTN","PRCG238Q",63,0)
GET ;
"RTN","PRCG238Q",64,0)
 S (BEGDA,ENDA)=NEXT+1,ICOUNT=1
"RTN","PRCG238Q",65,0)
 S @("NEXT=$O("_GLO_"NEXT))")
"RTN","PRCG238Q",66,0)
 I 'NEXT S NEXT="" Q
"RTN","PRCG238Q",67,0)
 S BEGDA=NEXT,(NEXT,ENDA)=NEXT+GET,ICOUNT=ENDA-BEGDA+1
"RTN","PRCG238Q",68,0)
 Q
"RTN","PRCG238Q",69,0)
MSG ;
"RTN","PRCG238Q",70,0)
 S X="This will schedule records in files 410, 410.1 and 443 for review "
"RTN","PRCG238Q",71,0)
 S X=X_"in the background by PurgeMaster (file 443.1 will be populated).  "
"RTN","PRCG238Q",72,0)
 S X=X_"Entries in file 410 will be purged first by PurgeMaster based "
"RTN","PRCG238Q",73,0)
 S X=X_"on dates that you will enter.  As data in file 410 is purged, "
"RTN","PRCG238Q",74,0)
 S X=X_"related entries in file 410.1 are also purged.  Entries in file "
"RTN","PRCG238Q",75,0)
 S X=X_"443 will be purged next if there is no corresponding entry in "
"RTN","PRCG238Q",76,0)
 S X=X_"file 410.  Finally, additional clean-up will be performed on file 410.1."
"RTN","PRCG238Q",77,0)
 D MSG^PRCFQ
"RTN","PRCG238Q",78,0)
 W ! S X="The dates you are about to enter MUST be confirmed with A&MM "
"RTN","PRCG238Q",79,0)
 S X=X_"or Fiscal staff.  FAILURE TO DO SO MAY RESULT IN DATA "
"RTN","PRCG238Q",80,0)
 S X=X_"CORRUPTION." D MSG^PRCFQ W $C(7),$C(7),$C(7)
"RTN","PRCG238Q",81,0)
 Q
"RTN","PRCG238Q",82,0)
LOAD ;
"RTN","PRCG238Q",83,0)
 ;;410;^PRCS(410,;410;PRC("TEMPDATE")_"-"_PRC("PERMDATE")
"RTN","PRCG238Q",84,0)
 ;;443;^PRC(443,;443
"RTN","PRCG238Q",85,0)
 ;;410.1;^PRCS(410.1,;4101;"-"_PRC("PERMDATE")
"RTN","PRCG238Q",86,0)
 ;;;
"RTN","PRCG239Q")
0^4^B11630074^B13453904
"RTN","PRCG239Q",1,0)
PRCG239Q ;WISC/BGJ-IFCAP 410 FILE CLEANUP (QUEUE) ;11/8/99
"RTN","PRCG239Q",2,0)
V ;;5.1;IFCAP;**95,138,193**;Oct 20, 2000;Build 9
"RTN","PRCG239Q",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCG239Q",4,0)
 ;This routine is installed by patch PRC*5.1*95.
"RTN","PRCG239Q",5,0)
 ;This routine creates entries in file 443.1 for background processing
"RTN","PRCG239Q",6,0)
 ;by PurgeMaster.  Entries are created for file 417.
"RTN","PRCG239Q",7,0)
 ;Routine PRCG239P will be utilized by PurgeMaster to actually purge the
"RTN","PRCG239Q",8,0)
 ;entries in this file.
"RTN","PRCG239Q",9,0)
 ;
"RTN","PRCG239Q",10,0)
 ;PRC*5.1*193 Added universal date control query to process
"RTN","PRCG239Q",11,0)
 ;
"RTN","PRCG239Q",12,0)
 W @IOF,!
"RTN","PRCG239Q",13,0)
 D MSG
"RTN","PRCG239Q",14,0)
 S %A="Are you ready to continue",%A(0)="!",%=1
"RTN","PRCG239Q",15,0)
 D ^PRCFYN Q:%'=1
"RTN","PRCG239Q",16,0)
 S PRCF("X")="AS" D ^PRCFSITE G OUT:'%
"RTN","PRCG239Q",17,0)
 D NOW^%DTC K %H,%,%I
"RTN","PRCG239Q",18,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCG239Q",19,0)
 S PFY=CFY-1700-1_"0930"
"RTN","PRCG239Q",20,0)
DT ;Ask processing date     PRC*5.1*193
"RTN","PRCG239Q",21,0)
 S PRCGOUT=$$PURGEDT^PRCGPUTL("",7)
"RTN","PRCG239Q",22,0)
 I PRCGPGDT'>0!PRCGOUT G OUT
"RTN","PRCG239Q",23,0)
 W !! S %A="The archiving processing will go through date "_PRCGDOUT_" is this OK?" S %=1 D ^PRCFYN G OUT:%'=1
"RTN","PRCG239Q",24,0)
 W !! S %A="ARE YOU SURE" D ^PRCFYN I %'=1 W ?35,"I am confused, let's start over..." G DT
"RTN","PRCG239Q",25,0)
 S Y=PRCGPGDT,PRC("DATE")=Y
"RTN","PRCG239Q",26,0)
DQ ;
"RTN","PRCG239Q",27,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCG239Q",28,0)
 F I=1:1 S X=$T(LOAD+I) Q:$P(X,";",3)=""  D
"RTN","PRCG239Q",29,0)
 . S FILE(I)=$P(X,";",3),GLO(I)=$P(X,";",4),REF(I)=$P(X,";",5),ADDVAR(I)=$P(X,";",6)
"RTN","PRCG239Q",30,0)
 S N=0,TREC=0
"RTN","PRCG239Q",31,0)
 F  S N=$O(GLO(N)) Q:'N  D
"RTN","PRCG239Q",32,0)
 . S X="S REC(N)=$P("_GLO(N)_"0),U,4)" X X S TREC=TREC+REC(N)
"RTN","PRCG239Q",33,0)
 S OGET=TREC\1000+1
"RTN","PRCG239Q",34,0)
 S MESSAGE="CREATING PURGEMASTER ENTRIES FOR FILE CLEANUP"
"RTN","PRCG239Q",35,0)
 D BEGIN^PRCGU
"RTN","PRCG239Q",36,0)
 S LEVEL=0
"RTN","PRCG239Q",37,0)
 F  S LEVEL=$O(GLO(LEVEL)) Q:LEVEL=""  D
"RTN","PRCG239Q",38,0)
 . S GLO=GLO(LEVEL),REF=REF(LEVEL),ADDVAR=""
"RTN","PRCG239Q",39,0)
 . S:ADDVAR(LEVEL)]"" @("ADDVAR="_ADDVAR(LEVEL))
"RTN","PRCG239Q",40,0)
 . S NEXT=0
"RTN","PRCG239Q",41,0)
 . F  D  S XCOUNT=XCOUNT+COUNT D PERCENT^PRCGU Q:'NEXT
"RTN","PRCG239Q",42,0)
 . . S COUNT=0
"RTN","PRCG239Q",43,0)
 . . F  D  Q:'NEXT!(COUNT>LREC)
"RTN","PRCG239Q",44,0)
 . . . S GET=($S((LREC-COUNT)>OGET:OGET,1:(LREC-COUNT)+2))-1
"RTN","PRCG239Q",45,0)
 . . . I GET<1 S GET=1
"RTN","PRCG239Q",46,0)
 . . . D GET
"RTN","PRCG239Q",47,0)
 . . . Q:'NEXT
"RTN","PRCG239Q",48,0)
 . . . S COUNT=COUNT+ICOUNT
"RTN","PRCG239Q",49,0)
 . . . S Z="",ROUTINE=REF_"^PRCG239P",VARIABLE=BEGDA_"-"_ENDA_";"_PRC("SITE")
"RTN","PRCG239Q",50,0)
 . . . I ADDVAR]"" S VARIABLE=VARIABLE_";"_ADDVAR
"RTN","PRCG239Q",51,0)
 . . . D ADD^PRCGPM1(ROUTINE,VARIABLE,.Z)
"RTN","PRCG239Q",52,0)
 D END^PRCGU
"RTN","PRCG239Q",53,0)
 ;
"RTN","PRCG239Q",54,0)
OUT ;
"RTN","PRCG239Q",55,0)
 K A,ADDVAR,ATERM,BEGDA,BTIME,CFY,COUNT,CURSOR,DX,DY,ENDA,FILE,GET,GLO
"RTN","PRCG239Q",56,0)
 K HOURS,ICOUNT,LEVEL,LINE,LREC,MIN,VARIABLE,X,XCOUNT,XPOS,Y,Z,PRC
"RTN","PRCG239Q",57,0)
 K NEXT,OGET,OUT,PERCENT,PFY,REC,REF,ROUTINE,RTIME,SEC,TIME,TREC,TTIME
"RTN","PRCG239Q",58,0)
 K PRCGOUT,PRCGDOUT,PRCGPGDT     ;PRC*5.1*193
"RTN","PRCG239Q",59,0)
 D KILL^%ZISS
"RTN","PRCG239Q",60,0)
 Q
"RTN","PRCG239Q",61,0)
GET ;
"RTN","PRCG239Q",62,0)
 S (BEGDA,ENDA)=NEXT+1,ICOUNT=1
"RTN","PRCG239Q",63,0)
 S @("NEXT=$O("_GLO_"NEXT))")
"RTN","PRCG239Q",64,0)
 I 'NEXT S NEXT="" Q
"RTN","PRCG239Q",65,0)
 S BEGDA=NEXT,(NEXT,ENDA)=NEXT+GET,ICOUNT=ENDA-BEGDA+1
"RTN","PRCG239Q",66,0)
 Q
"RTN","PRCG239Q",67,0)
MSG ;
"RTN","PRCG239Q",68,0)
 S X="This will schedule records in file 417 for review in the "
"RTN","PRCG239Q",69,0)
 S X=X_"background by PurgeMaster (file 443.1 will be populated).  "
"RTN","PRCG239Q",70,0)
 S X=X_"FMS reconciliation data in file 417 will be purged by "
"RTN","PRCG239Q",71,0)
 S X=X_"PurgeMaster based on the date that you will enter."
"RTN","PRCG239Q",72,0)
 D MSG^PRCFQ W !
"RTN","PRCG239Q",73,0)
 S X="The date you are about to enter MUST be confirmed with A&MM "
"RTN","PRCG239Q",74,0)
 S X=X_"or Fiscal staff.  FAILURE TO DO SO MAY RESULT IN DATA "
"RTN","PRCG239Q",75,0)
 S X=X_"CORRUPTION." D MSG^PRCFQ W $C(7),$C(7),$C(7)
"RTN","PRCG239Q",76,0)
 Q
"RTN","PRCG239Q",77,0)
LOAD ;
"RTN","PRCG239Q",78,0)
 ;;417;^PRCS(417,;417;PRC("DATE")
"RTN","PRCG239Q",79,0)
 ;;;
"RTN","PRCGARCF")
0^1^B6742034^B8833451
"RTN","PRCGARCF",1,0)
PRCGARCF ;WIRMFO@ALTOONA/CTB FIND ARCHIVABLE RECORDS ;12/10/97  9:49 AM
"RTN","PRCGARCF",2,0)
V ;;5.1;IFCAP;**193**;Oct 20, 2000;Build 9
"RTN","PRCGARCF",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCGARCF",4,0)
 ;ifcap archive
"RTN","PRCGARCF",5,0)
 ;
"RTN","PRCGARCF",6,0)
 ;PRC*5.1*193 Added universal date control query to process
"RTN","PRCGARCF",7,0)
 ;
"RTN","PRCGARCF",8,0)
 ;SELECT STATION
"RTN","PRCGARCF",9,0)
 S PRCF("X")="AS" D ^PRCFSITE Q:'%
"RTN","PRCGARCF",10,0)
 D NOW^%DTC
"RTN","PRCGARCF",11,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCGARCF",12,0)
DT ;SELECT FISCAL YEAR        ;PRC*5.1*193
"RTN","PRCGARCF",13,0)
 S PRCGOUT=$$PURGEDT^PRCGPUTL("",7)
"RTN","PRCGARCF",14,0)
 I PRCGPGDT'>0!PRCGOUT G END
"RTN","PRCGARCF",15,0)
 W !! S %A="The archiving processing will go through date "_PRCGDOUT_" is this OK?" S %=1 D ^PRCFYN G END:%'=1
"RTN","PRCGARCF",16,0)
 W !! S %A="ARE YOU SURE" D ^PRCFYN I %'=1 W ?35,"I am confused, let's start over..." G DT
"RTN","PRCGARCF",17,0)
 S FY=PRCGPGDT,AFY=$E(FY,1,3)+1700
"RTN","PRCGARCF",18,0)
CKOLD S %=2
"RTN","PRCGARCF",19,0)
 I $O(^PRC(443.9,0)) D
"RTN","PRCGARCF",20,0)
 . F  D  Q:%<3
"RTN","PRCGARCF",21,0)
 . . W !! S %A="There are already records in the IFCAP Pending Archive File",%A(1)="If these are old records, they could cause duplication of the archive.",%A(2)="Do you want me to REMOVE these records before I begin"
"RTN","PRCGARCF",22,0)
 . . S %=1 D ^PRCFYN Q:%'=1
"RTN","PRCGARCF",23,0)
 . . S %A="ARE YOU SURE" D ^PRCFYN
"RTN","PRCGARCF",24,0)
 . . Q:%'=2  W !! S X="OK,  Now I'm really confused.  Let's do that again.*" D MSG^PRCFQ S %=3
"RTN","PRCGARCF",25,0)
 . . QUIT
"RTN","PRCGARCF",26,0)
 . QUIT
"RTN","PRCGARCF",27,0)
 QUIT:%<0
"RTN","PRCGARCF",28,0)
 S CLEANFIL=%
"RTN","PRCGARCF",29,0)
 S ZTDESC="IFCAP ARCHIVE RECORD FIND",ZTSAVE("AFY")="",ZTSAVE("EFY")="",ZTSAVE("FY")="",ZTSAVE("CFY")="",ZTSAVE("PRC*")="",ZTSAVE("CLEANFIL")="",ZTRTN="^PRCGARCG"
"RTN","PRCGARCF",30,0)
 D ^PRCFQ
"RTN","PRCGARCF",31,0)
END K FY,BFY,EFY,CFY,AFY,NX,MX,ZERONODE,FLAG,X,Y,TREC,CREC,LREC,XPOS,DX,CY
"RTN","PRCGARCF",32,0)
 K MOP,ARCBIT,DIC,DLAYGO,A,N,M,PERCENT,%DT,ARCHECK,CURSOR,CLEANFIL,D0
"RTN","PRCGARCF",33,0)
 K DG,DICR,DIG,DIH,DIU,DIV,DIW,ITEMS,MESSAGE,OUT,RTIME,TTIME,YPOS
"RTN","PRCGARCF",34,0)
 K PRCGOUT,PRCGDOUT,PRCGPGDT
"RTN","PRCGARCF",35,0)
 QUIT
"RTN","PRCGPUTL")
0^5^B3265914^n/a
"RTN","PRCGPUTL",1,0)
PRCGPUTL ;MNT/RB-IFCAP ARCHIVE/PURGE DATE UTILITY ; 01/12/16
"RTN","PRCGPUTL",2,0)
V ;;5.1;IFCAP;**193**;JAN 12, 2016;Build 9
"RTN","PRCGPUTL",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCGPUTL",4,0)
 ;
"RTN","PRCGPUTL",5,0)
 ;PRC*5.1*193 Universal date query for archive/purge options
"RTN","PRCGPUTL",6,0)
 ;
"RTN","PRCGPUTL",7,0)
PURGEDT(PRCGTHRU,PRCGYRS) ;ARCHIVE/PURGE date query
"RTN","PRCGPUTL",8,0)
 N PRCGDT,OUT D DT S OUT=0
"RTN","PRCGPUTL",9,0)
P1 S PRCGDOUT=0,PRCGPGDT=0
"RTN","PRCGPUTL",10,0)
 S DIR(0)="D^::E",DIR("A")="Select Fiscal Year thru which this option is to run",DIR("?",1)="Enter a valid FileMan date (YYYY is valid), or an up-arrow to quit."
"RTN","PRCGPUTL",11,0)
 S DIR("?")="Date is converted to last day of FISCAL YEAR associated with entry"
"RTN","PRCGPUTL",12,0)
 S:PRCGTHRU>0 DIR("B")=PRCGTHRU
"RTN","PRCGPUTL",13,0)
 D ^DIR K DIR I X["^"!(X="") S OUT=1 G Q
"RTN","PRCGPUTL",14,0)
 I $E(Y,4,5)>9 S Y=($E(Y,1,3)+1)_"0930"
"RTN","PRCGPUTL",15,0)
 E  S Y=$E(Y,1,3)_"0930"
"RTN","PRCGPUTL",16,0)
 S PRCGPGDT=Y
"RTN","PRCGPUTL",17,0)
 I PRCGPGDT>PRCGDT W !,"CANNOT RUN THIS OPTION FOR LESS THAN LAST "_PRCGYRS_" FISCAL YEARS + CURRENT FISCAL YEAR" K PRCGDOUT,PRCGPGDT G P1
"RTN","PRCGPUTL",18,0)
 D DD^%DT S PRCGDOUT=Y K Y
"RTN","PRCGPUTL",19,0)
Q Q OUT
"RTN","PRCGPUTL",20,0)
 ;
"RTN","PRCGPUTL",21,0)
DT N U,X,MM,DD,YY
"RTN","PRCGPUTL",22,0)
 S U="^"
"RTN","PRCGPUTL",23,0)
 I '$D(DT) S DT=$$DT^XLFDT
"RTN","PRCGPUTL",24,0)
 S MM=$E(DT,4,5),DD=$E(DT,6,7),YY=$E(DT,1,3)
"RTN","PRCGPUTL",25,0)
 S YY=YY-PRCGYRS    ;MIN = LAST 7 YEARS + CURRENT
"RTN","PRCGPUTL",26,0)
 S YY=YY-1,PRCGDT=YY_"0930"
"RTN","PRCGPUTL",27,0)
 Q
"VER")
8.0^22.0
"BLD",7580,6)
^169
**END**
**END**

