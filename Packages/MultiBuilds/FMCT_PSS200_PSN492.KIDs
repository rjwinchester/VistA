KIDS Distribution saved on Nov 15, 2016@19:23:20
FCMT PSS PSN BUNDLE 1.0
**KIDS**:FMCT PSS PSN BUNDLE 1.0^PSS*1.0*200^PSN*4.0*492^

**INSTALL NAME**
FMCT PSS PSN BUNDLE 1.0
"BLD",9557,0)
FMCT PSS PSN BUNDLE 1.0^^1^3161115^y
"BLD",9557,6.3)
12
"BLD",9557,10,0)
^9.63^2^2
"BLD",9557,10,1,0)
PSS*1.0*200^1
"BLD",9557,10,2,0)
PSN*4.0*492^1
"BLD",9557,10,"B","PSN*4.0*492",2)

"BLD",9557,10,"B","PSS*1.0*200",1)

"BLD",9557,"KRN",0)
^9.67PA^779.2^20
"BLD",9557,"KRN",.4,0)
.4
"BLD",9557,"KRN",.401,0)
.401
"BLD",9557,"KRN",.402,0)
.402
"BLD",9557,"KRN",.403,0)
.403
"BLD",9557,"KRN",.5,0)
.5
"BLD",9557,"KRN",.84,0)
.84
"BLD",9557,"KRN",3.6,0)
3.6
"BLD",9557,"KRN",3.8,0)
3.8
"BLD",9557,"KRN",9.2,0)
9.2
"BLD",9557,"KRN",9.8,0)
9.8
"BLD",9557,"KRN",19,0)
19
"BLD",9557,"KRN",19.1,0)
19.1
"BLD",9557,"KRN",101,0)
101
"BLD",9557,"KRN",409.61,0)
409.61
"BLD",9557,"KRN",771,0)
771
"BLD",9557,"KRN",779.2,0)
779.2
"BLD",9557,"KRN",870,0)
870
"BLD",9557,"KRN",8989.51,0)
8989.51
"BLD",9557,"KRN",8989.52,0)
8989.52
"BLD",9557,"KRN",8994,0)
8994
"BLD",9557,"KRN","B",.4,.4)

"BLD",9557,"KRN","B",.401,.401)

"BLD",9557,"KRN","B",.402,.402)

"BLD",9557,"KRN","B",.403,.403)

"BLD",9557,"KRN","B",.5,.5)

"BLD",9557,"KRN","B",.84,.84)

"BLD",9557,"KRN","B",3.6,3.6)

"BLD",9557,"KRN","B",3.8,3.8)

"BLD",9557,"KRN","B",9.2,9.2)

"BLD",9557,"KRN","B",9.8,9.8)

"BLD",9557,"KRN","B",19,19)

"BLD",9557,"KRN","B",19.1,19.1)

"BLD",9557,"KRN","B",101,101)

"BLD",9557,"KRN","B",409.61,409.61)

"BLD",9557,"KRN","B",771,771)

"BLD",9557,"KRN","B",779.2,779.2)

"BLD",9557,"KRN","B",870,870)

"BLD",9557,"KRN","B",8989.51,8989.51)

"BLD",9557,"KRN","B",8989.52,8989.52)

"BLD",9557,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
PSS*1.0*200
"BLD",2210,0)
PSS*1.0*200^PHARMACY DATA MANAGEMENT^0^3161115^y
"BLD",2210,4,0)
^9.64PA^^
"BLD",2210,6)
3^
"BLD",2210,6.3)
29
"BLD",2210,"ABPKG")
n
"BLD",2210,"KRN",0)
^9.67PA^9002226^21
"BLD",2210,"KRN",.4,0)
.4
"BLD",2210,"KRN",.401,0)
.401
"BLD",2210,"KRN",.402,0)
.402
"BLD",2210,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",2210,"KRN",.402,"NM",1,0)
PSSCOMMON    FILE #50^50^0
"BLD",2210,"KRN",.402,"NM","B","PSSCOMMON    FILE #50",1)

"BLD",2210,"KRN",.403,0)
.403
"BLD",2210,"KRN",.5,0)
.5
"BLD",2210,"KRN",.84,0)
.84
"BLD",2210,"KRN",3.6,0)
3.6
"BLD",2210,"KRN",3.8,0)
3.8
"BLD",2210,"KRN",9.2,0)
9.2
"BLD",2210,"KRN",9.8,0)
9.8
"BLD",2210,"KRN",9.8,"NM",0)
^9.68A^6^3
"BLD",2210,"KRN",9.8,"NM",4,0)
PSSLOOK^^0^B94208630
"BLD",2210,"KRN",9.8,"NM",5,0)
PSSDEE^^0^B142621269
"BLD",2210,"KRN",9.8,"NM",6,0)
PSSMARK^^0^B45969252
"BLD",2210,"KRN",9.8,"NM","B","PSSDEE",5)

"BLD",2210,"KRN",9.8,"NM","B","PSSLOOK",4)

"BLD",2210,"KRN",9.8,"NM","B","PSSMARK",6)

"BLD",2210,"KRN",19,0)
19
"BLD",2210,"KRN",19.1,0)
19.1
"BLD",2210,"KRN",101,0)
101
"BLD",2210,"KRN",409.61,0)
409.61
"BLD",2210,"KRN",771,0)
771
"BLD",2210,"KRN",779.2,0)
779.2
"BLD",2210,"KRN",870,0)
870
"BLD",2210,"KRN",8989.51,0)
8989.51
"BLD",2210,"KRN",8989.52,0)
8989.52
"BLD",2210,"KRN",8994,0)
8994
"BLD",2210,"KRN",9002226,0)
9002226
"BLD",2210,"KRN","B",.4,.4)

"BLD",2210,"KRN","B",.401,.401)

"BLD",2210,"KRN","B",.402,.402)

"BLD",2210,"KRN","B",.403,.403)

"BLD",2210,"KRN","B",.5,.5)

"BLD",2210,"KRN","B",.84,.84)

"BLD",2210,"KRN","B",3.6,3.6)

"BLD",2210,"KRN","B",3.8,3.8)

"BLD",2210,"KRN","B",9.2,9.2)

"BLD",2210,"KRN","B",9.8,9.8)

"BLD",2210,"KRN","B",19,19)

"BLD",2210,"KRN","B",19.1,19.1)

"BLD",2210,"KRN","B",101,101)

"BLD",2210,"KRN","B",409.61,409.61)

"BLD",2210,"KRN","B",771,771)

"BLD",2210,"KRN","B",779.2,779.2)

"BLD",2210,"KRN","B",870,870)

"BLD",2210,"KRN","B",8989.51,8989.51)

"BLD",2210,"KRN","B",8989.52,8989.52)

"BLD",2210,"KRN","B",8994,8994)

"BLD",2210,"KRN","B",9002226,9002226)

"BLD",2210,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",2210,"QUES",0)
^9.62^^
"BLD",2210,"REQB",0)
^9.611^6^4
"BLD",2210,"REQB",3,0)
PSS*1.0*189^1
"BLD",2210,"REQB",4,0)
PSS*1.0*180^1
"BLD",2210,"REQB",5,0)
PSS*1.0*192^1
"BLD",2210,"REQB",6,0)
PSS*1.0*193^1
"BLD",2210,"REQB","B","PSS*1.0*180",4)

"BLD",2210,"REQB","B","PSS*1.0*189",3)

"BLD",2210,"REQB","B","PSS*1.0*192",5)

"BLD",2210,"REQB","B","PSS*1.0*193",6)

"KRN",.402,1998,-1)
0^1
"KRN",.402,1998,0)
PSSCOMMON^3160829.1846^@^50^^@^3161115
"KRN",.402,1998,"DIAB",1,1,50.037,0)
ALL
"KRN",.402,1998,"DIAB",1,1,50.065,0)
ALL
"KRN",.402,1998,"DIAB",6,0,50,0)
84;"ePharmacy Billable"
"KRN",.402,1998,"DIAB",7,0,50,0)
85;"  ePharmacy Billable (TRICARE)"
"KRN",.402,1998,"DIAB",8,0,50,0)
86;"  ePharmacy Billable (CHAMPVA)"
"KRN",.402,1998,"DIAB",9,0,50,0)
87;"Sensitive Diagnosis Drug"
"KRN",.402,1998,"DR",1,50)
.01;2;D PKIND^PSSDDUT2;3;W !;84ePharmacy Billable~;85  ePharmacy Billable (TRICARE)~;86  ePharmacy Billable (CHAMPVA)~;87Sensitive Diagnosis Drug~;81;D PKIND^PSSDDUT2;
"KRN",.402,1998,"DR",1,50,1)
W !!,"NATIONAL FORMULARY INDICATOR: " W:$P($G(^PSDRUG(DA,"ND")),"^",11)=1 "YES" W:$P($G(^PSDRUG(DA,"ND")),"^",11)="" "Not Matched To NDF" W:$P($G(^PSDRUG(DA,"ND")),"^",11)=0 "NO";D CPTIER^PSSDEE(DA);51;52;37;65;9;101;102;6;31;100;
"KRN",.402,1998,"DR",1,50,2)
N ND S ND=$G(^PSDRUG(DA,"ND")) I +ND,+$P(ND,"^",3),+$P($G(^PSNDF(50.68,+$P(ND,"^",3),"PFS")),"^") S Y="@4";W !!,"If you are planning to match to a NDF entry later or have no plan of using";
"KRN",.402,1998,"DR",1,50,3)
W !,"the external billing function, you may skip the Service Code entry.";W !!,"Unmatched items that are not copay exempt (ie. Supplies) default to Tier 2";400;@4;
"KRN",.402,1998,"DR",1,50,4)
S PSONEWW=$S($P($G(^PS(59.7,1,10)),"^",9)="N":1,1:0) W !!,"WARNING LABEL SOURCE is "_$S(PSONEWW:"'NEW'.",1:"not 'NEW'.");
"KRN",.402,1998,"DR",1,50,5)
I PSONEWW W !,"The following WARNING LABEL may continue to be used for a limited time for some external interfaces.";I 'PSONEWW W !,"WARNING LABEL will be used until the WARNING LABEL SOURCE is set to 'NEW'.";8;@5;
"KRN",.402,1998,"DR",1,50,6)
D WARN^PSSWRNB S:$G(WARNEDIT) Y="@10" I '$G(WARNEDIT) S Y="@15";@10;8.1;S Y="@5";@15;D GENDER2^PSSWRNA I GENDER="" S Y="@20";8.2;@20;12;13;14.5;15;D NCINIT^PSSDDUT2 S Y="@24";@24;82;D NCPDPDU^PSSDDUT2 S PSSNDU=X S Y="@25";@25;83;
"KRN",.402,1998,"DR",1,50,7)
66;
"KRN",.402,1998,"DR",2,50.037)
.01
"KRN",.402,1998,"DR",2,50.065)
.01
"KRN",.402,1998,"DR",2,50.1)
.01;1;2;
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
200^3161115^11951
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSSDEE")
0^5^B142621269
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ;01/21/00
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110,155,156,180,193,200**;9/30/97;Build 29
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;Reference to PSNAPIS supported by DBIA #2531
"RTN","PSSDEE",9,0)
 ;Reference to ^XMB("NETNAME" supported by DBIA #1131
"RTN","PSSDEE",10,0)
 ;Reference to ^XUSEC supported by DIBA #10076
"RTN","PSSDEE",11,0)
 ;
"RTN","PSSDEE",12,0)
BEGIN N PSSUPRAF,PSSTDRUG
"RTN","PSSDEE",13,0)
 S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",14,0)
DONE D ^PSSDEE2 K PSSFLAGK,PSSXX,DIE,DIR,CLFLAG,CLFALG,DISPDRG,DLAYGO,DR,ENTRY,FLAG,FLG1,FLG2,FLG4,FLG5,FLG6,FLG7,FLGKY,FLGMTH,FLGNDF,FLGOI,K,NEWDF
"RTN","PSSDEE",15,0)
 K NFLAG,NWND,NWPC1,NWPC2,NWPC3OLDDF,PSIUDA,PSIUX,PSNP,PSSANS,PSSASK,PSSDA,PSSDD,PSSFLAG,PSSOR,PSSZ,PSXBT,PSXF,PSXFL,PSXUM,PSXGOOD,PSXLOC,ZAPFLG
"RTN","PSSDEE",16,0)
 Q
"RTN","PSSDEE",17,0)
ASK ;
"RTN","PSSDEE",18,0)
 W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",19,0)
 N PSINACT S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI,PSINACT)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",20,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",21,0)
 I $G(^PSDRUG(DA,"I")) S PSINACT=$G(^PSDRUG(DA,"I")) I PSINACT,PSINACT<DT S PSINACT=1  ;;<<*180 - RJS
"RTN","PSSDEE",22,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG,PSSUPRAF
"RTN","PSSDEE",23,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",24,0)
 ; run the new routine and create message
"RTN","PSSDEE",25,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU,PSSUPRA S XX=""
"RTN","PSSDEE",26,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",27,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",28,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",29,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",30,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG)
"RTN","PSSDEE",31,0)
 S XX=$P($G(^PSDRUG(DISPDRG,2)),"^",3) I XX["U"!(XX["I") D  S XX=""
"RTN","PSSDEE",32,0)
 .S XX=$$SNDHL7^PSSMSTR() D:XX
"RTN","PSSDEE",33,0)
 ..Q:PSSNEW&'((XX=2)!(XX=3))  ;U=1,N=2,B=3
"RTN","PSSDEE",34,0)
 ..Q:'PSSNEW&(XX=2)  ;U=1,N=2,B=3
"RTN","PSSDEE",35,0)
 ..N VAR
"RTN","PSSDEE",36,0)
 ..I PSSNEW&((XX=2)!(XX=3)) S VAR="Would you like to send this new drug to PADE"
"RTN","PSSDEE",37,0)
 ..E  S VAR="Would you like to send a drug file update to PADE"
"RTN","PSSDEE",38,0)
 ..W !!,"This drug is marked for either UD or IV use, and you have at least"
"RTN","PSSDEE",39,0)
 ..W !,"one active Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSSDEE",40,0)
 ..K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSSDEE",41,0)
 ..S DIR(0)="Y",DIR("A")=VAR
"RTN","PSSDEE",42,0)
 ..S DIR("?")="Enter Y for Yes or N for No." D ^DIR K DIR
"RTN","PSSDEE",43,0)
 ..Q:'Y
"RTN","PSSDEE",44,0)
 ..N PSSPADE S PSSPADE=1 S XX=""
"RTN","PSSDEE",45,0)
 ..D ENP^PSSHLDFS(DISPDRG,$S(PSSNEW:"MAD",1:"MUP"))
"RTN","PSSDEE",46,0)
 K FLG3,PSSNEW
"RTN","PSSDEE",47,0)
 Q
"RTN","PSSDEE",48,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",49,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"."
"RTN","PSSDEE",52,0)
 S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",53,0)
 Q
"RTN","PSSDEE",54,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",55,0)
 Q
"RTN","PSSDEE",56,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",57,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",58,0)
 S PSSUPRAF=%
"RTN","PSSDEE",59,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",60,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",61,0)
 I %=1 D  ;;<<*180 - RJS
"RTN","PSSDEE",62,0)
 .D RSET^PSSDEE1
"RTN","PSSDEE",63,0)
 .I 'PSINACT D EN1^PSSUTIL(DISPDRG,1)
"RTN","PSSDEE",64,0)
 .S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",65,0)
 Q  ;;<< *180 - RJS
"RTN","PSSDEE",66,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",67,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",68,0)
 Q
"RTN","PSSDEE",69,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",70,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",71,0)
 Q
"RTN","PSSDEE",72,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",73,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",74,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",75,0)
 Q
"RTN","PSSDEE",76,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",77,0)
 Q
"RTN","PSSDEE",78,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",79,0)
 Q
"RTN","PSSDEE",80,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",81,0)
 Q
"RTN","PSSDEE",82,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",83,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",84,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",85,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",86,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",87,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",88,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",89,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",90,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",91,0)
 W !
"RTN","PSSDEE",92,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",93,0)
 I FLGKY'=1 D
"RTN","PSSDEE",94,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",95,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",96,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",97,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",98,0)
 Q
"RTN","PSSDEE",99,0)
 ;
"RTN","PSSDEE",100,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",101,0)
 N CHECK,I,C
"RTN","PSSDEE",102,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",103,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",104,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",105,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",106,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",107,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",108,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",109,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",110,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",111,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",112,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",113,0)
 Q CHECK
"RTN","PSSDEE",114,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",115,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",116,0)
 Q
"RTN","PSSDEE",117,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",118,0)
 Q
"RTN","PSSDEE",119,0)
OP I FLG1 D
"RTN","PSSDEE",120,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",121,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",122,0)
 . I %=1 D
"RTN","PSSDEE",123,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",124,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",125,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",126,0)
 Q
"RTN","PSSDEE",127,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",128,0)
 Q
"RTN","PSSDEE",129,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",130,0)
 Q
"RTN","PSSDEE",131,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",132,0)
 Q
"RTN","PSSDEE",133,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",134,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",135,0)
 K PSSIVOUT
"RTN","PSSDEE",136,0)
 Q
"RTN","PSSDEE",137,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",138,0)
 Q
"RTN","PSSDEE",139,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",140,0)
 Q
"RTN","PSSDEE",141,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",142,0)
 Q
"RTN","PSSDEE",143,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",144,0)
 Q
"RTN","PSSDEE",145,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",146,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",147,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",148,0)
 Q
"RTN","PSSDEE",149,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",150,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",151,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",152,0)
 Q
"RTN","PSSDEE",153,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",154,0)
 Q
"RTN","PSSDEE",155,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",156,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",157,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",158,0)
 Q
"RTN","PSSDEE",159,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",160,0)
 Q
"RTN","PSSDEE",161,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",162,0)
 I PACK'="" D
"RTN","PSSDEE",163,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",164,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",165,0)
 .D USE1
"RTN","PSSDEE",166,0)
 Q
"RTN","PSSDEE",167,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",168,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",169,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",170,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",171,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",172,0)
 Q
"RTN","PSSDEE",173,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",174,0)
 Q
"RTN","PSSDEE",175,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",176,0)
 Q
"RTN","PSSDEE",177,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",178,0)
 Q
"RTN","PSSDEE",179,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",180,0)
 Q
"RTN","PSSDEE",181,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",182,0)
 Q
"RTN","PSSDEE",183,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",184,0)
 Q
"RTN","PSSDEE",185,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",186,0)
 Q
"RTN","PSSDEE",187,0)
OPEI ;
"RTN","PSSDEE",188,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",189,0)
 D ^DIE
"RTN","PSSDEE",190,0)
 Q:'+$P($G(^PSDRUG(DA,6)),"^")
"RTN","PSSDEE",191,0)
OPEI2 ; get external dispensing devices associated with the drug
"RTN","PSSDEE",192,0)
 W !!,"Defining a dispensing device at the drug level for a division will override"
"RTN","PSSDEE",193,0)
 W !,"the dispensing device settings in the OUTPATIENT SITE File (#59). If populated,",!,"the drug will be sent to the dispensing device for that division.",!
"RTN","PSSDEE",194,0)
 S DR="906"
"RTN","PSSDEE",195,0)
 D ^DIE
"RTN","PSSDEE",196,0)
 Q
"RTN","PSSDEE",197,0)
DEA ;
"RTN","PSSDEE",198,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",199,0)
 Q
"RTN","PSSDEE",200,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",201,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",202,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",203,0)
 Q
"RTN","PSSDEE",204,0)
CPTIER(VAPID) ;Called from PSSCOMMON Input Template
"RTN","PSSDEE",205,0)
 ; VAPID = IEN OF DRUG FILE #50
"RTN","PSSDEE",206,0)
 N CPDATE,X,PSSCP D NOW^%DTC S CPDATE=X S PSSCP=$$CPTIER^PSNAPIS("",CPDATE,VAPID,1) K CPDATE,X
"RTN","PSSDEE",207,0)
 ;  PSSCP = Copay Tier^Effective Date^End Date
"RTN","PSSDEE",208,0)
 W !,"Copay Tier: ",$P(PSSCP,"^",1)
"RTN","PSSDEE",209,0)
 W !,"Copay Effective Date: " S Y=$P(PSSCP,"^",2) D DD^%DT W Y K Y,PSSCP
"RTN","PSSDEE",210,0)
 Q
"RTN","PSSDEE",211,0)
 ;
"RTN","PSSDEE",212,0)
GETTIER(PSSTDRUG) ;called by DIC to get copay tier for today's date 
"RTN","PSSDEE",213,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSSDRGCL,PSSCONVD,PSSINACT,PSSFSN,PSSNFORM,PSSMSG,PSSRESTR,PSSDRDAT D NOW^%DTC S CPDATE=X
"RTN","PSSDEE",214,0)
 D GETS^DIQ(50,PSSTDRUG,"2;22;51;6;100;101;102","IE","PSSDRDAT")
"RTN","PSSDEE",215,0)
 S (PSSDRGCL,PSSFSN,PSSNFORM,PSSINACT,PSSMSG,PSSRESTR,VAPROD)=""
"RTN","PSSDEE",216,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",2,"E"))'="" PSSDRGCL=PSSDRDAT(50,PSSTDRUG_",",2,"E")
"RTN","PSSDEE",217,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",6,"E"))'="" PSSFSN=PSSDRDAT(50,PSSTDRUG_",",6,"E")
"RTN","PSSDEE",218,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",51,"E"))'="" PSSNFORM=PSSDRDAT(50,PSSTDRUG_",",51,"E")
"RTN","PSSDEE",219,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",100,"I")) PSSINACT=PSSDRDAT(50,PSSTDRUG_",",100,"I")
"RTN","PSSDEE",220,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",101,"E"))'="" PSSMSG=PSSDRDAT(50,PSSTDRUG_",",101,"E")
"RTN","PSSDEE",221,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",102,"E"))'="" PSSRESTR=PSSDRDAT(50,PSSTDRUG_",",102,"E")
"RTN","PSSDEE",222,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",22,"I")) VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",223,0)
 W " "_$$GET1^DIQ(50,PSSTDRUG,2)
"RTN","PSSDEE",224,0)
 Q:'$G(VAPROD) 
"RTN","PSSDEE",225,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,"",1) K CPDATE,X
"RTN","PSSDEE",226,0)
 W:$G(PSSFSN)["" "  "_PSSFSN W:$G(PSSNFORM)["" "  ",PSSNFORM ;FSN; local non-formulary
"RTN","PSSDEE",227,0)
 I $P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSSDEE",228,0)
 S:$G(PSSINACT) PSSCONVD=$$DATE(PSSINACT)  ;inactive date
"RTN","PSSDEE",229,0)
 W:$G(PSSCONVD)'="" "  "_PSSCONVD
"RTN","PSSDEE",230,0)
 W:$G(PSSMSG)'="" "  "_PSSMSG
"RTN","PSSDEE",231,0)
 W:$G(PSSRESTR)'="" "  "_PSSRESTR
"RTN","PSSDEE",232,0)
 Q
"RTN","PSSDEE",233,0)
 ;
"RTN","PSSDEE",234,0)
DATE(PSSCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSSDEE",235,0)
 N DATE
"RTN","PSSDEE",236,0)
 S DATE="",DATE=$E(PSSCONVD,4,5)_"/"_$E(PSSCONVD,6,7)_"/"_(1700+$E(PSSCONVD,1,3))
"RTN","PSSDEE",237,0)
 Q DATE
"RTN","PSSLOOK")
0^4^B94208630
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ;02/03/00
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189,192,200**;9/30/97;Build 29
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",15,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",16,0)
 ;
"RTN","PSSLOOK",17,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",18,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",19,0)
 Q
"RTN","PSSLOOK",20,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",21,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",22,0)
 Q
"RTN","PSSLOOK",23,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",24,0)
 Q
"RTN","PSSLOOK",25,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",26,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",27,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",28,0)
 Q
"RTN","PSSLOOK",29,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",30,0)
 Q
"RTN","PSSLOOK",31,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",32,0)
 Q
"RTN","PSSLOOK",33,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",34,0)
 Q
"RTN","PSSLOOK",35,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",36,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",37,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",38,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",39,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",40,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",41,0)
 Q
"RTN","PSSLOOK",42,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",43,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",44,0)
 Q
"RTN","PSSLOOK",45,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",46,0)
 Q
"RTN","PSSLOOK",47,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",48,0)
 Q
"RTN","PSSLOOK",49,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",50,0)
 Q
"RTN","PSSLOOK",51,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",52,0)
 Q
"RTN","PSSLOOK",53,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",54,0)
 Q
"RTN","PSSLOOK",55,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",56,0)
 N DAW
"RTN","PSSLOOK",57,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",58,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",59,0)
 W !
"RTN","PSSLOOK",60,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",61,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",62,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",63,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",64,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",65,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",66,0)
 W !
"RTN","PSSLOOK",67,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",68,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",69,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",70,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",71,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",72,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",73,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",74,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",75,0)
 .N DRUG
"RTN","PSSLOOK",76,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",77,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",78,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",79,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",80,0)
 .K PSSWRN
"RTN","PSSLOOK",81,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",82,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",83,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",84,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",85,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",86,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",87,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",88,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",90,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",91,0)
 D FULL Q:$G(QUIT)  W !,"ePharmacy Billable: ",$$GET1^DIQ(50,IFN,84)
"RTN","PSSLOOK",92,0)
 D FULL Q:$G(QUIT)  W !?2,"ePharmacy Billable (TRICARE): ",$$GET1^DIQ(50,IFN,85) W ?40,"ePharmacy Billable (CHAMPVA): ",$$GET1^DIQ(50,IFN,86)
"RTN","PSSLOOK",93,0)
 D FULL Q:$G(QUIT)  W !,"Sensitive Diagnosis Drug: ",$$GET1^DIQ(50,IFN,87) W !
"RTN","PSSLOOK",94,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",95,0)
 I $D(APP) D
"RTN","PSSLOOK",96,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",97,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",98,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",99,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",100,0)
 W ?13,APPL
"RTN","PSSLOOK",101,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",102,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",103,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",104,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",105,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",106,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",107,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",108,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",109,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",110,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",111,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",112,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",113,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",114,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",115,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",116,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",117,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",118,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",119,0)
 N DA,K,LIST,PSXDN,PSXGN,PSXVP,X,XX1,XX2
"RTN","PSSLOOK",120,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",121,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",122,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",123,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",124,0)
 N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".") S PSSTIER=$$CPTIER^PSNAPIS($P($G(^PSDRUG(IFN,"ND")),"^",3),CPDATE,IFN,1) K CPDATE,%
"RTN","PSSLOOK",125,0)
 ;  PSSTIER = Copay Tier^Effective Date^End Date
"RTN","PSSLOOK",126,0)
 W !,"Copay Tier: ",$P(PSSTIER,"^",1)
"RTN","PSSLOOK",127,0)
 W !,"Copay Effective Date: " S Y=$P(PSSTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSSLOOK",128,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",129,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",130,0)
 Q
"RTN","PSSLOOK",131,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",132,0)
 ;
"RTN","PSSLOOK",133,0)
 ;
"RTN","PSSLOOK",134,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",135,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",136,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC,PSSTIER
"RTN","PSSLOOK",137,0)
 Q
"RTN","PSSLOOK",138,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",139,0)
 Q
"RTN","PSSLOOK",140,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",141,0)
 Q
"RTN","PSSLOOK",142,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",143,0)
 Q
"RTN","PSSLOOK",144,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",145,0)
 Q
"RTN","PSSLOOK",146,0)
UNCALC ;
"RTN","PSSLOOK",147,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",148,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",149,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",150,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",151,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",152,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",153,0)
 Q
"RTN","PSSLOOK",154,0)
 ;
"RTN","PSSLOOK",155,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",156,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",157,0)
 S PSSLKL4=""
"RTN","PSSLOOK",158,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",159,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",160,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",161,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",162,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",163,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",164,0)
 Q
"RTN","PSSMARK")
0^6^B45969252
"RTN","PSSMARK",1,0)
PSSMARK ;BIR/WRT-Review single NDF matches for CMOP ; 9/14/11 11:29am
"RTN","PSSMARK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,17,20,28,57,82,124,170,200**;9/30/97;Build 29
"RTN","PSSMARK",3,0)
 ;
"RTN","PSSMARK",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSMARK",5,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSMARK",6,0)
 ;Reference to ^PSNTRAN("END" supported by DBIA #2527
"RTN","PSSMARK",7,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSMARK",8,0)
 ;Reference to $$CPTIER^PSNAPIS(P2,P2,P3) supported by DBIA #2531
"RTN","PSSMARK",9,0)
 ;
"RTN","PSSMARK",10,0)
PICK S U="^" S PSXFL=0 D TEXT F PSXMM=1:1 D PICK1 S:'$D(PSXFL) PSXFL=0 Q:PSXFL
"RTN","PSSMARK",11,0)
DONE K PSXBT,PSXF,PSXFL,PSXVAP,PSXVP,PSXGN,PSXUM,PSXDN,PSXDP,PSXCMOP,PSXLOC,PSXZERO,PSXODE,PSXMM,PSXOU,PSXG,X,Y,PSXIDENT,PSXNDF,PSXVAPN,NONCE,PSXNEXT,PSXLAST,RTC,PSXNOW,PSXID,PSSEXP
"RTN","PSSMARK",12,0)
 Q
"RTN","PSSMARK",13,0)
TEXT W !!,"This option allows you to choose entries from your drug file and helps you",!,"review your NDF matches and mark individual entries to send to CMOP.",!
"RTN","PSSMARK",14,0)
 W !,"If you mark the entry to transmit to CMOP, it will replace your Dispense Unit",!,"with the VA Dispense Unit. In addition, you may overwrite the local drug name",!,"with the VA Print Name and the entry will remain uneditable.",!
"RTN","PSSMARK",15,0)
 Q
"RTN","PSSMARK",16,0)
DISPLAY W @IOF W !!?3,"Local Drug Generic Name: ",PSXLOC W !!,?16,"ORDER UNIT: "
"RTN","PSSMARK",17,0)
 I $D(^PSDRUG(PSXUM,660)) S PSXODE=^PSDRUG(PSXUM,660) I $P(PSXODE,"^",2) S PSXOU=$P(PSXODE,"^",2) I $D(^DIC(51.5)),$D(^DIC(51.5,PSXOU)) W ?28,$S('$D(PSXOU):"",1:$P(^DIC(51.5,PSXOU,0),"^",1))
"RTN","PSSMARK",18,0)
 W !,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",5)),!,?13,"DISPENSE UNIT: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",8)),!,"   PRICE PER DISPENSE UNIT: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",6))
"RTN","PSSMARK",19,0)
 W !!,"VA Print Name: ",PSXVAP,?59,"VA Dispense Unit: ",PSXDP,!,"VA Drug Class: ",$P(^PS(50.605,$P(PSXDN,"^",6),0),"^",1),?50,"CMOP ID: ",PSXID
"RTN","PSSMARK",20,0)
 N CPDATE,X,PSNCP D NOW^%DTC S CPDATE=X S PSNCP=$$CPTIER^PSNAPIS("",CPDATE,PSXUM) K CPDATE,X W !,"COPAY Tier: ",$P(PSNCP,"^",1)
"RTN","PSSMARK",21,0)
 D CHECK
"RTN","PSSMARK",22,0)
 Q
"RTN","PSSMARK",23,0)
CHECK I $D(^PSDRUG("AQ",PSXUM)),$P(^PSDRUG(PSXUM,3),"^",1)=1 D UNMARK
"RTN","PSSMARK",24,0)
 Q:PSXBT=1  I '$D(^PSDRUG("AQ",PSXUM)) D MARK
"RTN","PSSMARK",25,0)
 Q
"RTN","PSSMARK",26,0)
MARK Q:PSXBT=1  W !!,"Do you wish to mark this drug to transmit to CMOP? " K DIR S DIR(0)="Y" D ^DIR D OUT I (Y=0)!($D(DUOUT)) K X,Y,DIRUT S PSXBT=1,PSXF=1 Q:PSXF=1  Q:PSXBT=1
"RTN","PSSMARK",27,0)
 I Y=1 S $P(^PSDRUG(PSXUM,660),"^",8)=PSXDP,^PSDRUG(PSXUM,3)=1,^PSDRUG("AQ",PSXUM)="",DA=PSXUM D ^PSSREF,IDENT K DA D QDM,QUEST,QUES2 S PSXF=1  ;;<RJS*170
"RTN","PSSMARK",28,0)
 Q
"RTN","PSSMARK",29,0)
UNMARK Q:PSXF=1  W !!,"Do you wish to UNmark this drug to transmit to CMOP? " K DIR S DIR(0)="Y" D ^DIR D OUT I (Y=0)!($D(DUOUT)) K X,Y,DIRUT S PSXF=1 Q
"RTN","PSSMARK",30,0)
 I Y=1 S $P(^PSDRUG(PSXUM,3),"^",1)=0 K ^PSDRUG("AQ",PSXUM) S DA=PSXUM D ^PSSREF K DA S PSXF=1,PSXBT=1 Q:PSXBT=1  ;;<RJS*170
"RTN","PSSMARK",31,0)
 Q
"RTN","PSSMARK",32,0)
QUES2 W !!,"Do you wish to overwrite your local name? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will overwrite GENERIC NAME with the VA Print Name." D ^DIR D OUT I (Y=0)!($D(DUOUT)) D SYN K X,Y,DIRUT S PSXG=1 Q:PSXG=1
"RTN","PSSMARK",33,0)
 I Y=1 D DUP I '$D(^PSDRUG("B",PSXVAP)) S $P(^PSDRUG(PSXUM,0),"^",1)=PSXVAP D XREF,OLDNM S PSXF=1,PSXG=1  ;;<RJS*170
"RTN","PSSMARK",34,0)
 Q
"RTN","PSSMARK",35,0)
DUP I PSXVAP'=PSXLOC,$D(^PSDRUG("B",PSXVAP)) W !,"You cannot write over the GENERIC NAME because one already has that",!,"VA Print Name. You cannot have duplicate names.",!
"RTN","PSSMARK",36,0)
 Q
"RTN","PSSMARK",37,0)
XREF K:PSXLOC'=PSXVAP ^PSDRUG("B",PSXLOC,PSXUM) S:PSXLOC'=PSXVAP ^PSDRUG("B",PSXVAP,PSXUM)="" I $D(^PSNTRAN(PSXUM,"END")) S $P(^PSNTRAN(PSXUM,"END"),"^",3)=PSXVAP,$P(^PSNTRAN("END"),"^",3)=PSXVAP
"RTN","PSSMARK",38,0)
 Q
"RTN","PSSMARK",39,0)
BLD ;
"RTN","PSSMARK",40,0)
 I $D(^PSDRUG(PSXUM,"I")) D  ;; <*124 RJS
"RTN","PSSMARK",41,0)
 .N X,X1,X2
"RTN","PSSMARK",42,0)
 .S X1=$G(^PSDRUG(PSXUM,"I")),X2=DT D ^%DTC
"RTN","PSSMARK",43,0)
 .S:X<1 PSSEXP(1)="It has been inactivated."  ;; *124 RJS >
"RTN","PSSMARK",44,0)
 I $D(^PSDRUG(PSXUM,2)),$P(^PSDRUG(PSXUM,2),"^",3)'["O" S PSSEXP(2)="It is not marked for outpatient pharmacy use."
"RTN","PSSMARK",45,0)
BLD5 I $P(^PSDRUG(PSXUM,0),"^",3)[1!($P(^(0),"^",3)[2) S PSSEXP(3)="It is a schedule I or schedule II controlled substance."
"RTN","PSSMARK",46,0)
 I '$D(^PSDRUG(PSXUM,"ND")) S PSSEXP(4)="It is not matched to NDF."
"RTN","PSSMARK",47,0)
 I $D(^PSDRUG(PSXUM,"ND")),$P(^PSDRUG(PSXUM,"ND"),"^",2)']"" S PSSEXP(5)="It is not matched to NDF."
"RTN","PSSMARK",48,0)
 ;
"RTN","PSSMARK",49,0)
BLD1 S PSSXX="" I $D(^PSDRUG(PSXUM,"ND")) S PSXDN=^PSDRUG(PSXUM,"ND"),PSXGN=$P(PSXDN,"^",1),PSXVP=$P(PSXDN,"^",3) S PSSXX=$$PROD2^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSMARK",50,0)
 I $P(PSSXX,"^",3)'=1 S PSSEXP(6)="It is not marked for CMOP in NDF." Q
"RTN","PSSMARK",51,0)
 I '$O(PSSEXP(0)),PSSXX]"",$P(PSSXX,"^",3)=1 S PSXVAP=$P(PSSXX,"^"),PSXDP=$P(PSSXX,"^",4)
"RTN","PSSMARK",52,0)
 Q
"RTN","PSSMARK",53,0)
PICK1 S DIC="^PSDRUG(",DIC(0)="QEAM" D ^DIC K DIC I Y<0 S PSXFL=1 Q
"RTN","PSSMARK",54,0)
 K PSSEXP
"RTN","PSSMARK",55,0)
 S PSXUM=+Y,PSXLOC=$P(Y,"^",2) S PSSEXP(0)="",PSXF=0,PSXBT=0 D BLD
"RTN","PSSMARK",56,0)
PICK2 I $O(PSSEXP(0)) W !!,"This drug cannot be marked for the following reason(s).",! F PSSXX=0:0 S PSSXX=$O(PSSEXP(PSSXX)) Q:'PSSXX  W !,PSSEXP(PSSXX)
"RTN","PSSMARK",57,0)
 I $O(PSSEXP(0)) K PSSEXP W ! Q
"RTN","PSSMARK",58,0)
GOTIT S PSXID=$P(PSSXX,"^",2),PSXZERO=^PSDRUG(PSXUM,0) D DISPLAY
"RTN","PSSMARK",59,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU S XX=""
"RTN","PSSMARK",60,0)
 I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSXUM) D  Q:PSXF  Q:PSXBT
"RTN","PSSMARK",61,0)
 . F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSMARK",62,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSMARK",63,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) D:$G(DNSNAM)&(DMFU="YES") DRG^PSSDGUPD(PSXUM,"",DNSNAM,DNSPORT)
"RTN","PSSMARK",64,0)
 Q
"RTN","PSSMARK",65,0)
OUT I $D(DTOUT),DTOUT=1 S PSXFL=1
"RTN","PSSMARK",66,0)
 Q
"RTN","PSSMARK",67,0)
IDENT S PSXNDF=$P(^PSDRUG(PSXUM,"ND"),"^",1),PSXVAPN=$P(^PSDRUG(PSXUM,"ND"),"^",3),DA=PSXNDF,K=PSXVAPN S X=$$PROD2^PSNAPIS(DA,K),PSXIDENT=$P(X,"^",2),$P(^PSDRUG(PSXUM,"ND"),"^",10)=PSXIDENT,^PSDRUG("AQ1",PSXIDENT,PSXUM)=""
"RTN","PSSMARK",68,0)
 Q
"RTN","PSSMARK",69,0)
QUEST I $D(PSXODE),$P(PSXODE,"^",8)'=PSXDP W !!,"Your old Dispense Unit  ",$P(PSXODE,"^",8),"  does not match the new one  ",PSXDP,".",!,"You may wish to edit the Price Per Order Unit and/or The Dispense",!,"Units Per Order Unit.",! D QUESTA
"RTN","PSSMARK",70,0)
 Q
"RTN","PSSMARK",71,0)
QUESTA S DIE="^PSDRUG(",DA=PSXUM,DR="13;15",DIE("NO^")="BACK" D ^DIE K DIE("NO^")
"RTN","PSSMARK",72,0)
 Q
"RTN","PSSMARK",73,0)
OLDNM D OLD I $D(NONCE) D OLD1
"RTN","PSSMARK",74,0)
 Q
"RTN","PSSMARK",75,0)
OLD D NOW^%DTC I $D(^PSDRUG(PSXUM,900,1,0)) S NONCE=0,PSXLAST=0 F RTC=0:0 S RTC=$O(^PSDRUG(PSXUM,900,RTC)) Q:'RTC  S PSXLAST=PSXLAST+1,PSXNEXT=PSXLAST+1
"RTN","PSSMARK",76,0)
 I '$D(^PSDRUG(PSXUM,900,1,0)) S ^PSDRUG(PSXUM,900,1,0)=PSXLOC_"^"_X
"RTN","PSSMARK",77,0)
 Q
"RTN","PSSMARK",78,0)
OLD1 I NONCE=0 S ^PSDRUG(PSXUM,900,PSXNEXT,0)=PSXLOC_"^"_X,NONCE=1
"RTN","PSSMARK",79,0)
 Q
"RTN","PSSMARK",80,0)
SYN S:'$D(^PSDRUG(PSXUM,1,0)) ^PSDRUG(PSXUM,1,0)="^50.1A^0^0" I '$D(^PSDRUG("C",PSXVAP,PSXUM)) S PSXNOW=$P(^PSDRUG(PSXUM,1,0),"^",3)+1,^PSDRUG(PSXUM,1,PSXNOW,0)=PSXVAP,^PSDRUG("C",PSXVAP,PSXUM,PSXNOW)="" D SYN1
"RTN","PSSMARK",81,0)
 Q
"RTN","PSSMARK",82,0)
SYN1 S $P(^PSDRUG(PSXUM,1,0),"^",3)=PSXNOW,$P(^PSDRUG(PSXUM,1,0),"^",4)=$P(^PSDRUG(PSXUM,1,0),"^",4)+1
"RTN","PSSMARK",83,0)
 Q
"RTN","PSSMARK",84,0)
QDM S DIE="^PSDRUG(",DA=PSXUM,DR=215 D ^DIE
"RTN","PSSMARK",85,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
PSN*4.0*492
"BLD",9553,0)
PSN*4.0*492^NATIONAL DRUG FILE^0^3161115^y
"BLD",9553,4,0)
^9.64PA^^0
"BLD",9553,6)
3^
"BLD",9553,6.3)
27
"BLD",9553,"ABPKG")
n
"BLD",9553,"KRN",0)
^9.67PA^9002226^21
"BLD",9553,"KRN",.4,0)
.4
"BLD",9553,"KRN",.401,0)
.401
"BLD",9553,"KRN",.402,0)
.402
"BLD",9553,"KRN",.403,0)
.403
"BLD",9553,"KRN",.5,0)
.5
"BLD",9553,"KRN",.84,0)
.84
"BLD",9553,"KRN",3.6,0)
3.6
"BLD",9553,"KRN",3.8,0)
3.8
"BLD",9553,"KRN",9.2,0)
9.2
"BLD",9553,"KRN",9.8,0)
9.8
"BLD",9553,"KRN",9.8,"NM",0)
^9.68A^10^6
"BLD",9553,"KRN",9.8,"NM",5,0)
PSNLOOK^^0^B55919915
"BLD",9553,"KRN",9.8,"NM",6,0)
PSNVFY^^0^B17319517
"BLD",9553,"KRN",9.8,"NM",7,0)
PSNAPIS^^0^B93408219
"BLD",9553,"KRN",9.8,"NM",8,0)
PSNHIT^^0^B26995302
"BLD",9553,"KRN",9.8,"NM",9,0)
PSNACT^^0^B121966674
"BLD",9553,"KRN",9.8,"NM",10,0)
PSNOUT^^0^B9659319
"BLD",9553,"KRN",9.8,"NM","B","PSNACT",9)

"BLD",9553,"KRN",9.8,"NM","B","PSNAPIS",7)

"BLD",9553,"KRN",9.8,"NM","B","PSNHIT",8)

"BLD",9553,"KRN",9.8,"NM","B","PSNLOOK",5)

"BLD",9553,"KRN",9.8,"NM","B","PSNOUT",10)

"BLD",9553,"KRN",9.8,"NM","B","PSNVFY",6)

"BLD",9553,"KRN",19,0)
19
"BLD",9553,"KRN",19.1,0)
19.1
"BLD",9553,"KRN",101,0)
101
"BLD",9553,"KRN",409.61,0)
409.61
"BLD",9553,"KRN",771,0)
771
"BLD",9553,"KRN",779.2,0)
779.2
"BLD",9553,"KRN",870,0)
870
"BLD",9553,"KRN",8989.51,0)
8989.51
"BLD",9553,"KRN",8989.52,0)
8989.52
"BLD",9553,"KRN",8994,0)
8994
"BLD",9553,"KRN",9002226,0)
9002226
"BLD",9553,"KRN","B",.4,.4)

"BLD",9553,"KRN","B",.401,.401)

"BLD",9553,"KRN","B",.402,.402)

"BLD",9553,"KRN","B",.403,.403)

"BLD",9553,"KRN","B",.5,.5)

"BLD",9553,"KRN","B",.84,.84)

"BLD",9553,"KRN","B",3.6,3.6)

"BLD",9553,"KRN","B",3.8,3.8)

"BLD",9553,"KRN","B",9.2,9.2)

"BLD",9553,"KRN","B",9.8,9.8)

"BLD",9553,"KRN","B",19,19)

"BLD",9553,"KRN","B",19.1,19.1)

"BLD",9553,"KRN","B",101,101)

"BLD",9553,"KRN","B",409.61,409.61)

"BLD",9553,"KRN","B",771,771)

"BLD",9553,"KRN","B",779.2,779.2)

"BLD",9553,"KRN","B",870,870)

"BLD",9553,"KRN","B",8989.51,8989.51)

"BLD",9553,"KRN","B",8989.52,8989.52)

"BLD",9553,"KRN","B",8994,8994)

"BLD",9553,"KRN","B",9002226,9002226)

"BLD",9553,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9553,"QUES",0)
^9.62^^
"BLD",9553,"REQB",0)
^9.611^4^4
"BLD",9553,"REQB",1,0)
PSN*4.0*429^1
"BLD",9553,"REQB",2,0)
PSN*4.0*92^1
"BLD",9553,"REQB",3,0)
PSN*4.0*476^1
"BLD",9553,"REQB",4,0)
PSN*4.0*448^1
"BLD",9553,"REQB","B","PSN*4.0*429",1)

"BLD",9553,"REQB","B","PSN*4.0*448",4)

"BLD",9553,"REQB","B","PSN*4.0*476",3)

"BLD",9553,"REQB","B","PSN*4.0*92",2)

"MBREQ")
1
"PKG",136,-1)
1^1
"PKG",136,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.14
"PKG",136,20,0)
^9.402P^^
"PKG",136,22,0)
^9.49I^1^1
"PKG",136,22,1,0)
4.0^2981030^2981223^11595
"PKG",136,22,1,"PAH",1,0)
492^3161115^11951
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSNACT")
0^9^B121966674
"RTN","PSNACT",1,0)
PSNACT ;BIR/DMA&WRT-inquiries by VAPN, CMOP ID, or NDC ;07/02/03 14:01
"RTN","PSNACT",2,0)
 ;;4.0;NATIONAL DRUG FILE;**22,35,47,62,65,70,160,169,262,296,429,492**; 30 Oct 98;Build 27
"RTN","PSNACT",3,0)
 ;
"RTN","PSNACT",4,0)
 ;Reference to ^PS(50.606 supported by DBIA #2174
"RTN","PSNACT",5,0)
 ;Reference to ^PSNAPIS supported by DBIA #2531
"RTN","PSNACT",6,0)
 ;
"RTN","PSNACT",7,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","PSNACT",8,0)
 K DIC,DIR F ZXX=0:0 W ! D TEXT,ASKIT Q:$D(DIRUT)
"RTN","PSNACT",9,0)
 K QUIT,DIR,DIC,OLDDA,PROMPT,J,I,IEN,PPP,Y,Y1,Y3,Y5,Y6,Y7,Z0,Z1,Z3,Z5,Z6,Z7,ZA,ZXX,ASK,NDX,SIE,PSN,PSN1,MORE,SIE1
"RTN","PSNACT",10,0)
 N PMIS,QQQ,ENG,MAP,D,ANS,ZCT,DYAYGO,DUOUT,DTOUT,PSNTIER
"RTN","PSNACT",11,0)
 Q
"RTN","PSNACT",12,0)
TEXT W !,"This option allows you to lookup NDF file information three ways (VA Product",!,"Name, NDC, or CMOP ID number).",!
"RTN","PSNACT",13,0)
 Q
"RTN","PSNACT",14,0)
ASKIT S DIR(0)="SA^VA:VA PRODUCT;N:NDC;C:CMOP ID",DIR("A")="LOOKUP BY (VA) PRODUCT, (N)DC, OR (C)MOP ID ? " D ^DIR G END:$D(DIRUT) S ASK=Y(0)
"RTN","PSNACT",15,0)
 I ASK="NDC" D NDC
"RTN","PSNACT",16,0)
 I ASK="VA PRODUCT"  D LISTNDC
"RTN","PSNACT",17,0)
 I ASK="CMOP ID" D CMOP
"RTN","PSNACT",18,0)
 Q
"RTN","PSNACT",19,0)
NDC ;OR UPN
"RTN","PSNACT",20,0)
 K PROMPT S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ? " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",21,0)
 I PROMPT="NDC" S DIR(0)="F",DIR("A")="Enter NDC with or without Dashes (-)" D ^DIR G END:$D(DIRUT) D:X["-" PAD S DIC=50.67,DIC(0)="EQZN",D=PROMPT,DIC("W")="S PSNCTNDC=Y D GETTIERN^PSNACT(PSNCTNDC)" D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",22,0)
 I PROMPT="UPN" S DIC=50.67,DIC(0)="AEQZN",DIC("A")="Select "_PROMPT_":"_" ",D=PROMPT,DIC("W")="S PSNCTNDC=Y D GETTIERN^PSNACT(PSNCTNDC)" D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",23,0)
 Q
"RTN","PSNACT",24,0)
LKNDC W @IOF,!,"NDC: ",$P(NDF,"^",2),$$DT($P(NDF,"^",7)),"  UPN: ",$P(NDF,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDF,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDF,"^",4),0)),"^"),"  Trade Name: ",$P(NDF,"^",5),!,"Route: "
"RTN","PSNACT",25,0)
 S K=0 F  S K=$O(^PSNDF(50.67,DA,1,K)) Q:'K  W $P(^(K,0),"^")," "
"RTN","PSNACT",26,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDF,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDF,"^",9),0),"^")
"RTN","PSNACT",27,0)
 S ZA=$P(NDF,"^",6) D PRINT(ZA)
"RTN","PSNACT",28,0)
 Q
"RTN","PSNACT",29,0)
END K DA,DA,DIC,DIE,DIR,DR,IN,ING,J,K,L,NEW,NDF,OLD,OLDDA,PROMPT,X,Y,Y1,Y3,Y7,^TMP($J) Q
"RTN","PSNACT",30,0)
 Q
"RTN","PSNACT",31,0)
 ;
"RTN","PSNACT",32,0)
PRODI ;INQUIRE INTO 50.68
"RTN","PSNACT",33,0)
 F  S DIC="^PSNDF(50.68,",DIC(0)="AEQM" D ^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",34,0)
 K DA,DIC,X,Y Q
"RTN","PSNACT",35,0)
 ;
"RTN","PSNACT",36,0)
NDCI ;INQUIRE INTO 50.67
"RTN","PSNACT",37,0)
 S DIR(0)="SA^N:NDC;U:UPN;T:TRADE;P:PRODUCT",DIR("A")="NDC (N), UPN (U), Trade name (T), or Product (P) " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0) G LISTNDC:PROMPT["PRO",LISTNDC1:PROMPT="NDC" I PROMPT["T" S PROMPT="T"
"RTN","PSNACT",38,0)
 F  S DIC="^PSNDF(50.67,",DIC(0)="AEQZS",DIC("A")="Select "_PROMPT S:PROMPT="T" DIC("A")=DIC("A")_"rade name" S DIC("A")=DIC("A")_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",39,0)
 K DA,DIC,DIR,PROMPT,X,Y Q
"RTN","PSNACT",40,0)
 ;
"RTN","PSNACT",41,0)
LINK ;LINK NDCS OR UPNS
"RTN","PSNACT",42,0)
 S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ",DIR("B")="NDC" D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",43,0)
 F  Q:$D(DIRUT)!(Y<0)  S DIC=50.67,DIC(0)="AEQZ",DIC("A")="Enter Current "_PROMPT_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y,OLD=$P(Y(0),"^",$S(PROMPT="NDC":2,1:3)) D
"RTN","PSNACT",44,0)
 .K DIR S DIR(0)="F^"_$S(PROMPT="NDC":"12:12",1:"1:40")_"^W:$D(^PSNDF(50.67,PROMPT,X)) !!,""That "_PROMPT_" already exists"",! K:$D(^PSNDF(50.67,PROMPT,X)) X",DIR("A")="Enter a new "_PROMPT_" " D ^DIR K DIR Q:$D(DIRUT)  S NEW=Y
"RTN","PSNACT",45,0)
 .I PROMPT="NDC" D
"RTN","PSNACT",46,0)
 ..S IN=$O(^PSNDF(50.67,DA,2,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those NDCs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",47,0)
 ..I IN S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",2,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",48,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",2,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,11,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",49,0)
 .I PROMPT="UPN" D
"RTN","PSNACT",50,0)
 ..S IN=$O(^PSNDF(50.67,DA,3,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those UPNs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",51,0)
  ..S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",3,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",52,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",3,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,12,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",53,0)
 G LINK
"RTN","PSNACT",54,0)
 ;
"RTN","PSNACT",55,0)
LISTNDC ;LOOK UP NDCS BY PRODUCT
"RTN","PSNACT",56,0)
 K L,DA,^TMP($J),DIC
"RTN","PSNACT",57,0)
 S DIC=50.68,DIC(0)="AQEMZ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D ^DIC G END:Y<0
"RTN","PSNACT",58,0)
 S IEN=+Y W @IOF D PRINT(IEN) Q:$G(QUIT)  F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE!($G(QUIT))  D PRNT ; S ^TMP($J,"A"_$P(^PSNDF(50.67,SIE,0),"^",2)_"^"_SIE)=""
"RTN","PSNACT",59,0)
 Q
"RTN","PSNACT",60,0)
PRT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)  S DA=SIE,DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",61,0)
 Q
"RTN","PSNACT",62,0)
 ;
"RTN","PSNACT",63,0)
LISTNDC1 ;LOOK UP PARTIAL NDC
"RTN","PSNACT",64,0)
 ;
"RTN","PSNACT",65,0)
 F  K ^TMP($J) S QUIT=0,DIR(0)="F^1:12",DIR("A")="Select NDC ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D ^DIR Q:$D(DIRUT)  S PSN1=Y,PSN=Y D
"RTN","PSNACT",66,0)
 .I $D(^PSNDF(50.67,"NDC",PSN1)) S DA=0 F  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) S:'DA QUIT=1 Q:QUIT  S DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",67,0)
 .Q:QUIT
"RTN","PSNACT",68,0)
 .I PSN1?."0".E S PSN1=PSN1_"/"
"RTN","PSNACT",69,0)
 .I PSN1?.N,PSN1=+PSN1 S PSN1=$$LJ^XLFSTR(PSN1,12,0)-1
"RTN","PSNACT",70,0)
 .S ZCT=0 F  Q:QUIT  S PSN1=$O(^PSNDF(50.67,"NDC",PSN1)),DA=0 Q:$E(PSN1,1,$L(PSN))'=PSN  F  Q:QUIT  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) Q:'DA  S ZCT=ZCT+1,^TMP($J,ZCT)=DA W !,$J(ZCT,5),"  ",PSN1 D
"RTN","PSNACT",71,0)
 ..S MORE=$E($O(^PSNDF(50.67,"NDC",PSN1)),1,$L(PSN))=PSN!$O(^(PSN1,DA)) I ZCT#5&MORE Q
"RTN","PSNACT",72,0)
 ..S DIR(0)="NOA^1:"_ZCT,DIR("A")="Choose 1 - "_ZCT_" or ^ to quit " S:MORE DIR("A")=DIR("A")_"or return to see more "
"RTN","PSNACT",73,0)
 ..D ^DIR I $D(DUOUT)!$D(DTOUT) S QUIT=1 Q
"RTN","PSNACT",74,0)
 ..I Y="" Q
"RTN","PSNACT",75,0)
 ..S DA=^TMP($J,Y),QUIT=1,DIC="^PSNDF(50.67," W !! D EN^DIQ Q
"RTN","PSNACT",76,0)
 G END
"RTN","PSNACT",77,0)
 ;
"RTN","PSNACT",78,0)
PRINT(VAPRDIEN) ; Prints the Va Product field
"RTN","PSNACT",79,0)
 ;Input: VAPRDIEN - Internal Entry Number (IEN) in the VA PRODUCT (#50.68) file
"RTN","PSNACT",80,0)
 ;
"RTN","PSNACT",81,0)
 N QQQ,PSNELIEN,Z0,Z1,Z3,Z5,Z6,Z7,X,PSNELXY,K,ING
"RTN","PSNACT",82,0)
 S Z0=^PSNDF(50.68,VAPRDIEN,0)
"RTN","PSNACT",83,0)
 S Z1=^PSNDF(50.68,VAPRDIEN,1)
"RTN","PSNACT",84,0)
 S Z3=^PSNDF(50.68,VAPRDIEN,3)
"RTN","PSNACT",85,0)
 S Z5=$G(^PSNDF(50.68,VAPRDIEN,5))
"RTN","PSNACT",86,0)
 S Z6=$G(^PSNDF(50.68,VAPRDIEN,6,1,0))
"RTN","PSNACT",87,0)
 S Z7=$G(^PSNDF(50.68,VAPRDIEN,7))
"RTN","PSNACT",88,0)
 S QQQ=$P(Z1,"^",5) D GCN
"RTN","PSNACT",89,0)
 W !,"VA Product Name: ",$P(Z0,"^"),$$DT($P(Z7,"^",3))
"RTN","PSNACT",90,0)
 W !,"VA Generic Name: ",$P(^PSNDF(50.6,+$P(Z0,"^",2),0),"^")
"RTN","PSNACT",91,0)
 D NDOSE(VAPRDIEN)
"RTN","PSNACT",92,0)
 W !,"National Formulary Name: ",$P(Z0,"^",6)
"RTN","PSNACT",93,0)
 W !,"VA Print Name: ",$P(Z1,"^")
"RTN","PSNACT",94,0)
 W !,"VA Product Identifier: ",$P(Z1,"^",2),"  Transmit to CMOP: ",$S($P(Z1,"^",3):"Yes",1:"No"),"  VA Dispense Unit: ",$P($G(^PSNDF(50.64,+$P(Z1,"^",4),0)),"^")
"RTN","PSNACT",95,0)
 W !,"PMIS: ",PMIS,!,"Active Ingredients: "
"RTN","PSNACT",96,0)
 S (K,QUIT)=0 F  S K=$O(^PSNDF(50.68,VAPRDIEN,2,K)) Q:'K  D  Q:$G(QUIT)
"RTN","PSNACT",97,0)
 . S (PSNELXY,X)=^PSNDF(50.68,VAPRDIEN,2,K,0),ING=^PS(50.416,K,0)
"RTN","PSNACT",98,0)
 . S:$P(ING,"^",2) ING=^PS(50.416,$P(ING,"^",2),0)
"RTN","PSNACT",99,0)
 . W ?23,$P(ING,"^"),"  Strength: ",$P(PSNELXY,"^",2)," Units: ",$P($G(^PS(50.607,+$P(PSNELXY,"^",3),0)),"^")
"RTN","PSNACT",100,0)
 . D:($Y+5)>IOSL&'QUIT HANG Q:$G(QUIT)  W !
"RTN","PSNACT",101,0)
 Q:$G(QUIT)
"RTN","PSNACT",102,0)
 W !,"Primary VA Drug Class: ",$P($G(^PS(50.605,+Z3,0),"Unknown"),"^")
"RTN","PSNACT",103,0)
 W !,"Secondary VA Drug Class: "
"RTN","PSNACT",104,0)
 S (K,QUIT)=0 F  S K=$O(^PSNDF(50.68,VAPRDIEN,4,K)) Q:'K  D  Q:$G(QUIT)
"RTN","PSNACT",105,0)
 . W ?26,$P($G(^PS(50.605,+K,0),"Unknown"),"^")
"RTN","PSNACT",106,0)
 . D:($Y+5)>IOSL&'QUIT HANG Q:$G(QUIT)  W !
"RTN","PSNACT",107,0)
 Q:$G(QUIT)
"RTN","PSNACT",108,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",109,0)
 W !,"CS Federal Schedule: "_$S($P($G(^PSNDF(50.68,VAPRDIEN,7)),"^")]"":$P(^PSNDF(50.68,VAPRDIEN,7),"^"),1:"") D EXPAN(VAPRDIEN)
"RTN","PSNACT",110,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",111,0)
 W !,"National Formulary Indicator: ",$S($P(Z5,"^"):"Yes",1:"No")
"RTN","PSNACT",112,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",113,0)
 W !,"National Formulary Restriction: ",! D NFIP(VAPRDIEN) Q:$G(QUIT)
"RTN","PSNACT",114,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",115,0)
 D CPTIER(VAPRDIEN)  ; Copay Tier
"RTN","PSNACT",116,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",117,0)
 I $G(^PSNDF(50.68,VAPRDIEN,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNACT",118,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",119,0)
 D OVEX(VAPRDIEN)
"RTN","PSNACT",120,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",121,0)
 D POSDOS(VAPRDIEN)
"RTN","PSNACT",122,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",123,0)
 W !,"Maximum Days Supply: ",$$GET1^DIQ(50.68,VAPRDIEN,32)
"RTN","PSNACT",124,0)
 W ! D HANG
"RTN","PSNACT",125,0)
 Q
"RTN","PSNACT",126,0)
 ;
"RTN","PSNACT",127,0)
CMOP K DIC S DIC="^PSNDF(50.68,",DIC(0)="QEAZ",D="C",DIC("A")="CMOP ID: ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D MIX^DIC1 Q:Y<0  S IEN=+Y D PRINT(IEN) F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE  D PRNT
"RTN","PSNACT",128,0)
 Q
"RTN","PSNACT",129,0)
HANG K DIR S DIR(0)="E",DIR("A")="Press return to continue or '^' to exit" D ^DIR W @IOF S $X=0 S:Y'=1 QUIT=1
"RTN","PSNACT",130,0)
 Q
"RTN","PSNACT",131,0)
PRNT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)
"RTN","PSNACT",132,0)
 S NDX=^PSNDF(50.67,SIE,0)
"RTN","PSNACT",133,0)
 W !!,"NDC: ",$P(NDX,"^",2),"  UPN: ",$P(NDX,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDX,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDX,"^",4),0)),"^"),"  Trade Name: ",$P(NDX,"^",5),!,"Route: "
"RTN","PSNACT",134,0)
 S SIE1=0 F  S SIE1=$O(^PSNDF(50.67,SIE,1,SIE1)) Q:'SIE1  W $P(^(SIE1,0),"^")
"RTN","PSNACT",135,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDX,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDX,"^",9),0),"^")
"RTN","PSNACT",136,0)
 Q
"RTN","PSNACT",137,0)
PAD S ANS=Y F VV=1:1:3 S VV1=$S(VV=1:6,VV=2:4,VV=3:2) D PAD1
"RTN","PSNACT",138,0)
 S ANS=$P(ANS,"-",1)_$P(ANS,"-",2)_$P(ANS,"-",3) K VV,VV1
"RTN","PSNACT",139,0)
 S ANS=$TR(ANS,"-"),X=ANS
"RTN","PSNACT",140,0)
 Q
"RTN","PSNACT",141,0)
PAD1 I $L($P(ANS,"-",VV))<VV1 S $P(ANS,"-",VV)=$E("0000000",1,VV1-$L($P(ANS,"-",VV)))_$P(ANS,"-",VV)
"RTN","PSNACT",142,0)
 Q
"RTN","PSNACT",143,0)
DT(Y) ;Inactivation Date display
"RTN","PSNACT",144,0)
 X:Y ^DD("DD") Q $S(Y]"":IORVON_" ***INACTIVE: "_Y_" ***"_IORVOFF,1:"")
"RTN","PSNACT",145,0)
 Q
"RTN","PSNACT",146,0)
GCN I QQQ']"" S PMIS="None"
"RTN","PSNACT",147,0)
 I QQQ]"",'$D(^PS(50.623,"B",QQQ)) S PMIS="None"
"RTN","PSNACT",148,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",149,0)
 Q
"RTN","PSNACT",150,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",151,0)
 Q
"RTN","PSNACT",152,0)
 ;
"RTN","PSNACT",153,0)
NDOSE(PSNELXXX) ;New Dose Form/Strength/Unit display added with patch PSN*4*169
"RTN","PSNACT",154,0)
 N PSNELSTL,PSNELUNL,PSNELZER
"RTN","PSNACT",155,0)
 S PSNELZER=$G(^PSNDF(50.68,PSNELXXX,0))
"RTN","PSNACT",156,0)
 I '$P(PSNELZER,"^",3) W !,"Dose Form: "
"RTN","PSNACT",157,0)
 I $P(PSNELZER,"^",3) W !,"Dose Form: ",$P($G(^PS(50.606,+$P(PSNELZER,"^",3),0)),"^")_$S($P($G(^PS(50.606,+$P(PSNELZER,"^",3),1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNACT",158,0)
 S PSNELSTL=$L($P(PSNELZER,"^",4))
"RTN","PSNACT",159,0)
 I $P(PSNELZER,"^",5) S PSNELUNL=$L($P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"))
"RTN","PSNACT",160,0)
 I '$P(PSNELZER,"^",5) S PSNELUNL=0
"RTN","PSNACT",161,0)
 I (PSNELSTL+PSNELUNL)<62 W !,"Strength: ",$P(PSNELZER,"^",4)," Units: ",$S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",162,0)
 W !,"Strength: ",$P(PSNELZER,"^",4)
"RTN","PSNACT",163,0)
 W !,"Units: " I PSNELUNL<72 W $S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",164,0)
 W !,"  "_$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^")
"RTN","PSNACT",165,0)
 Q
"RTN","PSNACT",166,0)
 ;
"RTN","PSNACT",167,0)
OVEX(PSNELORX) ;New Override Dose Form display added with patch PSN*4*169
"RTN","PSNACT",168,0)
 N PSNELDFF
"RTN","PSNACT",169,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNELORX,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1 D
"RTN","PSNACT",170,0)
 .S PSNELDFF=$P($G(^PSNDF(50.68,PSNELORX,0)),"^",3)
"RTN","PSNACT",171,0)
 .I 'PSNELDFF Q
"RTN","PSNACT",172,0)
 .I '$D(^PS(50.606,PSNELDFF,0)) Q
"RTN","PSNACT",173,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNACT",174,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=0 W " (No dosage checks performed)"
"RTN","PSNACT",175,0)
 Q
"RTN","PSNACT",176,0)
CPTIER(VAPRD) ;
"RTN","PSNACT",177,0)
 ; Input: VAPRD - VA PRODUCT (#50.68) entry IEN
"RTN","PSNACT",178,0)
 N CPDATE,X D NOW^%DTC S CPDATE=X S PSNTIER=$$CPTIER^PSNAPIS(VAPRD,CPDATE,"",1) K CPDATE,X
"RTN","PSNACT",179,0)
 ; PSNTIER = Copay Tier^Effective Date^End Date
"RTN","PSNACT",180,0)
 W !,"Copay Tier: ",$P(PSNTIER,"^",1)
"RTN","PSNACT",181,0)
 W !,"Copay Effective Date: " S Y=$P(PSNTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSNACT",182,0)
 W !
"RTN","PSNACT",183,0)
 Q
"RTN","PSNACT",184,0)
EXPAN(PSNELFZA) ;
"RTN","PSNACT",185,0)
 N PSNELFZB,PSNELFZC
"RTN","PSNACT",186,0)
 I $P($G(^PSNDF(50.68,PSNELFZA,7)),"^")="" Q
"RTN","PSNACT",187,0)
 S PSNELFZB=PSNELFZA_"," S PSNELFZC=$$GET1^DIQ(50.68,PSNELFZB,19)
"RTN","PSNACT",188,0)
 W "  "_$G(PSNELFZC)
"RTN","PSNACT",189,0)
 Q
"RTN","PSNACT",190,0)
NFIP(PSNELFJ) ;
"RTN","PSNACT",191,0)
 N PSNELFJZ,PSNELFJC
"RTN","PSNACT",192,0)
 S PSNELFJC=0
"RTN","PSNACT",193,0)
 F PSNELFJZ=0:0 S PSNELFJZ=$O(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ)) Q:'PSNELFJZ!($G(QUIT))  D
"RTN","PSNACT",194,0)
 .I PSNELFJC W !
"RTN","PSNACT",195,0)
 .W $G(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ,0))
"RTN","PSNACT",196,0)
 .S PSNELFJC=1
"RTN","PSNACT",197,0)
 .D:($Y+5)>IOSL HANG
"RTN","PSNACT",198,0)
 I '$G(QUIT),$G(PSNELFJC) W !
"RTN","PSNACT",199,0)
 Q
"RTN","PSNACT",200,0)
 ;
"RTN","PSNACT",201,0)
POSDOS(VAPRD) ; Dispaly Possible Dosage Auto-Create Setting fields
"RTN","PSNACT",202,0)
 ; Input: VAPRD - VA PRODUCT (#50.68) entry IEN
"RTN","PSNACT",203,0)
 ;
"RTN","PSNACT",204,0)
 N POSDOS Q:'$G(VAPRD)
"RTN","PSNACT",205,0)
 S POSDOS=$$POSDOS^PSNAPIS(VAPRD)
"RTN","PSNACT",206,0)
 W !!,"Auto-Create Default Possible Dosage? ",$S($P(POSDOS,"^")="Y":"Yes",1:"No")
"RTN","PSNACT",207,0)
 I $P(POSDOS,"^")="N" D
"RTN","PSNACT",208,0)
 . W !,"    Possible Dosages To Auto-Create: ",$S($P(POSDOS,"^",2)="N":"No Possible Dosages",$P(POSDOS,"^",2)="O":"1x Possible Dosage",$P(POSDOS,"^",2)="B":"1x and 2x Possible Dosages",1:"")
"RTN","PSNACT",209,0)
 . I ($P(POSDOS,"^",2)'="N") D
"RTN","PSNACT",210,0)
 . . W !,"                            Package: ",$S($P(POSDOS,"^",3)="O":"Outpatient",$P(POSDOS,"^",3)="I":"Inpatient",$P(POSDOS,"^",3)="IO":"Both Inpatient and Outpatient",1:"")
"RTN","PSNACT",211,0)
 Q
"RTN","PSNACT",212,0)
 ;
"RTN","PSNACT",213,0)
GETTIERN(PSNCTNDC) ;Get copay tier by NDC; called by DIC to get copay tier for today's date 
"RTN","PSNACT",214,0)
 N CPDATE,X,PSSCP,VAPID,VAPNAM,PSNINACT,PSNCONVD D NOW^%DTC S CPDATE=X
"RTN","PSNACT",215,0)
 D NOW^%DTC S CPDATE=%
"RTN","PSNACT",216,0)
 S VAPID=$$GET1^DIQ(50.67,PSNCTNDC,5,"I")
"RTN","PSNACT",217,0)
 I PROMPT="UPN"!(PROMPT="NDC") S VAPNAM=$$GET1^DIQ(50.68,VAPID,.01) W "  ",VAPNAM
"RTN","PSNACT",218,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPID,CPDATE) K CPDATE,X
"RTN","PSNACT",219,0)
 I $P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSNACT",220,0)
 S PSNINACT=$$GET1^DIQ(50.67,PSNCTNDC,7,"I")  ;inactive date
"RTN","PSNACT",221,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE^PSNLOOK(PSNINACT)
"RTN","PSNACT",222,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNACT",223,0)
 Q
"RTN","PSNACT",224,0)
 ;
"RTN","PSNACT",225,0)
GETTIER(PSNTDRUG) ;called by DIC; look up copay tier by va product for the current date 
"RTN","PSNACT",226,0)
 N CPDATE,X,PSSCP,PSNINACT,PSNCONVD D NOW^%DTC S CPDATE=X
"RTN","PSNACT",227,0)
 D NOW^%DTC S CPDATE=%
"RTN","PSNACT",228,0)
 S PSSCP=$$CPTIER^PSNAPIS(PSNTDRUG,CPDATE,"",1) K CPDATE,X
"RTN","PSNACT",229,0)
 I $P(PSSCP,"^")'="" W " Tier ",$P(PSSCP,"^")
"RTN","PSNACT",230,0)
 S PSNINACT=$$GET1^DIQ(50.68,PSNTDRUG,21,"I")  ;inactive date
"RTN","PSNACT",231,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE^PSNLOOK(PSNINACT)
"RTN","PSNACT",232,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNACT",233,0)
 Q
"RTN","PSNAPIS")
0^7^B93408219
"RTN","PSNAPIS",1,0)
PSNAPIS ;BIR/DMA-APIs for NDF ; 27 Jan 2010  7:44 AM
"RTN","PSNAPIS",2,0)
 ;;4.0;NATIONAL DRUG FILE;**2,3,47,70,169,108,262,296,448,492**; 30 Oct 98;Build 27
"RTN","PSNAPIS",3,0)
 ;
"RTN","PSNAPIS",4,0)
 ;Reference to ^PSDRUG supported by DBIA #2192
"RTN","PSNAPIS",5,0)
 ;Reference to ^PS(50.606 supported by DBIA #2174
"RTN","PSNAPIS",6,0)
 ;Reference to $$PROD0^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSNAPIS",7,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSNAPIS",8,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSNAPIS",9,0)
 ;Reference to ^XTMP supported by DBIA #4770
"RTN","PSNAPIS",10,0)
 ;Referenct to ^PSS50 supported by DBIA #4483
"RTN","PSNAPIS",11,0)
 ;
"RTN","PSNAPIS",12,0)
PSA(NDC,LIST) ;ENTRY FOR DRUG ACCOUNTABILITY
"RTN","PSNAPIS",13,0)
 N Y,PN,PN1,P50,J
"RTN","PSNAPIS",14,0)
 S Y=$Q(^PSNDF(50.67,"NDC",NDC)) I $QS(Y,3)'=NDC Q 0
"RTN","PSNAPIS",15,0)
 S Y=^PSNDF(50.67,$QS(Y,4),0),Y=$P(Y,"^",6),PN=$P(^PSNDF(50.68,Y,0),"^"),PN1=$E(PN,1,30)
"RTN","PSNAPIS",16,0)
 S P50=0,J=0 F  S P50=$O(^PSDRUG("VAPN",PN1,P50)) Q:'P50  I $P(^PSDRUG(P50,"ND"),"^",2)=PN S LIST(P50)=$P(^PSDRUG(P50,0),"^"),J=J+1
"RTN","PSNAPIS",17,0)
 Q J
"RTN","PSNAPIS",18,0)
 ;
"RTN","PSNAPIS",19,0)
PSJING(DA1,K,LIST) ;ENTRY FOR INGREDIENTS
"RTN","PSNAPIS",20,0)
 N X,CT
"RTN","PSNAPIS",21,0)
 ;DA1 IS SUPERFLUOUS, BUT WE LEAVE IN FOR COMPATABILITY
"RTN","PSNAPIS",22,0)
 I 'K!('$D(^PSNDF(50.68,+K))) Q 0
"RTN","PSNAPIS",23,0)
 S DA=0 F CT=0:1 S DA=$O(^PSNDF(50.68,K,2,DA)) Q:'DA  S X=^(DA,0),LIST(+X)=+X_"^"_$P(^PS(50.416,+X,0),"^")_"^"_$P(X,"^",2)_"^" S:$P(X,"^",3)]"" LIST(+X)=LIST(+X)_$P($G(^PS(50.607,$P(X,"^",3),0)),"^")
"RTN","PSNAPIS",24,0)
 Q CT
"RTN","PSNAPIS",25,0)
 ;
"RTN","PSNAPIS",26,0)
PSJDF(DA,K) ;GET DOSE FORM
"RTN","PSNAPIS",27,0)
 N X,DF
"RTN","PSNAPIS",28,0)
 ;AGAIN DA IS SUPERFLUOUS
"RTN","PSNAPIS",29,0)
 I 'K!('$D(^PSNDF(50.68,+K))) Q 0
"RTN","PSNAPIS",30,0)
 S X=$P(^PSNDF(50.68,K,0),"^",3),DF=$P($G(^PS(50.606,X,0)),"^")
"RTN","PSNAPIS",31,0)
 Q X_"^"_DF
"RTN","PSNAPIS",32,0)
 ;
"RTN","PSNAPIS",33,0)
PSJST(DA,K) ;ENTRY FOR STRENGTH
"RTN","PSNAPIS",34,0)
 I 'K!('$D(^PSNDF(50.68,K))) Q 0
"RTN","PSNAPIS",35,0)
 Q 1_"^"_$P(^PSNDF(50.68,K,0),"^",4)
"RTN","PSNAPIS",36,0)
 ;
"RTN","PSNAPIS",37,0)
CLASS(CL) ;ENTRY FOR OE/RR TO GET CLASS $D
"RTN","PSNAPIS",38,0)
 I CL']"" Q 0
"RTN","PSNAPIS",39,0)
 Q $D(^PS(50.605,"C",CL))>0
"RTN","PSNAPIS",40,0)
 ;
"RTN","PSNAPIS",41,0)
DRUG(DA) ;ENTRY FOR OE/RR TO GET DRUG $D
"RTN","PSNAPIS",42,0)
 I DA']"" Q 0
"RTN","PSNAPIS",43,0)
 Q $D(^PSNDF(50.6,"B",DA))!$D(^PSNDF(50.67,"T",DA))
"RTN","PSNAPIS",44,0)
 ;
"RTN","PSNAPIS",45,0)
PROD0(P1,P2) ;GET INFO IN THE FORM OF THE OLD 0 PRODUCT NODE
"RTN","PSNAPIS",46,0)
 N A,B
"RTN","PSNAPIS",47,0)
 ;P1 IS SUPERFLUOUS
"RTN","PSNAPIS",48,0)
 I P2']"" Q ""
"RTN","PSNAPIS",49,0)
 S A=$G(^PSNDF(50.68,P2,0)),B=$G(^(1))
"RTN","PSNAPIS",50,0)
 Q $P(A,"^")_"^"_$P(A,"^",3,5)_"^^^"_$P(B,"^",5,6)
"RTN","PSNAPIS",51,0)
 ;
"RTN","PSNAPIS",52,0)
PROD2(P1,P2) ;GET OLD 2 NODE
"RTN","PSNAPIS",53,0)
 ;P1 STILL SUPERFLUOUS
"RTN","PSNAPIS",54,0)
 I P2']"" Q ""
"RTN","PSNAPIS",55,0)
 Q $P($G(^PSNDF(50.68,P2,1)),"^",1,3)_"^"_$P($G(^PSNDF(50.64,+$P(^PSNDF(50.68,P2,1),"^",4),0)),"^")
"RTN","PSNAPIS",56,0)
 ;
"RTN","PSNAPIS",57,0)
DCLASS(DA,K) ;GET CLASS FOR PRODUCT
"RTN","PSNAPIS",58,0)
 I K']"" Q ""
"RTN","PSNAPIS",59,0)
 S X=+$P($G(^PSNDF(50.68,+K,3)),"^"),Y=$P($G(^PS(50.605,X,0)),"^",2)
"RTN","PSNAPIS",60,0)
 Q X_"^"_Y
"RTN","PSNAPIS",61,0)
 ;
"RTN","PSNAPIS",62,0)
DCLCODE(DA,K) ;RETURN VA CLASS CODE
"RTN","PSNAPIS",63,0)
 I K']"" Q ""
"RTN","PSNAPIS",64,0)
 S X=+$P($G(^PSNDF(50.68,+K,3)),"^"),X=$P($G(^PS(50.605,X,0)),"^")
"RTN","PSNAPIS",65,0)
 Q X
"RTN","PSNAPIS",66,0)
 ;
"RTN","PSNAPIS",67,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",68,0)
VAGN(DA) ;GET VA GENERIC NAME
"RTN","PSNAPIS",69,0)
 I 'DA!'$D(^PSNDF(50.6,+DA,0)) Q 0
"RTN","PSNAPIS",70,0)
 Q $P(^PSNDF(50.6,+DA,0),"^")
"RTN","PSNAPIS",71,0)
 ;
"RTN","PSNAPIS",72,0)
FORMI(DA,K) ;GET FORMULARY INDICATOR FOR VA PRODUCT
"RTN","PSNAPIS",73,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",74,0)
 ;1 if yes, 0 if no, null if not entered
"RTN","PSNAPIS",75,0)
 Q $P($G(^PSNDF(50.68,+K,5)),"^")
"RTN","PSNAPIS",76,0)
 ;
"RTN","PSNAPIS",77,0)
FORMR(DA,K) ;GET EXISTENCE OF FORMULARY RESTRICTIONS
"RTN","PSNAPIS",78,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",79,0)
 Q $O(^PSNDF(50.68,+K,6,0))]""
"RTN","PSNAPIS",80,0)
 ;
"RTN","PSNAPIS",81,0)
DFSU(DA,K) ;RETURN DOSE FORM, STRENGTH, AND UNITS FOR PDM AND CPRS
"RTN","PSNAPIS",82,0)
 N U1,UN
"RTN","PSNAPIS",83,0)
 I 'K!('$D(^PSNDF(50.68,+K,0))) Q 0
"RTN","PSNAPIS",84,0)
 S U1=+$P(^PSNDF(50.68,+K,0),"^",5),UN=$P($G(^PS(50.607,U1,0)),"^")
"RTN","PSNAPIS",85,0)
 Q $$PSJDF(DA,K)_"^"_$$PSJST(DA,K)_"^"_U1_"^"_UN
"RTN","PSNAPIS",86,0)
 ;
"RTN","PSNAPIS",87,0)
VAP(DA,LIST) ;GIVEN GENERIC RETURN ARRAY LIST(IEN)=IEN^PRODUCT^DF PTR^DOSE FOMR^CLIEN^CLASS^INACTIVE^TIER
"RTN","PSNAPIS",88,0)
 N PR,J,X,DAT
"RTN","PSNAPIS",89,0)
 I 'DA!'$D(^PSNDF(50.6,+DA)) Q 0
"RTN","PSNAPIS",90,0)
 S PR=0,J=0 F  S PR=$O(^PSNDF(50.6,"APRO",DA,PR)) Q:'PR  S X=^PSNDF(50.68,PR,0),DAT=$P($G(^(7)),"^",3) D
"RTN","PSNAPIS",91,0)
 .S LIST(PR)=PR_"^"_$P(X,"^")_"^"_$P(X,"^",3)_"^"_$P($G(^PS(50.606,+$P(X,"^",3),0)),"^")_"^"_$P(^PSNDF(50.68,PR,3),"^")_"^"_$P($G(^PS(50.605,+$P(^PSNDF(50.68,PR,3),"^"),0)),"^"),J=J+1 I DAT,(DAT<DT) S LIST(PR)=LIST(PR)_"^I"
"RTN","PSNAPIS",92,0)
 . N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".")
"RTN","PSNAPIS",93,0)
 . S PSSTIER=$$CPTIER^PSNAPIS(PR,CPDATE,"",1),$P(LIST(PR),"^",8)="Tier "_$P(PSSTIER,"^",1) K CPDATE,%,X,PSSTIER
"RTN","PSNAPIS",94,0)
 Q J
"RTN","PSNAPIS",95,0)
 ;
"RTN","PSNAPIS",96,0)
PSPT(DA,K,LIST) ;GIVEN PRODUCT K RETURN LIST(INE1^IEN2)=IEN1^PSIZE^IEN1^PTYPE
"RTN","PSNAPIS",97,0)
 N NDC,J,PT,PS
"RTN","PSNAPIS",98,0)
 ;DA SUPERFLUOUS
"RTN","PSNAPIS",99,0)
 I 'K!'$D(^PSNDF(50.68,+K)) Q 0
"RTN","PSNAPIS",100,0)
 S NDC=0 F J=0:1 S NDC=$O(^PSNDF(50.68,"ANDC",K,NDC)) Q:'NDC  S X=^PSNDF(50.67,NDC,0),PS=$P(X,"^",8),PT=$P(X,"^",9),LIST(PS_"^"_PT)=PS_"^"_$P($G(^PS(50.609,PS,0)),"^")_"^"_PT_"^"_$P($G(^PS(50.608,PT,0)),"^")
"RTN","PSNAPIS",101,0)
 Q J
"RTN","PSNAPIS",102,0)
 ;
"RTN","PSNAPIS",103,0)
DSS(DA,K,DATE) ;RETURN DSS FEEDER KEY
"RTN","PSNAPIS",104,0)
 ;NEW STYLE IF DATE IS MISSING OR NOT LESS THAN 199810
"RTN","PSNAPIS",105,0)
 ;OLD STYLE OTHERWISE
"RTN","PSNAPIS",106,0)
 S DATE=$G(DATE,999999)
"RTN","PSNAPIS",107,0)
 I DATE'<199810 Q $S($D(^PSNDF(50.68,+K)):$$RJ^XLFSTR(K,5,0),1:"00000")
"RTN","PSNAPIS",108,0)
 I $D(^PSNDF(50.6,+DA)),$D(^PSNDF(50.68,+K,7)) Q $$RJ^XLFSTR(DA,4,0)_$$RJ^XLFSTR($P(^PSNDF(50.68,+K,7),"^",9),3,0)
"RTN","PSNAPIS",109,0)
 Q "0000000"
"RTN","PSNAPIS",110,0)
 ;
"RTN","PSNAPIS",111,0)
CPRS(DA,K) ;CALL FOR CPRS
"RTN","PSNAPIS",112,0)
 N CL,X,DF,ST,UN
"RTN","PSNAPIS",113,0)
 ;RETURNS X=DOSE FORM^CLASS^STRENGTH^UNITS
"RTN","PSNAPIS",114,0)
 I '$D(^PSNDF(50.68,+K)) Q 0
"RTN","PSNAPIS",115,0)
 S CL=$P($G(^PS(50.605,+$P(^PSNDF(50.68,K,3),"^"),0)),"^")
"RTN","PSNAPIS",116,0)
 S X=^PSNDF(50.68,K,0),DF=+$P(X,"^",3),ST=$P(X,"^",4),UN=+$P(X,"^",5)
"RTN","PSNAPIS",117,0)
 Q $P($G(^PS(50.606,DF,0)),"^")_"^"_CL_"^"_ST_"^"_$P($G(^PS(50.607,UN,0)),"^")
"RTN","PSNAPIS",118,0)
 ;
"RTN","PSNAPIS",119,0)
CIRN(NDC,LIST) ;CALL FOR CIRN
"RTN","PSNAPIS",120,0)
 N DA,X,A
"RTN","PSNAPIS",121,0)
 I NDC["-" S NDC=$$RJ^XLFSTR($P(NDC,"-"),6,0)_$$RJ^XLFSTR($P(NDC,"-",2),4,0)_$$RJ^XLFSTR($P(NDC,"-",3),2,0)
"RTN","PSNAPIS",122,0)
 K LIST S LIST="000000000000" F J=1:1:7 S LIST(J)=""
"RTN","PSNAPIS",123,0)
 S DA=$O(^PSNDF(50.67,"NDC",NDC,0)) Q:'DA  S X=^PSNDF(50.67,DA,0),LIST(7)=$P(X,"^",2)_"^"_$P(X,"^",4,6)_"^",A=0 F  S A=$O(^PSNDF(50.67,DA,1,A)) Q:'A  S LIST(7)=LIST(7)_^(A,0)_" "
"RTN","PSNAPIS",124,0)
 S LIST(6)=$P(X,"^",9),LIST(5)=$P(X,"^",8),A=$P(X,"^",6),X=^PSNDF(50.68,A,0)
"RTN","PSNAPIS",125,0)
  S LIST(2)=$P(X,"^",3)_"^^"_$P(^PSNDF(50.68,A,3),"^"),LIST(3)=$P(X,"^",4),LIST(4)=$P(X,"^",5)
"RTN","PSNAPIS",126,0)
 S LIST(0)=$P(X,"^",2),LIST(1)=^PSNDF(50.6,$P(X,"^",2),0),LIST=NDC
"RTN","PSNAPIS",127,0)
 F J=1:1:7 I LIST(J)="NO DATA" S LIST(J)=""
"RTN","PSNAPIS",128,0)
 Q
"RTN","PSNAPIS",129,0)
 ;
"RTN","PSNAPIS",130,0)
B() ;RETURNS THE GLOBAL ROOT OF THE "B" CROSSREFERENCE IN NDF
"RTN","PSNAPIS",131,0)
 Q "^PSNDF(50.6,""B"")"
"RTN","PSNAPIS",132,0)
 ;
"RTN","PSNAPIS",133,0)
T() ;RETURNS THE GLOBAL ROOT OF THE "T" CROSSREFERENCE IN NDF
"RTN","PSNAPIS",134,0)
 Q "^PSNDF(50.67,""T"")"
"RTN","PSNAPIS",135,0)
 ;
"RTN","PSNAPIS",136,0)
TTOG(TRADE,LIST) ;RETURNS LIST(IEN)=IEN_"^"GENERIC FOR EVERY ENTRY IN 50.6 WHICH MATCHES THE TRADE NAME
"RTN","PSNAPIS",137,0)
 I TRADE="" Q 0
"RTN","PSNAPIS",138,0)
 N X,CT
"RTN","PSNAPIS",139,0)
 I '$O(^PSNDF(50.67,"T",TRADE,0)) Q 0
"RTN","PSNAPIS",140,0)
 S (X,CT)=0 F  S X=$O(^PSNDF(50.67,"T",TRADE,X)) Q:'X  S Y=$P(^PSNDF(50.67,X,0),"^",6),Y=$P(^PSNDF(50.68,Y,0),"^",2) I '$D(LIST(Y)) S LIST(Y)=Y_"^"_$P(^PSNDF(50.6,Y,0),"^"),CT=CT+1
"RTN","PSNAPIS",141,0)
 Q CT
"RTN","PSNAPIS",142,0)
 ;
"RTN","PSNAPIS",143,0)
CLIST(DA,LIST) ;RETURNS LIST(IEN)=IEN IN 50.605^CLASS CODE
"RTN","PSNAPIS",144,0)
 ;FOR EVERY CLASS IN PSNDF(50.6,DA)
"RTN","PSNAPIS",145,0)
 I 'DA Q 0
"RTN","PSNAPIS",146,0)
 I '$D(^PSNDF(50.6,+DA)) Q 0
"RTN","PSNAPIS",147,0)
 N K,CT S (K,CT)=0 F  S K=$O(^PSNDF(50.6,"APRO",DA,K)) Q:'K  S IEN=$P(^PSNDF(50.68,K,3),"^") I '$D(LIST(IEN)) S LIST(IEN)=IEN_"^"_$P(^PS(50.605,IEN,0),"^"),CT=CT+1
"RTN","PSNAPIS",148,0)
 Q CT
"RTN","PSNAPIS",149,0)
 ;
"RTN","PSNAPIS",150,0)
TGTOG(NAME) ;GIVEN NAME TRY TO FIND IT IN T OR B CROSS REFERENCE AND RETURN IEN
"RTN","PSNAPIS",151,0)
 N X
"RTN","PSNAPIS",152,0)
 I NAME="" Q 0
"RTN","PSNAPIS",153,0)
 S X=$O(^PSNDF(50.6,"B",NAME,0)) I X Q X
"RTN","PSNAPIS",154,0)
 I '$O(^PSNDF(50.67,"T",NAME,0)) Q 0
"RTN","PSNAPIS",155,0)
 S X=$O(^PSNDF(50.67,"T",NAME,0)),X=$P(^PSNDF(50.67,X,0),"^",6),X=$P(^PSNDF(50.68,X,0),"^",2) Q X
"RTN","PSNAPIS",156,0)
 ;
"RTN","PSNAPIS",157,0)
TGTOG2(NAME,LIST) ;PARTIAL LOOKUP ON T OR B
"RTN","PSNAPIS",158,0)
 I NAME="" Q
"RTN","PSNAPIS",159,0)
 N NAM,X,Y,CT
"RTN","PSNAPIS",160,0)
 S CT=0
"RTN","PSNAPIS",161,0)
 S NAM=$E(NAME,1,$L(NAME)-1)_$C($A($E(NAME,$L(NAME)))-1)_"z" F  S NAM=$O(^PSNDF(50.6,"B",NAM)),X=0 Q:NAM'[NAME  F  S X=$O(^PSNDF(50.6,"B",NAM,X)) Q:'X  S LIST(X)=X_"^"_$P(^PSNDF(50.6,X,0),"^"),CT=CT+1
"RTN","PSNAPIS",162,0)
 S NAM=$E(NAME,1,$L(NAME)-1)_$C($A($E(NAME,$L(NAME)))-1)_"z" F  S NAM=$O(^PSNDF(50.67,"T",NAM)),X=0 Q:NAM'[NAME  F  S X=$O(^PSNDF(50.67,"T",NAM,X)) Q:'X  S Y=$P(^PSNDF(50.67,X,0),"^",6),Y=$P(^PSNDF(50.68,Y,0),"^",2) D
"RTN","PSNAPIS",163,0)
 .I '$D(LIST(Y)) S LIST(Y)=Y_"^"_$P(^PSNDF(50.6,Y,0),"^"),CT=CT+1
"RTN","PSNAPIS",164,0)
 Q CT
"RTN","PSNAPIS",165,0)
 ;
"RTN","PSNAPIS",166,0)
CIRN2(P1,P3,LIST) ;RETURN LIST OF NDCS FOR A PRODUCT
"RTN","PSNAPIS",167,0)
 I 'P3 Q 0
"RTN","PSNAPIS",168,0)
 I '$D(^PSNDF(50.68,+P3)) Q 0
"RTN","PSNAPIS",169,0)
 N D,N,J
"RTN","PSNAPIS",170,0)
 S N=0
"RTN","PSNAPIS",171,0)
 F J=0:1 S N=$O(^PSNDF(50.68,"ANDC",P3,N)) Q:'N  S LIST(J)=$P(^PSNDF(50.67,N,0),"^",2)
"RTN","PSNAPIS",172,0)
 Q J
"RTN","PSNAPIS",173,0)
 ;
"RTN","PSNAPIS",174,0)
CLASS2(IEN) ;RETURNS FIRST 2 PIECES OF ZERO NODE OF 50.605
"RTN","PSNAPIS",175,0)
 Q $P($G(^PS(50.605,+IEN,0)),"^",1,2)
"RTN","PSNAPIS",176,0)
 ;
"RTN","PSNAPIS",177,0)
CMOP(CODE) ;CODE = 5 CHARACTER CMOP CODE RETURNS PRODUCT NAME
"RTN","PSNAPIS",178,0)
 I CODE="" Q ""
"RTN","PSNAPIS",179,0)
 I '$O(^PSNDF(50.68,"C",CODE,0)) Q ""
"RTN","PSNAPIS",180,0)
 Q $P(^PSNDF(50.68,+$O(^PSNDF(50.68,"C",CODE,0)),0),"^")
"RTN","PSNAPIS",181,0)
 ;
"RTN","PSNAPIS",182,0)
FORMRX(DA,K,LIST) ;RETURN X=1 FOR RESTRICTIONS, 0 FOR NO
"RTN","PSNAPIS",183,0)
 ;RETURNS LIST=WORD PROCESSING FIELD FOR RESTRICTIONS
"RTN","PSNAPIS",184,0)
 ;
"RTN","PSNAPIS",185,0)
 I '$O(^PSNDF(50.68,+K,6,0)) Q 0
"RTN","PSNAPIS",186,0)
 M LIST=^PSNDF(50.68,+K,6) Q 1
"RTN","PSNAPIS",187,0)
 ;
"RTN","PSNAPIS",188,0)
DDIEX(DA,K) ;RETURN X=1 FOR EXCLUDE DDI CHECK, 0 FOR CONTINUE DDI CHECK
"RTN","PSNAPIS",189,0)
 ;
"RTN","PSNAPIS",190,0)
 I '$G(^PSNDF(50.68,+K,8)) Q 0
"RTN","PSNAPIS",191,0)
 I $G(^PSNDF(50.68,+K,8)) Q 1
"RTN","PSNAPIS",192,0)
 ;
"RTN","PSNAPIS",193,0)
OVRIDE(PSNPOV1,PSNPOV3) ;Return Override Dose Form Exclusion
"RTN","PSNAPIS",194,0)
 I '$G(PSNPOV3) Q ""
"RTN","PSNAPIS",195,0)
 Q $P($G(^PSNDF(50.68,+PSNPOV3,9)),"^")
"RTN","PSNAPIS",196,0)
 ;
"RTN","PSNAPIS",197,0)
FDAMG(IEN) ;RETURN URL FOR MED GUIDE OR NULL
"RTN","PSNAPIS",198,0)
 Q $P($G(^PSNDF(50.68,IEN,"MG")),"^")
"RTN","PSNAPIS",199,0)
 ;
"RTN","PSNAPIS",200,0)
POSDOS(IEN) ; Return Possible Dosage Auto-Creation Related fields
"RTN","PSNAPIS",201,0)
 ; Input: IEN - VA Product (#50.68) IEN
"RTN","PSNAPIS",202,0)
 ;Output: Possible Dosage Creation field (separated by "^")
"RTN","PSNAPIS",203,0)
 ;           1. CREATE DEFAULT POSSIBLE DOSAGE (Y/N) - Field #40
"RTN","PSNAPIS",204,0)
 ;           2. POSSIBLE DOSAGES TO CREATE (N/O/B) - Field #41
"RTN","PSNAPIS",205,0)
 ;           3. PACKAGE (I/O/IO) - Field #42
"RTN","PSNAPIS",206,0)
 ;
"RTN","PSNAPIS",207,0)
 Q $G(^PSNDF(50.68,IEN,"DOS"))
"RTN","PSNAPIS",208,0)
 ;
"RTN","PSNAPIS",209,0)
INTRAN(SCR) ; input transform lookup for fields that store NDC codes
"RTN","PSNAPIS",210,0)
 ; Input: SCR - (optional) M code for value of DIC("S") - If SCR is not
"RTN","PSNAPIS",211,0)
 ;              defined, all active entries will be returned
"RTN","PSNAPIS",212,0)
 ;
"RTN","PSNAPIS",213,0)
 ; Output: The variable X will be returned if input is valid. If no valid
"RTN","PSNAPIS",214,0)
 ;         input is available, X will be not be returned.
"RTN","PSNAPIS",215,0)
 ;
"RTN","PSNAPIS",216,0)
 N D,DIC,Y
"RTN","PSNAPIS",217,0)
 S DIC("S")="I $P(^(0),U,7)=""""!($P(^(0),U,7)>DT)"
"RTN","PSNAPIS",218,0)
 I $G(SCR)'="" S DIC("S")=SCR
"RTN","PSNAPIS",219,0)
 S DIC="^PSNDF(50.67,",DIC(0)="EMQZ"
"RTN","PSNAPIS",220,0)
 S D="A" D IX^DIC
"RTN","PSNAPIS",221,0)
 I +$G(Y)>0 S X=$P(Y(0),"^",2)
"RTN","PSNAPIS",222,0)
 I $G(Y)=-1 K X
"RTN","PSNAPIS",223,0)
 Q
"RTN","PSNAPIS",224,0)
 ;
"RTN","PSNAPIS",225,0)
DRGCLS(IEN) ; return class and parent class for NDC
"RTN","PSNAPIS",226,0)
 ; Input: IEN - (required) internal entry number of NDC in file 50.67
"RTN","PSNAPIS",227,0)
 ; 
"RTN","PSNAPIS",228,0)
 ; Output: Drug Class code^Parent Class
"RTN","PSNAPIS",229,0)
 N PSNP,PSNDC,PSNCLS
"RTN","PSNAPIS",230,0)
 S PSNCLS=""
"RTN","PSNAPIS",231,0)
 S PSNP=$P($G(^PSNDF(50.67,IEN,0)),"^",6) Q:'PSNP PSNCLS
"RTN","PSNAPIS",232,0)
 S PSNDC=$P($G(^PSNDF(50.68,PSNP,3)),"^") Q:'PSNDC PSNCLS
"RTN","PSNAPIS",233,0)
 S PSNCLS=$$GET1^DIQ(50.605,PSNDC,.01)_"^"_$$GET1^DIQ(50.605,PSNDC,2)
"RTN","PSNAPIS",234,0)
 Q PSNCLS
"RTN","PSNAPIS",235,0)
 ;
"RTN","PSNAPIS",236,0)
QLIST(SCR) ; executable help ("?" or "??") for fields that store NDC codes
"RTN","PSNAPIS",237,0)
 ; Input: SCR - (optional) M code for value of DIC("S") - If SCR is not
"RTN","PSNAPIS",238,0)
 ;              defined, all active entries will be returned
"RTN","PSNAPIS",239,0)
 N D,DIC,DO,X
"RTN","PSNAPIS",240,0)
 S DIC("S")="I $P(^(0),U,7)=""""!($P(^(0),U,7)>DT)"
"RTN","PSNAPIS",241,0)
 I $G(SCR)'="" S DIC("S")=SCR
"RTN","PSNAPIS",242,0)
 S X="?",DIC="^PSNDF(50.67,",DIC(0)="EQS",D="NDC"
"RTN","PSNAPIS",243,0)
 D IX^DIC
"RTN","PSNAPIS",244,0)
 Q
"RTN","PSNAPIS",245,0)
 ;
"RTN","PSNAPIS",246,0)
CPTIER(VAPIEN,DATE,PSNDRIEN,PSNCINQS) ; RETURN COPAY TIER INFORMATION (FMCT)
"RTN","PSNAPIS",247,0)
 ;Input: VAPIEN - VA Product (#50.68) IEN
"RTN","PSNAPIS",248,0)
 ;         DATE - Date to be verified for Copay Tier
"RTN","PSNAPIS",249,0)
 ;      PSNDRIEN - Drug file (#50) IEN.
"RTN","PSNAPIS",250,0)
 ;      PSNCINQS - 1 if an inquiry screen, null if called by IB
"RTN","PSNAPIS",251,0)
 ; The VAPIEN and/or the PSNDRIEN may be passed; however, the PSNDRIEN takes precedence.
"RTN","PSNAPIS",252,0)
 ; If the PSNDRIEN variable isn't defined, the VAPIEN IEN will be processed.
"RTN","PSNAPIS",253,0)
 ;
"RTN","PSNAPIS",254,0)
 ;Output: Tier^Effective Date^End Date
"RTN","PSNAPIS",255,0)
 ;
"RTN","PSNAPIS",256,0)
 ;*************************************************************************************************
"RTN","PSNAPIS",257,0)
 ;** Copay Tier Business Rules:  (DO NOT REMOVE)
"RTN","PSNAPIS",258,0)
 ;   - Pharmacy Product System - National (PPS-N) is used to define copay tier information.
"RTN","PSNAPIS",259,0)
 ;   - A check for the DEA special Handling code for the drug is an additional check made 
"RTN","PSNAPIS",260,0)
 ;     in Pharmacy to determine if a drug is exempt from copay. The copay exempt DEA codes 
"RTN","PSNAPIS",261,0)
 ;     are: I = Investigational Drug, N = Nutritional Supplement and S for Supply Item.
"RTN","PSNAPIS",262,0)
 ;
"RTN","PSNAPIS",263,0)
 ;   Copay Tier determination criteria:
"RTN","PSNAPIS",264,0)
 ;   1. For NDF and PDM display screens (i.e. PSNACT, PSNLOOK, PSSDEE, PSS LOOK), this API
"RTN","PSNAPIS",265,0)
 ;      will return null if the copay tier is not defined or will return the defined copay tier
"RTN","PSNAPIS",266,0)
 ;      for the given date. If the drug is not matched to NDF, null is returned.  If the tier is 
"RTN","PSNAPIS",267,0)
 ;      null, the selection of drug or product screens will not display the Tier field; however,
"RTN","PSNAPIS",268,0)
 ;      the body of the display will show the Tier and effective date as null.
"RTN","PSNAPIS",269,0)
 ;        
"RTN","PSNAPIS",270,0)
 ;   2. If the DEA Special Handling Code is exempt from copay and regardless of the copay 
"RTN","PSNAPIS",271,0)
 ;      tier value, this API will return zero.  OP will not call IB for billing. The DEA Special
"RTN","PSNAPIS",272,0)
 ;      Handling Code overrides the nationally defined copay tier. 
"RTN","PSNAPIS",273,0)
 ;
"RTN","PSNAPIS",274,0)
 ;   3. The product is matched to NDF:
"RTN","PSNAPIS",275,0)
 ;      a. If the copay tier is 1, 2, or 3 and the DEA code is NOT exempt from copay, this 
"RTN","PSNAPIS",276,0)
 ;         API will return the defined copay tier.  OP will call IB to charge copay. Copay
"RTN","PSNAPIS",277,0)
 ;         will be charged based on the tier defined.
"RTN","PSNAPIS",278,0)
 ;      b. If the copay tier is 0 (zero), this API will return 0 (zero).  OP will not call
"RTN","PSNAPIS",279,0)
 ;         IB to charge copay. 
"RTN","PSNAPIS",280,0)
 ;      c. If no copay tier is defined and the product is NOT exempt from copay, this API 
"RTN","PSNAPIS",281,0)
 ;         will return null.  OP will call IB to charge copay and IB will default the copay
"RTN","PSNAPIS",282,0)
 ;         tier to 2.
"RTN","PSNAPIS",283,0)
 ;
"RTN","PSNAPIS",284,0)
 ;   4. The product is not matched to NDF:
"RTN","PSNAPIS",285,0)
 ;      a. If the DEA special handling code is NOT exempt from copay, this API will return
"RTN","PSNAPIS",286,0)
 ;         null.  OP will call IB to charge copay.  IB will default to copay tier 2 then 
"RTN","PSNAPIS",287,0)
 ;         charge copay.
"RTN","PSNAPIS",288,0)
 ;
"RTN","PSNAPIS",289,0)
 ;   5. The copay tier does not have a rate defined in IB, this API will return the defined copay
"RTN","PSNAPIS",290,0)
 ;      tier. OP will call IB to charge copay and IB will default to tier 2 and charge copay.
"RTN","PSNAPIS",291,0)
 ;*************************************************************************************************
"RTN","PSNAPIS",292,0)
 ;
"RTN","PSNAPIS",293,0)
 N FLG,I,II,CPTIER,EFFDT,ENDDT,TIER,RETTIER,RETURN,DEASH,DEA,DEAFLG,PSOTIERE
"RTN","PSNAPIS",294,0)
 S:'$G(PSNCINQS) PSNCINQS=""
"RTN","PSNAPIS",295,0)
 S RETURN=""
"RTN","PSNAPIS",296,0)
 ;SQA TESTING ONLY - S ^XTMP("PSOTIEREFTST",0)="3201231^3170227^FOR SQA TESTING ONLY"
"RTN","PSNAPIS",297,0)
 D NOW^%DTC N PSOTIERE
"RTN","PSNAPIS",298,0)
 S PSOTIERE=1  ;use copay tiers - new
"RTN","PSNAPIS",299,0)
 I $P(%,".")<3170227 S PSOTIERE=0  ;legacy billing - old
"RTN","PSNAPIS",300,0)
 I $G(^XTMP("PSOTIEREFTST",0)) S PSOTIERE=1  ;for SQA testing only - bill with copay tiers - new
"RTN","PSNAPIS",301,0)
 I 'PSOTIERE S RETTIER="" Q RETTIER
"RTN","PSNAPIS",302,0)
 ;***** end for regression test
"RTN","PSNAPIS",303,0)
 ;
"RTN","PSNAPIS",304,0)
 I $G(PSNDRIEN) S RETURN=$$CPTIER3(RETURN,DATE,PSNDRIEN) Q RETURN
"RTN","PSNAPIS",305,0)
 I $G(VAPIEN) S RETURN=$$CPTIER2(RETURN,DATE,VAPIEN) Q RETURN
"RTN","PSNAPIS",306,0)
 Q ""
"RTN","PSNAPIS",307,0)
 ;
"RTN","PSNAPIS",308,0)
CPTIER2(RETURN,DATE,VAPIEN) ;
"RTN","PSNAPIS",309,0)
 I '$O(^PSNDF(50.68,VAPIEN,10,0)) Q ""
"RTN","PSNAPIS",310,0)
 S PSOTIERE=1  ;use copay tiers - new
"RTN","PSNAPIS",311,0)
 S (FLG,II)=0,RETTIER=""
"RTN","PSNAPIS",312,0)
 F  S II=$O(^PSNDF(50.68,VAPIEN,10,II)) Q:'II  S CPTIER=$G(^PSNDF(50.68,VAPIEN,10,II,0)) I CPTIER'="" D
"RTN","PSNAPIS",313,0)
 .S TIER=$P(CPTIER,"^"),EFFDT=$P(CPTIER,"^",2),ENDDT=$P(CPTIER,"^",3)
"RTN","PSNAPIS",314,0)
 .I $G(EFFDT)&($G(ENDDT)),(DATE'<EFFDT&(DATE'>ENDDT)) S FLG=1,RETTIER=CPTIER
"RTN","PSNAPIS",315,0)
 .I $G(EFFDT)&('$G(ENDDT)),DATE'<EFFDT S FLG=1,RETTIER=CPTIER
"RTN","PSNAPIS",316,0)
 Q RETTIER
"RTN","PSNAPIS",317,0)
 ;
"RTN","PSNAPIS",318,0)
CPTIER3(RETURN,DATE,PSNDRIEN) ;
"RTN","PSNAPIS",319,0)
 ; 
"RTN","PSNAPIS",320,0)
 K ^TMP($J,"PSNAPIS")
"RTN","PSNAPIS",321,0)
 D NDF^PSS50(PSNDRIEN,,,,,"PSNAPIS")
"RTN","PSNAPIS",322,0)
 S (DEAFLG,DEASH)="",DEASH=$$GET1^DIQ(50,PSNDRIEN,3)
"RTN","PSNAPIS",323,0)
 I DEASH'="" F I=1:1:$L(DEASH) S DEA="",DEA=$E(DEASH,I) D
"RTN","PSNAPIS",324,0)
 . I (",I,S,N,")[(","_DEA_",") S DEAFLG=1
"RTN","PSNAPIS",325,0)
 S:$D(^TMP($J,"PSNAPIS",PSNDRIEN,22)) VAPIEN=$P(^TMP($J,"PSNAPIS",PSNDRIEN,22),"^")
"RTN","PSNAPIS",326,0)
 ;not matched to NDF
"RTN","PSNAPIS",327,0)
 ;I VAPIEN="" S RETURN=$S($G(PSNCINQS):"",'$G(PSNCINQS):0,1:"") Q RETURN
"RTN","PSNAPIS",328,0)
 I VAPIEN="" S RETURN="" Q RETURN
"RTN","PSNAPIS",329,0)
 ;matched to NDF
"RTN","PSNAPIS",330,0)
 S RETURN=$$CPTIER2(RETURN,DATE,VAPIEN)
"RTN","PSNAPIS",331,0)
 I +RETURN="" D  Q RETURN  ;MATCHED
"RTN","PSNAPIS",332,0)
 . I $G(PSNCINQS) S RETURN="" Q
"RTN","PSNAPIS",333,0)
 . S RETURN=0
"RTN","PSNAPIS",334,0)
 ;DEA special handling code is exempt from copay
"RTN","PSNAPIS",335,0)
 I $G(DEAFLG)&('$D(RETURN)) D  Q RETURN
"RTN","PSNAPIS",336,0)
 . I $G(PSNCINQS) S RETURN="" Q
"RTN","PSNAPIS",337,0)
 . S RETURN=0
"RTN","PSNAPIS",338,0)
 K ^TMP($J,"PSNAPIS")
"RTN","PSNAPIS",339,0)
 ;otherwise return defined copay tier info
"RTN","PSNAPIS",340,0)
 Q RETURN
"RTN","PSNAPIS",341,0)
 ;
"RTN","PSNHIT")
0^8^B26995302
"RTN","PSNHIT",1,0)
PSNHIT ;BIR/CCH&WRT-After match is made package size and type selected ; 02/08/00 8:41
"RTN","PSNHIT",2,0)
 ;;4.0;NATIONAL DRUG FILE;**22,47,65,492**; 30 Oct 98;Build 27
"RTN","PSNHIT",3,0)
 ;
"RTN","PSNHIT",4,0)
 ;Reference to ^DIC(51.5 supported by DBIA #1931
"RTN","PSNHIT",5,0)
 ;Reference to ^PSDRUG supported by DBIA #2352,#221
"RTN","PSNHIT",6,0)
 ;
"RTN","PSNHIT",7,0)
 S ASC="Enter your choice or press return to continue: "
"RTN","PSNHIT",8,0)
HIT W !!,"Match made with ",PSNLOC W:$P(^PSDRUG(PSNB,0),"^",9)=1 ?62,"N/F" W !,"  Now select VA Product Name ",!
"RTN","PSNHIT",9,0)
 S PSNFL=0
"RTN","PSNHIT",10,0)
FORM K ANS,LIST,DA S DA=PSNDA,X=$$VAP^PSNAPIS(DA,.LIST),STOP=X D STAR0,STAR F PSNWR=0:0 S PSNWR=$O(^TMP($J,"PSNND",PSNWR)) Q:'PSNWR
"RTN","PSNHIT",11,0)
WRTIT F BB=1:1:STOP D EXTD D  I BB#10=0,STOP'=10 W !!,ASC R ANS:DTIME S:'$T ANS="^" S:ANS="^" PSNFL=1 Q:PSNFL  Q:ANS]""
"RTN","PSNHIT",12,0)
 .W !,BB," ",$P(^TMP($J,"PSNND",BB),"^",1)_"    "_$P(^TMP($J,"PSNND",BB),"^",3)_"  "_$P(^TMP($J,"PSNND",BB),"^",4)_"  "_CMID_"  "_$S($P(^TMP($J,"PSNND",BB),"^",6)="I":"**INACTIVE**",1:"")
"RTN","PSNHIT",13,0)
 .W "  "_$P(^TMP($J,"PSNND",BB),"^",7)   ; PSN*4*492 FMCT
"RTN","PSNHIT",14,0)
 I $D(ANS),ANS?.E1C.E G FORM
"RTN","PSNHIT",15,0)
 I $D(ANS),ANS["?" D HIT1^PSNHELP K ANS G FORM
"RTN","PSNHIT",16,0)
 Q:PSNFL  I $D(ANS),ANS']"" K ANS
"RTN","PSNHIT",17,0)
 I $D(ANS),ANS?.E1C.E G FORM
"RTN","PSNHIT",18,0)
VAPN I '$D(ANS) S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV R !!,"Enter your choice: ",ANS:DTIME S:'$T ANS="^" S:ANS["^" PSNFL=1 Q:PSNFL
"RTN","PSNHIT",19,0)
 I ANS?.E1C.E K ANS G VAPN
"RTN","PSNHIT",20,0)
 I $D(ANS),ANS["?" D NDC3^PSNHELP W !!,"Match local drug  ",PSNNAM," with " W !,?40,"ORDER UNIT: " I $D(PSNODE),$D(PSNOU),$D(^DIC(51.5)) W ?52,$S('$D(^DIC(51.5,PSNOU)):"",1:$P(^DIC(51.5,PSNOU,0),"^",1))
"RTN","PSNHIT",21,0)
 I $D(ANS),ANS["?" K ANS W !,?24,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(PSNODE):"",1:$P(PSNODE,"^",5)),!,?37,"DISPENSE UNIT: ",$S('$D(PSNODE):"",1:$P(PSNODE,"^",8)),!,?5 G FORM
"RTN","PSNHIT",22,0)
 I $D(ANS),ANS']"" G TRY3^PSNCOMP
"RTN","PSNHIT",23,0)
 I $D(ANS),'$D(^TMP($J,"PSNND",ANS)) W !!,"Invalid answer",! K ANS G FORM
"RTN","PSNHIT",24,0)
 S (PSNFNM,KK)=$P(^TMP($J,"PSNND",ANS),"^",2)
"RTN","PSNHIT",25,0)
RESP R !,?10,"Is this a match  < Reply Y, N or press return to continue > :  ",ANS:DTIME S:'$T ANS="^" W ! I ANS']"" K ANS,PSNFORM G PUNT^PSNCOMP
"RTN","PSNHIT",26,0)
 I ANS?.E1C.E G RESP
"RTN","PSNHIT",27,0)
 I "Nn"[$E(ANS),'X K ANS,PSNFORM G PUNT^PSNCOMP
"RTN","PSNHIT",28,0)
 I "Nn"[$E(ANS) K ANS,PSNFORM G FORM
"RTN","PSNHIT",29,0)
 I ANS["^" S PSNFL=1 Q
"RTN","PSNHIT",30,0)
 I ANS["?" D RES1^PSNHELP K ANS G RESP
"RTN","PSNHIT",31,0)
 I "YyNn"'[$E(ANS) W !," Invalid Response " G RESP
"RTN","PSNHIT",32,0)
 I $P(LIST(KK),"^",7)="I" W !,"Inactive VA Product entry has been selected!!",!! G FORM
"RTN","PSNHIT",33,0)
 S PSNCLASS=$P(^PSNDF(50.68,PSNFNM,3),"^"),PSNNDF=PSNDA S PSNVAR="BLDIT^PSNCOMP" D ^PSNSTCK I $D(PSNFL) Q:PSNFL
"RTN","PSNHIT",34,0)
 Q:'$D(ANS)  I "NOno"[ANS K ANS Q
"RTN","PSNHIT",35,0)
SET S:'$D(^PSNTRAN(PSNB,0)) $P(^PSNTRAN(0),"^",4)=($P(^PSNTRAN(0),"^",4))+1,$P(^PSNTRAN(0),"^",3)=PSNB
"RTN","PSNHIT",36,0)
 S ^PSNTRAN(PSNB,0)=PSNNDF_"^"_PSNFNM_"^"_PSNCLASS_"^^"_PSNSIZE_"^^"_PSNTYPE_"^"_DUZ D PKI W:$D(IOF) @IOF S:'$D(PSNFL) PSNFL=0 Q
"RTN","PSNHIT",37,0)
PRA ; PRINT DOSE FORM AND CLASS AFTER VA PRODUCT NAME IF A DUPLICATE
"RTN","PSNHIT",38,0)
 ; S PSNDFM=$P(^PSNDF(PSNDA,2,$P(^PSNDF(PSNDA,5,KK,0),"^",2),0),"^",1),PSND=$P(^PS(50.606,PSNDFM,0),"^",1)
"RTN","PSNHIT",39,0)
 ; S PSNVCL=$P(^PSNDF(PSNDA,2,$P(^PSNDF(PSNDA,5,KK,0),"^",2),0),"^",3),PSNVC=$P(^PS(50.605,PSNVCL,0),"^",1) W "     ",PSND,"  ",PSNVC S PSNF=0 Q
"RTN","PSNHIT",40,0)
 ; W "     ",PSND,"  ",PSNVC S PSNF=0 Q
"RTN","PSNHIT",41,0)
 Q
"RTN","PSNHIT",42,0)
OOPS W !!,"No match found" S ^PSNTRAN(PSNB,0)="0^^^^^^^"_DUZ Q
"RTN","PSNHIT",43,0)
 Q
"RTN","PSNHIT",44,0)
 Q
"RTN","PSNHIT",45,0)
STAR K ^TMP($J,"PSNND") S PSNRAN=0 S PSNM="" F WRT=0:0 S PSNM=$O(^TMP($J,"PSNDF1",PSNM)) Q:PSNM=""  D SETARY1
"RTN","PSNHIT",46,0)
 Q
"RTN","PSNHIT",47,0)
SETARY1 S CID=" " F KK=0:0 S KK=$O(^TMP($J,"PSNDF1",PSNM,KK)) Q:'KK  S CID=$P($G(^PSNDF(50.68,KK,1)),"^",2) D ARRAY
"RTN","PSNHIT",48,0)
 Q
"RTN","PSNHIT",49,0)
ARRAY S PSNRAN=PSNRAN+1 S ^TMP($J,"PSNND",PSNRAN)=PSNM_"^"_KK_"^"_$P(LIST(KK),"^",4)_"^"_$P(LIST(KK),"^",6)_"^"_CID_"^"_$P(LIST(KK),"^",7)_"^"_$S($P(LIST(KK),"^",8)="Tier ":"",1:$P(LIST(KK),"^",8))
"RTN","PSNHIT",50,0)
 Q
"RTN","PSNHIT",51,0)
KILL K ANS,IFN,PSNDA,PSNDDA,PSNUNDA,PSNSTDA,DIC,II,MJL,JJ,NBR,PSNCLASS,PSNFL,PSNFNM,PSNFORM,PSNNAM,PSNNAME,DOS,NDP,PS,PT,STR,UNT,VV,VV1,PSNNDC,PSNNDF,PSNSP,PSNSIZE,PSNTYPE,PSNVAR,PSNSZ,PSNTRFL,PSNTYP,X,Y,PSNSZE
"RTN","PSNHIT",52,0)
 K PSNTPE,PSNODE,PSNOU,VADC,PSNLOC,^TMP($J,"PSNND"),ASC,PSNRAN,PSNV,PSNWR,PSNX,PSNZ,WRT,BB,END,LIST,IEN,^TMP($J,"PSNDF1") Q
"RTN","PSNHIT",53,0)
STAR0 K ^TMP($J,"PSNDF1") F IEN=0:0 S IEN=$O(LIST(IEN)) Q:'IEN  S ^TMP($J,"PSNDF1",$P(LIST(IEN),"^",2),IEN)=""
"RTN","PSNHIT",54,0)
 Q
"RTN","PSNHIT",55,0)
ASKIT D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !!,"Local drug ",$P(^PSDRUG(PSNB,0),"^"),!,"matches ",?11,PSNFORM,!,"PACKAGE SIZE: ",PSNSZE,!,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNHIT",56,0)
 W !?10,"Is this a match ?" K DIR S DIR("B")="YES",DIR(0)="Y" D ^DIR Q:$D(DIRUT)
"RTN","PSNHIT",57,0)
 I Y(0)="NO" Q
"RTN","PSNHIT",58,0)
 I Y(0)="YES" D SET^PSNHIT
"RTN","PSNHIT",59,0)
 Q
"RTN","PSNHIT",60,0)
ASKIT1 S DUNCE=0 D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !!,"Local drug ",$P(^PSDRUG(PSNB,0),"^"),!,"matches ",?11,PSNFORM,!,"PACKAGE SIZE: ",PSNSZE,!,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNHIT",61,0)
 W !?10,"Is this a match ?" K DIR S DIR("B")="YES",DIR(0)="Y" D ^DIR Q:$D(DIRUT)
"RTN","PSNHIT",62,0)
 I Y(0)="NO" S DUNCE=1,NOMSYN=1
"RTN","PSNHIT",63,0)
 I Y(0)="YES" D SET^PSNHIT
"RTN","PSNHIT",64,0)
 Q
"RTN","PSNHIT",65,0)
EXTD S CMID=$P(^TMP($J,"PSNND",BB),"^",5)
"RTN","PSNHIT",66,0)
 Q
"RTN","PSNHIT",67,0)
PKI N CS
"RTN","PSNHIT",68,0)
 I +$P($G(^PSNDF(50.68,PSNFNM,7)),"^") S CS=$P(^(7),"^") D
"RTN","PSNHIT",69,0)
 .S CS=$S(CS?1(1"2n",1"3n"):+CS_"C",+CS=2!(+CS=3)&(CS'["C"):+CS_"A",1:CS)
"RTN","PSNHIT",70,0)
 .I $L(CS)=1,$P(^PSDRUG(PSNB,0),"^",3)[CS Q
"RTN","PSNHIT",71,0)
 .I $P(^PSDRUG(PSNB,0),"^",3)[$E(CS),$P(^PSDRUG(PSNB,0),"^",3)[$E(CS,2) Q
"RTN","PSNHIT",72,0)
 .W !!,"The CS Federal Schedule associated with this drug in the VA Product file"
"RTN","PSNHIT",73,0)
 .W !,"represents a DEA, Special Handling code of "_CS,!!
"RTN","PSNHIT",74,0)
 .W ?5,"Enter RETURN to continue..." R X:10
"RTN","PSNHIT",75,0)
 Q
"RTN","PSNLOOK")
0^5^B55919915
"RTN","PSNLOOK",1,0)
PSNLOOK ;BIR/WRT-Look up into drug file ; 06/19/03 15:00
"RTN","PSNLOOK",2,0)
 ;;4.0;NATIONAL DRUG FILE;**2,3,5,11,22,27,62,70,169,262,296,429,492**; 30 Oct 98;Build 27
"RTN","PSNLOOK",3,0)
 ;
"RTN","PSNLOOK",4,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSNLOOK",5,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174
"RTN","PSNLOOK",6,0)
 ; Reference to ^PSNAPIS supported by DBIA #2531
"RTN","PSNLOOK",7,0)
 ;
"RTN","PSNLOOK",8,0)
 ;USE PSNLK*
"RTN","PSNLOOK",9,0)
BEGIN ;
"RTN","PSNLOOK",10,0)
 D ASK
"RTN","PSNLOOK",11,0)
 N PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ
"RTN","PSNLOOK",12,0)
 N DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT,PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM
"RTN","PSNLOOK",13,0)
 N PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC
"RTN","PSNLOOK",14,0)
 N PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS,PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA,PSNLKCP,PSNTDRUG
"RTN","PSNLOOK",15,0)
SELD ;Select Drug
"RTN","PSNLOOK",16,0)
 K PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ
"RTN","PSNLOOK",17,0)
 K DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT,PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM
"RTN","PSNLOOK",18,0)
 K PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC
"RTN","PSNLOOK",19,0)
 K PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS,PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA,PSNLKCP
"RTN","PSNLOOK",20,0)
 W ! K DIC S DIC=50,DIC(0)="QEAM",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNLOOK(PSNTDRUG)" D ^DIC I Y<0!($D(DTOUT))!($D(DUOUT)) Q
"RTN","PSNLOOK",21,0)
 S PSNLKDA=+Y K Y
"RTN","PSNLOOK",22,0)
 S PSNLKIND=$P($G(^PSDRUG(PSNLKDA,"I")),"^") I PSNLKIND,PSNLKIND<DT  S Y=PSNLKIND D DD^%DT W !!,"This drug has an Inactive date of "_$G(Y),! D MESS G SELD
"RTN","PSNLOOK",23,0)
 D DSPLY
"RTN","PSNLOOK",24,0)
 D HG
"RTN","PSNLOOK",25,0)
 G SELD
"RTN","PSNLOOK",26,0)
 ;
"RTN","PSNLOOK",27,0)
ASK W !!,"This option will allow you to look up entries in your local DRUG file. It will",!,"display National Drug File software match information.",!
"RTN","PSNLOOK",28,0)
 Q
"RTN","PSNLOOK",29,0)
DSPLY W @IOF W !?14,"DRUG Generic Name:  ",$P($G(^PSDRUG(PSNLKDA,0)),"^") I $D(^PSDRUG(PSNLKDA,"ND")) S PSNLKCL=$P(^("ND"),"^",6)
"RTN","PSNLOOK",30,0)
 I $D(^PSDRUG(PSNLKDA,"ND")),$P(^PSDRUG(PSNLKDA,"ND"),"^",2)]"" S PSNLKNOD=^PSDRUG(PSNLKDA,"ND") D DSPLY1,DSPLY2,PRODF,DSP,ING,SV,DSP1,RESTN Q
"RTN","PSNLOOK",31,0)
 W !?8,"*** NO NATIONAL DRUG FILE INFORMATION ***",!
"RTN","PSNLOOK",32,0)
 Q
"RTN","PSNLOOK",33,0)
DSPLY1 W !?5,"VA Product Name: ",$P(PSNLKNOD,"^",2)
"RTN","PSNLOOK",34,0)
 W !?5,"VA Generic Name: ",$P($G(^PSNDF(50.6,$P(PSNLKNOD,"^"),0)),"^")
"RTN","PSNLOOK",35,0)
 Q
"RTN","PSNLOOK",36,0)
DSPLY2 ;
"RTN","PSNLOOK",37,0)
 S (PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR)=""
"RTN","PSNLOOK",38,0)
 K X S PSNLKDAV=$P(PSNLKNOD,"^"),PSNLKGK=$P(PSNLKNOD,"^",3),X=$$PROD2^PSNAPIS(PSNLKDAV,PSNLKGK) I $P(X,"^")]"" S PSNLKVPN=$P(X,"^"),PSNLKID=$P(X,"^",2),PSNLKTR=$P(X,"^",3),PSNLKVDU=$P(X,"^",4)
"RTN","PSNLOOK",39,0)
 K PSNLKPMI I X]"" S PSNLKQQ=$P(^PSNDF(50.68,PSNLKGK,1),"^",5) D GCN
"RTN","PSNLOOK",40,0)
 K X
"RTN","PSNLOOK",41,0)
 Q
"RTN","PSNLOOK",42,0)
GCN I PSNLKQQ']"" S PSNLKPMI="None" Q
"RTN","PSNLOOK",43,0)
 ;
"RTN","PSNLOOK",44,0)
GCN1 ; 
"RTN","PSNLOOK",45,0)
 I $D(^PS(50.623,"B",PSNLKQQ)) S PSNLKMAP=$O(^PS(50.623,"B",PSNLKQQ,0)),PSNLKENG=$P(^PS(50.623,PSNLKMAP,0),"^",2),PSNLKPMI=$P(^PS(50.621,+PSNLKENG,0),"^") Q
"RTN","PSNLOOK",46,0)
 S PSNLKPMI="None"
"RTN","PSNLOOK",47,0)
 Q
"RTN","PSNLOOK",48,0)
DSPLY3 W ?50,"Transmit To CMOP: "
"RTN","PSNLOOK",49,0)
 I PSNLKTR=1 W "YES"
"RTN","PSNLOOK",50,0)
 I PSNLKTR=0 W "NO"
"RTN","PSNLOOK",51,0)
 Q
"RTN","PSNLOOK",52,0)
PRODF ;
"RTN","PSNLOOK",53,0)
 S X=$$PROD0^PSNAPIS(PSNLKDAV,PSNLKGK)
"RTN","PSNLOOK",54,0)
 S PSNLKDF=+$P(X,"^",2),PSNLKSTR=$P(X,"^",3),PSNLKUN=+$P(X,"^",4),PSNLKFRM=$S($G(PSNLKDF):$P($G(^PS(50.606,PSNLKDF,0)),"^"),1:""),PSNLKUNT=$S($G(PSNLKUN):$P($G(^PS(50.607,PSNLKUN,0)),"^"),1:""),PSNLKNFN=$P(^PSNDF(50.68,PSNLKGK,0),"^",6)
"RTN","PSNLOOK",55,0)
 K X
"RTN","PSNLOOK",56,0)
 Q
"RTN","PSNLOOK",57,0)
ING F PSNLKBB=0:0 S PSNLKBB=$O(^PSNDF(50.68,PSNLKGK,2,PSNLKBB)) Q:'PSNLKBB  D
"RTN","PSNLOOK",58,0)
 .I $D(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)) S PSNLKAND=$G(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)),PSNLKGR=$P(^PS(50.416,$P(PSNLKAND,"^",1),0),"^"),PSNLKIST=$P(PSNLKAND,"^",2),PSNLKIUT=$P(PSNLKAND,"^",3) K PSNLKIUN D ING1,IN2
"RTN","PSNLOOK",59,0)
 Q
"RTN","PSNLOOK",60,0)
IN2 W ?3,PSNLKGR,?50,"Str: ",PSNLKIST W:PSNLKIUT ?65,"Unt: ",$G(PSNLKIUN) W !
"RTN","PSNLOOK",61,0)
 Q
"RTN","PSNLOOK",62,0)
ING1 S:$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2) PSNLKGR=$P($G(^PS(50.416,$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2),0)),"^") I PSNLKIUT S PSNLKIUN=$P(^PS(50.607,PSNLKIUT,0),"^")
"RTN","PSNLOOK",63,0)
 Q
"RTN","PSNLOOK",64,0)
SC I $O(^PSNDF(50.68,PSNLKGK,4,0)) W !,"Secondary Class(es): ",! F PSNLKCC=0:0 S PSNLKCC=$O(^PSNDF(50.68,PSNLKGK,4,PSNLKCC)) Q:'PSNLKCC  S PSNLKZ=$P($G(^PSNDF(50.68,PSNLKGK,4,PSNLKCC,0)),"^") I PSNLKZ D
"RTN","PSNLOOK",65,0)
 .S PSNLKSCL=$P($G(^PS(50.605,PSNLKZ,0)),"^") D SC1
"RTN","PSNLOOK",66,0)
 Q
"RTN","PSNLOOK",67,0)
SC1 W "   ",PSNLKSCL
"RTN","PSNLOOK",68,0)
 Q
"RTN","PSNLOOK",69,0)
SV S PSNLKSEV=$G(^PSNDF(50.68,PSNLKGK,7)) I PSNLKSEV]"" S PSNLKCSF=$P(PSNLKSEV,"^"),PSNLKSP=$P(PSNLKSEV,"^",2) S:PSNLKSP="M" PSNLKSP="Multi" S:PSNLKSP="S" PSNLKSP="Single" D SV1
"RTN","PSNLOOK",70,0)
 Q
"RTN","PSNLOOK",71,0)
SV1 S PSNZZFSA=PSNLKGK_"," S PSNZZFS=$$GET1^DIQ(50.68,PSNZZFSA,19) I $G(PSNZZFS)="" S PSNZZFS="None"
"RTN","PSNLOOK",72,0)
 S PSNLKNND=$P(^PSNDF(50.68,PSNLKGK,7),"^",3)
"RTN","PSNLOOK",73,0)
 Q
"RTN","PSNLOOK",74,0)
DSP W !,"Dosage Form: ",PSNLKFRM_$S('$G(PSNLKDF):"",$P($G(^PS(50.606,PSNLKDF,1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNLOOK",75,0)
 S PSNLKL1=$L(PSNLKSTR),PSNLKL2=$S($G(PSNLKUN):$L(PSNLKUNT),1:0)
"RTN","PSNLOOK",76,0)
 I (PSNLKL1+PSNLKL2)<62 W !,"Strength: ",PSNLKSTR W:$G(PSNLKUN) " Units: "_PSNLKUNT G PSDZZ
"RTN","PSNLOOK",77,0)
 W !,"Strength: ",PSNLKSTR
"RTN","PSNLOOK",78,0)
 I $G(PSNLKUN) D
"RTN","PSNLOOK",79,0)
 .W !,"Units: " I PSNLKL2<72 W PSNLKUNT Q
"RTN","PSNLOOK",80,0)
 .W !,PSNLKUNT
"RTN","PSNLOOK",81,0)
PSDZZ ;
"RTN","PSNLOOK",82,0)
 W !,"National Formulary Name: ",PSNLKNFN,!,"VA Print Name: ",PSNLKVPN,!,"VA Product Identifier: ",PSNLKID D DSPLY3 W !,"VA Dispense Unit: ",PSNLKVDU I $D(PSNLKPMI) W !,"PMIS: ",PSNLKPMI
"RTN","PSNLOOK",83,0)
 W !,"Active Ingredients: ",!
"RTN","PSNLOOK",84,0)
 Q
"RTN","PSNLOOK",85,0)
DSP1 D HG W "Primary Drug Class: ",$P(^PS(50.605,PSNLKCL,0),"^") D SC W !,"CS Federal Schedule: ",$G(PSNLKCSF)_"  "_$G(PSNZZFS),!,"Single/Multi Source Product: ",$G(PSNLKSP)
"RTN","PSNLOOK",86,0)
 I $G(PSNLKNND)]"" W !,"Inactivation Date: " S Y=PSNLKNND D DD^%DT W Y K Y
"RTN","PSNLOOK",87,0)
 W !,"Max Single Dose: ",$P(PSNLKSEV,"^",4),?45,"Min Single Dose: ",$P(PSNLKSEV,"^",5)
"RTN","PSNLOOK",88,0)
 W !,"Max Daily Dose: ",$P(PSNLKSEV,"^",6),?45,"Min Daily Dose: ",$P(PSNLKSEV,"^",7),!,"Max Cumulative Dose: ",$P(PSNLKSEV,"^",8)
"RTN","PSNLOOK",89,0)
 W !,"National Formulary Indicator: " I $D(^PSNDF(50.68,PSNLKGK,5)) W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=0 "No" W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=1 "Yes"
"RTN","PSNLOOK",90,0)
 N CPDATE,X D NOW^%DTC S CPDATE=X S PSNLKCP=$$CPTIER^PSNAPIS(PSNLKGK,CPDATE,"",1) K CPDATE,X
"RTN","PSNLOOK",91,0)
 ;  PSNLKCP = Copay Tier^Effective Date^End Date
"RTN","PSNLOOK",92,0)
 W !,"Copay Tier: ",$P(PSNLKCP,"^",1)
"RTN","PSNLOOK",93,0)
 W !,"Copay Effective Date: " S Y=$P(PSNLKCP,"^",2) D DD^%DT W Y K Y
"RTN","PSNLOOK",94,0)
 W !
"RTN","PSNLOOK",95,0)
 I $G(^PSNDF(50.68,PSNLKGK,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNLOOK",96,0)
 D OVER
"RTN","PSNLOOK",97,0)
 D POSDOS^PSNACT(PSNLKGK)
"RTN","PSNLOOK",98,0)
 W !,"Maximum Days Supply: ",$$GET1^DIQ(50.68,PSNLKGK,32)
"RTN","PSNLOOK",99,0)
 W !
"RTN","PSNLOOK",100,0)
 Q
"RTN","PSNLOOK",101,0)
RESTN I $O(^PSNDF(50.68,PSNLKGK,6,0)) W !,"Restriction: " F PSNLKRE=0:0 S PSNLKRE=$O(^PSNDF(50.68,PSNLKGK,6,PSNLKRE)) Q:'PSNLKRE  S PSNLKWRT=$G(^PSNDF(50.68,PSNLKGK,6,PSNLKRE,0)) W !,PSNLKWRT
"RTN","PSNLOOK",102,0)
 Q
"RTN","PSNLOOK",103,0)
HG ;
"RTN","PSNLOOK",104,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",105,0)
 W @IOF
"RTN","PSNLOOK",106,0)
 Q
"RTN","PSNLOOK",107,0)
MESS ;
"RTN","PSNLOOK",108,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",109,0)
 Q
"RTN","PSNLOOK",110,0)
 ;
"RTN","PSNLOOK",111,0)
OVER ;
"RTN","PSNLOOK",112,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1 D
"RTN","PSNLOOK",113,0)
 .I '$G(PSNLKDF) Q
"RTN","PSNLOOK",114,0)
 .I '$D(^PS(50.606,PSNLKDF,0)) Q
"RTN","PSNLOOK",115,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNLOOK",116,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=0 W " (No Dosage Checks performed)"
"RTN","PSNLOOK",117,0)
 Q
"RTN","PSNLOOK",118,0)
 ;
"RTN","PSNLOOK",119,0)
GETTIER(PSNTDRUG) ;called by DIC; look up copay tier by file 50 ien for current date
"RTN","PSNLOOK",120,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSNINACT,PSNCONVD D NOW^%DTC S CPDATE=X
"RTN","PSNLOOK",121,0)
 S VAPROD=$$GET1^DIQ(50,PSNTDRUG,22,"I")
"RTN","PSNLOOK",122,0)
 Q:'$G(VAPROD) 
"RTN","PSNLOOK",123,0)
 D NOW^%DTC S CPDATE=%
"RTN","PSNLOOK",124,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,PSNTDRUG,1) K CPDATE,X
"RTN","PSNLOOK",125,0)
 I $P(PSSCP,"^")'="" W " Tier ",$P(PSSCP,"^")
"RTN","PSNLOOK",126,0)
 S PSNINACT=$$GET1^DIQ(50,PSNTDRUG,100,"I")  ;inactive date
"RTN","PSNLOOK",127,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE(PSNINACT)
"RTN","PSNLOOK",128,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNLOOK",129,0)
 Q
"RTN","PSNLOOK",130,0)
 ;
"RTN","PSNLOOK",131,0)
DATE(PSNCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSNLOOK",132,0)
 N DATE
"RTN","PSNLOOK",133,0)
 S DATE="",DATE=$E(PSNCONVD,4,5)_"/"_$E(PSNCONVD,6,7)_"/"_(1700+$E(PSNCONVD,1,3))
"RTN","PSNLOOK",134,0)
 Q DATE
"RTN","PSNOUT")
0^10^B9659319
"RTN","PSNOUT",1,0)
PSNOUT ;BIR/CCH&WRT-output transform routine ; 10/31/98 19:19
"RTN","PSNOUT",2,0)
 ;;4.0;NATIONAL DRUG FILE;**2,82,92,492**;30 Oct 98;Build 27
"RTN","PSNOUT",3,0)
INGRED ; output transform for ingredient
"RTN","PSNOUT",4,0)
 K X,LIST,^TMP($J,"PSNING") S K=PSNFNM,X=$$PSJING^PSNAPIS(,K,.LIST),STOP=X D ING0,ING00 F PSNXZ=0:0 S PSNXZ=$O(^TMP($J,"PSNING",PSNXZ)) Q:PSNXZ'?1.N  S INGT=^TMP($J,"PSNING",PSNXZ) D DISP,BREAK
"RTN","PSNOUT",5,0)
 K ^TMP($J,"PSNING")
"RTN","PSNOUT",6,0)
 Q
"RTN","PSNOUT",7,0)
DISP W !?5,$P(INGT,"^",1)_" "_$P(INGT,"^",2)_" "_$P(INGT,"^",3)
"RTN","PSNOUT",8,0)
 Q
"RTN","PSNOUT",9,0)
BREAK I PSNXZ#7=0,STOP'=7 W !,"Press ANY key to continue Ingredient listing: " R PSNCON:DTIME S:'$T PSNCON="^" Q:PSNCON="^"
"RTN","PSNOUT",10,0)
 Q
"RTN","PSNOUT",11,0)
ING0 F INT=0:0 S INT=$O(LIST(INT)) Q:'INT  S ^TMP($J,"PSNING",$P(LIST(INT),"^",2),INT)=LIST(INT)
"RTN","PSNOUT",12,0)
 Q
"RTN","PSNOUT",13,0)
ING00 S PSNRAN=0 S IN="" F  S IN=$O(^TMP($J,"PSNING",IN)) Q:IN=""  D ING000
"RTN","PSNOUT",14,0)
 Q
"RTN","PSNOUT",15,0)
ING000 F IN1=0:0 S IN1=$O(^TMP($J,"PSNING",IN,IN1)) Q:'IN1  D ARRAY
"RTN","PSNOUT",16,0)
 Q
"RTN","PSNOUT",17,0)
ARRAY S PSNRAN=PSNRAN+1 S ^TMP($J,"PSNING",PSNRAN)=IN_"^"_$P(LIST(IN1),"^",3)_"^"_$P(LIST(IN1),"^",4)
"RTN","PSNOUT",18,0)
 Q
"RTN","PSNOUT",19,0)
FORM ; output transform for va product code
"RTN","PSNOUT",20,0)
 I $D(^PSDRUG(D0,"ND")) S PSNLOCL=^PSDRUG(D0,"ND")
"RTN","PSNOUT",21,0)
 Q:'$O(^PSNDF(50.68,0))  Q:'$D(PSNLOCL)  Q:$P(PSNLOCL,"^",1)']""
"RTN","PSNOUT",22,0)
 S PSNDF=$P(PSNLOCL,"^",1),PSNPTR=$P(PSNLOCL,"^",3)
"RTN","PSNOUT",23,0)
 S Y=$P(^PSNDF(50.68,PSNPTR,0),"^",1) K PSNLOCL,PSNDF,PSNPTR Q
"RTN","PSNOUT",24,0)
 Q
"RTN","PSNOUT",25,0)
REACT ; code for reactivation of inactive drug in local drug file
"RTN","PSNOUT",26,0)
 I $D(^PSDRUG(DA,"ND")) I $P(^PSDRUG(DA,"ND"),"^",2)]"" W !!,"points to ",$P(^("ND"),"^",2)," in the National Drug File."
"RTN","PSNOUT",27,0)
REACT1 I $O(^PSNDF(50.6,0)) S XX=$S('$D(^PSDRUG(DA,"ND")):1,1:$P(^("ND"),"^",2)="") D
"RTN","PSNOUT",28,0)
 .I XX S (PSNB,PSNDRG,Z9)=DA,PSNLOC=$P(^PSDRUG(PSNB,0),"^",1) K ^PSNTRAN(PSNB) D GONE^PSNDRUG,BLDIT^PSNCOMP S DA=Z9,PSEDIT=1 D CHK^PSNVFY,SET^PSNMRG,GONE^PSNDRUG K Z9,XX,PSEDIT
"RTN","PSNOUT",29,0)
 Q
"RTN","PSNOUT",30,0)
PKSIZE ; output transform for package size
"RTN","PSNOUT",31,0)
 I $D(^PS(50.609,PSNSIZE,0)) S PSNSZE=$P(^PS(50.609,PSNSIZE,0),"^",1)
"RTN","PSNOUT",32,0)
 Q
"RTN","PSNOUT",33,0)
PKTYPE ; output transform for package type
"RTN","PSNOUT",34,0)
 S PSNTPE=""
"RTN","PSNOUT",35,0)
 I $D(^PS(50.608,PSNTYPE,0)) S PSNTPE=$P(^PS(50.608,PSNTYPE,0),"^",1)
"RTN","PSNOUT",36,0)
 Q
"RTN","PSNOUT",37,0)
INGRED1 ; output transform for ingredient-used in NDF Info Report
"RTN","PSNOUT",38,0)
 K LIST,X S K=FNM,X=$$PSJING^PSNAPIS(,K,.LIST) D INGRD1,INGRD2 K IN,VV,VVV
"RTN","PSNOUT",39,0)
 Q
"RTN","PSNOUT",40,0)
INGRD1 K ^TMP($J,"PSNING") F INT=0:0 S INT=$O(LIST(INT)) Q:'INT  S ^TMP($J,"PSNING",$P(LIST(INT),"^",2),INT)=LIST(INT)
"RTN","PSNOUT",41,0)
 Q
"RTN","PSNOUT",42,0)
INGRD2 S IN="" F  S IN=$O(^TMP($J,"PSNING",IN)) Q:IN=""  S IN1=$O(^TMP($J,"PSNING",IN,0)) W !,?42,IN,"  ",$P(^TMP($J,"PSNING",IN,IN1),"^",3)," ",$P(^TMP($J,"PSNING",IN,IN1),"^",4)
"RTN","PSNOUT",43,0)
 Q
"RTN","PSNVFY")
0^6^B17319517
"RTN","PSNVFY",1,0)
PSNVFY ;BIR/CCH&WRT-verifies matches allows rematch ; 02/08/00 8:45
"RTN","PSNVFY",2,0)
 ;;4.0;NATIONAL DRUG FILE;**3,22,65,492**; 30 Oct 98;Build 27
"RTN","PSNVFY",3,0)
 ;
"RTN","PSNVFY",4,0)
 ;Reference to ^DIC(51.5 supported by DBIA #1931
"RTN","PSNVFY",5,0)
 ;Reference to ^PSDRUG supported by DBIA #2352,#221
"RTN","PSNVFY",6,0)
 ;
"RTN","PSNVFY",7,0)
 S PSNFL=0,PSNW=0 F PSNB=0:0 S PSNB=$O(^PSNTRAN(PSNB)) Q:'PSNB  D CHK I $D(PSNFL) Q:PSNFL
"RTN","PSNVFY",8,0)
DONE W:PSNW=0 !!,?13,"No Data has been generated" K PSNB,PSNFL D KILL Q
"RTN","PSNVFY",9,0)
CHK I $D(PSNFL) Q:PSNFL
"RTN","PSNVFY",10,0)
 S PSNP=$G(^PSDRUG(PSNB,"I")) I PSNP,PSNP<DT K ^PSNTRAN(PSNB,0) Q
"RTN","PSNVFY",11,0)
 Q:'$D(^PSNTRAN(PSNB,0))  Q:$P(^PSNTRAN(PSNB,0),"^",9)="Y"  Q:'$P(^PSNTRAN(PSNB,0),"^",2)
"RTN","PSNVFY",12,0)
 S PSNPST=^PSNTRAN(PSNB,0),PSNOLD=$P(^PSDRUG(PSNB,0),U),PSNNEW=$P(^PSNDF(50.68,$P(PSNPST,"^",2),0),"^")
"RTN","PSNVFY",13,0)
START W @IOF W ?2,"LOCAL DRUG NAME: ",PSNOLD S PSNW=1 W:$P(^PSDRUG(PSNB,0),"^",9)=1 ?68,"N/F"
"RTN","PSNVFY",14,0)
 W !,?40,"ORDER UNIT:"
"RTN","PSNVFY",15,0)
 I $D(^PSDRUG(PSNB,660)) S NODE=^PSDRUG(PSNB,660) I $P(NODE,"^",2) S PSNWRT=$P(NODE,"^",2) I $D(^DIC(51.5)),$D(^DIC(51.5,PSNWRT)) W ?52,$S('$D(PSNWRT):"",1:$P(^DIC(51.5,PSNWRT,0),"^",1))
"RTN","PSNVFY",16,0)
 W !,?24,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(NODE):"",1:$P(NODE,"^",5)),!,?37,"DISPENSE UNIT: ",$S('$D(NODE):"",1:$P(NODE,"^",8))
"RTN","PSNVFY",17,0)
 W !!,"VA PRODUCT NAME: ",PSNNEW
"RTN","PSNVFY",18,0)
 S D0=$P(^PSNTRAN(PSNB,0),"^",1),PSNFNM=$P(^PSNTRAN(PSNB,0),"^",2)
"RTN","PSNVFY",19,0)
 S DA=D0,K=PSNFNM,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" W !,"VA PRINT NAME: ",$P(X,"^"),?57,"CMOP ID: ",$P(X,"^",2),!,"VA DISPENSE UNIT: ",$P(X,"^",4)
"RTN","PSNVFY",20,0)
 W ?57,"MARKABLE FOR CMOP: " W:$P(X,"^",3)=1 "YES" W:$P(X,"^",3)=0 "NO" W:$P(X,"^",3)="" "NOT MARKED"
"RTN","PSNVFY",21,0)
 S PSNSIZE=$P(^PSNTRAN(PSNB,0),"^",5),PSNTYPE=$P(^PSNTRAN(PSNB,0),"^",7)
"RTN","PSNVFY",22,0)
 D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !,?5,"PACKAGE SIZE: ",PSNSZE,!,?5,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNVFY",23,0)
 S PSNVADC=$P(^PSNTRAN(PSNB,0),"^",3) W !,"VA CLASS: ",$P(^PS(50.605,PSNVADC,0),"^",1)_"  "_$P(^PS(50.605,PSNVADC,0),"^",2)
"RTN","PSNVFY",24,0)
 W !,"CS FEDERAL SCHEDULE: "_$S($P($G(^PSNDF(50.68,PSNFNM,7)),"^"):$P(^PSNDF(50.68,PSNFNM,7),"^"),1:"")
"RTN","PSNVFY",25,0)
 W !,"INGREDIENTS:" D INGRED^PSNOUT
"RTN","PSNVFY",26,0)
 S NFI=$P($G(^PSNDF(50.68,PSNFNM,5)),"^"),NFR=$P($G(^PSNDF(50.68,PSNFNM,6,1,0)),"^")
"RTN","PSNVFY",27,0)
 W !,"NATIONAL FORMULARY INDICATOR: " W:NFI=1 ?30,"YES" W:NFI=0 ?30,"NO"
"RTN","PSNVFY",28,0)
 W !,"NATIONAL FORMULARY RESTRICTION:",!,NFR
"RTN","PSNVFY",29,0)
 N CPDATE,X,PSNCP D NOW^%DTC S CPDATE=X S PSNCP=$$CPTIER^PSNAPIS(PSNFNM,CPDATE,"",1) K CPDATE,X
"RTN","PSNVFY",30,0)
 ;  PSNCP = Copay Tier^Effective Date^End Date
"RTN","PSNVFY",31,0)
 W !,"Copay Tier: ",$P(PSNCP,"^",1)
"RTN","PSNVFY",32,0)
 W !,"Copay Effective Date: " S Y=$P(PSNCP,"^",2) D DD^%DT W Y K Y
"RTN","PSNVFY",33,0)
 K D0,Y,PSNSIZE,PSNTYPE,PSNTPE,PSNSZE,PSNCON,STOPIT
"RTN","PSNVFY",34,0)
RESP W !!,"< Enter ""Y"" for yes, ""N"" for no >"
"RTN","PSNVFY",35,0)
 W:'$D(Z9) !,"< Press RETURN to Pass to Next Drug >"
"RTN","PSNVFY",36,0)
 R !!!,?10,"Is this a match ? ",ANS:DTIME I '$T S ANS="^" S PSNFL=1 Q
"RTN","PSNVFY",37,0)
 I ANS?.E1C.E G RESP
"RTN","PSNVFY",38,0)
 I ANS="" K ANS Q
"RTN","PSNVFY",39,0)
 W ! I ANS["^" S PSNFL=1 Q
"RTN","PSNVFY",40,0)
 I "Nn"[$E(ANS) K ANS D BLDIT^PSNCOMP Q:$P(^PSNTRAN(PSNB,0),"^",2)']""  G CHK
"RTN","PSNVFY",41,0)
 I ANS["?" D RES2^PSNHELP K ANS G START
"RTN","PSNVFY",42,0)
 I "YyNn"'[$E(ANS) W !," Invalid Response " G RESP
"RTN","PSNVFY",43,0)
 S $P(^PSNTRAN(PSNB,0),"^",9)="Y",$P(^PSNTRAN(PSNB,0),"^",10)=DUZ D:$G(PSEDIT)'=1 SET^PSNMRG    ;PSEDIT set in ^PSNOUT
"RTN","PSNVFY",44,0)
 Q
"RTN","PSNVFY",45,0)
KILL K ANS,PSNSIZE,PSNSZ,PSNTYP,PSNTYPE,PSNDA,PSNSTDA,PSNDDA,PSNUNDA,PSNCLASS,PSNDF,PSNFNM,PSNFORM,PSNNDF,DIC,PSNFL,NBR,PSNNEW,PSNOLD,PSNPST,X,Y,PSNCON,STOPIT
"RTN","PSNVFY",46,0)
 K PSNFN,PSNNAM,PSNNAME,PSNNL,PSNVAR,PSND,PSNDFM,PSNVC,PSNVCL,RM,SL,ZZ,ZZZ,PSNTPE,PSNSZE,VV,VVV,JJ,MJL,KK,IN,PSNODE,PSNOU,NODE,PSNWRT,PSNVADC,PSNENT,PSNF,PSNM,PSNLOC,^TMP($J,"PSNND"),ASC,PSNRAN,PSNV,PSNWR,PSNX,PSNZ,WRT,BB,END,PSNP,PSNW
"RTN","PSNVFY",47,0)
 K CODE,DA,DATE,DIR,EEE,FFF,FL,GGG,IEN,J,K,NO31,NOM31,NOMSYN,DUNCE,PP,PSNARY,PSNIEN,PSNP,PTPS,QQ,RR,ST,TT,TTT,WR,XX,XXX,Y,ZXZX,DDD,LIST,PPQ,PSNTRFL,PSNXZ,STOP,PSNPD,PSNUP,PSNINQ,NFI
"VER")
8.0^22.0
**END**
**END**
