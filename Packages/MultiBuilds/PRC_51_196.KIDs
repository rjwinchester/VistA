KIDS Distribution saved on Nov 16, 2017@08:50:19
PRC196/GEC40
**KIDS**:PRC*5.1*196^GEC*2.0*40^

**INSTALL NAME**
PRC*5.1*196
"BLD",7590,0)
PRC*5.1*196^IFCAP^0^3171116^y
"BLD",7590,1,0)
^^5^5^3170505^^
"BLD",7590,1,1,0)
1. Add new Transaction (Ceiling) may have endless loop at times
"BLD",7590,1,2,0)
 
"BLD",7590,1,3,0)
2. Auto obligation of Delivery Orders ignores Overcommit (off).
"BLD",7590,1,4,0)
 
"BLD",7590,1,5,0)
3. Next FY 1358s, 2237s and orders rejected by FMS in that FY.
"BLD",7590,4,0)
^9.64PA^^
"BLD",7590,6.3)
15
"BLD",7590,"ABPKG")
n
"BLD",7590,"KRN",0)
^9.67PA^779.2^20
"BLD",7590,"KRN",.4,0)
.4
"BLD",7590,"KRN",.401,0)
.401
"BLD",7590,"KRN",.402,0)
.402
"BLD",7590,"KRN",.402,"NM",0)
^9.68A^8^7
"BLD",7590,"KRN",.402,"NM",1,0)
PRCE NEW 1358    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",2,0)
PRCE NEW 1358S    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",3,0)
PRCSEN2237B    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",4,0)
PRCSEN2237S    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",6,0)
PRCSENPRS    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",7,0)
PRCSENR&NR    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM",8,0)
PRCSENR&NRS    FILE #410^410^0
"BLD",7590,"KRN",.402,"NM","B","PRCE NEW 1358    FILE #410",1)

"BLD",7590,"KRN",.402,"NM","B","PRCE NEW 1358S    FILE #410",2)

"BLD",7590,"KRN",.402,"NM","B","PRCSEN2237B    FILE #410",3)

"BLD",7590,"KRN",.402,"NM","B","PRCSEN2237S    FILE #410",4)

"BLD",7590,"KRN",.402,"NM","B","PRCSENPRS    FILE #410",6)

"BLD",7590,"KRN",.402,"NM","B","PRCSENR&NR    FILE #410",7)

"BLD",7590,"KRN",.402,"NM","B","PRCSENR&NRS    FILE #410",8)

"BLD",7590,"KRN",.403,0)
.403
"BLD",7590,"KRN",.5,0)
.5
"BLD",7590,"KRN",.84,0)
.84
"BLD",7590,"KRN",3.6,0)
3.6
"BLD",7590,"KRN",3.8,0)
3.8
"BLD",7590,"KRN",9.2,0)
9.2
"BLD",7590,"KRN",9.8,0)
9.8
"BLD",7590,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",7590,"KRN",9.8,"NM",1,0)
PRCBE^^0^B21566382
"BLD",7590,"KRN",9.8,"NM",2,0)
PRCEN^^0^B57712163
"BLD",7590,"KRN",9.8,"NM",3,0)
PRCEOB1^^0^B6964382
"BLD",7590,"KRN",9.8,"NM",4,0)
PRCSEA^^0^B87690038
"BLD",7590,"KRN",9.8,"NM",5,0)
PRCSEB^^0^B29593062
"BLD",7590,"KRN",9.8,"NM",6,0)
PRCSEB0^^0^B25973826
"BLD",7590,"KRN",9.8,"NM",7,0)
PRCFFU^^0^B39785146
"BLD",7590,"KRN",9.8,"NM",8,0)
PRCHNPO4^^0^B67972862
"BLD",7590,"KRN",9.8,"NM",9,0)
PRCFFU8^^0^B14240820
"BLD",7590,"KRN",9.8,"NM","B","PRCBE",1)

"BLD",7590,"KRN",9.8,"NM","B","PRCEN",2)

"BLD",7590,"KRN",9.8,"NM","B","PRCEOB1",3)

"BLD",7590,"KRN",9.8,"NM","B","PRCFFU",7)

"BLD",7590,"KRN",9.8,"NM","B","PRCFFU8",9)

"BLD",7590,"KRN",9.8,"NM","B","PRCHNPO4",8)

"BLD",7590,"KRN",9.8,"NM","B","PRCSEA",4)

"BLD",7590,"KRN",9.8,"NM","B","PRCSEB",5)

"BLD",7590,"KRN",9.8,"NM","B","PRCSEB0",6)

"BLD",7590,"KRN",19,0)
19
"BLD",7590,"KRN",19.1,0)
19.1
"BLD",7590,"KRN",101,0)
101
"BLD",7590,"KRN",409.61,0)
409.61
"BLD",7590,"KRN",771,0)
771
"BLD",7590,"KRN",779.2,0)
779.2
"BLD",7590,"KRN",870,0)
870
"BLD",7590,"KRN",8989.51,0)
8989.51
"BLD",7590,"KRN",8989.52,0)
8989.52
"BLD",7590,"KRN",8994,0)
8994
"BLD",7590,"KRN","B",.4,.4)

"BLD",7590,"KRN","B",.401,.401)

"BLD",7590,"KRN","B",.402,.402)

"BLD",7590,"KRN","B",.403,.403)

"BLD",7590,"KRN","B",.5,.5)

"BLD",7590,"KRN","B",.84,.84)

"BLD",7590,"KRN","B",3.6,3.6)

"BLD",7590,"KRN","B",3.8,3.8)

"BLD",7590,"KRN","B",9.2,9.2)

"BLD",7590,"KRN","B",9.8,9.8)

"BLD",7590,"KRN","B",19,19)

"BLD",7590,"KRN","B",19.1,19.1)

"BLD",7590,"KRN","B",101,101)

"BLD",7590,"KRN","B",409.61,409.61)

"BLD",7590,"KRN","B",771,771)

"BLD",7590,"KRN","B",779.2,779.2)

"BLD",7590,"KRN","B",870,870)

"BLD",7590,"KRN","B",8989.51,8989.51)

"BLD",7590,"KRN","B",8989.52,8989.52)

"BLD",7590,"KRN","B",8994,8994)

"BLD",7590,"QDEF")
^^^^^^^^^^YES
"BLD",7590,"QUES",0)
^9.62^^
"BLD",7590,"REQB",0)
^9.611^4^4
"BLD",7590,"REQB",1,0)
PRC*5.1*79^2
"BLD",7590,"REQB",2,0)
PRC*5.1*139^2
"BLD",7590,"REQB",3,0)
PRC*5.1*184^2
"BLD",7590,"REQB",4,0)
PRC*5.1*130^2
"BLD",7590,"REQB","B","PRC*5.1*130",4)

"BLD",7590,"REQB","B","PRC*5.1*139",2)

"BLD",7590,"REQB","B","PRC*5.1*184",3)

"BLD",7590,"REQB","B","PRC*5.1*79",1)

"KRN",.402,2468,-1)
0^3
"KRN",.402,2468,0)
PRCSEN2237B^3170901.0943^^410^^^3171114
"KRN",.402,2468,"DIAB",1,2,410.212,1)
1:
"KRN",.402,2468,"DIAB",7,0,410,0)
REQUESTING SERVICE;REQ
"KRN",.402,2468,"DR",1,410)
I $D(PRCSERR),PRCSERR S Y="@1";1///O;8;49;Q;5//TODAY;6.3R~;@22;7;S PRCSTDT=X D CHKREQ^PRCSEB S:PRCCKERR=1 Y="@22";7.5//ST;9;
"KRN",.402,2468,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;I $D(^PRCS(410,T1,3)),$P(^(3),U,4)]"" S $P(^PRCS(410,DA,3),U,4)=$P(^PRCS(410,T1,3),U,4);11;
"KRN",.402,2468,"DR",1,410,2)
I $D(Z(1))!('$D(Z("Z"))) S Y="@1";11;11.1;I X="" S Y=11.5;11.2;I X="" S Y=11.5;11.3;I X="" S Y=11.5;11.4;11.5;11.6;11.7;11.8;11.9;@1;10;D CHKITDES^PRCSCK(DA);D EX1^PRCSCK,^PRCSCK;
"KRN",.402,2468,"DR",1,410,3)
I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR,PRCSF,PRCSI;20;Q;@23;21//TODAY;S PRCCOMDT=X D COMCHK^PRCEN S:PRCCKERR=1 Y="@23";I $D(PRCSJP) S Y=48.1;D RB^PRCSCK;16;48.1;46;45;40;
"KRN",.402,2468,"DR",1,410,4)
I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S Y=68;42;Q;44//TODAY;68;K PRCSJP,PRCSTDT,PRCCOMDT,PRCCKERR;60;
"KRN",.402,2468,"DR",2,410.02)
I '$D(PRCSTDT) S PRCSTDT=$S($D(^PRCS(410,DA(1),1)):$P(^(0),U,4),1:"");@1;.01//1;1;I X="^" S Y="@1";I '$$ITDES^PRCHJUTL(DA(1),DA) W !,"  Item DESCRIPTION is required!",*7 S Y=1;2;3;6;7;
"KRN",.402,2468,"DR",2,410.02,1)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);4//^S X="" S:$D(PRCS("SUB")) X=PRCS("SUB");@44;
"KRN",.402,2468,"DR",2,410.02,2)
I $D(^PRC(411,PRC("SITE"),0)),$P(^(0),U,18)'="Y" S Y="@3";10;@3;D 2^PRCSCK;I $D(PRCSERR),PRCSERR S Y=PRCSERR K PRCSERR;D QRB^PRCSCK;12;K PRCSMDP;
"KRN",.402,2468,"DR",2,410.04)
.01;1;D RB1^PRCSCK;
"KRN",.402,2468,"DR",3,410.212)
.01;S PRCSMDP=$P(^PRCS(410,DA(2),0),U)_"-"_DA(1)_"-"_$P(^PRCS(410,DA(2),"IT",DA(1),2,DA,0),U);1///^S X=PRCSMDP;D QRB1^PRCSCK;
"KRN",.402,2468,"DR",3,410.212,1)
^410.6^PRCS(410.6,^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCS(410,D0,"IT",D1,"2",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2468,"DR",4,410.6)
1;I X<PRCSTDT W *7,!,?4,"Delivery date must be later than Request's required date." S Y=1;@1;3;K PRCSERR D QRB2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;2;4;
"KRN",.402,2470,-1)
0^4
"KRN",.402,2470,0)
PRCSEN2237S^3170824.1423^^410^^^3170824
"KRN",.402,2470,"%D",0)
^^2^2^2921005^^
"KRN",.402,2470,"%D",1,0)
This input template is for creating a non-repetitive form type
"KRN",.402,2470,"%D",2,0)
request at the Requestor's Level.
"KRN",.402,2470,"DIAB",1,2,410.212,1)
1:
"KRN",.402,2470,"DIAB",6,0,410,0)
5//TODAY;REQ
"KRN",.402,2470,"DIAB",7,0,410,0)
40;REQ
"KRN",.402,2470,"DR",1,410)
I $D(PRCSERR),PRCSERR S Y="@1";1///O;8;49;Q;5R~//TODAY;40R~;6.3;@22;7;S PRCSTDT=X D CHKREQ^PRCSEB S:PRCCKERR=1 Y="@22";7.5//ST;9;
"KRN",.402,2470,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;11;I $D(Z(1))!('$D(Z("Z"))) S Y="@1";11;11.1;I X="" S Y=11.5;11.2;I X="" S Y=11.5;11.3;
"KRN",.402,2470,"DR",1,410,2)
I X="" S Y=11.5;11.4;11.5:11.9;@1;10;D ^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;48.1;46;45;W !,"ORIGINATOR: ",$P(^VA(200,$P(^PRCS(410,DA,14),"^"),0),"^");K PRCCKERR;60;
"KRN",.402,2470,"DR",2,410.02)
@1;.01//1;1;2;3;6;7;S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);
"KRN",.402,2470,"DR",2,410.02,1)
4//^S X="" S:$D(PRCS("SUB")) X=PRCS("SUB");@44;D 2^PRCSCK;I $D(PRCSERR),PRCSERR S Y=PRCSERR K PRCSERR;D QRB^PRCSCK;12;K PRCSMDP;
"KRN",.402,2470,"DR",3,410.212)
.01;S PRCSMDP=$P(^PRCS(410,DA(2),0),U)_"-"_DA(1)_"-"_$P(^PRCS(410,DA(2),"IT",DA(1),2,DA,0),U);1///^S X=PRCSMDP;D QRB1^PRCSCK;
"KRN",.402,2470,"DR",3,410.212,1)
^410.6^PRCS(410.6,^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCS(410,D0,"IT",D1,"2",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2470,"DR",4,410.6)
1;S PRCSTDT=+$P(^PRCS(410,T1,1),"^",4) I X<PRCSTDT W $C(7),!,?4,"Delivery date must be later than Request's required date." S Y=1;@1;3;K PRCSERR D QRB2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;2;4;
"KRN",.402,2470,"ROUOLD")
PRCST4
"KRN",.402,2473,-1)
0^7
"KRN",.402,2473,0)
PRCSENR&NR^3170901.1002^^410^^^3171012
"KRN",.402,2473,"%D",0)
^^2^2^2981019^^^
"KRN",.402,2473,"%D",1,0)
This input template is for creating a repetitive and non-repetitive
"KRN",.402,2473,"%D",2,0)
form type request.
"KRN",.402,2473,"DIAB",1,2,410.212,1)
1:
"KRN",.402,2473,"DIAB",7,0,410,0)
REQUESTING SERVICE;REQ
"KRN",.402,2473,"DR",1,410)
I $D(PRCSERR),PRCSERR S Y="@1";1///O;8;49;Q;5//TODAY;6.3R~;@22;7;S PRCSTDT=X D CHKREQ^PRCSEB S:PRCCKERR=1 Y="@22";7.5//ST;9;
"KRN",.402,2473,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;I $D(^PRCS(410,T1,3)),$P(^(3),U,4)]"" S $P(^PRCS(410,DA,3),U,4)=$P(^(3),U,4);11;
"KRN",.402,2473,"DR",1,410,2)
I $D(Z(1))!('$D(Z("Z"))) S Y="@1";11;11.1;I X="" S Y=11.5;11.2;I X="" S Y=11.5;11.3;I X="" S Y=11.5;11.4;11.5:11.9;@1;10;D CHKITDES^PRCSCK($G(DA));D EX1^PRCSCK,^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR,PRCSF,PRCSI;20;Q;@23;
"KRN",.402,2473,"DR",1,410,3)
21//TODAY;S PRCCOMDT=X D COMCHK^PRCEN S:PRCCKERR=1 Y="@23";I $D(PRCSJP) S Y=46;D RB^PRCSCK;16;46;45;40;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S Y=68;42;Q;44//TODAY;68;
"KRN",.402,2473,"DR",1,410,4)
K PRCSJP,PRCSTDT,PRCCOMDT,PRCSSUB,PRCCKERR;60;
"KRN",.402,2473,"DR",2,410.02)
I '$D(PRCSTDT) S PRCSTDT=$S($D(^PRCS(410,DA(1),1)):$P(^(1),U,4),1:"");@1;.01//1;I $D(^PRCS(410,DA(1),3)),$P(^(3),"^",4),$D(^(2)),$P(^(2),"^",1)'="" S PRCSV=$P(^(3),"^",4);I '$D(PRCSV) S Y=1;5;K PRCSSUB I X="" S Y=1;
"KRN",.402,2473,"DR",2,410.02,1)
S PRCSSUB=$S($D(^PRCD(420.1,+$S($D(^PRCS(410,DA(1),3)):$P(^(3),U,3),1:""),1,+$S($D(^PRC(441,+$S($D(^PRCS(410,DA(1),"IT",DA,0)):$P(^(0),U,5),1:""),0)):$P(^(0),U,10),1:""),0)):$P(^(0),U),1:"");
"KRN",.402,2473,"DR",2,410.02,2)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);4;@44;2;S Y="@4";1;I X="^" S Y="@1";
"KRN",.402,2473,"DR",2,410.02,3)
I '$$ITDES^PRCHJUTL(DA(1),DA) W !,"  Item DESCRIPTION is required!",*7 S Y=1;
"KRN",.402,2473,"DR",2,410.02,4)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@444" W !,"BOC: ",$P(X,U,2);4;@444;@2;2;3;6;7;K PRCSV;@4;
"KRN",.402,2473,"DR",2,410.02,5)
I $D(^PRC(411,PRC("SITE"),0)),$P(^(0),U,18)'="Y" S Y="@5";10;@5;K PRCSV;D 2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;D QRB^PRCSCK;12;K PRCSMDP;
"KRN",.402,2473,"DR",2,410.04)
.01:1;D RB1^PRCSCK;
"KRN",.402,2473,"DR",3,410.212)
.01;S PRCSMDP=$P(^PRCS(410,DA(2),0),U)_"-"_DA(1)_"-"_$P(^PRCS(410,DA(2),"IT",DA(1),2,DA,0),U);1///^S X=PRCSMDP;D QRB1^PRCSCK;
"KRN",.402,2473,"DR",3,410.212,1)
^410.6^PRCS(410.6,^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCS(410,D0,"IT",D1,"2",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2473,"DR",4,410.6)
1;I X<PRCSTDT W *7,!,?3,"Delivery date must be later than Request's required date." S Y=1;@1;3;K PRCSERR D QRB2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;2;4;
"KRN",.402,2473,"ROUOLD")

"KRN",.402,2474,-1)
0^6
"KRN",.402,2474,0)
PRCSENPRS^3170809.0937^^410^^^3170809
"KRN",.402,2474,"%D",0)
2
"KRN",.402,2474,"%D",1,0)
This input template is for creating a repetitive form type request
"KRN",.402,2474,"%D",2,0)
at the Requestor's level.
"KRN",.402,2474,"DIAB",1,2,410.212,1)
1:
"KRN",.402,2474,"DIAB",6,0,410,0)
5//TODAY;REQ
"KRN",.402,2474,"DIAB",7,0,410,0)
40;REQ
"KRN",.402,2474,"DR",1,410)
I $D(PRCSERR),PRCSERR S Y="@1";1///O;8;49;Q;5R~//TODAY;40R~;6.3;@22;7;S PRCSTDT=X D CHKREQ^PRCSEB S:PRCCKERR=1 Y="@22";7.5//ST;9;
"KRN",.402,2474,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;11;11.1;I X="" S Y=11.5;11.2;I X="" S Y=11.5;11.3;I X="" S Y=11.5;11.4;11.5;11.6;11.7;11.8;
"KRN",.402,2474,"DR",1,410,2)
11.9;@1;10;D ^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1";46;45;W !,"ORIGINATOR: ",$P(^VA(200,$P(^PRCS(410,DA,14),"^"),0),"^");K PRCCKERR;60;
"KRN",.402,2474,"DR",2,410.02)
I '$D(PRCSTDT) S PRCSTDT=$S($D(^PRCS(410,DA(1),1)):$P(^(1),U,4),1:"");@1;.01//1;I $D(^PRCS(410,DA(1),3)),$P(^(3),"^",4),$D(^(2)),$P(^(2),"^",1)'="" S PRCSV=$P(^(3),"^",4);
"KRN",.402,2474,"DR",2,410.02,1)
I '$D(PRCSV) W !,"There are no items in the Item file for this vendor." S Y="";5;I X="" W *7," ??  required field" S Y=5;
"KRN",.402,2474,"DR",2,410.02,2)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);4;@44;@2;2;K PRCSV;D 2^PRCSCK;
"KRN",.402,2474,"DR",2,410.02,3)
I $D(PRCSERR),PRCSERR S Y=PRCSERR K PRCSERR;D QRB^PRCSCK;12;K PRCSMDP;
"KRN",.402,2474,"DR",3,410.212)
.01;S PRCSMDP=$P(^PRCS(410,DA(2),0),U)_"-"_DA(1)_"-"_$P(^PRCS(410,DA(2),"IT",DA(1),2,DA,0),U);1///^S X=PRCSMDP;D QRB1^PRCSCK;
"KRN",.402,2474,"DR",3,410.212,1)
^410.6^PRCS(410.6,^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCS(410,D0,"IT",D1,"2",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2474,"DR",4,410.6)
1;I X<PRCSTDT W $C(7),!,?3,"Delivery date must be later than Request's required date." S Y=1;@1;3;K PRCSERR D QRB2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;2;4;
"KRN",.402,2477,-1)
0^8
"KRN",.402,2477,0)
PRCSENR&NRS^3160407.1452^^410^^^3170927
"KRN",.402,2477,"%D",0)
^^2^2^2890716^
"KRN",.402,2477,"%D",1,0)
This input template is for creating a repetitive and non-repetitive
"KRN",.402,2477,"%D",2,0)
form type request at the Requestor's Level.
"KRN",.402,2477,"DIAB",1,2,410.212,1)
1:
"KRN",.402,2477,"DIAB",6,0,410,0)
5//TODAY;REQ
"KRN",.402,2477,"DIAB",7,0,410,0)
40;REQ
"KRN",.402,2477,"DR",1,410)
I $D(PRCSERR),PRCSERR S Y="@1";1///O;8;49;Q;5R~//TODAY;40R~;6.3;@22;7;S PRCSTDT=X D CHKREQ^PRCSEB S:PRCCKERR=1 Y="@22";7.5//ST;9;
"KRN",.402,2477,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;11;I $D(Z(1))!('$D(Z("Z"))) S Y="@1";11;11.1;I X="" S Y=11.5;11.2;I X="" S Y=11.5;11.3;
"KRN",.402,2477,"DR",1,410,2)
I X="" S Y=11.5;11.4;11.5:11.9;@1;10;Q;D ^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1";46;45;W !,"ORIGINATOR: ",$P(^VA(200,$P(^PRCS(410,DA,14),"^"),0),"^");K PRCSSUB,PRCCKERR;60;
"KRN",.402,2477,"DR",2,410.02)
@1;.01//1;I $D(^PRCS(410,DA(1),3)),$P(^(3),"^",4),$D(^(2)),$P(^(2),"^",1)'="" S PRCSV=$P(^(3),"^",4);I '$D(PRCSV) S Y=1;5;K PRCSSUB I X="" S Y=1;
"KRN",.402,2477,"DR",2,410.02,1)
S PRCSSUB=$S($D(^PRCD(420.1,+$S($D(^PRCS(410,DA(1),3)):$P(^(3),U,3),1:""),1,+$S($D(^PRC(441,+$S($D(^PRCS(410,DA(1),"IT",DA,0)):$P(^(0),U,5),1:""),0)):$P(^(0),U,10),1:""),0)):$P(^(0),U),1:"");
"KRN",.402,2477,"DR",2,410.02,2)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);4;@44;2;S Y="@4";1;
"KRN",.402,2477,"DR",2,410.02,3)
S X=$P($G(^PRCS(410,DA(1),3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA(1),"IT",DA,0),U,4)=$P(X,U,2),Y="@444" W !,"BOC: ",$P(X,U,2);4;@444;@2;2;3;6;7;@4;K PRCSV;D 2^PRCSCK;
"KRN",.402,2477,"DR",2,410.02,4)
I $D(PRCSERR),PRCSERR S Y="@1";D QRB^PRCSCK;12;K PRCSMDP;
"KRN",.402,2477,"DR",3,410.212)
.01;S PRCSMDP=$P(^PRCS(410,DA(2),0),U)_"-"_DA(1)_"-"_$P(^PRCS(410,DA(2),"IT",DA(1),2,DA,0),U);1///^S X=PRCSMDP;D QRB1^PRCSCK;
"KRN",.402,2477,"DR",3,410.212,1)
^410.6^PRCS(410.6,^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCS(410,D0,"IT",D1,"2",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2477,"DR",4,410.6)
1;S PRCSTDT=+$P(^PRCS(410,T1,1),"^",4) I X<PRCSTDT W $C(7),!,?3,"Delivery date must be later than Request's required date." S Y=1;@1;3;K PRCSERR D QRB2^PRCSCK;I $D(PRCSERR),PRCSERR S Y="@1" K PRCSERR;2;4;
"KRN",.402,2477,"ROUOLD")
PRCST2
"KRN",.402,2639,-1)
0^1
"KRN",.402,2639,0)
PRCE NEW 1358^3160330.1032^^410^^^3170823
"KRN",.402,2639,"DIAB",3,0,410,6)
VENDOR CONTRACT NUMBER;REQ
"KRN",.402,2639,"DIAB",5,0,410,0)
19;REQ
"KRN",.402,2639,"DIAB",5,0,410,6)
6;REQ
"KRN",.402,2639,"DIAB",7,0,410,6)
6.5;REQ
"KRN",.402,2639,"DIAB",9,0,410,6)
45;"PURPOSE"
"KRN",.402,2639,"DIAB",12,0,410,0)
19.1;REQ
"KRN",.402,2639,"DR",1,410)
1///O;S PRCS1MO=X;40////^S X=DUZ;S:$P(XQY0,U)="PRCEC NEW" Y="@4";19R~;S PRCAUTH=+X;S:$D(^PRCS(410.9,"AC",PRCAUTH,+$P($G(^PRCS(410,D0,11)),U,5))) Y="@3";19.1///@;@3;S:'$D(^PRCS(410.9,"AC",PRCAUTH)) Y="@4";K PRCAUTH;19.1R~;@4;
"KRN",.402,2639,"DR",1,410,1)
S PRCVEN=$G(^PRCS(410,D0,11)),PRCVEN=$G(^PRCS(410.9,+$S($P(PRCVEN,U,5):$P(PRCVEN,U,5),1:$P(PRCVEN,U,4)),0)),PRCONT=$P(PRCVEN,U,6),PRCVEN=$P(PRCVEN,U,5);8;49;Q;5//TODAY;@22;21//^S X=$E(DT,4,5)_"/01/"_$E(DT,2,3);
"KRN",.402,2639,"DR",1,410,2)
S PRCCOMDT=X D COMCHK^PRCEN S:PRCCKERR=1 Y="@22";@1;20;S $P(^PRCS(410,DA,3),U,7)=X;S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;
"KRN",.402,2639,"DR",1,410,3)
S X=$P($G(^PRCS(410,DA,3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA,3),U,6)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);17;@44;D RB^PRCSCK;16;@2;
"KRN",.402,2639,"DR",1,410,4)
S:$P($G(^PRCS(410,DA,2)),U)]""!(PRCVEN) Y="@25";
"KRN",.402,2639,"DR",1,410,5)
W !,"Do you want to enter a vendor for this 1358 request" S %=2 D YN^DICN I %'=1 W:%=0 !,"Enter 'YES' if you want to enter a vendor and vendor contract # for this request." S Y=$S(%=0:"@2",%<0:"",1:6);@25;11;S:PRCONT Y="@55";13;
"KRN",.402,2639,"DR",1,410,6)
S Y=6;@55;13R~;S Y=6;6R~;S PRCSDT=X;6.5R~;K PRCSDT;45PURPOSE~;I '$D(^PRCS(410,DA,8,1,0)) W $C(7),!,"PURPOSE IS REQUIRED!!!" S Y=45;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S Y=68;42;68;
"KRN",.402,2639,"DR",1,410,7)
K PRCSCOST,PRCSBOST,PRCS1MO,PRCCKERR,PRCCOMDT;60;
"KRN",.402,2639,"DR",2,410.04)
.01;1;D RB1^PRCSCK;
"KRN",.402,2656,-1)
0^2
"KRN",.402,2656,0)
PRCE NEW 1358S^3160426.1357^^410^^^3160426
"KRN",.402,2656,"DIAB",5,0,410,0)
40;REQ
"KRN",.402,2656,"DIAB",6,0,410,3)
45;"PURPOSE"
"KRN",.402,2656,"DIAB",7,0,410,0)
5//TODAY;REQ
"KRN",.402,2656,"DR",1,410)
1///O;S PRCS1MO=X;8;49;40R~;Q;5R~//TODAY;@22;21//^S X=$E(DT,4,5)_"/01/"_$E(DT,2,3);S PRCCOMDT=X D COMCHK^PRCEN S:PRCCKERR=1 Y="@22";20;S $P(^PRCS(410,DA,3),"^",7)=X;
"KRN",.402,2656,"DR",1,410,1)
S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;
"KRN",.402,2656,"DR",1,410,2)
S X=$P($G(^PRCS(410,DA,3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA,3),U,6)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);17;@44;D RB^PRCSCK;@2;S:$P($G(^PRCS(410,DA,2)),U)]"" Y="@25";
"KRN",.402,2656,"DR",1,410,3)
W !,"Do you want to enter a vendor for this 1358 request" S %=2 D YN^DICN I %'=1 W:%=0 !,"Enter 'YES' if you want to enter a vendor and vendor contract # for this request." S Y=$S(%=0:"@2",%<0:"",1:45);@25;11;13;S Y=45;45PURPOSE~;
"KRN",.402,2656,"DR",1,410,4)
W !,"ORIGINATOR: ",$P(^VA(200,$P(^PRCS(410,DA,14),"^"),0),"^");K PRCS1MO,PRCCKERR;60;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
196^3171116
"PKG",455,22,1,"PAH",1,1,0)
^^5^5^3171116
"PKG",455,22,1,"PAH",1,1,1,0)
1. Add new Transaction (Ceiling) may have endless loop at times
"PKG",455,22,1,"PAH",1,1,2,0)
 
"PKG",455,22,1,"PAH",1,1,3,0)
2. Auto obligation of Delivery Orders ignores Overcommit (off).
"PKG",455,22,1,"PAH",1,1,4,0)
 
"PKG",455,22,1,"PAH",1,1,5,0)
3. Next FY 1358s, 2237s and orders rejected by FMS in that FY.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PRCBE")
0^1^B21566382
"RTN","PRCBE",1,0)
PRCBE ;WISC@ALTOONA/CTB-EDIT ROUTINE FOR BUDGET MODULE OF ADMIN ACTIVITIES PACKAGE ; 04/07/94  1:43 PM
"RTN","PRCBE",2,0)
V ;;5.1;IFCAP;**139,196**;Oct 20, 2000;Build 15
"RTN","PRCBE",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCBE",4,0)
 ;
"RTN","PRCBE",5,0)
 ;PRC*5.1*196 If the 'AD' x-ref for file 421, site-fy has no 
"RTN","PRCBE",6,0)
 ;            entries, find the last sequence number used and
"RTN","PRCBE",7,0)
 ;            apply reverse entry to 'AD' x-ref site-fy,entry
"RTN","PRCBE",8,0)
 ;
"RTN","PRCBE",9,0)
 W "ROUTINE CAN ONLY BE ENTERED THROUGH MENU MANAGER OR DRIVER",$C(7),!! Q
"RTN","PRCBE",10,0)
SEQNUM S:'$D(PRCF("SIFY")) PRCF("SIFY")=PRC("SITE")_"-"_PRC("FY") S X=$O(^PRCF(421,"AD",PRCF("SIFY"),0)) I X="" D WAIT^PRCFYN,ENIT G SEQNUM
"RTN","PRCBE",11,0)
 E  K ^PRCF(421,"AD",PRCF("SIFY"),X+30) S X=100000-X+1
"RTN","PRCBE",12,0)
 S X="00000"_X,X=$E(X,$L(X)-4,$L(X)) S PRCB("TRANS")=PRC("SITE")_"-"_PRC("FY")_"-"_X,X=PRCB("TRANS")
"RTN","PRCBE",13,0)
 Q
"RTN","PRCBE",14,0)
EN1 ;ENTER NEW TRANSACTION
"RTN","PRCBE",15,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBE",16,0)
SEQ D SEQNUM G:X="" OUT
"RTN","PRCBE",17,0)
 W ! S %A="I am going to create a new transaction with the number "_X,%A(1)="IS THIS OK ",%B="",%=1 D ^PRCFYN I %'=1 W !!,"Transaction number ",X," has been deleted",$C(7) R X:2 G OUT
"RTN","PRCBE",18,0)
 K DIC("A") S DIC=421,DIC(0)="LZ",DLAYGO=421 D ^DIC I $P(Y,"^",3)="" W !,X," has just been taken by someone else, please hold on while I get another one." G SEQ
"RTN","PRCBE",19,0)
 G:+Y<0 OUT S DIE=DIC,DA=+Y,DR="[PRCB NEW TRANSACTION]" D ^DIE I $D(Y)=0,$P(^PRCF(421,DA,0),"^",2)]"",$P($G(^(0)),U,23) G EN1
"RTN","PRCBE",20,0)
 I $P(^PRCF(421,DA,0),"^",2)="" W !,$C(7),"Control Point missing."
"RTN","PRCBE",21,0)
KILL W $C(7),!!,"Transaction terminated!  ",!,"Transaction # ",PRCB("TRANS")," is being deleted." S DIK="^PRCF(421," D ^DIK
"RTN","PRCBE",22,0)
OUT K A,B,D,D0,DA,DIC,DIE,DIK,DLAYGO,DQ,DR,DWDL,J,PRCF,PRCB,X,Y Q
"RTN","PRCBE",23,0)
 ;
"RTN","PRCBE",24,0)
 ;
"RTN","PRCBE",25,0)
EN2 ;EDIT EXISTING, UNRELEASED TRANSACTION
"RTN","PRCBE",26,0)
 S PRCF("X")="ABFS" D ^PRCFSITE Q:'%
"RTN","PRCBE",27,0)
 S DR="[PRCB NEW TRANSACTION]",DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",28,0)
 D EN21 K %,PRCFEN,A,B,DA,DIC,DIE,DR,I,J,K,X,Y,PRCF,PRCB Q
"RTN","PRCBE",29,0)
EN21 W ! S DIC("S")="S ZX=^(0) I $P(ZX,U)[PRCF(""SIFY"")&($P(ZX,U,11)="""")&($P(ZX,U)'[""00000"")&(+$P(ZX,U,20)<1)&'$P(ZX,U,22)"
"RTN","PRCBE",30,0)
 S DIC=421,DIC(0)="AEQZ",D="D" D IX^DIC K DIC Q:Y<0  S DA=+Y,DIE="^PRCF(421,"
"RTN","PRCBE",31,0)
 D ^DIE S DIC("A")="Select Next Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",32,0)
 G EN21
"RTN","PRCBE",33,0)
 Q
"RTN","PRCBE",34,0)
 ;
"RTN","PRCBE",35,0)
EN3 ;DELETE AN UNRELEASED TRANSACTION
"RTN","PRCBE",36,0)
 S PRCF("X")="ABFS" D ^PRCFSITE Q:'%
"RTN","PRCBE",37,0)
 S DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",38,0)
 D EN31 K A,B,DA,DIC,DIK,DR,I,PRCB,X,Y,PRCF Q
"RTN","PRCBE",39,0)
EN31 W ! S DIC("S")="S ZX=^(0) I $P(ZX,U)[PRCF(""SIFY""),$P(ZX,U,11)="""",$P(ZX,U)'[""00000"",+$P(ZX,U,20)=0",DIC=421,DIC(0)="AEQZ",D="D" D IX^DIC K DIC,ZX Q:Y<0  S DA=+Y,DIK="^PRCF(421,"
"RTN","PRCBE",40,0)
 S %A="ARE YOU SURE YOU WANT TO DELETE THIS TRANSACTION",%B="Enter 'YES' to delete.",%=2 D ^PRCFYN I %'=1 W "  <NOTHING DELETED>",$C(7)
"RTN","PRCBE",41,0)
 E  S PRCB("TODA")=$P(^PRCF(421,DA,0),"^",22) D ^DIK S DA=PRCB("TODA") D:DA ^DIK S X=" Transaction Deleted.*" D MSG^PRCFQ
"RTN","PRCBE",42,0)
 S %A="Do you wish to delete another transaction for "_PRCF("SIFY"),%B="" D ^PRCFYN Q:%'=1
"RTN","PRCBE",43,0)
 S DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",44,0)
 G EN31
"RTN","PRCBE",45,0)
 ;
"RTN","PRCBE",46,0)
NA W !!,$C(7),"THIS OPTION IS UNDER DEVELOPMENT AND NOT YET AVAILABLE",!! H 2 Q
"RTN","PRCBE",47,0)
ERR S ^PRC(420,PRC("SITE"),1,9999,0)="9999 GRAND TOTAL",^PRC(420,PRC("SITE"),1,"B","9999 GRAND TOTAL",9999)="",^PRC(420,PRC("SITE"),1,"C","GRAND TOTAL",9999)="" Q
"RTN","PRCBE",48,0)
 ;W !,$C(7),"Control Point '9999 GRAND TOTAL' does not exist for station ",PRC("SITE"),!,"Check documentation and use the 'ADD/EDIT FUND CONTROL POINT' to establish. ",!," Further processing is terminated." R X:3 S %X=9999 Q
"RTN","PRCBE",49,0)
ENIT I '$D(^PRC(420,PRC("SITE"),1,9999)) D ERR
"RTN","PRCBE",50,0)
 S X="00000",PRCB("TRANS")=PRC("SITE")_"-"_PRC("FY")_"-"_X,X=PRCB("TRANS")    ;PRC*5.1*196
"RTN","PRCBE",51,0)
 I $D(^PRCF(421,"B",X)) G ENIT1            ;PRC*5.1*196  
"RTN","PRCBE",52,0)
 K DIC("A") S DIC=421,DIC(0)="NL",DLAYGO=421 D ^DIC S DIE=DIC,DR="1////9999 GRAND TOTAL",DA=+Y    ;PRC*5.1*196
"RTN","PRCBE",53,0)
 D ^DIE S $P(^PRCF(421,DA,0),U,11)=.5
"RTN","PRCBE",54,0)
 S X=$P(^PRCF(421,DA,0),"^",16) K:X]"" ^PRCF(421,"AG",X,DA) K X S $P(^PRCF(421,DA,0),"^",16)="",$P(^(0),"^",20)=2,^(4)="1^1^1^1",^PRCF(421,"AL",PRCF("SIFY"),2,DA)="" K ^PRCF(421,"AL",PRCF("SIFY"),0,DA) Q
"RTN","PRCBE",55,0)
ENIT1 ;SET LAST USED SITE-FY REVERSE TXIN 'AD'    ;PRC*5.1*196
"RTN","PRCBE",56,0)
 N PRCBA,PRCBB,PRCBX
"RTN","PRCBE",57,0)
 S PRCBA=PRCF("SIFY"),PRCBB=100000,PRCBX=PRCBA
"RTN","PRCBE",58,0)
 F I=1:1 S PRCBA=$O(^PRCF(421,"B",PRCBA)) Q:PRCBA=""!($P(PRCBA,"-",1,2)'=PRCBX)  S PRCBB=+$P(PRCBA,"-",3)
"RTN","PRCBE",59,0)
 S:PRCBB'=100000 PRCBB=100000-PRCBB
"RTN","PRCBE",60,0)
 S ^PRCF(421,"AD",PRCBX,PRCBB)=""
"RTN","PRCBE",61,0)
 Q
"RTN","PRCBE",62,0)
DOLLAR I $D(IOST),"C-PK-"[$E(IOST,1,2) S:X["$" X=$P(X,"$",2) W "   $ ",$J(X,0,2)
"RTN","PRCBE",63,0)
 Q
"RTN","PRCEN")
0^2^B57712163
"RTN","PRCEN",1,0)
PRCEN ;WISC/CLH - ENTER/EDIT 1358 ;9/2/2010
"RTN","PRCEN",2,0)
V ;;5.1;IFCAP;**23,148,150,196**;Oct 20, 2000;Build 15
"RTN","PRCEN",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCEN",4,0)
 ;
"RTN","PRCEN",5,0)
 ;PRC*5.1*150 RGB 4/23/12  Control the node 0 counter for file 410
"RTN","PRCEN",6,0)
 ;kill call since DIK call does not handle descending file logic
"RTN","PRCEN",7,0)
 ;
"RTN","PRCEN",8,0)
 ;PRC*5.1*196 Check Committed Date for 1358 against FY requested
"RTN","PRCEN",9,0)
 ;            to insure date is within the FY range.
"RTN","PRCEN",10,0)
 ;
"RTN","PRCEN",11,0)
EN ;new 1358 request
"RTN","PRCEN",12,0)
 N PRC,X,X1,DIC,DIE,DR,PRCS2,PRCSL,PRCSIP,DIR,DIRUT,PRCS,PRCSCP,PRCSN
"RTN","PRCEN",13,0)
 N PRCST,PRCST1,PRCSTT,PRC410,PRCUA,PRCAUTH,PRCAUTHS,PRCQ,PRCVEN,PRCONT
"RTN","PRCEN",14,0)
EN0 K PRC,X,X1,DIC,DIE,DR,PRCS2,PRCSL,PRCSIP,DIR,DIRUT,PRCS,PRCSCP,PRCSN
"RTN","PRCEN",15,0)
 K PRCST,PRCST1,PRCSTT,PRCAED,PRC410,PRCUA,PRCAUTHS
"RTN","PRCEN",16,0)
 D EN^PRCSUT I '$D(PRC("SITE")) W !!,"You are not an authorized control point user.",!,"Contact your control point official." H 3 Q
"RTN","PRCEN",17,0)
 Q:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCEN",18,0)
 ;
"RTN","PRCEN",19,0)
 ; warn CP official, allow to quit
"RTN","PRCEN",20,0)
 Q:$$Q1358(PRC("SITE"),PRC("CP"))
"RTN","PRCEN",21,0)
 ;
"RTN","PRCEN",22,0)
 ; ask for 1358 Authority (need to preserve variables)
"RTN","PRCEN",23,0)
 S PRCQ=0 D
"RTN","PRCEN",24,0)
 . N X,Y,DTOUT,DUOUT,DIC
"RTN","PRCEN",25,0)
 . S DIC="^PRCS(410.9,",DIC(0)="AEMQ",DIC("S")="I Y<100,('$P(^(0),U,4)!($P(^(0),U,4)>DT))",DIC("A")="Select AUTHORITY OF REQUEST: " D ^DIC S PRCAUTH=+Y I Y<1 S PRCQ=1 Q
"RTN","PRCEN",26,0)
 . I $D(^PRCS(410.9,"AC",PRCAUTH)) S DIC("S")="I $P(^(0),U,3)=PRCAUTH,('$P(^(0),U,4)!($P(^(0),U,4)>DT))",DIC("A")="Select SUB-AUTHORITY OF REQUEST: " D ^DIC S PRCAUTHS=+Y I Y<1 S PRCQ=1
"RTN","PRCEN",27,0)
 Q:PRCQ
"RTN","PRCEN",28,0)
 D EN1^PRCSUT3 Q:'X
"RTN","PRCEN",29,0)
 S X1=X D EN2^PRCSUT3 Q:'$D(X1)  S X=X1 W !!,"This transaction is assigned Transaction number: ",X
"RTN","PRCEN",30,0)
 S PRC410=DA
"RTN","PRCEN",31,0)
 D  G:'$D(DA) EN0
"RTN","PRCEN",32,0)
 . L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","PRCEN",33,0)
 . E  D EN^DDIOL("Transaction is being accessed by another user!") K DA
"RTN","PRCEN",34,0)
 . Q
"RTN","PRCEN",35,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS2=1
"RTN","PRCEN",36,0)
 S DIC(0)="AEMQ",DIE=DIC,DR="3///1"_$S($D(PRCSIP):";4////"_PRCSIP,1:"")_";19////^S X=PRCAUTH"_$S($G(PRCAUTHS):";19.1////^S X=PRCAUTHS",1:""),X4=1 D ^DIE
"RTN","PRCEN",37,0)
 S PRCAED=1,PRCUA=""
"RTN","PRCEN",38,0)
 ; define if fields need to be required or not
"RTN","PRCEN",39,0)
 S PRCVEN=^PRCS(410.9,$S($G(PRCAUTHS):PRCAUTHS,1:PRCAUTH),0),PRCONT=$P(PRCVEN,"^",6),PRCVEN=$P(PRCVEN,"^",5)
"RTN","PRCEN",40,0)
 S DR="[PRCE NEW 1358]" D ^DIE
"RTN","PRCEN",41,0)
 I $D(Y)#10 S PRCUA=1 D YN^PRC0A(.X,.Y,"Delete this NEW entry","","No") I Y=1 D
"RTN","PRCEN",42,0)
 . S PRCIENCT=$P(^PRCS(410,0),"^",3)+1      ;PRC*5.1*150
"RTN","PRCEN",43,0)
 . D DELETE^PRC0B1(.X,"410;^PRCS(410,;"_DA) S:X=1 PRCAED=-1
"RTN","PRCEN",44,0)
 . I X=1 S $P(^PRCS(410,0),"^",3)=PRCIENCT     ;PRC*5.1*150
"RTN","PRCEN",45,0)
 . K PRCIENCT     ;PRC*5.1*150
"RTN","PRCEN",46,0)
 . D EN^DDIOL(" **** NEW ENTRY IS "_$S(X=1:"",1:"NOT ")_"DELETED ****")
"RTN","PRCEN",47,0)
 . QUIT
"RTN","PRCEN",48,0)
 I PRCAED'=-1 D
"RTN","PRCEN",49,0)
 . D:$O(^PRCS(410,DA,12,0)) SCPC0^PRCSED
"RTN","PRCEN",50,0)
 . K PRCSF
"RTN","PRCEN",51,0)
 . D W1^PRCSEB
"RTN","PRCEN",52,0)
 . I $D(PRCS2),+^PRCS(410,DA,0),'PRCUA,$$CHECK(PRC410) D
"RTN","PRCEN",53,0)
 .. D W6^PRCSEB
"RTN","PRCEN",54,0)
 .. Q
"RTN","PRCEN",55,0)
 . Q
"RTN","PRCEN",56,0)
 L -^PRCS(410,PRC410)
"RTN","PRCEN",57,0)
 S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to enter another NEW request" D ^DIR Q:'Y!($D(DIRUT))
"RTN","PRCEN",58,0)
 W !! K PRCS2 G EN0
"RTN","PRCEN",59,0)
 Q
"RTN","PRCEN",60,0)
ED ;edit 1358
"RTN","PRCEN",61,0)
 N PRC410,PRC442,PRCHQ,PRCSDR,PRCSN,PRCST,PRCST1,Y,PRC,PRCS,TT,DIE,DA,DIC
"RTN","PRCEN",62,0)
 N DR,DIR,PRCSY,PRCSL,X,X1,T,T1,Z,PRCSDA,DTOUT,PRCVEN,PRCONT
"RTN","PRCEN",63,0)
ED0 K PRCHQ,PRCSDR,PRCSN,PRCST,PRCST1,Y,PRC,PRCS,TT,DIE,DA,DIC,DR,DIR,PRCSY
"RTN","PRCEN",64,0)
 K PRCSL,X,X1,T,T1,Z,PRCSDA
"RTN","PRCEN",65,0)
 D EN3^PRCSUT I '$D(PRC("SITE")) W !!,"You are not an authorized control point user.",!,"Contact your control point official." H 3 Q
"RTN","PRCEN",66,0)
 Q:Y<0
"RTN","PRCEN",67,0)
 S DIC="^PRCS(410,",DIE=DIC,DIC(0)="AEQM",DIC("S")="I $P(^(0),U,4)=1,+$P(^(0),U)'=0,$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCEN",68,0)
 D ^PRCSDIC Q:Y<0  K DIC("S") S (DA,PRCSY,PRCSDA)=+Y ;D LOCK^PRCSUT G ED0:PRCSL=0
"RTN","PRCEN",69,0)
 D  G:'$D(DA) ED0
"RTN","PRCEN",70,0)
 . L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","PRCEN",71,0)
 . E  D EN^DDIOL("Another user is editing this transaction! Try Later") K DA
"RTN","PRCEN",72,0)
 . Q
"RTN","PRCEN",73,0)
 D NODE^PRCS58OB(DA,.TRNODE) S PRC410=DA
"RTN","PRCEN",74,0)
 S X=^PRCS(410,DA,0) S:+X PRC("FY")=$P(X,"-",2),PRC("QTR")=+$P(X,"-",3),TT=$P(X,"^",2)
"RTN","PRCEN",75,0)
 D EN2B^PRCSUT3
"RTN","PRCEN",76,0)
 I $D(^PRCS(410,DA,7)),$P(^(7),U,6)]"" D SCPE G OUT ;if obligated
"RTN","PRCEN",77,0)
ED1 I TT="CA" S DR="[PRCSENCT]",DIE=DIC D ^DIE S DA=PRCSY L -^PRCS(410,PRCSY) G ED0
"RTN","PRCEN",78,0)
 ; warn CP offical and allow to quit
"RTN","PRCEN",79,0)
 I $$Q1358(PRC("SITE"),PRC("CP"),$G(TT),$G(DA)) L -^PRCS(410,PRCSY) G ED0
"RTN","PRCEN",80,0)
 ;
"RTN","PRCEN",81,0)
 ;  patch 23, fix problem of not able to exit with "^"
"RTN","PRCEN",82,0)
 I TT'="O" S DR="[PRCSENA 1358]" S DIE=DIC D ^DIE L:$D(Y)>9 -^PRCS(410,PRCSY) G:$D(Y)>9 ED0 S DA=PRCSY
"RTN","PRCEN",83,0)
 I TT="A" S PRC442=$P($G(^PRCS(410,PRC410,10)),U,3) I PRC442 G:$$EN1^PRCE0A(PRC410,PRC442,1) ED1
"RTN","PRCEN",84,0)
 I TT="A",$P(^PRCS(410,DA,0),U,4)=1 S X=$P(^(4),U,6),X1=$P(^(3),U,7) I $J(X,0,2)'=$J(X1,0,2)!('X)!('X1) W $C(7),!,"Adj $ Amt does not equal the total of BOC $ Amts.",!,"Please correct the error.",! K DR G ED1
"RTN","PRCEN",85,0)
 D:TT="A"&($O(^PRCS(410,PRCSY,12,0))) SCPC0^PRCSED
"RTN","PRCEN",86,0)
 I TT="A" D REV D:$$CHECK(PRC410) W6^PRCSEB G OUT
"RTN","PRCEN",87,0)
 ;
"RTN","PRCEN",88,0)
 S DR="[PRCE NEW 1358]" D ^DIE,REV D:$$CHECK(PRC410) W6^PRCSEB
"RTN","PRCEN",89,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to edit another request" D ^DIR G OUT:'Y!($D(DIRUT))
"RTN","PRCEN",90,0)
 L -^PRCS(410,PRCSDA)
"RTN","PRCEN",91,0)
 G ED0
"RTN","PRCEN",92,0)
SCPE ;sub control point edit
"RTN","PRCEN",93,0)
 S DR="[PRCSEDS]" D ^DIE
"RTN","PRCEN",94,0)
REV W !!,"Would you like to review this request" S %=2 D YN^DICN G REV:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCEN",95,0)
OUT L -^PRCS(410,PRCSDA) Q
"RTN","PRCEN",96,0)
 ;
"RTN","PRCEN",97,0)
CHECK(PRC410) ; - Check out a 1358 410 entry for required fields
"RTN","PRCEN",98,0)
 N PRCX,PRC0,PRC11,PRCER,PRC3,PRC1
"RTN","PRCEN",99,0)
 Q:'$G(PRC410) -1
"RTN","PRCEN",100,0)
 ;
"RTN","PRCEN",101,0)
 ; get data
"RTN","PRCEN",102,0)
 F PRCX=0,1,3,11 S @("PRC"_PRCX)=$G(^PRCS(410,PRC410,PRCX))
"RTN","PRCEN",103,0)
 S PRCX=$G(^PRCS(410.9,$S(+$P(PRC11,"^",5):+$P(PRC11,"^",5),1:+$P(PRC11,"^",4)),0))
"RTN","PRCEN",104,0)
 S PRCER=0
"RTN","PRCEN",105,0)
 ;
"RTN","PRCEN",106,0)
 ; make sure I have a 1358
"RTN","PRCEN",107,0)
 I $P(PRC0,"^",4)'=1 Q 1
"RTN","PRCEN",108,0)
 ;
"RTN","PRCEN",109,0)
 ; start checking out data
"RTN","PRCEN",110,0)
 I '$D(^PRCS(410,PRC410,8,1,0)) D CKER("PURPOSE is Missing")
"RTN","PRCEN",111,0)
 ;
"RTN","PRCEN",112,0)
 ; done checking if not an obligation
"RTN","PRCEN",113,0)
 I $P(PRC0,"^",2)'="O" G CKEX
"RTN","PRCEN",114,0)
 ;
"RTN","PRCEN",115,0)
 ; continue checking
"RTN","PRCEN",116,0)
 I '$P(PRC11,"^",4) D CKER("AUTHORITY is Missing")
"RTN","PRCEN",117,0)
 I $P(PRC11,"^",5),'$D(^PRCS(410.9,"AC",$P(PRC11,"^",4),$P(PRC11,"^",5))) D CKER("SUB-AUTHORITY does not correspond to AUTHORITY")
"RTN","PRCEN",118,0)
 I '$P(PRC11,"^",5),$O(^PRCS(410.9,"AC",+$P(PRC11,"^",4),0)) D CKER("SUB-AUTHORITY is Missing")
"RTN","PRCEN",119,0)
 I $P(PRCX,"^",5),'$P(PRC3,"^",4) D CKER("VENDOR is Missing")
"RTN","PRCEN",120,0)
 I $P(PRCX,"^",6),'$L($P(PRC3,"^",10)) D CKER("CONTRACT is Missing")
"RTN","PRCEN",121,0)
 I '$P(PRC1,"^",6) D CKER("Service Start Date is Missing")
"RTN","PRCEN",122,0)
 I '$P(PRC1,"^",7) D CKER("Service End Date is Missing")
"RTN","PRCEN",123,0)
 ;
"RTN","PRCEN",124,0)
CKEX I PRCER S PRCER=0 F  S PRCER=$O(PRCER(PRCER)) Q:'PRCER  W !?5,PRCER(PRCER),"!!!"
"RTN","PRCEN",125,0)
 Q $S($O(PRCER(0)):0,1:1)
"RTN","PRCEN",126,0)
 ;
"RTN","PRCEN",127,0)
CKER(X) ;
"RTN","PRCEN",128,0)
 S PRCER=PRCER+1
"RTN","PRCEN",129,0)
 S PRCER(PRCER)=X
"RTN","PRCEN",130,0)
 Q
"RTN","PRCEN",131,0)
 ;
"RTN","PRCEN",132,0)
Q1358(PRCSTA,PRCFCP,PRCTT,PRCDA) ; Quit 1358 Process
"RTN","PRCEN",133,0)
 ; This API warns a control point offical that they will be set as
"RTN","PRCEN",134,0)
 ; the requestor on the 1358 and thus cannot also approve it.
"RTN","PRCEN",135,0)
 ; The API will return 1 (true) if the user decided to quit the
"RTN","PRCEN",136,0)
 ; current process before being set as the requestor.
"RTN","PRCEN",137,0)
 ;
"RTN","PRCEN",138,0)
 ; inputs
"RTN","PRCEN",139,0)
 ;   PRCSTA - station number
"RTN","PRCEN",140,0)
 ;   PRCFCP - fund control point
"RTN","PRCEN",141,0)
 ;   PRCTT  - (optional) transaction type, pass "A" for adjustment
"RTN","PRCEN",142,0)
 ;   PRCDA  - (optional) file 410 ien of 1358 when editing 1358
"RTN","PRCEN",143,0)
 ; returns boolean value (0 or 1)
"RTN","PRCEN",144,0)
 ;   = 0 to proceed with process
"RTN","PRCEN",145,0)
 ;   = 1 to quit process
"RTN","PRCEN",146,0)
 ;
"RTN","PRCEN",147,0)
 N RET
"RTN","PRCEN",148,0)
 S RET=0 ; init value to return
"RTN","PRCEN",149,0)
 ;
"RTN","PRCEN",150,0)
 ; if user is control point official for input station and FCP
"RTN","PRCEN",151,0)
 I $G(PRCSTA)]"",$G(PRCFCP)]"",$D(^PRC(420,"A",DUZ,PRCSTA,+PRCFCP,1)) D
"RTN","PRCEN",152,0)
 . N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PRCEN",153,0)
 . ;
"RTN","PRCEN",154,0)
 . ; don't warn when editing a 1358 if user is already the requestor
"RTN","PRCEN",155,0)
 . I $G(PRCDA),$P($G(^PRCS(410,PRCDA,7)),"^")=DUZ Q
"RTN","PRCEN",156,0)
 . ;
"RTN","PRCEN",157,0)
 . I $G(PRCTT)'="A" D
"RTN","PRCEN",158,0)
 . . W !,"WARNING: The system will assign you as the CP Clerk (Requestor) of this 1358."
"RTN","PRCEN",159,0)
 . . W !,"You will be unable to approve a 1358 on which you are the REQUESTOR due to"
"RTN","PRCEN",160,0)
 . . W !,"segregation of duties."
"RTN","PRCEN",161,0)
 . I $G(PRCTT)="A" D
"RTN","PRCEN",162,0)
 . . W !,"WARNING: The system will assign you as the CP Clerk (Requestor) of this 1358"
"RTN","PRCEN",163,0)
 . . W !,"Adjustment.  You will be unable to approve a 1358 Adjustment on which you"
"RTN","PRCEN",164,0)
 . . W !,"are the REQUESTOR due to segregation of duties."
"RTN","PRCEN",165,0)
 . ;
"RTN","PRCEN",166,0)
 . S DIR(0)="Y",DIR("A")="Do you want to proceed (Y/N)",DIR("B")="NO"
"RTN","PRCEN",167,0)
 . D ^DIR K DIR I $D(DIRUT)!'Y S RET=1
"RTN","PRCEN",168,0)
 . W !
"RTN","PRCEN",169,0)
 ;
"RTN","PRCEN",170,0)
 Q RET
"RTN","PRCEN",171,0)
COMCHK ;Check Committed Date to insure it is within the FY/FQ range during option entry for 'NEW 1358'    ;PRC*5.1*196
"RTN","PRCEN",172,0)
 N PRCDT,PRCDT1
"RTN","PRCEN",173,0)
 I '$D(PRC("BBFY"))!(+$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",12)>0)!($P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",3)["X") S PRC("BBFY")=PRC("FY")+2000
"RTN","PRCEN",174,0)
 S PRCCKERR=0,PRCDT=(PRC("BBFY")-1701)_$P("10:01:04:07",":",PRC("QTR"))_"01",PRCDT1=(PRC("BBFY")-1700)_"0930"
"RTN","PRCEN",175,0)
 I PRCCOMDT<PRCDT!(PRCCOMDT>PRCDT1) D
"RTN","PRCEN",176,0)
 . S PRCCKERR=1
"RTN","PRCEN",177,0)
 . W !!," ** Date Committed must be specified for time **",!," ** period covered by fiscal year ",PRC("BBFY"),"        **",!
"RTN","PRCEN",178,0)
 Q
"RTN","PRCEOB1")
0^3^B6964382
"RTN","PRCEOB1",1,0)
PRCEOB1 ;WISC/CTB/CLH-SUBROUTINES FOR PRCEOB ;2/10/92
"RTN","PRCEOB1",2,0)
V ;;5.1;IFCAP;**148,196**;Oct 20, 2000;Build 15
"RTN","PRCEOB1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCEOB1",4,0)
 ;
"RTN","PRCEOB1",5,0)
 ;PRC*5.1*196 Display Date Committed on Obligation display for 
"RTN","PRCEOB1",6,0)
 ;            obligator verification.
"RTN","PRCEOB1",7,0)
 ;
"RTN","PRCEOB1",8,0)
SCREEN D HILO^PRCFQ,SW,SC Q
"RTN","PRCEOB1",9,0)
 Q
"RTN","PRCEOB1",10,0)
SW ;SWITCH BOCS IF NECESSARY
"RTN","PRCEOB1",11,0)
 F I=6:1:9 S @("S"_I)=$P(TRNODE(3),"^",I)
"RTN","PRCEOB1",12,0)
 I S8=0!(S9=0) S S8="",S9=""
"RTN","PRCEOB1",13,0)
 I S6=0!(S7=0) S S6=S8,S7=S9,S8="",S9=""
"RTN","PRCEOB1",14,0)
 S $P(TRNODE(3),"^",6,9)=S6_"^"_S7_"^"_S8_"^"_S9 K S6,S7,S8,S9 Q
"RTN","PRCEOB1",15,0)
 ;
"RTN","PRCEOB1",16,0)
SC ;DISPLAY SCREEN
"RTN","PRCEOB1",17,0)
 W @IOF,!?15,"1358 TRANSACTION - ",IOINHI,$P(TRNODE(0),"^"),IOINLOW
"RTN","PRCEOB1",18,0)
 W !!,"  COST CENTER: ",IOINHI,+$P(TRNODE(3),"^",3),IOINLOW,?IOM-4\2,"AMOUNT: ",IOINHI,"$ ",$J($P(TRNODE(4),"^"),0,2)
"RTN","PRCEOB1",19,0)
 W !!,IOINLOW,"BOC #1: ",IOINHI,+$P(TRNODE(3),"^",6),IOINLOW,?IOM-10\2,"AMOUNT #1: ",IOINHI,"$ "_$J($P(TRNODE(3),"^",7),0,2)
"RTN","PRCEOB1",20,0)
 I $P(TRNODE(3),"^",8,9)'="^" W !!,IOINLOW,"BOC #2: ",IOINHI,+$P(TRNODE(3),"^",8),?IOM-10\2,IOINLOW,"AMOUNT #2: ",IOINHI,"$ "_$J($P(TRNODE(3),"^",9),0,2)
"RTN","PRCEOB1",21,0)
 W !!,IOINLOW,"AUTHORITY: ",IOINHI,$P($G(^PRCS(410.9,+$P($G(TRNODE(11)),"^",4),0)),"^")," ",$P($G(^(0)),"^",2)
"RTN","PRCEOB1",22,0)
 W:$P($G(TRNODE(11)),"^",5) !,IOINLOW,"SUB: ",IOINHI,$P($G(^PRCS(410.9,+$P($G(TRNODE(11)),"^",5),0)),"^")," ",$P($G(^(0)),"^",2)
"RTN","PRCEOB1",23,0)
 W !,IOINLOW,"DATE REQUIRED: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(1)),"^",4))      ;PRC*5.1*196
"RTN","PRCEOB1",24,0)
 W !,IOINLOW,"DATE COMMITTED: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(4)),"^",2))      ;PRC*5.1*196
"RTN","PRCEOB1",25,0)
 W !,IOINLOW,"SERVICE START DATE: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(1)),"^",6))
"RTN","PRCEOB1",26,0)
 W !,IOINLOW,"SERVICE END DATE: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(1)),"^",7))
"RTN","PRCEOB1",27,0)
 W IOINORM Q:'$D(^PRCS(410,PRCFA("TRDA"),8,0))#2  W !!,IOINHI K ^UTILITY($J,"W") S DIWF="W",DIWL=1,DIWR=IOM*.75\1,N=0 F I=1:1 S N=$O(^PRCS(410,PRCFA("TRDA"),8,N)) Q:'N  S X=^(N,0) D DIWP^PRCUTL($G(DA))
"RTN","PRCEOB1",28,0)
 D ^DIWW,DIWKILL^PRCFQ W IOINORM Q
"RTN","PRCEOB1",29,0)
 S $P(^PRC(424,DA,0),"^",2,14)=X,DIK="^PRC(424," D IX1^DIK K DIK S %=1 Q
"RTN","PRCFFU")
0^7^B39785146
"RTN","PRCFFU",1,0)
PRCFFU ;WISC/SJG-CONTINUATION OF OBLIGATION PROCESSING ;7/21/93  13:51
"RTN","PRCFFU",2,0)
V ;;5.1;IFCAP;**196**;Oct 20, 2000;Build 15
"RTN","PRCFFU",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCFFU",4,0)
 ;
"RTN","PRCFFU",5,0)
 ;PRC*5.1*196 Send order obligation date to GECS for creation
"RTN","PRCFFU",6,0)
 ;            of the SO document CTL segment with correct date
"RTN","PRCFFU",7,0)
 QUIT
"RTN","PRCFFU",8,0)
 ; No top level entry point
"RTN","PRCFFU",9,0)
OKAY ;
"RTN","PRCFFU",10,0)
 S DIR(0)="Y",DIR("A",1)="The information listed above is recorded on this "_PRCFA("IDES")_"."
"RTN","PRCFFU",11,0)
 S DIR("A")="Is the above information correct",DIR("B")="YES"
"RTN","PRCFFU",12,0)
 S DIR("?")="Enter 'NO' or 'N' to edit the Cost Center or BOC."
"RTN","PRCFFU",13,0)
 S DIR("?",1)="Enter '^' to exit this option."
"RTN","PRCFFU",14,0)
 S DIR("?",2)="Enter 'YES' or 'Y' or 'RETURN' to continue processing this obligation."
"RTN","PRCFFU",15,0)
 D ^DIR K DIR
"RTN","PRCFFU",16,0)
 QUIT
"RTN","PRCFFU",17,0)
 ;
"RTN","PRCFFU",18,0)
OKAY2 ;
"RTN","PRCFFU",19,0)
 S DIR(0)="Y",DIR("A")="OK to Continue",DIR("B")="YES"
"RTN","PRCFFU",20,0)
 S DIR("?")="Enter 'NO' or 'N' or '^' to exit this option."
"RTN","PRCFFU",21,0)
 S DIR("?",1)="Enter 'YES' or 'Y' or 'RETURN' to continue processing this obligation."
"RTN","PRCFFU",22,0)
 D ^DIR K DIR
"RTN","PRCFFU",23,0)
 QUIT
"RTN","PRCFFU",24,0)
 ;
"RTN","PRCFFU",25,0)
EDIT ; Set up PRCFMO array to indicate required FMS fields
"RTN","PRCFFU",26,0)
 S PARAM1="^"_PRC("SITE")_"^"_+$P(PO(0),U,3)_"^"_PRC("FY")_"^"_PRCFA("BBFY")
"RTN","PRCFFU",27,0)
 ; build PRCFMO array to use when creating LIN string of FMS transaction
"RTN","PRCFFU",28,0)
 ; PARAM1=^STATION^FCP^FY^BBFY
"RTN","PRCFFU",29,0)
 ; SPE means spending documents
"RTN","PRCFFU",30,0)
 D DOCREQ^PRC0C(PARAM1,"SPE","PRCFMO")
"RTN","PRCFFU",31,0)
 S PRCFMO("G/N")=$P(PRCFMO,U,12)
"RTN","PRCFFU",32,0)
 QUIT
"RTN","PRCFFU",33,0)
 ;
"RTN","PRCFFU",34,0)
GO ; Prompt user for final go-ahead for the document creation
"RTN","PRCFFU",35,0)
 S PRCFA("FDES")=$S(PRCFA("TT")="MO":"Miscellaneous Order (MO)",PRCFA("TT")="SO":"Service (SO) Order",PRCFA("TT")="AR":"Receiver Accrual (AR)")
"RTN","PRCFFU",36,0)
 N POSIT S POSIT=$F(PRCFA("FDES"),"(")
"RTN","PRCFFU",37,0)
 S PRCFA("TYPE")=$E(PRCFA("FDES"),POSIT,POSIT+1)
"RTN","PRCFFU",38,0)
 S DIR(0)="Y"
"RTN","PRCFFU",39,0)
 S DIR("A")="Transmit this Document to FMS"
"RTN","PRCFFU",40,0)
 S DIR("B")="YES"
"RTN","PRCFFU",41,0)
 S DIR("A",1)=" "
"RTN","PRCFFU",42,0)
 S DIR("A",2)="This "_PRCFA("IDES")_" will now generate the "
"RTN","PRCFFU",43,0)
 S DIR("A",3)=$P(PRCFA("MOD"),U,3)_" "_PRCFA("FDES")_" Document.  The "_PRCFA("TYPE")_" Document"
"RTN","PRCFFU",44,0)
 S DIR("A",4)="will be marked for transmission to FMS."
"RTN","PRCFFU",45,0)
 S DIR("A",5)=" "
"RTN","PRCFFU",46,0)
 S DIR("?")="Enter 'NO' or 'N' or '^' to exit this option."
"RTN","PRCFFU",47,0)
 S DIR("?",1)="Enter 'YES' or 'Y' or 'RETURN' to transmit this Document."
"RTN","PRCFFU",48,0)
 D ^DIR K DIR
"RTN","PRCFFU",49,0)
 QUIT
"RTN","PRCFFU",50,0)
 ;
"RTN","PRCFFU",51,0)
STACK(MOD) ; Create entry in GECS Stack File
"RTN","PRCFFU",52,0)
 I $D(PRCFA("CONVS")),PRCFA("CONVS")=1 G STACK1
"RTN","PRCFFU",53,0)
 I $D(PRCFA("CONVG")),PRCFA("CONVG")=1 G STACK1
"RTN","PRCFFU",54,0)
 W !!,"...now generating the FMS "
"RTN","PRCFFU",55,0)
 W $S(PRCFA("TT")="MO":"Miscellaneous Order (MO) Document",PRCFA("TT")="SO":"Service Order (SO) Document",PRCFA("TT")="AR":"Receiver Accrual (AR) Document",1:"Document")
"RTN","PRCFFU",56,0)
 W "...",! D WAIT^DICD
"RTN","PRCFFU",57,0)
STACK1 N FMSSYS,FMSSTA,FMSDOC,FMSTRA,FMSSEC,FMSMOD,FMSFCP,FMSDES,FMSCOMDT
"RTN","PRCFFU",58,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 Q
"RTN","PRCFFU",59,0)
 K GECSUFMS("DA") ; delete current ien to get new ien
"RTN","PRCFFU",60,0)
 S FMSDES=PRCFA("IDES")
"RTN","PRCFFU",61,0)
 S FMSDOC=PRCFA("REF")
"RTN","PRCFFU",62,0)
 S FMSMOD=MOD
"RTN","PRCFFU",63,0)
 I PRCFA("TT")="AR" D
"RTN","PRCFFU",64,0)
 . S FMSDOC=FMSDOC_12
"RTN","PRCFFU",65,0)
 . S FMSMOD=1
"RTN","PRCFFU",66,0)
 S FMSSEC=$$SEC1^PRC0C(PRC("SITE"))
"RTN","PRCFFU",67,0)
 S FMSSTA=PRC("SITE")
"RTN","PRCFFU",68,0)
 S FMSSYS="I"
"RTN","PRCFFU",69,0)
 S FMSTRA=PRCFA("TT")
"RTN","PRCFFU",70,0)
 S FMSCOMDT=PRCFA("OBLDATE")        ;PRC*5.1*196
"RTN","PRCFFU",71,0)
 D CONTROL^GECSUFMS(FMSSYS,FMSSTA,FMSDOC,FMSTRA,FMSSEC,FMSMOD,"Y",FMSDES,FMSCOMDT)
"RTN","PRCFFU",72,0)
 QUIT
"RTN","PRCFFU",73,0)
 ;
"RTN","PRCFFU",74,0)
OKAM ; Reader for prompt to approve amendment
"RTN","PRCFFU",75,0)
 S DIR(0)="Y"
"RTN","PRCFFU",76,0)
 S DIR("A",1)="The information listed above is recorded on this Purchase Order amendment."
"RTN","PRCFFU",77,0)
 S DIR("A")="Are you ready to approve and obligate this amendment"
"RTN","PRCFFU",78,0)
 S DIR("B")="YES"
"RTN","PRCFFU",79,0)
 S DIR("?")="Enter 'NO' or 'N' or '^' to exit this option."
"RTN","PRCFFU",80,0)
 S DIR("?",1)="Enter 'YES' or 'Y' or 'RETURN' to continue processing this amendment obligation."
"RTN","PRCFFU",81,0)
 D ^DIR K DIR
"RTN","PRCFFU",82,0)
 QUIT
"RTN","PRCFFU",83,0)
 ;
"RTN","PRCFFU",84,0)
OKAPP ; Reader for prompt that amendment has already been approved
"RTN","PRCFFU",85,0)
 S DIR(0)="Y"
"RTN","PRCFFU",86,0)
 S DIR("A",1)="This amendment has already been approved by Fiscal."
"RTN","PRCFFU",87,0)
 S DIR("A")="Are you sure that you wish to continue"
"RTN","PRCFFU",88,0)
 S DIR("B")="NO"
"RTN","PRCFFU",89,0)
 S DIR("?")="Enter 'YES' or 'Y' to continue."
"RTN","PRCFFU",90,0)
 S DIR("?",1)="Enter 'NO' or 'N' or '^' or 'RETURN' to exit this option."
"RTN","PRCFFU",91,0)
 D ^DIR K DIR
"RTN","PRCFFU",92,0)
 QUIT
"RTN","PRCFFU",93,0)
 ;
"RTN","PRCFFU",94,0)
OKPRT ; Reader to prompt user to print the amendment
"RTN","PRCFFU",95,0)
 S DIR(0)="Y"
"RTN","PRCFFU",96,0)
 S DIR("A")="Would you like to print this amendment"
"RTN","PRCFFU",97,0)
 S DIR("B")="YES"
"RTN","PRCFFU",98,0)
 S DIR("?")="Enter 'YES' or 'Y' or 'RETURN' to print this amendment."
"RTN","PRCFFU",99,0)
 S DIR("?",1)="Enter 'NO' or 'N' or '^' if printing in not desired."
"RTN","PRCFFU",100,0)
 D ^DIR K DIR
"RTN","PRCFFU",101,0)
 QUIT
"RTN","PRCFFU",102,0)
 ;
"RTN","PRCFFU",103,0)
REVIEW ; Reader to prompt user to review the PO before obligation
"RTN","PRCFFU",104,0)
 N LABEL S LABEL=$S((PRCFA("MP")=1)!(PRCFA("MP")=2):"Purchase Order",PRCFA("MP")=8:"Requisition",1:"Purchase Order")
"RTN","PRCFFU",105,0)
 S DIR(0)="Y"
"RTN","PRCFFU",106,0)
 S DIR("A")="Would you like to review the entire "_LABEL
"RTN","PRCFFU",107,0)
 S DIR("B")="YES"
"RTN","PRCFFU",108,0)
 S DIR("?")="Enter 'NO' or 'N' or '^' if the "_LABEL_" review is not necessary."
"RTN","PRCFFU",109,0)
 S DIR("?",1)="Enter 'YES' or 'Y' or 'RETURN' to display the "_LABEL_"."
"RTN","PRCFFU",110,0)
 D ^DIR K DIR
"RTN","PRCFFU",111,0)
 Q
"RTN","PRCFFU",112,0)
 ;
"RTN","PRCFFU",113,0)
 ; PO is the ien of the 443.6 file
"RTN","PRCFFU",114,0)
 ; AMNUM is the amendment number
"RTN","PRCFFU",115,0)
CHKAMEN(PO,AMNUM) ; checks PO completeness, looks for missing data 
"RTN","PRCFFU",116,0)
 N CNT,J,INUM,CHNG,STARTFLG,TYPAM,MSG,PRPAYFLG
"RTN","PRCFFU",117,0)
 S CNT=0
"RTN","PRCFFU",118,0)
 S STARTFLG=0
"RTN","PRCFFU",119,0)
 S PRPAYFLG=0
"RTN","PRCFFU",120,0)
 F CHNG=0:0 S CHNG=$O(^PRC(443.6,+PO,6,AMNUM,3,CHNG)) Q:CHNG'>0  D
"RTN","PRCFFU",121,0)
 . S CHNG=^(CHNG,0)
"RTN","PRCFFU",122,0)
 . ;
"RTN","PRCFFU",123,0)
 . ;Has the data in any of the following fields been deleted?
"RTN","PRCFFU",124,0)
 . ;Ship To Address, Inv. Address, Prompt Pay. Terms, or F.O.B.Point.
"RTN","PRCFFU",125,0)
 . S TYPAM=$P($G(CHNG),U,2)
"RTN","PRCFFU",126,0)
 . I TYPAM=20,$P(^PRC(443.6,+PO,1),U,3)="" D
"RTN","PRCFFU",127,0)
 . . S MSG="Ship To Address."
"RTN","PRCFFU",128,0)
 . . S $P(^PRC(443.6,+PO,1),U,3)=$P(^PRC(442,+PO,1),U,3)
"RTN","PRCFFU",129,0)
 . I TYPAM=25,$P(^PRC(443.6,+PO,12),U,6)="" D
"RTN","PRCFFU",130,0)
 . . S MSG="Invoice Address."
"RTN","PRCFFU",131,0)
 . . S $P(^PRC(443.6,+PO,12),U,6)=$P(^PRC(442,+PO,12),U,6)
"RTN","PRCFFU",132,0)
 . I TYPAM=33,^PRC(443.6,+PO,5,0)="" D
"RTN","PRCFFU",133,0)
 . . S MSG="Prompt Payment Terms."
"RTN","PRCFFU",134,0)
 . . S ^PRC(443.6,+PO,5,0)=^PRC(442,+PO,5,0)
"RTN","PRCFFU",135,0)
 . . S I=0 F J=0:0 S I=$O(^PRC(443.6,+PO,5,I)) Q:I=""  S ^PRC(443.6,+PO,5,I,0)=^PRC(442,+PO,5,I,0)
"RTN","PRCFFU",136,0)
 . . Q
"RTN","PRCFFU",137,0)
 . I TYPAM=35,$P(^PRC(443.6,+PO,1),U,6)="" D
"RTN","PRCFFU",138,0)
 . . S MSG="F.O.B. Point."
"RTN","PRCFFU",139,0)
 . . S $P(^PRC(443.6,+PO,1),U,6)=$P(^PRC(442,+PO,1),U,6)
"RTN","PRCFFU",140,0)
 . I $G(MSG)]"" D
"RTN","PRCFFU",141,0)
 . . I TYPAM=33&'PRPAYFLG!(TYPAM'=33) W !?10,"This amendment is missing it's ",MSG,"!" K MSG
"RTN","PRCFFU",142,0)
 . . I TYPAM=33 S PRPAYFLG=1
"RTN","PRCFFU",143,0)
 . . S STARTFLG=1
"RTN","PRCFFU",144,0)
 . Q
"RTN","PRCFFU",145,0)
 . ;
"RTN","PRCFFU",146,0)
 . I $P($P(CHNG,U,3),":",2)=40,($P($P(CHNG,U,3),";"))=1 S INUM=$P(CHNG,U,4) I $G(INUM)]"" D
"RTN","PRCFFU",147,0)
 . . ; for each item , check description
"RTN","PRCFFU",148,0)
 . . S J=0 S J=$O(^PRC(443.6,+PO,2,INUM,1,J)) I J>0&(^(J,0)="") D
"RTN","PRCFFU",149,0)
 . . . I CNT>22 N DIR S DIR(0)="E" D ^DIR S CNT=0
"RTN","PRCFFU",150,0)
 . . . W !,?10,"Line item ",INUM," is missing it's description!"
"RTN","PRCFFU",151,0)
 . . . S CNT=CNT+2,STARTFLG=1
"RTN","PRCFFU",152,0)
 . . . Q
"RTN","PRCFFU",153,0)
 . . Q
"RTN","PRCFFU",154,0)
 . Q
"RTN","PRCFFU",155,0)
 Q STARTFLG
"RTN","PRCFFU8")
0^9^B14240820
"RTN","PRCFFU8",1,0)
PRCFFU8 ;WISC/SJG-OBLIGATION PROCESSING UTILITIES, CON'T ;5/17/09  23:39
"RTN","PRCFFU8",2,0)
 ;;5.1;IFCAP;**130,196**;Oct 20, 2000;Build 15
"RTN","PRCFFU8",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCFFU8",4,0)
 ;
"RTN","PRCFFU8",5,0)
 ;PRC*5.1*196 Send order obligation date to GECS for creation
"RTN","PRCFFU8",6,0)
 ;            of the SO document CTL segment with correct date for 
"RTN","PRCFFU8",7,0)
 ;            Cancel doc and Decrease Adj doc or when
"RTN","PRCFFU8",8,0)
 ;            amending a vendor.
"RTN","PRCFFU8",9,0)
 ;
"RTN","PRCFFU8",10,0)
 ; No Top Level Entry
"RTN","PRCFFU8",11,0)
 QUIT
"RTN","PRCFFU8",12,0)
MSG ;
"RTN","PRCFFU8",13,0)
 W !!,"This Purchase Order Amendment will not require a Modification "
"RTN","PRCFFU8",14,0)
 W:PRCFA("TT")="MO" !,"Miscellaneous Order (MO) "
"RTN","PRCFFU8",15,0)
 W:PRCFA("TT")="SO" !,"Service Order (SO) "
"RTN","PRCFFU8",16,0)
 W "Document for the following reason(s):"
"RTN","PRCFFU8",17,0)
 W !!,"The Amendment consisted of: "
"RTN","PRCFFU8",18,0)
 I $D(PRCFA("SHIP")),PRCFA("SHIP")]"" W ?30,PRCFA("SHIP"),!
"RTN","PRCFFU8",19,0)
 I $D(PRCFA("SOURCE")),PRCFA("SOURCE")]"" W ?30,PRCFA("SOURCE"),!
"RTN","PRCFFU8",20,0)
 I $D(PRCFA("MAIL")),PRCFA("MAIL")]"" W ?30,PRCFA("MAIL"),!
"RTN","PRCFFU8",21,0)
 I $D(PRCFA("ADMADD")),PRCFA("ADMADD")]"" W ?30,PRCFA("ADMADD"),!
"RTN","PRCFFU8",22,0)
 I $D(PRCFA("ADMDEL")),PRCFA("ADMDEL")]"" W ?30,PRCFA("ADMDEL"),!
"RTN","PRCFFU8",23,0)
 I $D(PRCFA("AUTH")),PRCFA("AUTH")]"" W ?30,PRCFA("AUTH"),!
"RTN","PRCFFU8",24,0)
 I $D(PRCFA("ZERO")),PRCFA("ZERO")]"" W ?30,PRCFA("ZERO"),! H 3
"RTN","PRCFFU8",25,0)
 I $D(PRCFA("WASH")),PRCFA("WASH")]"" W ?30,PRCFA("WASH"),! H 3
"RTN","PRCFFU8",26,0)
 W !!,"No Modification FMS Document has been transmitted!!" H 3
"RTN","PRCFFU8",27,0)
 QUIT
"RTN","PRCFFU8",28,0)
 ;
"RTN","PRCFFU8",29,0)
CANCEL(REF,TYPE) ; Cancel FMS Obligation Documents
"RTN","PRCFFU8",30,0)
 ; REF - PAT Reference Number
"RTN","PRCFFU8",31,0)
 ; TYPE - FMS Transaction Type
"RTN","PRCFFU8",32,0)
 ; DATA - MO2 Segment
"RTN","PRCFFU8",33,0)
 N DATA,FMSCOMDT       ;PRC*5.1*196
"RTN","PRCFFU8",34,0)
 S FMSCOMDT=PRCFA("OBLDATE")    ;PRC*5.1*196
"RTN","PRCFFU8",35,0)
 S (PRCFA("MOD"),PRCFA("CANCEL"))="X^2^Cancellation Entry"
"RTN","PRCFFU8",36,0)
 S FMSMOD=$P(PRCFA("MOD"),U)
"RTN","PRCFFU8",37,0)
 I PRCFA("TT")="AR",$E(REF,11,12)'=12 S REF=$E(REF,1,10)_12
"RTN","PRCFFU8",38,0)
 S FMSSEC=$$SEC1^PRC0C(PRC("SITE"))
"RTN","PRCFFU8",39,0)
 I TYPE="AR" D CANC S TYPE="SO",REF=$E(REF,1,10)
"RTN","PRCFFU8",40,0)
 D:$G(MTOPDA)="" DEC,CANC Q
"RTN","PRCFFU8",41,0)
DEC ;
"RTN","PRCFFU8",42,0)
 Q:XRBLD=2  ; exit if rebuilding the 'E' (amended original) transaction
"RTN","PRCFFU8",43,0)
 W !!,"...now generating the FMS Decrease "_TYPE_" Obligation Document..."
"RTN","PRCFFU8",44,0)
 S FMSDES="Decrease Obligation Amount of "_TYPE_" Obligation Document"
"RTN","PRCFFU8",45,0)
 I XRBLD=0 D CONTROL^GECSUFMS("I",PRC("SITE"),REF,TYPE,FMSSEC,1,"Y",FMSDES,FMSCOMDT)    ;PRC*5.1*196
"RTN","PRCFFU8",46,0)
 S DATA=$$SEG2^PRCFFU8("X^"_TYPE,POIEN,.SEG)
"RTN","PRCFFU8",47,0)
 D GECS
"RTN","PRCFFU8",48,0)
 S PRCFA("PODA")=PRCFA("OLDPODA")
"RTN","PRCFFU8",49,0)
 I '$D(POESIG) I $D(PRCFA("PODA")),+PRCFA("PODA")>0 S POESIG=1
"RTN","PRCFFU8",50,0)
 N FMSDOCT S FMSDOCT=$P(PRCFA("REF"),"-",2)
"RTN","PRCFFU8",51,0)
 D EN7^PRCFFU41(TYPE,FMSMOD,PRCFA("OBLDATE"),FMSDOCT)
"RTN","PRCFFU8",52,0)
 Q
"RTN","PRCFFU8",53,0)
CANC ;
"RTN","PRCFFU8",54,0)
 Q:XRBLD=2
"RTN","PRCFFU8",55,0)
 W !!,"...now generating the FMS "_TYPE_" Cancellation Document..."
"RTN","PRCFFU8",56,0)
 S FMSDES="Cancellation of "_TYPE_" Obligation Document"
"RTN","PRCFFU8",57,0)
 I XRBLD=0 D CONTROL^GECSUFMS("I",PRC("SITE"),REF,TYPE,FMSSEC,1,"Y",FMSDES,FMSCOMDT)   ;PRC*5.1*196
"RTN","PRCFFU8",58,0)
 S DATA=$$SEG2^PRCFFU8("X^"_TYPE,POIEN,.SEG)
"RTN","PRCFFU8",59,0)
 D GECS
"RTN","PRCFFU8",60,0)
 S PRCFA("PODA")=PRCFA("OLDPODA")
"RTN","PRCFFU8",61,0)
 I '$D(POESIG) I $D(PRCFA("PODA")),+PRCFA("PODA")>0 S POESIG=1
"RTN","PRCFFU8",62,0)
 N FMSDOCT S FMSDOCT=$P(PRCFA("REF"),"-",2)
"RTN","PRCFFU8",63,0)
 D EN7^PRCFFU41(TYPE,FMSMOD,PRCFA("OBLDATE"),FMSDOCT)
"RTN","PRCFFU8",64,0)
 Q
"RTN","PRCFFU8",65,0)
 ;
"RTN","PRCFFU8",66,0)
GECS ; Common GECS processing for 'X' documents
"RTN","PRCFFU8",67,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),DATA)
"RTN","PRCFFU8",68,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCFFU8",69,0)
 N P2 S P2=+PO_"/"_PRCFA("AMEND#"),$P(P2,"/",5)=$P($G(PRCFA("ACCPD")),U),$P(P2,"/",6)=PRCFA("OBLDATE")
"RTN","PRCFFU8",70,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),P2)
"RTN","PRCFFU8",71,0)
 Q
"RTN","PRCFFU8",72,0)
SEG2(TYPE,IEN,SEG) ; Create MO2 segment for cancellation document
"RTN","PRCFFU8",73,0)
 ; IEN - Internal Entry Number of Purchase Order
"RTN","PRCFFU8",74,0)
 ; TYPE - FMS Document Type 
"RTN","PRCFFU8",75,0)
 ; SEG - Return value for MO2 segment
"RTN","PRCFFU8",76,0)
 D GENDIQ^PRCFFU7(442,IEN,.1,"I","")
"RTN","PRCFFU8",77,0)
 S FMSPODAT=$G(PRCFA("OBLDATE"))
"RTN","PRCFFU8",78,0)
 I FMSPODAT="" D NOW^%DTC S FMSPODAT=X
"RTN","PRCFFU8",79,0)
 D DATE^PRCFFU2(FMSPODAT,.A,.B,.C)
"RTN","PRCFFU8",80,0)
 S FMSPODAT=FMSYR_"^"_FMSMO_"^"_FMSDAY
"RTN","PRCFFU8",81,0)
 I $P(TYPE,"^",2)="AR" S SEG="RC2",$P(SEG,U,7)=$P(TYPE,"^",1)_"^~"
"RTN","PRCFFU8",82,0)
 E  S SEG="MO2",$P(SEG,U,10)=$P(TYPE,"^",1)_"^~"
"RTN","PRCFFU8",83,0)
 S $P(SEG,"^",2,4)=FMSPODAT
"RTN","PRCFFU8",84,0)
 I $P(TYPE,"^",2)="SO",PRCFA("MP")=2 S $P(SEG,U,11)="C"
"RTN","PRCFFU8",85,0)
 S:$P(SEG,U,$L(SEG,U))'="~" SEG=SEG_"^~"
"RTN","PRCFFU8",86,0)
 K PRCTMP
"RTN","PRCFFU8",87,0)
 QUIT SEG
"RTN","PRCHNPO4")
0^8^B67972862
"RTN","PRCHNPO4",1,0)
PRCHNPO4 ;WOIFO/RSD/RHD-CONT. OF NEW PO--COMPLETE PROCESSING IN SUPPLY ;4/22/98  06:21
"RTN","PRCHNPO4",2,0)
V ;;5.1;IFCAP;**51,56,81,79,196**;Oct 20, 2000;Build 15
"RTN","PRCHNPO4",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCHNPO4",4,0)
 ;
"RTN","PRCHNPO4",5,0)
 ;PRC*5.1*196 Modified check for only PCard orders to insure ALL
"RTN","PRCHNPO4",6,0)
 ;            orders have FCP monies available for the order,
"RTN","PRCHNPO4",7,0)
 ;            and, if not, the FCP Overcommit switch set to ON.
"RTN","PRCHNPO4",8,0)
 ;
"RTN","PRCHNPO4",9,0)
PHA S ERROR="" I $G(PRCHPC)'=1 D NEW^PRCOEDC(PRCHPO,.ERROR) I ERROR'="" W !!?5,"Procurement History transaction error " G ERR^PRCHNPO
"RTN","PRCHNPO4",10,0)
 N RBD,RBDT,RBQT,RBFY,CCHK,FCHK,REFMOP S REFMOP=$P($G(^PRC(442,PRCHPO,0)),U,2)
"RTN","PRCHNPO4",11,0)
 S RBDT=$$DATE^PRC0C($P($G(^PRC(442,PRCHPO,1)),U,15),"I"),RBFY=$E(RBDT,3,4),RBQT=$P(RBDT,"^",2),RBD=$$QTRDATE^PRC0D(RBFY,RBQT),RBD=$P(RBD,"^",7)   ;PRC*5.1*196
"RTN","PRCHNPO4",12,0)
 S PRC("CP")=$P($G(^PRC(442,PRCHPO,0)),"^",3)
"RTN","PRCHNPO4",13,0)
 S CCHK=$P($G(^PRC(442,PRCHPO,0)),U,15)
"RTN","PRCHNPO4",14,0)
 I $G(PRCHPC)="",CCHK'="" N BRCHK,BRCOST S BRCHK=$P($G(^PRC(442,PRCHPO,0)),"^",12),BRCOST=$P($G(^PRCS(410,+BRCHK,4)),"^") S:BRCOST'="" CCHK=CCHK-BRCOST
"RTN","PRCHNPO4",15,0)
 S FCHK=$$OVCOM^PRCS0A(PRC("SITE")_"^"_PRC("CP")_"^"_$P($$DATE^PRC0C(RBD,"I"),"^",1,2),CCHK,2) I FCHK'=0 W !,"Insufficient funds for this request." H 2 G ERR^PRCHNPO   ;PRC*5.1*196
"RTN","PRCHNPO4",16,0)
 I $P($G(^PRC(442,PRCHPO,0)),U,2)=25 S FILE=442 D LIMIT^PRCHCD0 I $G(ERROR) K FILE,ERROR G ERR^PRCHNPO
"RTN","PRCHNPO4",17,0)
 ;I $G(PRCHPC)=2 S $P(^PRC(442,PRCHPO,0),U,15)=PRCHTAMT
"RTN","PRCHNPO4",18,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="D" D  G:$G(ERROR)=1 ERR^PRCHNPO
"RTN","PRCHNPO4",19,0)
 . S PRCHITM=0 F  S PRCHITM=$O(^PRC(442,PRCHPO,2,PRCHITM)) Q:'PRCHITM  I $P($G(^PRC(442,PRCHPO,2,PRCHITM,2)),U,2)="" W !!,?5,"One or more of the items on this delivery order",!,?5,"does not contain contract number." S ERROR=1
"RTN","PRCHNPO4",20,0)
 ;
"RTN","PRCHNPO4",21,0)
 ; New check for FPDS, PRC*5.1*79
"RTN","PRCHNPO4",22,0)
 ; Check Detailed PC orders with source code 6 and contract items only
"RTN","PRCHNPO4",23,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="P"&($P($G(^PRC(442,PRCHPO,1)),U,7)=6) D  G:$G(ERROR)=1 ERR^PRCHNPO
"RTN","PRCHNPO4",24,0)
 . S PRCHITM=0 F  S PRCHITM=$O(^PRC(442,PRCHPO,2,PRCHITM)) Q:'PRCHITM  I $P($G(^PRC(442,PRCHPO,2,PRCHITM,2)),U,2)="" W !!,?5,"Line item "_PRCHITM_" on this purchase card order",!,?5,"does not contain a required contract number." S ERROR=1
"RTN","PRCHNPO4",25,0)
 D EN105^PRCHNPO7 G:$G(ERROR)=1 ERR^PRCHNPO
"RTN","PRCHNPO4",26,0)
 ; End of new check for FPDS
"RTN","PRCHNPO4",27,0)
 ;
"RTN","PRCHNPO4",28,0)
FS S PRCHN("SFC")=$P(^PRC(442,PRCHPO,0),U,19)
"RTN","PRCHNPO4",29,0)
 ; SET STATUS TO 'Ordered (no Fiscal Action Required)' IF IMPREST FUNDS METHOD OF PROCESSING, OR IF SPECIAL CONTROL POINT FOR SUPPLY FUND (POSTED).
"RTN","PRCHNPO4",30,0)
 ; SET STATUS TO 'Transaction Complete' FOR CERTIFIED INVOICES ORDERED FOR SUPPLY FUND.
"RTN","PRCHNPO4",31,0)
 ; SET STATUS TO 'Pending Fiscal Action' OTHERWISE.
"RTN","PRCHNPO4",32,0)
 S PRCHSTAT=10,%A="Send to Fiscal Service"
"RTN","PRCHNPO4",33,0)
 I PRCHN("SFC")=2!(PRCHN("MP")=25) S PRCHSTAT=22,%A="Print Purchase Order"
"RTN","PRCHNPO4",34,0)
 S FILE=442 D:$D(PRCHPO) CHECK^PRCHSWCH
"RTN","PRCHNPO4",35,0)
 I $G(PRCHOBL)=1 S PRCHSTAT=22,%A="Print Purchase Order "
"RTN","PRCHNPO4",36,0)
 I PRCHN("MP")=2,PRCHN("SFC")=2 S PRCHSTAT=40
"RTN","PRCHNPO4",37,0)
 ;
"RTN","PRCHNPO4",38,0)
ASK I '$G(PRCHPC),'$G(PRCHDELV) D  G Q:%=2&(PRCHN("MP")'=25)!(%<0),FS:%=0
"RTN","PRCHNPO4",39,0)
 . W ! S %A="     "_%A,%B="",%=1 D ^PRCFYN
"RTN","PRCHNPO4",40,0)
 . S NOPRINT="" I %=2 S NOPRINT=1
"RTN","PRCHNPO4",41,0)
 S P=+$P($G(^PRC(442,PRCHPO,1)),U,10),DA=PRCHPO
"RTN","PRCHNPO4",42,0)
 I 'P W !!,"P.O. is missing the Purchasing Agent and must be re-edited !",$C(7) G Q
"RTN","PRCHNPO4",43,0)
 I P'=DUZ W !!,"You must be the Purchasing Agent listed on P.O. to sign it.",$C(7) S DIR(0)="EAO",DIR("A")="Press <Return> to continue " D ^DIR K DIR(0),DIR("A") G Q
"RTN","PRCHNPO4",44,0)
 I $G(PRCHPHAM),$P(^PRC(442,PRCHPO,0),U,15)=0 D  G:%'=1 ERR^PRCHNPO
"RTN","PRCHNPO4",45,0)
 . W !!,?5,"This pharmacy order is a no charge order." S %A="     Would you like to sign this order",%B="",%=2 D ^PRCFYN
"RTN","PRCHNPO4",46,0)
 S X=$P($G(^PRC(442,PRCHPO,1)),U)
"RTN","PRCHNPO4",47,0)
 ;
"RTN","PRCHNPO4",48,0)
 ; Begin modifications for PRC*5.1*56
"RTN","PRCHNPO4",49,0)
 I X]"",$P($G(^PRC(440,X,3)),U,2)="Y",";P;S;"[(";"_$P($G(^PRC(442,PRCHPO,23)),U,11)_";") D
"RTN","PRCHNPO4",50,0)
 . S MSG1="                   This order will not be sent via EDI."
"RTN","PRCHNPO4",51,0)
 . S MSG2="To place a Purchase Card order via EDI please use the Purchasing Agent Menu."
"RTN","PRCHNPO4",52,0)
 . W !!!,"                           ***** TAKE NOTE *****"
"RTN","PRCHNPO4",53,0)
 . W !!,?2,MSG1,!!,MSG2,!!
"RTN","PRCHNPO4",54,0)
 . K MSG1,MSG2
"RTN","PRCHNPO4",55,0)
 . Q
"RTN","PRCHNPO4",56,0)
 ; End modifications for PRC*5.1*56
"RTN","PRCHNPO4",57,0)
 I X]"",$P($G(^PRC(440,X,3)),U,2)="Y",";P;S;"'[(";"_$P($G(^PRC(442,PRCHPO,23)),U,11)_";") D  G:$G(X)="ABORT" Q I $D(DTOUT)!$D(Y) W $C(7),!!,"The 'Do You Want to Send This EDI?' question was bypassed - You must reedit PO" K DTOUT G Q
"RTN","PRCHNPO4",58,0)
 . N PRCY S PRCY=""
"RTN","PRCHNPO4",59,0)
 . I $P($G(^PRC(442,PRCHPO,0)),U,2)=25 D
"RTN","PRCHNPO4",60,0)
 . . N PRCX
"RTN","PRCHNPO4",61,0)
 . . S PRCX=$P($G(^PRC(442,PRCHPO,23)),U,8)
"RTN","PRCHNPO4",62,0)
 . . S:PRCX'="" PRCX=$P($G(^PRC(440.5,PRCX,2)),U,4)
"RTN","PRCHNPO4",63,0)
 . . D NOW^%DTC
"RTN","PRCHNPO4",64,0)
 . . I ($E(PRCX,6,7)>0&(X>PRCX))!(+$E(PRCX,6,7)=0&(X\100>(PRCX\100))) D
"RTN","PRCHNPO4",65,0)
 . . . W !!,"In File #440.5, the Expiration Date for this card is blank or this card has"
"RTN","PRCHNPO4",66,0)
 . . . W !,?5,"expired!  An EDI order will reject.  Please contact your Purchase"
"RTN","PRCHNPO4",67,0)
 . . . W !,?5,"Card Coordinator." S PRCY="NO"
"RTN","PRCHNPO4",68,0)
 . N DIE,DR,DA
"RTN","PRCHNPO4",69,0)
 . S DIE=442,DR="116///@;S Y=""@1"";@1;116Do You Want to Send This EDI?~R",DA=PRCHPO D ^DIE
"RTN","PRCHNPO4",70,0)
 . Q:$D(DTOUT)!$D(Y)
"RTN","PRCHNPO4",71,0)
 . I $P($G(^PRC(442,PRCHPO,12)),U,16)="y",PRCY="NO" D
"RTN","PRCHNPO4",72,0)
 . . S X="ABORT"
"RTN","PRCHNPO4",73,0)
 . . W !,"As you have elected to send this order EDI, please ask the Purchase Card"
"RTN","PRCHNPO4",74,0)
 . . W !,"Coordinator to update the Card's Expiration Date before completing this"
"RTN","PRCHNPO4",75,0)
 . . W !,"Purchase Order. - You must reedit this PO."
"RTN","PRCHNPO4",76,0)
 ; UPDATE STATUS, P.A.SIGNATURE & BOC DATA, IN P.O.
"RTN","PRCHNPO4",77,0)
 S PRCSIG="" D ESIG^PRCUESIG(DUZ,.PRCSIG) S ROUTINE="PRCUESIG" I PRCSIG<1 D QQ G Q
"RTN","PRCHNPO4",78,0)
 ;Following line added in P194: go create new txn # if PC order modified
"RTN","PRCHNPO4",79,0)
 ;to new FCP
"RTN","PRCHNPO4",80,0)
 D CHECKFCP^PRCHNPOA(PRCHPO)
"RTN","PRCHNPO4",81,0)
 ;I $P($G(^PRC(442,PRCHPO,23)),U,11)="D",$P(^PRC(442,PRCHPO,0),U,2)=26 S $P(^PRC(442,PRCHPO,24),U)=1
"RTN","PRCHNPO4",82,0)
 I $G(PRCHPC)!$G(PRCHDELV) D  G Q:%<0,FS:%=0
"RTN","PRCHNPO4",83,0)
 . I $G(PRCPROST) S PRCPROST=3.9,NOPRINT=1,%=2 QUIT
"RTN","PRCHNPO4",84,0)
 . S %A=$S($G(PRCHPC):"Print Purchase Card Order ",1:"Print Delivery Order")
"RTN","PRCHNPO4",85,0)
 . W ! S %A="     "_%A,%B="",%=1 D ^PRCFYN
"RTN","PRCHNPO4",86,0)
 . S NOPRINT="" I %=2 S NOPRINT=1
"RTN","PRCHNPO4",87,0)
 ;
"RTN","PRCHNPO4",88,0)
 S X=$S($G(PRCHPHAM)'="":30,1:PRCHSTAT),DA=PRCHPO D ENS^PRCHSTAT
"RTN","PRCHNPO4",89,0)
 S (D0,DA)=PRCHPO D ^PRCHSF ;CALLS ROUTINE FOR FMS PROCESSING
"RTN","PRCHNPO4",90,0)
 S %DT="T",X="NOW" D ^%DT S PRCSIG="" D ENCODE^PRCHES5(DA,DUZ,.PRCSIG)
"RTN","PRCHNPO4",91,0)
 S ROUTINE=$T(+0) I PRCSIG<1 D QQ G Q
"RTN","PRCHNPO4",92,0)
 S D0=PRCHPO K D1 S:'$D(DT) DT=$P(Y,".",1)
"RTN","PRCHNPO4",93,0)
 ;
"RTN","PRCHNPO4",94,0)
 I $G(PRCHPC)!$G(PRCHDELV) D
"RTN","PRCHNPO4",95,0)
 . I $P($G(^PRC(442,PRCHPO,23)),U,8)]"" D
"RTN","PRCHNPO4",96,0)
 . . S PRCHCD=$P(^PRC(442,PRCHPO,23),U,8)
"RTN","PRCHNPO4",97,0)
 . . S PRCHPOMT=$P(^PRC(442,PRCHPO,0),U,15)
"RTN","PRCHNPO4",98,0)
 . S PODA=DA,DA=CDA S X=$P(^PRC(442,PRCHPO,0),U,15) D ESIG^PRCH410 S DA=PODA K PODA
"RTN","PRCHNPO4",99,0)
 ; IF SUPPLY FUND, NOT CERTIFIED INVOICE, SET FLAG NOTIFYING PPM TO CREATE LOG CODE SHEETS
"RTN","PRCHNPO4",100,0)
 S PRCHPOMT=$P(^PRC(442,PRCHPO,0),U,15),PRCHCD=$P(^PRC(442,PRCHPO,23),U,8)
"RTN","PRCHNPO4",101,0)
 I $P($G(^PRC(442,PRCHPO,0)),U,2)=25,$G(PRCHCD)'="" S $P(^PRC(440.5,PRCHCD,2),U)=+$P($G(^PRC(440.5,PRCHCD,2)),U)+PRCHPOMT
"RTN","PRCHNPO4",102,0)
 I PRCHN("SFC")=2 S $P(^PRC(442,PRCHPO,18),U,12)=1
"RTN","PRCHNPO4",103,0)
 I PRCHN("SFC")=2,PRCHN("MP")'=2 S $P(^PRC(442,PRCHPO,18),U,11)="N",^PRC(442,"AE","N",PRCHPO)=""
"RTN","PRCHNPO4",104,0)
 ; IF SUPPLY FUND, CERTIFIED INVOICE, UPDATE CONTROL POINT OBLIGATED BALANCE.
"RTN","PRCHNPO4",105,0)
 ;
"RTN","PRCHNPO4",106,0)
ISMS ;I PRCHSC=9 ;;I $D(PRCHISMS)   ;CHECK ISMS SWITCH AND IF TRUE CREATE ISMS TRANSACTION
"RTN","PRCHNPO4",107,0)
 ;I PRCHSC=1 D:0 EN11^PRCHEI
"RTN","PRCHNPO4",108,0)
 ;I PRCHSC=9 S PRCHTRAN="PO1" D EN11^PRCHEI(PRCHTRAN)
"RTN","PRCHNPO4",109,0)
 ;
"RTN","PRCHNPO4",110,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCHNPO4",111,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D UPD^PRCV442A(PRCHPO)
"RTN","PRCHNPO4",112,0)
 ;
"RTN","PRCHNPO4",113,0)
EDI ;CHECK TO SEE IF IT IS AN EDI PO AND SEND TO AUSTIN
"RTN","PRCHNPO4",114,0)
 ;I $G(PRCHSTAT)'="",PRCHSTAT'=10 N PRCOPODA S PRCOPODA=PRCHPO D ^PRCOEDI
"RTN","PRCHNPO4",115,0)
 I PRCHN("MP")=25 D  S $P(^PRC(442,PRCHPO,24),U)=1 G INV
"RTN","PRCHNPO4",116,0)
 . I $G(PRCHPC)'=1 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",117,0)
 .;Create FPDS message for the AAC, PRC*5.1*79
"RTN","PRCHNPO4",118,0)
 . I $P(^PRC(442,PRCHPO,0),U,15)>0,$D(^PRC(442,PRCHPO,25)) D
"RTN","PRCHNPO4",119,0)
 . . D EN^DDIOL("...now generating the FPDS message for the AAC","","!!"),EN^DDIOL(" ") D AAC^PRCHAAC
"RTN","PRCHNPO4",120,0)
 .;End of changes for PRC*5.1*79
"RTN","PRCHNPO4",121,0)
 . I '$P($G(^PRC(442,PRCHPO,23)),U,11) D
"RTN","PRCHNPO4",122,0)
 . . I '$P(^PRC(442,PRCHPO,0),U,12) S DA=PRCHPO D START^PRCH410 D  Q
"RTN","PRCHNPO4",123,0)
 . . . S PODA=PRCHPO,DA=CDA S X=$P(^PRC(442,PRCHPO,0),U,15) D ESIG^PRCH410 S DA=PODA K PODA
"RTN","PRCHNPO4",124,0)
 . . I $P(^PRC(442,PRCHPO,0),U,12) D COMM^PRCSPC(PRCHPO,$P(^PRC(442,PRCHPO,0),U,10))
"RTN","PRCHNPO4",125,0)
 I $G(PRCHSTAT)'="",PRCHSTAT'=10 D  S:$P(^PRC(442,PRCHPO,0),U,2)=26 $P(^PRC(442,PRCHPO,24),U)=1 G INV
"RTN","PRCHNPO4",126,0)
 . Q:$P(^PRC(442,PRCHPO,0),U,2)=2
"RTN","PRCHNPO4",127,0)
 . N PRCOPODA S PRCOPODA=PRCHPO D ^PRCOEDI,SUPP^PRCFFMO
"RTN","PRCHNPO4",128,0)
 I $G(PRCHOBL)=2 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",129,0)
 ;
"RTN","PRCHNPO4",130,0)
 ;update due-ins at the inventory point
"RTN","PRCHNPO4",131,0)
INV G:$P($G(^PRC(442,PRCHPO,23)),U,11)="S" PRT
"RTN","PRCHNPO4",132,0)
 G:$G(PRCHPHAM) PRT
"RTN","PRCHNPO4",133,0)
 S FLG=0 I $P(^PRC(442,PRCHPO,0),U,2)=2 D
"RTN","PRCHNPO4",134,0)
 .S N=0 F  S N=$O(^PRC(442,PRCHPO,2,N)) Q:'N!(FLG)  I $P(^(N,0),U,5)]"" S FLG=1
"RTN","PRCHNPO4",135,0)
 .K N
"RTN","PRCHNPO4",136,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)'="S" I '$G(PRCHPHAM) D
"RTN","PRCHNPO4",137,0)
 . I $P(^PRC(442,PRCHPO,0),U,2)'=2 S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",138,0)
 . I ($P(^PRC(442,PRCHPO,0),U,2)=2)&(FLG) S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",139,0)
 K FLG
"RTN","PRCHNPO4",140,0)
 ;S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",141,0)
 ;
"RTN","PRCHNPO4",142,0)
PRT ;IF IMPREST FUND PO, PRINT A COPY ON BOTH IMPREST FUND & FISCAL PRINTER.
"RTN","PRCHNPO4",143,0)
 ;IF SUPPLY FUND PO, PRINT A COPY IN P&C AND ONE IN FISCAL.
"RTN","PRCHNPO4",144,0)
 ; OTHERWISE, PRINT A COPY IN FISCAL
"RTN","PRCHNPO4",145,0)
 ;IF SUPPLY FUND PAYMENT IN ADVANCE, PRINT 2 MORE COPIES IN FISCAL.
"RTN","PRCHNPO4",146,0)
 K PRCHQ S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",147,0)
 ;
"RTN","PRCHNPO4",148,0)
 I PRCHN("MP")=12 S PRCHQ("DEST2")="IFP" D ^PRCHQUE
"RTN","PRCHNPO4",149,0)
 I '$G(NOPRINT) I PRCHN("SFC")=2!(PRCHN("MP")=25) S:PRCHN("MP")'=25 PRCHQ("DEST")="S8" D ^PRCHQUE S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",150,0)
 ;
"RTN","PRCHNPO4",151,0)
 K PRCHQ S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",152,0)
 I PRCHN("MP")'=25 S PRCHQ("DEST")="F" D ^PRCHQUE
"RTN","PRCHNPO4",153,0)
 I PRCHN("SFC")=2,PRCHN("MP")=3 F PRCHI=1,2 S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT",PRCHQ("DEST")="F" D ^PRCHQUE
"RTN","PRCHNPO4",154,0)
 G Q
"RTN","PRCHNPO4",155,0)
 ;
"RTN","PRCHNPO4",156,0)
QQ N:'$D(ROUTINE) ROUTINE S:$G(ROUTINE)="" ROUTINE=$T(+0) N DIR
"RTN","PRCHNPO4",157,0)
 W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7)
"RTN","PRCHNPO4",158,0)
 S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR K PRCSIG
"RTN","PRCHNPO4",159,0)
 Q
"RTN","PRCHNPO4",160,0)
 ;
"RTN","PRCHNPO4",161,0)
Q L  K PRCH,PRCHAC,PRCHACT,PRCHAM,PRCHAMT,PRCHB,PRCHBO,PRCHCN,PRCHCNT,PRCHD,PRCHDA,PRCHDT,PRCHEC,PRCHEDI,PRCHER,PRCHES,PRCHEST,PRCHESTL,PRCHFPDS,PRCHI,PRCHL0,PRCHL1,PRCHL2,PRCHL3,PRCHLCNT,PRCHLI,PRCSIG,ROUTINE
"RTN","PRCHNPO4",162,0)
 K PRCHN,PRCHNM,PRCHNRQ,PRCHP,PRCHPO,PRCHPONO,PRCHQ,PRCHS,PRCHSC,PRCHSTAT,PRCHTTT,PRCHV,PRCHVAR,PRCHX,PRCHY,DIC,DIE,DR,D0,DA,X,Y,Z,I,J,K,P,ZTSK
"RTN","PRCHNPO4",163,0)
 K ERROR,ITEMCNT,M,M0,PRCHFCP,PRCHLOG,PRCHSTN,ZTDESC,ZTRTN,ZTUCI,A,B,C,V3,PRCHXXD0,F1,I1,POP,PRCHLN,SUBACC,ERROR1,NOPRINT
"RTN","PRCHNPO4",164,0)
 Q
"RTN","PRCSEA")
0^4^B87690038
"RTN","PRCSEA",1,0)
PRCSEA ;WISC/SAW/DXH/BM/SC/DAP - CONTROL POINT ACTIVITY EDITS ;5/8/13  15:31
"RTN","PRCSEA",2,0)
V ;;5.1;IFCAP;**81,147,150,174,196**;Oct 20, 2000;Build 15
"RTN","PRCSEA",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCSEA",4,0)
 ;
"RTN","PRCSEA",5,0)
 ;PRC*5.1*81 BMM 3/23/05 when a 2237 is canceled, in CT1, add code 
"RTN","PRCSEA",6,0)
 ;to update Audit file (#414.02), and send update message to 
"RTN","PRCSEA",7,0)
 ;DynaMed thru a call to rtn PRCVTCA.
"RTN","PRCSEA",8,0)
 ;
"RTN","PRCSEA",9,0)
 ;PRC*5.1*150 RGB 4/23/12 DO NOT allow the same temporary tx
"RTN","PRCSEA",10,0)
 ;number to be used at all.  Previously, the same temp tx #
"RTN","PRCSEA",11,0)
 ;could be used by different users, not same user.
"RTN","PRCSEA",12,0)
 ;Also, Control the node 0 counter for file 410 kill (DIK)
"RTN","PRCSEA",13,0)
 ;since DIK call does not handle descending file logic
"RTN","PRCSEA",14,0)
 ;
"RTN","PRCSEA",15,0)
 ;PRC*5.1*196  Check to move Date Required to Committed Date (MOP: 2-4)
"RTN","PRCSEA",16,0)
 ;             to insure a later date is used for FMS document. Also,
"RTN","PRCSEA",17,0)
 ;             added date check called from templates PRCSENR&NRS,
"RTN","PRCSEA",18,0)
 ;             PRCSEN2237S & PRCSENPRS to insure dates are in same 
"RTN","PRCSEA",19,0)
 ;             FY/FQ defined.
"RTN","PRCSEA",20,0)
 ;
"RTN","PRCSEA",21,0)
ENRS ;ENTER REQ
"RTN","PRCSEA",22,0)
 S PRCSK=1,X3="H"
"RTN","PRCSEA",23,0)
 D EN1F^PRCSUT(1) ; ask site,FY,QRTR,CP & set up PRC array, PRCSIP variable ; prc*5*197
"RTN","PRCSEA",24,0)
 G W2:'$D(PRC("SITE")),EXIT:Y<0 ; unauthorized user or '^' entered
"RTN","PRCSEA",25,0)
 D W6 ; display help on transaction# format
"RTN","PRCSEA",26,0)
ENRS0 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="ABELQX",D="H"   ;PRC*5.1*150
"RTN","PRCSEA",27,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",28,0)
 S DIC("S")="I '^(0),$P(^(0),U)'="""",$D(^PRCS(410,""B"",$P(^(0),U),+Y))" ; only temp tx number not defined will be allowed  ;PRC*5.1*150
"RTN","PRCSEA",29,0)
 D ^PRCSDIC ; lookup & preliminary validity checking
"RTN","PRCSEA",30,0)
 K DLAYGO,DIC("A"),DIC("S")
"RTN","PRCSEA",31,0)
 G:Y<0 EXIT
"RTN","PRCSEA",32,0)
 I $P(Y,U,3)'=1 W $C(7),"   Must be a new (unique) entry." G ENRS0     ;PRC*5.1*150
"RTN","PRCSEA",33,0)
 ;*81 Check site parameter to see if issue books are allowed
"RTN","PRCSEA",34,0)
 D CKPRM^PRCSEB
"RTN","PRCSEA",35,0)
 W !!,PRCVY,!
"RTN","PRCSEA",36,0)
 S (PDA,T1,DA)=+Y
"RTN","PRCSEA",37,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...try a different transaction number or try later" G ENRS0
"RTN","PRCSEA",38,0)
 S T(2)=$P(Y,U,2)
"RTN","PRCSEA",39,0)
 D EN2A^PRCSUT3 ; saves CP,sta,substa,txn name,user,BBFY,RB stat,acct data in new txn (nodes 0,3,6,11 of file 410)
"RTN","PRCSEA",40,0)
 S $P(^PRCS(410,DA,14),"^")=DUZ ; originator (entered by)
"RTN","PRCSEA",41,0)
 S $P(^PRCS(410,DA,7),"^")=DUZ,$P(^PRCS(410,DA,7),"^",2)=$P($G(^VA(200,DUZ,20)),"^",3) ; requestor default
"RTN","PRCSEA",42,0)
 I $G(PRCSIP) S $P(^PRCS(410,DA,0),"^",6)=PRCSIP,^PRCS(410,"AO",PRCSIP,DA)="" ; PRCSIP was set up in PRCSUT & is inventory distribution point
"RTN","PRCSEA",43,0)
 S PRCS="" ; set PRCS=1 if CP is automated, i.e. it uses IFCAP to send requests to A&MM
"RTN","PRCSEA",44,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS=1
"RTN","PRCSEA",45,0)
TYPE ;
"RTN","PRCSEA",46,0)
 W !!,"This transaction is assigned temporary transaction number: ",T(2)
"RTN","PRCSEA",47,0)
 S DIC("A")="FORM TYPE: ",DIC="^PRCS(410.5,",DIC(0)="AEQZ"
"RTN","PRCSEA",48,0)
 S DIC("S")=PRCVX ; only allow selection of 2237's
"RTN","PRCSEA",49,0)
 D ^DIC
"RTN","PRCSEA",50,0)
 S DA=PDA
"RTN","PRCSEA",51,0)
 ;if user didn't enter a form type, go ask whether to backout and act
"RTN","PRCSEA",52,0)
 ;accordingly: go let them re-enter a form type or exit
"RTN","PRCSEA",53,0)
 I Y<0 G:'$$BACKOUT(T(2),DA) TYPE L -^PRCS(420,DA) G EXIT
"RTN","PRCSEA",54,0)
 ;
"RTN","PRCSEA",55,0)
 I Y<2 W "??" G TYPE
"RTN","PRCSEA",56,0)
 K PRCVX,PRCVY
"RTN","PRCSEA",57,0)
 S $P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y,PRCSTYP=X ; form type     ;PRC*5.1*196
"RTN","PRCSEA",58,0)
 ; if CP is not automated (file 420), user's response will be overwritten with non-recuring (type 2). Although user's selection is changed 'behind the scenes', 
"RTN","PRCSEA",59,0)
 ; the scenario is unlikely to occur because full implementation of IFCAP was made mandatory and sites are now automated.
"RTN","PRCSEA",60,0)
 S:'PRCS&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSEA",61,0)
 K PRCSERR ; flag denoting item info is missing
"RTN","PRCSEA",62,0)
 S DIC(0)="AEMQ",(DIC,DIE)="^PRCS(410,"
"RTN","PRCSEA",63,0)
 S PRCSTYP=X ; form type     ;PRC*5.1*196
"RTN","PRCSEA",64,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237S",X=3:"PRCSENPRS",X=4:"PRCSENR&NRS",1:"PRCSENIBS")_"]"
"RTN","PRCSEA",65,0)
EN1 K DTOUT,DUOUT,Y
"RTN","PRCSEA",66,0)
 D ^DIE
"RTN","PRCSEA",67,0)
 S DA=PDA
"RTN","PRCSEA",68,0)
 I $D(Y)!($D(DTOUT)) D DOR L -^PRCS(410,DA) G EXIT
"RTN","PRCSEA",69,0)
CMDAT I PRCSTYP>1,PRCSTYP<5,$P(^PRCS(410,DA,4),U,2)="" D          ;PRC*5.1*196
"RTN","PRCSEA",70,0)
 . S PRCOMDT=$S($P(^PRCS(410,DA,1),U,4)'=DT:$P(^PRCS(410,DA,1),U,4),1:DT)
"RTN","PRCSEA",71,0)
 . S DR="21///^S X=PRCOMDT",DIE="^PRCS(410," D ^DIE
"RTN","PRCSEA",72,0)
 D RL^PRCSUT1 ; sets up 'IT' & '10' nodes
"RTN","PRCSEA",73,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G EN1 ; missing required field ('item')
"RTN","PRCSEA",74,0)
 D DOR ; populate date of request field if it is nil
"RTN","PRCSEA",75,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",76,0)
 S T="enter" D W5 G EXIT:%'=1
"RTN","PRCSEA",77,0)
 W !! K PRCS("SUB")
"RTN","PRCSEA",78,0)
 G ENRS
"RTN","PRCSEA",79,0)
 ;
"RTN","PRCSEA",80,0)
EDRS ;EDIT REQ
"RTN","PRCSEA",81,0)
 ; following line commented out by PRC*5*140 - user responses not used to limit selection of txn and sometimes resulted in bad info being set into the selected txn
"RTN","PRCSEA",82,0)
 ; S PRCSK=1 D EN1F^PRCSUT(1) G W2:'$D(PRC("SITE")),EXIT:Y<0 ; ask sta,FY,QRTR,CP ; prc*5*197
"RTN","PRCSEA",83,0)
 ; if the above line is reactivated, programmer should note that the transaction selected may not be of the same FY,QRTR,sta, subst, and CP specified by the user
"RTN","PRCSEA",84,0)
 D W6 ; format doc for txn#
"RTN","PRCSEA",85,0)
 S X3="H" S DIC="^PRCS(410,",DIC(0)="AEQ",D="H"
"RTN","PRCSEA",86,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",87,0)
 S DIC("S")="I '^(0),$P(^(0),U,3)'="""",$P(^(0),U,4)'=1,^PRCS(410,""H"",$P(^(0),U,3),+Y)=DUZ!(^(+Y)="""")" ; request must be authored by user or unauthored & cannot be a 1358
"RTN","PRCSEA",88,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("A"),DIC("S")
"RTN","PRCSEA",89,0)
 S (PDA,DA,T1)=+Y
"RTN","PRCSEA",90,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...please try later" G EDRS
"RTN","PRCSEA",91,0)
 ; following line commented out in PRC*5*140 - PRCSUT3 needs PRC("SST") or MYY to do something, neither exists in this option
"RTN","PRCSEA",92,0)
 ; D EN2B^PRCSUT3
"RTN","PRCSEA",93,0)
 S PRC("SITE")=+$P(^PRCS(410,PDA,0),"^",5)
"RTN","PRCSEA",94,0)
 S PRC("CP")=$P(^PRCS(410,PDA,3),"^")
"RTN","PRCSEA",95,0)
 I $P(^PRCS(410,PDA,0),"^",6)="" D  ; prc*5*197
"RTN","PRCSEA",96,0)
 . N PRCSIP D IP^PRCSUT
"RTN","PRCSEA",97,0)
 . I $D(PRCSIP) S $P(^PRCS(410,DA,0),U,6)=PRCSIP  ;PRC*5.1*147 modified file set from ^PRC(410 to ^PRCS(410
"RTN","PRCSEA",98,0)
 S X=+$P(^PRCS(410,DA,0),"^",4) I X<1 D FORM
"RTN","PRCSEA",99,0)
 S PRCSTYP=X ; form type     ;PRC*5.1*196
"RTN","PRCSEA",100,0)
 ;*81 Check site parameter to see if Issue Books are allowed
"RTN","PRCSEA",101,0)
 D CKPRM
"RTN","PRCSEA",102,0)
 I PRCVD=1 S PRCVZ=1
"RTN","PRCSEA",103,0)
 I PRCVD'=1 S PRCVZ=0
"RTN","PRCSEA",104,0)
 W !,"The form type for this transaction is ",$P($G(^PRCS(410.5,X,0)),"^"),!
"RTN","PRCSEA",105,0)
 I PRCVZ=1,X=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP issue book order." S T="edit" D W5 G:%'=1 EXIT W !! K PRCS("SUB") G EDRS
"RTN","PRCSEA",106,0)
 ;
"RTN","PRCSEA",107,0)
 S DIC(0)="AEMQ",(DIC,DIE)="^PRCS(410,"
"RTN","PRCSEA",108,0)
 ;P182--Modified next 3 lines to use new templates if supply fund FCP
"RTN","PRCSEA",109,0)
 S (DR,PRCSDR)="["_$S(X=1:"PRCE NEW 1358S",X=2:"PRCSEN2237S",X=3:"PRCSENPRS",X=4:"PRCSENR&NRS",1:"PRCSENIBS")_"]"
"RTN","PRCSEA",110,0)
ED1 K DTOUT,DUOUT,Y
"RTN","PRCSEA",111,0)
 D ^DIE
"RTN","PRCSEA",112,0)
 S DA=PDA
"RTN","PRCSEA",113,0)
 I $D(Y)!($D(DTOUT)) L -^PRCS(410,DA) G EXIT
"RTN","PRCSEA",114,0)
COMDT I PRCSTYP>1,PRCSTYP<5,$P(^PRCS(410,DA,4),U,2)="" D          ;PRC*5.1*196
"RTN","PRCSEA",115,0)
 . S PRCOMDT=$S($P(^PRCS(410,DA,1),U,4)'=DT:$P(^PRCS(410,DA,1),U,4),1:DT)
"RTN","PRCSEA",116,0)
 . S DR="21///^S X=PRCOMDT",DIE="^PRCS(410," D ^DIE
"RTN","PRCSEA",117,0)
 D RL^PRCSUT1
"RTN","PRCSEA",118,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G ED1
"RTN","PRCSEA",119,0)
 K PRCSERR S $P(^PRCS(410,DA,14),"^")=DUZ
"RTN","PRCSEA",120,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",121,0)
 S T="edit" D W5 G EXIT:%'=1
"RTN","PRCSEA",122,0)
 W !! K PRCS("SUB")
"RTN","PRCSEA",123,0)
 G EDRS
"RTN","PRCSEA",124,0)
 ;
"RTN","PRCSEA",125,0)
CT ;CANCEL A (PERMANENT) TRANS
"RTN","PRCSEA",126,0)
 D EN3^PRCSUT
"RTN","PRCSEA",127,0)
 G W2:'$D(PRC("SITE")),EXIT:Y<0
"RTN","PRCSEA",128,0)
 S DIC="^PRCS(410,",DIC(0)="AEMQ"
"RTN","PRCSEA",129,0)
 ;S DIC("S")="I $P(^(0),""^"",4)=.5!($S('$D(^(7)):1,1:$P(^(7),""^"",6)="""")) I +^(0)>0,$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEA",130,0)
 S DIC("S")="I $P(^(0),U,2)=""O""!($P(^(0),U,2)=""A""&($P(^(0),U,4)=1)),$S('$D(^(7)):1,1:$P(^(7),""^"",6)=""""),$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),U,5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEA",131,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",132,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("S"),DIC("A")
"RTN","PRCSEA",133,0)
CT1 W !,"Cancel this transaction" S %=2 D YN^DICN G CT1:%=0,EXIT:%'=1
"RTN","PRCSEA",134,0)
 S DA=+Y
"RTN","PRCSEA",135,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...please try later" G CT
"RTN","PRCSEA",136,0)
 S DIE="^PRCS(410,",DR="104////^S X=DUZ" D ^DIE K DIE,DR
"RTN","PRCSEA",137,0)
 S T=$P(^PRCS(410,DA,0),"^")
"RTN","PRCSEA",138,0)
 I T?1A.E D  G EXIT:%'=1 W !! G CT     ;PRC*5.1*150 Will DELETE entry if temporary transaction
"RTN","PRCSEA",139,0)
 . S DIK="^PRCS(410,",PRCIENCT=$P(^PRCS(410,0),"^",3)+1
"RTN","PRCSEA",140,0)
 . D ^DIK
"RTN","PRCSEA",141,0)
 . S $P(^PRCS(410,0),"^",3)=PRCIENCT K PRCIENCT,DIK
"RTN","PRCSEA",142,0)
 . S T="cancel" D W4
"RTN","PRCSEA",143,0)
 S $P(^PRCS(410,DA,11),"^",3)="",$P(^PRCS(410,DA,0),"^",2)="CA",$P(^PRCS(410,DA,5),"^")=0,$P(^PRCS(410,DA,6),"^")=0
"RTN","PRCSEA",144,0)
 K ^PRCS(410,"F",+T_"-"_+PRC("CP")_"-"_$P(T,"-",5),DA),^PRCS(410,"F1",$P(T,"-",5)_"-"_+T_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA)
"RTN","PRCSEA",145,0)
 K ZX
"RTN","PRCSEA",146,0)
 I $D(^PRCS(410,DA,4)) S ZX=^(4),X=$P(ZX,"^",8) F I=1,3,6,8 S $P(ZX,"^",I)=0
"RTN","PRCSEA",147,0)
 I $D(ZX) S ^PRCS(410,DA,4)=ZX K ZX
"RTN","PRCSEA",148,0)
 I $D(^PRCS(410,DA,12,0)) S N=0 F I=0:0 S N=$O(^PRCS(410,DA,12,N)) Q:N'>0  S X=$P(^(N,0),"^",2) I X S DA(1)=DA,DA=N D TRANK^PRCSEZZ S DA=DA(1)
"RTN","PRCSEA",149,0)
 D ERS410^PRC0G(DA_"^C")
"RTN","PRCSEA",150,0)
 W !,"Enter comments for this cancellation",!
"RTN","PRCSEA",151,0)
 S DIE=DIC,DR=60
"RTN","PRCSEA",152,0)
 D ^DIE
"RTN","PRCSEA",153,0)
 ;PRC*5.1*81 if DM trx, update Audit file and send msg to DM
"RTN","PRCSEA",154,0)
 D EN^PRCVTCA(DA)
"RTN","PRCSEA",155,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",156,0)
 I $D(^PRC(443,DA,0)) S DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCSEA",157,0)
 S T="cancel" D W4 G EXIT:%'=1
"RTN","PRCSEA",158,0)
 W !! G CT
"RTN","PRCSEA",159,0)
 ;
"RTN","PRCSEA",160,0)
DT ;DELETE A (TEMPORARY) TRANS
"RTN","PRCSEA",161,0)
 S X3="H"
"RTN","PRCSEA",162,0)
 D W6 ; format doc for txn#
"RTN","PRCSEA",163,0)
 S DIC="^PRCS(410,",DIC(0)="AEQ",DIC("A")="Select TRANSACTION: ",D="H"
"RTN","PRCSEA",164,0)
 S DIC("S")="S W=$P(^(0),""^"",5),W(1)=+^(3) I '^(0),$P(^(0),""^"",3)'="""",^PRCS(410,""H"",$P(^(0),""^"",3),+Y)=DUZ!(^(+Y)="""")!($D(^PRC(420,""A"",DUZ,W,W(1),1)))!($D(^(2)))"
"RTN","PRCSEA",165,0)
 D ^PRCSDIC G EXIT:Y<0
"RTN","PRCSEA",166,0)
 K DIC("S"),DIC("A")
"RTN","PRCSEA",167,0)
 S DA=+Y
"RTN","PRCSEA",168,0)
 L +^PRCS(410,DA):5 I $T=0 W !,"File is being accessed...please try later" G DT
"RTN","PRCSEA",169,0)
DT1 W !,"Delete this transaction" S %=2 D YN^DICN G DT1:%=0,EXIT:%'=1
"RTN","PRCSEA",170,0)
 ;The following line was commented out in patch 182; should NOT manually
"RTN","PRCSEA",171,0)
 ;change or reset last assigned IEN # in node zero.
"RTN","PRCSEA",172,0)
 ;S PRCSDA=$P(^PRCS(410,0),U,3),DIK=DIC
"RTN","PRCSEA",173,0)
 S PRCIENCT=$P(^PRCS(410,0),"^",3)+1      ;PRC*5.1*150
"RTN","PRCSEA",174,0)
 S DIK=DIC
"RTN","PRCSEA",175,0)
 W !,"Okay....."
"RTN","PRCSEA",176,0)
 D ^DIK K DIK
"RTN","PRCSEA",177,0)
 S $P(^PRCS(410,0),"^",3)=PRCIENCT K PRCIENCT     ;PRC*5.1*150
"RTN","PRCSEA",178,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",179,0)
 ;The following line was commented out in patch 182; should NOT manually
"RTN","PRCSEA",180,0)
 ;change or reset last assigned IEN # in node zero.
"RTN","PRCSEA",181,0)
 ;S $P(^PRCS(410,0),U,3)=PRCSDA
"RTN","PRCSEA",182,0)
 K PRCSDA
"RTN","PRCSEA",183,0)
 W "It's deleted"
"RTN","PRCSEA",184,0)
 S T="delete" D W4 G EXIT:%'=1
"RTN","PRCSEA",185,0)
 W !! G DT
"RTN","PRCSEA",186,0)
 ;
"RTN","PRCSEA",187,0)
 ;
"RTN","PRCSEA",188,0)
DOR ; Date of Request
"RTN","PRCSEA",189,0)
 I $D(^PRCS(410,DA,1)),$P(^PRCS(410,DA,1),"^")'="" Q
"RTN","PRCSEA",190,0)
 S %DT="X",X="T" D ^%DT S $P(^PRCS(410,DA,1),"^")=Y
"RTN","PRCSEA",191,0)
 Q
"RTN","PRCSEA",192,0)
FORM ;*81 Allow user to change txn to a valid form and check site parameter to see if issue books are allowed
"RTN","PRCSEA",193,0)
 D CKPRM
"RTN","PRCSEA",194,0)
 I PRCVD=1 S PRCVX1="I Y>1&(Y<5)",PRCVY1="The Issue Book and NO FORM type are not valid in this option."
"RTN","PRCSEA",195,0)
 I PRCVD'=1 S PRCVX1="I Y>1",PRCVY1="The NO FORM type is not valid in this option."
"RTN","PRCSEA",196,0)
 W !,PRCVY1,!
"RTN","PRCSEA",197,0)
 W !,"Please enter another form type",!
"RTN","PRCSEA",198,0)
 S PRCSDAA=DA,DIC="^PRCS(410.5,",DIC("A")="FORM TYPE: ",DIC(0)="AEQZ"
"RTN","PRCSEA",199,0)
 S DIC("S")=PRCVX1
"RTN","PRCSEA",200,0)
 D ^DIC
"RTN","PRCSEA",201,0)
 S:Y=-1 Y=2
"RTN","PRCSEA",202,0)
 S DA=PRCSDAA,$P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y
"RTN","PRCSEA",203,0)
 K DIC,PRCVX1,PRCVY1,PRCVD
"RTN","PRCSEA",204,0)
 Q
"RTN","PRCSEA",205,0)
 ;
"RTN","PRCSEA",206,0)
 ;Allow user the option of re entering a form type.  If they decline,
"RTN","PRCSEA",207,0)
 ;kill off the transaction and return 1; else return 0
"RTN","PRCSEA",208,0)
BACKOUT(TRNNAME,TRNDA) ;
"RTN","PRCSEA",209,0)
 N DIK,Y,%,DA
"RTN","PRCSEA",210,0)
 W !!,"WARNING: WITHOUT A FORM TYPE, TRANSACTION """,TRNNAME,""" WILL BE DELETED!",$C(7)
"RTN","PRCSEA",211,0)
 W !,"Are you sure you want to delete this transaction" S %=2 D YN^DICN
"RTN","PRCSEA",212,0)
 I %=0 G BACKOUT
"RTN","PRCSEA",213,0)
 I %=2 Q 0
"RTN","PRCSEA",214,0)
 S DIK="^PRCS(410,",DA=TRNDA
"RTN","PRCSEA",215,0)
 S PRCIENCT=$P(^PRCS(410,0),"^",3)+1      ;PRC*5.1*150
"RTN","PRCSEA",216,0)
 D ^DIK
"RTN","PRCSEA",217,0)
 S $P(^PRCS(410,0),"^",3)=PRCIENCT K PRCIENCT     ;PRC*5.1*150
"RTN","PRCSEA",218,0)
 Q 1
"RTN","PRCSEA",219,0)
 ;
"RTN","PRCSEA",220,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact control point official" R X:5 G EXIT
"RTN","PRCSEA",221,0)
W3 Q  ; can this subroutine be deleted? commented out in patch PRC*5*140
"RTN","PRCSEA",222,0)
 W !!,"This transaction is assigned temporary transaction number: ",X Q
"RTN","PRCSEA",223,0)
W4 W !!,"Would you like to ",T," another transaction" S %=2 D YN^DICN G W4:%=0 Q
"RTN","PRCSEA",224,0)
W5 W !!,"Would you like to ",T," another request" S %=1 D YN^DICN G W5:%=0 Q
"RTN","PRCSEA",225,0)
W6 W !!,"For the transaction number, use an uppercase alpha as the first character,",!," and then 2-15 alphanumerics, as in 'ADP1'.",! Q
"RTN","PRCSEA",226,0)
 ;*81 Site parameter pull 
"RTN","PRCSEA",227,0)
CKPRM S PRCVD=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCSEA",228,0)
 Q
"RTN","PRCSEA",229,0)
 ;
"RTN","PRCSEA",230,0)
EXIT K %,C,D,DA,DIC,DIE,DR,PRCS,PDA,PRCSL,T,X,Y,Z,T1,X3,TYPE,PRCVZ,PRCOMDT,PRCSTYP    ;PRC*5.1*196
"RTN","PRCSEA",231,0)
 I $D(PRCSERR) K PRCSERR
"RTN","PRCSEA",232,0)
 Q
"RTN","PRCSEB")
0^5^B29593062
"RTN","PRCSEB",1,0)
PRCSEB ;SF-ISC/LJP/SAW/DXH/DAP - CPA EDITS CON'T ;7.26.99
"RTN","PRCSEB",2,0)
V ;;5.1;IFCAP;**81,174,184,196**;Oct 20, 2000;Build 15
"RTN","PRCSEB",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCSEB",4,0)
 ;
"RTN","PRCSEB",5,0)
 ;PRC*5.1*184  Check for error message indicating no 2237 seq nos.
"RTN","PRCSEB",6,0)
 ;             remaining to be used out of the max 9999 available
"RTN","PRCSEB",7,0)
 ;             for FCP FY-FQ.
"RTN","PRCSEB",8,0)
 ;
"RTN","PRCSEB",9,0)
 ;PRC*5.1*196  Check to move Date Required to Committed Date (MOP= 2,3 or 4)
"RTN","PRCSEB",10,0)
 ;             to insure a later date is used for FMS document. Also,
"RTN","PRCSEB",11,0)
 ;             added date check called from templates PRCSENR&NR1,
"RTN","PRCSEB",12,0)
 ;             PRCSEN2237B & PRCSENPR to insure dates are in same 
"RTN","PRCSEB",13,0)
 ;             FY/FQ defined.
"RTN","PRCSEB",14,0)
 ;
"RTN","PRCSEB",15,0)
ENRB ;ENTER CP CLERK REQUEST FROM OPTION PRCSENRB
"RTN","PRCSEB",16,0)
 D ENF^PRCSUT(1) G W2:'$D(PRC("SITE")) G EXIT:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCSEB",17,0)
 S MSG="" D EN1^PRCSUT3 Q:'X  I MSG'="" W !!,MSG,! S DIR(0)="EAO",DIR("A")="Press <Enter> to exit processing..." D ^DIR K DIR,MSG Q      ;PRC*5.1*184
"RTN","PRCSEB",18,0)
 K MSG        ;PRC*5.1*184
"RTN","PRCSEB",19,0)
 S PRCSX1=X D EN2^PRCSUT3 Q:'$D(PRCSX1)  S X=PRCSX1,T1=DA  D W L +^PRCS(410,DA):15 G ENRB:$T=0 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS2=1
"RTN","PRCSEB",20,0)
 ;
"RTN","PRCSEB",21,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCSEB",22,0)
 D CKPRM
"RTN","PRCSEB",23,0)
 W !!,PRCVY,!!
"RTN","PRCSEB",24,0)
TYPE ;
"RTN","PRCSEB",25,0)
 S PRCDAA=DA,DIC="^PRCS(410.5,",DIC(0)="AEQZ",DIC("A")="FORM TYPE: ",DIC("S")=PRCVX D ^DIC S TYPE=+Y,DA=PRCDAA
"RTN","PRCSEB",26,0)
 I TYPE<2 W "??    EXIT NOT ALLOWED" G TYPE
"RTN","PRCSEB",27,0)
 K PRCVX,PRCVY
"RTN","PRCSEB",28,0)
 S $P(^PRCS(410,DA,0),"^",4)=TYPE S:$G(PRCSIP) $P(^PRCS(410,DA,0),"^",6)=PRCSIP S (DIE,DIC)="^PRCS(410,",X=TYPE
"RTN","PRCSEB",29,0)
 ;NOTE THAT THE FOLLOWING LINE OVERWRITES THE USER'S SELECTION OF FORM
"RTN","PRCSEB",30,0)
 ;TYPE IF THE FUND CONTROL POINT IS NOT 'AUTOMATED'
"RTN","PRCSEB",31,0)
 S:'$D(PRCS2)&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSEB",32,0)
 S PRCSTYP=X     ;PRC*5.1*196
"RTN","PRCSEB",33,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",1:"PRCSENIB")_"]"
"RTN","PRCSEB",34,0)
EN1 K DTOUT,DUOUT,Y S PRCSDAA=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=PRCSDAA L -^PRCS(410,DA) G EXIT
"RTN","PRCSEB",35,0)
 S DA=PRCSDAA D RL^PRCSUT1
"RTN","PRCSEB",36,0)
COMDT I PRCSTYP>1,PRCSTYP<5,$P(^PRCS(410,DA,4),U,2)="" D          ;PRC*5.1*196
"RTN","PRCSEB",37,0)
 . S PRCOMDT=$S($P(^PRCS(410,DA,1),U,4)'=DT:$P(^PRCS(410,DA,1),U,4),1:DT)
"RTN","PRCSEB",38,0)
 . S DR="21///^S X=PRCOMDT",DIE="^PRCS(410," D ^DIE
"RTN","PRCSEB",39,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G EN1
"RTN","PRCSEB",40,0)
 K PRCSERR
"RTN","PRCSEB",41,0)
 I PRCSDR="[PRCSENCOD]" D W7^PRCSEB0 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSEB",42,0)
 S:$P($G(^PRCS(410,DA,7)),"^")="" $P(^PRCS(410,DA,7),"^")=DUZ
"RTN","PRCSEB",43,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I $D(PRCS2),+^PRCS(410,DA,0) D W6
"RTN","PRCSEB",44,0)
 S DA=PRCSDAA L -^PRCS(410,DA) D W3 G EXIT:%'=1 W !! K PRCS,PRCS2
"RTN","PRCSEB",45,0)
 G ENRB
"RTN","PRCSEB",46,0)
W W !!,"This transaction is assigned transaction number: ",X Q
"RTN","PRCSEB",47,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSEB",48,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSEB",49,0)
W3 W !!,"Would you like to enter another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEB",50,0)
W5 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)="" K ^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA),^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA) Q
"RTN","PRCSEB",51,0)
W51 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)=1,(^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA),^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA))="" Q
"RTN","PRCSEB",52,0)
W6 N JUMP,SKIPRNT,OK,TEST,TEST1,CURQTR,CURQTR1
"RTN","PRCSEB",53,0)
W61 ;
"RTN","PRCSEB",54,0)
 N REPORT2 I $P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),1,DUZ,0)),"^",2)'=1 S REPORT2=1 D T1^PRCSAPP1
"RTN","PRCSEB",55,0)
 ;*****PRC*5.1*174 start*****
"RTN","PRCSEB",56,0)
 ;if Level of Access is not Control Point Official DO block
"RTN","PRCSEB",57,0)
 I $P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),1,DUZ,0)),"^",2)'=1 D  Q
"RTN","PRCSEB",58,0)
 . N PRCFTYPE S PRCFTYPE=+$$GET1^DIQ(410,$G(DA)_",",3,"I") ;Form Type
"RTN","PRCSEB",59,0)
 . S %=1
"RTN","PRCSEB",60,0)
 . ;if request is a 2237 (Form Type IEN 2,3, or 4)
"RTN","PRCSEB",61,0)
 . I $G(PRCFTYPE)>1&($G(PRCFTYPE)<5) D
"RTN","PRCSEB",62,0)
 . . ;don't allow approval of 2237 if Requesting Service OR any line item description is missing
"RTN","PRCSEB",63,0)
 . . I '$$REQCHECK^PRCHJUTL($G(DA),,1) S %=2
"RTN","PRCSEB",64,0)
 . I $G(%)'=2 S %=1 W !,"Is this request ready for approval" D YN^DICN
"RTN","PRCSEB",65,0)
 . D:%=1 W51
"RTN","PRCSEB",66,0)
 . D:%=0 W61
"RTN","PRCSEB",67,0)
 . D:%=2 W5
"RTN","PRCSEB",68,0)
 ;*****PRC*5.1*174 end******
"RTN","PRCSEB",69,0)
 S PRCSN=^PRCS(410,DA,0),PRCHQ=$P(PRCSN,"^",4),PRC("FY")=$P(PRCSN,"-",2),PRC("QTR")=$P(PRCSN,"-",3)
"RTN","PRCSEB",70,0)
 S (CURQTR,CURQTR1)=PRC("QTR"),(JUMP,TEST,TEST1,OK)=0
"RTN","PRCSEB",71,0)
 D T1^PRCSAPP1 I OK=1 S SKIPRNT=1 D FINAL^PRCSAPP2
"RTN","PRCSEB",72,0)
 Q
"RTN","PRCSEB",73,0)
 ;*81 Site Parameter Check
"RTN","PRCSEB",74,0)
CKPRM I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>1&(Y<5)",PRCVY="The form types 1358, Issue Book, and NO FORM are no longer used within this option."
"RTN","PRCSEB",75,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>1",PRCVY="The form types 1358 and NO FORM are no longer used within this option"
"RTN","PRCSEB",76,0)
 Q
"RTN","PRCSEB",77,0)
 ;
"RTN","PRCSEB",78,0)
CHKREQ ;Check Date to insure it is within the FY/FQ range during option entry for 'NEW 2237'    ;PRC*5.1*196
"RTN","PRCSEB",79,0)
 N PRCDT,PRCDT1
"RTN","PRCSEB",80,0)
 S PRCDTT=1700+$E(DT,1,3)
"RTN","PRCSEB",81,0)
 I '$D(PRC("BBFY"))!(+$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",12)>0)!($P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",3)["X") S PRC("BBFY")=PRC("FY")+2000
"RTN","PRCSEB",82,0)
 S PRCCKERR=0,PRCDT=(PRC("BBFY")-$S(PRC("QTR")=1:1701,1:1700))_$P("10:01:04:07",":",PRC("QTR"))_"01",PRCDT1=(PRC("BBFY")-1700)_"0930"
"RTN","PRCSEB",83,0)
 I PRCSTDT<PRCDT!(PRCSTDT>PRCDT1) D
"RTN","PRCSEB",84,0)
 . S PRCCKERR=1
"RTN","PRCSEB",85,0)
 . W !!," ** Date must be specified for time **",!," ** period covered by fiscal year ",PRC("BBFY"),"       **",!
"RTN","PRCSEB",86,0)
 Q
"RTN","PRCSEB",87,0)
EXIT K %,C,D,DA,DIC,DIE,DQ,DR,PRCS,PRCS2,PRCSDAA,PRCSDR,PRCSERR,PRCSL,PRCSTT,I,N,T,T1,T2,X,X1,PRCSX3,Y,Z,PRCOMDT,PRCCKERR,PRCSTYP Q     ;PRC*5.1*196
"RTN","PRCSEB0")
0^6^B25973826
"RTN","PRCSEB0",1,0)
PRCSEB0 ;SF-ISC/LJP/SAW/DGL/DAP-CPA EDITS CON'T ;7/9/13  16:01
"RTN","PRCSEB0",2,0)
V ;;5.1;IFCAP;**81,174,196**;Oct 20, 2000;Build 15
"RTN","PRCSEB0",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCSEB0",4,0)
 ;
"RTN","PRCSEB0",5,0)
 ;PRC*5.1*196  Check to move Date Required to Committed Date to
"RTN","PRCSEB0",6,0)
 ;             insure a later date is used for FMS document.
"RTN","PRCSEB0",7,0)
 ;
"RTN","PRCSEB0",8,0)
EDTD ;EDIT TRANSACTION DATA
"RTN","PRCSEB0",9,0)
 N TYPE,TYPE1,CHECK,JUMP S JUMP=1
"RTN","PRCSEB0",10,0)
 D EN3F^PRCSUT(1) G W2:'$D(PRC("SITE")),EXIT:Y<0
"RTN","PRCSEB0",11,0)
 S DIC="^PRCS(410,",DIE=DIC,DIC(0)="AEQM" S DIC("S")="I $P(^(0),U,4)'=1" S:$D(PRCSFT) DIC("S")="I $P(^(0),U,4)=1"
"RTN","PRCSEB0",12,0)
 S DIC("S")=DIC("S")_",$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEB0",13,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("S") S (DA,PRCSDAA,PRCSY,T1)=+Y L +^PRCS(410,DA):15 G EDTD:$T=0
"RTN","PRCSEB0",14,0)
 S TYPE=$P(^PRCS(410,DA,0),"^",4)
"RTN","PRCSEB0",15,0)
EDTD1 S X=^PRCS(410,DA,0) S:+X PRC("FY")=$P(X,"-",2),PRC("QTR")=+$P(X,"-",3) S PRCSX3=$P(X,"^",2) G ASK:PRCSX3="" I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S PRCS2=1
"RTN","PRCSEB0",16,0)
EDTD3 I $D(^PRCS(410,DA,7)),$P(^(7),U,6)]"" G EDTD4
"RTN","PRCSEB0",17,0)
 I $D(PRCSEM) S DIE=DIC,DR="[PRCSENMDR]" D ^DIE S DA=T1 L -^PRCS(410,DA) G EXIT
"RTN","PRCSEB0",18,0)
 I PRCSX3'="O" S DR=$S(PRCSX3="C"&('$D(PRCS2)):"[PRCSENC]",PRCSX3="C"&($D(PRCS2)):"[PRCSENCI]",PRCSX3="A":"[PRCSENA]",1:"[PRCSENCT]") S:PRCSX3="A"&($P(^PRCS(410,PRCSY,0),U,4)=1) DR="[PRCSENA 1358]" S DIE=DIC D ^DIE S DA=PRCSY
"RTN","PRCSEB0",19,0)
 D:PRCSX3="A"&($O(^PRCS(410,PRCSY,12,0))) SCPC0^PRCSED
"RTN","PRCSEB0",20,0)
 I PRCSX3="A",$P(^PRCS(410,DA,0),U,4)=1 S X=$P(^(4),U,6),X1=$P(^(3),U,7) I $J(X,0,2)'=$J(X1,0,2)!('X)!('X1) W $C(7),!,"Adj $ Amt does not equal the total of BOC $ Amts.",!,"Please correct the error.",! K DR G EDTD3
"RTN","PRCSEB0",21,0)
 I PRCSX3="A",$P(^PRCS(410,DA,0),"^",4)=1 D W6^PRCSEB
"RTN","PRCSEB0",22,0)
 I PRCSX3'="O" G EDTD2
"RTN","PRCSEB0",23,0)
EDTD4 I $D(^PRCS(410,DA,7)),$P(^(7),"^",6)'="" S DR="[PRCSEDS]" D ^DIE D W1 G EDTD2
"RTN","PRCSEB0",24,0)
EDTD5 ;*81 Loop now checks site parameter to see if Issue Books should be allowed
"RTN","PRCSEB0",25,0)
 S X=+$P(^PRCS(410,DA,0),"^",4) I X<2 D
"RTN","PRCSEB0",26,0)
 .I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>1&(Y<5)",PRCVY="The 1358, Issue Book, and NO FORM types are not valid for use in this option."
"RTN","PRCSEB0",27,0)
 .I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>1",PRCVY="The 1358 and NO FORM types are not valid for use in this option."
"RTN","PRCSEB0",28,0)
 .W !,PRCVY,!
"RTN","PRCSEB0",29,0)
 .W !,"Please enter another form type.",!
"RTN","PRCSEB0",30,0)
 .S PRCDAA=DA,DIC="^PRCS(410.5,",DIC("A")="FORM TYPE: ",DIC(0)="AEQZ",DIC("S")=PRCVX,DIC("B")=4 D ^DIC S:Y=-1 Y=4 S DA=PRCDAA K DIC
"RTN","PRCSEB0",31,0)
 .K PRCVX,PRCVY
"RTN","PRCSEB0",32,0)
 .S $P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y
"RTN","PRCSEB0",33,0)
 I $G(PRCSIP) S $P(^PRCS(410,DA,0),"^",6)=PRCSIP
"RTN","PRCSEB0",34,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVZ=1
"RTN","PRCSEB0",35,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVZ=0
"RTN","PRCSEB0",36,0)
 W !,"The form type for this transaction is ",$P($G(^PRCS(410.5,X,0)),"^"),!
"RTN","PRCSEB0",37,0)
 I PRCVZ=1,X=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP Issue Book order." D W3 G:%'=1 EXIT W !! K PRCS,PRCS2 G EDTD
"RTN","PRCSEB0",38,0)
 ;P182--Removed reference to TEMPREQ in following line: no longer used.
"RTN","PRCSEB0",39,0)
 ;Q:$D(TEMPREQ)  S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSEB0",40,0)
 K PRCVZ
"RTN","PRCSEB0",41,0)
 S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSEB0",42,0)
 G EDTD2:X=""
"RTN","PRCSEB0",43,0)
 S PRCSTYP=X     ;PRC*5.1*196
"RTN","PRCSEB0",44,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",1:"PRCSENIB")_"]"
"RTN","PRCSEB0",45,0)
ED1 K DTOUT,DUOUT,Y S PRCSDAA=DA D ^DIE I $D(Y) S DA=PRCSDAA L -^PRCS(410,DA) G EXIT   ;PRC*5.1*196
"RTN","PRCSEB0",46,0)
CMDAT I PRCSTYP>1,PRCSTYP<5,$P(^PRCS(410,DA,4),U,2)="" D          ;PRC*5.1*196
"RTN","PRCSEB0",47,0)
 . S PRCOMDT=$S($P(^PRCS(410,DA,1),U,4)'=DT:$P(^PRCS(410,DA,1),U,4),1:DT)
"RTN","PRCSEB0",48,0)
 . S DR="21///^S X=PRCOMDT",DIE="^PRCS(410," D ^DIE
"RTN","PRCSEB0",49,0)
 S DA=PRCSDAA D RL^PRCSUT1
"RTN","PRCSEB0",50,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G ED1
"RTN","PRCSEB0",51,0)
 K PRCSERR
"RTN","PRCSEB0",52,0)
 I PRCSDR="[PRCSENCOD]" D W7 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSEB0",53,0)
 S:$P($G(^PRCS(410,DA,7)),U)="" $P(^PRCS(410,DA,7),U)=DUZ,$P(^PRCS(410,DA,7),U,2)=$P($G(^VA(200,DUZ,20)),U,3)
"RTN","PRCSEB0",54,0)
 ;
"RTN","PRCSEB0",55,0)
 ;if 2237 required field checks fail, warn user (PRC*5.1*174)
"RTN","PRCSEB0",56,0)
 I PRCSDR'="[PRCSENCOD]",'$$REQCHECK^PRCHJUTL($G(DA),,1)
"RTN","PRCSEB0",57,0)
 ;
"RTN","PRCSEB0",58,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I $D(PRCS2),+^PRCS(410,DA,0) D W6^PRCSEB
"RTN","PRCSEB0",59,0)
EDTD2 S DA=PRCSDAA L -^PRCS(410,DA) G EXIT:$D(PRCSQ) D W3 G EXIT:%'=1 W !! K PRCS,PRCS2 G EDTD
"RTN","PRCSEB0",60,0)
ASK W !!,"This transaction does not have a valid transaction type (e.g.,O for Obligation, A for Adjustment, C for Ceiling).  Please enter one now.",! S DR="1" D ^DIE K DR G EDTD1
"RTN","PRCSEB0",61,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSEB0",62,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSEB0",63,0)
W3 W !!,"Would you like to edit another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEB0",64,0)
W7 W !,"Do you wish to enter obligation data" S %=1 D YN^DICN Q:%=-1!(%=2)  G W7:%=0 S:%=1 PRCSOB=1 Q
"RTN","PRCSEB0",65,0)
EXIT K %,C,D,DA,DIC,DIE,DQ,DR,PRCS,PRCS2,PRCSDAA,PRCSDR,PRCSL,PRCSTT,I,N,T,T1,T2,X,X1,PRCSX3,Y,Z,Z7,PRCVZ,PRCSTYP,PRCOMDT Q
"VER")
8.0^22.0
**INSTALL NAME**
GEC*2.0*40
"BLD",7584,0)
GEC*2.0*40^GENERIC CODE SHEET^0^3171116^y
"BLD",7584,1,0)
^^2^2^3160627^
"BLD",7584,1,1,0)
1. Modify GEC document for correct date in CTL segment for IFCAP orders
"BLD",7584,1,2,0)
   and 1358 when Date Committed not in current Fiscal Year
"BLD",7584,4,0)
^9.64PA^^
"BLD",7584,6.3)
13
"BLD",7584,"ABPKG")
n
"BLD",7584,"KRN",0)
^9.67PA^779.2^20
"BLD",7584,"KRN",.4,0)
.4
"BLD",7584,"KRN",.401,0)
.401
"BLD",7584,"KRN",.402,0)
.402
"BLD",7584,"KRN",.403,0)
.403
"BLD",7584,"KRN",.5,0)
.5
"BLD",7584,"KRN",.84,0)
.84
"BLD",7584,"KRN",3.6,0)
3.6
"BLD",7584,"KRN",3.8,0)
3.8
"BLD",7584,"KRN",9.2,0)
9.2
"BLD",7584,"KRN",9.8,0)
9.8
"BLD",7584,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7584,"KRN",9.8,"NM",1,0)
GECSUFMS^^0^B23945626
"BLD",7584,"KRN",9.8,"NM","B","GECSUFMS",1)

"BLD",7584,"KRN",19,0)
19
"BLD",7584,"KRN",19.1,0)
19.1
"BLD",7584,"KRN",101,0)
101
"BLD",7584,"KRN",409.61,0)
409.61
"BLD",7584,"KRN",771,0)
771
"BLD",7584,"KRN",779.2,0)
779.2
"BLD",7584,"KRN",870,0)
870
"BLD",7584,"KRN",8989.51,0)
8989.51
"BLD",7584,"KRN",8989.52,0)
8989.52
"BLD",7584,"KRN",8994,0)
8994
"BLD",7584,"KRN","B",.4,.4)

"BLD",7584,"KRN","B",.401,.401)

"BLD",7584,"KRN","B",.402,.402)

"BLD",7584,"KRN","B",.403,.403)

"BLD",7584,"KRN","B",.5,.5)

"BLD",7584,"KRN","B",.84,.84)

"BLD",7584,"KRN","B",3.6,3.6)

"BLD",7584,"KRN","B",3.8,3.8)

"BLD",7584,"KRN","B",9.2,9.2)

"BLD",7584,"KRN","B",9.8,9.8)

"BLD",7584,"KRN","B",19,19)

"BLD",7584,"KRN","B",19.1,19.1)

"BLD",7584,"KRN","B",101,101)

"BLD",7584,"KRN","B",409.61,409.61)

"BLD",7584,"KRN","B",771,771)

"BLD",7584,"KRN","B",779.2,779.2)

"BLD",7584,"KRN","B",870,870)

"BLD",7584,"KRN","B",8989.51,8989.51)

"BLD",7584,"KRN","B",8989.52,8989.52)

"BLD",7584,"KRN","B",8994,8994)

"BLD",7584,"QUES",0)
^9.62^^
"BLD",7584,"REQB",0)
^9.611^1^1
"BLD",7584,"REQB",1,0)
GEC*2.0*34^2
"BLD",7584,"REQB","B","GEC*2.0*34",1)

"MBREQ")
0
"PKG",155,-1)
1^1
"PKG",155,0)
GENERIC CODE SHEET^GEC^GENERIC CODE SHEET
"PKG",155,20,0)
^9.402P^^
"PKG",155,22,0)
^9.49I^1^1
"PKG",155,22,1,0)
2.0^2950210^2960703
"PKG",155,22,1,"PAH",1,0)
40^3171116
"PKG",155,22,1,"PAH",1,1,0)
^^2^2^3171116
"PKG",155,22,1,"PAH",1,1,1,0)
1. Modify GEC document for correct date in CTL segment for IFCAP orders
"PKG",155,22,1,"PAH",1,1,2,0)
   and 1358 when Date Committed not in current Fiscal Year
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GECSUFMS")
0^1^B23945626
"RTN","GECSUFMS",1,0)
GECSUFMS ;WISC/RFJ/KLD-fms utilities ;10/13/98
"RTN","GECSUFMS",2,0)
 ;;2.0;GCS;**7,8,15,19,30,31,34,40**;MAR 14, 1995;Build 13
"RTN","GECSUFMS",3,0)
 Q
"RTN","GECSUFMS",4,0)
 ;
"RTN","GECSUFMS",5,0)
 ;GEC*2.0*40 Modified document MOA segment to insure the
"RTN","GECSUFMS",6,0)
 ;           document transaction date used was from 
"RTN","GECSUFMS",7,0)
 ;           Committed Date in file 410 entry and handles
"RTN","GECSUFMS",8,0)
 ;           the FY/FQ correctly when date is before 
"RTN","GECSUFMS",9,0)
 ;           or after current FY.
"RTN","GECSUFMS",10,0)
 ;
"RTN","GECSUFMS",11,0)
CONTROL(SYSTEM,STATION,DOCUMENT,TRANCODE,SECCODE,MODFLAG,FCPFLAG,DESCRIPT,COMMDATE) ;  return fms control segment
"RTN","GECSUFMS",12,0)
 ;  system = "A" for ar, "I" for ifcap, "E" for eng, "C" for create doc
"RTN","GECSUFMS",13,0)
 ;  station = 3 digit station number
"RTN","GECSUFMS",14,0)
 ;  document = source document [sta-po####xx] where xx=partial (opt)
"RTN","GECSUFMS",15,0)
 ;  trancode = MO, SV, etc for class = DOC
"RTN","GECSUFMS",16,0)
 ;           = VR for vendor requests
"RTN","GECSUFMS",17,0)
 ;  seccode = security 1 code (usually '10  ')
"RTN","GECSUFMS",18,0)
 ;  modflag = 1 for modification document (batch number auto gen)
"RTN","GECSUFMS",19,0)
 ;  fcpflag = Y if transaction has updated ifcap fcp balance
"RTN","GECSUFMS",20,0)
 ;            use only for tran-code AR, CR, IV, MO, SA, ST
"RTN","GECSUFMS",21,0)
 ;  descript = description of event
"RTN","GECSUFMS",22,0)
 ;  return gecsfms("ctl"), gecsfms("bat"), gecsfms("doc")
"RTN","GECSUFMS",23,0)
 N %,%H,%I,BATNUMB,DATE,FY,H,M,S,SEGMENT,STACK,TIME,TRANCLAS,X,Y,SYSTEMI,GECOMDT    ;GEC*2.0*40
"RTN","GECSUFMS",24,0)
 K GECSFMS
"RTN","GECSUFMS",25,0)
 S SYSTEMI=SYSTEM ; save initial system for rebuild
"RTN","GECSUFMS",26,0)
 S SYSTEM=$S($E(SYSTEM)="A":"ARS",$E(SYSTEM)="I":"IFC",$E(SYSTEM)="E":"AMM",1:"CFD")
"RTN","GECSUFMS",27,0)
 S STATION=$E(STATION,1,3)
"RTN","GECSUFMS",28,0)
 S DOCUMENT=$E($TR(DOCUMENT,"-")_"           ",1,11)
"RTN","GECSUFMS",29,0)
 S TRANCODE=$E(TRANCODE,1,2)
"RTN","GECSUFMS",30,0)
 S SECCODE=$E(SECCODE_"    ",1,4)
"RTN","GECSUFMS",31,0)
GCOMDT D NOW^%DTC S Y=%,(GECOMDT,DATE)=X D DD^%DT    ;GEC*2.0*40
"RTN","GECSUFMS",32,0)
 I $G(COMMDATE) S GECOMDT=COMMDATE,TIME="100000"
"RTN","GECSUFMS",33,0)
 S %=$P(Y,"@",2),H=$P(%,":"),M=$P(%,":",2),S=$P(%,":",3),H=$E("00",$L(H)+1,2)_H,M=$E("00",$L(M)+1,2)_M,S=$E("00",$L(S)+1,2)_S,TIME=H_M_S
"RTN","GECSUFMS",34,0)
 S Y=X X ^DD("DD") S FY=$S(GECOMDT>($E(DATE,1,3)_"0930"):$E(DATE,2,3)+1,GECOMDT<DATE:999,1:$E(DATE,2,3))    ;GEC*2.0*40
"RTN","GECSUFMS",35,0)
 I FY=999 D    ;GEC*2.0*40
"RTN","GECSUFMS",36,0)
 . I $E(GECOMDT,1,3)=$E(DATE,1,3)!((GECOMDT>($E(DATE,1,3)-1)_"0930")) S FY=$E(DATE,2,3) Q
"RTN","GECSUFMS",37,0)
 . I GECOMDT>($E(GECOMDT,1,3)_"0930"),GECOMDT<($E(GECOMDT,1,3)_1232) S FY=$E(GECOMDT,2,3)+1 Q
"RTN","GECSUFMS",38,0)
 . S FY=$E(GECOMDT,2,3)
"RTN","GECSUFMS",39,0)
 S STACK=TRANCODE_"-"_DOCUMENT
"RTN","GECSUFMS",40,0)
 ; check if STACK exists in 2100.1 file
"RTN","GECSUFMS",41,0)
 K GECSDATA
"RTN","GECSUFMS",42,0)
 D DATA^GECSSGET(STACK,0)
"RTN","GECSUFMS",43,0)
 I $G(GECSDATA)>0,MODFLAG'>0 S GECSTEST=GECSDATA D  Q
"RTN","GECSUFMS",44,0)
 .    ;STACK entry exists.  convert CONTROL call into REBUILD call
"RTN","GECSUFMS",45,0)
 .    D REBUILD^GECSUFM1(GECSDATA,SYSTEMI,SECCODE,FCPFLAG,DESCRIPT)
"RTN","GECSUFMS",46,0)
 .    S DA=GECSTEST,GECSFMS("DA")=GECSTEST
"RTN","GECSUFMS",47,0)
 .    K GECSDATA,GECSTEST
"RTN","GECSUFMS",48,0)
 ;
"RTN","GECSUFMS",49,0)
 I MODFLAG F  S %=$$ACOUNTER^GECSUNUM(STATION_"-FMS:BATCH-"_FY),%=$E(%,$L(%)-2,$L(%)),%=$E("000",$L(%)+1,3)_%,X=STACK_"-"_STATION_% I '$D(^GECS(2100.1,"B",X)) L +^GECS(2100.1,"AZ",X):0 I $T S STACK=X Q
"RTN","GECSUFMS",50,0)
 S BATNUMB=$E($P(STACK,"-",3)_"      ",1,6)
"RTN","GECSUFMS",51,0)
 S TRANCLAS="DOC" I TRANCODE="VR" S TRANCLAS="VRQ",TRANCODE="  "
"RTN","GECSUFMS",52,0)
 S GECSFMS("CTL")="CTL^"_SYSTEM_"^FMS^"_$E(STATION,1,3)_"^"_TRANCLAS_"^"_TRANCODE_"^"_SECCODE_"^"_$E(BATNUMB,1,6)_"^"_DOCUMENT_"^"_(17+$E(GECOMDT))_$E(GECOMDT,2,7)_"^"_TIME_"^001^001^001^"_$C(126)    ;GEC*2.0*40
"RTN","GECSUFMS",53,0)
 ;
"RTN","GECSUFMS",54,0)
 ;  vendor request, add ctl to stack and quit
"RTN","GECSUFMS",55,0)
 I TRANCLAS="VRQ" D  Q
"RTN","GECSUFMS",56,0)
 .   S GECSFMS("DA")=$$ADD^GECSSTAA("VR:FMS",GECSFMS("CTL"),"","",DESCRIPT)
"RTN","GECSUFMS",57,0)
 .   L -^GECS(2100.1,"AZ",STACK)
"RTN","GECSUFMS",58,0)
 ;
"RTN","GECSUFMS",59,0)
 ;  change segment for specific transaction codes
"RTN","GECSUFMS",60,0)
 S SEGMENT=TRANCODE
"RTN","GECSUFMS",61,0)
 I TRANCODE="CF"!(TRANCODE="WR")!(TRANCODE="TR") S SEGMENT="CR"
"RTN","GECSUFMS",62,0)
 I TRANCODE="DV"!(TRANCODE="ET") S SEGMENT="DD"
"RTN","GECSUFMS",63,0)
 I TRANCODE="AO"!(TRANCODE="CO")!(TRANCODE="SO")!(TRANCODE="TG")!(TRANCODE="WO") S SEGMENT="MO"
"RTN","GECSUFMS",64,0)
 I TRANCODE="AV"!(TRANCODE="CT")!(TRANCODE="MV")!(TRANCODE="OP")!(TRANCODE="PS")!(TRANCODE="TD") S SEGMENT="PV"
"RTN","GECSUFMS",65,0)
 I TRANCODE="AR"!(TRANCODE="RT") S SEGMENT="RC"
"RTN","GECSUFMS",66,0)
 I TRANCODE="BV" S SEGMENT="SV"
"RTN","GECSUFMS",67,0)
 I TRANCODE="RO"!(TRANCODE="TZ") S SEGMENT="TO"
"RTN","GECSUFMS",68,0)
 I TRANCODE="RV"!(TRANCODE="TY") S SEGMENT="TV"
"RTN","GECSUFMS",69,0)
 ;  create bat segment
"RTN","GECSUFMS",70,0)
 I MODFLAG S GECSFMS("BAT")="BAT^"_$C(126)_SEGMENT_"0^"_BATNUMB_"^"_$C(126)
"RTN","GECSUFMS",71,0)
 ;  create doc and <tc>1 segments
"RTN","GECSUFMS",72,0)
 I "RC^CR^TR^IV^MO^SA^ST"[SEGMENT S FCPFLAG=$S(FCPFLAG="Y":"Y",1:"N")_"^"
"RTN","GECSUFMS",73,0)
 ;  security code is not on the sa1,st1 code sheets
"RTN","GECSUFMS",74,0)
 S SECCODE=SECCODE_"^"
"RTN","GECSUFMS",75,0)
 I "SA^ST"[SEGMENT S SECCODE=""
"RTN","GECSUFMS",76,0)
 S GECSFMS("DOC")="DOC^"_$C(126)
"RTN","GECSUFMS",77,0)
 ;  do not create <tc>1 document for at transaction code or amm system
"RTN","GECSUFMS",78,0)
 I SEGMENT'="AT",SYSTEM'="AMM" S GECSFMS("DOC")=GECSFMS("DOC")_SEGMENT_"1^"_TRANCODE_"^"_DOCUMENT_"^"_SECCODE_FCPFLAG_$C(126)
"RTN","GECSUFMS",79,0)
 ;  add entry and control segment to stack file
"RTN","GECSUFMS",80,0)
 S GECSFMS("DA")=$$ADD^GECSSTAA(TRANCODE_":FMS",GECSFMS("CTL"),$G(GECSFMS("BAT")),GECSFMS("DOC"),DESCRIPT)
"RTN","GECSUFMS",81,0)
 L -^GECS(2100.1,"AZ",STACK)
"RTN","GECSUFMS",82,0)
 Q
"RTN","GECSUFMS",83,0)
 ;
"RTN","GECSUFMS",84,0)
 ;
"RTN","GECSUFMS",85,0)
TRANSMIT ;  transmit fms document from file 2100 immediately without batching
"RTN","GECSUFMS",86,0)
 ;  called from gecsxbl1 routine
"RTN","GECSUFMS",87,0)
 N %,CTLDATA,DA,GECSFMS,STACK
"RTN","GECSUFMS",88,0)
 S CTLDATA=$G(^GECS(2100,GECS("CSDA"),"FMS"))
"RTN","GECSUFMS",89,0)
 ;  ctldata=trancode^transnumber^modification=Y^securitycode^fcpflag
"RTN","GECSUFMS",90,0)
 D CONTROL("C",GECS("SITE"),$P(CTLDATA,"^",2),$P(CTLDATA,"^"),$P(CTLDATA,"^",4),$S($P(CTLDATA,"^",3)="Y":1,1:0),$P(CTLDATA,"^",5),"Create a Code Sheet Document")
"RTN","GECSUFMS",91,0)
 S DA=0 F  S DA=$O(^GECS(2100,GECS("CSDA"),"CODE",DA)) Q:'DA  S %=$G(^(DA,0)) I %'="" D SETCS^GECSSTAA(GECSFMS("DA"),%)
"RTN","GECSUFMS",92,0)
 ;  set status for queued task to pick up and transmit
"RTN","GECSUFMS",93,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","GECSUFMS",94,0)
 ;  set status in file 2100
"RTN","GECSUFMS",95,0)
 S STACK=$P($G(^GECS(2100.1,GECSFMS("DA"),0)),"^")
"RTN","GECSUFMS",96,0)
 S $P(^GECS(2100,GECS("CSDA"),"TRANS"),"^",3)=STACK
"RTN","GECSUFMS",97,0)
 W !!,"STACK FILE ENTRY: ",STACK,?53,"QUEUED FOR TRANSMISSION"
"RTN","GECSUFMS",98,0)
 W !?5,"document header automatically created:",!,GECSFMS("CTL")
"RTN","GECSUFMS",99,0)
 I $D(GECSFMS("BAT")) W !,GECSFMS("BAT")
"RTN","GECSUFMS",100,0)
 W !,$G(GECSFMS("DOC"))
"RTN","GECSUFMS",101,0)
 Q
"VER")
8.0^22.0
**END**
**END**
