KIDS Distribution saved on Sep 14, 2018@07:38:44
GMTS*2.7*94 / PSO*7.0*314 COMBINED BUILD
**KIDS**:GMTS*2.7*94^PSO*7.0*314^

**INSTALL NAME**
GMTS*2.7*94
"BLD",9073,0)
GMTS*2.7*94^HEALTH SUMMARY^0^3180914^y
"BLD",9073,4,0)
^9.64PA^^
"BLD",9073,6.3)
41
"BLD",9073,"INID")
^n
"BLD",9073,"INIT")
CI^GMTSPI94
"BLD",9073,"KRN",0)
^9.67PA^779.2^20
"BLD",9073,"KRN",.4,0)
.4
"BLD",9073,"KRN",.401,0)
.401
"BLD",9073,"KRN",.402,0)
.402
"BLD",9073,"KRN",.403,0)
.403
"BLD",9073,"KRN",.5,0)
.5
"BLD",9073,"KRN",.84,0)
.84
"BLD",9073,"KRN",3.6,0)
3.6
"BLD",9073,"KRN",3.8,0)
3.8
"BLD",9073,"KRN",9.2,0)
9.2
"BLD",9073,"KRN",9.8,0)
9.8
"BLD",9073,"KRN",9.8,"NM",0)
^9.68A^9^8
"BLD",9073,"KRN",9.8,"NM",2,0)
GMTSPST1^^0^B167015680
"BLD",9073,"KRN",9.8,"NM",3,0)
GMTSPI94^^0^B7561147
"BLD",9073,"KRN",9.8,"NM",4,0)
GMTSPST4^^0^B17358718
"BLD",9073,"KRN",9.8,"NM",5,0)
GMTSPST5^^0^B13367450
"BLD",9073,"KRN",9.8,"NM",6,0)
GMTSPSTR^^0^B1733586
"BLD",9073,"KRN",9.8,"NM",7,0)
GMTSPSCK^^0^B5589868
"BLD",9073,"KRN",9.8,"NM",8,0)
GMTSPSTN^^0^B180171627
"BLD",9073,"KRN",9.8,"NM",9,0)
GMTSGLOS^^0^B14557009
"BLD",9073,"KRN",9.8,"NM","B","GMTSGLOS",9)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPI94",3)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPSCK",7)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPST1",2)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPST4",4)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPST5",5)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPSTN",8)

"BLD",9073,"KRN",9.8,"NM","B","GMTSPSTR",6)

"BLD",9073,"KRN",19,0)
19
"BLD",9073,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",9073,"KRN",19,"NM",1,0)
GMTS PS MED RECON CONFIG CHECK^^0
"BLD",9073,"KRN",19,"NM",2,0)
GMTS IRM/ADPAC MAINT MENU^^2
"BLD",9073,"KRN",19,"NM","B","GMTS IRM/ADPAC MAINT MENU",2)

"BLD",9073,"KRN",19,"NM","B","GMTS PS MED RECON CONFIG CHECK",1)

"BLD",9073,"KRN",19.1,0)
19.1
"BLD",9073,"KRN",101,0)
101
"BLD",9073,"KRN",409.61,0)
409.61
"BLD",9073,"KRN",771,0)
771
"BLD",9073,"KRN",779.2,0)
779.2
"BLD",9073,"KRN",870,0)
870
"BLD",9073,"KRN",8989.51,0)
8989.51
"BLD",9073,"KRN",8989.52,0)
8989.52
"BLD",9073,"KRN",8994,0)
8994
"BLD",9073,"KRN","B",.4,.4)

"BLD",9073,"KRN","B",.401,.401)

"BLD",9073,"KRN","B",.402,.402)

"BLD",9073,"KRN","B",.403,.403)

"BLD",9073,"KRN","B",.5,.5)

"BLD",9073,"KRN","B",.84,.84)

"BLD",9073,"KRN","B",3.6,3.6)

"BLD",9073,"KRN","B",3.8,3.8)

"BLD",9073,"KRN","B",9.2,9.2)

"BLD",9073,"KRN","B",9.8,9.8)

"BLD",9073,"KRN","B",19,19)

"BLD",9073,"KRN","B",19.1,19.1)

"BLD",9073,"KRN","B",101,101)

"BLD",9073,"KRN","B",409.61,409.61)

"BLD",9073,"KRN","B",771,771)

"BLD",9073,"KRN","B",779.2,779.2)

"BLD",9073,"KRN","B",870,870)

"BLD",9073,"KRN","B",8989.51,8989.51)

"BLD",9073,"KRN","B",8989.52,8989.52)

"BLD",9073,"KRN","B",8994,8994)

"BLD",9073,"QUES",0)
^9.62^^
"BLD",9073,"REQB",0)
^9.611^1^1
"BLD",9073,"REQB",1,0)
PSO*7.0*294^1
"BLD",9073,"REQB","B","PSO*7.0*294",1)

"INIT")
CI^GMTSPI94
"KRN",19,7007,-1)
2^2
"KRN",19,7007,0)
GMTS IRM/ADPAC MAINT MENU^Health Summary Maintenance Menu^^M^.5^^^^^^y^160
"KRN",19,7007,10,0)
^19.01PI^11^11
"KRN",19,7007,10,11,0)
14505^11
"KRN",19,7007,10,11,"^")
GMTS PS MED RECON CONFIG CHECK
"KRN",19,7007,"U")
HEALTH SUMMARY MAINTENANCE MEN
"KRN",19,14505,-1)
0^1
"KRN",19,14505,0)
GMTS PS MED RECON CONFIG CHECK^Check Medication Reconciliation Configuration^^R^^^^^^^^HEALTH SUMMARY
"KRN",19,14505,1,0)
^^3^3^3160408^
"KRN",19,14505,1,1,0)
This option allows a site to confirm that the setup of Health Summary 
"KRN",19,14505,1,2,0)
Types is consistent with the intent of the Medication Reconciliation 
"KRN",19,14505,1,3,0)
approach for use as the 'Essential Med List for Review'.
"KRN",19,14505,25)
EN1^GMTSPSCK
"KRN",19,14505,"U")
CHECK MEDICATION RECONCILIATIO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",160,-1)
1^1
"PKG",160,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",160,20,0)
^9.402P^^
"PKG",160,22,0)
^9.49I^1^1
"PKG",160,22,1,0)
2.7^2951020^2951219
"PKG",160,22,1,"PAH",1,0)
94^3180914^10000000200
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","GMTSGLOS")
0^9^B14557009
"RTN","GMTSGLOS",1,0)
GMTSGLOS ;BIR/RMS - GLOSSARY FOR MED RECON TOOL #1 (MED REC PROFILE) ;Apr 19, 2018@20:05
"RTN","GMTSGLOS",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSGLOS",3,0)
 ;
"RTN","GMTSGLOS",4,0)
FOOTER1 ;;
"RTN","GMTSGLOS",5,0)
 ;;==========PHARMACY TERMS AND POSSIBLE PATIENT ACTIONS===========
"RTN","GMTSGLOS",6,0)
 ;;
"RTN","GMTSGLOS",7,0)
 ;;INPT = VA inpatient order
"RTN","GMTSGLOS",8,0)
 ;;IV = VA intravenous medication
"RTN","GMTSGLOS",9,0)
 ;;OUTPT = VA outpatient prescription
"RTN","GMTSGLOS",10,0)
 ;;
"RTN","GMTSGLOS",11,0)
 ;;PHARMACY                                       POSSIBLE PATIENT
"RTN","GMTSGLOS",12,0)
 ;;TERMS        EXPLANATION                       ACTIONS
"RTN","GMTSGLOS",13,0)
 ;;--------     -------------------------------   -----------------
"RTN","GMTSGLOS",14,0)
 ;;
"RTN","GMTSGLOS",15,0)
 ;;ACTIVE       A prescription that can be        If you have refills,
"RTN","GMTSGLOS",16,0)
 ;;             filled at the local VA pharmacy.  you may request a
"RTN","GMTSGLOS",17,0)
 ;;                                               refill of this
"RTN","GMTSGLOS",18,0)
 ;;                                               prescription from
"RTN","GMTSGLOS",19,0)
 ;;                                               your VA pharmacy.
"RTN","GMTSGLOS",20,0)
 ;;
"RTN","GMTSGLOS",21,0)
 ;;CLINIC       A medication you received during  If you have questions
"RTN","GMTSGLOS",22,0)
 ;;             a visit to a VA clinic or         about this medication
"RTN","GMTSGLOS",23,0)
 ;;             emergency department.             contact your VA
"RTN","GMTSGLOS",24,0)
 ;;             healthcare team.
"RTN","GMTSGLOS",25,0)
 ;;
"RTN","GMTSGLOS",26,0)
 ;;DISCONTINUED A prescription your provider has  Contact your VA
"RTN","GMTSGLOS",27,0)
 ;;             stopped. It is no longer          healthcare team if you
"RTN","GMTSGLOS",28,0)
 ;;             available to be sent to you or    need more of this
"RTN","GMTSGLOS",29,0)
 ;;             picked up at the VA pharmacy      medication.
"RTN","GMTSGLOS",30,0)
 ;;             window.
"RTN","GMTSGLOS",31,0)
 ;;
"RTN","GMTSGLOS",32,0)
 ;;EXPIRED      A prescription which is too old   Contact your VA
"RTN","GMTSGLOS",33,0)
 ;;             to fill. This does not refer to   healthcare team if you
"RTN","GMTSGLOS",34,0)
 ;;             the expiration date of the        need more of this
"RTN","GMTSGLOS",35,0)
 ;;             medication in the container.      medication.
"RTN","GMTSGLOS",36,0)
 ;;
"RTN","GMTSGLOS",37,0)
 ;;NON-VA       A medication that came from       If this medication is
"RTN","GMTSGLOS",38,0)
 ;;             someplace other than a VA         medication information
"RTN","GMTSGLOS",39,0)
 ;;             pharmacy. This may be a           is incorrect or out of
"RTN","GMTSGLOS",40,0)
 ;;             prescription from either the VA   date, please tell your
"RTN","GMTSGLOS",41,0)
 ;;             other providers that was filled   VA healthcare team.
"RTN","GMTSGLOS",42,0)
 ;;             outside the VA. Or, it may be an
"RTN","GMTSGLOS",43,0)
 ;;             over-the-counter (OTC), herbal,
"RTN","GMTSGLOS",44,0)
 ;;             dietary supplement or sample
"RTN","GMTSGLOS",45,0)
 ;;             medication.
"RTN","GMTSGLOS",46,0)
 ;;
"RTN","GMTSGLOS",47,0)
 ;;ON HOLD      An active prescription that will  Contact your VA
"RTN","GMTSGLOS",48,0)
 ;;             not be filled until pharmacy      pharmacy when you need
"RTN","GMTSGLOS",49,0)
 ;;             resolves the issue.               more of this
"RTN","GMTSGLOS",50,0)
 ;;                                               medication.
"RTN","GMTSGLOS",51,0)
 ;;
"RTN","GMTSGLOS",52,0)
 ;;PENDING      This prescription order has been  If you have been
"RTN","GMTSGLOS",53,0)
 ;;             sent to the pharmacy for review   instructed to start the
"RTN","GMTSGLOS",54,0)
 ;;             and is not ready yet.             this medication now,
"RTN","GMTSGLOS",55,0)
 ;;                                               contact your VA
"RTN","GMTSGLOS",56,0)
 ;;                                               pharmacy.
"RTN","GMTSGLOS",57,0)
 ;;
"RTN","GMTSGLOS",58,0)
 ;;SUSPENDED    An active prescription that is    Contact your VA
"RTN","GMTSGLOS",59,0)
 ;;             not scheduled to be filled yet.   pharmacy if you need
"RTN","GMTSGLOS",60,0)
 ;;             You should receive it before you  this medication
"RTN","GMTSGLOS",61,0)
 ;;             run out.                          now.
"RTN","GMTSGLOS",62,0)
 ;;
"RTN","GMTSGLOS",63,0)
 ;;==================================================================
"RTN","GMTSGLOS",64,0)
 ;;$$END
"RTN","GMTSPI94")
0^3^B7561147
"RTN","GMTSPI94",1,0)
GMTSPI94 ;CIO/SLC - Post Install GMTS*2.7*94    ;May 15, 2018@07:50
"RTN","GMTSPI94",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPI94",3,0)
 Q
"RTN","GMTSPI94",4,0)
CI ; Component Install
"RTN","GMTSPI94",5,0)
 N GMTSIN,GMTSLIM,GMTSINST,GMTSTL,GMTSINST,GMTSTOT,GMTSBLD,GMTSCPS,GMTSCP,GMTSCI
"RTN","GMTSPI94",6,0)
 S GMTSCPS="MRT1;MRT4;MRT5;MRR1"
"RTN","GMTSPI94",7,0)
 F GMTSCI=1:1 Q:'$L($P(GMTSCPS,";",GMTSCI))  D
"RTN","GMTSPI94",8,0)
 . S GMTSCP=$P(GMTSCPS,";",GMTSCI) K GMTSIN
"RTN","GMTSPI94",9,0)
 . D ARRAY Q:'$D(GMTSIN)
"RTN","GMTSPI94",10,0)
 . I $L($G(GMTSIN("TIM"))),+($G(GMTSIN(0)))>0 S GMTSLIM(+($G(GMTSIN(0))),"TIM")=$G(GMTSIN("TIM"))
"RTN","GMTSPI94",11,0)
 . I $L($G(GMTSIN("OCC"))),+($G(GMTSIN(0)))>0 S GMTSLIM(+($G(GMTSIN(0))),"OCC")=$G(GMTSIN("OCC"))
"RTN","GMTSPI94",12,0)
 . S GMTSINST=$$ADD^GMTSXPD1(.GMTSIN),GMTSTOT=+($G(GMTSTOT))+($G(GMTSINST))
"RTN","GMTSPI94",13,0)
 ; Rebuild Ad Hoc Health Summary Type
"RTN","GMTSPI94",14,0)
 D:+($G(GMTSTOT))>0 BUILD^GMTSXPD3
"RTN","GMTSPI94",15,0)
 D LIM
"RTN","GMTSPI94",16,0)
 I +$$ROK("GMTSXPS1")>0 D
"RTN","GMTSPI94",17,0)
 . N GMTSHORT S GMTSHORT=1,GMTSINST="",GMTSBLD="GMTS*2.7*94" D SEND^GMTSXPS1
"RTN","GMTSPI94",18,0)
 Q
"RTN","GMTSPI94",19,0)
ARRAY ; Build Array
"RTN","GMTSPI94",20,0)
 K GMTSIN N GMTSI,GMTSTXT,GMTSEX,GMTSFLD,GMTSUB,GMTSVAL,GMTSPDX S GMTSPDX=1,GMTSCP=$G(GMTSCP) Q:'$L(GMTSCP)
"RTN","GMTSPI94",21,0)
 F GMTSI=1:1 D  Q:'$L(GMTSTXT)
"RTN","GMTSPI94",22,0)
 . S GMTSTXT="",GMTSEX="S GMTSTXT=$T("_GMTSCP_"+"_GMTSI_")" X GMTSEX S:$L(GMTSTXT,";")'>3 GMTSTXT="" Q:'$L(GMTSTXT)
"RTN","GMTSPI94",23,0)
 . S GMTSFLD=$P(GMTSTXT,";",2),GMTSUB=$P(GMTSTXT,";",3),GMTSVAL=$P(GMTSTXT,";",4)
"RTN","GMTSPI94",24,0)
 . S:$E(GMTSFLD,1)=1&(+GMTSFLD<2) GMTSVAL=$P(GMTSTXT,";",4,5)
"RTN","GMTSPI94",25,0)
 . S:$E(GMTSFLD,1)=" "!('$L(GMTSFLD)) GMTSTXT="" Q:GMTSTXT=""
"RTN","GMTSPI94",26,0)
 . S:$L(GMTSFLD)&('$L(GMTSUB)) GMTSIN(GMTSFLD)=GMTSVAL Q:$L(GMTSFLD)&('$L(GMTSUB))  S:$L(GMTSFLD)&($L(GMTSUB)) GMTSIN(GMTSFLD,GMTSUB)=GMTSVAL
"RTN","GMTSPI94",27,0)
 . S:$G(GMTSFLD)=7&(+($G(GMTSUB))>0) GMTSPDX=0
"RTN","GMTSPI94",28,0)
 K:+($G(GMTSPDX))=0 GMTSIN("PDX")
"RTN","GMTSPI94",29,0)
 Q
"RTN","GMTSPI94",30,0)
LIM ; Limits
"RTN","GMTSPI94",31,0)
 N GMTSI,GMTST,GMTSO,GMTSA S GMTSI=0 F  S GMTSI=$O(GMTSLIM(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSPI94",32,0)
 . S GMTSA=$P($G(^GMT(142.1,+($G(GMTSI)),0)),"^",3),GMTST=$G(GMTSLIM(+GMTSI,"TIM")) S:'$L(GMTST) GMTST=$S(GMTSA="Y ":"1Y ",1:"")
"RTN","GMTSPI94",33,0)
 . S GMTSA=$P($G(^GMT(142.1,+($G(GMTSI)),0)),"^",5),GMTSO=$G(GMTSLIM(+GMTSI,"OCC")) S:'$L(GMTSO) GMTSO=$S(GMTSA="Y ":"10 ",1:"")
"RTN","GMTSPI94",34,0)
 . D TO^GMTSXPD3(GMTSI,GMTST,GMTSO)
"RTN","GMTSPI94",35,0)
 Q
"RTN","GMTSPI94",36,0)
ROK(X) ; Routine OK
"RTN","GMTSPI94",37,0)
 S X=$G(X) Q:'$L(X) 0 N GMTSEX,GMTSTXT S GMTSEX="S GMTSTXT=$T(+1^"_X_")" X GMTSEX
"RTN","GMTSPI94",38,0)
 Q:'$L(GMTSTXT) 0  Q 1
"RTN","GMTSPI94",39,0)
 ;
"RTN","GMTSPI94",40,0)
MRT1 ; Med Reconciliation Component Data
"RTN","GMTSPI94",41,0)
 ;0;;258
"RTN","GMTSPI94",42,0)
 ;.01;;Med. Reconciliation (Tool #1)
"RTN","GMTSPI94",43,0)
 ;1;;TOOL1;GMTSPST1
"RTN","GMTSPI94",44,0)
 ;1.1;;0
"RTN","GMTSPI94",45,0)
 ;2;;
"RTN","GMTSPI94",46,0)
 ;3;;MRT1
"RTN","GMTSPI94",47,0)
 ;3.5;;5
"RTN","GMTSPI94",48,0)
 ;3.5;1;This component generates a list of the patient's complete medication
"RTN","GMTSPI94",49,0)
 ;3.5;2;profile, including Outpatient Rx's, Inpatient Medication Orders, Clinic
"RTN","GMTSPI94",50,0)
 ;3.5;3;Orders, Non-VA Medications, and Remote Active Medications.  It is sorted
"RTN","GMTSPI94",51,0)
 ;3.5;4;alphabetically by drug name, creating groups of outpatient/inpatient
"RTN","GMTSPI94",52,0)
 ;3.5;5;orders for the same item in order to facilitate medication reconciliation.
"RTN","GMTSPI94",53,0)
 ;4;;
"RTN","GMTSPI94",54,0)
 ;5;;
"RTN","GMTSPI94",55,0)
 ;6;;
"RTN","GMTSPI94",56,0)
 ;7;;0
"RTN","GMTSPI94",57,0)
 ;8;;
"RTN","GMTSPI94",58,0)
 ;9;;Med Reconciliation
"RTN","GMTSPI94",59,0)
 ;10;;
"RTN","GMTSPI94",60,0)
 ;11;;
"RTN","GMTSPI94",61,0)
 ;12;;
"RTN","GMTSPI94",62,0)
 ;13;;
"RTN","GMTSPI94",63,0)
 ;14;;
"RTN","GMTSPI94",64,0)
 ;PDX;;1
"RTN","GMTSPI94",65,0)
 ;
"RTN","GMTSPI94",66,0)
 Q
"RTN","GMTSPI94",67,0)
 ;
"RTN","GMTSPI94",68,0)
MRT4 ; Remote Active Meds (Tool #4) Component Data
"RTN","GMTSPI94",69,0)
 ;0;;261
"RTN","GMTSPI94",70,0)
 ;.01;;Remote Active Meds (Tool #4)
"RTN","GMTSPI94",71,0)
 ;1;;ENHS;GMTSPST4
"RTN","GMTSPI94",72,0)
 ;1.1;;0
"RTN","GMTSPI94",73,0)
 ;2;;
"RTN","GMTSPI94",74,0)
 ;3;;MRT4
"RTN","GMTSPI94",75,0)
 ;3.5;;2
"RTN","GMTSPI94",76,0)
 ;3.5;1;This component will display the details of a patient's remote active
"RTN","GMTSPI94",77,0)
 ;3.5;2;outpatient medications using data from the Health Data Repository.
"RTN","GMTSPI94",78,0)
 ;4;;
"RTN","GMTSPI94",79,0)
 ;5;;
"RTN","GMTSPI94",80,0)
 ;6;;
"RTN","GMTSPI94",81,0)
 ;7;;0
"RTN","GMTSPI94",82,0)
 ;8;;
"RTN","GMTSPI94",83,0)
 ;9;;
"RTN","GMTSPI94",84,0)
 ;10;;
"RTN","GMTSPI94",85,0)
 ;11;;
"RTN","GMTSPI94",86,0)
 ;12;;
"RTN","GMTSPI94",87,0)
 ;13;;
"RTN","GMTSPI94",88,0)
 ;14;;
"RTN","GMTSPI94",89,0)
 ;PDX;;1
"RTN","GMTSPI94",90,0)
 ;
"RTN","GMTSPI94",91,0)
 Q
"RTN","GMTSPI94",92,0)
 ;
"RTN","GMTSPI94",93,0)
MRT5 ; Allergies/ADRs Component Data
"RTN","GMTSPI94",94,0)
 ;0;;262
"RTN","GMTSPI94",95,0)
 ;.01;;Allergies/ADRs (Tool #5)
"RTN","GMTSPI94",96,0)
 ;1;;ENHS;GMTSPST5
"RTN","GMTSPI94",97,0)
 ;1.1;;0
"RTN","GMTSPI94",98,0)
 ;2;;
"RTN","GMTSPI94",99,0)
 ;3;;MRT5
"RTN","GMTSPI94",100,0)
 ;3.5;;4
"RTN","GMTSPI94",101,0)
 ;3.5;1;This component displays local facility and remote facility allergy and
"RTN","GMTSPI94",102,0)
 ;3.5;2;adverse data information using the Remote Data Interoperability features
"RTN","GMTSPI94",103,0)
 ;3.5;3;of the Health Data Repository.  Data from the local facility is merged
"RTN","GMTSPI94",104,0)
 ;3.5;4;into a single table with remote facility allergy/adverse reaction data.
"RTN","GMTSPI94",105,0)
 ;4;;
"RTN","GMTSPI94",106,0)
 ;5;;
"RTN","GMTSPI94",107,0)
 ;6;;
"RTN","GMTSPI94",108,0)
 ;7;;0
"RTN","GMTSPI94",109,0)
 ;8;;
"RTN","GMTSPI94",110,0)
 ;9;;Allergies/ADRs
"RTN","GMTSPI94",111,0)
 ;10;;
"RTN","GMTSPI94",112,0)
 ;11;;
"RTN","GMTSPI94",113,0)
 ;12;;
"RTN","GMTSPI94",114,0)
 ;13;;
"RTN","GMTSPI94",115,0)
 ;14;;
"RTN","GMTSPI94",116,0)
 ;PDX;;1
"RTN","GMTSPI94",117,0)
 ;
"RTN","GMTSPI94",118,0)
 Q
"RTN","GMTSPI94",119,0)
 ;
"RTN","GMTSPI94",120,0)
MRR1 ; Med Reconciliation Component Data
"RTN","GMTSPI94",121,0)
 ;0;;267
"RTN","GMTSPI94",122,0)
 ;.01;;Med Recon NoGlossary (Tool #1)
"RTN","GMTSPI94",123,0)
 ;1;;TOOL1;GMTSPSTN
"RTN","GMTSPI94",124,0)
 ;1.1;;0
"RTN","GMTSPI94",125,0)
 ;2;;
"RTN","GMTSPI94",126,0)
 ;3;;MRR1
"RTN","GMTSPI94",127,0)
 ;3.5;;5
"RTN","GMTSPI94",128,0)
 ;3.5;1;This component generates a list of the patient's complete medication
"RTN","GMTSPI94",129,0)
 ;3.5;2;profile, including Outpatient Rx's, Inpatient Medication Orders, Clinic
"RTN","GMTSPI94",130,0)
 ;3.5;3;Orders, Non-VA Medications, and Remote Active Medications.  It is sorted
"RTN","GMTSPI94",131,0)
 ;3.5;4;alphabetically by drug name, creating groups of outpatient/inpatient
"RTN","GMTSPI94",132,0)
 ;3.5;5;orders for the same item in order to facilitate medication reconciliation.
"RTN","GMTSPI94",133,0)
 ;4;;
"RTN","GMTSPI94",134,0)
 ;5;;
"RTN","GMTSPI94",135,0)
 ;6;;
"RTN","GMTSPI94",136,0)
 ;7;;0
"RTN","GMTSPI94",137,0)
 ;8;;
"RTN","GMTSPI94",138,0)
 ;9;;Med Reconciliation
"RTN","GMTSPI94",139,0)
 ;10;;
"RTN","GMTSPI94",140,0)
 ;11;;
"RTN","GMTSPI94",141,0)
 ;12;;
"RTN","GMTSPI94",142,0)
 ;13;;
"RTN","GMTSPI94",143,0)
 ;14;;
"RTN","GMTSPI94",144,0)
 ;PDX;;1
"RTN","GMTSPI94",145,0)
 ;
"RTN","GMTSPI94",146,0)
 Q
"RTN","GMTSPI94",147,0)
 ;
"RTN","GMTSPSCK")
0^7^B5589868
"RTN","GMTSPSCK",1,0)
GMTSPSCK ;PBM/RMS - MED RECONCILIATION CONFIGURATION CHECKER ;Jun 07, 2018@21:40
"RTN","GMTSPSCK",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPSCK",3,0)
 ;
"RTN","GMTSPSCK",4,0)
EN1 ; Main entry point
"RTN","GMTSPSCK",5,0)
 N ASK,IDX,IDX1,IDX2,ORDER,REC,NAME,COMP,HAVET,HAVE1,HAVE2,HAVE3,FAILS
"RTN","GMTSPSCK",6,0)
 S HAVE1=0,HAVE2=0,HAVE3=0,HAVET=0
"RTN","GMTSPSCK",7,0)
 S FAILS=""
"RTN","GMTSPSCK",8,0)
 W !,"Checking for TYPE 'Essential Med List for Review' ..."
"RTN","GMTSPSCK",9,0)
 S IDX="" F  S IDX=$O(^GMT(142,IDX)) Q:IDX=""  D
"RTN","GMTSPSCK",10,0)
 . S NAME=$P($G(^GMT(142,IDX,0)),U,1)
"RTN","GMTSPSCK",11,0)
 . I NAME="Essential Med List for Review"  D
"RTN","GMTSPSCK",12,0)
 .. S HAVET=1
"RTN","GMTSPSCK",13,0)
 .. W " OK",!
"RTN","GMTSPSCK",14,0)
 .. S IDX1=0 F  S IDX1=$O(^GMT(142,IDX,1,IDX1)) Q:IDX1=""  D
"RTN","GMTSPSCK",15,0)
 ... S REC=$G(^GMT(142,IDX,1,IDX1,0))
"RTN","GMTSPSCK",16,0)
 ... I REC'=""  D
"RTN","GMTSPSCK",17,0)
 .... S ORDER=$P(REC,U,1)
"RTN","GMTSPSCK",18,0)
 .... S IDX2=$P(REC,U,2)
"RTN","GMTSPSCK",19,0)
 .... S COMP=$$GETCOMP(IDX2)
"RTN","GMTSPSCK",20,0)
 .... I COMP'=""  D
"RTN","GMTSPSCK",21,0)
 ..... I $P(COMP,U,1)="Allergies/ADRs (Tool #5)" S HAVE1=1
"RTN","GMTSPSCK",22,0)
 ..... I $P(COMP,U,1)="Med. Reconciliation (Tool #1)" S HAVE2=1
"RTN","GMTSPSCK",23,0)
 ..... I $P(COMP,U,1)="Med Recon NoGlossary (Tool #1)" S HAVE3=1
"RTN","GMTSPSCK",24,0)
 .... E  D
"RTN","GMTSPSCK",25,0)
 ..... W " FAIL (Component not found)",!
"RTN","GMTSPSCK",26,0)
 . I HAVET Q
"RTN","GMTSPSCK",27,0)
 I 'HAVET  D
"RTN","GMTSPSCK",28,0)
 . W " FAIL (Missing)",!
"RTN","GMTSPSCK",29,0)
 E  D
"RTN","GMTSPSCK",30,0)
 . W "Checking for COMPONENT 'Allergies/ADRs (Tool #5)' configured in TYPE ..."
"RTN","GMTSPSCK",31,0)
 . I HAVE1 W " OK",!
"RTN","GMTSPSCK",32,0)
 . E  W !?5," FAIL (Missing)",!
"RTN","GMTSPSCK",33,0)
 . W "Checking Tool #1 COMPONENTs to Verify One (and Only One) is Present ...",!
"RTN","GMTSPSCK",34,0)
 . W "Checking for COMPONENT 'Med. Reconciliation (Tool #1)' configured in TYPE ...",!
"RTN","GMTSPSCK",35,0)
 . W "Checking for COMPONENT 'Med Recon NoGlossary (Tool #1)' configured in TYPE ..."
"RTN","GMTSPSCK",36,0)
 . I HAVE2,'HAVE3 W " OK",!
"RTN","GMTSPSCK",37,0)
 . I 'HAVE2,HAVE3 W " OK",!
"RTN","GMTSPSCK",38,0)
 . I HAVE2,HAVE3 W !?5," FAIL (Can't have both MRT1 & MRR1 Tool #1 COMPONENTs)"
"RTN","GMTSPSCK",39,0)
 . I 'HAVE2,'HAVE3 W !?5," FAIL (Missing One)",!
"RTN","GMTSPSCK",40,0)
 W !!,"Press <Return> to Continue..."  R ASK:300
"RTN","GMTSPSCK",41,0)
 Q
"RTN","GMTSPSCK",42,0)
 ;-------------------------------------------------------------
"RTN","GMTSPSCK",43,0)
 ; GETCOMP - Retrieves a single Health Summary Component by IEN
"RTN","GMTSPSCK",44,0)
 ; Parameters: IEN - IEN of HS component
"RTN","GMTSPSCK",45,0)
 ; Returns: REC - parts 1,2,4 from HS component record
"RTN","GMTSPSCK",46,0)
GETCOMP(IEN) ;
"RTN","GMTSPSCK",47,0)
 N REC
"RTN","GMTSPSCK",48,0)
 S REC=$G(^GMT(142.1,IEN,0))
"RTN","GMTSPSCK",49,0)
 I REC'=""  D
"RTN","GMTSPSCK",50,0)
 . S REC=$P(REC,U,1)_U_$P(REC,U,2)_U_$P(REC,U,4)
"RTN","GMTSPSCK",51,0)
 Q REC
"RTN","GMTSPST1")
0^2^B167015680
"RTN","GMTSPST1",1,0)
GMTSPST1 ;BIR/RMS - MED RECON TOOL #1 (MED REC PROFILE) ;May 14, 2018@20:50
"RTN","GMTSPST1",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPST1",3,0)
 ;Reference to COVER^ORWPS supported by IA 4926
"RTN","GMTSPST1",4,0)
 ;References to ^ORRDI1 supported by IA 4659
"RTN","GMTSPST1",5,0)
 ;Reference to ^XTMP("ORRDI","PSOO" supported by IA 4660
"RTN","GMTSPST1",6,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by IA 5440
"RTN","GMTSPST1",7,0)
 ;Reference to ^PSOHCSUM supported by IA 330
"RTN","GMTSPST1",8,0)
 ;Reference to $$ISCLIN^ORUTL1 supported by IA 5691
"RTN","GMTSPST1",9,0)
 ;Reference to ^PS(51 supported by IA 1980
"RTN","GMTSPST1",10,0)
 ;Reference to file 53.1 supported by IA 534
"RTN","GMTSPST1",11,0)
 ;Reference to TEXT^ORQ12 supported by IA 4202
"RTN","GMTSPST1",12,0)
 ;Reference to $$PKGID^ORX8 supported by IA 3071
"RTN","GMTSPST1",13,0)
 ;Reference to BCMALG^PSJUTL2 supported by IA 5057
"RTN","GMTSPST1",14,0)
TOOL1 ;ENTRY POINT FOR HEALTH SUMMARY
"RTN","GMTSPST1",15,0)
 N ALPHA,DRUGNM,EXPDAYS,IND1,LIST,ORDER,PSNUM,RPC,RPCT,RPCNODE,SAVE,SAVERD
"RTN","GMTSPST1",16,0)
 D ADD^GMTSPSTR("GMTSPST1")
"RTN","GMTSPST1",17,0)
 S IND1=7,EXPDAYS=90
"RTN","GMTSPST1",18,0)
 D COVER^ORWPS(.RPC,DFN)
"RTN","GMTSPST1",19,0)
 S RPCT=0 F  S RPCT=$O(RPC(RPCT)) Q:'+RPCT  D
"RTN","GMTSPST1",20,0)
 . S RPCNODE=RPC(RPCT)
"RTN","GMTSPST1",21,0)
 . S PSNUM=$P(RPCNODE,U)
"RTN","GMTSPST1",22,0)
 . S DRUGNM=$$UP^XLFSTR($P(RPCNODE,U,2))
"RTN","GMTSPST1",23,0)
 . S ORDER=+$P(RPCNODE,U,3)
"RTN","GMTSPST1",24,0)
 . Q:DRUGNM']""!(ORDER=0)!(PSNUM']"")
"RTN","GMTSPST1",25,0)
 . S SAVERD=9999999-$$LRD(+$G(^OR(100,ORDER,4)))
"RTN","GMTSPST1",26,0)
 . S SAVE(DRUGNM,SAVERD,ORDER,PSNUM)=""
"RTN","GMTSPST1",27,0)
 . Q:("ACTIVE^ACTIVE/SUSP^ACTIVE/PARKED^HOLD^PENDING^ON CALL"'[$P(RPCNODE,U,4))&($P(PSNUM,";")["N")
"RTN","GMTSPST1",28,0)
 . S ALPHA(1,DRUGNM,ORDER,PSNUM)=$P(RPCNODE,U,4)
"RTN","GMTSPST1",29,0)
 D ADDREM
"RTN","GMTSPST1",30,0)
 D HEADER
"RTN","GMTSPST1",31,0)
 S LIST=1 D OUTPUT
"RTN","GMTSPST1",32,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",33,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",34,0)
 D CKP Q:$D(GMTSQIT)  W !,$$CJ^XLFSTR("SUPPLIES",IOM-8)
"RTN","GMTSPST1",35,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",36,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",37,0)
 S LIST=2 D OUTPUT
"RTN","GMTSPST1",38,0)
 D FOOTER
"RTN","GMTSPST1",39,0)
 Q
"RTN","GMTSPST1",40,0)
 ;
"RTN","GMTSPST1",41,0)
ADDREM ;USES RDI - REMOTE DATA INTEROPERABILITY TO INCORPORATE OUTSIDE MEDS
"RTN","GMTSPST1",42,0)
 N DOWN,MED,RDI,RNAM,RNUM,STAT,ISSUE
"RTN","GMTSPST1",43,0)
 Q:'$$HAVEHDR^ORRDI1
"RTN","GMTSPST1",44,0)
 D  Q:$G(DOWN)  ;Check for outage of RDI
"RTN","GMTSPST1",45,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPST1",46,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S DOWN=1 D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",47,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",48,0)
 .. W !,"WARNING: Connection to Remote Data Currently Down",!
"RTN","GMTSPST1",49,0)
 .. D CKP
"RTN","GMTSPST1",50,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",51,0)
 ;Get data for HFS file structure
"RTN","GMTSPST1",52,0)
 D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",53,0)
 S RDI=$$GET^ORRDI1(DFN,"PSOO")
"RTN","GMTSPST1",54,0)
 D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",55,0)
 D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",56,0)
 ;
"RTN","GMTSPST1",57,0)
 H 1 ;One extra second to allow ^XTMP replication across nodes
"RTN","GMTSPST1",58,0)
 I +RDI=-1 D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",59,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",60,0)
 . W !,"WARNING: Connection to Remote Data Not Available",!
"RTN","GMTSPST1",61,0)
 . D CKP
"RTN","GMTSPST1",62,0)
 Q:'$D(^XTMP("ORRDI","PSOO",DFN))
"RTN","GMTSPST1",63,0)
 S MED=0 F  S MED=$O(^XTMP("ORRDI","PSOO",DFN,MED)) Q:'+MED  D
"RTN","GMTSPST1",64,0)
 . S STAT=$G(^XTMP("ORRDI","PSOO",DFN,MED,5,0))
"RTN","GMTSPST1",65,0)
 . Q:STAT']""
"RTN","GMTSPST1",66,0)
 . Q:"ACTIVE^SUSPENDED^HOLD"'[STAT
"RTN","GMTSPST1",67,0)
 . Q:$G(^XTMP("ORRDI","PSOO",DFN,MED,7,0))']""  ;DoD:quit if there is no exp. date
"RTN","GMTSPST1",68,0)
 . D  Q:ISSUE<$$FMADD^XLFDT(DT,-366)  ;DoD: quit if ISSUE DATE > 1Y ago
"RTN","GMTSPST1",69,0)
 .. N %DT,X,Y
"RTN","GMTSPST1",70,0)
 .. S X=$G(^XTMP("ORRDI","PSOO",DFN,MED,8,0))
"RTN","GMTSPST1",71,0)
 .. D ^%DT
"RTN","GMTSPST1",72,0)
 .. S ISSUE=+Y
"RTN","GMTSPST1",73,0)
 . S RNAM=$G(^XTMP("ORRDI","PSOO",DFN,MED,2,0),"Unknown Drug")
"RTN","GMTSPST1",74,0)
 . S RNUM=$G(^XTMP("ORRDI","PSOO",DFN,MED,4,0))
"RTN","GMTSPST1",75,0)
 . Q:RNAM']""!(RNUM']"")
"RTN","GMTSPST1",76,0)
 . S ALPHA(1,RNAM,RNUM,MED_"X;R")=""
"RTN","GMTSPST1",77,0)
 Q
"RTN","GMTSPST1",78,0)
HEADER ;
"RTN","GMTSPST1",79,0)
 N NVADT,REPEAT
"RTN","GMTSPST1",80,0)
 S NVADT=$$NVADT
"RTN","GMTSPST1",81,0)
 D TEXTPRNT("HEADTXT1")
"RTN","GMTSPST1",82,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",83,0)
 W !,"Non-VA Meds Last Documented On: "
"RTN","GMTSPST1",84,0)
 W $S(+NVADT:$$FMTE^XLFDT(NVADT,"D"),1:"** Data not found **")
"RTN","GMTSPST1",85,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",86,0)
 W !,$$REPEAT^XLFSTR("*",IOM-8)
"RTN","GMTSPST1",87,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",88,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",89,0)
 D TEXTPRNT("HEADTXT2")
"RTN","GMTSPST1",90,0)
 F REPEAT=1,2 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",91,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",92,0)
 W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",93,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",94,0)
 Q
"RTN","GMTSPST1",95,0)
TEXTPRNT(TEXTLOC) ;PRINT LINES OF TEXT FROM A LINE LABEL, ENDS WITH $$END
"RTN","GMTSPST1",96,0)
 N LINE,TLINE,LINETEXT
"RTN","GMTSPST1",97,0)
 S LINE=0 F  S LINE=LINE+1,TLINE=TEXTLOC_"+"_LINE S:TEXTLOC="FOOTER1" TLINE=TLINE_"^GMTSGLOS" S LINETEXT=$T(@TLINE) S LINETEXT=$E(LINETEXT,4,$L(LINETEXT)) Q:LINETEXT="$$END"  D
"RTN","GMTSPST1",98,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",99,0)
 . W !,LINETEXT
"RTN","GMTSPST1",100,0)
 Q
"RTN","GMTSPST1",101,0)
OUTPUT N DRUGNM,ORDER,PSNUM
"RTN","GMTSPST1",102,0)
 N PACK,PACKREF,SIGLINE,ORDNUM
"RTN","GMTSPST1",103,0)
 N LASTACT,OTLINE
"RTN","GMTSPST1",104,0)
 S DRUGNM="" F  S DRUGNM=$O(ALPHA(LIST,DRUGNM)) Q:DRUGNM']""  D  K SAVE(DRUGNM) Q:$D(GMTSQIT)
"RTN","GMTSPST1",105,0)
 . S ORDER="" F  S ORDER=$O(ALPHA(LIST,DRUGNM,ORDER)) Q:ORDER']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",106,0)
 .. S PSNUM="" F  S PSNUM=$O(ALPHA(LIST,DRUGNM,ORDER,PSNUM)) Q:PSNUM']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",107,0)
 ... S PACK=$P(PSNUM,";",2),ORDNUM=$P(PSNUM,";")
"RTN","GMTSPST1",108,0)
 ... I $$ISSUPPLY(,DRUGNM) S ALPHA(2,DRUGNM,ORDER,PSNUM)=ALPHA(LIST,DRUGNM,ORDER,PSNUM) Q
"RTN","GMTSPST1",109,0)
 ... I PACK="I" D INPDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",110,0)
 ... I PACK="O" D OPTDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",111,0)
 ... I PACK="R" D RDIDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",112,0)
 Q
"RTN","GMTSPST1",113,0)
INPDISP ;Display an Inpatient or Clinic Meds Entry
"RTN","GMTSPST1",114,0)
 N GMTSPST1,OALINE,ORIG,ORVP,PSIFN,WLINE,DIWL,DIWR,DIWF,TYPE,X,LASTBCMA,STATUS
"RTN","GMTSPST1",115,0)
 N DDNUM,DRUGDISP,ORY
"RTN","GMTSPST1",116,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",117,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",118,0)
 S STATUS=$G(ALPHA(LIST,DRUGNM,ORDER,PSNUM))
"RTN","GMTSPST1",119,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["HOLD":"On Hold",STATUS["PENDING":"Pending",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPST1",120,0)
 ;W !,$S($$ISCLIN^ORUTL1(ORDER):"CLIN ",1:"INPT ")_DRUGNM_" (Status="_STATUS_")"
"RTN","GMTSPST1",121,0)
 D DRUGDSP^GMTSPSTN
"RTN","GMTSPST1",122,0)
 D IMOOD^ORIMO(.ORY,ORDER)
"RTN","GMTSPST1",123,0)
 W !,$S(ORY:"CLIN ",1:"INPT ")_DRUGDISP_" (Status="_STATUS_")"
"RTN","GMTSPST1",124,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",125,0)
 D DRGDSP2^GMTSPSTN
"RTN","GMTSPST1",126,0)
 D TEXT^ORQ12(.GMTSPST1,ORDER,80)
"RTN","GMTSPST1",127,0)
 S DIWL=IND1,DIWR=60,ORIG=$S(PSNUM["U":2,$$GET1^DIQ(53.1,+PSNUM,4,"I")="U":2,1:1)
"RTN","GMTSPST1",128,0)
 D:$E(GMTSPST1(1),1,7)="Change "
"RTN","GMTSPST1",129,0)
 . F OALINE=2:1:$O(GMTSPST1(":"),-1) I $E(GMTSPST1(OALINE),1,3)="to " S ORIG=OALINE,$E(GMTSPST1(OALINE),1,3)="" Q
"RTN","GMTSPST1",130,0)
 F OALINE=ORIG:1:$O(GMTSPST1(":"),-1) D
"RTN","GMTSPST1",131,0)
 . S X=$$LSIG($G(GMTSPST1(OALINE)))
"RTN","GMTSPST1",132,0)
 .; S X=$G(GMTSPST1(OALINE))
"RTN","GMTSPST1",133,0)
 . D ^DIWP
"RTN","GMTSPST1",134,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",135,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",136,0)
 . D CKP
"RTN","GMTSPST1",137,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",138,0)
 S LASTBCMA=$$BCMALG^PSJUTL2(DFN,ORDNUM)
"RTN","GMTSPST1",139,0)
 I LASTBCMA'="" W !?IND1,$$BCMALG^PSJUTL2(DFN,ORDNUM) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",140,0)
 Q
"RTN","GMTSPST1",141,0)
 ;
"RTN","GMTSPST1",142,0)
OPTDISP ;Display an Outpatient Prescription Entry
"RTN","GMTSPST1",143,0)
 N EXPDT,REFILLS,STATUS,DIWL,DIWR,PENDMED,GMTSPSTP,ORQLN,CANCELDT
"RTN","GMTSPST1",144,0)
 N ORDTYP,ORIGRX,QDFLAG
"RTN","GMTSPST1",145,0)
 K ^TMP($J,"GMTSPST1"),^UTILITY($J,"W")
"RTN","GMTSPST1",146,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPST1",147,0)
 I PACKREF["S" D  Q
"RTN","GMTSPST1",148,0)
 . D PEN^PSO5241(DFN,"GMTSPST1",+PACKREF,ORDER)
"RTN","GMTSPST1",149,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",150,0)
 . W !,"OUTPT "_DRUGNM_" (Status = Pending)"
"RTN","GMTSPST1",151,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",152,0)
 . D TEXT^ORQ12(.GMTSPSTP,ORDER,60)
"RTN","GMTSPST1",153,0)
 . S ORQLN=1 F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN!($E(GMTSPSTP(ORQLN),1,10)="Quantity: ")  D
"RTN","GMTSPST1",154,0)
 .. W !?IND1,GMTSPSTP(ORQLN)
"RTN","GMTSPST1",155,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",156,0)
 . S ORIGRX=$P($G(^TMP($J,"GMTSPST1",DFN,+PACKREF,22.1)),U,2)
"RTN","GMTSPST1",157,0)
 . S ORDTYP=$P($G(^TMP($J,"GMTSPST1",DFN,+PACKREF,2)),U,1)
"RTN","GMTSPST1",158,0)
 . S QDFLAG=0 I ORIGRX]"",ORDTYP="RNW" D
"RTN","GMTSPST1",159,0)
 .. W !?10,"Renewed from Rx# "_ORIGRX
"RTN","GMTSPST1",160,0)
 .. D CKP Q:$D(QMTSQIT)
"RTN","GMTSPST1",161,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,101))
"RTN","GMTSPST1",162,0)
 .. S QDFLAG=1 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",163,0)
 . W !?10,"Login Date: "_$$FMTE^XLFDT(+$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,15)),"2D")
"RTN","GMTSPST1",164,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",165,0)
 . I 'QDFLAG D
"RTN","GMTSPST1",166,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,101))
"RTN","GMTSPST1",167,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",168,0)
 . W:'QDFLAG ! W ?50,"Refills Ordered: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,13))
"RTN","GMTSPST1",169,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",170,0)
 D RX^PSO52API(DFN,"GMTSPST1",PACKREF)
"RTN","GMTSPST1",171,0)
 S EXPDT=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,26))
"RTN","GMTSPST1",172,0)
 S CANCELDT=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,26.1))
"RTN","GMTSPST1",173,0)
 S REFILLS=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,9))-$S($G(^TMP($J,"GMTSPST1",DFN,PACKREF,"RF",0))>0:$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"RF",0)),1:0)  ;need to make sure this is as accurate as the previous method in PSOQ0076
"RTN","GMTSPST1",174,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPST1",175,0)
 I $P(PSNUM,";")["N" G NVADISP
"RTN","GMTSPST1",176,0)
 I EXPDT Q:$$FMDIFF^XLFDT(DT,$P(EXPDT,U))>EXPDAYS
"RTN","GMTSPST1",177,0)
 I CANCELDT Q:$$FMDIFF^XLFDT(DT,$P(CANCELDT,U))>EXPDAYS
"RTN","GMTSPST1",178,0)
 S STATUS=$P($G(^TMP($J,"GMTSPST1",DFN,PACKREF,100)),U,2)
"RTN","GMTSPST1",179,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"On Hold",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPST1",180,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",181,0)
 W !,"OUTPT "_DRUGNM_" (Status = "_STATUS_")"
"RTN","GMTSPST1",182,0)
 S DIWL=IND1,DIWR=72
"RTN","GMTSPST1",183,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",184,0)
 . S X=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPST1",185,0)
 . D ^DIWP
"RTN","GMTSPST1",186,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE!($D(GMTSQIT))  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",187,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",188,0)
 . D CKP
"RTN","GMTSPST1",189,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",190,0)
 W !?10,"Rx# "_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,.01))_" Last Released: "_$$FMTE^XLFDT(LASTREL,"2D"),?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,7))_"/"_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,8)) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",191,0)
 W !?10,"Rx Expiration Date: ",$$FMTE^XLFDT(EXPDT,"2D"),?50,"Refills Remaining: ",REFILLS D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",192,0)
 W ! D CKP
"RTN","GMTSPST1",193,0)
 Q
"RTN","GMTSPST1",194,0)
 ;
"RTN","GMTSPST1",195,0)
ISSUPPLY(DRUG,DRUGNAME) ;
"RTN","GMTSPST1",196,0)
 ; Function returns '1' if drug is a SUPPLY, '0' otherwise
"RTN","GMTSPST1",197,0)
 Q:LIST=2 0 ;Only check during regular med list, not in supply list
"RTN","GMTSPST1",198,0)
 N VACLASS,DEAHDLG
"RTN","GMTSPST1",199,0)
 K ^TMP($J,"GMTSPST1D")
"RTN","GMTSPST1",200,0)
 I +$G(DRUG) D DATA^PSS50(DRUG,,,,,"GMTSPST1D")
"RTN","GMTSPST1",201,0)
 E  D DATA^PSS50(,DRUGNAME,,,,"GMTSPST1D") S DRUG=$O(^TMP($J,"GMTSPST1D",0))
"RTN","GMTSPST1",202,0)
 I 'DRUG Q 0
"RTN","GMTSPST1",203,0)
 S VACLASS=$G(^TMP($J,"GMTSPST1D",DRUG,2))
"RTN","GMTSPST1",204,0)
 S DEAHDLG=$G(^TMP($J,"GMTSPST1D",DRUG,3))
"RTN","GMTSPST1",205,0)
 Q:$E(VACLASS,1,2)="XA" 1
"RTN","GMTSPST1",206,0)
 Q:$E(VACLASS,1,2)="XX" 1
"RTN","GMTSPST1",207,0)
 Q:(VACLASS="DX900")&(DEAHDLG["S") 1
"RTN","GMTSPST1",208,0)
 Q 0
"RTN","GMTSPST1",209,0)
 ;
"RTN","GMTSPST1",210,0)
RDIDISP ;Display a Remote Meds Entry
"RTN","GMTSPST1",211,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",212,0)
 W !,"Remote ",?IND1,DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",213,0)
 N STATUS,DIWL,DIWR,DIWF,X,WLINE
"RTN","GMTSPST1",214,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",215,0)
 S X=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,14,0)),DIWL=IND1,DIWR=60
"RTN","GMTSPST1",216,0)
 D ^DIWP
"RTN","GMTSPST1",217,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",218,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",219,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",220,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",221,0)
 S STATUS=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,5,0))
"RTN","GMTSPST1",222,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"Hold",1:"Unknown")
"RTN","GMTSPST1",223,0)
 W !?10,"Last Filled: "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,9,0))_" ("_STATUS_" at "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,1,0))_") "
"RTN","GMTSPST1",224,0)
 W !?10,"Rx Expiration Date: ",$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,7,0)),?55,"Days Supply: "_$P($P($G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,6,0)),";",2),"D",2)
"RTN","GMTSPST1",225,0)
 Q
"RTN","GMTSPST1",226,0)
 ;
"RTN","GMTSPST1",227,0)
NVADISP ;Display a Non-VA Medication Entry
"RTN","GMTSPST1",228,0)
 N GMTSPST1,OALINE,ORIG,WLINE,DIWL,DIWR,DIWF,X
"RTN","GMTSPST1",229,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",230,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",231,0)
 W !,"Non-VA "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",232,0)
 D TEXT^ORQ12(.GMTSPST1,ORDER,80)
"RTN","GMTSPST1",233,0)
 S DIWL=IND1,DIWR=60,ORIG=2
"RTN","GMTSPST1",234,0)
 D:$E(GMTSPST1(1),1,7)="Change "
"RTN","GMTSPST1",235,0)
 . F OALINE=2:1:$O(GMTSPST1(":"),-1) I $E(GMTSPST1(OALINE),1,3)="to " S ORIG=OALINE+1 Q
"RTN","GMTSPST1",236,0)
 F OALINE=ORIG:1:$O(GMTSPST1(":"),-1) D
"RTN","GMTSPST1",237,0)
 . S X=$$LSIG($G(GMTSPST1(OALINE)))
"RTN","GMTSPST1",238,0)
 . D ^DIWP
"RTN","GMTSPST1",239,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",240,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",241,0)
 . D CKP
"RTN","GMTSPST1",242,0)
 W ! D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",243,0)
 Q
"RTN","GMTSPST1",244,0)
FOOTER ;Report footer for older medication entries
"RTN","GMTSPST1",245,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",246,0)
 D TEXTPRNT("FOOTER1")
"RTN","GMTSPST1",247,0)
 Q
"RTN","GMTSPST1",248,0)
OPTFOOT ;Actual display for outpatient footer
"RTN","GMTSPST1",249,0)
 N LASTREL,FOOTTXT,DAYSSUPP,STATUS
"RTN","GMTSPST1",250,0)
 K ^TMP($J,"GMTSPST1")
"RTN","GMTSPST1",251,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPST1",252,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPST1",253,0)
 Q:LASTREL<$$FMADD^XLFDT(DT,-365)
"RTN","GMTSPST1",254,0)
 Q:$P(PSNUM,";")["N"
"RTN","GMTSPST1",255,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",256,0)
 W !,"OPT "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",257,0)
 D RX^PSO52API(DFN,"GMTSPST1",PACKREF)
"RTN","GMTSPST1",258,0)
 S STATUS=$P($G(^TMP($J,"GMTSPST1",DFN,PACKREF,100)),U,2)
"RTN","GMTSPST1",259,0)
 S DAYSSUPP=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,8))
"RTN","GMTSPST1",260,0)
 S FOOTTXT="("_STATUS_"/"_DAYSSUPP_" Days Supply Last Released: "_$$FMTE^XLFDT(LASTREL,"2D")_")"
"RTN","GMTSPST1",261,0)
 W $$RJ^XLFSTR(FOOTTXT,74) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",262,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",263,0)
 . W !?IND1,$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPST1",264,0)
 . D CKP
"RTN","GMTSPST1",265,0)
 D CKP
"RTN","GMTSPST1",266,0)
 Q
"RTN","GMTSPST1",267,0)
NVADT() ;Replaces call previously in ^PSOQCF04
"RTN","GMTSPST1",268,0)
 N NVAL,NVARR
"RTN","GMTSPST1",269,0)
 D ^PSOHCSUM
"RTN","GMTSPST1",270,0)
 Q:'$D(^TMP("PSOO",$J,"NVA")) ""
"RTN","GMTSPST1",271,0)
 S NVAL=0 F  S NVAL=$O(^TMP("PSOO",$J,"NVA",NVAL)) Q:'+NVAL  D
"RTN","GMTSPST1",272,0)
 . S NVADT=9999999-$P($G(^TMP("PSOO",$J,"NVA",NVAL,0)),"^",5)
"RTN","GMTSPST1",273,0)
 . S NVARR(NVADT)=""
"RTN","GMTSPST1",274,0)
 S NVADT=$O(NVARR(0)) Q:NVADT=9999999 ""
"RTN","GMTSPST1",275,0)
 Q 9999999-NVADT
"RTN","GMTSPST1",276,0)
LSIG(SIG) ;Expand a SIG
"RTN","GMTSPST1",277,0)
 N P,SGY,X
"RTN","GMTSPST1",278,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","GMTSPST1",279,0)
 .I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","GMTSPST1",280,0)
 .S SGY=SGY_X_" "
"RTN","GMTSPST1",281,0)
 Q SGY
"RTN","GMTSPST1",282,0)
LRD(PACKREF) ;Calculate LAST RELEASE DATE as latest of original + refill relDates
"RTN","GMTSPST1",283,0)
 N RELDT,REFDT,CTR,ANS
"RTN","GMTSPST1",284,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPST1",285,0)
 S ANS=""
"RTN","GMTSPST1",286,0)
 D RX^PSO52API(DFN,"GMTSLRD",PACKREF,,"3,R")
"RTN","GMTSPST1",287,0)
 S RELDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,31))
"RTN","GMTSPST1",288,0)
 S ANS=RELDT
"RTN","GMTSPST1",289,0)
 S CTR=0 F  S CTR=$O(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR)) Q:'+CTR  D  ;
"RTN","GMTSPST1",290,0)
 . S REFDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR,17))
"RTN","GMTSPST1",291,0)
 . I REFDT>ANS S ANS=REFDT
"RTN","GMTSPST1",292,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPST1",293,0)
 Q ANS
"RTN","GMTSPST1",294,0)
 ;
"RTN","GMTSPST1",295,0)
CKP D CKP^GMTSUP Q
"RTN","GMTSPST1",296,0)
 ;
"RTN","GMTSPST1",297,0)
HEADTXT1 ;;
"RTN","GMTSPST1",298,0)
 ;;INCLUDED IN THIS LIST:  Alphabetical list of active outpatient
"RTN","GMTSPST1",299,0)
 ;;prescriptions dispensed from this VA (local) and dispensed from another
"RTN","GMTSPST1",300,0)
 ;;VA or DoD facility (remote) as well as inpatient orders (local pending and
"RTN","GMTSPST1",301,0)
 ;;active), local clinic medications, locally documented non-VA medications,
"RTN","GMTSPST1",302,0)
 ;;and local prescriptions that have expired or been discontinued in the past
"RTN","GMTSPST1",303,0)
 ;;90 days.
"RTN","GMTSPST1",304,0)
 ;;
"RTN","GMTSPST1",305,0)
 ;;$$END
"RTN","GMTSPST1",306,0)
HEADTXT2 ;;
"RTN","GMTSPST1",307,0)
 ;;***NOTE*** The display of VA prescriptions dispensed from another VA or
"RTN","GMTSPST1",308,0)
 ;;DoD facility (remote) is limited to active outpatient prescription entries
"RTN","GMTSPST1",309,0)
 ;;matched to National Drug File at the originating site and may not include
"RTN","GMTSPST1",310,0)
 ;;some items such as investigational drugs, compounds, etc.
"RTN","GMTSPST1",311,0)
 ;;
"RTN","GMTSPST1",312,0)
 ;;NOT INCLUDED IN THIS LIST: Medications self-entered by the patient into
"RTN","GMTSPST1",313,0)
 ;;personal health records (i.e. My HealtheVet) are NOT included in this
"RTN","GMTSPST1",314,0)
 ;;list. Non-VA medications documented outside this VA, remote inpatient
"RTN","GMTSPST1",315,0)
 ;;orders (regardless of status) and remote clinic medications are NOT
"RTN","GMTSPST1",316,0)
 ;;included in this list. The patient and provider must always discuss
"RTN","GMTSPST1",317,0)
 ;;medications the patient is taking, regardless of where the medication was
"RTN","GMTSPST1",318,0)
 ;;dispensed or obtained.
"RTN","GMTSPST1",319,0)
 ;;$$END
"RTN","GMTSPST4")
0^4^B17358718
"RTN","GMTSPST4",1,0)
GMTSPST4 ;BHAM/RMS - TIU OBJECT FOR REMOTE MEDS VIA RDI ;06/28/17  10:31
"RTN","GMTSPST4",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPST4",3,0)
 ;
"RTN","GMTSPST4",4,0)
 ;Reference to ORRDI1 supported by DBIA 4659
"RTN","GMTSPST4",5,0)
 ;Reference to ^XTMP("ORRDI","PSOO" supported by DBIA 4660
"RTN","GMTSPST4",6,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by DBIA 5440
"RTN","GMTSPST4",7,0)
 ;
"RTN","GMTSPST4",8,0)
RDI(DFN,TARGET) ;
"RTN","GMTSPST4",9,0)
 ;OBJECT METHOD IS: S X=$$RDI^GMTSPST4(DFN,"^TMP($J,""GMTSRDI"")")
"RTN","GMTSPST4",10,0)
 K @TARGET
"RTN","GMTSPST4",11,0)
 N GMTSHDR,GMTSRET,GMTSMED,GMTSLINE,GMTSQTY,GMTSSIG,GMTSSTAT,GMTSRDI,GMTSDOWN,GMTSISSU
"RTN","GMTSPST4",12,0)
 G:'$G(DFN) RDIOUT
"RTN","GMTSPST4",13,0)
 S GMTSHDR=$$HAVEHDR^ORRDI1 I '+$G(GMTSHDR) D  G RDIOUT
"RTN","GMTSPST4",14,0)
 . S @TARGET@(1,0)="Remote Data from HDR not available"
"RTN","GMTSPST4",15,0)
 D  G:$G(GMTSDOWN) RDIOUT
"RTN","GMTSPST4",16,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPST4",17,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S GMTSDOWN=1 D
"RTN","GMTSPST4",18,0)
 .. S @TARGET@(1,0)="WARNING: Connection to Remote Data Currently Down"
"RTN","GMTSPST4",19,0)
 D  ;RDI/HDR CALL ENCAPSULATION
"RTN","GMTSPST4",20,0)
 . D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST4",21,0)
 . S GMTSRET=$$GET^ORRDI1(DFN,"PSOO")
"RTN","GMTSPST4",22,0)
 . D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPST4",23,0)
 . D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST4",24,0)
 I +GMTSRET=-1 D  G RDIOUT
"RTN","GMTSPST4",25,0)
 . S @TARGET@(1,0)="Connection to Remote Data Not Available"
"RTN","GMTSPST4",26,0)
 I '$D(^XTMP("ORRDI","PSOO",DFN)) D  G RDIOUT
"RTN","GMTSPST4",27,0)
 . S @TARGET@(1,0)="No Remote Data available for this patient"
"RTN","GMTSPST4",28,0)
OBJ S GMTSLINE=5
"RTN","GMTSPST4",29,0)
 S GMTSMED=0 F  S GMTSMED=$O(^XTMP("ORRDI","PSOO",DFN,GMTSMED)) Q:'+GMTSMED  D
"RTN","GMTSPST4",30,0)
 . S GMTSSTAT=$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,5,0))
"RTN","GMTSPST4",31,0)
 . Q:"ACTIVE^SUSPENDED^HOLD"'[GMTSSTAT
"RTN","GMTSPST4",32,0)
 . Q:$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,7,0))']""  ;Special case #1 for DoD data, quit if there is no expiration date listed
"RTN","GMTSPST4",33,0)
 . D  Q:GMTSISSU<$$FMADD^XLFDT(DT,-366)  ;Special case #2 for DoD data; quit if the ISSUE DATE is more than a year ago.  (May still show beyond expiration for Controlled Substances)
"RTN","GMTSPST4",34,0)
 .. N %DT,X,Y
"RTN","GMTSPST4",35,0)
 .. S X=$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,8,0))
"RTN","GMTSPST4",36,0)
 .. D ^%DT
"RTN","GMTSPST4",37,0)
 .. S GMTSISSU=+Y
"RTN","GMTSPST4",38,0)
 . S @TARGET@(GMTSLINE,0)=$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,2,0)) D INC
"RTN","GMTSPST4",39,0)
 . S GMTSSIG=$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,14,0)) D  ;
"RTN","GMTSPST4",40,0)
 .. I $L(GMTSSIG)>60 D  D INC Q
"RTN","GMTSPST4",41,0)
 ... N WORDS,COUNT
"RTN","GMTSPST4",42,0)
 ... S WORDS=$L(GMTSSIG," ")
"RTN","GMTSPST4",43,0)
 ... S @TARGET@(GMTSLINE,0)="Sig: "
"RTN","GMTSPST4",44,0)
 ... F COUNT=1:1:WORDS D
"RTN","GMTSPST4",45,0)
 .... S @TARGET@(GMTSLINE,0)=$G(@TARGET@(GMTSLINE,0))_$P(GMTSSIG," ",COUNT)_" "
"RTN","GMTSPST4",46,0)
 .... I $L(@TARGET@(GMTSLINE,0))>60 D INC S @TARGET@(GMTSLINE,0)="     "
"RTN","GMTSPST4",47,0)
 .. S @TARGET@(GMTSLINE,0)="Sig: "_GMTSSIG D INC
"RTN","GMTSPST4",48,0)
 . S GMTSQTY=$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,6,0)) S @TARGET@(GMTSLINE,0)="Quantity: "_+$P(GMTSQTY,";")_"    Days Supply: "_$P($P(GMTSQTY,";",2),"D",2) D INC
"RTN","GMTSPST4",49,0)
 . S @TARGET@(GMTSLINE,0)="Rx Expiration Date: "_$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,7,0)) D INC
"RTN","GMTSPST4",50,0)
 . S @TARGET@(GMTSLINE,0)="Last filled "_$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,9,0))_" at "_$G(^XTMP("ORRDI","PSOO",DFN,GMTSMED,1,0))
"RTN","GMTSPST4",51,0)
 . S @TARGET@(GMTSLINE,0)=@TARGET@(GMTSLINE,0)_" ("_$S(GMTSSTAT["ACT":"Active",GMTSSTAT["SUSP":"Active/Suspended",GMTSSTAT["HOLD":"Hold",1:"Status Unknown")_")" D INC
"RTN","GMTSPST4",52,0)
 . S @TARGET@(GMTSLINE,0)=" " D INC
"RTN","GMTSPST4",53,0)
 I GMTSLINE=5 D  G RDIOUT
"RTN","GMTSPST4",54,0)
 . S @TARGET@(1,0)="No Active Remote Medications for this patient"
"RTN","GMTSPST4",55,0)
 S @TARGET@(1,0)="Active Medications from Remote Data"
"RTN","GMTSPST4",56,0)
 S @TARGET@(2,0)="NOTE: Remote meds display is limited to those items matched to"
"RTN","GMTSPST4",57,0)
 S @TARGET@(3,0)="National Drug File at the originating site."
"RTN","GMTSPST4",58,0)
 S @TARGET@(4,0)=" "
"RTN","GMTSPST4",59,0)
RDIOUT Q "~@"_$NA(@TARGET)
"RTN","GMTSPST4",60,0)
INC S GMTSLINE=$G(GMTSLINE)+1
"RTN","GMTSPST4",61,0)
    Q
"RTN","GMTSPST4",62,0)
 ;-----------------------------
"RTN","GMTSPST4",63,0)
ENHS ;ENTRY POINT OF REMOTE DATA MEDICATIONS AS A HEALTH SUMMARY
"RTN","GMTSPST4",64,0)
 N GMTSHS,GMTSWRT
"RTN","GMTSPST4",65,0)
 Q:'$G(DFN)
"RTN","GMTSPST4",66,0)
 S GMTSHS=$$RDI(DFN,"^TMP($J,""GMTSRDI"")")
"RTN","GMTSPST4",67,0)
 S GMTSWRT=0 F  S GMTSWRT=$O(^TMP($J,"GMTSRDI",GMTSWRT)) Q:'+GMTSWRT  D
"RTN","GMTSPST4",68,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST4",69,0)
 . W !,^TMP($J,"GMTSRDI",GMTSWRT,0)
"RTN","GMTSPST4",70,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST4",71,0)
 Q
"RTN","GMTSPST5")
0^5^B13367450
"RTN","GMTSPST5",1,0)
GMTSPST5 ;HINES/RMS - TIU OBJECT FOR REMOTE ALLERGIES VIA RDI ;Aug 21, 2018@14:28
"RTN","GMTSPST5",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPST5",3,0)
 ;
"RTN","GMTSPST5",4,0)
 ;Reference to ORRDI1 supported by DBIA 4659
"RTN","GMTSPST5",5,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by DBIA 5440
"RTN","GMTSPST5",6,0)
 ;
"RTN","GMTSPST5",7,0)
ENHS ;ENTRY POINT FOR HEALTH SUMMARY OF REMOTE AND LOCAL ALLERGY/ADR DATA
"RTN","GMTSPST5",8,0)
 N GMTSHDR,GMTSRET,GMTSALG,GMTSALGR,GMTSFAC,GMTSREAC,GMTSRDI,GMTSDOWN,GMTSSTAT,GMTSSMSG
"RTN","GMTSPST5",9,0)
 Q:'$G(DFN)
"RTN","GMTSPST5",10,0)
 S GMTSSMSG=""
"RTN","GMTSPST5",11,0)
 ;Track usage of this routine
"RTN","GMTSPST5",12,0)
 D ADD^GMTSPSTR("GMTSPST5")
"RTN","GMTSPST5",13,0)
 ;
"RTN","GMTSPST5",14,0)
 ;Get Remote Allergy/ADR Data
"RTN","GMTSPST5",15,0)
 D RMTALG
"RTN","GMTSPST5",16,0)
 I GMTSSTAT=1 D
"RTN","GMTSPST5",17,0)
 .F GMTSALG=1:1:GMTSRET D
"RTN","GMTSPST5",18,0)
 .. S GMTSFAC=$G(^XTMP("ORRDI","ART",DFN,GMTSALG,"FACILITY",0))
"RTN","GMTSPST5",19,0)
 .. S GMTSREAC=$G(^XTMP("ORRDI","ART",DFN,GMTSALG,"GMRALLERGY",0))
"RTN","GMTSPST5",20,0)
 .. Q:$$YESCHK
"RTN","GMTSPST5",21,0)
 .. Q:GMTSFAC']""!(GMTSREAC']"")
"RTN","GMTSPST5",22,0)
 .. S GMTSFAC=$P(GMTSFAC,"^",2)
"RTN","GMTSPST5",23,0)
 .. S GMTSREAC=$P(GMTSREAC,U,2)
"RTN","GMTSPST5",24,0)
 .. S GMTSALGR(GMTSFAC,GMTSREAC)=""
"RTN","GMTSPST5",25,0)
 .S GMTSRET=$O(^XTMP("ORRDI","ART",DFN,"ASSESSMENT",""),-1)
"RTN","GMTSPST5",26,0)
 .F GMTSALG=1:1:+GMTSRET D
"RTN","GMTSPST5",27,0)
 .. S GMTSFAC=$G(^XTMP("ORRDI","ART",DFN,"ASSESSMENT",GMTSALG,"FACILITY",0))
"RTN","GMTSPST5",28,0)
 .. S GMTSREAC=$G(^XTMP("ORRDI","ART",DFN,"ASSESSMENT",GMTSALG))
"RTN","GMTSPST5",29,0)
 .. Q:$$YESCHK
"RTN","GMTSPST5",30,0)
 .. Q:GMTSFAC']""!(GMTSREAC']"")
"RTN","GMTSPST5",31,0)
 .. S GMTSFAC=$P(GMTSFAC,"^",2)
"RTN","GMTSPST5",32,0)
 .. S GMTSREAC=$P(GMTSREAC,U,2)
"RTN","GMTSPST5",33,0)
 .. S GMTSALGR(GMTSFAC,GMTSREAC)=""
"RTN","GMTSPST5",34,0)
 ;
"RTN","GMTSPST5",35,0)
 ;Get Local Allergy/ADR Data
"RTN","GMTSPST5",36,0)
 N LOCFAC S LOCFAC=$P($$SITE^VASITE,"^",2)
"RTN","GMTSPST5",37,0)
 N GMI,GMRAL D EN1^GMRADPT
"RTN","GMTSPST5",38,0)
 ; HERE, 1=Allergy List, 0=NKA, NULL=No Assessment
"RTN","GMTSPST5",39,0)
 I GMRAL=1 D
"RTN","GMTSPST5",40,0)
 . S GMI=0 F  S GMI=$O(GMRAL(GMI)) Q:GMI'>0  S GMTSALGR(LOCFAC,$P(GMRAL(GMI),U,2))=""
"RTN","GMTSPST5",41,0)
 I GMRAL=0 D
"RTN","GMTSPST5",42,0)
 . S GMTSALGR(LOCFAC,"No Known Allergies")=""
"RTN","GMTSPST5",43,0)
 I GMRAL="" D
"RTN","GMTSPST5",44,0)
 . S GMTSALGR(LOCFAC,"No Allergy Assessment Completed")=""
"RTN","GMTSPST5",45,0)
 ;
"RTN","GMTSPST5",46,0)
 ;Display HS Component
"RTN","GMTSPST5",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",48,0)
 W !,"FACILITY",?40,"ALLERGY/ADR",!,"--------",?40,"-----------"
"RTN","GMTSPST5",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",50,0)
 I GMTSSTAT=0 D  ;Q   ;Took out QUIT here so local allergy info can display
"RTN","GMTSPST5",51,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",52,0)
 .W !,GMTSSMSG
"RTN","GMTSPST5",53,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",54,0)
 S GMTSFAC="" F  S GMTSFAC=$O(GMTSALGR(GMTSFAC)) Q:GMTSFAC']""  D  ;
"RTN","GMTSPST5",55,0)
 . S GMTSREAC="" F  S GMTSREAC=$O(GMTSALGR(GMTSFAC,GMTSREAC)) Q:GMTSREAC']""  D  ;
"RTN","GMTSPST5",56,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",57,0)
 .. W !,$E(GMTSFAC,1,38),?40,GMTSREAC
"RTN","GMTSPST5",58,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",59,0)
 W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPST5",60,0)
 Q
"RTN","GMTSPST5",61,0)
 ;
"RTN","GMTSPST5",62,0)
RMTALG ;
"RTN","GMTSPST5",63,0)
 ;ZEXCEPT: GMTSDOWN,GMTSHDR,GMTSREAC,GMTSRET,GMTSSMSG,GMTSSTAT
"RTN","GMTSPST5",64,0)
 S GMTSSTAT=0
"RTN","GMTSPST5",65,0)
 S GMTSSMSG=""
"RTN","GMTSPST5",66,0)
 S GMTSHDR=$$HAVEHDR^ORRDI1 I '+$G(GMTSHDR) D  Q
"RTN","GMTSPST5",67,0)
 . S GMTSSMSG="*** WARNING: Remote Data from HDR not available ***"
"RTN","GMTSPST5",68,0)
 D  Q:$G(GMTSDOWN)
"RTN","GMTSPST5",69,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPST5",70,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S GMTSDOWN=1 D
"RTN","GMTSPST5",71,0)
 .. S GMTSSMSG="*** WARNING: Connection to Remote Data Currently Down ***"
"RTN","GMTSPST5",72,0)
 D  ;RDI/HDR CALL ENCAPSULATION
"RTN","GMTSPST5",73,0)
 . D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST5",74,0)
 . S GMTSRET=$$GET^ORRDI1(DFN,"ART")
"RTN","GMTSPST5",75,0)
 . D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPST5",76,0)
 . D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST5",77,0)
 I GMTSRET=-1 D  Q
"RTN","GMTSPST5",78,0)
 . S GMTSSMSG="*** WARNING: Connection to Remote Data Not Available ***"
"RTN","GMTSPST5",79,0)
 I '$D(^XTMP("ORRDI","ART",DFN))!('+GMTSRET) D  Q
"RTN","GMTSPST5",80,0)
 . I $D(^XTMP("ORRDI","ART",DFN,"ASSESSMENT")) S GMTSSTAT=1 Q
"RTN","GMTSPST5",81,0)
 . S GMTSSMSG="No Remote Allergy/ADR Data available for this patient"
"RTN","GMTSPST5",82,0)
 S GMTSSTAT=1
"RTN","GMTSPST5",83,0)
 Q
"RTN","GMTSPST5",84,0)
 ;
"RTN","GMTSPST5",85,0)
YESCHK() ;DO NOT INCLUDE IF A 'YES' ASSESSMENT
"RTN","GMTSPST5",86,0)
 I $P(GMTSREAC,U,2)'="YES" Q 0
"RTN","GMTSPST5",87,0)
 I $P(GMTSREAC,U,2)="YES" I $P(GMTSREAC,U,3)["99VA8" Q 1
"RTN","GMTSPST5",88,0)
 Q 1 ;STOP IF THERE IS ANY PROBLEMATIC DATA
"RTN","GMTSPST5",89,0)
 ;----------------------------------------------------------
"RTN","GMTSPSTN")
0^8^B180171627
"RTN","GMTSPSTN",1,0)
GMTSPSTN ;BIR/RMS - MED RECON TOOL #1 NO GLOSSARY (MED REC PROFILE) ;May 14, 2018@20:52
"RTN","GMTSPSTN",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPSTN",3,0)
 ;Reference to COVER^ORWPS supported by IA 4926
"RTN","GMTSPSTN",4,0)
 ;References to ^ORRDI1 supported by IA 4659
"RTN","GMTSPSTN",5,0)
 ;Reference to ^XTMP("ORRDI","PSOO" supported by IA 4660
"RTN","GMTSPSTN",6,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by IA 5440
"RTN","GMTSPSTN",7,0)
 ;Reference to ^PSOHCSUM supported by IA 330
"RTN","GMTSPSTN",8,0)
 ;Reference to $$ISCLIN^ORUTL1 supported by IA 5691
"RTN","GMTSPSTN",9,0)
 ;Reference to ^PS(51 supported by IA 1980
"RTN","GMTSPSTN",10,0)
 ;Reference to file 53.1 supported by IA 534
"RTN","GMTSPSTN",11,0)
 ;Reference to TEXT^ORQ12 supported by IA 4202
"RTN","GMTSPSTN",12,0)
 ;Reference to $$PKGID^ORX8 supported by IA 3071
"RTN","GMTSPSTN",13,0)
 ;Reference to BCMALG^PSJUTL2 supported by IA 5057
"RTN","GMTSPSTN",14,0)
 ;Reference to OEL^PSOORRL supported by IA 2400
"RTN","GMTSPSTN",15,0)
TOOL1 ;ENTRY POINT FOR HEALTH SUMMARY
"RTN","GMTSPSTN",16,0)
 N ALPHA,DRUGNM,EXPDAYS,IND1,LIST,ORDER,PSNUM,RPC,RPCT,RPCNODE,SAVE,SAVERD
"RTN","GMTSPSTN",17,0)
 D ADD^GMTSPSTR("GMTSPSTN")
"RTN","GMTSPSTN",18,0)
 S IND1=7,EXPDAYS=90
"RTN","GMTSPSTN",19,0)
 D COVER^ORWPS(.RPC,DFN)
"RTN","GMTSPSTN",20,0)
 S RPCT=0 F  S RPCT=$O(RPC(RPCT)) Q:'+RPCT  D
"RTN","GMTSPSTN",21,0)
 . S RPCNODE=RPC(RPCT)
"RTN","GMTSPSTN",22,0)
 . S PSNUM=$P(RPCNODE,U)
"RTN","GMTSPSTN",23,0)
 . S DRUGNM=$$UP^XLFSTR($P(RPCNODE,U,2))
"RTN","GMTSPSTN",24,0)
 . S ORDER=+$P(RPCNODE,U,3)
"RTN","GMTSPSTN",25,0)
 . Q:DRUGNM']""!(ORDER=0)!(PSNUM']"")
"RTN","GMTSPSTN",26,0)
 . S SAVERD=9999999-$$LRD(+$G(^OR(100,ORDER,4)))
"RTN","GMTSPSTN",27,0)
 . S SAVE(DRUGNM,SAVERD,ORDER,PSNUM)=""
"RTN","GMTSPSTN",28,0)
 . Q:("ACTIVE^ACTIVE/SUSP^ACTIVE/PARKED^HOLD^PENDING^ON CALL"'[$P(RPCNODE,U,4))&($P(PSNUM,";")["N")
"RTN","GMTSPSTN",29,0)
 . S ALPHA(1,DRUGNM,ORDER,PSNUM)=$P(RPCNODE,U,4)
"RTN","GMTSPSTN",30,0)
 D ADDREM
"RTN","GMTSPSTN",31,0)
 D HEADER
"RTN","GMTSPSTN",32,0)
 S LIST=1 D OUTPUT
"RTN","GMTSPSTN",33,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",34,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",35,0)
 D CKP Q:$D(GMTSQIT)  W !,$$CJ^XLFSTR("SUPPLIES",IOM-8)
"RTN","GMTSPSTN",36,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",37,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",38,0)
 S LIST=2 D OUTPUT
"RTN","GMTSPSTN",39,0)
 Q
"RTN","GMTSPSTN",40,0)
 ;
"RTN","GMTSPSTN",41,0)
ADDREM ;USES RDI - REMOTE DATA INTEROPERABILITY TO INCORPORATE OUTSIDE MEDS
"RTN","GMTSPSTN",42,0)
 N DOWN,MED,RDI,RNAM,RNUM,STAT,ISSUE
"RTN","GMTSPSTN",43,0)
 Q:'$$HAVEHDR^ORRDI1
"RTN","GMTSPSTN",44,0)
 D  Q:$G(DOWN)  ;Check for outage of RDI
"RTN","GMTSPSTN",45,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPSTN",46,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S DOWN=1 D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",47,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",48,0)
 .. W !,"WARNING: Connection to Remote Data Currently Down",!
"RTN","GMTSPSTN",49,0)
 .. D CKP
"RTN","GMTSPSTN",50,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",51,0)
 ;Get data for HFS file structure
"RTN","GMTSPSTN",52,0)
 D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",53,0)
 S RDI=$$GET^ORRDI1(DFN,"PSOO")
"RTN","GMTSPSTN",54,0)
 D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",55,0)
 D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",56,0)
 ;
"RTN","GMTSPSTN",57,0)
 H 1 ;One extra second to allow ^XTMP replication across nodes
"RTN","GMTSPSTN",58,0)
 I +RDI=-1 D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",59,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",60,0)
 . W !,"WARNING: Connection to Remote Data Not Available",!
"RTN","GMTSPSTN",61,0)
 . D CKP
"RTN","GMTSPSTN",62,0)
 Q:'$D(^XTMP("ORRDI","PSOO",DFN))
"RTN","GMTSPSTN",63,0)
 S MED=0 F  S MED=$O(^XTMP("ORRDI","PSOO",DFN,MED)) Q:'+MED  D
"RTN","GMTSPSTN",64,0)
 . S STAT=$G(^XTMP("ORRDI","PSOO",DFN,MED,5,0))
"RTN","GMTSPSTN",65,0)
 . Q:STAT']""
"RTN","GMTSPSTN",66,0)
 . Q:"ACTIVE^SUSPENDED^HOLD"'[STAT
"RTN","GMTSPSTN",67,0)
 . Q:$G(^XTMP("ORRDI","PSOO",DFN,MED,7,0))']""  ;DoD:quit if there is no exp. date
"RTN","GMTSPSTN",68,0)
 . D  Q:ISSUE<$$FMADD^XLFDT(DT,-366)  ;DoD: quit if ISSUE DATE > 1Y ago
"RTN","GMTSPSTN",69,0)
 .. N %DT,X,Y
"RTN","GMTSPSTN",70,0)
 .. S X=$G(^XTMP("ORRDI","PSOO",DFN,MED,8,0))
"RTN","GMTSPSTN",71,0)
 .. D ^%DT
"RTN","GMTSPSTN",72,0)
 .. S ISSUE=+Y
"RTN","GMTSPSTN",73,0)
 . S RNAM=$G(^XTMP("ORRDI","PSOO",DFN,MED,2,0),"Unknown Drug")
"RTN","GMTSPSTN",74,0)
 . S RNUM=$G(^XTMP("ORRDI","PSOO",DFN,MED,4,0))
"RTN","GMTSPSTN",75,0)
 . Q:RNAM']""!(RNUM']"")
"RTN","GMTSPSTN",76,0)
 . S ALPHA(1,RNAM,RNUM,MED_"X;R")=""
"RTN","GMTSPSTN",77,0)
 Q
"RTN","GMTSPSTN",78,0)
HEADER ;
"RTN","GMTSPSTN",79,0)
 N NVADT,REPEAT
"RTN","GMTSPSTN",80,0)
 S NVADT=$$NVADT
"RTN","GMTSPSTN",81,0)
 D TEXTPRNT("HEADTXT1")
"RTN","GMTSPSTN",82,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",83,0)
 W !,"Non-VA Meds Last Documented On: "
"RTN","GMTSPSTN",84,0)
 W $S(+NVADT:$$FMTE^XLFDT(NVADT,"D"),1:"** Data not found **")
"RTN","GMTSPSTN",85,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",86,0)
 W !,$$REPEAT^XLFSTR("*",IOM-8)
"RTN","GMTSPSTN",87,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",88,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",89,0)
 D TEXTPRNT("HEADTXT2")
"RTN","GMTSPSTN",90,0)
 F REPEAT=1,2 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",91,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",92,0)
 W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",93,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",94,0)
 Q
"RTN","GMTSPSTN",95,0)
TEXTPRNT(TEXTLOC) ;PRINT LINES OF TEXT FROM A LINE LABEL, ENDS WITH $$END
"RTN","GMTSPSTN",96,0)
 N LINE,TLINE,LINETEXT
"RTN","GMTSPSTN",97,0)
 S LINE=0 F  S LINE=LINE+1,TLINE=TEXTLOC_"+"_LINE,LINETEXT=$T(@TLINE) S LINETEXT=$E(LINETEXT,4,$L(LINETEXT)) Q:LINETEXT="$$END"  D
"RTN","GMTSPSTN",98,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",99,0)
 . W !,LINETEXT
"RTN","GMTSPSTN",100,0)
 Q
"RTN","GMTSPSTN",101,0)
OUTPUT N DRUGNM,ORDER,PSNUM
"RTN","GMTSPSTN",102,0)
 N PACK,PACKREF,SIGLINE,ORDNUM
"RTN","GMTSPSTN",103,0)
 N LASTACT,OTLINE
"RTN","GMTSPSTN",104,0)
 S DRUGNM="" F  S DRUGNM=$O(ALPHA(LIST,DRUGNM)) Q:DRUGNM']""  D  K SAVE(DRUGNM) Q:$D(GMTSQIT)
"RTN","GMTSPSTN",105,0)
 . S ORDER="" F  S ORDER=$O(ALPHA(LIST,DRUGNM,ORDER)) Q:ORDER']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",106,0)
 .. S PSNUM="" F  S PSNUM=$O(ALPHA(LIST,DRUGNM,ORDER,PSNUM)) Q:PSNUM']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",107,0)
 ... S PACK=$P(PSNUM,";",2),ORDNUM=$P(PSNUM,";")
"RTN","GMTSPSTN",108,0)
 ... I $$ISSUPPLY(,DRUGNM) S ALPHA(2,DRUGNM,ORDER,PSNUM)=ALPHA(LIST,DRUGNM,ORDER,PSNUM) Q
"RTN","GMTSPSTN",109,0)
 ... I PACK="I" D INPDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",110,0)
 ... I PACK="O" D OPTDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",111,0)
 ... I PACK="R" D RDIDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",112,0)
 Q
"RTN","GMTSPSTN",113,0)
INPDISP ;Display an Inpatient or Clinic Meds Entry
"RTN","GMTSPSTN",114,0)
 N GMTSPSTN,OALINE,OR0,ORIG,ORVP,PSIFN,WLINE,DIWL,DIWR,DIWF,TYPE,X,LASTBCMA,STATUS
"RTN","GMTSPSTN",115,0)
 N DDNUM,DRUGDISP,ORY
"RTN","GMTSPSTN",116,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",117,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",118,0)
 S STATUS=$G(ALPHA(LIST,DRUGNM,ORDER,PSNUM))
"RTN","GMTSPSTN",119,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["HOLD":"On Hold",STATUS["PENDING":"Pending",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPSTN",120,0)
 ;W !,$S($$ISCLIN^ORUTL1(ORDER):"CLIN ",1:"INPT ")_DRUGNM_" (Status="_STATUS_")"
"RTN","GMTSPSTN",121,0)
 D DRUGDSP
"RTN","GMTSPSTN",122,0)
 D IMOOD^ORIMO(.ORY,ORDER)
"RTN","GMTSPSTN",123,0)
 W !,$S(ORY:"CLIN ",1:"INPT ")_DRUGDISP_" (Status="_STATUS_")"
"RTN","GMTSPSTN",124,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",125,0)
 D DRGDSP2
"RTN","GMTSPSTN",126,0)
 D TEXT^ORQ12(.GMTSPSTN,ORDER,80)
"RTN","GMTSPSTN",127,0)
 S DIWL=IND1,DIWR=60,ORIG=$S(PSNUM["U":2,$$GET1^DIQ(53.1,+PSNUM,4,"I")="U":2,1:1)
"RTN","GMTSPSTN",128,0)
 D:$E(GMTSPSTN(1),1,7)="Change "
"RTN","GMTSPSTN",129,0)
 . F OALINE=2:1:$O(GMTSPSTN(":"),-1) I $E(GMTSPSTN(OALINE),1,3)="to " S ORIG=OALINE,$E(GMTSPSTN(OALINE),1,3)="" Q
"RTN","GMTSPSTN",130,0)
 F OALINE=ORIG:1:$O(GMTSPSTN(":"),-1) D
"RTN","GMTSPSTN",131,0)
 . S X=$$LSIG($G(GMTSPSTN(OALINE)))
"RTN","GMTSPSTN",132,0)
 .; S X=$G(GMTSPSTN(OALINE))
"RTN","GMTSPSTN",133,0)
 . D ^DIWP
"RTN","GMTSPSTN",134,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",135,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",136,0)
 . D CKP
"RTN","GMTSPSTN",137,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",138,0)
 S LASTBCMA=$$BCMALG^PSJUTL2(DFN,ORDNUM)
"RTN","GMTSPSTN",139,0)
 I LASTBCMA'="" W !?IND1,$$BCMALG^PSJUTL2(DFN,ORDNUM) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",140,0)
 Q
"RTN","GMTSPSTN",141,0)
 ;
"RTN","GMTSPSTN",142,0)
DRUGDSP ; Get Medication with Dosage
"RTN","GMTSPSTN",143,0)
 S PSIFN=$G(^OR(100,ORDER,4)),OR0=$G(^OR(100,ORDER,0)),TYPE=$P(OR0,U,12)
"RTN","GMTSPSTN",144,0)
 S ORVP=$P(OR0,U,2) K ^TMP("PS",$J)
"RTN","GMTSPSTN",145,0)
 D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)   ; IA 2400
"RTN","GMTSPSTN",146,0)
 S DRUGDISP="" I $P($G(^TMP("PS",$J,"DD",1,0)),U,1)]"" D
"RTN","GMTSPSTN",147,0)
 . S DRUGDISP=$$GET1^DIQ(50,+$P(^TMP("PS",$J,"DD",1,0),U,1)_",",.01)
"RTN","GMTSPSTN",148,0)
 S DRUGDISP=$S(DRUGDISP]"":DRUGDISP,1:DRUGNM)
"RTN","GMTSPSTN",149,0)
 Q
"RTN","GMTSPSTN",150,0)
 ;
"RTN","GMTSPSTN",151,0)
DRGDSP2 ; Display other multiple information for medications/dosages
"RTN","GMTSPSTN",152,0)
 S DDNUM=1 F  S DDNUM=$O(^TMP("PS",$J,"DD",DDNUM)) Q:DDNUM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",153,0)
 . S DRUGDISP=$$GET1^DIQ(50,+$P(^TMP("PS",$J,"DD",DDNUM,0),U,1)_",",.01)
"RTN","GMTSPSTN",154,0)
 . I DRUGDISP]"" W !,"     ",DRUGDISP D CKP
"RTN","GMTSPSTN",155,0)
 Q
"RTN","GMTSPSTN",156,0)
 ;
"RTN","GMTSPSTN",157,0)
OPTDISP ;Display an Outpatient Prescription Entry
"RTN","GMTSPSTN",158,0)
 N EXPDT,REFILLS,STATUS,DIWL,DIWR,PENDMED,GMTSPSTP,ORQLN,CANCELDT
"RTN","GMTSPSTN",159,0)
 N ORDTYP,ORIGRX,QDFLAG
"RTN","GMTSPSTN",160,0)
 K ^TMP($J,"GMTSPSTN"),^UTILITY($J,"W")
"RTN","GMTSPSTN",161,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPSTN",162,0)
 I PACKREF["S" D  Q
"RTN","GMTSPSTN",163,0)
 . D PEN^PSO5241(DFN,"GMTSPSTN",+PACKREF,ORDER)
"RTN","GMTSPSTN",164,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",165,0)
 . W !,"OUTPT "_DRUGNM_" (Status = Pending)"
"RTN","GMTSPSTN",166,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",167,0)
 . D TEXT^ORQ12(.GMTSPSTP,ORDER,60)
"RTN","GMTSPSTN",168,0)
 . S ORQLN=1 F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN!($E(GMTSPSTP(ORQLN),1,10)="Quantity: ")  D
"RTN","GMTSPSTN",169,0)
 .. W !?IND1,GMTSPSTP(ORQLN)
"RTN","GMTSPSTN",170,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",171,0)
 . S ORIGRX=$P($G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,22.1)),U,2)
"RTN","GMTSPSTN",172,0)
 . S ORDTYP=$P($G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,2)),U,1)
"RTN","GMTSPSTN",173,0)
 . S QDFLAG=0 I ORIGRX]"",ORDTYP="RNW" D
"RTN","GMTSPSTN",174,0)
 .. W !?10,"Renewed from Rx# "_ORIGRX
"RTN","GMTSPSTN",175,0)
 .. D CKP Q:$D(QMTSQIT)
"RTN","GMTSPSTN",176,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,101))
"RTN","GMTSPSTN",177,0)
 .. S QDFLAG=1 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",178,0)
 . W !?10,"Login Date: "_$$FMTE^XLFDT(+$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,15)),"2D")
"RTN","GMTSPSTN",179,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",180,0)
 . I 'QDFLAG D
"RTN","GMTSPSTN",181,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,101))
"RTN","GMTSPSTN",182,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",183,0)
 . W:'QDFLAG ! W ?50,"Refills Ordered: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,13))
"RTN","GMTSPSTN",184,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",185,0)
 . W !
"RTN","GMTSPSTN",186,0)
 D RX^PSO52API(DFN,"GMTSPSTN",PACKREF)
"RTN","GMTSPSTN",187,0)
 S EXPDT=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,26))
"RTN","GMTSPSTN",188,0)
 S CANCELDT=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,26.1))
"RTN","GMTSPSTN",189,0)
 S REFILLS=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,9))-$S($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"RF",0))>0:$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"RF",0)),1:0)  ;need to make sure this is as accurate as the previous method in PSOQ0076
"RTN","GMTSPSTN",190,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPSTN",191,0)
 I $P(PSNUM,";")["N" G NVADISP
"RTN","GMTSPSTN",192,0)
 I EXPDT Q:$$FMDIFF^XLFDT(DT,$P(EXPDT,U))>EXPDAYS
"RTN","GMTSPSTN",193,0)
 I CANCELDT Q:$$FMDIFF^XLFDT(DT,$P(CANCELDT,U))>EXPDAYS
"RTN","GMTSPSTN",194,0)
 S STATUS=$P($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,100)),U,2)
"RTN","GMTSPSTN",195,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"On Hold",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPSTN",196,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",197,0)
 W !,"OUTPT "_DRUGNM_" (Status = "_STATUS_")"
"RTN","GMTSPSTN",198,0)
 S DIWL=IND1,DIWR=72
"RTN","GMTSPSTN",199,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",200,0)
 . S X=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPSTN",201,0)
 . D ^DIWP
"RTN","GMTSPSTN",202,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE!($D(GMTSQIT))  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",203,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",204,0)
 . D CKP
"RTN","GMTSPSTN",205,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",206,0)
 W !?10,"Rx# "_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,.01))_" Last Released: "_$$FMTE^XLFDT(LASTREL,"2D"),?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,7))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,8)) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",207,0)
 W !?10,"Rx Expiration Date: ",$$FMTE^XLFDT(EXPDT,"2D"),?50,"Refills Remaining: ",REFILLS D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",208,0)
 W ! D CKP
"RTN","GMTSPSTN",209,0)
 Q
"RTN","GMTSPSTN",210,0)
 ;
"RTN","GMTSPSTN",211,0)
ISSUPPLY(DRUG,DRUGNAME) ;
"RTN","GMTSPSTN",212,0)
 ; Function returns '1' if drug is a SUPPLY, '0' otherwise
"RTN","GMTSPSTN",213,0)
 Q:LIST=2 0 ;Only check during regular med list, not in supply list
"RTN","GMTSPSTN",214,0)
 N VACLASS,DEAHDLG
"RTN","GMTSPSTN",215,0)
 K ^TMP($J,"GMTSPSTND")
"RTN","GMTSPSTN",216,0)
 I +$G(DRUG) D DATA^PSS50(DRUG,,,,,"GMTSPSTND")
"RTN","GMTSPSTN",217,0)
 E  D DATA^PSS50(,DRUGNAME,,,,"GMTSPSTND") S DRUG=$O(^TMP($J,"GMTSPSTND",0))
"RTN","GMTSPSTN",218,0)
 I 'DRUG Q 0
"RTN","GMTSPSTN",219,0)
 S VACLASS=$G(^TMP($J,"GMTSPSTND",DRUG,2))
"RTN","GMTSPSTN",220,0)
 S DEAHDLG=$G(^TMP($J,"GMTSPSTND",DRUG,3))
"RTN","GMTSPSTN",221,0)
 Q:$E(VACLASS,1,2)="XA" 1
"RTN","GMTSPSTN",222,0)
 Q:$E(VACLASS,1,2)="XX" 1
"RTN","GMTSPSTN",223,0)
 Q:(VACLASS="DX900")&(DEAHDLG["S") 1
"RTN","GMTSPSTN",224,0)
 Q 0
"RTN","GMTSPSTN",225,0)
 ;
"RTN","GMTSPSTN",226,0)
RDIDISP ;Display a Remote Meds Entry
"RTN","GMTSPSTN",227,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",228,0)
 W !,"Remote ",?IND1,DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",229,0)
 N STATUS,DIWL,DIWR,DIWF,X,WLINE
"RTN","GMTSPSTN",230,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",231,0)
 S X=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,14,0)),DIWL=IND1,DIWR=60
"RTN","GMTSPSTN",232,0)
 D ^DIWP
"RTN","GMTSPSTN",233,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",234,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",235,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",236,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",237,0)
 S STATUS=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,5,0))
"RTN","GMTSPSTN",238,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"Hold",1:"Unknown")
"RTN","GMTSPSTN",239,0)
 W !?10,"Last Filled: "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,9,0))_" ("_STATUS_" at "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,1,0))_") "
"RTN","GMTSPSTN",240,0)
 W !?10,"Rx Expiration Date: ",$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,7,0)),?55,"Days Supply: "_$P($P($G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,6,0)),";",2),"D",2)
"RTN","GMTSPSTN",241,0)
 Q
"RTN","GMTSPSTN",242,0)
 ;
"RTN","GMTSPSTN",243,0)
NVADISP ;Display a Non-VA Medication Entry
"RTN","GMTSPSTN",244,0)
 N GMTSPSTN,OALINE,ORIG,WLINE,DIWL,DIWR,DIWF,X
"RTN","GMTSPSTN",245,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",246,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",247,0)
 W !,"Non-VA "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",248,0)
 D TEXT^ORQ12(.GMTSPSTN,ORDER,80)
"RTN","GMTSPSTN",249,0)
 S DIWL=IND1,DIWR=60,ORIG=2
"RTN","GMTSPSTN",250,0)
 D:$E(GMTSPSTN(1),1,7)="Change "
"RTN","GMTSPSTN",251,0)
 . F OALINE=2:1:$O(GMTSPSTN(":"),-1) I $E(GMTSPSTN(OALINE),1,3)="to " S ORIG=OALINE+1 Q
"RTN","GMTSPSTN",252,0)
 F OALINE=ORIG:1:$O(GMTSPSTN(":"),-1) D
"RTN","GMTSPSTN",253,0)
 . S X=$$LSIG($G(GMTSPSTN(OALINE)))
"RTN","GMTSPSTN",254,0)
 . D ^DIWP
"RTN","GMTSPSTN",255,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",256,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",257,0)
 . D CKP
"RTN","GMTSPSTN",258,0)
 W ! D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",259,0)
 Q
"RTN","GMTSPSTN",260,0)
FOOTER ;Report footer for older medication entries
"RTN","GMTSPSTN",261,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",262,0)
 D TEXTPRNT("FOOTER1")
"RTN","GMTSPSTN",263,0)
 Q
"RTN","GMTSPSTN",264,0)
OPTFOOT ;Actual display for outpatient footer
"RTN","GMTSPSTN",265,0)
 N LASTREL,FOOTTXT,DAYSSUPP,STATUS
"RTN","GMTSPSTN",266,0)
 K ^TMP($J,"GMTSPSTN")
"RTN","GMTSPSTN",267,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPSTN",268,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPSTN",269,0)
 Q:LASTREL<$$FMADD^XLFDT(DT,-365)
"RTN","GMTSPSTN",270,0)
 Q:$P(PSNUM,";")["N"
"RTN","GMTSPSTN",271,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",272,0)
 W !,"OPT "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",273,0)
 D RX^PSO52API(DFN,"GMTSPSTN",PACKREF)
"RTN","GMTSPSTN",274,0)
 S STATUS=$P($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,100)),U,2)
"RTN","GMTSPSTN",275,0)
 S DAYSSUPP=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,8))
"RTN","GMTSPSTN",276,0)
 S FOOTTXT="("_STATUS_"/"_DAYSSUPP_" Days Supply Last Released: "_$$FMTE^XLFDT(LASTREL,"2D")_")"
"RTN","GMTSPSTN",277,0)
 W $$RJ^XLFSTR(FOOTTXT,74) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",278,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",279,0)
 . W !?IND1,$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPSTN",280,0)
 . D CKP
"RTN","GMTSPSTN",281,0)
 D CKP
"RTN","GMTSPSTN",282,0)
 Q
"RTN","GMTSPSTN",283,0)
NVADT() ;Replaces call previously in ^PSOQCF04
"RTN","GMTSPSTN",284,0)
 N NVAL,NVARR
"RTN","GMTSPSTN",285,0)
 D ^PSOHCSUM
"RTN","GMTSPSTN",286,0)
 Q:'$D(^TMP("PSOO",$J,"NVA")) ""
"RTN","GMTSPSTN",287,0)
 S NVAL=0 F  S NVAL=$O(^TMP("PSOO",$J,"NVA",NVAL)) Q:'+NVAL  D
"RTN","GMTSPSTN",288,0)
 . S NVADT=9999999-$P($G(^TMP("PSOO",$J,"NVA",NVAL,0)),"^",5)
"RTN","GMTSPSTN",289,0)
 . S NVARR(NVADT)=""
"RTN","GMTSPSTN",290,0)
 S NVADT=$O(NVARR(0)) Q:NVADT=9999999 ""
"RTN","GMTSPSTN",291,0)
 Q 9999999-NVADT
"RTN","GMTSPSTN",292,0)
LSIG(SIG) ;Expand a SIG
"RTN","GMTSPSTN",293,0)
 N P,SGY,X
"RTN","GMTSPSTN",294,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","GMTSPSTN",295,0)
 .I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","GMTSPSTN",296,0)
 .S SGY=SGY_X_" "
"RTN","GMTSPSTN",297,0)
 Q SGY
"RTN","GMTSPSTN",298,0)
LRD(PACKREF) ;Calculate LAST RELEASE DATE as latest of original + refill relDates
"RTN","GMTSPSTN",299,0)
 N RELDT,REFDT,CTR,ANS
"RTN","GMTSPSTN",300,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPSTN",301,0)
 S ANS=""
"RTN","GMTSPSTN",302,0)
 D RX^PSO52API(DFN,"GMTSLRD",PACKREF,,"3,R")
"RTN","GMTSPSTN",303,0)
 S RELDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,31))
"RTN","GMTSPSTN",304,0)
 S ANS=RELDT
"RTN","GMTSPSTN",305,0)
 S CTR=0 F  S CTR=$O(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR)) Q:'+CTR  D  ;
"RTN","GMTSPSTN",306,0)
 . S REFDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR,17))
"RTN","GMTSPSTN",307,0)
 . I REFDT>ANS S ANS=REFDT
"RTN","GMTSPSTN",308,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPSTN",309,0)
 Q ANS
"RTN","GMTSPSTN",310,0)
 ;
"RTN","GMTSPSTN",311,0)
CKP D CKP^GMTSUP Q
"RTN","GMTSPSTN",312,0)
 ;
"RTN","GMTSPSTN",313,0)
HEADTXT1 ;;
"RTN","GMTSPSTN",314,0)
 ;;INCLUDED IN THIS LIST:  Alphabetical list of active outpatient
"RTN","GMTSPSTN",315,0)
 ;;prescriptions dispensed from this VA (local) and dispensed from another
"RTN","GMTSPSTN",316,0)
 ;;VA or DoD facility (remote) as well as inpatient orders (local pending and
"RTN","GMTSPSTN",317,0)
 ;;active), local clinic medications, locally documented non-VA medications,
"RTN","GMTSPSTN",318,0)
 ;;and local prescriptions that have expired or been discontinued in the past
"RTN","GMTSPSTN",319,0)
 ;;90 days.
"RTN","GMTSPSTN",320,0)
 ;;
"RTN","GMTSPSTN",321,0)
 ;;$$END
"RTN","GMTSPSTN",322,0)
HEADTXT2 ;;
"RTN","GMTSPSTN",323,0)
 ;;***NOTE*** The display of VA prescriptions dispensed from another VA or
"RTN","GMTSPSTN",324,0)
 ;;DoD facility (remote) is limited to active outpatient prescription entries
"RTN","GMTSPSTN",325,0)
 ;;matched to National Drug File at the originating site and may not include
"RTN","GMTSPSTN",326,0)
 ;;some items such as investigational drugs, compounds, etc.
"RTN","GMTSPSTN",327,0)
 ;;
"RTN","GMTSPSTN",328,0)
 ;;NOT INCLUDED IN THIS LIST: Medications self-entered by the patient into
"RTN","GMTSPSTN",329,0)
 ;;personal health records (i.e. My HealtheVet) are NOT included in this
"RTN","GMTSPSTN",330,0)
 ;;list. Non-VA medications documented outside this VA, remote inpatient
"RTN","GMTSPSTN",331,0)
 ;;orders (regardless of status) and remote clinic medications are NOT
"RTN","GMTSPSTN",332,0)
 ;;included in this list. The patient and provider must always discuss
"RTN","GMTSPSTN",333,0)
 ;;medications the patient is taking, regardless of where the medication was
"RTN","GMTSPSTN",334,0)
 ;;dispensed or obtained.
"RTN","GMTSPSTN",335,0)
 ;;$$END
"RTN","GMTSPSTR")
0^6^B1733586
"RTN","GMTSPSTR",1,0)
GMTSPSTR ;PBM/RMS - USAGE TRACKER for HEALTH SUMMARY COMPONENT ;06/28/17  10:32
"RTN","GMTSPSTR",2,0)
 ;;2.7;Health Summary;**94**;Oct 20, 1995;Build 41
"RTN","GMTSPSTR",3,0)
 Q
"RTN","GMTSPSTR",4,0)
 ;This routine tracks usage of Health Summary Components
"RTN","GMTSPSTR",5,0)
 ;
"RTN","GMTSPSTR",6,0)
 ;Global is: ^GMT(142.3,"TRACKING")
"RTN","GMTSPSTR",7,0)
 ;  where each entry is an array of TAGs:
"RTN","GMTSPSTR",8,0)
 ;   format: ^GMT(142.3,"TRACKING",TAG)
"RTN","GMTSPSTR",9,0)
 ;    where each TAG is an array of SITEs:
"RTN","GMTSPSTR",10,0)
 ;     format: ^GMT(142.3,"TRACKING",TAG,SITE)
"RTN","GMTSPSTR",11,0)
 ;      where each SITE is an array of usage records:
"RTN","GMTSPSTR",12,0)
 ;       format: ^GMT(142.3,"TRACKING",TAG,SITE,IEN)=USER^TIMESTAMP
"RTN","GMTSPSTR",13,0)
 ;        where:
"RTN","GMTSPSTR",14,0)
 ;         IEN is unique index number for each record
"RTN","GMTSPSTR",15,0)
 ;         USER is NEW PERSON (file #200) IEN/DUZ of user
"RTN","GMTSPSTR",16,0)
 ;         TIMESTAMP is date and time of usage
"RTN","GMTSPSTR",17,0)
 ;
"RTN","GMTSPSTR",18,0)
 ; Entry Point: ADD
"RTN","GMTSPSTR",19,0)
 ;   Adds a new tracking record to ^GMT(142.3,"TRACKING") global
"RTN","GMTSPSTR",20,0)
 ;   Parameter(s):      TAG - identifying string (usually component/routine name)
"RTN","GMTSPSTR",21,0)
 ;   Returns:           <nothing>
"RTN","GMTSPSTR",22,0)
 ;
"RTN","GMTSPSTR",23,0)
ADD(TAG) ;
"RTN","GMTSPSTR",24,0)
 N SITE,IEN,RECORD
"RTN","GMTSPSTR",25,0)
 S SITE=DUZ(2)
"RTN","GMTSPSTR",26,0)
 F  L +^GMT(142.3,"TRACKING"):$G(DILOCKTM,3) I  Q
"RTN","GMTSPSTR",27,0)
 S IEN=$$NEXTI(TAG,SITE)
"RTN","GMTSPSTR",28,0)
 L -^GMT(142.3,"TRACKING")
"RTN","GMTSPSTR",29,0)
 S RECORD=DUZ_"^"_$$NOW^XLFDT
"RTN","GMTSPSTR",30,0)
 S ^GMT(142.3,"TRACKING",TAG,SITE,IEN)=RECORD
"RTN","GMTSPSTR",31,0)
 Q
"RTN","GMTSPSTR",32,0)
 ;
"RTN","GMTSPSTR",33,0)
 ; Sub-routine: NEXTI
"RTN","GMTSPSTR",34,0)
 ;   Retrieves next index value for ^GMT(142.3,"TRACKING",TAG,SITE)
"RTN","GMTSPSTR",35,0)
 ;   Parameter(s):      TAG - identifying string, SITE - division identifier passed from ADD
"RTN","GMTSPSTR",36,0)
 ;   Returns:           IEN - integer of next record number
"RTN","GMTSPSTR",37,0)
 ;
"RTN","GMTSPSTR",38,0)
NEXTI(TAG,SITE) ;
"RTN","GMTSPSTR",39,0)
 N IEN
"RTN","GMTSPSTR",40,0)
 I '$D(^GMT(142.3,"TRACKING",TAG,SITE)) S ^GMT(142.3,"TRACKING",TAG,SITE)="",IEN=1
"RTN","GMTSPSTR",41,0)
 I $D(^GMT(142.3,"TRACKING",TAG,SITE))=11 S IEN=$O(^GMT(142.3,"TRACKING",TAG,SITE,":"),-1)+1
"RTN","GMTSPSTR",42,0)
 S ^GMT(142.3,"TRACKING",TAG,SITE,IEN)=""
"RTN","GMTSPSTR",43,0)
 Q IEN
"VER")
8.0^22.2
**INSTALL NAME**
PSO*7.0*314
"BLD",9849,0)
PSO*7.0*314^OUTPATIENT PHARMACY^0^3180914^y
"BLD",9849,4,0)
^9.64PA^^
"BLD",9849,6.3)
25
"BLD",9849,"KRN",0)
^9.67PA^779.2^20
"BLD",9849,"KRN",.4,0)
.4
"BLD",9849,"KRN",.401,0)
.401
"BLD",9849,"KRN",.402,0)
.402
"BLD",9849,"KRN",.403,0)
.403
"BLD",9849,"KRN",.5,0)
.5
"BLD",9849,"KRN",.84,0)
.84
"BLD",9849,"KRN",3.6,0)
3.6
"BLD",9849,"KRN",3.8,0)
3.8
"BLD",9849,"KRN",9.2,0)
9.2
"BLD",9849,"KRN",9.8,0)
9.8
"BLD",9849,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9849,"KRN",9.8,"NM",1,0)
PSO5241^^0^B7033088
"BLD",9849,"KRN",9.8,"NM","B","PSO5241",1)

"BLD",9849,"KRN",19,0)
19
"BLD",9849,"KRN",19.1,0)
19.1
"BLD",9849,"KRN",101,0)
101
"BLD",9849,"KRN",409.61,0)
409.61
"BLD",9849,"KRN",771,0)
771
"BLD",9849,"KRN",779.2,0)
779.2
"BLD",9849,"KRN",870,0)
870
"BLD",9849,"KRN",8989.51,0)
8989.51
"BLD",9849,"KRN",8989.52,0)
8989.52
"BLD",9849,"KRN",8994,0)
8994
"BLD",9849,"KRN","B",.4,.4)

"BLD",9849,"KRN","B",.401,.401)

"BLD",9849,"KRN","B",.402,.402)

"BLD",9849,"KRN","B",.403,.403)

"BLD",9849,"KRN","B",.5,.5)

"BLD",9849,"KRN","B",.84,.84)

"BLD",9849,"KRN","B",3.6,3.6)

"BLD",9849,"KRN","B",3.8,3.8)

"BLD",9849,"KRN","B",9.2,9.2)

"BLD",9849,"KRN","B",9.8,9.8)

"BLD",9849,"KRN","B",19,19)

"BLD",9849,"KRN","B",19.1,19.1)

"BLD",9849,"KRN","B",101,101)

"BLD",9849,"KRN","B",409.61,409.61)

"BLD",9849,"KRN","B",771,771)

"BLD",9849,"KRN","B",779.2,779.2)

"BLD",9849,"KRN","B",870,870)

"BLD",9849,"KRN","B",8989.51,8989.51)

"BLD",9849,"KRN","B",8989.52,8989.52)

"BLD",9849,"KRN","B",8994,8994)

"BLD",9849,"QUES",0)
^9.62^^
"BLD",9849,"REQB",0)
^9.611^2^2
"BLD",9849,"REQB",1,0)
PSO*7.0*213^1
"BLD",9849,"REQB",2,0)
PSO*7.0*294^0
"BLD",9849,"REQB","B","PSO*7.0*213",1)

"BLD",9849,"REQB","B","PSO*7.0*294",2)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
314^3180914^10000000200
"PKG",141,22,1,"PAH",1,1,0)
^^56^56^3180508
"PKG",141,22,1,"PAH",1,1,1,0)
*************
"PKG",141,22,1,"PAH",1,1,2,0)
THIS ENTIRE PATCH DESCRIPTION NEEDS TO BE REVISED.  RMS 3-12-12
"PKG",141,22,1,"PAH",1,1,3,0)
*************
"PKG",141,22,1,"PAH",1,1,4,0)
 
"PKG",141,22,1,"PAH",1,1,5,0)
This patch corrects issues that have been reported with Medication 
"PKG",141,22,1,"PAH",1,1,6,0)
Reconciliation Tool #1 (Medication Reconciliation Health Summary) and 
"PKG",141,22,1,"PAH",1,1,7,0)
Medication Reconciliation Tool #2 (Medication Worksheet).
"PKG",141,22,1,"PAH",1,1,8,0)
 
"PKG",141,22,1,"PAH",1,1,9,0)
Tool #1 - Medication Reconciliation
"PKG",141,22,1,"PAH",1,1,10,0)
  At the bottom of the report there is a section that displays other 
"PKG",141,22,1,"PAH",1,1,11,0)
outpatient prescriptions dispensed in the previous year.  The combination 
"PKG",141,22,1,"PAH",1,1,12,0)
of long drug names and the status "DISCONTINUED/EDIT" would cause the 
"PKG",141,22,1,"PAH",1,1,13,0)
report to lose data at the right margin when printed.  This patch 
"PKG",141,22,1,"PAH",1,1,14,0)
reformats lines in the affected section to maintain spacing within the 
"PKG",141,22,1,"PAH",1,1,15,0)
printed margins.
"PKG",141,22,1,"PAH",1,1,16,0)
 
"PKG",141,22,1,"PAH",1,1,17,0)
Tool #1 - Medication Reconciliation
"PKG",141,22,1,"PAH",1,1,18,0)
  Inpatient orders that do not have additional order text (such as large 
"PKG",141,22,1,"PAH",1,1,19,0)
volume IVs) are inadvertently skipping the BCMA LAST ACTION line.  This 
"PKG",141,22,1,"PAH",1,1,20,0)
patch will include that line more consistently on all inpatient orders.
"PKG",141,22,1,"PAH",1,1,21,0)
 
"PKG",141,22,1,"PAH",1,1,22,0)
Tool #1 - Medication Reconciliation
"PKG",141,22,1,"PAH",1,1,23,0)
  The display of previously expired and discontinued orders at the bottom 
"PKG",141,22,1,"PAH",1,1,24,0)
of the report was selecting the LAST RELEASED DATE based on the 
"PKG",141,22,1,"PAH",1,1,25,0)
prescription that had the latest expiration date.  This patch corrects 
"PKG",141,22,1,"PAH",1,1,26,0)
that selection to display the proper release date that is most recent for 
"PKG",141,22,1,"PAH",1,1,27,0)
a given medication.
"PKG",141,22,1,"PAH",1,1,28,0)
 
"PKG",141,22,1,"PAH",1,1,29,0)
Tool #1 - Medication Reconciliation
"PKG",141,22,1,"PAH",1,1,30,0)
  The listing of medications entered as "clinic medications" through the 
"PKG",141,22,1,"PAH",1,1,31,0)
Inpatient Medications for Outpatient (IMO) process was incorrectly labeled
"PKG",141,22,1,"PAH",1,1,32,0)
as an INP (Inpatient) Medication.  This patch will display that category 
"PKG",141,22,1,"PAH",1,1,33,0)
of medications as CLN, identified in the legend as Clinic Medications.
"PKG",141,22,1,"PAH",1,1,34,0)
 
"PKG",141,22,1,"PAH",1,1,35,0)
Tool #1 - Medication Reconciliation and Tool #4 - Remote Active Medications
"PKG",141,22,1,"PAH",1,1,36,0)
  The statuses of remote outpatient medications shown in the Medication 
"PKG",141,22,1,"PAH",1,1,37,0)
Reconciliation profile and the Remote Active Medications health summary 
"PKG",141,22,1,"PAH",1,1,38,0)
component will now include "HOLD" medications.
"PKG",141,22,1,"PAH",1,1,39,0)
 
"PKG",141,22,1,"PAH",1,1,40,0)
Tool #2 - Medication Worksheet
"PKG",141,22,1,"PAH",1,1,41,0)
  The hard-coded display of a the patient's last four digits of the SSN in
"PKG",141,22,1,"PAH",1,1,42,0)
the body of the work sheet is removed. The release of health summary patch
"PKG",141,22,1,"PAH",1,1,43,0)
GMTS*2.7*85 now permits the removal of the patient SSN from the health
"PKG",141,22,1,"PAH",1,1,44,0)
summary overall header, but this change permits the worksheet to be
"PKG",141,22,1,"PAH",1,1,45,0)
printed with no SSN references remaining.
"PKG",141,22,1,"PAH",1,1,46,0)
 
"PKG",141,22,1,"PAH",1,1,47,0)
Tool #2 - Medication Worksheet
"PKG",141,22,1,"PAH",1,1,48,0)
  The internal programming that selects the name of the pharmacy
"PKG",141,22,1,"PAH",1,1,49,0)
division shown at the top of the worksheet and the pharmacy phone
"PKG",141,22,1,"PAH",1,1,50,0)
number associated with it has been revised. The impact of this correction
"PKG",141,22,1,"PAH",1,1,51,0)
will be seen mostly at legacy integrated systems.
"PKG",141,22,1,"PAH",1,1,52,0)
 
"PKG",141,22,1,"PAH",1,1,53,0)
Also included in this patch is the removal of routine PSOQUAP.  This
"PKG",141,22,1,"PAH",1,1,54,0)
routine was orphaned during the final testing of patch PSO*7*294.  Its
"PKG",141,22,1,"PAH",1,1,55,0)
functionality is fully incorporated into routine PSOQUAP2 which is
"PKG",141,22,1,"PAH",1,1,56,0)
referenced in the implementation guide.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSO5241")
0^1^B7033088
"RTN","PSO5241",1,0)
PSO5241 ;BHAM ISC/SAB - encap II API to return pending Rx data ;May 15, 2018@09:04
"RTN","PSO5241",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213,314**;DEC 1997;Build 25
"RTN","PSO5241",3,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSO5241",4,0)
 ;^PS(50.7 supported by DBIA 2223
"RTN","PSO5241",5,0)
 ;
"RTN","PSO5241",6,0)
PEN(DFN,LIST,IEN,PLACER) ;
"RTN","PSO5241",7,0)
 ;
"RTN","PSO5241",8,0)
 ;DFN: Patient's IEN
"RTN","PSO5241",9,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO5241",10,0)
 ;IEN: Internal record number [optional]
"RTN","PSO5241",11,0)
 ;PLACER: Pointer to Orders file (#100) [optional]
"RTN","PSO5241",12,0)
 ;
"RTN","PSO5241",13,0)
 Q:$G(DFN)']""  Q:$G(LIST)=""
"RTN","PSO5241",14,0)
 N DA,DR,PSOPOST,DIC,DIQ,ND,LK K ^TMP($J,LIST)
"RTN","PSO5241",15,0)
 S ^TMP($J,LIST,DFN,0)=0
"RTN","PSO5241",16,0)
 I $G(IEN) D PROCESS G CLEAN
"RTN","PSO5241",17,0)
 I $G(PLACER)]"",'$G(IEN) S IEN=$O(^PS(52.41,"B",PLACER,0)) D  G CLEAN
"RTN","PSO5241",18,0)
 .I 'IEN S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5241",19,0)
 .D PROCESS
"RTN","PSO5241",20,0)
 F IEN=0:0 S IEN=$O(^PS(52.41,"P",DFN,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5241",21,0)
CLEAN I ^TMP($J,LIST,DFN,0)=0 S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO5241",22,0)
 K DA,DR,DIC,PSOPOST,DIQ
"RTN","PSO5241",23,0)
 Q
"RTN","PSO5241",24,0)
PROCESS ;
"RTN","PSO5241",25,0)
 Q:$P($G(^PS(52.41,IEN,0)),"^",3)="DC"  Q:$P($G(^PS(52.41,IEN,0)),"^",3)="DE"
"RTN","PSO5241",26,0)
 I DFN'=$P($G(^PS(52.41,IEN,0)),"^",2) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO5241",27,0)
 I $G(^PS(52.41,IEN,0))']"" S ^TMP($J,LIST,DFN,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5241",28,0)
 K PSOPOST S DIC=52.41,DA=IEN,DR=".01;2;8;9;11;12;13;15;22.1;101",DIQ="PSOPOST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO5241",29,0)
 F DR=.01,2,12,13,15,22.1,101,8 D  I DR=8 D OI
"RTN","PSO5241",30,0)
 .I DR=.01 S ^TMP($J,LIST,DFN,"B",PSOPOST(52.41,DA,DR,"I"),IEN)=""
"RTN","PSO5241",31,0)
 .I PSOPOST(52.41,DA,DR,"E")'=PSOPOST(52.41,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,DA,DR,"I")_"^"_PSOPOST(52.41,DA,DR,"E") Q
"RTN","PSO5241",32,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,DA,DR,"I")
"RTN","PSO5241",33,0)
 .I DR=22.1,^TMP($J,LIST,DFN,IEN,DR)]"" D
"RTN","PSO5241",34,0)
 ..S IEN52=^TMP($J,LIST,DFN,IEN,DR)
"RTN","PSO5241",35,0)
 ..S $P(^TMP($J,LIST,DFN,IEN,DR),"^",2)=$$GET1^DIQ(52,IEN52,.01)
"RTN","PSO5241",36,0)
 S DR=11 D
"RTN","PSO5241",37,0)
 .I PSOPOST(52.41,IEN,DR,"E")'=PSOPOST(52.41,IEN,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,IEN,DR,"I")_"^"_PSOPOST(52.41,IEN,DR,"E") Q
"RTN","PSO5241",38,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,IEN,DR,"I")
"RTN","PSO5241",39,0)
 S ^TMP($J,LIST,DFN,0)=^TMP($J,LIST,DFN,0)+1
"RTN","PSO5241",40,0)
 K DA,DR,PSOPOST,DIC,DIQ,IEN52
"RTN","PSO5241",41,0)
 Q
"RTN","PSO5241",42,0)
OI ;orderable item
"RTN","PSO5241",43,0)
 S DIC=50.7,DA=PSOPOST(52.41,DA,DR,"I"),DR=.02,DIQ(0)="IE" D EN^DIQ1
"RTN","PSO5241",44,0)
 S ^TMP($J,LIST,DFN,IEN,8)=^TMP($J,LIST,DFN,IEN,8)_"^"_PSOPOST(50.7,DA,DR,"I")_"^"_PSOPOST(50.7,DA,DR,"E")
"RTN","PSO5241",45,0)
 Q
"VER")
8.0^22.2
**END**
**END**
