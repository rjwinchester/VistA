KIDS Distribution saved on Jun 12, 2019@13:46:02
T23 build June 12, 2019 YS*5.01*122, PSO*7.0*457, PSJ*5.0*327, OR*3.0*42
**KIDS**:MENTAL HEALTH NCC PROJECT 5.01^YS*5.01*122^PSO*7.0*457^PSJ*5.0*327^OR*3.0*427^

**INSTALL NAME**
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10965,0)
MENTAL HEALTH NCC PROJECT 5.01^^1^3190612^y
"BLD",10965,1,0)
^^1^1^3180813^
"BLD",10965,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10965,6.3)
28
"BLD",10965,10,0)
^9.63^4^4
"BLD",10965,10,1,0)
YS*5.01*122^1
"BLD",10965,10,2,0)
PSO*7.0*457^1
"BLD",10965,10,3,0)
PSJ*5.0*327^1
"BLD",10965,10,4,0)
OR*3.0*427^1
"BLD",10965,10,"B","OR*3.0*427",4)

"BLD",10965,10,"B","PSJ*5.0*327",3)

"BLD",10965,10,"B","PSO*7.0*457",2)

"BLD",10965,10,"B","YS*5.01*122",1)

"BLD",10965,"KRN",0)
^9.67PA^779.2^20
"BLD",10965,"KRN",.4,0)
.4
"BLD",10965,"KRN",.401,0)
.401
"BLD",10965,"KRN",.402,0)
.402
"BLD",10965,"KRN",.403,0)
.403
"BLD",10965,"KRN",.5,0)
.5
"BLD",10965,"KRN",.84,0)
.84
"BLD",10965,"KRN",3.6,0)
3.6
"BLD",10965,"KRN",3.8,0)
3.8
"BLD",10965,"KRN",9.2,0)
9.2
"BLD",10965,"KRN",9.8,0)
9.8
"BLD",10965,"KRN",19,0)
19
"BLD",10965,"KRN",19.1,0)
19.1
"BLD",10965,"KRN",101,0)
101
"BLD",10965,"KRN",409.61,0)
409.61
"BLD",10965,"KRN",771,0)
771
"BLD",10965,"KRN",779.2,0)
779.2
"BLD",10965,"KRN",870,0)
870
"BLD",10965,"KRN",8989.51,0)
8989.51
"BLD",10965,"KRN",8989.52,0)
8989.52
"BLD",10965,"KRN",8994,0)
8994
"BLD",10965,"KRN","B",.4,.4)

"BLD",10965,"KRN","B",.401,.401)

"BLD",10965,"KRN","B",.402,.402)

"BLD",10965,"KRN","B",.403,.403)

"BLD",10965,"KRN","B",.5,.5)

"BLD",10965,"KRN","B",.84,.84)

"BLD",10965,"KRN","B",3.6,3.6)

"BLD",10965,"KRN","B",3.8,3.8)

"BLD",10965,"KRN","B",9.2,9.2)

"BLD",10965,"KRN","B",9.8,9.8)

"BLD",10965,"KRN","B",19,19)

"BLD",10965,"KRN","B",19.1,19.1)

"BLD",10965,"KRN","B",101,101)

"BLD",10965,"KRN","B",409.61,409.61)

"BLD",10965,"KRN","B",771,771)

"BLD",10965,"KRN","B",779.2,779.2)

"BLD",10965,"KRN","B",870,870)

"BLD",10965,"KRN","B",8989.51,8989.51)

"BLD",10965,"KRN","B",8989.52,8989.52)

"BLD",10965,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.2
**INSTALL NAME**
YS*5.01*122
"BLD",10956,0)
YS*5.01*122^MENTAL HEALTH^0^3190612^y
"BLD",10956,1,0)
^^1^1^3180813^^^
"BLD",10956,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10956,4,0)
^9.64PA^603.03^1
"BLD",10956,4,603.03,0)
603.03
"BLD",10956,4,603.03,2,0)
^9.641^603.03^1
"BLD",10956,4,603.03,2,603.03,0)
CLOZAPINE PARAMETERS  (File-top level)
"BLD",10956,4,603.03,2,603.03,1,0)
^9.6411^11^4
"BLD",10956,4,603.03,2,603.03,1,8,0)
RX LAB PROD LISTENER
"BLD",10956,4,603.03,2,603.03,1,9,0)
DEMOGRAPHIC PROD LISTENER
"BLD",10956,4,603.03,2,603.03,1,10,0)
RX LAB TEST LISTENER
"BLD",10956,4,603.03,2,603.03,1,11,0)
DEMOGRAPHIC TEST LISTENER
"BLD",10956,4,603.03,222)
y^y^p^^^^n^^n
"BLD",10956,4,603.03,224)

"BLD",10956,4,"APDD",603.03,603.03)

"BLD",10956,4,"APDD",603.03,603.03,8)

"BLD",10956,4,"APDD",603.03,603.03,9)

"BLD",10956,4,"APDD",603.03,603.03,10)

"BLD",10956,4,"APDD",603.03,603.03,11)

"BLD",10956,4,"B",603.03,603.03)

"BLD",10956,6.3)
112
"BLD",10956,"ABPKG")
n
"BLD",10956,"INI")
BKGRD^YSCLTEST
"BLD",10956,"INID")
^n^n
"BLD",10956,"INIT")
START^YSCL122P
"BLD",10956,"KRN",0)
^9.67PA^779.2^20
"BLD",10956,"KRN",.4,0)
.4
"BLD",10956,"KRN",.4,"NM",0)
^9.68A^^
"BLD",10956,"KRN",.401,0)
.401
"BLD",10956,"KRN",.402,0)
.402
"BLD",10956,"KRN",.403,0)
.403
"BLD",10956,"KRN",.5,0)
.5
"BLD",10956,"KRN",.84,0)
.84
"BLD",10956,"KRN",3.6,0)
3.6
"BLD",10956,"KRN",3.8,0)
3.8
"BLD",10956,"KRN",9.2,0)
9.2
"BLD",10956,"KRN",9.8,0)
9.8
"BLD",10956,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",10956,"KRN",9.8,"NM",1,0)
YSCLTST2^^0^B118550569
"BLD",10956,"KRN",9.8,"NM",2,0)
YSCLSERV^^0^B113744359
"BLD",10956,"KRN",9.8,"NM",3,0)
YSCLDIS^^0^B33307266
"BLD",10956,"KRN",9.8,"NM",4,0)
YSCLTST3^^0^B73925187
"BLD",10956,"KRN",9.8,"NM",5,0)
YSCLTST5^^0^B144170754
"BLD",10956,"KRN",9.8,"NM",6,0)
YSCLTST6^^0^B35479087
"BLD",10956,"KRN",9.8,"NM",7,0)
YSCLSRV1^^0^B2824351
"BLD",10956,"KRN",9.8,"NM",8,0)
YSCL122P^^0^B1888525
"BLD",10956,"KRN",9.8,"NM",9,0)
YSCLTST4^^0^B20061166
"BLD",10956,"KRN",9.8,"NM","B","YSCL122P",8)

"BLD",10956,"KRN",9.8,"NM","B","YSCLDIS",3)

"BLD",10956,"KRN",9.8,"NM","B","YSCLSERV",2)

"BLD",10956,"KRN",9.8,"NM","B","YSCLSRV1",7)

"BLD",10956,"KRN",9.8,"NM","B","YSCLTST2",1)

"BLD",10956,"KRN",9.8,"NM","B","YSCLTST3",4)

"BLD",10956,"KRN",9.8,"NM","B","YSCLTST4",9)

"BLD",10956,"KRN",9.8,"NM","B","YSCLTST5",5)

"BLD",10956,"KRN",9.8,"NM","B","YSCLTST6",6)

"BLD",10956,"KRN",19,0)
19
"BLD",10956,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",10956,"KRN",19,"NM",1,0)
YSCL DAILY TRANSMISSION^^0
"BLD",10956,"KRN",19,"NM",2,0)
YSCL WEEKLY TRANSMISSION^^0
"BLD",10956,"KRN",19,"NM",3,0)
YSCL TRANSMIT DEMOGRAPHICS^^0
"BLD",10956,"KRN",19,"NM","B","YSCL DAILY TRANSMISSION",1)

"BLD",10956,"KRN",19,"NM","B","YSCL TRANSMIT DEMOGRAPHICS",3)

"BLD",10956,"KRN",19,"NM","B","YSCL WEEKLY TRANSMISSION",2)

"BLD",10956,"KRN",19.1,0)
19.1
"BLD",10956,"KRN",101,0)
101
"BLD",10956,"KRN",409.61,0)
409.61
"BLD",10956,"KRN",771,0)
771
"BLD",10956,"KRN",779.2,0)
779.2
"BLD",10956,"KRN",870,0)
870
"BLD",10956,"KRN",8989.51,0)
8989.51
"BLD",10956,"KRN",8989.52,0)
8989.52
"BLD",10956,"KRN",8994,0)
8994
"BLD",10956,"KRN","B",.4,.4)

"BLD",10956,"KRN","B",.401,.401)

"BLD",10956,"KRN","B",.402,.402)

"BLD",10956,"KRN","B",.403,.403)

"BLD",10956,"KRN","B",.5,.5)

"BLD",10956,"KRN","B",.84,.84)

"BLD",10956,"KRN","B",3.6,3.6)

"BLD",10956,"KRN","B",3.8,3.8)

"BLD",10956,"KRN","B",9.2,9.2)

"BLD",10956,"KRN","B",9.8,9.8)

"BLD",10956,"KRN","B",19,19)

"BLD",10956,"KRN","B",19.1,19.1)

"BLD",10956,"KRN","B",101,101)

"BLD",10956,"KRN","B",409.61,409.61)

"BLD",10956,"KRN","B",771,771)

"BLD",10956,"KRN","B",779.2,779.2)

"BLD",10956,"KRN","B",870,870)

"BLD",10956,"KRN","B",8989.51,8989.51)

"BLD",10956,"KRN","B",8989.52,8989.52)

"BLD",10956,"KRN","B",8994,8994)

"BLD",10956,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",10956,"QUES",0)
^9.62^^
"BLD",10956,"REQB",0)
^9.611^2^1
"BLD",10956,"REQB",2,0)
YS*5.01*92^2
"BLD",10956,"REQB","B","YS*5.01*92",2)

"FIA",603.03)
CLOZAPINE PARAMETERS
"FIA",603.03,0)
^YSCL(603.03,
"FIA",603.03,0,0)
603.03S
"FIA",603.03,0,1)
y^y^p^^^^n^^n
"FIA",603.03,0,10)

"FIA",603.03,0,11)

"FIA",603.03,0,"RLRO")

"FIA",603.03,0,"VR")
5.01^YS
"FIA",603.03,603.03)
1
"FIA",603.03,603.03,8)

"FIA",603.03,603.03,9)

"FIA",603.03,603.03,10)

"FIA",603.03,603.03,11)

"INI")
BKGRD^YSCLTEST
"INIT")
START^YSCL122P
"KRN",19,4944,-1)
0^2
"KRN",19,4944,0)
YSCL WEEKLY TRANSMISSION^Weekly Clozapine Report^Replaced by YSCL DAILY TRANSMISSION^R^^^^^^^^
"KRN",19,4944,1,0)
^19.06^3^3^3160726^^
"KRN",19,4944,1,1,0)
This option should be queued once to run every 7 days (on Tuesday morning
"KRN",19,4944,1,2,0)
prior to the start of business) to transmit Clozapine dispensing data to
"KRN",19,4944,1,3,0)
the Clozapine Roll-Up database located in Hines.
"KRN",19,4944,25)
YSCLTEST
"KRN",19,4944,"U")
WEEKLY CLOZAPINE REPORT
"KRN",19,4946,-1)
0^3
"KRN",19,4946,0)
YSCL TRANSMIT DEMOGRAPHICS^Transmit Clozapine Demographics^Replaced by YSCL DAILY TRANSMISSION.^R^^^^^^^^
"KRN",19,4946,1,0)
^^3^3^2981130^
"KRN",19,4946,1,1,0)
This option should be queued to run on Tuesday morning prior to the start
"KRN",19,4946,1,2,0)
of business to transmit Clozapine patient demographics to the Clozpaine
"KRN",19,4946,1,3,0)
Roll-Up database located in Hines.
"KRN",19,4946,25)
YSCLTST3
"KRN",19,4946,"U")
TRANSMIT CLOZAPINE DEMOGRAPHIC
"KRN",19,11865,-1)
0^1
"KRN",19,11865,0)
YSCL DAILY TRANSMISSION^Daily Clozapine Transmission^^R^^^^^^^^MENTAL HEALTH^^1
"KRN",19,11865,1,0)
^19.06^2^2^3181017^^
"KRN",19,11865,1,1,0)
This option is used to transmit the daily Clozapine patient demographics
"KRN",19,11865,1,2,0)
to the Clozapine Roll-Up database located in Hines.
"KRN",19,11865,20)
D XMIT^YSCLTST5
"KRN",19,11865,25)
YSCLTST5
"KRN",19,11865,"U")
DAILY CLOZAPINE TRANSMISSION
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",100,-1)
1^1
"PKG",100,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",100,22,0)
^9.49I^1^1
"PKG",100,22,1,0)
5.01^3051119^2960821
"PKG",100,22,1,"PAH",1,0)
122^3190612^74
"PKG",100,22,1,"PAH",1,1,0)
^^1^1^3190612
"PKG",100,22,1,"PAH",1,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","YSCL122P")
0^8^B1888525
"RTN","YSCL122P",1,0)
YSCL122P ;ALB/RTW - NCC POST INSTALL;10 May 2019 16:19:28
"RTN","YSCL122P",2,0)
 ;;5.01;MENTAL HEALTH;**122**;Dec 30, 1994;Build 112
"RTN","YSCL122P",3,0)
 ; calls START^YSCLDIS to find clozapine patients in file #55
"RTN","YSCL122P",4,0)
 ; registered more than 57 days ago that do not have a recent clozapine
"RTN","YSCL122P",5,0)
 ; prescription or order, set them to discontinued and send a report to the NCC.
"RTN","YSCL122P",6,0)
 ; the NCC software will maintain the file from this point
"RTN","YSCL122P",7,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCL122P",8,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCL122P",9,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCL122P",10,0)
START ;
"RTN","YSCL122P",11,0)
 ;INITIALIZE ^XTMP("YSCLDEM") and ^XTMP("YSCLTRN")
"RTN","YSCL122P",12,0)
 N DIE,DA,DR S DR="",DIE="^YSCL(603.03,",DA=1,U="^"
"RTN","YSCL122P",13,0)
 I $$GET1^DIQ(8989.3,1,501,"I") S DR="3///0;"   ;S $P(^YSCL(603.03,1,0),"^",3)=0
"RTN","YSCL122P",14,0)
 S DR=DR_"8///S.RUCLRXLAB@FO-HINES.DOMAIN.EXT;9///S.RUCLDEM@FO-HINES.DOMAIN.EXT;"
"RTN","YSCL122P",15,0)
 S DR=DR_"10///G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT;11///G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT"
"RTN","YSCL122P",16,0)
 D ^DIE
"RTN","YSCL122P",17,0)
 N YSDTS S YSDTS("+366")=$$FMADD^XLFDT(DT,366),YSDTS("-one")=$$FMADD^XLFDT(DT,-1)
"RTN","YSCL122P",18,0)
 F VAR="YSCLDEM","YSCLTRN" D
"RTN","YSCL122P",19,0)
 . S ^XTMP(VAR,0)=YSDTS("+366")_U_DT_U_"CLOZAPINE DAILY ROLLUP DATA"_U_(YSDTS("-one")_".000001")
"RTN","YSCL122P",20,0)
 D START^YSCLDIS
"RTN","YSCL122P",21,0)
 Q
"RTN","YSCL122P",22,0)
 ;
"RTN","YSCLDIS")
0^3^B33307266
"RTN","YSCLDIS",1,0)
YSCLDIS ;HINOI/RTW-DISCONTINUE CLOZAPINE PATIENT STATUS ; 11/27/18 5:24pm
"RTN","YSCLDIS",2,0)
 ;;5.01;MENTAL HEALTH;**122**;Dec 30, 1994;Build 112
"RTN","YSCLDIS",3,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLDIS",4,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLDIS",5,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","YSCLDIS",6,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLDIS",7,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLDIS",8,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLDIS",9,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLDIS",10,0)
 ; Reference to ^XMD supported by DBIA #10070
"RTN","YSCLDIS",11,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLDIS",12,0)
 ;
"RTN","YSCLDIS",13,0)
 ;This routine will loop through ^PS(55,DFN,"ASAND" and check the last prescription
"RTN","YSCLDIS",14,0)
 ; enddate and/or the the Inpatient Order stop date. If the patient has not had an active
"RTN","YSCLDIS",15,0)
 ; prescription or Inpatent Clozapine Order in the last 56 days, the Active Treatment will STOP
"RTN","YSCLDIS",16,0)
 ; YSCLFLAG changes from 0 to 1 if criteria to avoid discontinue
"RTN","YSCLDIS",17,0)
 Q
"RTN","YSCLDIS",18,0)
START ;
"RTN","YSCLDIS",19,0)
 N YSLN,DFN,YSCLREGN,YSCLREGD,YSCLREGA,YSCLFLAG,YSARR
"RTN","YSCLDIS",20,0)
 S U="^" S:'$G(DT) DT=$P($$NOW^XLFDT,".") K ^XTMP("YSCLDIS",DT),^XTMP("YSCLDATA")
"RTN","YSCLDIS",21,0)
 D LIST^DIC(603.01,,1,"I",,,,,,,"YSARR")
"RTN","YSCLDIS",22,0)
 F YSLN=1:1 Q:'$D(YSARR("DILIST","ID",YSLN))  S DFN=YSARR("DILIST","ID",YSLN,1) D:DFN
"RTN","YSCLDIS",23,0)
 .S YSCLREGN=$$GET1^DIQ(55,DFN,53) Q:YSCLREGN=""
"RTN","YSCLDIS",24,0)
 .Q:$$GET1^DIQ(55,DFN,54,"I")="D"   ;Not checking those already discontinued
"RTN","YSCLDIS",25,0)
 .N YSCLDIS2,YSCLNEW,X,X1,X2
"RTN","YSCLDIS",26,0)
 .S YSCLREGD=$$GET1^DIQ(55,DFN,58,"I")
"RTN","YSCLDIS",27,0)
 .S X1=DT,X2=YSCLREGD D ^%DTC S YSCLREGA=X
"RTN","YSCLDIS",28,0)
 .I YSCLREGN?1U6N D:YSCLREGA>4  Q   ;temps greater than 4 days since registration
"RTN","YSCLDIS",29,0)
 ..S YSCLDIS2=3 D SET,DC,DMG^YSCLTST5
"RTN","YSCLDIS",30,0)
 .Q:YSCLREGA<28                     ;Not checking those registered 27 days or less
"RTN","YSCLDIS",31,0)
 .S ^XTMP("YSCLDATA",DT,DFN)=YSCLREGN_U_YSCLREGD,YSCLFLAG=0
"RTN","YSCLDIS",32,0)
 .S YSCLNEW=1                       ;Registration is new unless clozapine orders are found
"RTN","YSCLDIS",33,0)
 .D OPT Q:YSCLFLAG=1                ;Not checking further
"RTN","YSCLDIS",34,0)
 .D INP Q:YSCLFLAG=1
"RTN","YSCLDIS",35,0)
 .S YSCLDIS2=$S(YSCLNEW:1,1:2)
"RTN","YSCLDIS",36,0)
 .D SET,DC,DMG^YSCLTST5
"RTN","YSCLDIS",37,0)
 D:$D(^XTMP("YSCLDIS")) TR
"RTN","YSCLDIS",38,0)
 Q
"RTN","YSCLDIS",39,0)
OPT ; Outpatient orders
"RTN","YSCLDIS",40,0)
 N YSARRAY,YSCLOPT,YSCLRX,YSCLDRG,YSCLFLDT,YSCLSPDT,X,X1,X2,YSCLFLDA
"RTN","YSCLDIS",41,0)
 D LIST^DIC(55.03,","_DFN_",",,"I",,,,,,,"YSARRAY")
"RTN","YSCLDIS",42,0)
 S YSCLOPT="A" F  S YSCLOPT=$O(YSARRAY("DILIST",1,YSCLOPT),-1) Q:'YSCLOPT  D  Q:YSCLFLAG
"RTN","YSCLDIS",43,0)
 .S YSCLRX=YSARRAY("DILIST",1,YSCLOPT),YSCLDRG=$$GET1^DIQ(52,YSCLRX,6,"I") Q:'YSCLDRG
"RTN","YSCLDIS",44,0)
 .Q:'$L($$GET1^DIQ(50,YSCLDRG,17.5))  ;'$D(^PSDRUG("ACLOZ",+YSCLDRG))
"RTN","YSCLDIS",45,0)
 .S YSCLFLDT=$$GET1^DIQ(52,YSCLRX,22,"I") Q:YSCLFLDT<YSCLREGD   ;Fill Date before Registration
"RTN","YSCLDIS",46,0)
 .S YSCLNEW=0                                                   ;Not a new Registration
"RTN","YSCLDIS",47,0)
 .S YSCLSPDT=$$GET1^DIQ(52,YSCLRX,26,"I")
"RTN","YSCLDIS",48,0)
 .I YSCLSPDT'<DT S YSCLFLAG=1 Q                                 ;Not Expired yet
"RTN","YSCLDIS",49,0)
 .S X1=DT,X2=YSCLFLDT D ^%DTC S YSCLFLDA=X
"RTN","YSCLDIS",50,0)
 .I YSCLFLDA<56 S YSCLFLAG=1
"RTN","YSCLDIS",51,0)
 Q
"RTN","YSCLDIS",52,0)
INP ;Inpatient Orders
"RTN","YSCLDIS",53,0)
 N YSARRAY,YSARRAY1,YSCLIPT,YSLINE,YSCLDRG,YSCLORDT,YSCLSPDT,YSCLORDA,X,X1,X2
"RTN","YSCLDIS",54,0)
 D LIST^DIC(55.06,","_DFN_",",,"I",,,,,,,"YSARRAY")
"RTN","YSCLDIS",55,0)
 S YSCLIPT="A" F  S YSCLIPT=$O(YSARRAY("DILIST",1,YSCLIPT),-1) Q:'YSCLIPT  D  Q:YSCLFLAG
"RTN","YSCLDIS",56,0)
 .S YSLINE=YSARRAY("DILIST",2,YSCLIPT)
"RTN","YSCLDIS",57,0)
 .D LIST^DIC(55.07,","_YSLINE_","_DFN_",",,"I",,,,,,,"YSARRAY1")
"RTN","YSCLDIS",58,0)
 .S YSCLDRG=+$G(YSARRAY1("DILIST",1,1)) Q:'$G(YSCLDRG)
"RTN","YSCLDIS",59,0)
 .Q:$$GET1^DIQ(50,YSCLDRG,17.5)'="PSOCLO1"
"RTN","YSCLDIS",60,0)
 .S YSCLORDT=$$GET1^DIQ(55.06,YSLINE_","_DFN,27,"I") Q:YSCLORDT<YSCLREGD  ;Order date before Registration
"RTN","YSCLDIS",61,0)
 .S YSCLNEW=0                                                   ;Not a new Registration
"RTN","YSCLDIS",62,0)
 .S YSCLSPDT=$$GET1^DIQ(55.06,YSLINE_","_DFN,34,"I")
"RTN","YSCLDIS",63,0)
 .I YSCLSPDT'<DT S YSCLFLAG=1 Q                                 ;Not Stopped yet
"RTN","YSCLDIS",64,0)
 .S X1=DT,X2=YSCLORDT D ^%DTC S YSCLORDA=X
"RTN","YSCLDIS",65,0)
 .I YSCLORDA<56 S YSCLFLAG=1
"RTN","YSCLDIS",66,0)
 Q
"RTN","YSCLDIS",67,0)
 ;
"RTN","YSCLDIS",68,0)
SET ;XTMP BUILD USED FOR TESTING
"RTN","YSCLDIS",69,0)
 S ^XTMP("YSCLDIS",DT,DFN,0)=YSCLDIS2
"RTN","YSCLDIS",70,0)
 Q
"RTN","YSCLDIS",71,0)
DC ;
"RTN","YSCLDIS",72,0)
 N DIE,DR
"RTN","YSCLDIS",73,0)
 S DIE="^PS(55,",DA=DFN,DR="54///"_"D"_";56///1" D ^DIE
"RTN","YSCLDIS",74,0)
 Q
"RTN","YSCLDIS",75,0)
 ;
"RTN","YSCLDIS",76,0)
TR ;
"RTN","YSCLDIS",77,0)
 K ^TMP("YSCL",$J) X ^%ZOSF("UCI")
"RTN","YSCLDIS",78,0)
 D YSCLDRSN K XMY
"RTN","YSCLDIS",79,0)
 I $$GET1^DIQ(8989.3,1,501,"I") S XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLDIS",80,0)
 E  S XMY("G.PSOCLOZ")=""
"RTN","YSCLDIS",81,0)
 D YSXMTEXT
"RTN","YSCLDIS",82,0)
 S XMDUZ="CLOZAPINE MONITOR",DT=$$NOW^XLFDT
"RTN","YSCLDIS",83,0)
 S ^TMP("YSCL",$J,1,0)="Clozapine Discontinued Patient(s) Data was transmitted, "_YSCLLN
"RTN","YSCLDIS",84,0)
 S ^(0)=^TMP("YSCL",$J,1,0)_" records were sent."
"RTN","YSCLDIS",85,0)
 S XMSUB=$P($$SITE^VASITE,U,2)_" Discontinued Status",^TMP("YSCL",$J,2,0)=" "
"RTN","YSCLDIS",86,0)
 S XMTEXT="^TMP(""YSCL"",$J," D ^XMD
"RTN","YSCLDIS",87,0)
 S $P(^YSCL(603.03,1,0),U,6)=DT
"RTN","YSCLDIS",88,0)
 K ^TMP("YSCL",$J)
"RTN","YSCLDIS",89,0)
 Q
"RTN","YSCLDIS",90,0)
 ;
"RTN","YSCLDIS",91,0)
YSXMTEXT ;CALLED BY YSCLTST3 /RTW Start: Added to build message of discontinued clozapine patients data for NCC
"RTN","YSCLDIS",92,0)
 S (YSCLLN,YSCLDATE)=0,YSCLCNT=2
"RTN","YSCLDIS",93,0)
 F  S YSCLDATE=$O(^XTMP("YSCLDIS",YSCLDATE)) Q:'YSCLDATE  D
"RTN","YSCLDIS",94,0)
 .S YSCLDFN=0 F  S YSCLDFN=$O(^XTMP("YSCLDIS",YSCLDATE,YSCLDFN)) Q:'YSCLDFN  D
"RTN","YSCLDIS",95,0)
 ..I $$GET1^DIQ(55,DFN,54,"I")'="D" Q                      ; quit if patient wasn't Discontinued
"RTN","YSCLDIS",96,0)
 ..S PSOLAST4=$E($$GET1^DIQ(2,YSCLDFN,.09),6,9),YSCLLN=YSCLLN+1
"RTN","YSCLDIS",97,0)
 ..S YSCLMESG=$$GET1^DIQ(2,YSCLDFN,.01)_" ("_PSOLAST4_")"
"RTN","YSCLDIS",98,0)
 ..S YSCLDIS2=$P(^XTMP("YSCLDIS",YSCLDATE,YSCLDFN,0),U)
"RTN","YSCLDIS",99,0)
 ..S MSG1=$S(YSCLDIS2=1:YSCLD1,YSCLDIS2=2:YSCLD2,1:YSCLD3)
"RTN","YSCLDIS",100,0)
 ..S MSG2=$S(YSCLDIS2=1:YSCLD11,YSCLDIS2=2:YSCLD22,1:YSCLD33)
"RTN","YSCLDIS",101,0)
 ..S MSG3=$S(YSCLDIS2=1:YSCLD111,YSCLDIS2=2:YSCLD222,1:YSCLD333)
"RTN","YSCLDIS",102,0)
 ..S ^TMP("YSCL",$J,$I(YSCLCNT),0)=YSCLMESG ;message from YSCLDRSN
"RTN","YSCLDIS",103,0)
 ..S ^TMP("YSCL",$J,$I(YSCLCNT),0)=MSG1
"RTN","YSCLDIS",104,0)
 ..S ^TMP("YSCL",$J,$I(YSCLCNT),0)=MSG2
"RTN","YSCLDIS",105,0)
 ..S ^TMP("YSCL",$J,$I(YSCLCNT),0)=MSG3
"RTN","YSCLDIS",106,0)
 ..S ^TMP("YSCL",$J,$I(YSCLCNT),0)="" ;blank line
"RTN","YSCLDIS",107,0)
 Q
"RTN","YSCLDIS",108,0)
YSCLDRSN ;CALLED BY YSCLTST3  discontinued reasons
"RTN","YSCLDIS",109,0)
 S YSCLD1="The patient status has changed to 'Discontinued' because the new clozapine"
"RTN","YSCLDIS",110,0)
 S YSCLD11="patient has not filled the prescription/order within 28 days of being marked "
"RTN","YSCLDIS",111,0)
 S YSCLD111="'Active'. "
"RTN","YSCLDIS",112,0)
 S YSCLD2="The patient status has changed to 'Discontinued' because the active clozapine"
"RTN","YSCLDIS",113,0)
 S YSCLD22="patient has not filled the prescription/order within 56 days of being "
"RTN","YSCLDIS",114,0)
 S YSCLD222="prescribed/ordered."
"RTN","YSCLDIS",115,0)
 S YSCLD3="The patient status has changed to 'Discontinued' because the temporary local "
"RTN","YSCLDIS",116,0)
 S YSCLD33="authorization number assigned has expired and NCCC has not issued a new "
"RTN","YSCLDIS",117,0)
 S YSCLD333="authorization number. "
"RTN","YSCLDIS",118,0)
 Q
"RTN","YSCLSERV")
0^2^B113744359
"RTN","YSCLSERV",1,0)
YSCLSERV ;DALOI/RLM-Clozapine data server ; 11/27/18 5:22pm
"RTN","YSCLSERV",2,0)
 ;;5.01;MENTAL HEALTH;**18,22,26,47,61,69,74,90,92,122**;Dec 30, 1994;Build 112
"RTN","YSCLSERV",3,0)
 ; Reference to ^%ZOSF supported by IA #10096
"RTN","YSCLSERV",4,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLSERV",5,0)
 ; Reference to ^DD("DD" supported by IA #10017
"RTN","YSCLSERV",6,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLSERV",7,0)
 ; Reference to ^PSDRUG supported by IA #25
"RTN","YSCLSERV",8,0)
 ; Reference to ^PSRX supported by IA #780
"RTN","YSCLSERV",9,0)
 ; Reference to ^VA(200 supported by IA #10060
"RTN","YSCLSERV",10,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","YSCLSERV",11,0)
 ; Reference to $$FMTE^XLFDT() supported by IA #10103
"RTN","YSCLSERV",12,0)
 ; Reference to ^PSDRUG supported by IA #221
"RTN","YSCLSERV",13,0)
 ; Reference to ^XMD supported by IA #10070
"RTN","YSCLSERV",14,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLSERV",15,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLSERV",16,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLSERV",17,0)
 ; Reference to ^DIK supported by DBIA #10013
"RTN","YSCLSERV",18,0)
 ; Reference to MIX^DIC1 supported by DBIA #10007
"RTN","YSCLSERV",19,0)
 ; Reference to FILE^DICN supported by DBIA #10009
"RTN","YSCLSERV",20,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLSERV",21,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","YSCLSERV",22,0)
 ;
"RTN","YSCLSERV",23,0)
START ;
"RTN","YSCLSERV",24,0)
 K ^TMP($J,"YSCLDATA")
"RTN","YSCLSERV",25,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I")
"RTN","YSCLSERV",26,0)
 S YSCLST=$P($$SITE^VASITE,"^",3)
"RTN","YSCLSERV",27,0)
 S YSCLSTN=$P($$SITE^VASITE,"^",2)
"RTN","YSCLSERV",28,0)
 ;Determine station number
"RTN","YSCLSERV",29,0)
 I $G(PSCLOZ) G UNREG
"RTN","YSCLSERV",30,0)
 S X=XQSUB X ^%ZOSF("UPPERCASE") S YSCLSUB=Y
"RTN","YSCLSERV",31,0)
 S ^TMP($J,"YSCLDATA",1)=$S(YSDEBUG:"DEBUG ",1:"")_YSCLSUB_" triggered at "_YSCLST_" by "_XMFROM_" on "_XQDATE
"RTN","YSCLSERV",32,0)
 ;The first line of the message tells who requested the action and when
"RTN","YSCLSERV",33,0)
 D
"RTN","YSCLSERV",34,0)
 .S YSACTION=$S(YSCLSUB["REMOVE"!(YSCLSUB["DELETE"):"data deleted",YSCLSUB["REPORT":"report generated",YSCLSUB["REBUILD":"data verified",YSCLSUB["UPDATE":"data updated",YSCLSUB["DATESET":"date set",1:"CONT")
"RTN","YSCLSERV",35,0)
 .I YSACTION="CONT" S YSACTION=$S(YSCLSUB["DEMOG RESET":"Demographics Flag Reset",YSCLSUB["DEBUG":"Debug Mode set",YSCLSUB["AUTH":"Authorization",YSCLSUB["LOCK":"Lock",1:"Site Lock")
"RTN","YSCLSERV",36,0)
 .S ^TMP($J,"YSCLDATA",2)="No "_$S(YSDEBUG:"DEBUG ",1:"")_YSACTION_" at "_YSCLST
"RTN","YSCLSERV",37,0)
 ;The second line tells when the server is activated and no data can be
"RTN","YSCLSERV",38,0)
 ;gathered from the MailMan message.  This line gets replaced if the
"RTN","YSCLSERV",39,0)
 ;server finds something to do.
"RTN","YSCLSERV",40,0)
 S YSCLLNT=1 I YSCLSUB["REMOVE"!(YSCLSUB["DELETE") G DELETE
"RTN","YSCLSERV",41,0)
 ;If the subject contains the word REMOVE or DELETE delete those entries from the list.
"RTN","YSCLSERV",42,0)
 I YSCLSUB["REPORT" G REPORT
"RTN","YSCLSERV",43,0)
 ;If the subject contains "REPORT" send a report of the currently registered patients to the Clozapine group on Forum
"RTN","YSCLSERV",44,0)
 ;I YSCLSUB["REBUILD" G REBUILD
"RTN","YSCLSERV",45,0)
 I YSCLSUB["RESEND" G RESEND
"RTN","YSCLSERV",46,0)
 I YSCLSUB["UPDATE" G UPDATE
"RTN","YSCLSERV",47,0)
 ;I YSCLSUB["CHECKSUM" G CSUM^YSCLSRV1
"RTN","YSCLSERV",48,0)
 I YSCLSUB["DATESET" G DSET
"RTN","YSCLSERV",49,0)
 I YSCLSUB["DEBUG" G DEBUG
"RTN","YSCLSERV",50,0)
 I YSCLSUB["PATIENT" G ^YSCLSRV3
"RTN","YSCLSERV",51,0)
 I YSCLSUB["LOCKOUT" G LOCK^YSCLSRV3
"RTN","YSCLSERV",52,0)
 I YSCLSUB="DEMOG RESET" G DEMOG^YSCLSRV3
"RTN","YSCLSERV",53,0)
 I YSCLSUB["AUTHORIZE" G AUTH^YSCLSRV3
"RTN","YSCLSERV",54,0)
 I YSCLSUB="OVERRIDE" G OVRRID^YSCLSRV2
"RTN","YSCLSERV",55,0)
 I YSCLSUB="CLAPI" G CLAPI^YSCLSRV2
"RTN","YSCLSERV",56,0)
 I YSCLSUB="CL1API" G CL1API^YSCLSRV2
"RTN","YSCLSERV",57,0)
 I YSCLSUB["DISCON" G DCON^YSCLSRV2
"RTN","YSCLSERV",58,0)
 F  X XMREC Q:XMER<0  S XMRG=$TR(XMRG,"- ","") D
"RTN","YSCLSERV",59,0)
 . ;Verify that + of site number matches local site number
"RTN","YSCLSERV",60,0)
 . I XMRG'?2U5N1","9N1","1U S YSCLER=" is in error and was not added at " D OUT Q
"RTN","YSCLSERV",61,0)
 . I $P(XMRG,",")'?2U5N S YSCLER=" is not a valid Clozapine number " D OUT Q
"RTN","YSCLSERV",62,0)
 . I $P(XMRG,",",2)'?9N S YSCLER=" An SSN must be 9 numbers " D OUT Q
"RTN","YSCLSERV",63,0)
 . I $P(XMRG,",",3)'="B",$P(XMRG,",",3)'="W",$P(XMRG,",",3)'="M" S YSCLER=" You must specify Weekly, Biweekly, or Monthly " D OUT Q
"RTN","YSCLSERV",64,0)
 . ;Validate the format of the data in the message and report the error.
"RTN","YSCLSERV",65,0)
 . ;Do not add data for records where the SSN sent is not in the local database
"RTN","YSCLSERV",66,0)
 . S DIC="^DPT(",DIC(0)="X",D="SSN",X=$P(XMRG,",",2)
"RTN","YSCLSERV",67,0)
 . N ARRAY D LIST^DIC(2,,.09,,,,X,"SSN",,,"ARRAY")
"RTN","YSCLSERV",68,0)
 . S DFN=$G(ARRAY("DILIST",2,1)) I DFN="" S YSCLER=" SSN does not exist at " D OUT Q
"RTN","YSCLSERV",69,0)
 . ;I '$D(^DPT("SSN",X)) S YSCLER=" SSN does not exist at " D OUT Q
"RTN","YSCLSERV",70,0)
 . K ARRAY D LIST^DIC(603.01,,1,,,,$P(XMRG,","),,,,"ARRAY")
"RTN","YSCLSERV",71,0)
 . I $D(ARRAY("DILIST","ID",1,1)) D  D OUT Q
"RTN","YSCLSERV",72,0)
 . . S YSCLER=" Clozapine # is in use by "_ARRAY("DILIST","ID",1,1)_" at "
"RTN","YSCLSERV",73,0)
 . ;I $D(^YSCL(603.01,"B",$P(XMRG,","))) S YSCLX=$O(^YSCL(603.01,"B",$P(XMRG,","),"")) S:YSCLX]"" YSCLX=$P(^YSCL(603.01,YSCLX,0),"^",2),YSCLER=" Clozapine # is in use by "_$P($G(^DPT(YSCLX,0)),"^")_" at " D OUT Q
"RTN","YSCLSERV",74,0)
 . D MIX^DIC1 S YSCLPT=+Y I Y=-1 S YSCLER=" could not be added at " D OUT Q
"RTN","YSCLSERV",75,0)
 . ;Add the data and report any errors to the Roll-Up group at Forum.
"RTN","YSCLSERV",76,0)
 . K DD S DIC="^YSCL(603.01,",X=$P(XMRG,","),DIC("DR")="1////"_YSCLPT_";2////W" K DO D FILE^DICN
"RTN","YSCLSERV",77,0)
 . K ARRAY D LIST^DIC(603.01,,1,,,,$P(XMRG,","),,,,"ARRAY")
"RTN","YSCLSERV",78,0)
 . I $D(ARRAY("DILIST","ID",1,1)) S YSCLER=" assigned to "_ARRAY("DILIST","ID",1,1)_" at " D OUT
"RTN","YSCLSERV",79,0)
 . ;S YSCLX=$O(^YSCL(603.01,"B",$P(XMRG,","),"")) S:YSCLX]"" YSCLX=$P(^YSCL(603.01,YSCLX,0),"^",2),YSCLER=" assigned to "_$P($G(^DPT(YSCLX,0)),"^")_" at " D OUT
"RTN","YSCLSERV",80,0)
EXIT ;If all went well, report that too.
"RTN","YSCLSERV",81,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I")
"RTN","YSCLSERV",82,0)
 S %H=$H D YMD^%DTC S XMDUN="NCCC LOGGER",XMDUZ=".5",XMSUB=$S(YSDEBUG:"DEBUG ",YSCLSUB["DEBUG":"DEBUG ",1:"")_YSCLST_" NCCC ENROLLER ("_X_%_")",XMTEXT="^TMP($J,""YSCLDATA"","
"RTN","YSCLSERV",83,0)
 ;/MZR -Begin modifications for YS*5.01*122
"RTN","YSCLSERV",84,0)
 K XMY I $$GET1^DIQ(8989.3,1,501,"I") D:YSCLLNT
"RTN","YSCLSERV",85,0)
 . I 'YSDEBUG S XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLSERV",86,0)
 . E  S XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLSERV",87,0)
 E  D:YSCLLNT
"RTN","YSCLSERV",88,0)
 . I 'YSDEBUG S XMY("G.CLOZAPINE ROLL-UP")=""
"RTN","YSCLSERV",89,0)
 . E  S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLSERV",90,0)
 ;/MZR - End modifications for YS*5.01*122
"RTN","YSCLSERV",91,0)
 D ^XMD
"RTN","YSCLSERV",92,0)
 ;Mail the errors and successes back to the Roll-Up group at Forum.
"RTN","YSCLSERV",93,0)
 K ^TMP($J,"YSCLDATA")
"RTN","YSCLSERV",94,0)
 K %,%DT,%H,D,DA,DD,DIC,DIE,DIK,RET,X,XMDUN,XMDUZ,XMER,XMFROM
"RTN","YSCLSERV",95,0)
 K XMREC,XMRG,XMSUB,XMTEXT,XMY,XMZ,XQDATE,XQSUB,Y,YSA,YSACTION,YSCLTYPE
"RTN","YSCLSERV",96,0)
 K YSCL28,YSCLA,YSCLAA,YSCLB,YSCLC,YSCLDA,YSCLDA1,YSCLDATA,YSCLDEA1
"RTN","YSCLSERV",97,0)
 K YSCLDFN,YSCLDM,YSCLDOC,YSCLDOM,YSCLDR,YSCLDRA,YSCLDRB,YSCLDTA,YSCLERR
"RTN","YSCLSERV",98,0)
 K YSCLDUZ,YSCLED,YSCLER,YSCLFDA,YSCLFRQ,YSCLLNT,YSCLNM,YSCLOVR,YSCLSITE
"RTN","YSCLSERV",99,0)
 K YSCLPT,YSCLRPT,YSCLSD1,YSCLSDT,YSCLSSN,YSCLST,YSCLSTN,YSCLSUB,YSCLTC
"RTN","YSCLSERV",100,0)
 K YSCLRX,YSCLSAND,YSCLWB,YSCLX,YSCLYN,YSDEBUG,YSI,YSOFF,YSPR,ZTQUEUED,ZTSK
"RTN","YSCLSERV",101,0)
 Q
"RTN","YSCLSERV",102,0)
 ;/RBN Begin mods - YS*5.01*122
"RTN","YSCLSERV",103,0)
UNREG I $G(PSCLOZ) D  Q
"RTN","YSCLSERV",104,0)
 . ;Verify that + of site number matches local site number
"RTN","YSCLSERV",105,0)
 . I XMRG'?1U4.6N1",".U1",".U1","4N S YSCLER=" is in error and was not added at " D OUT Q
"RTN","YSCLSERV",106,0)
 . I $P(XMRG,",")'?1U4.6N S YSCLER=" is not a valid Clozapine number " D OUT Q
"RTN","YSCLSERV",107,0)
 . I $P(XMRG,",",4)'?4N S YSCLER=" An SSN must be 4 numbers " D OUT Q
"RTN","YSCLSERV",108,0)
 . ;Validate the format of the data in the message and report the error.
"RTN","YSCLSERV",109,0)
 . ;Do not add data for records where the SSN sent is not in the local database
"RTN","YSCLSERV",110,0)
 . S DIC="^DPT(",DIC(0)="X",D="SSN",X=SSN
"RTN","YSCLSERV",111,0)
 . N ARRAY D LIST^DIC(2,,.09,,,,X,"SSN",,,"ARRAY")
"RTN","YSCLSERV",112,0)
 . S DFN=$G(ARRAY("DILIST",2,1)) I DFN="" S YSCLER=" SSN does not exist at " D OUT Q
"RTN","YSCLSERV",113,0)
 . K ARRAY D LIST^DIC(603.01,,1,,,,$P(XMRG,","),,,,"ARRAY")
"RTN","YSCLSERV",114,0)
 . I $D(ARRAY("DILIST","ID",1,1)) D  D OUT Q
"RTN","YSCLSERV",115,0)
 . . S YSCLER=" Clozapine # is in use by "_ARRAY("DILIST","ID",1,1)_" at "
"RTN","YSCLSERV",116,0)
 . D MIX^DIC1 S YSCLPT=+Y I Y=-1 S YSCLER=" could not be added at " D OUT Q
"RTN","YSCLSERV",117,0)
 . ;Add the data and report any errors to the Roll-Up group at Forum.
"RTN","YSCLSERV",118,0)
 . K DD S DIC="^YSCL(603.01,",X=$P(XMRG,","),DIC("DR")="1////"_YSCLPT_";2////"_"W" K DO D FILE^DICN
"RTN","YSCLSERV",119,0)
 . K ARRAY D LIST^DIC(603.01,,1,,,,$P(XMRG,","),,,,"ARRAY")
"RTN","YSCLSERV",120,0)
 . I $D(ARRAY("DILIST","ID",1,1)) S YSCLER=" assigned to "_ARRAY("DILIST","ID",1,1)_" at " D OUT
"RTN","YSCLSERV",121,0)
 ;/RBN End mods - YS*5.01*122
"RTN","YSCLSERV",122,0)
 Q
"RTN","YSCLSERV",123,0)
DELETE ;Allow the NCCC users to delete clozapine registration at the individual sites
"RTN","YSCLSERV",124,0)
 S YSCLLNT=1 F  X XMREC Q:XMER<0  S XMRG=$TR(XMRG,"- ","") D
"RTN","YSCLSERV",125,0)
  . I XMRG="**++**DELETEALL**++**" D DELALL Q
"RTN","YSCLSERV",126,0)
  . N ARRAY D LIST^DIC(603.01,,1,,,,$P(XMRG,","),,,,"ARRAY")
"RTN","YSCLSERV",127,0)
  . I '$D(ARRAY("DILIST","ID",1,1)) S YSCLER=" "_$P(XMRG,",")_" is not registered at " D OUT Q
"RTN","YSCLSERV",128,0)
  . ;I '$D(^YSCL(603.01,"B",$P(XMRG,","))) S YSCLER=" "_$P(XMRG,",")_" is not registered at " D OUT Q
"RTN","YSCLSERV",129,0)
  . N ARRAY D LIST^DIC(2,,.09,,,,$P(XMRG,",",2),"SSN",,,"ARRAY")
"RTN","YSCLSERV",130,0)
  . S YSCLDFN=$G(ARRAY("DILIST",2,1)) I YSCLDFN="" S YSCLER=" "_$P(XMRG,",",2)_" is not a valid SSN at " D OUT Q
"RTN","YSCLSERV",131,0)
  . ;S YSCLDFN=$O(^DPT("SSN",$P(XMRG,",",2),"")) I YSCLDFN="" S YSCLER=" "_$P(XMRG,",")_" is not a valid SSN at " D OUT Q
"RTN","YSCLSERV",132,0)
  . K ARRAY D LIST^DIC(603.01,,1,"I",,,YSCLDFN,"C",,,"ARRAY")
"RTN","YSCLSERV",133,0)
  . I '$D(ARRAY("DILIST","ID",1,1)) S YSCLER=" "_$P(XMRG,",",2)_" is not registered at " D OUT Q
"RTN","YSCLSERV",134,0)
  . ;I '$D(^YSCL(603.01,"C",YSCLDFN)) S YSCLER=" "_$P(XMRG,",",2)_" is not registered at " D OUT Q
"RTN","YSCLSERV",135,0)
  . S YSCLA=ARRAY("DILIST",2,1) ;I YSCLA="" S YSCLER=" "_$P(XMRG,",")_" is not a valid entry at " D OUT Q
"RTN","YSCLSERV",136,0)
  . ;K ^YSCL(603.01,YSCLA),^YSCL(603.01,"B",$P(XMRG,","),YSCLA),^YSCL(603.01,"C",YSCLDFN,YSCLA)
"RTN","YSCLSERV",137,0)
  . S DIK="^YSCL(603.01,",DA=YSCLA D ^DIK
"RTN","YSCLSERV",138,0)
  . S YSCLER=" removed at " D OUT
"RTN","YSCLSERV",139,0)
  . ;I $D(^YSCL(603.01,"C",+Y)) K ^YSCL(603.01,YSCLA),^YSCL(603.01,"B",$P(XMRG,","),YSCLA),^YSCL(603.01,"C",YSCLDFN,YSCLA) S YSCLER=" removed at " D OUT Q  ;RLM 9-29-99 ADDED QUIT
"RTN","YSCLSERV",140,0)
 G EXIT
"RTN","YSCLSERV",141,0)
DELALL ;Delete all patients in file 603.01
"RTN","YSCLSERV",142,0)
 N ARRAY,DFN,YSCLA,YSCLREGN
"RTN","YSCLSERV",143,0)
 D LIST^DIC(603.01,,"1;2","I",,,,"C",,,"ARRAY")
"RTN","YSCLSERV",144,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S YSCLA=ARRAY("DILIST",2,I) D:YSCLA
"RTN","YSCLSERV",145,0)
 . S DFN=ARRAY("DILIST",1,I),YSCLREGN=ARRAY("DILIST","ID",I,.01)
"RTN","YSCLSERV",146,0)
 . S YSCLER=YSCLREGN_", "_$$GET1^DIQ(2,DFN,.09)_", ("_ARRAY("DILIST","ID",I,2)_") gdeleted at " D OUT
"RTN","YSCLSERV",147,0)
 . S DIK="^YSCL(603.01,",DA=YSCLA D ^DIK ;K ^YSCL(603.01,YSCLA)
"RTN","YSCLSERV",148,0)
 Q
"RTN","YSCLSERV",149,0)
REPORT ;send report of current registrations to the Clozapine group on Forum
"RTN","YSCLSERV",150,0)
 D REPORT^YSCLSRV2 G EXIT
"RTN","YSCLSERV",151,0)
OUT S YSCLLNT=$G(YSCLLNT)+1,^TMP($J,"YSCLDATA",YSCLLNT)=XMRG_YSCLER_YSCLST Q
"RTN","YSCLSERV",152,0)
 ;Build the text for the return message here.
"RTN","YSCLSERV",153,0)
REBUILD ;
"RTN","YSCLSERV",154,0)
 D REBUILD^YSCLSRV2 G EXIT
"RTN","YSCLSERV",155,0)
UPDATE ;Update record with Monthly, Weekly or Bi-weekly status
"RTN","YSCLSERV",156,0)
 N YSARRAY D LIST^DIC(603.01,,,"I",,,,,,,"YSARRAY")
"RTN","YSCLSERV",157,0)
 F I=1:1 Q:'$D(YSARRAY("DILIST",2,I))  D
"RTN","YSCLSERV",158,0)
 .S YSARRAY(YSARRAY("DILIST",2,I))=YSARRAY("DILIST",1,I)
"RTN","YSCLSERV",159,0)
 .S YSARRAY("B",YSARRAY("DILIST",1,I))=YSARRAY("DILIST",2,I)
"RTN","YSCLSERV",160,0)
 K YSARRAY("DILIST")
"RTN","YSCLSERV",161,0)
 F  X XMREC Q:XMER<0  S XMRG=$TR(XMRG,"- ","") D
"RTN","YSCLSERV",162,0)
  . I XMRG'?2U5N1","9N1","1U S YSCLER=" is in error and was not added at " D OUT Q
"RTN","YSCLSERV",163,0)
  . I $P(XMRG,",")'?2U5N S YSCLER=" is not a valid Clozapine number format " D OUT Q
"RTN","YSCLSERV",164,0)
  . I $P(XMRG,",",2)'?9N S YSCLER=" An SSN must be 9 numbers " D OUT Q
"RTN","YSCLSERV",165,0)
  . I $P(XMRG,",",3)'="B",$P(XMRG,",",3)'="W",$P(XMRG,",",3)'="M" S YSCLER=" You must specify Monthly, Weekly or Biweekly " D OUT Q  ;RLM 06/15/05
"RTN","YSCLSERV",166,0)
  . S YSCLNM=$P(XMRG,","),YSCLSSN=$P(XMRG,",",2),YSCLWB=$P(XMRG,",",3)
"RTN","YSCLSERV",167,0)
  . I '$D(YSARRAY("B",YSCLNM)) S YSCLER=" does not exist at " D OUT Q
"RTN","YSCLSERV",168,0)
  . N ARRAY D LIST^DIC(2,,.09,,,,YSCLSSN,"SSN",,,"ARRAY")
"RTN","YSCLSERV",169,0)
  . S YSCLDA=$G(ARRAY("DILIST",2,1)) I 'YSCLDA S YSCLER=" SSN does not exist at " D OUT Q
"RTN","YSCLSERV",170,0)
  . K ARRAY D LIST^DIC(603.01,,1,"I",,,YSCLDA,"C",,,"ARRAY")
"RTN","YSCLSERV",171,0)
  . S YSCLDA1=$G(ARRAY("DILIST",2,1)) I 'YSCLDA1 S YSCLER=" SSN not in Clozapine file " D OUT Q
"RTN","YSCLSERV",172,0)
  . D
"RTN","YSCLSERV",173,0)
  . . S DIE=603.01,DA=YSCLDA1,DR="2////"_YSCLWB D ^DIE
"RTN","YSCLSERV",174,0)
  . . S YSCLER=" "_YSCLNM_" ("_$$GET1^DIQ(2,YSCLDA,.09)_") updated to "_$S(YSCLWB="M":"Monthly",YSCLWB="W":"Weekly",YSCLWB="B":"Bi-weekly",1:"Unknown")_" at " D OUT ;06/15/05
"RTN","YSCLSERV",175,0)
 G EXIT
"RTN","YSCLSERV",176,0)
RESEND ;Trigger retransmission of Clozapine data
"RTN","YSCLSERV",177,0)
 X XMREC
"RTN","YSCLSERV",178,0)
 I $L(XMRG,"^")<1!($L(XMRG,"^")>2) S YSCLER=" is an invalid date(s), RESEND not triggered at " D OUT G EXIT
"RTN","YSCLSERV",179,0)
 S YSCLSTDT=$P(XMRG,"^",1)
"RTN","YSCLSERV",180,0)
 K %DT S X=YSCLSTDT,%DT="P" D ^%DT I Y=-1 S YSCLER=" is an invalid start date, RESEND not triggered at " D OUT G EXIT
"RTN","YSCLSERV",181,0)
 S X1=Y,X2=-1 D C^%DTC S YSCLSTDT=X
"RTN","YSCLSERV",182,0)
 I $L(XMRG,"^")>1 S YSCLEDDT=$P(XMRG,"^",2) K %DT S X=YSCLEDDT,%DT="P" D ^%DT I Y=-1 S YSCLER=" is an invalid end date, RESEND not triggered at " D OUT G EXIT
"RTN","YSCLSERV",183,0)
 S X1=Y,X2=1 D C^%DTC S YSCLEDDT=X
"RTN","YSCLSERV",184,0)
 I $L(XMRG,"^")=1 S X1=YSCLSTDT,X2=2 D C^%DTC S YSCLEDDT=X
"RTN","YSCLSERV",185,0)
 S X1=YSCLEDDT,X2=YSCLSTDT D ^%DTC I X<0 S YSCLER=" ending date cannot be less than start date, RESEND not triggered at " D OUT G EXIT
"RTN","YSCLSERV",186,0)
 N YSCLREX
"RTN","YSCLSERV",187,0)
 S YSCLREX=1
"RTN","YSCLSERV",188,0)
 S (YSCLTRDT,YSCLSDT)=YSCLSTDT
"RTN","YSCLSERV",189,0)
 D REXMIT^YSCLTST5
"RTN","YSCLSERV",190,0)
 S Y=YSCLSDT X ^DD("DD") S YSCLER=" - Resend triggered (local task #"_$G(ZTSK)_") by "_XMFROM_" for "_Y_" at " D OUT
"RTN","YSCLSERV",191,0)
 G EXIT
"RTN","YSCLSERV",192,0)
DSET ;Set the day of the week for the roll-up to run.
"RTN","YSCLSERV",193,0)
 X XMREC Q:XMER<0  S X=$TR(XMRG,"- ","")
"RTN","YSCLSERV",194,0)
 S YSOFF=$S(X="SUNDAY":0,X="MONDAY":1,X="TUESDAY":2,X="WEDNESDAY":3,X="THURSDAY":4,X="FRIDAY":5,X="SATURDAY":6,1:7)
"RTN","YSCLSERV",195,0)
 I YSOFF>6 S YSCLLNT=$G(YSCLLNT)+1,^TMP($J,"YSCLDATA",YSCLLNT)=X_" isn't a valid day of the week." G EXIT
"RTN","YSCLSERV",196,0)
 S DIE="^YSCL(603.03,",DA=1,DR="2////"_X D ^DIE  ;S $P(^YSCL(603.03,1,0),"^",2)=X
"RTN","YSCLSERV",197,0)
 S YSCLLNT=$G(YSCLLNT)+1,^TMP($J,"YSCLDATA",YSCLLNT)="Run day set to "_X
"RTN","YSCLSERV",198,0)
 G EXIT
"RTN","YSCLSERV",199,0)
 Q
"RTN","YSCLSERV",200,0)
DEBUG ;Turn debug mode on and off.
"RTN","YSCLSERV",201,0)
 I YSCLSUB["DEBUG ON" D
"RTN","YSCLSERV",202,0)
  . S YSCLLNT=$G(YSCLLNT)+1,^TMP($J,"YSCLDATA",YSCLLNT)="Debug Mode is "_$S(YSDEBUG:"already",1:"now")_" ON at "_YSCLSTN
"RTN","YSCLSERV",203,0)
  . S DIE="^YSCL(603.03,",DA=1,DR="3////1" D ^DIE   ;S $P(^YSCL(603.03,1,0),"^",3)=1
"RTN","YSCLSERV",204,0)
 I YSCLSUB["DEBUG OFF" D
"RTN","YSCLSERV",205,0)
  . S YSCLLNT=$G(YSCLLNT)+1,^TMP($J,"YSCLDATA",YSCLLNT)="Debug Mode is "_$S('YSDEBUG:"already",1:"now")_" OFF at "_YSCLSTN
"RTN","YSCLSERV",206,0)
  . S DIE="^YSCL(603.03,",DA=1,DR="3////0" D ^DIE   ;S $P(^YSCL(603.03,1,0),"^",3)=0
"RTN","YSCLSERV",207,0)
 G EXIT
"RTN","YSCLSERV",208,0)
ZEOR ;YSCLSERV
"RTN","YSCLSRV1")
0^7^B2824351
"RTN","YSCLSRV1",1,0)
YSCLSRV1 ;DALOI/RLM-Clozapine data server ; 11/27/18 4:30pm
"RTN","YSCLSRV1",2,0)
 ;;5.01;MENTAL HEALTH;**61,69,74,90,122**;Dec 30, 1994;Build 112
"RTN","YSCLSRV1",3,0)
 ; Reference to ^%ZOSF supported by IA #10096
"RTN","YSCLSRV1",4,0)
 ; Reference to ^XMD supported by IA #10070
"RTN","YSCLSRV1",5,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLSRV1",6,0)
CSUM ;Calculate checksum for routines and transmit errors to Forum
"RTN","YSCLSRV1",7,0)
 S X=$T(+0) X ^%ZOSF("RSUM") S ^TMP("YSCL",$J,2,0)="YSCLSRV1 at "_YSCLST_" = "_Y
"RTN","YSCLSRV1",8,0)
 F YSI=1:1 S YSA=$T(ROU+YSI) Q:YSA["***"  S X=$P($P(YSA,","),";",3) D
"RTN","YSCLSRV1",9,0)
 . X ^%ZOSF("TEST") I '$T S ^TMP("YSCL",$J,YSI+3,0)=X_" is missing." Q
"RTN","YSCLSRV1",10,0)
 . X ^%ZOSF("RSUM") S ^TMP("YSCL",$J,YSI+3,0)=X_" should be "_$P(YSA,",",2)_" is "_Y
"RTN","YSCLSRV1",11,0)
 ;/RBN - Begin modifications for YS*5.01*122
"RTN","YSCLSRV1",12,0)
 K XMY I $$GET1^DIQ(8989.3,1,501,"I") D
"RTN","YSCLSRV1",13,0)
 . I 'YSDEBUG S XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLSRV1",14,0)
 . E  S XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLSRV1",15,0)
 E  D
"RTN","YSCLSRV1",16,0)
 . I 'YSDEBUG S XMY("G.CLOZAPINE ROLL-UP")=""
"RTN","YSCLSRV1",17,0)
 . E  S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLSRV1",18,0)
 ;/RBN - End modifications for YS*5.01*122
"RTN","YSCLSRV1",19,0)
 S XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine Checksum data at "_YSCLST_" run on "_XQDATE
"RTN","YSCLSRV1",20,0)
 S XMTEXT="^TMP(""YSCL"",$J,",XMDUZ="CLOZAPINE MONITOR" D ^XMD
"RTN","YSCLSRV1",21,0)
 K %DT,YSA,YSCLST,YSI,X,XMDUZ,XMSUB,XMTEXT,Y
"RTN","YSCLSRV1",22,0)
 K ^TMP("YSCL",$J)
"RTN","YSCLSRV1",23,0)
 Q
"RTN","YSCLSRV1",24,0)
ROU ;
"RTN","YSCLSRV1",25,0)
 ;;YSCLDIS,62418722
"RTN","YSCLSRV1",26,0)
 ;;YSCLSERV,90753877
"RTN","YSCLSRV1",27,0)
 ;;YSCLSRV2,24723007
"RTN","YSCLSRV1",28,0)
 ;;YSCLSRV3,24872037
"RTN","YSCLSRV1",29,0)
 ;;YSCLTEST,21727247
"RTN","YSCLSRV1",30,0)
 ;;YSCLTST1,11839450
"RTN","YSCLSRV1",31,0)
 ;;YSCLTST2,112458688
"RTN","YSCLSRV1",32,0)
 ;;YSCLTST3,69598047
"RTN","YSCLSRV1",33,0)
 ;;YSCLTST5,129720110
"RTN","YSCLSRV1",34,0)
 ;;YSCLTST6,26876020
"RTN","YSCLSRV1",35,0)
 ;;***
"RTN","YSCLSRV1",36,0)
ZEOR ;YSCLSRV1
"RTN","YSCLTEST")
0^^B21338958
"RTN","YSCLTEST",1,0)
YSCLTEST ;DALOI/LB/RLM-COLLECT RX AND LAB DATA FOR CLOZAPINE ;10 May 2019 16:19:28
"RTN","YSCLTEST",2,0)
 ;;5.01;MENTAL HEALTH;**18,22,26,47,61,69,74,90,122**;Dec 30, 1994;Build 112
"RTN","YSCLTEST",3,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLTEST",4,0)
 ; Reference to ^DIC(5 supported by IA #10056
"RTN","YSCLTEST",5,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLTEST",6,0)
 ; Reference to ^PSDRUG supported by IA #25
"RTN","YSCLTEST",7,0)
 ; Reference to ^PSRX supported by IA #780
"RTN","YSCLTEST",8,0)
 ; Reference to ^XMD supported by IA #10070
"RTN","YSCLTEST",9,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTEST",10,0)
 ; Reference to ^%ZTLOAD supported by DBIA #10063
"RTN","YSCLTEST",11,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTEST",12,0)
 ; Reference to $$SITE^VASITE supported by DBIA #10112
"RTN","YSCLTEST",13,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLTEST",14,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLTEST",15,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","YSCLTEST",16,0)
 ;
"RTN","YSCLTEST",17,0)
BKGRD ;Normal entry for weekly background job - dates from T-10 to T-3
"RTN","YSCLTEST",18,0)
 Q  ; << NCC REMEDIATION - THIS ENTRY POINT IS NOLONGER USED *122/RJS
"RTN","YSCLTEST",19,0)
 S X=DT D DW^%DTC Q:X'=$$GET1^DIQ(603.03,1,2)  ;Make the day to run a parameter settable by the server.
"RTN","YSCLTEST",20,0)
 S YSOFF=$S(X="SUNDAY":0,X="MONDAY":1,X="TUESDAY":2,X="WEDNESDAY":3,X="THURSDAY":4,X="FRIDAY":5,X="SATURDAY":6,1:7) Q:YSOFF>6
"RTN","YSCLTEST",21,0)
 S X="T-"_YSOFF D ^%DT S YSCLED=Y,YSCLRET=""
"RTN","YSCLTEST",22,0)
 ;S YSCL=$H#7-2 S:YSCL<1 YSCL=YSCL+7 S X="T-"_(YSCL+7) D ^%DT S YSCLED=Y,YSCLRET="" K YSCL ;Make sure it's a Sunday ending date.
"RTN","YSCLTEST",23,0)
RUN ; entry from above for normal or below for requeue
"RTN","YSCLTEST",24,0)
 Q  ; << NCC REMEDIATION - THIS ENTRY POINT IS NOLONGER USED *122/RJS
"RTN","YSCLTEST",25,0)
 S YSDEBUG=$P(^YSCL(603.03,1,0),"^",3)
"RTN","YSCLTEST",26,0)
 ;I $G(^YSCL(603.02,1,0))'?1.N1"^"1.N G FLERR^YSCLTST3 ;Check for entry in file 603.02, report an error if either entry is missing.
"RTN","YSCLTEST",27,0)
 D DMG^YSCLTST3
"RTN","YSCLTEST",28,0)
 S YSCLSITE=$P($$SITE^VASITE,"^",2)
"RTN","YSCLTEST",29,0)
 K XMY
"RTN","YSCLTEST",30,0)
 S XMY("G.CLOZAPINE ROLL-UP")=""
"RTN","YSCLTEST",31,0)
 I YSDEBUG K XMY S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLTEST",32,0)
 S %DT="T",X="NOW" D ^%DT S YSCLNOW=$P(Y,".",2)
"RTN","YSCLTEST",33,0)
 S XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine lab data started at "_YSCLSITE_" on "_DT_" at "_YSCLNOW,^TMP("YSCL",$J,1,0)=" ",^TMP("YSCL",$J,2,0)="+++ Clozapine data collection started at "_YSCLSITE_" on "_DT_" +++",^TMP("YSCL",$J,3,0)=" "
"RTN","YSCLTEST",34,0)
 S XMTEXT="^TMP(""YSCL"",$J,",XMDUZ="Clozapine MONITOR" D ^XMD
"RTN","YSCLTEST",35,0)
 S $P(^YSCL(603.03,1,0),"^",4)=$$NOW^XLFDT
"RTN","YSCLTEST",36,0)
 ;send MM message when routine started.
"RTN","YSCLTEST",37,0)
 S YSCLLN=0,YSCLLLN=3,X1=$P(YSCLED,"."),X2=-60 D C^%DTC S YSCLM28=X,X1=$P(YSCLED,"."),X2=-28 D C^%DTC S YSCLM7=X,YSCLED=YSCLED+.5 ;28 TO 60 and 14 to 28 6/15/05
"RTN","YSCLTEST",38,0)
 S X1=$P(YSCLED,"."),X2=-180 D C^%DTC S YSCLM180=X
"RTN","YSCLTEST",39,0)
 S X1=$P(YSCLED,"."),X2=-56 D C^%DTC S YSCLM56=X
"RTN","YSCLTEST",40,0)
 S YSCLIF=+$$SITE^VASITE_","
"RTN","YSCLTEST",41,0)
 D GETS^DIQ(4,YSCLIF,"1.01;1.02;1.03;.02;1.04","I","YSCLFF")
"RTN","YSCLTEST",42,0)
 S $P(YSCLDEMO,"^",1)=YSCLFF(4,YSCLIF,1.01,"I")
"RTN","YSCLTEST",43,0)
 S $P(YSCLDEMO,"^",2)=YSCLFF(4,YSCLIF,1.02,"I")
"RTN","YSCLTEST",44,0)
 S $P(YSCLDEMO,"^",3)=YSCLFF(4,YSCLIF,1.03,"I")
"RTN","YSCLTEST",45,0)
 S $P(YSCLDEMO,"^",4)=$P(^DIC(5,YSCLFF(4,YSCLIF,.02,"I"),0),"^",2)
"RTN","YSCLTEST",46,0)
 S $P(YSCLDEMO,"^",5)=YSCLFF(4,YSCLIF,1.04,"I")
"RTN","YSCLTEST",47,0)
 S $P(YSCLDEMO,"^",6)=""
"RTN","YSCLTEST",48,0)
 K J,YSCLF,YSCLFF,YSCLIF,X
"RTN","YSCLTEST",49,0)
 ;YSCLDEMO=street1^street2^city^state(2 letter)^ZIP^phone
"RTN","YSCLTEST",50,0)
 K ^TMP($J),^TMP("YSCL",$J) S (DFN,YSCLIEN)=0
"RTN","YSCLTEST",51,0)
 F  K YSCLA S YSCLIEN=$O(^YSCL(603.01,YSCLIEN)),YSCLLD=0 Q:'YSCLIEN  S DFN=$P($G(^YSCL(603.01,YSCLIEN,0)),"^",2) S $P(YSSTOP,",",1)=1 Q:$$S^%ZTLOAD  D:DFN
"RTN","YSCLTEST",52,0)
  . I $D(^DPT(DFN,0)),$D(^YSCL(603.01,YSCLIEN,0)) S YSCLSAND=$P($G(^YSCL(603.01,YSCLIEN,0)),"^",2),YSCL=^DPT(DFN,0),YSCLX=$E($P($P(YSCL,"^"),",",2))_$E(YSCL)_"^"_$P(YSCL,"^",9) D
"RTN","YSCLTEST",53,0)
  . . S YSCLLAB="" D GET I YSCLLAB]"" D CHECK^YSCLTST1 I YSCLT D LOAD^YSCLTST1
"RTN","YSCLTEST",54,0)
 G TRANSMIT^YSCLTST2
"RTN","YSCLTEST",55,0)
GET ;prescriptions
"RTN","YSCLTEST",56,0)
 Q:$$S^%ZTLOAD
"RTN","YSCLTEST",57,0)
 N YSARRAY D LIST^DIC(55.03,","_DFN_",",,"I",,,,,,,"YSARRAY")
"RTN","YSCLTEST",58,0)
 S YSCLPHY="",$P(YSCLX,"^",6)=$P(YSCLDEMO,"^",5),$P(YSCLX,"^",11)=$$GET1^DIQ(603.01,YSCLIEN,.01),$P(YSCLX,"^",16)=DT
"RTN","YSCLTEST",59,0)
 ;site zip(p6),registration number (p11), today (p16)
"RTN","YSCLTEST",60,0)
 F YSCL=1:1 Q:'$D(YSARRAY("DILIST",1,YSCL))  S YSCL1=YSARRAY("DILIST",1,YSCL) D
"RTN","YSCLTEST",61,0)
 . D ACTIVE Q:YSACT'=0  S YSDRG=$$GET1^DIQ(52,YSCL1,6,"I") Q:$$GET1^DIQ(50,YSDRG,17.5)'="PSOCLO1"
"RTN","YSCLTEST",62,0)
 . N YSARRAY1 D LIST^DIC(50.02,","_YSDRG_",",3,"I",,,,,,,"YSARRAY1")
"RTN","YSCLTEST",63,0)
 . F YSCL2=1:1 Q:'$D(YSARRAY1("DILIST","ID",YSCL2))  I $G(YSARRAY1("DILIST","ID",YSCL2,3))=1 D  Q
"RTN","YSCLTEST",64,0)
 . . S YSCLID=$$GET1^DIQ(52,YSCL1,1,"I") S:YSCLID>$G(YSCLLD) YSCLLD=YSCLID
"RTN","YSCLTEST",65,0)
 . . I YSCLID'>DT,YSCLID'<$G(YSCLM28) S YSCLA(-YSCLID,-YSCL1)="" ;Changed YSCLED to DT  RLM
"RTN","YSCLTEST",66,0)
 Q
"RTN","YSCLTEST",67,0)
ACTIVE ;Test for Active prescriptions
"RTN","YSCLTEST",68,0)
 S YSACT=$$GET1^DIQ(52,YSCL1,100,"I")
"RTN","YSCLTEST",69,0)
 Q
"RTN","YSCLTEST",70,0)
REXMIT ;Resend Clozapine data
"RTN","YSCLTEST",71,0)
 S X1=YSCLED,X2=-3 D C^%DTC S YSCLED=X,YSCLRET=1,ZTREQ="@" G RUN
"RTN","YSCLTEST",72,0)
 Q
"RTN","YSCLTEST",73,0)
ABORT ;
"RTN","YSCLTEST",74,0)
 K XMY
"RTN","YSCLTEST",75,0)
 S XMY("G.CLOZAPINE ROLL-UP@")=""
"RTN","YSCLTEST",76,0)
 I YSDEBUG K XMY S XMY("G.CLOZAPINE DEBUG@")=""
"RTN","YSCLTEST",77,0)
 S %DT="T",X="NOW" D ^%DT S YSCLNOW=$P(Y,".",2)
"RTN","YSCLTEST",78,0)
 S YSCLSITE=$P($$SITE^VASITE,"^",2)
"RTN","YSCLTEST",79,0)
 S XMSUB="Clozapine Roll-Up aborted ["_$G(YSSTOP)_"] at "_YSCLSITE_" on "_DT
"RTN","YSCLTEST",80,0)
 S YSTEXT(1,0)=" "
"RTN","YSCLTEST",81,0)
 S YSTEXT(2,0)=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine Roll-Up aborted ["_$G(YSSTOP)_"] at "_YSCLSITE_" on "_DT_" at "_YSCLNOW,^TMP("YSCL",$J,1,0)=" "
"RTN","YSCLTEST",82,0)
 S XMTEXT="YSTEXT(",XMDUZ="Clozapine MONITOR" D ^XMD
"RTN","YSCLTEST",83,0)
 S ZTSTOP=1 Q
"RTN","YSCLTEST",84,0)
ZEOR ;YSCLTEST
"RTN","YSCLTST2")
0^1^B118550569
"RTN","YSCLTST2",1,0)
YSCLTST2 ;DALOI/LB/RLM-TRANSMIT RX AND lAB DATA FOR CLOZAPINE ; 11/28/18 3:34am
"RTN","YSCLTST2",2,0)
 ;;5.01;MENTAL HEALTH;**18,22,26,47,61,69,74,90,92,122**;Dec 30, 1994;Build 112
"RTN","YSCLTST2",3,0)
 ; Reference to ^LAB(60 supported by IA #333
"RTN","YSCLTST2",4,0)
 ; Reference to ^PSDRUG supported by IA #25
"RTN","YSCLTST2",5,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLTST2",6,0)
 ; Reference to ^XMD supported by IA #10070
"RTN","YSCLTST2",7,0)
 ; Reference to ^LR7OR1 supported by IA #2503
"RTN","YSCLTST2",8,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTST2",9,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLTST2",10,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTST2",11,0)
 ; Reference to ^DIR supported by DBIA #10026
"RTN","YSCLTST2",12,0)
 ; Reference to $$SITE^VASITE supported by DBIA #10112
"RTN","YSCLTST2",13,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLTST2",14,0)
 ; Reference to MIX^DIC1 supported by DBIA #10007
"RTN","YSCLTST2",15,0)
 ; Reference to ^%ZTLOAD supported by DBIA #10063
"RTN","YSCLTST2",16,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLTST2",17,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","YSCLTST2",18,0)
 ; 
"RTN","YSCLTST2",19,0)
TRANSMIT ; send remote and local, kill and quit
"RTN","YSCLTST2",20,0)
 K XMZ S %DT="T",X="NOW" D ^%DT S YSCLNOW=$P(Y,".",2),YSCLSITE=$P($$SITE^VASITE,"^",2)
"RTN","YSCLTST2",21,0)
 S $P(YSSTOP,",",7)=7 I $$S^%ZTLOAD D ABORT^YSCLTEST G END
"RTN","YSCLTST2",22,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I"),YSPROD=$$GET1^DIQ(8989.3,1,501,"I")
"RTN","YSCLTST2",23,0)
 S YSPRODST=$$GET1^DIQ(603.03,1,8) ;S:YSPRODST="" YSPRODST="S.RUCLRXLAB@FO-HINES.DOMAIN.EXT"
"RTN","YSCLTST2",24,0)
 S YSDBGST=$$GET1^DIQ(603.03,1,10) ;S:YSDBGST="" YSDBGST="G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT"
"RTN","YSCLTST2",25,0)
 ;/RBN - Begin modifications for YS*5.01*122
"RTN","YSCLTST2",26,0)
 I $G(YSCLLN) D
"RTN","YSCLTST2",27,0)
 .K XMY
"RTN","YSCLTST2",28,0)
 .I YSPROD D
"RTN","YSCLTST2",29,0)
 ..I 'YSDEBUG S XMY(YSPRODST)="" ;XMY("G.CLOZAPINE ROLL-UP")="" ;,
"RTN","YSCLTST2",30,0)
 ..E  S XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")="",XMY("G.RUCLRXLAB@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLTST2",31,0)
 .E  D
"RTN","YSCLTST2",32,0)
 ..I 'YSDEBUG S XMY(YSDBGST)=""
"RTN","YSCLTST2",33,0)
 ..E  S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLTST2",34,0)
 .S XMDUZ="Clozapine MONITOR",XMTEXT="^TMP($J,",XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine lab data @ "_YSCLSITE_" on "_DT_" at "_YSCLNOW D ^XMD
"RTN","YSCLTST2",35,0)
 K XMY
"RTN","YSCLTST2",36,0)
 S ^TMP("YSCL",$J,2,0)=" ",^TMP("YSCL",$J,3,0)="In message # "_$S($D(XMZ):XMZ,1:"no data sent")
"RTN","YSCLTST2",37,0)
 I 'YSDEBUG S XMY("G.PSOCLOZ")="" S:YSPROD XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLTST2",38,0)
 E  S XMY("G.CLOZAPINE DEBUG")="" S:YSPROD XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLTST2",39,0)
 S XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine lab data @ "_YSCLSITE_" on "_DT_" at "_YSCLNOW
"RTN","YSCLTST2",40,0)
 K XMZ S ^TMP("YSCL",$J,1,0)="Clozapine lab data was transmitted, "_YSCLLN_" records were sent",XMTEXT="^TMP(""YSCL"",$J," D ^XMD
"RTN","YSCLTST2",41,0)
 S DIE="^YSCL(603.03,",DA=1,DR="5////"_$$NOW^XLFDT D ^DIE  ;S $P(^YSCL(603.03,1,0),"^",5)=$$NOW^XLFDT
"RTN","YSCLTST2",42,0)
 ;/RBN - End modifications for YS*5.01*122
"RTN","YSCLTST2",43,0)
END ;
"RTN","YSCLTST2",44,0)
 G END1^YSCLTST3
"RTN","YSCLTST2",45,0)
 Q
"RTN","YSCLTST2",46,0)
 ;
"RTN","YSCLTST2",47,0)
REXMIT ; retransmit lab and RX data
"RTN","YSCLTST2",48,0)
 ; must be a tuesday
"RTN","YSCLTST2",49,0)
 S DIR(0)="Y",DIR("A")="Are you sure you wish to retransmit lab data"
"RTN","YSCLTST2",50,0)
 D ^DIR K DIR I Y'=1 K Y Q
"RTN","YSCLTST2",51,0)
 ;/RBN Begin modification for YS*122
"RTN","YSCLTST2",52,0)
 D REX^YSCLTST5
"RTN","YSCLTST2",53,0)
 ;/RBN End modification for YS*122
"RTN","YSCLTST2",54,0)
 Q
"RTN","YSCLTST2",55,0)
 ;
"RTN","YSCLTST2",56,0)
DATE S %DT="AEXP",%DT(0)=-DT,%DT("A")="Ending date for data collection."
"RTN","YSCLTST2",57,0)
 D ^%DT K %DT G END:X="^",END:X="^" I Y=-1 G DATE
"RTN","YSCLTST2",58,0)
 ;/RBN Begin modifications for *122
"RTN","YSCLTST2",59,0)
 S ZTDESC="Server triggered retransmission"
"RTN","YSCLTST2",60,0)
 S ZTSAVE("YSCLED")="",ZTIO="",ZTRTN="REXMIT^YSCLTST5",ZTDTH=$H
"RTN","YSCLTST2",61,0)
 D REXMIT^YSCLTST5 G END
"RTN","YSCLTST2",62,0)
 ;/RBN End modifications for *122
"RTN","YSCLTST2",63,0)
FLSET ;Set up file 603.02
"RTN","YSCLTST2",64,0)
 W @IOF,"This option specifies the blood tests associated with the Clozapine"
"RTN","YSCLTST2",65,0)
 W !,"reporting software.  Two tests must be defined.  The first is the White"
"RTN","YSCLTST2",66,0)
 W !,"Blood Count.  The second is the Granulocyte (or Neutrophil) percentage."
"RTN","YSCLTST2",67,0)
 K DIR W !! S DIR(0)="PA^64:EMZ",DIR("A",1)="Enter the test that will be used to record the White Blood Count for the",DIR("A")="Clozapine patients: " D ^DIR
"RTN","YSCLTST2",68,0)
 Q:Y=-1!($D(DUOUT))!($D(DTOUT))!($D(DIRUT))!($D(DIROUT))
"RTN","YSCLTST2",69,0)
 S YSCLWBC=+Y
"RTN","YSCLTST2",70,0)
 K DIR W !! S DIR(0)="PA^64:EMZ",DIR("A",1)="Enter the test that will be used to record the Neutrophil Count (percentage)",DIR("A")=" for the Clozapine patients: " D ^DIR
"RTN","YSCLTST2",71,0)
 Q:Y=-1!($D(DUOUT))!($D(DTOUT))!($D(DIRUT))!($D(DIROUT))
"RTN","YSCLTST2",72,0)
 S YSCLGRN=+Y
"RTN","YSCLTST2",73,0)
 I YSCLWBC,YSCLGRN D
"RTN","YSCLTST2",74,0)
 .K DD S DIC="^YSCL(603.02,",X=YSCLWBC,DIC("DR")="1////"_YSCLGRN K DO D FILE^DICN
"RTN","YSCLTST2",75,0)
 ;Only one entry is allowed.
"RTN","YSCLTST2",76,0)
 K DIR,X,Y,YSCLWBC,YSCLGRN,ZTDESC
"RTN","YSCLTST2",77,0)
 Q
"RTN","YSCLTST2",78,0)
EN(DRG) ;
"RTN","YSCLTST2",79,0)
 K LAB
"RTN","YSCLTST2",80,0)
 I $$GET1^DIQ(50,DRG,17.5)'="PSOCLO1" S LAB("NOT")=0 Q
"RTN","YSCLTST2",81,0)
 N YSARRAY D LIST^DIC(50.02,","_YSDRG_",",3,"I",,,,,,,"YSARRAY")
"RTN","YSCLTST2",82,0)
 S (CNT,I)=0 F  S I=$O(YSARRAY("DILIST",2,I)) Q:'I  S CNT=$G(CNT)+1
"RTN","YSCLTST2",83,0)
 I CNT'=2 S LAB("BAD TEST")=0 K CNT Q
"RTN","YSCLTST2",84,0)
 K CNT F I=1:1 Q:'$D(YSARRAY("DILIST","ID",I))  D
"RTN","YSCLTST2",85,0)
 .S LABT=$S(YSARRAY("DILIST","ID",I,3)=1:"WBC",1:"ANC"),YSLN=YSARRAY("DILIST",2,I)
"RTN","YSCLTST2",86,0)
 .S LAB(LABT)=$$GET1^DIQ(50.02,YSLN_","_DRG,.01,"I")_"^"_$$GET1^DIQ(50.02,YSLN_","_DRG,2,"I")_"^"_$$GET1^DIQ(50.02,YSLN_","_DRG,3,"I")
"RTN","YSCLTST2",87,0)
 K LABT,I
"RTN","YSCLTST2",88,0)
 Q
"RTN","YSCLTST2",89,0)
CL1(DFN,DAYS) ;The routine was split due to size
"RTN","YSCLTST2",90,0)
 G CL1^YSCLTST4
"RTN","YSCLTST2",91,0)
 Q
"RTN","YSCLTST2",92,0)
 ;
"RTN","YSCLTST2",93,0)
CL(DFN) ; patient must be in both file #55 and #603.01 to get lab results
"RTN","YSCLTST2",94,0)
 K ^TMP("LRRR",$J) N RESULTS,YSCLYWBC,YSCLRANC,YSCLYANC,YSCLXANC,YSCLXWBC,YSCLRWBC,YSCLFRQ,YSCLIEN
"RTN","YSCLTST2",95,0)
 I 'DFN Q "-1^-1^-1^-1^-1^-1^-1"
"RTN","YSCLTST2",96,0)
 N ARRAY D LIST^DIC(603.01,,1,"I",,,DFN,"C",,,"ARRAY")
"RTN","YSCLTST2",97,0)
 I '$D(ARRAY("DILIST","ID")) Q "-1^-1^-1^-1^-1^-1^-1"
"RTN","YSCLTST2",98,0)
 S YSCLIEN=ARRAY("DILIST",2,1),YSCLFRQ="" ;$O(^YSCL(603.01,"C",DFN,"")),YSCLFRQ=""
"RTN","YSCLTST2",99,0)
 I YSCLIEN S YSCLFRQ=$$GET1^DIQ(603.01,YSCLIEN,2,"I")
"RTN","YSCLTST2",100,0)
 I $$GET1^DIQ(603.03,1,7,"I")=1!(YSCLFRQ="")  Q "-1^0^0^0^0^0^"_YSCLFRQ
"RTN","YSCLTST2",101,0)
 I $$GET1^DIQ(55,DFN,54,"I")'="A"  Q "-1^0^0^0^0^0^"_YSCLFRQ
"RTN","YSCLTST2",102,0)
 S X1=DT,X2="-7" D C^%DTC S YSCLSD=X
"RTN","YSCLTST2",103,0)
 K ARRAY D LIST^DIC(603.41,",1,",,"I",,,,,,,"ARRAY")
"RTN","YSCLTST2",104,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S YSCLA=ARRAY("DILIST",2,I) D
"RTN","YSCLTST2",105,0)
 . N YSCLTNM,YSCLTTP,YSCLTFR S YSCLTNM=$$GET1^DIQ(603.41,YSCLA_",1,",.01,"I")
"RTN","YSCLTST2",106,0)
 . S YSCLTTP=$$GET1^DIQ(603.41,YSCLA_",1,",1,"I")
"RTN","YSCLTST2",107,0)
 . S YSCLTFR=$$GET1^DIQ(603.41,YSCLA_",1,",2,"I")
"RTN","YSCLTST2",108,0)
 . S YSCLTLS(YSCLTTP,YSCLTNM)=YSCLTFR
"RTN","YSCLTST2",109,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",1,I))  S YSCLTL=ARRAY("DILIST",1,I) D
"RTN","YSCLTST2",110,0)
 . D RR^LR7OR1(DFN,,YSCLSD,DT,,YSCLTL,"L")
"RTN","YSCLTST2",111,0)
 . S YSCLSB1="" F  S YSCLSB1=$O(^TMP("LRRR",$J,DFN,YSCLSB1)) Q:YSCLSB1=""  D
"RTN","YSCLTST2",112,0)
 . . S YSCLTDT="" F  S YSCLTDT=$O(^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT)) Q:YSCLTDT=""  I $P(YSCLTDT,".",2)]"" D
"RTN","YSCLTST2",113,0)
 . . . S YSCLTA="" F  S YSCLTA=$O(^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT,YSCLTA)) Q:YSCLTA=""  I YSCLTA D
"RTN","YSCLTST2",114,0)
 . . . . S RESULTS1=^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT,YSCLTA)
"RTN","YSCLTST2",115,0)
 . . . . S RESULTS(YSCLTL,YSCLTDT)=$P(RESULTS1,"^",2)
"RTN","YSCLTST2",116,0)
 ;Find all entries for WBC and sort by inverse date.
"RTN","YSCLTST2",117,0)
 S YSCLA="" F  S YSCLA=$O(YSCLTLS("W",YSCLA)) Q:'YSCLA  S YSCLXWBC(YSCLA)="" D
"RTN","YSCLTST2",118,0)
  . S YSCLA1="" F  S YSCLA1=$O(RESULTS(YSCLA,YSCLA1)) Q:'YSCLA1  S YSCLYWBC(YSCLA1)=RESULTS(YSCLA,YSCLA1)_"^"_$$GET1^DIQ(60,YSCLA,.01)_"^"_YSCLTLS("W",YSCLA)
"RTN","YSCLTST2",119,0)
 I '$D(YSCLYWBC) G ALTANC
"RTN","YSCLTST2",120,0)
 I $D(YSCLXWBC),$D(YSCLYWBC) D
"RTN","YSCLTST2",121,0)
 .S YSCLRWBC=$O(YSCLYWBC(0)) I 'YSCLRWBC ;D KILL Q "0^^^^^^"_YSCLFRQ
"RTN","YSCLTST2",122,0)
 .S YSCLMULT=$P(YSCLYWBC(YSCLRWBC),"^",3),YSCLMULT=$S(YSCLMULT:1000,1:1)
"RTN","YSCLTST2",123,0)
 .S YSCLRWBC(YSCLRWBC)=($P(YSCLYWBC(YSCLRWBC),"^")*YSCLMULT)_"^"_$P(YSCLYWBC(YSCLRWBC),"^",2)
"RTN","YSCLTST2",124,0)
 .;Scan for Neutrophil count on same day and time as most recent WBC
"RTN","YSCLTST2",125,0)
 .S YSCLMTCH=0 F YSCLA="A","N","S","T" S YSCLTPT="" Q:YSCLMTCH  F  S YSCLTPT=$O(YSCLTLS(YSCLA,YSCLTPT)) Q:'YSCLTPT  D  Q:YSCLMTCH
"RTN","YSCLTST2",126,0)
 ..S YSCLMULT=YSCLTLS(YSCLA,YSCLTPT),YSCLMULT=$S(YSCLMULT:1000,1:1)
"RTN","YSCLTST2",127,0)
  ..I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="A",RESULTS(YSCLTPT,YSCLRWBC)'?1A.E S YSCLMTCH=1,YSCLRANC(YSCLRWBC)=RESULTS(YSCLTPT,YSCLRWBC)*YSCLMULT_"^"_$$GET1^DIQ(60,YSCLTPT,.01) Q
"RTN","YSCLTST2",128,0)
  ..I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="N",RESULTS(YSCLTPT,YSCLRWBC)'?1A.E S YSCLMTCH=1,YSCLRANC(YSCLRWBC)=YSCLRWBC(YSCLRWBC)*((RESULTS(YSCLTPT,YSCLRWBC))*.01)_"^"_$$GET1^DIQ(60,YSCLTPT,.01) Q
"RTN","YSCLTST2",129,0)
  ..I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="S",RESULTS(YSCLTPT,YSCLRWBC)'?1A.E D
"RTN","YSCLTST2",130,0)
  ...S YSCLSGS="" F  S YSCLSGS=$O(YSCLTLS("B",YSCLSGS)) D  Q:YSCLMTCH!'YSCLSGS
"RTN","YSCLTST2",131,0)
  ....S:'YSCLSGS YSCLSGS="Z" I '$D(RESULTS(YSCLSGS,YSCLRWBC)) S RESULTS(YSCLSGS,YSCLRWBC)=0
"RTN","YSCLTST2",132,0)
  ....S YSCLMTCH=1,YSCLRANC(YSCLRWBC)=YSCLRWBC(YSCLRWBC)*((RESULTS(YSCLTPT,YSCLRWBC)*.01)+(RESULTS(YSCLSGS,YSCLRWBC)*.01))_"^"_$$GET1^DIQ(60,YSCLTPT,.01)_"/"_$$GET1^DIQ(60,YSCLSGS,.01) Q
"RTN","YSCLTST2",133,0)
  ..I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="C",RESULTS(YSCLTPT,YSCLRWBC)'?1A.E D
"RTN","YSCLTST2",134,0)
  ...S YSCLSGS="" F  S YSCLSGS=$O(YSCLTLS("T",YSCLSGS)) D  Q:YSCLMTCH!'YSCLSGS
"RTN","YSCLTST2",135,0)
  ....S:'YSCLSGS YSCLSGS="Z" I '$D(RESULTS(YSCLSGS,YSCLRWBC)) S RESULTS(YSCLSGS,YSCLRWBC)=0
"RTN","YSCLTST2",136,0)
  ....S YSCLMTCH=1,YSCLRANC(YSCLRWBC)=((RESULTS(YSCLTPT,YSCLRWBC)*YSCLMULT)+(RESULTS(YSCLSGS,YSCLRWBC)*YSCLMULT))_"^"_$P(^LAB(60,YSCLTPT,0),"^")_"/"_$P($G(^LAB(60,YSCLSGS,0)),"^") Q
"RTN","YSCLTST2",137,0)
 D KILL
"RTN","YSCLTST2",138,0)
 I '$G(YSCLRWBC(YSCLRWBC)),'+$G(YSCLRANC(YSCLRWBC)) Q "0^^^^^^"_YSCLFRQ
"RTN","YSCLTST2",139,0)
 I $G(YSCLRWBC(YSCLRWBC)),+$G(YSCLRANC(YSCLRWBC))<1000 Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",140,0)
 I '$G(YSCLRWBC(YSCLRWBC)),+$G(YSCLRANC(YSCLRWBC))<1000 Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",141,0)
 I '$G(YSCLRWBC(YSCLRWBC)),+$G(YSCLRANC(YSCLRWBC)) Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",142,0)
 I $G(YSCLRWBC(YSCLRWBC)),+$G(YSCLRANC(YSCLRWBC))<1500 Q "2^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",143,0)
 ;;END NCC REMEDIATION << RJS*122
"RTN","YSCLTST2",144,0)
 Q "1^"_YSCLRWBC(YSCLRWBC)_"^"_YSCLRANC(YSCLRWBC)_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",145,0)
 ;
"RTN","YSCLTST2",146,0)
 ;;START NCC REMEDIATION >> RJS*122
"RTN","YSCLTST2",147,0)
ALTANC ;
"RTN","YSCLTST2",148,0)
 S YSCLA=0 F  S YSCLA=$O(YSCLTLS("A",YSCLA)) Q:'YSCLA  S YSCLXANC(YSCLA)="" D
"RTN","YSCLTST2",149,0)
 .S YSCLA1=0 F  S YSCLA1=$O(RESULTS(YSCLA,YSCLA1)) Q:'YSCLA1  S YSCLYANC(YSCLA1)=RESULTS(YSCLA,YSCLA1)_"^"_$$GET1^DIQ(60,YSCLA,.01)_"^"_YSCLTLS("A",YSCLA)
"RTN","YSCLTST2",150,0)
 I $D(YSCLYANC) D
"RTN","YSCLTST2",151,0)
 .S (YSCLRANC,YSCLRWBC)=$O(YSCLYANC(0)) I 'YSCLRANC ;D KILL Q "0^^^^^^"_YSCLFRQ
"RTN","YSCLTST2",152,0)
 .S YSCLMULT=$P(YSCLYANC(YSCLRANC),"^",3),YSCLMULT=$S(YSCLMULT:1000,1:1)
"RTN","YSCLTST2",153,0)
 .S YSCLRANC(YSCLRANC)=($P(YSCLYANC(YSCLRANC),"^")*YSCLMULT)_"^"_$P(YSCLYANC(YSCLRANC),"^",2)
"RTN","YSCLTST2",154,0)
 .;Scan for Neutrophil count on same day and time as most recent ANC
"RTN","YSCLTST2",155,0)
 .S YSCLMTCH=0 F YSCLA="A","N","S","T" S YSCLTPT="" Q:YSCLMTCH  F  S YSCLTPT=$O(YSCLTLS(YSCLA,YSCLTPT)) Q:'YSCLTPT  D  Q:YSCLMTCH
"RTN","YSCLTST2",156,0)
 ..S YSCLMULT=YSCLTLS(YSCLA,YSCLTPT),YSCLMULT=$S(YSCLMULT:1000,1:1)
"RTN","YSCLTST2",157,0)
 ..I $D(RESULTS(YSCLTPT,YSCLRANC)),YSCLA="A",RESULTS(YSCLTPT,YSCLRANC)'?1A.E S YSCLMTCH=1,YSCLRANC(YSCLRANC)=RESULTS(YSCLTPT,YSCLRANC)*YSCLMULT_"^"_$$GET1^DIQ(60,YSCLTPT,.01) Q
"RTN","YSCLTST2",158,0)
 ..I $D(RESULTS(YSCLTPT,YSCLRANC)),YSCLA="N",RESULTS(YSCLTPT,YSCLRANC)'?1A.E S YSCLMTCH=1,YSCLRANC(YSCLRANC)=YSCLRANC(YSCLRANC)*((RESULTS(YSCLTPT,YSCLRANC))*.01)_"^"_$$GET1^DIQ(60,YSCLTPT,.01) Q
"RTN","YSCLTST2",159,0)
 ..I $D(RESULTS(YSCLTPT,YSCLRANC)),YSCLA="S",RESULTS(YSCLTPT,YSCLRANC)'?1A.E D
"RTN","YSCLTST2",160,0)
 ...S YSCLSGS="" F  S YSCLSGS=$O(YSCLTLS("B",YSCLSGS)) D  Q:YSCLMTCH
"RTN","YSCLTST2",161,0)
 ....S:'YSCLSGS YSCLSGS="Z" I '$D(RESULTS(YSCLSGS,YSCLRANC)) S RESULTS(YSCLSGS,YSCLRANC)=0
"RTN","YSCLTST2",162,0)
 ....S YSCLMTCH=1,YSCLRANC(YSCLRANC)=YSCLRANC(YSCLRANC)*((RESULTS(YSCLTPT,YSCLRANC)*.01)+(RESULTS(YSCLSGS,YSCLRANC)*.01))_"^"_$$GET1^DIQ(60,YSCLTPT,.01)_"/"_$$GET1^DIQ(60,YSCLSGS,.01) Q
"RTN","YSCLTST2",163,0)
 ..I $D(RESULTS(YSCLTPT,YSCLRANC)),YSCLA="C",RESULTS(YSCLTPT,YSCLRANC)'?1A.E D
"RTN","YSCLTST2",164,0)
 ...S YSCLSGS="" F  S YSCLSGS=$O(YSCLTLS("T",YSCLSGS)) D  Q:YSCLMTCH
"RTN","YSCLTST2",165,0)
 ....S:'YSCLSGS YSCLSGS="Z" I '$D(RESULTS(YSCLSGS,YSCLRANC)) S RESULTS(YSCLSGS,YSCLRANC)=0
"RTN","YSCLTST2",166,0)
 ....S YSCLMTCH=1,YSCLRANC(YSCLRANC)=((RESULTS(YSCLTPT,YSCLRANC)*YSCLMULT)+(RESULTS(YSCLSGS,YSCLRANC)*YSCLMULT))_"^"_$P(^LAB(60,YSCLTPT,0),"^")_"/"_$P($G(^LAB(60,YSCLSGS,0)),"^") Q
"RTN","YSCLTST2",167,0)
 .S YSCLRWBC(YSCLRWBC)="^WBC"
"RTN","YSCLTST2",168,0)
 D KILL
"RTN","YSCLTST2",169,0)
 I '$G(YSCLRANC(+$G(YSCLRWBC))) Q "0^^^^^^"_YSCLFRQ
"RTN","YSCLTST2",170,0)
 I +$G(YSCLRANC(YSCLRWBC))<1000 Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",171,0)
 I +$G(YSCLRANC(YSCLRWBC))<1500 Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",172,0)
 Q "0^"_$G(YSCLRWBC(YSCLRWBC))_"^"_$S($G(YSCLRANC(YSCLRWBC))="":"^",1:$G(YSCLRANC(YSCLRWBC)))_"^"_(9999999-YSCLRWBC)_"^"_YSCLFRQ
"RTN","YSCLTST2",173,0)
 ;;END NCC REMEDIATION << RJS*122
"RTN","YSCLTST2",174,0)
 ;
"RTN","YSCLTST2",175,0)
KILL ;
"RTN","YSCLTST2",176,0)
 ;Q:$D(PSLAST7)  ;RTW
"RTN","YSCLTST2",177,0)
 K FDA,YSCLSGS,Y15,RESULTS,RESULTS1,YSCLA,YSCLA1,YSCLMTCH,YSCLSB1,YSCLSD,YSCLTA,YSCLMULT
"RTN","YSCLTST2",178,0)
 K YSCLTL,YSCLTLS,X1,X2
"RTN","YSCLTST2",179,0)
 Q
"RTN","YSCLTST2",180,0)
 ;
"RTN","YSCLTST2",181,0)
OVERRIDE(DFN) ;Check for an over-ride.   SEE RQ12.11
"RTN","YSCLTST2",182,0)
 N YSCLIEN,YSCLOVRD,ARRAY ;S YSCLIEN=$O(^YSCL(603.01,"C",DFN,0)) Q:YSCLIEN="" 0
"RTN","YSCLTST2",183,0)
 S YSCLIEN=$$FIND1^DIC(603.01,,"Q",DFN,"C") Q:YSCLIEN="" 0
"RTN","YSCLTST2",184,0)
 S YSCLOVRD=$$GET1^DIQ(603.01,YSCLIEN,3,"I")
"RTN","YSCLTST2",185,0)
 S:YSCLOVRD'=DT ANQRE=""
"RTN","YSCLTST2",186,0)
 I '$G(PSGCFLG),$G(YSCLOVRD),DT>YSCLOVRD S X=YSCLOVRD,YSCXDATE=$$FMTE^XLFDT(X,"D") W !,"National Override expired at midnight on "_YSCXDATE
"RTN","YSCLTST2",187,0)
 Q YSCLOVRD=DT
"RTN","YSCLTST2",188,0)
ZEOR ;YSCLTST2
"RTN","YSCLTST3")
0^4^B73925187
"RTN","YSCLTST3",1,0)
YSCLTST3 ;DALOI/LB/RLM-TRANSMISSION FOR CLOZAPINE REPORTING SYSTEM ; 11/27/18 5:17pm
"RTN","YSCLTST3",2,0)
 ;;5.01;MENTAL HEALTH;**18,22,25,26,47,61,69,74,90,122**;Dec 30, 1994;Build 112
"RTN","YSCLTST3",3,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLTST3",4,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLTST3",5,0)
 ; Reference to ^PS(59 supported by IA #783
"RTN","YSCLTST3",6,0)
 ; Reference to ^VA(200 supported by IA #10060
"RTN","YSCLTST3",7,0)
 ; Reference to ^LAB(60 supported by IA #333
"RTN","YSCLTST3",8,0)
 ; Reference to ^XMD supported by IA #10070
"RTN","YSCLTST3",9,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTST3",10,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLTST3",11,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTST3",12,0)
 ; Reference to ^DIR supported by DBIA #10026
"RTN","YSCLTST3",13,0)
 ; Reference to ^VADPT supported by DBIA #10061
"RTN","YSCLTST3",14,0)
 ; Reference to $$SITE^VASITE supported by DBIA #10112
"RTN","YSCLTST3",15,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLTST3",16,0)
 ; Reference to ^%ZTLOAD supported by DBIA #10063
"RTN","YSCLTST3",17,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","YSCLTST3",18,0)
 ;
"RTN","YSCLTST3",19,0)
DEMOG ; Old entry point to send demographic data for patients from task. Obsolete
"RTN","YSCLTST3",20,0)
 Q
"RTN","YSCLTST3",21,0)
DMG ; Called by YSCLTEST
"RTN","YSCLTST3",22,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I")
"RTN","YSCLTST3",23,0)
 K ^TMP($J),^TMP("YSCL",$J),^TMP("YSCLL",$J) S YSCLLN=0,YSCLNO=20,DFN=0,YSCLIEN=0
"RTN","YSCLTST3",24,0)
 N ARRAY D LIST^DIC(603.01,,1,"I",,,,,,,"ARRAY")
"RTN","YSCLTST3",25,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  K YSCLA S YSCLIEN=ARRAY("DILIST",2,I)  D
"RTN","YSCLTST3",26,0)
 .S DFN=ARRAY("DILIST","ID",I,1),$P(YSSTOP,",",8)=8 Q:$$S^%ZTLOAD!'DFN
"RTN","YSCLTST3",27,0)
 .I $L($$GET1^DIQ(2,DFN,.01)) S YSCLC=$$GET1^DIQ(603.01,YSCLIEN,.01) D GET
"RTN","YSCLTST3",28,0)
 D TRANSMIT:YSCLLN G END
"RTN","YSCLTST3",29,0)
 ;
"RTN","YSCLTST3",30,0)
GET ;
"RTN","YSCLTST3",31,0)
 S $P(YSSTOP,",",9)=9 Q:$$S^%ZTLOAD
"RTN","YSCLTST3",32,0)
 Q:'$L($$GET1^DIQ(55,DFN,53))  ;Don't try to transmit if no pharmacy record
"RTN","YSCLTST3",33,0)
 Q:$$GET1^DIQ(55,DFN,56,"I")   ;Don't retransmit demographics.
"RTN","YSCLTST3",34,0)
 Q:$D(^TMP("YSCLL",$J,DFN))
"RTN","YSCLTST3",35,0)
 S ^TMP("YSCLL",$J,DFN)=1
"RTN","YSCLTST3",36,0)
 S YSCLP=$$GET1^DIQ(55,DFN,57,"I"),YSCLDEA=$$GET1^DIQ(200,YSCLP,53.2),YSCLP=$$GET1^DIQ(200,YSCLP,.01)
"RTN","YSCLTST3",37,0)
 D DEM^VADPT,ADD^VADPT S YSCL=YSCLC_"^"_$E($P(VADM(1),",",2))_$E(VADM(1))_"^"_$P(VADM(3),"^")_"^"_$P(VADM(2),"^")_"^"_$P(VADM(5),"^")_"^"_VAPA(6)_"^"_DT
"RTN","YSCLTST3",38,0)
 D
"RTN","YSCLTST3",39,0)
 .S YSRACE="*"
"RTN","YSCLTST3",40,0)
 .S YSRC=0 F  S YSRC=$O(VADM(11,YSRC)) Q:'YSRC  S YSRACE=YSRACE_+VADM(11,YSRC)_"-"_+VADM(11,YSRC,1)_","
"RTN","YSCLTST3",41,0)
 .S YSRACE=YSRACE_"~"
"RTN","YSCLTST3",42,0)
 .S YSRC=0 F  S YSRC=$O(VADM(12,YSRC)) Q:'YSRC  S YSRACE=YSRACE_+VADM(12,YSRC)_"-"_+VADM(12,YSRC,1)_","
"RTN","YSCLTST3",43,0)
 S YSCL=YSCL_"^"_YSRACE_"^"_YSCLP_"^"_YSCLDEA
"RTN","YSCLTST3",44,0)
 ; YSCLJ containing a ZIP code
"RTN","YSCLTST3",45,0)
 N ARRAY59 D LIST^DIC(59,,"1;.05",,,,,,,,"ARRAY59")
"RTN","YSCLTST3",46,0)
 F YSCLJ=1:1 Q:'$D(ARRAY59("DILIST","ID",YSCLJ))  I ARRAY59("DILIST","ID",YSCLJ,1)'="" S YSCLJ=ARRAY59("DILIST","ID",YSCLJ,.05) Q
"RTN","YSCLTST3",47,0)
 S YSCL=YSCL_"^"_YSCLJ
"RTN","YSCLTST3",48,0)
 ;registration number^initials^dob^ssn^sex^zip^today^race^physician^dea^zip code (hosp)
"RTN","YSCLTST3",49,0)
 S YSCLLN=YSCLLN+1,^TMP($J,YSCLLN,0)=YSCL
"RTN","YSCLTST3",50,0)
 I VADM(5)=""!(VAPA(6)="")!('VADM(11))!('VADM(12)) D  ;RLM RACETEST
"RTN","YSCLTST3",51,0)
 .S ^TMP("YSCL",$J,YSCLNO,0)=$P(VADM(2),"^",1)_"   "_VADM(1)
"RTN","YSCLTST3",52,0)
 .S:VADM(5)="" ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (SEX)"
"RTN","YSCLTST3",53,0)
 .S:VAPA(6)="" ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (ZIP)"
"RTN","YSCLTST3",54,0)
 .S:'VADM(12) ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (RACE, NEW FORMAT)"
"RTN","YSCLTST3",55,0)
 .S:'VADM(11) ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (ETHNICITY)"
"RTN","YSCLTST3",56,0)
 .S YSCLNO=YSCLNO+1
"RTN","YSCLTST3",57,0)
 .S ^TMP("YSCLL",$J,DFN)=0 ; leave unmarked pending demographic data
"RTN","YSCLTST3",58,0)
 .I ('VADM(11))!('VADM(12)) D
"RTN","YSCLTST3",59,0)
 ..S ^TMP("YSCL",$J,YSCLNO,0)="NOTE: Race and Ethnicity may be entered if permission is obtained in the informed consent",YSCLNO=YSCLNO+1
"RTN","YSCLTST3",60,0)
 ..S ^TMP("YSCL",$J,YSCLNO,0)="document. See VHA Directive 99-035.",YSCLNO=YSCLNO+1
"RTN","YSCLTST3",61,0)
 ;
"RTN","YSCLTST3",62,0)
 Q
"RTN","YSCLTST3",63,0)
 ;
"RTN","YSCLTST3",64,0)
TRANSMIT ; remote and local messages
"RTN","YSCLTST3",65,0)
 S $P(YSSTOP,",",10)=10 Q:$$S^%ZTLOAD
"RTN","YSCLTST3",66,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I"),YSPROD=$$GET1^DIQ(8989.3,1,501,"I")
"RTN","YSCLTST3",67,0)
 S YSPRODST=$$GET1^DIQ(603.03,1,9) ;S:YSPRODST="" YSPRODST="S.RUCLDEM@FO-HINES.DOMAIN.EXT"
"RTN","YSCLTST3",68,0)
 S YSDBGST=$$GET1^DIQ(603.03,1,11) ;S:YSDBGST="" YSDBGST="G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT"
"RTN","YSCLTST3",69,0)
 ;/RBN - Begin modifications for YS*5.01*122
"RTN","YSCLTST3",70,0)
 I YSCLLN D
"RTN","YSCLTST3",71,0)
 .I YSPROD D
"RTN","YSCLTST3",72,0)
 ..I 'YSDEBUG S XMY(YSPRODST)="" ;XMY("G.CLOZAPINE ROLL-UP")="" ;,
"RTN","YSCLTST3",73,0)
 ..E  S XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")="",XMY("G.RUCLDEM@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLTST3",74,0)
 .E  D
"RTN","YSCLTST3",75,0)
 ..I 'YSDEBUG S XMY(YSDBGST)=""
"RTN","YSCLTST3",76,0)
 ..E  S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLTST3",77,0)
 .S XMDUZ="CLOZAPINE MONITOR",XMTEXT="^TMP($J,",XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine demographics" D ^XMD
"RTN","YSCLTST3",78,0)
 .N DIE,DA,DR S DIE="^YSCL(603.03,",DA=1,DR="6///"_$$NOW^XLFDT D ^DIE
"RTN","YSCLTST3",79,0)
 K XMY
"RTN","YSCLTST3",80,0)
 I 'YSDEBUG S XMY("G.PSOCLOZ")="" S:YSPROD XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLTST3",81,0)
 E  S XMY("G.CLOZAPINE DEBUG")="" S:YSPROD XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLTST3",82,0)
 S XMDUZ="CLOZAPINE MONITOR",XMTEXT="^TMP($J,"
"RTN","YSCLTST3",83,0)
 S XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine demographics",^TMP("YSCL",$J,2,0)=" "
"RTN","YSCLTST3",84,0)
 S ^TMP("YSCL",$J,1,0)="Clozapine demographic data was transmitted, "_YSCLLN_" records were sent.",XMTEXT="^TMP(""YSCL"",$J,"
"RTN","YSCLTST3",85,0)
 I $O(^TMP("YSCL",$J,10)) S ^TMP("YSCL",$J,3,0)="For the following patients, one or more of the required data",^TMP("YSCL",$J,4,0)="elements (race, sex, ZIP code) were missing.",^TMP("YSCL",$J,5,0)=" "
"RTN","YSCLTST3",86,0)
 I  S ^TMP("YSCL",$J,6,0)="Please have this information entered.",^TMP("YSCL",$J,7,0)="The available data was transmitted.",^TMP("YSCL",$J,8,0)=" "
"RTN","YSCLTST3",87,0)
 D ^XMD
"RTN","YSCLTST3",88,0)
 ; set transmitted field in 55 from ^TMP("YSCLL",$J)
"RTN","YSCLTST3",89,0)
 F DFN=0:0 S DFN=$O(^TMP("YSCLL",$J,DFN)) Q:'DFN  I ^TMP("YSCLL",$J,DFN) S DIE="^PS(55,",DA=DFN,DR="56///1" D ^DIE
"RTN","YSCLTST3",90,0)
 Q
"RTN","YSCLTST3",91,0)
 ;
"RTN","YSCLTST3",92,0)
FLERR ;
"RTN","YSCLTST3",93,0)
 K XMY
"RTN","YSCLTST3",94,0)
 ;/RBN - Begin modifications for YS*5.01*122
"RTN","YSCLTST3",95,0)
 X ^%ZOSF("UCI") I Y=^%ZOSF("PROD") D
"RTN","YSCLTST3",96,0)
 .S XMY("G.CLOZAPINE ROLL-UP@AADOMAIN.EXT")=""
"RTN","YSCLTST3",97,0)
 .I YSDEBUG K XMY S XMY("G.CLOZAPINE DEBUG@FO-DALLAS.DOMAIN.EXT")=""
"RTN","YSCLTST3",98,0)
 I Y'=^%ZOSF("PROD") D
"RTN","YSCLTST3",99,0)
 .S XMY("G.CLOZAPINE ROLL-UP")=""
"RTN","YSCLTST3",100,0)
 .I YSDEBUG K XMY S XMY("G.CLOZAPINE DEBUG")=""
"RTN","YSCLTST3",101,0)
 ;/RBN - End modifications for YS*5.01*122
"RTN","YSCLTST3",102,0)
 S %DT="T",X="NOW" D ^%DT S YSCLNOW=$P(Y,".",2)
"RTN","YSCLTST3",103,0)
 S YSCLSITE=$P($$SITE^VASITE,"^",2)
"RTN","YSCLTST3",104,0)
 S XMSUB=$S(YSDEBUG:"DEBUG ",1:"")_"Clozapine lab data error at "_YSCLSITE_" on "_DT_" at "_YSCLNOW,^TMP("YSCL",$J,1,0)=" "
"RTN","YSCLTST3",105,0)
 S ^TMP("YSCL",$J,2,0)="### Clozapine data error at "_YSCLSITE_" on "_DT_" +++"
"RTN","YSCLTST3",106,0)
 S ^TMP("YSCL",$J,3,0)=" Clozapine Lab Test file not properly defined."
"RTN","YSCLTST3",107,0)
 S ^TMP("YSCL",$J,4,0)=" Data cannot be transmitted!"
"RTN","YSCLTST3",108,0)
 S XMTEXT="^TMP(""YSCL"",$J,",XMDUZ="Clozapine MONITOR" D ^XMD
"RTN","YSCLTST3",109,0)
 G END^YSCLTST2
"RTN","YSCLTST3",110,0)
 Q
"RTN","YSCLTST3",111,0)
TLIST ;
"RTN","YSCLTST3",112,0)
 I '$D(^YSCL(603.04)) W !,"Patch YS*5.01*90 not properly installed.  Contact IRM" S DIR(0)="E" D ^DIR Q
"RTN","YSCLTST3",113,0)
 W !,"Currently linked Tests:" I '$O(^YSCL(603.04,1,1,0)) W !,"No tests linked",!
"RTN","YSCLTST3",114,0)
 S YSCLA=0
"RTN","YSCLTST3",115,0)
 F  S YSCLA=$O(^YSCL(603.04,1,1,YSCLA)) Q:'YSCLA  S YSCLB=^YSCL(603.04,1,1,YSCLA,0) D
"RTN","YSCLTST3",116,0)
  . W !,$P(^LAB(60,$P(YSCLB,"^"),0),"^")," represents " S YSCLB=$P(YSCLB,"^",2)
"RTN","YSCLTST3",117,0)
  . W $S(YSCLB="W":"WHITE BLOOD COUNT",YSCLB="A":"ABSOLUTE NEUTROPHIL COUNT",YSCLB="N":"NEUTROPHIL PERCENT",YSCLB="S":"SEGS %",YSCLB="B":"BANDS %",YSCLB="T":"BANDS ABSOLUTE",YSCLB="C":"SEGS ABSOLUTE",1:"Bad Record")
"RTN","YSCLTST3",118,0)
 F  K DIR S DIR(0)="PA^60:EMZ",DIR("A")="Enter the name of the test for Clozapine: " W ! D ^DIR Q:Y="^"!($D(DTOUT))!($D(DUOUT))  S YSCLTST=+Y D  Q:Y="^"!($D(DTOUT))!($D(DUOUT))
"RTN","YSCLTST3",119,0)
  . I $D(^YSCL(603.04,1,1,"B",YSCLTST)) G TEXIST
"RTN","YSCLTST3",120,0)
  . K DIR S DIR(0)="SA^W:WHITE BLOOD COUNT;A:ABSOLUTE NEUTROPHIL COUNT;N:NEUTROPHIL PERCENT;S:SEGS %;B:BANDS %;T:BANDS ABSOLUTE;C:SEGS ABSOLUTE"
"RTN","YSCLTST3",121,0)
  . S DIR("A")="Enter the type of the test for Clozapine: "  D ^DIR Q:Y["^"!($D(DTOUT))!($D(DUOUT))  S YSCLTS1=Y
"RTN","YSCLTST3",122,0)
  . K DIR S DIR(0)="SA^0:uL;1:K/uL;2:Percent"
"RTN","YSCLTST3",123,0)
  . S DIR("A")="Enter the reporting method of the test for Clozapine: "  D ^DIR Q:Y["^"!($D(DTOUT))!($D(DUOUT))  S YSCLTS2=Y
"RTN","YSCLTST3",124,0)
  . K YSCLERR
"RTN","YSCLTST3",125,0)
  . D VAL^DIE(603.41,"+1,1,",.01,"F","`"_YSCLTST,.YSCLRES,"FDA","YSCLERR")
"RTN","YSCLTST3",126,0)
  . I $D(YSCLERR) W !,"There was a problem with the data, please re-enter it" Q
"RTN","YSCLTST3",127,0)
  . D VAL^DIE(603.41,"+1,1,",1,"F",YSCLTS1,.YSCLRES,"FDA","YSCLERR")
"RTN","YSCLTST3",128,0)
  . I $D(YSCLERR) W !,"There was a problem with the data, please re-enter it" Q
"RTN","YSCLTST3",129,0)
  . D VAL^DIE(603.41,"+1,1,",2,"F",YSCLTS2,.YSCLRES,"FDA","YSCLERR")
"RTN","YSCLTST3",130,0)
  . I $D(YSCLERR) W !,"There was a problem with the data, please re-enter it" Q
"RTN","YSCLTST3",131,0)
  . D UPDATE^DIE(,"FDA",,"ERROR")
"RTN","YSCLTST3",132,0)
  . I $D(YSCLERR) W !,"There was a problem with the data, please re-enter it" Q
"RTN","YSCLTST3",133,0)
 Q
"RTN","YSCLTST3",134,0)
TEXIST ;
"RTN","YSCLTST3",135,0)
 W !,"This entry already exists.  Do you wish to delete it?" K DIR S DIR(0)="Y" D ^DIR Q:'Y!($D(DTOUT))!($D(DUOUT))
"RTN","YSCLTST3",136,0)
 S DA(1)=1,DA=$O(^YSCL(603.04,1,1,"B",YSCLTST,"")),DIE="^YSCL(603.04,1,1,",DR=".01////@" D ^DIE W !,"Deleted" S Y="" Q
"RTN","YSCLTST3",137,0)
 Q
"RTN","YSCLTST3",138,0)
END K %,C,D,DA,DFN,DISYS,DR,I,R,VADM,VAPA,VAERR,Y,YSCL,YSCL1,YSCL2,YSCLC,YSCLDEA,YSCLJ,YSCLLN,YSCLNAME,YSCLNO,YSCLP,^TMP($J),^TMP("YSCL",$J),^TMP("YSCLL",$J) Q
"RTN","YSCLTST3",139,0)
 Q
"RTN","YSCLTST3",140,0)
END1 ;
"RTN","YSCLTST3",141,0)
 K ^TMP($J),^TMP("YSCL",$J)
"RTN","YSCLTST3",142,0)
 K %,%DT,%H,%T,AGE,C,CNT,D,DA,DFN,DIE,DIK,DIR,DIROUT,DIRUT,DISYS,DOB,DR
"RTN","YSCLTST3",143,0)
 K DRG,DTOUT,DUOUT,I,IOF,J,K,LAB,LABT,PNM,POP,R,RESULTS1,SEX,SSN,VADM,VAERR,VAPA
"RTN","YSCLTST3",144,0)
 K X,X1,X2,XMDUZ,XMSUB,XMTEXT,XMY,XMZ,Y,YSACT,YSCL,YSCL1,YSCL2,YSCL28,YSCLA,YSCLA1,YSCLAB
"RTN","YSCLTST3",145,0)
 K YSCLAB1,YSCLAB2,YSCLAB3,YSCLAB4,YSCLC,YSCLD,YSCLD0,YSCLD1,YSCLDAT1
"RTN","YSCLTST3",146,0)
 K YSCLDATA,YSCLDEA,YSCLDEMO,YSCLED,YSCLF,YSCLFF,YSCLFRQ,YSCLGL,YSCLGRN,YSCLI
"RTN","YSCLTST3",147,0)
 K YSCLID,YSCLIED,YSCLIEN,YSCLIF,YSCLJ,YSCLLAB,YSCLLD,YSCLLDFN,YSCLLDN
"RTN","YSCLTST3",148,0)
 K YSCLLDT,YSCLLK,YSCLLLN,YSCLLN,YSCLLO,YSCLM180,YSCLM28,YSCLM56,YSCLM7,YSCLMTCH,YSCLNAME
"RTN","YSCLTST3",149,0)
 K YSCLNO,YSCLNOW,YSCLNST1,YSCLNSTE,YSCLOVR,YSCLP,YSCLPHY,YSCLR,YSCLRES,YSCLRET,YSCLRWBC,YSCLRX
"RTN","YSCLTST3",150,0)
 K YSCLRX2,YSCLSAND,YSCLSB1,YSCLSD,YSCLSGS,YSCLSITE,YSCLSN,YSCLSP,YSCLT,YSCLTA,YSCLTDT,YSCLTEST
"RTN","YSCLTST3",151,0)
 K YSCLTL,YSCLTPT,YSCLTLS,YSCLTLS1,YSCLTS1,YSCLTST,YSCLTYPE,YSCLWBC,YSCLWBCC
"RTN","YSCLTST3",152,0)
 K YSCLWBCT,YSCLX,YSCLZ2,YSDEBUG,YSOFF,YSRACE,YSRC,YSSTOP,YSTEXT,ZTDESC
"RTN","YSCLTST3",153,0)
 K ZTDTH,ZTIO,ZTREQ,ZTRTN,ZTSAVE,ZTSTOP
"RTN","YSCLTST3",154,0)
 Q
"RTN","YSCLTST3",155,0)
ZEOR ;YSCLTST3
"RTN","YSCLTST4")
0^9^B20061166
"RTN","YSCLTST4",1,0)
YSCLTST4 ;DALOI/LB/RLM-TRANSMIT RX AND lAB DATA FOR CLOZAPINE ; 11/27/18 5:15pm
"RTN","YSCLTST4",2,0)
 ;;5.01;MENTAL HEALTH;**92,122**;Dec 30, 1994;Build 112
"RTN","YSCLTST4",3,0)
 ; Reference to ^LAB(60 supported by IA #333
"RTN","YSCLTST4",4,0)
 ; Reference to ^LR7OR1 supported by IA #2503
"RTN","YSCLTST4",5,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTST4",6,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTST4",7,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLTST4",8,0)
 ;
"RTN","YSCLTST4",9,0)
CL1 ;(DFN,DAYS) ;
"RTN","YSCLTST4",10,0)
 K ^TMP($J,"PSO"),RESULTS,YSCLYWBC,YSCLRANC,YSCLXWBC
"RTN","YSCLTST4",11,0)
 Q:'DFN
"RTN","YSCLTST4",12,0)
 S:'$G(DAYS) DAYS=90
"RTN","YSCLTST4",13,0)
 N ARRAY D LIST^DIC(603.01,,1,"I",,,DFN,"C",,,"ARRAY")
"RTN","YSCLTST4",14,0)
 S YSCLIEN=$G(ARRAY("DILIST",2,1)),YSCLFRQ="" I YSCLIEN S YSCLFRQ=$$GET1^DIQ(603.01,YSCLIEN,2,"I")
"RTN","YSCLTST4",15,0)
 I $$GET1^DIQ(603.03,1,7,"I")=1  Q "-1^0^0^0^0^0^"_YSCLFRQ
"RTN","YSCLTST4",16,0)
 S X1=DT,X2="-"_DAYS D C^%DTC S YSCLSD=X
"RTN","YSCLTST4",17,0)
 K ARRAY D LIST^DIC(603.41,",1,","1;2","I",,,,,,,"ARRAY")
"RTN","YSCLTST4",18,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S YSCLA=ARRAY("DILIST",2,I) D
"RTN","YSCLTST4",19,0)
 . N YSCLTNM,YSCLTTP,YSCLTFR S YSCLTNM=ARRAY("DILIST",1,I) ;$$GET1^DIQ(603.41,YSCLA_",1,",.01,"I")
"RTN","YSCLTST4",20,0)
 . S YSCLTTP=ARRAY("DILIST","ID",I,1)
"RTN","YSCLTST4",21,0)
 . S YSCLTFR=ARRAY("DILIST","ID",I,2)
"RTN","YSCLTST4",22,0)
 . S YSCLTLS(YSCLTTP,YSCLTNM)=YSCLTFR
"RTN","YSCLTST4",23,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",1,I))  S YSCLTL=ARRAY("DILIST",1,I) D
"RTN","YSCLTST4",24,0)
 . D RR^LR7OR1(DFN,,YSCLSD,DT,,YSCLTL,"L")
"RTN","YSCLTST4",25,0)
 . S YSCLSB1="" F  S YSCLSB1=$O(^TMP("LRRR",$J,DFN,YSCLSB1)) Q:YSCLSB1=""  D
"RTN","YSCLTST4",26,0)
 . . S YSCLTDT="" F  S YSCLTDT=$O(^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT)) Q:YSCLTDT=""  I $P(YSCLTDT,".",2)]"" D
"RTN","YSCLTST4",27,0)
 . . . S YSCLTA="" F  S YSCLTA=$O(^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT,YSCLTA)) Q:YSCLTA=""  I YSCLTA D
"RTN","YSCLTST4",28,0)
 . . . . S RESULTS1=^TMP("LRRR",$J,DFN,YSCLSB1,YSCLTDT,YSCLTA)
"RTN","YSCLTST4",29,0)
 . . . . S RESULTS(YSCLTL,YSCLTDT)=$P(RESULTS1,"^",2)
"RTN","YSCLTST4",30,0)
 ;Find all entries for WBC and sort by inverse date.
"RTN","YSCLTST4",31,0)
 S YSCLA="" F  S YSCLA=$O(YSCLTLS("W",YSCLA)) Q:'YSCLA  S YSCLXWBC(YSCLA)="" D
"RTN","YSCLTST4",32,0)
 . S YSCLA1="" F  S YSCLA1=$O(RESULTS(YSCLA,YSCLA1)) Q:'YSCLA1  D
"RTN","YSCLTST4",33,0)
 . . S YSCLYWBC(YSCLA1)=RESULTS(YSCLA,YSCLA1)*$S(YSCLTLS("W",YSCLA):1000,1:1)
"RTN","YSCLTST4",34,0)
 . . S ^TMP($J,"PSO",YSCLA1)=YSCLYWBC(YSCLA1)
"RTN","YSCLTST4",35,0)
 S YSCLRWBC=0 F  S YSCLRWBC=$O(YSCLYWBC(YSCLRWBC)) Q:YSCLRWBC=""  S YSCLRWBC(YSCLRWBC)=YSCLYWBC(YSCLRWBC) D
"RTN","YSCLTST4",36,0)
 . ;Match all ANC's and WBC's
"RTN","YSCLTST4",37,0)
 . S YSCLMTCH=0 F YSCLA="A","N","S","C" Q:YSCLMTCH  S YSCLTPT="" F  S YSCLTPT=$O(YSCLTLS(YSCLA,YSCLTPT)) Q:'YSCLTPT  D  Q:YSCLMTCH
"RTN","YSCLTST4",38,0)
 . . I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="A",$D(YSCLRWBC(YSCLRWBC)) S ^TMP($J,"PSO",YSCLRWBC)=YSCLRWBC(YSCLRWBC)_"^"_(RESULTS(YSCLTPT,YSCLRWBC)*$S(YSCLTLS(YSCLA,YSCLTPT):1000,1:1)) Q
"RTN","YSCLTST4",39,0)
 . . I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="N",$D(YSCLRWBC(YSCLRWBC)) S YSCLMTCH=1,^TMP($J,"PSO",YSCLRWBC)=YSCLRWBC(YSCLRWBC)_"^"_(YSCLRWBC(YSCLRWBC)*((RESULTS(YSCLTPT,YSCLRWBC)*.01))) Q
"RTN","YSCLTST4",40,0)
 . . I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="S",$D(YSCLRWBC(YSCLRWBC)) D  Q
"RTN","YSCLTST4",41,0)
 . . . S (YSCLSG1,YSCLSGS)="" F  S YSCLSGS=$O(YSCLTLS("B",YSCLSGS)) D  Q:'YSCLSGS!YSCLMTCH
"RTN","YSCLTST4",42,0)
 . . . . I 'YSCLSG1,'YSCLSGS S YSCLSGS="Z",YSCLSG1=1
"RTN","YSCLTST4",43,0)
 . . . . I 'YSCLSGS,YSCLSG1 Q
"RTN","YSCLTST4",44,0)
 . . . . I '$D(RESULTS(YSCLSGS,YSCLRWBC)) S RESULTS(YSCLSGS,YSCLRWBC)=0
"RTN","YSCLTST4",45,0)
 . . . . S YSCLMTCH=1,^TMP($J,"PSO",YSCLRWBC)=YSCLRWBC(YSCLRWBC)_"^"_(YSCLRWBC(YSCLRWBC)*((RESULTS(YSCLTPT,YSCLRWBC)*.01)+(RESULTS(YSCLSGS,YSCLRWBC)*.01))) Q
"RTN","YSCLTST4",46,0)
 . . I $G(RESULTS(YSCLTPT,YSCLRWBC)),YSCLA="C" S YSCLMTCH=1 D
"RTN","YSCLTST4",47,0)
 . . . S YSCLSGS="" F  S YSCLSGS=$O(YSCLTLS("T",YSCLSGS)) D  Q:'YSCLSGS!YSCLMTCH
"RTN","YSCLTST4",48,0)
 . . . . I '$G(YSCLSG1),'YSCLSGS S YSCLSGS="Z",YSCLSG1=1
"RTN","YSCLTST4",49,0)
 . . . . I 'YSCLSGS,$G(YSCLSG1) Q
"RTN","YSCLTST4",50,0)
 . . . . I '$D(RESULTS(YSCLSGS,YSCLRWBC)) S RESULTS(YSCLSGS,YSCLRWBC)=0
"RTN","YSCLTST4",51,0)
 . . . . S YSCLMTCH=1,^TMP($J,"PSO",YSCLRWBC)=YSCLRWBC(YSCLRWBC)_"^"_((RESULTS(YSCLTPT,YSCLRWBC)*$S(YSCLTLS(YSCLA,YSCLTPT):1000,1:1))+(RESULTS(YSCLSGS,YSCLRWBC))) Q
"RTN","YSCLTST4",52,0)
 S YSCLA="A",YSCLTPT="" F  S YSCLTPT=$O(YSCLTLS(YSCLA,YSCLTPT)) Q:'YSCLTPT  D
"RTN","YSCLTST4",53,0)
 . S YSCLRANC="" F  S YSCLRNC=$O(RESULTS(YSCLTPT,YSCLRANC)) Q:'YSCLRANC  D
"RTN","YSCLTST4",54,0)
 . . Q:$D(^TMP($J,"PSO",YSCLRANC))
"RTN","YSCLTST4",55,0)
 . . S ^TMP($J,"PSO",YSCLRANC)="^"_(RESULTS(YSCLTPT,YSCLRANC)*$S(YSCLTLS("A",YSCLTPT):1000,1:1))
"RTN","YSCLTST4",56,0)
 K FDA,YSCLSGS,Y15,YSCLRWBC,YSCLANC,YSCLYWBC,YSCLFRQ,ZIENS,RESULTS,RESULTS1,YSCLA,YSCLA1,YSCLMTCH,YSCLSB1,YSCLSD
"RTN","YSCLTST4",57,0)
 K YSCLTA,YSCLTDT,YSCLTL,YSCLTLS,YSCLTPT,YSCLXWBC,YSCLMULT
"RTN","YSCLTST4",58,0)
 Q
"RTN","YSCLTST4",59,0)
 ;
"RTN","YSCLTST4",60,0)
KILL ;
"RTN","YSCLTST4",61,0)
 K FDA,YSCLSGS,Y15,RESULTS,RESULTS1,YSCLA,YSCLA1,YSCLMTCH,YSCLSB1,YSCLSD,YSCLTA,YSCLMULT
"RTN","YSCLTST4",62,0)
 K YSCLTDT,YSCLTL,YSCLSG1,YSCLTLS,YSCLTPT,YSCLXWBC
"RTN","YSCLTST4",63,0)
 ;
"RTN","YSCLTST4",64,0)
ZEOR ;YSCLTST4
"RTN","YSCLTST5")
0^5^B144170754
"RTN","YSCLTST5",1,0)
YSCLTST5 ;HINOI/RSJ-TRANSMISSION FOR REAL-TIME CLOZAPINE ORDERS ;10 May 2019 12:09:40
"RTN","YSCLTST5",2,0)
 ;;5.01;MENTAL HEALTH;**122**;Dec 30, 1994;Build 112
"RTN","YSCLTST5",3,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","YSCLTST5",4,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLTST5",5,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLTST5",6,0)
 ; Reference to ^PS(59 supported by IA #783
"RTN","YSCLTST5",7,0)
 ; Reference to ^VA(200 supported by IA #10060
"RTN","YSCLTST5",8,0)
 ; Reference to ^LAB(60 supported by IA #333
"RTN","YSCLTST5",9,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTST5",10,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLTST5",11,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTST5",12,0)
 ; Reference to ^DIR supported by DBIA #10026
"RTN","YSCLTST5",13,0)
 ; Reference to ^VADPT supported by DBIA #10061
"RTN","YSCLTST5",14,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLTST5",15,0)
 ; Reference to ^%ZTLOAD supported by DBIA #10063
"RTN","YSCLTST5",16,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLTST5",17,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","YSCLTST5",18,0)
 ;
"RTN","YSCLTST5",19,0)
 Q
"RTN","YSCLTST5",20,0)
INPSND ; Build inpatient clozapine data for transmision
"RTN","YSCLTST5",21,0)
 N PSJPAT,PSJIOF,YCLSCNTR,PSGTIM,X,X1,X2 S YSCLRET="",PSJPAT=DFN,PSJIOF=IOF,YCLSCNTR=0
"RTN","YSCLTST5",22,0)
 S X1=DT,X2=365 D C^%DTC S YSEND=X
"RTN","YSCLTST5",23,0)
 S $P(^XTMP("YSCLTRN",0),"^",1)=YSEND,$P(^XTMP("YSCLTRN",0),"^",2)=DT
"RTN","YSCLTST5",24,0)
 S:'$G(^XTMP("YSCLTRN",DT)) ^XTMP("YSCLTRN",DT)=0
"RTN","YSCLTST5",25,0)
 D DMG,DMG1,GETINP,INPCHK
"RTN","YSCLTST5",26,0)
 I YSCLT D LOAD
"RTN","YSCLTST5",27,0)
 S DFN=PSJPAT,IOF=PSJIOF
"RTN","YSCLTST5",28,0)
 K ^TMP("YSCL",$J),^TMP("YSCLL",$J),^TMP($J)
"RTN","YSCLTST5",29,0)
 Q
"RTN","YSCLTST5",30,0)
DMG ; Called by PSGOETO
"RTN","YSCLTST5",31,0)
 Q:'DFN
"RTN","YSCLTST5",32,0)
 N PSDFN
"RTN","YSCLTST5",33,0)
 S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I"),PSDFN=DFN    ;$P(^YSCL(603.03,1,0),"^",3)
"RTN","YSCLTST5",34,0)
 K ^TMP($J),^TMP("YSCL",$J) S (YSCLIEN,YSCLLN)=0,YSCLNO=20
"RTN","YSCLTST5",35,0)
 N ARRAY D LIST^DIC(603.01,,1,"I",,,DFN,"C",,,"ARRAY")
"RTN","YSCLTST5",36,0)
 S YSCLIEN=$G(ARRAY("DILIST",2,1)) Q:'YSCLIEN
"RTN","YSCLTST5",37,0)
 S $P(YSSTOP,",",8)=8 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",38,0)
 I $L($$GET1^DIQ(2,DFN,.01)) S YSCLC=ARRAY("DILIST","ID",1,.01) D GET
"RTN","YSCLTST5",39,0)
 I $D(^TMP("YSCLL",$J,DFN)) D
"RTN","YSCLTST5",40,0)
 . S $P(^XTMP("YSCLTRN",0),"^",1)=YSEND,$P(^XTMP("YSCLTRN",0),"^",2)=DT
"RTN","YSCLTST5",41,0)
 . S:'$G(^XTMP("YSCLDEM",DT)) ^XTMP("YSCLDEM",DT)=0
"RTN","YSCLTST5",42,0)
 . I '$G(YSCLDIS2) S ^XTMP("YSCLDEM",DT,DFN,0)=0 ;RTW 
"RTN","YSCLTST5",43,0)
 . I $G(YSCLDIS2) S ^XTMP("YSCLDIS",DT,DFN,0)=$G(YSCLDIS2) ;RTW
"RTN","YSCLTST5",44,0)
 I $G(YSCLDIS2) S ^XTMP("YSCLDIS",DT,DFN,0)=$G(YSCLDIS2) ;RTW
"RTN","YSCLTST5",45,0)
 S DFN=PSDFN
"RTN","YSCLTST5",46,0)
 Q
"RTN","YSCLTST5",47,0)
DMG1 ; GATHER FACILITY INFORMATION
"RTN","YSCLTST5",48,0)
 S YSCLLN=0,YSCLLLN=3,(X1,YSCLED)=DT,X2=-60 D C^%DTC S YSCLM28=X,X1=$P(YSCLED,"."),X2=-28 D C^%DTC S YSCLM7=X,YSCLED=YSCLED+.5 ;28 TO 60 and 14 to 28 6/15/05
"RTN","YSCLTST5",49,0)
 S X1=$P(YSCLED,"."),X2=-180 D C^%DTC S YSCLM180=X
"RTN","YSCLTST5",50,0)
 S X1=$P(YSCLED,"."),X2=-56 D C^%DTC S YSCLM56=X
"RTN","YSCLTST5",51,0)
 S YSCLIF=+$$SITE^VASITE_","
"RTN","YSCLTST5",52,0)
 D GETS^DIQ(4,YSCLIF,"1.01;1.02;1.03;.02;1.04","I","YSCLFF")
"RTN","YSCLTST5",53,0)
 S $P(YSCLDEMO,"^",1)=YSCLFF(4,YSCLIF,1.01,"I")
"RTN","YSCLTST5",54,0)
 S $P(YSCLDEMO,"^",2)=YSCLFF(4,YSCLIF,1.02,"I")
"RTN","YSCLTST5",55,0)
 S $P(YSCLDEMO,"^",3)=YSCLFF(4,YSCLIF,1.03,"I")
"RTN","YSCLTST5",56,0)
 S $P(YSCLDEMO,"^",4)=$P(^DIC(5,YSCLFF(4,YSCLIF,.02,"I"),0),"^",2)
"RTN","YSCLTST5",57,0)
 S $P(YSCLDEMO,"^",5)=YSCLFF(4,YSCLIF,1.04,"I")
"RTN","YSCLTST5",58,0)
 S $P(YSCLDEMO,"^",6)=""
"RTN","YSCLTST5",59,0)
 K J,YSCLF,YSCLFF,YSCLIF,X
"RTN","YSCLTST5",60,0)
 Q
"RTN","YSCLTST5",61,0)
GET ; GATHER PATIENT DEMOGRAPHICS
"RTN","YSCLTST5",62,0)
 S $P(YSSTOP,",",9)=9 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",63,0)
 Q:'$L($$GET1^DIQ(55,DFN,53))  ; Don't try to transmit if no pharmacy record
"RTN","YSCLTST5",64,0)
 Q:$$GET1^DIQ(55,DFN,56,"I")   ; Don't retransmit demographics.
"RTN","YSCLTST5",65,0)
 Q:$D(^TMP("YSCLL",$J,DFN))
"RTN","YSCLTST5",66,0)
 S ^TMP("YSCLL",$J,DFN)=1
"RTN","YSCLTST5",67,0)
 S YSCLP=$$GET1^DIQ(55,DFN,57,"I"),YSCLDEA=$$GET1^DIQ(200,YSCLP,53.2),YSCLP=$$GET1^DIQ(200,YSCLP,.01)
"RTN","YSCLTST5",68,0)
 D DEM^VADPT,ADD^VADPT S YSCL=$G(YSCLC)_"^"_$E($P(VADM(1),",",2))_$E(VADM(1))_"^"_$P(VADM(3),"^")_"^"_$P(VADM(2),"^")_"^"_$P(VADM(5),"^")_"^"_VAPA(6)_"^"_DT
"RTN","YSCLTST5",69,0)
 D
"RTN","YSCLTST5",70,0)
 . S YSRACE="*"
"RTN","YSCLTST5",71,0)
 . S YSRC=0 F  S YSRC=$O(VADM(11,YSRC)) Q:'YSRC  S YSRACE=YSRACE_+VADM(11,YSRC)_"-"_+VADM(11,YSRC,1)_","
"RTN","YSCLTST5",72,0)
 . S YSRACE=YSRACE_"~"
"RTN","YSCLTST5",73,0)
 . S YSRC=0 F  S YSRC=$O(VADM(12,YSRC)) Q:'YSRC  S YSRACE=YSRACE_+VADM(12,YSRC)_"-"_+VADM(12,YSRC,1)_","
"RTN","YSCLTST5",74,0)
 S YSCL=YSCL_"^"_YSRACE_"^"_YSCLP_"^"_YSCLDEA
"RTN","YSCLTST5",75,0)
 ; YSCLJ contains a ZIP code
"RTN","YSCLTST5",76,0)
 N ARRAY59 D LIST^DIC(59,,"1;.05",,,,,,,,"ARRAY59")
"RTN","YSCLTST5",77,0)
 S YSCLJ="" F  S YSCLJ=$O(ARRAY59("DILIST","ID",YSCLJ)) Q:'YSCLJ  I ARRAY59("DILIST","ID",YSCLJ,1)'="" S YSCLJ=ARRAY59("DILIST","ID",YSCLJ,.05) Q
"RTN","YSCLTST5",78,0)
 S YSCL=YSCL_"^"_YSCLJ
"RTN","YSCLTST5",79,0)
 ;registration number^initials^dob^ssn^sex^zip^today^race^physician^dea^zip code (hosp)
"RTN","YSCLTST5",80,0)
 S YSCLLN=YSCLLN+1,^TMP($J,YSCLLN,0)=YSCL
"RTN","YSCLTST5",81,0)
 I VADM(5)=""!(VAPA(6)="")!('VADM(11))!('VADM(12)) D  ;RLM RACETEST
"RTN","YSCLTST5",82,0)
 . S ^TMP("YSCL",$J,YSCLNO,0)=$P(VADM(2),"^",1)_"   "_VADM(1)
"RTN","YSCLTST5",83,0)
 . S:VADM(5)="" ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (SEX)"
"RTN","YSCLTST5",84,0)
 . S:VAPA(6)="" ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (ZIP)"
"RTN","YSCLTST5",85,0)
 . S:'VADM(12) ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (RACE, NEW FORMAT)"
"RTN","YSCLTST5",86,0)
 . S:'VADM(11) ^TMP("YSCL",$J,YSCLNO,0)=^TMP("YSCL",$J,YSCLNO,0)_" (ETHNICITY)"
"RTN","YSCLTST5",87,0)
 . S YSCLNO=YSCLNO+1
"RTN","YSCLTST5",88,0)
 . S ^TMP("YSCLL",$J,DFN)=0 ; leave unmarked pending demographic data
"RTN","YSCLTST5",89,0)
 . I ('VADM(11))!('VADM(12)) D
"RTN","YSCLTST5",90,0)
 . . S ^TMP("YSCL",$J,YSCLNO,0)="NOTE: Race and Ethnicity may be entered if permission is obtained in the informed consent",YSCLNO=YSCLNO+1
"RTN","YSCLTST5",91,0)
 . . S ^TMP("YSCL",$J,YSCLNO,0)="document. See VHA Directive 99-035.",YSCLNO=YSCLNO+1
"RTN","YSCLTST5",92,0)
 ;
"RTN","YSCLTST5",93,0)
 Q
"RTN","YSCLTST5",94,0)
GETINP ;Inpatient Medications
"RTN","YSCLTST5",95,0)
 Q:$$S^%ZTLOAD  D DEM^VADPT
"RTN","YSCLTST5",96,0)
 S YSCLX=$E($P(VADM(1),",",2))_$E(VADM(1))_"^"_$P(VADM(2),"^")
"RTN","YSCLTST5",97,0)
 S YSCLPHY="",$P(YSCLX,"^",6)=$P(YSCLDEMO,"^",5),$P(YSCLX,"^",11)=$G(YSCLC),$P(YSCLX,"^",16)=DT
"RTN","YSCLTST5",98,0)
 ;site zip(p6),registration number (p11), today (p16)
"RTN","YSCLTST5",99,0)
 S YSSTRT=$$GET1^DIQ(55.06,+PSGORD_","_DFN,10,"I"),YSSTOP=$$GET1^DIQ(55.06,+PSGORD_","_DFN,34,"I")
"RTN","YSCLTST5",100,0)
 ;S YSSTRT=$P($G(^PS(55,DFN,5,+PSGORD,2)),"^",2),YSSTOP=$P($G(^PS(55,DFN,5,+PSGORD,2)),"^",4)
"RTN","YSCLTST5",101,0)
 S PSJOR=$$GET1^DIQ(55.06,+PSGORD_","_DFN,66) ;$P($G(^PS(55,DFN,5,+PSGORD,0)),"^",21)
"RTN","YSCLTST5",102,0)
 Q
"RTN","YSCLTST5",103,0)
INPCHK ;for data to send
"RTN","YSCLTST5",104,0)
 S YSCLT=0,YSCLWBC=0
"RTN","YSCLTST5",105,0)
 S $P(YSSTOP,",",3)=3 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",106,0)
 K PNM,SEX,DOB,AGE,SSN D DEM^VADPT I 'VAERR S PNM=VADM(1),SEX=$P(VADM(5),U),DOB=$P(VADM(3),U),AGE=VADM(4),SSN=$P(VADM(2),U)
"RTN","YSCLTST5",107,0)
 I $G(PSGSD)=0,$$GET1^DIQ(55,DFN,54,"I")="P" Q  ;no transmit for pretreatment
"RTN","YSCLTST5",108,0)
 I $G(PSGSD),$G(PSGSD)<YSCLM180 Q  ;Don't report if over 6 months old.
"RTN","YSCLTST5",109,0)
 S YSCL=$O(YSCLA("")) I 'YSCL D LAB^YSCLTST1 S YSCLT=1  ;Q  ;get latest WBC results even if no script.
"RTN","YSCLTST5",110,0)
 S YSCLT=1,YSCLRXPR=$$GET1^DIQ(55.06,+PSGORD_","_DFN,1,"I") ;we've got provider
"RTN","YSCLTST5",111,0)
 N PSJWRD,PSJDIV,PSJINST S PSJWRD=$$GET1^DIQ(55.06,+PSGORD_","_DFN,68,"I")
"RTN","YSCLTST5",112,0)
 S:'PSJWRD PSJWRD=$$GET1^DIQ(5506,+PSGORD_","_DFN,9,"I")
"RTN","YSCLTST5",113,0)
 I PSJWRD S PSJINST=$$GET1^DIQ(42,PSJWRD,44,"I") I PSJINST S PSJDIV=$$GET1^DIQ(44,PSJINST,3,"I")
"RTN","YSCLTST5",114,0)
 S YSCLD=$G(PSJDIV) I YSCLD S $P(YSCLX,"^",10)=$$GET1^DIQ(4,YSCLD,52),$P(YSCLX,"^",12)=YSCLD
"RTN","YSCLTST5",115,0)
 ;site DEA# (p10), site pointer (p12)
"RTN","YSCLTST5",116,0)
 ;here if active
"RTN","YSCLTST5",117,0)
 I $$GET1^DIQ(55,DFN,54,"I")="A" S $P(YSCLX,"^",5)="A" ;force active
"RTN","YSCLTST5",118,0)
 S $P(YSCLX,"^",13)=1,$P(YSCLX,"^",9)=PSGLI\1
"RTN","YSCLTST5",119,0)
 I '$L($$GET1^DIQ(55.06,+PSGORD_","_DFN,301)),$G(^TMP("PSJCOM",$J,+$G(PSGORD),"SAND")) D
"RTN","YSCLTST5",120,0)
 .S DIE="^PS(55,"_DFN_",5,",DA(1)=DFN,DA=+PSGORD,DR="301////"_^TMP("PSJCOM",$J,+PSGORD,"SAND") D ^DIE
"RTN","YSCLTST5",121,0)
 S $P(YSCLX,"^",8)=+$$GET1^DIQ(55.06,+PSGORD_","_DFN,301)
"RTN","YSCLTST5",122,0)
 ;status(p5),dosage(p8),rx count(p13),issue date(p9)
"RTN","YSCLTST5",123,0)
 S YSCLLO=$O(^PS(53.8,"A",+$G(PSJOR),0)) I YSCLLO D
"RTN","YSCLTST5",124,0)
 .S $P(YSCLX,"^",14)=$$GET1^DIQ(53.8,YSCLLO,4,"I")
"RTN","YSCLTST5",125,0)
 .S:$P(YSCLX,"^",14)=9 $P(YSCLX,"^",14)=94
"RTN","YSCLTST5",126,0)
 .S $P(YSCLX,"^",15)=$$GET1^DIQ(53.8,YSCLLO,3)       ;$P(^VA(200,YSCLLO,0),"^")
"RTN","YSCLTST5",127,0)
 ;lockout reason (p14), approving official (p15)
"RTN","YSCLTST5",128,0)
 S $P(YSSTOP,",",4)=4 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",129,0)
 S YSCLPHY=$$GET1^DIQ(200,+YSCLRXPR,.01),$P(YSCLX,"^",7)=$$GET1^DIQ(200,+YSCLRXPR,53.2)  ;,YSCLPHY=$P(YSCLPHY,"^")
"RTN","YSCLTST5",130,0)
 ; add if prescription on same day for different drug and different dose
"RTN","YSCLTST5",131,0)
 S $P(YSCLX,"^",21)=$$GET1^DIQ(50,+PSGDN,31)  ;$P(^PSDRUG(+PSGDN,2),"^",4) ;Add NDC to string
"RTN","YSCLTST5",132,0)
 S YCLSCNTR=YCLSCNTR+1
"RTN","YSCLTST5",133,0)
 I $D(^XTMP("YSCLTRN",DT,DFN,PSGLI)) D
"RTN","YSCLTST5",134,0)
 .S PSGTIM=PSGLI+.000001,PSHLI1=PSGTIM
"RTN","YSCLTST5",135,0)
 .I $D(^XTMP("YSCLTRN",DT,DFN,PSGTIM)) D
"RTN","YSCLTST5",136,0)
 ..S PSHLI2=0 F  S PSHLI2=$O(^XTMP("YSCLTRN",DT,DFN,PSHLI2)) Q:'PSHLI2  D
"RTN","YSCLTST5",137,0)
 ...I $P(PSHLI2,".",1)=$P(PSGTIM,".",1) D
"RTN","YSCLTST5",138,0)
 ....I $P(PSHLI2,".",2)<$P(PSGTIM,".",2)!($P(PSHLI2,".",2)=$P(PSGTIM,".",2)) S (PSHLI1,PSGTIM)=PSHLI2+.000001
"RTN","YSCLTST5",139,0)
 I $G(PSGTIM) N PSGLI S (PSGLI,PSGLI1)=PSGTIM
"RTN","YSCLTST5",140,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSGLI,0)=0_"^I^"_PSJOR
"RTN","YSCLTST5",141,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSGLI,YCLSCNTR)=YSCLX
"RTN","YSCLTST5",142,0)
 Q
"RTN","YSCLTST5",143,0)
LOAD ;
"RTN","YSCLTST5",144,0)
 S $P(YSSTOP,",",6)=6 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",145,0)
 I YSCLWBC="",YSCLLD<YSCLM28 Q
"RTN","YSCLTST5",146,0)
 ; don't send for pretest or older that 28 days
"RTN","YSCLTST5",147,0)
 S YSCLNSTE=$P(YSCLX,"^",12)
"RTN","YSCLTST5",148,0)
 S YSCLNST1=$P($$SITE^VASITE,"^",2),YSCLNSTE=$P($$SITE^VASITE,"^",3)
"RTN","YSCLTST5",149,0)
 S YSCLLN=YSCLLN+1,$P(YSCLX,"^",18)=YSCLRET,^TMP($J,YSCLLN,0)=YSCLX,YSCLLN=YSCLLN+1,^TMP($J,YSCLLN,0)=YSCLPHY_"^"_YSCLDEMO_"^"_YSCLNSTE_"^"_YSCLNST1
"RTN","YSCLTST5",150,0)
 I $G(PSGLI1) N PSGLI S PSGLI=PSGLI1
"RTN","YSCLTST5",151,0)
Z2 I $D(^TMP($J,YSCLLN,0)) D
"RTN","YSCLTST5",152,0)
 .S YCLSCNTR=YCLSCNTR+1,^XTMP("YSCLTRN",DT,DFN,PSGLI,YCLSCNTR)=^TMP($J,YSCLLN,0)
"RTN","YSCLTST5",153,0)
 ;site number and name
"RTN","YSCLTST5",154,0)
 S YSCLLLN=YSCLLLN+1,^TMP("YSCL",$J,YSCLLLN,0)=$P(^DPT(DFN,0),"^",9)_"   "_$P(^(0),"^")_"  (R) "_$S($P(YSCLX,"^",13)="":"NO RX   ",1:$$FMTE^XLFDT($P(YSCLX,"^",9),"D"))_" (W) "
"RTN","YSCLTST5",155,0)
 S ^TMP("YSCL",$J,YSCLLLN,0)=^TMP("YSCL",$J,YSCLLLN,0)_$S($P(YSCLX,"^",3)="":"NO WBC   ",1:$$FMTE^XLFDT($P(YSCLX,"^",3),"D"))_" (N) "_$S($P(YSCLX,"^",20)="":"NO NEUT  ",1:$$FMTE^XLFDT($P(YSCLX,"^",19),"D")) ;Q
"RTN","YSCLTST5",156,0)
 I $D(^TMP("YSCL",$J)) D
"RTN","YSCLTST5",157,0)
 .S YCLSCNTR=YCLSCNTR+1,^XTMP("YSCLTRN",DT,DFN,PSGLI,YCLSCNTR)=$G(^TMP("YSCL",$J,YSCLLLN,0)) K PSGLI1
"RTN","YSCLTST5",158,0)
 ;9the piece for issue date, 16th piece for WBC date ;RLM 06/16/05
"RTN","YSCLTST5",159,0)
 S ^XTMP("YSCLTRN",DT,0)=+$G(^XTMP("YSCLTRN",DT,0))+1
"RTN","YSCLTST5",160,0)
 Q
"RTN","YSCLTST5",161,0)
DOSE ; GET DOSE
"RTN","YSCLTST5",162,0)
 N YSCLPS55,YSCLPTR,YSCLDFN,YSCLDOSE
"RTN","YSCLTST5",163,0)
 S YSCLPS55=+$$GET1^DIQ(100,+PSJOR,33),PSJDOSE=0,YSCLDFN=DFN    ;+$G(^OR(100,+PSJOR,4))
"RTN","YSCLTST5",164,0)
 S YSCLDOSE=$$GET1^DIQ(55.06,YSCLPS55_","_DFN,120)
"RTN","YSCLTST5",165,0)
 N ARRAY D LIST^DIC(55.07,","_YSCLPS55_","_DFN_",",.02,"I",,,,,,,"ARRAY")
"RTN","YSCLTST5",166,0)
 F YSCLPTR=1:1 Q:'$D(ARRAY("DILIST","ID",YSCLPTR))  D
"RTN","YSCLTST5",167,0)
 .S PSJDOSE=PSJDOSE+(ARRAY("DILIST","ID",YSCLPTR,.02)*YSCLDOSE)
"RTN","YSCLTST5",168,0)
 .D FRQ S PSJDOSE=PSJDOSE*PSJFRQ
"RTN","YSCLTST5",169,0)
 Q
"RTN","YSCLTST5",170,0)
FRQ ; GET ADMIN FREQUENCY
"RTN","YSCLTST5",171,0)
 N PSJDI
"RTN","YSCLTST5",172,0)
 S PSJFRQ(0)=+$$GET1^DIQ(55.06,YSCLPS55_","_YSCLDFN_",",42)
"RTN","YSCLTST5",173,0)
 I 'PSJFRQ(0) D   ;Get administration times
"RTN","YSCLTST5",174,0)
 .S PSJFRQ=+$$GET1^DIQ(55.06,YSCLPS55_","_YSCLDFN_",",41)
"RTN","YSCLTST5",175,0)
 .I $$GET1^DIQ(55.06,YSCLPS55_","_YSCLDFN_",",26)["@" D  ; CHECK FOR @ IN DAY OF WEEK SCHEDULE
"RTN","YSCLTST5",176,0)
 .. S PSJFRQ(0)=1440/$L(PSJFRQ,"-") Q                  ; THEN CALCULATE CORRECT FRUENCY
"RTN","YSCLTST5",177,0)
 . Q:+$G(PSJFRQ(0))
"RTN","YSCLTST5",178,0)
 . I '$L($TR(PSJFRQ,"0123456789-")) Q          ; no good - we have non numeric characters
"RTN","YSCLTST5",179,0)
 . F PSJDI=1:1:$L(PSJFRQ,"-") I $P(PSJFRQ,"-",PSJDI)]"" D      ; If we have data in the piece
"RTN","YSCLTST5",180,0)
 .. I $L($P(PSJFRQ,"-",PSJDI))>2,$L($P(PSJFRQ,"-",PSJDI))<5                                         ;
"RTN","YSCLTST5",181,0)
 .. E  S PSJFRQ="" Q                                        ; only allow 3 or 4 digits
"RTN","YSCLTST5",182,0)
 .. I $L($P(PSJFRQ,"-",PSJDI))=4 D  Q
"RTN","YSCLTST5",183,0)
 ... I $E($P(PSJFRQ,"-",PSJDI),3,4)<60,$E($P(PSJFRQ,"-",PSJDI),1,2)<25 S PSJFRQ(0)=1+PSJFRQ(0) Q
"RTN","YSCLTST5",184,0)
 ... S PSJFRQ="" Q                                          ; Out of range
"RTN","YSCLTST5",185,0)
 .. I $L($P(PSJFRQ,"-",PSJDI))=3,$E($P(PSJFRQ,"-",PSJDI),2,3)<60 S PSJFRQ(0)=1+PSJFRQ(0) Q
"RTN","YSCLTST5",186,0)
 .. S PSJFRQ="" Q                                     ; Out of range
"RTN","YSCLTST5",187,0)
 S:PSJFRQ(0)=0 PSJFRQ(0)=1440
"RTN","YSCLTST5",188,0)
 S PSJFRQ=1440/PSJFRQ(0)
"RTN","YSCLTST5",189,0)
 Q
"RTN","YSCLTST5",190,0)
XMIT ;
"RTN","YSCLTST5",191,0)
 D START^YSCLDIS ; THIS WILL CHECK FOR CLOZAPINE PATIENTS THAT NEED TO BE DISCONTINUED AND DISCONTIUNE THEM & SEND MESSAGE TO NCCC
"RTN","YSCLTST5",192,0)
 N YSCLDT,YSCLTRDT ;D NOW^%DTC S YSCLDT=%-1
"RTN","YSCLTST5",193,0)
 S YSCLLST=$P($G(^XTMP("YSCLDEM",0)),"^",4),YSCLTRDT=$P(YSCLLST,".",1)
"RTN","YSCLTST5",194,0)
REXMIT ;
"RTN","YSCLTST5",195,0)
 N YSCLDT S %DT="T",X="N-1" D ^%DT S YSCLDT=Y  ;D NOW^%DTC S YSCLDT=%-1
"RTN","YSCLTST5",196,0)
 I $O(^XTMP("YSCLDEM",YSCLTRDT)) D
"RTN","YSCLTST5",197,0)
 .;/RBN Begin modification for retransmit
"RTN","YSCLTST5",198,0)
 .I $G(YSCLREX) N DT S DT=YSCLEDDT
"RTN","YSCLTST5",199,0)
 .;/RBN End modification for retransmit
"RTN","YSCLTST5",200,0)
 .N DFN,PSDFN,VA,VACNTRY,VADM,VAERR,VAPA,XMDUN,XMDUZ,XMZ,Y,YSCL,YSCLDEA,YSCLGL,YSCLJ,YSCLEND
"RTN","YSCLTST5",201,0)
 .N YSCLLN,YSCLORD,YSCLP,YSCLX,YSRACE,YSRC,YSDEBUG,YSCLIEN,YSSTOP,YSCLC,YSCLCNTR,YSCLNO
"RTN","YSCLTST5",202,0)
 .F  S YSCLTRDT=$O(^XTMP("YSCLDEM",YSCLTRDT)) Q:'YSCLTRDT!(YSCLTRDT'<DT)  D
"RTN","YSCLTST5",203,0)
 ..S YSDEBUG=$$GET1^DIQ(603.03,1,3,"I")  ;$P(^YSCL(603.03,1,0),"^",3)
"RTN","YSCLTST5",204,0)
 ..K ^TMP($J),^TMP("YSCL",$J),^TMP("YSCLL",$J) S (YSCLIEN,YSCLLN)=0,YSCLNO=20
"RTN","YSCLTST5",205,0)
 ..S YSCLCNTR=0,YSCLC=""  ; set YSCLC, may not get value from FM call
"RTN","YSCLTST5",206,0)
 ..S DFN=0 F  S DFN=$O(^XTMP("YSCLDEM",YSCLTRDT,DFN)) Q:'DFN  D
"RTN","YSCLTST5",207,0)
 ...S YSCLIEN=$O(^YSCL(603.01,"C",DFN,0)) Q:'YSCLIEN
"RTN","YSCLTST5",208,0)
 ...S $P(YSSTOP,",",8)=8 Q:$$S^%ZTLOAD
"RTN","YSCLTST5",209,0)
 ...I $L($$GET1^DIQ(2,DFN,.01)) S YSCLC=$$GET1^DIQ(603.01,YSCLIEN,.01) D GET
"RTN","YSCLTST5",210,0)
 ...S ^XTMP("YSCLDEM",YSCLTRDT,DFN,0)=1,YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST5",211,0)
 ..D TRANSMIT^YSCLTST3:YSCLLN
"RTN","YSCLTST5",212,0)
 ..S ^XTMP("YSCLDEM",YSCLTRDT)=YSCLCNTR
"RTN","YSCLTST5",213,0)
 ..K ^TMP("YSCLL",$J),^TMP("YSCL",$J)
"RTN","YSCLTST5",214,0)
 .S $P(^XTMP("YSCLDEM",0),"^",4)=YSCLDT
"RTN","YSCLTST5",215,0)
 ;
"RTN","YSCLTST5",216,0)
 S YSCLCT=4,YSCLCNTR=1
"RTN","YSCLTST5",217,0)
 ;RBN Modificaton for retransmit
"RTN","YSCLTST5",218,0)
 I '$G(YSCLREX) S YSCLTRDT=$P($P($G(^XTMP("YSCLTRN",0)),"^",4),"."),YSCLEND=DT
"RTN","YSCLTST5",219,0)
 E  S YSCLTRDT=YSCLSTDT,YSCLEND=YSCLEDDT
"RTN","YSCLTST5",220,0)
 ;RBN End modification for retransmit
"RTN","YSCLTST5",221,0)
 I $O(^XTMP("YSCLTRN",YSCLTRDT)) D
"RTN","YSCLTST5",222,0)
 .F  S YSCLTRDT=$O(^XTMP("YSCLTRN",YSCLTRDT)) Q:'YSCLTRDT!(YSCLTRDT'<YSCLEND)  D
"RTN","YSCLTST5",223,0)
 ..S YSCLCNTR=1
"RTN","YSCLTST5",224,0)
 ..D ORDBLD
"RTN","YSCLTST5",225,0)
 ..S YSCLLN=$G(^XTMP("YSCLTRN",YSCLTRDT,0)) D TRANSMIT^YSCLTST2
"RTN","YSCLTST5",226,0)
 ..I $G(YSCLREX) S DT=YSCLEDDT
"RTN","YSCLTST5",227,0)
 ..S ^XTMP("YSCLTRN",YSCLTRDT)=1
"RTN","YSCLTST5",228,0)
 ..K ^TMP("YSCLL",$J),^TMP("YSCL",$J)
"RTN","YSCLTST5",229,0)
 .S $P(^XTMP("YSCLTRN",0),"^",4)=YSCLDT
"RTN","YSCLTST5",230,0)
 Q
"RTN","YSCLTST5",231,0)
 ;
"RTN","YSCLTST5",232,0)
ORDBLD ;
"RTN","YSCLTST5",233,0)
 N YSCLDFN,YSCLCNT ;,YSCLCT
"RTN","YSCLTST5",234,0)
 S YSCLDFN=0 F  S YSCLDFN=$O(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN)) Q:'YSCLDFN  D
"RTN","YSCLTST5",235,0)
 .S YSCLORD=0 F  S YSCLORD=$O(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD)) Q:'YSCLORD!(YSCLORD>DT)  D
"RTN","YSCLTST5",236,0)
 ..S YSCLCNT=0 F  S YSCLCNT=$O(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)) Q:'YSCLCNT  D
"RTN","YSCLTST5",237,0)
 ...S:YSCLCNT=1 ^TMP($J,YSCLCNTR,0)=$G(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)),^TMP($J,YSCLCNTR,0)=$G(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)),YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST5",238,0)
 ...S:YSCLCNT=2 ^TMP($J,YSCLCNTR,0)=$G(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)),^TMP($J,YSCLCNTR,0)=$G(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)),YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST5",239,0)
 ...S:YSCLCNT=3 ^TMP("YSCL",$J,YSCLCT,0)=$G(^XTMP("YSCLTRN",YSCLTRDT,YSCLDFN,YSCLORD,YSCLCNT)),YSCLCT=YSCLCT+1
"RTN","YSCLTST5",240,0)
 Q
"RTN","YSCLTST5",241,0)
 ;
"RTN","YSCLTST5",242,0)
REX ; Alternate retransmit
"RTN","YSCLTST5",243,0)
  ; First get the date range to be resent
"RTN","YSCLTST5",244,0)
  N DA,DATE,DFN,DIR,DTRUT,YSCLREX,X,Y,YSCLCT,YSCLDT,YSCLLN,YSCLTRDT,YSCLEDDT,YSCLSTDT
"RTN","YSCLTST5",245,0)
  K ^TMP($J),^TMP("YSCL")
"RTN","YSCLTST5",246,0)
  S DIR(0)="D"
"RTN","YSCLTST5",247,0)
  S DIR("A")="Enter the starting date"
"RTN","YSCLTST5",248,0)
  S DIR("?",1)="Enter the starting date of the orders you want"
"RTN","YSCLTST5",249,0)
  S DIR("?")="to retransmit"
"RTN","YSCLTST5",250,0)
  D ^DIR
"RTN","YSCLTST5",251,0)
  I $D(DIRUT) W !,"Aborting retransmit",! Q
"RTN","YSCLTST5",252,0)
  S YSCLSTDT=Y
"RTN","YSCLTST5",253,0)
  K Y
"RTN","YSCLTST5",254,0)
  S DIR("A")="Enter the ending date"
"RTN","YSCLTST5",255,0)
  S DIR("?",1)="Enter the ending date of the orders you want"
"RTN","YSCLTST5",256,0)
  S DIR("?")="to retransmit"
"RTN","YSCLTST5",257,0)
  D ^DIR
"RTN","YSCLTST5",258,0)
  I $D(DIRUT) W !,"Aborting retransmit",! Q
"RTN","YSCLTST5",259,0)
  S YSCLEDDT=Y
"RTN","YSCLTST5",260,0)
  S X1=YSCLEDDT,X2=YSCLSTDT D ^%DTC I X<0 W !,"The ending date cannot be before the start date!",! G REX
"RTN","YSCLTST5",261,0)
  ;
"RTN","YSCLTST5",262,0)
  ;D NOW^%DTC S YSCLDT=%-1
"RTN","YSCLTST5",263,0)
  S YSCLREX=1
"RTN","YSCLTST5",264,0)
  S X1=YSCLSTDT,X2=-1 D C^%DTC S YSCLSTDT=X
"RTN","YSCLTST5",265,0)
  S YSCLTRDT=YSCLSTDT,X1=YSCLEDDT,X2=1 D C^%DTC S YSCLEDDT=X
"RTN","YSCLTST5",266,0)
  D REXMIT
"RTN","YSCLTST5",267,0)
  Q
"RTN","YSCLTST6")
0^6^B35479087
"RTN","YSCLTST6",1,0)
YSCLTST6 ;HINOI/RBN-TRANSMISSION FOR REAL-TIME CLOZAPINE ORDERS (OUTPATIENT ;10 May 2019 12:09:40
"RTN","YSCLTST6",2,0)
 ;;5.01;MENTAL HEALTH;**122**;Dec 30, 1994;Build 112
"RTN","YSCLTST6",3,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","YSCLTST6",4,0)
 ; Reference to ^PSRX supported by IA #780
"RTN","YSCLTST6",5,0)
 ; Reference to ^PS(52.52 supported by IA #782
"RTN","YSCLTST6",6,0)
 ; Reference to ^PS(55 supported by IA #787
"RTN","YSCLTST6",7,0)
 ; Reference to ^VA(200 supported by IA #10060
"RTN","YSCLTST6",8,0)
 ; Reference to ^DPT supported by IA #10035
"RTN","YSCLTST6",9,0)
 ; Reference to ^DIC supported by DBIA #2051
"RTN","YSCLTST6",10,0)
 ; Reference to ^DIE supported by DBIA #2053
"RTN","YSCLTST6",11,0)
 ; Reference to ^DIQ supported by DBIA #2056
"RTN","YSCLTST6",12,0)
 ; Reference to ^VADPT supported by DBIA #10061
"RTN","YSCLTST6",13,0)
 ; Reference to ^XLFDT supported by DBIA #10103
"RTN","YSCLTST6",14,0)
 ; Reference to ^%ZTLOAD supported by DBIA #10063
"RTN","YSCLTST6",15,0)
 ; Reference to ^%DTC supported by DBIA #10000
"RTN","YSCLTST6",16,0)
 ;
"RTN","YSCLTST6",17,0)
 ; Build outpatient clozapine data for transmision
"RTN","YSCLTST6",18,0)
 N PSOPAT,PSOIOF,YSCLCNTR,YSCLDFN,YSEND,X,X1,X2
"RTN","YSCLTST6",19,0)
 S YSCLRET=""
"RTN","YSCLTST6",20,0)
 S PSOPAT=DFN
"RTN","YSCLTST6",21,0)
 S PSODFN=DFN
"RTN","YSCLTST6",22,0)
 S PSOIOF=IOF
"RTN","YSCLTST6",23,0)
 S YSCLCNTR=0
"RTN","YSCLTST6",24,0)
 S X1=DT,X2=365 D C^%DTC S YSEND=X
"RTN","YSCLTST6",25,0)
 S $P(^XTMP("YSCLTRN",0),"^",1)=YSEND,$P(^XTMP("YSCLTRN",0),"^",2)=DT ;_"^CLOZAPINE DAILY ROLLUP DATA"
"RTN","YSCLTST6",26,0)
 S:'$G(^XTMP("YSCLTRN",DT)) ^XTMP("YSCLTRN",DT)=0
"RTN","YSCLTST6",27,0)
 ; Get patient and facility demographic data
"RTN","YSCLTST6",28,0)
 D DMG^YSCLTST5
"RTN","YSCLTST6",29,0)
 D DMG1^YSCLTST5
"RTN","YSCLTST6",30,0)
 D GET^YSCLTST5
"RTN","YSCLTST6",31,0)
 S DFN=PSODFN
"RTN","YSCLTST6",32,0)
 S YSCL1=PSONEW("IRXN")
"RTN","YSCLTST6",33,0)
 S YSCLLD=PSOX("STOP DATE")
"RTN","YSCLTST6",34,0)
 D CHECK
"RTN","YSCLTST6",35,0)
 D LOAD
"RTN","YSCLTST6",36,0)
 S IOF=PSOIOF
"RTN","YSCLTST6",37,0)
 D END
"RTN","YSCLTST6",38,0)
 Q
"RTN","YSCLTST6",39,0)
 ;
"RTN","YSCLTST6",40,0)
CHECK ;for data to send
"RTN","YSCLTST6",41,0)
 K ^TMP($J),^TMP("YSCL",$J) D DEM^VADPT
"RTN","YSCLTST6",42,0)
 S YSCLX=$E($P(VADM(1),",",2))_$E(VADM(1))_"^"_$P(VADM(2),"^")
"RTN","YSCLTST6",43,0)
 S YSCLPHY="",$P(YSCLX,"^",6)=$P(YSCLDEMO,"^",5),$P(YSCLX,"^",16)=DT
"RTN","YSCLTST6",44,0)
 N ARRAY D LIST^DIC(603.01,,1,"I",,,DFN,"C",,,"ARRAY")
"RTN","YSCLTST6",45,0)
 S YSCLT=0,$P(YSCLX,"^",11)=$G(ARRAY("DILIST","ID",1,.01))
"RTN","YSCLTST6",46,0)
 S $P(YSSTOP,",",3)=3 Q:$$S^%ZTLOAD
"RTN","YSCLTST6",47,0)
 S YSCLLD=+$$GET1^DIQ(55,DFN,58,"I") ;$P(^PS(55,DFN,"SAND"),U,6) ;/RBN ADDED 04/12/2016
"RTN","YSCLTST6",48,0)
 K PNM,SEX,DOB,AGE,SSN I 'VAERR S PNM=VADM(1),SEX=$P(VADM(5),U),DOB=$P(VADM(3),U),AGE=VADM(4),SSN=$P(VADM(2),U)
"RTN","YSCLTST6",49,0)
 I YSCLLD=0,$$GET1^DIQ(55,DFN,54,"I")="P" Q  ;no transmit for pretreatment
"RTN","YSCLTST6",50,0)
 S YSCLT=1,YSCLRX=$$GET1^DIQ(52,YSCL1,4,"I") ;we've got Provider
"RTN","YSCLTST6",51,0)
 S YSCL=$O(YSCLA("")) I 'YSCL D LAB S YSCLT=1
"RTN","YSCLTST6",52,0)
 S YSCLD=+$$GET1^DIQ(52,YSCL1,20,"I"),$P(YSCLX,"^",10)=$$GET1^DIQ(59,YSCLD,1),$P(YSCLX,"^",12)=$$GET1^DIQ(59,YSCLD,2)
"RTN","YSCLTST6",53,0)
 ;site DEA# (p10), site pointer (p12)
"RTN","YSCLTST6",54,0)
 ;here if active
"RTN","YSCLTST6",55,0)
 S $P(YSCLX,"^",5)="A"  ;,$P(^PS(55,DFN,"SAND"),"^",2)="A" ;force active
"RTN","YSCLTST6",56,0)
 S $P(YSCLX,"^",13)=1,$P(YSCLX,"^",9)=$$GET1^DIQ(52,YSCL1,1,"I")
"RTN","YSCLTST6",57,0)
 K YSCLD1 D GETS^DIQ(52,YSCL1,"301;302;303;304","I","YSCLD1")
"RTN","YSCLTST6",58,0)
 I $D(YSCLD1) N REC D  K YSCLD1 S YSCLD1=REC
"RTN","YSCLTST6",59,0)
 .S REC="" F I=301:1:304 S REC=REC_YSCLD1(52,YSCL1_",",I,"I")_"^"
"RTN","YSCLTST6",60,0)
 ;/MZR Begin modifications for 'New Order Created by editing'
"RTN","YSCLTST6",61,0)
 I '$D(YSCLD1),$$GET1^DIQ(52,YSCL1,12)["New Order Created by editing Rx # " D
"RTN","YSCLTST6",62,0)
 .N PHRX,PHRX0,ARR,YSCLD2 S PHRX=YSCL1
"RTN","YSCLTST6",63,0)
 .F  Q:$$GET1^DIQ(52,PHRX,12)'["New Order Created by editing Rx # "!$L($$GET1^DIQ(52,PHRX,301))  D
"RTN","YSCLTST6",64,0)
 ..S PHRX0=+$P($$GET1^DIQ(52,PHRX,12),"Rx # ",2)
"RTN","YSCLTST6",65,0)
 ..I $L($$GET1^DIQ(52,PHRX0,.01)) S ARR(PHRX0,PHRX)="",PHRX=PHRX0 Q
"RTN","YSCLTST6",66,0)
 .I $L($$GET1^DIQ(52,PHRX,301)) N REC D  K YSCLD1 S YSCLD1=REC
"RTN","YSCLTST6",67,0)
 ..D GETS^DIQ(52,PHRX,"301;302;303;304","I","YSCLD1")
"RTN","YSCLTST6",68,0)
 ..S REC="" F I=301:1:304 S REC=REC_YSCLD1(52,PHRX_",",I,"I")_"^"
"RTN","YSCLTST6",69,0)
 ..F  S PHRX0=$O(ARR(PHRX,"")) Q:PHRX0=""  D  S PHRX=PHRX0
"RTN","YSCLTST6",70,0)
 ...S DIE="^PSRX(",DA=PHRX0,DR="" F I=1:1:4 S DR=DR_(300+I)_"////"_$P(REC,"^",I)_";"
"RTN","YSCLTST6",71,0)
 ...D ^DIE
"RTN","YSCLTST6",72,0)
 ;/MZR End modifications for 'New Order Created by editing'
"RTN","YSCLTST6",73,0)
 S $P(YSCLX,"^",8)=+YSCLD1
"RTN","YSCLTST6",74,0)
 ;status(p5),dosage(p8),rx count(p13),issue date(p9)
"RTN","YSCLTST6",75,0)
 K ARRAY D LIST^DIC(52.52,,"3;4;5","I",,,YSCL1,"A",,,"ARRAY")
"RTN","YSCLTST6",76,0)
 I $D(ARRAY("DILIDT","ID",1)) S $P(YSCLX,"^",14)=$G(ARRAY("DILIST","ID",1,4)) D
"RTN","YSCLTST6",77,0)
 .I ARRAY("DILIST","ID",1,4)=9  D
"RTN","YSCLTST6",78,0)
 ..N YSCLTMP6 S YSCLTMP6=ARRAY("DILIST","ID",1,5)
"RTN","YSCLTST6",79,0)
 ..I YSCLTMP6["Weather Related Conditions" S $P(YSCLX,"^",14)=91
"RTN","YSCLTST6",80,0)
 ..I YSCLTMP6["Mail Order Delay" S $P(YSCLX,"^",14)=92
"RTN","YSCLTST6",81,0)
 ..I YSCLTMP6["Inpatient Going On Leave" S $P(YSCLX,"^",14)=93
"RTN","YSCLTST6",82,0)
 .S YSCLLO=+ARRAY("DILIST","ID",1,3),$P(YSCLX,"^",15)=$$GET1^DIQ(200,YSCLLO,.01)
"RTN","YSCLTST6",83,0)
 ;lockout reason (p14), approving official (p15)
"RTN","YSCLTST6",84,0)
 S $P(YSSTOP,",",4)=4 Q:$$S^%ZTLOAD
"RTN","YSCLTST6",85,0)
 S YSCLPHY=$$GET1^DIQ(200,+YSCLRX,.01),$P(YSCLX,"^",7)=$$GET1^DIQ(200,+YSCLRX,53.2)  ;,YSCLPHY=$P(YSCLPHY,"^")
"RTN","YSCLTST6",86,0)
 S $P(YSCLX,"^",4)=$P(YSCLD1,"^",2),$P(YSCLX,"^",3)=$P(YSCLD1,"^",3) I $P(YSCLD1,"^",2)]"",$P(YSCLD1,"^",3)'>YSCLED,$P(YSCLD1,"^",3)'<YSCLM7 S YSCLWBC=1
"RTN","YSCLTST6",87,0)
 ;wbc(p4),date(p3)
"RTN","YSCLTST6",88,0)
 ; add if prescription on same day for different drug and different dose
"RTN","YSCLTST6",89,0)
 S $P(YSCLX,"^",21)=$$GET1^DIQ(52,YSCL1,27) ;Add NDC to string
"RTN","YSCLTST6",90,0)
 N PSORD S PSORD=$$GET1^DIQ(52,YSCL1,39.3,"I") S:'PSORD PSORD=YSCL1
"RTN","YSCLTST6",91,0)
 S PSOLOGDT=PSOX("LOGIN DATE")
"RTN","YSCLTST6",92,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSOLOGDT,YSCLCNTR)="0^O^"_PSORD
"RTN","YSCLTST6",93,0)
 S YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST6",94,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSOLOGDT,YSCLCNTR)=YSCLX
"RTN","YSCLTST6",95,0)
 Q
"RTN","YSCLTST6",96,0)
 ;
"RTN","YSCLTST6",97,0)
ORDSET(PSORD) ; Setting and Order # instead of PSRX #
"RTN","YSCLTST6",98,0)
 S $P(^XTMP("YSCLTRN",DT,DFN,PSOLOGDT,0),"^",3)=PSORD
"RTN","YSCLTST6",99,0)
 Q
"RTN","YSCLTST6",100,0)
 ;
"RTN","YSCLTST6",101,0)
LAB ;get most recent
"RTN","YSCLTST6",102,0)
 S $P(YSSTOP,",",5)=5 Q:$$S^%ZTLOAD
"RTN","YSCLTST6",103,0)
 S YSCLLDT="",J=9999998-YSCLED,K=9999998-YSCLM7 I $P(YSCLX,"^",9) S J=9999998-$P(YSCLX,"^",9)
"RTN","YSCLTST6",104,0)
 S YSCLR=$$CL^YSCLTST2(DFN) D  ;Set 3,4,17,19,20,22,23
"RTN","YSCLTST6",105,0)
 . S $P(YSCLX,"^",3)=$P(YSCLR,"^",6)  ;WBC Date
"RTN","YSCLTST6",106,0)
 . S $P(YSCLX,"^",4)=$P(YSCLR,"^",2)  ;WBC Results
"RTN","YSCLTST6",107,0)
 . S $P(YSCLX,"^",19)=$P(YSCLR,"^",6) ;ANC Date
"RTN","YSCLTST6",108,0)
 . S $P(YSCLX,"^",20)=$P(YSCLR,"^",4) ;ANC Results
"RTN","YSCLTST6",109,0)
 . S $P(YSCLX,"^",22)=$P(YSCLR,"^",3) ;WBC Name
"RTN","YSCLTST6",110,0)
 . S $P(YSCLX,"^",23)=$P(YSCLR,"^",5) ;ANC Name
"RTN","YSCLTST6",111,0)
 Q
"RTN","YSCLTST6",112,0)
 ;
"RTN","YSCLTST6",113,0)
LOAD ;
"RTN","YSCLTST6",114,0)
 S $P(YSSTOP,",",6)=6 Q:$$S^%ZTLOAD
"RTN","YSCLTST6",115,0)
 S YSCLNST1=$P($$SITE^VASITE,"^",2),YSCLNSTE=$P($$SITE^VASITE,"^",3)
"RTN","YSCLTST6",116,0)
 S YSCLLN=YSCLLN+1,$P(YSCLX,"^",18)=YSCLRET,^TMP($J,YSCLLN,0)=YSCLX,YSCLLN=YSCLLN+1,^TMP($J,YSCLLN,0)=YSCLPHY_"^"_YSCLDEMO_"^"_YSCLNSTE_"^"_YSCLNST1
"RTN","YSCLTST6",117,0)
 S YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST6",118,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSOX("LOGIN DATE"),YSCLCNTR)=^TMP($J,YSCLLN,0)
"RTN","YSCLTST6",119,0)
 ;site number and name
"RTN","YSCLTST6",120,0)
 S YSCLLLN=YSCLLLN+1,^TMP("YSCL",$J,YSCLLLN,0)=$P(^DPT(DFN,0),"^",9)_"   "_$P(^(0),"^")_"  (R) "_$S($P(YSCLX,"^",13)="":"NO RX   ",1:$$FMTE^XLFDT($P(YSCLX,"^",9),"D"))_" (W) "
"RTN","YSCLTST6",121,0)
 S ^TMP("YSCL",$J,YSCLLLN,0)=^TMP("YSCL",$J,YSCLLLN,0)_$S($P(YSCLX,"^",3)="":"NO WBC   ",1:$$FMTE^XLFDT($P(YSCLX,"^",3),"D"))_" (N) "_$S($P(YSCLX,"^",20)="":"NO NEUT  ",1:$$FMTE^XLFDT($P(YSCLX,"^",19),"D"))
"RTN","YSCLTST6",122,0)
 S YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST6",123,0)
 S ^XTMP("YSCLTRN",DT,DFN,PSOX("LOGIN DATE"),YSCLCNTR)=^TMP("YSCL",$J,YSCLLLN,0)
"RTN","YSCLTST6",124,0)
 ; Increment the counter for the date and the given patient
"RTN","YSCLTST6",125,0)
 S YSCLCNTR=YSCLCNTR+1
"RTN","YSCLTST6",126,0)
 S ^XTMP("YSCLTRN",DT,0)=+$G(^XTMP("YSCLTRN",DT,0))+1
"RTN","YSCLTST6",127,0)
 Q
"RTN","YSCLTST6",128,0)
 ;
"RTN","YSCLTST6",129,0)
END ; Clean up
"RTN","YSCLTST6",130,0)
 K ^TMP("YSCL",$J),^TMP("YSCLL",$J)
"RTN","YSCLTST6",131,0)
 Q
"RTN","YSCLTST6",132,0)
 ;
"VER")
8.0^22.2
"^DD",603.03,603.03,8,0)
RX LAB PROD LISTENER^FJ40^^0;7^K:$L(X)>40!($L(X)<5) X
"^DD",603.03,603.03,8,3)
Answer must be 5-40 characters in length.
"^DD",603.03,603.03,8,21,0)
^^2^2^3170509^
"^DD",603.03,603.03,8,21,1,0)
This is the server address where the Clozapine order information and 
"^DD",603.03,603.03,8,21,2,0)
patient blood test results get sent
"^DD",603.03,603.03,8,"DT")
3170509
"^DD",603.03,603.03,9,0)
DEMOGRAPHIC PROD LISTENER^FJ40^^0;8^K:$L(X)>40!($L(X)<5) X
"^DD",603.03,603.03,9,3)
Answer must be 5-40 characters in length.
"^DD",603.03,603.03,9,21,0)
^^2^2^3170509^
"^DD",603.03,603.03,9,21,1,0)
This is the server address where the Clozapine Patient demographic 
"^DD",603.03,603.03,9,21,2,0)
information get sent
"^DD",603.03,603.03,9,"DT")
3170509
"^DD",603.03,603.03,10,0)
RX LAB TEST LISTENER^FJ40^^0;9^K:$L(X)>40!($L(X)<5) X
"^DD",603.03,603.03,10,3)
Answer must be 5-40 characters in length.
"^DD",603.03,603.03,10,21,0)
^^2^2^3181018^^
"^DD",603.03,603.03,10,21,1,0)
This is the test server address or MailMan group where the Clozapine 
"^DD",603.03,603.03,10,21,2,0)
order information and Patient blood test results get sent
"^DD",603.03,603.03,10,"DT")
3181018
"^DD",603.03,603.03,11,0)
DEMOGRAPHIC TEST LISTENER^FJ40^^0;10^K:$L(X)>40!($L(X)<5) X
"^DD",603.03,603.03,11,3)
Answer must be 5-40 characters in length.
"^DD",603.03,603.03,11,21,0)
^^2^2^3170509^
"^DD",603.03,603.03,11,21,1,0)
This is the test server address or MailMan group where the Clozapine 
"^DD",603.03,603.03,11,21,2,0)
Patient demographic information get sent
"^DD",603.03,603.03,11,"DT")
3170509
**INSTALL NAME**
PSO*7.0*457
"BLD",10957,0)
PSO*7.0*457^OUTPATIENT PHARMACY^0^3190612^y
"BLD",10957,1,0)
^^1^1^3190512^^^^
"BLD",10957,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10957,4,0)
^9.64PA^52.52^2
"BLD",10957,4,52.52,0)
52.52
"BLD",10957,4,52.52,2,0)
^9.641^52.52^1
"BLD",10957,4,52.52,2,52.52,0)
CLOZAPINE PRESCRIPTION OVERRIDES  (File-top level)
"BLD",10957,4,52.52,2,52.52,1,0)
^9.6411^5^3
"BLD",10957,4,52.52,2,52.52,1,4,0)
REASON FOR OVERRIDE
"BLD",10957,4,52.52,2,52.52,1,5,0)
COMMENTS
"BLD",10957,4,52.52,2,52.52,1,6,0)
SECOND PHARMACIST
"BLD",10957,4,52.52,222)
y^y^p^^^^n^^n
"BLD",10957,4,52.52,224)

"BLD",10957,4,52.54,0)
52.54
"BLD",10957,4,52.54,222)
y^y^f^^n^^y^a^n
"BLD",10957,4,"APDD",52.52,52.52)

"BLD",10957,4,"APDD",52.52,52.52,4)

"BLD",10957,4,"APDD",52.52,52.52,5)

"BLD",10957,4,"APDD",52.52,52.52,6)

"BLD",10957,4,"B",52.52,52.52)

"BLD",10957,4,"B",52.54,52.54)

"BLD",10957,6.3)
116
"BLD",10957,"ABPKG")
n
"BLD",10957,"INIT")
POST^PSO457P
"BLD",10957,"KRN",0)
^9.67PA^779.2^20
"BLD",10957,"KRN",.4,0)
.4
"BLD",10957,"KRN",.401,0)
.401
"BLD",10957,"KRN",.402,0)
.402
"BLD",10957,"KRN",.403,0)
.403
"BLD",10957,"KRN",.5,0)
.5
"BLD",10957,"KRN",.84,0)
.84
"BLD",10957,"KRN",3.6,0)
3.6
"BLD",10957,"KRN",3.8,0)
3.8
"BLD",10957,"KRN",9.2,0)
9.2
"BLD",10957,"KRN",9.8,0)
9.8
"BLD",10957,"KRN",9.8,"NM",0)
^9.68A^20^19
"BLD",10957,"KRN",9.8,"NM",1,0)
PSOCLO1^^0^B149456436
"BLD",10957,"KRN",9.8,"NM",2,0)
PSORENW0^^0^B98608427
"BLD",10957,"KRN",9.8,"NM",3,0)
PSON52^^0^B118986186
"BLD",10957,"KRN",9.8,"NM",4,0)
PSOCLUTL^^0^B101965385
"BLD",10957,"KRN",9.8,"NM",5,0)
PSODRG^^0^B99583322
"BLD",10957,"KRN",9.8,"NM",7,0)
PSOORED5^^0^B114405743
"BLD",10957,"KRN",9.8,"NM",8,0)
PSODIR2^^0^B32390771
"BLD",10957,"KRN",9.8,"NM",9,0)
PSODIR1^^0^B108575993
"BLD",10957,"KRN",9.8,"NM",10,0)
PSOORED1^^0^B79193159
"BLD",10957,"KRN",9.8,"NM",11,0)
PSORENW4^^0^B91746035
"BLD",10957,"KRN",9.8,"NM",12,0)
PSONEW^^0^B38956670
"BLD",10957,"KRN",9.8,"NM",13,0)
PSONEW1^^0^B21636420
"BLD",10957,"KRN",9.8,"NM",14,0)
PSOORNEW^^0^B119452733
"BLD",10957,"KRN",9.8,"NM",15,0)
PSOCAN3^^0^B73878473
"BLD",10957,"KRN",9.8,"NM",16,0)
PSORENW^^0^B54413066
"BLD",10957,"KRN",9.8,"NM",17,0)
PSOBKDED^^0^B94241318
"BLD",10957,"KRN",9.8,"NM",18,0)
PSOCLOU^^0^B77943063
"BLD",10957,"KRN",9.8,"NM",19,0)
PSODIR^^0^B42041292
"BLD",10957,"KRN",9.8,"NM",20,0)
PSOCLOLS^^0^B14700402
"BLD",10957,"KRN",9.8,"NM","B","PSOBKDED",17)

"BLD",10957,"KRN",9.8,"NM","B","PSOCAN3",15)

"BLD",10957,"KRN",9.8,"NM","B","PSOCLO1",1)

"BLD",10957,"KRN",9.8,"NM","B","PSOCLOLS",20)

"BLD",10957,"KRN",9.8,"NM","B","PSOCLOU",18)

"BLD",10957,"KRN",9.8,"NM","B","PSOCLUTL",4)

"BLD",10957,"KRN",9.8,"NM","B","PSODIR",19)

"BLD",10957,"KRN",9.8,"NM","B","PSODIR1",9)

"BLD",10957,"KRN",9.8,"NM","B","PSODIR2",8)

"BLD",10957,"KRN",9.8,"NM","B","PSODRG",5)

"BLD",10957,"KRN",9.8,"NM","B","PSON52",3)

"BLD",10957,"KRN",9.8,"NM","B","PSONEW",12)

"BLD",10957,"KRN",9.8,"NM","B","PSONEW1",13)

"BLD",10957,"KRN",9.8,"NM","B","PSOORED1",10)

"BLD",10957,"KRN",9.8,"NM","B","PSOORED5",7)

"BLD",10957,"KRN",9.8,"NM","B","PSOORNEW",14)

"BLD",10957,"KRN",9.8,"NM","B","PSORENW",16)

"BLD",10957,"KRN",9.8,"NM","B","PSORENW0",2)

"BLD",10957,"KRN",9.8,"NM","B","PSORENW4",11)

"BLD",10957,"KRN",19,0)
19
"BLD",10957,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",10957,"KRN",19,"NM",1,0)
PSOL MANAGER^^0
"BLD",10957,"KRN",19,"NM",2,0)
PSOL REGISTER PATIENT^^0
"BLD",10957,"KRN",19,"NM",3,0)
PSOLAB LIST^^0
"BLD",10957,"KRN",19,"NM",4,0)
PSOLIST OVERRIDES^^0
"BLD",10957,"KRN",19,"NM",5,0)
PSOL EDIT^^0
"BLD",10957,"KRN",19,"NM","B","PSOL EDIT",5)

"BLD",10957,"KRN",19,"NM","B","PSOL MANAGER",1)

"BLD",10957,"KRN",19,"NM","B","PSOL REGISTER PATIENT",2)

"BLD",10957,"KRN",19,"NM","B","PSOLAB LIST",3)

"BLD",10957,"KRN",19,"NM","B","PSOLIST OVERRIDES",4)

"BLD",10957,"KRN",19.1,0)
19.1
"BLD",10957,"KRN",101,0)
101
"BLD",10957,"KRN",409.61,0)
409.61
"BLD",10957,"KRN",771,0)
771
"BLD",10957,"KRN",779.2,0)
779.2
"BLD",10957,"KRN",870,0)
870
"BLD",10957,"KRN",8989.51,0)
8989.51
"BLD",10957,"KRN",8989.52,0)
8989.52
"BLD",10957,"KRN",8994,0)
8994
"BLD",10957,"KRN","B",.4,.4)

"BLD",10957,"KRN","B",.401,.401)

"BLD",10957,"KRN","B",.402,.402)

"BLD",10957,"KRN","B",.403,.403)

"BLD",10957,"KRN","B",.5,.5)

"BLD",10957,"KRN","B",.84,.84)

"BLD",10957,"KRN","B",3.6,3.6)

"BLD",10957,"KRN","B",3.8,3.8)

"BLD",10957,"KRN","B",9.2,9.2)

"BLD",10957,"KRN","B",9.8,9.8)

"BLD",10957,"KRN","B",19,19)

"BLD",10957,"KRN","B",19.1,19.1)

"BLD",10957,"KRN","B",101,101)

"BLD",10957,"KRN","B",409.61,409.61)

"BLD",10957,"KRN","B",771,771)

"BLD",10957,"KRN","B",779.2,779.2)

"BLD",10957,"KRN","B",870,870)

"BLD",10957,"KRN","B",8989.51,8989.51)

"BLD",10957,"KRN","B",8989.52,8989.52)

"BLD",10957,"KRN","B",8994,8994)

"BLD",10957,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",10957,"QUES",0)
^9.62^^
"BLD",10957,"REQB",0)
^9.611^9^6
"BLD",10957,"REQB",1,0)
PSO*7.0*422^2
"BLD",10957,"REQB",4,0)
PSO*7.0*518^2
"BLD",10957,"REQB",5,0)
PSO*7.0*526^2
"BLD",10957,"REQB",7,0)
PSO*7.0*550^2
"BLD",10957,"REQB",8,0)
PSO*7.0*537^2
"BLD",10957,"REQB",9,0)
PSO*7.0*555^2
"BLD",10957,"REQB","B","PSO*7.0*422",1)

"BLD",10957,"REQB","B","PSO*7.0*518",4)

"BLD",10957,"REQB","B","PSO*7.0*526",5)

"BLD",10957,"REQB","B","PSO*7.0*537",8)

"BLD",10957,"REQB","B","PSO*7.0*550",7)

"BLD",10957,"REQB","B","PSO*7.0*555",9)

"DATA",52.54,1,0)
NO WBC IN LAST 7 DAYS
"DATA",52.54,2,0)
NO VERIFIED WBC
"DATA",52.54,3,0)
 LAST WBC RESULT < 3500
"DATA",52.54,4,0)
3 SEQ. WBC DECREASE
"DATA",52.54,5,0)
LAST ANC RESULT < 2000
"DATA",52.54,6,0)
3 SEQ. ANC DECREASE
"DATA",52.54,7,0)
NCCC AUTHORIZED
"DATA",52.54,8,0)
REGISTER NON-DUTY HR/WEEKEND (MAX 4DAY)
"DATA",52.54,9,0)
PRESCRIBER APPROVED 4 DAY SUPPLY
"DATA",52.54,10,0)
MILD NEUTROPENIA PRESCRIBER APPROVED
"FIA",52.52)
CLOZAPINE PRESCRIPTION OVERRIDES
"FIA",52.52,0)
^PS(52.52,
"FIA",52.52,0,0)
52.52D
"FIA",52.52,0,1)
y^y^p^^^^n^^n
"FIA",52.52,0,10)

"FIA",52.52,0,11)

"FIA",52.52,0,"RLRO")

"FIA",52.52,0,"VR")
7.0^PSO
"FIA",52.52,52.52)
1
"FIA",52.52,52.52,4)

"FIA",52.52,52.52,5)

"FIA",52.52,52.52,6)

"FIA",52.54)
CLOZAPINE OVERRIDE REASONS
"FIA",52.54,0)
^PS(52.54,
"FIA",52.54,0,0)
52.54
"FIA",52.54,0,1)
y^y^f^^n^^y^a^n
"FIA",52.54,0,10)

"FIA",52.54,0,11)

"FIA",52.54,0,"RLRO")

"FIA",52.54,0,"VR")
7.0^PSO
"FIA",52.54,52.54)
0
"INIT")
POST^PSO457P
"KRN",19,3321,-1)
0^3
"KRN",19,3321,0)
PSOLAB LIST^Display Lab Tests and Results^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,3321,1,0)
^^3^3^2920819^^
"KRN",19,3321,1,1,0)
This option displays results of lab tests for patients receiving
"KRN",19,3321,1,2,0)
clozapine as required by the circular regarding patient management
"KRN",19,3321,1,3,0)
protocol for the use of clozapine.
"KRN",19,3321,25)
PSORXLAB
"KRN",19,3321,"U")
DISPLAY LAB TESTS AND RESULTS
"KRN",19,3322,-1)
0^4
"KRN",19,3322,0)
PSOLIST OVERRIDES^List of Override Prescriptions^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,3322,1,0)
^^2^2^2920819^^^
"KRN",19,3322,1,1,0)
This generates a list of clozapine prescriptions which were entered by
"KRN",19,3322,1,2,0)
overriding the lockout.
"KRN",19,3322,25)
PSOCLOLS
"KRN",19,3322,"U")
LIST OF OVERRIDE PRESCRIPTIONS
"KRN",19,3335,-1)
0^2
"KRN",19,3335,0)
PSOL REGISTER PATIENT^Register Clozapine Patient^^R^^PSOLOCKCLOZ^^^^^^OUTPATIENT PHARMACY
"KRN",19,3335,1,0)
^^2^2^2920819^^^
"KRN",19,3335,1,1,0)
This option enters data required by Sandoz for Clozapine patients into
"KRN",19,3335,1,2,0)
the Pharmacy Patient file
"KRN",19,3335,25)
REG^PSOCLUTL
"KRN",19,3335,99)
55587,58104
"KRN",19,3335,"U")
REGISTER CLOZAPINE PATIENT
"KRN",19,3339,-1)
0^1
"KRN",19,3339,0)
PSOL MANAGER^Clozapine Pharmacy Manager^^M^^PSOLOCKCLOZ^^^^^^OUTPATIENT PHARMACY
"KRN",19,3339,1,0)
^19.06^3^3^3160620^^^^
"KRN",19,3339,1,1,0)
This menu contains the options used to control the dispensing of
"KRN",19,3339,1,2,0)
Clozapine.
"KRN",19,3339,1,3,0)
 
"KRN",19,3339,10,0)
^19.01IP^8^7
"KRN",19,3339,10,3,0)
3335^^1
"KRN",19,3339,10,3,"^")
PSOL REGISTER PATIENT
"KRN",19,3339,10,5,0)
3321^^2
"KRN",19,3339,10,5,"^")
PSOLAB LIST
"KRN",19,3339,10,6,0)
3322^^3
"KRN",19,3339,10,6,"^")
PSOLIST OVERRIDES
"KRN",19,3339,10,8,0)
3340^^4
"KRN",19,3339,10,8,"^")
PSOL EDIT
"KRN",19,3339,99)
65143,29309
"KRN",19,3339,99.1)
58239,49698
"KRN",19,3339,"U")
CLOZAPINE PHARMACY MANAGER
"KRN",19,3340,-1)
0^5
"KRN",19,3340,0)
PSOL EDIT^Edit Data for a Patient in the Clozapine Program^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,3340,1,0)
^^5^5^2930107^^^^
"KRN",19,3340,1,1,0)
This option allows you to edit data for a patient who has already been
"KRN",19,3340,1,2,0)
enrolled in the Clozapine treatment program.  It will typically be used
"KRN",19,3340,1,3,0)
to reregister a patient whose treatment has been suspended and who has
"KRN",19,3340,1,4,0)
rejoined the program.
"KRN",19,3340,1,5,0)
 
"KRN",19,3340,25)
AGAIN^PSOCLUTL
"KRN",19,3340,"U")
EDIT DATA FOR A PATIENT IN THE
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
7.0^3051119^2990416^1
"PKG",60,22,1,"PAH",1,0)
457^3190612^74
"PKG",60,22,1,"PAH",1,1,0)
^^1^1^3190612
"PKG",60,22,1,"PAH",1,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
20
"RTN","PSO457P")
0^^B1583709
"RTN","PSO457P",1,0)
PSO457P ;HEC/hrub - Post-Init for PSO*7*457 ;31 May 2019 14:27:27
"RTN","PSO457P",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**457**;March 2019;Build 116
"RTN","PSO457P",3,0)
 ;
"RTN","PSO457P",4,0)
 Q
"RTN","PSO457P",5,0)
 ;
"RTN","PSO457P",6,0)
POST ; post-init entry point
"RTN","PSO457P",7,0)
 ;
"RTN","PSO457P",8,0)
 I $D(^DIR("A")) K ^DIR("A")  ; clean up any residue
"RTN","PSO457P",9,0)
 ;
"RTN","PSO457P",10,0)
 D  ; update ^XTMP storage if found
"RTN","PSO457P",11,0)
 . D BMES^XPDUTL("Checking for Clozapine Registry data in ^XTMP. "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","PSO457P",12,0)
 . I '$D(^XTMP("PSJ CLOZ",0)) D BMES^XPDUTL("No Clozapine Registry data found in ^XTMP.  No action taken.") Q
"RTN","PSO457P",13,0)
 . D XTMPZRO^PSOCLOU D BMES^XPDUTL("Clozapine Registry data in ^XTMP updated.")
"RTN","PSO457P",14,0)
 ;
"RTN","PSO457P",15,0)
 Q
"RTN","PSO457P",16,0)
 ;
"RTN","PSOBKDED")
0^17^B94241318
"RTN","PSOBKDED",1,0)
PSOBKDED ;BIR/SAB - Edit backdoor Rx Order entry ;10 May 2019 08:19:50
"RTN","PSOBKDED",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,46,91,78,99,117,133,143,268,378,416,282,450,402,518,525,538,457**;DEC 1997;Build 116
"RTN","PSOBKDED",3,0)
 ;Ref PS(50.607 IA 2221
"RTN","PSOBKDED",4,0)
 ;Ref PS(50.7 IA 2223
"RTN","PSOBKDED",5,0)
 ;Ref PS(51.2 IA 2226
"RTN","PSOBKDED",6,0)
 ;Ref PSDRUG( IA 221
"RTN","PSOBKDED",7,0)
 ;Ref DOSE^PSSORPH IA 3234
"RTN","PSOBKDED",8,0)
 ;Ref PS(55 IA 2228
"RTN","PSOBKDED",9,0)
1 S %DT="AEX",%DT(0)=-PSONEW("FILL DATE"),Y=PSONEW("ISSUE DATE") X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT
"RTN","PSOBKDED",10,0)
 I "^"[$E(X) D KX K %DT Q
"RTN","PSOBKDED",11,0)
 ; PSO*7*538 Added Next Line
"RTN","PSOBKDED",12,0)
 I Y=-1 W ! D CIDH^PSOUTL W ! G 1
"RTN","PSOBKDED",13,0)
 G:Y=-1 1 S (PSOID,PSONEW("ISSUE DATE"))=Y D KX K %DT
"RTN","PSOBKDED",14,0)
 Q
"RTN","PSOBKDED",15,0)
2 S PSONEW("FLD")=2 D FILLDT^PSODIR2(.PSONEW) ;Fdt
"RTN","PSOBKDED",16,0)
 Q
"RTN","PSOBKDED",17,0)
3 S:$G(POERR) PSONEW("ISSUE DATE")=PSOID
"RTN","PSOBKDED",18,0)
 S PSONEW("FLD")=3 D PTSTAT^PSODIR1(.PSONEW) ;Sta
"RTN","PSOBKDED",19,0)
 Q
"RTN","PSOBKDED",20,0)
4 S PSONEW("FLD")=4 D PROV^PSODIR(.PSONEW) ;Pro
"RTN","PSOBKDED",21,0)
 Q
"RTN","PSOBKDED",22,0)
5 S PSONEW("FLD")=5 D CLINIC^PSODIR2(.PSONEW) ;Cli
"RTN","PSOBKDED",23,0)
 Q
"RTN","PSOBKDED",24,0)
6 S PSONEW("FLD")=6 D ^PSODRG,EN^PSODIAG ;Drg/ICD
"RTN","PSOBKDED",25,0)
 D 6^PSODRGN
"RTN","PSOBKDED",26,0)
 Q
"RTN","PSOBKDED",27,0)
7 S PSONEW("FLD")=7 D QTY^PSODIR1(.PSONEW) ;Qty
"RTN","PSOBKDED",28,0)
 Q
"RTN","PSOBKDED",29,0)
8 S PSONEW("FLD")=8 D DAYS^PSODIR1(.PSONEW) ;Day
"RTN","PSOBKDED",30,0)
 K PSMAX,PSTMAX D REF^PSOORNEW S PSONEW("N# REF")=PSONEW("# OF REFILLS")
"RTN","PSOBKDED",31,0)
 Q
"RTN","PSOBKDED",32,0)
9 S PSONEW("FLD")=9 D REFILL^PSODIR1(.PSONEW) ;Ref
"RTN","PSOBKDED",33,0)
 K PSMAX,PSTMAX
"RTN","PSOBKDED",34,0)
 Q
"RTN","PSOBKDED",35,0)
10 S PSONEW("FLD")="3A" N PSOEDDOS S PSOEDDOS=1 D DOSE^PSODIR(.PSONEW) ;Dose
"RTN","PSOBKDED",36,0)
 Q
"RTN","PSOBKDED",37,0)
 ;
"RTN","PSOBKDED",38,0)
 Q  I $G(COPY),$G(SIGOK) S PSOFDR=1 K PSONEW("SIG")
"RTN","PSOBKDED",39,0)
 S PSONEW("FLD")=10 D SIG^PSODIR1(.PSONEW) ;Sig
"RTN","PSOBKDED",40,0)
 I $G(COPY) K PSOFDR
"RTN","PSOBKDED",41,0)
 S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR D KV
"RTN","PSOBKDED",42,0)
 Q
"RTN","PSOBKDED",43,0)
INS S PSONEW("FLD")="3B" D INS^PSODIR(.PSONEW) ;Ins
"RTN","PSOBKDED",44,0)
 Q
"RTN","PSOBKDED",45,0)
11 S PSONEW("FLD")=11 D COPIES^PSODIR1(.PSONEW) ;Cop
"RTN","PSOBKDED",46,0)
 Q
"RTN","PSOBKDED",47,0)
12 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ;M/W
"RTN","PSOBKDED",48,0)
 Q
"RTN","PSOBKDED",49,0)
13 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ;Rem
"RTN","PSOBKDED",50,0)
 Q
"RTN","PSOBKDED",51,0)
DOSE ;backdoor
"RTN","PSOBKDED",52,0)
 I '$G(PSONEW("ENT")) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5) Dosage Ordered: " G INS1
"RTN","PSOBKDED",53,0)
 S SD=1 F I=1:1:PSONEW("ENT") D 
"RTN","PSOBKDED",54,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOBKDED",55,0)
 .S:$G(SD)=1 IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5)",DS=1 K SD
"RTN","PSOBKDED",56,0)
 .D DOSE1
"RTN","PSOBKDED",57,0)
INS1 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (6)Pat Instruction:"
"RTN","PSOBKDED",58,0)
INS2 I $O(PSONEW("SIG",0)) F D=0:0 S D=$O(PSONEW("SIG",D)) Q:'D  D
"RTN","PSOBKDED",59,0)
 .F SG=1:1:$L(PSONEW("SIG",D)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("SIG",D)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " D
"RTN","PSOBKDED",60,0)
 ..S:$P(PSONEW("SIG",D)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("SIG",D)," ",SG)
"RTN","PSOBKDED",61,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D  Q
"RTN","PSOBKDED",62,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" Other Patient Inst.: "
"RTN","PSOBKDED",63,0)
 .I $G(^PSRX(+$G(PSONEW("OIRXN")),"INSS"))]"" S PSONEW("SINS")=^PSRX(PSONEW("OIRXN"),"INSS")
"RTN","PSOBKDED",64,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$G(PSONEW("SINS"))
"RTN","PSOBKDED",65,0)
 Q
"RTN","PSOBKDED",66,0)
 ;
"RTN","PSOBKDED",67,0)
DOSE1 I $G(DS)=1 D  K DS G DU
"RTN","PSOBKDED",68,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_" Dosage Ordered: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)_$S($G(PSONEW("UNITS",I))'="":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOBKDED",69,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dosage Ordered: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)_$S($G(PSONEW("UNITS",I))'="":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOBKDED",70,0)
DU I '$G(PSONEW("DOSE ORDERED",I)),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOBKDED",71,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOBKDED",72,0)
 S:$G(PSONEW("DOSE ORDERED",I)) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dispense Units: "_$S($E($G(PSONEW("DOSE ORDERED",I)),1)=".":"0",1:"")_$G(PSONEW("DOSE ORDERED",I))
"RTN","PSOBKDED",73,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("NOUN",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Noun: "_PSONEW("NOUN",I)
"RTN","PSOBKDED",74,0)
 I $G(PSONEW("ROUTE",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Route: "_$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOBKDED",75,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            Schedule: "_$G(PSONEW("SCHEDULE",I))
"RTN","PSOBKDED",76,0)
 I $G(PSONEW("DURATION",I))]"" D
"RTN","PSOBKDED",77,0)
 .S IEN=IEN+1
"RTN","PSOBKDED",78,0)
 .S ^TMP("PSOPO",$J,IEN,0)="           *Duration: "_PSONEW("DURATION",I)_" ("_$S(PSONEW("DURATION",I)["M":"MINUTES",PSONEW("DURATION",I)["W":"WEEKS",PSONEW("DURATION",I)["L":"MONTHS",PSONEW("DURATION",I)["H":"HOURS",1:"DAYS")_")"
"RTN","PSOBKDED",79,0)
 I $G(PSONEW("CONJUNCTION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Conjunction: "_$S($G(PSONEW("CONJUNCTION",I))="A":"AND",$G(PSONEW("CONJUNCTION",I))="T":"THEN",$G(PSONEW("CONJUNCTION",I))="X":"EXCEPT",1:"")
"RTN","PSOBKDED",80,0)
 Q
"RTN","PSOBKDED",81,0)
RTE ;*525
"RTN","PSOBKDED",82,0)
 I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOBKDED",83,0)
 I $G(RTE) K RTE
"RTN","PSOBKDED",84,0)
 D KV N MRSLS,MRX,MRDFV,MRQ S MRQ=0,MRDFV=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"")
"RTN","PSOBKDED",85,0)
 S X=""
"RTN","PSOBKDED",86,0)
 W !,"ROUTE: "_MRDFV_"//"
"RTN","PSOBKDED",87,0)
 D  G:$G(MRSLS) RTEC G:MRQ RTE
"RTN","PSOBKDED",88,0)
 . R MRX:DTIME
"RTN","PSOBKDED",89,0)
 . I '$T S DTOUT=1
"RTN","PSOBKDED",90,0)
 . I MRX="^" S DUOUT=1
"RTN","PSOBKDED",91,0)
 . I MRX="?" D MRSL^PSOORED5
"RTN","PSOBKDED",92,0)
 . I MRX="",$G(MRDFV)]"" S MRX=$G(MRDFV)
"RTN","PSOBKDED",93,0)
 S X=MRX
"RTN","PSOBKDED",94,0)
 K MRSLS,MRX,MRDFV,MRQ
"RTN","PSOBKDED",95,0)
 ;K DIR,DIRUT S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOBKDED",96,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",97,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"") K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",98,0)
 ;I '$G(PSORXED("ROUTE",ENT)),$G(PSOREEDT) K DIR("B")
"RTN","PSOBKDED",99,0)
 ;D ^DIR 
"RTN","PSOBKDED",100,0)
 I X[U,$L(X)>1 S FIELD="RTE",JUMP=1 K DIRUT,DTOUT Q
"RTN","PSOBKDED",101,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOBKDED",102,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" Q
"RTN","PSOBKDED",103,0)
 D CKMRSL^PSOORED5
"RTN","PSOBKDED",104,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) Q
"RTN","PSOBKDED",105,0)
RTEC ;
"RTN","PSOBKDED",106,0)
 K DIC S DIC=51.2,DIC(0)="QEZMX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOBKDED",107,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOBKDED",108,0)
 Q
"RTN","PSOBKDED",109,0)
ASK K JUMP,UNITN,DOSE D KV D DOSE^PSSORPH(.DOSE,PSODRUG("IEN"),"O",PSODFN)
"RTN","PSOBKDED",110,0)
 N PSODOSCT,PSODOSFL,PSODOSWT D FULL^VALM1  ;402
"RTN","PSOBKDED",111,0)
 I $D(DOSE("DD")) D LST2^PSOBKDE1 G ASK1
"RTN","PSOBKDED",112,0)
 D:$G(PSOFROM)="NEW"&($G(PSORX("EDIT"))']"")!($G(PSOFROM1))!($G(COPY)) LST^PSOBKDE1:$O(DOSE(0))
"RTN","PSOBKDED",113,0)
ASK1 S STRE=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",5),UNITN=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",6),DOSE("LD")=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",11)
"RTN","PSOBKDED",114,0)
 W ! S DIR(0)="F^1:60"
"RTN","PSOBKDED",115,0)
 I '$G(PSODOSCT) D
"RTN","PSOBKDED",116,0)
 .F I=0:0 S I=$O(DOSE(I)) Q:'I!('$D(DOSE(I)))  S PSODOSCT=I
"RTN","PSOBKDED",117,0)
 .I PSODOSCT=1,$P(DOSE(1),"^")=""&($P(DOSE("DD",PSODRUG("IEN")),"^",6)="") S PSODOSFL=1
"RTN","PSOBKDED",118,0)
 S PSODOSWT="",PSODOSWT=$S($G(PSODOSCT)<1:"",$G(PSODOSCT)=1&($G(PSODOSFL)):"",1:" (1-"_$G(PSODOSCT)_")")
"RTN","PSOBKDED",119,0)
 ;S DIR("A",1)="Select from list of Available Dosages"_PSODOSWT_", Enter Free Text Dose",DIR("?")="^D LST1^PSOBKDE1",DIR("A")="or Enter a Question Mark (?) to view list"
"RTN","PSOBKDED",120,0)
 ; next 2 lines 402
"RTN","PSOBKDED",121,0)
 I PSODOSCT=1,($P($G(DOSE(1)),"^")=""&($P($G(DOSE(1)),"^",3)="")) S PSODOSFL=1
"RTN","PSOBKDED",122,0)
 S:$G(PSODOSFL) DIR("A")="     Please Enter a Free Text Dose"
"RTN","PSOBKDED",123,0)
 S:'$G(PSODOSFL) DIR("A",1)="Select from list of Available Dosages"_PSODOSWT_", Enter Free Text Dose",DIR("?")="^D LST1^PSOBKDE1",DIR("A")="or Enter a Question Mark (?) to view list"
"RTN","PSOBKDED",124,0)
 ;
"RTN","PSOBKDED",125,0)
 K DIR("B")  ; PSO*7.0*457 - removed dose default logic that set DIR("B")
"RTN","PSOBKDED",126,0)
 D ^DIR
"RTN","PSOBKDED",127,0)
 I X[U,$L(X)>1 S FIELD="ASK",JUMP=1 K DIRUT,DTOUT Q
"RTN","PSOBKDED",128,0)
 I $D(DIRUT) S:$G(ORD) PSODSPL=1 Q
"RTN","PSOBKDED",129,0)
 I X=$G(PSORXED("DOSE",ENT)),$D(DOSE(Y)) G GD1
"RTN","PSOBKDED",130,0)
 I X=$G(PSORXED("DOSE",ENT)) D  G DOS
"RTN","PSOBKDED",131,0)
 .S DOSE=X,UNITS=$G(PSORXED("UNITS",ENT))
"RTN","PSOBKDED",132,0)
 .I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("DOSE ORDERED",ENT),DUPD,PSORXED("NOUN",ENT)
"RTN","PSOBKDED",133,0)
GD1 N PSORXTE
"RTN","PSOBKDED",134,0)
 I $D(DOSE(Y)) D  G DOS ;from list
"RTN","PSOBKDED",135,0)
 .S DOSE=$S($P(DOSE(Y),"^"):$P(DOSE(Y),"^"),$P(DOSE(Y),"^",3)]"":$P(DOSE(Y),"^",3),1:1),DOLST=Y
"RTN","PSOBKDED",136,0)
 .I $P(DOSE(Y),"^") S UNITS=$P(DOSE(Y),"^",2),DUPD=$P(DOSE(Y),"^",3),UNITN=$P(DOSE("DD",PSODRUG("IEN")),"^",6),PSORXTE("DOSE ORDERED",ENT)=DUPD
"RTN","PSOBKDED",137,0)
 .S PSORXTE("NOUN",ENT)=$P(DOSE(Y),"^",6),PSORXTE("VERB",ENT)=$P(DOSE(Y),"^",8)
"RTN","PSOBKDED",138,0)
 .I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") D  Q
"RTN","PSOBKDED",139,0)
 ..S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("DOSE ORDERED",ENT),DUPD,PSORXED("NOUN",ENT)
"RTN","PSOBKDED",140,0)
 ..I $P($G(^PS(55,PSODFN,"LAN")),"^"),$G(PSOFROM)="PENDING" D LAN^PSOORED5 Q
"RTN","PSOBKDED",141,0)
 ..I $P($G(^PS(55,PSODFN,"LAN")),"^"),$G(PSOFROM)="NEW" D LAN^PSOORED5
"RTN","PSOBKDED",142,0)
 .S PSORXTE("UNITS",ENT)=$G(UNITS)
"RTN","PSOBKDED",143,0)
 S DOSE=Y,DOLST=0 ;non-numeric and numeric not in list
"RTN","PSOBKDED",144,0)
 I DOSE("LD") D
"RTN","PSOBKDED",145,0)
 .F I=1:1:$L(DOSE)  I $E(DOSE,I)'?.N&($E(DOSE,I)'?1" ")&($E(DOSE,I)'?1".") S DCHK=$G(DCHK)_$E(DOSE,I)
"RTN","PSOBKDED",146,0)
 .I $G(DCHK)]"" D
"RTN","PSOBKDED",147,0)
 ..S DCHK=$TR(DCHK,"qwertyuioplkjhgfdsazxcvbnm","QWERTYUIOPLKJHGFDSAZXCVBNM")
"RTN","PSOBKDED",148,0)
 ..I DCHK=UNITN S DOSE=+DOSE
"RTN","PSOBKDED",149,0)
 K I,DCHK
"RTN","PSOBKDED",150,0)
 S PSOINDT=$$GET1^DIQ(50,PSODRUG("IEN"),100,"I") I PSOINDT,DT>PSOINDT G DOS
"RTN","PSOBKDED",151,0)
 S PSORXTE("NOUN",ENT)=$P(DOSE("DD",PSODRUG("IEN")),"^",9),PSORXTE("VERB",ENT)=$P(DOSE("DD",PSODRUG("IEN")),"^",10)
"RTN","PSOBKDED",152,0)
 I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("NOUN",ENT),PSORXED("ODOSE",ENT) G DOS
"RTN","PSOBKDED",153,0)
 S:$P(DOSE("DD",PSODRUG("IEN")),"^",6)]"" (PSORXTE("UNITS",ENT),UNITS)=$O(^PS(50.607,"B",$P(DOSE("DD",PSODRUG("IEN")),"^",6),0)),UNITN=$P(DOSE("DD",PSODRUG("IEN")),"^",6)
"RTN","PSOBKDED",154,0)
 S:$P(DOSE("DD",PSODRUG("IEN")),"^",5) DUPD=DOSE/$P(DOSE("DD",PSODRUG("IEN")),"^",5),PSORXTE("DOSE ORDERED",ENT)=DUPD
"RTN","PSOBKDED",155,0)
DOS W " "_$S($E(DOSE,1)="."&($G(UNITN)'=""):"0",1:"")_DOSE W:$G(UNITN)'="" UNITN
"RTN","PSOBKDED",156,0)
 W ! K DIR,DIRUT S DIR(0)="Y",DIR("A")="You entered "_$S($E(DOSE,1)="."&($G(UNITN)'=""):"0",1:"")_DOSE_$S($G(UNITN)'="":UNITN,1:"")_" is this correct",DIR("B")="Yes"
"RTN","PSOBKDED",157,0)
 D ^DIR I 'Y D KX K DOSE,UNITS,PSORXTE,PSOINDT G ASK
"RTN","PSOBKDED",158,0)
 S PSORXED("DOSE",ENT)=DOSE
"RTN","PSOBKDED",159,0)
 S:$G(PSORXTE("DOSE ORDERED",ENT))]"" PSORXED("DOSE ORDERED",ENT)=PSORXTE("DOSE ORDERED",ENT)
"RTN","PSOBKDED",160,0)
 S:$G(PSORXTE("NOUN",ENT))]"" PSORXED("NOUN",ENT)=PSORXTE("NOUN",ENT)
"RTN","PSOBKDED",161,0)
 I $G(PSORX("EDIT"))']"" D  ;PSO*7.0*450
"RTN","PSOBKDED",162,0)
 .S:$G(PSORXTE("VERB",ENT))]"" PSORXED("VERB",ENT)=PSORXTE("VERB",ENT)
"RTN","PSOBKDED",163,0)
 S:$G(PSORXTE("UNITS",ENT))]"" PSORXED("UNITS",ENT)=PSORXTE("UNITS",ENT)
"RTN","PSOBKDED",164,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD"),$P($G(^PS(55,PSODFN,"LAN")),"^") D
"RTN","PSOBKDED",165,0)
 .K OTHDOS(ENT) D KX S DIR(0)="52.0113,9"
"RTN","PSOBKDED",166,0)
 .I '$G(OTHDOS(ENT)),$G(PSORXED("ODOSE",ENT))']"" D LAN^PSOORED5
"RTN","PSOBKDED",167,0)
 .I $G(PSORXED("ODOSE",ENT))]"" S DIR("B")=PSORXED("ODOSE",ENT) K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",168,0)
 .K DTOUT,DUOUT,DIRUT,Y,X D ^DIR K DIR K:$G(X)="@"!($G(X)="") DIRUT I $D(DIRUT) Q
"RTN","PSOBKDED",169,0)
 .I X="@" S OTHDOS(ENT)=1 D KX K PSORXED("ODOSE",ENT) Q
"RTN","PSOBKDED",170,0)
 .S:X'="" PSORXED("ODOSE",ENT)=X
"RTN","PSOBKDED",171,0)
 Q
"RTN","PSOBKDED",172,0)
 ;
"RTN","PSOBKDED",173,0)
SCH D KX
"RTN","PSOBKDED",174,0)
 ;*282 Allow multi-word schedules
"RTN","PSOBKDED",175,0)
 S DIR("?")="^D SCHLP^PSOORED4",DIR("A")="Schedule: ",DIR(0)="FA^1:20^I X[""""""""!(X?.E1C.E)!($A(X)=45)!($L(X,"" "")>$S(X[""PRN"":4,1:3))!($L(X)>20)!($L(X)<1) K X"
"RTN","PSOBKDED",176,0)
 I '$D(PSOSCH),'$D(PSORXED("SCHEDULE",ENT)),$P(^PS(50.7,PSODRUG("OI"),0),"^",8)]"" S PSOSCH=$P(^PS(50.7,PSODRUG("OI"),0),"^",8)
"RTN","PSOBKDED",177,0)
 S DIR("B")=$S($D(PSOSCH)&('$D(PSORXED("SCHEDULE",ENT))):PSOSCH,$G(PSORXED("SCHEDULE",ENT))]"":PSORXED("SCHEDULE",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",178,0)
 I $G(PSORXED("SCHEDULE",ENT))']"",$G(PSOREEDT) K DIR("B")
"RTN","PSOBKDED",179,0)
 D ^DIR
"RTN","PSOBKDED",180,0)
 Q
"RTN","PSOBKDED",181,0)
KX K X,Y
"RTN","PSOBKDED",182,0)
KV K DTOUT,DUOUT,DIR,DIRUT
"RTN","PSOBKDED",183,0)
 Q
"RTN","PSOCAN3")
0^15^B73878473
"RTN","PSOCAN3",1,0)
PSOCAN3 ;BIR/RTR/SAB - auto dc rxs due to death ;2/05/97 2:59pm
"RTN","PSOCAN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,24,27,32,36,94,88,117,131,146,139,132,223,235,148,249,225,324,251,375,379,372,540,508,457**;DEC 1997;Build 116
"RTN","PSOCAN3",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN3",4,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN3",5,0)
 Q
"RTN","PSOCAN3",6,0)
APSOD(PSODFN) ;called from file #2 date of death xref 'APOSD'
"RTN","PSOCAN3",7,0)
 N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DQ,DU,DV,DW,DR
"RTN","PSOCAN3",8,0)
 S PSODEATH=1 D CAN K PSODEATH
"RTN","PSOCAN3",9,0)
 Q
"RTN","PSOCAN3",10,0)
CAN ;discontinued rxs due to death
"RTN","PSOCAN3",11,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOCAN3",12,0)
 .I '$P($G(^PS(52.91,PSODFN,0)),"^",3)!($P($G(^(0)),"^",3)>DT) S $P(^PS(52.91,PSODFN,0),"^",3)=DT,$P(^PS(52.91,PSODFN,0),"^",4)=5,^PS(52.91,"AX",DT,PSODFN)="" D SET^PSOTPCAN(PSODFN)
"RTN","PSOCAN3",13,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) S STA=$S($P($G(^PSRX(PSORX,"STA")),"^")<11:1,$P($G(^("STA")),"^")=16:1,1:0) D:STA
"RTN","PSOCAN3",14,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,"STA")),"^")="" D SETC
"RTN","PSOCAN3",15,0)
 .D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOCAN3",16,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,2)),"^",6)'<DT S PSO0=^(0),PSO2=$G(^(2)) D
"RTN","PSOCAN3",17,0)
 ..S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")
"RTN","PSOCAN3",18,0)
 ..;remove from hold
"RTN","PSOCAN3",19,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOCAN3",20,0)
 ...S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PSRX(PSORX,"H")
"RTN","PSOCAN3",21,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOCAN3",22,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOCAN3",23,0)
 ...I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",24,0)
 ..;delete from non-verified file
"RTN","PSOCAN3",25,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S ^PSRX(PSORX,"DDSTA")="52.4;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PS(52.4,PSORX,0),DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOCAN3",26,0)
 ..I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",27,0)
 ..;delete from suspense
"RTN","PSOCAN3",28,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOCAN3",29,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)) I '$G(^PS(52.5,DA,"P")),$G(PSODEATH) S ^PSRX(PSORX,"DDSTA")="52.5;5^"_^PS(52.5,DA,0),^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",30,0)
 ...I $O(^PSRX(PSORX,1,0)),'$G(PSODEATH) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOCAN3",31,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",32,0)
 ..D SETC
"RTN","PSOCAN3",33,0)
 ..;activity record
"RTN","PSOCAN3",34,0)
 ..S (COM,ACOM)=$S($G(PSODEATH):"Date of Death Entered by MAS",1:"Discontinued by Pharmacy")_"."
"RTN","PSOCAN3",35,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN3",36,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN3",37,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT
"RTN","PSOCAN3",38,0)
 ..S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued Due to Death. "_ACOM
"RTN","PSOCAN3",39,0)
 ..;check for label/release/pending release
"RTN","PSOCAN3",40,0)
 ..D FIL
"RTN","PSOCAN3",41,0)
 ..S STAT="OD",PHARMST="" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A") K COMM,PHARMST,STAT
"RTN","PSOCAN3",42,0)
 ;dc pending orders
"RTN","PSOCAN3",43,0)
 F PDA=0:0 S PDA=$O(^PS(52.41,"P",PSODFN,PDA)) Q:'PDA  I $P(^PS(52.41,PDA,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") D
"RTN","PSOCAN3",44,0)
 .I $G(PSODEATH) D
"RTN","PSOCAN3",45,0)
 ..S ^PS(52.41,PDA,"DDSTA")=$P(^PS(52.41,PDA,0),"^",3)_";"_+$P($G(^PS(52.41,PDA,"INI")),"^"),^PS(52.41,"APSOD",PSODFN,PDA)=""
"RTN","PSOCAN3",46,0)
 ..S $P(^PS(52.41,PDA,4),"^")="Date of Death Entered by MAS."
"RTN","PSOCAN3",47,0)
 .S $P(^PS(52.41,PDA,0),"^",3)="DC"
"RTN","PSOCAN3",48,0)
 .K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,PDA,"INI")),"^"),PDA)
"RTN","PSOCAN3",49,0)
 .S COM=$S($G(PSODEATH):"Date of Death Entered by MAS.",1:""),PL=$P(^PS(52.41,PDA,0),"^"),$P(^(0),"^",3)="DC"
"RTN","PSOCAN3",50,0)
 .D EN^PSOHLSN(PL,"OC",COM,"A") K COM,PL
"RTN","PSOCAN3",51,0)
 ;dc non-va meds
"RTN","PSOCAN3",52,0)
 D APSOD^PSONVNEW
"RTN","PSOCAN3",53,0)
KILL K %,%H,%T,ACNT,DA,PDA,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOCAN3",54,0)
 D KVAR^VADPT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOCAN3",55,0)
 Q
"RTN","PSOCAN3",56,0)
CAN1 Q:$G(DODR)
"RTN","PSOCAN3",57,0)
 S PSOMGDFN=$G(PSODFN) ; SAVE IN CASE CANCELING RX THAT WAS MERGED TO ANOTHER DFN
"RTN","PSOCAN3",58,0)
 I $G(^PSRX(DA,"H"))]"" D HLD^PSOCAN2
"RTN","PSOCAN3",59,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOCAN3",60,0)
 S PSCANVAR=0,RXDA=DA,DA=$O(^PS(52.5,"B",DA,0)) I DA,'$G(^PS(52.5,DA,"P")) S PSCANVAR=1 D
"RTN","PSOCAN3",61,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOCAN3",62,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while suspended. "_$G(COM)
"RTN","PSOCAN3",63,0)
 .S DIK="^PS(52.5," D ^DIK K DIK S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN3",64,0)
 .D AREC^PSOCAN1 S DA=RXDA I $O(^PSRX(DA,1,0)) D REF^PSOCAN2
"RTN","PSOCAN3",65,0)
 I $G(REA)="C" S DA=$O(^PS(52.5,"B",RXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",66,0)
 I 'PSCANVAR S:$D(SPCANC) ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" during Rx cancel.  "
"RTN","PSOCAN3",67,0)
ADD S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) S:$G(PSOOPT)=3 REA="L"
"RTN","PSOCAN3",68,0)
 D:'$G(PSCANVAR) AREC^PSOCAN1 S:REA="L" REA="C"
"RTN","PSOCAN3",69,0)
 S:REA'="C" $P(^PSRX(DA,"STA"),"^")=0,$P(^(7),"^")=""
"RTN","PSOCAN3",70,0)
 N PSOTPCNZ S PSOTPCNZ=0 I $P(^PSRX(DA,"STA"),"^")'=12 S PSOTPCNZ=1
"RTN","PSOCAN3",71,0)
 S:REA="C"&($P(^PSRX(DA,"STA"),"^")<12)!($P(^("STA"),"^")=16) $P(^PSRX(DA,"STA"),"^")=12 I $P($G(^PSRX(DA,"STA")),"^")=12,$G(PSOTPCNZ) D CAN^PSOTPCAN(DA)
"RTN","PSOCAN3",72,0)
 K PSOTPCNZ
"RTN","PSOCAN3",73,0)
 I REA="R" D
"RTN","PSOCAN3",74,0)
 .I $P(^PSRX(DA,3),"^",8) S $P(^PSRX(DA,3),"^",2)=$P(^PSRX(DA,3),"^",8),$P(^(3),"^",8)=""
"RTN","PSOCAN3",75,0)
 .S $P(^PSRX(DA,3),"^")=$S($P(^PSRX(DA,3),"^",10):$P(^(3),"^",10),$G(PSOCANHD):PSOCANHD,$P(^(3),"^",5):$P(^(3),"^",5),1:$P(^(3),"^")),$P(^(3),"^",5)="",$P(^(3),"^",10)=""
"RTN","PSOCAN3",76,0)
 I REA="C" D
"RTN","PSOCAN3",77,0)
 .S $P(^PSRX(DA,3),"^",10)=$P(^PSRX(DA,3),"^")
"RTN","PSOCAN3",78,0)
 .S:'$P(^PSRX(DA,3),"^",5) $P(^PSRX(DA,3),"^",5)=DT
"RTN","PSOCAN3",79,0)
 .K ^XTMP("PSO4D-"_PSODFN) ; p457 clear clozapine 4-day supply
"RTN","PSOCAN3",80,0)
 .I $O(^PS(52.41,"ARF",DA,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S HLDDA=DA,DA=$O(^PS(52.41,"ARF",DA,0)),DIK="^PS(52.41," D ^DIK S DA=HLDDA K HLDDA
"RTN","PSOCAN3",81,0)
 .;check for label/release/pending release
"RTN","PSOCAN3",82,0)
 .I $G(PSOOPT)'=3 D FILX
"RTN","PSOCAN3",83,0)
 S PSONOOR=$S($D(PSONOOR):PSONOOR,1:"D"),STAT=$S(REA="C":"OD",1:"SC"),PHARMST=$S(REA="C":"",1:"CM")
"RTN","PSOCAN3",84,0)
 S COM=$S(REA="C":$S($G(PSOOPT)=3&('$G(DUP)):"Renewed",1:"Discontinued")_" by Pharmacy",1:"Reinstated by Pharmacy")
"RTN","PSOCAN3",85,0)
 D EN^PSOHLSN1(DA,STAT,PHARMST,$S(COM["Discontinued"&($D(INCOM)):INCOM,1:COM),$S($G(PSOOPT)=3&('$G(DUP)):"",1:PSONOOR)) K COM,STAT,PHARMST,PSCANVAR
"RTN","PSOCAN3",86,0)
 I REA="C" D
"RTN","PSOCAN3",87,0)
 .I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOCAN3",88,0)
 I $G(PSOMGDFN)'="" S PSODFN=PSOMGDFN K PSOMGDFN
"RTN","PSOCAN3",89,0)
 S PSVC=$P(^PSRX(DA,0),"^",16)
"RTN","PSOCAN3",90,0)
 Q:(REA="C")!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",91,0)
 Q:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2))
"RTN","PSOCAN3",92,0)
 S PSRXIN=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXIN,DIC(0)="ML"
"RTN","PSOCAN3",93,0)
 S DIC("DR")="1////"_$G(PSODFN)_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN3",94,0)
 K DD,DO D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM
"RTN","PSOCAN3",95,0)
 K DA,DIK S DA=PSRXIN K PSRXIN S $P(^PSRX(DA,"STA"),"^")=1 D NVER^PSOCAN2
"RTN","PSOCAN3",96,0)
 W !,"Rx # "_$P(^PSRX(DA,0),"^")_" is still non-verified!"
"RTN","PSOCAN3",97,0)
 Q
"RTN","PSOCAN3",98,0)
 ; PSO*7*508 - added ERXDCIEN parameter, and check for parameter and possession of psorph.
"RTN","PSOCAN3",99,0)
 ;           - the pso application proxy will not possess the PSORPH key, so we do not quit if that is the case.
"RTN","PSOCAN3",100,0)
OERR(ERXDCIEN) I '$D(^XUSEC("PSORPH",DUZ)),'$P($G(PSOPAR),"^",2),'$G(ERXDCIEN) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOCAN3",101,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN3",102,0)
 K PSOPLCK S PSOCANRD=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",4),PSOCANRA=1
"RTN","PSOCAN3",103,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D KCAN D ULP Q
"RTN","PSOCAN3",104,0)
 I $P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^"),$P(^("STA"),"^")=1!($P(^("STA"),"^")=4) S:$G(SPEED) PSONOORS=$G(PSONOOR) D DEL^PSOCAN4 S:$G(PSONOORS)'="" PSONOOR=$G(PSONOORS) K PSONOORS D KCAN D ULP Q
"RTN","PSOCAN3",105,0)
 I '+^PSRX($P(PSOLST(ORN),"^",2),"OR1"),$P(^("STA"),"^")=12 S VALMSG="Rx Cannot be Reinstated.  No Orderable Item." D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",106,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12,$P($G(^("PKI")),"^") S VALMSG="Cannot be Reinstated - Digitally Signed" D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",107,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN3",108,0)
 ; PSO*7*508 - replacing below line with following 2 lines - do not try to build header if this is an auto-dc for an eRx.
"RTN","PSOCAN3",109,0)
 ;D HLDHDR^PSOLMUTL S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",110,0)
 I '$G(ERXDCIEN) D HLDHDR^PSOLMUTL
"RTN","PSOCAN3",111,0)
 S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",112,0)
 ; PSO*7*508 - end changes
"RTN","PSOCAN3",113,0)
 S POERR=1,DFNHLD=PSODFN,DA=$P(PSOLST(ORN),"^",2) N PSOREINS,PSOONOFC S PSOREINS=1
"RTN","PSOCAN3",114,0)
 I $G(PSORX("DOSING OFF")) S PSOREINF=1
"RTN","PSOCAN3",115,0)
 I $P(^PSRX(DA,3),"^",5) S PSOCANHD=$P(^PSRX(DA,3),"^",5)
"RTN","PSOCAN3",116,0)
 D LMNO S:$G(PSOONOFC) PSORX("DOSING OFF")=1 I $G(PSOQUIT) D ULP,KCAN S VALMBCK="R" Q
"RTN","PSOCAN3",117,0)
 D:$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 RMP
"RTN","PSOCAN3",118,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN3",119,0)
 K POERR,PSCAN,PSI,PSL,PSOREINF S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN3",120,0)
 D KCAN
"RTN","PSOCAN3",121,0)
 Q
"RTN","PSOCAN3",122,0)
ULP D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN3",123,0)
 Q
"RTN","PSOCAN3",124,0)
 ;
"RTN","PSOCAN3",125,0)
LMNO ; Calls LMNO^PSOCAN
"RTN","PSOCAN3",126,0)
 N PSODFN,PSORX,RXN,RX0
"RTN","PSOCAN3",127,0)
 S PSPOP=0,RXNUM=X S PSODFN=+$P(^PSRX(DA,0),"^",2) D LMNO^PSOCAN
"RTN","PSOCAN3",128,0)
 Q
"RTN","PSOCAN3",129,0)
 ;
"RTN","PSOCAN3",130,0)
KCAN ;
"RTN","PSOCAN3",131,0)
 K PSOCANRA,PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ,PSOMSG,PSOCANHD,PSOQUIT
"RTN","PSOCAN3",132,0)
 Q
"RTN","PSOCAN3",133,0)
 ;
"RTN","PSOCAN3",134,0)
KCAN1 ;
"RTN","PSOCAN3",135,0)
 K PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ
"RTN","PSOCAN3",136,0)
 Q
"RTN","PSOCAN3",137,0)
 ;
"RTN","PSOCAN3",138,0)
RMP D RMP^PSOCAN3N
"RTN","PSOCAN3",139,0)
 Q
"RTN","PSOCAN3",140,0)
 ;
"RTN","PSOCAN3",141,0)
FIL Q:'$G(PSORX)
"RTN","PSOCAN3",142,0)
 S PSOFC=PSORX G FILC
"RTN","PSOCAN3",143,0)
FILX Q:'$G(DA)
"RTN","PSOCAN3",144,0)
 S PSOFC=DA
"RTN","PSOCAN3",145,0)
FILC ;
"RTN","PSOCAN3",146,0)
 N PFC,PSOFFLAG
"RTN","PSOCAN3",147,0)
 I $P($G(^PSRX(PSOFC,2)),"^",13) G FILQ
"RTN","PSOCAN3",148,0)
 S PSOFFLAG=0 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,1,PFC)) Q:'PFC!(PSOFFLAG)  I $P($G(^PSRX(PSOFC,1,PFC,0)),"^",18) S PSOFFLAG=1
"RTN","PSOCAN3",149,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",150,0)
 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,"L",PFC)) Q:'PFC!(PSOFFLAG)  I $D(^PSRX(PSOFC,"L",PFC,0)),'$P($G(^(0)),"^",5) S PSOFFLAG=1
"RTN","PSOCAN3",151,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",152,0)
 S PSOFCSUS=$O(^PS(52.5,"B",PSOFC,0))
"RTN","PSOCAN3",153,0)
 I $G(PSOFCSUS),$P($G(^PS(52.5,PSOFCSUS,0)),"^",7)="L"!($P($G(^(0)),"^",7)="X") G FILQ
"RTN","PSOCAN3",154,0)
 S $P(^PSRX(PSOFC,3),"^",8)=$P($G(^PSRX(PSOFC,3)),"^",2)
"RTN","PSOCAN3",155,0)
 S $P(^PSRX(PSOFC,3),"^",2)=$P($G(^PSRX(PSOFC,2)),"^",2)
"RTN","PSOCAN3",156,0)
 I $P($G(^PSRX(PSOFC,"OR1")),"^",3) S $P(^PSRX(PSOFC,3),"^")=$P($G(^PSRX($P(^PSRX(PSOFC,"OR1"),"^",3),3)),"^")
"RTN","PSOCAN3",157,0)
FILQ K PSOFC,PSOFCSUS
"RTN","PSOCAN3",158,0)
 Q
"RTN","PSOCAN3",159,0)
 ;
"RTN","PSOCAN3",160,0)
SETC ;Called from Date of Death
"RTN","PSOCAN3",161,0)
 S $P(^PSRX(PSORX,"STA"),"^")=12,$P(^PSRX(PSORX,3),"^",5)=DT,$P(^PSRX(PSORX,3),"^",10)=$P(^PSRX(PSORX,3),"^") D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",162,0)
 D CHKCMOP^PSOUTL(PSORX,"D")
"RTN","PSOCAN3",163,0)
 Q
"RTN","PSOCLO1")
0^1^B149456436
"RTN","PSOCLO1",1,0)
PSOCLO1 ;BHAM ISC/SAB, HEC/hrub - clozaril Rx lockout logic ;12 May 2019 12:53:12
"RTN","PSOCLO1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,23,37,222,457**;DEC 1997;Build 116
"RTN","PSOCLO1",3,0)
 ;External reference YSCLTST2 supported by DBIA 4556
"RTN","PSOCLO1",4,0)
 ;Reference to ^YSCL(603.01 is supported by DBIA 2697
"RTN","PSOCLO1",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOCLO1",6,0)
 ;Reference to ^XMD supported by IA #10070
"RTN","PSOCLO1",7,0)
 ;Reference to ^DPT supported by IA #10035
"RTN","PSOCLO1",8,0)
 ;Reference to $$GET1^DIQ is supported by DBIA 2056
"RTN","PSOCLO1",9,0)
 ;MH package will authorize dispensing of the Clozapine drugs
"RTN","PSOCLO1",10,0)
 K ANQDATA,ANQX,ANQNO,FLG,PSONEW("SAND"),^TMP($J,"PSO"),^TMP($J,"CLOZFLG",DFN)
"RTN","PSOCLO1",11,0)
 N X,Y,%,%DT,J,ANQ,ANQD,ANQJ,ANQRE,DTOUT,DUOUT,DIR,DIRUT,LSTFOUR,PSOYS,PSTYPE,PSREG,CLOZFLG
"RTN","PSOCLO1",12,0)
 ; START NCC REMEDIATION
"RTN","PSOCLO1",13,0)
 W !!,"Now doing Clozapine Order checks.  Please wait...",!
"RTN","PSOCLO1",14,0)
 N PSMSGTXT
"RTN","PSOCLO1",15,0)
 I XQY0["PSO" S PSTYPE=0,PSMSGTXT="prescription" K PSOSAND
"RTN","PSOCLO1",16,0)
 I XQY0["PSJ" S PSTYPE=1,PSMSGTXT="order"
"RTN","PSOCLO1",17,0)
 ;
"RTN","PSOCLO1",18,0)
 S CLOZFLG=0 ; Used to force start/stop dates to four days only
"RTN","PSOCLO1",19,0)
 ; ^PS(55,D0,SAND)= (#53) CLOZAPINE REGISTRATION NUMBER [1F] ^ (#54) CLOZAPINE STATUS [2S] 
"RTN","PSOCLO1",20,0)
 S PSREG=$$GET1^DIQ(55,DFN,53),PSREG("status")=$$GET1^DIQ(55,DFN,54,"I")
"RTN","PSOCLO1",21,0)
 D LABRSLT^PSOCLOU(DFN,.PSOYS,.CLOZPAT) ; get lab tests
"RTN","PSOCLO1",22,0)
 I PSREG=""!(PSREG("status")="D") D  D NOREG Q:'CLOZFLG  S PSREG=$$GET1^DIQ(55,DFN,53)
"RTN","PSOCLO1",23,0)
 . W !!,"*** This patient has no clozapine registration number ***",!
"RTN","PSOCLO1",24,0)
 I PSREG?1U6N S ^TMP($J,"CLOZFLG",DFN)=1
"RTN","PSOCLO1",25,0)
 ;
"RTN","PSOCLO1",26,0)
 ;
"RTN","PSOCLO1",27,0)
 S PSLAST7="" ; ** NCC REMEDIATION ** 457/RTW
"RTN","PSOCLO1",28,0)
 S PSOYS=$$CL^YSCLTST2(DFN)
"RTN","PSOCLO1",29,0)
 ;
"RTN","PSOCLO1",30,0)
 I PSREG("status")="A",PSREG?2U5N,PSOYS("rANC")="",PSOYS("rWBC")="" G OV1
"RTN","PSOCLO1",31,0)
 G:+PSOYS<0 END
"RTN","PSOCLO1",32,0)
 N PSGDSP
"RTN","PSOCLO1",33,0)
 S CLOZPAT=$P(PSOYS,U,7),CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOCLO1",34,0)
 G:+PSOYS=0 OV1
"RTN","PSOCLO1",35,0)
 I +PSOYS=1 D
"RTN","PSOCLO1",36,0)
 .I '$G(CLOZFLG),$G(^TMP($J,"CLOZFLG",DFN)) S CLOZFLG=1  Q
"RTN","PSOCLO1",37,0)
 .D DSP
"RTN","PSOCLO1",38,0)
 I PSOYS("rWBC")>0,PSOYS("rANC")>1499,'$G(CLOZFLG) D:'$G(PSTYPE) DOSE Q
"RTN","PSOCLO1",39,0)
 I $G(ANQRE)'=7,$$OVERRIDE^YSCLTST2(DFN) S ANQRE=7,ANQX=0 W !!,"Permission to dispense clozapine has been authorized by NCCC",!
"RTN","PSOCLO1",40,0)
 I $G(CLOZFLG),+PSOYS=1 S ANQRE=8
"RTN","PSOCLO1",41,0)
 S X=$S(CLOZPAT=2:84,CLOZPAT=1:42,1:21)
"RTN","PSOCLO1",42,0)
 D CL1^YSCLTST2(DFN,X)
"RTN","PSOCLO1",43,0)
 ;/RBN-RJS Begin modification for override bypass
"RTN","PSOCLO1",44,0)
 I $D(^TMP($J,"PSO")) D DSP,CHECK
"RTN","PSOCLO1",45,0)
 I $P(ANQ(1),U,2)>1499,+$G(PSTYPE),'+$G(ANQRE) Q  ;/RJS Emergency override
"RTN","PSOCLO1",46,0)
 I $P(ANQ(1),U,2)>1499,'$G(PSTYPE),'+$G(ANQRE) D DOSE Q  ;/RJS Emergency override
"RTN","PSOCLO1",47,0)
 E  D OVRD
"RTN","PSOCLO1",48,0)
 ;/RBN-RJS End modification for override bypass
"RTN","PSOCLO1",49,0)
 Q
"RTN","PSOCLO1",50,0)
 ;
"RTN","PSOCLO1",51,0)
OV1 ;
"RTN","PSOCLO1",52,0)
 I $$OVERRIDE^YSCLTST2(DFN) S ANQRE=7,ANQX=0 W !!,"Permission to dispense clozapine has been authorized by NCCC",!
"RTN","PSOCLO1",53,0)
 S X=$S(CLOZPAT=2:84,CLOZPAT=1:42,1:21)
"RTN","PSOCLO1",54,0)
 D CL1^YSCLTST2(DFN,X)
"RTN","PSOCLO1",55,0)
 S:$P(PSOYS,U,6)="" $P(PSOYS,U,6)=DT
"RTN","PSOCLO1",56,0)
 I $G(ANQRE)'=7 D DSP,CHECK
"RTN","PSOCLO1",57,0)
 I $G(ANQRE)=8!($G(ANQRE)=7) D OVRD Q
"RTN","PSOCLO1",58,0)
 ; patient is ACTIVE, has no labs, regular registration #
"RTN","PSOCLO1",59,0)
 I 'PSOYS("rWBC"),'PSOYS("rANC"),PSREG("status")="A",PSREG?2U5N D  Q
"RTN","PSOCLO1",60,0)
 . D PKEYCHK Q:$G(ANQX)  ; doesn't hold key
"RTN","PSOCLO1",61,0)
 . D:PSTYPE=1 MSG10^PSOCLUTL  ; inpt
"RTN","PSOCLO1",62,0)
 . D:PSTYPE=0 MSG9^PSOCLUTL  ; outpt
"RTN","PSOCLO1",63,0)
 . S ANQRE=9 D OVRD  ; PRESCRIBER APPROVED 4 DAY SUPPLY
"RTN","PSOCLO1",64,0)
 ;
"RTN","PSOCLO1",65,0)
 I PSOYS("rWBC"),PSOYS("rANC")<1000,PSOYS("rANC")>0 D MSG4^PSOCLUTL,MSG3^PSOCLUTL,MH,QU Q
"RTN","PSOCLO1",66,0)
 I $D(PSREG),'PSOYS("rWBC"),'PSOYS("rANC") D MSG4^PSOCLUTL,MSG3^PSOCLUTL,MH,QU Q
"RTN","PSOCLO1",67,0)
 I PSTYPE=0 D  ; outpatient
"RTN","PSOCLO1",68,0)
 . I PSOYS("rWBC"),'PSOYS("rANC") D MSG9^PSOCLUTL,PKEYCHK,OVRD Q  ;  WBC, no ANC
"RTN","PSOCLO1",69,0)
 . I PSOYS("rWBC"),'PSOYS("rANC") D MSG9^PSOCLUTL,PKEYCHK,OVRD Q  ; No labs
"RTN","PSOCLO1",70,0)
 ;
"RTN","PSOCLO1",71,0)
 I PSTYPE=1 D  ; inpatient
"RTN","PSOCLO1",72,0)
 . I PSOYS("rWBC"),'PSOYS("rANC") D MSG10^PSOCLUTL,OVRD Q  ; WBC, no ANC
"RTN","PSOCLO1",73,0)
 . I 'PSOYS("rWBC"),'PSOYS("rANC") D MSG10^PSOCLUTL,PKEYCHK,OVRD Q  ; No labs
"RTN","PSOCLO1",74,0)
 ;
"RTN","PSOCLO1",75,0)
 I 'PSOYS("rWBC"),PSOYS("rANC") D MSG1^PSOCLUTL Q  ; ANC, no WBC
"RTN","PSOCLO1",76,0)
 Q
"RTN","PSOCLO1",77,0)
CHECK ;
"RTN","PSOCLO1",78,0)
 S:'$$HASKEY(DUZ) ANQX=0 ;RTW added because of undefined ANQX error from PSGOE7 routine 3160303
"RTN","PSOCLO1",79,0)
 I $G(ANQRE)'=7,$G(ANQRE)'=8 S ANQRE=$S('PSOYS("rANC"):9,PSOYS("rANC")<1000:9,'PSOYS("rWBC"):9,PSOYS("rANC")<1500:10,PSLAST7["Y":9,1:0)
"RTN","PSOCLO1",80,0)
 I '$P(PSOYS,U,6) S $P(PSOYS,U,6)=$$NOW^XLFDT
"RTN","PSOCLO1",81,0)
 S (ANQD,ANQD(1))=9999999-$P(PSOYS,U,6)
"RTN","PSOCLO1",82,0)
 S ANQ(1)=PSOYS("rWBC")_U_PSOYS("rANC") D
"RTN","PSOCLO1",83,0)
 .Q:'$D(^TMP($J,"PSO"))
"RTN","PSOCLO1",84,0)
 .F ANQJ=2:1:4 S ANQD=$O(^TMP($J,"PSO",ANQD)) Q:'ANQD  S ANQ(ANQJ)=^(ANQD),ANQD(ANQJ)=ANQD
"RTN","PSOCLO1",85,0)
 S ANQD=$O(ANQ(""),-1)
"RTN","PSOCLO1",86,0)
 I $D(PSREG),PSREG=""!(PSREG?1U6N),PSOYS("rANC")'>1499 D  Q  ; temporary reg # not enough
"RTN","PSOCLO1",87,0)
 . W !,"Emergency overrides for non-registered clozapine patients require",!,"ANC levels greater than or equal to 1500",!
"RTN","PSOCLO1",88,0)
 . S ANQX=1
"RTN","PSOCLO1",89,0)
 I ANQD<2 W !,"*** No previous results to display ***",! Q
"RTN","PSOCLO1",90,0)
 S ANQ=$S($P(ANQ(1),U)!$P(ANQ(1),U,2):ANQD,1:ANQD-1)
"RTN","PSOCLO1",91,0)
 W !,"*** Last "_$S(ANQ=4:"Four ",ANQ=3:"Three ",ANQ=2:"Two ",1:"")_"WBC and NEUTROPHILS ABSOLUTE (ANC) results ***",!
"RTN","PSOCLO1",92,0)
 W !,$J("WBC    ANC",49),!
"RTN","PSOCLO1",93,0)
 F ANQJ=ANQD:-1:1 S ANQD=9999999-ANQD(ANQJ)_"0000" D
"RTN","PSOCLO1",94,0)
 . I $L($P($G(ANQ(ANQJ)),U))!$L($P($G(ANQ(ANQJ)),U,2))  D
"RTN","PSOCLO1",95,0)
 ..  W $$FMTE^XLFDT(ANQD,"5Z") W:ANQD["." "@",$E(ANQD,9,10),":",$E(ANQD,11,12)
"RTN","PSOCLO1",96,0)
 ..  W ?29,"Results: "_$J($P(ANQ(ANQJ),U),4)_"   ",$J($P(ANQ(ANQJ),U,2),4),!
"RTN","PSOCLO1",97,0)
 Q
"RTN","PSOCLO1",98,0)
 ;
"RTN","PSOCLO1",99,0)
OVRD ;
"RTN","PSOCLO1",100,0)
 Q:$G(ANQX)
"RTN","PSOCLO1",101,0)
 N PSREASON
"RTN","PSOCLO1",102,0)
 I ANQRE,'$$HASKEY(DUZ) D  D QU G EXIT
"RTN","PSOCLO1",103,0)
 . S ANQX=1 W !!,"You Are Not Authorized to Override! See Clozapine Manager with PSOLOCKCLOZ key."
"RTN","PSOCLO1",104,0)
 ;
"RTN","PSOCLO1",105,0)
 I $L($G(PSOYS)) D:PSOYS("rANC")<1000  ; severe neutropenia
"RTN","PSOCLO1",106,0)
 . W !,"Test ANC labs daily until levels stabilize to ANC greater than or equal to 1000.",!
"RTN","PSOCLO1",107,0)
 I ANQRE W !,"Override reason: "_$$OVRDTXT^PSOCLOU(ANQRE),! D
"RTN","PSOCLO1",108,0)
 . I ANQRE=7 D  Q
"RTN","PSOCLO1",109,0)
 ..  S PSREASON=$$OVRDTXT^PSOCLOU(ANQRE)
"RTN","PSOCLO1",110,0)
 ..  D OVPRMPT Q:$G(ANQX)
"RTN","PSOCLO1",111,0)
 ..  D OVRD2 Q:$G(ANQX)
"RTN","PSOCLO1",112,0)
 ..  D OVRREA
"RTN","PSOCLO1",113,0)
 . I ANQRE=5 D  Q
"RTN","PSOCLO1",114,0)
 ..  N DIR S DIR("A")="ANC levels are Critically low. Do you want to Cancel the order",DIR(0)="Y",DIR("B")="N"
"RTN","PSOCLO1",115,0)
 ..  D ^DIR I Y=0 D MSG6^PSOCLUTL Q
"RTN","PSOCLO1",116,0)
 ..  I Y(0)="YES"!($D(DTOUT))!($D(DUOUT))!($D(DIROUT)) S ANQX=1 K Q
"RTN","PSOCLO1",117,0)
 . I $G(ANQRE)=8 D  Q
"RTN","PSOCLO1",118,0)
 ..  S ANQX=0 D OVPRMPT Q:$G(ANQX)
"RTN","PSOCLO1",119,0)
 ..  D OVRD2 Q:$G(ANQX)
"RTN","PSOCLO1",120,0)
 ..  D OVRREA Q:$G(ANQX)
"RTN","PSOCLO1",121,0)
 ..  D CRXTMPI(DFN,PSOYS)
"RTN","PSOCLO1",122,0)
 . ;/RBN Begin modifications for new special override condition for inpatient
"RTN","PSOCLO1",123,0)
 . I ANQRE=9,PSTYPE=0 D  Q
"RTN","PSOCLO1",124,0)
 ..  D OVPRMPT Q:$G(ANQX)
"RTN","PSOCLO1",125,0)
 ..  N DIR,DIRUT S DIR(0)="S^1:Weather Related Conditions;2:Mail Order Delay;3:Inpatient Going On Leave"
"RTN","PSOCLO1",126,0)
 ..  S DIR("A")="Prescriber's reason for Special Condition Override " D ^DIR I $D(DIRUT) S ANQX=1 Q
"RTN","PSOCLO1",127,0)
 ..  S PSREASON=Y(0)_": ",^TMP($J,"CLOZFLG",DFN)=1
"RTN","PSOCLO1",128,0)
 ..  D OVRD2 Q:$G(ANQX)
"RTN","PSOCLO1",129,0)
 ..  D OVRREA Q:$G(ANQX)
"RTN","PSOCLO1",130,0)
 ..  S PSREMARK=PSREASON_PSREMARK
"RTN","PSOCLO1",131,0)
 ..  D CRXTMP(DFN,PSOYS)
"RTN","PSOCLO1",132,0)
 . I ANQRE=9,PSTYPE=1 D  Q
"RTN","PSOCLO1",133,0)
 ..  D OVPRMPT Q:$G(ANQX)
"RTN","PSOCLO1",134,0)
 ..  S PSREASON="IP Order Override with Outside Lab Results: ",^TMP($J,"CLOZFLG",DFN)=1
"RTN","PSOCLO1",135,0)
 ..  W !,$P(PSREASON,":"),!
"RTN","PSOCLO1",136,0)
 ..  D OVRREA Q:$G(ANQX)
"RTN","PSOCLO1",137,0)
 ..  D OVRD2 Q:$G(ANQX)
"RTN","PSOCLO1",138,0)
 ..  S PSREMARK=PSREASON_PSREMARK
"RTN","PSOCLO1",139,0)
 ..  D CRXTMPI(DFN,PSOYS)
"RTN","PSOCLO1",140,0)
 . I ANQRE=10 D
"RTN","PSOCLO1",141,0)
 ..  W !,"Test ANC Results 3x weekly until ANC stabilize to greater than or equal to 1500",!
"RTN","PSOCLO1",142,0)
 ..  D OVPRMPT Q:$G(ANQX)
"RTN","PSOCLO1",143,0)
 ..  D OVRD2 Q:$G(ANQX)
"RTN","PSOCLO1",144,0)
 ..  D OVRREA
"RTN","PSOCLO1",145,0)
 ;
"RTN","PSOCLO1",146,0)
 I $G(ANQX) D EXIT Q
"RTN","PSOCLO1",147,0)
 ;
"RTN","PSOCLO1",148,0)
 S PSPROVID="UNKNOWN"
"RTN","PSOCLO1",149,0)
 I $D(ND0) S PSPROVID=$P(ND0,U,2),PSJORN=$P(ND0,U,21),PSJORDER("PSJORN")=PSJORN
"RTN","PSOCLO1",150,0)
 I $D(ORO) S PSPROVID=$P(ORO,U,4),PSJORN=$P(ORO,U),PSJORDER("PSJORN")=PSJORN
"RTN","PSOCLO1",151,0)
 I '$G(PSPROVID),$G(PSTYPE),$G(PSGOEPR) S PSPROVID=+$G(PSGOEPR)
"RTN","PSOCLO1",152,0)
 I $D(DUPRX0) S PSPROVID=$P(DUPRX0,U,4)
"RTN","PSOCLO1",153,0)
 ;/RBN Begin modifications for new special overide condition for inpatient
"RTN","PSOCLO1",154,0)
 ;
"RTN","PSOCLO1",155,0)
 S:ANQRE SANQX=0,PSCLPAT=DFN,ANQDATA=DUZ_U_PSPROVID_U_ANQRE_U_PSREMARK_U_PSSPHARM_U_PSCLPAT_U_$G(PSJORN)
"RTN","PSOCLO1",156,0)
 ;
"RTN","PSOCLO1",157,0)
GDOSE ; set variable to ask daily dose
"RTN","PSOCLO1",158,0)
 N PSOCD
"RTN","PSOCLO1",159,0)
 I $G(PSTYPE) Q
"RTN","PSOCLO1",160,0)
DOSE ;
"RTN","PSOCLO1",161,0)
 S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR G EXIT:$D(DIRUT)
"RTN","PSOCLO1",162,0)
 S PSOCD=X
"RTN","PSOCLO1",163,0)
 I PSOCD#25=0,PSOCD'<12.5,PSOCD<900 G EXIT
"RTN","PSOCLO1",164,0)
 I PSOCD#12.5 S DIR(0)="Y",DIR("B")="NO",DIR("A")=PSOCD_" is an unusual dose.  Are you sure" D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSOCLO1",165,0)
 I PSOCD>900 S DIR(0)="Y",DIR("A")="Recommended maximum daily dose is 900. Are you sure" D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSOCLO1",166,0)
EXIT ;
"RTN","PSOCLO1",167,0)
 K ^TMP($J,"PSO")
"RTN","PSOCLO1",168,0)
 S:$D(DIRUT) ANQX=1
"RTN","PSOCLO1",169,0)
 I $G(ANQX) W !!,"No "_PSMSGTXT_" entered!" H 2 Q
"RTN","PSOCLO1",170,0)
 ;
"RTN","PSOCLO1",171,0)
 D LABRSLT^PSOCLOU(DFN,.PSOYS,.CLOZPAT) ; if added to files #55 or #603.01 lab results may be available
"RTN","PSOCLO1",172,0)
 S (PSONEW("SAND"),PSOSAND)=PSOCD_U_PSOYS("rWBC")_U_($P($P(PSOYS,U,6),"."))_U_PSOYS("rANC")
"RTN","PSOCLO1",173,0)
 N NDAYS S NDAYS=$S($G(ANQRE)=9!(PSREG?1U6N):4,CLOZPAT=2:28,CLOZPAT=1:14,1:7)
"RTN","PSOCLO1",174,0)
 I $G(PSONEW("DAYS SUPPLY"))>NDAYS D
"RTN","PSOCLO1",175,0)
 .S PSONEW("DAYS SUPPLY")=NDAYS,$P(PSONEW("RX0"),U,8)=NDAYS
"RTN","PSOCLO1",176,0)
 .S PSONEW("DURATION",1)=NDAYS
"RTN","PSOCLO1",177,0)
 .N PSOIENX S PSOIENX="1,"_$G(PSORXIEN)
"RTN","PSOCLO1",178,0)
 .S PSONEW("SCHEDULE",1)=$$GET1^DIQ(52.0113,PSOIENX,7)
"RTN","PSOCLO1",179,0)
 .S PSONEW("DOSE ORDERED",1)=$$GET1^DIQ(52.0113,PSOIENX,1)
"RTN","PSOCLO1",180,0)
 .N SCH,ND,QTY S SCH=PSONEW("SCHEDULE",1)
"RTN","PSOCLO1",181,0)
 .S ND=$$QTSCH^PSOSIG(SCH) Q:'ND   ;number of minutes between meds
"RTN","PSOCLO1",182,0)
 .S ND=1440/ND                     ;times daily
"RTN","PSOCLO1",183,0)
 .S QTY=NDAYS*ND*PSONEW("DOSE ORDERED",1)
"RTN","PSOCLO1",184,0)
 .S PSONEW("QTY")=QTY,$P(PSONEW("RX0"),U,7)=QTY
"RTN","PSOCLO1",185,0)
 Q
"RTN","PSOCLO1",186,0)
 ;
"RTN","PSOCLO1",187,0)
OVPRMPT ; ask user to override
"RTN","PSOCLO1",188,0)
 N DIR
"RTN","PSOCLO1",189,0)
 S DIR("A")="Do you want to override and issue this "_PSMSGTXT,DIR(0)="Y",DIR("B")="N" D ^DIR
"RTN","PSOCLO1",190,0)
 I 'Y!($D(DIROUT)!($D(DTOUT))) S ANQX=1
"RTN","PSOCLO1",191,0)
 Q
"RTN","PSOCLO1",192,0)
 ;
"RTN","PSOCLO1",193,0)
PKEYCHK ; does user have PSOLOCKCLOZ key
"RTN","PSOCLO1",194,0)
 I '$D(PSGSTAT)!($G(PSGSTAT)="PENDING") D
"RTN","PSOCLO1",195,0)
 . Q:$$HASKEY(DUZ)  ; has the security key
"RTN","PSOCLO1",196,0)
 . S ANQX=1 W !,"You Are Not Authorized to Override! See Clozapine Manager with PSOLOCKCLOZ key."
"RTN","PSOCLO1",197,0)
 Q
"RTN","PSOCLO1",198,0)
 ;
"RTN","PSOCLO1",199,0)
MH ;
"RTN","PSOCLO1",200,0)
 W !!,"Also make sure that the LAB test, ANC is set up correctly in the"
"RTN","PSOCLO1",201,0)
 W !,"Mental Health package using the CLOZAPINE MULTI TEST LINK option.",!
"RTN","PSOCLO1",202,0)
 Q
"RTN","PSOCLO1",203,0)
DSP ; subroutine: NCC remediation PSO*7.0*457
"RTN","PSOCLO1",204,0)
 I 'PSOYS("rWBC"),'PSOYS("rANC") Q
"RTN","PSOCLO1",205,0)
 Q:$G(PSGDSP)
"RTN","PSOCLO1",206,0)
 N DIR,Y S Y=$P($$FMTE^XLFDT($P(PSOYS,U,6)),"@")
"RTN","PSOCLO1",207,0)
 W !,"*** Most recent WBC and "_$P(PSOYS,U,5)_" (ANC) results ***"
"RTN","PSOCLO1",208,0)
 W !,"     performed on "_Y_" are: "
"RTN","PSOCLO1",209,0)
 W !!,"    "_$P(PSOYS,U,3)_": "_PSOYS("rWBC")
"RTN","PSOCLO1",210,0)
 W !,"    ANC: "_PSOYS("rANC"),!
"RTN","PSOCLO1",211,0)
 S DIR(0)="EA",DIR("A")="Type <Enter> to continue: " D ^DIR W !
"RTN","PSOCLO1",212,0)
 S PSGDSP=1
"RTN","PSOCLO1",213,0)
 Q
"RTN","PSOCLO1",214,0)
DIR ;
"RTN","PSOCLO1",215,0)
 W !! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSOCLO1",216,0)
 Q
"RTN","PSOCLO1",217,0)
 ;
"RTN","PSOCLO1",218,0)
END ;
"RTN","PSOCLO1",219,0)
 D MSG5^PSOCLUTL
"RTN","PSOCLO1",220,0)
QU ; no med prescribed 
"RTN","PSOCLO1",221,0)
 S ANQX=1 D DIR
"RTN","PSOCLO1",222,0)
 Q
"RTN","PSOCLO1",223,0)
 ;
"RTN","PSOCLO1",224,0)
 ; /RBN Begin NCC weekend/new patient for PSO*7.0*457
"RTN","PSOCLO1",225,0)
NOREG ; Register a new/discontinued non-registered cloz patient
"RTN","PSOCLO1",226,0)
 ;
"RTN","PSOCLO1",227,0)
 N %,FIRST,FLG,I,LAST,LSTFOUR,MSG,MSGNUM,NAME,NOW,PSO1,PSO2,PSO4,PSONAME,REG,SSN,STAT,TMP1
"RTN","PSOCLO1",228,0)
 N TMP2,X,X1,X2XML,XMSUB,XMTEXT,Y,YSCLFRQ
"RTN","PSOCLO1",229,0)
 ; Check for authorization key
"RTN","PSOCLO1",230,0)
 I '$$HASKEY(DUZ) D  Q
"RTN","PSOCLO1",231,0)
 . S ANQX=1 W !,"You Are Not Authorized to Override! See Clozapine Manager with PSOLOCKCLOZ key." W:PSTYPE=1 !!,"No order entered!"
"RTN","PSOCLO1",232,0)
 ;
"RTN","PSOCLO1",233,0)
 W !,"Do you want to register this patient with a temporary local"
"RTN","PSOCLO1",234,0)
 W !," authorization number in the Clozapine registry? Y/N  "
"RTN","PSOCLO1",235,0)
 S %=2 D YN^DICN I %'=1 S ANQX=1 W !,"Patient Not Registered",! Q
"RTN","PSOCLO1",236,0)
 W !
"RTN","PSOCLO1",237,0)
 S (PSO1,TMP1)=DFN
"RTN","PSOCLO1",238,0)
 S PSO2=$$FINDNEXT^PSOCLOU
"RTN","PSOCLO1",239,0)
 I PSO2=-1 D  S ANQX=1 Q
"RTN","PSOCLO1",240,0)
 . W !!,"All emergency registration numbers have been used."
"RTN","PSOCLO1",241,0)
 . W !,"Emergency registration may no longer be done at this site",!!
"RTN","PSOCLO1",242,0)
 . W !,"Patient Not Registered",!
"RTN","PSOCLO1",243,0)
CONT S TMP2=PSO2
"RTN","PSOCLO1",244,0)
 S (NAME,PSONAME)=$$GET1^DIQ(2,PSO1,.01)
"RTN","PSOCLO1",245,0)
 S PSCLOZ=1
"RTN","PSOCLO1",246,0)
 S DFN=TMP1
"RTN","PSOCLO1",247,0)
 S (PSO2,REG)=TMP2
"RTN","PSOCLO1",248,0)
 ; Check if registration in file #55 failed or was terminated
"RTN","PSOCLO1",249,0)
 S LAST=$P(NAME,","),FIRST=$P($P(NAME,",",2)," ")
"RTN","PSOCLO1",250,0)
 S SSN=$$GET1^DIQ(2,PSO1,.09),LSTFOUR=$E(SSN,6,9),ANQX=1
"RTN","PSOCLO1",251,0)
 D NUMBER1^PSOCLUTL
"RTN","PSOCLO1",252,0)
 Q:$G(ANQX)
"RTN","PSOCLO1",253,0)
 D  ; delete entries in file 603.01 for this patient
"RTN","PSOCLO1",254,0)
 . N DIK,DA
"RTN","PSOCLO1",255,0)
 . S DIK="^YSCL(603.01,",DA="" F  S DA=$O(^YSCL(603.01,"C",DFN,DA)) Q:DA=""  D ^DIK
"RTN","PSOCLO1",256,0)
 S MSG(1)=REG_","_LAST_","_FIRST_","_LSTFOUR
"RTN","PSOCLO1",257,0)
 S XMTEXT="MSG("
"RTN","PSOCLO1",258,0)
 ;/RBN Begin modification for XMSUB gets killed off in NUMBER1^PSOCLUTL
"RTN","PSOCLO1",259,0)
 S XMSUB="ADD"
"RTN","PSOCLO1",260,0)
 N YSPROD S YSPROD=$$GET1^DIQ(8989.3,1,501,"I") D
"RTN","PSOCLO1",261,0)
 . I YSPROD S XMY("G.RUCLDEM@FO-DALLAS.DOMAIN.EXT")="" Q  ; production account
"RTN","PSOCLO1",262,0)
 . S XMY("G.CLOZAPINE ROLL-UP")=""  ; test account
"RTN","PSOCLO1",263,0)
 D ^XMD
"RTN","PSOCLO1",264,0)
 S DFN=TMP1
"RTN","PSOCLO1",265,0)
 I '$G(XMMG) S MSGNUM=$G(XMZ)
"RTN","PSOCLO1",266,0)
 E  W !!,"Failed to connect with the NCCC." S PSOFL=1 Q
"RTN","PSOCLO1",267,0)
 ; Now trick the server into thinking it is sending a message
"RTN","PSOCLO1",268,0)
 ; so we can populate 55 and 603.01
"RTN","PSOCLO1",269,0)
 S PSCLOZ=1,^TMP($J,"CLOZFLG",DFN)=1,XMRG=MSG(1),XMFROM=DUZ,XQDATE=$$NOW^XLFDT
"RTN","PSOCLO1",270,0)
 D ^YSCLSERV
"RTN","PSOCLO1",271,0)
 D XTMPZRO
"RTN","PSOCLO1",272,0)
 S $P(^XTMP("PSJ CLOZ",0),U,4)=REG
"RTN","PSOCLO1",273,0)
 S ^XTMP("PSJ CLOZ",DFN)=DT_U_REG_U_"A"
"RTN","PSOCLO1",274,0)
 S ^XTMP("PSJ CLOZ","B",REG,DFN)=$$FMADD^XLFDT($$NOW^XLFDT,4)  ; four days from now
"RTN","PSOCLO1",275,0)
 S ^XTMP("PSJ CLOZ","C",DFN,REG)=""
"RTN","PSOCLO1",276,0)
 S ANQX=0,CLOZFLG=1
"RTN","PSOCLO1",277,0)
 D LABRSLT^PSOCLOU(DFN,.PSOYS,.CLOZPAT) ; lab results may now be available
"RTN","PSOCLO1",278,0)
 ;
"RTN","PSOCLO1",279,0)
QUIT ;
"RTN","PSOCLO1",280,0)
 Q
"RTN","PSOCLO1",281,0)
 ;
"RTN","PSOCLO1",282,0)
OVRD2 ;
"RTN","PSOCLO1",283,0)
 S PSSPHARM=""  ; clozapine team member IEN
"RTN","PSOCLO1",284,0)
 D OVRDTMBR^PSOCLOU
"RTN","PSOCLO1",285,0)
 S:'PSSPHARM ANQX=1  ; no team member selected, exit
"RTN","PSOCLO1",286,0)
 Q
"RTN","PSOCLO1",287,0)
 ;
"RTN","PSOCLO1",288,0)
OVRREA ; Override reason when order is NCCC Approved
"RTN","PSOCLO1",289,0)
 S ANQX=0
"RTN","PSOCLO1",290,0)
 I $G(ANQRE)>6 D
"RTN","PSOCLO1",291,0)
 . N DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSOCLO1",292,0)
 . S DIR(0)="F^5:200"
"RTN","PSOCLO1",293,0)
 . S DIR("A")="REASON FOR OVERRIDE Remarks"
"RTN","PSOCLO1",294,0)
 . I $G(ANQRE)=9 S DIR("A")="Remarks: "_$P(PSREASON,":")
"RTN","PSOCLO1",295,0)
 . S DIR("?")="Response is 5 to 200 characters."
"RTN","PSOCLO1",296,0)
 . D ^DIR
"RTN","PSOCLO1",297,0)
 . I $G(DTOUT)!$G(DUOUT)!$G(DIRUT)!$G(DIROUT) S ANQX=1 Q
"RTN","PSOCLO1",298,0)
 . S PSREMARK=Y
"RTN","PSOCLO1",299,0)
 Q
"RTN","PSOCLO1",300,0)
 ;
"RTN","PSOCLO1",301,0)
CHK4REG(YSCLDFN) ; See if tpatient already has a clozapine registration number
"RTN","PSOCLO1",302,0)
 N YSCLANS
"RTN","PSOCLO1",303,0)
 S YSCLANS=$O(^XTMP("PSJ CLOZ","C",YSCLDFN,""))
"RTN","PSOCLO1",304,0)
 Q YSCLANS
"RTN","PSOCLO1",305,0)
 ;
"RTN","PSOCLO1",306,0)
CHK4DFN(YSCLREG) ; See if this Clozapine registration is assigned
"RTN","PSOCLO1",307,0)
 N YSCLANS
"RTN","PSOCLO1",308,0)
 S YSCLANS=$O(^XTMP("PSJ CLOZ","B",YSCLREG,""))
"RTN","PSOCLO1",309,0)
 Q YSCLANS
"RTN","PSOCLO1",310,0)
 ;
"RTN","PSOCLO1",311,0)
CHK4EXP(YSCLREG,YSCLDFN) ; Check for registration expiration
"RTN","PSOCLO1",312,0)
 ;    RETURNS 0 IF EXPIRED
"RTN","PSOCLO1",313,0)
 ;            1 IF NOT EXPIRED
"RTN","PSOCLO1",314,0)
 N YSCLANS,YSCLDAT
"RTN","PSOCLO1",315,0)
 S YSCLANS=1
"RTN","PSOCLO1",316,0)
 I $D(^XTMP("PSJ CLOZ","B",YSCLREG,YSCLDFN)) D
"RTN","PSOCLO1",317,0)
 .S YSCLDAT=$G(^XTMP("PSJ CLOZ","B",YSCLREG,YSCLDFN))
"RTN","PSOCLO1",318,0)
 .I YSCLDAT<DT D
"RTN","PSOCLO1",319,0)
 ..S YSCLANS=0
"RTN","PSOCLO1",320,0)
 ..S:YSCLDAT>0 $P(^XTMP("PSJ CLOZ",YSCLDFN),U,3)="D"
"RTN","PSOCLO1",321,0)
 Q YSCLANS
"RTN","PSOCLO1",322,0)
 ;
"RTN","PSOCLO1",323,0)
CRXTMP(DFN,PSOYS) ; create XTMP entry for 4 day supply tracking
"RTN","PSOCLO1",324,0)
 I $G(DFN) D CRXTMP^PSOCLUTL(DFN,PSOYS)
"RTN","PSOCLO1",325,0)
 Q
"RTN","PSOCLO1",326,0)
CRXTMPI(DFN,PSOYS) ; create XTMP entry for 4 day supply tracking
"RTN","PSOCLO1",327,0)
 I $G(DFN) D CRXTMPI^PSOCLUTL(DFN,PSOYS)
"RTN","PSOCLO1",328,0)
 Q
"RTN","PSOCLO1",329,0)
 ;
"RTN","PSOCLO1",330,0)
HASKEY(USRNUM) ; Boolean function, does USRNUM hold the PSOLOCKCLOZ security key?
"RTN","PSOCLO1",331,0)
 I '$G(USRNUM)>0 S USRNUM=DUZ  ; default to current user
"RTN","PSOCLO1",332,0)
 Q $S($D(^XUSEC("PSOLOCKCLOZ",USRNUM)):1,1:0)
"RTN","PSOCLO1",333,0)
 ;
"RTN","PSOCLO1",334,0)
XTMPZRO ;set zero node in ^XTMP("PSJ CLOZ")
"RTN","PSOCLO1",335,0)
 N Y
"RTN","PSOCLO1",336,0)
 S Y=$$FMADD^XLFDT($$DT^XLFDT,180)  ; 6 months in the future
"RTN","PSOCLO1",337,0)
 S $P(^XTMP("PSJ CLOZ",0),U)=Y,$P(^XTMP("PSJ CLOZ",0),U,2)=DT,$P(^XTMP("PSJ CLOZ",0),U,3)="CLOZAPINE WEEKEND REGISTRATION"
"RTN","PSOCLO1",338,0)
 Q
"RTN","PSOCLO1",339,0)
 ;
"RTN","PSOCLOLS")
0^20^B14700402
"RTN","PSOCLOLS",1,0)
PSOCLOLS ; HEC/hrub ;4 May 2019 18:48:29
"RTN","PSOCLOLS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**457**;DEC 1997;Build 116
"RTN","PSOCLOLS",3,0)
 ;
"RTN","PSOCLOLS",4,0)
 W !,"Print clozapine prescriptions with lockout override.",!
"RTN","PSOCLOLS",5,0)
 D DT^DICRW N %ZIS,DIR,PSOCLDT
"RTN","PSOCLOLS",6,0)
 S DIR(0)="DA^:"_DT_":XE",DIR("A")="Override Beginning date: " D ^DIR G EXIT:'(Y>0) S PSOCLDT("beg")=Y
"RTN","PSOCLOLS",7,0)
 K DIR S DIR(0)="DA^"_Y_":"_DT_":XE",DIR("A")="   Override Ending date: " D ^DIR G EXIT:Y<0 S PSOCLDT("end")=Y
"RTN","PSOCLOLS",8,0)
 K %ZIS S %ZIS="Q" D ^%ZIS G EXIT:POP
"RTN","PSOCLOLS",9,0)
 I $D(IO("Q")) D QUE G EXIT
"RTN","PSOCLOLS",10,0)
DQ ; List of Override Prescriptions [PSOLIST OVERRIDES] report
"RTN","PSOCLOLS",11,0)
 N PSIEN,PSOHDR,PSOLPDT,X
"RTN","PSOCLOLS",12,0)
 S PSOHDR(1)=" Clozapine Lockout Override Prescriptions - "_$$FMTE^XLFDT($$NOW^XLFDT)_"   Page: "
"RTN","PSOCLOLS",13,0)
 S PSOHDR(2)="    From "_$$FMTE^XLFDT(PSOCLDT("beg"))_" through "_$$FMTE^XLFDT(PSOCLDT("end"))
"RTN","PSOCLOLS",14,0)
 S PSOHDR(0,"pg#")=0
"RTN","PSOCLOLS",15,0)
 W:$Y @IOF D PGHDR(.PSOHDR) I '$O(^PS(52.52,"B",PSOCLDT("beg"))) D NOTFND(.PSOHDR) G EXIT
"RTN","PSOCLOLS",16,0)
 I $O(^PS(52.52,"B",PSOCLDT("beg")))>PSOCLDT("end") D NOTFND(.PSOHDR) G EXIT
"RTN","PSOCLOLS",17,0)
 S PSOLPDT=PSOCLDT("beg")-.1,PSOLPDT("stop")=0  ; PSOLPDT("stop") - flag to exit loop
"RTN","PSOCLOLS",18,0)
 F  S PSOLPDT=$O(^PS(52.52,"B",PSOLPDT)) Q:'PSOLPDT!PSOLPDT("stop")!(PSOLPDT>PSOCLDT("end"))  D
"RTN","PSOCLOLS",19,0)
 . S PSIEN=0 F  S PSIEN=$O(^PS(52.52,"B",PSOLPDT,PSIEN)) Q:'PSIEN  S X=$G(^PS(52.52,PSIEN,0)) D:$L(X) PRINT(X)
"RTN","PSOCLOLS",20,0)
 ;
"RTN","PSOCLOLS",21,0)
 D:'PSOLPDT("stop") RPTEND  ; only if user didn't enter '^'
"RTN","PSOCLOLS",22,0)
 ;
"RTN","PSOCLOLS",23,0)
EXIT ;
"RTN","PSOCLOLS",24,0)
 D ^%ZISC Q
"RTN","PSOCLOLS",25,0)
 ;
"RTN","PSOCLOLS",26,0)
PRINT(OVRDND) ;OVRDND - zero node of entry in file 52.52
"RTN","PSOCLOLS",27,0)
 I $Y+7>IOSL D
"RTN","PSOCLOLS",28,0)
 . I '$G(ZTSK),$E(IOST,1,2)="C-"  D   ; only if interactive user
"RTN","PSOCLOLS",29,0)
 ..  N DIR S DIR(0)="E" D ^DIR S:'Y PSOLPDT("stop")=1
"RTN","PSOCLOLS",30,0)
 . I 'PSOLPDT("stop") W @IOF D PGHDR(.PSOHDR)
"RTN","PSOCLOLS",31,0)
 N CLUSR,RPTLN,RXCLO,Y
"RTN","PSOCLOLS",32,0)
 S RXCLO("rxIen")=+$P(OVRDND,U,2),RXCLO("ntryDuz")=+$P(OVRDND,U,3),RXCLO("apprvDuz")=+$P(OVRDND,U,4),RXCLO("ovrdRsn")=$P(OVRDND,U,6)
"RTN","PSOCLOLS",33,0)
 S RXCLO("ntryNm")=$P($G(^VA(200,RXCLO("ntryDuz"),0)),U),RXCLO("apprvNm")=$P($G(^VA(200,RXCLO("apprvDuz"),0)),U)
"RTN","PSOCLOLS",34,0)
 S RXCLO("cmmnt")=$P(OVRDND,U,6),RXCLO("rxZroNd")=$S($D(^PSRX(RXCLO("rxIen"),0)):^(0),1:""),RXCLO("rxDfn")=$P(RXCLO("rxZroNd"),U,2),RXCLO("rxDrgIen")=$P(RXCLO("rxZroNd"),U,6),RXCLO("rx#")=$P(RXCLO("rxZroNd"),U)
"RTN","PSOCLOLS",35,0)
 I RXCLO("rxIen") S RXCLO("rxPtNm")=$P(^DPT(RXCLO("rxDfn"),0),U),RXCLO("drugNm")=$P($G(^PSDRUG(RXCLO("rxDrgIen"),0)),U)
"RTN","PSOCLOLS",36,0)
 S Y=$$FMTE^XLFDT(PSOLPDT,2),RPTLN="Date: "_Y_$J(" ",18-$L(Y))_" Rx #"_$S(RXCLO("rxIen"):RXCLO("rx#"),1:" UNKNOWN (Rx Deleted)")
"RTN","PSOCLOLS",37,0)
 S RPTLN=RPTLN_"   Patient: "_$S(RXCLO("rxIen"):RXCLO("rxPtNm"),1:"UNKNOWN")
"RTN","PSOCLOLS",38,0)
 W !,RPTLN
"RTN","PSOCLOLS",39,0)
 W !,"  Drug: "_$S(RXCLO("rxIen"):RXCLO("drugNm"),1:"UNKNOWN (PRESCRIPTION DELETED)")
"RTN","PSOCLOLS",40,0)
 W !,"  Entered by: "_RXCLO("ntryNm")_"  Approved by: "_RXCLO("apprvNm")
"RTN","PSOCLOLS",41,0)
 W !,"  Override reason: "_$P(RXCLO("ovrdRsn"),":",2)
"RTN","PSOCLOLS",42,0)
 W !,"  Comments: "_RXCLO("cmmnt"),!
"RTN","PSOCLOLS",43,0)
 Q
"RTN","PSOCLOLS",44,0)
PGHDR(PSOHDR) ; header, PSOHDR passed by ref.
"RTN","PSOCLOLS",45,0)
 S PSOHDR(0,"pg#")=PSOHDR(0,"pg#")+1
"RTN","PSOCLOLS",46,0)
 U IO W !,PSOHDR(1)_PSOHDR(0,"pg#"),!,PSOHDR(2),! Q
"RTN","PSOCLOLS",47,0)
 ;
"RTN","PSOCLOLS",48,0)
RPTEND ;
"RTN","PSOCLOLS",49,0)
 W !," ** End of Clozapine Override Report **",! Q
"RTN","PSOCLOLS",50,0)
QUE ;queue job
"RTN","PSOCLOLS",51,0)
 N ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","PSOCLOLS",52,0)
 S ZTRTN="DQ^"_$T(+0),ZTDESC="Clozapine Override Report",ZTSAVE("PSOCLDT")="" D ^%ZTLOAD
"RTN","PSOCLOLS",53,0)
 W !,$S($G(ZTSK):"Override Report queued as task #"_ZTSK,1:"* Report NOT queued.")
"RTN","PSOCLOLS",54,0)
 Q
"RTN","PSOCLOLS",55,0)
 ;
"RTN","PSOCLOLS",56,0)
NOTFND(PSOHDR) ;
"RTN","PSOCLOLS",57,0)
 W !," * No CLOZAPINE PRESCRIPTION OVERRIDES"_PSOHDR(2)_" *",!
"RTN","PSOCLOLS",58,0)
 D RPTEND
"RTN","PSOCLOLS",59,0)
 Q
"RTN","PSOCLOLS",60,0)
 ;
"RTN","PSOCLOU")
0^18^B77943063
"RTN","PSOCLOU",1,0)
PSOCLOU ; HEC/hrub - clozapine support utilities ;28 May 2019 14:59:09
"RTN","PSOCLOU",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**457**;DEC 1997;Build 116
"RTN","PSOCLOU",3,0)
 ;
"RTN","PSOCLOU",4,0)
 ; 29 April 2019 - code moved from PSOCLO1 for PSO*7*457
"RTN","PSOCLOU",5,0)
 ;
"RTN","PSOCLOU",6,0)
 Q
"RTN","PSOCLOU",7,0)
 ;
"RTN","PSOCLOU",8,0)
ANCWARN(PSOYS) ; ANC warnings
"RTN","PSOCLOU",9,0)
 I PSOYS("rANC")<1000 W !,"Test ANC labs daily until levels stabilize to ANC greater than or equal to 1000.",! Q
"RTN","PSOCLOU",10,0)
 I PSOYS("rANC")<1500 W !,"Test ANC labs 3x weekly until levels stabilize to greater than or equal to 1500.",!
"RTN","PSOCLOU",11,0)
 Q
"RTN","PSOCLOU",12,0)
 ;
"RTN","PSOCLOU",13,0)
NOTAUTH ;
"RTN","PSOCLOU",14,0)
 W !!,"You Are Not Authorized to Override! See Clozapine Manager with PSOLOCKCLOZ key."
"RTN","PSOCLOU",15,0)
 Q
"RTN","PSOCLOU",16,0)
 ;
"RTN","PSOCLOU",17,0)
AUTHMSG ;
"RTN","PSOCLOU",18,0)
 W !!,"Permission to dispense clozapine has been authorized by NCCC.",!
"RTN","PSOCLOU",19,0)
 Q
"RTN","PSOCLOU",20,0)
 ;
"RTN","PSOCLOU",21,0)
CLOZDISP(PRVDRIEN) ; Boolean function, does PRVDRIEN have (DEA# or VA#) and the YSCL AUTHORIZED key?
"RTN","PSOCLOU",22,0)
 ;
"RTN","PSOCLOU",23,0)
 Q:'($G(PRVDRIEN)>0) ""  ; return null for bad input
"RTN","PSOCLOU",24,0)
 N NMBR,RSLT,X S RSLT=0,NMBR=0
"RTN","PSOCLOU",25,0)
 ; providers may have both DEA# and VA#
"RTN","PSOCLOU",26,0)
 S:$L($$GET1^DIQ(200,PRVDRIEN,53.2)) NMBR=NMBR+1  ; (#53.2) DEA# [2F]
"RTN","PSOCLOU",27,0)
 S:$L($$GET1^DIQ(200,PRVDRIEN,53.3)) NMBR=NMBR+1  ; (#53.3) VA# [3F]
"RTN","PSOCLOU",28,0)
 I NMBR S:$D(^XUSEC("YSCL AUTHORIZED",PRVDRIEN)) RSLT=1
"RTN","PSOCLOU",29,0)
 Q RSLT
"RTN","PSOCLOU",30,0)
 ;
"RTN","PSOCLOU",31,0)
CLZPTNFO(PTNFO,CLZDFN) ; clozapine patient info, PTNFO passed by ref.
"RTN","PSOCLOU",32,0)
 ;
"RTN","PSOCLOU",33,0)
 Q:'($G(CLZDFN)>0)  ; must have DFN
"RTN","PSOCLOU",34,0)
 N C,IEN,X K PTNFO
"RTN","PSOCLOU",35,0)
 S PTNFO(55,"pharmDFN")=$$GET1^DIQ(55,CLZDFN,.01,"I") D:PTNFO(55,"pharmDFN")  ; if patient in file #55
"RTN","PSOCLOU",36,0)
 . S PTNFO(55,"clozReg#")=$$GET1^DIQ(55,CLZDFN,53)  ; (#53) CLOZAPINE REGISTRATION NUMBER
"RTN","PSOCLOU",37,0)
 . S PTNFO(55,"clozStatus")=$$GET1^DIQ(55,CLZDFN,54,"I")  ; (#54) CLOZAPINE STATUS
"RTN","PSOCLOU",38,0)
 . S PTNFO(55,"clozPrvdr")=$$GET1^DIQ(55,CLZDFN,57,"I")  ; (#57) RESPONSIBLE PROVIDER
"RTN","PSOCLOU",39,0)
 . S PTNFO(55,"clozRegDt")=$$GET1^DIQ(55,CLZDFN,58,"I")  ; (#58) REGISTRATION DATE
"RTN","PSOCLOU",40,0)
 ;
"RTN","PSOCLOU",41,0)
 Q:'PTNFO(55,"pharmDFN")  ; stop if not in file #55
"RTN","PSOCLOU",42,0)
 ;
"RTN","PSOCLOU",43,0)
 I $L($G(XQY0)) D
"RTN","PSOCLOU",44,0)
 . S:XQY0["PSO" PTNFO("pharmStat")="OUT"
"RTN","PSOCLOU",45,0)
 . S:XQY0["PSJ" PTNFO("pharmStat")="IN"
"RTN","PSOCLOU",46,0)
 ;
"RTN","PSOCLOU",47,0)
 S PTNFO(2,"wardLoc")=$$GET1^DIQ(2,CLZDFN,.1)  ; (#.1) WARD LOCATION
"RTN","PSOCLOU",48,0)
 ;
"RTN","PSOCLOU",49,0)
 S X=$$CL^YSCLTST2(CLZDFN),PTNFO("lab","WBC")="",PTNFO("lab","ANC")="",PTNFO("labNm","WBC")="",PTNFO("labNm","ANC")=""
"RTN","PSOCLOU",50,0)
 I '(X<0) D  ; lab test names and results
"RTN","PSOCLOU",51,0)
 . S PTNFO("ysRslt")=X,PTNFO("lab","dt")=$P(X,U,6)
"RTN","PSOCLOU",52,0)
 . S PTNFO("labNm","WBC")=$P(X,U,3) S:$L(PTNFO("labNm","WBC")) PTNFO("lab","WBC")=+$P(X,U,2)
"RTN","PSOCLOU",53,0)
 . S PTNFO("labNm","ANC")=$P(X,U,5) S:$L(PTNFO("labNm","ANC")) PTNFO("lab","ANC")=+$P(X,U,4)
"RTN","PSOCLOU",54,0)
 ;
"RTN","PSOCLOU",55,0)
 S C=0,IEN=0  ; entry count & ien
"RTN","PSOCLOU",56,0)
 F  S IEN=$O(^YSCL(603.01,"C",CLZDFN,IEN)) Q:'IEN  S C=C+1 D  ; get file #603.01 info, may be duplicates
"RTN","PSOCLOU",57,0)
 . S PTNFO(603.01,IEN,"cloz#")=$$GET1^DIQ(603.01,IEN,.01)  ; (#.01) CLOZAPINE REGISTRATION NUMBER
"RTN","PSOCLOU",58,0)
 . S PTNFO(603.01,IEN,"clozDFN")=$$GET1^DIQ(603.01,IEN,1,"I")  ; (#1) CLOZAPINE PATIENT
"RTN","PSOCLOU",59,0)
 . S PTNFO(603.01,IEN,"dispFrq")=$$GET1^DIQ(603.01,IEN,2,"I")  ; (#2) DISPENSE FREQUENCY
"RTN","PSOCLOU",60,0)
 . S PTNFO(603.01,IEN,"ovrdDt")=$$GET1^DIQ(603.01,IEN,3,"I")  ; (#3) OVERRIDE DATE
"RTN","PSOCLOU",61,0)
 ;
"RTN","PSOCLOU",62,0)
 S PTNFO(603.01,0,"total")=C
"RTN","PSOCLOU",63,0)
 ;
"RTN","PSOCLOU",64,0)
 Q
"RTN","PSOCLOU",65,0)
 ;
"RTN","PSOCLOU",66,0)
FINDNEXT() ; Find the next pseudo Clozapine registration number, return -1 if none left
"RTN","PSOCLOU",67,0)
 D DT^DICRW
"RTN","PSOCLOU",68,0)
 N N,NUM,PRFIX,RGRSLT,RGZRO,STNUM,Y
"RTN","PSOCLOU",69,0)
 D XTMPZRO
"RTN","PSOCLOU",70,0)
 S STNUM=+$P($$SITE^VASITE,U,3),RGZRO=$G(^XTMP("PSJ CLOZ",0)),Y=$P(RGZRO,U,4)
"RTN","PSOCLOU",71,0)
 S PRFIX=$E(Y)  ; last temp registration prefix
"RTN","PSOCLOU",72,0)
 I '(PRFIX]"A") S N=0,Y=STNUM_"999" D  I N Q -1  ; no more temp numbers
"RTN","PSOCLOU",73,0)
 . S:$D(^XTMP("PSJ CLOZ","B",Y)) N=1 Q:N
"RTN","PSOCLOU",74,0)
 . S:$D(^YSCL(603.01,"B",Y)) N=1 Q:N
"RTN","PSOCLOU",75,0)
 . S:$D(^PS(55,"ASAND1",Y)) N=1
"RTN","PSOCLOU",76,0)
 S:'(PRFIX?1U) PRFIX="Z"  ; start at Z if no prefix found
"RTN","PSOCLOU",77,0)
 S N=0 F  L +^XTMP("PSJ CLOZ",0):DILOCKTM S Y=$T Q:Y!(N>2)  S N=N+Y  ; try until LOCK or 3 attempts
"RTN","PSOCLOU",78,0)
 I 'Y Q -1  ; couldn't get a LOCK 
"RTN","PSOCLOU",79,0)
 S NUM=+$E(RGZRO,5,7)  ; numeric value after station #
"RTN","PSOCLOU",80,0)
 I (NUM<0)!(NUM>998) S NUM=0  ; adjust if needed
"RTN","PSOCLOU",81,0)
 S RGRSLT=""  ; registration number to return
"RTN","PSOCLOU",82,0)
 F  D  Q:$L(RGRSLT)
"RTN","PSOCLOU",83,0)
 . S N=1000+NUM  ; pad NUM
"RTN","PSOCLOU",84,0)
 . S Y=PRFIX_STNUM_($E(N,2,4))  ; potential registration number
"RTN","PSOCLOU",85,0)
 . ; check if registration number in use
"RTN","PSOCLOU",86,0)
 . I '$D(^XTMP("PSJ CLOZ","B",Y)),'$D(^YSCL(603.01,"B",Y)),'$D(^PS(55,"ASAND1",Y)) S RGRSLT=Y Q
"RTN","PSOCLOU",87,0)
 . S NUM=NUM+1 Q:NUM<1000  ; keep looking on same prefix
"RTN","PSOCLOU",88,0)
 . S Y=$E(PRFIX),Y=$C($A(Y)-1),PRFIX=Y ; make 1st char. of prefix previous ASCII character
"RTN","PSOCLOU",89,0)
 . I ("A"]PRFIX) S RGRSLT=-1  Q  ; No more pseudo numbers left
"RTN","PSOCLOU",90,0)
 . S NUM=0  ; reset counter
"RTN","PSOCLOU",91,0)
 ;
"RTN","PSOCLOU",92,0)
 L -^XTMP("PSJ CLOZ",0)
"RTN","PSOCLOU",93,0)
 Q RGRSLT
"RTN","PSOCLOU",94,0)
 ;
"RTN","PSOCLOU",95,0)
LABRSLT(DFN,PSOYS,CLOZPAT) ; get lab tests
"RTN","PSOCLOU",96,0)
 ; PSOYS, CLOZPAT both passed by ref.
"RTN","PSOCLOU",97,0)
 N X
"RTN","PSOCLOU",98,0)
 S PSOYS=$$CL^YSCLTST2(DFN),PSOYS("rWBC")="",PSOYS("rANC")=""
"RTN","PSOCLOU",99,0)
 D:'(PSOYS<0)  ; if less than zero no lab tests
"RTN","PSOCLOU",100,0)
 . S X=$P(PSOYS,U,2) S:$L(X) PSOYS("rWBC")=+X  ; WBC result
"RTN","PSOCLOU",101,0)
 . S X=$P(PSOYS,U,4) S:$L(X) PSOYS("rANC")=+X  ; ANC result
"RTN","PSOCLOU",102,0)
 S X=$P(PSOYS,U,7),CLOZPAT=$S(X="M":2,X="B":1,1:0)
"RTN","PSOCLOU",103,0)
 Q
"RTN","PSOCLOU",104,0)
 ;
"RTN","PSOCLOU",105,0)
OVRDRSN(DFN,PSOYS,PSREG,CLOZPAT) ; function, return override reason
"RTN","PSOCLOU",106,0)
 ;PSOYS, PSREG, CLOZPAT passed by ref.
"RTN","PSOCLOU",107,0)
 N OVRDRSN S OVRDRSN=""
"RTN","PSOCLOU",108,0)
 ;
"RTN","PSOCLOU",109,0)
 D LABRSLT(DFN,.PSOYS,.CLOZPAT)  ; update lab results
"RTN","PSOCLOU",110,0)
 S PSREG=$$GET1^DIQ(55,DFN,53),PSREG("status55")=$$GET1^DIQ(55,DFN,54,"I")
"RTN","PSOCLOU",111,0)
 ;
"RTN","PSOCLOU",112,0)
 I $$OVERRIDE^YSCLTST2(DFN,0) S OVRDRSN=7  ; NCCC AUTHORIZED
"RTN","PSOCLOU",113,0)
 ; no reg # or (temp. reg # and active)
"RTN","PSOCLOU",114,0)
 I 'OVRDRSN,PSREG=""!((PSREG?1U6N)&(PSREG("status55")="A")) D
"RTN","PSOCLOU",115,0)
 . Q:PSOYS("rANC")<1500  ; must be at least 1500
"RTN","PSOCLOU",116,0)
 . Q:'$L(PSOYS("rWBC"))  ; must have WBC result (any value)
"RTN","PSOCLOU",117,0)
 . S OVRDRSN=8  ; REGISTER NON-DUTY HR/WEEKEND (MAX4DAY)
"RTN","PSOCLOU",118,0)
 ;
"RTN","PSOCLOU",119,0)
 I 'OVRDRSN,PSREG("status55")="A",PSREG?2U5N D  ; active, normal reg #
"RTN","PSOCLOU",120,0)
 . ; if no ANC reult, return 9
"RTN","PSOCLOU",121,0)
 . I '($L(PSOYS("rANC")))  S OVRDRSN=9 Q  ;PRESCRIBER APPROVED 4 DAY SUPPLY
"RTN","PSOCLOU",122,0)
 ;
"RTN","PSOCLOU",123,0)
 I 'OVRDRSN,PSREG("status55")="A",PSREG?2U5N D  ; active, normal reg #
"RTN","PSOCLOU",124,0)
 . I PSOYS("rANC")<1500&'(PSOYS("rANC")<1000) S OVRDRSN=10  ; MILD NEUTROPENIA PRESCRIBER APPROVED
"RTN","PSOCLOU",125,0)
 ;
"RTN","PSOCLOU",126,0)
 Q OVRDRSN
"RTN","PSOCLOU",127,0)
 ;
"RTN","PSOCLOU",128,0)
OVRDTMBR ; select override team member, returned in PSSPHARM
"RTN","PSOCLOU",129,0)
 S ANQX=0  ; flag, exit clozapine logic
"RTN","PSOCLOU",130,0)
 S PSSPHARM=""  ; null if no selection
"RTN","PSOCLOU",131,0)
 N CNT,DIR,IEN,LPXIT,PSOTMND,R,V,X,Y
"RTN","PSOCLOU",132,0)
 S PSOTMND="PSO CLOZ TEAM"
"RTN","PSOCLOU",133,0)
 K ^TMP($J,PSOTMND)
"RTN","PSOCLOU",134,0)
 S ^TMP($J,PSOTMND,0,"date")=$P($$FMTE^XLFDT($$NOW^XLFDT),"@")
"RTN","PSOCLOU",135,0)
 S ^TMP($J,PSOTMND,0,"duzXcld")=0  ; indicates user was excluded
"RTN","PSOCLOU",136,0)
 ; create alphabetic list of key holders
"RTN","PSOCLOU",137,0)
 S IEN=0 F  S IEN=$O(^XUSEC("PSOLOCKCLOZ",IEN)) Q:'IEN  D
"RTN","PSOCLOU",138,0)
 . I IEN=DUZ S ^TMP($J,PSOTMND,0,"duzXcld")=IEN Q  ; set flag, exclude user from list
"RTN","PSOCLOU",139,0)
 . Q:$$GET1^DIQ(200,IEN_",",7,"I")  ; (#7) DISUSER [7S], skip if set
"RTN","PSOCLOU",140,0)
 . S X=$$GET1^DIQ(200,IEN_",",2,"I") Q:X=""  ; (#2) ACCESS CODE [3F], skip if null
"RTN","PSOCLOU",141,0)
 . S X=$$GET1^DIQ(200,IEN_",",.01) Q:X=""
"RTN","PSOCLOU",142,0)
 . S ^TMP($J,PSOTMND,"B",X,IEN)=""
"RTN","PSOCLOU",143,0)
 ; count members, create numeric list
"RTN","PSOCLOU",144,0)
 S CNT=0,V=$NA(^TMP($J,PSOTMND,"B"))
"RTN","PSOCLOU",145,0)
 F  S V=$Q(@V) Q:V=""  Q:'($QS(V,2)=PSOTMND)  D
"RTN","PSOCLOU",146,0)
 . S IEN=$QS(V,5),Y=$QS(V,4)_" (user #"_IEN_")"
"RTN","PSOCLOU",147,0)
 . S CNT=CNT+1,^TMP($J,PSOTMND,CNT)=Y
"RTN","PSOCLOU",148,0)
 . S ^TMP($J,PSOTMND,CNT,"IEN")=IEN
"RTN","PSOCLOU",149,0)
 ;
"RTN","PSOCLOU",150,0)
 S ^TMP($J,PSOTMND,0)=CNT
"RTN","PSOCLOU",151,0)
 I CNT=0 D  Q
"RTN","PSOCLOU",152,0)
 . S ANQX=1  ; no member selected
"RTN","PSOCLOU",153,0)
 . W !!,"No active approving members available"_$S(^TMP($J,PSOTMND,0,"duzXcld"):" (other than you).",1:".")
"RTN","PSOCLOU",154,0)
 . S DIR(0)="EA",DIR("A")="Enter: " D ^DIR
"RTN","PSOCLOU",155,0)
 . K ^TMP($J,PSOTMND)
"RTN","PSOCLOU",156,0)
 ;
"RTN","PSOCLOU",157,0)
 S LPXIT=0 F  D  Q:LPXIT
"RTN","PSOCLOU",158,0)
 . D DISPTM(PSOTMND)
"RTN","PSOCLOU",159,0)
 . N MMBRNO K DIR S R=^TMP($J,PSOTMND,0)
"RTN","PSOCLOU",160,0)
 . S DIR(0)="NA^1:"_R,DIR("A")="Select Approving Team Member or '^' to exit (1-"_R_"): "
"RTN","PSOCLOU",161,0)
 . S DIR("?")="Enter an integer to select from the list"_$S(^TMP($J,PSOTMND,0,"duzXcld"):" (you were excluded).",1:".")
"RTN","PSOCLOU",162,0)
 . S DIR("A",1)=" " D ^DIR
"RTN","PSOCLOU",163,0)
 . I 'Y!$D(DUOUT)!$D(DTOUT) S ANQX=1,LPXIT=1 Q  ; no member selected
"RTN","PSOCLOU",164,0)
 . S MMBRNO=Y
"RTN","PSOCLOU",165,0)
 . K DIR S DIR(0)="YA",DIR("A")="Is this correct? ",DIR("B")="NO"
"RTN","PSOCLOU",166,0)
 . S DIR("A",1)=" ",DIR("A",2)="You selected "_^TMP($J,PSOTMND,MMBRNO)
"RTN","PSOCLOU",167,0)
 . D ^DIR I $D(DUOUT)!$D(DTOUT) S LPXIT=1,ANQX=1 Q  ; time out or '^', no member selected
"RTN","PSOCLOU",168,0)
 . Q:'Y  S PSSPHARM=^TMP($J,PSOTMND,MMBRNO,"IEN"),LPXIT=1
"RTN","PSOCLOU",169,0)
 ;
"RTN","PSOCLOU",170,0)
 K ^TMP($J,PSOTMND)  ; clean up
"RTN","PSOCLOU",171,0)
 Q
"RTN","PSOCLOU",172,0)
 ;
"RTN","PSOCLOU",173,0)
DISPTM(PSOTMND) ; display team members
"RTN","PSOCLOU",174,0)
 Q:$G(PSOTMND)=""
"RTN","PSOCLOU",175,0)
 Q:'$G(^TMP($J,PSOTMND,0))  ; nothing to display
"RTN","PSOCLOU",176,0)
 N CNT,DIR,DUOUT,LPXIT,R
"RTN","PSOCLOU",177,0)
 W !!,"    Clozapine Team Members   "_$G(^TMP($J,PSOTMND,0,"date")),!
"RTN","PSOCLOU",178,0)
 S (CNT,LPXIT,R)=0
"RTN","PSOCLOU",179,0)
 F  S CNT=$O(^TMP($J,PSOTMND,CNT)) Q:'CNT!LPXIT  S Y=^(CNT) D
"RTN","PSOCLOU",180,0)
 . S R=R+1 W !,$J(CNT,3)_". "_Y Q:(R<20)  ; display 20 at a time
"RTN","PSOCLOU",181,0)
 . Q:'$O(^TMP($J,PSOTMND,CNT))  ; nothing left to display
"RTN","PSOCLOU",182,0)
 . K DIR,DUOUT S DIR(0)="EA",DIR("A")="<ENTER> to see more members, '^' to exit: "
"RTN","PSOCLOU",183,0)
 . D ^DIR S R=0 S:$D(DUOUT) LPXIT=1
"RTN","PSOCLOU",184,0)
 ;
"RTN","PSOCLOU",185,0)
 Q
"RTN","PSOCLOU",186,0)
 ;
"RTN","PSOCLOU",187,0)
CRXTMP(DFN,PSOYS) ; create XTMP entry for 4 day supply tracking
"RTN","PSOCLOU",188,0)
 I $G(DFN) D CRXTMP^PSOCLUTL(DFN,PSOYS)
"RTN","PSOCLOU",189,0)
 Q
"RTN","PSOCLOU",190,0)
CRXTMPI(DFN,PSOYS) ; create XTMP entry for 4 day supply tracking
"RTN","PSOCLOU",191,0)
 I $G(DFN) D CRXTMPI^PSOCLUTL(DFN,PSOYS)
"RTN","PSOCLOU",192,0)
 Q
"RTN","PSOCLOU",193,0)
 ; ** NCC REMEDIATION add new reasons 8-11 ** 457/RTW  11 ;;EMERGENCY OVERRIDE NO ANC LAST 7 DAYS
"RTN","PSOCLOU",194,0)
OVRDTXT(RSNCODE) ; function, return text for override
"RTN","PSOCLOU",195,0)
 Q:'($G(RSNCODE)>0) ""  ; no reason code, return null
"RTN","PSOCLOU",196,0)
 Q:$G(RSNCODE)=1 "NO WBC IN LAST 7 DAYS"
"RTN","PSOCLOU",197,0)
 Q:$G(RSNCODE)=2 "NO VERIFIED WBC"
"RTN","PSOCLOU",198,0)
 Q:$G(RSNCODE)=3 "LAST WBC RESULT < 3500"
"RTN","PSOCLOU",199,0)
 Q:$G(RSNCODE)=4 "3 SEQ. WBC DECREASE"
"RTN","PSOCLOU",200,0)
 Q:$G(RSNCODE)=5 "LAST ANC RESULT < 2000"
"RTN","PSOCLOU",201,0)
 Q:$G(RSNCODE)=6 "SEQ. ANC DECREASE"
"RTN","PSOCLOU",202,0)
 Q:$G(RSNCODE)=7 "NCCC AUTHORIZED"
"RTN","PSOCLOU",203,0)
 Q:$G(RSNCODE)=8 "REGISTER NON-DUTY HR/WEEKEND (MAX 4DAY)"
"RTN","PSOCLOU",204,0)
 Q:$G(RSNCODE)=9 "PRESCRIBER APPROVED 4 DAY SUPPLY"
"RTN","PSOCLOU",205,0)
 Q:$G(RSNCODE)=10 "MILD NEUTROPENIA PRESCRIBER APPROVED"
"RTN","PSOCLOU",206,0)
 Q ""  ; shouldn't get here, return null
"RTN","PSOCLOU",207,0)
 ;
"RTN","PSOCLOU",208,0)
HASKEY(USRNUM) ; Boolean function, does USRNUM hold the PSOLOCKCLOZ security key?
"RTN","PSOCLOU",209,0)
 I '($G(USRNUM)>0) S USRNUM=DUZ  ; default to current user
"RTN","PSOCLOU",210,0)
 Q $D(^XUSEC("PSOLOCKCLOZ",USRNUM))
"RTN","PSOCLOU",211,0)
 ;
"RTN","PSOCLOU",212,0)
XTMPZRO ;set zero node in ^XTMP("PSJ CLOZ")
"RTN","PSOCLOU",213,0)
 N Y
"RTN","PSOCLOU",214,0)
 S Y=$$FMADD^XLFDT($$DT^XLFDT,366)  ; one year (366 days) in the future
"RTN","PSOCLOU",215,0)
 S $P(^XTMP("PSJ CLOZ",0),U)=Y,$P(^XTMP("PSJ CLOZ",0),U,2)=DT,$P(^XTMP("PSJ CLOZ",0),U,3)="CLOZAPINE WEEKEND REGISTRATION"
"RTN","PSOCLOU",216,0)
 Q
"RTN","PSOCLOU",217,0)
 ;
"RTN","PSOCLUTL")
0^4^B101965385
"RTN","PSOCLUTL",1,0)
PSOCLUTL ;BHAM ISC/DMA - utilities for clozapine reporting system ;10 May 2019 09:01:28
"RTN","PSOCLUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**28,56,122,222,268,457**;DEC 1997;Build 116
"RTN","PSOCLUTL",3,0)
 ;External reference ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOCLUTL",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOCLUTL",5,0)
 ;
"RTN","PSOCLUTL",6,0)
REG ; Register Clozapine Patient
"RTN","PSOCLUTL",7,0)
 N DIC,DIR
"RTN","PSOCLUTL",8,0)
 S DIC=55,DLAYGO=55,DIC(0)="AEQL",DIC("A")="Select patient to register: " D ^DIC K DIC,DLAYGO G END:Y<0
"RTN","PSOCLUTL",9,0)
 S PSO1=+Y,PSONAME=$$GET1^DIQ(2,PSO1,.01)
"RTN","PSOCLUTL",10,0)
 D:$$GET1^DIQ(55,PSO1,52.1,"I")'=2 EN^PSOHLUP(PSO1) N ANQX
"RTN","PSOCLUTL",11,0)
 I '$$FIND1^DIC(603.01,,"Q",PSO1,"C") W !!,PSONAME_" has not been authorized for Clozapine",!,"by the NCCC in Dallas.  Contact the NCCC in Dallas for authorization." D OVER G:'$G(%) REG S JADOVER=""
"RTN","PSOCLUTL",12,0)
 S PSO4=$$GET1^DIQ(55,PSO1,53) I PSO4]"" W !!,PSONAME_" is already registered with number "_PSO4,!!,"Use the edit option to change registration data, or",!,"contact your supervisor",! G REG
"RTN","PSOCLUTL",13,0)
NUMBER ;
"RTN","PSOCLUTL",14,0)
 S DIR(0)="55,53",Y=$$GET1^DIQ(603.01,$$FIND1^DIC(603.01,,"Q",PSO1,"C"),.01)
"RTN","PSOCLUTL",15,0)
 S:Y]"" DIR("B")=Y
"RTN","PSOCLUTL",16,0)
 D ^DIR S PSO2=Y K DIR I $D(DIRUT) W !,"Not registered",! D END G REG
"RTN","PSOCLUTL",17,0)
 N PSOEX S PSOEX=$$FIND1^DIC(55,,"X",PSO2,"ASAND1")
"RTN","PSOCLUTL",18,0)
 I PSOEX,PSOEX'=PSO1 W !,PSO2," is already assigned to ",$$GET1^DIQ(2,PSOEX,.01) W !,"Please contact your supervisor" D END G REG
"RTN","PSOCLUTL",19,0)
 I '$D(JADOVER),'$$FIND1^DIC(603.01,"","X",PSO2,"B") D  I '$G(%) W ! G NUMBER
"RTN","PSOCLUTL",20,0)
 . W !!,"The NCCC in Dallas has not authorized "_PSO2_" to be used",!
"RTN","PSOCLUTL",21,0)
 . W "at this facility.  Contact the NCCC in Dallas for authorization." D OVER
"RTN","PSOCLUTL",22,0)
NUMBER1 ;
"RTN","PSOCLUTL",23,0)
 S PSO3="A"  ; (#54) CLOZAPINE STATUS
"RTN","PSOCLUTL",24,0)
PHY ;
"RTN","PSOCLUTL",25,0)
 N DIC,DIR
"RTN","PSOCLUTL",26,0)
 S DIC="^VA(200,",DIC(0)="AEQMZ",DIC("A")="Provider responsible: ",DIC("S")="I $$GET1^DIQ(200,+Y,53.1)]"""""
"RTN","PSOCLUTL",27,0)
 D ^DIC K DIC I Y<0 D END D  G:'$G(PSCLOZ) REG G END1
"RTN","PSOCLUTL",28,0)
 .I '$G(PSCLOZ) W !!,"Not registered",!! Q
"RTN","PSOCLUTL",29,0)
 .S ANQX=1 Q
"RTN","PSOCLUTL",30,0)
 I $G(PSCLOZ) D PROVCHK(+Y) G:$G(ANQX) PHY
"RTN","PSOCLUTL",31,0)
 S PSO4=+Y
"RTN","PSOCLUTL",32,0)
 ;/RBN Begin NCC changes Ask if okay to register the unregistered patient - PSO*7.0*457
"RTN","PSOCLUTL",33,0)
 N DFN,VADM S DFN=PSO1 D DEM^VADPT
"RTN","PSOCLUTL",34,0)
 S SSN=$P(VADM(2),"^")
"RTN","PSOCLUTL",35,0)
 S LSTFOUR=$E(SSN,6,9)
"RTN","PSOCLUTL",36,0)
 I '$G(PSCLOZ) D
"RTN","PSOCLUTL",37,0)
 . S DIR("A",1)="OK to register "_PSONAME_" ("_$G(LSTFOUR)_")"_" with number "_PSO2
"RTN","PSOCLUTL",38,0)
 . S DIR("A")="as a"_$S('PSO3:" new",1:"n ongoing")_" patient in this program? "
"RTN","PSOCLUTL",39,0)
 I $G(PSCLOZ) D
"RTN","PSOCLUTL",40,0)
 . S DIR("A",2)="Would you like to override the registration requirement"
"RTN","PSOCLUTL",41,0)
 . S DIR("A",1)="and assign a temporary local authorization number"
"RTN","PSOCLUTL",42,0)
 . S DIR("A")="for  "_PSONAME_" ("_$G(LSTFOUR)_")"_" with number "_PSO2_"? "
"RTN","PSOCLUTL",43,0)
 S DIR(0)="YA",DIR("B")="NO" D ^DIR K DIR I Y=0!($D(DUOUT)) S ANQX=1 D END G END1
"RTN","PSOCLUTL",44,0)
 ;/RBN End NCC changes to remove Pretreatment choice - PSO*7.0*457
"RTN","PSOCLUTL",45,0)
SAVE ;
"RTN","PSOCLUTL",46,0)
 S DA=PSO1,DIE=55,DR="53////"_PSO2_";54////"_PSO3_";57////"_PSO4_";56////0;58////"_DT
"RTN","PSOCLUTL",47,0)
 L +^PS(55,DA):DILOCKTM E  W !!,$C(7),"Patient "_PSONAME_" is being edited by another user!  Try Later." S ANQX=1 D END G END1
"RTN","PSOCLUTL",48,0)
 D ^DIE L -^PS(55,DA)
"RTN","PSOCLUTL",49,0)
 S $P(^XTMP("PSJ CLOZ",0),U,4)=PSO2  ; save last temp reg#
"RTN","PSOCLUTL",50,0)
END ;
"RTN","PSOCLUTL",51,0)
 K %,%Y,C,D,D0,DA,DI,DQ,DIC,DIE,DR,PSO,PSO1,PSO2,PSO3,PSO4,PSOC,PSOLN,PSONAME,PSONO,PSOT,R,SSNVAERR,XMDUZ,XMSUB,XMTEXT,Y
"RTN","PSOCLUTL",52,0)
 I '$G(PSCLOZ) K ^TMP($J),^TMP("PSO",$J)
"RTN","PSOCLUTL",53,0)
 Q
"RTN","PSOCLUTL",54,0)
END1 ;
"RTN","PSOCLUTL",55,0)
 I $G(ANQX) W !!,"Patient Not Registered"
"RTN","PSOCLUTL",56,0)
 Q
"RTN","PSOCLUTL",57,0)
 ;
"RTN","PSOCLUTL",58,0)
FACILITY ;Enter facility DEA number to set up clozapine system
"RTN","PSOCLUTL",59,0)
 ;this entry point is no longer used.  this functionality was taken over
"RTN","PSOCLUTL",60,0)
 ;by the mental health package with the release of YS*5.01*18
"RTN","PSOCLUTL",61,0)
 ;W ! S DIC=59,DIC(0)="AEQM",DIC("A")="Select site to participate in clozapine program : " D ^DIC G END:Y<0
"RTN","PSOCLUTL",62,0)
 ;S DIE=DIC,DA=+Y,DR="1R;2R;" L +^PS(59,DA) D ^DIE L -^PS(59,DA) G FACILITY
"RTN","PSOCLUTL",63,0)
 Q
"RTN","PSOCLUTL",64,0)
 ;
"RTN","PSOCLUTL",65,0)
 ;
"RTN","PSOCLUTL",66,0)
AGAIN ; re-enter patient - new number, status and provider
"RTN","PSOCLUTL",67,0)
 S DIC=55,DIC(0)="AEQM",DIC("A")="Select clozapine patient : " D ^DIC K DIC G END:Y<0 S (DA,PSO1)=+Y,PSONAME=$$GET1^DIQ(2,DA,.01)
"RTN","PSOCLUTL",68,0)
 I $$GET1^DIQ(55,DA,53)="" W !,PSONAME_" is not registered.  Use the register option." G AGAIN
"RTN","PSOCLUTL",69,0)
 I '$$FIND1^DIC(603.01,,"Q",PSO1,"C") W !!,PSONAME_" has not been authorized for Clozapine",!,"by the NCCC in Dallas.  Contact the NCCC in Dallas for authorization." D OVER G:'$G(%) AGAIN S JADOVER=""
"RTN","PSOCLUTL",70,0)
 S DIR(0)="55,53" D ^DIR G END:$D(DIRUT) S PSO2=Y
"RTN","PSOCLUTL",71,0)
 N PSOEX S PSOEX=$$FIND1^DIC(55,,"X",PSO2,"ASAND1")
"RTN","PSOCLUTL",72,0)
 I PSOEX,PSOEX'=PSO1 W !,PSO2," already assigned to ",$$GET1^DIQ(2,PSOEX,.01) G END
"RTN","PSOCLUTL",73,0)
 I '$D(JADOVER),'$$FIND1^DIC(603.01,,"X",PSO2) W !!,"The NCCC in Dallas has not authorized "_PSO2_" for usage",!,"at this facility.  Contact the NCCC in Dallas for authorization." D OVER G:'$G(%) END
"RTN","PSOCLUTL",74,0)
 W !,"CLOZAPINE STATUS: "_$$GET1^DIQ(55,PSO1,54)
"RTN","PSOCLUTL",75,0)
 S PSO3=$$GET1^DIQ(55,PSO1,54,"I")
"RTN","PSOCLUTL",76,0)
PHY1 ;
"RTN","PSOCLUTL",77,0)
 S DIR(0)="55,57" D ^DIR G END:$D(DIRUT) I Y S PSO4=+Y
"RTN","PSOCLUTL",78,0)
 I $$GET1^DIQ(200,PSO4,53.2)="" W !!,"Only providers with DEA numbers entered in the New Person",!,"file can register patients in this program.",!! G PHY1
"RTN","PSOCLUTL",79,0)
 G SAVE
"RTN","PSOCLUTL",80,0)
 ;
"RTN","PSOCLUTL",81,0)
OVER ;allow registration of patients and clozapine numbers not yet authorized by the NCCC.
"RTN","PSOCLUTL",82,0)
 K DIR,% W ! S DIR("A")="Do you want to override this warning",DIR(0)="Y",DIR("B")="No" D ^DIR
"RTN","PSOCLUTL",83,0)
 I Y S %=1
"RTN","PSOCLUTL",84,0)
 K DIR,DIRUT,DUOUT Q
"RTN","PSOCLUTL",85,0)
 ;
"RTN","PSOCLUTL",86,0)
CLOZPAT ;VERIFY PATIENT IS A CLOZAPINE PATIENT
"RTN","PSOCLUTL",87,0)
 K CLOZPAT,CLOZST S CLOZST=$$GET1^DIQ(55,DFN,54,"I")
"RTN","PSOCLUTL",88,0)
 I $L(CLOZST),CLOZST'="D" D
"RTN","PSOCLUTL",89,0)
 .N CLOZNUM,CLOZUID S CLOZNUM=$$GET1^DIQ(55,DFN,53)
"RTN","PSOCLUTL",90,0)
 .I CLOZNUM?1U6N S CLOZPAT=3 Q
"RTN","PSOCLUTL",91,0)
 .S CLOZUID=$$FIND1^DIC(603.01,,"X",CLOZNUM) Q:'CLOZUID  ;Q:'$D(^YSCL(603.01,CLOZUID,0))
"RTN","PSOCLUTL",92,0)
 .S CLOZPAT=$$GET1^DIQ(603.01,CLOZUID,2,"I")
"RTN","PSOCLUTL",93,0)
 .S CLOZPAT=$S($G(CLOZPAT)="M":2,$G(CLOZPAT)="B":1,$G(CLOZPAT)="W":0,1:90)
"RTN","PSOCLUTL",94,0)
 Q
"RTN","PSOCLUTL",95,0)
 ;
"RTN","PSOCLUTL",96,0)
PROVCHK(PROV) ;
"RTN","PSOCLUTL",97,0)
 N PSJQUIT S (ANQX,PSJQUIT)=0 I '$G(PROV) Q
"RTN","PSOCLUTL",98,0)
 I '$L($$DEA^XUSER(,PROV)) S (ANQX,PSJQUIT)=1 D  Q
"RTN","PSOCLUTL",99,0)
 .W !," ",!,"*** Provider must have a DEA# or VA# to write prescriptions for this drug."
"RTN","PSOCLUTL",100,0)
 I '$$FIND1^DIC(200.051,","_PROV_",","X","YSCL AUTHORIZED") S (ANQX,PSJQUIT)=1 D
"RTN","PSOCLUTL",101,0)
 .W !," ",!,"*** Provider must hold YSCL AUTHORIZED key to write prescriptions for clozapine."
"RTN","PSOCLUTL",102,0)
 Q
"RTN","PSOCLUTL",103,0)
 ;
"RTN","PSOCLUTL",104,0)
MSG1 ;
"RTN","PSOCLUTL",105,0)
 W !!,"Permission to dispense clozapine has been denied. The results of the latest",!
"RTN","PSOCLUTL",106,0)
 W "Lab Test drawn in the past 7 days show ANC results but No Matching WBC.",!
"RTN","PSOCLUTL",107,0)
 W "If you wish to dispense outside the FDA and VA protocol ANC limits,",!
"RTN","PSOCLUTL",108,0)
 W "document your request to Request for Override of Pharmacy Lockout ",!
"RTN","PSOCLUTL",109,0)
 W "(from VHA Handbook 1160.02) Director of the",!
"RTN","PSOCLUTL",110,0)
 W "VA National Clozapine Coordinating Center",!
"RTN","PSOCLUTL",111,0)
 W "(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSOCLUTL",112,0)
 W !,"No order entered!"
"RTN","PSOCLUTL",113,0)
 S ANQX=1
"RTN","PSOCLUTL",114,0)
 Q
"RTN","PSOCLUTL",115,0)
MSG2 ;
"RTN","PSOCLUTL",116,0)
 W !!,"Permission to dispense clozapine has been denied. The results of the latest",!
"RTN","PSOCLUTL",117,0)
 W "Lab Test drawn in the past 7 days show No ANC results. If you wish to dispense",!
"RTN","PSOCLUTL",118,0)
 W "outside the FDA and VA protocol ANC limits, document your request to Request",!
"RTN","PSOCLUTL",119,0)
 W "for Override of Pharmacy Lockout (from VHA Handbook 1160.02) Director of the",!
"RTN","PSOCLUTL",120,0)
 W "VA National Clozapine Coordinating Center",!
"RTN","PSOCLUTL",121,0)
 W "(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSOCLUTL",122,0)
 W !,"No order entered!"
"RTN","PSOCLUTL",123,0)
 S ANQX=1
"RTN","PSOCLUTL",124,0)
 Q
"RTN","PSOCLUTL",125,0)
MSG3 ;
"RTN","PSOCLUTL",126,0)
 W !,"A CBC/Differential including ANC Must Be Ordered and Monitored on a",!
"RTN","PSOCLUTL",127,0)
 W "Daily basis until the ANC above 1000/mm3 with no signs of infection.",!
"RTN","PSOCLUTL",128,0)
 W "If ANC is between 1000-1499, therapy can be continued but physician must order",!
"RTN","PSOCLUTL",129,0)
 W "lab test three times weekly."
"RTN","PSOCLUTL",130,0)
 Q
"RTN","PSOCLUTL",131,0)
MSG4 ;
"RTN","PSOCLUTL",132,0)
 W !,"Permission to dispense clozapine has been denied. If the results of the latest"
"RTN","PSOCLUTL",133,0)
 W !,"Lab Test drawn in the past 7 days show ANC below 1000/mm3 and you wish to"
"RTN","PSOCLUTL",134,0)
 W !,"dispense outside the FDA and VA protocol ANC limits, document your request to"
"RTN","PSOCLUTL",135,0)
 W !,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSOCLUTL",136,0)
 W !,"Director of the VA National Clozapine Coordinating Center"
"RTN","PSOCLUTL",137,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSOCLUTL",138,0)
 S ANQX=1
"RTN","PSOCLUTL",139,0)
 Q
"RTN","PSOCLUTL",140,0)
MSG5 ;
"RTN","PSOCLUTL",141,0)
 W !!,"Permission to dispense clozapine has been denied. Please contact the"
"RTN","PSOCLUTL",142,0)
 W !,"Director of the VA National Clozapine Coordinating Center"
"RTN","PSOCLUTL",143,0)
 W !!,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSOCLUTL",144,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339).",!
"RTN","PSOCLUTL",145,0)
 Q
"RTN","PSOCLUTL",146,0)
MSG6 ; ; ** START NCC REMEDIATION ** 457 AND PSJ 327/RTW MSG 6 added for new critically low ANC levels clozapine override requirements
"RTN","PSOCLUTL",147,0)
 W !!,"This clozapine drug may not be dispensed to the patient at this time based on the available lab tests related to the clozapine treatment program."
"RTN","PSOCLUTL",148,0)
 W !!,"Please contact the NCCC to request an override in order to proceed with dispensing this drug. "
"RTN","PSOCLUTL",149,0)
 W !!,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSOCLUTL",150,0)
 W !!,"The matching ANC counts which caused the lockout are of lab test results performed on "
"RTN","PSOCLUTL",151,0)
 S ANQX=1,Y=$P(PSOYS,"^",6) X ^DD("DD") W $P(Y,"@")
"RTN","PSOCLUTL",152,0)
 W !!,?5,"ANC: "_$P(PSOYS,"^",4),!
"RTN","PSOCLUTL",153,0)
 Q
"RTN","PSOCLUTL",154,0)
MSG9 ;
"RTN","PSOCLUTL",155,0)
 W !,"*** Permission to dispense clozapine has been denied based on the available"
"RTN","PSOCLUTL",156,0)
 W !,"    lab tests related to the clozapine treatment program. ***"
"RTN","PSOCLUTL",157,0)
 W !!,"For a National Override to dispense at the patient's normal frequency,"
"RTN","PSOCLUTL",158,0)
 W !,"please contact the VA National Clozapine Coordinating Center to request"
"RTN","PSOCLUTL",159,0)
 W !,"an Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSOCLUTL",160,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339)."
"RTN","PSOCLUTL",161,0)
 W !,"A Special Conditions Local Override can be approved for"
"RTN","PSOCLUTL",162,0)
 W !,"(1) weather-related conditions, (2) mail order delays of clozapine, or"
"RTN","PSOCLUTL",163,0)
 W !,"(3) inpatient going on leave. With Provider's documentation of approval,"
"RTN","PSOCLUTL",164,0)
 W !,"you may dispense a one-time supply not to exceed 4 days.",!
"RTN","PSOCLUTL",165,0)
 Q
"RTN","PSOCLUTL",166,0)
 ;
"RTN","PSOCLUTL",167,0)
 ;/RBN Begin of modifications for new message for IP 4 day overrride.
"RTN","PSOCLUTL",168,0)
MSG10 ;
"RTN","PSOCLUTL",169,0)
 W !,"*** Permission to dispense clozapine has been denied based on the available"
"RTN","PSOCLUTL",170,0)
 W !,"    lab tests related to the clozapine treatment program. ***"
"RTN","PSOCLUTL",171,0)
 W !!,"For a National Override to dispense at the patient's normal frequency,"
"RTN","PSOCLUTL",172,0)
 W !,"please contact the VA National Clozapine Coordinating Center to request an"
"RTN","PSOCLUTL",173,0)
 W !,"Override of Pharmacy Lockout (from VHA Handbook 1160.02) (Phone: 214-857-0068"
"RTN","PSOCLUTL",174,0)
 W !,"Fax: 214-857-0339)."
"RTN","PSOCLUTL",175,0)
 W !,"A Special Conditions Local Override for Inpatients can be approved for an"
"RTN","PSOCLUTL",176,0)
 W !,"IP Override Order with Outside Lab Results. With Provider's documentation of"
"RTN","PSOCLUTL",177,0)
 W !,"approval, you may dispense a one-time IP supply not to exceed 4 days."
"RTN","PSOCLUTL",178,0)
 W !,"The ANC from another facility must be recorded in the Progress note/comments"
"RTN","PSOCLUTL",179,0)
 W !,"in pharmacy"
"RTN","PSOCLUTL",180,0)
 Q
"RTN","PSOCLUTL",181,0)
 ;
"RTN","PSOCLUTL",182,0)
CRXTMP(DFN,PSOYS) ; track OP 4 day supply
"RTN","PSOCLUTL",183,0)
 S ^XTMP("PSO4D-"_DFN,0)=$$FMADD^XLFDT(DT,5)_U_DT_"^Clozapine Local Override 4 day supply tracking"
"RTN","PSOCLUTL",184,0)
 S ^XTMP("PSO4D-"_DFN,"PSOYS")=PSOYS
"RTN","PSOCLUTL",185,0)
 Q
"RTN","PSOCLUTL",186,0)
 ;
"RTN","PSOCLUTL",187,0)
CRXTMPI(DFN,PSOYS) ; track IP 4 day supply
"RTN","PSOCLUTL",188,0)
 S ^XTMP("PSJ4D-"_DFN,0)=$$FMADD^XLFDT(DT,5)_U_DT_"^Clozapine Local Override 4 day supply tracking"
"RTN","PSOCLUTL",189,0)
 S ^XTMP("PSJ4D-"_DFN,"PSOYS")=PSOYS
"RTN","PSOCLUTL",190,0)
 Q
"RTN","PSOCLUTL",191,0)
 ;
"RTN","PSOCLUTL",192,0)
CLKEYWRN() ; uniform message to users - PSO*7*457
"RTN","PSOCLUTL",193,0)
 Q "Provider must hold YSCL AUTHORIZED key to write medication orders for clozapine."
"RTN","PSOCLUTL",194,0)
 ;
"RTN","PSODIR")
0^19^B42041292
"RTN","PSODIR",1,0)
PSODIR ;BHAM ISC/SAB - asks data for rx order entry ;10 May 2019 09:01:28
"RTN","PSODIR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**37,46,111,117,146,164,211,264,275,391,372,416,422,504,457**;DEC 1997;Build 116
"RTN","PSODIR",3,0)
 ;External reference PSDRUG( supported by DBIA 221
"RTN","PSODIR",4,0)
 ;External reference PS(50.7 supported by DBIA 2223
"RTN","PSODIR",5,0)
 ;External reference to VA(200 is supported by DBIA 10060
"RTN","PSODIR",6,0)
 ;----------------------------------------------------------------
"RTN","PSODIR",7,0)
 ;
"RTN","PSODIR",8,0)
PROV(PSODIR) ;
"RTN","PSODIR",9,0)
PROVEN ; Entry point for failed lookup
"RTN","PSODIR",10,0)
 K DIC,X,Y S:$G(PSOFDR)&($G(OR0)) DIC("B")=$P(^VA(200,$P($G(OR0),"^",5),0),"^")
"RTN","PSODIR",11,0)
 I '$D(PSODIR("CS")),$D(PSODRUG("DEA")) D
"RTN","PSODIR",12,0)
 .N DEA S PSODIR("CS")=0 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSODIR",13,0)
 I $G(PSODIR("PROVIDER"))]"" S PSODIR("OLD VAL")=PSODIR("PROVIDER")
"RTN","PSODIR",14,0)
 S DIC="^VA(200,",DIC(0)="QEAM",PSODIR("FIELD")=0
"RTN","PSODIR",15,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)"
"RTN","PSODIR",16,0)
 S DIC("A")="PROVIDER: ",DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",17,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" S DIC("S")=DIC("S")_",$P($G(^(""TPB"")),""^""),$P($G(^(""TPB"")),""^"",5)=0"
"RTN","PSODIR",18,0)
 S:$G(PSORX("PROVIDER NAME"))]"" DIC("B")=PSORX("PROVIDER NAME")
"RTN","PSODIR",19,0)
 D ^DIC K DIC
"RTN","PSODIR",20,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP G PROVX
"RTN","PSODIR",21,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G PROVX
"RTN","PSODIR",22,0)
 I '$G(SPEED),Y=-1 G PROVEN
"RTN","PSODIR",23,0)
 Q:$G(SPEED)&(Y=-1)
"RTN","PSODIR",24,0)
 ;PSO*7*211; ADD CHECK FOR DEA# AND VA#
"RTN","PSODIR",25,0)
 I $P($G(PSODIR("CS")),"^",1)!($D(CLOZPAT)) N NDEA,SDEA S SDEA=$$DRGSCH() S NDEA=$$SDEA^XUSER(0,+Y,SDEA) I $L($P(NDEA,"^"))<3 D  G PROVEN
"RTN","PSODIR",26,0)
 .I NDEA=2 W $C(7),!!,"Provider not authorized to write Federal Schedule "_SDEA_" prescriptions.",! Q
"RTN","PSODIR",27,0)
 .W $C(7),!!,"Provider must have a valid DEA# or VA# to write prescriptions for this drug.",!
"RTN","PSODIR",28,0)
 ;PSO*7.0*391; Added check for DETOX#
"RTN","PSODIR",29,0)
 I $$DETOX^PSSOPKI($G(PSODRUG("IEN"))),$$DETOX^XUSER(+Y)="" W $C(7),!!,"Provider must have a DETOX# to order this drug.",! G PROVEN
"RTN","PSODIR",30,0)
 I $D(CLOZPAT),'$D(^XUSEC("YSCL AUTHORIZED",+Y)) D  G PROVEN
"RTN","PSODIR",31,0)
 .W $C(7),!!,$$CLKEYWRN^PSOCLUTL,!  ; PSO*7*457
"RTN","PSODIR",32,0)
 I '$G(PSODRUG("IEN")),'$G(PSORENW("DRUG IEN")) G NODRUG
"RTN","PSODIR",33,0)
NODRUG S PSODIR("PROVIDER")=+Y
"RTN","PSODIR",34,0)
 S (PSODIR("PROVIDER NAME"),PSORX("PROVIDER NAME"))=$P(Y,"^",2)
"RTN","PSODIR",35,0)
 I $G(PSODIR("OLD VAL"))'=+Y K PSODIR("GENERIC PROVIDER"),PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",36,0)
 I $G(PSODIR("OLD VAL"))'=$G(PSODIR("PROVIDER")),$P(Y,"^",2)="PROVIDER,OTHER"!($P(Y,"^",2)="PROVIDER,OUTSIDE") D GENERIC
"RTN","PSODIR",37,0)
 I $P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7),$P(^("PS"),"^",8) D COSIGN
"RTN","PSODIR",38,0)
 I $G(PSODIR("COSIGNING PROVIDER")),'$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7) K PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",39,0)
PROVX K X,Y
"RTN","PSODIR",40,0)
 Q
"RTN","PSODIR",41,0)
 ;
"RTN","PSODIR",42,0)
DRGSCH() ; determine the drug schedule
"RTN","PSODIR",43,0)
 N ND3,SCH
"RTN","PSODIR",44,0)
 S SCH="",ND3=$P($G(^PSDRUG(PSODRUG("IEN"),"ND")),"^",3) S:+ND3 SCH=$$GET1^DIQ(50.68,ND3,19,"I")
"RTN","PSODIR",45,0)
 I +SCH>0!($G(PSODRUG("DEA"))="") Q SCH
"RTN","PSODIR",46,0)
 I "^4^5^"[+PSODRUG("DEA") Q +PSODRUG("DEA")
"RTN","PSODIR",47,0)
 Q $S($G(PSODRUG("DEA"))["A":+PSODRUG("DEA"),1:+PSODRUG("DEA")_"n")
"RTN","PSODIR",48,0)
 ;
"RTN","PSODIR",49,0)
GENERIC ;
"RTN","PSODIR",50,0)
 K DIR,DIC,PSODIR("GENERIC PROVIDER")
"RTN","PSODIR",51,0)
 S DIR(0)="52,30"
"RTN","PSODIR",52,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") GENERICX
"RTN","PSODIR",53,0)
 S PSODIR("GENERIC PROVIDER")=Y
"RTN","PSODIR",54,0)
GENERICX K X,Y
"RTN","PSODIR",55,0)
 Q
"RTN","PSODIR",56,0)
 ;
"RTN","PSODIR",57,0)
COSIGN ;
"RTN","PSODIR",58,0)
 K DIC
"RTN","PSODIR",59,0)
 I '$G(PSODIR("COSIGNING PROVIDER")),$P($G(RX3),"^",3) S PSODIR("COSIGNING PROVIDER")=$P(RX3,"^",3) G COSIGN1
"RTN","PSODIR",60,0)
 I $P($G(RX3),"^",3),$P($G(RX3),"^",3)'=$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8) D
"RTN","PSODIR",61,0)
 .W !!,"Previous Co-Signing Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSODIR",62,0)
 .S PSODIR("COSIGNING PROVIDER")=$S($P(RX3,"^",3)'=PSODIR("COSIGNING PROVIDER"):PSODIR("COSIGNING PROVIDER"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",63,0)
COSIGN1 S DIC(0)="QEAM",DIC="^VA(200,",DIC("B")=$S($G(PSODIR("COSIGNING PROVIDER")):$P(^VA(200,PSODIR("COSIGNING PROVIDER"),0),"^"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",64,0)
 S DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",65,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)",DIC("S")=DIC("S")_",'$P(^(""PS""),""^"",7)"
"RTN","PSODIR",66,0)
 S DIC("A")="COSIGNING PROVIDER: " D ^DIC K DIC
"RTN","PSODIR",67,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G COSIGNX
"RTN","PSODIR",68,0)
 S:+Y>0 PSODIR("COSIGNING PROVIDER")=+Y G:Y<0 COSIGN
"RTN","PSODIR",69,0)
COSIGNX K X,Y
"RTN","PSODIR",70,0)
 Q
"RTN","PSODIR",71,0)
DOSE(PSODIR) ;add dosing info
"RTN","PSODIR",72,0)
 N PSODOSNW S PSODOSNW=1
"RTN","PSODIR",73,0)
 D DOSE1^PSOORED5(.PSODIR)
"RTN","PSODIR",74,0)
EX K PSODOSE,PSOSCH,DOSE,DOOR,SCH,VERB,NOUN,DOSEOR,ENT,PSORTE,DRUA,DIR,X,Y,DIRUT,RTE,ERTE,DD,INS1,SINS1
"RTN","PSODIR",75,0)
 Q
"RTN","PSODIR",76,0)
INS(PSODIR) ;patient instructions
"RTN","PSODIR",77,0)
 N DA
"RTN","PSODIR",78,0)
 K INS1,DD,DIR,DIRUT S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S DD=$G(DD)+1
"RTN","PSODIR",79,0)
 I $G(DD)=1 S PSODIR("INS")=$G(PSODIR("SIG",1)) G INSD
"RTN","PSODIR",80,0)
 ;PSO*7*275 remove check for PSOINSFL just check for multi line sig
"RTN","PSODIR",81,0)
 I $G(DD)>1 D  G EX
"RTN","PSODIR",82,0)
 .K ^TMP($J) S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S ^TMP($J,"SIG",D,0)=PSODIR("SIG",D)
"RTN","PSODIR",83,0)
 .S DWPK=2,DWLW=80,DIC="^TMP($J,""SIG""," D EN^DIWE K PSODIR("SIG")
"RTN","PSODIR",84,0)
 .S D=0 F  S D=$O(^TMP($J,"SIG",D)) Q:'D  S PSODIR("SIG",D)=^TMP($J,"SIG",D,0)
"RTN","PSODIR",85,0)
 .D EN^PSOFSIG(.PSODIR,1) K DWLW,D,DWPK,^TMP($J)
"RTN","PSODIR",86,0)
 I $G(PSOINSFL)=0 G INSD
"RTN","PSODIR",87,0)
 I $G(PSOFDR),$G(ORD),$P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="" G INSD
"RTN","PSODIR",88,0)
 I $G(PSODIR("INS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS"))]"",'$D(PSODIR("FLD",114)) S (DIR("B"),PSOOEINS)=^PS(50.7,PSODRUG("OI"),"INS") G INSD  ;*422
"RTN","PSODIR",89,0)
 S (DIR("B"),PSOOEINS)=$G(PSODIR("SIG",1))  ;*422
"RTN","PSODIR",90,0)
INSD S DIR(0)="52,114" S:$G(PSODIR("INS"))]"" DIR("B")=PSODIR("INS")
"RTN","PSODIR",91,0)
 D DIR
"RTN","PSODIR",92,0)
 I $G(PSODIR("DFLG")) S (PSODIR("INS"),PSODIR("SIG"),PSODIR("SIG",1))=$G(PSOOEINS),PSODIR("SINS")=$G(PSOOSINS) D EN^PSOFSIG(.PSODIR,0)
"RTN","PSODIR",93,0)
 G:$G(PSODIR("DFLG"))!(PSODIR("FIELD")) EX
"RTN","PSODIR",94,0)
 I X'="",X'="@" S PSODIR("INS")=Y D SIG^PSOHELP G INSD:'$D(X)
"RTN","PSODIR",95,0)
 I $G(INS1)]"" D EN^DDIOL($E(INS1,2,9999999)) S (PSODIR("SIG",1),PSODIR("SIG"))=$E(INS1,2,9999999)
"RTN","PSODIR",96,0)
 I X="@" S PSODELINS=1 D DELINS^PSOHELP3 I $G(PSODELINS) S (PSODIR("FLD",114),PSODIR("FLD",114.1))="" K PSODIR("INS"),PSODIR("SIG"),PSODIR("SINS")  ;*422
"RTN","PSODIR",97,0)
 D EN^PSOFSIG(.PSODIR,1) I $O(SIG(0)) S SIGOK=1
"RTN","PSODIR",98,0)
 G EX
"RTN","PSODIR",99,0)
 Q
"RTN","PSODIR",100,0)
SINS(PSODIR) ;other lang. patient instructions
"RTN","PSODIR",101,0)
 K SINS1,DIR
"RTN","PSODIR",102,0)
 S DIR(0)="52,114.1" S:$G(PSODIR("SINS"))]"" DIR("B")=PSODIR("SINS")
"RTN","PSODIR",103,0)
 I $G(PSODIR("SINS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS1"))]"",'$D(PSODIR("FLD",114)),$G(PSOOEINS)]"" S (DIR("B"),PSOOSINS)=^PS(50.7,PSODRUG("OI"),"INS1")
"RTN","PSODIR",104,0)
 D DIR I $G(PSODIR("DFLG")) S (PSODIR("INS"),PSODIR("SIG"),PSODIR("SIG",1))=$G(PSOOEINS),PSODIR("SINS")=$G(PSOOSINS) D EN^PSOFSIG(.PSODIR,0) G EX
"RTN","PSODIR",105,0)
 I X'="",X'="@" S PSODIR("SINS")=Y D SSIG^PSOHELP
"RTN","PSODIR",106,0)
 I $G(SINS1)]"" D EN^DDIOL($E(SINS1,2,9999999)) S PSODIR("SINS")=$E(SINS1,2,9999999)
"RTN","PSODIR",107,0)
 I X="@" S PSODELINS=2 D DELINS^PSOHELP3 I $G(PSODELINS) S (PSODIR("FLD",114),PSODIR("FLD",114.1))="" K PSODIR("INS"),PSODIR("SIG"),PSODIR("SINS") D EN^PSOFSIG(.PSODIR,1) ;*422
"RTN","PSODIR",108,0)
 G EX
"RTN","PSODIR",109,0)
 Q
"RTN","PSODIR",110,0)
 ;
"RTN","PSODIR",111,0)
DIR ;
"RTN","PSODIR",112,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR",113,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR",114,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR",115,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1 S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR",116,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP
"RTN","PSODIR",117,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR",118,0)
 Q
"RTN","PSODIR",119,0)
 ;
"RTN","PSODIR",120,0)
JUMP ;
"RTN","PSODIR",121,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR",122,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR",123,0)
 I Y=-1 S PSODIR("FIELD")=$G(PSODIR("FLD")) G JUMPX
"RTN","PSODIR",124,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR",125,0)
 I $G(PSOREF1)=0 D JUMP^PSOREF1 G JUMPX
"RTN","PSODIR",126,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR",127,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR",128,0)
JUMPX S X="^"_X
"RTN","PSODIR",129,0)
 Q
"RTN","PSODIR",130,0)
 ;
"RTN","PSODIR1")
0^9^B108575993
"RTN","PSODIR1",1,0)
PSODIR1 ;IHS/DSD - ASKS DATA FOR RX ORDER ENTRY CONT. ;3 June 2019 10:45:03
"RTN","PSODIR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,46,78,102,121,131,146,166,184,222,268,206,266,340,391,444,446,505,543,457**;DEC 1997;Build 116
"RTN","PSODIR1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSODIR1",4,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSODIR1",5,0)
 ;External reference $$MXDAYSUP^PSSUTIL1 supported by DBIA 6229
"RTN","PSODIR1",6,0)
 ;External reference $$HTFM^XLFDT supported by DBIA 10103
"RTN","PSODIR1",7,0)
 ;
"RTN","PSODIR1",8,0)
PTSTAT(PSODIR) ;
"RTN","PSODIR1",9,0)
PTSTATEN K DIC,DR,DIE S PSODIR("FIELD")=0
"RTN","PSODIR1",10,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" K PSORX("PATIENT STATUS"),PSODIR("PATIENT STATUS") N PSOFNDRX,PSOFNDFL,PSOFNDPS D
"RTN","PSODIR1",11,0)
 . S PSOFNDFL=0 F PSOFNDPS=0:0 S PSOFNDPS=$O(^PS(53,PSOFNDPS)) Q:'PSOFNDPS!(PSOFNDFL)  D
"RTN","PSODIR1",12,0)
 ..  S PSOFNDRX=$P($G(^PS(53,PSOFNDPS,0)),"^") S PSOFNDRX=$$UP^XLFSTR(PSOFNDRX) I PSOFNDRX="NON-VA" S PSOFNDFL=1 S (PSORX("PATIENT STATUS"),DIC("B"))=$P($G(^PS(53,PSOFNDPS,0)),"^")
"RTN","PSODIR1",13,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW",$G(PSORX("PATIENT STATUS"))="" W !,"Could not find a 'NON-VA' Patient Status in the RX PATIENT STATUS file (#53)!" D PSTPB D  S PSODIR("DFLG")=1 G PTSTATX
"RTN","PSODIR1",14,0)
 . K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODIR1",15,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" G TPBB
"RTN","PSODIR1",16,0)
 N PSOX
"RTN","PSODIR1",17,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^"),DIC("B")=PSORX("PATIENT STATUS")
"RTN","PSODIR1",18,0)
 S:$G(PSODIR("PATIENT STATUS"))]"" DIC("B")=PSODIR("PATIENT STATUS")
"RTN","PSODIR1",19,0)
TPBB ;
"RTN","PSODIR1",20,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSODIR1",21,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSODIR1",22,0)
 S DIC("A")="RX PATIENT STATUS: "
"RTN","PSODIR1",23,0)
 S DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSODIR1",24,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" N PSOPSDIR,PSOFNDZZ,PSOPSUPA S (PSOPSDIR,PSOPSUPA)=0 D  I PSOPSDIR S:PSOPSUPA PSODIR("DFLG")=1 G:PSOPSUPA PTSTATX W ! D PSTPB G PTSTATEN
"RTN","PSODIR1",25,0)
 . I Y'>0!($D(DTOUT))!($D(DUOUT)) S (PSOPSDIR,PSOPSUPA)=1 Q
"RTN","PSODIR1",26,0)
 . S (PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"))=+Y,PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",27,0)
 . S PSOFNDZZ=$P($G(^PS(53,+Y,0)),"^") S PSOFNDZZ=$$UP^XLFSTR(PSOFNDZZ) I PSOFNDZZ'="NON-VA" S PSOPSDIR=1 K PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"),PSODIR("PTST NODE")
"RTN","PSODIR1",28,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" G TPBSC
"RTN","PSODIR1",29,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP G PTSTATX
"RTN","PSODIR1",30,0)
 I $D(DUOUT)!$D(DTOUT) S PSODIR("DFLG")=1 G PTSTATX
"RTN","PSODIR1",31,0)
 I Y=-1 W $C(7)," Required" G PTSTATEN
"RTN","PSODIR1",32,0)
 N PSOFNDX,PSOFNDXY,PSOFNDXX,PSOFNDYY
"RTN","PSODIR1",33,0)
 S PSOFNDXY=$G(Y),PSOFNDYY=$G(Y(0))
"RTN","PSODIR1",34,0)
 I '$G(PSOTPBFG),$G(PSOFROM)="NEW" S PSOFNDX=$P($G(^PS(53,+Y,0)),"^") S PSOFNDXX=$$UP^XLFSTR(PSOFNDX) I PSOFNDXX="NON-VA" K PSOFNDX,PSOFNDXY,PSOFNDYY,PSOFNDXX,Y W !!,"Cannot select 'NON-VA' Rx Patient Status!",! G PTSTATEN
"RTN","PSODIR1",35,0)
 S Y=$G(PSOFNDXY),Y(0)=$G(PSOFNDYY)
"RTN","PSODIR1",36,0)
 K PSOFNDXY,PSOFNDYY,PSOFNDX,PSOFNDXX
"RTN","PSODIR1",37,0)
 S (PSODIR("PATIENT STATUS"),PSORX("PATIENT STATUS"))=+Y
"RTN","PSODIR1",38,0)
 S PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",39,0)
TPBSC ;
"RTN","PSODIR1",40,0)
 I $G(PSOFDR),$P($G(OR0),"^",17)="C" G PTSTATX
"RTN","PSODIR1",41,0)
 L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T G PTSTATX
"RTN","PSODIR1",42,0)
 S DIE="55",DR="3////"_+Y,DA=PSODFN D ^DIE K DIE,DA,D0
"RTN","PSODIR1",43,0)
 L -^PS(55,PSODFN)
"RTN","PSODIR1",44,0)
PTSTATX ;
"RTN","PSODIR1",45,0)
 K DTOUT,DUOUT,X,Y,DA Q
"RTN","PSODIR1",46,0)
 ;
"RTN","PSODIR1",47,0)
SIG(PSODIR) ;
"RTN","PSODIR1",48,0)
 I $G(PSOFDR),$G(PSODIR("SIG"))']"" D SIGOK G:$G(SIGOK)!($G(PSODIR("DFLG"))) SIGX
"RTN","PSODIR1",49,0)
 K DIR,DIC
"RTN","PSODIR1",50,0)
 S DIR(0)="52,10"
"RTN","PSODIR1",51,0)
 S:$G(PSODRUG("SIG"))]"" DIR("B")=PSODRUG("SIG")
"RTN","PSODIR1",52,0)
 S:$G(PSODIR("SIG"))]"" DIR("B")=PSODIR("SIG")
"RTN","PSODIR1",53,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") SIGX
"RTN","PSODIR1",54,0)
 S PSODIR("SIG")=Y,SIGOK=0 K SIG
"RTN","PSODIR1",55,0)
SIGX ;
"RTN","PSODIR1",56,0)
 K X,Y Q
"RTN","PSODIR1",57,0)
 ;
"RTN","PSODIR1",58,0)
QTY(PSODIR) ;
"RTN","PSODIR1",59,0)
QTYA K DIR,DIC N RFL,RXIEN
"RTN","PSODIR1",60,0)
 I $G(CLOZPAT)=1 S DIR("A",1)="Patient Eligible for 14 day supply or 7 day supply with 1 refill"
"RTN","PSODIR1",61,0)
 I $G(CLOZPAT)=2 S DIR("A",1)="Patient Eligible 28 day supply or 14 day supply with 1 refill or 7 day supply with 3 refill"
"RTN","PSODIR1",62,0)
 S DIR(0)="52,7" S:$G(PSODRUG("IEN")) DIR("A")="QTY ( "_$G(PSODRUG("UNIT"))_" ) "_$S($P($G(^PSDRUG(+PSODRUG("IEN"),5)),"^")]"":$P(^PSDRUG(+PSODRUG("IEN"),5),"^"),1:"")
"RTN","PSODIR1",63,0)
 K QTYHLD I $G(PSODIR("QTY"))]"" S QTYHLD=PSODIR("QTY") K PSODIR("QTY")
"RTN","PSODIR1",64,0)
 D:'$G(PSOQTY) QTY^PSOSIG(.PSODIR)
"RTN","PSODIR1",65,0)
 I '$G(SPEED),$G(QTYHLD),'$G(PSODIR("QTY")) S PSODIR("QTY")=QTYHLD
"RTN","PSODIR1",66,0)
 K QTYHLD K:'$G(PSODIR("QTY")) PSODIR("QTY")
"RTN","PSODIR1",67,0)
 I $G(SPEED),$G(PSODIR("QTY"))']"" S PSODIR("QTY")=$P(^PSRX(PSORENW("OIRXN"),0),"^",7)
"RTN","PSODIR1",68,0)
 S:$G(PSODIR("QTY"))]"" DIR("B")=PSODIR("QTY")
"RTN","PSODIR1",69,0)
 D DIR
"RTN","PSODIR1",70,0)
 ;/BLB/ PSO*7.0*505 ;MODIFIED QTY CHECK TO ALLOW LEADING ZEROS
"RTN","PSODIR1",71,0)
 I Y[".",$P(Y,".")<1 S Y="0"_"."_$P(Y,".",2)
"RTN","PSODIR1",72,0)
 G:PSODIR("DFLG")!PSODIR("FIELD") QTYX
"RTN","PSODIR1",73,0)
 I $G(Y),$G(PSODRUG("MAXDOSE"))]"",$G(PSODIR("DAYS SUPPLY")),(Y/+PSODIR("DAYS SUPPLY")>PSODRUG("MAXDOSE")) D  G:$G(PSODIR("DFLG")) QTYX  G QTYA
"RTN","PSODIR1",74,0)
 . W !,$C(7)," Greater than Maximum dose of "_PSODRUG("MAXDOSE")_" per day" D DAYSEN
"RTN","PSODIR1",75,0)
 I $G(PSOFDR),$P($G(OR0),"^",24),$G(PSODIR("QTY")),+Y>$G(PSODIR("QTY")) D  G QTYX
"RTN","PSODIR1",76,0)
 . W !!,"Digitally Signed Order - QTY cannot be increased",!
"RTN","PSODIR1",77,0)
 . N DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR W !
"RTN","PSODIR1",78,0)
 S PSODIR("QTY")=Y
"RTN","PSODIR1",79,0)
QTYX ;
"RTN","PSODIR1",80,0)
 K X,Y Q
"RTN","PSODIR1",81,0)
 ;
"RTN","PSODIR1",82,0)
COPIES(PSODIR) ;
"RTN","PSODIR1",83,0)
 K DIR,DIC
"RTN","PSODIR1",84,0)
 S DIR(0)="52,10.6"
"RTN","PSODIR1",85,0)
 S DIR("B")=$S($G(PSODIR("COPIES"))]"":PSODIR("COPIES"),1:1)
"RTN","PSODIR1",86,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") COPIESX
"RTN","PSODIR1",87,0)
 S PSODIR("COPIES")=Y
"RTN","PSODIR1",88,0)
COPIESX ;
"RTN","PSODIR1",89,0)
 K X,Y Q
"RTN","PSODIR1",90,0)
 ;
"RTN","PSODIR1",91,0)
DAYS(PSODIR) ;
"RTN","PSODIR1",92,0)
DAYSEN K DIR,DIC N PSORFLS
"RTN","PSODIR1",93,0)
 ;PSO*7*266
"RTN","PSODIR1",94,0)
 N S2DS,MXDAYSUP,DFDAYSUP,PSDAYSUP,CSDRUG,NEWTOTDS,PSOREGN S S2DS=0
"RTN","PSODIR1",95,0)
 S MXDAYSUP=90,CSDRUG=0
"RTN","PSODIR1",96,0)
 I $D(PSODRUG("IEN")) D
"RTN","PSODIR1",97,0)
 . S MXDAYSUP=$$MXDAYSUP^PSSUTIL1(PSODRUG("IEN"))
"RTN","PSODIR1",98,0)
 . S S2DS=$$CSDS^PSOSIGDS(PSODRUG("IEN")) I S2DS,$P($G(PSODIR("PTST NODE")),"^",3)>29 S S2DS=30
"RTN","PSODIR1",99,0)
 . S PSORFLS=$S($G(PSODIR("# OF REFILLS")):PSODIR("# OF REFILLS"),1:$P($G(PSODIR("RX0")),"^",9))
"RTN","PSODIR1",100,0)
 . I '$D(PSODRUG("DEA")) S PSODRUG("DEA")=$$GET1^DIQ(50,PSODRUG("IEN"),3,"")
"RTN","PSODIR1",101,0)
 . I (PSODRUG("DEA")["2")!(PSODRUG("DEA")["3")!(PSODRUG("DEA")["4")!(PSODRUG("DEA")["5") S CSDRUG=1
"RTN","PSODIR1",102,0)
 S PSOREGN="" ;p457
"RTN","PSODIR1",103,0)
 I $$ISCLOZ^PSJCLOZ(,,,,$G(PSODRUG("IEN"))) S PSOREGN=$$GET1^DIQ(55,PSODFN,53) ;p457
"RTN","PSODIR1",104,0)
 ;S PSOREGN=$$GET1^DIQ(55,PSODFN,53) p457 commented out
"RTN","PSODIR1",105,0)
 S PSDAYSUP=$S(PSOREGN?1U6N!$D(^TMP($J,"CLOZFLG",PSODFN)):4,$G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:MXDAYSUP)
"RTN","PSODIR1",106,0)
 I (PSOREGN?2U5N)&($$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5)="PSOCLO1") D
"RTN","PSODIR1",107,0)
 . I $P($G(^XTMP("PSO4D-"_PSODFN,"PSOYS")),"^",4)'>0,($P($G(^XTMP("PSO4D-"_PSODFN,0)),"^",1))>$$HTFM^XLFDT($H,1) D
"RTN","PSODIR1",108,0)
 ..  S PSDAYSUP=4 ; Special condition local override if no ANC results
"RTN","PSODIR1",109,0)
 S DIR(0)="N^1:"_PSDAYSUP
"RTN","PSODIR1",110,0)
 S DFDAYSUP=$S($D(CLOZPAT)&('$G(PSODIR("DAYS SUPPLY"))):7,$G(PSODIR("DAYS SUPPLY"))]"":PSODIR("DAYS SUPPLY"),S2DS>1:S2DS,$P($G(PSODIR("PTST NODE")),"^",3):$P(PSODIR("PTST NODE"),"^",3),1:30)
"RTN","PSODIR1",111,0)
 I DFDAYSUP>MXDAYSUP D  S DFDAYSUP=MXDAYSUP
"RTN","PSODIR1",112,0)
 . W:$G(PSODIR("DAYS SUPPLY")) !!,$C(7),"Invalid DAYS SUPPLY value (",DFDAYSUP,"), resetting it to ",MXDAYSUP," (maximum allowed).",!
"RTN","PSODIR1",113,0)
 S DIR("B")=DFDAYSUP
"RTN","PSODIR1",114,0)
 S DIR("A")="DAYS SUPPLY",DIR("?")="Enter a whole number between 1 and "_PSDAYSUP
"RTN","PSODIR1",115,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") DAYSX
"RTN","PSODIR1",116,0)
 I $G(Y),$G(PSODRUG("MAXDOSE"))]"",$G(PSODIR("QTY"))]"",(+PSODIR("QTY")/Y>PSODRUG("MAXDOSE")) D  G DAYSEN
"RTN","PSODIR1",117,0)
 .W !,$C(7)," Greater than Maximum dose of "_PSODRUG("MAXDOSE")_" per day"
"RTN","PSODIR1",118,0)
 I $G(PSOFDR),$P($G(OR0),"^",24),$G(PSODIR("DAYS SUPPLY")),+Y>$G(PSODIR("DAYS SUPPLY")) D  G DAYSX
"RTN","PSODIR1",119,0)
 . W !!,"Digitally Signed Order - Days Supply cannot be increased",!
"RTN","PSODIR1",120,0)
 . N DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR W !
"RTN","PSODIR1",121,0)
 I $G(PSONEW("FLD"))=8,PSODIR("DAYS SUPPLY")=Y Q
"RTN","PSODIR1",122,0)
 S:$G(PSODIR("DAYS SUPPLY")) PSODIR("OLD DAYS SUPPLY")=PSODIR("DAYS SUPPLY")
"RTN","PSODIR1",123,0)
 S PSODIR("DAYS SUPPLY")=Y
"RTN","PSODIR1",124,0)
 ; Checking the # Of Refills field value after the Days Supply field was edited
"RTN","PSODIR1",125,0)
 I $D(PSODRUG("IEN")),$G(Y),$G(Y)>$S(PSORFLS<4:90,PSORFLS<6:89,PSORFLS<12:60,1:0) D
"RTN","PSODIR1",126,0)
 . N PTST
"RTN","PSODIR1",127,0)
 . S PTST=+$G(PSODIR("PATIENT STATUS")) S:'PTST PTST=$P($G(PSODIR("RX0")),"^",3)
"RTN","PSODIR1",128,0)
 . I 'PTST,$G(PSODFN) S PTST=+$G(^PS(55,PSODFN,"PS"))
"RTN","PSODIR1",129,0)
 . I PSORFLS>$$MAXNUMRF^PSOUTIL(PSODRUG("IEN"),Y,PTST,.CLOZPAT) D
"RTN","PSODIR1",130,0)
 ..  W !,$C(7),"Invalid number of REFILLS for amount of DAYS SUPPLY.",!,"REFILL EDIT FORCED." D REFILL(.PSODIR)
"RTN","PSODIR1",131,0)
 ..  S PSODIR("FLD",9)=PSODIR("# OF REFILLS")
"RTN","PSODIR1",132,0)
 S:$G(CLOZPAT)=0 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",133,0)
 D:$G(CLOZPAT)=2
"RTN","PSODIR1",134,0)
 . S:PSODIR("DAYS SUPPLY")=28 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",135,0)
 . S:PSODIR("DAYS SUPPLY")=14 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=1
"RTN","PSODIR1",136,0)
 . S:PSODIR("DAYS SUPPLY")=7 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=3
"RTN","PSODIR1",137,0)
 D:$G(CLOZPAT)=1
"RTN","PSODIR1",138,0)
 . S:PSODIR("DAYS SUPPLY")=14 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=0
"RTN","PSODIR1",139,0)
 . S:PSODIR("DAYS SUPPLY")=7 (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=1
"RTN","PSODIR1",140,0)
 K QTYHLD S:$G(PSODIR("QTY")) QTYHLD=PSODIR("QTY") D QTY^PSOSIG(.PSODIR)
"RTN","PSODIR1",141,0)
 I $G(QTYHLD),'$G(PSODIR("QTY")) S PSODIR("QTY")=QTYHLD
"RTN","PSODIR1",142,0)
 K QTYHLD K:'$G(PSODIR("QTY")) PSODIR("QTY")
"RTN","PSODIR1",143,0)
DAYSX ;
"RTN","PSODIR1",144,0)
 K X,Y Q
"RTN","PSODIR1",145,0)
 ;
"RTN","PSODIR1",146,0)
REFILL(PSODIR) ;
"RTN","PSODIR1",147,0)
 N PSODAYS,PSOX
"RTN","PSODIR1",148,0)
 S PSODAYS=+$G(PSODIR("DAYS SUPPLY"))
"RTN","PSODIR1",149,0)
 ;Recalculating RFTT if it doesn't exist
"RTN","PSODIR1",150,0)
 I '$G(PSONEW) D
"RTN","PSODIR1",151,0)
 . N I I '$G(RFTT),$G(PSORXED("IRXN")) F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFTT=$G(RFTT)+1
"RTN","PSODIR1",152,0)
 ;
"RTN","PSODIR1",153,0)
 I $G(PSODIR("PTST NODE"))="" D
"RTN","PSODIR1",154,0)
 . N X,Y
"RTN","PSODIR1",155,0)
 . S X=$G(PSODIR("PATIENT STATUS")) S:'X X=$P(RX0,"^",3)
"RTN","PSODIR1",156,0)
 . S DIC=53,DIC(0)="QXZ" D ^DIC K DIC
"RTN","PSODIR1",157,0)
 . S:+Y PSODIR("PTST NODE")=Y(0)
"RTN","PSODIR1",158,0)
 . S:'$G(PSODIR("PATIENT STATUS")) PSODIR("PATIENT STATUS")=+Y
"RTN","PSODIR1",159,0)
 S $P(PSODIR("PTST NODE"),"^",4)=+$P($G(PSODIR("PTST NODE")),"^",4)
"RTN","PSODIR1",160,0)
 I $G(OR0) G REFOR
"RTN","PSODIR1",161,0)
 K DIR,DIC,PSOX
"RTN","PSODIR1",162,0)
 ; Controlled Substance
"RTN","PSODIR1",163,0)
 S PSODIR("CS")=0
"RTN","PSODIR1",164,0)
 I (PSODRUG("DEA")["2")!(PSODRUG("DEA")["3")!(PSODRUG("DEA")["4")!(PSODRUG("DEA")["5") D
"RTN","PSODIR1",165,0)
 . S $P(PSODIR("CS"),"^")=1 S:(PSODRUG("DEA")["2") $P(PSODIR("CS"),"^",2)=1
"RTN","PSODIR1",166,0)
 ;
"RTN","PSODIR1",167,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSODIR1",168,0)
 S PSOX=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),PSODAYS,+$G(PSODIR("PATIENT STATUS")),.CLOZPAT)
"RTN","PSODIR1",169,0)
 ;
"RTN","PSODIR1",170,0)
 I '$D(CLOZPAT) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) D  G REFILLX
"RTN","PSODIR1",171,0)
 . I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2)!'$O(^PSRX(+$G(PSODIR("IRXN")),1,0))!('$G(PSOLOKED)) D  Q
"RTN","PSODIR1",172,0)
 ..  S VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["F":"this drug.",1:"Narcotics.") W !,VALMSG,!
"RTN","PSODIR1",173,0)
 ..  S:$D(PSODIR("FIELD")) PSODIR("FIELD")=0 S PSODIR("# OF REFILLS")=0
"RTN","PSODIR1",174,0)
 . ; reset refills to the # given
"RTN","PSODIR1",175,0)
 . D RFRSET^PSODIR2
"RTN","PSODIR1",176,0)
 ;
"RTN","PSODIR1",177,0)
 I $P($G(PSODIR("CS")),"^",2)=1 W !,"No refills allowed on Schedule 2 drugs...",! S:$D(PSODIR("FIELD")) PSODIR("FIELD")=0 S PSODIR("# OF REFILLS")=0 G REFILLX
"RTN","PSODIR1",178,0)
 ;
"RTN","PSODIR1",179,0)
 ;/RBN - Integration of 457 start
"RTN","PSODIR1",180,0)
 I $D(CLOZPAT) S PSOX=$S($G(CLOZPAT)=2&(PSODIR("DAYS SUPPLY")=14):1,$G(CLOZPAT)=2&(PSODIR("DAYS SUPPLY")=7):3,$G(CLOZPAT)=1&(PSODIR("DAYS SUPPLY")=7):1,1:0)
"RTN","PSODIR1",181,0)
 ;/RBN - Integration of 457 end
"RTN","PSODIR1",182,0)
 ;
"RTN","PSODIR1",183,0)
 ;PSO*7*266 make sure PSOX is greater than RFTT
"RTN","PSODIR1",184,0)
 S DIR(0)="N^"_$S($G(RFTT):RFTT,1:0)_":"_$S(+$G(RFTT)>PSOX:RFTT,1:PSOX),DIR("A")="# OF REFILLS"
"RTN","PSODIR1",185,0)
 ;PSO*7*340 Correct Default Value
"RTN","PSODIR1",186,0)
 S DIR("B")=$S($G(COPY)&('$G(PSOTITRX)):$G(PSODIR("# OF REFILLS")),$G(PSODIR("N# REF"))]"":PSODIR("N# REF"),$G(PSODIR("# OF REFILLS"))]"":PSODIR("# OF REFILLS"),$G(RFTT)>PSOX:RFTT,1:PSOX)
"RTN","PSODIR1",187,0)
 S DIR("?",1)="Enter a whole number. The maximum number of refills is based on"
"RTN","PSODIR1",188,0)
 S DIR("?")="the DAYS SUPPLY and the PATIENT STATUS fields."
"RTN","PSODIR1",189,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") REFILLX
"RTN","PSODIR1",190,0)
 S (PSODIR("N# REF"),PSODIR("# OF REFILLS"))=Y
"RTN","PSODIR1",191,0)
 ;
"RTN","PSODIR1",192,0)
REFILLX ;
"RTN","PSODIR1",193,0)
 S:$G(PSODIR("# OF REFILLS"))']"" PSODIR("# OF REFILLS")=$S($G(PSODIR("N# REF"))]"":PSODIR("N# REF"),1:PSOX)
"RTN","PSODIR1",194,0)
 K X,Y,PSOX,DEA,PSOCS,RFTT ;PSO*7*340 Kill RFTT
"RTN","PSODIR1",195,0)
 Q
"RTN","PSODIR1",196,0)
 ;OERR CALL
"RTN","PSODIR1",197,0)
REFOR ;
"RTN","PSODIR1",198,0)
 D REFOR^PSODIR3
"RTN","PSODIR1",199,0)
 G REFILLX
"RTN","PSODIR1",200,0)
 Q
"RTN","PSODIR1",201,0)
DIR ;
"RTN","PSODIR1",202,0)
 S (PSODIR("FIELD"),PSODIR("DFLG"))=0
"RTN","PSODIR1",203,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR1",204,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR1",205,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1!(Y="") S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR1",206,0)
 I $D(DIRUT)!($D(DIROUT)),$G(SPEED) S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR1",207,0)
 I X[U,$L(X)>1 D JUMP
"RTN","PSODIR1",208,0)
DIRX ;
"RTN","PSODIR1",209,0)
 K DIRUT,DTOUT,DUOUT,DIROUT Q
"RTN","PSODIR1",210,0)
 ;
"RTN","PSODIR1",211,0)
JUMP ;
"RTN","PSODIR1",212,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR1",213,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR1",214,0)
 I Y=-1 S PSODIR("FIELD")=PSODIR("FLD") G JUMPX
"RTN","PSODIR1",215,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR1",216,0)
 I $G(PSOREF1)=0 D JUMP^PSOREF1 G JUMPX
"RTN","PSODIR1",217,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR1",218,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR1",219,0)
JUMPX ;
"RTN","PSODIR1",220,0)
 S X="^"_X Q
"RTN","PSODIR1",221,0)
 ;
"RTN","PSODIR1",222,0)
SIGOK ;review and decide on oerr sig
"RTN","PSODIR1",223,0)
 I '$O(SIG(0)) S SIGOK=0 Q
"RTN","PSODIR1",224,0)
 K SIGOK W !,"SIG: "
"RTN","PSODIR1",225,0)
 F SIG=0:0 S SIG=$O(SIG(SIG)) W SIG(SIG)_" ",!?5 Q:'$O(SIG(SIG))
"RTN","PSODIR1",226,0)
 K DIR,DIRUT,DUOUT,DTOUT S DIR("B")="YES",DIR(0)="Y",DIR("A")="Is this SIG correct" D ^DIR K DIR I $D(DIRUT) S PSODIR("DFLG")=1 K DIRUT,DUOUT,DTOUT Q
"RTN","PSODIR1",227,0)
 S SIGOK=Y I Y K PSODIR("SIG")
"RTN","PSODIR1",228,0)
 Q
"RTN","PSODIR1",229,0)
PSTPB    ;
"RTN","PSODIR1",230,0)
 W !,"New orders entered through this option must have a Patient Status of 'NON-VA'!",!
"RTN","PSODIR1",231,0)
 Q
"RTN","PSODIR1",232,0)
 ;
"RTN","PSODIR2")
0^8^B32390771
"RTN","PSODIR2",1,0)
PSODIR2 ;IHS/DSD/JCM - rx order entry contd ;Jul 24, 2017@15:24
"RTN","PSODIR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,9,26,46,124,146,139,152,166,504,526,457**;DEC 1997;Build 116
"RTN","PSODIR2",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSODIR2",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSODIR2",5,0)
 ;External reference to ^%DTC supported by DBIA 10000
"RTN","PSODIR2",6,0)
 ;External reference to ^DIC supported by DBIA 10006
"RTN","PSODIR2",7,0)
 ;External reference to ^DIR supported by DBIA 10026
"RTN","PSODIR2",8,0)
 ;
"RTN","PSODIR2",9,0)
 ;---------------------------------------------------------------------
"RTN","PSODIR2",10,0)
 ;
"RTN","PSODIR2",11,0)
EXP(PSODIR) ;
"RTN","PSODIR2",12,0)
 K DIR,DIC
"RTN","PSODIR2",13,0)
 I $G(PSODRUG("EXPIRATION DATE"))]"" S Y=PSODRUG("EXPIRATION DATE") X ^DD("DD") S PSORX("EXPIRATION DATE")=Y
"RTN","PSODIR2",14,0)
 S DIR("A")="EXPIRES",DIR("B")=$S($G(PSORX("EXPIRATION DATE"))]"":PSORX("EXPIRATION DATE"),1:"T+6M")
"RTN","PSODIR2",15,0)
 S DIR(0)="D^NOW::EX"
"RTN","PSODIR2",16,0)
 S DIR("?")="Both the month and date are required."
"RTN","PSODIR2",17,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") EXPX
"RTN","PSODIR2",18,0)
 S PSODIR("EXPIRATION DATE")=Y
"RTN","PSODIR2",19,0)
EXPX K X,Y
"RTN","PSODIR2",20,0)
 Q
"RTN","PSODIR2",21,0)
 ;
"RTN","PSODIR2",22,0)
CLINIC(PSODIR) ;
"RTN","PSODIR2",23,0)
 K DIR,DIC S PSODIR("FIELD")=0
"RTN","PSODIR2",24,0)
 S DIR(0)="52,5" S:$G(PSORX("CLINIC"))]"" DIR("B")=PSORX("CLINIC"),DIR("A")="CLINIC"
"RTN","PSODIR2",25,0)
 D ^DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) CLINICX  ;526
"RTN","PSODIR2",26,0)
 I +Y>0 S PSODIR("CLINIC")=+Y,PSORX("CLINIC")=$P(Y,"^",2)
"RTN","PSODIR2",27,0)
 E  S (PSORX("CLINIC"),PSODIR("CLINIC"))=""
"RTN","PSODIR2",28,0)
CLINICX K X,Y,PSOX,DIC
"RTN","PSODIR2",29,0)
 Q
"RTN","PSODIR2",30,0)
 ;
"RTN","PSODIR2",31,0)
MW(PSODIR) ;
"RTN","PSODIR2",32,0)
 K DIR,DIC
"RTN","PSODIR2",33,0)
 S DIR(0)="52,11" S:$G(POERR)&'$D(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$S($P($G(OR0),"^",17)="M":"MAIL",1:"WINDOW")
"RTN","PSODIR2",34,0)
 S DIR("B")=$S($G(PSORX("MAIL/WINDOW"))]"":PSORX("MAIL/WINDOW"),$G(PSOTPBFG)&($G(PSOFROM)="NEW"):"MAIL",1:"WINDOW")
"RTN","PSODIR2",35,0)
 D DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) MWX
"RTN","PSODIR2",36,0)
 I $G(Y(0))']"" S PSODIR("DFLG")=1 G MWX
"RTN","PSODIR2",37,0)
 S PSODIR("MAIL/WINDOW")=Y,PSORX("MAIL/WINDOW")=Y(0)
"RTN","PSODIR2",38,0)
 I $G(PSORX("EDIT"))]"",PSODIR("MAIL/WINDOW")'="W" K PSODIR("METHOD OF PICK-UP")
"RTN","PSODIR2",39,0)
MW1 G:PSODIR("MAIL/WINDOW")'="W"!('$P($G(PSOPAR),"^",12)) MWX
"RTN","PSODIR2",40,0)
 S DIR(0)="52,35O"
"RTN","PSODIR2",41,0)
 S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP")
"RTN","PSODIR2",42,0)
 D DIR G:$G(PSODIR("DFLG")) MWX
"RTN","PSODIR2",43,0)
 I X[U W !,"Cannot jump to another field ..",! G MW1
"RTN","PSODIR2",44,0)
 S (PSODIR("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y
"RTN","PSODIR2",45,0)
MWX K X,Y
"RTN","PSODIR2",46,0)
 Q
"RTN","PSODIR2",47,0)
 ;
"RTN","PSODIR2",48,0)
RMK(PSODIR) ;
"RTN","PSODIR2",49,0)
RMKEN K DIR,DIC
"RTN","PSODIR2",50,0)
 S DIR(0)="52,12"
"RTN","PSODIR2",51,0)
 S:$G(PSODIR("REMARKS"))]"" DIR("B")=PSODIR("REMARKS")
"RTN","PSODIR2",52,0)
 D DIR G:$G(PSODIR("DFLG")) RMKX  ;*526
"RTN","PSODIR2",53,0)
 I X[U W !,"Cannot jump to another field ..",! G RMKEN
"RTN","PSODIR2",54,0)
 S:$L(X)>0 PSODIR("REMARKS")=X
"RTN","PSODIR2",55,0)
 S:X="@" PSODIR("REMARKS")=""
"RTN","PSODIR2",56,0)
RMKX K X,Y
"RTN","PSODIR2",57,0)
 Q
"RTN","PSODIR2",58,0)
 ;
"RTN","PSODIR2",59,0)
ISSDT(PSODIR) ;
"RTN","PSODIR2",60,0)
 K DIR,DIC
"RTN","PSODIR2",61,0)
 S DIR("A")="ISSUE DATE",DIR("B")=$S($G(POERR)&($G(PSORX("ISSUE DATE"))']"")&($G(PSODIR("ISSUE DATE"))]""):PSODIR("ISSUE DATE"),$G(PSORX("ISSUE DATE"))]"":PSORX("ISSUE DATE"),1:"TODAY")
"RTN","PSODIR2",62,0)
 I DIR("B") S Y=DIR("B") X ^DD("DD") S DIR("B")=Y
"RTN","PSODIR2",63,0)
 S DIR(0)="52,1"
"RTN","PSODIR2",64,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") ISSDTX
"RTN","PSODIR2",65,0)
 S (PSODIR("ISSUE DATE"),PSOID)=Y
"RTN","PSODIR2",66,0)
 X ^DD("DD") S (PSORX("ISSUE DATE"),PSODIR("ISSUE DATE"))=Y
"RTN","PSODIR2",67,0)
ISSDTX K X,Y
"RTN","PSODIR2",68,0)
 Q
"RTN","PSODIR2",69,0)
 ;
"RTN","PSODIR2",70,0)
FILLDT(PSODIR) ;
"RTN","PSODIR2",71,0)
 K DIR,DIC
"RTN","PSODIR2",72,0)
 S:'$G(PSONEW("DAYS SUPPLY")) PSONEW("DAYS SUPPLY")=30,PSONEW("# OF REFILLS")=1
"RTN","PSODIR2",73,0)
 S DIR("A")="FILL DATE",DIR("B")=$S($G(PSORX("FILL DATE"))]"":PSORX("FILL DATE"),1:"TODAY")
"RTN","PSODIR2",74,0)
 S X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSODIR2",75,0)
 S X1=$S($G(PSOID):PSOID,1:DT)
"RTN","PSODIR2",76,0)
 S X2=$S(PSONEW("DAYS SUPPLY")=X2:X2,+$G(PSODIR("CS")):184,1:366)
"RTN","PSODIR2",77,0)
 I X2<30 D
"RTN","PSODIR2",78,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSODIR2",79,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSODIR2",80,0)
 ;; START NCC REMEDIATION >> 457*RJS
"RTN","PSODIR2",81,0)
 ;; ADJUST EXPIRE DATE FOR 4 DAY SUPPLY
"RTN","PSODIR2",82,0)
 I $G(CLOZFLG),PSONEW("DAYS SUPPLY"),5 S X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSODIR2",83,0)
 ;; END NCC REMEDIATION << 457*RJS
"RTN","PSODIR2",84,0)
 D C^%DTC S PSOFDMX=$P(X,".") I DT>X S Y=$S($G(PSOID):PSOID,1:PSORX("ISSUE DATE")) X ^DD("DD") S DIR("B")=Y
"RTN","PSODIR2",85,0)
 S DIR(0)="D^"_$S($G(PSOID):PSOID,+$G(PSODIR("ISSUE DATE")):PSODIR("ISSUE DATE"),1:DT)_$S($G(DUZ("AG"))="I":":"_DT_":EX",1:":"_PSOFDMX_":EX")
"RTN","PSODIR2",86,0)
 S Y=PSOFDMX X ^DD("DD")
"RTN","PSODIR2",87,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the ISSUE DATE,"
"RTN","PSODIR2",88,0)
 S DIR("?",2)="the FILL DATE cannot be before the ISSUE DATE or AFTER the Expiration Date "
"RTN","PSODIR2",89,0)
 S DIR("?")=Y_".  Both the month and date are required."
"RTN","PSODIR2",90,0)
 D DIR G:$G(PSODIR("DFLG"))!$G(PSODIR("FIELD")) FILLDTX  ;*526
"RTN","PSODIR2",91,0)
 S PSODIR("FILL DATE")=Y
"RTN","PSODIR2",92,0)
 X ^DD("DD") S PSORX("FILL DATE")=Y
"RTN","PSODIR2",93,0)
FILLDTX K X,Y,PSOFDMX
"RTN","PSODIR2",94,0)
 Q
"RTN","PSODIR2",95,0)
 ;
"RTN","PSODIR2",96,0)
CLERK(PSODIR) ;
"RTN","PSODIR2",97,0)
 I $G(DUZ("AG"))'="I" D  G CLERKX
"RTN","PSODIR2",98,0)
 .S PSODIR("CLERK CODE")=$S($G(PSOFDR):$P(OR0,"^",4),1:DUZ),PSORX("CLERK CODE")=$P($G(^VA(200,PSODIR("CLERK CODE"),0)),"^")
"RTN","PSODIR2",99,0)
 K DIR,DIC
"RTN","PSODIR2",100,0)
 S DIR("A")="CLERK",DIR("B")=$S($G(PSORX("CLERK CODE"))]"":PSORX("CLERK CODE"),1:$P($G(^VA(200,DUZ,0)),"^",2)),DIR(0)="52,16"
"RTN","PSODIR2",101,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") CLERKX
"RTN","PSODIR2",102,0)
 S PSODIR("CLERK CODE")=+Y,PSORX("CLERK CODE")=$P(Y,"^")
"RTN","PSODIR2",103,0)
CLERKX Q
"RTN","PSODIR2",104,0)
 ;
"RTN","PSODIR2",105,0)
DIR ;
"RTN","PSODIR2",106,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR2",107,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR2",108,0)
 D ^DIR K DIR,DIE,DIC,DA I X="^^" S (PSODIR("QFLG"),PSODIR("DFLG"))=1 G DIRX
"RTN","PSODIR2",109,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1!(Y="") S PSODIR("DFLG")=1 S:$G(SPEED) PSODIR("QFLG")=1 G DIRX
"RTN","PSODIR2",110,0)
 I $D(DUOUT)!($D(DTOUT)),$G(SPEED) S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR2",111,0)
 I X[U,$L(X)>1 D JUMP
"RTN","PSODIR2",112,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR2",113,0)
 Q
"RTN","PSODIR2",114,0)
 ;
"RTN","PSODIR2",115,0)
JUMP ;
"RTN","PSODIR2",116,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR2",117,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR2",118,0)
 I Y=-1 S PSODIR("FIELD")=$G(PSODIR("FLD")) G JUMPX
"RTN","PSODIR2",119,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR2",120,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR2",121,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR2",122,0)
JUMPX S X="^"_X
"RTN","PSODIR2",123,0)
 Q
"RTN","PSODIR2",124,0)
 ;Reset refills when drug changed to a controlled sub
"RTN","PSODIR2",125,0)
RFRSET ;
"RTN","PSODIR2",126,0)
 N RFN,RFNC
"RTN","PSODIR2",127,0)
 S (RFN,RFNC)=0
"RTN","PSODIR2",128,0)
 F  S RFN=$O(^PSRX(+$G(PSODIR("IRXN")),1,RFN)) Q:'RFN  S RFNC=RFNC+1
"RTN","PSODIR2",129,0)
 I $D(PSODIR("FIELD")) S PSODIR("FIELD")=0
"RTN","PSODIR2",130,0)
 S PSODIR("# OF REFILLS")=RFNC
"RTN","PSODIR2",131,0)
 S VALMSG="The drug has been changed and no longer allows refills."
"RTN","PSODIR2",132,0)
 W !,VALMSG,!
"RTN","PSODIR2",133,0)
 Q
"RTN","PSODRG")
0^5^B99583322
"RTN","PSODRG",1,0)
PSODRG ;IHS/DSD/JCM - ORDER ENTRY DRUG SELECTION ;14 March 2019 16:07:09
"RTN","PSODRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,23,36,53,54,46,112,139,207,148,243,268,324,251,375,387,398,390,427,411,458,504,517,457**;DEC 1997;Build 116
"RTN","PSODRG",3,0)
 ;Reference to ^PSDRUG( supported by DBIA 221
"RTN","PSODRG",4,0)
 ;Reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODRG",5,0)
 ;Reference to $$PROMPT^PSSDIN supported by DBIA 3166
"RTN","PSODRG",6,0)
 ;Reference to EN^PSSDIN supported by DBIA 3166
"RTN","PSODRG",7,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSODRG",8,0)
 ;Reference to ^OROCAPI controlled subscription supported by DBIA 5367
"RTN","PSODRG",9,0)
 ;Reference to $$OITM^ORX8 supported by DBIA 5469
"RTN","PSODRG",10,0)
 ;Reference to ^VADPT supported by DBIA 10061
"RTN","PSODRG",11,0)
 ;Reference to IN^PSSHRQ2 supported by DBIA 5369
"RTN","PSODRG",12,0)
 ;Reference to ^XTMP("ORRDI" supported by DBIA 5440
"RTN","PSODRG",13,0)
 ;----------------------------------------------------------
"RTN","PSODRG",14,0)
START ;
"RTN","PSODRG",15,0)
 S (PSONEW("DFLG"),PSONEW("FIELD"),PSODRG("QFLG"))=0 K PSORX("DFLG")
"RTN","PSODRG",16,0)
 D @($S(+$G(PSOEDIT)=1&('$D(DA)):"SELECT^PSODRGN",1:"SELECT"))
"RTN","PSODRG",17,0)
 G:$G(PSORXED("DFLG")) END ; Select Drug
"RTN","PSODRG",18,0)
 ;PATCH PSO*7*517 - Blocking action FN if issuing a controlled substance to a patient without a zipcode
"RTN","PSODRG",19,0)
 N DRGIEN S DRGIEN=$P($G(PSOY),U)
"RTN","PSODRG",20,0)
 I $$CSBLOCK^PSOORNEW(PSODFN,DRGIEN) D  S DIR(0)="E" W ! D ^DIR K DIR,Y  G END
"RTN","PSODRG",21,0)
 .W !,"Controlled substance prescriptions require a patient address. Please update"
"RTN","PSODRG",22,0)
 .W !,"patient address information. This action will also invalidate a digitally"
"RTN","PSODRG",23,0)
 .W !,"signed prescription and require the provider to re-enter the order."
"RTN","PSODRG",24,0)
 .S PSONEW("DFLG")=1
"RTN","PSODRG",25,0)
 ;PSO*7*517 - END
"RTN","PSODRG",26,0)
 I $G(PSORX("EDIT")),$G(PSOY),$G(PSODRUG("IEN"))=+PSOY D  G:$G(PSORXED("DFLG")) END
"RTN","PSODRG",27,0)
 . N NDC D NDC(+$G(PSORXED("IRXN")),0,+PSOY,.NDC) I $G(NDC)="^" S PSORXED("DFLG")=1 Q
"RTN","PSODRG",28,0)
 . I $G(NDC)'="" S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSODRG",29,0)
 ;
"RTN","PSODRG",30,0)
 I $G(PSORX("EDIT"))]"",'PSONEW("FIELD") D TRADE
"RTN","PSODRG",31,0)
 G:$G(PSONEW("DFLG"))!($G(PSODRG("QFLG")))!($G(PSORXED("DFLG"))) END
"RTN","PSODRG",32,0)
 D SET ; Set various drug information
"RTN","PSODRG",33,0)
 D NFI ; Display dispense drug/orderable item text
"RTN","PSODRG",34,0)
 D:'$G(PSOEDIT) POST I $G(PSORX("DFLG")) S PSONEW("DFLG")=1 K:'$G(PSORX("EDIT")) PSORX("DFLG") ; Do any post selection action
"RTN","PSODRG",35,0)
END ;D EOJ
"RTN","PSODRG",36,0)
 Q
"RTN","PSODRG",37,0)
 ;------------------------------------------------------------
"RTN","PSODRG",38,0)
 ;
"RTN","PSODRG",39,0)
SELECT ;
"RTN","PSODRG",40,0)
 K:'$G(PSORXED) CLOZPAT
"RTN","PSODRG",41,0)
 K IT,DIC,X,Y,PSODRUG("TRADE NAME"),PSODRUG("NDC"),PSODRUG("DAW"),PSODRUG("BAD") S:$G(POERR)&($P($G(OR0),"^",9)) Y=$$GET1^DIQ(50,$P(OR0,"^",9),.01)
"RTN","PSODRG",42,0)
 I $G(PSODRUG("IEN"))]"" S Y=PSODRUG("NAME"),PSONEW("OLD VAL")=PSODRUG("IEN")
"RTN","PSODRG",43,0)
 W !,"DRUG: "_$S($G(Y)]"":Y_"// ",1:"") R X:$S($D(DTIME):DTIME,1:300) I '$T S DTOUT=1
"RTN","PSODRG",44,0)
 I X="",$G(Y)]"" S:Y X=Y S:'X X=$G(PSODRUG("IEN")) S:X X="`"_X
"RTN","PSODRG",45,0)
 G:X="" SELECT
"RTN","PSODRG",46,0)
 I X?1."?" W !!,"Answer with DRUG NUMBER, or GENERIC NAME, or VA PRODUCT NAME, or",!,"NATIONAL DRUG CLASS, or SYNONYM" G SELECT
"RTN","PSODRG",47,0)
 I $G(PSORXED),X["^" S PSORXED("DFLG")=1 G SELECTX
"RTN","PSODRG",48,0)
 I X="^"!(X["^^")!($D(DTOUT)) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",49,0)
 I '$G(POERR),X[U,$L(X)>1 S PSODIR("FLD")=PSONEW("FLD") D JUMP^PSODIR1 S:$G(PSODIR("FIELD")) PSONEW("FIELD")=PSODIR("FIELD") K PSODIR S PSODRG("QFLG")=1 G SELECTX
"RTN","PSODRG",50,0)
 S DIC=50,DIC(0)="EMQZVT",DIC("T")="",D="B^C^VAPN^VAC"
"RTN","PSODRG",51,0)
 S DIC("S")="I $S('$$GET1^DIQ(50,+Y,100,""I""):1,DT'>$$GET1^DIQ(50,+Y,100,""I""):1,1:0),$S($$GET1^DIQ(50,+Y,63,""I"")'[""O"":0,1:1)"   ;,$D(^PSDRUG(""ASP"",+$G(^(2)),+Y))"
"RTN","PSODRG",52,0)
 D MIX^DIC1 K DIC,D
"RTN","PSODRG",53,0)
 I $D(DTOUT) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",54,0)
 I $D(DUOUT) K DUOUT G SELECT
"RTN","PSODRG",55,0)
 I Y<0 G SELECT
"RTN","PSODRG",56,0)
 S:$G(PSONEW("OLD VAL"))=+Y&('$G(PSOEDIT)) PSODRG("QFLG")=1
"RTN","PSODRG",57,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSODRG",58,0)
 I $P(PSOY(0),"^")="OTHER DRUG"!($P(PSOY(0),"^")="OUTSIDE DRUG") D TRADE
"RTN","PSODRG",59,0)
SELECTX K X,Y,DTOUT,DUOUT,PSONEW("OLD VAL")
"RTN","PSODRG",60,0)
 Q
"RTN","PSODRG",61,0)
 ;
"RTN","PSODRG",62,0)
NDC(RX,RFL,DRG,NDC) ; Editing NDC for Released Rx's or for Unresolved ECME Rejects
"RTN","PSODRG",63,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",64,0)
 ; Check if we should edit the NDC
"RTN","PSODRG",65,0)
 ; Needs to be released or have unresolved billable rejects (PSO*7*427)
"RTN","PSODRG",66,0)
 ;
"RTN","PSODRG",67,0)
 N PSOCONT S PSOCONT=0                         ; continue flag
"RTN","PSODRG",68,0)
 D  Q:'PSOCONT                                 ; get out if NDC edit not allowed
"RTN","PSODRG",69,0)
 . I $$RXRLDT^PSOBPSUT(RX,RFL) S PSOCONT=1 Q   ; Released - continue and allow edit
"RTN","PSODRG",70,0)
 . I $$FIND^PSOREJUT(RX,RFL),$$STATUS^PSOBPSUT(RX,RFL)'="" S PSOCONT=1 Q    ; unreleased w/unresolved billable rejections
"RTN","PSODRG",71,0)
 . Q
"RTN","PSODRG",72,0)
 ;
"RTN","PSODRG",73,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",74,0)
 D NDCEDT^PSONDCUT(RX,.RFL,$G(DRG),$G(PSOSITE),.NDC)
"RTN","PSODRG",75,0)
 Q
"RTN","PSODRG",76,0)
 ;
"RTN","PSODRG",77,0)
TRADE ;
"RTN","PSODRG",78,0)
 K DIR,DIC,DA,X,Y
"RTN","PSODRG",79,0)
 S DIR(0)="52,6.5" S:$G(PSOTRN)]"" DIR("B")=$G(PSOTRN) D ^DIR K DIR,DIC
"RTN","PSODRG",80,0)
 I X="@" S Y=X K DIRUT
"RTN","PSODRG",81,0)
 I $D(DIRUT) S:$D(DUOUT)!$D(DTOUT)&('$D(PSORX("EDIT"))) PSONEW("DFLG")=1 G TRADEX
"RTN","PSODRG",82,0)
 S PSODRUG("TRADE NAME")=Y
"RTN","PSODRG",83,0)
TRADEX I $G(PSORXED("DFLG")),$D(DIRUT) S PSORXED("DFLG")=1
"RTN","PSODRG",84,0)
 K DIRUT,DTOUT,DUOUT,X,Y,DA,DR,DIE
"RTN","PSODRG",85,0)
 Q
"RTN","PSODRG",86,0)
SET ;
"RTN","PSODRG",87,0)
 N STAT
"RTN","PSODRG",88,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2)
"RTN","PSODRG",89,0)
 S PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSODRG",90,0)
 S PSODRUG("OI")=+$$GET1^DIQ(50,+PSOY,2.1,"I"),PSODRUG("OIN")=$$GET1^DIQ(50,+PSOY,2.1)
"RTN","PSODRG",91,0)
 S PSODRUG("NDF")=$S(PSODRUG("OI"):$$GET1^DIQ(50,+PSOY,20,"I")_"A"_$$GET1^DIQ(50,+PSOY,22,"I"),1:0)
"RTN","PSODRG",92,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3)
"RTN","PSODRG",93,0)
 ; (#25) NATIONAL DRUG CLASS [6P:50.605]
"RTN","PSODRG",94,0)
 S PSODRUG("CLN")=+$$GET1^DIQ(50,+PSOY,25,"I")  ; zero if field is null
"RTN","PSODRG",95,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5)
"RTN","PSODRG",96,0)
 I $G(PSODRUG("NDC"))="" S PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE))
"RTN","PSODRG",97,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSOY,81)
"RTN","PSODRG",98,0)
 S PSODRUG("STKLVL")=$$GET1^DIQ(50,+PSOY,50)
"RTN","PSODRG",99,0)
 G:'$$GET1^DIQ(50,+PSOY,11) SETX
"RTN","PSODRG",100,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660))
"RTN","PSODRG",101,0)
 S PSODRUG("COST")=$$GET1^DIQ(50,+PSOY,15)
"RTN","PSODRG",102,0)
 S PSODRUG("UNIT")=$$GET1^DIQ(50,+PSOY,14.5)
"RTN","PSODRG",103,0)
 S PSODRUG("EXPIRATION DATE")=$$GET1^DIQ(50,+PSOY,17.1,"I")
"RTN","PSODRG",104,0)
SETX K PSOX1,PSOY
"RTN","PSODRG",105,0)
 Q
"RTN","PSODRG",106,0)
NFI ;display restriction/guidelines
"RTN","PSODRG",107,0)
 D EN^PSSDIN(PSODRUG("OI"),PSODRUG("IEN")) S NFI=$$PROMPT^PSSDIN
"RTN","PSODRG",108,0)
 I NFI]"","ODY"[NFI D TD^PSONFI
"RTN","PSODRG",109,0)
 K NFI Q
"RTN","PSODRG",110,0)
POST ;order checks
"RTN","PSODRG",111,0)
 N LIST S LIST="PSOPEPS"
"RTN","PSODRG",112,0)
 K PSODOSD,^TMP("PSORXDC",$J),^TMP($J,LIST),^TMP("PSODAOC",$J)
"RTN","PSODRG",113,0)
 K ZDGDG,ZTHER,IT,PSODLQT,PSODOSD
"RTN","PSODRG",114,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S ^TMP("PSODAOC",$J,"NORDI",1,0)="Remote data not available - Only local order checks processed."
"RTN","PSODRG",115,0)
 S ^TMP($J,LIST,"IN","PING")="" D IN^PSSHRQ2(LIST)
"RTN","PSODRG",116,0)
 K DIR I $P(^TMP($J,LIST,"OUT",0),"^")=-1 D
"RTN","PSODRG",117,0)
 .D DATACK^PSODDPRE
"RTN","PSODRG",118,0)
 .S ^TMP("PSODAOC",$J,"NOSYS",1,0)="No Enhanced Order Checks can be performed. Reason(s): "_$P($G(^TMP($J,LIST,"OUT",0)),"^",2)
"RTN","PSODRG",119,0)
 K ^TMP($J,LIST,"IN"),^TMP($J,LIST,"OUT","EXCEPTIONS")
"RTN","PSODRG",120,0)
 G:$G(PSORX("DFLG"))!($G(PSORXED("DFLG"))) POSTX
"RTN","PSODRG",121,0)
 K PSORX("INTERVENE"),PSOQUIT N STAT,SIG,PTR,NDF,VAP S PSORX("DFLG")=0
"RTN","PSODRG",122,0)
 W !! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",123,0)
 D ^PSOBUILD
"RTN","PSODRG",124,0)
 D:'$D(PSODGCK) @$S($G(COPY):"^PSOCPPRE",1:"^PSODDPRE") ; Duplicate drug check
"RTN","PSODRG",125,0)
 G:$G(PSORX("DFLG")) POSTX
"RTN","PSODRG",126,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",127,0)
 I $$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5)="PSOCLO1" D CLOZ
"RTN","PSODRG",128,0)
 G:PSORX("DFLG") POSTX
"RTN","PSODRG",129,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",130,0)
 W !,"Now doing allergy checks.  Please wait...",! H 1
"RTN","PSODRG",131,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D:PSONOAL'="" NOALRGY K PSONOAL
"RTN","PSODRG",132,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",133,0)
 I '$G(PSODGCKX) D ^PSODGAL1 K PSORX("INTERVENE")
"RTN","PSODRG",134,0)
 G:PSORX("DFLG")!$G(PSOQUIT) POSTX
"RTN","PSODRG",135,0)
 ;This is the allergy check for profile drugs CK action
"RTN","PSODRG",136,0)
 I $D(PSODGCK),$D(PSOSD) D PRFLP^PSOUTL
"RTN","PSODRG",137,0)
 G:$G(PSORX("DFLG")) POSTX ;pso*7*412
"RTN","PSODRG",138,0)
 G:$G(PSOSPRNW)&($G(PSORENW("DFLG"))) POSTX ;speed renew
"RTN","PSODRG",139,0)
 ;aminoglycoside
"RTN","PSODRG",140,0)
 N AOC,CROCPFLG S CROCPFLG=0
"RTN","PSODRG",141,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",142,0)
 S AOC=$$AOC^OROCAPI(PSODFN,$P(PSODRUG("NDF"),"A",2)) I $P(AOC,"^",4)]"" D
"RTN","PSODRG",143,0)
 .S CROCPFLG=1
"RTN","PSODRG",144,0)
 .W !!,"***Aminoglycoside Ordered***",!!
"RTN","PSODRG",145,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(AOC,"^",4) D ^DIWP
"RTN","PSODRG",146,0)
 .W ! F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",147,0)
 .K ^UTILITY($J,"W")
"RTN","PSODRG",148,0)
 .S ^TMP("PSODAOC",$J,"CPRS",$P(AOC,"^",2),0)=PSODRUG("IEN")_"^"_$P(AOC,"^",4)
"RTN","PSODRG",149,0)
 .W !
"RTN","PSODRG",150,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",151,0)
 ;dangerous meds for pat >64
"RTN","PSODRG",152,0)
 I $G(PSODRUG("OI")) D
"RTN","PSODRG",153,0)
 .N OI,OIR S OI=$$OITM^ORX8(PSODRUG("OI"),"99PSP") Q:'OI
"RTN","PSODRG",154,0)
 .S OIR=$$DOC^OROCAPI(PSODFN,OI) I $P(OIR,"^",4)]"" D
"RTN","PSODRG",155,0)
 ..S CROCPFLG=1
"RTN","PSODRG",156,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) W !!,"***Dangerous Meds for Patient >64***",!! S DFN=PSODFN D DEM^VADPT
"RTN","PSODRG",157,0)
 ..K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(OIR,"^",4) D ^DIWP
"RTN","PSODRG",158,0)
 ..F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",159,0)
 ..K ^UTILITY($J,"W")
"RTN","PSODRG",160,0)
 ..S ^TMP("PSODAOC",$J,"CPRS",$P(OIR,"^",2),0)=PSODRUG("IEN")_"^"_$P(OIR,"^",4)
"RTN","PSODRG",161,0)
 ..W !
"RTN","PSODRG",162,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",163,0)
 ;metformin lab results
"RTN","PSODRG",164,0)
 N GOC S GOC=$$GOC^OROCAPI(PSODFN,PSODRUG("NAME")) I $P(GOC,"^",4)]"" D
"RTN","PSODRG",165,0)
 .S CROCPFLG=1
"RTN","PSODRG",166,0)
 .W !!,"***Metformin Lab Results***",!!
"RTN","PSODRG",167,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(GOC,"^",4) D ^DIWP
"RTN","PSODRG",168,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",169,0)
 .K ^UTILITY($J,"W")
"RTN","PSODRG",170,0)
 .S ^TMP("PSODAOC",$J,"CPRS",$P(GOC,"^",2),0)=PSODRUG("IEN")_"^"_$P(GOC,"^",4)
"RTN","PSODRG",171,0)
 .W !
"RTN","PSODRG",172,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",173,0)
 ;clinical reminder oc
"RTN","PSODRG",174,0)
 D:'$G(PSONCROC) CK^PSOCROC K CROCPFLG I $G(PSORX("DFLG")) Q
"RTN","PSODRG",175,0)
 K DIWF,DIWL,DIWR,ZX,DFN,CROCPFLG
"RTN","PSODRG",176,0)
 I $G(PSODRUG("DEA"))["S"!($E($G(PSODRUG("VA CLASS")),1,2)="XA"),'$G(PSODGCK) D  G POSTX ;stops if drug is supply
"RTN","PSODRG",177,0)
 .W !,"Now Processing Enhanced Order Checks!  Please wait...",! H 1
"RTN","PSODRG",178,0)
 ;enhanced OC
"RTN","PSODRG",179,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",180,0)
 W ! D @$S($G(COPY):"OBX^PSOCPPRE",1:"OBX^PSODDPRE") ; Set PSORX("DFLG")=1 if process to stop new enhanced order checks
"RTN","PSODRG",181,0)
POSTX ;
"RTN","PSODRG",182,0)
 K IT,^TMP($J,"DI"),PSORX("INTERVENE"),DA,^TMP($J,"PSODRDI"),ZDGDG,ZTHER,^TMP($J,"DI"_PSODFN),PSZZQUIT
"RTN","PSODRG",183,0)
 I '$G(PSORXED),'$G(PSOREINS) K PSOQUIT
"RTN","PSODRG",184,0)
 Q
"RTN","PSODRG",185,0)
 ;
"RTN","PSODRG",186,0)
EOJ ;
"RTN","PSODRG",187,0)
 K PSODRG
"RTN","PSODRG",188,0)
 Q
"RTN","PSODRG",189,0)
WAIT ;
"RTN","PSODRG",190,0)
 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue..." W !
"RTN","PSODRG",191,0)
 D ^DIR K DIRUT,DUOUT,DIR,X,Y
"RTN","PSODRG",192,0)
 Q
"RTN","PSODRG",193,0)
 ;
"RTN","PSODRG",194,0)
CLOZ ;
"RTN","PSODRG",195,0)
 S ANQRTN=$$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5),ANQX=0
"RTN","PSODRG",196,0)
 S P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSODRG",197,0)
 X ^%ZOSF("TEST") I  D ^PSOCLO1 S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSODRG",198,0)
 K P(5),ANQRTN,ANQX,X,DFN
"RTN","PSODRG",199,0)
 Q
"RTN","PSODRG",200,0)
 ;
"RTN","PSODRG",201,0)
EN(DRG) ;returns lab test identified for clozapine order checking
"RTN","PSODRG",202,0)
 K LAB I $$GET1^DIQ(50,+$G(DRG),17.5)'="PSOCLO1" S LAB("NOT")=0 Q
"RTN","PSODRG",203,0)
 N LABARR D LIST^DIC(50.02,","_DRG_",","2;3","I",,,,,,,"LABARR")
"RTN","PSODRG",204,0)
 I +LABARR("DILIST",0)'=2 S LAB("BAD TEST")=0 K CNT Q
"RTN","PSODRG",205,0)
 K CNT F I=1:1 Q:'$D(LABARR("DILIST",2,I))  D
"RTN","PSODRG",206,0)
 .S LABT=$S(LABARR("DILIST","ID",I,3)=1:"WBC",1:"ANC")
"RTN","PSODRG",207,0)
 .S LAB(LABT)=LABARR("DILIST",1,I)_"^"_LABARR("DILIST","ID",I,2)_"^"_LABARR("DILIST","ID",I,3)
"RTN","PSODRG",208,0)
 K LABT,I
"RTN","PSODRG",209,0)
 Q
"RTN","PSODRG",210,0)
NOALRGY ;
"RTN","PSODRG",211,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",212,0)
 N DIR S DIR(0)="SA^1:YES;0:NO"
"RTN","PSODRG",213,0)
 I $D(^TMP($J,"PSOINTERVENE",+PSODFN)) D  Q
"RTN","PSODRG",214,0)
 .S DIR("A")="No Allergy Assessment - Do you want to duplicate Intervention?: ",DIR("B")="Yes"
"RTN","PSODRG",215,0)
 .D ^DIR
"RTN","PSODRG",216,0)
 .I 'Y D  Q
"RTN","PSODRG",217,0)
 ..I Y=0 D ^PSORXI Q
"RTN","PSODRG",218,0)
 ..S PSORX("DFLG")=1
"RTN","PSODRG",219,0)
 .D DUPINV^PSORXI
"RTN","PSODRG",220,0)
 W $C(7),!,"There is no allergy assessment on file for this patient."
"RTN","PSODRG",221,0)
 W !,"You will be prompted to intervene if you continue with this prescription"
"RTN","PSODRG",222,0)
 I $D(PSODGCK) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR
"RTN","PSODRG",223,0)
 Q:$D(PSODGCK)
"RTN","PSODRG",224,0)
 N DUOUT,DTOUT,RXIEN,RXSTA               ;*398
"RTN","PSODRG",225,0)
 S DIR("A")="Do you want to Continue?: ",DIR("B")="N" D ^DIR
"RTN","PSODRG",226,0)
 I 'Y!($D(DUOUT))!($D(DTOUT)) D  Q       ;*398 - Exit/Timeout
"RTN","PSODRG",227,0)
 .I $D(PSONV) S PSZZQUIT=1 Q
"RTN","PSODRG",228,0)
 .S PSORX("DFLG")=1
"RTN","PSODRG",229,0)
 .I '$O(PSCAN(0)) Q                      ;*398 - Array has Rx IEN
"RTN","PSODRG",230,0)
 .I $G(REA)'="R" Q                       ;*398 - Reinstate only
"RTN","PSODRG",231,0)
 .S RXIEN=+$G(PSCAN(RX)) I 'RXIEN Q      ;*398 - Get Rx IEN
"RTN","PSODRG",232,0)
 .S RXSTA=$$GET1^DIQ(52,RXIEN,100,"I")   ;*398 - Get status
"RTN","PSODRG",233,0)
 .I RXSTA=12 Q                           ;*398 - Correct status
"RTN","PSODRG",234,0)
 .S DIE="^PSRX(",DA=RXIEN,DR="100///12"  ;*398 - Discontinued
"RTN","PSODRG",235,0)
 .D ^DIE                                 ;*398 - Update Rx file
"RTN","PSODRG",236,0)
 I $D(PSONV) S PSORX("INTERVENE")=0 D EN1^PSORXI(PSONV) Q
"RTN","PSODRG",237,0)
 D ^PSORXI
"RTN","PSODRG",238,0)
 Q
"RTN","PSON52")
0^3^B118986186
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;Jul 24, 2017@15:24
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219,148,239,201,268,260,225,303,358,251,387,379,390,391,313,408,473,504,505,517,457**;DEC 1997;Build 116
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
 ;External reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSON52",7,0)
 ;External reference SAVNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSON52",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSON52",9,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",10,0)
START ;
"RTN","PSON52",11,0)
 ;
"RTN","PSON52",12,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))
"RTN","PSON52",13,0)
 D PS55,DIK
"RTN","PSON52",14,0)
 ;
"RTN","PSON52",15,0)
 D FINISH
"RTN","PSON52",16,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",17,0)
END D EOJ
"RTN","PSON52",18,0)
 Q
"RTN","PSON52",19,0)
INIT ;
"RTN","PSON52",20,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",21,0)
 S PSOX("CS")=0 K PSOX("NOPSDRPH")
"RTN","PSON52",22,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",23,0)
 I $P($G(PSOX("CS")),"^"),'$D(^XUSEC("PSDRPH",DUZ)) S PSOX("NOPSDRPH")=1
"RTN","PSON52",24,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",25,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",26,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",27,0)
 I X2<30 D
"RTN","PSON52",28,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",29,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",30,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",31,0)
 ;*473 - If Calculated Exp. Date < Fill Date with No refills, reset Exp.
"RTN","PSON52",32,0)
 I '$D(CLOZPAT),'PSOX("# OF REFILLS"),PSOX("FILL DATE")>PSOX("STOP DATE") D
"RTN","PSON52",33,0)
 . N EXP S EXP=$$FMADD^XLFDT(PSOX("FILL DATE"),PSOX("DAYS SUPPLY"))
"RTN","PSON52",34,0)
 . I $$FMDIFF^XLFDT(EXP,PSOX("ISSUE DATE"))>$S(+$G(PSOX("CS")):184,1:366) D
"RTN","PSON52",35,0)
 . . S EXP=$$FMADD^XLFDT(PSOX("ISSUE DATE"),$S(+$G(PSOX("CS")):184,1:366))
"RTN","PSON52",36,0)
 . I EXP<PSOX("FILL DATE") S EXP=PSOX("FILL DATE")
"RTN","PSON52",37,0)
 . S PSOX("STOP DATE")=EXP
"RTN","PSON52",38,0)
 ; Titration to Maintenance Rx Conversion - Set Maint. Rx Exp. Date = Original Rx Exp. Date
"RTN","PSON52",39,0)
 I $G(PSOTITRX) D
"RTN","PSON52",40,0)
 . S PSOX("STOP DATE")=$$GET1^DIQ(52,PSOTITRX,26,"I")
"RTN","PSON52",41,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",42,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",43,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,$D(PSOX("NOPSDRPH")):1,1:0)
"RTN","PSON52",44,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",45,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",46,0)
INITX    Q
"RTN","PSON52",47,0)
 ;
"RTN","PSON52",48,0)
NFILE    I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",49,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",50,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",51,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO
"RTN","PSON52",52,0)
 I '$D(^XUSEC("PSORPH",DUZ))!($D(PSOX("NOPSDRPH"))),$$DS^PSSDSAPI&(+$G(^TMP("PSODOSF",$J,0))) S PSON52(PSOX("IRXN"),"STA")=1,PSOX("STATUS")=1
"RTN","PSON52",53,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",54,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",55,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",56,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",57,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",58,0)
 K PSOX1,PSOY
"RTN","PSON52",59,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",60,0)
 ; PSO*7*505 - quantity check - leading zeroes
"RTN","PSON52",61,0)
 N QTYTMP
"RTN","PSON52",62,0)
 S QTYTMP=$P(^PSRX(PSOX("IRXN"),0),U,7)
"RTN","PSON52",63,0)
 I QTYTMP["." D
"RTN","PSON52",64,0)
 .Q:$P(QTYTMP,".")'=""
"RTN","PSON52",65,0)
 .;Q:$P(QTYTMP,".")=0
"RTN","PSON52",66,0)
 .S $P(^PSRX(PSOX("IRXN"),0),U,7)=0_QTYTMP
"RTN","PSON52",67,0)
 ; PSO*7*505 - end quantity check - leading zeroes
"RTN","PSON52",68,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",69,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",70,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",71,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",72,0)
 I $G(SIGOK) D
"RTN","PSON52",73,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",74,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",75,0)
 .K SIG
"RTN","PSON52",76,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",77,0)
 I $G(OR0),$P(OR0,"^",24) S ^PSRX(PSOX("IRXN"),"PKI")=$S($G(PSOSIGFL):"^1",1:1) D ACLOG
"RTN","PSON52",78,0)
 I $P($G(PSOX("CS")),"^"),'+$P($G(^PSRX(PSOX("IRXN"),"PKI")),"^") S $P(^PSRX(PSOX("IRXN"),"PKI"),"^",2)=1
"RTN","PSON52",79,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",80,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",81,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",82,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",83,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",84,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",85,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",86,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",87,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",88,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",89,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",90,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",91,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))_"^"_$G(PSOANSQ("SHAD"))
"RTN","PSON52",92,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1) D
"RTN","PSON52",93,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",94,0)
 D ICD^PSODIAG
"RTN","PSON52",95,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSON52",96,0)
 D:$G(PSOTITRX) SAVETIT(PSOTITRX,PSOX("IRXN"))
"RTN","PSON52",97,0)
 K PSOTITRX,PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",98,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",99,0)
 Q
"RTN","PSON52",100,0)
 ;
"RTN","PSON52",101,0)
ACLOG    ;activity log (digitally signed CS orders)
"RTN","PSON52",102,0)
 N DTTM,CNT,OCNT,XX
"RTN","PSON52",103,0)
 D NOW^%DTC S DTTM=%
"RTN","PSON52",104,0)
 S CNT=0 F XX=0:0 S XX=$O(^PSRX(PSOX("IRXN"),"A",XX)) Q:'XX  S CNT=XX
"RTN","PSON52",105,0)
 S OCNT=CNT
"RTN","PSON52",106,0)
 I $G(PSOCSP("NAME"))'=PSODRUG("NAME") S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^NAME: "_PSOCSP("NAME")
"RTN","PSON52",107,0)
 S XX=0 F  S XX=$O(PSOCSP("DOSE",XX)) Q:'XX  I PSOCSP("DOSE",XX)'=$G(PSONEW("DOSE",XX)) D
"RTN","PSON52",108,0)
 .S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^DOSAGE: "_PSOCSP("DOSE",XX)
"RTN","PSON52",109,0)
 S XX=0 F  S XX=$O(PSOCSP("DOSE ORDERED",XX)) Q:'XX  I PSOCSP("DOSE ORDERED",XX)'=$G(PSONEW("DOSE ORDERED",XX)) D
"RTN","PSON52",110,0)
 .S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^DISPENSE UNITS: "_PSOCSP("DOSE ORDERED",XX)
"RTN","PSON52",111,0)
 I PSOCSP("ISSUE DATE")'=PSONEW("ISSUE DATE") S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^ISSUE DATE: "_$$FMTE^XLFDT(PSOCSP("ISSUE DATE"))
"RTN","PSON52",112,0)
 I PSOCSP("DAYS SUPPLY")'=PSONEW("DAYS SUPPLY") S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^DAYS SUPPLY: "_PSOCSP("DAYS SUPPLY")
"RTN","PSON52",113,0)
 I PSOCSP("QTY")'=PSONEW("QTY") S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^QTY: "_PSOCSP("QTY")
"RTN","PSON52",114,0)
 I PSOCSP("# OF REFILLS")'=PSONEW("# OF REFILLS") S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^# OF REFILLS: "_PSOCSP("# OF REFILLS")
"RTN","PSON52",115,0)
 I '$$SUBSCRIB^ORDEA($P(OR0,"^"),PSOX("IRXN")) S CNT=CNT+1,^PSRX(PSOX("IRXN"),"A",CNT,0)=DTTM_"^K^"_DUZ_"^0^ORDER DEA ARCHIVE INFO file entry failure"
"RTN","PSON52",116,0)
 I OCNT'=CNT S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^"_CNT_"^"_CNT
"RTN","PSON52",117,0)
 Q
"RTN","PSON52",118,0)
 ;
"RTN","PSON52",119,0)
PS55     ;
"RTN","PSON52",120,0)
 L +^PS(55,PSODFN,"P"):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSON52",121,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",122,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",123,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",124,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",125,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",126,0)
PS55X    L -^PS(55,PSODFN,"P")
"RTN","PSON52",127,0)
 K PSOX1
"RTN","PSON52",128,0)
 Q
"RTN","PSON52",129,0)
DIK ;
"RTN","PSON52",130,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",131,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",132,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",133,0)
 Q
"RTN","PSON52",134,0)
FINISH ;
"RTN","PSON52",135,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC H 1 G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",136,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",137,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K X,Y,%,ANQREM
"RTN","PSON52",138,0)
 ;PSO 457 Added H 1 to line tag ANQ
"RTN","PSON52",139,0)
 ; ** START NCC REMEDIATION ** 457/RTW RJS
"RTN","PSON52",140,0)
 I $D(ANQDATA) D  ;ADD ADDITIONAL LOGIC FOR ORDERING PROVIDER RJS/457
"RTN","PSON52",141,0)
 .I $P($G(ANQDATA),"^",2)["UNKNOWN",$D(PSOX("PROVIDER")) S $P(ANQDATA,"^",2)=PSOX("PROVIDER")
"RTN","PSON52",142,0)
 .I $D(PSOX("PROVIDER")),$P($G(ANQDATA),"^",2)'=PSOX("PROVIDER") S $P(ANQDATA,"^",2)=PSOX("PROVIDER")
"RTN","PSON52",143,0)
 I $G(ANQDATA)]"" N PSOUSER,PSO1PH,PSO2PH,PSOREASN,PSOREMRK,DTM D NOW^%DTC S DTM=% G:$$FIND1^DIC(52.52,,"X",DTM) ANQ D
"RTN","PSON52",144,0)
 .S PSOUSER=$P(ANQDATA,"^",2),PSO1PH=$P(ANQDATA,"^"),PSO2PH=$P(ANQDATA,"^",5)
"RTN","PSON52",145,0)
 .S PSOREASN=$P(ANQDATA,"^",3),PSOREMRK=$P(ANQDATA,"^",4)
"RTN","PSON52",146,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=DTM
"RTN","PSON52",147,0)
 .D FILE^DICN K DIC,DLAYGO,DD,DO,DA,DR
"RTN","PSON52",148,0)
 .N PS52 S (PS52,DA)=+Y,DIE="^PS(52.52,",DR="1////^S X=PSOX(""IRXN"")"_";2////^S X=PSO1PH;3////^S X=PSOUSER;4////^S X=PSOREASN;5////^S X=PSOREMRK;6////^S X=PSO2PH"
"RTN","PSON52",149,0)
 .D ^DIE K DIE,DA,DR
"RTN","PSON52",150,0)
 .K X,Y,%,ANQREM
"RTN","PSON52",151,0)
 .D ALERT^PSORENW0
"RTN","PSON52",152,0)
 I $$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5)="PSOCLO1" D ^YSCLTST6
"RTN","PSON52",153,0)
 ;/RBN END MODIFICATIONS FOR PSO*7.0*457
"RTN","PSON52",154,0)
 ;
"RTN","PSON52",155,0)
 N PSOTFIN
"RTN","PSON52",156,0)
 I $D(PSOX("NOPSDRPH"))!('$D(^XUSEC("PSORPH",DUZ))) S PSOTFIN="",PSOTFIN=$$TECH2^PSODGDGP(PSOX("IRXN"),PSODFN,DUZ,.PSOX)
"RTN","PSON52",157,0)
 I $D(PSOX("NOPSDRPH"))!('$D(^XUSEC("PSORPH",DUZ))) G FINISHP:$G(PSOTFIN)=1 G FINISHX:$G(PSOTFIN)=2
"RTN","PSON52",158,0)
 ;
"RTN","PSON52",159,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",160,0)
 ;
"RTN","PSON52",161,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSON52",162,0)
 N ACTION,PSOERX
"RTN","PSON52",163,0)
 S PSOERX=PSOX("IRXN")
"RTN","PSON52",164,0)
 I $$SUBMIT^PSOBPSUT(PSOERX,0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSON52",165,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOERX,0,"","OF")
"RTN","PSON52",166,0)
 . ; Quit if there is an unresolved Tricare/CHAMPVA non-billable reject code, PSO*7*358
"RTN","PSON52",167,0)
 . I $$PSOET^PSOREJP3(PSOERX,0) S ACTION="Q" Q
"RTN","PSON52",168,0)
 . I $$FIND^PSOREJUT(PSOERX,0) D
"RTN","PSON52",169,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOERX,0,"79,88","OF","IOQ","Q")
"RTN","PSON52",170,0)
 . I $$STATUS^PSOBPSUT(PSOERX,0)="E PAYABLE" D
"RTN","PSON52",171,0)
 . . D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,PSOERX,6,"I"),$G(PSOSITE),$$GETNDC^PSONDCUT(PSOERX,0))
"RTN","PSON52",172,0)
 ;
"RTN","PSON52",173,0)
FINISHP  ;
"RTN","PSON52",174,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",175,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",176,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",177,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",178,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",179,0)
FINISHX  ;call to build Rx array for bingo board
"RTN","PSON52",180,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",181,0)
 K PSOX1,PSOX2
"RTN","PSON52",182,0)
 K ^TMP("PSODGI",$J),^TMP("PSOSER",$J),^TMP("PSOSERS",$J),^TMP("PSODGS",$J),^TMP("PSOTDD",$J),^TMP("PSODOSF",$J)
"RTN","PSON52",183,0)
 Q
"RTN","PSON52",184,0)
 ;
"RTN","PSON52",185,0)
SAVETIT(TITRX,MNTRX) ; Save Titration/Maintenance dose Rx information
"RTN","PSON52",186,0)
 I '$D(^PSRX(+$G(TITRX),0))!'$D(^PSRX(+$G(MNTRX),0)) Q
"RTN","PSON52",187,0)
 S $P(^PSRX(TITRX,"TIT"),"^",2,3)=MNTRX_"^1"
"RTN","PSON52",188,0)
 D RXACT^PSOBPSU2(TITRX,0,"Maintenance Rx#: "_$$GET1^DIQ(52,MNTRX,.01),"E")
"RTN","PSON52",189,0)
 S $P(^PSRX(MNTRX,"TIT"),"^",1)=TITRX
"RTN","PSON52",190,0)
 D RXACT^PSOBPSU2(MNTRX,0,"Titration Rx#: "_$$GET1^DIQ(52,TITRX,.01),"E")
"RTN","PSON52",191,0)
 Q
"RTN","PSON52",192,0)
 ;
"RTN","PSON52",193,0)
EOJ ;
"RTN","PSON52",194,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",195,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",196,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",197,0)
 Q
"RTN","PSON52",198,0)
 ;
"RTN","PSON52",199,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",200,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",201,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",202,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",203,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",204,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",205,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",206,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",207,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",208,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",209,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",210,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",211,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",212,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",213,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",214,0)
 ;;PSOX("ADMINCLINIC");;0;;15 
"RTN","PSON52",215,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",216,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",217,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",218,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",219,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",220,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",221,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",222,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",223,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",224,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",225,0)
 ;;PSODRUG("DAW");;EPH;;1
"RTN","PSON52",226,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",227,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",228,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",229,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",230,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",231,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",232,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",233,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",234,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",235,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",236,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",237,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",238,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONEW")
0^12^B38956670
"RTN","PSONEW",1,0)
PSONEW ;BIR/SAB - new rx order main driver ;Jul 24, 2017@15:24
"RTN","PSONEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,46,94,130,268,225,251,379,390,417,313,411,457**;DEC 1997;Build 116
"RTN","PSONEW",3,0)
 ;External reference to UL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW",4,0)
 ;External reference to $$L^PSSLOCK supported by DBIA 2789
"RTN","PSONEW",5,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSONEW",6,0)
 ;External reference to ^XUSEC( supported by DBIA 10076
"RTN","PSONEW",7,0)
 ;External reference to ^ORX1 supported by DBIA 2186
"RTN","PSONEW",8,0)
 ;External reference to ^ORX2 supported by DBIA 867
"RTN","PSONEW",9,0)
 ;External reference to ^TIUEDIT supported by DBIA 2410
"RTN","PSONEW",10,0)
 ;External reference to ^DD("DILOCKTM" supported by DBIA 999
"RTN","PSONEW",11,0)
 ;---------------------------------------------------------------
"RTN","PSONEW",12,0)
OERR ;backdoor new rx for v7
"RTN","PSONEW",13,0)
 K PSOREEDT,COPY,SPEED,PSOEDIT,DUR,DRET,PSOTITRX,PSOMTFLG N PSOCKCON,PSODAOC
"RTN","PSONEW",14,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSONEW",15,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSONEW",16,0)
AGAIN N VALMCNT K PSODRUG,PSOCOU,PSOCOUU,PSONOOR,PSORX("FN"),PSORX("DFLG"),PSOQUIT,POERR S PSORX("DFLG")=0
"RTN","PSONEW",17,0)
 W ! D HLDHDR^PSOLMUTL S (PSONEW("QFLG"),PSONEW("DFLG"),PSOQUIT)=0,PSOFROM="NEW",PSONOEDT=1
"RTN","PSONEW",18,0)
 K ORD D FULL^VALM1,^PSONEW1 ; Continue order entry
"RTN","PSONEW",19,0)
 I PSONEW("QFLG") G END
"RTN","PSONEW",20,0)
 I PSONEW("DFLG") W !,$C(7),"RX DELETED",! S:$G(POERR) POERR("DFLG")=1,VALMBCK="Q" G END
"RTN","PSONEW",21,0)
 D:$P($G(PSOPAR),"^",7)=1 AUTO^PSONRXN I $P($G(PSOPAR),"^",7)'=1 S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSONEW",22,0)
 I PSONEW("DFLG")!PSONEW("QFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END
"RTN","PSONEW",23,0)
 D NOOR I PSONEW("DFLG") D DEL G END
"RTN","PSONEW",24,0)
 D ^PSONEW2 I PSONEW("DFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END ; Asks if correct
"RTN","PSONEW",25,0)
 G:$G(PSORX("FN")) END
"RTN","PSONEW",26,0)
 D EN^PSON52(.PSONEW) ; Files entry in File 52
"RTN","PSONEW",27,0)
 D NPSOSD^PSOUTIL(.PSONEW) ; Adds newly added rx to PSOSD array
"RTN","PSONEW",28,0)
 S VALMBCK="R"
"RTN","PSONEW",29,0)
 ;
"RTN","PSONEW",30,0)
 ; - Possible Titration prescription
"RTN","PSONEW",31,0)
 I $G(PSONEW("IRXN")) D MARK^PSOOTMRX(PSONEW("IRXN"),0)
"RTN","PSONEW",32,0)
 ;
"RTN","PSONEW",33,0)
END D EOJ ; Clean up          
"RTN","PSONEW",34,0)
 I '$G(PSORX("FN")) W ! K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Another New Order for "_PSORX("NAME") D ^DIR K DIR,DIRUT,DUOUT,DTOUT I Y K PSONEW,PSDRUG,ORD G AGAIN
"RTN","PSONEW",35,0)
 D ^PSOBUILD,BLD^PSOORUT1 S X=PSODFN_";DPT(" D ULK^ORX2 D UL^PSSLOCK(PSODFN)
"RTN","PSONEW",36,0)
 D RV^PSOORFL
"RTN","PSONEW",37,0)
 S VALMBCK="R" K PSORX("FN") Q
"RTN","PSONEW",38,0)
 ;----------------------------------------------------------------
"RTN","PSONEW",39,0)
DEL ;
"RTN","PSONEW",40,0)
 W !,$C(7),"RX DELETED",!
"RTN","PSONEW",41,0)
 I $P($G(PSOPAR),"^",7)=1 D
"RTN","PSONEW",42,0)
 . S DIE="^PS(59,",DA=PSOSITE,PSOY=$O(PSONEW("OLD LAST RX#",""))
"RTN","PSONEW",43,0)
 . S PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSONEW",44,0)
 . L +^PS(59,+PSOSITE,PSOY):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSONEW",45,0)
 . S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSONEW",46,0)
 . D:PSOX<$$GET1^DIQ(59,+PSOSITE,+DR,"I") ^DIE K DIE,X,Y
"RTN","PSONEW",47,0)
 . L -^PS(59,+PSOSITE,PSOY)
"RTN","PSONEW",48,0)
 . K PSOX,PSOY Q
"RTN","PSONEW",49,0)
EOJ ;
"RTN","PSONEW",50,0)
 I $D(PSONEW("RX #")) L -^PSRX("B",PSONEW("RX #")) ; +Lock set in PSONRXN
"RTN","PSONEW",51,0)
 K PSONOEDT,PSONEW,PSODRUG,ANQDATA,LSI,C,MAX,MIN,NDF,REF,SIG,SER,PSOFLAG,PSOHI,PSOLO,PSONOOR,PSOCOUU,PSOCOU,PSORX("EDIT"),ZNEW
"RTN","PSONEW",52,0)
 D CLEAN^PSOVER1
"RTN","PSONEW",53,0)
 K ^TMP("PSORXDC",$J),RORD,ACOM,ACNT,CRIT,DEF,F1,GG,I1,IEN,INDT,LAST,MSG,NIEN,STA,DUR,DRET,PSOPRC
"RTN","PSONEW",54,0)
 S (ZRXN,RXN)=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSONEW",55,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSONEW",56,0)
 .I $$GET1^DIQ(52,RXN,100,"I")=5 D EN^PSOHLSN1(RXN,"SC","ZS","")
"RTN","PSONEW",57,0)
 .;; START NCC REMEDIATION >> 457*MZR
"RTN","PSONEW",58,0)
 .N PSOCLOZO S PSOCLOZO=($$GET1^DIQ(50,+$$GET1^DIQ(52,RXN,6,"I"),17.5)="PSOCLO1")  ; Clozapine order
"RTN","PSONEW",59,0)
 .I PSOCLOZO,$G(PSOLOGDT) N ORN S ORN=$$GET1^DIQ(52,RXN,39.3,"I") I ORN D  ;/MZR populate ^XTMP entry with order #
"RTN","PSONEW",60,0)
 ..I $P($G(^XTMP("YSCLTRN",DT,DFN,PSOLOGDT,0)),"^",3)=RXN D ORDSET^YSCLTST6(ORN)
"RTN","PSONEW",61,0)
 .;; END NCC REMEDIATION >> 457*457
"RTN","PSONEW",62,0)
 .;saves drug allergy order chks pso*7*390
"RTN","PSONEW",63,0)
 .I $D(^TMP("PSODAOC",$J)) D
"RTN","PSONEW",64,0)
 ..S RXN=ZRXN,PSODAOC="Rx Backdoor "_$S($$GET1^DIQ(52,RXN,100,"I")=4:"NON-VERIFIED ",1:"")_"NEW Order Acceptance_OP",ZNEW=1
"RTN","PSONEW",65,0)
 .D DAOC
"RTN","PSONEW",66,0)
 K ZRXN,RXN,RXN1,^TMP("PSORXN",$J),^TMP("PSODAOC",$J),RET,PSODAOC,ZNEW
"RTN","PSONEW",67,0)
 I $G(PSONOTE) D FULL^VALM1,MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1)
"RTN","PSONEW",68,0)
 K PSONOTE,PSOCKCON,ZZCOPY
"RTN","PSONEW",69,0)
 ;W !! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSONEW",70,0)
 Q
"RTN","PSONEW",71,0)
NOOR ;asks nature of order
"RTN","PSONEW",72,0)
 N PSONOODF
"RTN","PSONEW",73,0)
 S PSONOODF=0
"RTN","PSONEW",74,0)
 ;; START NCC REMEDIATION >> 457*MZR
"RTN","PSONEW",75,0)
 ;/MZR Added a next line because otherwise data gets lost
"RTN","PSONEW",76,0)
 I $$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5)="PSOCLO1",'$D(PSONEW("SAND")),$G(PSOSAND) S PSONEW("SAND")=PSOSAND K PSOSAND
"RTN","PSONEW",77,0)
 ;; EMD NCC REMEDIATION >> 457*MZR
"RTN","PSONEW",78,0)
 I $G(OR0) D  G NOORX ;front door
"RTN","PSONEW",79,0)
 .S PSOI=$S($G(PSOSIGFL):1,$G(PSODRUG("OI"))'=$P(OR0,"^",8):1,1:0)
"RTN","PSONEW",80,0)
 .I 'PSOI S PSONOOR="" D:$$FIND1^DIC(200.051,","_DUZ_",","X","PSORPH") COUN Q  ;NoO $P(OR0,"^",7)
"RTN","PSONEW",81,0)
 .S PSONOODF=1
"RTN","PSONEW",82,0)
 .D DIR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",83,0)
 .S PSONOOR=Y D:$$FIND1^DIC(200.051,","_DUZ_",","X","PSORPH") COUN K DIR,DTOUT,DTOUT,DIRUT
"RTN","PSONEW",84,0)
 ;backdoor order
"RTN","PSONEW",85,0)
 D DIR I $D(DIRUT) S PSONEW("DFLG")=1,VALMBCK="Q" Q
"RTN","PSONEW",86,0)
 S PSONOOR=Y K DIK,DA,DIE,DR,PSOI,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",87,0)
 G:'$D(^XUSEC("PSORPH",DUZ)) NOORX
"RTN","PSONEW",88,0)
COUN ;patient counseling
"RTN","PSONEW",89,0)
 G:$G(PSORX("EDIT"))&('$G(PSOSIGFL)) NOORX K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",90,0)
 S DIR("B")="NO",DIR(0)="52,41" D ^DIR S PSOCOU=$S(Y:Y,1:0)
"RTN","PSONEW",91,0)
 I $D(DIRUT)!('PSOCOU) S PSOCOUU=0 D:'$G(SPEED) PRONTE Q
"RTN","PSONEW",92,0)
 K:'$G(PSOCOU) PSOCOUU K DIR,DUOUT,DTOUT,DIRUT I Y S DIR(0)="52,42",DIR("B")="NO" D ^DIR S PSOCOUU=$S(Y:Y,1:0)
"RTN","PSONEW",93,0)
PRONTE K PSONOTE,DIR,DIRUT,DUOUT
"RTN","PSONEW",94,0)
 I $T(MAIN^TIUEDIT)]"",'$G(SPEED) D  K DIR,DIRUT,DUOUT
"RTN","PSONEW",95,0)
 .S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to enter a Progress Note",DIR("A",1)="" D ^DIR K DIR
"RTN","PSONEW",96,0)
 .S PSONOTE=+Y Q  ;I 'Y!($D(DIRUT)) Q
"RTN","PSONEW",97,0)
NOORX K X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",98,0)
 Q
"RTN","PSONEW",99,0)
DIR ;ask nature of order
"RTN","PSONEW",100,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSONEW",101,0)
 .S PSONOOR=$$NA^ORX1($S($G(PSONOODF)!($G(PSONOBCK)):"S",1:"W"),0,"B","Nature of Order",0,"WPSDIVR"_$S($$GET1^DIQ(200,DUZ,53.3):"E",1:""))
"RTN","PSONEW",102,0)
 .I +PSONOOR S (Y,PSONOOR)=$P(PSONOOR,"^",3) Q
"RTN","PSONEW",103,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSONEW",104,0)
 I $D(PSONOOR) S DF=PSONOOR,PSONODF=$S(DF="E":"PROVIDER ENTERED",DF="V":"VERBAL",DF="P":"TELEPHONE",DF="D":"DUPLICATE",DF="S":"SERVICE CORRECTED",DF="I":"POLICY",DF="R":"SERVICE REJECTED",1:"WRITTEN")
"RTN","PSONEW",105,0)
 K DIR,DTOUT,DTOUT,DIRUT S DIR("A")="Nature of Order: ",DIR("B")=$S($D(PSONOOR):PSONODF,1:"WRITTEN")
"RTN","PSONEW",106,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S($$GET1^DIQ(200,DUZ,53.3):";E:PROVIDER ENTERED",1:"")
"RTN","PSONEW",107,0)
 D ^DIR K DF,PSONODF Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSONEW",108,0)
DIRX Q
"RTN","PSONEW",109,0)
 ;
"RTN","PSONEW",110,0)
NOORE(PSONEW) ;entry point for renew
"RTN","PSONEW",111,0)
 D NOOR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",112,0)
 S PSONEW("NOO")=PSONOOR
"RTN","PSONEW",113,0)
 Q
"RTN","PSONEW",114,0)
DAOC ;adds all backdoor order checks to file 100.05.
"RTN","PSONEW",115,0)
 D ^PSONEWOC K ^TMP("PSODAOC",$J),PSRDI
"RTN","PSONEW",116,0)
 Q
"RTN","PSONEW1")
0^13^B21636420
"RTN","PSONEW1",1,0)
PSONEW1 ;BIR/DSD - new Rx order entry ; 12/21/18 9:45am
"RTN","PSONEW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,104,117,143,422,457**;DEC 1997;Build 116
"RTN","PSONEW1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSONEW1",4,0)
 ;
"RTN","PSONEW1",5,0)
START ;
"RTN","PSONEW1",6,0)
 S (PSONEW("DFLG"),PSONEW("FIELD"),PSONEW1)=0
"RTN","PSONEW1",7,0)
 ;
"RTN","PSONEW1",8,0)
1 S PSONEW("FLD")=1 S PSONEW("FIELD")=0
"RTN","PSONEW1",9,0)
 I $P($G(PSOPAR),"^",7)'=1 D MANUAL^PSONRXN ; Get Manual Rx number
"RTN","PSONEW1",10,0)
 G:PSONEW("QFLG")!PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",11,0)
 ;
"RTN","PSONEW1",12,0)
2 S PSONEW("FLD")=2 D PTSTAT^PSODIR1(.PSONEW) ; Get Patient Status
"RTN","PSONEW1",13,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",14,0)
 ;
"RTN","PSONEW1",15,0)
3 S PSONEW("FLD")=3 D ^PSODRG  ; Get drug and related information
"RTN","PSONEW1",16,0)
 G:PSONEW("DFLG") END D EN^PSODIAG  ; get ICD diagnosis codes for order
"RTN","PSONEW1",17,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",18,0)
 ;
"RTN","PSONEW1",19,0)
 ;/RBN - BEGIN CHANGES PSO*7.0*457
"RTN","PSONEW1",20,0)
31 I $D(^TMP($J,"CLOZFLG",PSODFN)) D  ; Get Dosing
"RTN","PSONEW1",21,0)
 . S PSONEW("# OF REFILLS")=0
"RTN","PSONEW1",22,0)
 . S PSONEW("DAYS SUPPLY")=4
"RTN","PSONEW1",23,0)
 . S PSONEW("DOSE",1)=100
"RTN","PSONEW1",24,0)
 . S PSONEW("DOSE ORDERED",1)=1
"RTN","PSONEW1",25,0)
 . S PSONEW("DURATION",1)=4
"RTN","PSONEW1",26,0)
 . S PSONEW("QTY")=4
"RTN","PSONEW1",27,0)
 . S PSONEW("ENT")=1
"RTN","PSONEW1",28,0)
 . S CLOZFLG=1 ; /MZR Added it to assure check for duration in PSOORED5
"RTN","PSONEW1",29,0)
 S PSONEW("FLD")=31 D DOSE^PSODIR(.PSONEW) ; Get Dosing
"RTN","PSONEW1",30,0)
 ;/RBN - END CHANGES PSO*7.0*457
"RTN","PSONEW1",31,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",32,0)
 ;
"RTN","PSONEW1",33,0)
32 K PSODELINS
"RTN","PSONEW1",34,0)
 I '$G(PSONEW("ENT")) W !,"Incomplete Dosaging Data!",! K DIRUT G 31
"RTN","PSONEW1",35,0)
 S:'$D(PSOOEINS) PSOOEINS=$G(PSONEW("INS")) S:'$D(PSOOSINS) PSOOSINS=$G(PSONEW("SINS"))
"RTN","PSONEW1",36,0)
 I '$P($G(^PS(55,PSODFN,"LAN")),"^") S PSONEW("FLD")=32 D INS^PSODIR(.PSONEW) ; Get Patient Instructions
"RTN","PSONEW1",37,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D
"RTN","PSONEW1",38,0)
 .N PSOINSCH,PSODONE S PSODONE=0
"RTN","PSONEW1",39,0)
 .F  D  Q:PSODONE
"RTN","PSONEW1",40,0)
 ..S PSONEW("FLD")=32 D INS^PSODIR(.PSONEW)
"RTN","PSONEW1",41,0)
 ..I '$G(PSONEW("DFLG")),'PSODONE,'$G(PSODELINS) D SINS^PSODIR(.PSONEW)
"RTN","PSONEW1",42,0)
 ..I $G(PSONEW("DFLG")) S PSODONE=1 K PSONEW("DFLG") D  Q
"RTN","PSONEW1",43,0)
 ...I $G(PSONEW("INS"))]"",$G(PSONEW("SINS"))="" K PSONEW("INS"),PSONEW("SIG") Q
"RTN","PSONEW1",44,0)
 ...I $G(PSONEW("INS"))="",$G(PSONEW("SINS"))]"" K PSONEW("SINS")
"RTN","PSONEW1",45,0)
 ..S PSOINSCH=$$INSCHK^PSOHELP3(.PSONEW)
"RTN","PSONEW1",46,0)
 ..I 'PSOINSCH S PSODONE=1
"RTN","PSONEW1",47,0)
 G:$G(PSONEW("DFLG")) END G:$G(PSONEW("FIELD")) @PSONEW("FIELD")
"RTN","PSONEW1",48,0)
 ;
"RTN","PSONEW1",49,0)
 ;
"RTN","PSONEW1",50,0)
4 D EN^PSOFSIG(.PSONEW) I $O(SIG(0)) S SIGOK=1
"RTN","PSONEW1",51,0)
 ;S PSONEW("FLD")=4 D SIG^PSODIR1(.PSONEW) ; Get Rx directions
"RTN","PSONEW1",52,0)
 ;G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",53,0)
 ;
"RTN","PSONEW1",54,0)
7 S PSONEW("FLD")=7 D DAYS^PSODIR1(.PSONEW) ; Get days supply
"RTN","PSONEW1",55,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",56,0)
 ;
"RTN","PSONEW1",57,0)
5 S PSONEW("FLD")=5 D QTY^PSODIR1(.PSONEW) ; Get quantity
"RTN","PSONEW1",58,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",59,0)
 ;
"RTN","PSONEW1",60,0)
6 I $P($G(PSOPAR),"^",15) S PSONEW("FLD")=6 D COPIES^PSODIR1(.PSONEW) ; Get label copies
"RTN","PSONEW1",61,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",62,0)
 ;
"RTN","PSONEW1",63,0)
8 I $G(^TMP($J,"CLOZFLG",PSODFN)) G 9  ; PSO*7.0*457
"RTN","PSONEW1",64,0)
 S PSONEW("FLD")=8 D REFILL^PSODIR1(.PSONEW) ; Get # of refills
"RTN","PSONEW1",65,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",66,0)
 ;
"RTN","PSONEW1",67,0)
9 S PSONEW("FLD")=9 D PROV^PSODIR(.PSONEW) ; Get Provider
"RTN","PSONEW1",68,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",69,0)
 G:$G(DUZ("AG"))'="I" 11
"RTN","PSONEW1",70,0)
 ;
"RTN","PSONEW1",71,0)
10 Q:$G(DUZ("AG"))'="I"  S PSONEW("FLD")=10 D EXP^PSODIR2(.PSONEW) ; Get Expiration Date - Indian Health Service ONLY
"RTN","PSONEW1",72,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",73,0)
 ;
"RTN","PSONEW1",74,0)
11 S PSONEW("FLD")=11 D CLINIC^PSODIR2(.PSONEW) ; Get Clinic
"RTN","PSONEW1",75,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",76,0)
 ;
"RTN","PSONEW1",77,0)
12 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ; Get Mail/Window Info
"RTN","PSONEW1",78,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",79,0)
 ;
"RTN","PSONEW1",80,0)
13 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ; Get Remarks
"RTN","PSONEW1",81,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",82,0)
 ;
"RTN","PSONEW1",83,0)
14 S PSONEW("FLD")=14 D ISSDT^PSODIR2(.PSONEW) ; Get Issue Date
"RTN","PSONEW1",84,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",85,0)
 ;
"RTN","PSONEW1",86,0)
15 S PSONEW("FLD")=15 D FILLDT^PSODIR2(.PSONEW) ; Get Fill date
"RTN","PSONEW1",87,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",88,0)
 ;
"RTN","PSONEW1",89,0)
16 S PSONEW("FLD")=16 D CLERK^PSODIR2(.PSONEW) ; Get Clerk Code
"RTN","PSONEW1",90,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",91,0)
 ;
"RTN","PSONEW1",92,0)
END ;
"RTN","PSONEW1",93,0)
 K PSONEW1,PSOOEINS,PSOOSINS,^TMP($J,"CLOZFLG",PSODFN)
"RTN","PSONEW1",94,0)
 Q
"RTN","PSONEW1",95,0)
 ;
"RTN","PSONEW1",96,0)
JUMP ;
"RTN","PSONEW1",97,0)
 S PSONEW("FIELD")=$S(+Y=.01:1,+Y=3:2,+Y=6:3,+Y=10:4,+Y=7:5,+Y=10.6:6,+Y=8:7,+Y=9:8,+Y=4:9,+Y=29:10,+Y=5:11,+Y=11:12,+Y=12:13,+Y=1:14,+Y=22:15,+Y=16:16,+Y=113:31,+Y=114:32,1:PSONEW("FLD"))
"RTN","PSONEW1",98,0)
 I PSONEW("FIELD")>PSONEW("FLD") W !,$C(7),"Cannot jump ahead ..",! S PSONEW("FIELD")=PSONEW("FLD")
"RTN","PSONEW1",99,0)
 Q
"RTN","PSOORED1")
0^10^B79193159
"RTN","PSOORED1",1,0)
PSOORED1 ;ISC-BHAM/SAB - edit orders from backdoor ; 10/12/18 5:13am
"RTN","PSOORED1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,23,46,78,114,117,131,146,223,148,244,249,268,206,313,444,422,457**;DEC 1997;Build 116
"RTN","PSOORED1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORED1",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED1",5,0)
 ;
"RTN","PSOORED1",6,0)
 ;*244 call to remove DC'd Rx's from Rx ien strings
"RTN","PSOORED1",7,0)
 ;
"RTN","PSOORED1",8,0)
EN(PSORENW) ;
"RTN","PSOORED1",9,0)
 N LST,ORD,ORN K VALMBCK,PSORX("FN") S PSOAC=1,(PSORX("QFLG"),PSORX("DFLG"))=0 ;D DREN^PSOORNW2,INIT
"RTN","PSOORED1",10,0)
 D INIT
"RTN","PSOORED1",11,0)
 D @$S($P(PSOPAR,"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN")
"RTN","PSOORED1",12,0)
 I '$D(PSONEW("RX #")),'$P(PSOPAR,"^",7) D PAUSE^VALM1 K VALMSG,PSONEW("QFLG") S VALMBCK="Q" Q
"RTN","PSOORED1",13,0)
 I '$D(PSONEW("RX #")) K VALMSG D DEL^PSONEW,PAUSE^VALM1 S VALMBCK="Q" Q
"RTN","PSOORED1",14,0)
 S PSORENW("RX #")=PSONEW("RX #") I '$P(PSOPAR,"^",7) D  Q:$G(PSONEW("DFLG"))!($G(PSONEW("QFLG")))
"RTN","PSOORED1",15,0)
 .S PSOX=PSORENW("RX #") D CHECK^PSONRXN
"RTN","PSOORED1",16,0)
 I $G(PSONEW("DFLG"))!$G(PSONEW("QFLG")) D DEL^PSONEW,PAUSE^VALM1 S VALMBCK="Q" K PSORENW Q
"RTN","PSOORED1",17,0)
 D EN^PSOORNE1(.PSORENW) I '$G(PSORX("FN")) D:$P($G(PSOPAR),"^",7)=1  S VALMBCK="Q" Q
"RTN","PSOORED1",18,0)
 .S DIE="^PS(59,",DA=PSOSITE,PSOY=$O(PSONEW("OLD LAST RX#","")),PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSOORED1",19,0)
 .L +^PS(59,+PSOSITE,PSOY):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSOORED1",20,0)
 .S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSOORED1",21,0)
 .D:PSOX<$P(^PS(59,+PSOSITE,PSOY),"^",3) ^DIE K DIE,X,Y L -^PS(59,+PSOSITE,PSOY)
"RTN","PSOORED1",22,0)
 .I $D(PSONEW("RX #")) L -^PSRX("B",PSONEW("RX #"))
"RTN","PSOORED1",23,0)
 .K PSOX,PSOY Q
"RTN","PSOORED1",24,0)
 Q:$G(COPY)
"RTN","PSOORED1",25,0)
TRY S $P(^PSRX(PSORENW("OIRXN"),"STA"),"^")=15,DA=PSORENW("OIRXN")
"RTN","PSOORED1",26,0)
 S $P(^PSRX(DA,3),"^",5)=DT,$P(^PSRX(DA,3),"^",10)=$P(^PSRX(DA,3),"^")
"RTN","PSOORED1",27,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7),CAN^PSOTPCAN(DA)
"RTN","PSOORED1",28,0)
 D RMP^PSOCAN3                ;*244
"RTN","PSOORED1",29,0)
 ;cancel/discontinue action
"RTN","PSOORED1",30,0)
 S PHARM="",STAT="RP",COMM="Prescription discontinued due to editing." D EN^PSOHLSN1(DA,STAT,PHARM,COMM,PSONOOR) K STAT,PHARM,COMM
"RTN","PSOORED1",31,0)
 S ACOM="Discontinued due to editing. New Rx created "_$P(^PSRX(PSORENW("IRXN"),0),"^")_"."
"RTN","PSOORED1",32,0)
 I $G(^PSRX(DA,"H"))]"" D
"RTN","PSOORED1",33,0)
 .I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")=16) D
"RTN","PSOORED1",34,0)
 ..S DIE=52,DR="22///"_$P(^PSRX(DA,3),"^") D ^DIE S ACOM="Discontinued due to editing while on hold. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA)
"RTN","PSOORED1",35,0)
 ..S ^PSRX(DA,"H")=""
"RTN","PSOORED1",36,0)
 S RXDA=DA,(DA,SUSDA)=$O(^PS(52.5,"B",RXDA,0)) D:DA
"RTN","PSOORED1",37,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOORED1",38,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM="Discontinued due to editing while suspended."
"RTN","PSOORED1",39,0)
 .I $O(^PSRX(RXDA,1,0)) S DA=RXDA D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOORED1",40,0)
 .S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORED1",41,0)
 K SUSD,SUSDA S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) D
"RTN","PSOORED1",42,0)
 .S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOORED1",43,0)
 .S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOORED1",44,0)
 .D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1),^PSRX(DA,"A",ACNT+1,0)=%_"^C^"_DUZ_"^"_RFCNT_"^"_$G(ACOM)
"RTN","PSOORED1",45,0)
 .I $G(PSOOIFLG),'$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Pharmacy Orderable Item Edited."
"RTN","PSOORED1",46,0)
 .I '$G(PSOOIFLG),$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Medication Route/Schedule Edited."
"RTN","PSOORED1",47,0)
 .I $G(PSOOIFLG),$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Pharmacy Orderable Item and Medication Route/Schedule Edited."
"RTN","PSOORED1",48,0)
 .S REA="C" D EXP^PSOHELP1
"RTN","PSOORED1",49,0)
 I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOORED1",50,0)
 Q
"RTN","PSOORED1",51,0)
INS K X,QUIT,Y,DIR,DIRUT,DUOUT,DTOUT,DIC,INSDEL,UPMI,^TMP($J,"INS1")
"RTN","PSOORED1",52,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)),'$O(PSORXED("DOSE",0)) D UPMI Q:$G(QUIT)  ;G INS1
"RTN","PSOORED1",53,0)
 I $G(^PSRX(PSORXED("IRXN"),"INS"))]"" S PSORXED("FLD",114)=^PSRX(PSORXED("IRXN"),"INS") K UPMI G INS1
"RTN","PSOORED1",54,0)
 K DD,GG F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"INS1",I)) Q:'I  S DD=$G(DD)+1
"RTN","PSOORED1",55,0)
 I $G(DD)=1 S PSORXED("FLD",114)=^PSRX(PSORXED("IRXN"),"INS1",$O(^PSRX(PSORXED("IRXN"),"INS1",0)),0) K UPMI,DD G INS1
"RTN","PSOORED1",56,0)
 I $O(^PSRX(PSORXED("IRXN"),"INS1",0)) D  G INSX
"RTN","PSOORED1",57,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"INS1",I)) Q:'I  S ^TMP($J,"INS1",I,0)=^PSRX(PSORXED("IRXN"),"INS1",I,0)
"RTN","PSOORED1",58,0)
 .S ^TMP($J,"INS1",0)=^PSRX(PSORXED("IRXN"),"INS1",0)
"RTN","PSOORED1",59,0)
 .S DIC="^TMP($J,""INS1"",",DWPK=2,DWLW=80 D EN^DIWE I $G(X)="^" K ^TMP($J,"INS1") Q
"RTN","PSOORED1",60,0)
 .I '$O(^TMP($J,"INS1",0)) S INSDEL=1
"RTN","PSOORED1",61,0)
 .S D=0 F  S D=$O(^PSRX(PSORXED("IRXN"),"INS1",D)) Q:'D  S PSORXED("SIG",D)=^PSRX(PSORXED("IRXN"),"INS1",D,0)
"RTN","PSOORED1",62,0)
INS1 K Y,DIR,DIRUT,DUOUT,DTOUT,DIC,X
"RTN","PSOORED1",63,0)
 I $G(PSORXED("IRXN")) S:'$D(PSOOEINS) PSOOEINS=$G(^PSRX(PSORXED("IRXN"),"INS")) S:'$D(PSOOSINS) PSOOSINS=$G(^PSRX(PSORXED("IRXN"),"INSS")) ;*422
"RTN","PSOORED1",64,0)
 I $G(UPMI) K UPMI I $G(^PS(50.7,PSODRUG("OI"),"INS"))]"" S PSORXED("FLD",114)=^PS(50.7,PSODRUG("OI"),"INS")
"RTN","PSOORED1",65,0)
 S:$G(PSORXED("FLD",114))]"" DIR("B")=PSORXED("FLD",114)
"RTN","PSOORED1",66,0)
 S DIR("?")="Enter Quick codes or Free Text",DIR(0)="52,114" D ^DIR
"RTN","PSOORED1",67,0)
 I $D(DTOUT)!($D(DUOUT)) K PSORXED("FLD",114),PSORXED("FLD",114.1) S (PSORXED("INS"),PSORXED("SIG",1))=$G(PSOOEINS) S:$P($G(^PS(55,PSODFN,"LAN")),"^") PSORXED("SINS")=$G(PSOOSINS) D EN^PSOFSIG(.PSORXED,1) G INSQ  ;*422
"RTN","PSOORED1",68,0)
 I $G(PSORXED("DFLG")) S (PSORXED("SIG"),PSORXED("INS"))=$G(PSOOEINS),PSORXED("SINS")=$G(PSOOSINS) K PSORXED("SIG") D EN^PSOFSIG(.PSONEW,1) G INSQ  ;*422
"RTN","PSOORED1",69,0)
 S PSODELINS=0 I X="@" S PSODELINS=1 D DELINS^PSOHELP3 ;*422
"RTN","PSOORED1",70,0)
 I '$G(PSODELINS),($G(X)="@"!($G(X)="")) S (X,INS1,PSORXED("INS"))=$G(PSOOEINS) ;*422
"RTN","PSOORED1",71,0)
 I $G(PSODELINS) S (INS1,PSORXED("FLD",114),PSORXED("FLD",114.1))="" K PSORXED("INS"),PSORXED("SIG"),PSORXED("SINS")  ;*422
"RTN","PSOORED1",72,0)
 I X'="",X'="@" D SIG^PSOHELP G INS1:'$D(X)
"RTN","PSOORED1",73,0)
 I $G(INS1)]"" W " ("_$E(INS1,2,9999999)_")"
"RTN","PSOORED1",74,0)
 S:$G(INS1)]"" (PSORXED("INS"),PSORXED("SIG",1),PSORXED("FLD",114))=$E(INS1,2,9999999) D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED1",75,0)
 I $G(PSODELINS) G INSQ
"RTN","PSOORED1",76,0)
INSX I '$P($G(^PS(55,PSODFN,"LAN")),"^") G INSQ
"RTN","PSOORED1",77,0)
 K DIR
"RTN","PSOORED1",78,0)
 I $G(^PSRX(PSORXED("IRXN"),"INSS"))]"" S PSORXED("SINS")=^PSRX(PSORXED("IRXN"),"INSS")
"RTN","PSOORED1",79,0)
 D SINS^PSODIR(.PSORXED) ;*422
"RTN","PSOORED1",80,0)
 I $G(PSORXED("DFLG")) K PSORXED("FLD",114) S PSORXED("INS")=$G(PSOOEINS) S:$P($G(^PS(55,PSODFN,"LAN")),"^") PSORXED("SINS")=$G(PSOOSINS) D EN^PSOFSIG(.PSORXED,1) G INSQ  ;*422
"RTN","PSOORED1",81,0)
 S:$G(PSORXED("SINS"))]"" PSORXED("FLD",114.1)=$G(PSORXED("SINS"))  ;*422
"RTN","PSOORED1",82,0)
 S PSOINSCH=$$INSCHK^PSOHELP3(.PSORXED)  ;*422
"RTN","PSOORED1",83,0)
 G:PSOINSCH INS1  ;*422
"RTN","PSOORED1",84,0)
INSQ K DIRUT,DUOUT,DTOUT,DIR,X,Y,DIC,DWPK,PSOOEINS,PSOOSINS,PSODELINS
"RTN","PSOORED1",85,0)
 Q
"RTN","PSOORED1",86,0)
INIT ;setup psorenw array
"RTN","PSOORED1",87,0)
 S PSORENW("RX0")=^PSRX(PSORENW("IRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSOORED1",88,0)
 I $G(PSOSIGFL),$G(PSORX("SIG"))]"" S PSORENW("SIG")=PSORX("SIG"),SIGOK=0
"RTN","PSOORED1",89,0)
 E  D
"RTN","PSOORED1",90,0)
 .I '$P($G(^PSRX(PSORENW("IRXN"),"SIG")),"^",2) S PSORENW("SIG")=$P($G(^("SIG")),"^")
"RTN","PSOORED1",91,0)
 .E  D
"RTN","PSOORED1",92,0)
 ..S SIGOK=1 Q:$O(SIG(0))
"RTN","PSOORED1",93,0)
 ..S D=0 F I=0:0 S D=D+1,I=$O(^PSRX(PSORENW("IRXN"),"SIG1",I)) Q:'I  S SIG(D)=^PSRX(PSORENW("IRXN"),"SIG1",I,0)
"RTN","PSOORED1",94,0)
 ..K PSOX1,D
"RTN","PSOORED1",95,0)
 S PSORENW("OIRXN")=PSORENW("IRXN")
"RTN","PSOORED1",96,0)
 S PSORENW("PROVIDER")=$S($G(PSORENW("PROVIDER")):PSORENW("PROVIDER"),1:$P(PSORENW("RX0"),"^",4))
"RTN","PSOORED1",97,0)
 S (PSORENW("PROVIDER NAME"),PSORX("PROVIDER NAME"))=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSOORED1",98,0)
 I $P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSOORED1",99,0)
 S PSORENW("CLINIC")=$S($G(PSORENW("CLINIC")):PSORENW("CLINIC"),1:$P(PSORENW("RX0"),"^",5))
"RTN","PSOORED1",100,0)
 S PSORENW("REMARKS")="New Order Created by "_$S($G(COPY)&('$G(PSOEDIT)):"copying",1:"editing")_" Rx # "_$P(PSORENW("RX0"),"^")_"."
"RTN","PSOORED1",101,0)
 ;
"RTN","PSOORED1",102,0)
 ; - Maintenance Dose Rx Remarks field
"RTN","PSOORED1",103,0)
 I $G(PSOMTFLG) S PSORENW("REMARKS")="Maintenance Rx created from Titration Rx# "_$P(PSORENW("RX0"),"^")_"."
"RTN","PSOORED1",104,0)
 ;
"RTN","PSOORED1",105,0)
 S PSORENW("COSIGNER")=$S($G(PSORENW("COSIGNER")):PSORENW("COSIGNER"),$P(PSORENW("RX3"),"^",3):$P(PSORENW("RX3"),"^",3),1:"")
"RTN","PSOORED1",106,0)
 K:PSORENW("COSIGNER")="" PSORENW("COSIGNER")
"RTN","PSOORED1",107,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSOORED1",108,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSOORED1",109,0)
 S:$G(PSODRUG("IEN")) PSORENW("DRUG IEN")=PSODRUG("IEN")
"RTN","PSOORED1",110,0)
 ;; START NCC REMEDIATION >> 457*RJS - ADJUST MAX DAYS SUPPLY FOR 4 DAY SUPPLY
"RTN","PSOORED1",111,0)
 I $$GET1^DIQ(50,+$G(PSODRUG("IEN")),17.5)="PSOCLO1",$P(PSORENW("RX0"),"^",8)<5 S PSORENW("DAYS SUPPLY")=$P(PSORENW("RX0"),"^",8)
"RTN","PSOORED1",112,0)
 ;; END NCC REMEDIATION << 457*RJS
"RTN","PSOORED1",113,0)
 I $G(PSORENW("DAYS SUPPLY")) G QTY
"RTN","PSOORED1",114,0)
 S PSORENW("DAYS SUPPLY")=$S($D(CLOZPAT):7,1:$P(PSORENW("RX0"),"^",8))
"RTN","PSOORED1",115,0)
QTY S PSORENW("QTY")=$S($G(PSORENW("QTY")):PSORENW("QTY"),1:$P(PSORENW("RX0"),"^",7))
"RTN","PSOORED1",116,0)
RFN S PSORENW("# OF REFILLS")=$S($D(CLOZPAT):0,$G(PSORENW("# OF REFILLS")):PSORENW("# OF REFILLS"),1:$P(PSORENW("RX0"),"^",9))
"RTN","PSOORED1",117,0)
 S (PSOID,Y,PSORENW("FILL DATE"),PSORENW("ISSUE DATE"))=DT
"RTN","PSOORED1",118,0)
 ;
"RTN","PSOORED1",119,0)
 ; - Maintenance Rx Fill Date is set with Next Possible Fill from Titration Rx
"RTN","PSOORED1",120,0)
 I $G(PSOMTFLG),$P($G(PSORENW("RX3")),"^",2)>DT S PSORENW("FILL DATE")=$P(PSORENW("RX3"),"^",2)
"RTN","PSOORED1",121,0)
 ;
"RTN","PSOORED1",122,0)
 S:PSORENW("CLINIC") PSORX("CLINIC")=$P(^SC(+PSORENW("CLINIC"),0),"^")
"RTN","PSOORED1",123,0)
 S PSORENW("PATIENT STATUS")=$S($G(PSORENW("PATIENT STATUS")):PSORENW("PATIENT STATUS"),'$P(PSORENW("RX0"),"^",3):$G(^PS(55,PSORENW("PSODFN"),"PS")),1:$P(PSORENW("RX0"),"^",3))
"RTN","PSOORED1",124,0)
 S PSORENW("PTST NODE")=$G(^PS(53,PSORENW("PATIENT STATUS"),0))
"RTN","PSOORED1",125,0)
 S PSDAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),'$P(PSORENW("RX0"),"^",8):$P(PSORENW("PTST NODE"),"^",3),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSOORED1",126,0)
 I $G(PSODRUG("IEN")) S DREN=PSODRUG("IEN"),POERR=1 D DRG^PSOORDRG K POERR
"RTN","PSOORED1",127,0)
 D:$G(PSORENW("# OF REFILLS"))']"" RF
"RTN","PSOORED1",128,0)
 ;
"RTN","PSOORED1",129,0)
 ; - Maintenance Rx # of Refills adjustment
"RTN","PSOORED1",130,0)
 I $G(PSOMTFLG),$G(PSORENW("# OF REFILLS"))>0 S PSORENW("# OF REFILLS")=PSORENW("# OF REFILLS")-1
"RTN","PSOORED1",131,0)
 ;
"RTN","PSOORED1",132,0)
 S PSORENW("MAIL/WINDOW")=$S($G(PSORENW("MAIL/WINDOW"))]"":PSORENW("MAIL/WINDOW"),1:$P(PSORENW("RX0"),"^",11))
"RTN","PSOORED1",133,0)
 S PSORX("MAIL/WINDOW")=$S(PSORENW("MAIL/WINDOW")="W":"WINDOW",1:"MAIL")
"RTN","PSOORED1",134,0)
 S PSORENW("COPIES")=$S($G(PSORENW("COPIES")):PSORENW("COPIES"),$P(PSORENW("RX0"),"^",18):$P(PSORENW("RX0"),"^",18),1:1)
"RTN","PSOORED1",135,0)
 S PSORENW("CLERK CODE")=DUZ
"RTN","PSOORED1",136,0)
 S:$G(PSORX("CLERK CODE"))']"" PSORX("CLERK CODE")=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSOORED1",137,0)
 Q:$D(COPY)  S PSORENW("ENT")=0
"RTN","PSOORED1",138,0)
 K PSORENW("ENT") F I=0:0 S I=$O(PSORENW("DOSE",I)) Q:'I  S PSORENW("ENT")=$G(PSORENW("ENT"))+1
"RTN","PSOORED1",139,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED1",140,0)
 .K PSORXED("SIG"),DD
"RTN","PSOORED1",141,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S PSORENW("SIG",I)=^TMP($J,"INS1",I,0)
"RTN","PSOORED1",142,0)
 .K ^TMP($J,"INS1")
"RTN","PSOORED1",143,0)
 I $G(^PSRX(PSORENW("IRXN"),"INS"))]"" S PSORENW("INS")=^PSRX(PSORENW("IRXN"),"INS")
"RTN","PSOORED1",144,0)
 I $G(^PSRX(PSORENW("IRXN"),"INSS"))]"" S PSORENW("SINS")=^PSRX(PSORENW("IRXN"),"INSS")
"RTN","PSOORED1",145,0)
 I '$G(PSORENW("ENT")),'$G(PSOSIGFL) D DOLST1^PSOORED3(.PSORENW) S PSORENW("ENT")=+$G(OLENT)
"RTN","PSOORED1",146,0)
 Q
"RTN","PSOORED1",147,0)
RF ;# of refills
"RTN","PSOORED1",148,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSOORED1",149,0)
 S PSORENW("# OF REFILLS")=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),PSDAYS,+$G(PSORENW("PATIENT STATUS")),.CLOZPAT)
"RTN","PSOORED1",150,0)
 Q
"RTN","PSOORED1",151,0)
UPMI ;add dosing data for pre-poe rxs
"RTN","PSOORED1",152,0)
 W !! K PSONEW("DFLG"),DIR,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Dosing Instructions Are Missing!! Do You Want to Add Them"
"RTN","PSOORED1",153,0)
 D ^DIR I 'Y!($D(DIRUT)) S QUIT=1 K DIR,DIRUT,DUOT,DUOUT Q
"RTN","PSOORED1",154,0)
 S UPMI=1,EDTHLD=$G(PSORX("EDIT")) K PSORX("EDIT")
"RTN","PSOORED1",155,0)
 D DOSE1^PSOORED5(.PSORXED) S (PSORXED,PSORX("EDIT"))=EDTHLD K EDTHLD I $G(PSONEW("DFLG")) S QUIT=1
"RTN","PSOORED1",156,0)
 Q
"RTN","PSOORED5")
0^7^B114405743
"RTN","PSOORED5",1,0)
PSOORED5 ;BIR/SAB-Rxs without dosing info ;3 June 2019 09:56:45
"RTN","PSOORED5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,75,78,100,99,117,133,251,378,372,416,313,450,486,402,500,507,525,537,555,457**;DEC 1997;Build 116
"RTN","PSOORED5",3,0)
 ;Reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORED5",4,0)
 ;Reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED5",5,0)
 ;Reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOORED5",6,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORED5",7,0)
 ;External reference to START^PSSJORDF(PSODRUG supported by DBIA 2418
"RTN","PSOORED5",8,0)
 ;called by psoored2 and psodir
"RTN","PSOORED5",9,0)
 ;pre-poe rxs and new backdoor rxs
"RTN","PSOORED5",10,0)
 ;
"RTN","PSOORED5",11,0)
 ;*507 indicate inactive file #51.1 sched entries
"RTN","PSOORED5",12,0)
 ;
"RTN","PSOORED5",13,0)
DOSE1(PSORXED) ;for new rxs
"RTN","PSOORED5",14,0)
DOSE ;pre-poe rx
"RTN","PSOORED5",15,0)
 D KV K ROU,STRE,FIELD,DOSEOR,DUPD,X,Y,UNITS,ENTBKP S:$D(PSORXED("ENT")) ENTBKP=PSORXED("ENT") S ENT=1,OLENT=ENT ;p555 added ENTBKP
"RTN","PSOORED5",16,0)
ASK S ROU="PSOORED5" D ASK^PSOBKDED K ROU G:$D(DIRUT) EXE  ;486
"RTN","PSOORED5",17,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED5",18,0)
 I $G(QUIT)]"" K QUIT,ROU Q
"RTN","PSOORED5",19,0)
 ;
"RTN","PSOORED5",20,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED5",21,0)
 I $G(PSORX("EDIT"))']"" W:$G(PSORXED("VERB",ENT))]"" !,"VERB: "_PSORXED("VERB",ENT) G DUPD
"RTN","PSOORED5",22,0)
VER D VER^PSOOREDX
"RTN","PSOORED5",23,0)
 I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED5",24,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT) I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED5",25,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED5",26,0)
DUPD ;
"RTN","PSOORED5",27,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED5",28,0)
 D KV S DIR(0)="52.0113,1",DIR("A")="DISPENSE UNITS PER DOSE"_$S($G(PSORXED("NOUN",ENT))]"":"("_PSORXED("NOUN",ENT)_")",1:"")
"RTN","PSOORED5",29,0)
 I '$G(PSORXED("DOSE",ENT)),$G(PSORXED("DOSE",ENT-1)) S PSORXED("DOSE",ENT)=PSORXED("DOSE",ENT-1)
"RTN","PSOORED5",30,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),$G(DUPD)]"":DUPD,1:"") S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED5",31,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED5",32,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",33,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED5",34,0)
 D STR^PSOOREDX
"RTN","PSOORED5",35,0)
 ;
"RTN","PSOORED5",36,0)
NOU1 G:'$D(DUPD) RTE D CNON^PSOORED3 N PSONDEF
"RTN","PSOORED5",37,0)
 I $G(NOUN)]"",$G(PSORX("EDIT"))']"" S PSORXED("NOUN",ENT)=NOUN W !,"NOUN: "_$G(NOUN) G RTE
"RTN","PSOORED5",38,0)
 I $G(PSORX("EDIT"))']"",$G(PSORXED("NOUN",ENT))]"" W !,"NOUN: "_PSORXED("NOUN",ENT) G RTE
"RTN","PSOORED5",39,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED5",40,0)
 G EXE:$D(DTOUT)!$D(DUOUT) I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED5",41,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED5",42,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED5",43,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED5",44,0)
 ;
"RTN","PSOORED5",45,0)
RTE I $G(ENT)>1,$G(PSORX("EDIT"))']"",$G(PSORXED("ROUTE",ENT-1)),$G(PSORXED("ROUTE",ENT))']"" S PSORXED("ROUTE",ENT)=PSORXED("ROUTE",ENT-1) G SCH
"RTN","PSOORED5",46,0)
 I '$G(DRET),'$G(PSORXED("ROUTE",ENT)),$P(^PS(50.7,PSODRUG("OI"),0),"^",6) S PSORXED("ROUTE",ENT)=$P(^PS(50.7,PSODRUG("OI"),0),"^",6)
"RTN","PSOORED5",47,0)
 I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOORED5",48,0)
 I $G(RTE) K RTE
"RTN","PSOORED5",49,0)
 ;*525
"RTN","PSOORED5",50,0)
 D KV N MRSLS,MRX,MRDFV,MRQ S MRQ=0,MRDFV=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"")
"RTN","PSOORED5",51,0)
 S X=""
"RTN","PSOORED5",52,0)
 W !,"ROUTE: "_MRDFV_"//"
"RTN","PSOORED5",53,0)
 D  G:$G(MRSLS) DQ G:MRQ=1 RTE
"RTN","PSOORED5",54,0)
 . R MRX:DTIME
"RTN","PSOORED5",55,0)
 . I '$T S DTOUT=1 Q
"RTN","PSOORED5",56,0)
 . I MRX="^" S DUOUT=1 Q
"RTN","PSOORED5",57,0)
 . I MRX="?" D MRSL
"RTN","PSOORED5",58,0)
 . I (MRX="")!(MRX=" ")&($G(MRDFV)]"") S MRX=$G(MRDFV)
"RTN","PSOORED5",59,0)
 . I $E(MRX,1)=" " S MRQ=1
"RTN","PSOORED5",60,0)
 S X=MRX
"RTN","PSOORED5",61,0)
 K MRSLS,MRX,MRDFV,MRQ
"RTN","PSOORED5",62,0)
 I X[U,$L(X)>1 S FIELD="RTE" G JUMP
"RTN","PSOORED5",63,0)
 S:($D(DTOUT))!($D(DUOUT)) PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",64,0)
 I X="^" S PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",65,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" G SCH
"RTN","PSOORED5",66,0)
 D CKMRSL
"RTN","PSOORED5",67,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) G SCH
"RTN","PSOORED5",68,0)
 ;D KV S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOORED5",69,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",70,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",71,0)
 ;D ^DIR I X[U,$L(X)>1 S FIELD="RTE" G JUMP
"RTN","PSOORED5",72,0)
 ;S:($D(DTOUT))!($D(DUOUT)) PSODIR("DFLG")=1 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",73,0)
 ;I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" G SCH
"RTN","PSOORED5",74,0)
 ;K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) G SCH
"RTN","PSOORED5",75,0)
 ;S DIC=51.2,DIC(0)="QEZM",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOORED5",76,0)
DQ ;
"RTN","PSOORED5",77,0)
 S DIC=51.2,DIC(0)="QEZMX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOORED5",78,0)
RTF ;
"RTN","PSOORED5",79,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOORED5",80,0)
 ;
"RTN","PSOORED5",81,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED5",82,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",83,0)
 S SCH=$$SCHASL(Y) D SCH^PSOSIG I $G(SCH)']""!($D(DTOUT))!($D(DUOUT)) G SCH
"RTN","PSOORED5",84,0)
 S PSORXED("SCHEDULE",ENT)=SCH IF $G(SCHEX)'="" W " ("_SCHEX_")"
"RTN","PSOORED5",85,0)
 K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED5",86,0)
 S:$G(PSORXED("ENT"))<ENT PSORXED("ENT")=ENT
"RTN","PSOORED5",87,0)
 ;
"RTN","PSOORED5",88,0)
DUR ;
"RTN","PSOORED5",89,0)
 D KV K EXP
"RTN","PSOORED5",90,0)
 S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOORED5",91,0)
 S DIR("B")=$S($D(DUR):DUR,$G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",92,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED5",93,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",94,0)
 ;; START NCC REMEDIATION >> 457*RJS - ADJUST FOR 4 DAY SUPPLY
"RTN","PSOORED5",95,0)
 ;/RBN Begin modification for #326 ;/MZR Added a message and correct checking for Hours/Minutes
"RTN","PSOORED5",96,0)
 I $G(DIR("B"))!$G(PSORXED("DURATION",ENT)) N Z,MAX D  I Z>MAX S PSORXED("DURATION",$G(PSORXED("ENT")))=MAX G DUR
"RTN","PSOORED5",97,0)
 .I X=+X S Z=X
"RTN","PSOORED5",98,0)
 .E  S Z=$E(X,$L(X)),Z=$S(Z="L":30*X,Z="W":7*X,Z="H":X/24,Z="M":X/1440,1:+X)
"RTN","PSOORED5",99,0)
 .S MAX=$S($G(DIR("B")):+DIR("B"),1:$G(PSORXED("DURATION",ENT)))
"RTN","PSOORED5",100,0)
 .I Z>MAX D
"RTN","PSOORED5",101,0)
 ..W " ("_$S(X["L":"MONTHS",X["W":"WEEKS",X["H":"HOURS",X["M":"MINUTES",1:"DAYS")_")"
"RTN","PSOORED5",102,0)
 ..W !,"NOT MORE THAN ",MAX," DAYS"
"RTN","PSOORED5",103,0)
 ;; END NCC REMEDIATION << 457*RJS
"RTN","PSOORED5",104,0)
 D DUR1^PSOOREDX
"RTN","PSOORED5",105,0)
 ;
"RTN","PSOORED5",106,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED5",107,0)
 G EX:$D(DTOUT),EXE:$D(DUOUT)
"RTN","PSOORED5",108,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED5",109,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED5",110,0)
 I X="@" D CON1^PSOOREDX G:$D(DIRUT) EX G:'Y CON S:'$G(COPY) PSOSIGFL=1 D UPD^PSOOREDX G CON
"RTN","PSOORED5",111,0)
 ;
"RTN","PSOORED5",112,0)
 I '$$DUROK^PSOORED3(.PSORXED,ENT) D  G DUR
"RTN","PSOORED5",113,0)
 . W !!,"Duration is required for the dosage entered prior to the THEN conjunction.",$C(7),!
"RTN","PSOORED5",114,0)
 N PSODLBD4 S PSOSAVX=X,PSODLBD4=1
"RTN","PSOORED5",115,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" S PSOCKCON=1 D DCHK1^PSODOSUT G:$G(PSORXED("DFLG"))!($G(PSORX("DFLG"))) EX S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED5",116,0)
 E  K PSOCKCON I $$DCHK^PSODOSUT S PSORXED("DFLG")=1,PSORX("DFLG")=1 G EX
"RTN","PSOORED5",117,0)
 I PSOSAVX="",$G(PSORXED)!($D(PSOEDDOS)) K PSOCKCON
"RTN","PSOORED5",118,0)
 K PSOSAVX
"RTN","PSOORED5",119,0)
 ;
"RTN","PSOORED5",120,0)
EXS ;Entry point for EXE to rebuild SIG  PSO*7.0*450
"RTN","PSOORED5",121,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOORED5",122,0)
 D EN^PSOFSIG(.PSORXED) I $O(SIG(0)) S PSORXED("ENT")=ENT,SIGOK=1
"RTN","PSOORED5",123,0)
 Q:$G(PSOREEDT)!($G(PSOORRNW))
"RTN","PSOORED5",124,0)
 K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED5",125,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED5",126,0)
 K QTYHLD Q:$G(PSOFROM)="NEW"!($G(COPY))!($G(PSOFROM))!($G(PSOREEDT))
"RTN","PSOORED5",127,0)
 Q:$G(PSOSIGFL)  D
"RTN","PSOORED5",128,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSOORED5",129,0)
 .S (A,I)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),"A",I)) Q:'I  S A=A+1
"RTN","PSOORED5",130,0)
 .S:'$D(^PSRX(PSORXED("IRXN"),"A",0)) ^PSRX(PSORXED("IRXN"),"A",0)="^52.3DA^"
"RTN","PSOORED5",131,0)
 .S $P(^PSRX(PSORXED("IRXN"),"A",0),"^",3)=$P($G(^PSRX(PSORXED("IRXN"),"A",0)),"^",3)+1,$P(^(0),"^",4)=$P($G(^(0)),"^",4)+1
"RTN","PSOORED5",132,0)
 .D NOW^%DTC S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^New Dosing Instructions Added",^PSRX(PSORXED("IRXN"),"A",A,1)="ORIGINAL SIG^" D
"RTN","PSOORED5",133,0)
 ..I '$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) S $P(^PSRX(PSORXED("IRXN"),"A",A,1),"^",2)=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^") Q
"RTN","PSOORED5",134,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S ^PSRX(PSORXED("IRXN"),"A",A,2,I,0)=^PSRX(PSORXED("IRXN"),"SIG1",I,0),^PSRX(PSORXED("IRXN"),"A",A,2,0)="^52.34A^"_I_"^"_I
"RTN","PSOORED5",135,0)
 .S ^PSRX(PSORXED("IRXN"),"SIG")="^1" K SIG,A,I
"RTN","PSOORED5",136,0)
 S ^PSRX(PSORXED("IRXN"),6,0)="^52.0113^"_ENT_"^"_ENT
"RTN","PSOORED5",137,0)
 F I=1:1:ENT S ^PSRX(PSORXED("IRXN"),6,I,0)=PSORXED("DOSE",I)_"^"_$G(PSORXED("DOSE ORDERED",I))_"^"_$G(PSORXED("UNITS",I))_"^"_$G(PSORXED("NOUN",I))_"^" D
"RTN","PSOORED5",138,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,0)=^PSRX(PSORXED("IRXN"),6,I,0)_$G(PSORXED("DURATION",I))_"^"_$G(PSORXED("CONJUNCTION",I))_"^"_$G(PSORXED("ROUTE",I))_"^"_$G(PSORXED("SCHEDULE",I))_"^"_$G(PSORXED("VERB",I))
"RTN","PSOORED5",139,0)
 .I $G(PSORXED("DOSE",I))]"" S ^PSRX(PSORXED("IRXN"),6,I,1)=PSORXED("DOSE",I)
"RTN","PSOORED5",140,0)
 S ^PSRX(PSORXED("IRXN"),"POE")=1 G EX
"RTN","PSOORED5",141,0)
 Q
"RTN","PSOORED5",142,0)
EX I $D(DUOUT)!($D(DTOUT)) S PSONEW("DFLG")=1 S:$D(ENTBKP) ENT=ENTBKP ;p555 added ENTBKP
"RTN","PSOORED5",143,0)
 ;I $D(DUOUT)!($D(DTOUT)) S:'$G(PSORX("EDIT")) PSONEW("DFLG")=1
"RTN","PSOORED5",144,0)
 G:$G(PSOSIGFL)!($G(PSORX("EDIT")))!($G(PSORXED))!($G(PSOREEDT)) EX1
"RTN","PSOORED5",145,0)
 K PSORXED("DOSE"),PSORXED("NOUN"),PSORXED("VERB"),PSORXED("DOSE ORDERED"),PSORXED("ROUTE"),SIG,PSORXED("SCHEDULE"),PSORXED("DURATION"),PSORXED("CONJUNCTION"),PSORXED("ODOSE")
"RTN","PSOORED5",146,0)
EX1 K UNITN,STRE,DOSE,DUPD,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSOSCH,ENT,PSORTE,DURA,ERTE,ROU
"RTN","PSOORED5",147,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED5",148,0)
 Q
"RTN","PSOORED5",149,0)
 ;This line tag was added to check if EXit is being performed while EDITing.  If it is,
"RTN","PSOORED5",150,0)
 ;process SIG and do not delete order.  Previous calls to EX when due to $D(DUOUT) were
"RTN","PSOORED5",151,0)
 ;changed to go to this line tag instead.
"RTN","PSOORED5",152,0)
EXE I $G(PSORX("EDIT"))]"" K DUOUT S:$D(ENTBKP) ENT=ENTBKP G EXS  ;*PSO*7.0*450 p555 added ENTBKP
"RTN","PSOORED5",153,0)
 G EX
"RTN","PSOORED5",154,0)
 ;
"RTN","PSOORED5",155,0)
UPD ;updates dosing array
"RTN","PSOORED5",156,0)
 D UPD^PSOORED6
"RTN","PSOORED5",157,0)
 Q
"RTN","PSOORED5",158,0)
JUMP ;
"RTN","PSOORED5",159,0)
 I $G(PSORXED("SCHEDULE",1))']"" W $C(7),!!,"All Dosing Instructions must be entered before Jumping to other Fields!",!! G @FIELD
"RTN","PSOORED5",160,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED5",161,0)
 D FNM^PSOOREDX
"RTN","PSOORED5",162,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED5",163,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED5",164,0)
 D KV
"RTN","PSOORED5",165,0)
 I $G(PSOFROM)'="NEW",'$G(COPY) S DIR("A",1)="* Indicates which fields will create a New Order"
"RTN","PSOORED5",166,0)
 S DIR("A")="Select Field by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED5",167,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED5",168,0)
 G EX
"RTN","PSOORED5",169,0)
 Q
"RTN","PSOORED5",170,0)
LAN ;
"RTN","PSOORED5",171,0)
 Q:'$G(PSODRUG("IEN"))
"RTN","PSOORED5",172,0)
 I $G(OR0),'$G(PSONEW("DOSE ORDERED",II)),$P($G(^PS(55,PSODFN,"LAN")),"^") D  K QI,QII Q
"RTN","PSOORED5",173,0)
 .Q:$G(OTHDOS(II))
"RTN","PSOORED5",174,0)
 .F QI=0:0 S QI=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",QI)) Q:'QI  D  Q:$G(QII)
"RTN","PSOORED5",175,0)
 ..Q:$G(PSONEW("DOSE",II))']""
"RTN","PSOORED5",176,0)
 ..I PSONEW("DOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^") S PSONEW("ODOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^",4),QII=1
"RTN","PSOORED5",177,0)
 I $G(Y),$P($G(DOSE(Y)),"^",13)]"" S PSORXED("ODOSE",ENT)=$P(DOSE(Y),"^",13) Q
"RTN","PSOORED5",178,0)
 K QII F I=0:0 S I=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",I)) Q:'I  I DOSE=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^") D  Q:$G(QII)
"RTN","PSOORED5",179,0)
 .S PSORXED("ODOSE",ENT)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^",4),QII=1
"RTN","PSOORED5",180,0)
 K QII,I
"RTN","PSOORED5",181,0)
 Q
"RTN","PSOORED5",182,0)
 ;
"RTN","PSOORED5",183,0)
SCHASL(SCHA) ;
"RTN","PSOORED5",184,0)
 N SCHEA,SCHFL1 S SCHEA="",SCHFL1=0
"RTN","PSOORED5",185,0)
 ;**Lookup into the ADMINISTRATION SCHEDULE (#51.1) file 
"RTN","PSOORED5",186,0)
 K X,Y,DIC,D SET X=$G(SCHA),DIC="^PS(51.1,",DIC(0)="CEMOV"
"RTN","PSOORED5",187,0)
 S DIC("W")="W ""  ""_$G(X)_""  ""_$P(^PS(51.1,+Y,0),U,8)_$S($P(^(0),U,12):""   **INACTIVE**"",1:"""")"      ;*507
"RTN","PSOORED5",188,0)
 S D="APPSJ^D" W !,"Now searching ADMINISTRATION SCHEDULE (#51.1) file...",! D MIX^DIC1                      ;*507
"RTN","PSOORED5",189,0)
 K DIC,D S:Y'>0 SCHFL1=1 IF '$G(SCHFL1),'$D(DTOUT),'$D(DUOUT) SET SCHEA=$P(Y,U,2) Q SCHEA
"RTN","PSOORED5",190,0)
 I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","PSOORED5",191,0)
 I $G(SCHFL1)=1 S SCHEA=$$SCHMI(SCHA) Q SCHEA
"RTN","PSOORED5",192,0)
 Q ""
"RTN","PSOORED5",193,0)
 ;
"RTN","PSOORED5",194,0)
SCHMI(SCHM) ;
"RTN","PSOORED5",195,0)
 N SCHEM,SCHFL2 S SCHEM="",SCHFL2=0
"RTN","PSOORED5",196,0)
 ;**Lookup into the MEDICATION INSRUCTION (#51) file
"RTN","PSOORED5",197,0)
 K X,Y,DIC,D SET X=$G(SCHM),DIC="^PS(51,",DIC(0)="CEMOV",DIC("W")="W ""  ""_$G(X)_""  ""_$P(^PS(51,+Y,0),U,2)",D="A^B^D" W !,"Now searching MEDICATION INSTRUCTION (#51) file...",! D MIX^DIC1
"RTN","PSOORED5",198,0)
 K DIC,D S:Y'>0 SCHFL2=1 IF '$G(SCHFL2),'$D(DTOUT),'$D(DUOUT) SET SCHEM=$P(Y,U,2) Q SCHEM
"RTN","PSOORED5",199,0)
 ;
"RTN","PSOORED5",200,0)
 I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","PSOORED5",201,0)
 I $G(SCHFL2)=1 Q SCHM
"RTN","PSOORED5",202,0)
 Q ""
"RTN","PSOORED5",203,0)
 ;
"RTN","PSOORED5",204,0)
MRSL ;;check for OI med route short list ;*525
"RTN","PSOORED5",205,0)
 I $G(PSODRUG("OI")) D START^PSSJORDF(PSODRUG("OI"),"O") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSOORED5",206,0)
 . N MRTP S MRTP="PSOTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSOORED5",207,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSOORED5",208,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)="" W !,?10,I_"  "_$P(^TMP("PSJMR",$J,I),U)_"  "_$P(^TMP("PSJMR",$J,I),U,2)
"RTN","PSOORED5",209,0)
 . N DIC S DIC("A")="Select MED ROUTE: ",DIC="^TMP(MRTP,$J,",DIC(0)="AEQZ" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J)
"RTN","PSOORED5",210,0)
 . I Y=-1 S MRQ=1 Q
"RTN","PSOORED5",211,0)
 . S MRSLS=1,X=$P(Y,"^",2)
"RTN","PSOORED5",212,0)
 Q
"RTN","PSOORED5",213,0)
 ;
"RTN","PSOORED5",214,0)
CKMRSL ;;check for med route short list leading letters ;*525
"RTN","PSOORED5",215,0)
 I $G(PSODRUG("OI")) D START^PSSJORDF(PSODRUG("OI"),"O") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSOORED5",216,0)
 . N MRTP S MRTP="PSOTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSOORED5",217,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSOORED5",218,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)=""
"RTN","PSOORED5",219,0)
 . N DIC S DIC("T")="",DIC="^TMP(MRTP,$J,",DIC(0)="EM" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J)
"RTN","PSOORED5",220,0)
 . I Y=-1 Q
"RTN","PSOORED5",221,0)
 . S X=$P(Y,"^",2)
"RTN","PSOORED5",222,0)
 Q
"RTN","PSOORNEW")
0^14^B119452733
"RTN","PSOORNEW",1,0)
PSOORNEW ;BIR/SAB - display orders from oerr ; 8/14/18 1:29pm
"RTN","PSOORNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133,143,237,222,258,206,225,251,386,390,391,372,416,431,313,408,436,411,444,486,446,505,517,508,457**;DEC 1997;Build 116
"RTN","PSOORNEW",3,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORNEW",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORNEW",5,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORNEW",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORNEW",7,0)
 ;External reference to EN1^ORCFLAG supported by DBIA 3620
"RTN","PSOORNEW",8,0)
 ;
"RTN","PSOORNEW",9,0)
 ;PSO*237 quit Finish if Today > Issue date + 365
"RTN","PSOORNEW",10,0)
 ;
"RTN","PSOORNEW",11,0)
DSPL I $G(PSODSPL) S VALMBCK="Q" K PSODSPL,PSOANSQD Q
"RTN","PSOORNEW",12,0)
 Q:'$D(PSOLMC)  K ^TMP("PSOPO",$J) S PSOLMC=PSOLMC+1
"RTN","PSOORNEW",13,0)
 I $D(CLOZPAT) S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),1:7) G OI
"RTN","PSOORNEW",14,0)
 S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3))&('$G(PSONEW("DAYS SUPPLY"))):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORNEW",15,0)
OI I '$G(PSODRUG("OI")) D
"RTN","PSOORNEW",16,0)
 .N OI,OID S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORNEW",17,0)
 .I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR
"RTN","PSOORNEW",18,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A",$G(PSODRUG("DEA"))'["B"!($G(PSODRUG("DEA"))["F") S PSONEW("# OF REFILLS")=0
"RTN","PSOORNEW",19,0)
 I $D(CLOZPAT) S PSONEW("# OF REFILLS")=$S($D(PSONEW("# OF REFILLS")):PSONEW("# OF REFILLS"),$G(CLOZPAT)=2&($P(OR0,"^",11)>2):3,$G(CLOZPAT)&($P(OR0,"^",11)>1):1,1:0)
"RTN","PSOORNEW",20,0)
 S IEN=0 D OBX^PSOORFI1,DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNEW",21,0)
 D LMDISP^PSOORFI5(+$G(ORD)) ; Display Flag/Unflag Information
"RTN","PSOORNEW",22,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNEW",23,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",24,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PT
"RTN","PSOORNEW",25,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNEW",26,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",27,0)
 .I $P($G(^PSDRUG(PSODRUG("IEN"),0)),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG
"RTN","PSOORNEW",28,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORNEW",29,0)
PT D DOSE2^PSOORFI4
"RTN","PSOORNEW",30,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D:$O(PSONEW("SIG",0)) INST^PSOORFI4
"RTN","PSOORNEW",31,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST^PSOORFI1
"RTN","PSOORNEW",32,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST^PSOORFI1
"RTN","PSOORNEW",33,0)
 K PSOELSE S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:"
"RTN","PSOORNEW",34,0)
 F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D
"RTN","PSOORNEW",35,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNEW",36,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORNEW",37,0)
 K PSOELSE I $G(PSONEW("ISSUE DATE"))']"" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,"^",6),1,7) X ^DD("DD") S PSONEW("ISSUE DATE")=Y,^TMP("PSOPO",$J,IEN,0)=" (4)     Issue Date: "_Y
"RTN","PSOORNEW",38,0)
 I '$G(PSOELSE) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORNEW",39,0)
 K PSOELSE I $G(PSORX("FILL DATE"))']"" S PSOELSE=1 D
"RTN","PSOORNEW",40,0)
 .S (Y,PSORX("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSONEW("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                  (5) Fill Date: "_Y
"RTN","PSOORNEW",41,0)
 I '$G(PSOELSE) S Y=PSORX("FILL DATE") X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"       (7) Fill Date: "_PSORX("FILL DATE")
"RTN","PSOORNEW",42,0)
 I $P(OR0,"^",18) S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORNEW",43,0)
 I $D(CLOZPAT) D ELIG^PSOORFI2 S:'$D(PSONEW("QTY")) PSONEW("QTY")=0
"RTN","PSOORNEW",44,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",45,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"               (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+PSODRUG("IEN"),660)),"^",8)_")",1:" (  )")
"RTN","PSOORNEW",46,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_": "_$S($G(PSONEW("QTY"))]"":PSONEW("QTY"),1:$P(OR0,"^",10))
"RTN","PSOORNEW",47,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORNEW",48,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNEW",49,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORNEW",50,0)
 S IEN=IEN+1
"RTN","PSOORNEW",51,0)
 I $P(OR0,"^",24) S ^TMP("PSOPO",$J,IEN,0)="   Provider ordered: days supply "_+$P(OR0,"^",22)_", quantity "_+$P(OR0,"^",10)_" & refills "_+$P(OR0,"^",11)
"RTN","PSOORNEW",52,0)
 E  S ^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORNEW",53,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORNEW",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_$S($G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),1:$P(OR0,"^",11))_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORNEW",55,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORNEW",56,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORNEW",57,0)
 D:$P(OR0,"^",24)!((+$G(PSODRUG("DEA"))>1)&(+$G(PSODRUG("DEA"))<6)) PRV^PSOORFI5($G(PSONEW("PROVIDER")),$G(PSODRUG("IEN")),$P(OR0,"^"))
"RTN","PSOORNEW",58,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) D
"RTN","PSOORNEW",59,0)
 .S IEN=IEN+1,PSONEW("COSIGNING PROVIDER")=$S($G(PSONEW("COSIGNING PROVIDER")):PSONEW("COSIGNING PROVIDER"),1:$P(^("PS"),"^",8))
"RTN","PSOORNEW",60,0)
 .S ^TMP("PSOPO",$J,IEN,0)="       Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNEW",61,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNEW",62,0)
 S PSONEW("REMARKS")=$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),$P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORNEW",63,0)
 K PSONEW("ADMINCLINIC") S:$P(OR0,"^",17)="C" PSONEW("ADMINCLINIC")=1
"RTN","PSOORNEW",64,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks:"
"RTN","PSOORNEW",65,0)
 I $G(PSONEW("REMARKS"))]"" D
"RTN","PSOORNEW",66,0)
 .F SG=1:1:$L(PSONEW("REMARKS")) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("REMARKS")," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",67,0)
 ..S:$P(PSONEW("REMARKS")," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("REMARKS")," ",SG)
"RTN","PSOORNEW",68,0)
 I $G(PSOSIGFL)!(PSODRUG("OI")'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P(^VA(200,DUZ,0),"^"),VALMSG="This change will create a new prescription!"
"RTN","PSOORNEW",69,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,PSONEW("CLERK CODE"),0),"^")_$E(RN,$L($P(^VA(200,PSONEW("CLERK CODE"),0),"^"))+1,35)
"RTN","PSOORNEW",70,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNEW",71,0)
 I PSOLMC<2 D ^PSOLMPO1 S VALMBCK="Q",PSOLMC=0
"RTN","PSOORNEW",72,0)
 S:PSOLMC>1 VALMBCK="R"
"RTN","PSOORNEW",73,0)
 Q
"RTN","PSOORNEW",74,0)
ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4
"RTN","PSOORNEW",75,0)
 Q
"RTN","PSOORNEW",76,0)
EDT D KV S DIR("A",1)="* Indicates which fields will create an new Order",DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:15" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOORNEW",77,0)
EDTSEL N LST,FLD,OUT,CHECK,CSDRG D KV S (OUT,CSDRG)=0 ;/BLB/ PSO*7.0*505/517 MODIFIED EDIT FUNCTIONALITY TO BLOCK CERTAIN FIELDS FOR CONTROLLED SUBSTANCE RX
"RTN","PSOORNEW",78,0)
 I '$D(PSODRG) S PSODRG=$G(PSODRUG("IEN"))
"RTN","PSOORNEW",79,0)
 I PSODRG,$$NDF(PSODRG)!($$CSDRG(PSODRG)) S CSDRG=1
"RTN","PSOORNEW",80,0)
 I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL
"RTN","PSOORNEW",81,0)
 .I CSDRG,(","_LST[",1,")!(","_LST[",3,")!(","_LST[",10,")!(","_LST[",13,") D
"RTN","PSOORNEW",82,0)
 ..W !!,"The selection includes field(s) that are not editable" W !,"for controlled substances. These field(s) will be skipped.",!
"RTN","PSOORNEW",83,0)
 ..S DIR(0)="E" D ^DIR K DIR
"RTN","PSOORNEW",84,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""!(OUT)  D
"RTN","PSOORNEW",85,0)
 ..S CHECK=","_+$P(LST,",",FLD)_"," I CSDRG,",1,3,10,13,"[CHECK Q
"RTN","PSOORNEW",86,0)
 ..D @(+$P(LST,",",FLD)) D:$P(LST,",",FLD)=8 REF D KV
"RTN","PSOORNEW",87,0)
 E  S VALMBCK="" Q
"RTN","PSOORNEW",88,0)
ACP ;
"RTN","PSOORNEW",89,0)
 N PSOORNEW,DIR,Y S Y=0,PSOORNEW=1
"RTN","PSOORNEW",90,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORNEW",91,0)
 . D FULL^VALM1
"RTN","PSOORNEW",92,0)
 . I '$D(^XUSEC("PSORPH",DUZ)) D  S Y=0 Q
"RTN","PSOORNEW",93,0)
 . . S DIR("A",1)="Order must be unflagged by a pharmacist before it can be finished."
"RTN","PSOORNEW",94,0)
 . . S DIR("A",2)=""
"RTN","PSOORNEW",95,0)
 . . S DIR(0)="E",DIR("A")="Enter RETURN to continue" W !,$C(7) D ^DIR
"RTN","PSOORNEW",96,0)
 . . S VALMBCK="R"
"RTN","PSOORNEW",97,0)
 . D KV
"RTN","PSOORNEW",98,0)
 . S DIR("A",1)="This Order is flagged. In order to finish it"
"RTN","PSOORNEW",99,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORNEW",100,0)
 . S DIR("A",3)=""
"RTN","PSOORNEW",101,0)
 . S DIR(0)="Y",DIR("A")="Unflag Order",DIR("B")="NO"
"RTN","PSOORNEW",102,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORNEW",103,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORNEW",104,0)
 ;
"RTN","PSOORNEW",105,0)
 ;/MZR edited next line in case QTY not defined *457
"RTN","PSOORNEW",106,0)
 I $D(CLOZPAT),+$G(PSONEW("QTY"))=0 S PSONEW("QTY")=$P(OR0,"^",10)
"RTN","PSOORNEW",107,0)
 S (PSODIR("DFLG"),PSORX("DFLG"),PSODIR("QFLD"))=0,ACP=1 D ORCHK
"RTN","PSOORNEW",108,0)
 G:$G(PSONEW("QFLG")) DSPL
"RTN","PSOORNEW",109,0)
 I $G(PSODIR("DFLG"))!$G(PSORX("DFLG")) Q
"RTN","PSOORNEW",110,0)
 I $G(PSONEW("FLD"))!($G(PSODRUG("NAME"))']"")!('$O(SIG(0))) G DSPL
"RTN","PSOORNEW",111,0)
 ;PATCH PSO*7*517 - Blocking action FN if issuing a controlled substance to a patient without a zipcode
"RTN","PSOORNEW",112,0)
 S DRGIEN=$G(PSODRUG("IEN"))
"RTN","PSOORNEW",113,0)
 I $$CSBLOCK(PSODFN,DRGIEN) D  S DIR(0)="E" W ! D ^DIR K DIR K Y Q
"RTN","PSOORNEW",114,0)
 .W !,"Controlled substance prescriptions require a patient address. Please update"
"RTN","PSOORNEW",115,0)
 .W !,"patient address information. This action will also invalidate a digitally"
"RTN","PSOORNEW",116,0)
 .W !,"signed prescription and require the provider to re-enter the order."
"RTN","PSOORNEW",117,0)
 ;PSO*7*517 - END
"RTN","PSOORNEW",118,0)
 I $G(PSODRUG("NAME"))]"",'$G(ORCHK)!($G(ORDRG)'=PSODRUG("NAME")) D  I $G(PSORX("DFLG")) Q  ; *457 fixed wrong flow D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",119,0)
 . D POST^PSODRG S:'$G(PSORX("DFLG")) ORCHK=1,ORDRG=PSODRUG("NAME")
"RTN","PSOORNEW",120,0)
 D:'$G(PSORX("DFLG")) DOSCK^PSODOSUT("N") I $G(PSORX("DFLG")) G DSPL
"RTN","PSOORNEW",121,0)
 I '$D(PSONEW("RX #")) S PSOFROM="NEW",RTN=$S($P($G(PSOPAR),"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN") D @RTN Q:PSONEW("QFLG")  I '$P($G(PSOPAR),"^",7) S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSOORNEW",122,0)
 D RXNCHK^PSOORNE1 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 Q
"RTN","PSOORNEW",123,0)
 I DT>$$FMADD^XLFDT($P(OR0,"^",6),365) D EXPR^PSONEW2 G DSPL
"RTN","PSOORNEW",124,0)
 D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF
"RTN","PSOORNEW",125,0)
 I $G(PSOCPZ("DFLG")) W !!,"No action taken!",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR,KV K PSOCPZ("DFLG"),DRET,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",126,0)
 ;
"RTN","PSOORNEW",127,0)
 K PSOCPZ("DFLG") D KV S DIR(0)="Y",DIR("A")="Are you sure you want to Accept this Order",DIR("B")="NO" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",128,0)
 D KV I 'Y K PSOANSQ G DSPL
"RTN","PSOORNEW",129,0)
 I $G(PSONEW("MAIL/WINDOW"))["W" D:$P($G(PSOPAR),"^",12)  S BINGCRT="Y",BINGRTE="W",PSORX("MAIL/WINDOW")="WINDOW" K RTN
"RTN","PSOORNEW",130,0)
 .W ! K DIR,DIRUT S DIR(0)="52,35O"
"RTN","PSOORNEW",131,0)
 .S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP") D ^DIR I $D(DIRUT) K DIR,DIRUT Q
"RTN","PSOORNEW",132,0)
 .S (PSONEW("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y K X,Y
"RTN","PSOORNEW",133,0)
 S PSONEW("POE")=1 K PSORX("DFLG"),PSONEW("DFLG") D EN^PSON52(.PSONEW) G:$G(PSONEW("DFLG")) ABORT D DCORD^PSONEW2 D:$G(PKI)=89802020 ALERT^PSOPKIV1
"RTN","PSOORNEW",134,0)
 ; - Possible Titration Rx?
"RTN","PSOORNEW",135,0)
 I $G(PSONEW("IRXN")) D MARK^PSOOTMRX(PSONEW("IRXN"),0)
"RTN","PSOORNEW",136,0)
 ;saves drug allergy order chks pso*7*390
"RTN","PSOORNEW",137,0)
 I $D(^TMP("PSODAOC",$J)) D
"RTN","PSOORNEW",138,0)
 .I $G(PSORX("DFLG")) K ^TMP("PSODAOC",$J) Q
"RTN","PSOORNEW",139,0)
 .S RXN=PSONEW("IRXN"),PSODAOC="Finished CPRS Rx "_$S($P(^PSRX(RXN,"STA"),"^")=4:"NON-VERIFIED ",1:"")_"Order Acceptance_OP"
"RTN","PSOORNEW",140,0)
 .D DAOC^PSONEW
"RTN","PSOORNEW",141,0)
 D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX("MAIL/WINDOW")
"RTN","PSOORNEW",142,0)
 ; PSO*7*508 - link the erx to the outpatient prescription
"RTN","PSOORNEW",143,0)
 N ERXIEN
"RTN","PSOORNEW",144,0)
 S ERXIEN=$$CHKERX^PSOERXU1(OR0) I ERXIEN D
"RTN","PSOORNEW",145,0)
 .S ERXFDA(52.49,ERXIEN_",",.13)=PSONEW("IRXN") D FILE^DIE(,"ERXFDA") K ERXFDA
"RTN","PSOORNEW",146,0)
 ; PSO*7*508 - end eRx enhancement
"RTN","PSOORNEW",147,0)
 D EOJ^PSONEW
"RTN","PSOORNEW",148,0)
ABORT S VALMBCK="Q",DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR,CLEAN^PSOVER1,KV
"RTN","PSOORNEW",149,0)
 Q
"RTN","PSOORNEW",150,0)
KV K DIRUT,DUOUT,DTOUT,DIR,PSOEDDOS
"RTN","PSOORNEW",151,0)
 Q
"RTN","PSOORNEW",152,0)
REF ;
"RTN","PSOORNEW",153,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSOORNEW",154,0)
 N MAXRF S MAXRF=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),+$G(PSONEW("DAYS SUPPLY")),+$G(PSONEW("PATIENT STATUS")),.CLOZPAT)
"RTN","PSOORNEW",155,0)
 I ($G(PSONEW("# OF REFILLS"))'="")&($G(PSONEW("# OF REFILLS"))'>MAXRF) D
"RTN","PSOORNEW",156,0)
 . S PSONEW("N# REF")=PSONEW("# OF REFILLS")
"RTN","PSOORNEW",157,0)
 E  D
"RTN","PSOORNEW",158,0)
 . S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=MAXRF
"RTN","PSOORNEW",159,0)
 Q
"RTN","PSOORNEW",160,0)
1 I $P($G(OR0),"^",24) D  Q
"RTN","PSOORNEW",161,0)
 . W !!,"Digitally Signed Order - Orderable Item cannot be changed",! D PZ
"RTN","PSOORNEW",162,0)
 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi
"RTN","PSOORNEW",163,0)
 ;
"RTN","PSOORNEW",164,0)
4 D INS^PSOORNW2 Q
"RTN","PSOORNEW",165,0)
 ;
"RTN","PSOORNEW",166,0)
3 I $G(LST)["3,",$P(OR0,"^",24) D  Q 
"RTN","PSOORNEW",167,0)
 . W !!,"Digitally Signed Order - Dose cannot be changed",! D PZ
"RTN","PSOORNEW",168,0)
 N PSOEDDOS S PSOEDDOS=1 D DOSE^PSOORED4(.PSONEW) Q
"RTN","PSOORNEW",169,0)
 ;
"RTN","PSOORNEW",170,0)
6 D 4^PSOORNW2 Q  ;idt
"RTN","PSOORNEW",171,0)
 ;
"RTN","PSOORNEW",172,0)
7 D 5^PSOORNW2 Q  ;fdt
"RTN","PSOORNEW",173,0)
 ;
"RTN","PSOORNEW",174,0)
5 D 3^PSOORNW2 Q  ;pstat
"RTN","PSOORNEW",175,0)
 ;
"RTN","PSOORNEW",176,0)
13 I $P($G(OR0),"^",24) D  Q
"RTN","PSOORNEW",177,0)
 . W !!,"Digitally Signed Order - Provider cannot be changed",! D PZ
"RTN","PSOORNEW",178,0)
 D 12^PSOORNW2 Q  ;doc
"RTN","PSOORNEW",179,0)
 ;
"RTN","PSOORNEW",180,0)
12 D 11^PSOORNW2 Q  ;cli
"RTN","PSOORNEW",181,0)
 ;
"RTN","PSOORNEW",182,0)
2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1,PSOQFLG=0
"RTN","PSOORNEW",183,0)
 N CPRN S CPRN=+$P($G(OR0),"^",24) D 2^PSOORNW1 Q:$G(PSOQFLG)  D EN^PSODIAG  ;drg/ICD
"RTN","PSOORNEW",184,0)
 I $G(PSOCSIG) K PSOCSIG G 3
"RTN","PSOORNEW",185,0)
 Q
"RTN","PSOORNEW",186,0)
 ;
"RTN","PSOORNEW",187,0)
9 D 8^PSOORNW2 Q  ;qty
"RTN","PSOORNEW",188,0)
 ;
"RTN","PSOORNEW",189,0)
8 N CPRN S CPRN=+$P($G(OR0),"^",24) D 7^PSOORNW2 Q  ;ds
"RTN","PSOORNEW",190,0)
 ;
"RTN","PSOORNEW",191,0)
10 I $P($G(OR0),"^",24) D  Q
"RTN","PSOORNEW",192,0)
 . W !!,"Digitally Signed Order - Refills cannot be changed",! D PZ
"RTN","PSOORNEW",193,0)
 D 9^PSOORNW2 Q  ;#rfs
"RTN","PSOORNEW",194,0)
 ;
"RTN","PSOORNEW",195,0)
14 D 13^PSOORNW2 Q  ;cop
"RTN","PSOORNEW",196,0)
 ;
"RTN","PSOORNEW",197,0)
11 D 10^PSOORNW2 Q  ;m/w
"RTN","PSOORNEW",198,0)
 ;
"RTN","PSOORNEW",199,0)
15 D 14^PSOORNW2 Q  ;rem
"RTN","PSOORNEW",200,0)
 ;
"RTN","PSOORNEW",201,0)
DRGMSG ;
"RTN","PSOORNEW",202,0)
 F SG=1:1:$L($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",203,0)
 .S:$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)
"RTN","PSOORNEW",204,0)
 K SG
"RTN","PSOORNEW",205,0)
 Q
"RTN","PSOORNEW",206,0)
 ;
"RTN","PSOORNEW",207,0)
PZ ;
"RTN","PSOORNEW",208,0)
 N DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR W !
"RTN","PSOORNEW",209,0)
 Q
"RTN","PSOORNEW",210,0)
CSDRG(DRGIEN) ;/BLB/ Patch PSO*7*505/517 Controlled Substance drug?
"RTN","PSOORNEW",211,0)
 ; Input: DRGIEN - DRUG file (#50) pointer 
"RTN","PSOORNEW",212,0)
 ;Output: $$CS - 1:YES / 0:NO
"RTN","PSOORNEW",213,0)
 N DEA
"RTN","PSOORNEW",214,0)
 Q:'DRGIEN 0
"RTN","PSOORNEW",215,0)
 S DEA=$$GET1^DIQ(50,DRGIEN,3)
"RTN","PSOORNEW",216,0)
 I (DEA'["0"),(DEA'["M"),(DEA["2")!(DEA["3")!(DEA["4")!(DEA["5") Q 1
"RTN","PSOORNEW",217,0)
 Q 0
"RTN","PSOORNEW",218,0)
NDF(DRGIEN) ;PATCH PSO*7*505/517 - 1:YES 0:NO checks the cs federal schedule field of the va product file
"RTN","PSOORNEW",219,0)
 N DEARES,VPROD
"RTN","PSOORNEW",220,0)
 S VPROD=$$GET1^DIQ(50,DRGIEN,22,"I") Q:'VPROD 0
"RTN","PSOORNEW",221,0)
 S DEARES=$$GET1^DIQ(50.68,VPROD,19,"I")
"RTN","PSOORNEW",222,0)
 I +$E(DEARES)>0 Q 1
"RTN","PSOORNEW",223,0)
 Q 0
"RTN","PSOORNEW",224,0)
CSBLOCK(DFN,DIEN) ;
"RTN","PSOORNEW",225,0)
 N VAPA
"RTN","PSOORNEW",226,0)
 D ADD^VADPT
"RTN","PSOORNEW",227,0)
 I DIEN,$$CSDRG(DIEN)!($$NDF(DIEN)),($$UP^XLFSTR($P(VAPA(25),U,2))'="UNITED STATES") Q 0
"RTN","PSOORNEW",228,0)
 I DIEN,$$CSDRG(DIEN)!($$NDF(DIEN)),('$L(VAPA(6))),('$L(VAPA(11))) Q 1
"RTN","PSOORNEW",229,0)
 Q 0
"RTN","PSORENW")
0^16^B54413066
"RTN","PSORENW",1,0)
PSORENW ; BIR/SAB - renew main driver ;15 March 2019 16:08:45
"RTN","PSORENW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,30,46,71,96,100,130,148,206,388,390,417,313,411,504,508,550,457**;DEC 1997;Build 116
"RTN","PSORENW",3,0)
 ;External reference to ^PSDRUG( supported by DBIA 221
"RTN","PSORENW",4,0)
 ;External reference to $$L^PSSLOCK supported by DBIA 2789
"RTN","PSORENW",5,0)
 ;External reference to UL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW",6,0)
 ;External reference to PSOL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW",7,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW",8,0)
 ;External reference to LK^ORX2 supported by DBIA 867
"RTN","PSORENW",9,0)
 ;External reference to ULK^ORX2 supported by DBIA 867
"RTN","PSORENW",10,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW",11,0)
 ;External reference to MAIN^TIUEDIT supported by DBIA 2410
"RTN","PSORENW",12,0)
 ;
"RTN","PSORENW",13,0)
ASK ;
"RTN","PSORENW",14,0)
 K PSORENW("FILL DATE"),ZZCOPY D FILLDT^PSODIR2(.PSORENW) S:$G(PSORENW("DFLG")) VALMSG="Renew Rx request cancelled",VALMBCK="R"
"RTN","PSORENW",15,0)
 I PSORENW("DFLG")!('$D(PSORENW("FILL DATE"))) S PSORENW("QFLG")=1,PSORENW("DFLG")=0 G ASKX
"RTN","PSORENW",16,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW",17,0)
 D MW^PSOCMOPA(.PSORENW)
"RTN","PSORENW",18,0)
 I PSORENW("DFLG") S PSORENW("QFLG")=1,PSORENW("DFLG")=0 G ASKX
"RTN","PSORENW",19,0)
 S PSORNW("MAIL/WINDOW")=PSORENW("MAIL/WINDOW") S PSORX("MAIL/WINDOW")=$S(PSORENW("MAIL/WINDOW")="M":"MAIL",1:"WINDOW")
"RTN","PSORENW",20,0)
 D NOORE^PSONEW(.PSORENW) S:$G(PSORENW("DFLG")) VALMSG="Renew Rx request cancelled",VALMBCK="R"
"RTN","PSORENW",21,0)
 I PSORENW("DFLG")!('$D(PSORENW("FILL DATE"))) S PSORENW("QFLG")=1,PSORENW("DFLG")=0
"RTN","PSORENW",22,0)
ASKX Q
"RTN","PSORENW",23,0)
 ;
"RTN","PSORENW",24,0)
EOJ ;
"RTN","PSORENW",25,0)
 K VERB,RTE,DRET,PSOMSG,PSORNW,PSOLIST,PSORENW,PSORX("BAR CODE"),PSORX("FILL DATE"),PSODIR,PSOID,PSONOOR,PSOCOU,PSOCOUU,PSOID,PSOFDMX,PSODRUG,COPY,PSOBCKDR
"RTN","PSORENW",26,0)
 N ZRXN
"RTN","PSORENW",27,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN S ZRXN=RXN D
"RTN","PSORENW",28,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW",29,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW",30,0)
 .;saves drug allergy order chks pso*7*411
"RTN","PSORENW",31,0)
 .I $D(^TMP("PSODAOC",$J)) D  Q:$G(PSORX("DFLG"))
"RTN","PSORENW",32,0)
 ..I $G(PSORX("DFLG")) K ^TMP("PSODAOC",$J) Q
"RTN","PSORENW",33,0)
 ..S RXN=ZRXN
"RTN","PSORENW",34,0)
 .S PSOARENW=1 D DAOC^PSONEW K PSOARENW
"RTN","PSORENW",35,0)
 I $G(PSORNEDT),'$O(^TMP("PSORXN",$J,0)),$D(^TMP("PSODAOC",$J)) S ZRXN=PSORNEDT,PSOARENW=1 D DAOC^PSONEW K PSOARENW,PSORNEDT
"RTN","PSORENW",36,0)
 K ZZCOPY,ZRXN,RXN,RXN1,^TMP("PSORXN",$J),^TMP("PSODAOC",$J)
"RTN","PSORENW",37,0)
 I $G(PSONOTE) D MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1)
"RTN","PSORENW",38,0)
 K PSONOTE
"RTN","PSORENW",39,0)
 Q
"RTN","PSORENW",40,0)
OERR ;entry for renew backdoor
"RTN","PSORENW",41,0)
 N PSORNEDT,PSORXIEN,PSOCHECK
"RTN","PSORENW",42,0)
 S PSORXIEN=+$P($G(PSOLST(ORN)),"^",2) D:PSORXIEN>0  ; Clozapine check
"RTN","PSORENW",43,0)
 . N PSDRGIEN S PSDRGIEN=$$GET1^DIQ(52,PSORXIEN,6,"I")  ; drug IEN
"RTN","PSORENW",44,0)
 . Q:'PSDRGIEN
"RTN","PSORENW",45,0)
 . I $$GET1^DIQ(50,PSDRGIEN,17.5)="PSOCLO1" S VALMSG="Cannot Renew a Clozapine Order",VALMBCK="R",PSORXIEN=0 W $C(7)
"RTN","PSORENW",46,0)
 Q:'(PSORXIEN>0)  ; didn't pass Clozapine check
"RTN","PSORENW",47,0)
 ; Checking whether the Provider still qualifies as prescriber for the renewed Rx
"RTN","PSORENW",48,0)
 S PSOCHECK=$$CHKRXPRV^PSOUTIL(PSORXIEN)
"RTN","PSORENW",49,0)
 I 'PSOCHECK S VALMSG=$P(PSOCHECK,"^",2),VALMBCK="R" W $C(7) Q
"RTN","PSORENW",50,0)
 I $$TITRX^PSOUTL(PSORXIEN)="t" D  Q
"RTN","PSORENW",51,0)
 . S VALMSG="Cannot Renew a 'Titration Rx'.",VALMBCK="R" W $C(7)
"RTN","PSORENW",52,0)
 I $$LMREJ^PSOREJU1(PSORXIEN,,.VALMSG,.VALMBCK) Q
"RTN","PSORENW",53,0)
 ; PSO*7*508 - check if the Rx is an eRx. If so, inform the user and ask to proceed.
"RTN","PSORENW",54,0)
 N ERXORN,ERXIEN,ERXPROC S ERXORN=$$GET1^DIQ(52,$P(PSOLST(ORN),U,2),39.3)
"RTN","PSORENW",55,0)
 S ERXIEN=$$CHKERX^PSOERXU1(ERXORN)
"RTN","PSORENW",56,0)
 I ERXIEN D FULL^VALM1 S ERXPROC=$$PROVPMT^PSOERXU1(ERXIEN) Q:'ERXPROC
"RTN","PSORENW",57,0)
 ; PSO*7*508 - end
"RTN","PSORENW",58,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW",59,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW",60,0)
 K PSOID,PSOFDMX,PSORX("FILL DATE"),PSORENW("FILL DATE"),PSORX("QS"),PSORENW("QS"),PSOBARCD,COPY
"RTN","PSORENW",61,0)
 D PSOL^PSSLOCK(PSORXIEN) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULPAT Q
"RTN","PSORENW",62,0)
 S PSOBCKDR=1,PSOFROM="NEW",PSORENW("OIRXN")=PSORXIEN,PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0
"RTN","PSORENW",63,0)
 S PSONEW("DAYS SUPPLY")=$P(^PSRX(PSORENW("OIRXN"),0),"^",8),PSONEW("# OF REFILLS")=$P(^(0),"^",9)
"RTN","PSORENW",64,0)
 D FULL^VALM1,ASK D:PSORENW("QFLG") KLIB^PSORENW1 D:PSORENW("QFLG") ULPAT D:PSORENW("QFLG") PSOUL^PSSLOCK(PSORXIEN) G:PSORENW("QFLG") EOJ D ^PSORENW0
"RTN","PSORENW",65,0)
 D ULPAT,EOJ,KLIB^PSORENW1 K PSOOPT,PSONEW,PSORX("DFLG"),X,Y
"RTN","PSORENW",66,0)
 Q
"RTN","PSORENW",67,0)
ULPAT K PSOMSG D UL^PSSLOCK(PSODFN) S X=PSODFN_";DPT(" D ULK^ORX2 K X
"RTN","PSORENW",68,0)
 Q
"RTN","PSORENW",69,0)
RENEW(PLACER,PSOCPDRG) ;passes flag to CPRS for front door renews
"RTN","PSORENW",70,0)
 ;-1=couldn't find order, 0=unable to renew, 1=renewable
"RTN","PSORENW",71,0)
 ;Placer=Pharmacy number
"RTN","PSORENW",72,0)
 N PSOSURX,PSORFRM,PSOLC,PSODRG,PSODRUG0,RXN,ST,PSONEWOI,PSOOLDOI,PSOIFLAG,PSOINA,RX0,X1,X2
"RTN","PSORENW",73,0)
 I $G(PLACER)["S"!('$G(PLACER)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSORENW",74,0)
 S RXN=PLACER I '$D(^PSRX(RXN,0)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSORENW",75,0)
 S RX0=^PSRX(RXN,0),PSODRG=+$P(^PSRX(RXN,0),"^",6),ST=+^("STA"),PSODRUG0=^PSDRUG(PSODRG,0)
"RTN","PSORENW",76,0)
 S PSOIFLAG=0,PSOOLDOI=+$P($G(^PSRX(RXN,"OR1")),"^"),PSONEWOI=+$P($G(^PSDRUG(+$G(PSODRG),2)),"^") I PSONEWOI,PSONEWOI'=PSOOLDOI S PSOIFLAG=1
"RTN","PSORENW",77,0)
 S PSOINA=$P($G(^PS(50.7,PSONEWOI,0)),"^",4)
"RTN","PSORENW",78,0)
 I PSOINA,DT>PSOINA Q "0^This Orderable Item has been Inactivated."
"RTN","PSORENW",79,0)
 I ST=5 S PSOSURX=$O(^PS(52.5,"B",RXN,0)) I PSOSURX,$P($G(^PS(52.5,PSOSURX,0)),"^",7)="L" Q "0^Rx loading into a CMOP Transmission."
"RTN","PSORENW",80,0)
 S X1=DT,X2=-120 D C^%DTC I $P($G(^PSRX(RXN,2)),"^",6)<X Q "0^Prescription Expired more than 120 Days."
"RTN","PSORENW",81,0)
 S X1=DT,X2=-120 D C^%DTC I $P($G(^PSRX(RXN,3)),"^",5),$P($G(^(3)),"^",5)<X,$P(^("STA"),"^")=12 Q "0^Prescription Discontinued more than 120 Days."
"RTN","PSORENW",82,0)
 I $G(PSOCPDRG),$G(PSOCPDRG)'=$G(PSODRG) Q "0^Drug Mismatch, Non-Renewable."
"RTN","PSORENW",83,0)
 N PSOOCPRX,PSOOLPF,PSOOLPD,PSONOSIG S PSOOCPRX=RXN D CDOSE^PSORENW0 I PSOOLPF Q "0^Non-Renewable, invalid Dosage of "_$G(PSOOLPD)
"RTN","PSORENW",84,0)
 I PSONOSIG Q "0^Non-Renewable, missing Sig."
"RTN","PSORENW",85,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" Q "0^Drug is No longer used by Outpatient Pharmacy."
"RTN","PSORENW",86,0)
 I $G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) Q "0^This Drug has been Inactivated."
"RTN","PSORENW",87,0)
 I ($P(PSODRUG0,"^",3)[1)!($P(PSODRUG0,"^",3)[2)!($P(PSODRUG0,"^",3)["W") Q "0^Non-Renewable "_$S($P(PSODRUG0,"^",3)["A":"Drug Narcotic.",1:"Drug.")
"RTN","PSORENW",88,0)
 I $D(^PS(53,+$P(RX0,"^",3),0)),'$P(^(0),"^",5) Q "0^Non-Renewable Prescription."
"RTN","PSORENW",89,0)
 S PSOLC=$P(RX0,"^"),PSOLC=$E(PSOLC,$L(PSOLC)) I $A(PSOLC)'<90 Q "0^Max number of renewals (26) has been reached."
"RTN","PSORENW",90,0)
 I ST,ST'=2,ST'=5,ST'=6,ST'=11,ST'=12,ST'=14 Q "0^Prescription is in a Non-Renewable Status."
"RTN","PSORENW",91,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",4) Q "0^Duplicate Rx Renewal Request."
"RTN","PSORENW",92,0)
 I $O(^PS(52.41,"AQ",RXN,0)) Q "0^Duplicate Rx Renewal Request."
"RTN","PSORENW",93,0)
 N TITMSG
"RTN","PSORENW",94,0)
 I $$TITRX^PSOUTL(RXN)="t" D  Q TITMSG
"RTN","PSORENW",95,0)
 . S TITMSG="0^Prescription was marked as 'Titration to Maintenance Dose' by Pharmacy and cannot be renewed."
"RTN","PSORENW",96,0)
 . S TITMSG=TITMSG_" To repeat the titration, enter a new prescription or copy the prior titration order."
"RTN","PSORENW",97,0)
 . S TITMSG=TITMSG_" To continue the maintenance dose, refill this prescription if refills are available"
"RTN","PSORENW",98,0)
 . S TITMSG=TITMSG_" or enter a new prescription for the maintenance dose."
"RTN","PSORENW",99,0)
 K PSORFRM,PSOLC,PSODRG,PSODRUG0,RXN,ST,TITMSG
"RTN","PSORENW",100,0)
 Q 1_$S($G(PSOIFLAG):"^"_$G(PSONEWOI),1:"")
"RTN","PSORENW",101,0)
 ;
"RTN","PSORENW",102,0)
INST1 ;Set Pharmacy Instructions array
"RTN","PSORENW",103,0)
 N PSOTZ
"RTN","PSORENW",104,0)
 I $O(^PSRX(RXN,"PI",0)) S PHI=$G(^PSRX(RXN,"PI",0)),PSOTZ=0 D
"RTN","PSORENW",105,0)
 .F  S PSOTZ=$O(^PSRX(RXN,"PI",PSOTZ)) Q:PSOTZ=""  S PHI(PSOTZ)=$G(^PSRX(RXN,"PI",PSOTZ,0))
"RTN","PSORENW",106,0)
 Q
"RTN","PSORENW",107,0)
INST2 ;Set Instructions and Comments
"RTN","PSORENW",108,0)
 I '$G(PSORENW("OIRXN")) Q
"RTN","PSORENW",109,0)
 I $G(PSOFDR) Q
"RTN","PSORENW",110,0)
 N PSOPHL,PSOPRL
"RTN","PSORENW",111,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) K PHI S PHI=$G(^PSRX(PSORENW("OIRXN"),"PI",0)),PSOPHL="" D
"RTN","PSORENW",112,0)
 .F  S PSOPHL=$O(^PSRX(PSORENW("OIRXN"),"PI",PSOPHL)) Q:PSOPHL=""  S PHI(PSOPHL)=$G(^PSRX(PSORENW("OIRXN"),"PI",PSOPHL,0))
"RTN","PSORENW",113,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PRC",0)) K PRC S PRC=$G(^PSRX(PSORENW("OIRXN"),"PRC",0)),PSOPRL="" D
"RTN","PSORENW",114,0)
 .F  S PSOPRL=$O(^PSRX(PSORENW("OIRXN"),"PRC",PSOPRL)) Q:PSOPRL=""  S PRC(PSOPRL)=$G(^PSRX(PSORENW("OIRXN"),"PRC",PSOPRL,0))
"RTN","PSORENW",115,0)
 Q
"RTN","PSORENW0")
0^2^B98608427
"RTN","PSORENW0",1,0)
PSORENW0 ;IHS/DSD/JCM-renew main driver continuation ;15 May 2019 18:14:18
"RTN","PSORENW0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,59,64,46,71,96,100,130,237,206,251,375,379,372,411,518,457**;DEC 1997;Build 116
"RTN","PSORENW0",3,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW0",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW0",5,0)
 ;External reference to PSOL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW0",6,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW0",7,0)
 ;
"RTN","PSORENW0",8,0)
 ;PSO*237 was not adding to Clozapine Override file, fix
"RTN","PSORENW0",9,0)
PROCESS ;
"RTN","PSORENW0",10,0)
 D ^PSORENW1
"RTN","PSORENW0",11,0)
 D INST2^PSORENW
"RTN","PSORENW0",12,0)
 I $D(PSORX("BAR CODE")),PSODFN'=PSORENW("PSODFN") D NEWPT
"RTN","PSORENW0",13,0)
 S PSORENW("DFLG")=0,PSORENW("FILL DATE")=PSORNW("FILL DATE")
"RTN","PSORENW0",14,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW0",15,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$$GET1^DIQ(50,+$G(PSORENW("DRUG IEN")),.01),!
"RTN","PSORENW0",16,0)
 D CHECK G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",17,0)
 D FILDATE
"RTN","PSORENW0",18,0)
 D DRUG G:PSORENW("DFLG")!PSORX("DFLG") PROCESSX
"RTN","PSORENW0",19,0)
 D RXN G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",20,0)
 D STOP^PSORENW1,OERR^PSORENW1:$G(PSOFDR)
"RTN","PSORENW0",21,0)
DSPL K PSOEDT,PSOLM D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",22,0)
 S PSORENW("QFLG")=0 D:'$G(PSOFDR) EDIT
"RTN","PSORENW0",23,0)
 G:PSORENW("DFLG")!$G(PSORX("FN")) PROCESSX
"RTN","PSORENW0",24,0)
 G:'$G(PSORX("FN"))&('$G(PSORENW("QFLG"))) DSPL
"RTN","PSORENW0",25,0)
 D:$$FIND1^DIC(200.051,","_DUZ_",","X","PSORPH")!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) I PSORENW("DFLG")=1 G PROCESSX
"RTN","PSORENW0",26,0)
 I $G(NEWDOSE),PSORENW("ENT")>0 K NEWDOSE G DSPL
"RTN","PSORENW0",27,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW0",28,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW0",29,0)
 D CAN,DCORD^PSONEW2
"RTN","PSORENW0",30,0)
 S BBRN1=$$FIND1^DIC(52,,"X",PSORENW("NRX #")) I $$GET1^DIQ(52,BBRN1,11,"I")["W" S BINGCRT="Y",BINGRTE="W"
"RTN","PSORENW0",31,0)
 ;PSO*237 add to Clozapine Override file
"RTN","PSORENW0",32,0)
ANQ I $G(ANQDATA)]"" N PSOUSER,PSO1PH,PSO2PH,PSOREASN,PSOREMRK S PSOUSER=$P(ANQDATA,"^",5),PSO1PH=$P(ANQDATA,"^"),PSO2PH=$P(ANQDATA,"^",5),PSOREASN=$P(ANQDATA,"^",3),PSOREMRK=$P(ANQDATA,"^",4) D NOW^%DTC G:$$FIND1^DIC(52.52,,"X",%) ANQ D
"RTN","PSORENW0",33,0)
 .;; ** START NCC REMEDIATION ** 457/RTW 
"RTN","PSORENW0",34,0)
 .N PSOUSER,PSO1PH,PSO2PH,PSOREASN,PSOREMRK,PSOPROV
"RTN","PSORENW0",35,0)
 .S PSOPROV=$P(ANQDATA,"^",2),PSO1PH=$P(ANQDATA,"^"),PSO2PH=$P(ANQDATA,"^",5),PSOREASN=$P(ANQDATA,"^",3),PSOREMRK=$P(ANQDATA,"^",4)
"RTN","PSORENW0",36,0)
 .S XQA(PSO2PH)="",XQA(PSOPROV)=""
"RTN","PSORENW0",37,0)
 .I $D(ORO) S PSOPROV=$P(ORO,"^",4)
"RTN","PSORENW0",38,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=%
"RTN","PSORENW0",39,0)
 .D FILE^DICN K DIC,DLAYGO,DD,DO,DA,DR
"RTN","PSORENW0",40,0)
 .N PS52 S (PS52,DA)=+Y,DIE="^PS(52.52,",DR="1////"_PSORENW("IRXN")_";2////"_PSO1PH_";3////"_PSOPROV_";4////"_PSOREASN_";5////"_PSOREMRK_";6////"_PSO2PH
"RTN","PSORENW0",41,0)
 .D ^DIE K DIE,DA,DR
"RTN","PSORENW0",42,0)
 .K ANQDATA,X,Y,%,ANQREM
"RTN","PSORENW0",43,0)
 .D ALERT
"RTN","PSORENW0",44,0)
 ; ** END NCC REMEDIATION ** 457/RTW
"RTN","PSORENW0",45,0)
 ;
"RTN","PSORENW0",46,0)
PROCESSX N PSORWRIT I PSORENW("DFLG")!$G(PSORX("DFLG")) S PSOBBCLK=1 W:'$G(POERR) !,$C(7),"RENEWED RX DELETED",! S PSOWRIT=1,PSORERR=1 D
"RTN","PSORENW0",47,0)
 .D:$P($G(PSOLST(+$G(ORN))),"^",2) PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) S POERR("DFLG")=1 D CLEAN^PSOVER1 D
"RTN","PSORENW0",48,0)
 ..W !! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT S VALMBCK="Q"
"RTN","PSORENW0",49,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW0",50,0)
 K PRC,PHI,PSOQUIT,BBRN,BBRN1,PSORENW,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC"),PSORX("FN")
"RTN","PSORENW0",51,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW0",52,0)
 D CLEAN^PSOVER1
"RTN","PSORENW0",53,0)
 Q
"RTN","PSORENW0",54,0)
 ;
"RTN","PSORENW0",55,0)
CHECK ;
"RTN","PSORENW0",56,0)
 I '$D(PSORX("BAR CODE")),PSORENW("PSODFN")'=PSODFN D  G CHECKX
"RTN","PSORENW0",57,0)
 .W !!,?5,$C(7),"Can't renew Rx # "_$P(PSORENW("RX0"),"^")_", it is not for this patient." S PSORENW("DFLG")=1
"RTN","PSORENW0",58,0)
 .S:$G(POERR) VALMSG="Can't renew Rx # "_$P(PSORENW("RX0"),"^")_", not for this patient.",VALMBCK="R"
"RTN","PSORENW0",59,0)
 ;Invalid dosage check
"RTN","PSORENW0",60,0)
 N PSOOCPRX,PSOOLPF,PSOOLPD,PSONOSIG S PSOOCPRX=PSORENW("OIRXN") D CDOSE
"RTN","PSORENW0",61,0)
 I PSOOLPF!(PSONOSIG) D  G CHECKX
"RTN","PSORENW0",62,0)
 .S PSORENW("DFLG")=1
"RTN","PSORENW0",63,0)
 .W !!,$C(7),"Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_$S(PSOOLPF:", invalid dosage of "_$G(PSOOLPD),1:", Missing Sig")
"RTN","PSORENW0",64,0)
 .S:$G(POERR) VALMSG="Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_$S(PSOOLPF:", invalid Dosage of "_$G(PSOOLPD),1:", Missing Sig") S VALMBCK="R"
"RTN","PSORENW0",65,0)
 .I '$G(PSORNSPD) W ! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSORENW0",66,0)
 .I $G(PSORNSPD) W !
"RTN","PSORENW0",67,0)
 ;
"RTN","PSORENW0",68,0)
 N PSOS S (PSOS,PSOX,PSOY)="" K ACOM,DIR,DIRUT,DIRUT,DUOUT N DRG
"RTN","PSORENW0",69,0)
 I $G(PSOSD) F  S PSOS=$O(PSOSD(PSOS)) Q:PSOS=""  F  S PSOX=$O(PSOSD(PSOS,PSOX)) Q:PSOX']""!(PSORENW("DFLG"))  I PSORENW("OIRXN")=+PSOSD(PSOS,PSOX) S PSOY=PSOSD(PSOS,PSOX) I $TR($P(PSOY,"^",3),"B")]"" D  K ACOM,DIR,DIRUT,DIRUT,DUOUT
"RTN","PSORENW0",70,0)
 . S PSORENW("DFLG")=1
"RTN","PSORENW0",71,0)
 . W !,$C(7),"Cannot renew Rx # ",$P(PSORENW("RX0"),"^")
"RTN","PSORENW0",72,0)
 . S PSOREA=$P(PSOY,"^",3),PSOSTAT=+PSORENW("STA")
"RTN","PSORENW0",73,0)
 . D STATUS^PSOUTIL(PSOREA,PSOSTAT) K PSOREA,PSOSTAT
"RTN","PSORENW0",74,0)
 .I $G(ACOM)]"" D
"RTN","PSORENW0",75,0)
 ..S DRG=$$GET1^DIQ(52,PSORENW("OIRXN"),6)
"RTN","PSORENW0",76,0)
 ..W ! S DIR(0)="Y",DIR("A",1)="Do you want to Discontinue this Pending Order",DIR("A")="for "_DRG,DIR("B")="No"
"RTN","PSORENW0",77,0)
 ..D ^DIR I 'Y!($D(DIRUT)) Q
"RTN","PSORENW0",78,0)
 ..D NOOR^PSOCAN4 Q:$D(DIRUT)  D DE^PSOORFI2
"RTN","PSORENW0",79,0)
 .Q
"RTN","PSORENW0",80,0)
 I PSOY="",'$G(PSOORRNW) D
"RTN","PSORENW0",81,0)
 .W !,$C(7),"Cannot renew Rx # ",$P(PSORENW("RX0"),"^")," later Rx exists." S PSORENW("DFLG")=1
"RTN","PSORENW0",82,0)
 .S:$G(POERR) VALMSG="Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_" later Rx exists.",VALMBCK="R"
"RTN","PSORENW0",83,0)
 K PSOX,PSOY G:PSORENW("DFLG") CHECKX
"RTN","PSORENW0",84,0)
 ;
"RTN","PSORENW0",85,0)
 I $A($E(PSORENW("ORX #"),$L(PSORENW("ORX #"))))'<90 D  Q
"RTN","PSORENW0",86,0)
 . W !,$C(7),"Cannot renew Rx # "_PSORENW("ORX #")_", Max number of renewals reached."
"RTN","PSORENW0",87,0)
 .S:$G(POERR)!('$G(SPEED)) (ACOM,VALMSG)="Cannot renew Rx # "_PSORENW("ORX #")_", Max number reached.",VALMBCK="R"
"RTN","PSORENW0",88,0)
 . S PSORENW("DFLG")=1
"RTN","PSORENW0",89,0)
 .I $G(OR0)]"" D
"RTN","PSORENW0",90,0)
 ..S DRG=$$GET1^DIQ(52,PSORENW("OIRXN"),6)
"RTN","PSORENW0",91,0)
 ..W ! S DIR(0)="Y",DIR("A",1)="Do you want to Discontinue this Pending Order",DIR("A")="for "_DRG,DIR("B")="No"
"RTN","PSORENW0",92,0)
 ..D ^DIR I 'Y!($D(DIRUT)) Q
"RTN","PSORENW0",93,0)
 ..D NOOR^PSOCAN4 Q:$D(DIRUT)  D DE^PSOORFI2
"RTN","PSORENW0",94,0)
 .K ACOM Q
"RTN","PSORENW0",95,0)
 D CHKDIV G:PSORENW("DFLG") CHECKX
"RTN","PSORENW0",96,0)
 ;
"RTN","PSORENW0",97,0)
 D CHKPRV^PSOUTIL
"RTN","PSORENW0",98,0)
CHECKX Q
"RTN","PSORENW0",99,0)
 ;
"RTN","PSORENW0",100,0)
CHKDIV ;
"RTN","PSORENW0",101,0)
 G:$P(PSORENW("RX2"),"^",9)=+PSOSITE CHKDIVX
"RTN","PSORENW0",102,0)
 W !?5,$C(7),"RX # ",$P(PSORENW("RX0"),"^")," is for (",$$GET1^DIQ(59,$P(PSORENW("RX2"),"^",9),.01),") division."
"RTN","PSORENW0",103,0)
 I '$P($G(PSOSYS),"^",2) S PSORENW("DFLG")=1 G CHKDIVX
"RTN","PSORENW0",104,0)
 D:$P($G(PSOSYS),"^",3) DIR
"RTN","PSORENW0",105,0)
CHKDIVX Q
"RTN","PSORENW0",106,0)
 ;
"RTN","PSORENW0",107,0)
DRUG ;
"RTN","PSORENW0",108,0)
 K PSOY
"RTN","PSORENW0",109,0)
 S PSOY=PSORENW("DRUG IEN"),PSOY(0)=^PSDRUG(PSOY,0),PSORENWD=1
"RTN","PSORENW0",110,0)
 I '$P($G(^PSDRUG(PSOY,2)),"^") D  Q:$G(PSORX("DFLG"))
"RTN","PSORENW0",111,0)
 .I $$GET1^DIQ(52,PSORENW("OIRXN"),39.2,"I") S PSODRUG("OI")=$$GET1^DIQ(52,PSORENW("OIRXN"),39.2,"I"),PSODRUG("OIN")=$$GET1^DIQ(52,PSORENW("OIRXN"),39.2) Q
"RTN","PSORENW0",112,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW0",113,0)
 D SET^PSODRG
"RTN","PSORENW0",114,0)
 D POST^PSODRG D:'PSORX("DFLG") DOSCK^PSODOSUT("R") S:$G(PSORX("DFLG")) PSORENW("DFLG")=1 ;remove order checks for v7. do allergy checks only
"RTN","PSORENW0",115,0)
 S PSONOOR=PSORENW("NOO")
"RTN","PSORENW0",116,0)
 K PSORX("INTERVENE")
"RTN","PSORENW0",117,0)
 S:$D(PSONEW("STATUS")) PSORENW("STATUS")=PSONEW("STATUS")
"RTN","PSORENW0",118,0)
 K PSOY,PSONEW("STATUS"),PSORENWD
"RTN","PSORENW0",119,0)
 Q
"RTN","PSORENW0",120,0)
 ;
"RTN","PSORENW0",121,0)
RXN ;
"RTN","PSORENW0",122,0)
 K PSOX
"RTN","PSORENW0",123,0)
 S PSOX=$E(PSORENW("ORX #"),$L(PSORENW("ORX #")))
"RTN","PSORENW0",124,0)
 S PSORENW("NRX #")=$S(PSOX?1N:PSORENW("ORX #")_"A",1:$E(PSORENW("ORX #"),1,$L(PSORENW("ORX #"))-1)_$C($A(PSOX)+1))
"RTN","PSORENW0",125,0)
RETRY I $O(^PSRX("B",PSORENW("NRX #"),0)) D  G:'$G(PSORENW("DFLG")) RETRY
"RTN","PSORENW0",126,0)
 .W:$A($E(PSORENW("NRX #"),$L(PSORENW("ORX #"))))'=90 !,"Rx # "_PSORENW("NRX #")_" is already on file."
"RTN","PSORENW0",127,0)
 .S:$G(PSOFDR) VALMSG="Rx # "_PSORENW("NRX #")_" is already on file."
"RTN","PSORENW0",128,0)
 .I $A($E(PSORENW("NRX #"),$L(PSORENW("ORX #"))))=90 D
"RTN","PSORENW0",129,0)
 ..W !,"Rx # "_PSORENW("NRX #")_" is already on file. Cannot renew Rx #"_PSORENW("ORX #")_".",!,"A new Rx must be entered.",!
"RTN","PSORENW0",130,0)
 ..S:$G(PSOFDR) VALMSG="Rx # "_PSORENW("NRX #")_" is already on file. Cannot renew Rx #"_PSORENW("ORX #")_". A new Rx must be entered."
"RTN","PSORENW0",131,0)
 ..K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSORENW0",132,0)
 ..S:$G(POERR)!($G(PSOFDR)) VALMSG="Cannot renew Rx # "_PSORENW("ORX #")_", Max number reached.",VALMBCK="R" S PSORENW("DFLG")=1
"RTN","PSORENW0",133,0)
 .S PSOX=$E(PSORENW("NRX #"),$L(PSORENW("NRX #")))
"RTN","PSORENW0",134,0)
 .S PSORENW("NRX #")=$S(PSOX?1N:PSORENW("NRX #")_"A",1:$E(PSORENW("NRX #"),1,$L(PSORENW("NRX #"))-1)_$C($A(PSOX)+1))
"RTN","PSORENW0",135,0)
RXNX K PSOX
"RTN","PSORENW0",136,0)
 Q
"RTN","PSORENW0",137,0)
 ;
"RTN","PSORENW0",138,0)
FILDATE ;
"RTN","PSORENW0",139,0)
 S PSORENW("IRXN")=PSORENW("OIRXN")
"RTN","PSORENW0",140,0)
 D NEXT^PSOUTIL(.PSORENW)
"RTN","PSORENW0",141,0)
 I PSORENW("FILL DATE")<$P(PSORENW("RX3"),"^",2) D
"RTN","PSORENW0",142,0)
 .D RENFDT^PSOUTIL(.PSORENW)
"RTN","PSORENW0",143,0)
 .I PSORENW("FILL DATE")<DT,PSORENW("FILL DATE")<PSORNW("FILL DATE") S (Y,PSORENW("FILL DATE"))=DT X ^DD("DD") S PSORX("FILL DATE")=Y K Y
"RTN","PSORENW0",144,0)
 K PSORENW("IRXN")
"RTN","PSORENW0",145,0)
 Q
"RTN","PSORENW0",146,0)
 ;
"RTN","PSORENW0",147,0)
EDIT ;
"RTN","PSORENW0",148,0)
 K DIR,X,Y
"RTN","PSORENW0",149,0)
 S DIR(0)="Y",DIR("B")=$S($G(DUZ("AG"))'="I":"Y",$G(PSEXDT):"Y",1:"N")
"RTN","PSORENW0",150,0)
 S DIR("A")="Edit renewed Rx ",DIR("?")="Answer YES to edit the renewed Rx, NO not to."
"RTN","PSORENW0",151,0)
 D ^DIR K DIR S:$D(DIRUT) PSORENW("DFLG")=1
"RTN","PSORENW0",152,0)
 G:PSORENW("DFLG") EDITX
"RTN","PSORENW0",153,0)
 K PSOQUIT,PSORX("FN") I Y S PSORNALL=1 D INIT^PSORENW3,EN^PSOORNE4(.PSORENW) K PSORNALL S:$G(PSOQUIT) PSORENW("DFLG")=1 I '$G(PSORX("FN")) D FULL^VALM1 Q
"RTN","PSORENW0",154,0)
 Q:$G(PSORX("FN"))
"RTN","PSORENW0",155,0)
EDITX S PSOEDT=1,VALMBCK="Q" K X,Y,DIRUT,DTOUT,DUOUT S PSORENW("QFLG")=1
"RTN","PSORENW0",156,0)
 Q
"RTN","PSORENW0",157,0)
 ;
"RTN","PSORENW0",158,0)
DELETE ;
"RTN","PSORENW0",159,0)
 K DA,DIK
"RTN","PSORENW0",160,0)
 S DA=$O(^PS(52.5,"B",PSORENW("OIRXN"),0)),DIK="^PS(52.5,"
"RTN","PSORENW0",161,0)
 D ^DIK K DIK,DIC
"RTN","PSORENW0",162,0)
 Q
"RTN","PSORENW0",163,0)
 ;
"RTN","PSORENW0",164,0)
CAN ;
"RTN","PSORENW0",165,0)
 K REA,DA,MSG
"RTN","PSORENW0",166,0)
 S REA="C",DA=PSORENW("OIRXN")
"RTN","PSORENW0",167,0)
 S MSG="Renewed"_$S($G(PSOFDR):" from CPRS",1:"")
"RTN","PSORENW0",168,0)
 S PSCAN(PSORENW("ORX #"))=DA_"^C"
"RTN","PSORENW0",169,0)
 D CAN^PSOCAN
"RTN","PSORENW0",170,0)
 K REA,DA,MSG,PSCAN
"RTN","PSORENW0",171,0)
 Q
"RTN","PSORENW0",172,0)
 ;
"RTN","PSORENW0",173,0)
DIR ;
"RTN","PSORENW0",174,0)
 S DIR(0)="Y",DIR("A")="CONTINUE ",DIR("B")="N"
"RTN","PSORENW0",175,0)
 S DIR("?")="Answer YES to Continue, NO to bypass"
"RTN","PSORENW0",176,0)
 D ^DIR K DIR
"RTN","PSORENW0",177,0)
 S:$D(DIRUT)!('Y) PSORENW("DFLG")=1
"RTN","PSORENW0",178,0)
DIRX K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSORENW0",179,0)
 Q
"RTN","PSORENW0",180,0)
NEWPT ;
"RTN","PSORENW0",181,0)
 S PSOQFLG=0 N PSODFN
"RTN","PSORENW0",182,0)
 S PSODFN=PSORENW("PSODFN")
"RTN","PSORENW0",183,0)
 D ^PSOPTPST I PSOQFLG S PSORENW("DFLG")=1,PSOQFLG=0 G NEWPTX
"RTN","PSORENW0",184,0)
 D PROFILE^PSOREF1
"RTN","PSORENW0",185,0)
NEWPTX Q
"RTN","PSORENW0",186,0)
 ;
"RTN","PSORENW0",187,0)
EN(PSORENW)        ; Entry Point for Batch Barcode Option
"RTN","PSORENW0",188,0)
 S PSORENRX=$G(PSOBBC("OIRXN"))
"RTN","PSORENW0",189,0)
 I $G(PSORENRX) D PSOL^PSSLOCK(PSORENRX) I '$G(PSOMSG) D  K DIR,PSOMSG W ! S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR W ! Q
"RTN","PSORENW0",190,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P(PSOMSG,"^",2) Q
"RTN","PSORENW0",191,0)
 .W $C(7),!!,"Another person is editing Rx "_$$GET1^DIQ(52,PSORENRX,.01,"I")
"RTN","PSORENW0",192,0)
 K PSOMSG,PSOBBCLK S PSOBARCD=1 D PROCESS K PSOBARCD
"RTN","PSORENW0",193,0)
 D KLIB^PSORENW1
"RTN","PSORENW0",194,0)
 I $G(PSORENRX),$G(PSOBBCLK) D PSOUL^PSSLOCK(PSORENRX)
"RTN","PSORENW0",195,0)
 K PSORENRX,PSOBBCLK
"RTN","PSORENW0",196,0)
 Q
"RTN","PSORENW0",197,0)
CDOSE ;Validate Dosage field on Renewal, Copy, Edit
"RTN","PSORENW0",198,0)
 ;PSOOCPRX must be set to internal Rx number
"RTN","PSORENW0",199,0)
 Q:'$G(PSOOCPRX)
"RTN","PSORENW0",200,0)
 N PSOOLP,PSOOKZ
"RTN","PSORENW0",201,0)
 S PSOOLP="",(PSOOLPF,PSONOSIG)=0 F  S PSOOLP=$O(^PSRX(PSOOCPRX,6,PSOOLP)) Q:PSOOLP=""!(PSOOLPF)  I $P($G(^PSRX(PSOOCPRX,6,PSOOLP,0)),"^")["0.." S PSOOLPD=$P($G(^(0)),"^"),PSOOLPF=1
"RTN","PSORENW0",202,0)
 Q:PSOOLPF
"RTN","PSORENW0",203,0)
 S PSOOKZ=0
"RTN","PSORENW0",204,0)
 I $P($G(^PSRX(PSOOCPRX,"SIG")),"^",2) S PSOOLP="" F  S PSOOLP=$O(^PSRX(PSOOCPRX,"SIG1",PSOOLP)) Q:PSOOLP=""!(PSOOKZ)  I $G(^PSRX(PSOOCPRX,"SIG1",PSOOLP,0))'="" S PSOOKZ=1
"RTN","PSORENW0",205,0)
 I '$P($G(^PSRX(PSOOCPRX,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" S PSOOKZ=1
"RTN","PSORENW0",206,0)
 I 'PSOOKZ S PSONOSIG=1
"RTN","PSORENW0",207,0)
 Q
"RTN","PSORENW0",208,0)
 ;
"RTN","PSORENW0",209,0)
ALERT ; send an alert to the TWO approving team members
"RTN","PSORENW0",210,0)
 N RSLT
"RTN","PSORENW0",211,0)
 S XQADATA=PSCLPAT
"RTN","PSORENW0",212,0)
 S PSOLAST4=$E($P($G(^DPT(PSCLPAT,0)),"^",9),6,9)
"RTN","PSORENW0",213,0)
 S XQAARCH=1,XQAFLG="D"
"RTN","PSORENW0",214,0)
 S XQA(PSO2PH)="",XQA(PSOUSER)="",PSCDATE=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","PSORENW0",215,0)
 S XQAMSG=$$GET1^DIQ(2,PSCLPAT,.01)_" ("_PSOLAST4_")"_": Clozapine Override Rx Processed : "_PSCDATE
"RTN","PSORENW0",216,0)
 S XQAID="PSI"_","_PSCLPAT
"RTN","PSORENW0",217,0)
 S RSLT=$$SETUP1^XQALERT
"RTN","PSORENW0",218,0)
 W !!,"OVERRIDE ALERTS HAVE BEEN SENT TO THE APPROVING TEAM MEMBERS",!!
"RTN","PSORENW0",219,0)
 Q
"RTN","PSORENW0",220,0)
 ;
"RTN","PSORENW4")
0^11^B91746035
"RTN","PSORENW4",1,0)
PSORENW4 ;BIR/SAB - rx speed renew ;6 June 2019 16:18:07
"RTN","PSORENW4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,37,64,46,75,71,100,130,117,152,148,264,225,301,390,313,411,444,504,508,550,457**;DEC 1997;Build 116
"RTN","PSORENW4",3,0)
 ;External reference to ^PSDRUG( supported by DBIA 221
"RTN","PSORENW4",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW4",5,0)
 ;External reference to $$L^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",6,0)
 ;External reference to UL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",7,0)
 ;External reference to PSOL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",8,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",9,0)
 ;External reference to LK^ORX2 supported by DBIA 867
"RTN","PSORENW4",10,0)
 ;External reference to ULK^ORX2 supported by DBIA 867
"RTN","PSORENW4",11,0)
 ;External reference to ^PSRX supported by DBIA 3500
"RTN","PSORENW4",12,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORENW4",13,0)
SEL K PSODRUG  ;PSO*7*301
"RTN","PSORENW4",14,0)
 N PSOSPRNW,PSOIBOLD S PSOSPRNW=1
"RTN","PSORENW4",15,0)
 I $P(PSOPAR,"^",4)=0 S VALMSG="Renewing is NOT Allowed. Check Site Parameters!",VALMBCK="" Q
"RTN","PSORENW4",16,0)
 N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!",VALMBCK="" Q
"RTN","PSORENW4",17,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW4",18,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW4",19,0)
 K PRC,PHI,PSORX("EDIT"),PSOFDR,DIR,DUOUT,DIRUT,PSORNSPD
"RTN","PSORENW4",20,0)
 S LST="",DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR
"RTN","PSORENW4",21,0)
 K DIR I $D(DTOUT)!($D(DUOUT)) K DIRUT,DTOUT,DUOUT S VALMBCK="" G SELQ
"RTN","PSORENW4",22,0)
 ;
"RTN","PSORENW4",23,0)
 K DIRUT,PSOOELSE I +Y S (SPEED,PSOOELSE,PSORNSPD)=1 D FULL^VALM1 S LST=Y
"RTN","PSORENW4",24,0)
 ; begin NCC remediation *457, remove any Clozapine orders
"RTN","PSORENW4",25,0)
 I $G(LST)]"" F ORD=1:1:$L(LST,",") S ORN=$P(LST,",",ORD) D:ORN  I PSOERR=2 S PSOERR=0
"RTN","PSORENW4",26,0)
 . S PSOERR=0
"RTN","PSORENW4",27,0)
 . N PSDRGIEN,ORDLN S ORDLN=$G(PSOLST(ORN)) Q:'(+ORDLN=52)
"RTN","PSORENW4",28,0)
 . ; Clozapine check
"RTN","PSORENW4",29,0)
 . S PSDRGIEN=$$GET1^DIQ(52,+$P(ORDLN,"^",2),6,"I")  ; drug IEN
"RTN","PSORENW4",30,0)
 . Q:'PSDRGIEN  I $$GET1^DIQ(50,PSDRGIEN,17.5)="PSOCLO1" D
"RTN","PSORENW4",31,0)
 ..  S $P(LST,",",ORD)=0  ; order removed from LST
"RTN","PSORENW4",32,0)
 ..  W !,$$GET1^DIQ(50,PSDRGIEN,.01)  ;  drug name
"RTN","PSORENW4",33,0)
 ..  N DIR,ORUB,Y S Y("1")="^^Renew^RN",ORUB=1 D NS^XQORM4
"RTN","PSORENW4",34,0)
 ..  S Y=$$GET1^DIQ(52,+$P(ORDLN,U,2),.01)  ; Rx #
"RTN","PSORENW4",35,0)
 ..  S PSOERR=2 S DIR(0)="E",DIR("A")="Rx #"_Y_" not processed. Press enter" D ^DIR
"RTN","PSORENW4",36,0)
 ;
"RTN","PSORENW4",37,0)
 S Y=0 I $G(LST)]"" F ORD=1:1:$L(LST,",") S:$P(LST,",",ORD)>0 Y=Y+1  ; count remaining orders in LST
"RTN","PSORENW4",38,0)
 I 'Y G SELQ  ; no orders to process
"RTN","PSORENW4",39,0)
 ; end NCC remediation *457
"RTN","PSORENW4",40,0)
 D  ; process remaining orders
"RTN","PSORENW4",41,0)
 . S (PSODIR("DFLG"),PSODIR("FIELD"))=0,PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0 D INIT Q:PSORENW("DFLG")
"RTN","PSORENW4",42,0)
 . F ORD=1:1:$L(LST,",") S ORN=$P(LST,",",ORD) D:ORN>0
"RTN","PSORENW4",43,0)
 ..  D:+PSOLST(ORN)=52 PROCESS
"RTN","PSORENW4",44,0)
 ..  S (PSOQUIT,PSORENW("DFLG"),POERR,POERR("DFLG"),PSORX("DFLG"))=0
"RTN","PSORENW4",45,0)
 I '$G(PSOOELSE) S VALMBCK="" G SELQ
"RTN","PSORENW4",46,0)
 S VALMBCK="R"
"RTN","PSORENW4",47,0)
 D ^PSOBUILD,BLD^PSOORUT1 K DIR,DIRUT,DTOUT,DUOUT,LST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,PSORNW,PSORENW,PSONO,PSOCO,PSOCU,PSODIR,DSMSG,SPEED,PSORENW,PSOOELSE,PSOOPT,PSORX("FILL DATE"),PSORX("ISSUE DATE"),PSOID,PSOMSG,PSORX("DFLG"),PSOQTY
"RTN","PSORENW4",48,0)
SELQ ; 
"RTN","PSORENW4",49,0)
 K PSORNSPD,RTE,DRET,PRC,PHI,PSOSPRNW,X
"RTN","PSORENW4",50,0)
 S X=PSODFN_";DPT(" D ULK^ORX2,UL^PSSLOCK(PSODFN),CLEAN^PSOVER1
"RTN","PSORENW4",51,0)
 Q
"RTN","PSORENW4",52,0)
 ;
"RTN","PSORENW4",53,0)
PROCESS ; Process one order at a time
"RTN","PSORENW4",54,0)
 N PSORXIEN,PSOCHECK,MAXNUMRF
"RTN","PSORENW4",55,0)
 S PSORXIEN=+$P($G(PSOLST(ORN)),"^",2)
"RTN","PSORENW4",56,0)
 ;
"RTN","PSORENW4",57,0)
 I $$LMREJ^PSOREJU1(PSORXIEN) D  K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",58,0)
 . W $C(7),!!,"Rx# "_$$GET1^DIQ(52,PSORXIEN,.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!"
"RTN","PSORENW4",59,0)
 I $$TITRX^PSOUTL(PSORXIEN)="t" D  K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",60,0)
 . W $C(7),!!,"Rx# "_$$GET1^DIQ(52,PSORXIEN,.01)_" is marked as 'Titration Rx' and cannot be renewed."
"RTN","PSORENW4",61,0)
 ; Checking whether the Provider still qualifies as prescriber for the renewed Rx
"RTN","PSORENW4",62,0)
 S PROVIEN=$S($G(PSORENW("PROVIDER")):PSORENW("PROVIDER"),1:+$$GET1^DIQ(52,PSORXIEN,4,"I"))
"RTN","PSORENW4",63,0)
 S PSOCHECK=$$CHKRXPRV^PSOUTIL(PSORXIEN,PROVIEN)
"RTN","PSORENW4",64,0)
 I 'PSOCHECK D  K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",65,0)
 . W $C(7),!!,"Rx# "_$$GET1^DIQ(52,PSORXIEN,.01)_" - "_$P(PSOCHECK,"^",3)
"RTN","PSORENW4",66,0)
 ; Checking the Maximum Number of Refills Allowed
"RTN","PSORENW4",67,0)
 S MAXNUMRF=$$MAXNUMRF^PSOUTIL(+$$GET1^DIQ(52,PSORXIEN,6,"I"),+$G(PSORENW("DAYS SUPPLY")),+$G(PSORENW("PATIENT STATUS")),.CLOZPAT)
"RTN","PSORENW4",68,0)
 I PSORENW("# OF REFILLS")>MAXNUMRF D  K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",69,0)
 . W $C(7),!!,"Rx# "_$$GET1^DIQ(52,PSORXIEN,.01)_" - # of Refills requested exceeds maximum allowed ("_MAXNUMRF_") for this Rx"
"RTN","PSORENW4",70,0)
 ; PSO*7*508 - check if the Rx is an eRx. If so, inform the user and ask to proceed.
"RTN","PSORENW4",71,0)
 N ERXORN,ERXIEN,ERXPROC S ERXORN=$$GET1^DIQ(52,$P(PSOLST(ORN),U,2),39.3)
"RTN","PSORENW4",72,0)
 S ERXIEN=$$CHKERX^PSOERXU1(ERXORN)
"RTN","PSORENW4",73,0)
 I ERXIEN S ERXPROC=$$PROVPMT^PSOERXU1(ERXIEN) Q:'ERXPROC
"RTN","PSORENW4",74,0)
 ; PSO*7*508 - end
"RTN","PSORENW4",75,0)
 ; Checking if Rx is locked by Another person
"RTN","PSORENW4",76,0)
 D PSOL^PSSLOCK(PSORXIEN) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX(PSORXIEN,0),"^")),! K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",77,0)
 K RET,DRET,PRC,PHI S PSORENW("OIRXN")=PSORXIEN,PSOFROM="NEW"
"RTN","PSORENW4",78,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^",2)
"RTN","PSORENW4",79,0)
 I SIGOK F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW4",80,0)
 S PSOIBOLD=$G(PSORENW("OIRXN")) D SETIB^PSORENW1
"RTN","PSORENW4",81,0)
 I '$G(PSORENW("PROVIDER")) D
"RTN","PSORENW4",82,0)
 .S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW4",83,0)
 .S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW4",84,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW4",85,0)
 I '$G(PSORENW("CLINIC")) S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5)
"RTN","PSORENW4",86,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",87,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW4",88,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW4",89,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",90,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW4",91,0)
 S PSORENW("QTY")=$P(PSORENW("RX0"),"^",7)
"RTN","PSORENW4",92,0)
 S PSORENW("INS")=$S($G(PSORENW("ENT"))]"":PSORENW("ENT"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW4",93,0)
 S:$G(PSORENW("ENT"))']"" PSORENW("ENT")=0
"RTN","PSORENW4",94,0)
 N I F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW4",95,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW4",96,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW4",97,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW4",98,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW4",99,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW4",100,0)
 .K DOSE
"RTN","PSORENW4",101,0)
 I $P($G(^PSDRUG(PSORENW("DRUG IEN"),"CLOZ1")),"^")="PSOCLO1" N PSON S PSON=0 D  I PSON K PSON D POZ,KLIB^PSORENW1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSORENW4",102,0)
 . I '$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",2)),'$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",3)) D  Q
"RTN","PSORENW4",103,0)
 . . S PSON=1 W $C(7),!!,"Only providers with DEA# or a VA# can write prescriptions for clozapine.",!
"RTN","PSORENW4",104,0)
 . I '$D(^XUSEC("YSCL AUTHORIZED",PSORENW("PROVIDER"))) D 
"RTN","PSORENW4",105,0)
 . . S PSON=1 W $C(7),!!,$$CLKEYWRN^PSOCLUTL,!
"RTN","PSORENW4",106,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW4",107,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) D  K T
"RTN","PSORENW4",108,0)
 .S PHI=^PSRX(PSORENW("OIRXN"),"PI",0),T=0
"RTN","PSORENW4",109,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PI",T)) Q:'T  S PHI(T)=^PSRX(PSORENW("OIRXN"),"PI",T,0)
"RTN","PSORENW4",110,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$P($G(^PSDRUG(+$G(PSORENW("DRUG IEN")),0)),"^"),!
"RTN","PSORENW4",111,0)
 I '$P($G(^PSDRUG($P(PSORENW("RX0"),"^",6),2)),"^") D  G:$G(PSORENW("DFLG")) PROCESSX
"RTN","PSORENW4",112,0)
 .I $P($G(^PSRX(PSORENW("OIRXN"),"OR1")),"^") S PSODRUG("OI")=$P(^PSRX(PSORENW("OIRXN"),"OR1"),"^"),PSODRUG("OIN")=$P(^PS(50.7,+^("OR1"),0),"^") Q
"RTN","PSORENW4",113,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW4",114,0)
 D POZ
"RTN","PSORENW4",115,0)
 D CHECK^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",116,0)
 D FILDATE^PSORENW0
"RTN","PSORENW4",117,0)
 D DRUG^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",118,0)
 D RXN^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",119,0)
 D STOP^PSORENW1
"RTN","PSORENW4",120,0)
DSPL K PSOEDT,PSOLM,BBFLG,BBRX,BINGCRT,BINGRTE S PSDY=PSORENW("DAYS SUPPLY"),PSRF=PSORENW("# OF REFILLS")
"RTN","PSORENW4",121,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW4",122,0)
 N MXRFLS
"RTN","PSORENW4",123,0)
 S MXRFLS=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),+$G(PSORENW("DAYS SUPPLY")),+$P(^PSRX(PSORENW("OIRXN"),0),"^",3),.CLOZPAT)
"RTN","PSORENW4",124,0)
 I MXRFLS<PSORENW("# OF REFILLS") S PSORENW("# OF REFILLS")=MXRFLS
"RTN","PSORENW4",125,0)
 D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",126,0)
 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",127,0)
 I $G(PSOQTY) D QTY^PSODIR1(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",128,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW4",129,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW4",130,0)
 D CAN^PSORENW0,DCORD^PSONEW2
"RTN","PSORENW4",131,0)
 S PSORENW("# OF REFILLS")=PSRF K PSDY,PSRF,PSODIR("CS"),DEA,PSORENW("ENT")
"RTN","PSORENW4",132,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSORENW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W",BBFLG=1,BBRX(1)=$G(BBRX(1))_BBRN1_","
"RTN","PSORENW4",133,0)
PROCESSX ;
"RTN","PSORENW4",134,0)
 I PSORENW("DFLG") D
"RTN","PSORENW4",135,0)
 .K PHI,PRC,PSODRUG,SIG,PSORXED,SIGOK
"RTN","PSORENW4",136,0)
 .K PSORENW("DOSE"),PSORENW("DURATION"),PSORENW("DRUG IEN"),PSORENW("ENT"),PSORENW("INS"),PSORENW("NOUN"),PSORENW("ROUTE"),PSORENW("SCHEDULE"),PSORENW("SIG"),PSORENW("VERB"),PSORENW("UNITS")
"RTN","PSORENW4",137,0)
 .I '$G(POERR) W !,$C(7),"Rx NOT RENEWED. RENEWED RX DELETED",! S POERR("DFLG")=1 D CLEAN^PSOVER1,POZ
"RTN","PSORENW4",138,0)
 K PSORDLOK I PSORENW("DFLG") S PSORDLOK=1
"RTN","PSORENW4",139,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW4",140,0)
 K BBRN,BBRN1,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC")
"RTN","PSORENW4",141,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW4",142,0)
 I $G(PSORDLOK) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSORENW4",143,0)
 D KLIB^PSORENW1
"RTN","PSORENW4",144,0)
 K PSORDLOK
"RTN","PSORENW4",145,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN N ZRXN S ZRXN=RXN D
"RTN","PSORENW4",146,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW4",147,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW4",148,0)
 .;saves drug allergy order chks pso*7*390
"RTN","PSORENW4",149,0)
 .I $D(^TMP("PSODAOC",$J,"ALLERGY")) D 
"RTN","PSORENW4",150,0)
 ..I $G(PSORX("DFLG"))!$G(PSORENW("DFLG")) K ^TMP("PSODAOC",$J) Q
"RTN","PSORENW4",151,0)
 ..S RXN=ZRXN,PSODAOC="Rx Backdoor "_$S($P(^PSRX(RXN,"STA"),"^")=4:"NON-VERIFIED ",1:"")_"SPEED RENEW Order Acceptance_OP"
"RTN","PSORENW4",152,0)
 ..S PSOARENW=1 D DAOC^PSONEW K PSOARENW
"RTN","PSORENW4",153,0)
 K ZRXN,RXN,RXN1,^TMP("PSORXN",$J),^TMP("PSODAOC",$J)
"RTN","PSORENW4",154,0)
 Q
"RTN","PSORENW4",155,0)
INIT ;
"RTN","PSORENW4",156,0)
 D ASK Q:PSORENW("DFLG")
"RTN","PSORENW4",157,0)
 D NOORE^PSONEW(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",158,0)
 Q
"RTN","PSORENW4",159,0)
ASK ;upfront questions
"RTN","PSORENW4",160,0)
 W !! D ISSDT^PSODIR2(.PSORENW) Q:PSORENW("DFLG")  S PSORENW("ISSUE DATE")=PSOID
"RTN","PSORENW4",161,0)
 D FILLDT^PSODIR2(.PSORENW) K PSONEW("DAYS SUPPLY"),PSONEW("# OF REFILLS") Q:PSORENW("DFLG")
"RTN","PSORENW4",162,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW4",163,0)
 D MW^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",164,0)
 D PTSTAT^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",165,0)
 D DAYS^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",166,0)
 S PSODRUG("DEA")=0 D REFILL^PSODIR1(.PSORENW) K PSODRUG("DEA") Q:PSORENW("DFLG")
"RTN","PSORENW4",167,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to edit Renewed Rx(s) QTY " D ^DIR I $D(DIRUT) S PSORENW("DFLG")=1 K DIR,DIRUT Q
"RTN","PSORENW4",168,0)
 S PSOQTY=Y K DIR,DIRUT,Y
"RTN","PSORENW4",169,0)
 D CLINIC^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",170,0)
 D PROV^PSODIR(.PSORENW) S:PSORENW("DFLG") PSORENW("DFLG")=0
"RTN","PSORENW4",171,0)
 Q
"RTN","PSORENW4",172,0)
 ;
"RTN","PSORENW4",173,0)
POZ ;
"RTN","PSORENW4",174,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DTOUT
"RTN","PSORENW4",175,0)
 Q
"RTN","PSORENW4",176,0)
 ;
"VER")
8.0^22.2
"^DD",52.52,52.52,4,0)
REASON FOR OVERRIDE^RP52.54'^PS(52.54,^0;5^Q
"^DD",52.52,52.52,4,3)
Enter the reason for the override of this prescription.
"^DD",52.52,52.52,4,8.5)
^
"^DD",52.52,52.52,4,9)
^
"^DD",52.52,52.52,4,21,0)
^.001^1^1^3160701^^^^
"^DD",52.52,52.52,4,21,1,0)
This field records the reason as a pointer to file #52.54.
"^DD",52.52,52.52,4,"DT")
3160218
"^DD",52.52,52.52,5,0)
COMMENTS^RFIX^^0;6^K:$L(X)>200!($L(X)<5)!(X?." ") X
"^DD",52.52,52.52,5,3)
Enter comments describing the reason override the lockout.  Input must be between 5 and 200 characters in length.
"^DD",52.52,52.52,5,9)
^
"^DD",52.52,52.52,5,21,0)
^.001^1^1^3160315^^^^
"^DD",52.52,52.52,5,21,1,0)
This is any information about why the prescription was filled.
"^DD",52.52,52.52,5,"DT")
2900302
"^DD",52.52,52.52,6,0)
SECOND APPROVING TEAM MEMBER^RP200'^VA(200,^1;1^Q
"^DD",52.52,52.52,6,3)
Enter the name of the second approving team member.
"^DD",52.52,52.52,6,21,0)
^.001^1^1^3160310^^^
"^DD",52.52,52.52,6,21,1,0)
This field records the name as a pointer to file 200).
"^DD",52.52,52.52,6,"DT")
3160516
"^DD",52.54,52.54,0)
FIELD^^.01^1
"^DD",52.54,52.54,0,"DT")
3190510
"^DD",52.54,52.54,0,"IX","B",52.54,.01)

"^DD",52.54,52.54,0,"NM","CLOZAPINE OVERRIDE REASONS")

"^DD",52.54,52.54,0,"PT",52.52,4)

"^DD",52.54,52.54,0,"PT",53.8,4)

"^DD",52.54,52.54,0,"VRPK")
PSO
"^DD",52.54,52.54,.01,0)
OVERRIDE REASON^RF^^0;1^K:$L(X)>100!($L(X)<3)!'(X'?1P.E) X
"^DD",52.54,52.54,.01,1,0)
^.1
"^DD",52.54,52.54,.01,1,1,0)
52.54^B
"^DD",52.54,52.54,.01,1,1,1)
S ^PS(52.54,"B",$E(X,1,30),DA)=""
"^DD",52.54,52.54,.01,1,1,2)
K ^PS(52.54,"B",$E(X,1,30),DA)
"^DD",52.54,52.54,.01,3)
Enter the reason for the override (input should be 3 to 100 characters in length).
"^DD",52.54,52.54,.01,21,0)
^^1^1^3160310^
"^DD",52.54,52.54,.01,21,1,0)
This field contains the reason for the Clozapine lockout override.
"^DD",52.54,52.54,.01,"DT")
3160310
"^DIC",52.54,52.54,0)
CLOZAPINE OVERRIDE REASONS^52.54
"^DIC",52.54,52.54,0,"GL")
^PS(52.54,
"^DIC",52.54,52.54,"%D",0)
^^2^2^3160310^
"^DIC",52.54,52.54,"%D",1,0)
This file contains the possible reasons for overriding a Clozapine 
"^DIC",52.54,52.54,"%D",2,0)
prescription or order lockout.
"^DIC",52.54,"B","CLOZAPINE OVERRIDE REASONS",52.54)

**INSTALL NAME**
PSJ*5.0*327
"BLD",10958,0)
PSJ*5.0*327^INPATIENT MEDICATIONS^0^3190612^y
"BLD",10958,1,0)
^^1^1^3190403^^^^
"BLD",10958,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10958,4,0)
^9.64PA^55^2
"BLD",10958,4,53.8,0)
53.8
"BLD",10958,4,53.8,222)
y^y^f^^^^n
"BLD",10958,4,55,0)
55
"BLD",10958,4,55,2,0)
^9.641^55.06^1
"BLD",10958,4,55,2,55.06,0)
UNIT DOSE  (sub-file)
"BLD",10958,4,55,2,55.06,1,0)
^9.6411^301^1
"BLD",10958,4,55,2,55.06,1,301,0)
CLOZAPINE DOSAGE (MG/DAY)
"BLD",10958,4,55,222)
y^y^p^^^^n^^n
"BLD",10958,4,55,224)

"BLD",10958,4,"APDD",55,55.06)

"BLD",10958,4,"APDD",55,55.06,301)

"BLD",10958,4,"B",53.8,53.8)

"BLD",10958,4,"B",55,55)

"BLD",10958,6.3)
114
"BLD",10958,"ABPKG")
n
"BLD",10958,"INID")
^n
"BLD",10958,"INIT")
ADDMENUS^PSJ327P
"BLD",10958,"KRN",0)
^9.67PA^779.2^20
"BLD",10958,"KRN",.4,0)
.4
"BLD",10958,"KRN",.4,"NM",0)
^9.68A^^
"BLD",10958,"KRN",.401,0)
.401
"BLD",10958,"KRN",.402,0)
.402
"BLD",10958,"KRN",.403,0)
.403
"BLD",10958,"KRN",.5,0)
.5
"BLD",10958,"KRN",.84,0)
.84
"BLD",10958,"KRN",3.6,0)
3.6
"BLD",10958,"KRN",3.8,0)
3.8
"BLD",10958,"KRN",9.2,0)
9.2
"BLD",10958,"KRN",9.8,0)
9.8
"BLD",10958,"KRN",9.8,"NM",0)
^9.68A^40^33
"BLD",10958,"KRN",9.8,"NM",1,0)
PSJOE^^0^B121657110
"BLD",10958,"KRN",9.8,"NM",2,0)
PSGOE42^^0^B13181041
"BLD",10958,"KRN",9.8,"NM",3,0)
PSJCLOZ^^0^B192160082
"BLD",10958,"KRN",9.8,"NM",4,0)
PSGOE7^^0^B45336185
"BLD",10958,"KRN",9.8,"NM",6,0)
PSGOE41^^0^B134934850
"BLD",10958,"KRN",9.8,"NM",7,0)
PSJRXLAB^^0^B37749956
"BLD",10958,"KRN",9.8,"NM",8,0)
PSJCLOLS^^0^B10135228
"BLD",10958,"KRN",9.8,"NM",9,0)
PSGOEV^^0^B102409211
"BLD",10958,"KRN",9.8,"NM",12,0)
PSGOE92^^0^B47365647
"BLD",10958,"KRN",9.8,"NM",13,0)
PSGOER^^0^B93777816
"BLD",10958,"KRN",9.8,"NM",14,0)
PSGOER0^^0^B25398399
"BLD",10958,"KRN",9.8,"NM",15,0)
PSGOE8^^0^B60586386
"BLD",10958,"KRN",9.8,"NM",16,0)
PSGOE81^^0^B156313151
"BLD",10958,"KRN",9.8,"NM",17,0)
PSGOE82^^0^B42921710
"BLD",10958,"KRN",9.8,"NM",18,0)
PSJCOM^^0^B47683425
"BLD",10958,"KRN",9.8,"NM",19,0)
PSGOT^^0^B26696723
"BLD",10958,"KRN",9.8,"NM",20,0)
PSJOE1^^0^B42053305
"BLD",10958,"KRN",9.8,"NM",21,0)
PSGOD^^0^B41024059
"BLD",10958,"KRN",9.8,"NM",23,0)
PSGPEN^^0^B58080181
"BLD",10958,"KRN",9.8,"NM",24,0)
PSGNE3^^0^B96072062
"BLD",10958,"KRN",9.8,"NM",25,0)
PSGOEF^^0^B147534789
"BLD",10958,"KRN",9.8,"NM",26,0)
PSGON^^0^B39542310
"BLD",10958,"KRN",9.8,"NM",27,0)
PSGOEE^^0^B130091847
"BLD",10958,"KRN",9.8,"NM",29,0)
PSGOETO^^0^B46539798
"BLD",10958,"KRN",9.8,"NM",30,0)
PSGOE91^^0^B154370497
"BLD",10958,"KRN",9.8,"NM",31,0)
PSJCOM1^^0^B54823711
"BLD",10958,"KRN",9.8,"NM",33,0)
PSJLMUDE^^0^B98434237
"BLD",10958,"KRN",9.8,"NM",35,0)
PSJLMPRU^^0^B26845194
"BLD",10958,"KRN",9.8,"NM",36,0)
PSJOEA^^0^B34137251
"BLD",10958,"KRN",9.8,"NM",37,0)
PSJOEA1^^0^B31482767
"BLD",10958,"KRN",9.8,"NM",38,0)
PSJ327P^^0^B688619
"BLD",10958,"KRN",9.8,"NM",39,0)
PSGOERS^^0^B41465316
"BLD",10958,"KRN",9.8,"NM",40,0)
PSGOEC^^0^B76544319
"BLD",10958,"KRN",9.8,"NM","B","PSGNE3",24)

"BLD",10958,"KRN",9.8,"NM","B","PSGOD",21)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE41",6)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE42",2)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE7",4)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE8",15)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE81",16)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE82",17)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE91",30)

"BLD",10958,"KRN",9.8,"NM","B","PSGOE92",12)

"BLD",10958,"KRN",9.8,"NM","B","PSGOEC",40)

"BLD",10958,"KRN",9.8,"NM","B","PSGOEE",27)

"BLD",10958,"KRN",9.8,"NM","B","PSGOEF",25)

"BLD",10958,"KRN",9.8,"NM","B","PSGOER",13)

"BLD",10958,"KRN",9.8,"NM","B","PSGOER0",14)

"BLD",10958,"KRN",9.8,"NM","B","PSGOERS",39)

"BLD",10958,"KRN",9.8,"NM","B","PSGOETO",29)

"BLD",10958,"KRN",9.8,"NM","B","PSGOEV",9)

"BLD",10958,"KRN",9.8,"NM","B","PSGON",26)

"BLD",10958,"KRN",9.8,"NM","B","PSGOT",19)

"BLD",10958,"KRN",9.8,"NM","B","PSGPEN",23)

"BLD",10958,"KRN",9.8,"NM","B","PSJ327P",38)

"BLD",10958,"KRN",9.8,"NM","B","PSJCLOLS",8)

"BLD",10958,"KRN",9.8,"NM","B","PSJCLOZ",3)

"BLD",10958,"KRN",9.8,"NM","B","PSJCOM",18)

"BLD",10958,"KRN",9.8,"NM","B","PSJCOM1",31)

"BLD",10958,"KRN",9.8,"NM","B","PSJLMPRU",35)

"BLD",10958,"KRN",9.8,"NM","B","PSJLMUDE",33)

"BLD",10958,"KRN",9.8,"NM","B","PSJOE",1)

"BLD",10958,"KRN",9.8,"NM","B","PSJOE1",20)

"BLD",10958,"KRN",9.8,"NM","B","PSJOEA",36)

"BLD",10958,"KRN",9.8,"NM","B","PSJOEA1",37)

"BLD",10958,"KRN",9.8,"NM","B","PSJRXLAB",7)

"BLD",10958,"KRN",19,0)
19
"BLD",10958,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",10958,"KRN",19,"NM",1,0)
PSJL MANAGER^^0
"BLD",10958,"KRN",19,"NM",2,0)
PSJLAB LIST^^0
"BLD",10958,"KRN",19,"NM",3,0)
PSJLIST OVERRIDES^^0
"BLD",10958,"KRN",19,"NM","B","PSJL MANAGER",1)

"BLD",10958,"KRN",19,"NM","B","PSJLAB LIST",2)

"BLD",10958,"KRN",19,"NM","B","PSJLIST OVERRIDES",3)

"BLD",10958,"KRN",19.1,0)
19.1
"BLD",10958,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",10958,"KRN",101,0)
101
"BLD",10958,"KRN",409.61,0)
409.61
"BLD",10958,"KRN",771,0)
771
"BLD",10958,"KRN",779.2,0)
779.2
"BLD",10958,"KRN",870,0)
870
"BLD",10958,"KRN",8989.51,0)
8989.51
"BLD",10958,"KRN",8989.52,0)
8989.52
"BLD",10958,"KRN",8994,0)
8994
"BLD",10958,"KRN","B",.4,.4)

"BLD",10958,"KRN","B",.401,.401)

"BLD",10958,"KRN","B",.402,.402)

"BLD",10958,"KRN","B",.403,.403)

"BLD",10958,"KRN","B",.5,.5)

"BLD",10958,"KRN","B",.84,.84)

"BLD",10958,"KRN","B",3.6,3.6)

"BLD",10958,"KRN","B",3.8,3.8)

"BLD",10958,"KRN","B",9.2,9.2)

"BLD",10958,"KRN","B",9.8,9.8)

"BLD",10958,"KRN","B",19,19)

"BLD",10958,"KRN","B",19.1,19.1)

"BLD",10958,"KRN","B",101,101)

"BLD",10958,"KRN","B",409.61,409.61)

"BLD",10958,"KRN","B",771,771)

"BLD",10958,"KRN","B",779.2,779.2)

"BLD",10958,"KRN","B",870,870)

"BLD",10958,"KRN","B",8989.51,8989.51)

"BLD",10958,"KRN","B",8989.52,8989.52)

"BLD",10958,"KRN","B",8994,8994)

"BLD",10958,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",10958,"QUES",0)
^9.62^^
"BLD",10958,"REQB",0)
^9.611^13^10
"BLD",10958,"REQB",2,0)
PSJ*5.0*54^2
"BLD",10958,"REQB",4,0)
PSJ*5.0*344^2
"BLD",10958,"REQB",5,0)
PSJ*5.0*353^2
"BLD",10958,"REQB",6,0)
PSJ*5.0*355^2
"BLD",10958,"REQB",7,0)
PSJ*5.0*357^2
"BLD",10958,"REQB",8,0)
PSJ*5.0*367^2
"BLD",10958,"REQB",10,0)
PSJ*5.0*366^2
"BLD",10958,"REQB",11,0)
PSJ*5.0*378^2
"BLD",10958,"REQB",12,0)
PSJ*5.0*299^2
"BLD",10958,"REQB",13,0)
PSJ*5.0*382^2
"BLD",10958,"REQB","B","PSJ*5.0*299",12)

"BLD",10958,"REQB","B","PSJ*5.0*344",4)

"BLD",10958,"REQB","B","PSJ*5.0*353",5)

"BLD",10958,"REQB","B","PSJ*5.0*355",6)

"BLD",10958,"REQB","B","PSJ*5.0*357",7)

"BLD",10958,"REQB","B","PSJ*5.0*366",10)

"BLD",10958,"REQB","B","PSJ*5.0*367",8)

"BLD",10958,"REQB","B","PSJ*5.0*378",11)

"BLD",10958,"REQB","B","PSJ*5.0*382",13)

"BLD",10958,"REQB","B","PSJ*5.0*54",2)

"FIA",53.8)
CLOZAPINE MEDICATION OVERRIDES
"FIA",53.8,0)
^PS(53.8,
"FIA",53.8,0,0)
53.8D
"FIA",53.8,0,1)
y^y^f^^^^n
"FIA",53.8,0,10)

"FIA",53.8,0,11)

"FIA",53.8,0,"RLRO")

"FIA",53.8,0,"VR")
5.0^PSJ
"FIA",53.8,53.8)
0
"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^y^p^^^^n^^n
"FIA",55,0,10)

"FIA",55,0,11)

"FIA",55,0,"RLRO")

"FIA",55,0,"VR")
5.0^PSJ
"FIA",55,55)
1
"FIA",55,55.06)
1
"FIA",55,55.06,301)

"INIT")
ADDMENUS^PSJ327P
"KRN",19,11866,-1)
0^2
"KRN",19,11866,0)
PSJLAB LIST^Display Inpatient Lab Tests and Results^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,11866,1,0)
^19.06^3^3^3160329^^
"KRN",19,11866,1,1,0)
This option displays results of lab tests for patients receiving clozapine
"KRN",19,11866,1,2,0)
as required by the circular regarding patient management protocol for the
"KRN",19,11866,1,3,0)
use of clozapine. This is for inpatient pharmacy.
"KRN",19,11866,25)
PSJRXLAB
"KRN",19,11866,"U")
DISPLAY INPATIENT LAB TESTS AN
"KRN",19,11867,-1)
0^3
"KRN",19,11867,0)
PSJLIST OVERRIDES^List Inpatient Clozapine Overrides^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,11867,1,0)
^^2^2^3160407^
"KRN",19,11867,1,1,0)
This generates a list of inpatient ordered clozapine prescriptions entered
"KRN",19,11867,1,2,0)
by overriding the lockout.
"KRN",19,11867,25)
PSJCLOLS
"KRN",19,11867,"U")
LIST INPATIENT CLOZAPINE OVERR
"KRN",19,11868,-1)
0^1
"KRN",19,11868,0)
PSJL MANAGER^Clozapine Inpatient Medications Manager^^M^^PSOLOCKCLOZ^^^^^^INPATIENT MEDICATIONS
"KRN",19,11868,1,0)
^19.06^1^1^3160620^^^^
"KRN",19,11868,1,1,0)
This menu contains options used to control inpatient Clozapine dispensing.
"KRN",19,11868,10,0)
^19.01IP^7^6
"KRN",19,11868,10,3,0)
11867^^3
"KRN",19,11868,10,3,"^")
PSJLIST OVERRIDES
"KRN",19,11868,10,5,0)
11866^^2
"KRN",19,11868,10,5,"^")
PSJLAB LIST
"KRN",19,11868,99)
65143,58268
"KRN",19,11868,"U")
CLOZAPINE INPATIENT MEDICATION
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",77,-1)
1^1
"PKG",77,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",77,22,0)
^9.49I^1^1
"PKG",77,22,1,0)
5.0^3051119^2990416^1
"PKG",77,22,1,"PAH",1,0)
327^3190612^74
"PKG",77,22,1,"PAH",1,1,0)
^^1^1^3190612
"PKG",77,22,1,"PAH",1,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
33
"RTN","PSGNE3")
0^24^B96072062
"RTN","PSGNE3",1,0)
PSGNE3 ;BIR/CML3,MLM-DETERMINE DEFAULT FOR START & STOP TIMES ; 12/13/10 2:46pm
"RTN","PSGNE3",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**4,26,47,50,63,69,105,80,111,183,193,179,275,378,327**;16 DEC 97;Build 114
"RTN","PSGNE3",3,0)
 ;
"RTN","PSGNE3",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGNE3",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGNE3",6,0)
 ; Reference to PSBAPIPM is supported by DBIA 3564
"RTN","PSGNE3",7,0)
 ;
"RTN","PSGNE3",8,0)
 N X1,X2,Y
"RTN","PSGNE3",9,0)
NOW ;
"RTN","PSGNE3",10,0)
 S:'$D(PSGST) PSGST=""
"RTN","PSGNE3",11,0)
 S PSGDT=$$DATE^PSJUTL2(),PSGNESD=$$ENSD($S(PSGST["P":"PRN",1:PSGSCH),PSGS0Y,PSGDT,PSGDT)
"RTN","PSGNE3",12,0)
 ;
"RTN","PSGNE3",13,0)
STOP ; exit when start date found
"RTN","PSGNE3",14,0)
 K ET,F,FT,LT,NT,PSGNE3,TT G:$D(PSGOES)!$D(PSGODF) SF S PSGNESDO=$$ENDD^PSGMI(PSGNESD)
"RTN","PSGNE3",15,0)
 Q
"RTN","PSGNE3",16,0)
 ;
"RTN","PSGNE3",17,0)
ENFD(PSGDT) ; find default stop date
"RTN","PSGNE3",18,0)
 N X1,X2,X3DMIN,Y
"RTN","PSGNE3",19,0)
SF I '$O(^PS(55,PSGP,5,"AUS",PSGDT)),'$D(^PS(53.1,"AC",PSGP)),+$G(^PS(55,PSGP,5.1)) S $P(^PS(55,PSGP,5.1),U)=""
"RTN","PSGNE3",20,0)
 S PSJSYSW0=$G(PSJSYSW0) ; Initialize/restore PSJSYSW0 ward parameters; clinic orders may not have them. Killed at exit in ENKV^PSGSETU
"RTN","PSGNE3",21,0)
 I $G(PSGOEA)="R",$P(PSJSYSW0,"^",4) D ENWALL(%,0,PSGP)
"RTN","PSGNE3",22,0)
 S PSGNEFD="",PSGNEW=$S('$P(PSJSYSW0,U,4):0,+$G(^PS(55,PSGP,5.1))'>PSGDT:0,1:+$G(^PS(55,PSGP,5.1))) S:PSGNEW<PSGNESD PSGNEW=0
"RTN","PSGNE3",23,0)
 I PSGNEW,($G(PSGOEA)="R") S X1=$P(%,"."),X2=3 D C^%DTC S PSGNEW=$S($P(X,".")_(PSGNESD#1)'>PSGNEW:PSGNEW,1:0)
"RTN","PSGNE3",24,0)
 I PSGST="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",25,0)
 ;PSJ*179;x-ref to "APPSJ"
"RTN","PSGNE3",26,0)
 I PSGST'="O",PSGSCH]"",$S(PSGSCH="ONCE":1,PSGSCH="STAT":1,PSGSCH="ONE TIME":1,1:0)!($P($G(^PS(51.1,+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),0)),"^",5)="O") S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",27,0)
 S X1=$P(PSGNESD,"."),X2=$S($P(PSJSYSW0,"^",3):+$P(PSJSYSW0,"^",3),1:14)
"RTN","PSGNE3",28,0)
 D
"RTN","PSGNE3",29,0)
 . ; *** psi 06 082 - RDC 08/2006;ADDED VAR AA TO CHK FOR APPT and CLINIC ***
"RTN","PSGNE3",30,0)
 . N A,AA,B
"RTN","PSGNE3",31,0)
 . Q:'$D(PSGORD)  S A=""
"RTN","PSGNE3",32,0)
 . I PSGORD["P" S A=$G(^PS(53.1,+PSGORD,"DSS"))
"RTN","PSGNE3",33,0)
 . I PSGORD["U" S A=$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSGNE3",34,0)
 . I PSGORD["I" S A=$G(^PS(55,PSGP,"IV",+PSGORD,"DSS"))
"RTN","PSGNE3",35,0)
 . ;PSJ*5*179;Clin Def Stop
"RTN","PSGNE3",36,0)
 . S AA=$P(A,"^",2),A=$P(A,"^") I A,AA S X2=14 I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),X2=$P(^PS(53.46,B,0),"^",2) I X2="" S X2=14
"RTN","PSGNE3",37,0)
 D
"RTN","PSGNE3",38,0)
 .N CLOZFLG I $G(PSGORD)["P",$$GET1^DIQ(53.1,+PSGORD,.01) S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD) I 1
"RTN","PSGNE3",39,0)
 .E  I $G(PSGORD),$$GET1^DIQ(55.06,+PSGORD_","_PSGP,.01) S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) I 1
"RTN","PSGNE3",40,0)
 .E  S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,,$G(PSGDRG))
"RTN","PSGNE3",41,0)
 .Q:'CLOZFLG
"RTN","PSGNE3",42,0)
 .N DFN,X1 S DFN=PSGP
"RTN","PSGNE3",43,0)
 .I '$D(CLOZPAT) D CLOZPAT^PSJCLOZ
"RTN","PSGNE3",44,0)
 .N PSGANC,PSGCFLG,PSGOVRD
"RTN","PSGNE3",45,0)
 .S PSGANC=$$CL^YSCLTST2(DFN),PSGCFLG=1
"RTN","PSGNE3",46,0)
 .S PSGOVRD=$$OVERRIDE^YSCLTST2(DFN)
"RTN","PSGNE3",47,0)
 .S X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGNE3",48,0)
 .I $$GET1^DIQ(55,DFN,53)?1U6N S X2=4
"RTN","PSGNE3",49,0)
 .I 'PSGOVRD,'+$P(PSGANC,"^",4) S X2=4
"RTN","PSGNE3",50,0)
 D C^%DTC
"RTN","PSGNE3",51,0)
 I $G(PSGNEDFD) I $S($P(PSGNEDFD,"^")["L":PSGS0XT!PSGS0Y,1:1) D DFD
"RTN","PSGNE3",52,0)
 I $G(PSGORD),$G(PSGFD) S X3DMIN=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),$S($G(PSGORD)["P":"P",$G(PSGORD)["V":"IV",1:5),1) I X3DMIN]"" D  I PSGNEFD]"" G OUT
"RTN","PSGNE3",53,0)
 . S X3DMIN=$$DURMIN^PSJLIVMD(X3DMIN) I $G(X3DMIN) S PSGNEFD=$$FMADD^XLFDT(PSGNESD,,,X3DMIN)
"RTN","PSGNE3",54,0)
 S X=+(X_$S($P(PSJSYSW0,"^",7):"."_$P(PSJSYSW0,"^",7),1:(PSGNESD#1)))
"RTN","PSGNE3",55,0)
 S PSGNEFD=$S('PSGNEFD:X,X<PSGNEFD:X,1:PSGNEFD) I PSGNEW,(PSGNEW<PSGNEFD),$P(PSJSYSW0,U,4) D
"RTN","PSGNE3",56,0)
 . I $G(PSGORD),$G(PSGRDTX) I PSGORD=$P(PSGRDTX,U,4),PSGNEW<PSGRDTX Q   ; Requested Start is after Stop
"RTN","PSGNE3",57,0)
 . S PSGNEFD=PSGNEW
"RTN","PSGNE3",58,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGNE3",59,0)
 ;
"RTN","PSGNE3",60,0)
OUT ;
"RTN","PSGNE3",61,0)
 ;*179 Account for drug changing
"RTN","PSGNE3",62,0)
 I $G(PSGPDNX)&('$G(PSBSTR)) S:$G(PSGSDX) PSGNESD=PSGSDX S:$G(PSGFDX) PSGNEFD=PSGFDX
"RTN","PSGNE3",63,0)
 I '$D(PSGODF),'$D(PSGOES) S PSGNEFDO=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGNE3",64,0)
 K PSGDL,PSGNEW Q
"RTN","PSGNE3",65,0)
 ;
"RTN","PSGNE3",66,0)
DFD ;
"RTN","PSGNE3",67,0)
 I $P(PSGNEDFD,"^")["D" S X1=$P(PSGNESD,"."),X2=+PSGNEDFD D C^%DTC S X=+(X_"."_$S($P(PSJSYSW0,"^",7):$P(PSJSYSW0,"^",7),1:$P(PSGNESD,".",2)))
"RTN","PSGNE3",68,0)
 I $P(PSGNEDFD,"^")["L" S PSGDL=+PSGNEDFD D EN1^PSGDL
"RTN","PSGNE3",69,0)
 S PSGNEFD=$S(PSGNEW<X&PSGNEW:PSGNEW,1:X) Q:$P(PSGNEDFD,"^")'["D"!'$P(PSJSYSW0,"^",4)!PSGNEW
"RTN","PSGNE3",70,0)
 Q
"RTN","PSGNE3",71,0)
 ;
"RTN","PSGNE3",72,0)
ENOR ;
"RTN","PSGNE3",73,0)
 K PSGOES,PSGODF S X=$P($G(^PS(53.1,DA,2)),"^")
"RTN","PSGNE3",74,0)
 S $P(^PS(53.1,DA,0),"^",7)=$S(X="PRN":"P",X="ONCE":"O",X="STAT":"O",X="ONE TIME":"O",X="ON CALL":"OC",$P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C") D PSGNE3 S X=PSGNESD
"RTN","PSGNE3",75,0)
 Q
"RTN","PSGNE3",76,0)
 ;
"RTN","PSGNE3",77,0)
ENSET0(DFN) ; Set "0" node and build xrefs for entries found without one.
"RTN","PSGNE3",78,0)
 N DA,DIK S ^PS(55,DFN,0)=DFN,DIK="^PS(55,",DIK(1)=.01,DA=DFN D EN^DIK
"RTN","PSGNE3",79,0)
 S $P(^PS(55,DFN,5.1),"^",11)=2 ; Mark as converted for POE
"RTN","PSGNE3",80,0)
 Q
"RTN","PSGNE3",81,0)
 ;
"RTN","PSGNE3",82,0)
ENWALL(SD,FD,DFN) ; Update default stop date if appropriate.
"RTN","PSGNE3",83,0)
 N WALL,NWALL,X1,X2,X3
"RTN","PSGNE3",84,0)
 D NOW^%DTC S X3=%
"RTN","PSGNE3",85,0)
 S WALL=+$G(^PS(55,DFN,5.1)),X1=$P(SD,"."),X2=3 D C^%DTC I +(X_"."_$P(SD,".",2))'>+WALL Q
"RTN","PSGNE3",86,0)
 S X1=$P(X3,"."),X2=$S($P(PSJSYSW0,U,3):+$P(PSJSYSW0,U,3),1:14) D C^%DTC
"RTN","PSGNE3",87,0)
 S NWALL=X_$S($P(PSJSYSW0,U,7):"."_$P(PSJSYSW0,U,7),1:SD#1)
"RTN","PSGNE3",88,0)
 S $P(^PS(55,DFN,5.1),U)=+$S(FD>NWALL:FD,1:NWALL)
"RTN","PSGNE3",89,0)
 Q
"RTN","PSGNE3",90,0)
 ;
"RTN","PSGNE3",91,0)
ENSD(SCH,AT,LI,OSD) ;Find start dt/tm
"RTN","PSGNE3",92,0)
 ;SCH=schedule,AT=admin times,LI=login date/time,OSD=Renewed orders start
"RTN","PSGNE3",93,0)
 I $G(APPT),$G(PSGORD)["P" S XD=$$DATE2^PSJUTL2($S(($$FMDIFF^XLFDT(APPT,PSGDT,2)<0):PSGDT,1:APPT)) Q XD
"RTN","PSGNE3",94,0)
 N X,OSDLI D
"RTN","PSGNE3",95,0)
 .I $L(LI)<13 S X=LI Q
"RTN","PSGNE3",96,0)
 .I $L(LI)=14 S X=$E(LI,13,14) S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",97,0)
 .I $L(LI)=13 S X=$E(LI,13)_0 S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",98,0)
 I $G(LI) S:(LI=$G(OSD)) OSDLI=1
"RTN","PSGNE3",99,0)
 S LI=+$FN(X,"",4) I '$P(LI,".",2) S LI=$$FMADD^XLFDT(LI,-1,0,0,0)_.24
"RTN","PSGNE3",100,0)
 I $G(OSDLI) S OSD=LI K OSDLI
"RTN","PSGNE3",101,0)
 ;BHW;PSJ*5*179;Re-calc Start date
"RTN","PSGNE3",102,0)
 N PSGBCADM,PSGBCLDT,PSGBCLA,PSGBCFR,PSGBTT,PSGBST,PSGBCSHH,PSGBCLHH,PSGBSAT,PSGBSATN,PSGBNAT,PSGBCLIT,PSGBCTDY
"RTN","PSGNE3",103,0)
 N PSGBCTDD,PSGBCTDA,PSGDAYC,PSGBDNXT,PSGBCSCD,PSGBCLID
"RTN","PSGNE3",104,0)
 S (PSGBST,PSGBCFR,PSGBCADM)=""
"RTN","PSGNE3",105,0)
 S PSGBCORD=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,1:$G(PSGORD))
"RTN","PSGNE3",106,0)
 I PSGBCORD S:'$P($G(^PS(55,DFN,$S($G(PSGBCORD)["V":"IV",1:5),+PSGBCORD,0)),"^",2) PSGBCORD=""
"RTN","PSGNE3",107,0)
 I PSGBCORD["U" S PSGBCOT=5,PSGBCND=0,PSGBCPO=25
"RTN","PSGNE3",108,0)
 I PSGBCORD["V" S PSGBCOT="IV",PSGBCND=2,PSGBCPO=5
"RTN","PSGNE3",109,0)
 I (PSGBCORD'["U")&(PSGBCORD'["V") S PSGBCORD=""
"RTN","PSGNE3",110,0)
 I +$G(DFN)&(+PSGBCORD) S PSGBCPRV=PSGBCORD D
"RTN","PSGNE3",111,0)
 .F  S PSGBCADM=$$EN^PSBAPIPM(DFN,PSGBCPRV) Q:PSGBCADM'=""  S PSGBCPRV=$P(^PS(55,DFN,PSGBCOT,+PSGBCPRV,PSGBCND),U,PSGBCPO) Q:(PSGBCPRV="")!(PSGBCPRV["P")
"RTN","PSGNE3",112,0)
 .Q
"RTN","PSGNE3",113,0)
 I $L(PSGBCADM) D  I PSGBST Q +PSGBST
"RTN","PSGNE3",114,0)
 .S PSGBCLID=$P(LI,".",1),PSGBCLIT=$E($P(LI,".",2),1,2) I $L(PSGBCLIT)=1 S PSGBCLIT=PSGBCLIT*10
"RTN","PSGNE3",115,0)
 .S PSGBCSCH=$P(PSGBCADM,U,1),PSGBCSCD=$P(PSGBCSCH,".",1),PSGBCLDT=$P(PSGBCADM,U,2),PSGBCLA=$P(PSGBCADM,U,3)
"RTN","PSGNE3",116,0)
 .I "GR"'[PSGBCLA Q
"RTN","PSGNE3",117,0)
 .S PSGBCFR=""
"RTN","PSGNE3",118,0)
 .I PSGBCORD["U" S PSGBCFR=$P(^PS(55,DFN,5,+PSGBCORD,2),U,6)
"RTN","PSGNE3",119,0)
 .I PSGBCORD["V" S PSGBCFR=$P(^PS(55,DFN,"IV",+PSGBCORD,0),U,15)
"RTN","PSGNE3",120,0)
 .;Convert
"RTN","PSGNE3",121,0)
 .S PSGBCFR=$S(PSGBCFR="D":1440,PSGBCFR="O":0,1:PSGBCFR)*60
"RTN","PSGNE3",122,0)
 .I 'PSGBCFR,'AT Q
"RTN","PSGNE3",123,0)
 .S X=PSGBCSCH D H^%DTC S PSGBCSCH=%H*86400+%T,PSGBCSHH=%H_","_%T
"RTN","PSGNE3",124,0)
 .S X=PSGBCLDT D H^%DTC S PSGBCLDT=%H*86400+%T,PSGBCLHH=%H_","_%T
"RTN","PSGNE3",125,0)
 .;Sched Admin Time
"RTN","PSGNE3",126,0)
 .I PSGBCSCH D
"RTN","PSGNE3",127,0)
 ..;Check admin times/freq
"RTN","PSGNE3",128,0)
 ..I AT D  Q:PSGBST
"RTN","PSGNE3",129,0)
 ...S PSGBSAT=$P($P(PSGBCADM,"^",1),".",2) Q:'PSGBSAT
"RTN","PSGNE3",130,0)
 ...I $L(PSGBSAT)=1 S PSGBSAT=PSGBSAT*10
"RTN","PSGNE3",131,0)
 ...I ((PSGBSAT<PSGBCLIT)!(PSGBCSCD<PSGBCLID))&(PSGBCSCD'>PSGBCLID) S PSGBSAT=PSGBCLIT  ;&(PSGBCFR<86400)
"RTN","PSGNE3",132,0)
 ...S PSGBNAT=""
"RTN","PSGNE3",133,0)
 ...I ($L($P(AT,"-",1))=4)&($L(PSGBSAT)'=4) S PSGBSAT=PSGBSAT_$E("00",1,4-$L(PSGBSAT))
"RTN","PSGNE3",134,0)
 ...F PSGBSATN=1:1 S PSGBNAT=$P(AT,"-",PSGBSATN) Q:PSGBNAT=""  I PSGBNAT>PSGBSAT Q
"RTN","PSGNE3",135,0)
 ...;If DOW
"RTN","PSGNE3",136,0)
 ...I ("SU-MO-TU-WE-TH-FR-SA"[$P(SCH,"-",1)) D  Q:PSGBST
"RTN","PSGNE3",137,0)
 ....;Get TODAY
"RTN","PSGNE3",138,0)
 ....D NOW^%DTC I '$L(PSGBNAT),PSGBCSCD'<X S X1=X,X2=1 D C^%DTC
"RTN","PSGNE3",139,0)
 ....S PSGBCTDD=X D DW^%DTC S PSGBCTDY=$E(X,1,2)
"RTN","PSGNE3",140,0)
 ....K PSGBCTMP F PSGBCTMP="SU:1","MO:2","TU:3","WE:4","TH:5","FR:6","SA:7" S PSGBCTMP($P(PSGBCTMP,":",1))=$P(PSGBCTMP,":",2),PSGBCTMP($P(PSGBCTMP,":",2))=$P(PSGBCTMP,":",1)
"RTN","PSGNE3",141,0)
 ....;DAY of Last Admin
"RTN","PSGNE3",142,0)
 ....S X=PSGBCSCD D DW^%DTC S PSGBCTDA=$E(X,1,2) I PSGBCSCD<PSGBCTDD S PSGBCTDA=PSGBCTDY
"RTN","PSGNE3",143,0)
 ....;Get Next Day in Sched
"RTN","PSGNE3",144,0)
 ....S PSGDAYC=PSGBCTMP(PSGBCTDA),(PSGBDNXT,X)=""
"RTN","PSGNE3",145,0)
 ....F X=PSGDAYC:1:7 I SCH[$G(PSGBCTMP(X)) S PSGBDNXT=PSGBCTMP(X) Q
"RTN","PSGNE3",146,0)
 ....I '$L(PSGBDNXT) S PSGBDNXT=$P(SCH,"-",1)
"RTN","PSGNE3",147,0)
 ....;Set new Start Day
"RTN","PSGNE3",148,0)
 ....S PSGBCTDY=PSGBCTMP(PSGBCTDY)
"RTN","PSGNE3",149,0)
 ....S PSGBDNXT=PSGBCTMP(PSGBDNXT)
"RTN","PSGNE3",150,0)
 ....S X2=PSGBDNXT-PSGBCTDY I X2<0 S X2=(7-PSGBCTDY)+PSGBDNXT
"RTN","PSGNE3",151,0)
 ....S X1=PSGBCTDD D C^%DTC ;Add # of days
"RTN","PSGNE3",152,0)
 ....I +X S PSGBST=X_"."_($S('$L(PSGBNAT)!(PSGBCLID'=X):$P(AT,"-",1),1:PSGBNAT))
"RTN","PSGNE3",153,0)
 ....Q
"RTN","PSGNE3",154,0)
 ...;IF no Next Admin
"RTN","PSGNE3",155,0)
 ...I (('PSGBNAT)&(PSGBCFR))!((PSGBCFR>86399)&(PSGBCSCD<PSGBCLID)) S X1=$S(PSGBCFR<86400:PSGBCLID,1:PSGBCSCD),X2=$S(PSGBCFR<86400:1,1:PSGBCFR/60/60/24) D C^%DTC S PSGBST=+X_"."_($S(PSGBNAT:PSGBNAT,1:$P(AT,"-",1))) Q
"RTN","PSGNE3",156,0)
 ...S PSGBST=PSGBCSCD_"."_PSGBNAT
"RTN","PSGNE3",157,0)
 ...Q
"RTN","PSGNE3",158,0)
 ..I 'PSGBCFR Q
"RTN","PSGNE3",159,0)
 ..;Add Freq
"RTN","PSGNE3",160,0)
 ..S PSGBST=PSGBCSCH+PSGBCFR,PSGBST=(PSGBST\86400)_","_(PSGBST#86400)
"RTN","PSGNE3",161,0)
 ..I $P(PSGBST,",",2)<3600 S $P(PSGBST,",",2)=3600
"RTN","PSGNE3",162,0)
 ..;If next day
"RTN","PSGNE3",163,0)
 ..I $P(PSGBST,",",2)<3600 S %H=$S(+PSGBST=+PSGBCSHH:+PSGBST,1:PSGBST-1)_",86400"
"RTN","PSGNE3",164,0)
 ..S %H=PSGBST D YMD^%DTC S PSGBST=X_(+$E(%,1,5))
"RTN","PSGNE3",165,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",166,0)
 ..;If the date/time is > than the First admin
"RTN","PSGNE3",167,0)
 ..I AT,($P(PSGBST,".",1)>PSGBCLID) D
"RTN","PSGNE3",168,0)
 ...S PSGBSAT=$P(PSGBST,".",2) I $L(PSGBSAT)=1 S PSGBSAT=PSGBSAT*10
"RTN","PSGNE3",169,0)
 ...S PSGBSATN=$P(AT,"-",1) ;First admin TIME
"RTN","PSGNE3",170,0)
 ...I PSGBSAT>PSGBSATN S PSGBST=$P(PSGBST,".",1)_"."_PSGBSATN
"RTN","PSGNE3",171,0)
 ...Q
"RTN","PSGNE3",172,0)
 ..Q
"RTN","PSGNE3",173,0)
 .;Future Date?
"RTN","PSGNE3",174,0)
 .I (PSGBST)&((PSGBST<LI)!(($P(PSGBCADM,"^",1)+.0001)>PSGBST)) D
"RTN","PSGNE3",175,0)
 ..S INFO=($S(($P(PSGBCADM,"^",1)+.0001>PSGBST):$P(PSGBCADM,"^",1)+.0001,1:$G(LI)))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSGNE3",176,0)
 ..S PSGBST=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSGNE3",177,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",178,0)
 ..Q
"RTN","PSGNE3",179,0)
 .;No Sched time
"RTN","PSGNE3",180,0)
 .I PSGBCLDT,PSGBCFR,'PSGBCSCH D  Q
"RTN","PSGNE3",181,0)
 ..;Add Freq
"RTN","PSGNE3",182,0)
 ..S PSGBST=PSGBCLDT+PSGBCFR,PSGBST=(PSGBST\86400)_","_(PSGBST#86400)
"RTN","PSGNE3",183,0)
 ..I $P(PSGBST,",",2)<3600 S $P(PSGBST,",",2)=3600
"RTN","PSGNE3",184,0)
 ..I $P(PSGBST,",",2)#3600 S PSGBTT=$P(($P(PSGBST,",",2)/3600)+1,".",1)*3600,$P(PSGBST,",",2)=PSGBTT
"RTN","PSGNE3",185,0)
 ..;If next day
"RTN","PSGNE3",186,0)
 ..I $P(PSGBST,",",2)<3600 S %H=$S(+PSGBST=+PSGBCLHH:+PSGBST,1:PSGBST-1)_",86400"
"RTN","PSGNE3",187,0)
 ..S %H=PSGBST D YMD^%DTC S PSGBST=X_(+$E(%,1,3))
"RTN","PSGNE3",188,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",189,0)
 ..Q
"RTN","PSGNE3",190,0)
 ;BHW;PSJ*5*179;END
"RTN","PSGNE3",191,0)
 I ($P($G(PSJSYSW0),U,5)="")!($P($G(PSJSYSW0),U,5)=2) Q LI
"RTN","PSGNE3",192,0)
 S:SCH["PRN" AT=""
"RTN","PSGNE3",193,0)
 N INT,PSG S:(SCH'["PRN"&(SCH'?1"Q".N1"H")&(LI'=OSD)&('AT)&($G(PSGST)'="O")) AT=$E(OSD,9,10) S OSD=$E(OSD,1,10)
"RTN","PSGNE3",194,0)
 S INT=$S(SCH="QD":24,SCH="QOD":48,SCH="QH":1,SCH?1"Q".N1"D":(+$P(SCH,"Q",2)*24),SCH?1"Q".N1"H":+$P(SCH,"Q",2),LI=OSD:24,1:24)
"RTN","PSGNE3",195,0)
 S:INT=24 OSD=$$FMADD^XLFDT(LI,0,-INT,0,0)
"RTN","PSGNE3",196,0)
 I 'AT,INT>23 S:$P(PSJSYSW0,U,5)!($E(LI,11,12)>30) AT=$E($$FMADD^XLFDT(LI,0,1,0,0),9,10) S:AT="00" AT=24 S:'AT AT=$E(LI,9,10)
"RTN","PSGNE3",197,0)
 I SCH?1"Q".N1"H",'AT S ND=OSD,PSG(+ND)="" S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) F  S ND=$$FMADD^XLFDT(ND,DAYS,HRS),PSG(+ND)="" Q:ND>LI
"RTN","PSGNE3",198,0)
 Q:INT=24&'$L(AT,"-") $E(LI,1,8)_AT
"RTN","PSGNE3",199,0)
 I '$O(PSG(LI)) S X=$S(OSD>1:OSD,LI>1:LI,1:$$DATE^PSJUTL2) D
"RTN","PSGNE3",200,0)
 .F  S ND=X D  Q:ND>LI  S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) S X=$$FMADD^XLFDT($S($P(ND,".",2)=24:$P(ND,".")_".23",1:ND),DAYS,HRS) S:$P(X,".")'>$P(ND,".") X=$$FMADD^XLFDT(X,1,0,0,0)
"RTN","PSGNE3",201,0)
 ..F Y=1:1 S AT1=$P(AT,"-",Y) Q:'AT1  S ND=ND\1_"."_AT1,PSG(+ND)=""
"RTN","PSGNE3",202,0)
 Q:$P(PSJSYSW0,U,5) $O(PSG(LI))
"RTN","PSGNE3",203,0)
 S INT="" F ND=0:0 S ND=$O(PSG(ND)) S X=$$FMDIFF^XLFDT(LI,ND,2) S:X<0 X=-X Q:INT&(X'<INT)  S INT=+X,OND=ND Q:INT=0
"RTN","PSGNE3",204,0)
 Q $S($G(OND):OND,1:LI) ;Use login time if OND is null PSJ*5*193
"RTN","PSGOD")
0^21^B41024059
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3 - CREATES NEW ORDER FROM OLD ONE ;12 June 2019 09:31:53
"RTN","PSGOD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**67,58,111,133,181,286,281,315,338,256,347,367,327**;16 DEC 97;Build 114
"RTN","PSGOD",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 ;*286 - Do not allow copied Unit Dose orders for outpatients
"RTN","PSGOD",7,0)
 D INP^VADPT I 'VAIN(4) W !,"You cannot copy Unit Dose orders for this patient!" H 2 Q
"RTN","PSGOD",8,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",9,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",10,0)
 ; /MZR PSJ*5*327 start
"RTN","PSGOD",11,0)
 N CLOZFLG D  G:$G(ANQX) DONE
"RTN","PSGOD",12,0)
 .S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSJORD) Q:'CLOZFLG  ; continue just with Clozapine drug
"RTN","PSGOD",13,0)
 .N CLOZNUM,CLOZUID
"RTN","PSGOD",14,0)
 .S CLOZNUM=$$GET1^DIQ(55,DFN,53)
"RTN","PSGOD",15,0)
 .I CLOZNUM'="" S CLOZUID=$$FIND1^DIC(603.01,,"X",CLOZNUM)
"RTN","PSGOD",16,0)
 .I '$G(CLOZUID) D  Q
"RTN","PSGOD",17,0)
 ..W !!,"*** This patient has no clozapine registration number ***"
"RTN","PSGOD",18,0)
 ..W !,"*** and must be reregistered ***"
"RTN","PSGOD",19,0)
 ..D PAUSE^VALM1 S ANQX=1 Q
"RTN","PSGOD",20,0)
 .S CLOZPAT=$$GET1^DIQ(603.01,CLOZUID,2,"I"),CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,CLOZPAT="W":0,1:90)
"RTN","PSGOD",21,0)
 ; /MZR PSJ*5*327 end
"RTN","PSGOD",22,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",23,0)
 G:%'=1 DONE
"RTN","PSGOD",24,0)
 ;
"RTN","PSGOD",25,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",26,0)
 K PSGORQF
"RTN","PSGOD",27,0)
 N PSGPDRG,Q
"RTN","PSGOD",28,0)
 N PSJOLDNM
"RTN","PSGOD",29,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD,Q=""
"RTN","PSGOD",30,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,2.1,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",31,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",32,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",33,0)
 ;*315
"RTN","PSGOD",34,0)
 S:$G(PSGODN(2.1))]"" PSGDUR=+PSGODN(2.1),PSGRMVT=$P(PSGODN(2.1),U,2),PSGRMV=$P(PSGODN(2.1),U,3),PSGRF=$P(PSGODN(2.1),U,4)
"RTN","PSGOD",35,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",36,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD
"RTN","PSGOD",37,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",38,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",39,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",40,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD  
"RTN","PSGOD",41,0)
 ;338
"RTN","PSGOD",42,0)
 N PSGK5345 S PSGK5345=0
"RTN","PSGOD",43,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND D
"RTN","PSGOD",44,0)
 .I '$P(ND,"^",3),'PSGK5345 S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",45,0)
 .I '$P(ND,"^",3),PSGK5345 S PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0) S PSGODN(1)=PSGODN(1)+1,PSGK5345=0 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0)
"RTN","PSGOD",46,0)
 .I $P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0) S PSGK5345=1
"RTN","PSGOD",47,0)
 K PSGK5345
"RTN","PSGOD",48,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",49,0)
 ;PSJ*5*256
"RTN","PSGOD",50,0)
 S PSJOLDNM("ORD_SCHD")=PSGSCH
"RTN","PSGOD",51,0)
 I $$CHKSCHD^PSJMISC2(.PSJOLDNM) W !!,"Order not copied." D PAUSE^VALM1 K PSJOLDNM G ORIG
"RTN","PSGOD",52,0)
 S:$G(PSJOLDNM("NEW_SCHD"))]"" PSGSCH=PSJOLDNM("NEW_SCHD") K PSJOLDNM
"RTN","PSGOD",53,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",54,0)
 W "." D ^PSGNE3
"RTN","PSGOD",55,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",56,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",57,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",58,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",59,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",60,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",61,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",62,0)
 .I $G(PSGAT),($G(PSGS0Y)="") S PSGS0Y=PSGAT
"RTN","PSGOD",63,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",64,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",65,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",66,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",67,0)
 I $G(PSJACEPT)=1 D OC S:$D(PSGORQF) PSJACEPT=0 S:$G(PSJACEPT)=1 VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",68,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W:'$G(PSJCOFLG) !!,"Order not copied." D PAUSE^VALM1:'$G(PSJCOFLG) G ORIG    ;PSJCOFLG set in PSODGAL1 for allergies
"RTN","PSGOD",69,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",70,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",71,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",72,0)
 .;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOD",73,0)
 .I +$G(PSGCOPY)!(+$G(PSGEDT)) D
"RTN","PSGOD",74,0)
 ..I CLOZFLG D
"RTN","PSGOD",75,0)
 ...I $D(^TMP($J,"PSGCLOZ",DFN,+$G(PSJORD),"SAND")) D   K ^TMP($J,"PSGCLOZ",DFN,+PSJORD,"SAND")
"RTN","PSGOD",76,0)
 ....S DIE="^PS(55,"_DFN_",5,",DA=+PSJORD,DA(1)=DFN,DR="301////"_^TMP($J,"PSGCLOZ",DFN,+PSJORD,"SAND") D ^DIE
"RTN","PSGOD",77,0)
 ...N PSGDN S PSGDN=$P(CLOZFLG,U,2)
"RTN","PSGOD",78,0)
 ...D PSJFILE^PSJCLOZ(DFN),INPSND^YSCLTST5 K:$D(^TMP($J,"CLOZFLG",DFN)) ^TMP($J,"CLOZFLG",DFN)
"RTN","PSGOD",79,0)
 .;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOD",80,0)
 .D SETOC^PSJNEWOC(PSGORD) ;RTC 178789 Store allergy if auto vf is on
"RTN","PSGOD",81,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD) N PSGOEEF S PSGOEEF=0 D ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",82,0)
 ;RTC 178789 - store allery if not verified the newly copied order
"RTN","PSGOD",83,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="COPY UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSGOD",84,0)
 ;
"RTN","PSGOD",85,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",86,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",87,0)
ORIG ;Redisplay original order
"RTN","PSGOD",88,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",89,0)
DONE ;
"RTN","PSGOD",90,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",91,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",92,0)
 Q
"RTN","PSGOD",93,0)
 ;
"RTN","PSGOD",94,0)
CH ;
"RTN","PSGOD",95,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",96,0)
 ;
"RTN","PSGOD",97,0)
WH ;
"RTN","PSGOD",98,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOD",99,0)
 ;
"RTN","PSGOD",100,0)
OC ;Perform order checks
"RTN","PSGOD",101,0)
 NEW PSJDD,X,PSJALLGY
"RTN","PSGOD",102,0)
 ;*286 - Order checks on current dispense drugs
"RTN","PSGOD",103,0)
 F X=0:0 S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  D
"RTN","PSGOD",104,0)
 . S PSJDD=$G(^PS(53.45,PSJSYSP,2,X,0))
"RTN","PSGOD",105,0)
 . I +PSJDD S PSJALLGY(+PSJDD)=""
"RTN","PSGOD",106,0)
 ;S X=+$O(PSGODN(1,0)) Q:'X  S PSJDD=+$G(PSGODN(1,X)) Q:'PSJDD
"RTN","PSGOD",107,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",108,0)
 D FULL^VALM1
"RTN","PSGOD",109,0)
 ;; START NCC REMEDIATION >> 327*RJS FOR TOTAL DAILY DOSE
"RTN","PSGOD",110,0)
 I CLOZFLG S ANQX=0 D TDD^PSJCLOZ
"RTN","PSGOD",111,0)
 Q:$G(PSGORQF) 
"RTN","PSGOD",112,0)
 ;/RJS Begin PSJ*5.0*327 modification FOR ORDER CHECKS
"RTN","PSGOD",113,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",114,0)
 D FULL^VALM1
"RTN","PSGOD",115,0)
 D ENDDC^PSGSICHK($G(PSGP),PSJDD) Q:$G(PSGORQF)
"RTN","PSGOD",116,0)
 D IN^PSJOCDS($G(PSGORD),"UD",PSJDD) Q:$G(PSGORQF)
"RTN","PSGOD",117,0)
 D ORD^PSJCLOZ
"RTN","PSGOD",118,0)
 Q
"RTN","PSGOE41")
0^6^B134934850
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3 - REGULAR ORDER ENTRY (CONT.) ;12 June 2019 09:08:29
"RTN","PSGOE41",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,63,64,69,58,111,136,113,267,315,334,373,366,327**;16 DEC 97;Build 114
"RTN","PSGOE41",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE41",4,0)
 ; Reference to ^DICN via DBIA 10009
"RTN","PSGOE41",5,0)
 ; Reference to %DT via DBIA 10003
"RTN","PSGOE41",6,0)
 ; Reference to %DTC via DBIA 10000
"RTN","PSGOE41",7,0)
 ; Reference to ^PS(51.1 via DBIA 2177
"RTN","PSGOE41",8,0)
 ; Reference to ^PS(50.7 via DBIA# 2180
"RTN","PSGOE41",9,0)
 ;
"RTN","PSGOE41",10,0)
39 ; admin times
"RTN","PSGOE41",11,0)
 G:$P(PSGNEDFD,"^",3)="P"!($P(PSGNEDFD,"^",3)="OC") 8
"RTN","PSGOE41",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G 8
"RTN","PSGOE41",13,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1,PSGDUR="" G DONE
"RTN","PSGOE41",14,0)
 I X="",PSGS0Y]"" S PSGNOHI=1,X=PSGS0Y ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE41",15,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",16,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",17,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 39
"RTN","PSGOE41",18,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",19,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",20,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",21,0)
 .Q
"RTN","PSGOE41",22,0)
 I $G(PSGS0XT)'="D",$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC" D TIMES G:'$D(X) 39 D PSGDUR G:'$D(X) 39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE41",23,0)
 I $G(PSGS0XT)="O",X="" S (PSGAT,PSGS0Y)=X,PSGFOK(39)="" G 8
"RTN","PSGOE41",24,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" G 39
"RTN","PSGOE41",25,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",26,0)
 ;
"RTN","PSGOE41",27,0)
8 ; special instructions
"RTN","PSGOE41",28,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD))
"RTN","PSGOE41",29,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",30,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",32,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<3)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>2:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE41",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",35,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",36,0)
10 ; start date/time
"RTN","PSGOE41",37,0)
 D ^PSGNE3
"RTN","PSGOE41",38,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",39,0)
A10 ; start date/time edit
"RTN","PSGOE41",40,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE41",41,0)
 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",42,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",43,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",44,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",45,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",46,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",47,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE41",48,0)
 S X1=PSGDT,X2=+7 D C^%DTC
"RTN","PSGOE41",49,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE41",50,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",51,0)
 ;
"RTN","PSGOE41",52,0)
O25 ;
"RTN","PSGOE41",53,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",54,0)
 ;
"RTN","PSGOE41",55,0)
25 ; stop date
"RTN","PSGOE41",56,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",57,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",58,0)
 ; HEC/hrubovcak PSJ*5*327 begin
"RTN","PSGOE41",59,0)
 N CLOZFLG,CLOZPAT,PSGCFLG,PSGEMRG,PSGTDTD,WRDPDYS
"RTN","PSGOE41",60,0)
 S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,,PSGDRG) I CLOZFLG D
"RTN","PSGOE41",61,0)
 . N WRDPDYS S WRDPDYS=U  ; ward parameter days
"RTN","PSGOE41",62,0)
 . ; if one-time default to INPATIENT WARD PARAMETERS value for stop date
"RTN","PSGOE41",63,0)
 . I $G(PSGST)="O",$G(PSJPWD) D
"RTN","PSGOE41",64,0)
 ..  N IEN S IEN=+$O(^PS(59.6,"B",PSJPWD,0)) Q:'IEN  ; get IEN in file #59.6
"RTN","PSGOE41",65,0)
 ..  S WRDPDYS=$P($G(^PS(59.6,IEN,0)),U,28)  ; (#3) DAYS UNTIL STOP FOR ONE-TIME [28N]
"RTN","PSGOE41",66,0)
 . I WRDPDYS S PSGNEFD=$$FMADD^XLFDT(PSGNESD,WRDPDYS),PSGFD=$$ENDD^PSGMI(PSGNEFD) Q
"RTN","PSGOE41",67,0)
 . S PSGNEFD=X,PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",68,0)
 . S PSGCFLG=1,PSGOVRD=$$OVERRIDE^YSCLTST2(PSGP)  ; PSGCFLG prevents message in YSCLTST2
"RTN","PSGOE41",69,0)
 . S PSGCFLG=0
"RTN","PSGOE41",70,0)
 . I $D(ANQDATA),$P(ANQDATA,"^",3)=9 D
"RTN","PSGOE41",71,0)
 ..  N X,X1,X2,X3 S X3=$G(PSGNESD),X1=X3,X2=4 D C^%DTC S PSGNEFD=X,PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",72,0)
 ..  S PSGOLDED=PSGFD,PSGNEFDOLD=PSGNEFD,PSGTDTD=1
"RTN","PSGOE41",73,0)
 . I $$GET1^DIQ(55,PSGP,53)?1U6N D  ; stop date for temporary clozapine registration
"RTN","PSGOE41",74,0)
 ..  N X S X=$$FMADD^XLFDT(PSGNESD,4),PSGNEFD=X,PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",75,0)
 ..  S PSGOLDED=PSGFD,PSGNEFDOLD=PSGNEFD,PSGEMRG=1
"RTN","PSGOE41",76,0)
 . D CLOZPAT^PSJCLOZ
"RTN","PSGOE41",77,0)
 . I $D(CLOZPAT),'$G(PSGEMRG),'$G(PSGTDTD) D  ; stop date
"RTN","PSGOE41",78,0)
 ..  N X,X1,X2
"RTN","PSGOE41",79,0)
 ..  S X1=PSGNESD,X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE41",80,0)
 ..  D C^%DTC S PSGNEFD=X,PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",81,0)
 ..  S PSGCFLG=0,PSGOLDED=PSGFD,PSGNEFDOLD=PSGNEFD
"RTN","PSGOE41",82,0)
 ; PSJ*5*327 end
"RTN","PSGOE41",83,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE41",84,0)
 I +$G(PSGRF),$$FIND1^DIC(51.1,,"X",$G(PSGSCH)) D
"RTN","PSGOE41",85,0)
 .S:PSGTMPST=($G(PSGST)="R") PSGST=$$GET1^DIQ(51.1,$$FIND1^DIC(51.1,,"X",$G(PSGSCH)),5,"I") ;Handle "Fill on Request"
"RTN","PSGOE41",86,0)
 .Q
"RTN","PSGOE41",87,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGNEFD,PSGFD)="" D
"RTN","PSGOE41",88,0)
 .I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE41",89,0)
 ..S MSG(2)=" at the next administration."
"RTN","PSGOE41",90,0)
 ..S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE41",91,0)
 ..Q
"RTN","PSGOE41",92,0)
 .I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE41",93,0)
 ..S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",94,0)
 ..S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE41",95,0)
 ..S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE41",96,0)
 ..S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE41",97,0)
 ..Q
"RTN","PSGOE41",98,0)
 .I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE41",99,0)
 ..S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",100,0)
 ..S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE41",101,0)
 ..Q
"RTN","PSGOE41",102,0)
 .D EN^DDIOL(.MSG)
"RTN","PSGOE41",103,0)
 ;
"RTN","PSGOE41",104,0)
A25 ;
"RTN","PSGOE41",105,0)
 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",106,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",107,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",108,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",109,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",110,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE41",111,0)
 ; re-ask if Stop Date more than 367 days after Start Date
"RTN","PSGOE41",112,0)
 S X1=+Y,X2=PSGNESD D ^%DTC
"RTN","PSGOE41",113,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A25
"RTN","PSGOE41",114,0)
 ;
"RTN","PSGOE41",115,0)
 I CLOZFLG D  I $G(PSGCFLG) S PSGCFLG=0 G A25
"RTN","PSGOE41",116,0)
 . N X2 S X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE41",117,0)
 . I $G(PSGEMRG)!$G(PSGTDTD) S X2=4
"RTN","PSGOE41",118,0)
 . I $P(Y,".")>$P(PSGNEFD,".") D  S PSGCFLG=1 Q
"RTN","PSGOE41",119,0)
 ..  W !!,"*** STOP DATE/TIME NOT TO EXCEED "_X2_" DAYS! ***",!
"RTN","PSGOE41",120,0)
 . S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE41",121,0)
 ;
"RTN","PSGOE41",122,0)
A255 ;
"RTN","PSGOE41",123,0)
 I $G(PSGCFLG) S PSGCFLG=0 G A25
"RTN","PSGOE41",124,0)
 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",125,0)
 K PSGEMRG,PSGTDTD
"RTN","PSGOE41",126,0)
 ;
"RTN","PSGOE41",127,0)
W25 ;
"RTN","PSGOE41",128,0)
 N Z
"RTN","PSGOE41",129,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE41",130,0)
 .W !,"There must be an admin time that falls between the Start Date/Time"
"RTN","PSGOE41",131,0)
 .W !,"and the Stop Date/Time."
"RTN","PSGOE41",132,0)
 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",133,0)
 D EFDNEW^PSJUTL  ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",134,0)
 I $G(PSGDUR),'$G(PSGOROE1) D VERTIMES ;*315
"RTN","PSGOE41",135,0)
NEXT ;
"RTN","PSGOE41",136,0)
 S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I")
"RTN","PSGOE41",137,0)
 G:'$D(PSGAARR) 1^PSGOE42
"RTN","PSGOE41",138,0)
 ;
"RTN","PSGOE41",139,0)
DONE ;
"RTN","PSGOE41",140,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",141,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,PSGEMRG,PSGCLOZ Q
"RTN","PSGOE41",142,0)
 ;
"RTN","PSGOE41",143,0)
FF ; up-arrow to another field
"RTN","PSGOE41",144,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",145,0)
 Q
"RTN","PSGOE41",146,0)
 ;
"RTN","PSGOE41",147,0)
DEL ; delete entry
"RTN","PSGOE41",148,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",149,0)
 Q
"RTN","PSGOE41",150,0)
TIMES    ;At least one admin time, not more than interval allows.
"RTN","PSGOE41",151,0)
 I $G(PSGS0XT)'="O",X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSGOE41",152,0)
 N H,I,MAX
"RTN","PSGOE41",153,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE41",154,0)
 I $G(PSGST)="O",$L(X,"-")>1 W !,"This is a One Time Order - only one admin time is permitted." K X Q
"RTN","PSGOE41",155,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE41",156,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE41",157,0)
 S MAX=1440/I
"RTN","PSGOE41",158,0)
 I MAX<1 D  Q
"RTN","PSGOE41",159,0)
 . I $L(X,"-")'=1 W !,"This order requires one admin time." K X Q
"RTN","PSGOE41",160,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSGOE41",161,0)
 I MAX'<1,$L(X,"-")<MAX W !,"The number of admin times entered is fewer than indicated by the schedule."  ;Too few times
"RTN","PSGOE41",162,0)
 Q
"RTN","PSGOE41",163,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE41",164,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE41",165,0)
 N INFO,X
"RTN","PSGOE41",166,0)
 S Z="",INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE41",167,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE41",168,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE41",169,0)
 Q
"RTN","PSGOE41",170,0)
 ;
"RTN","PSGOE41",171,0)
 ;*315 new tags
"RTN","PSGOE41",172,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE41",173,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE41",174,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE41",175,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE41",176,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE41",177,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE41",178,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE41",179,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE41",180,0)
 ;
"RTN","PSGOE41",181,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE41",182,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE41",183,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=PSGDUR/60 S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1 ; Use separate validation for Times Per Day type orders
"RTN","PSGOE41",184,0)
 S PSGF2=39
"RTN","PSGOE41",185,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGOROE1=1,X="^" K PSGFOK(39) Q
"RTN","PSGOE41",186,0)
 I RP="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMV)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",187,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGFOK(39),PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:$$GET1^DIQ(53.1,+$G(PSGORD),137) (PSGDUR,PSGRMVT)="@" Q
"RTN","PSGOE41",188,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE41",189,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE41",190,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE41",191,0)
 I (+RP>0),'PSGIDF D  I PSGRMV<1 K PSGRMV G PSGDUR ; exclude BID,TID or QID schedules
"RTN","PSGOE41",192,0)
 .S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE41",193,0)
 .I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR ;,PSGRMV G PSGDUR
"RTN","PSGOE41",194,0)
 .Q
"RTN","PSGOE41",195,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE41",196,0)
 I PSGRF=3,(+RP<1) W !,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE41",197,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE41",198,0)
 .W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE41",199,0)
 .W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE41",200,0)
 .W !,"to the next Admin Time."
"RTN","PSGOE41",201,0)
 .S PSGRMV=-1,RP=0
"RTN","PSGOE41",202,0)
 .Q
"RTN","PSGOE41",203,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE41",204,0)
 .N F,P,PSGARR
"RTN","PSGOE41",205,0)
 .S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGAT=PSGADT
"RTN","PSGOE41",206,0)
 .S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE41",207,0)
 .F P=1:1:PSGARR D
"RTN","PSGOE41",208,0)
 ..S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE41",209,0)
 ..I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE41",210,0)
 ..Q
"RTN","PSGOE41",211,0)
 .Q
"RTN","PSGOE41",212,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE41",213,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE41",214,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE41",215,0)
 Q:'$G(PSGOE3)!'+$G(PSGDUR)
"RTN","PSGOE41",216,0)
 ;
"RTN","PSGOE41",217,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE41",218,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE41",219,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE41",220,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE41",221,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="",$G(PSGS0Y)="" D  Q
"RTN","PSGOE41",222,0)
 .N L
"RTN","PSGOE41",223,0)
 .S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE41",224,0)
 .S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE41",225,0)
 .S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE41",226,0)
 .S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE41",227,0)
 .D WRITE
"RTN","PSGOE41",228,0)
 .Q
"RTN","PSGOE41",229,0)
 ;
"RTN","PSGOE41",230,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE41",231,0)
 N P,L
"RTN","PSGOE41",232,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE41",233,0)
 .S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE41",234,0)
 .S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE41",235,0)
 .S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE41",236,0)
 .S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE41",237,0)
 .S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE41",238,0)
 .S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE41",239,0)
 .Q
"RTN","PSGOE41",240,0)
 D WRITE
"RTN","PSGOE41",241,0)
 Q
"RTN","PSGOE41",242,0)
 ;
"RTN","PSGOE41",243,0)
WRITE ;
"RTN","PSGOE41",244,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE41",245,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE41",246,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE41",247,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE41",248,0)
 D ASK
"RTN","PSGOE41",249,0)
 Q
"RTN","PSGOE41",250,0)
 ;
"RTN","PSGOE41",251,0)
ASK ;
"RTN","PSGOE41",252,0)
 N Y
"RTN","PSGOE41",253,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE41",254,0)
 I 'Y K X S PSGDUR=-1 G 39
"RTN","PSGOE41",255,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",256,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE41",257,0)
 .S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",258,0)
 .Q
"RTN","PSGOE41",259,0)
 Q
"RTN","PSGOE41",260,0)
 ;
"RTN","PSGOE42")
0^2^B13181041
"RTN","PSGOE42",1,0)
PSGOE42 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;13 May 2019 18:44:10
"RTN","PSGOE42",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**366,327**;16 DEC 97;Build 114
"RTN","PSGOE42",3,0)
 ;
"RTN","PSGOE42",4,0)
 ;
"RTN","PSGOE42",5,0)
1 I $G(PSGCLOZ) K PSGCLOZ Q  ;NCC remediation *327/RJS QUIT IF STOP DATE HAS BEEN MODIFIED AND PROCESS
"RTN","PSGOE42",6,0)
 S:'$G(PSGPR) PSGPR=0 S:'$D(PSGPRN) PSGPRN=""  ; must have provider info
"RTN","PSGOE42",7,0)
 ; provider
"RTN","PSGOE42",8,0)
 I '$G(PSJSYSU) S PSTMPI=PSGPR,PSTMPN=PSGPRN G A1
"RTN","PSGOE42",9,0)
 I $S(+PSJSYSU=3:0,1:$P(PSJSYSU,";",2)) G:$P(PSJSYSW0,"^",24) 5 G DONE
"RTN","PSGOE42",10,0)
 S PSTMPI=PSGPR,PSTMPN=PSGPRN
"RTN","PSGOE42",11,0)
A1 ;
"RTN","PSGOE42",12,0)
 ;*366 - check provider credentials
"RTN","PSGOE42",13,0)
 I PSGPR N PSJACT S PSJACT=$$ACTPRO^PSGOE1(PSGPR) S:'PSJACT PSGPR=0,PSGPRN=""
"RTN","PSGOE42",14,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^" W $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",15,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?",PSGF2=1 D ENHLP^PSGOEM(53.1,1) G 1
"RTN","PSGOE42",16,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$$GET1^DIQ(200,PSGPR,53.1,"I") W "    "_$$GET1^DIQ(200,PSGPR,53.2)_"    "_$$GET1^DIQ(200,PSGPR,53.3) S PSGFOK(1)="" G A2
"RTN","PSGOE42",17,0)
 S PSGF2=1 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE42",18,0)
 I $E(X)="^" D FF G:Y>0 @Y G 1
"RTN","PSGOE42",19,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G 1
"RTN","PSGOE42",20,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOE42",21,0)
A2 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE42",22,0)
 I $$ISCLOZ^PSJCLOZ(,,,,PSGDRG) D
"RTN","PSGOE42",23,0)
 .S ANQX=0 D PROVCHK^PSJCLOZ(PSGPR) ;(PSGP,PSGDRG)
"RTN","PSGOE42",24,0)
 .I ANQX=0 K PSTMPN,PSTMPI
"RTN","PSGOE42",25,0)
 I $G(ANQX) S PSGPR=PSTMPI,PSGPRN=PSTMPN W ! K ANQX G A1
"RTN","PSGOE42",26,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOE42",27,0)
5 ; self med
"RTN","PSGOE42",28,0)
 I '$P(PSJSYSW0,"^",24) G DONE
"RTN","PSGOE42",29,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",30,0)
 I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G DONE
"RTN","PSGOE42",31,0)
 I X="@" W:PSGSM="" $C(7),"  ??" G:PSGSM="" A5 D DEL G:%'=1 A5 S (PSGSM,PSGHSM)="" G DONE
"RTN","PSGOE42",32,0)
 S PSGF2=5 I X?1"^".E D FF G:Y>0 @Y G A5
"RTN","PSGOE42",33,0)
 I X?1."?" S PSGF2=5 D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE42",34,0)
 D YN I  S PSGSM=$E(X)="Y",PSGFOK(5)="" G 6:PSGSM,DONE
"RTN","PSGOE42",35,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE42",36,0)
 ;
"RTN","PSGOE42",37,0)
6 ; hospital supplied self med
"RTN","PSGOE42",38,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",39,0)
 I "01"[X,$L(X)<2 S:PSGHSM=""&(X]"") PSGHSM=X W:PSGHSM]"" "  (",$P("NO^YES","^",PSGHSM+1),")" G DONE
"RTN","PSGOE42",40,0)
 I X="@" W:PSGHSM="" $C(7),"  ??" G:PSGHSM="" 6 D DEL G:%'=1 6 S PSGHSM="" G DONE
"RTN","PSGOE42",41,0)
 S PSGF2=6 I X?1"^".E D FF G:Y>0 @Y G 6
"RTN","PSGOE42",42,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G 6
"RTN","PSGOE42",43,0)
 D YN I  S PSGHSM=$E(X)="Y" G DONE
"RTN","PSGOE42",44,0)
 W $C(7) S PSGF2=6 D ENHLP^PSGOEM(53.1,6) G 6
"RTN","PSGOE42",45,0)
 Q
"RTN","PSGOE42",46,0)
 ;
"RTN","PSGOE42",47,0)
DONE ;
"RTN","PSGOE42",48,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE42",49,0)
 ;
"RTN","PSGOE42",50,0)
FF ; up-arrow to another field
"RTN","PSGOE42",51,0)
 D ENFF^PSGOEM I Y>0,Y'=1,Y'=5 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:1)
"RTN","PSGOE42",52,0)
 Q
"RTN","PSGOE42",53,0)
 ;
"RTN","PSGOE42",54,0)
DEL ; delete entry
"RTN","PSGOE42",55,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE42",56,0)
 Q
"RTN","PSGOE42",57,0)
 ;
"RTN","PSGOE42",58,0)
YN ; yes/no as a set of codes
"RTN","PSGOE42",59,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE42",60,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE42",61,0)
 Q
"RTN","PSGOE42",62,0)
 ;
"RTN","PSGOE42",63,0)
2 ; dispense drug multiple
"RTN","PSGOE42",64,0)
 I PSGDRG,'$D(^PS(53.45,PSJSYSP,2)) S ^(2,0)="^53.4502P^1^1",^(1,0)=PSGDRG_"^"_PSGUD
"RTN","PSGOE42",65,0)
 K DA,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=$S($G(PSGFOK(13)):.02,1:".01;.02") D ^DIE
"RTN","PSGOE42",66,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!"
"RTN","PSGOE42",67,0)
 I $G(PSGFOK(13)) Q
"RTN","PSGOE42",68,0)
 G @FB
"RTN","PSGOE42",69,0)
 ;
"RTN","PSGOE7")
0^4^B45336185
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ; 8/6/18 11:56am
"RTN","PSGOE7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,26,34,52,55,50,87,111,181,254,267,260,288,281,317,355,327**;16 DEC 97;Build 114
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; Reference to ^PSNAPIS is supported by DBIA 2531
"RTN","PSGOE7",8,0)
 ; Reference to $$GET^XPAR is supported by DBIA 2263
"RTN","PSGOE7",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSGOE7",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSGOE7",11,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",12,0)
 ; 
"RTN","PSGOE7",13,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",14,0)
 S PSGDICS="U"
"RTN","PSGOE7",15,0)
 ;
"RTN","PSGOE7",16,0)
AD ; Ask Drug
"RTN","PSGOE7",17,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",18,0)
 K PSGODO,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSGOE7",19,0)
 D ENKILL^PSJLMUDE
"RTN","PSGOE7",20,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",21,0)
 N PSJTABS,PSJPLTYP,PSJPDLOC
"RTN","PSGOE7",22,0)
 E  D
"RTN","PSGOE7",23,0)
 .I '$D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I $$GET1^DIQ(50,+Y,2.1,""I""),$$GET1^DIQ(50,+Y,63)[""U"" S X(1)=+$$GET1^DIQ(50,+Y,100,""I"") I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",24,0)
 .I $D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I $$GET1^DIQ(50,+Y,2.1,""I""),$$GCN^PSGOE7(+Y),$$PKGFLG^PSGOE7($$GET1^DIQ(50,+Y,63)) S X(1)=+$$GET1^DIQ(50,+Y,100,""I"") I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",25,0)
 ;
"RTN","PSGOE7",26,0)
AD1 ;
"RTN","PSGOE7",27,0)
 K PSGORD,PSJORD,PSJALLGY,PSGUSRX,^TMP("PSJINTER",$J),^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6),PSJPLTYP,PSJPDLOC
"RTN","PSGOE7",28,0)
 K ^TMP("PSODAOC",$J)
"RTN","PSGOE7",29,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",30,0)
 ; -- save off value of X in PSGUSRX so variable can be reliable checked at DO tag
"RTN","PSGOE7",31,0)
 S PSGUSRX=X
"RTN","PSGOE7",32,0)
 I $D(PSJDGCK) I ($G(PSJOCNT)=1&(X="")) D  Q
"RTN","PSGOE7",33,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSGOE7",34,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSGOE7",35,0)
 I $D(PSJDGCK),X="" N PSGDGCKF S PSGDGCKF=1 G DGCKX
"RTN","PSGOE7",36,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",37,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",38,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",39,0)
 ; PSJ*5*317 - PADE - Define PADE identifier for lookups if kernel parameter turned on
"RTN","PSGOE7",40,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") N PSJTABS N:'$G(VAIN(4))&$G(PSGP) VAIN,DFN,PSJTABS D
"RTN","PSGOE7",41,0)
 .N PSJORCL,PSJCLNK K DIC("W")
"RTN","PSGOE7",42,0)
 .I '$G(VAIN(4)),$G(PSGP) S DFN=PSGP D INP^VADPT
"RTN","PSGOE7",43,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE7",44,0)
 .S PSJORCL="" I $G(PSGORD)["P" S PSJORCL=$$GET1^DIQ(53.1,+$G(PSGORD),113,"I")_"^"_$$GET1^DIQ(53.1,+$G(PSGORD),126,"I") I 1
"RTN","PSGOE7",45,0)
 .E  I $G(PSGORD)["U" S PSJORCL=$$GET1^DIQ(55.06,+$G(PSGORD)_","_+$G(PSGP),130,"I")_"^"_$$GET1^DIQ(55.06,+$G(PSGORD)_","_+$G(PSGP),131,"I") I 1
"RTN","PSGOE7",46,0)
 .E  I $G(PSGORD)["V" S PSJORCL=$$GET1^DIQ(55.01,+$G(PSGORD)_","_+$G(PSGP),136,"I")_"^"_$$GET1^DIQ(55.01,+$G(PSGORD)_","_+$G(PSGP),139,"I")
"RTN","PSGOE7",47,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE7",48,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE7",49,0)
 .S $P(PSJTABS," ",40)=""
"RTN","PSGOE7",50,0)
 .S PSJPLTYP=$S($G(PSJCLNK):"""CL""",1:"""WD"""),PSJPDLOC=$S(PSJPLTYP="CL":+PSJORCL,1:+$G(VAIN(4)))
"RTN","PSGOE7",51,0)
 .S DIC("W")="W $E(PSJTABS,1,(40-$L($S($G(DIY)]"""":$G(DIY),1:$$GET1^DIQ(50,+$G(Y),.01)))))_""  PADE: ""_$$DRGQTY^PSJPADSI(+Y,"_PSJPLTYP_","_$G(PSJPDLOC)_")_""   ""_$$GET1^DIQ(50,+Y,101)"
"RTN","PSGOE7",52,0)
 ;
"RTN","PSGOE7",53,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",54,0)
 I $D(PSJDGCK) I $$PSJSUPCK^PSJDGCK(+Y) G AD1
"RTN","PSGOE7",55,0)
 ;
"RTN","PSGOE7",56,0)
DGCKX I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",57,0)
 .S:'$D(PSJDGCK) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",58,0)
 .S:$D(PSJDGCK)&'$D(PSGDGCKF) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",59,0)
 .S:$D(PSJDGCK)&$D(PSGDGCKF) PSGDRG=$P($$DGCKIEN^PSJDGCK(),";",2),PSGDRGN=$$GET1^DIQ(50,PSGDRG,.01)
"RTN","PSGOE7",60,0)
 .D DIN^PSJDIN(+$$GET1^DIQ(50,PSGDRG,2.1,"I"),PSGDRG)
"RTN","PSGOE7",61,0)
 .I '$D(PSJDGCK) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",62,0)
 .I $D(PSJDGCK)&'$D(PSGDGCKF) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",63,0)
 .S PSGPDRG=+$$GET1^DIQ(50,PSGDRG,2.1,"I"),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",64,0)
 I '$D(PSJDGCK) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",65,0)
 I $D(PSJDGCK)&'$D(PSGDGCKF) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",66,0)
 D LIST^DIC(50,,.01,"I",,,PSGPDRG,"ASP",,,"ARRAY") I +ARRAY("DILIST",0)=1 S (X,PSGDRG)=ARRAY("DILIST",2,1),PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",67,0)
 ;
"RTN","PSGOE7",68,0)
DO ; dosage ordered
"RTN","PSGOE7",69,0)
 NEW PSJALLGY,PSGFLG,ANQX  ;; NCC Remediation 317/327 intergation.  RJS-327
"RTN","PSGOE7",70,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",71,0)
 ; -- if PSGDGCKF is set, CK action is being used and no DRUG was entered, do not set PSJALLGY array
"RTN","PSGOE7",72,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) D  G:$G(PSGORQF) AD
"RTN","PSGOE7",73,0)
 .S:'$G(PSGDGCKF) PSJALLGY(PSGDRG)=$S($G(PSGUSRX)=""&($G(PSGDRG)):"",1:"P")
"RTN","PSGOE7",74,0)
 .D ENDDC^PSGSICHK(PSGP,PSGDRG)
"RTN","PSGOE7",75,0)
 ;;START NCC T4 MODS >> 327*RJS
"RTN","PSGOE7",76,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,,PSGDRG)
"RTN","PSGOE7",77,0)
 I $P(PSJSYSU,";",4),CLOZFLG D  G:$G(ANQX) AD
"RTN","PSGOE7",78,0)
 .D ^PSOCLO1
"RTN","PSGOE7",79,0)
 I '$P(PSJSYSU,";",4) D  G:$G(ANQX) AD S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",80,0)
 .I CLOZFLG D ^PSOCLO1 S PSGFLG=1
"RTN","PSGOE7",81,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOE7",82,0)
 S PSGDO=""
"RTN","PSGOE7",83,0)
 ;
"RTN","PSGOE7",84,0)
DONE ;
"RTN","PSGOE7",85,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY,PSGUSRX Q
"RTN","PSGOE7",86,0)
 ;
"RTN","PSGOE7",87,0)
NF ;
"RTN","PSGOE7",88,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",89,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",90,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",91,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",92,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",93,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",94,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",95,0)
 ;
"RTN","PSGOE7",96,0)
NFOH ;
"RTN","PSGOE7",97,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",98,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",99,0)
 Q
"RTN","PSGOE7",100,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",101,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",102,0)
 Q 0
"RTN","PSGOE7",103,0)
 ;
"RTN","PSGOE7",104,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",105,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",106,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",107,0)
 ;
"RTN","PSGOE7",108,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",109,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",110,0)
 N Q,X S X=""
"RTN","PSGOE7",111,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",112,0)
 Q X
"RTN","PSGOE7",113,0)
 ;
"RTN","PSGOE7",114,0)
PKGFLG(PKF) ;Return 0 for not in range of acceptable package flags, 1 for within range
"RTN","PSGOE7",115,0)
 I $S(PKF["U":1,1:0) Q 1
"RTN","PSGOE7",116,0)
 I $S(PKF["I":1,1:0) Q 1
"RTN","PSGOE7",117,0)
 Q 0
"RTN","PSGOE7",118,0)
 ;
"RTN","PSGOE7",119,0)
GCN(PSGIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSGOE7",120,0)
 N PSGNDFID,PSGGCNPT,PSGGCNID
"RTN","PSGOE7",121,0)
 S PSGNDFID=$P($G(^PSDRUG(PSGIENID,"ND")),"^"),PSGGCNPT=$P($G(^PSDRUG(PSGIENID,"ND")),"^",3)
"RTN","PSGOE7",122,0)
 I 'PSGNDFID!('PSGGCNPT) Q 0
"RTN","PSGOE7",123,0)
 S PSGGCNID=$$PROD0^PSNAPIS(PSGNDFID,PSGGCNPT)
"RTN","PSGOE7",124,0)
 I $P(PSGGCNID,"^",7) Q PSGIENID_";"_PSGNDFID_";"_$P(PSGGCNID,"^",7)
"RTN","PSGOE7",125,0)
 Q PSGIENID_";"_PSGNDFID
"RTN","PSGOE8")
0^15^B60586386
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3 - EDIT ORDERS IN 53.1 ;12 June 2019 09:31:53
"RTN","PSGOE8",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113,223,269,287,315,338,366,327**;16 DEC 97;Build 114
"RTN","PSGOE8",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",18,0)
A201 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$L($$GET1^DIQ(50.7,PSGPD,.01)) G:'$G(ANQX) DONE
"RTN","PSGOE8",19,0)
 S PSGPDOLD=PSGPD,PSGPDNOLD=PSGPDN,PSGPDRGOLD=PSGPDRG
"RTN","PSGOE8",20,0)
 ;; END NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",21,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",22,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",23,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",24,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",25,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",26,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",27,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",28,0)
 I %'=1 G A101
"RTN","PSGOE8",29,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",30,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",31,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",32,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",33,0)
 S PSGDRGTMP=X
"RTN","PSGOE8",34,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",35,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",36,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,PSGPD) I CLOZFLG D  I $G(ANQX) K ANQX G A201
"RTN","PSGOE8",37,0)
 .N PSGDRG S ANQX=0,PSGDRG=$P(CLOZFLG,U,2) D CLOZ^PSJCLOZ(DFN,PSGDRG)
"RTN","PSGOE8",38,0)
 .I $G(ANQX) W ! S X=$E(PSGPDNOLD,0,4),PSGPDN=PSGPDNOLD,PSGPD=PSGPDOLD,PSGPDRG=PSGPDRGOLD K PSGDRGTMP,PSGPDOLD,PSGPDNOLD,PSGPDRGOLD
"RTN","PSGOE8",39,0)
 ;; END NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",40,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) G DONE
"RTN","PSGOE8",41,0)
 ;G DONE
"RTN","PSGOE8",42,0)
 ;
"RTN","PSGOE8",43,0)
109 ; dosage ordered
"RTN","PSGOE8",44,0)
 S MSG=0,F2=109 S:$G(PSGOEEF(F2)) BACK="109^PSGOE8"
"RTN","PSGOE8",45,0)
A109 ;
"RTN","PSGOE8",46,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",47,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",48,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",49,0)
 D EDITDOSE^PSJDOSE S X=PSGDO S:X="" PSGDREQ=1 G DONE
"RTN","PSGOE8",50,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",51,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",52,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",53,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",54,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",55,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",56,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",57,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",58,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",59,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",60,0)
 ;
"RTN","PSGOE8",61,0)
3 ; med route
"RTN","PSGOE8",62,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",63,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",64,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",65,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",66,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",67,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",68,0)
 I X="?" D MRSL^PSGOE4 ;*366
"RTN","PSGOE8",69,0)
 I X?1."??" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",70,0)
 ;I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",71,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",72,0)
 D CKMRSL^PSGOE4 ;*366
"RTN","PSGOE8",73,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3  ;*366
"RTN","PSGOE8",74,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",75,0)
 ;
"RTN","PSGOE8",76,0)
26 ; schedule
"RTN","PSGOE8",77,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",78,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",79,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",80,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",81,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",82,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",83,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",84,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",85,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",86,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",87,0)
 I X'=PSGSCH D
"RTN","PSGOE8",88,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE8",89,0)
 . N XX
"RTN","PSGOE8",90,0)
 . S PSGSCH=X
"RTN","PSGOE8",91,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",92,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",93,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",94,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",95,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX
"RTN","PSGOE8",96,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",97,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",98,0)
 . I $G(PSJSYSW0),($P(PSJSYSW0,U,5)'=2),'$G(PSGEFN(8)) W !!,"NOTE: This may cause the Admin Times and the Start Time to be out of sync."
"RTN","PSGOE8",99,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",100,0)
 . S MSG=1 S:'$G(PSGOEEF(39)) PSGOEEF(39)=1 ;*287 - Prevent infinite loop editing admin times
"RTN","PSGOE8",101,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE8",102,0)
 ..S PSGF2=39,BACK="39^PSGOE81" D 39^PSGOE81 S BACK="26^PSGOE8",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE8",103,0)
 ..Q
"RTN","PSGOE8",104,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",105,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(25)=1 D 25^PSGOE81 S PSGF2=26
"RTN","PSGOE8",106,0)
 G DONE
"RTN","PSGOE8",107,0)
 ;
"RTN","PSGOE8",108,0)
7 ; schedule type
"RTN","PSGOE8",109,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",110,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",111,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",112,0)
 S:X="F" X="R"
"RTN","PSGOE8",113,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",114,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",115,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",116,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",117,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE8",118,0)
 I X="O",$$SCHTP(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE8",119,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE8",120,0)
 I X="C",$$SCHTP(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE8",121,0)
 S PSGOST=PSGST
"RTN","PSGOE8",122,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",123,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",124,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",125,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",126,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",127,0)
 ;
"RTN","PSGOE8",128,0)
DONE ;
"RTN","PSGOE8",129,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",130,0)
 K F,F0,F2 Q
"RTN","PSGOE8",131,0)
 ;
"RTN","PSGOE8",132,0)
DEL ; delete entry
"RTN","PSGOE8",133,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",134,0)
 Q
"RTN","PSGOE8",135,0)
 ;
"RTN","PSGOE8",136,0)
DH ;
"RTN","PSGOE8",137,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",138,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' to exit this edit." Q
"RTN","PSGOE8",139,0)
 ;
"RTN","PSGOE8",140,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",141,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",142,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",143,0)
 ;          1 = more than one
"RTN","PSGOE8",144,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",145,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",146,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",147,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",148,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",149,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",150,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",151,0)
 ;
"RTN","PSGOE8",152,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",153,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",154,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",155,0)
 Q RNWL
"RTN","PSGOE8",156,0)
 ;
"RTN","PSGOE8",157,0)
SCHTP(SCH) ; *223 Return SCHedule type
"RTN","PSGOE8",158,0)
 N X I SCH="" Q ""
"RTN","PSGOE8",159,0)
 S X=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","PSGOE8",160,0)
 Q:'$G(X) ""
"RTN","PSGOE8",161,0)
 Q $P(^PS(51.1,X,0),"^",5)
"RTN","PSGOE8",162,0)
 ;
"RTN","PSGOE81")
0^16^B156313151
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3 - NON-VERIFIED ORDER EDIT (CONT.) ;12 June 2019 09:31:53
"RTN","PSGOE81",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**26,50,64,58,82,110,111,136,113,267,315,334,373,366,327**;16 DEC 97;Build 114
"RTN","PSGOE81",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE81",4,0)
 ; Reference to ^PS(50.7 via DBIA# 2180
"RTN","PSGOE81",5,0)
 ; Reference to ^PS(51.1 via DBIA 2177.
"RTN","PSGOE81",6,0)
 ;
"RTN","PSGOE81",7,0)
39 ; admin times
"RTN","PSGOE81",8,0)
 N PSGDOA
"RTN","PSGOE81",9,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81",ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR)
"RTN","PSGOE81",10,0)
A39 ;*315 next 2 lines
"RTN","PSGOE81",11,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE81",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE81",13,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE ;*315
"RTN","PSGOE81",14,0)
 I X="" S:(($G(PSGS0XT)="D")&'$G(PSGS0Y)) PSGOEE=0 S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE81",15,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",16,0)
 I X=" "!(X?1."?") D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",17,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",18,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",19,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="",X=""
"RTN","PSGOE81",20,0)
 I $G(PSGS0XT),'$$ODD^PSGS0(PSGS0XT),$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC",'$$PRNOK^PSGS0(PSGSCH),($G(PSGST)'="O") D TIMES G:'$D(X) A39 D PSGDUR G:'$D(X) A39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE81",21,0)
 I (($G(PSGST)="O")!($G(PSGST)="OC")),X="" D  G DONE
"RTN","PSGOE81",22,0)
 .S (PSGS0Y,PSGAT)=X
"RTN","PSGOE81",23,0)
 .I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S (PSGRO,PSGOEEF(25))=1,PSGOEEF(39)=1 D 25
"RTN","PSGOE81",24,0)
 .Q
"RTN","PSGOE81",25,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7) G A39
"RTN","PSGOE81",26,0)
 S PSGOAT=PSGAT
"RTN","PSGOE81",27,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE81",28,0)
 ;
"RTN","PSGOE81",29,0)
8 ; special instructions
"RTN","PSGOE81",30,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",31,0)
A8 ; special instructions
"RTN","PSGOE81",32,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE81",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE81",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",35,0)
 Q
"RTN","PSGOE81",36,0)
 ;
"RTN","PSGOE81",37,0)
10 ; start date/time edit
"RTN","PSGOE81",38,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",39,0)
A10 ; start date/time edit
"RTN","PSGOE81",40,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE81",41,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",42,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",43,0)
 .W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",44,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",45,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",46,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 D  G DONE
"RTN","PSGOE81",47,0)
 .S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",48,0)
 .W "  ",$P(PSGSDN,"^")
"RTN","PSGOE81",49,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",50,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",51,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX
"RTN","PSGOE81",52,0)
 D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",53,0)
 I PSGFD<Y D  G A10
"RTN","PSGOE81",54,0)
 .W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1
"RTN","PSGOE81",55,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE81",56,0)
 S X1=+$G(PSGLI),X2=+7 D C^%DTC
"RTN","PSGOE81",57,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE81",58,0)
 N X1,X2,DIFF,PSGEMRG,PSGBACK,CLOZFLG S X1=PSGFD,X2=Y D ^%DTC S DIFF=X
"RTN","PSGOE81",59,0)
 I $G(PSGORD) S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD) I 1
"RTN","PSGOE81",60,0)
 E  S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,,PSGDRG)
"RTN","PSGOE81",61,0)
 ;S PSGEMRG=$S($$GET1^DIQ(55,DFN,53)?2U5N:1,1:0),PSGBACK=0
"RTN","PSGOE81",62,0)
 S PSGEMRG=0,PSGBACK=0
"RTN","PSGOE81",63,0)
 I ($$GET1^DIQ(55,DFN,53)?2U5N),($P($G(^XTMP("PSJ4D-"_DFN,0)),"^",1))>$$HTFM^XLFDT($H,1) S PSGEMRG=1
"RTN","PSGOE81",64,0)
 I PSGEMRG,$G(CLOZFLG),DIFF>4 D  G A10   ; Emergency Registration period not to exceed 4 days
"RTN","PSGOE81",65,0)
 .W !!?13,"*** EMERGENCY SUPPLY NOT TO EXCEED 4 DAYS! ***",!
"RTN","PSGOE81",66,0)
 I 'PSGEMRG,$G(CLOZFLG) D  G:PSGBACK A10
"RTN","PSGOE81",67,0)
 .N CLOZPAT,X2 D CLOZPAT^PSJCLOZ
"RTN","PSGOE81",68,0)
 .S X2=$S($P($G(ANQDATA),"^",3)=9:4,$G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE81",69,0)
 .I DIFF>X2 W !!,"*** SUPPLY PERIOD NOT TO EXCEED "_X2_" DAYS! ***",! S PSGBACK=1
"RTN","PSGOE81",70,0)
 ;S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)  ;373
"RTN","PSGOE81",71,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD)  ;373
"RTN","PSGOE81",72,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",73,0)
 . ;S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",74,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",75,0)
 G DONE
"RTN","PSGOE81",76,0)
 ;
"RTN","PSGOE81",77,0)
25 ; stop date
"RTN","PSGOE81",78,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",79,0)
A25 ;
"RTN","PSGOE81",80,0)
 ;; START NCC REMEDIATION RJS*327
"RTN","PSGOE81",81,0)
 N CLOZFLG,CLOZPAT
"RTN","PSGOE81",82,0)
 I $G(PSGORD) S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD) I 1
"RTN","PSGOE81",83,0)
 E  S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,,PSGDRG)
"RTN","PSGOE81",84,0)
 I $G(CLOZFLG) N CLOZPAT,PSGDRG S PSGDRG=$P(CLOZFLG,U,2) D CLOZPAT^PSJCLOZ
"RTN","PSGOE81",85,0)
 I $G(CLOZFLG) N PSGOLDED,PSGFDNOLD S PSGOLDED=PSGFD,PSGFDNOLD=PSGFDN
"RTN","PSGOE81",86,0)
 ;; END NCC REMEDIATION RJS*327
"RTN","PSGOE81",87,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE81",88,0)
 I $$FIND1^DIC(51.1,,"X",$G(PSGSCH)) D
"RTN","PSGOE81",89,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$$GET1^DIQ(51.1,$$FIND1^DIC(51.1,,"X",$G(PSGSCH)),5,"I") ;Handle "Fill on Request"
"RTN","PSGOE81",90,0)
 .Q
"RTN","PSGOE81",91,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D
"RTN","PSGOE81",92,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE81",93,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE81",94,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE81",95,0)
 ..Q
"RTN","PSGOE81",96,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE81",97,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",98,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE81",99,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE81",100,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE81",101,0)
 ..Q
"RTN","PSGOE81",102,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE81",103,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",104,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE81",105,0)
 ..Q
"RTN","PSGOE81",106,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",107,0)
 .Q
"RTN","PSGOE81",108,0)
 K PSGFDX N PSGEMRG
"RTN","PSGOE81",109,0)
 I $D(PSGFDORG) S PSGFDN=PSGFDORG,PSGFD=PSGFDORX
"RTN","PSGOE81",110,0)
 I '$D(PSGFDORG) N PSGFDORG,PSGFDORX S PSGFDORG=PSGFDN,PSGFDORX=PSGFD
"RTN","PSGOE81",111,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",112,0)
 I X="",PSGFD S X=$P(PSGFDN,"^")
"RTN","PSGOE81",113,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",114,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",115,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",116,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE81",117,0)
 ; RBD PSJ*5*373 Hard stop when Stop Date more than 367 days after Start Date
"RTN","PSGOE81",118,0)
 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE81",119,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A25
"RTN","PSGOE81",120,0)
 ;S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",121,0)
 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",122,0)
 ;/RJS Begin changes for emergency registration of clozapine patient Set end date to start date + 4 days at midnight.
"RTN","PSGOE81",123,0)
 N PSGGTF S PSGGTF=0
"RTN","PSGOE81",124,0)
 I ($$GET1^DIQ(55,DFN,53)?1U6N)!($$GET1^DIQ(55,DFN,53)?2U5N),$G(CLOZFLG) D  G:PSGGTF A25  ;def 418867 RJS*327
"RTN","PSGOE81",125,0)
 .I $P($G(^XTMP("PSJ4D-"_DFN,0)),"^",1)>$$HTFM^XLFDT($H,1) D
"RTN","PSGOE81",126,0)
 ..N X1,X2 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE81",127,0)
 ..S PSGEMRG=1 Q:X'>4
"RTN","PSGOE81",128,0)
 ..I X>4 D
"RTN","PSGOE81",129,0)
 ...W !!?13,"*** EMERGENCY SUPPLY NOT TO EXCEED 4 DAYS! ***",!
"RTN","PSGOE81",130,0)
 ...S $P(PSGFD,".",2)=2359,X1=PSGSD,X2=4 D C^%DTC S PSGFD=X
"RTN","PSGOE81",131,0)
 ...S $P(PSGFDN,"^",1)=$$ENDD^PSGMI(PSGFD),$P(PSGFDN,"^",2)=PSGFD
"RTN","PSGOE81",132,0)
 ...S PSGGTF=1
"RTN","PSGOE81",133,0)
 ;/RJS End changes for emergency registration of clozapine patient Set end date to start date + 4 days at midnight.
"RTN","PSGOE81",134,0)
 ;/RJS Begin verify that stop date does not exceed maximum days supply based on lab frequency
"RTN","PSGOE81",135,0)
A255 I '$G(PSGEMRG),$G(CLOZFLG) N PSGBACK D  G:$G(PSGBACK) A25
"RTN","PSGOE81",136,0)
 .N PSGCFLG S PSGCFLG=1
"RTN","PSGOE81",137,0)
 .N X,X1,X2
"RTN","PSGOE81",138,0)
 .S X2=$S($P($G(ANQDATA),"^",3)=9:4,$G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE81",139,0)
 .S X1=+Y D
"RTN","PSGOE81",140,0)
 ..N X2 S X2=PSGSD D ^%DTC S X1=PSGSD
"RTN","PSGOE81",141,0)
 .I X>X2 W !!,"*** STOP DATE/TIME NOT TO EXCEED "_X2_" DAYS! ***",! S PSGBACK=1 Q
"RTN","PSGOE81",142,0)
 K:($G(PSGEMRG)) PSGEMRG
"RTN","PSGOE81",143,0)
 ;/RJS End verify that stop date does not exceed maximum days supply based on lab frequency.
"RTN","PSGOE81",144,0)
 ;; END NCC REMEDIATION RJS*327
"RTN","PSGOE81",145,0)
 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",146,0)
W25 ;
"RTN","PSGOE81",147,0)
 N Z,MSG
"RTN","PSGOE81",148,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE81",149,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE81",150,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE81",151,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",152,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",153,0)
 Q:+$G(PSGRO)
"RTN","PSGOE81",154,0)
 ;
"RTN","PSGOE81",155,0)
DONE ;
"RTN","PSGOE81",156,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",157,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",158,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",159,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE81",160,0)
 K ORIG,PSGOLDED,PSGNEFDOLD,PSGFDNOLD
"RTN","PSGOE81",161,0)
 S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I")
"RTN","PSGOE81",162,0)
 Q
"RTN","PSGOE81",163,0)
 ;
"RTN","PSGOE81",164,0)
FF ; up-arrow to another field
"RTN","PSGOE81",165,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",166,0)
 Q
"RTN","PSGOE81",167,0)
 ;
"RTN","PSGOE81",168,0)
DEL ; delete entry
"RTN","PSGOE81",169,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",170,0)
 Q
"RTN","PSGOE81",171,0)
 ;
"RTN","PSGOE81",172,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE81",173,0)
 I ($G(PSGS0XT)'="O"),($G(PSGST)'="OC"),'$$PRNOK^PSGS0(PSGSCH) I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE81",174,0)
 N H,I,MAX
"RTN","PSGOE81",175,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE81",176,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE81",177,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE81",178,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE81",179,0)
 S MAX=1440/I
"RTN","PSGOE81",180,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE81",181,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE81",182,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE81",183,0)
 Q
"RTN","PSGOE81",184,0)
 ;
"RTN","PSGOE81",185,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE81",186,0)
 N INFO,X
"RTN","PSGOE81",187,0)
 S Z="",INFO=$S($G(PSGNESD):PSGNESD,1:$G(PSGSD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE81",188,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE81",189,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE81",190,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE81",191,0)
 Q
"RTN","PSGOE81",192,0)
 ;
"RTN","PSGOE81",193,0)
 ;*315 new tags
"RTN","PSGOE81",194,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE81",195,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE81",196,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE81",197,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE81",198,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE81",199,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE81",200,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE81",201,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE81",202,0)
 ;
"RTN","PSGOE81",203,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE81",204,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE81",205,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE81",206,0)
 S PSGF2=39
"RTN","PSGOE81",207,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE81",208,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE81",209,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE81",210,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:+$$GET1^DIQ(53.1,+$G(PSGORD),137) (PSGDUR,PSGRMV,PSGRMVT)="@" Q
"RTN","PSGOE81",211,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE81",212,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE81",213,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE81",214,0)
 I (+RP>0),'PSGIDF D  I PSGRMV<1 K PSGMRV G PSGDUR ; exclude BID,TID or QID schedules
"RTN","PSGOE81",215,0)
 .S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE81",216,0)
 .I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR ;,PSGRMV G PSGDUR
"RTN","PSGOE81",217,0)
 .Q
"RTN","PSGOE81",218,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE81",219,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE81",220,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE81",221,0)
 .W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE81",222,0)
 .W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE81",223,0)
 .W !,"to the next Admin Time."
"RTN","PSGOE81",224,0)
 .S PSGRMV=-1,RP=0
"RTN","PSGOE81",225,0)
 .Q
"RTN","PSGOE81",226,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE81",227,0)
 .N F,P,PSGARR
"RTN","PSGOE81",228,0)
 .S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGAT):PSGAT,$G(PSGS0Y):PSGS0Y,1:""),PSGS0Y=PSGADT
"RTN","PSGOE81",229,0)
 .S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE81",230,0)
 .F P=1:1:PSGARR D
"RTN","PSGOE81",231,0)
 ..S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE81",232,0)
 ..I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE81",233,0)
 ..Q
"RTN","PSGOE81",234,0)
 .Q
"RTN","PSGOE81",235,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE81",236,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE81",237,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE81",238,0)
 Q
"RTN","PSGOE81",239,0)
 ;
"RTN","PSGOE81",240,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE81",241,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE81",242,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE81",243,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE81",244,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE81",245,0)
 .N L
"RTN","PSGOE81",246,0)
 .S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE81",247,0)
 .S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE81",248,0)
 .S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE81",249,0)
 .S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE81",250,0)
 .D WRITE
"RTN","PSGOE81",251,0)
 .Q
"RTN","PSGOE81",252,0)
 ;
"RTN","PSGOE81",253,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE81",254,0)
 N P,L
"RTN","PSGOE81",255,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE81",256,0)
 .S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE81",257,0)
 .S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE81",258,0)
 .S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE81",259,0)
 .S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE81",260,0)
 .S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE81",261,0)
 .S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE81",262,0)
 .Q
"RTN","PSGOE81",263,0)
 D WRITE
"RTN","PSGOE81",264,0)
 Q
"RTN","PSGOE81",265,0)
 ;
"RTN","PSGOE81",266,0)
WRITE ;
"RTN","PSGOE81",267,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE81",268,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE81",269,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE81",270,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE81",271,0)
 D ASK
"RTN","PSGOE81",272,0)
 Q
"RTN","PSGOE81",273,0)
 ;
"RTN","PSGOE81",274,0)
ASK ;
"RTN","PSGOE81",275,0)
 N Y
"RTN","PSGOE81",276,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE81",277,0)
 I 'Y K X S PSGDUR=-1 G A39
"RTN","PSGOE81",278,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",279,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE81",280,0)
 .S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",281,0)
 .Q
"RTN","PSGOE81",282,0)
 Q
"RTN","PSGOE81",283,0)
 ;
"RTN","PSGOE82")
0^17^B42921710
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127,168,181,276,317,366,327**;16 DEC 97;Build 114
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE82",10,0)
 ;
"RTN","PSGOE82",11,0)
1 ; provider
"RTN","PSGOE82",12,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",13,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",14,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",15,0)
 ;*366 - check provider credentials
"RTN","PSGOE82",16,0)
 I PSGPR N PSJACT,BKP,BKPN S PSJACT=$$ACTPRO^PSGOE1(PSGPR) S:'PSJACT BKP=PSGPR,BKPN=PSGPRN,PSGPR=0,PSGPRN="",PSJACT="Z"
"RTN","PSGOE82",17,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE82",18,0)
 S PSTMPI=PSGPR,PSTMPN=PSGPRN
"RTN","PSGOE82",19,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME
"RTN","PSGOE82",20,0)
 I X="^"!'$T W:'$T $C(7) S PSGOEE=0 S:PSJACT="Z" PSGPR=BKP,PSGPRN=BKPN G DONE
"RTN","PSGOE82",21,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",22,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$$GET1^DIQ(200,PSGPR,53.1,"I") G:'$G(ANQX) DONE
"RTN","PSGOE82",23,0)
 I +$G(ANQX) G A2
"RTN","PSGOE82",24,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",25,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",26,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",27,0)
A2 S ANQX=0 D CLOZPRV
"RTN","PSGOE82",28,0)
 I $G(ANQX) S PSGPR=PSTMPI,PSGPRN=PSTMPN  K PSTMPN,PSTMPI,ANQX G A1
"RTN","PSGOE82",29,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOE82",30,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",31,0)
 ;
"RTN","PSGOE82",32,0)
5 ; self med
"RTN","PSGOE82",33,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",34,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",35,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",36,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",37,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",38,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",39,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",40,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",41,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",42,0)
 ;
"RTN","PSGOE82",43,0)
6 ; hospital supplied self med
"RTN","PSGOE82",44,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",45,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",46,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",47,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",48,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",49,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",50,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",51,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",52,0)
 ;
"RTN","PSGOE82",53,0)
2 ; dispense drug multiple
"RTN","PSGOE82",54,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE82",55,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE82",56,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",57,0)
 N PSGX,ARRAY D LIST^DIC(53.4502,","_PSJSYSP_",",,"I",,,,,,,"ARRAY") S PSGX=+ARRAY("DILIST",0)
"RTN","PSGOE82",58,0)
 N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$$GET1^DIQ(53.1,+PSGORD,103,"I")="R" S PSJPNDRN=1 D
"RTN","PSGOE82",59,0)
 .S $P(PSJPNDRN,"^",2)="Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.  "
"RTN","PSGOE82",60,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE82",61,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE82",62,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE82",63,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,DFN,PSJORD,PSJPOI,PSJORCL,PSJCLNK,PSJCLND
"RTN","PSGOE82",64,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE82",65,0)
 .S PSJORCL=$S($G(PSGORD)["P":$$GET1^DIQ(53.1,+$G(PSGORD),113,"I")_"^"_$$GET1^DIQ(53.1,+$G(PSGORD),126,"I"),1:"")
"RTN","PSGOE82",66,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE82",67,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE82",68,0)
 .I $G(PSGORD) S PSJPOI=$$GET1^DIQ(53.1,PSGORD,108,"I")
"RTN","PSGOE82",69,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE82",70,0)
 .N ARRAY D LIST^DIC(53.4502,","_+$G(PSJSYSP)_",",,"I",,,,,,,"ARRAY")
"RTN","PSGOE82",71,0)
 .F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S PSJDDC=ARRAY("DILIST",2,I),PSJDRG(PSJDDC)=$$GET1^DIQ(53.4502,PSJDDC_","_PSJSYSP,.01,"I") I '$G(PSJPOI) D
"RTN","PSGOE82",72,0)
 ..S PSJPOI=+$$GET1^DIQ(50,+$G(PSJDRG(PSJDDC)),2.1,"I")
"RTN","PSGOE82",73,0)
 ..I '$G(PSJPOI),$G(PSGPD),($$GET1^DIQ(50.7,+$G(PSGPD),.01)]"") S PSJPOI=+PSGPD
"RTN","PSGOE82",74,0)
 .S PSJCLND=$S($G(PSJORD)["U":$$GET1^DIQ(55.06,+PSJORD_","_DFN,28,"I"),$G(PSJORD)["P":$$GET1^DIQ(53.1,+PSGORD,113,"I")_"^"_$$GET1^DIQ(53.1,+PSGORD,126,"I"),1:"")
"RTN","PSGOE82",75,0)
 .S PSJLOC=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE82",76,0)
 .;S PSJLOC=$S($G(PSJORD)["U":+$G(^PS(55,DFN,5,+PSJORD,8))_"C",$G(PSJORD)["P":+$G(^PS(53.1,+PSJORD,"DSS"))_"C",1:"")
"RTN","PSGOE82",77,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE82",78,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE82",79,0)
 .S PSJPADLK=1
"RTN","PSGOE82",80,0)
 .D READDD^PSJPAD50(.PSJDRG,$S($G(PSGPD):+$G(PSGPD),1:+$G(PSJPOI)),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE82",81,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE82",82,0)
 I '$G(PSJPADLK) N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02"_$S($G(PSJPNDRN):";.03",1:"") D ^DIE
"RTN","PSGOE82",83,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",84,0)
 D DDOC(PSGX)
"RTN","PSGOE82",85,0)
 NEW PSJDOSE
"RTN","PSGOE82",86,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",87,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",88,0)
 G DONE
"RTN","PSGOE82",89,0)
 ;
"RTN","PSGOE82",90,0)
40 ; comments
"RTN","PSGOE82",91,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",92,0)
 ;
"RTN","PSGOE82",93,0)
66 ; provider comments
"RTN","PSGOE82",94,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",95,0)
 ;
"RTN","PSGOE82",96,0)
DONE ;
"RTN","PSGOE82",97,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",98,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",99,0)
 ;
"RTN","PSGOE82",100,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",101,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",102,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",103,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",104,0)
 ;
"RTN","PSGOE82",105,0)
DEL ; delete entry
"RTN","PSGOE82",106,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",107,0)
 Q
"RTN","PSGOE82",108,0)
 ;
"RTN","PSGOE82",109,0)
CLOZPRV ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE82",110,0)
 N CLOZFLG I $G(PSGORD)["P",$$GET1^DIQ(53.1,+PSGORD,.01) S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD) I 1
"RTN","PSGOE82",111,0)
 E  I $G(PSGORD),$$GET1^DIQ(55.06,+PSGORD_","_PSGP,.01) S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) I 1
"RTN","PSGOE82",112,0)
 E  S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,,+$G(PSGDRG))
"RTN","PSGOE82",113,0)
 I CLOZFLG D
"RTN","PSGOE82",114,0)
 .I PSGPR'=+Y S PSGPR=+Y,PSGPRN=Y(0,0)
"RTN","PSGOE82",115,0)
 .S ANQX=0 D PROVCHK^PSJCLOZ(PSGPR)
"RTN","PSGOE82",116,0)
 .I ANQX=0 K PSTMPN,PSTMPI
"RTN","PSGOE82",117,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOE82",118,0)
 Q
"RTN","PSGOE82",119,0)
 ;
"RTN","PSGOE82",120,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",121,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",122,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",123,0)
 Q
"RTN","PSGOE82",124,0)
DDOC(PSGX) ; Order check on additional dispense drug for allergy and adv. reactions.
"RTN","PSGOE82",125,0)
 N PSGY,PSGND1,PSGND3,PSJALLGY
"RTN","PSGOE82",126,0)
 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",127,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",128,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",129,0)
 . I '$G(PSJALGY1) S PSJALLGY(PSJDD)="" D ALLERGY^PSJOC
"RTN","PSGOE82",130,0)
 . ;D IVSOL^PSGSICHK
"RTN","PSGOE82",131,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",132,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",133,0)
 Q
"RTN","PSGOE82",134,0)
 ;
"RTN","PSGOE82",135,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",136,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",137,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",138,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",139,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",140,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",141,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",142,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",143,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",144,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",145,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",146,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGOE91")
0^30^B154370497
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3 - ACTIVE ORDER EDIT (CONT.) ;12 June 2019 09:31:53
"RTN","PSGOE91",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,64,58,110,111,136,113,179,265,267,285,315,334,373,366,327**;16 DEC 97;Build 114
"RTN","PSGOE91",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE91",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE91",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE91",7,0)
 ; External reference YSCLTST2 supported by DBIA 4556
"RTN","PSGOE91",8,0)
 ;
"RTN","PSGOE91",9,0)
41 ; admin times
"RTN","PSGOE91",10,0)
 ;S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",11,0)
 ;*315 next 5 lines
"RTN","PSGOE91",12,0)
 N PSGDOA
"RTN","PSGOE91",13,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",14,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",15,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE91",16,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",17,0)
 .W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",18,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE
"RTN","PSGOE91",19,0)
 I X="" S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE91",20,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",21,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",22,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",23,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",24,0)
 I ((PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P($G(ZZND),"^",3))!($P($G(ZZND),"^",5)="O")),X="" D  G DONE
"RTN","PSGOE91",25,0)
 .S (PSGS0Y,PSGAT)=X
"RTN","PSGOE91",26,0)
 .I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S PSGOEEF(34)=1,PSGOEEF(41)=1,PSGRO=1 D 34
"RTN","PSGOE91",27,0)
 .Q
"RTN","PSGOE91",28,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES G:'$D(X) A41 D PSGDUR G:'$D(X) A41 G:$G(X)="^" DONE ;*315
"RTN","PSGOE91",29,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",30,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",31,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",32,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",33,0)
 ;
"RTN","PSGOE91",34,0)
8 ; special instructions
"RTN","PSGOE91",35,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",36,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",37,0)
 .N X,Y,PARENT S PARENT=$S(PSGORD["U":$$GET1^DIQ(55.06,+PSGORD_","_PSGP,125,"I"),1:$$GET1^DIQ(53.1,+PSGORD,125,"I"))
"RTN","PSGOE91",38,0)
 .I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",39,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",40,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE91",41,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$$GET1^DIQ(53.455,"1,"_+PSJSYSP,.01)_" "_$$GET1^DIQ(53.455,"2,"_+PSJSYSP,.01),PSGSI>3:"Instructions too long. See Order View or BCMA for full text.",1:"")
"RTN","PSGOE91",42,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",43,0)
 Q
"RTN","PSGOE91",44,0)
 ;
"RTN","PSGOE91",45,0)
10 ; start date/time edit
"RTN","PSGOE91",46,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",47,0)
A10 ; start date/time edit
"RTN","PSGOE91",48,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE91",49,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",50,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",51,0)
 K PSGSDX
"RTN","PSGOE91",52,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",53,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",54,0)
 ;I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE  ;373
"RTN","PSGOE91",55,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE  ;373
"RTN","PSGOE91",56,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",57,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",58,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",59,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",60,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE91",61,0)
 S X1=+$G(PSGDT),X2=+7 D C^%DTC
"RTN","PSGOE91",62,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE91",63,0)
 N X1,X2,DIFF,PSGEMRG,PSGBACK S X1=PSGFD,X2=Y D ^%DTC S DIFF=X
"RTN","PSGOE91",64,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+$G(PSJORD))
"RTN","PSGOE91",65,0)
 ;S PSGEMRG=$S($$GET1^DIQ(55,DFN,53)?2U5N:1,1:0),PSGBACK=0
"RTN","PSGOE91",66,0)
 S PSGEMRG=0,PSGBACK=0
"RTN","PSGOE91",67,0)
 I ($$GET1^DIQ(55,DFN,53)?2U5N),($P($G(^XTMP("PSJ4D-"_DFN,0)),"^",1))>$$HTFM^XLFDT($H,1) S PSGEMRG=1
"RTN","PSGOE91",68,0)
 I PSGEMRG,$G(CLOZFLG),DIFF>4 D  G A10   ; Emergency Registration period not to exceed 4 days
"RTN","PSGOE91",69,0)
 .W !!?13,"*** EMERGENCY SUPPLY NOT TO EXCEED 4 DAYS! ***",!
"RTN","PSGOE91",70,0)
 I 'PSGEMRG,$G(CLOZFLG) D  G:PSGBACK A10
"RTN","PSGOE91",71,0)
 .N CLOZPAT,X2,PSGCFLG,PSGANC D CLOZPAT^PSJCLOZ
"RTN","PSGOE91",72,0)
 .S PSGCFLG=1,PSGANC=$$CL^YSCLTST2(DFN)
"RTN","PSGOE91",73,0)
 .I '$$OVERRIDE^YSCLTST2(DFN),'+$P(PSGANC,"^",4) S X2=4
"RTN","PSGOE91",74,0)
 .E  S X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE91",75,0)
 .I DIFF>X2 W !!,"*** SUPPLY PERIOD NOT TO EXCEED "_X2_" DAYS! ***",! S PSGBACK=1
"RTN","PSGOE91",76,0)
 ;S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE  ;373
"RTN","PSGOE91",77,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD) G DONE  ;373
"RTN","PSGOE91",78,0)
 ;
"RTN","PSGOE91",79,0)
34 ; stop date
"RTN","PSGOE91",80,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",81,0)
A34 ;
"RTN","PSGOE91",82,0)
 ;
"RTN","PSGOE91",83,0)
 K PSGFDX N PSGEMRG
"RTN","PSGOE91",84,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD),'$$LASTCHLD^PSJCLOZ(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",85,0)
 .W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",86,0)
 ;; START NCC REMEDIATION RJS*327
"RTN","PSGOE91",87,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+$G(PSJORD))
"RTN","PSGOE91",88,0)
 I $G(CLOZFLG) N CLOZPAT,PSGDRG S PSGDRG=$P(CLOZFLG,U,2) D CLOZPAT^PSJCLOZ
"RTN","PSGOE91",89,0)
 I $D(CLOZPAT) N PSGOLDED,PSGFDNOLD S PSGOLDED=PSGFD,PSGFDNOLD=PSGFDN
"RTN","PSGOE91",90,0)
 ;; END NCC REMEDIATION RJS*327
"RTN","PSGOE91",91,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE91",92,0)
 I +$G(PSGRF),$$FIND1^DIC(51.1,,"X",$G(PSGSCH)) D
"RTN","PSGOE91",93,0)
 .S:PSGTMPST=($G(PSGST)="R") PSGST=$$GET1^DIQ(51.1,$$FIND1^DIC(51.1,,"X",$G(PSGSCH)),5,"I") ;Handle "Fill on Request"
"RTN","PSGOE91",94,0)
 .Q
"RTN","PSGOE91",95,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D
"RTN","PSGOE91",96,0)
 .I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE91",97,0)
 ..S MSG(2)=" at the next administration."
"RTN","PSGOE91",98,0)
 ..S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE91",99,0)
 ..Q
"RTN","PSGOE91",100,0)
 .I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE91",101,0)
 ..S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",102,0)
 ..S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE91",103,0)
 ..S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE91",104,0)
 ..S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE91",105,0)
 ..Q
"RTN","PSGOE91",106,0)
 .I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE91",107,0)
 ..S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",108,0)
 ..S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE91",109,0)
 ..Q
"RTN","PSGOE91",110,0)
 .D EN^DDIOL(.MSG)
"RTN","PSGOE91",111,0)
 .Q
"RTN","PSGOE91",112,0)
 I $D(PSGFDORG) S PSGFDN=PSGFDORG,PSGFD=PSGFDORX
"RTN","PSGOE91",113,0)
 I '$D(PSGFDORG) N PSGFDORG,PSGFDORX S PSGFDORG=PSGFDN,PSGFDORX=PSGFD
"RTN","PSGOE91",114,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",115,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",116,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",117,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",118,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",119,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A34
"RTN","PSGOE91",120,0)
 ; RBD PSJ*5*373 Hard stop when Stop Date more than 367 days after Start Date
"RTN","PSGOE91",121,0)
 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE91",122,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A34
"RTN","PSGOE91",123,0)
 ;S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE91",124,0)
 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE91",125,0)
 ;/RJS Begin changes for emergency registration of clozapine patient Set end date to start date + 4 days at midnight.
"RTN","PSGOE91",126,0)
 S PSGEMRG=$$GET1^DIQ(55,DFN,53)?1U6N
"RTN","PSGOE91",127,0)
 I $G(CLOZFLG) N PSGBACK D  G:$G(PSGBACK) A34
"RTN","PSGOE91",128,0)
 .N PSGANC,PSGOVRD,PSGCFLG S PSGCFLG=1
"RTN","PSGOE91",129,0)
 .S:$$OVERRIDE^YSCLTST2(DFN) PSGOVRD=1
"RTN","PSGOE91",130,0)
 .S PSGANC=$$CL^YSCLTST2(DFN)
"RTN","PSGOE91",131,0)
 .N X,X1,X2 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE91",132,0)
 .I '$G(PSGOVRD),'+$P(PSGANC,"^",4) S X2=4
"RTN","PSGOE91",133,0)
 .E  I PSGEMRG S X2=4
"RTN","PSGOE91",134,0)
 .E  S X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,1:90)
"RTN","PSGOE91",135,0)
 .I X>X2 S PSGBACK=1 D
"RTN","PSGOE91",136,0)
 ..I X2=4
"RTN","PSGOE91",137,0)
 ..I PSGEMRG W !!?13,"*** EMERGENCY SUPPLY NOT TO EXCEED 4 DAYS! ***",! Q
"RTN","PSGOE91",138,0)
 ..W !!,"*** STOP DATE/TIME NOT TO EXCEED "_X2_" DAYS! ***",!
"RTN","PSGOE91",139,0)
 K:$G(PSGEMRG) PSGEMRG
"RTN","PSGOE91",140,0)
 ;/RJS End verify that stop date does not exceed maximum days supply based on lab frequency.
"RTN","PSGOE91",141,0)
 ;; END NCC REMEDIATION RJS*327
"RTN","PSGOE91",142,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",143,0)
 N Z,MSG
"RTN","PSGOE91",144,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",145,0)
 .S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",146,0)
 .S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",147,0)
 .D EN^DDIOL(.MSG)
"RTN","PSGOE91",148,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",149,0)
 Q:+$G(PSGRO)
"RTN","PSGOE91",150,0)
 ;
"RTN","PSGOE91",151,0)
DONE ;
"RTN","PSGOE91",152,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",153,0)
 ;BHW;PSJ*5*179; - Remove EFD call.  Added to PSGOEE.
"RTN","PSGOE91",154,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",155,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE91",156,0)
 S:'+$G(PSGRF) PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I")
"RTN","PSGOE91",157,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",158,0)
 ;
"RTN","PSGOE91",159,0)
FF ; up-arrow to another field
"RTN","PSGOE91",160,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",161,0)
 Q
"RTN","PSGOE91",162,0)
 ;
"RTN","PSGOE91",163,0)
DEL ; delete entry
"RTN","PSGOE91",164,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",165,0)
 Q
"RTN","PSGOE91",166,0)
 ;
"RTN","PSGOE91",167,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",168,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",169,0)
 N H,I,MAX
"RTN","PSGOE91",170,0)
 I PSGSCH]"" S H=$$FIND1^DIC(51.1,,"X",PSGSCH) I H S I=$$GET1^DIQ(51.1,H,2,"I")
"RTN","PSGOE91",171,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",172,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",173,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",174,0)
 S MAX=1440/I
"RTN","PSGOE91",175,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",176,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",177,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",178,0)
 Q
"RTN","PSGOE91",179,0)
 ;
"RTN","PSGOE91",180,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",181,0)
 N INFO,X
"RTN","PSGOE91",182,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",183,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",184,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",185,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",186,0)
 Q
"RTN","PSGOE91",187,0)
 ;*315 New tags
"RTN","PSGOE91",188,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE91",189,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE91",190,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE91",191,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE91",192,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE91",193,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration)
"RTN","PSGOE91",194,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE91",195,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE91",196,0)
 ;
"RTN","PSGOE91",197,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE91",198,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE91",199,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE91",200,0)
 S PSGF2=41
"RTN","PSGOE91",201,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE91",202,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE91",203,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE91",204,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S PSGS0Y="",(PSGDUR,PSGRMVT)="@",PSGRMV=-1 Q
"RTN","PSGOE91",205,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE91",206,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE91",207,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE91",208,0)
 I (+RP>0),'PSGIDF D  I PSGRMV<1 K PSGRMV G PSGDUR ; exclude BID,TID or QID schedules
"RTN","PSGOE91",209,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE91",210,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR ;,PSGRMV G PSGDUR Q
"RTN","PSGOE91",211,0)
 .Q
"RTN","PSGOE91",212,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE91",213,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE91",214,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE91",215,0)
 .W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE91",216,0)
 .W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE91",217,0)
 .W !,"to the next Admin Time."
"RTN","PSGOE91",218,0)
 .S PSGRMV=-1,RP=0
"RTN","PSGOE91",219,0)
 .Q
"RTN","PSGOE91",220,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE91",221,0)
 .N F,P,PSGARR
"RTN","PSGOE91",222,0)
 .S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGS0Y=PSGADT
"RTN","PSGOE91",223,0)
 .S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE91",224,0)
 .F P=1:1:PSGARR D
"RTN","PSGOE91",225,0)
 ..S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE91",226,0)
 ..I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE91",227,0)
 ..Q
"RTN","PSGOE91",228,0)
 .Q
"RTN","PSGOE91",229,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE91",230,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE91",231,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE91",232,0)
 Q
"RTN","PSGOE91",233,0)
 ;
"RTN","PSGOE91",234,0)
VERTIMES ; Redisplay Admin and Removal times *315
"RTN","PSGOE91",235,0)
 S PSGRF=+$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I") Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE91",236,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE91",237,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE91",238,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE91",239,0)
 .N L
"RTN","PSGOE91",240,0)
 .S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE91",241,0)
 .S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE91",242,0)
 .S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE91",243,0)
 .S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE91",244,0)
 .D WRITE
"RTN","PSGOE91",245,0)
 .Q
"RTN","PSGOE91",246,0)
 ;
"RTN","PSGOE91",247,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE91",248,0)
 N P,L
"RTN","PSGOE91",249,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE91",250,0)
 .S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE91",251,0)
 .S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE91",252,0)
 .S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE91",253,0)
 .S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE91",254,0)
 .S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE91",255,0)
 .S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE91",256,0)
 .Q
"RTN","PSGOE91",257,0)
 D WRITE
"RTN","PSGOE91",258,0)
 Q
"RTN","PSGOE91",259,0)
 ;
"RTN","PSGOE91",260,0)
WRITE ;
"RTN","PSGOE91",261,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE91",262,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE91",263,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE91",264,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE91",265,0)
 D ASK
"RTN","PSGOE91",266,0)
 Q
"RTN","PSGOE91",267,0)
 ;
"RTN","PSGOE91",268,0)
ASK ;
"RTN","PSGOE91",269,0)
 N Y
"RTN","PSGOE91",270,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE91",271,0)
 I 'Y K X S PSGDUR=-1,PSGFOK(8)="" G A41
"RTN","PSGOE91",272,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",273,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE91",274,0)
 .S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",275,0)
 .Q
"RTN","PSGOE91",276,0)
 Q
"RTN","PSGOE91",277,0)
 ;
"RTN","PSGOE92")
0^12^B47365647
"RTN","PSGOE92",1,0)
PSGOE92 ;BIR/CML3 - ACTIVE ORDER EDIT (CONT.) ;2/18/10 4:15pm
"RTN","PSGOE92",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,58,81,110,215,237,276,316,317,366,327**;16 DEC 97;Build 114
"RTN","PSGOE92",3,0)
 ;
"RTN","PSGOE92",4,0)
 ;Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE92",5,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE92",6,0)
 ;Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGOE92",7,0)
 ;Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE92",8,0)
 ;
"RTN","PSGOE92",9,0)
1 ; provider
"RTN","PSGOE92",10,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE92"
"RTN","PSGOE92",11,0)
A1 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",12,0)
 . W !!?5,"Provider may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",13,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",14,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE92",15,0)
 S PSTMPI=PSGPR,PSTMPN=PSGPRN
"RTN","PSGOE92",16,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOE92",17,0)
 I +$G(ANQX) G A2
"RTN","PSGOE92",18,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$L($$GET1^DIQ(200,PSGPR,53.1)) G DONE
"RTN","PSGOE92",19,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOE92",20,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE92",21,0)
 ;*366 - check provider credentials
"RTN","PSGOE92",22,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE92",23,0)
A2 D CLOZPRV^PSGOE82
"RTN","PSGOE92",24,0)
 I $G(ANQX) W ! S PSGPR=PSTMPI,PSGPRN=PSTMPN  K PSTMPN,PSTMPI,ANQX G A1
"RTN","PSGOE92",25,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOE92",26,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE92",27,0)
 ;
"RTN","PSGOE92",28,0)
5 ; self med
"RTN","PSGOE92",29,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",30,0)
 . W !!?5,"Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",31,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE92" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=""
"RTN","PSGOE92",32,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",33,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",34,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE92",35,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE92",36,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",37,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",38,0)
 W $C(7) D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",39,0)
 ;
"RTN","PSGOE92",40,0)
6 ; hospital supplied self med
"RTN","PSGOE92",41,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE92"
"RTN","PSGOE92",42,0)
A6 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",43,0)
 . W !!?5,"Hospital Supplied Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",44,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",45,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",46,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE92",47,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE92",48,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",49,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",50,0)
 W $C(7) D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",51,0)
 ;
"RTN","PSGOE92",52,0)
2 ; dispense drug multiple
"RTN","PSGOE92",53,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE92",54,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE92",55,0)
 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE92",56,0)
 .N X,Y,PARENT S PARENT=$S(PSGORD["U":$$GET1^DIQ(55.06,+PSGORD_","_PSGP,125,"I"),1:$$GET1^DIQ(53.1,+PSGORD,125,"I"))
"RTN","PSGOE92",57,0)
 .I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE92",58,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE92",PSGOEEND=1
"RTN","PSGOE92",59,0)
 N PSGX,ARRAY D LIST^DIC(53.4502,","_PSJSYSP_",",,"I",,,,,,,"ARRAY") S PSGX=+ARRAY("DILIST",0)
"RTN","PSGOE92",60,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE92",61,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE92",62,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE92",63,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,PSJORD,DFN,PSJORCL,PSJCLNK,PSJCLND S PSJCLND=""
"RTN","PSGOE92",64,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE92",65,0)
 .I $G(PSGORD)["P" S PSJCLND=$$GET1^DIQ(53.1,+$G(PSGORD),113,"I")_"^"_$$GET1^DIQ(53.1,+$G(PSGORD),126,"I") I 1
"RTN","PSGOE92",66,0)
 .E  I $G(PSGORD)["U" S PSJCLND=$$GET1^DIQ(55.06,+$G(PSGORD)_","_+$G(PSGP),130,"I")_"^"_$$GET1^DIQ(55.06,+$G(PSGORD)_","_+$G(PSGP),131,"I") I 1
"RTN","PSGOE92",67,0)
 .E  I $G(PSGORD)["V" S PSJCLND=$$GET1^DIQ(55.01,+$G(PSGORD)_","_+$G(PSGP),136,"I")_"^"_$$GET1^DIQ(55.01,+$G(PSGORD)_","_+$G(PSGP),139,"I")
"RTN","PSGOE92",68,0)
 .S PSJORCL=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE92",69,0)
 .I PSJORCL S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE92",70,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE92",71,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE92",72,0)
 .N ARRAY D LIST^DIC(53.4502,","_PSJSYSP_",",,"I",,,,,,,"ARRAY")
"RTN","PSGOE92",73,0)
 .F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S PSJDDC=ARRAY("DILIST",2,I),PSJDRG(PSJDDC)=$$GET1^DIQ(53.4502,PSJDDC_","_PSJSYSP,.01,"I")
"RTN","PSGOE92",74,0)
 .S PSJLOC=$S($G(PSJORD)["U":+$$GET1^DIQ(55.06,+PSJORD_","_DFN,130,"I")_"C",$G(PSJORD)["P":+$$GET1^DIQ(53.1,+$G(PSGORD),113,"I")_"C",1:"")
"RTN","PSGOE92",75,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE92",76,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE92",77,0)
 .S PSJPADLK=1
"RTN","PSGOE92",78,0)
 .D READDD^PSJPAD50(.PSJDRG,$G(PSGPDRG),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE92",79,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE92",80,0)
 I '$G(PSJPADLK) N DA,DIE,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1;.03" D ^DIE
"RTN","PSGOE92",81,0)
 I '$G(ARRAY("DILIST",0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE92",82,0)
 D DDOC^PSGOE82(PSGX) ;* Perform allergy/adv. reaction order checks
"RTN","PSGOE92",83,0)
 N PSJDOSE
"RTN","PSGOE92",84,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE92",85,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S:$G(PSGOEEF(109))="" PSGOEEF(109)=1 ; PSJ*5*237 - Check PSGOEEF(109) to prevent infinite loop
"RTN","PSGOE92",86,0)
 ; PSJ*5*215 - If Dispense Drug(s) changed, make entry in Activity Log.
"RTN","PSGOE92",87,0)
 ; Compare the edited dispense drug information in ^PS(53.45 to the active
"RTN","PSGOE92",88,0)
 ; order dispense drug information in ^PS(55.
"RTN","PSGOE92",89,0)
 S (PSJDDTMP,PSJDD55,PSJDTMP1,PSJDD551)=""
"RTN","PSGOE92",90,0)
 N ARRAY D LIST^DIC(53.4502,","_PSJSYSP_",",.02,"I",,,,,,,"ARRAY")
"RTN","PSGOE92",91,0)
 F I=1:1 Q:'$D(ARRAY("DILIST",2,I))  S PSJDDTMP=ARRAY("DILIST",2,I) D
"RTN","PSGOE92",92,0)
 .S PSJDDTMP(PSJDDTMP)=ARRAY("DILIST",1,I)_"^"_ARRAY("DILIST","ID",I,.02)
"RTN","PSGOE92",93,0)
 .S PSJDTMP1="Disp Drug: "_"("_$P($G(PSJDDTMP(PSJDDTMP)),"^",1)_") "_$$GET1^DIQ(50,$P($G(PSJDDTMP(PSJDDTMP)),"^",1),.01)_" Units: "_$P($G(PSJDDTMP(PSJDDTMP)),"^",2)_" "
"RTN","PSGOE92",94,0)
 N ARR1 D LIST^DIC(55.07,","_+ON_","_DFN_",",.02,"I",,,,,,,"ARR1")
"RTN","PSGOE92",95,0)
 F I=1:1 Q:'$D(ARR1("DILIST",2,I))  S PSJDD55=ARR1("DILIST",2,I) D
"RTN","PSGOE92",96,0)
 .S PSJDD55(PSJDD55)=ARR1("DILIST",1,I)_"^"_ARR1("DILIST","ID",I,.02)
"RTN","PSGOE92",97,0)
 .S PSJDD551="Disp Drug: "_"("_$P($G(PSJDD55(PSJDD55)),"^",1)_") "_$$GET1^DIQ(50,$P($G(PSJDD55(PSJDD55)),"^",1),.01)_" Units: "_$P($G(PSJDD55(PSJDD55)),"^",2)_" "
"RTN","PSGOE92",98,0)
 ; If the two temporary strings PSJDTMP1 and PSJDD551 do not match each other exactly
"RTN","PSGOE92",99,0)
 ; then an edit has been made to the Dispense Drug Field.  Make a new entry in
"RTN","PSGOE92",100,0)
 ; the Activity Log for this order.
"RTN","PSGOE92",101,0)
 I PSJDTMP1'=PSJDD551 D NEWUDAL^PSGAL5(DFN,+ON,6000,"Dispense Drug",PSJDD551)
"RTN","PSGOE92",102,0)
 K PSGOEEND,PSJDDTMP,PSJDTMP1,PSJDD55,PSJDD551 G DONE
"RTN","PSGOE92",103,0)
 ;
"RTN","PSGOE92",104,0)
15 ; comments
"RTN","PSGOE92",105,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",106,0)
 . W !!?5,"Comments may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",107,0)
 S MSG=0,PSGF2=15,BACK="15^PSGOE92",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE92",108,0)
 ;
"RTN","PSGOE92",109,0)
72 ; provider comments
"RTN","PSGOE92",110,0)
 ;
"RTN","PSGOE92",111,0)
DONE ;
"RTN","PSGOE92",112,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE92",113,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE92",114,0)
 ;
"RTN","PSGOE92",115,0)
ENFF ; up-arrow to another field
"RTN","PSGOE92",116,0)
 S Y=-1 I '$D(PSGOEEF) W $C(7),"  ??" Q
"RTN","PSGOE92",117,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE92",118,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE92",119,0)
 ;
"RTN","PSGOE92",120,0)
DEL ; delete entry
"RTN","PSGOE92",121,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE92",122,0)
 Q
"RTN","PSGOE92",123,0)
 ;
"RTN","PSGOE92",124,0)
YN ; yes/no as a set of codes
"RTN","PSGOE92",125,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE92",126,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE92",127,0)
 Q
"RTN","PSGOE92",128,0)
 ;
"RTN","PSGOE92",129,0)
F101 ;;101^PSGOE9
"RTN","PSGOE92",130,0)
F109 ;;109^PSGOE9
"RTN","PSGOE92",131,0)
F3 ;;3^PSGOE9
"RTN","PSGOE92",132,0)
F7 ;;7^PSGOE9
"RTN","PSGOE92",133,0)
PSGF26 ;;26^PSGOE9
"RTN","PSGOE92",134,0)
F41 ;;41^PSGOE91
"RTN","PSGOE92",135,0)
F8 ;;8^PSGOE91
"RTN","PSGOE92",136,0)
F10 ;;10^PSGOE91
"RTN","PSGOE92",137,0)
F34 ;;34^PSGOE91
"RTN","PSGOE92",138,0)
F1 ;;1^PSGOE92
"RTN","PSGOE92",139,0)
F5 ;;5^PSGOE92
"RTN","PSGOE92",140,0)
PSGF2 ;;2^PSGOE92
"RTN","PSGOEC")
0^40^B76544319
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**23,58,110,175,201,134,181,260,288,257,299,327**;16 DEC 97;Build 114
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I $$PNDRNOK(PSGORD) N PSJDCTYP S PSJDCTYP=$$PNDRNA(PSGORD) D:(PSJDCTYP=1!(PSJDCTYP=2)) PNDRN($G(PSJDCTYP),PSGORD) G DONE
"RTN","PSGOEC",33,0)
 ;I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",34,0)
 ;F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",35,0)
 ;I %<0 S VALMBCK="" Q
"RTN","PSGOEC",36,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",37,0)
 I PSJCOM F  W !!,"Do you want to discontinue this series of complex orders" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",38,0)
 I 'PSJCOM,CF,'$D(PSJDCDTF) F  W !!,"Do you want to discontinue this order" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",39,0)
 I 'PSJCOM,CF,$D(PSJDCDTF) F  W !!,"Enter DC to discontinue the above order or press <RETURN> to continue:" S %=$S($G(PSJOCFLG):2,1:1) D TST4DC W:%=2 !,"No action taken!" Q:%  D ENDC^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",40,0)
 I 'PSJCOM,'CF,'$D(PSJDCDTF) F  W !!,"Do you want mark this order for discontinuation" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",41,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",42,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",43,0)
 G DONE
"RTN","PSGOEC",44,0)
SOC ;
"RTN","PSGOEC",45,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",46,0)
 E  I CF,'($G(PSJDCTYP)=2) S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",47,0)
 ; prompt for requesting provider
"RTN","PSGOEC",48,0)
 I '($G(PSJDCTYP)=2) I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",49,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",50,0)
 I 'PSJCOM D
"RTN","PSGOEC",51,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",52,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",53,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",54,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",55,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",56,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",57,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",58,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",59,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",60,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",61,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",62,0)
 K:+$$ISCLOZ^PSJCLOZ(,,,,$G(PSGDN)) ^XTMP("PSJ4D-"_DFN) ;p357 clear clozapine 4-day supply 
"RTN","PSGOEC",63,0)
 Q
"RTN","PSGOEC",64,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",65,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",66,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",67,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",68,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",69,0)
 Q
"RTN","PSGOEC",70,0)
OUT ;
"RTN","PSGOEC",71,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",72,0)
DONE ;
"RTN","PSGOEC",73,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y,PSJDCTYP Q
"RTN","PSGOEC",74,0)
ASET ;
"RTN","PSGOEC",75,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="136////@;28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",76,0)
 Q
"RTN","PSGOEC",77,0)
NSET ;
"RTN","PSGOEC",78,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",79,0)
AC ;
"RTN","PSGOEC",80,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",81,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",82,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",83,0)
 I '$D(PSJSYSL) S PSJSYSL=""
"RTN","PSGOEC",84,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",85,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",86,0)
 Q
"RTN","PSGOEC",87,0)
NC ;
"RTN","PSGOEC",88,0)
 D KILL531^PSJIMO1(PSGP,"",+PSGORD)
"RTN","PSGOEC",89,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",90,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",91,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",92,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",93,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",94,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",95,0)
 Q
"RTN","PSGOEC",96,0)
T ;
"RTN","PSGOEC",97,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",98,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",99,0)
RS ;
"RTN","PSGOEC",100,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",101,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",102,0)
 ;
"RTN","PSGOEC",103,0)
REQPROV()          ;
"RTN","PSGOEC",104,0)
 I $G(PSJDCTYP)=2 Q 1
"RTN","PSGOEC",105,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",106,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",107,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",108,0)
 I PROVIDER>0 D
"RTN","PSGOEC",109,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",110,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",111,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",112,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",113,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",114,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",115,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",116,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",117,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",118,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",119,0)
 Q RESULT
"RTN","PSGOEC",120,0)
 ;
"RTN","PSGOEC",121,0)
PNDRNA(ORDER) ; Ask Discontinue Pending Renewal only, or both Pending Renew and Renewed Order
"RTN","PSGOEC",122,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",123,0)
 I '$G(ORDER)!'($G(ORDER)["P") Q 3
"RTN","PSGOEC",124,0)
 ; Quit if original order is no longer active
"RTN","PSGOEC",125,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD  D  I ORIGSTOP<$G(PSGDT) Q 1
"RTN","PSGOEC",126,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",127,0)
 N NDP2
"RTN","PSGOEC",128,0)
 S NDP2=^PS(53.1,+ORDER,.2) S DRG=NDP2,DO=$P(DRG,"^",2) S DRG=$$ENPDN^PSGMI($P(DRG,"^"))
"RTN","PSGOEC",129,0)
 S ND2=^PS(53.1,+ORDER,2) S SCH=$P(ND2,"^"),START=$P(ND2,"^",2),START=$$FMTE^XLFDT(START,2)
"RTN","PSGOEC",130,0)
 W !!?5,DRG_" "_DO
"RTN","PSGOEC",131,0)
 W !?5,"This order has a pending status. If this pending order"
"RTN","PSGOEC",132,0)
 W !?5,"is discontinued, the original order may still be active."
"RTN","PSGOEC",133,0)
 S DIR("A")="Select order(s) to discontinue"
"RTN","PSGOEC",134,0)
 S DIR(0)="S^1:DC BOTH Orders;2:DC Pending Order;3:Cancel - No Action Taken"
"RTN","PSGOEC",135,0)
 S DIR("L",1)="1 - DC BOTH Orders"
"RTN","PSGOEC",136,0)
 S DIR("L",2)="2 - DC Pending Order"
"RTN","PSGOEC",137,0)
 S DIR("L",3)="3 - Cancel - No Action Taken" D ^DIR
"RTN","PSGOEC",138,0)
 ; Reverse order - Y=1 - Pending only  Y=2:BOTH
"RTN","PSGOEC",139,0)
 S Y=$S(Y=1:2,Y=2:1,1:3)
"RTN","PSGOEC",140,0)
 Q Y
"RTN","PSGOEC",141,0)
 ;
"RTN","PSGOEC",142,0)
PNDRN(PSJDCTYP,ORDER) ; Perform Discontinue action for Pending order only or both Pending and Renewed
"RTN","PSGOEC",143,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",144,0)
 N PSGORD S PSGORD=ORDER
"RTN","PSGOEC",145,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P")
"RTN","PSGOEC",146,0)
 I PSJDCTYP=1 G SOC
"RTN","PSGOEC",147,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D SOC Q:'$G(PSJDCTYP)  D
"RTN","PSGOEC",148,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOEC",149,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOEC",150,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D SOC K PSJDCTYP
"RTN","PSGOEC",151,0)
 Q
"RTN","PSGOEC",152,0)
 ;
"RTN","PSGOEC",153,0)
PNDRNOK(ORDER) ; Execute DC Pending Renew enhancement only if 
"RTN","PSGOEC",154,0)
 ;                  1) Renewal order is pending/non-verified, and 
"RTN","PSGOEC",155,0)
 ;                  2) Original order is not DC'd or Expired
"RTN","PSGOEC",156,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P") 0
"RTN","PSGOEC",157,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD 0  D  I ORIGSTOP<$G(PSGDT) Q 0
"RTN","PSGOEC",158,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",159,0)
 Q:'($P($G(^PS(53.1,+PSGORD,0)),U,24)="R") 0
"RTN","PSGOEC",160,0)
 Q 1
"RTN","PSGOEC",161,0)
 ;
"RTN","PSGOEC",162,0)
TST4DC ; Test for DC at prompt
"RTN","PSGOEC",163,0)
 R X:$S($D(DTIME):DTIME,1:300) I '$T S %=2 Q
"RTN","PSGOEC",164,0)
 S %=$S(X="DC":1,X="Dc":1,X="dc":1,X="dC":1,X="D":1,X="d":1,X="":2,X="^":2,X]"":"",1:2)
"RTN","PSGOEC",165,0)
 Q
"RTN","PSGOEE")
0^27^B130091847
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3 - EDIT ACTIVE OR NON-VERIFIED ORDERS ;12 June 2019 09:31:53
"RTN","PSGOEE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,29,47,64,58,82,91,110,111,112,142,179,181,254,267,268,281,315,338,373,366,327**;16 DEC 97;Build 114
"RTN","PSGOEE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEE",4,0)
 ;
"RTN","PSGOEE",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",7,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA# 6071.
"RTN","PSGOEE",8,0)
 ;
"RTN","PSGOEE",9,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",10,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",11,0)
ENF ; Entry point
"RTN","PSGOEE",12,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",13,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",14,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",16,0)
 E  D
"RTN","PSGOEE",17,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",18,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",19,0)
 D DONE1
"RTN","PSGOEE",20,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",21,0)
 Q
"RTN","PSGOEE",22,0)
ACT ; Perform Edit
"RTN","PSGOEE",23,0)
 NEW ANQX,PSJALGY1,PSGSDEDT
"RTN","PSGOEE",24,0)
 K PSGOEER
"RTN","PSGOEE",25,0)
 S ANQX=0
"RTN","PSGOEE",26,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD)
"RTN","PSGOEE",27,0)
 I $G(CLOZFLG),PSJOP D
"RTN","PSGOEE",28,0)
 .D PROVCHK^PSJCLOZ(PSGOPR)
"RTN","PSGOEE",29,0)
 I +$G(ANQX) D PAUSE^VALM1 Q
"RTN","PSGOEE",30,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",31,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",32,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",33,0)
 E  D
"RTN","PSGOEE",34,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",35,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",36,0)
ACT1 ; Continue editing
"RTN","PSGOEE",37,0)
 D DONE1
"RTN","PSGOEE",38,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",39,0)
 Q
"RTN","PSGOEE",40,0)
EDIT ; Edit
"RTN","PSGOEE",41,0)
 I $G(Y) D ASKOVR(Y,$G(PSGORD),.PSJSTARI)
"RTN","PSGOEE",42,0)
 D FULL^VALM1
"RTN","PSGOEE",43,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",44,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",45,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",46,0)
 Q
"RTN","PSGOEE",47,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",48,0)
 K PSJNOO
"RTN","PSGOEE",49,0)
 D:$G(Y) EDIT I $G(PSGOROE1)=1!($G(PSGOEE)=0) S VALMBCK="R",(PSGOROE1,PSJACEPT)=0 Q
"RTN","PSGOEE",50,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",51,0)
 K VALMSG
"RTN","PSGOEE",52,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",53,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",54,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",55,0)
 .;S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)  ;373
"RTN","PSGOEE",56,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC2^PSGMI(PSGDT)  ;373
"RTN","PSGOEE",57,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",58,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",59,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",60,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",61,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",62,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC S:($G(PSGOEER)["2^PSGOE82") PSJDSVFY=1
"RTN","PSGOEE",63,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",64,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",65,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",66,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",67,0)
 Q
"RTN","PSGOEE",68,0)
OC ;Perform OC (only when OI or Dosage was edited) & dosing check
"RTN","PSGOEE",69,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",70,0)
 K PSGORQF
"RTN","PSGOEE",71,0)
 D FULL^VALM1
"RTN","PSGOEE",72,0)
 N CLOZFLG,ANQX S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD)
"RTN","PSGOEE",73,0)
 I $G(CLOZFLG) D  I $G(PSGORQF) Q
"RTN","PSGOEE",74,0)
 .S (ANQX,PSGORQF)=0,PSGDRG=$P(CLOZFLG,U,2) D TDD^PSJCLOZ I $G(PSGORQF) Q
"RTN","PSGOEE",75,0)
 .I +$G(PSGETDD) S ANQX=0 D CLOZ^PSJCLOZ(PSGP,PSGDRG) I $G(ANQX) S PSGORQF=1 Q
"RTN","PSGOEE",76,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",77,0)
 I $G(PSJALGY1)!$G(PSGOEENO) D
"RTN","PSGOEE",78,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",79,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",80,0)
 Q
"RTN","PSGOEE",81,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",82,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",83,0)
 Q
"RTN","PSGOEE",84,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",85,0)
 I $G(PSGSDEDT) Q  ; Start/Stop Date Manually edited
"RTN","PSGOEE",86,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",87,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",88,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",89,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",90,0)
 .;S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1  ;373
"RTN","PSGOEE",91,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC2^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC2^PSGMI(PSGNEFD),PSGNEWDT=1  ;373
"RTN","PSGOEE",92,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",93,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",94,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",95,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",96,0)
 Q
"RTN","PSGOEE",97,0)
NEW3 ;
"RTN","PSGOEE",98,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",99,0)
NEW ;
"RTN","PSGOEE",100,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSGOEE",101,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",102,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",103,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",104,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",105,0)
 ;DC and Unlock order.
"RTN","PSGOEE",106,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",107,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",108,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",109,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",110,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",111,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",112,0)
 I $G(PSJFSI) I $$GETSI^PSJBCMA5(DFN,PSGOORD) D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",113,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",114,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",115,0)
 I PSGOEAV D
"RTN","PSGOEE",116,0)
 . S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSGOEE",117,0)
 . D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOEE",118,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",119,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",120,0)
 ;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEE",121,0)
 Q
"RTN","PSGOEE",122,0)
UPD ;
"RTN","PSGOEE",123,0)
 ;/327*MZR added next line to prevent updating if nothing changed
"RTN","PSGOEE",124,0)
 Q:$G(PSGOEE)=0
"RTN","PSGOEE",125,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",126,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",127,0)
 I $$DIFFSI^PSJBCMA5(DFN,PSGORD) D
"RTN","PSGOEE",128,0)
 .N SIARRAY M:PSGORD["P" SIARRAY=^PS(53.1,+PSGORD,15) M:PSGORD["U" SIARRAY=^PS(55,DFN,5,+PSGORD,15)
"RTN","PSGOEE",129,0)
 .Q:'$D(SIARRAY)
"RTN","PSGOEE",130,0)
 .I PSGORD["P" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",131,0)
 .I PSGORD["U" D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",132,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",133,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",134,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",135,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",136,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",137,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",138,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",139,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI,^TMP("PSGSI",$J) M ^TMP("PSGSI",$J,5)=^PS(53.45,PSJSYSP,5) D
"RTN","PSGOEE",140,0)
 .D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",141,0)
 .N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",142,0)
 .. S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",143,0)
 ... Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",144,0)
 ... I '$D(^PS(53.45,+$G(PSJSYSP),5)) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSGSI",$J,5)
"RTN","PSGOEE",145,0)
 ... D FILESI^PSJBCMA5(DFN,PSJCHILD)
"RTN","PSGOEE",146,0)
 ... ;PSJ*5*179 Comment edits
"RTN","PSGOEE",147,0)
 ... S DR=$TR($G(DR),"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",148,0)
 . K ^TMP("PSGSI",$J)
"RTN","PSGOEE",149,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",150,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",151,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",152,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) D FILESI^PSJBCMA5(DFN,PSJORD)
"RTN","PSGOEE",153,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",154,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)),ND2P1=$G(^(2.1)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD) ;*315
"RTN","PSGOEE",155,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",156,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",157,0)
 ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEE",158,0)
 D EDIT^PSJADM
"RTN","PSGOEE",159,0)
 ; **END of Interface Hook **
"RTN","PSGOEE",160,0)
 Q
"RTN","PSGOEE",161,0)
OUT ;
"RTN","PSGOEE",162,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",163,0)
 Q
"RTN","PSGOEE",164,0)
DONE ;
"RTN","PSGOEE",165,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",166,0)
DONE1 ;
"RTN","PSGOEE",167,0)
 ;; START NCC REMEDIATION >> 327*RJS ;/RBN & MZR changed conditions on the next line
"RTN","PSGOEE",168,0)
 I $G(PSGEDT),$$GET1^DIQ(55.06,+$G(PSGORD)_","_DFN,.01,"I") D
"RTN","PSGOEE",169,0)
 .N CLOZFLG,PSGDRG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,DFN,+PSGORD)
"RTN","PSGOEE",170,0)
 .I $G(CLOZFLG) S PSGDRG=$P(CLOZFLG,U,2) D
"RTN","PSGOEE",171,0)
 ..N DIE,DA,DR S DIE="^PS(55,"_DFN_",5,",DA=+PSGORD,DA(1)=DFN,DR="301////"
"RTN","PSGOEE",172,0)
 ..I $D(^TMP("PSJCOM",$J,+$G(PSGORD))) D  K ^TMP($J,"PSGCLOZ",DFN,+PSGORD,"SAND") I 1
"RTN","PSGOEE",173,0)
 ...S DR=DR_$G(^TMP("PSJCOM",$J,+PSGORD,"SAND"))
"RTN","PSGOEE",174,0)
 ..E  I $G(^TMP($J,"PSGCLOZ",DFN,+$G(PSJORD),"SAND")) D  K ^TMP($J,"PSGCLOZ",DFN,+PSJORD,"SAND") I 1
"RTN","PSGOEE",175,0)
 ...S DR=DR_$G(^TMP($J,"PSGCLOZ",DFN,+PSJORD,"SAND"))
"RTN","PSGOEE",176,0)
 ..E  I $G(^TMP($J,"PSGCLOZ",DFN,+$G(PSGORD),"SAND")) D  K ^TMP($J,"PSGCLOZ",DFN,+PSGORD,"SAND")
"RTN","PSGOEE",177,0)
 ...S DR=DR_$G(^TMP($J,"PSGCLOZ",DFN,+PSGORD,"SAND"))
"RTN","PSGOEE",178,0)
 ..D ^DIE
"RTN","PSGOEE",179,0)
 ..N PSGDN S PSGDN=PSGDRG
"RTN","PSGOEE",180,0)
 ..D PSJFILE^PSJCLOZ(DFN),INPSND^YSCLTST5
"RTN","PSGOEE",181,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOEE",182,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",183,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",184,0)
 K ^PS(53.45,+PSJSYSP,1),^(2),^(5),^(6)
"RTN","PSGOEE",185,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",186,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ND2P1,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",187,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",188,0)
K1 ;
"RTN","PSGOEE",189,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",190,0)
 Q
"RTN","PSGOEE",191,0)
 ;
"RTN","PSGOEE",192,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",193,0)
 D FULL^VALM1
"RTN","PSGOEE",194,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",195,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",196,0)
 I '$G(PSJRNFLG) W !!,$C(7),"No changes made to this order." D PAUSE^VALM1  ;if flag set in PSODGAL1, no repeat message
"RTN","PSGOEE",197,0)
 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",198,0)
 Q
"RTN","PSGOEE",199,0)
 ;
"RTN","PSGOEE",200,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",201,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",202,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",203,0)
 Q
"RTN","PSGOEE",204,0)
 ;
"RTN","PSGOEE",205,0)
ASKOVR(Y,PSJOVRON,PSJSTARI)  ; Check to see if any starred fields are being edited. If so, ask if they wish to view overrides/interventions if they exist
"RTN","PSGOEE",206,0)
 Q:'$D(Y)!$D(PSJSTARI)  N II,I3,YY S YY=$S(Y:Y,1:$TR($P(Y,"^",4),"="))
"RTN","PSGOEE",207,0)
 Q:'YY  S PSJOVRON=$S($G(PSJOVRON):PSJOVRON,1:$G(PSJORD)) Q:'$G(PSJOVRON)
"RTN","PSGOEE",208,0)
 N PSJORD S PSJORD=PSJOVRON
"RTN","PSGOEE",209,0)
 I '$G(PSJSTARI) F II=1:1:$L(YY,",") Q:$G(PSJSTARI)  S I3=$P(YY,",",II) I I3 S:$G(PSGEFN(I3))!($G(PSJSTAR)[("("_I3_")")) PSJSTARI=1
"RTN","PSGOEE",210,0)
 I $G(PSJSTARI) I ($G(PSJORD)&$G(PSGP)) I $$ASKDISP^PSGSICH1 D FULL^VALM1 D OVRDISP^PSGSICH2(PSGP,PSJORD,3)
"RTN","PSGOEE",211,0)
 Q
"RTN","PSGOEE",212,0)
 ;
"RTN","PSGOEE",213,0)
FIELDS ;
"RTN","PSGOEE",214,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",215,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",216,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",217,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",218,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",219,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",220,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",221,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",222,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",223,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",224,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",225,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",226,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",227,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",228,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",229,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",230,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",231,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1
"RTN","PSGOEE",232,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",233,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",234,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",235,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",236,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",237,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",238,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",239,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEF")
0^25^B147534789
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3 - FINISH ORDERS ENTERED THROUGH OE/RR ;12 June 2019 09:31:53
"RTN","PSGOEF",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113,181,260,199,281,315,256,373,327**;16 DEC 97;Build 114
"RTN","PSGOEF",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( via DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH via DBIA 3234
"RTN","PSGOEF",7,0)
 ; Reference to ^TMP("PSODAOC",$J via DBIA 6071
"RTN","PSGOEF",8,0)
 ; Reference to FULL^VALM1 via DBIA 10116
"RTN","PSGOEF",9,0)
 ; Reference to ^PS(50.7 via DBIA# 2180
"RTN","PSGOEF",10,0)
 ;
"RTN","PSGOEF",11,0)
START ;
"RTN","PSGOEF",12,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",13,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",14,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD)
"RTN","PSGOEF",15,0)
 I $G(CLOZFLG),'$D(CLOZPAT) D CLOZPAT^PSJCLOZ
"RTN","PSGOEF",16,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",17,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",18,0)
 .S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",19,0)
 .N PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",20,0)
 .S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",21,0)
 .D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",22,0)
 .I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",23,0)
 .S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",24,0)
 .S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",25,0)
 .S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",26,0)
 .S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",27,0)
 .F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",28,0)
 ..I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",29,0)
 ..I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",30,0)
 ..S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",31,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",32,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",33,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",34,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",35,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",36,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",37,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",38,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",39,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",40,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",41,0)
ZZ S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",42,0)
 ;; START NCC REMEDIATION >> 327*RJS - next line has been added
"RTN","PSGOEF",43,0)
 I $G(CLOZFLG) D COMPLEX1^PSJCLOZ
"RTN","PSGOEF",44,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",45,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",46,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",47,0)
 E  D
"RTN","PSGOEF",48,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",49,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",50,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",51,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",52,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",53,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",54,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",55,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",56,0)
 ;S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)  ; #373
"RTN","PSGOEF",57,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC2^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC2^PSGMI(PSGFD)  ; #373
"RTN","PSGOEF",58,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",59,0)
 I '$$GET1^DIQ(53.4502,"1,"_PSJSYSP,.01,"I") N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",60,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",61,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",62,0)
 Q
"RTN","PSGOEF",63,0)
FINISH ;
"RTN","PSGOEF",64,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",65,0)
 N NSFF,PSGOEF39,PSGEDTOI S NSFF=1 K PSJNSS,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",66,0)
 N PSJRMABT,PSJOLDNM
"RTN","PSGOEF",67,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",68,0)
 .;PSJOCDSC stores the default start & stop date ^ cal start & stop date (use in dosing calculation for duration)
"RTN","PSGOEF",69,0)
 .;for some reasons PSGSD & PSGFD are reset to the cal dates if order has duration defined
"RTN","PSGOEF",70,0)
 .S PSJOCDSC("CX","PSGSD",+PSGORD)=$G(PSGSD)_U_$G(PSGRDTX(+PSGORD,"PSGRSD"))
"RTN","PSGOEF",71,0)
 .S PSJOCDSC("CX","PSGFD",+PSGORD)=$G(PSGFD)_U_$G(PSGRDTX(+PSGORD,"PSGRFD"))
"RTN","PSGOEF",72,0)
 .S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",73,0)
 .S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",74,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",75,0)
 ; 
"RTN","PSGOEF",76,0)
 ; PSJ*5*222
"RTN","PSGOEF",77,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",78,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",79,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",80,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",81,0)
 ; 
"RTN","PSGOEF",82,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",83,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",84,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",85,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",86,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",87,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",88,0)
 ; 
"RTN","PSGOEF",89,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",90,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",91,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",92,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",93,0)
 D FULL^VALM1
"RTN","PSGOEF",94,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOEF",95,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD)
"RTN","PSGOEF",96,0)
 I PSGSTAT'="ACTIVE",PSGSTAT'="NON-VERIFIED",PSGSTAT'="DISCONTINUED",$G(CLOZFLG) D  I $G(ANQX) Q
"RTN","PSGOEF",97,0)
 .N PSGDRG S PSGDRG=$P(CLOZFLG,U,2)
"RTN","PSGOEF",98,0)
 .S ANQX=0 D CLOZ^PSJCLOZ(PSGP,PSGDRG)
"RTN","PSGOEF",99,0)
 .I $G(ANQX) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEF",100,0)
 ;; END NCC REMEDIATION << 327*RJS
"RTN","PSGOEF",101,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",102,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",103,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",104,0)
 . . N X,X1,DIR
"RTN","PSGOEF",105,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",106,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",107,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",108,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",109,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",110,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",111,0)
 . . . W !
"RTN","PSGOEF",112,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",113,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",114,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",115,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",116,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",117,0)
 ;*** PSJ*5*256
"RTN","PSGOEF",118,0)
 S PSJOLDNM("ORD_SCHD")=PSGOSCH
"RTN","PSGOEF",119,0)
 I $$CHKSCHD^PSJMISC2(.PSJOLDNM,$S($P($G(^PS(53.1,+PSGORD,0)),U,24)="R":"R",1:"")) S PSGORQF=1,VALMBCK="R" D DONE Q
"RTN","PSGOEF",120,0)
 S:$G(PSJOLDNM("NEW_SCHD"))]"" PSGSCH=PSJOLDNM("NEW_SCHD")
"RTN","PSGOEF",121,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",122,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=$S($G(PSJOLDNM("NEW_SCHD"))]"":PSJOLDNM("NEW_SCHD"),1:PSGOSCH) K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",123,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",124,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",125,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",126,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",127,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",128,0)
 ..W !?13," for this administration schedule (",$S($G(PSJOLDNM("NEW_SCHD"))]"":PSJOLDNM("NEW_SCHD"),1:PSGOSCH),")",!
"RTN","PSGOEF",129,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",130,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",131,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",132,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",133,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",134,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",135,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",136,0)
 ; *315 DRP If removal flag in 50.7 is a 2 or a 3 then order must be reviewed and removal times entered if required.
"RTN","PSGOEF",137,0)
 S PSGRF=$$GET1^DIQ(50.7,$G(PSGPDRG),12,"I")
"RTN","PSGOEF",138,0)
 ; Abort Finish process if no Stop Date entered ($G(PSJRMABT))
"RTN","PSGOEF",139,0)
 N SCHARR D FIND^DIC(51.1,,"5I","X",$G(PSGSCH),,"APPSJ",,,"SCHARR")
"RTN","PSGOEF",140,0)
 I $G(PSGRF),$G(PSGDUR)="",'$G(PSGRMV),$G(SCHARR("DILIST",0)) S PSJRMABT=0 D  I PSJRMABT D ABORTACC Q
"RTN","PSGOEF",141,0)
 . N PSGTMPST S PSGTMPST=$S($G(PSGST)="R":$G(SCHARR("DILIST","ID",1,5)),1:$G(PSGST)) ;Handle "Fill on Request"
"RTN","PSGOEF",142,0)
 . I ($G(PSGTMPST)'="O"),($G(PSGTMPST)'="P"),($G(PSGTMPST)'="OC"),+$G(PSGRF)>1 S X="",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",143,0)
 . I $G(PSGTMPST)="O" S (PSGFDN,PSGFD)="" D 
"RTN","PSGOEF",144,0)
 .. S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) S CHK=0 I 'PSGOEE S PSJRMABT=1
"RTN","PSGOEF",145,0)
 .. W:PSJRMABT $C(7),!!,"INVALID STOP DATE"  S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",146,0)
 ..Q
"RTN","PSGOEF",147,0)
 .Q
"RTN","PSGOEF",148,0)
 ;
"RTN","PSGOEF",149,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",150,0)
 I PSGOEFF,X]"" S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",151,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",152,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",153,0)
 .I $G(PSGRMVT),'PSGOEE D INIT^PSJLMUDE($G(PSGP),$G(PSGORD)) ;*315 IF REMOVE TIME SET THEN REDISPLAY DETAIL
"RTN","PSGOEF",154,0)
 .Q
"RTN","PSGOEF",155,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",156,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",157,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",158,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",159,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",160,0)
 S VALMBG=1
"RTN","PSGOEF",161,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",162,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",163,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",164,0)
 S PSJLMFIN=1
"RTN","PSGOEF",165,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",166,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",167,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",168,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",169,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",170,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",171,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",172,0)
 ;I $G(PSGPDN)["CLOZ",+$G(PSGCOMP) D COMPLEX^PSJCLOZ  ;; RJS*327
"RTN","PSGOEF",173,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",174,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",175,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",176,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",177,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",178,0)
 ;***PSJ*5*113
"RTN","PSGOEF",179,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOEF",180,0)
 I $G(PSJACEPT) D  I $G(PSGORQF) D ABORTACC Q
"RTN","PSGOEF",181,0)
 .I $G(PSGCLZ)!(+$G(PSGRDTX)) D
"RTN","PSGOEF",182,0)
 ..I $G(CLOZFLG) D
"RTN","PSGOEF",183,0)
 ...S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S (CHK,PSGORQF)=1 Q  ;G DONE:$G(CHK)
"RTN","PSGOEF",184,0)
 ...S (^TMP("PSJCOM",$J,+PSGORD,"SAND"),PSOSAND)=X
"RTN","PSGOEF",185,0)
 ...D CLOZPAT^PSJCLOZ
"RTN","PSGOEF",186,0)
 ...S X1=PSGSD,X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,$G(CLOZPAT)=3:4,1:90)
"RTN","PSGOEF",187,0)
 ...D C^%DTC I $G(PSGFD),$G(PSGFD)'>X Q  ; added by MZR to not override an existing Stop Date/Time
"RTN","PSGOEF",188,0)
 ...S PSGFD=X,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",189,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOEF",190,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",191,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",192,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",193,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",194,0)
 .K PSJACEPT
"RTN","PSGOEF",195,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",196,0)
 ;***
"RTN","PSGOEF",197,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",198,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",199,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",200,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",201,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",202,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",203,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",204,0)
 I $G(PSGEDTOI) D OC^PSJOE1
"RTN","PSGOEF",205,0)
 I $S($G(PSGORQF):0,$G(PSGEDTOI):0,$G(PSGOEER)["109^PSGOE8":1,$G(PSGOEER)["3^PSGOE8":1,$G(PSGOEER)["26^PSGOE8":1,$G(PSGOEER)["10^PSGOE81":1,$G(PSGOEER)["25^PSGOE81":1,1:0) D
"RTN","PSGOEF",206,0)
 . NEW PSJDD S PSJDD=+$$DD53P45^PSJMISC()
"RTN","PSGOEF",207,0)
 . D:$G(PSJDD) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEF",208,0)
 I $G(PSGORQF) S PSGOEENO=0,PSJACEPT=0
"RTN","PSGOEF",209,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",210,0)
ACCEPT ;
"RTN","PSGOEF",211,0)
 N PSGUDFIN S PSGUDFIN=1
"RTN","PSGOEF",212,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",213,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",214,0)
 ;*** PSJ*5*256
"RTN","PSGOEF",215,0)
 I $G(PSJOLDNM("NEW_SCHD"))]"" S PSGSCH=$G(PSJOLDNM("NEW_SCHD")),PSGOEENO=1,PSGOEEF(26)=1,PSJNOO="S"
"RTN","PSGOEF",216,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",217,0)
 ;saves drug allergy signs/symptoms PSJ*5*260
"RTN","PSGOEF",218,0)
 I $D(^TMP("PSODAOC",$J,"ALLERGY")) D
"RTN","PSGOEF",219,0)
 .N DA,OCCDT,ORN,ORL,Z,RET,PSJDAOC
"RTN","PSGOEF",220,0)
 .S PSJDAOC="IP "_$S($G(PSGORD)["P":"Pending/Non-Verified",$G(PSGORD)["U":"Unit Dose",$G(PSGORD)["V":"IV",1:"")_" Allergy",OCCDT=$$NOW^XLFDT
"RTN","PSGOEF",221,0)
 .I PSGORD["P" S ORN=$P(^PS(53.1,+PSGORD,0),U,21)
"RTN","PSGOEF",222,0)
 .I PSGORD["U" S ORN=$P(^PS(55,DFN,5,+PSGORD,0),U,21)
"RTN","PSGOEF",223,0)
 .I PSGORD["V" S ORN=$P(^PS(55,DFN,"IV",+PSGORD,0),U,21)
"RTN","PSGOEF",224,0)
 .Q:'$G(ORN)
"RTN","PSGOEF",225,0)
 . S PSJAGYSV=1 ;use in ^PSJOE to store allergy (also clean up this var)
"RTN","PSGOEF",226,0)
 .;D SETOC^PSJNEWOC(PSGORD) ;set order checks in 100.05
"RTN","PSGOEF",227,0)
 .;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEF",228,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",229,0)
 D DONE
"RTN","PSGOEF",230,0)
 Q
"RTN","PSGOEF",231,0)
BYPASS ;
"RTN","PSGOEF",232,0)
 S PSGCANFL=1
"RTN","PSGOEF",233,0)
 ;
"RTN","PSGOEF",234,0)
DONE ;
"RTN","PSGOEF",235,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",236,0)
 K PSJOVR
"RTN","PSGOEF",237,0)
 Q
"RTN","PSGOEF",238,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",239,0)
 ;*315
"RTN","PSGOEF",240,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF
"RTN","PSGOEF",241,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A K ^TMP("PSODAOC",$J)  ;,^TMP("PSGCPLX",$J,$G(DFN))
"RTN","PSGOEF",242,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",243,0)
 ;
"RTN","PSGOEF",244,0)
 ;
"RTN","PSGOEF",245,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",246,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",247,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",248,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",249,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",250,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",251,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",252,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",253,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",254,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",255,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",256,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",257,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",258,0)
 ;
"RTN","PSGOEF",259,0)
AH ;
"RTN","PSGOEF",260,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",261,0)
 Q
"RTN","PSGOER")
0^13^B93777816
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3 - RENEW A SINGLE ORDER ;12 June 2019 09:31:53
"RTN","PSGOER",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111,133,141,198,181,246,278,281,315,338,256,347,327**;16 DEC 97;Build 114
"RTN","PSGOER",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOER",4,0)
 ;
"RTN","PSGOER",5,0)
 ; Reference to ^PS(51.1 via DBIA 2177
"RTN","PSGOER",6,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSGOER",7,0)
 ; Reference to ^PSSLOCK via DBIA 2789
"RTN","PSGOER",8,0)
 ; Reference to ^PSBAPIPM via DBIA 3564
"RTN","PSGOER",9,0)
 ; Reference to ^PS(59.7 via DBIA 2181
"RTN","PSGOER",10,0)
 ; Reference to ^PSDRUG( via DBIA 2192
"RTN","PSGOER",11,0)
 ; Reference to ^TMP("PSODAOC",$J via DBIA 6071
"RTN","PSGOER",12,0)
 ;
"RTN","PSGOER",13,0)
 ; renew a single order
"RTN","PSGOER",14,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",15,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",16,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",17,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",18,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",19,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",20,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",21,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",22,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",23,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",24,0)
  .;PSJ*5*256
"RTN","PSGOER",25,0)
 .NEW PSJOLDNM
"RTN","PSGOER",26,0)
 .S PSJOLDNM("ORD_SCHD")=PSGSCH
"RTN","PSGOER",27,0)
 .I (PSGSCH]""),$$CHKSCHD^PSJMISC2(.PSJOLDNM,"R") K PSJOLDNM Q
"RTN","PSGOER",28,0)
 .K PSJOLDNM
"RTN","PSGOER",29,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",30,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",31,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",32,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",33,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",34,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",35,0)
 Q
"RTN","PSGOER",36,0)
 ;
"RTN","PSGOER",37,0)
UNMARK ;  
"RTN","PSGOER",38,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",39,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",40,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",41,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",42,0)
 ;
"RTN","PSGOER",43,0)
DONE ;
"RTN","PSGOER",44,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",45,0)
 ;
"RTN","PSGOER",46,0)
NEW ; get info, write record
"RTN","PSGOER",47,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",48,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",49,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",50,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",51,0)
 ;D OC55
"RTN","PSGOER",52,0)
 ;Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",53,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOER",54,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) I CLOZFLG D
"RTN","PSGOER",55,0)
 .N PSGDRG,PSGPR S PSGDRG=$P(CLOZFLG,U,2),PSGPR=PSGOPR D CLOZ^PSJCLOZ(DFN,PSGDRG) S:$G(ANQX) PSGCANFL=1
"RTN","PSGOER",56,0)
 ;; END NCC T4 MODS >> 327*RJS
"RTN","PSGOER",57,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",58,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",59,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",60,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",61,0)
 ;D OC55
"RTN","PSGOER",62,0)
 ;I $G(PSGORQF) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",63,0)
SPEED ;
"RTN","PSGOER",64,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",65,0)
 Q:$G(DUOUT)
"RTN","PSGOER",66,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",67,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",68,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",69,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD   ;set up which IEN will be used to store order checks
"RTN","PSGOER",70,0)
 D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOER",71,0)
 K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOER",72,0)
 ;
"RTN","PSGOER",73,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",74,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",75,0)
 ;
"RTN","PSGOER",76,0)
MARK ;
"RTN","PSGOER",77,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",78,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",79,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",80,0)
 Q
"RTN","PSGOER",81,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",82,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0)) S ^PS(53.45,PSJSYSP,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",83,0)
 ;S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",84,0)
 Q
"RTN","PSGOER",85,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",86,0)
 ;PSJ*5*181 - no longer use (OC will be triggered from OC^PSGOER0)
"RTN","PSGOER",87,0)
 Q
"RTN","PSGOER",88,0)
NEWOC55 ;
"RTN","PSGOER",89,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJDD0,PSJALLGY
"RTN","PSGOER",90,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",91,0)
 F PSGDDI=0:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'+PSGDDI  D
"RTN","PSGOER",92,0)
 . S PSJDD0=$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0))
"RTN","PSGOER",93,0)
 . S PSJX=$P(PSJDD0,U,3) I PSJX]"",(PSJX'>$G(PSGDT)) Q
"RTN","PSGOER",94,0)
 . S PSJDD=+PSJDD0
"RTN","PSGOER",95,0)
 . S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSGOER",96,0)
 . Q:PSJX
"RTN","PSGOER",97,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSGOER",98,0)
 S PSJDD=$O(PSJALLGY(0))
"RTN","PSGOER",99,0)
 I '+PSJDD W !!,"No active dispense drug was found" D PAUSE^PSJLMUT1 Q
"RTN","PSGOER",100,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOER",101,0)
 D:'$G(PSGORQF) IN^PSJOCDS(PSGORD,"UD",PSJDD) Q:$G(PSGORQF)
"RTN","PSGOER",102,0)
 Q
"RTN","PSGOER",103,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",104,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR,PSGOORD
"RTN","PSGOER",105,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",106,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",107,0)
 ; PSJ*5*141 - changed PSGOEPR to PSGPR for field 1 of the DR string below.
"RTN","PSGOER",108,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",109,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",110,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",111,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",112,0)
 ;PSJ*5*198
"RTN","PSGOER",113,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",4)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@" I $G(PSJORD)["P",+PSJSYSU=1 S DR=DR_";18////@;19////@"
"RTN","PSGOER",114,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",115,0)
 D ^DIE
"RTN","PSGOER",116,0)
 ; PSJ*5*278 - Check to re-assign orderable item
"RTN","PSGOER",117,0)
 N PSGPOI S PSGPOI=$$ACTIVE^PSJORREN(PSGP,PSGORD) Q:+PSGPOI=1  ;Quit if no change to OI
"RTN","PSGOER",118,0)
 I +PSGPOI>1,$P(PSGPOI,U,2) D  ;replace OI
"RTN","PSGOER",119,0)
 . N DR,DA,DIE S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="108///^S X=$P(PSGPOI,U,2)" D ^DIE
"RTN","PSGOER",120,0)
 Q
"RTN","PSGOER",121,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",122,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",123,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",124,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",125,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",126,0)
 Q
"RTN","PSGOER",127,0)
READ ; hold screen
"RTN","PSGOER",128,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",129,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",130,0)
 Q
"RTN","PSGOER",131,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",132,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",133,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",134,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",135,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",136,0)
 Q
"RTN","PSGOER",137,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",138,0)
 ; INPUT 
"RTN","PSGOER",139,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",140,0)
 ;       PSJY - Inpatient Order Number(appended with "V" or "U")
"RTN","PSGOER",141,0)
 ; OUTPUT
"RTN","PSGOER",142,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",143,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",144,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",145,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",146,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",147,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",148,0)
 I NOW<STOP Q 0
"RTN","PSGOER",149,0)
 ;*315 ND2P1 ON NEXT LINE
"RTN","PSGOER",150,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),ND2P1=$G(^PS(55,PSJX,5,+PSJY,2.1)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",151,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",152,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",153,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",154,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",155,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",156,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",157,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",158,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",159,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",160,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",161,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",162,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",163,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",164,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",165,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",166,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",167,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",168,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",169,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",170,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",171,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",172,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",173,0)
 ;
"RTN","PSGOER",174,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",175,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",176,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",177,0)
 ;
"RTN","PSGOER",178,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",179,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",180,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",181,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSGOER0")
0^14^B25398399
"RTN","PSGOER0",1,0)
PSGOER0 ;BIR/CML3 - EDIT FIELDS FOR RENEWAL ;Jul 26, 2017@18:04:02
"RTN","PSGOER0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**11,45,47,50,63,64,70,69,58,80,110,127,136,181,281,327**;16 DEC 97;Build 114
"RTN","PSGOER0",3,0)
 ;
"RTN","PSGOER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191. 
"RTN","PSGOER0",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSGOER0",6,0)
 ; Reference to ^DD(55.06 is supported by DBIA 2253.
"RTN","PSGOER0",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSGOER0",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSGOER0",9,0)
 ;
"RTN","PSGOER0",10,0)
DATE(PSGP,PSGORD,PSGDT) ;
"RTN","PSGOER0",11,0)
 K PSGFOK,PSJNOO,PSGNEDFD,PSGOEPR,PSGOER0,PSGPDRG,PSGOER2,PSGWLL,PSGOERDP,PSGOFD,PSGPRN,PSGPRI,PSGOSD,PSGOPR,PSGRNSD,PSGS0XT,PSGS0Y,PSGST,PSGSCH,PSGSDN
"RTN","PSGOER0",12,0)
 S F1=55.06,PSGWLL=+$G(^PS(55,PSGP,5.1)),PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGPDRG=+$G(^(.2)),PSGOER2=$G(^(2))
"RTN","PSGOER0",13,0)
 NEW XX S XX=$$ACTIVE^PSJORREN(PSGP,PSGORD) S:+XX=2 PSGPDRG=$P(XX,U,2)
"RTN","PSGOER0",14,0)
 I '+XX W !,"No active Orderable Item was found.",! G DONE
"RTN","PSGOER0",15,0)
 S (PSGNEDFD,PSGOERDP)=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)
"RTN","PSGOER0",16,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGST=$P(PSGOER0,"^",7),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6)
"RTN","PSGOER0",17,0)
 S PSGOEPR=+$P(PSGOER0,"^",2),(PSGOPR,PSGPR)=$S($P(PSJSYSU,";",2):DUZ,1:+PSGOEPR)
"RTN","PSGOER0",18,0)
 I $G(PSJSPEED) S PSGPR=$S($P(ND,"^",2):$P(ND,"^",2),1:+PSGOEPR)
"RTN","PSGOER0",19,0)
 S PSGOSD=+$P(PSGOER2,"^",2) S PSGOFD=+$P(PSGOER2,"^",4),PSGPRN=$$GET1^DIQ(200,PSGPR,.01),PSGPRI=$S($P(PSJSYSU,";",2):0,1:$P($G(^("PS")),"^",4)),PSGRO=0 S:PSGPRI PSGPRI=PSGPRI'>DT I PSGPRI S (PSGOPR,PSGPR,PSGPRN)=""
"RTN","PSGOER0",20,0)
 S PSGRNSD=$S($G(PSGLI):PSGLI,1:$G(PSGDT))
"RTN","PSGOER0",21,0)
 S PSGSD=$G(PSGOSD)
"RTN","PSGOER0",22,0)
 I PSGSD="" S PSJREN=1,PSGSD=$$ENSD^PSGNE3($S(PSGST["P":"PRN",1:$P(PSGOER2,U)),PSGS0Y,PSGDT,PSGOSD) S:PSGOSD>PSGSD PSGSD=PSGOSD K PSJREN
"RTN","PSGOER0",23,0)
 S PSGSDN=$$ENDD^PSGMI(PSGSD)
"RTN","PSGOER0",24,0)
10 ;
"RTN","PSGOER0",25,0)
 ;W !,"START DATE/TIME: "_PSGSDN
"RTN","PSGOER0",26,0)
O25 ;
"RTN","PSGOER0",27,0)
 N PSGSD,PSGNEFD S PSGSD=PSGDT
"RTN","PSGOER0",28,0)
 D ENWALL^PSGNE3(PSGSD,0,PSGP)
"RTN","PSGOER0",29,0)
 S:'$G(PSGDT) PSGDT=$$DATE2^PSJUTL2($$NOW^XLFDT)
"RTN","PSGOER0",30,0)
 N PSGNESD S PSGNESD=PSGDT D ENFD^PSGNE3(PSGNESD) I $G(PSGNEFD) S (Y,PSGFD)=PSGNEFD
"RTN","PSGOER0",31,0)
 S PSGFOK(10)="" I PSGST="O" S PSGFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGRNSD,PSGP) I PSGFD]"" S Y=PSGRNSD,X=0 G 1
"RTN","PSGOER0",32,0)
D25 K DUR,DURMIN N PKGFLG S PKGFLG=$S(PSGORD["U":5,PSGORD["V":"IV",PSGORD["P":"P",1:"") I PKGFLG]"" S DUR=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),PKGFLG,1) I DUR]"" D
"RTN","PSGOER0",33,0)
 .S DURMIN=($$DURMIN^PSJLIVMD(DUR)\1) I DURMIN>1 S Y=$$FMADD^XLFDT(PSGRNSD,,,DURMIN) I Y>PSGRNSD S PSGFD=Y,X=0
"RTN","PSGOER0",34,0)
 I $P($G(PSGOER2),"^",4)>PSGFD S Y=$P(PSGOER2,"^",4)
"RTN","PSGOER0",35,0)
 I $G(DUR)]"",($G(PSGORD)'["P") S DURMIN=$$DURMIN^PSJLIVMD(DUR)\1 S Y=$$FMADD^XLFDT(PSGDT,,,DURMIN)
"RTN","PSGOER0",36,0)
 S:X&$P(PSJSYSW0,"^",7) $P(Y,".",2)=$P(PSJSYSW0,"^",7) S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",37,0)
25 W !,"STOP DATE/TIME: "_PSGFDN_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",38,0)
 I X="" W "   "_PSGFDN G W25
"RTN","PSGOER0",39,0)
 I $E(X)="^" D FF G:Y>0 @Y G 25
"RTN","PSGOER0",40,0)
 S PSGF2=25 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,25)
"RTN","PSGOER0",41,0)
 I X=+X,X>0,X'>2000000 G 25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X,ND2=PSGOER2,$P(ND2,"^",2)=PSGRNSD W " ...dose limit..." D ENGO^PSGDL
"RTN","PSGOER0",42,0)
 K %DT S %DT="ERTX" D ^%DT K %DT G:Y'>0 25 S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",43,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOER0",44,0)
 I PSGFD<PSGSD W $C(7),!!?3,"*** The STOP date must be AFTER the START date. ***" G 25
"RTN","PSGOER0",45,0)
 S PSGFOK(25)=""
"RTN","PSGOER0",46,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOER0",47,0)
 D EFDNEW^PSJUTL
"RTN","PSGOER0",48,0)
 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S PSGFOK(1)="" Q
"RTN","PSGOER0",49,0)
1 ; provider
"RTN","PSGOER0",50,0)
 G:+PSJSYSU<3&$P(PSJSYSU,";",2) CHKDD S PSGF2=1
"RTN","PSGOER0",51,0)
A1 ;
"RTN","PSGOER0",52,0)
 S PSTMPI=PSGPR,PSTMPN=PSGPRN
"RTN","PSGOER0",53,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",54,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOER0",55,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$$GET1^DIQ(200,PSGPR,53.1,"I") W "    "_$$GET1^DIQ(200,PSGPR,53.2)_"    "_$$GET1^DIQ(200,PSGPR,53.3) S PSGFOK(1)="" G:'$G(ANOX) OC55
"RTN","PSGOER0",56,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOER0",57,0)
 I $E(X)="^" D FF G:Y>0 @Y G A1
"RTN","PSGOER0",58,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P((X(1)),""^"",4):1,1:DT<$P((X(1)),""^"",4))" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOER0",59,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOER0",60,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOER0",61,0)
A2 D CLOZPRV^PSGOE82
"RTN","PSGOER0",62,0)
 I $G(ANQX) W ! S PSGPR=PSTMPI,PSGPRN=PSTMPN  K PSTMPN,PSTMPI G A1
"RTN","PSGOER0",63,0)
 K ANQX
"RTN","PSGOER0",64,0)
 ;; END NCC T4 MODS << 327*RJS
"RTN","PSGOER0",65,0)
OC55 ;
"RTN","PSGOER0",66,0)
 ;Order check for Speed finish is triggered from OC531^PSGOESF
"RTN","PSGOER0",67,0)
 I $G(PSGORD)]"P",$G(PSJSPEED) Q
"RTN","PSGOER0",68,0)
 I $G(PSJOCFG)="SPEED RENEW" G CHKDD
"RTN","PSGOER0",69,0)
 D NEWOC55^PSGOER
"RTN","PSGOER0",70,0)
 I $G(PSGORQF) S COMQUIT=1 G DONE
"RTN","PSGOER0",71,0)
CHKDD ;
"RTN","PSGOER0",72,0)
 G:$G(PSGRENEW) 106
"RTN","PSGOER0",73,0)
 I PSGORD["P"!$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",PSGPDRG) G 106
"RTN","PSGOER0",74,0)
 ;I PSGORD["P"!'$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") G 106
"RTN","PSGOER0",75,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q
"RTN","PSGOER0",76,0)
 K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOER0",77,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOER0",78,0)
 D ENDRG^PSGOEF1(+$$GET1^DIQ(55.06,+PSGOED_","_PSGP,108,"I"),0)
"RTN","PSGOER0",79,0)
 I $G(DUOUT)!'$G(DRG) S COMQUIT=1 Q
"RTN","PSGOER0",80,0)
106 ; nature of order
"RTN","PSGOER0",81,0)
 S PSJNOO=$$ENNOO^PSJUTL5("R") S:PSJNOO<0 COMQUIT=1
"RTN","PSGOER0",82,0)
 S:PSJNOO'<0 PSGFOK(106)=""
"RTN","PSGOER0",83,0)
DONE ;
"RTN","PSGOER0",84,0)
 K F,F0,F1,PSGF2,F3,ND2,PSGDL,PSGDLS,PSGOROE1,PSGRO,SDT,X,Y Q
"RTN","PSGOER0",85,0)
FF ; "^" to another field
"RTN","PSGOER0",86,0)
 K DIC S DIC="^DD(55.06,",DIC(0)="EQ",DIC("S")="I $D(PSGFOK(+Y))",X=$E(X,2,255) D ^DIC K DIC
"RTN","PSGOER0",87,0)
 S Y=+Y Q
"RTN","PSGOERS")
0^39^B41465316
"RTN","PSGOERS",1,0)
PSGOERS ;BIR/CML3 - RENEW SELECTED ORDERS ; 10/23/14 9:30pm
"RTN","PSGOERS",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**11,29,35,47,58,110,281,327**;16 DEC 97;Build 114
"RTN","PSGOERS",3,0)
 ;
"RTN","PSGOERS",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOERS",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOERS",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOERS",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSGOERS",8,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000
"RTN","PSGOERS",9,0)
 ;
"RTN","PSGOERS",10,0)
MARK ; only mark order, not actually renew
"RTN","PSGOERS",11,0)
 W !,"...marking ",PSGPDRGN," ",PSGDO,"..." S $P(^PS(55,PSGP,5,+PSGORD,4),"^",15,17)="1^"_DUZ_"^"_PSGDT,PSGAL("C")=13180 D ^PSGAL5 W "."
"RTN","PSGOERS",12,0)
 I $D(PSJSYSO) S PSGPOSA="R",PSGPOSD=PSGDT,PSGORD=+PSGORD_"A" D ENPOS^PSGVDS
"RTN","PSGOERS",13,0)
 Q
"RTN","PSGOERS",14,0)
RENEW ; mark or renew order
"RTN","PSGOERS",15,0)
 D NOW^%DTC K DA S DA(1)=PSGP,DA=+PSGORD,PSGDT=+$E(%,1,12)
"RTN","PSGOERS",16,0)
 I $G(PSGFD)="" S X=$P(PSGFDN,":",1,2) D ^%DT S:Y>0 PSGFD=Y
"RTN","PSGOERS",17,0)
 ; do order checking
"RTN","PSGOERS",18,0)
 N PSJABT,PSGDRG,PSGOER1,PSGDO,PSGPDRG,PSGPDRGN,PSGOER0,PSGST,PSGOER2,PSGSI,PSGOSD,PSGOFD,PSGNEDFD,PSGNESD,PSGMR,PSGSM,PSGHSM,PSGSCH,PSGS0Y,PSGS0XT,PSGNEFD
"RTN","PSGOERS",19,0)
 ;* S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^")
"RTN","PSGOERS",20,0)
 ;* K PSGORQF D ENDDC^PSGSICHK(PSGP,+PSGDRG)
"RTN","PSGOERS",21,0)
 ;D OC55^PSGOER
"RTN","PSGOERS",22,0)
 ;I $D(PSGORQF) W !!,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P(^PS(55,PSGP,5,+PSGORD,.2),"^",2),!,"...No action taken on this order...",! Q
"RTN","PSGOERS",23,0)
 ;* Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOERS",24,0)
 ;
"RTN","PSGOERS",25,0)
 S PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGDO=$P(PSGOER1,"^",2),PSGPDRG=$P(PSGOER1,"^"),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG) I '$P(PSJSYSP0,"^",3) G MARK
"RTN","PSGOERS",26,0)
 S PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGST=$P(PSGOER0,"^",7),PSGOER2=$G(^(2)),PSGND4=$G(^(4)),PSGSI=$G(^(6)),PSGOSD=$P(PSGOER2,"^",2),PSGOFD=$P(PSGOER2,"^",4),PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)_"^^"_PSGST
"RTN","PSGOERS",27,0)
 N PSGOEAV S PSGOEAV=1,PSGOORD=PSGORD W "." K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOERS",28,0)
 I $$CHKDD() W !!,"...",PSGPDRGN," ",PSGDO," order NOT renewed..." Q
"RTN","PSGOERS",29,0)
 ; p327 
"RTN","PSGOERS",30,0)
 I $$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) D  Q
"RTN","PSGOERS",31,0)
 .W !,"Clozapine orders cannot be renewed."
"RTN","PSGOERS",32,0)
 .W !,"...order NOT renewed..."
"RTN","PSGOERS",33,0)
 ;W !!,"...renewing ",PSGOERS2,". ",PSGPDRGN," ",PSGDO,"..."
"RTN","PSGOERS",34,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6),PSGPDRG=$P(PSGOER1,"^"),PSGDO=$P(PSGOER1,"^",2)
"RTN","PSGOERS",35,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=$S(PSGST="O":PSGSD,1:PSGFD)
"RTN","PSGOERS",36,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSGOERS",37,0)
 ;K ^PS(53.45,PSJSYSP,4) S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,12,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,4,Q,0)=$G(^(Q,0))
"RTN","PSGOERS",38,0)
 I $O(^PS(55,PSGP,5,+PSGORD,3,0)) S ^PS(53.45,PSJSYSP,1,0)=^(0),Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,3,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,1,Q,0)=$G(^(Q,0))
"RTN","PSGOERS",39,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) D
"RTN","PSGOERS",40,0)
 .S X=$O(^PS(55,PSGP,5,+PSGORD,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,^PS(53.45,PSJSYSP,2,Q1,0)=$P(ND,"^",1,3)
"RTN","PSGOERS",41,0)
 D NEWOC55^PSGOER I $G(PSGORQF) W !!,"...order NOT renewed..." Q
"RTN","PSGOERS",42,0)
 W !!,"...renewing ",PSGOERS2,". ",PSGPDRGN," ",PSGDO,"..."
"RTN","PSGOERS",43,0)
 D SPEED^PSGOER
"RTN","PSGOERS",44,0)
 ; PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT
"RTN","PSGOERS",45,0)
 ;S:$S(X:Q1,1:0) ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_Q1_"^"_Q1 D ^PSGOETO I +PSJSYSU=3,PSGOORD["O" D EN^PSGPEN(+PSGORD)
"RTN","PSGOERS",46,0)
 ;W !,"...updating original order...",! K DA S DA(1)=PSGP,DA=+PSGOORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5
"RTN","PSGOERS",47,0)
 ;I PSGORD'["O",PSGSD<PSGOFD S PSGALR=70,DIE="^PS(55,"_PSGP_",5,",DR="34////"_+PSGSD S:PSGSD'>PSGDT DR=DR_";28////E"
"RTN","PSGOERS",48,0)
 ;I  D ^DIE I $P($G(^PS(55,PSGP,5,+PSGOORD,0)),"^",21) D EN1^PSJHL2(PSGP,"SC",PSGOORD,"ORDER EXPIRED")
"RTN","PSGOERS",49,0)
 ;S $P(PSGND4,"^",12,14)="^^",$P(PSGND4,"^",15,20)="^^^^^",$P(PSGND4,"^",22,24)="^^",^PS(55,PSGP,5,+PSGOORD,4)=PSGND4,$P(^(0),"^",26,27)=PSGORD_"^R"
"RTN","PSGOERS",50,0)
 Q
"RTN","PSGOERS",51,0)
CHKDD() ;
"RTN","PSGOERS",52,0)
 I '$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") Q 0
"RTN","PSGOERS",53,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q 1
"RTN","PSGOERS",54,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOERS",55,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOERS",56,0)
 I $G(DUOUT) W !,"ORDER NOT RENEW."
"RTN","PSGOERS",57,0)
 Q $G(DUOUT)!'$G(DRG)
"RTN","PSGOERS",58,0)
EN ;
"RTN","PSGOERS",59,0)
 NEW PSGORQF,PSJOCFG S PSJOCFG="SPEED RENEW"
"RTN","PSGOERS",60,0)
 Q:'$$HIDDEN^PSJLMUTL("SPEED")  S PSJSPEED=1
"RTN","PSGOERS",61,0)
 N PSGONR,CODE,ST,DRG,ON S PSGOEORF=1 D FULL^VALM1
"RTN","PSGOERS",62,0)
 S CODE="",PSGONR=0 F  S CODE=$O(^TMP("PSJ",$J,CODE)) Q:CODE'="A"  D
"RTN","PSGOERS",63,0)
 .S ST="" F  S ST=$O(^TMP("PSJ",$J,CODE,ST)) Q:ST=""  D
"RTN","PSGOERS",64,0)
 ..S DRG="" F  S DRG=$O(^TMP("PSJ",$J,CODE,ST,DRG)) Q:DRG=""  S ON="" F  S ON=$O(^TMP("PSJ",$J,CODE,ST,DRG,ON)) Q:ON=""  S PSGONR=PSGONR+1
"RTN","PSGOERS",65,0)
 S PSGONW="R",PSGLMT=PSGONR D ENWO^PSGON I "^"[X K X G DONE
"RTN","PSGOERS",66,0)
 S PSGOSD=0 F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S Y=+^TMP("PSJON",$J,PSGOERS2),F=$G(^PS(55,PSGP,5,Y,0)),D=$G(^(.2)) D HMSG I F G EN
"RTN","PSGOERS",67,0)
 I $P(PSJSYSP0,"^",3) D  I '$D(PSGFOK) S X="" G DONE
"RTN","PSGOERS",68,0)
 .NEW PSGRENEW S PSGRENEW=1
"RTN","PSGOERS",69,0)
 .S PSGORD=^TMP("PSJON",$J,+PSGODDD(1)),DA=+PSGORD,DA(1)=PSGP,PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSGP,5.1)),1:0),PSGOEE="R" W ! D DATE^PSGOER0(PSGP,PSGORD,PSGDT)
"RTN","PSGOERS",70,0)
 .I '$D(PSGFOK(106)) W $C(7),!,"...order",$E("s",$L(PSGODDD(1),",")>2)," NOT renewed..." K PSGFOK Q
"RTN","PSGOERS",71,0)
 .I 'PSGNEDFD,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOERS",72,0)
 ;W ! F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S PSGORD=^TMP("PSJON",$J,PSGOERS2) D RENEW
"RTN","PSGOERS",73,0)
 W !
"RTN","PSGOERS",74,0)
 N EXITLOOP S EXITLOOP=0
"RTN","PSGOERS",75,0)
 F PSGOERS=1:1:PSGODDD D
"RTN","PSGOERS",76,0)
 .F PSGOERS1=1:1 D  Q:EXITLOOP=1
"RTN","PSGOERS",77,0)
 ..S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1)
"RTN","PSGOERS",78,0)
 ..I 'PSGOERS2 S EXITLOOP=1 Q
"RTN","PSGOERS",79,0)
 ..S PSGORD=^TMP("PSJON",$J,PSGOERS2)
"RTN","PSGOERS",80,0)
 ..I $$CHKCOM Q
"RTN","PSGOERS",81,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOERS",82,0)
 ..D RENEW
"RTN","PSGOERS",83,0)
 ..; Call the unlock procedure
"RTN","PSGOERS",84,0)
 ..D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOERS",85,0)
 ..I $G(PSGOORD) D UNL^PSSLOCK(DFN,PSGOORD)
"RTN","PSGOERS",86,0)
 S X=""
"RTN","PSGOERS",87,0)
DONE ;
"RTN","PSGOERS",88,0)
 D INIT^PSJLMHED(1)
"RTN","PSGOERS",89,0)
 K DA,DIE,DR,FDSD,PSGAL,PSGALR,PSGFD,PSGFOK,PSGLMT,PSGND4,PSGODDD,PSGOERS,PSGOERS1,PSGOERS2,PSGONW,PSGOPR,PSGORD,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGSD
"RTN","PSGOERS",90,0)
 K PSGST,PSGTOL,PSGTOO,PSGUOW,PSGWLL,PSJSPEED,PSGDT,ND,Q,Q1,PSGDO,PSGOER1,PSGPDRG,PSGPDRGN,PSGOER0,PSGOER2,PSGND4,PSGSI,PSGOSD,PSGOFD,PSGNEDFD,%,Y,F,D
"RTN","PSGOERS",91,0)
 Q
"RTN","PSGOERS",92,0)
GRI ; get renewal info
"RTN","PSGOERS",93,0)
HMSG ; hold/'not to be given' message
"RTN","PSGOERS",94,0)
 S X=$P($G(^PS(50.7,+D,0)),"^") S:X]"" X=X_" "_$P(D,"^",2)
"RTN","PSGOERS",95,0)
 I $P(F,"^",22) S H="has been marked as 'NOT TO BE GIVEN'" D WO Q
"RTN","PSGOERS",96,0)
 I $P(F,"^",9)="H" S H="is ON HOLD" D WO Q
"RTN","PSGOERS",97,0)
 I $P(F,"^",27)]"",$P(F,"^",26) S H="has been "_$S($P(F,"^",24)="E":"EDITED",1:"RENEWED") D WO Q
"RTN","PSGOERS",98,0)
 I ($P($G(^PS(50.7,+D,0)),"^",4)]"")&($P($G(^(0)),"^",4)'>DT) S H="is no longer an active Orderable Item" D WO Q
"RTN","PSGOERS",99,0)
 N PSGDFLG,DRG,DRGPT
"RTN","PSGOERS",100,0)
 S PSGDFLG=1 F DRG=0:0 S DRG=$O(^PSDRUG("ASP",+D,DRG)) Q:'DRG  I $P(^PSDRUG(DRG,2),U,3)["U",($G(^PSDRUG(DRG,"I"))=""!($G(^("I"))>DT)) S PSGDFLG=0 Q
"RTN","PSGOERS",101,0)
 I PSGDFLG S H="is no longer an active Dispense drug" D WO Q
"RTN","PSGOERS",102,0)
 S F=0,X=$P($G(^PS(55,PSGP,5,Y,2)),"^",2) S:X>PSGOSD PSGOSD=X Q
"RTN","PSGOERS",103,0)
WO ;
"RTN","PSGOERS",104,0)
 W $C(7),"  ??",! W:X]"" !,X S H1="Order number "_$G(PSGOERS2)_" "_H_", and cannot be renewed." W ! F H2=1:1:$L(H1," ") S H3=$P(H1," ",H2) W:$L(H3)+$X>78 ! W H3," "
"RTN","PSGOERS",105,0)
 S F=1 K H,H1,H2,H3 Q
"RTN","PSGOERS",106,0)
CHKCOM() ;       Check if this order is a complex order
"RTN","PSGOERS",107,0)
 S PSJCOM=0
"RTN","PSGOERS",108,0)
 I PSGORD=+PSGORD S PSJCOM=PSGORD W !,"  Order ",PSGOERS2," is part of a complex order series, and cannot be renewed.",! H 2 Q PSJCOM
"RTN","PSGOERS",109,0)
 S PSJCOM=$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8))
"RTN","PSGOERS",110,0)
 I PSJCOM  W !,"  Order ",PSGOERS2," is part of a complex order series, and cannot be renewed.",! H 2
"RTN","PSGOERS",111,0)
 Q PSJCOM
"RTN","PSGOETO")
0^29^B46539798
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;12 June 2019 09:31:53
"RTN","PSGOETO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,13,25,31,33,50,68,58,85,105,90,117,110,111,112,161,254,267,268,315,327**;16 DEC 97;Build 114
"RTN","PSGOETO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 via DBIA 2178
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 via DBIA 2181
"RTN","PSGOETO",7,0)
 ; Reference to ^PSUHL via DBIA 4803
"RTN","PSGOETO",8,0)
 ;
"RTN","PSGOETO",9,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",14,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",15,0)
 S:$G(PSGRF)]"" ND2P1=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) ;*315 drp
"RTN","PSGOETO",16,0)
 ; naked reference below refers to ^PS(55,PSGP,0)
"RTN","PSGOETO",17,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F D LOGDFN^PSUHL(PSGP)
"RTN","PSGOETO",18,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",20,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",24,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",25,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",26,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",27,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",28,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",29,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",30,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",31,0)
 ;*315 DRP INSERT UPDATE FOR REMOVAL FIELDS HERE
"RTN","PSGOETO",32,0)
 S:$G(ND2P1)]"" @(F_"2.1)")=ND2P1
"RTN","PSGOETO",33,0)
 S X=-1 S:'$D(^PS(53.45,+$G(DUZ),5,1,0)) X=$S($G(PSGORD):$$GETSIOPI^PSJBCMA5(DFN,PSGORD),1:"") I X D FILESI^PSJBCMA5(PSGP,DA_$S(F["PS(55":"U",1:"P"))
"RTN","PSGOETO",34,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",35,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",36,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",37,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",38,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",39,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",40,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",41,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOETO",42,0)
 N ARR,FOUND D FIND^DIC(53.1,,.01,"Q",PSGP,,"AC",,,"ARR")
"RTN","PSGOETO",43,0)
 F I=2:1 Q:'$D(ARR("DILIST",2,I))  I ARR("DILIST",2,I)=DA S FOUND=1
"RTN","PSGOETO",44,0)
 I $G(FOUND)!($$GET1^DIQ(55.06,+$G(ND)_","_DFN,.01,"I")) D
"RTN","PSGOETO",45,0)
 .I +$G(PSGCTDD) N PSGTMP S PSGTDD=PSGCTDD,PSGTMP=DA K PSGCTDD
"RTN","PSGOETO",46,0)
 .I +$G(PSGETDD) N PSGTMP S PSGTDD=PSGETDD,PSGTMP=DA K PSGETDD
"RTN","PSGOETO",47,0)
 .I +$G(PSGNTDD) N PSGTMP S PSGTDD=PSGNTDD,PSGTMP=DA K PSGNTDD
"RTN","PSGOETO",48,0)
 I +$G(ND)["U" S PSGTMP=+$G(ND)
"RTN","PSGOETO",49,0)
 S:'+$G(PSGTMP) PSGTMP=DA
"RTN","PSGOETO",50,0)
 I $G(PSGTDD) D
"RTN","PSGOETO",51,0)
 .;/MZR changed the next line
"RTN","PSGOETO",52,0)
 .I PSGOEAV,'$D(^TMP("PSJCOM",$J,DA)) S ^TMP("PSJCOM",$J,DA,"SAND")=PSGTDD
"RTN","PSGOETO",53,0)
 .S ^TMP($J,"PSGCLOZ",DFN,+$G(PSGTMP),"SAND")=PSGTDD K PSGTDD
"RTN","PSGOETO",54,0)
 I $G(PSGETDD) D
"RTN","PSGOETO",55,0)
 .I 'PSGOEAV,'$D(^TMP("PSJCOM",$J,DA)) S ^TMP("PSJCOM",$J,DA,"SAND")=PSGETDD K PSGETDD
"RTN","PSGOETO",56,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOETO",57,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P")
"RTN","PSGOETO",58,0)
 I $G(PSGOORD),$D(PSGOEE) N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOETO",59,0)
 .N DIE,DA,DR
"RTN","PSGOETO",60,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",61,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",62,0)
 .I $G(DR) D ^DIE
"RTN","PSGOETO",63,0)
 D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",64,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",65,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",66,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",67,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",68,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",69,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",70,0)
 D STOREINT^PSGSICH1
"RTN","PSGOETO",71,0)
OUT ;
"RTN","PSGOETO",72,0)
 K PSGOETOF
"RTN","PSGOETO",73,0)
  ; ** This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change location **
"RTN","PSGOETO",74,0)
 D NEWG^PSJADM
"RTN","PSGOETO",75,0)
  ; ** END of Interface hook **
"RTN","PSGOETO",76,0)
DONE ;
"RTN","PSGOETO",77,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",78,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",79,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE,ND0,ND2P1
"RTN","PSGOETO",80,0)
 K ^PS(53.45,+$G(DUZ),5)
"RTN","PSGOETO",81,0)
 Q
"RTN","PSGOETO",82,0)
CRA ;
"RTN","PSGOETO",83,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",84,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",85,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",86,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",87,0)
CRN ;
"RTN","PSGOETO",88,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",89,0)
ENGNA ; Verified
"RTN","PSGOETO",90,0)
 F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",91,0)
 N PSGLCK S PSGLCK=0
"RTN","PSGOETO",92,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) D  I PSGLCK S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",93,0)
 . L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S PSGLCK=1
"RTN","PSGOETO",94,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",95,0)
ENGNN ; Not Verified
"RTN","PSGOETO",96,0)
 N ND F  L +^PS(59.7,1,25):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",97,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",98,0)
 F  L +^PS(53.1,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",99,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",100,0)
 I $G(PSIVCHG) D
"RTN","PSGOETO",101,0)
 .N PSGORD,ON S ON=DA_"P" D SETIVINT^PSGSICH1
"RTN","PSGOETO",102,0)
 Q
"RTN","PSGOEV")
0^9^B102409211
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3 - VERIFY (MAKE ACTIVE) ORDERS ; 12/9/18 4:26am
"RTN","PSGOEV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241,267,268,260,288,199,281,256,347,327**;16 DEC 97;Build 114
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to ^PSDRUG( supported by DBIA# 2192.
"RTN","PSGOEV",9,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSGOEV",11,0)
 ;
"RTN","PSGOEV",12,0)
EN(PSGORD) ;
"RTN","PSGOEV",13,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",14,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",15,0)
 NEW PSJOLDNM,PSJOLDX
"RTN","PSGOEV",16,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",17,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",18,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",19,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",20,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",21,0)
 ;PSJ*5*256 - inform user of old schedule name and quit
"RTN","PSGOEV",22,0)
 I $S((PSGORD["P"):$P($G(^PS(53.1,+PSGORD,0)),U,24)="R",(PSGORD["U"):$P($G(^PS(55,+PSGP,5,+PSGORD,0)),U,24)="R",1:0) S PSJOLDX="R"
"RTN","PSGOEV",23,0)
 S PSJOLDNM("ORD_SCHD")=$G(PSGSCH)
"RTN","PSGOEV",24,0)
 I $$CHKSCHD^PSJMISC2(.PSJOLDNM,$S($G(PSJOLDX)="R":"R",1:"V")) S CHK=1 G DONE
"RTN","PSGOEV",25,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",26,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",27,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",28,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",29,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",30,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",31,0)
 ;
"RTN","PSGOEV",32,0)
VFY ; change status, move to 55, and change label record **ENHANCEMENTS MADE IN PSJ*5.0*260 **CCR 6214 **CCR 6244
"RTN","PSGOEV",33,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",34,0)
 N PSJDOSE,PSJDSFLG,PSJDIS,PSGORQF,PSJCNT,PSJCNT1,PSJCNT2,LIST,PSJFLG,PSGDN SET PSJDIS="",PSJCNT=0,PSJCNT1="",PSJCNT2="",LIST="PSGPRE",PSJFLG="",PSGDN=""
"RTN","PSGOEV",35,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",36,0)
 S PSJFLG=+$G(PSGORD)
"RTN","PSGOEV",37,0)
 F  S PSJCNT=$O(^PS(53.1,PSJFLG,1,PSJCNT)) Q:'+PSJCNT  D
"RTN","PSGOEV",38,0)
 .I $D(^PS(53.1,PSJFLG,1,PSJCNT,0)) S PSGDN=$P($G(^PS(53.1,PSJFLG,1,PSJCNT,0)),U,1)
"RTN","PSGOEV",39,0)
 .I +$G(PSGDN),($$GET1^DIQ(50,PSGDN,3)'["S")&($E($$GET1^DIQ(50,PSGDN,2),1,2)'="XA")  D
"RTN","PSGOEV",40,0)
 ..D PROFILE^PSJBLDOC($G(DFN),LIST,"I;"_$G(PSGORD))
"RTN","PSGOEV",41,0)
 ..F  S PSJCNT1=$O(^TMP($J,LIST,"IN","PROFILE",PSJCNT1)) Q:(PSJCNT1="")!(PSJDIS'="")  D
"RTN","PSGOEV",42,0)
 ...S PSJCNT2=$P(PSJCNT1,";",2)
"RTN","PSGOEV",43,0)
 ...I PSJCNT2=$G(PSGORD) SET PSJDIS=$P(^TMP($J,LIST,"IN","PROFILE",PSJCNT1),U,3)
"RTN","PSGOEV",44,0)
 ..;**Do order checks if PSJDIS (Dispense drug IEN) has a value
"RTN","PSGOEV",45,0)
 ..;IF $G(PSJNEWOE)=0,'$G(PSJLMFIN),'$G(PSJSTARI),'$G(PSGCOPY),$G(PSJDIS),'$G(PSJSPEED)  D
"RTN","PSGOEV",46,0)
 ..I '+$G(PSJNEWOE),'$G(PSJLMFIN),'$G(PSJSTARI),'$G(PSGCOPY),$G(PSJDIS),'$G(PSJSPEED)  D
"RTN","PSGOEV",47,0)
 ...D ALLERGY($G(PSJORD),.PSJALLGY),ENDDC^PSGSICHK($G(PSGP),PSJDIS) D:('$G(PSGORQF)&'$G(PSJDSVFY)&'$G(PSJSTARI)) IN^PSJOCDS($G(PSGORD),"UD",PSJDIS) IF $G(PSGORQF) K ^TMP($J,LIST) D:$G(PSJORD)]"" EN^VALM("PSJ LM UD ACTION") QUIT
"RTN","PSGOEV",48,0)
 I $G(PSGORQF) QUIT
"RTN","PSGOEV",49,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",50,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",51,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",52,0)
 . S PSJACEPT=0
"RTN","PSGOEV",53,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",54,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",55,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",56,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",57,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",58,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",59,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",60,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",61,0)
 I PSGORD["P" D
"RTN","PSGOEV",62,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",63,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",64,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",65,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",66,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",67,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",68,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",69,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",70,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",71,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",72,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",73,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",74,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",75,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",76,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",77,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",78,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",79,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",80,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",81,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",82,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",83,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",84,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",85,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",86,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",87,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",88,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",89,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",90,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",91,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",92,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",93,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",94,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",95,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",96,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOEV",97,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD)
"RTN","PSGOEV",98,0)
 I CLOZFLG,'$$GET1^DIQ(55.06,+PSGORD_","_PSGP,301),$G(^TMP($J,"PSGCLOZ",PSGP,+PSJORD,"SAND")) D
"RTN","PSGOEV",99,0)
 .N DIE,DA,DR S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEV",100,0)
 .S DR="301////"_^TMP($J,"PSGCLOZ",PSGP,+PSGORD,"SAND") D ^DIE
"RTN","PSGOEV",101,0)
 .K ^TMP($J,"PSGCLOZ",PSGP,+$G(PSJORD),"SAND")
"RTN","PSGOEV",102,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOEV",103,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",104,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=$G(PSJORD),^TMP("PSODAOC",$J,"IP NEW IEN")=$G(PSGORD)
"RTN","PSGOEV",105,0)
 ; -- RTC 198753 - clean-up variable - K PSJAGYSV
"RTN","PSGOEV",106,0)
 D SETOC^PSJNEWOC(PSGORD) K PSJAGYSV
"RTN","PSGOEV",107,0)
  ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEV",108,0)
 ;; START NCC REMEDIATION >> 327*RJS - next line
"RTN","PSGOEV",109,0)
 D NEWJ^PSJADM I CLOZFLG D CLOZSND^PSJOE
"RTN","PSGOEV",110,0)
 ; **END of Interface hook **
"RTN","PSGOEV",111,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",112,0)
DONE ;
"RTN","PSGOEV",113,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",114,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",115,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",116,0)
 .Q:Y="N"
"RTN","PSGOEV",117,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",118,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSGTOL,PSGTOO,PSGUOW,PSJDOSE,PSJVAR,VND4,X,ZZND Q
"RTN","PSGOEV",119,0)
 ;
"RTN","PSGOEV",120,0)
LBL ;
"RTN","PSGOEV",121,0)
 Q
"RTN","PSGOEV",122,0)
 ;
"RTN","PSGOEV",123,0)
ALLERGY(PSGORD,PSJALLGY) ;setup PSJALLGY when non-vf was selected to verify
"RTN","PSGOEV",124,0)
 N PSGDDI,PSJDD,PSJX,ARR
"RTN","PSGOEV",125,0)
 I '+$G(PSGORD),($G(PSGORD)'["P") Q
"RTN","PSGOEV",126,0)
 D LIST^DIC(53.11,","_+PSGORD_",",,"I",,,,,,,"ARR")
"RTN","PSGOEV",127,0)
 F I=1:1 Q:'$D(ARR("DILIST",2,I))  S PSGDDI=ARR("DILIST",2,I) D
"RTN","PSGOEV",128,0)
 . S PSJDD=+$$GET1^DIQ(53.11,PSGDDI_","_+PSGORD,.01,"I")
"RTN","PSGOEV",129,0)
 . S PSJX=$S('$L($$GET1^DIQ(50,+PSJDD,.01)):1,$$GET1^DIQ(50,+PSJDD,63,"I")'["U":1,$$GET1^DIQ(50,+PSJDD,100)="":0,1:$$GET1^DIQ(50,+PSJDD,100,"I")'>$G(DT))
"RTN","PSGOEV",130,0)
 . Q:PSJX
"RTN","PSGOEV",131,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSGOEV",132,0)
 Q
"RTN","PSGOEV",133,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",134,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",135,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",136,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",137,0)
 S Y=$G(Y)
"RTN","PSGOEV",138,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",139,0)
 E  S CHK=1
"RTN","PSGOEV",140,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",141,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",142,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",143,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",144,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",145,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",146,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",147,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",148,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",149,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",150,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",151,0)
 Q:'CHK
"RTN","PSGOEV",152,0)
 W $C(7)
"RTN","PSGOEV",153,0)
 ;
"RTN","PSGOEV",154,0)
CHKM ;
"RTN","PSGOEV",155,0)
 D FULL^VALM1 K:CHK Y
"RTN","PSGOEV",156,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",157,0)
 ; PSJ*5*267 VMP Add the 8th condition
"RTN","PSGOEV",158,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:8 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG^DOSAGE ORDERED","^",X)
"RTN","PSGOEV",159,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",160,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",161,0)
 N DIR,DUOUT,DTOUT S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",162,0)
 Q
"RTN","PSGOEV",163,0)
 ;
"RTN","PSGOEV",164,0)
CONT() ;
"RTN","PSGOEV",165,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",166,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",167,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSGOEV",168,0)
 D ^DIR
"RTN","PSGOEV",169,0)
 Q Y
"RTN","PSGOEV",170,0)
 ;
"RTN","PSGOEV",171,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",172,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",173,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",174,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",175,0)
 Q:CHK=0
"RTN","PSGOEV",176,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",177,0)
 ;
"RTN","PSGOEV",178,0)
DDEDIT ;
"RTN","PSGOEV",179,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",180,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",181,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",182,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",183,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",184,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",185,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",186,0)
 K DRG,DRGF,%X,%Y,PSGPD Q
"RTN","PSGOEV",187,0)
 ;
"RTN","PSGOEV",188,0)
AESCREEN() ;
"RTN","PSGOEV",189,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",190,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",191,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",192,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",193,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",194,0)
 Q 0
"RTN","PSGOEV",195,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",196,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",197,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",198,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",199,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",200,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",201,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",202,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",203,0)
 . N TXTLN S TXTLN="" F  S TXTLN=$O(^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN)) Q:TXTLN=""  D
"RTN","PSGOEV",204,0)
 .. I TXTLN=0 S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN) Q
"RTN","PSGOEV",205,0)
 .. S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN,0)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN,0)
"RTN","PSGOEV",206,0)
 Q
"RTN","PSGON")
0^26^B39542310
"RTN","PSGON",1,0)
PSGON ;BIR/CML3-SELECT ORDERS ;Jul 26, 2017@18:04:02
"RTN","PSGON",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,22,54,327**;16 DEC 97;Build 114
"RTN","PSGON",3,0)
ENCHK ;
"RTN","PSGON",4,0)
 K PSGODDD S PSGODDD=1,PSGODDD(1)="" W:X="-" "  (ALL)" I X="ALL"!(X="-") S X="1-"_PSGLMT
"RTN","PSGON",5,0)
 E  S:$E(X)="-" X=1_X S:$E(X,$L(X))="-" X=X_PSGLMT
"RTN","PSGON",6,0)
 F Q=1:1:$L(X,",") S X1=$P(X,",",Q) D SET Q:'$D(X)
"RTN","PSGON",7,0)
 Q
"RTN","PSGON",8,0)
 ;
"RTN","PSGON",9,0)
SET ;
"RTN","PSGON",10,0)
 I $S(X1>PSGLMT:1,X1<1:1,X1?.N:0,1:X1'?1.N1"-"1.N) K X Q
"RTN","PSGON",11,0)
 I X1'["-" S X2=X1 G SET1
"RTN","PSGON",12,0)
 F X2=$P(X1,"-"):1:$P(X1,"-",2) D SET1 Q:'$D(X)
"RTN","PSGON",13,0)
 Q
"RTN","PSGON",14,0)
 ;
"RTN","PSGON",15,0)
SET1 ;
"RTN","PSGON",16,0)
 S X2=+X2 I $S(X2<1:1,X2>PSGLMT:1,$D(PSGEFN):'$D(PSGEFN(X2)),1:0) K X Q
"RTN","PSGON",17,0)
 I PSGODDD(PSGODDD) F QQ=+$G(PSGOESF):1:PSGODDD I ","_$G(PSGODDD(QQ))[(","_X2_",") Q
"RTN","PSGON",18,0)
 I  Q
"RTN","PSGON",19,0)
 I $L(PSGODDD(PSGODDD))+$L(X2)>244 S PSGODDD=PSGODDD+1,PSGODDD(PSGODDD)=""
"RTN","PSGON",20,0)
 S PSGODDD(PSGODDD)=PSGODDD(PSGODDD)_X2_"," ;Q
"RTN","PSGON",21,0)
 Q
"RTN","PSGON",22,0)
 ;
"RTN","PSGON",23,0)
ENASR ; action/select read
"RTN","PSGON",24,0)
 ;S ACTION=$S($D(PSGPRF):0,PSGONC:1,PSGONV:1,$G(PSGONF):1,1:PSGONR>0)
"RTN","PSGON",25,0)
 S ACTION=0
"RTN","PSGON",26,0)
RD1 ;W !!,$S($D(PSGPRF):"View",1:"Select"),$S(ACTION:" ACTION or",1:"")," ORDER",$S(PSGLMT>1:"S (1-"_PSGLMT,1:" (1"),"): " R X:DTIME W:'$T $C(7) S:'$T X="^" I "^"[X K ACTION Q
"RTN","PSGON",27,0)
 W !!,$S($D(PSGPRF):"View",1:"Select"),$S(ACTION:" ACTION or",1:"")," ORDER",$S(PSGLMT>1:"S (1-"_PSGLMT,1:" (1"),"): " R X:DTIME W:'$T $C(7) S:'$T X="^" I X["^" K ACTION S X="^" Q
"RTN","PSGON",28,0)
 I X="" K ACTION Q
"RTN","PSGON",29,0)
 I X="DC",ACTION,PSGONC W "  (DISCONTINUE)" S X="D" Q
"RTN","PSGON",30,0)
 I X="DC" W $C(7),"  ??" G RD1
"RTN","PSGON",31,0)
 I $P("DISCONTINUE",X)="",ACTION,PSGONC W $P("DISCONTINUE",X,2) S X="D" Q
"RTN","PSGON",32,0)
 I $P("DISCONTINUE",X)="" W $C(7),"  ??" G RD1
"RTN","PSGON",33,0)
 I $P("RENEW",X)="",ACTION,PSGONR W $P("RENEW",X,2) S X="R" Q
"RTN","PSGON",34,0)
 I $P("RENEW",X)="" W $C(7),"  ??" G RD1
"RTN","PSGON",35,0)
 I $P("VERIFY",X)="",ACTION,PSGONV W $P("VERIFY",X,2) S X="V" Q
"RTN","PSGON",36,0)
 I $P("VERIFY",X)="" W $C(7),"  ??" G RD1
"RTN","PSGON",37,0)
 I $P("FINISH",X)="",ACTION,$G(PSGONF) W $P("FINISH",X,2) S X="F" Q
"RTN","PSGON",38,0)
 I $P("FINISH",X)="" W $C(7)," ??" G RD1
"RTN","PSGON",39,0)
 I $S(X="ALL":1,X["-":1,1:X) D ENCHK Q:$D(X)  W $C(7),"  ??" G RD1
"RTN","PSGON",40,0)
 I X?1."?" D H1 G RD1
"RTN","PSGON",41,0)
 W $C(7),"  ??" G RD1
"RTN","PSGON",42,0)
 ;
"RTN","PSGON",43,0)
H1 ;
"RTN","PSGON",44,0)
 D FULL^VALM1 W !!?2 I ACTION  D
"RTN","PSGON",45,0)
 .W "Select ACTION to take on order",$E("s",PSGONR>1!(PSGONC>1)!(PSGONV>1)!($G(PSGONF)>1)),!,". Select -",! W:PSGONC ?9,"D for DISCONTINUE",! W:PSGONR ?9,"R for RENEW",! W:PSGONV ?9,"V for VERIFY",! W:$G(PSGONF) ?9,"F for FINISH",!
"RTN","PSGON",46,0)
 W !,"Select ORDER",$S(PSGLMT>1:"S (1-"_PSGLMT,1:" (1"),") to view",$S('$D(PSGPRF):" and/or on which to take action",1:""),"." D:X?2."?" H2
"RTN","PSGON",47,0)
 N DIR S DIR(0)="E" D ^DIR I $D(VALM("LINES")) D RE^VALM4
"RTN","PSGON",48,0)
 Q
"RTN","PSGON",49,0)
 ;
"RTN","PSGON",50,0)
ENWO ; which orders
"RTN","PSGON",51,0)
 S PSGLMT=$S(PSGONW="R":PSGONR,PSGONW="V":PSGONV,1:PSGONC)
"RTN","PSGON",52,0)
RDW ;
"RTN","PSGON",53,0)
 W !!,$S(PSGONW="V":"VERIFY which orders",PSGONW="R":$S($P(PSJSYSP0,"^",3):"RENEW which orders",1:"MARK which orders for RENEWAL"),1:$S($P(PSJSYSP0,"^",5):"DISCONTINUE which orders",1:"MARK which orders for DISCONTINUATION"))," (1-",PSGLMT,"): "
"RTN","PSGON",54,0)
 R X:DTIME W:'$T $C(7) S:'$T X="^" I "^"[X Q
"RTN","PSGON",55,0)
 I X?1."?" W !!?2,"Select order",$E("s",PSGLMT>1)," to ",$S(PSGONW="V":"verify",PSGONW="R":$S($P(PSJSYSP0,"^",3):"renew.",1:"mark for renewal."),1:$S($P(PSJSYSP0,"^",5):"discontinue.",1:"mark for discontinuation.")) D:X?2."?" H2 G RDW
"RTN","PSGON",56,0)
 D ENCHK I '$D(X) W $C(7),"  ??" G RDW
"RTN","PSGON",57,0)
 Q
"RTN","PSGON",58,0)
 ;
"RTN","PSGON",59,0)
H2 ;
"RTN","PSGON",60,0)
 N X S X=$S($D(PSGEFN):"field",1:"order") W !!?2,"Select ",X,"s either singularly separated by commas (1,2,3), by a range of",!,X,"s separated by a dash (1-3), or a combination (1,2,4-6).  To select all"
"RTN","PSGON",61,0)
 W !,X,"s, enter 'ALL' or a dash ('-').  You can also enter '-n' to select the"
"RTN","PSGON",62,0)
 W !,"first ",X," through the 'nth' ",X," or enter 'n-' to select the 'nth' ",X,!,"through the last ",X,".  If an ",X," is selected more than once, only the first",!,"selection is used (Entering '1,2,1' would return '1,2'.)."
"RTN","PSGON",63,0)
 W:$D(PSGEFN) !!,?2,"Fields numbers are as follows:"
"RTN","PSGON",64,0)
 I '$D(P("PON")) D
"RTN","PSGON",65,0)
 .Q:'$D(PSGEFN)
"RTN","PSGON",66,0)
 .N PS S PS=$S($G(PSJORD)["P":1,$G(PSJORD)["U":2,1:2)
"RTN","PSGON",67,0)
 .W !?3,"*(1) Orderable Item",!,?3,$S(PS=1:" ",PS=2:"*"),"(2) Dosage Ordered"
"RTN","PSGON",68,0)
 .W !?3,$S(PS=1:" ",PS=2:"*"),"(3) Start",!?3,"*(4) Med Route",!?3,$S(PS=1:" ",PS=2:"*"),"(5) Stop"
"RTN","PSGON",69,0)
 .W !?3," (6) Schedule Type",!?3," (7) Self Med",!?3,"*(8) Schedule"
"RTN","PSGON",70,0)
 .W !?3," (9) Admin Times",!?3,"*(10) Provider",!?3," (11) Special "
"RTN","PSGON",71,0)
 .W "Instructions",!?3," (12) Dispense Drug"
"RTN","PSGON",72,0)
 E  D
"RTN","PSGON",73,0)
 .Q:'$D(PSGEFN)
"RTN","PSGON",74,0)
 .N PS S PS=$S($G(PSJORD)["P":1,$G(PSJORD)["V":2,1:2)
"RTN","PSGON",75,0)
 .W !?3,$S($G(P("OT"))="F":"*",PS=1:" ",PS=2:"*"),"(1) Additives",!?3,$S($G(P("OT"))="F":"*",P(4)="P":" ",PS=1:" ",PS=2:"*"),"(2) Solutions",!?3,$S(P(4)="P":" ",PS=1:" ",PS=2:"*"),"(3) Infusion Rate"
"RTN","PSGON",76,0)
 .W !?3,$S(PS=1:" ",PS=2:"*"),"(4) Start",!?3,"*(5) Med Route",!?3,$S(PS=1:" ",PS=2:"*"),"(6) Stop"
"RTN","PSGON",77,0)
 .W !?3,"*(7) Schedule",!?3," (8) Admin Times",!?3,"*(9) Provider"
"RTN","PSGON",78,0)
 .I $G(P(4))="P"!($G(P("DTYP"))=0) D
"RTN","PSGON",79,0)
 ..W !?3,"*(10) Orderable Item",!?3," (11) Other Print",!?3," (12) Remarks"
"RTN","PSGON",80,0)
 .E  W !?3," (10) Other Print",!?3," (11) Remarks"
"RTN","PSGON",81,0)
 W ! K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGON",82,0)
 Q
"RTN","PSGON",83,0)
 ;
"RTN","PSGON",84,0)
ENEFA ;
"RTN","PSGON",85,0)
 N Q,X1,X2 I '$D(PSGEFN) K Y S Y="" Q
"RTN","PSGON",86,0)
 ;
"RTN","PSGON",87,0)
EFA ;
"RTN","PSGON",88,0)
 K Y S Y="" R !!,"Select FIELDS TO EDIT: ",X:DTIME E  W $C(7) S X="^" Q
"RTN","PSGON",89,0)
 I "^"[X Q
"RTN","PSGON",90,0)
 ;I X?1."?" D:$D(P("PON")) H2,@("DISPLAY^PSJLIFN") D:'$D(P("PON")) FULL^VALM1,EFH G EFA
"RTN","PSGON",91,0)
 I X="??"&('$D(P("PON"))) D FULL^VALM1,H2 G EFA
"RTN","PSGON",92,0)
 I X?1."?" D FULL^VALM1 D:'$D(P("PON")) EFH D:$D(P("PON")) H2,@("DISPLAY^PSJLIFN") G EFA
"RTN","PSGON",93,0)
 ;* I X?1."?" D EFH D:X?2."?" H2,READ^PSJUTL,@($S('$D(PSJDTYP):"ENW^PSGOEEW",PSJDTYP="OU":"ENW^PSJOEEW",PSJDTYP="O":"^PSIVORV1",1:"EN^PSIVORV2")) G EFA
"RTN","PSGON",94,0)
 I X="-"!($P("ALL",X)="") W $S(X="-":"  (ALL)",1:$P("ALL",X,2)) F Q=0:0 S Q=$O(PSGEFN(Q)) Q:'Q  S Y=Y_Q_","
"RTN","PSGON",95,0)
 I  G FDONE
"RTN","PSGON",96,0)
 S:$E(X)="-" X=+PSGEFN_X S:$E($L(X))="-" X=X_$P(PSGEFN,":",2)
"RTN","PSGON",97,0)
 F Q=1:1:$L(X,",") S X1=$P(X,",",Q) D FS Q:'$D(X)
"RTN","PSGON",98,0)
 I '$D(X) W $C(7),"  ??" G EFA
"RTN","PSGON",99,0)
 ;
"RTN","PSGON",100,0)
FDONE ;
"RTN","PSGON",101,0)
 I '$D(Y) W $C(7)," ??" G EFA
"RTN","PSGON",102,0)
 S:Y Y=$E(Y,1,$L(Y)-1) Q
"RTN","PSGON",103,0)
 ;
"RTN","PSGON",104,0)
FS ;
"RTN","PSGON",105,0)
 I $S(X1?1.N1"-"1.N:0,X1'?1.N:1,'$D(PSGEFN(X1)):1,1:","_Y[X1) K X Q
"RTN","PSGON",106,0)
 I X1'["-" S Y=Y_X1_"," Q
"RTN","PSGON",107,0)
 S X2=+X1,Y=Y_X2_"," F  S X2=$O(PSGEFN(X2)) K:$S(X="":1,","_Y[X2:1,1:X2>$P(X1,"-",2)) Y Q:'$D(Y)  S Y=Y_X2_"," Q:X2=$P(X1,"-",2)
"RTN","PSGON",108,0)
 Q
"RTN","PSGON",109,0)
ENEFA2 ;
"RTN","PSGON",110,0)
 I '$D(PSGEFN) K Y S Y="" Q
"RTN","PSGON",111,0)
 S Y=$P(XQORNOD(0),"=",2)
"RTN","PSGON",112,0)
 ; wasn't handling "0#" correctly, will strip off a leading zero on 1-9
"RTN","PSGON",113,0)
 N Q,X1 F Q=1:1:$L(Y,",") S X1=$P(Y,",",Q) D
"RTN","PSGON",114,0)
 .I X1?1"0"1.2N S $P(Y,",",Q)=+X1
"RTN","PSGON",115,0)
 Q
"RTN","PSGON",116,0)
 ;
"RTN","PSGON",117,0)
EFH ;
"RTN","PSGON",118,0)
 W !!?2,"Select the fields you wish to edit, by number.  Only those fields with a",!,"number to the left of the field name are editable."
"RTN","PSGON",119,0)
 Q
"RTN","PSGOT")
0^19^B26696723
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;Jul 26, 2017@18:04:02
"RTN","PSGOT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**13,68,90,110,173,134,161,254,267,257,315,327**;16 DEC 97;Build 114
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ; Reference to ^PSUHL supported by DBIA 4803.
"RTN","PSGOT",6,0)
 ;
"RTN","PSGOT",7,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",8,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSGOT",9,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",10,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",11,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2)
"RTN","PSGOT",12,0)
 S (ND2P1,^PS(55,PSGP,5,DA,2.1))=$G(^PS(53.1,ODA,2.1)),^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",13,0)
 ;S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),(ND2P1,^PS(55,PSGP,5,DA,2.1))=$G(^PS(53.1,ODA,2.1)) ;*315 DRP
"RTN","PSGOT",14,0)
 S ^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",15,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(PSGP)
"RTN","PSGOT",16,0)
 I $P($G(^PS(55,PSGP,5,DA,2)),"^",6)="" S $P(^PS(55,PSGP,5,DA,2),"^",6)=$S($G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(^PS(53.1,ODA,2),"^",6)=$P(^PS(55,PSGP,5,DA,2),"^",6)
"RTN","PSGOT",17,0)
 F X=6,7,13 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",18,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS") D CIMOU^PSJIMO1(PSGP,DA,"",ODA)
"RTN","PSGOT",19,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",20,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",21,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",22,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",23,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",24,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSGOT",25,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,DA) I $G(CLOZFLG) D
"RTN","PSGOT",26,0)
 .N DIE,DR S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DR="301////"
"RTN","PSGOT",27,0)
 .I $D(^TMP("PSJCOM",$J,ODA,"SAND")) D  K ^TMP("PSJCOM",$J,ODA,"SAND") I 1
"RTN","PSGOT",28,0)
 ..S DR=DR_$G(^TMP("PSJCOM",$J,ODA,"SAND"))
"RTN","PSGOT",29,0)
 .E  I $G(^TMP($J,"PSGCLOZ",PSGP,ODA,"SAND")) D  K ^TMP($J,"PSGCLOZ",PSGP,ODA,"SAND")
"RTN","PSGOT",30,0)
 ..S DR=DR_$G(^TMP($J,"PSGCLOZ",PSGP,ODA,"SAND"))
"RTN","PSGOT",31,0)
 .D ^DIE
"RTN","PSGOT",32,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSGOT",33,0)
 D SETUDINT^PSGSICH1(ODA_"P",DA_"U")
"RTN","PSGOT",34,0)
CR ; set x-refs
"RTN","PSGOT",35,0)
 N A
"RTN","PSGOT",36,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",37,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",38,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",39,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",40,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",41,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",42,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",43,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",44,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOT",45,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",46,0)
 N PSJTMPTX,PSJOVRMX,PSJTMPLIN
"RTN","PSGOT",47,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",48,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",49,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",50,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",51,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",52,0)
 I $D(^PS(53.1,+ODA,15,0)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4) D
"RTN","PSGOT",53,0)
 .N LN,LNCNT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOT",54,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOT",55,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOT",56,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOT",57,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOT",58,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOT",59,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOT",60,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOT",61,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOT",62,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOT",63,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOT",64,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND
"RTN","PSGOT",65,0)
 Q
"RTN","PSGOT",66,0)
 ;
"RTN","PSGPEN")
0^23^B58080181
"RTN","PSGPEN",1,0)
PSGPEN ;BIR/CML3 - FIND DEFAULT FOR PRE-EXCHANGE NEEDS ;15 May 2019 16:15:59
"RTN","PSGPEN",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**30,37,50,58,115,110,127,129,323,317,357,386,327**;16 DEC 97;Build 114
"RTN","PSGPEN",3,0)
 ;
"RTN","PSGPEN",4,0)
 ; References to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSGPEN",5,0)
 ; References to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSGPEN",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPEN",7,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGPEN",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGPEN",9,0)
 ;
"RTN","PSGPEN",10,0)
EN(PSGPENO) ;
"RTN","PSGPEN",11,0)
 S PSGPENO=+PSGPENO
"RTN","PSGPEN",12,0)
 N PSJPADE
"RTN","PSGPEN",13,0)
 S PSJPADE=$$PADE($G(PSJPWD),PSGP,PSGPENO_"U")  ; PADE check - PSJ*5*317
"RTN","PSGPEN",14,0)
 N PSJSITE,PSJPRN,PSJCLO,ND8 S PSJCLO=0,ND8=0 S PSJSITE=0,PSJSITE=$O(^PS(59.7,PSJSITE)) I $P($G(^(PSJSITE,26)),U,5)=1 S PSJPRN=1
"RTN","PSGPEN",15,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPEN="" S ND=$G(^PS(55,PSGP,5,PSGPENO,0)),ND8=$G(^PS(55,PSGP,5,PSGPENO,8))
"RTN","PSGPEN",16,0)
 S:$P(ND8,"^",2) PSJCLO=1
"RTN","PSGPEN",17,0)
 S PSGPENWS=0 I PSJPWD,'PSJCLO F Q=0:0 S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3),($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) S PSGPENWS=1 Q
"RTN","PSGPEN",18,0)
 I PSGPENWS F Q=0:0 S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S:'$D(^PSI(58.1,"D",+ND,PSJPWD))&'$D(^PSD(58.8,"D",+ND,PSJPWD)) PSGPENWS=0 Q:'PSGPENWS  S $P(PSGPENWS,"^",2)=1
"RTN","PSGPEN",19,0)
 I PSJPADE&'PSGPENWS W !!,"The dispense drug",$S(PSJPADE>1:"s",1:"")," for this order ",$S(PSJPADE>1:"are",1:"is a")," PADE item",$S(PSJPADE>1:"s",1:""),"." S PSGPEN=0
"RTN","PSGPEN",20,0)
 I PSJPADE&PSGPENWS W !!,"The dispense drug",$S(PSJPADE>1:"s",1:"")," for this order ",$S(PSJPADE>1:"are",1:"is a")," WARD STOCK/PADE item",$S(PSJPADE>1:"s",1:""),"." S PSGPEN=0
"RTN","PSGPEN",21,0)
 I PSGPENWS&'PSJPADE W !!,"The dispense drug",$E("s",$P(PSGPENWS,"^",2))," for this order ",$S($P(PSGPENWS,"^",2):"are",1:"is a")," WARD STOCK item",$E("s",$P(PSGPENWS,"^",2)),"." S PSGPEN=0
"RTN","PSGPEN",22,0)
 I '$G(PSJCLO),'PSGPENWS,PSJPWD,'PSJPADE S WG=+$O(^PS(57.5,"AB",PSJPWD,0)),PSGPLS=$P($G(^PS(55,PSGP,5,PSGPENO,2)),"^",2) I PSGPLS D
"RTN","PSGPEN",23,0)
 .S PSGPLF=$O(^PS(53.5,"AB",WG,PSGDT))
"RTN","PSGPEN",24,0)
 .N RNDT,PSJRNOS S RNDT=$$LASTREN^PSJLMPRI(PSGP,$S($G(PSJORD)["P":PSJORD,1:"")),PSJRNOS=$P(RNDT,"^",4) I PSJRNOS,'$G(PSJREN) S PSGPLS=PSJRNOS
"RTN","PSGPEN",25,0)
 .I $G(PSJREN),$G(PSJORD)["U" S PSJRNOS=$P(^PS(55,PSGP,5,+PSJORD,2),"^",4) S PSGPLS=$S(PSJRNOS>PSGDT:PSJRNOS,1:$$DATE2^PSJUTL2(PSGDT))
"RTN","PSGPEN",26,0)
 .D:'PSGPLF GF I PSGPLF S PSGPLO=PSGPENO D NCE,^PSGPL0 S:PSGPLC'<0 PSGPEN=PSGPLC
"RTN","PSGPEN",27,0)
 I $G(PSGPRIO)="DONE" S PSGPEN=0
"RTN","PSGPEN",28,0)
 ;
"RTN","PSGPEN",29,0)
UPDD ;
"RTN","PSGPEN",30,0)
 N DIR S DIR(0)="NOA^0:9999:0",DIR("A")="Pre-Exchange DOSES: ",DIR("?")="^D DH^PSGPEN" S:PSGPEN]"" DIR("B")=PSGPEN W ! D ^DIR G:'Y DONE S PSGY=+Y W !!,"...updating dispense drug(s)..."
"RTN","PSGPEN",31,0)
 F FQ=0:0 S FQ=$O(^PS(55,PSGP,5,PSGPENO,1,FQ)) Q:'FQ  S ND=$G(^(FQ,0)),$P(^(0),"^",9)="" I ND,'$P(ND,"^",3) D DD
"RTN","PSGPEN",32,0)
 ;
"RTN","PSGPEN",33,0)
DONE ;
"RTN","PSGPEN",34,0)
 I $P(PSJSYSW0,"^",29)="",$$DEFON^PSGPER1 S $P(PSJSYSW0,"^",29)=0
"RTN","PSGPEN",35,0)
 K PSGID,PSGMAR,PSGOD,PSGPLC,PSGPLF,PSGPLO,PSGPLS,PSGPLUD,WG S:$G(PSJREN) DUOUT=0 Q
"RTN","PSGPEN",36,0)
 ;
"RTN","PSGPEN",37,0)
NCE ;
"RTN","PSGPEN",38,0)
 W !!,"The next cart exchange is ",$$ENDTC^PSGMI(PSGPLF),! Q
"RTN","PSGPEN",39,0)
 ;
"RTN","PSGPEN",40,0)
GF ;
"RTN","PSGPEN",41,0)
 S QQ=0 F Q=0:0 S Q=$O(^PS(53.5,"AB",WG,Q)) Q:'Q  S QQ=Q
"RTN","PSGPEN",42,0)
 I QQ S QQ=$O(^PS(53.5,"AB",WG,QQ,0)) I QQ,$D(^PS(53.5,QQ,0)) S QQ=$P(^(0),"^",4) I QQ>PSGDT S PSGPLF=QQ
"RTN","PSGPEN",43,0)
 Q
"RTN","PSGPEN",44,0)
 ;
"RTN","PSGPEN",45,0)
DD ;
"RTN","PSGPEN",46,0)
 N DA S DRG=$S($P(ND,"^")="":"NOT FOUND",'$D(^PSDRUG(+ND,0)):"NOT FOUND ("_$P(ND,"^")_")",$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^")_";PSDRUG("),UD=$S('$P(ND,"^",2):1,1:$P(ND,"^",2))
"RTN","PSGPEN",47,0)
 W !,"...",DRG,?45,"U/D: ",UD,"..."
"RTN","PSGPEN",48,0)
 S PSGDA=PSGY I 'PSGPENWS,'$G(PSJCLO),ND,PSJPWD,($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) D PSGPENWS Q:'PSGDA
"RTN","PSGPEN",49,0)
 K DA,DR S PSGDA=$S(UD#1:(PSGDA*((UD\1)+1)),1:PSGDA*UD)
"RTN","PSGPEN",50,0)
 S DIE="^PS(55,"_PSGP_",5,"_PSGPENO_",1,",DA(2)=PSGP,DA(1)=PSGPENO,DA=FQ,DR=".09////"_PSGDA D ^DIE
"RTN","PSGPEN",51,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSGPEN",52,0)
 D:'PSGPXN
"RTN","PSGPEN",53,0)
 .D NOW^%DTC L +^PS(53.4,0):0 S ND=$G(^PS(53.4,0)) S:ND="" ND="PRE-EXCHANGE NEEDS^53.4P" F PSGPXN=$P(ND,"^",3)+1:1 I '$D(^PS(53.4,PSGPXN)) L +^PS(53.4,PSGPXN):0 I  S ^PS(53.4,0)=$P(ND,"^",1,2)_"^"_PSGPXN_"^"_($P(ND,"^",4)+1) L -^PS(53.4,0) Q
"RTN","PSGPEN",54,0)
 .S ^PS(53.4,PSGPXN,0)=DUZ_"^"_%,^PS(53.4,"B",DUZ,PSGPXN)="",^PS(53.4,"AUD",DUZ,%,PSGPXN)="" L -^PS(53.4,PSGPXN) Q
"RTN","PSGPEN",55,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,FQ,0)) S $P(^(0),"^",2)=$P(^(0),"^",2)+PSGDA Q
"RTN","PSGPEN",56,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",57,0)
 S ^(0)=FQ_"^"_PSGDA I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,0)) S $P(^(0),"^",3,4)=FQ_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",58,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",59,0)
 S ^(0)="^53.401101A^"_FQ_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,0))  S ^(0)=PSGPENO
"RTN","PSGPEN",60,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,0)) S $P(^(0),"^",3,4)=PSGPENO_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",61,0)
 ; naked reference below is from line above
"RTN","PSGPEN",62,0)
 S ^(0)="^53.4011A^"_PSGPENO_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,0))  S ^(0)=PSGP
"RTN","PSGPEN",63,0)
 I $D(^PS(53.4,PSGPXN,1,0)) S $P(^(0),"^",3,4)=PSGP_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",64,0)
 ; naked reference below is from line above
"RTN","PSGPEN",65,0)
 S ^(0)="^53.401PA^"_PSGP_"^1" Q
"RTN","PSGPEN",66,0)
 ;
"RTN","PSGPEN",67,0)
DH ;
"RTN","PSGPEN",68,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits."
"RTN","PSGPEN",69,0)
 W !!?2,"Enter the number of DOSES needed for this order until the next cart exchange.",!,"This will be the number of times the order will be administered to the patient",!,"from the start of the order until the next cart exchange."
"RTN","PSGPEN",70,0)
 W !!?2,"PLEASE NOTE that this is DOSES, and NOT UNITS.  The doses entered will be",!,"converted to units for each dispense drug of this order, as each dispense drug",!,"may have different units per dose." Q
"RTN","PSGPEN",71,0)
 ;
"RTN","PSGPEN",72,0)
PSGPENWS ;
"RTN","PSGPEN",73,0)
 W !,"This dispense drug is a WARD STOCK item."
"RTN","PSGPEN",74,0)
 W !,"Would you like to:",!?3,"1 - Enter 0 (no) doses needed for this dispense drug.",!?3,"2 - Enter ",PSGDA," doses needed for this dispense drug.",!?3,"3 - Enter another amount as the doses needed for this dispense drug."
"RTN","PSGPEN",75,0)
 K DIR S DIR(0)="SA^1:0 (no) doses;2:"_PSGDA_" doses;3:another amount",DIR("A")="Select ACTION: ",DIR("?")="^D WH^PSGPEN" W ! D ^DIR I Y=1!'Y S PSGDA=0 Q
"RTN","PSGPEN",76,0)
 Q:Y=2  K DIR S DIR(0)="NA^0:9999:0",DIR("A")="Pre-Exchange DOSES for this dispense drug: ",DIR("?")="^D WDH^PSGPEN" W ! D ^DIR S PSGDA=+Y Q
"RTN","PSGPEN",77,0)
 ;
"RTN","PSGPEN",78,0)
WH ;
"RTN","PSGPEN",79,0)
 S Q="This dispense drug ("_DRG_") is a ward stock item.  Select:"
"RTN","PSGPEN",80,0)
 W !! F Q1=1:1:$L(Q," ") S Q2=$P(Q," ",Q1) W:$X+$L(Q2)>78 ! W Q2," "
"RTN","PSGPEN",81,0)
 W !?3,"1 to enter 0 (no) pre-exchange doses for this dispense drug.",!?3,"2 to enter ",PSGDA," doses for this dispense drug.",!?3,"3 to enter another amount for this dispense drug." Q
"RTN","PSGPEN",82,0)
 ;
"RTN","PSGPEN",83,0)
WDH ;
"RTN","PSGPEN",84,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits.  If you enter an '^' to exit",!,"NO pre-exchange doses will be entered for this dispense drug." Q
"RTN","PSGPEN",85,0)
 ;
"RTN","PSGPEN",86,0)
PADE(PSJPWD,PSGP,PSGORD)  ; Pharmacy Automation Dispensing Equipment (PADE) check - PSJ*5*317
"RTN","PSGPEN",87,0)
 ; INPUT: PSJPWD = Ward location
"RTN","PSGPEN",88,0)
 ;        PSGP   = Patient DFN
"RTN","PSGPEN",89,0)
 ;        PSGORD = Order number
"RTN","PSGPEN",90,0)
 ; OUTPUT: PADE = Can this order be dispensed via PADE?
"RTN","PSGPEN",91,0)
 ;
"RTN","PSGPEN",92,0)
 N PADE,DFN,PSJDDND,PSJWDFLG
"RTN","PSGPEN",93,0)
 I '$G(PSJPWD)!'$G(PSGP)!'$G(PSGORD) Q ""
"RTN","PSGPEN",94,0)
 S PADE="",DFN=$G(PSGP)
"RTN","PSGPEN",95,0)
 ; Check DEFAULT 0 ON PADE PRE-EXCHANGE parameter
"RTN","PSGPEN",96,0)
 D GETS^DIQ(59.6,+$G(PSJSYSW),8,"I","PSJWDFLG")
"RTN","PSGPEN",97,0)
 I $G(PSJWDFLG("59.6",+$G(PSJSYSW)_",",8,"I")) D
"RTN","PSGPEN",98,0)
 .N PSJPDLOC,PSJORCL,PSJCLNK
"RTN","PSGPEN",99,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGPEN",100,0)
 .S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGPEN",101,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGPEN",102,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(PSJPWD)   ; Quit if patient location not linked to PADE
"RTN","PSGPEN",103,0)
 .S PSJPDLOC=$S($G(PSGORD)["P":+$G(^PS(53.1,+PSGORD,"DSS"))_"C",$G(PSGORD)["U":+$G(^PS(55,+$G(DFN),5,+$G(PSGORD),8))_"C",1:"")
"RTN","PSGPEN",104,0)
 .S:'PSJPDLOC PSJPDLOC=+$G(PSJPWD)
"RTN","PSGPEN",105,0)
 .N PADEFLAG,DDCNT S PADEFLAG=1
"RTN","PSGPEN",106,0)
 .I $G(PSGORD)["U" S Q=0 F DDCNT=0:1 S Q=$O(^PS(55,+$G(PSGP),5,+PSGORD,1,Q)) Q:'Q!'PADEFLAG  S PSJDDND=$G(^(Q,0)) D
"RTN","PSGPEN",107,0)
 ..S PADEFLAG=+$$DRGQTY^PSJPADSI(+PSJDDND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC)
"RTN","PSGPEN",108,0)
 .I $G(PSGORD)'["U" S Q=0 F DDCNT=0:1 S Q=$O(^PS(53.45,+$G(PSJSYSP),2,Q)) Q:'Q!'PADEFLAG  S PSJDDND=$G(^(Q,0)) D
"RTN","PSGPEN",109,0)
 ..S PADEFLAG=+$$DRGQTY^PSJPADSI(+PSJDDND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC)
"RTN","PSGPEN",110,0)
 .I DDCNT,PADEFLAG S PADE=DDCNT
"RTN","PSGPEN",111,0)
 Q PADE
"RTN","PSGPEN",112,0)
 ;
"RTN","PSJ327P")
0^38^B688619
"RTN","PSJ327P",1,0)
PSJ327P ; NCC/MIR - NCC POST INSTALL;10 May 2019 16:19:28
"RTN","PSJ327P",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**327**;01 DEC 15;Build 114
"RTN","PSJ327P",3,0)
 ;
"RTN","PSJ327P",4,0)
ADDMENUS ; Add new menu items to the main one
"RTN","PSJ327P",5,0)
 N RES
"RTN","PSJ327P",6,0)
 S RES=$$ADD^XPDMENU("PSJL MANAGER","PSOL REGISTER PATIENT","",1)
"RTN","PSJ327P",7,0)
 S RES=$$ADD^XPDMENU("PSJL MANAGER","PSJLAB LIST","",2)
"RTN","PSJ327P",8,0)
 S RES=$$ADD^XPDMENU("PSJL MANAGER","PSJLIST OVERRIDES","",3)
"RTN","PSJ327P",9,0)
 S RES=$$ADD^XPDMENU("PSJL MANAGER","PSOL EDIT","",4)
"RTN","PSJ327P",10,0)
 ;
"RTN","PSJ327P",11,0)
 S RES=$$ADD^XPDMENU("PSJU MGR","PSJL MANAGER","",2.98)
"RTN","PSJ327P",12,0)
 Q
"RTN","PSJCLOLS")
0^8^B10135228
"RTN","PSJCLOLS",1,0)
PSJCLOLS ;ALB/RTW - LIST INPATIENT CLOZAPINE ORDERS ENTERED BY OVERRIDE ; 8/30/18 3:20pm
"RTN","PSJCLOLS",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**327**;;Build 114
"RTN","PSJCLOLS",3,0)
 ;RTW copied from routine PSOCLOLS and modified for the NCC Clozapine inpatient pharmacy project
"RTN","PSJCLOLS",4,0)
 W !,"Print list of clozapine orders overriding lockout",!
"RTN","PSJCLOLS",5,0)
DATE S %DT="EAX",%DT("A")="Beginning date : " D ^%DT G EXIT:Y<0 S PSOBD=Y
"RTN","PSJCLOLS",6,0)
 S %DT("A")="Ending date : " D ^%DT G EXIT:Y<0 S PSOED=Y+.3 I PSOED<PSOBD W !!,"Ending date must be after beginning date" G DATE
"RTN","PSJCLOLS",7,0)
DEV S %ZIS("B")="",%ZIS="MQ" D ^%ZIS G EXIT:POP ;I $E(IOST)'="P" W !,"Select a printer " G DEV
"RTN","PSJCLOLS",8,0)
 I $D(IO("Q")) G QUE
"RTN","PSJCLOLS",9,0)
DQ ;Entry to report
"RTN","PSJCLOLS",10,0)
 K ^TMP($J,"PSJORDT") D LIST^DIC(53.8,,.01,"I",,PSOBD,,"B",,,"^TMP($J,""PSJORDT"")")
"RTN","PSJCLOLS",11,0)
 W:$Y @IOF D HD I '^TMP($J,"PSJORDT","DILIST",0) W !,?5,"NO ORDERS FOUND",@IOF G EXIT
"RTN","PSJCLOLS",12,0)
 I ^TMP($J,"PSJORDT","DILIST",1,1)>PSOED W !,?5,"NO ORDERS FOUND",@IOF G EXIT
"RTN","PSJCLOLS",13,0)
 F I=1:1 Q:'$D(^TMP($J,"PSJORDT","DILIST",1,I))  S PSJOD=^TMP($J,"PSJORDT","DILIST",1,I) Q:PSJOD>PSOED  D
"RTN","PSJCLOLS",14,0)
 .S PSOI=+^TMP($J,"PSJORDT","DILIST",2,I)
"RTN","PSJCLOLS",15,0)
 .D GETS^DIQ(53.8,PSOI,"*","I","PSJDATA") S PSOJ=PSOI_"," D:$D(PSJDATA) PRINT
"RTN","PSJCLOLS",16,0)
 W @IOF
"RTN","PSJCLOLS",17,0)
EXIT D ^%ZISC K %DT,PSJDRG,POP,PSJOD,PSOI,PSOJ,PSJDATA,PSJRX,PSJUSR,PSJAPR,PSJREA,PSJCOM,PSJPAT,PSOBD,PSOED,X,J,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSJCLOLS",18,0)
 K ^TMP($J,"PSJORDT") Q
"RTN","PSJCLOLS",19,0)
 ;
"RTN","PSJCLOLS",20,0)
PRINT I $Y+9>IOSL W @IOF D HD
"RTN","PSJCLOLS",21,0)
 I '$D(PSJDATA(53.8,PSOJ,1))!'$D(PSJDATA(53.8,PSOJ,2))!'$D(PSJDATA(53.8,PSOJ,3))!'$D(PSJDATA(53.8,PSOJ,4)) Q
"RTN","PSJCLOLS",22,0)
 S PSJORD=+PSJDATA(53.8,PSOJ,1,"I"),PSJUSR=PSJDATA(53.8,PSOJ,2,"I")
"RTN","PSJCLOLS",23,0)
 S PSJAPR=PSJDATA(53.8,PSOJ,3,"I"),PSJREA=PSJDATA(53.8,PSOJ,4,"I")
"RTN","PSJCLOLS",24,0)
 S PSJUSR=$$GET1^DIQ(200,PSJUSR,.01),PSJAPR=$$GET1^DIQ(200,PSJAPR,.01)
"RTN","PSJCLOLS",25,0)
 S PSJCOM=PSJDATA(53.8,PSOJ,5,"I")
"RTN","PSJCLOLS",26,0)
 S PSJNUM=$$FIND1^DIC(100.045,","_PSJORD_",","X","DRUG","ID")
"RTN","PSJCLOLS",27,0)
 S PSJDRG=$$GET1^DIQ(100.045,PSJNUM_","_PSJORD,1) Q:'$D(PSJDRG)
"RTN","PSJCLOLS",28,0)
 S PSJPAT=$$GET1^DIQ(100,PSJORD,.02),PSJDRG=$$GET1^DIQ(50,PSJDRG,.01)
"RTN","PSJCLOLS",29,0)
 W !,?3,"Date : ",$E(PSJOD,4,5),"/",$E(PSJOD,6,7),"/",$E(PSJOD,2,3),?25,"ORDER # : ",PSJORD,?45,"Patient : ",PSJPAT
"RTN","PSJCLOLS",30,0)
 W !,?3,"DRUG : ",PSJDRG
"RTN","PSJCLOLS",31,0)
 W !,?3,"Entered by : ",PSJUSR,!,?3,"Approved by : ",PSJAPR
"RTN","PSJCLOLS",32,0)
 W !,?3,"Lockout Reason : ",$$GET1^DIQ(52.54,PSJREA,.01)
"RTN","PSJCLOLS",33,0)
 W !,?3,"Comments : " I $L(PSJCOM)<65 W PSJCOM,!! Q
"RTN","PSJCLOLS",34,0)
 F J=1:1 Q:$P(PSJCOM," ",J,9999)=""  S X=$P(PSJCOM," ",J) W:$L(X)+$X>70 !,?14 W X," "
"RTN","PSJCLOLS",35,0)
 W !! Q
"RTN","PSJCLOLS",36,0)
HD U IO W !!,?5,"LIST OF ORDERS WRITTEN FOR CLOZAPINE OVERRIDING LOCKOUT",!,?10,"FOR THE DATE RANGE ",$E(PSOBD,4,5),"/",$E(PSOBD,6,7),"/",$E(PSOBD,2,3)," THROUGH ",$E(PSOED,4,5),"/",$E(PSOED,6,7),"/",$E(PSOED,2,3),! Q
"RTN","PSJCLOLS",37,0)
 ;
"RTN","PSJCLOLS",38,0)
QUE ;queue job
"RTN","PSJCLOLS",39,0)
 S ZTRTN="DQ^PSJCLOLS",ZTDESC="CLOZAPINE LIST",ZTSAVE("PSOBD")="",ZTSAVE("PSOED")="" D ^%ZTLOAD G EXIT
"RTN","PSJCLOZ")
0^3^B192160082
"RTN","PSJCLOZ",1,0)
PSJCLOZ ; DAL/RJS - INPATIENT CLOZAPINE ORDER CHECK ;12 June 2019 11:36:51
"RTN","PSJCLOZ",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**327**;01 DEC 15;Build 114
"RTN","PSJCLOZ",3,0)
 ;
"RTN","PSJCLOZ",4,0)
CLOZ(DFN,DRUG) ;
"RTN","PSJCLOZ",5,0)
 ; DFN is patient IEN, DRUG is drug file (#50) IEN
"RTN","PSJCLOZ",6,0)
 I '($G(DFN)>0)!'($G(DRUG)>0) S ANQX=0 Q
"RTN","PSJCLOZ",7,0)
 D PROVCHK($G(PSGPR)) Q:ANQX
"RTN","PSJCLOZ",8,0)
 N RTN
"RTN","PSJCLOZ",9,0)
 S RTN=$$GET1^DIQ(50,DRUG,17.5)
"RTN","PSJCLOZ",10,0)
 D:$L(RTN) ^@RTN
"RTN","PSJCLOZ",11,0)
 Q
"RTN","PSJCLOZ",12,0)
 ;
"RTN","PSJCLOZ",13,0)
PROVCHK(PROV) ;
"RTN","PSJCLOZ",14,0)
 N PSJQUIT
"RTN","PSJCLOZ",15,0)
 ;
"RTN","PSJCLOZ",16,0)
 S (ANQX,PSJQUIT)=0
"RTN","PSJCLOZ",17,0)
 I $G(PROV) D
"RTN","PSJCLOZ",18,0)
 .I '$L($$DEA^XUSER(,PROV)) D
"RTN","PSJCLOZ",19,0)
 ..S (ANQX,PSJQUIT)=1
"RTN","PSJCLOZ",20,0)
 ..W !," ",!,"*** Provider must have a DEA# or VA# to write prescriptions for this drug."
"RTN","PSJCLOZ",21,0)
 . Q:PSJQUIT
"RTN","PSJCLOZ",22,0)
 .I '$$FIND1^DIC(200.051,","_PROV_",","X","YSCL AUTHORIZED") D
"RTN","PSJCLOZ",23,0)
 ..S (ANQX,PSJQUIT)=1
"RTN","PSJCLOZ",24,0)
 ..W !," ",!,$$CLKEYWRN^PSOCLUTL
"RTN","PSJCLOZ",25,0)
 Q
"RTN","PSJCLOZ",26,0)
BEFQUIT ;
"RTN","PSJCLOZ",27,0)
 Q:'$G(QOAA)
"RTN","PSJCLOZ",28,0)
 N QODS,QORF,ORMAX,ORCLPAT
"RTN","PSJCLOZ",29,0)
 S QODS=$$FIND1^DIC(101.41,,"X","OR GTX DAYS SUPPLY","AB") Q:'QODS
"RTN","PSJCLOZ",30,0)
 S QODS=$$FIND1^DIC(101.416,","_ORX_",","Q",QODS,"D") Q:'QODS
"RTN","PSJCLOZ",31,0)
 S QODS=$$GET1^DIQ(101.416,QODS_","_ORX,.01)
"RTN","PSJCLOZ",32,0)
 S QORF=$$FIND1^DIC(101.41,,"X","OR GTX REFILLS","AB") Q:'QORF
"RTN","PSJCLOZ",33,0)
 S QORF=$$FIND1^DIC(101.416,","_ORX_",","Q",QORF,"D") Q:'QORF
"RTN","PSJCLOZ",34,0)
 S QORF=$$GET1^DIQ(101.416,QORF_","_ORX,.01)
"RTN","PSJCLOZ",35,0)
 S QORF=QORF+1
"RTN","PSJCLOZ",36,0)
 S ORCLPAT=$P(ORYS,U,7)
"RTN","PSJCLOZ",37,0)
 S ORMAX=$S(ORCLPAT="M":28,ORCLPAT="B":14,ORCLPAT="W":7,1:90)
"RTN","PSJCLOZ",38,0)
 I QORF*QODS>ORMAX D
"RTN","PSJCLOZ",39,0)
 .K ORY
"RTN","PSJCLOZ",40,0)
 .S ORY=1_U_ORCLOZ
"RTN","PSJCLOZ",41,0)
 .W !,?5,"Problem Ordering Clozapine Related Medication"_U_ORCLOZ
"RTN","PSJCLOZ",42,0)
 .W !,?5,"*** This patient is only allowed an order with a maximum Days Supply of "_ORMAX_"."
"RTN","PSJCLOZ",43,0)
 .W !,?5,"This includes the amounts added by any refills entered in with the order also."
"RTN","PSJCLOZ",44,0)
 Q
"RTN","PSJCLOZ",45,0)
OVERRIDE ;
"RTN","PSJCLOZ",46,0)
 I '$$FIND1^DIC(200.051,","_PROV_",","X","PSOLOCKCLOZ") D  Q 1
"RTN","PSJCLOZ",47,0)
 .N Y
"RTN","PSJCLOZ",48,0)
 .W !," ",!,"     *** You are not authorized to override Clozapine orders.",!," "
"RTN","PSJCLOZ",49,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSJCLOZ",50,0)
 Q
"RTN","PSJCLOZ",51,0)
PSJFILE(DFN) ;
"RTN","PSJCLOZ",52,0)
 S PSJCLPAT=DFN
"RTN","PSJCLOZ",53,0)
 N PSJORN,PSJORDER I $G(PSJCOM) D  Q
"RTN","PSJCLOZ",54,0)
 .I $G(PSGODA),$O(^TMP("PSJCOM",$J,PSGODA))'="" Q   ; Put into the file 53.8 just at the end
"RTN","PSJCLOZ",55,0)
 .N PSJORD1 S PSJORD1=""
"RTN","PSJCLOZ",56,0)
 .F  S PSJORD1=$O(^TMP("PSJCOM",$J,PSJORD1)) Q:'PSJORD1  D
"RTN","PSJCLOZ",57,0)
 ..S ANQDATA=$G(^TMP("PSJCOM",$J,PSJORD1,"ANQDATA")) Q:'$L(ANQDATA)
"RTN","PSJCLOZ",58,0)
 ..S PSJORN=+$P(^TMP("PSJCOM",$J,PSJORD1,0),"^",21)
"RTN","PSJCLOZ",59,0)
 ..D PSJFILE1
"RTN","PSJCLOZ",60,0)
PSJFILE1 ;
"RTN","PSJCLOZ",61,0)
 I $D(ANQDATA) D
"RTN","PSJCLOZ",62,0)
 .F  D NOW^%DTC I '$D(^PS(53.8,"B",%)) S NOW=% Q
"RTN","PSJCLOZ",63,0)
 .S PSJPROV=$P(ANQDATA,"^",2),PSJ1PH=$P(ANQDATA,"^"),PSJ2PH=$P(ANQDATA,"^",5)
"RTN","PSJCLOZ",64,0)
 .S PSJREASN=$P(ANQDATA,"^",3),PSJREMRK=$P(ANQDATA,"^",4)
"RTN","PSJCLOZ",65,0)
 .I $G(ORO) S PSJPROV=$P(ORO,"^",4)
"RTN","PSJCLOZ",66,0)
 .S:'$G(PSJORN)&$G(ORO) PSJORN=+ORO
"RTN","PSJCLOZ",67,0)
 .S PSJORDER("PSJORN")=PSJORN
"RTN","PSJCLOZ",68,0)
 .K DD,DO S DIC="^PS(53.8,",DIC(0)="L",DLAYGO=53.8,X=NOW
"RTN","PSJCLOZ",69,0)
 .D FILE^DICN K DIC,DLAYGO,DD,DO,DA,DR
"RTN","PSJCLOZ",70,0)
 .N PS538 S (PS538,DA)=+Y,DIE="^PS(53.8,",DR="1////^S X=PSJORDER(""PSJORN"")"_";3////^S X=PSJPROV;2////^S X=PSJ1PH;4////^S X=PSJREASN;5////^S X=PSJREMRK;6////^S X=PSJ2PH"
"RTN","PSJCLOZ",71,0)
 .D ^DIE K DIE,DA,DR
"RTN","PSJCLOZ",72,0)
 .S XMY(PSJPROV)="",XMY(PSJ2PH)=""
"RTN","PSJCLOZ",73,0)
 .K ANQDATA,X,Y,%,ANQREM
"RTN","PSJCLOZ",74,0)
 .W !,"THE OVERRIDDEN ORDER IS COMPLETE",!
"RTN","PSJCLOZ",75,0)
 .D ALERT
"RTN","PSJCLOZ",76,0)
 Q
"RTN","PSJCLOZ",77,0)
ALERT ; send an alert to the TWO approving team members
"RTN","PSJCLOZ",78,0)
 N RSLT
"RTN","PSJCLOZ",79,0)
 S XQADATA=PSCLPAT  ;
"RTN","PSJCLOZ",80,0)
 S PSOLAST4=$E($$GET1^DIQ(2,PSCLPAT,.09),6,9)
"RTN","PSJCLOZ",81,0)
 S XQAARCH=1,XQAFLG="D"
"RTN","PSJCLOZ",82,0)
 S XQA(PSJ2PH)="",XQA(PSJPROV)="",PSCDATE=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","PSJCLOZ",83,0)
 S XQAMSG=$$GET1^DIQ(2,PSCLPAT,.01)_" ("_PSOLAST4_")"_" : Clozapine Override Rx Processed: "_PSCDATE
"RTN","PSJCLOZ",84,0)
 S XQAID="PSI"_","_PSCLPAT
"RTN","PSJCLOZ",85,0)
 S RSLT=$$SETUP1^XQALERT
"RTN","PSJCLOZ",86,0)
 W !!,"OVERRIDE ALERTS HAVE BEEN SENT TO THE APPROVING TEAM MEMBERS",!!
"RTN","PSJCLOZ",87,0)
 Q
"RTN","PSJCLOZ",88,0)
 ;
"RTN","PSJCLOZ",89,0)
READ ;
"RTN","PSJCLOZ",90,0)
 S CLOZPAT=$P($P(XQX,"patient ",2)," BY",1)
"RTN","PSJCLOZ",91,0)
 S DIR("A")="Do you concur with the requested override for "_CLOZPAT,DIR(0)="Y",DIR("B")="N" D ^DIR G END:$D(DIRUT) K DIR D:'Y!($D(DIRUT)) END
"RTN","PSJCLOZ",92,0)
 Q
"RTN","PSJCLOZ",93,0)
TDD ; TOTAL DAILY DOSE INPUT
"RTN","PSJCLOZ",94,0)
 D
"RTN","PSJCLOZ",95,0)
 .S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S (ANQX,PSGORQF)=1 Q
"RTN","PSJCLOZ",96,0)
 .S:+$G(PSJEDITO) PSGETDD=X
"RTN","PSJCLOZ",97,0)
 .S:+$G(PSGCOPY) PSGCTDD=X
"RTN","PSJCLOZ",98,0)
 .S PSOSAND=X
"RTN","PSJCLOZ",99,0)
 Q
"RTN","PSJCLOZ",100,0)
ORD ;
"RTN","PSJCLOZ",101,0)
 S PSGDRG=PSJDD
"RTN","PSJCLOZ",102,0)
 I $$GET1^DIQ(50,+$G(PSGDRG),17.5)="PSOCLO1" D CLOZ(PSGP,PSGDRG) I $G(ANQX) S PSGORQF=1
"RTN","PSJCLOZ",103,0)
END ;
"RTN","PSJCLOZ",104,0)
 K DIRUT,DIROUT,DIR
"RTN","PSJCLOZ",105,0)
 Q
"RTN","PSJCLOZ",106,0)
 ;
"RTN","PSJCLOZ",107,0)
CMPLX ;COMPLEX THEN ORDER LOGIC
"RTN","PSJCLOZ",108,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",109,0)
 Q:+$G(PSGCOPY)
"RTN","PSJCLOZ",110,0)
 D CLOZPAT,ANDTHEN
"RTN","PSJCLOZ",111,0)
 Q:$G(PSGTYP)="A"
"RTN","PSJCLOZ",112,0)
 I $D(PSGTYP),'$D(^TMP("PSGCPLX",$J,DFN,+$G(PSGORD))) S ^TMP("PSGCPLX",$J,DFN,+$G(PSGORD))=PSGSD,PSGCOMP=1
"RTN","PSJCLOZ",113,0)
 Q
"RTN","PSJCLOZ",114,0)
CMPLX2 ;SECOND COMPLEX THEN ORDER LOGIC
"RTN","PSJCLOZ",115,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",116,0)
 Q:+$G(PSGCOPY)
"RTN","PSJCLOZ",117,0)
 D CLOZPAT,ANDTHEN
"RTN","PSJCLOZ",118,0)
 I $G(PSGTYP)="A"!($G(PSGTYP)="AT") Q
"RTN","PSJCLOZ",119,0)
 I $D(^TMP("PSGCPLX",$J,DFN)) D
"RTN","PSJCLOZ",120,0)
 .I $O(^TMP("PSGCPLX",$J,DFN,0)) S PSGTMP=$O(^TMP("PSGCPLX",$J,DFN,0))
"RTN","PSJCLOZ",121,0)
 .I +$G(PSGTMP)'=+$G(PSGORD) D
"RTN","PSJCLOZ",122,0)
 ..S $P(PSGRDTX,U,1)=$G(^TMP("PSGCPLX",$J,DFN,PSGTMP))
"RTN","PSJCLOZ",123,0)
 ..I $G(PSGRDTX(+$G(PSJORD),"PSGSD"))=+$G(PSGRDTX)
"RTN","PSJCLOZ",124,0)
 ..N X,X1,X2 S X1=+$G(PSGRDTX),X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,$G(CLOZPAT)=3:4,1:90)
"RTN","PSJCLOZ",125,0)
 ..D C^%DTC S PSGFD=X,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJCLOZ",126,0)
 Q
"RTN","PSJCLOZ",127,0)
CMPLX3 ;SECOND COMPLEX THEN ORDER LOGIC 
"RTN","PSJCLOZ",128,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",129,0)
 I PSGSTAT="NON-VERIFIED" D DISPCMP(PSGORD,PSGFD) D  Q
"RTN","PSJCLOZ",130,0)
 .I $G(PSSD) S PSGFD=PSSD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD) K PSSD
"RTN","PSJCLOZ",131,0)
 D CLOZPAT,ANDTHEN
"RTN","PSJCLOZ",132,0)
 I $G(PSGTYP)="T"!($G(PSGTYP)="TA") Q
"RTN","PSJCLOZ",133,0)
 N X,X1,X2 S X1=+$G(PSGRDTX),X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,$G(CLOZPAT)=3:4,1:90)
"RTN","PSJCLOZ",134,0)
 D C^%DTC S PSGFD=X,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJCLOZ",135,0)
 Q
"RTN","PSJCLOZ",136,0)
CLOZPAT ;VERIFY PATIENT IS A CLOZAPINE PATIENT
"RTN","PSJCLOZ",137,0)
 K CLOZPAT
"RTN","PSJCLOZ",138,0)
 I $L($$GET1^DIQ(55,DFN,53)),$$GET1^DIQ(55,DFN,54,"I")'="D" D
"RTN","PSJCLOZ",139,0)
 .I $$GET1^DIQ(55,DFN,53)?1U6N S CLOZPAT=3 Q
"RTN","PSJCLOZ",140,0)
 .N CLOZNUM,CLOZUID
"RTN","PSJCLOZ",141,0)
 .S CLOZNUM=$$GET1^DIQ(55,DFN,53) Q:CLOZNUM=""
"RTN","PSJCLOZ",142,0)
 .S CLOZUID=$$FIND1^DIC(603.01,,"X",CLOZNUM) Q:'CLOZUID
"RTN","PSJCLOZ",143,0)
 .S CLOZPAT=$$GET1^DIQ(603.01,CLOZUID,2,"I")
"RTN","PSJCLOZ",144,0)
 .S CLOZPAT=$S($G(CLOZPAT)="M":2,$G(CLOZPAT)="B":1,$G(CLOZPAT)="W":0,1:90)
"RTN","PSJCLOZ",145,0)
 Q
"RTN","PSJCLOZ",146,0)
ANDTHEN ;COMPLEX AND/THEN ORDER
"RTN","PSJCLOZ",147,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",148,0)
 Q:+$G(PSGCOPY)
"RTN","PSJCLOZ",149,0)
 N PSGTMP,PSGID S PSGTMP=+$$GET1^DIQ(53.1,+$G(PSGORD),125,"I"),PSGTYP=""
"RTN","PSJCLOZ",150,0)
 S PSGID=$$FIND1^DIC(100.045,","_PSGTMP_",","X","CONJ","ID") I PSGID D
"RTN","PSJCLOZ",151,0)
 .S PSGTYP=PSGTYP_$$GET1^DIQ(100.045,PSGID_","_PSGTMP,1)
"RTN","PSJCLOZ",152,0)
 Q
"RTN","PSJCLOZ",153,0)
DISPCMP(PSGORD,PSSD) ;COMPLEX ORDER CHECK
"RTN","PSJCLOZ",154,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",155,0)
 S PSSD=+$$GET1^DIQ(53.1,+$G(PSGORD),117,"I")
"RTN","PSJCLOZ",156,0)
 Q
"RTN","PSJCLOZ",157,0)
EXTDT ;VERIFY EXTERNAL DATE
"RTN","PSJCLOZ",158,0)
 Q
"RTN","PSJCLOZ",159,0)
 ;
"RTN","PSJCLOZ",160,0)
MSG1 ;
"RTN","PSJCLOZ",161,0)
 W !!,"Permission to dispense clozapine has been denied. The results of the latest",!
"RTN","PSJCLOZ",162,0)
 W "Lab Test drawn in the past 7 days show ANC results but No Matching WBC.",!
"RTN","PSJCLOZ",163,0)
 W "If you wish to dispense outside the FDA and VA protocol ANC limits,",!
"RTN","PSJCLOZ",164,0)
 W "document your request to Request for Override of Pharmacy Lockout ",!
"RTN","PSJCLOZ",165,0)
 W "(from VHA Handbook 1160.02) Director of the",!
"RTN","PSJCLOZ",166,0)
 W "VA National Clozapine Coordinating Center",!
"RTN","PSJCLOZ",167,0)
 W "(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSJCLOZ",168,0)
 W !,"No order entered!"
"RTN","PSJCLOZ",169,0)
 S ANQX=1
"RTN","PSJCLOZ",170,0)
 Q
"RTN","PSJCLOZ",171,0)
MSG2 ;
"RTN","PSJCLOZ",172,0)
 W !!,"Permission to dispense clozapine has been denied. The results of the latest",!
"RTN","PSJCLOZ",173,0)
 W "Lab Test drawn in the past 7 days show No ANC results. If you wish to dispense",!
"RTN","PSJCLOZ",174,0)
 W "outside the FDA and VA protocol ANC limits, document your request to Request",!
"RTN","PSJCLOZ",175,0)
 W "for Override of Pharmacy Lockout (from VHA Handbook 1160.02) Director of the",!
"RTN","PSJCLOZ",176,0)
 W "VA National Clozapine Coordinating Center",!
"RTN","PSJCLOZ",177,0)
 W "(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSJCLOZ",178,0)
 W !,"No order entered!"
"RTN","PSJCLOZ",179,0)
 S ANQX=1
"RTN","PSJCLOZ",180,0)
 Q
"RTN","PSJCLOZ",181,0)
MSG3 ;
"RTN","PSJCLOZ",182,0)
 W !,"A CBC/Differential including ANC Must Be Ordered and Monitored on a",!
"RTN","PSJCLOZ",183,0)
 W "Daily basis until the ANC above 1000/mm3 with no signs of infection.",!
"RTN","PSJCLOZ",184,0)
 W "If ANC is between 1000-1499, therapy can be continued but physician must order",!
"RTN","PSJCLOZ",185,0)
 W "lab test three times weekly."
"RTN","PSJCLOZ",186,0)
 Q
"RTN","PSJCLOZ",187,0)
MSG4 ;
"RTN","PSJCLOZ",188,0)
 W !,"Permission to dispense clozapine has been denied. If the results of the latest"
"RTN","PSJCLOZ",189,0)
 W !,"Lab Test drawn in the past 7 days show ANC below 1000/mm3 and you wish to"
"RTN","PSJCLOZ",190,0)
 W !,"dispense outside the FDA and VA protocol ANC limits, document your request to"
"RTN","PSJCLOZ",191,0)
 W !,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSJCLOZ",192,0)
 W !,"Director of the VA National Clozapine Coordinating Center"
"RTN","PSJCLOZ",193,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339) for a one-time override permission.",!
"RTN","PSJCLOZ",194,0)
 S ANQX=1
"RTN","PSJCLOZ",195,0)
 Q
"RTN","PSJCLOZ",196,0)
MSG5 ;
"RTN","PSJCLOZ",197,0)
 W !!,"Permission to dispense clozapine has been denied. Please contact the"
"RTN","PSJCLOZ",198,0)
 W !,"Director of the VA National Clozapine Coordinating Center"
"RTN","PSJCLOZ",199,0)
 W !!,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSJCLOZ",200,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339).",!
"RTN","PSJCLOZ",201,0)
 Q
"RTN","PSJCLOZ",202,0)
MSG6 ;  MSG 6 added for new critically low ANC levels clozapine override requirements
"RTN","PSJCLOZ",203,0)
 W !!,"This clozapine drug may not be dispensed to the patient at this time based on the available lab tests related to the clozapine treatment program."
"RTN","PSJCLOZ",204,0)
 W !!,"Please contact the NCCC to request an override in order to proceed with dispensing this drug. "
"RTN","PSJCLOZ",205,0)
 W !!,"Request for Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSJCLOZ",206,0)
 W !!,"The matching ANC counts which caused the lockout are of lab test results performed on "
"RTN","PSJCLOZ",207,0)
 S ANQX=1,Y=$P(PSOYS,"^",6) X ^DD("DD") W $P(Y,"@")
"RTN","PSJCLOZ",208,0)
 W !!,?5,"ANC: "_$P(PSOYS,"^",4),!
"RTN","PSJCLOZ",209,0)
 Q
"RTN","PSJCLOZ",210,0)
MSG9 ;
"RTN","PSJCLOZ",211,0)
 W !,"*** Permission to dispense clozapine has been denied based on the available"
"RTN","PSJCLOZ",212,0)
 W !,"    lab tests related to the clozapine treatment program. ***"
"RTN","PSJCLOZ",213,0)
 W !!,"For a National Override to dispense at the patient's normal frequency,"
"RTN","PSJCLOZ",214,0)
 W !,"please contact the VA National Clozapine Coordinating Center to request"
"RTN","PSJCLOZ",215,0)
 W !,"an Override of Pharmacy Lockout (from VHA Handbook 1160.02)"
"RTN","PSJCLOZ",216,0)
 W !,"(Phone: 214-857-0068 Fax: 214-857-0339)."
"RTN","PSJCLOZ",217,0)
 W !,"A Special Conditions Local Override can be approved for"
"RTN","PSJCLOZ",218,0)
 W !,"(1) weather-related conditions, (2) mail order delays of clozapine, or"
"RTN","PSJCLOZ",219,0)
 W !,"(3) inpatient going on leave. With Provider's documentation of approval,"
"RTN","PSJCLOZ",220,0)
 W !,"you may dispense a one-time supply not to exceed 4 days.",!
"RTN","PSJCLOZ",221,0)
 Q
"RTN","PSJCLOZ",222,0)
 ;
"RTN","PSJCLOZ",223,0)
 ;/RBN Begin of modifications for new message for IP 4 day overrride.
"RTN","PSJCLOZ",224,0)
MSG10 ;
"RTN","PSJCLOZ",225,0)
 W !,"*** Permission to dispense clozapine has been denied based on the available"
"RTN","PSJCLOZ",226,0)
 W !,"    lab tests related to the clozapine treatment program. ***"
"RTN","PSJCLOZ",227,0)
 W !!,"For a National Override to dispense at the patient's normal frequency,"
"RTN","PSJCLOZ",228,0)
 W !,"please contact the VA National Clozapine Coordinating Center to request an"
"RTN","PSJCLOZ",229,0)
 W !,"Override of Pharmacy Lockout (from VHA Handbook 1160.02) (Phone: 214-857-0068"
"RTN","PSJCLOZ",230,0)
 W !,"Fax: 214-857-0339)."
"RTN","PSJCLOZ",231,0)
 W !,"A Special Conditions Local Override for Inpatients can be approved for an"
"RTN","PSJCLOZ",232,0)
 W !,"IP Override Order with Outside Lab Results. With Provider's documentation of"
"RTN","PSJCLOZ",233,0)
 W !,"approval, you may dispense a one-time IP supply not to exceed 4 days."
"RTN","PSJCLOZ",234,0)
 W !,"The ANC from another facility must be recorded in the Progress note/comments"
"RTN","PSJCLOZ",235,0)
 W !,"in pharmacy"
"RTN","PSJCLOZ",236,0)
 Q
"RTN","PSJCLOZ",237,0)
 ;/RBN End of modifications for new message for IP 4 day overrride.
"RTN","PSJCLOZ",238,0)
 ; ** END NCC REMEDIATION ** 457 AND PSJ 327/RTW
"RTN","PSJCLOZ",239,0)
 ;
"RTN","PSJCLOZ",240,0)
COMPLEX ; Display Complex Order stop date warning message  <<RJS
"RTN","PSJCLOZ",241,0)
 Q:$G(PSGFLG)
"RTN","PSJCLOZ",242,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",243,0)
 N PSGFDT  ;,PSGSD,PSGYS,X,X1,X2
"RTN","PSJCLOZ",244,0)
 D CLOZPAT
"RTN","PSJCLOZ",245,0)
 S X1=+$G(PSGSD),X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,$G(CLOZPAT)=3:4,1:90)
"RTN","PSJCLOZ",246,0)
 D C^%DTC S PSGFDT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","PSJCLOZ",247,0)
 W !!,?25,"* WARNING *",!!,?10,"This order contains a requested duration."
"RTN","PSJCLOZ",248,0)
 W !,?8,"Please review the system calculated stop date",!,?5,"to confirm that it is within the allowable duration"
"RTN","PSJCLOZ",249,0)
 W !,?13,"of the order based on the patient's",!,?11,"authorized clozapine dispense frequency.",!
"RTN","PSJCLOZ",250,0)
 W !,?10,"Order stop date should not exceed ",PSGFDT,!,!,?1,"Review the entire profile to determine appropriate action(s).",!
"RTN","PSJCLOZ",251,0)
 K PSGCOMP D PAUSE^VALM1 S PSGFLG=1
"RTN","PSJCLOZ",252,0)
 Q
"RTN","PSJCLOZ",253,0)
COMPLEX1 ; Display Complex Order stop date warning message  <<RJS
"RTN","PSJCLOZ",254,0)
 Q:$G(PSGFLG)
"RTN","PSJCLOZ",255,0)
 Q:'$$GET1^DIQ(53.1,+$G(PSGORD),125,"I")
"RTN","PSJCLOZ",256,0)
 N PSGFDT,MSG
"RTN","PSJCLOZ",257,0)
 D:'$D(CLOZPAT) CLOZPAT
"RTN","PSJCLOZ",258,0)
 S X1=+$G(PSGSD),X2=$S($G(CLOZPAT)=2:28,$G(CLOZPAT)=1:14,$G(CLOZPAT)=0:7,$G(CLOZPAT)=3:4,1:90)
"RTN","PSJCLOZ",259,0)
 D C^%DTC S PSGFDT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","PSJCLOZ",260,0)
 S MSG=$J("",25)_"* WARNING *" D INSTR^VALM1("",1,9,80,1),INSTR^VALM1(MSG,1,10,80,1)
"RTN","PSJCLOZ",261,0)
 S MSG=$J("",10)_"This order contains a requested duration." D INSTR^VALM1(MSG,1,11,80,1)
"RTN","PSJCLOZ",262,0)
 S MSG=$J("",8)_"Please review the system calculated stop date" D INSTR^VALM1(MSG,1,12,80,1)
"RTN","PSJCLOZ",263,0)
 S MSG=$J("",5)_"to confirm that it is within the allowable duration" D INSTR^VALM1(MSG,1,13,80,1)
"RTN","PSJCLOZ",264,0)
 S MSG=$J("",13)_"of the order based on the patient's" D INSTR^VALM1(MSG,1,14,80,1)
"RTN","PSJCLOZ",265,0)
 S MSG=$J("",11)_"authorized clozapine dispense frequency." D INSTR^VALM1(MSG,1,15,80,1)
"RTN","PSJCLOZ",266,0)
 S MSG=$J("",10)_"Order stop date should not exceed "_PSGFDT D INSTR^VALM1(MSG,1,17,80,1)
"RTN","PSJCLOZ",267,0)
 S MSG=" Review the entire profile to determine appropriate action(s)." D INSTR^VALM1(MSG,1,18,80,1)
"RTN","PSJCLOZ",268,0)
 N LN F LN=16,19 D INSTR^VALM1("",1,LN,80,1)
"RTN","PSJCLOZ",269,0)
 K PSGCOMP D PAUSE^VALM1 S PSGFLG=1
"RTN","PSJCLOZ",270,0)
 Q
"RTN","PSJCLOZ",271,0)
LASTCHLD(DFN,ON) ; Last child of Complex order or not
"RTN","PSJCLOZ",272,0)
 N FL,PSORDA,PSORD1 I ON'["U",ON'["V" Q 1
"RTN","PSJCLOZ",273,0)
 I ON["U" D  Q:'PSORDA 1  Q:'PSORD1 1  Q 0
"RTN","PSJCLOZ",274,0)
 .S PSORDA=$$GET1^DIQ(55.06,+ON_","_DFN,125,"I"),PSORD1=+$$GET1^DIQ(55.06,+ON_","_DFN,66,"I")
"RTN","PSJCLOZ",275,0)
 .I 'PSORDA!'PSORD1 Q
"RTN","PSJCLOZ",276,0)
 .N ORARR,MAX D LIST^DIC(100.002,","_PSORDA_",",,"I",,,,,,,"ORARR") S MAX=+ORARR("DILIST",0)
"RTN","PSJCLOZ",277,0)
 .F I=1:1 Q:'$D(ORARR("DILIST",2,I))  I ORARR("DILIST",2,I)=PSORD1 Q
"RTN","PSJCLOZ",278,0)
 .S:I=MAX PSORD1=0 Q
"RTN","PSJCLOZ",279,0)
 I ON["V" D  Q:'PSORDA 1  Q:'PSORD1 1  Q 0
"RTN","PSJCLOZ",280,0)
 .S PSORDA=$$GET1^DIQ(55.01,+ON_","_DFN,150,"I"),PSORD1=+$$GET1^DIQ(55.01,+ON_","_DFN,110,"I")
"RTN","PSJCLOZ",281,0)
 .I 'PSORDA!'PSORD1 Q
"RTN","PSJCLOZ",282,0)
 .N ORARR,MAX D LIST^DIC(100.002,","_PSORDA_",",,"I",,,,,,,"ORARR") S MAX=+ORARR("DILIST",0)
"RTN","PSJCLOZ",283,0)
 .F I=1:1 Q:'$D(ORARR("DILIST",2,I))  I ORARR("DILIST",2,I)=PSORD1 Q
"RTN","PSJCLOZ",284,0)
 .S:I=MAX PSORD1=0 Q
"RTN","PSJCLOZ",285,0)
 Q 1
"RTN","PSJCLOZ",286,0)
 ;
"RTN","PSJCLOZ",287,0)
ISCLOZ(PSGORD,ORPSOI,DFN,PSGORDNM,PSGDRG) ; Define a clozapine order and associated drug
"RTN","PSJCLOZ",288,0)
 ; PSGORD   - Pending Order number (file 53.1)
"RTN","PSJCLOZ",289,0)
 ; ORPSOI   - ID containing Pharmacy Orderable Item number (file 50.7)
"RTN","PSJCLOZ",290,0)
 ; DFN      - Patient ID (file 2)
"RTN","PSJCLOZ",291,0)
 ; PSGORDNM - Pharmacy order number (file 55)
"RTN","PSJCLOZ",292,0)
 ; PSGDRG   - Drug Code
"RTN","PSJCLOZ",293,0)
 ; OROI     - Orderable Item number (file 101.43)
"RTN","PSJCLOZ",294,0)
 N ISCLOZ S ISCLOZ=0
"RTN","PSJCLOZ",295,0)
 I $G(PSGORD) D  Q ISCLOZ
"RTN","PSJCLOZ",296,0)
 .I '$$GET1^DIQ(53.1,PSGORD,.01,"I") Q
"RTN","PSJCLOZ",297,0)
 .S PSGDRG=$$GET1^DIQ(53.11,"1,"_+PSGORD,.01,"I") I PSGDRG D  Q
"RTN","PSJCLOZ",298,0)
 ..I $$GET1^DIQ(50,+$G(PSGDRG),17.5)="PSOCLO1" S ISCLOZ=1_U_PSGDRG
"RTN","PSJCLOZ",299,0)
 .N ORPSOI S ORPSOI=$$GET1^DIQ(53.1,PSGORD,108,"I") I 'ORPSOI Q
"RTN","PSJCLOZ",300,0)
 .D CLOZPSOI(+ORPSOI)
"RTN","PSJCLOZ",301,0)
 I $G(ORPSOI) D CLOZPSOI(+ORPSOI) Q ISCLOZ
"RTN","PSJCLOZ",302,0)
 I $G(DFN),$G(PSGORDNM) D  Q ISCLOZ
"RTN","PSJCLOZ",303,0)
 .S PSGDRG=$$GET1^DIQ(55.07,"1,"_PSGORDNM_","_DFN,.01,"I") I PSGDRG D  Q
"RTN","PSJCLOZ",304,0)
 ..I $$GET1^DIQ(50,+$G(PSGDRG),17.5)="PSOCLO1" S ISCLOZ=1_U_PSGDRG
"RTN","PSJCLOZ",305,0)
 .N ORPSOI S ORPSOI=$$GET1^DIQ(55.06,PSGORDNM_","_DFN,108,"I") I 'ORPSOI Q
"RTN","PSJCLOZ",306,0)
 .D CLOZPSOI(+ORPSOI)
"RTN","PSJCLOZ",307,0)
 ;
"RTN","PSJCLOZ",308,0)
 I $G(PSGDRG)>0,$$GET1^DIQ(50,$G(PSGDRG),17.5)="PSOCLO1" S ISCLOZ=1_U_PSGDRG
"RTN","PSJCLOZ",309,0)
 Q ISCLOZ
"RTN","PSJCLOZ",310,0)
 ;
"RTN","PSJCLOZ",311,0)
CLOZPSOI(ORPSOI) ; Define a clozapine order based on Pharmacy Orderable item
"RTN","PSJCLOZ",312,0)
 N ARR,PSGDRG,CLOZFLG D FIND^DIC(50,,.01,"Q",ORPSOI,,"ASP",,,"ARR")
"RTN","PSJCLOZ",313,0)
 N I F I=2:1 Q:'$D(ARR("DILIST",2,I))  S PSGDRG=+$G(ARR("DILIST",2,I)) D  Q:ISCLOZ
"RTN","PSJCLOZ",314,0)
 .I $$GET1^DIQ(50,PSGDRG,17.5)="PSOCLO1" S ISCLOZ=1_U_PSGDRG
"RTN","PSJCLOZ",315,0)
 Q
"RTN","PSJCLOZ",316,0)
 ;
"RTN","PSJCOM")
0^18^B47683425
"RTN","PSJCOM",1,0)
PSJCOM ;BIR/CML3-FINISH COMPLEX UNIT DOSE ORDERS ENTERED THROUGH OE/RR ;12 June 2019 09:31:53
"RTN","PSJCOM",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,186,267,281,315,338,327**;16 DEC 97;Build 114
"RTN","PSJCOM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCOM",4,0)
 ; Reference to ^VALM1 via DBIA 10116
"RTN","PSJCOM",5,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSJCOM",6,0)
 ; Reference to ^%DTC via DBIA 10000
"RTN","PSJCOM",7,0)
 ; Reference to ^%RCR via DBIA 10022
"RTN","PSJCOM",8,0)
 ; Reference to ^DIR via DBIA 10026
"RTN","PSJCOM",9,0)
 ; Reference to ^TIUEDIT via DBIA 2410
"RTN","PSJCOM",10,0)
 ; Reference to ^TMP("PSODAOC",$J) via DBIA 6071
"RTN","PSJCOM",11,0)
 ;
"RTN","PSJCOM",12,0)
UPD ;
"RTN","PSJCOM",13,0)
 Q:'PSJCOM
"RTN","PSJCOM",14,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",15,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSJCOM",16,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="N",$P(^(0),"^",4)="U",$P(^(0),"^",7)=PSGST,$P(^TMP("PSJCOM",$J,+PSGORD,2),"^",2)=PSGSD,$P(^(2),"^",4)=PSGFD
"RTN","PSJCOM",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^TMP("PSJCOM",$J,+PSGORD,6)=PSGSI
"RTN","PSJCOM",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U)=$P(PSGSI,U) I $P(PSGSI,U)="" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U,2)=""
"RTN","PSJCOM",19,0)
 S:$D(PSGSCH) $P(^TMP("PSJCOM",$J,+PSGORD,2),"^")=PSGSCH
"RTN","PSJCOM",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",5)=PSGSM,$P(^TMP("PSJCOM",$J,+PSGORD,0),"^",6)=PSGHSM
"RTN","PSJCOM",21,0)
 W "."
"RTN","PSJCOM",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSJCOM",23,0)
 ; Above code added to update file 53.1.
"RTN","PSJCOM",24,0)
 S PSGOEEWF="^TMP(""PSJCOM"",$J,+PSGORD,"
"RTN","PSJCOM",25,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSJCOM",26,0)
 S PSGND=$G(^TMP("PSJCOM",$J,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSJCOM",27,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM",28,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^TMP("PSJCOM",$J,+PSGORD,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSJCOM",29,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,.2),U,2)=PSGDO,$P(^TMP("PSJCOM",$J,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSJCOM",30,0)
 S:PSGRF]"" ^TMP("PSJCOM",$J,+PSGORD,2.1)=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) K PSGDUR,PSGRMVT,PSGRMV,PSGRF ;315
"RTN","PSJCOM",31,0)
 I 'PSGOEAV D NEWNVAL(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOM",32,0)
 I $D(^PS(53.45,DUZ,5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCOM",33,0)
 I PSGOEAV,+PSJSYSU=3 D VFY Q
"RTN","PSJCOM",34,0)
 I PSGOEAV,$G(PSJRNF) D VFY
"RTN","PSJCOM",35,0)
 Q
"RTN","PSJCOM",36,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJCOM",37,0)
 Q:'PSJCOM
"RTN","PSJCOM",38,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJCOM",39,0)
 D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJCOM",40,0)
 I '$D(^TMP("PSJCOM",$J,+PSGORD)) M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",41,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSJCOM",42,0)
 D DOSECHK^PSJDOSE
"RTN","PSJCOM",43,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSJCOM",44,0)
 . S PSGOEEF(109)=1
"RTN","PSJCOM",45,0)
 . S PSJACEPT=0
"RTN","PSJCOM",46,0)
 D DDCHK G:CHK DONE
"RTN","PSJCOM",47,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSJCOM",48,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD)
"RTN","PSJCOM",49,0)
 I CLOZFLG,'$G(^TMP("PSJCOM",$J,+PSGORD,"SAND")) D  G:CHK DONE
"RTN","PSJCOM",50,0)
 .S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S CHK=1 Q  ;G DONE:$G(CHK)
"RTN","PSJCOM",51,0)
 .S (^TMP("PSJCOM",$J,+PSGORD,"SAND"),PSOSAND)=X
"RTN","PSJCOM",52,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSJCOM",53,0)
 W !,"...a few moments, please..."
"RTN","PSJCOM",54,0)
 I PSGORD["P" D
"RTN","PSJCOM",55,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOM",56,0)
 . I '$D(^TMP("PSJCOM2",$J,+PSGORD)) D  Q
"RTN","PSJCOM",57,0)
 .. NEW PSGX S PSGX=$G(^TMP("PSJCOM",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",58,0)
 .. S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",59,0)
 .  NEW PSGX S PSGX=$G(^TMP("PSJCOM2",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",60,0)
 .  S $P(^TMP("PSJCOM2",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",61,0)
 D NEWNVAL(+PSGORD,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOM",62,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):$G(^TMP("PSJCOM",$J,+PSGORD,4)),1:$G(^TMP("PSJCOM2",$J,+PSGORD,4)))
"RTN","PSJCOM",63,0)
 I $G(PSGRSD) D
"RTN","PSJCOM",64,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL(PSGORD,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOM",65,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL(PSGORD,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOM",66,0)
 N DUR,DURORD S DURON=$S($G(ON)&($G(PSGORD)["U"):ON,$G(PSGORD):PSGORD,1:"") Q:'DURON  D
"RTN","PSJCOM",67,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",$G(DURON)["V":"IV",1:5),1),1:"")
"RTN","PSJCOM",68,0)
 I DUR]"" S $P(^TMP("PSJCOM2",$J,+PSGORD,2.5),"^",2)=DUR
"RTN","PSJCOM",69,0)
 ;D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSJCOM",70,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOM",71,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOM",72,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ;D EN^PSGPEN(+PSGORD)
"RTN","PSJCOM",73,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOM",74,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)=""
"RTN","PSJCOM",75,0)
 S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJCOM",76,0)
 S:'$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM",$J,+PSGORD,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J,+PSGORD,4)=VND4
"RTN","PSJCOM",77,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOM",78,0)
 I CLOZFLG,$L($G(ANQDATA)) S ^TMP("PSJCOM",$J,+PSGORD,"ANQDATA")=ANQDATA
"RTN","PSJCOM",79,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOM",80,0)
 S VALMBCK="Q"
"RTN","PSJCOM",81,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J)="A"
"RTN","PSJCOM",82,0)
 ;
"RTN","PSJCOM",83,0)
DONE ;
"RTN","PSJCOM",84,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSJCOM",85,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSJCOM",86,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJCOM",87,0)
 .Q:Y="N"
"RTN","PSJCOM",88,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSJCOM",89,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X,%X,%Y,Q,QQ Q
"RTN","PSJCOM",90,0)
 ;
"RTN","PSJCOM",91,0)
DDCHK ; dispense drug check
"RTN","PSJCOM",92,0)
 S DRGF=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):"^TMP(""PSJCOM"","_$J_","_+PSGORD_",",1:"^TMP(""PSJCOM2"","_$J_","_+PSGORD_","),CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJCOM",93,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJCOM",94,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJCOM",95,0)
 Q:CHK=0
"RTN","PSJCOM",96,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSJCOM",97,0)
 ;
"RTN","PSJCOM",98,0)
CONT() ;
"RTN","PSJCOM",99,0)
 NEW DIR,DIRUT,Y
"RTN","PSJCOM",100,0)
 W ! K DIR,DIRUT
"RTN","PSJCOM",101,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSJCOM",102,0)
 D ^DIR
"RTN","PSJCOM",103,0)
 Q Y
"RTN","PSJCOM",104,0)
 ;
"RTN","PSJCOM",105,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD)  ;
"RTN","PSJCOM",106,0)
 ;
"RTN","PSJCOM",107,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSJCOM",108,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSJCOM",109,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSJCOM",110,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSJCOM",111,0)
 ;
"RTN","PSJCOM",112,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSJCOM",113,0)
 ;
"RTN","PSJCOM",114,0)
 ; Create 0 node activity log for order if none exists, and get next entry number
"RTN","PSJCOM",115,0)
 I '$D(^TMP("PSJCOM2",$J,+PSGALORD)) D  Q
"RTN","PSJCOM",116,0)
 . S QQ=$G(^TMP("PSJCOM",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",117,0)
 . ;Set up data to be held in activity log record
"RTN","PSJCOM",118,0)
 . D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",119,0)
 . I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",120,0)
 . S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",121,0)
 . ; Create activity log entry
"RTN","PSJCOM",122,0)
 . S ^TMP("PSJCOM",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",123,0)
 S QQ=$G(^TMP("PSJCOM2",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",124,0)
 ;Set up data to be held in activity log record
"RTN","PSJCOM",125,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",126,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",127,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",128,0)
 ; Create activity log entry
"RTN","PSJCOM",129,0)
 S ^TMP("PSJCOM2",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",130,0)
 Q
"RTN","PSJCOM1")
0^31^B54823711
"RTN","PSJCOM1",1,0)
PSJCOM1 ;BIR/CML3-DISPLAY COMPLEX ORDERS FOR DISCONTINUE ;12 June 2019 09:31:53
"RTN","PSJCOM1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,281,315,327**;16 DEC 97;Build 114
"RTN","PSJCOM1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCOM1",4,0)
 ; Reference to ^VALM1 via DBIA 10116
"RTN","PSJCOM1",5,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSJCOM1",6,0)
 ; Reference to ^%DTC via DBIA 10000
"RTN","PSJCOM1",7,0)
 ; Reference to ^PS(51.2 via DBIA 2178
"RTN","PSJCOM1",8,0)
 ; Reference to ^DIE via DBIA 10018
"RTN","PSJCOM1",9,0)
 ; Reference to ^DIR via DBIA 10026
"RTN","PSJCOM1",10,0)
 ; Reference to ^TMP("PSODAOC",$J) via DBIA 6071
"RTN","PSJCOM1",11,0)
 ;
"RTN","PSJCOM1",12,0)
CMPLX(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",13,0)
 D PAUSE K PSJCM
"RTN","PSJCOM1",14,0)
 N PSJLINE,PSX,PSCM
"RTN","PSJCOM1",15,0)
 S PSJLINE=1
"RTN","PSJCOM1",16,0)
 I PSGORD["P" N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",ON,PSJO)) Q:'PSJO  D
"RTN","PSJCOM1",17,0)
 .Q:PSJO=+PSGORD  S PSJOO=PSGORD D DSPLORDU(PSGP,PSJO_"P") S PSJCM(PSJO_"P",PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",18,0)
 I PSGORD'["P" N PSJO,PSJOO S PSJOO="",PSJO=0 F  S PSJO=$O(^PS(55,"ACX",ON,PSJO)) Q:'PSJO  F  S PSJOO=$O(^PS(55,"ACX",ON,PSJO,PSJOO)) Q:PSJOO=""  D
"RTN","PSJCOM1",19,0)
 .Q:PSJOO=PSGORD  D:PSJOO["U" DSPLORDU(PSGP,PSJOO) D:PSJOO["V" DSPLORDV(PSGP,PSJOO) S PSJCM(PSJOO,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",20,0)
 N ON S ON="" F  S ON=$O(PSJCM(ON)) Q:ON=""  D
"RTN","PSJCOM1",21,0)
 .W ! F PSX=0:0 S PSX=$O(PSJCM(ON,PSX)) Q:'PSX  D
"RTN","PSJCOM1",22,0)
 ..W !,PSJCM(ON,PSX) D:'(PSX#6) PAUSE
"RTN","PSJCOM1",23,0)
 W !
"RTN","PSJCOM1",24,0)
 Q
"RTN","PSJCOM1",25,0)
 ;
"RTN","PSJCOM1",26,0)
CMPLX2(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",27,0)
 Q:$G(PSGORD)'["U"
"RTN","PSJCOM1",28,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSJCOM1",29,0)
 N CLOZFLG I PSGORD["U" S CLOZFLG=$$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) I 1
"RTN","PSJCOM1",30,0)
 E  S CLOZFLG=$$ISCLOZ^PSJCLOZ(+PSGORD)
"RTN","PSJCOM1",31,0)
 I CLOZFLG D
"RTN","PSJCOM1",32,0)
 .N PSGDN S PSGDN=$P(CLOZFLG,U,2)
"RTN","PSJCOM1",33,0)
 .D PSJFILE^PSJCLOZ(PSGP),INPSND^YSCLTST5 K:$D(^TMP($J,"CLOZFLG",PSGP)) ^TMP($J,"CLOZFLG",PSGP)
"RTN","PSJCOM1",34,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSJCOM1",35,0)
 N PSJLINE S PSJLINE=0
"RTN","PSJCOM1",36,0)
 D FULL^VALM1
"RTN","PSJCOM1",37,0)
 D DSPLORDU(PSGP,PSGORD)
"RTN","PSJCOM1",38,0)
 W ! S PSJLINE="" F  S PSJLINE=$O(PSJCM(PSGORD,PSJLINE)) Q:PSJLINE=""  W !,PSJCM(PSGORD,PSJLINE) D:'((PSJLINE+1)#6) PAUSE
"RTN","PSJCOM1",39,0)
 D EN^PSGPEN(PSGORD)
"RTN","PSJCOM1",40,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSJO_"P",^TMP("PSODAOC",$J,"IP NEW IEN")=PSGORD
"RTN","PSJCOM1",41,0)
 D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJCOM1",42,0)
 W !
"RTN","PSJCOM1",43,0)
 Q
"RTN","PSJCOM1",44,0)
 ;
"RTN","PSJCOM1",45,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJCOM1",46,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJCOM1",47,0)
 Q
"RTN","PSJCOM1",48,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJCOM1",49,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJCOM1",50,0)
 Q
"RTN","PSJCOM1",51,0)
 ;
"RTN","PSJCOM1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJCOM1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y K PSJCM
"RTN","PSJCOM1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJCOM1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJCOM1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJCOM1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJCOM1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJCOM1",59,0)
 S STAT=$P(NODE0,U,9)
"RTN","PSJCOM1",60,0)
 D NOW^%DTC I "A"[STAT I $P(NODE2,U,4)<% D EXPIRE S STAT="E"
"RTN","PSJCOM1",61,0)
 I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJCOM1",62,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJCOM1",63,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJCOM1",64,0)
 I $G(PSGPDN)["CLOZ" N PSGORD S PSGORD=+$G(NODE0),PSSD="" D DISPCMP^PSJCLOZ(PSGORD,.PSSD) I $G(PSSD) S SD=$E($$ENDTC^PSGMI(PSSD),1,5) K PSSD
"RTN","PSJCOM1",65,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJCOM1",66,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJCOM1",67,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJCOM1",68,0)
 . S PSJCM(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJCOM1",69,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJCOM1",70,0)
 Q
"RTN","PSJCOM1",71,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJCOM1",72,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJCOM1",73,0)
 S TYP="?" I ON["V" D
"RTN","PSJCOM1",74,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJCOM1",75,0)
 .D NOW^%DTC I "A"[P(17) I P(3)<% D EXPIRE S P(17)="E"
"RTN","PSJCOM1",76,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJCOM1",77,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",78,0)
 S PSJCT=0,PSJL=""
"RTN","PSJCOM1",79,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",80,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJCOM1",81,0)
 Q
"RTN","PSJCOM1",82,0)
SOL ;
"RTN","PSJCOM1",83,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJCOM1",84,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJCOM1",85,0)
 Q
"RTN","PSJCOM1",86,0)
PIVAD ; Print IV Additives.
"RTN","PSJCOM1",87,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJCOM1",88,0)
 Q
"RTN","PSJCOM1",89,0)
 ;
"RTN","PSJCOM1",90,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJCOM1",91,0)
 K PSJIVFLG
"RTN","PSJCOM1",92,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJCOM1",93,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJCOM1",94,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJCOM1",95,0)
 Q
"RTN","PSJCOM1",96,0)
SETTMP ;
"RTN","PSJCOM1",97,0)
 S PSJCM(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJCOM1",98,0)
 Q
"RTN","PSJCOM1",99,0)
PAUSE ;
"RTN","PSJCOM1",100,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJCOM1",101,0)
 Q
"RTN","PSJCOM1",102,0)
NEW ;
"RTN","PSJCOM1",103,0)
 Q:'PSJCOM
"RTN","PSJCOM1",104,0)
 Q:PSGORD'["P"
"RTN","PSJCOM1",105,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM1",106,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCOM1",107,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",27)="E",$P(^(0),"^",9)="DE"
"RTN","PSJCOM1",108,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSJCOM1",109,0)
 ;I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSJCOM1",110,0)
 K ND4,DA D NOW^%DTC S PSGDT=+$E(%,1,12),DA=+PSGORD
"RTN","PSJCOM1",111,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM1",112,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSJCOM1",113,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSJCOM1",114,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJCOM1",115,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSJCOM1",116,0)
 S:$G(PSGRF)]"" ND2P1=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) ;*315
"RTN","PSJCOM1",117,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSJCOM1",118,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSJCOM1",119,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSJCOM1",120,0)
 S F="^TMP(""PSJCOM2"","_$J_","_DA_",",@(F_"0)")=ND
"RTN","PSJCOM1",121,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",122,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2) S:PSJCOM]"" $P(^(.2),"^",8)=PSJCOM
"RTN","PSJCOM1",123,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSJCOM1",124,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",125,0)
 S @(F_"2)")=$P(ND2,"^",1,6),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSJCOM1",126,0)
 S @(F_"2.1)")=ND2P1 ;*315
"RTN","PSJCOM1",127,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",128,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSJCOM1",129,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSJCOM1",130,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",131,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSJCOM1",132,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSJCOM1",133,0)
 S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSJCOM1",134,0)
 W "."
"RTN","PSJCOM1",135,0)
OUT ;
"RTN","PSJCOM1",136,0)
 K PSGOETOF
"RTN","PSJCOM1",137,0)
DONE ;
"RTN","PSJCOM1",138,0)
 K C,D,ND,ND2,ND2P1,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE,%,Q
"RTN","PSJCOM1",139,0)
 Q
"RTN","PSJCOM1",140,0)
EXPIRE ;Change status of order to expired and send notice to OE/RR
"RTN","PSJCOM1",141,0)
 N DA,DIE,DR,PSGPO,PSIVACT
"RTN","PSJCOM1",142,0)
 Q:'$G(PSJOO)!($G(PSJOO)["P")
"RTN","PSJCOM1",143,0)
 S STATUS="E",(PSGPO,PSIVACT)=1,DA=+PSJOO,DA(1)=PSGP,DIE=$S(PSJOO["V":"^PS(55,"_PSGP_",""IV"",",1:"^PS(55,"_PSGP_",5,"),DR=$S(PSJOO["V":"100////E",1:"28////E") D ^DIE
"RTN","PSJCOM1",144,0)
 D EN1^PSJHL2(PSGP,"SC",PSJOO)
"RTN","PSJCOM1",145,0)
 Q
"RTN","PSJLMPRU")
0^35^B26845194
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM - INPATIENT LISTMAN UD PROFILE UTILITIES ;Jul 26, 2017@18:04:02
"RTN","PSJLMPRU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**16,58,85,110,185,181,267,323,317,373,327**;16 DEC 97;Build 114
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ; Reference to $$GET^XPAR is supported by DBIA 2263
"RTN","PSJLMPRU",7,0)
 ;
"RTN","PSJLMPRU",8,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",9,0)
 N PSJFLAG,PSJV,PADE
"RTN","PSJLMPRU",10,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",11,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",12,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",13,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJLMPRU",14,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",15,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",16,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",17,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",18,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",19,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",20,0)
 I $D(PSJCLIN) S WS=0  ; PSJ*5*323
"RTN","PSJLMPRU",21,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier
"RTN","PSJLMPRU",22,0)
 S PADE=0 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMPRU",23,0)
 .N PSJORCL,PSJCLNK
"RTN","PSJLMPRU",24,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMPRU",25,0)
 .S PSJORCL=$S($G(ON)["P":$G(^PS(53.1,+$G(ON),"DSS")),$G(ON)["U":$G(^PS(55,+$G(PSGP),5,+$G(ON),8)),$G(ON)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(ON),"DSS")),1:"")
"RTN","PSJLMPRU",26,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMPRU",27,0)
 .I '$G(VAIN(4)) N VAIN D INP^VADPT
"RTN","PSJLMPRU",28,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSJLMPRU",29,0)
 .S PADE=$$DRGFLAG^PSJPADSI(PSGP,$G(ON),,$G(ON),$G(PSJNEWOE)) S:PADE=0 PADE=1
"RTN","PSJLMPRU",30,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",31,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",32,0)
 ;NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)  ;#373
"RTN","PSJLMPRU",33,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:10) ;#373
"RTN","PSJLMPRU",34,0)
 ; START NCC REMEDIATION RJS-327
"RTN","PSJLMPRU",35,0)
 I $$ISCLOZ^PSJCLOZ(,,DFN,+ON) D
"RTN","PSJLMPRU",36,0)
 .D DISPCMP^PSJCLOZ(+$G(ND),.PSSD) S:$G(PSSD) SD=PSSD K PSSD
"RTN","PSJLMPRU",37,0)
 ; END NCC REMEDIATION RJS-327
"RTN","PSJLMPRU",38,0)
 ;F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN)) ;#373
"RTN","PSJLMPRU",39,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC2^PSGMI(@X),1,LEN)) ;#373
"RTN","PSJLMPRU",40,0)
 ;D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)  ;#373
"RTN","PSJLMPRU",41,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,33,27,.DRUGNAME,0)   ;#373
"RTN","PSJLMPRU",42,0)
 S RNDTPRT=0  ;#373
"RTN","PSJLMPRU",43,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",44,0)
 .I PSJX=1 D
"RTN","PSJLMPRU",45,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",46,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",47,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,46,3)   ;#373
"RTN","PSJLMPRU",48,0)
 ..;S PSJL=PSJL_PSGID1_"  "_SD1_" "_$E(STAT,1,2)_$S($L(STAT)=1:"     ",1:"    ")_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"") ;#373
"RTN","PSJLMPRU",49,0)
 ..S PSJL=$$SETSTR^VALM1(PSGID1,PSJL,49,10),PSJL=$$SETSTR^VALM1(SD1,PSJL,60,10)  ;#373
"RTN","PSJLMPRU",50,0)
 ..S PSJL=$$SETSTR^VALM1($E(STAT,1,2)_$S($L(STAT)=1:" ",1:""),PSJL,71,2)  ;#373
"RTN","PSJLMPRU",51,0)
 ..;S PSJL=PSJL_PSGID1_"  "_SD1_" "_$E(STAT,1,2)_$S($L(STAT)=1:"     ",1:"    ") 
"RTN","PSJLMPRU",52,0)
 ..;I NF!WS!SM!PF!$G(PADE) S PSJL=$$SETSTR^VALM1($S(NF:"NF ",(WS&PADE):"WP ",(PADE&'WS):"PD ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1) ;#373
"RTN","PSJLMPRU",53,0)
 ..I NF!WS!SM!PF!$G(PADE) S PSJL=$$SETSTR^VALM1($S(NF:"NF ",(WS&PADE):"WP ",(PADE&'WS):"PD ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,74,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,78,1) ;#373
"RTN","PSJLMPRU",54,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,33)
"RTN","PSJLMPRU",55,0)
 . I PSJX=2 D RNDTDSP  ;#373 - Renewal Date logic added for Unit Dose
"RTN","PSJLMPRU",56,0)
 . ;I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)   ; #373
"RTN","PSJLMPRU",57,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",58,0)
 I 'RNDTPRT S PSJL="" D RNDTDSP D:RNDTPRT SETTMP("PSJPRO",PSJL)  ;#373
"RTN","PSJLMPRU",59,0)
 I ND6'="" N X,PSJTXT3 S X=$$GETSIOPI^PSJBCMA5(DFN,ON) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN!$G(PSJTXT3)  D
"RTN","PSJLMPRU",60,0)
 .I ($O(^PS(53.45,DUZ,5," "),-1)>3) S PSJTXT3=1 S PSJL="Instructions too long. See Order View for full text." D PTXT(PSJL,"PSJPRO",10,66) Q
"RTN","PSJLMPRU",61,0)
 .S PSJL=^PS(53.45,DUZ,5,TXTLN,0) D PTXT(PSJL,"PSJPRO",10,66)
"RTN","PSJLMPRU",62,0)
 K RNDTPRT   ;#373
"RTN","PSJLMPRU",63,0)
 K ^PS(53.45,DUZ,5)
"RTN","PSJLMPRU",64,0)
 Q
"RTN","PSJLMPRU",65,0)
 ;
"RTN","PSJLMPRU",66,0)
RNDTDSP ; Display Renewal Date - #373
"RTN","PSJLMPRU",67,0)
 NEW RNDTDSP S RNDTDSP=$S($G(RNDT):$E($$ENDTC2^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",68,0)
 I RNDTDSP]"" D
"RTN","PSJLMPRU",69,0)
 . S PSJL=$$SETSTR^VALM1("Renewed:",PSJL,49,8)
"RTN","PSJLMPRU",70,0)
 . S PSJL=$$SETSTR^VALM1(RNDTDSP,PSJL,58,10)
"RTN","PSJLMPRU",71,0)
 . S RNDTPRT=1
"RTN","PSJLMPRU",72,0)
 Q
"RTN","PSJLMPRU",73,0)
 ;
"RTN","PSJLMPRU",74,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",75,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",76,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",77,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",78,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",79,0)
 ;                       
"RTN","PSJLMPRU",80,0)
 ;BHW;PSJ*5*185;Extra spaces causes display to "skip" part of the field. 
"RTN","PSJLMPRU",81,0)
 ;S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",82,0)
 S PSJL="",$P(PSJL," ",LM)=""
"RTN","PSJLMPRU",83,0)
 F X=1:1:$L(TXT," ") S WRD=$P(TXT," ",X) D
"RTN","PSJLMPRU",84,0)
 .;BHW;PSJ*5*185;check if end of string or just extra space
"RTN","PSJLMPRU",85,0)
 .I WRD="" S PSJL=PSJL_" " Q 
"RTN","PSJLMPRU",86,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",87,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",88,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",89,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",90,0)
 Q
"RTN","PSJLMPRU",91,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",92,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",93,0)
 Q
"RTN","PSJLMUDE")
0^33^B98434237
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;Jul 26, 2017@18:04:02
"RTN","PSJLMUDE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,47,50,63,64,58,80,116,110,111,164,175,201,181,254,267,228,315,317,338,373,327**;16 DEC 97;Build 114
"RTN","PSJLMUDE",3,0)
 ;
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSJLMUDE",10,0)
 ;
"RTN","PSJLMUDE",11,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",12,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR,J K ^TMP("PSJUDE",$J),^TMP($J,"GMRAING")
"RTN","PSJLMUDE",13,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",14,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",15,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",16,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",17,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",18,0)
 . I $$OVRCHK^PSGSICH1(PSGP,PSGORD) S PSJVD="<OCI>"_PSJVD
"RTN","PSJLMUDE",19,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),80)
"RTN","PSJLMUDE",20,0)
 . D:PSJVD]"" CNTRL^VALM10(1,80-$L(PSJVD),$L(PSJVD),IORVON,IORVOFF,0)
"RTN","PSJLMUDE",21,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",22,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",23,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",24,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",25,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",27,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3) ;#373
"RTN","PSJLMUDE",28,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,52,28) D:$G(PSGOEEF(10)) HILITE(3) ;#373
"RTN","PSJLMUDE",29,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",30,0)
 . ;N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT) ;#373
"RTN","PSJLMUDE",31,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC2^PSGMI(+OSTRT) ;#373
"RTN","PSJLMUDE",32,0)
 . ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26) ;#373
"RTN","PSJLMUDE",33,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,52,28) ;#373
"RTN","PSJLMUDE",34,0)
 D SETTMP
"RTN","PSJLMUDE",35,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",36,0)
 ;I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32) ;#373
"RTN","PSJLMUDE",37,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC2^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) ;#373
"RTN","PSJLMUDE",38,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",39,0)
 . ;I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q  ;#373
"RTN","PSJLMUDE",40,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC2^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,46,34) Q  ;#373
"RTN","PSJLMUDE",41,0)
 . ;I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D  ;#373
"RTN","PSJLMUDE",42,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC2^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,51,34) D  ;#373
"RTN","PSJLMUDE",43,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",44,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",45,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",46,0)
 . ;N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32) ;#373
"RTN","PSJLMUDE",47,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC2^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,34) ;#373
"RTN","PSJLMUDE",48,0)
 D SETTMP
"RTN","PSJLMUDE",49,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",50,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",51,0)
 ; START NCC REMEDIATION >> 327*RJS
"RTN","PSJLMUDE",52,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)  ;#373
"RTN","PSJLMUDE",53,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,52,28) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)  ;#373
"RTN","PSJLMUDE",54,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",55,0)
 ;I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D  ;#373
"RTN","PSJLMUDE",56,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC2^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,52,28) D  ;#373
"RTN","PSJLMUDE",57,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",58,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSJLMUDE",59,0)
 D SETTMP
"RTN","PSJLMUDE",60,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",61,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",62,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:'$G(PSGNOHI)&($G(PSGOEEF(39))!($G(PSGOEEF(41)))) HILITE(9) ;*315
"RTN","PSJLMUDE",63,0)
 I +$G(PSGRF)>1 N PSGRMVD S PSGRMVD=$S(+$G(PSGRMVT):PSGRMVT,1:"") S PSJL=$$SETSTR^VALM1("Removal Times: "_PSGRMVD,PSJL,6,71) D SETTMP ;*315
"RTN","PSJLMUDE",64,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",65,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_" (11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ") D
"RTN","PSJLMUDE",66,0)
 .I '$D(^PS(53.45,DUZ,5,1)),$G(PSGORD) D GETSI^PSJBCMA5(PSGP,PSGORD)
"RTN","PSJLMUDE",67,0)
 .I '$P($G(^PS(53.45,DUZ,5,0)),"^",3) S PSJL=PSJL_$P($G(PSGSI),"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80) Q
"RTN","PSJLMUDE",68,0)
 .S PSJL=PSJL_" (see below)" D SETTMP N I S I=0 F J=1:1 S I=$O(^PS(53.45,DUZ,5,I)) Q:'I  S PSJL="      "_^PS(53.45,DUZ,5,I,0) D SETTMP
"RTN","PSJLMUDE",69,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",70,0)
 ; E3R 16130
"RTN","PSJLMUDE",71,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",72,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,52,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,59,16) D  D SETTMP,CNTRL^VALM10(PSJLN-1,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",73,0)
 .I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",74,0)
 ..I '$G(VAIN(4)) N VAIN,DFN S DFN=$G(PSGP) D INP^VADPT
"RTN","PSJLMUDE",75,0)
 ..N PSJORCL,PSJCLNK
"RTN","PSJLMUDE",76,0)
 ..; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",77,0)
 ..S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",78,0)
 ..I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",79,0)
 ..I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; PADE device Inactive?
"RTN","PSJLMUDE",80,0)
 ..S PSJL=$$SETSTR^VALM1("PADE",PSJL,75,5)
"RTN","PSJLMUDE",81,0)
 NEW PSJX,PSJDLINE
"RTN","PSJLMUDE",82,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",83,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",84,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",85,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,52,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,59,16) D  D SETTMP
"RTN","PSJLMUDE",86,0)
 ..; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSJLMUDE",87,0)
 ..I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",88,0)
 ...N PSJPDLOC,VAIN,PSJORCL,PSJCLNK,PSJCLND D INP^VADPT
"RTN","PSJLMUDE",89,0)
 ...; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",90,0)
 ...S PSJCLND=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",91,0)
 ...S PSJORCL=$S(+PSJCLND&$P(PSJCLND,"^",2):+PSJCLND,1:"")
"RTN","PSJLMUDE",92,0)
 ...I PSJORCL,$P(PSJCLND,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",93,0)
 ...I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; Quit if patient location not linked to PADE
"RTN","PSJLMUDE",94,0)
 ...S PSJPDLOC=$S($G(PSJCLNK):PSJORCL_"C",1:"")
"RTN","PSJLMUDE",95,0)
 ...S:'PSJPDLOC PSJPDLOC=+$G(VAIN(4))
"RTN","PSJLMUDE",96,0)
 ...N PADE S PADE=$J($$DRGQTY^PSJPADSI(+ND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC),5)
"RTN","PSJLMUDE",97,0)
 ...S PSJL=$$SETSTR^VALM1(PADE,PSJL,74,5)
"RTN","PSJLMUDE",98,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",99,0)
 ..S PSJDLINE=$S($P(^PS(53.45,PSJSYSP,2,0),U,3)>1:16,1:13) ;*228 - Highlight multiple dispense drugs
"RTN","PSJLMUDE",100,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(PSJDLINE+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",101,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",102,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",103,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",104,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",105,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",106,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",107,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",108,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",109,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",110,0)
 D SETTMP
"RTN","PSJLMUDE",111,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",112,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",113,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",114,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",115,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",116,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",117,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",118,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",119,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",120,0)
ACTFLG ;
"RTN","PSJLMUDE",121,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",122,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",123,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",124,0)
 I AT]"" D
"RTN","PSJLMUDE",125,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",126,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",127,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",128,0)
 D SETTMP
"RTN","PSJLMUDE",129,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",130,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",131,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",132,0)
TEST ;
"RTN","PSJLMUDE",133,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",134,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",135,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",136,0)
 I $G(PSGDREQ) S CHK=1,VALMSG="DOSAGE IS REQUIRED" K PSGDREQ
"RTN","PSJLMUDE",137,0)
 Q
"RTN","PSJLMUDE",138,0)
DISPLAY ;
"RTN","PSJLMUDE",139,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",140,0)
 Q
"RTN","PSJLMUDE",141,0)
 ;
"RTN","PSJLMUDE",142,0)
SETTMP ;
"RTN","PSJLMUDE",143,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",144,0)
 Q
"RTN","PSJLMUDE",145,0)
 ;
"RTN","PSJLMUDE",146,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",147,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",148,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",149,0)
 I $G(PSGRF),FLD>9 S LIN=LIN+1 ;COMPENSATE FOR REMOVAL TIMES
"RTN","PSJLMUDE",150,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",151,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",152,0)
 Q
"RTN","PSJLMUDE",153,0)
 ;
"RTN","PSJLMUDE",154,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",155,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",156,0)
 S PSJX1=""
"RTN","PSJLMUDE",157,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",158,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",159,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",160,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",161,0)
 K PSJX1
"RTN","PSJLMUDE",162,0)
 Q
"RTN","PSJLMUDE",163,0)
 ;
"RTN","PSJLMUDE",164,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",165,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",166,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",167,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",168,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",169,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",170,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",171,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",172,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",173,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",174,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",175,0)
ENKILL ;
"RTN","PSJLMUDE",176,0)
 ; 373 - Additionally, KILL off PSJALLGY
"RTN","PSJLMUDE",177,0)
 K PSGNOHI,PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM,PSJALLGY Q
"RTN","PSJOE")
0^1^B121657110
"RTN","PSJOE",1,0)
PSJOE ;BIR/MLM - INPATIENT ORDER ENTRY ;12 June 2019 09:31:53
"RTN","PSJOE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,26,29,33,42,50,56,72,58,85,95,80,110,111,133,140,151,149,181,252,281,315,256,344,327**;16 DEC 97;Build 114
"RTN","PSJOE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOE",4,0)
 ; Reference to ^PS(55 via DBIA 2191
"RTN","PSJOE",5,0)
 ; Reference to EN^VALM via DBIA 10118
"RTN","PSJOE",6,0)
 ; Reference to FULL^VALM1 via DBIA 10116
"RTN","PSJOE",7,0)
 ; Reference to PAUSE^VALM1 via DBIA 10116
"RTN","PSJOE",8,0)
 ; Reference to ^PSSLOCK via DBIA 2789
"RTN","PSJOE",9,0)
 ; Reference to ^DPT( via DBIA 10035
"RTN","PSJOE",10,0)
 ; Reference to ^ORCFLAG via DBIA #3620
"RTN","PSJOE",11,0)
 ; Reference to ^SDAMA203 via DBIA #4133
"RTN","PSJOE",12,0)
 ; Reference to ^TMP("PSODAOC" via DBIA 6071
"RTN","PSJOE",13,0)
 ;
"RTN","PSJOE",14,0)
EN ; Start Inpatient LM OE
"RTN","PSJOE",15,0)
 N PSJLK,PSJNEWOE,PSJLMCON,PSJPROT,XQORS,VALMEVL D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",16,0)
 I $D(XQUIT) K XQUIT G DONE
"RTN","PSJOE",17,0)
 K PSGVBY,PSJPR S (PSJOL,PSJACOK,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE^PSJOE
"RTN","PSJOE",18,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ^PSJP,HK Q:PSGP'>0  S PSJPROT=3,DFN=PSGP D ^PSJAC D  I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSJOE",19,0)
 .K ^TMP("PSJ",$J)
"RTN","PSJOE",20,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSJOE",21,0)
 .K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",22,0)
 .N NXTPT S NXTPT=0 F  Q:$G(NXTPT)  D
"RTN","PSJOE",23,0)
 ..K PSGRDTX
"RTN","PSJOE",24,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSJOE",25,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSJOE",26,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJ LM OE")
"RTN","PSJOE",27,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSJOE",28,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSJOE",29,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",30,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSJOE",31,0)
 ...S NXTPT=1
"RTN","PSJOE",32,0)
 ..S NXTPT=1,PSJNEWOE=0
"RTN","PSJOE",33,0)
 .S PSJOL="S"
"RTN","PSJOE",34,0)
 .I $G(PSGPXN) I $P(PSJSYSW0,U,29)]""!($G(PSJCOM)) S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSJOE",35,0)
 ..N DFN,PSGP,PSJPXDP
"RTN","PSJOE",36,0)
 ..I $P(PSJSYSW0,U,29)="" S PSJPDXP=1 D
"RTN","PSJOE",37,0)
 ...;N IO,ION,IOS D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",38,0)
 ...D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",39,0)
 ..S (PSGP,DFN)=PSGPXPT D ^PSGPER S:$G(PSJPDXP) $P(PSJSYSW0,U,29)="" K PSJPDXP
"RTN","PSJOE",40,0)
 .D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",41,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSJOE",42,0)
DONE ;
"RTN","PSJOE",43,0)
 ; -- RTC 198753 - correct typo - r PSJALGSV w PSJAGYSV
"RTN","PSJOE",44,0)
 K PSJAGYSV,PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE"),^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",45,0)
 K AC,ACTION,D1,D2,MI,N,ON,P3,PNOW,PSIVAT,PSIVLN,PSIVSTR L -^PS(53.45,PSJSYSP)
"RTN","PSJOE",46,0)
 K DA,DRG,NE,PSGCF,PSGCANFL,PSGNEDFD,PSGNEF,PSGNEFD,PSGNEPR,PSGNESD,PSJACOK,PSJOE,PSJOECNT,PSJOEPF,PSJORD,PSGOEA,PSGOEAV,PSGOL,PSGOS,PSGON,PSGOP,PSGORD,PSGS0XT,PSGS0Y,RCT,ST,WD,XREF,Z,PSJIVORF,PSJIVPCL
"RTN","PSJOE",47,0)
 K PSGOEORF,PSIVREA,PSJOPC,PSJORL,PSJORPCL,PSJORTOI,RF,WSCHADM,PSJLM,PSJCT
"RTN","PSJOE",48,0)
 K DIU,DRGI,FLAG,FQC,ND2,PRI,PSGOE,PSGPRI,PSGSDN,PSGOEDMR,PSGOEPR,PSGPTS,PSGTOL,PSGTOO,PSGUOW,PSJIVOF,PSJOCNT,PSJON,PSJORQF,PSJORTOU,PSJORVP
"RTN","PSJOE",49,0)
 K PSIVENO,PSGRMV,PSGRMVT,PSGDUR,PSGRF,ND2P1 ;*315
"RTN","PSJOE",50,0)
 G:$G(PSGPXN) ^PSGPER1 D ENIVKV^PSGSETU
"RTN","PSJOE",51,0)
 Q
"RTN","PSJOE",52,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSJOE",53,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSJOE",54,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSJOE",55,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSJOE",56,0)
 Q:PSGP<0
"RTN","PSJOE",57,0)
 S (DFN,PSGOP)=PSGP,X=""
"RTN","PSJOE",58,0)
 Q
"RTN","PSJOE",59,0)
SELECT ; Select order from list
"RTN","PSJOE",60,0)
 ;Variable PSJOCDSC is used in Complex order dosing checks
"RTN","PSJOE",61,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC,PSJAGYSV K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJSTARI,^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",62,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE",63,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON
"RTN","PSJOE",64,0)
 I "^"[X S VALMQUIT=1 Q
"RTN","PSJOE",65,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL!($G(Y)<0)  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",66,0)
 .K PSJOCDSC
"RTN","PSJOE",67,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA Q:PSJORD=""!($G(Y)<0)  Q:PSJORD=+PSJORD  D
"RTN","PSJOE",68,0)
 ..Q:('$$LS^PSSLOCK(PSGP,PSJORD))
"RTN","PSJOE",69,0)
 ..Q:PSJORD=+PSJORD
"RTN","PSJOE",70,0)
 ..S PSGORD=""
"RTN","PSJOE",71,0)
 ..D DISACTIO(PSGP,PSJORD,"") S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",72,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",73,0)
 S VALMBCK="Q"
"RTN","PSJOE",74,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",75,0)
 Q
"RTN","PSJOE",76,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOE",77,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOE",78,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOE",79,0)
 ; PSJDSVFY - Flag if non-vf order was edited
"RTN","PSJOE",80,0)
 ; PSJENHOC=1 if DI,DT were display. This will be used by dosing OC to check if error messages should display or not
"RTN","PSJOE",81,0)
 ; PSJAGYSV=1 If UD was edited
"RTN","PSJOE",82,0)
 ;N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJDSVFY,PSJENHOC,PSJAGYSV
"RTN","PSJOE",83,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJDSVFY,PSJENHOC,PSIVENO,PSJBACK
"RTN","PSJOE",84,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE",85,0)
 K PSJEXCPT("PROSPECTIVE") ;*256  
"RTN","PSJOE",86,0)
 D OLDCOM^PSJOE0(DFN,PSJORD)
"RTN","PSJOE",87,0)
 S PSGP=DFN D ENIV^PSJAC I PSJORD["V" D EN^PSJLIORD(DFN,PSJORD) Q
"RTN","PSJOE",88,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOE",89,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",90,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOE",91,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOE",92,0)
 . I PSJORD["U" L +^PS(55,PSGP,5,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",93,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",94,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOE",95,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOE",96,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",97,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",98,0)
 .K:$P($G(PSJXX1),U,4)="U" PSIVFLG ;p344
"RTN","PSJOE",99,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOE",100,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOE",101,0)
 .. N ON S ON=PSJORD D VF^PSIVORC2
"RTN","PSJOE",102,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOE",103,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOE",104,0)
 ..I $P(PSJXX1,U,4)="U" D  Q:$G(PSJIVFLG)
"RTN","PSJOE",105,0)
 ... N VAIP S CLINIC=$G(^PS(53.1,+PSJORD,"DSS")),APPT=$P(CLINIC,"^",2),CLINIC=$P(CLINIC,"^") I $$PATCH^XPDUTL("SD*5.3*285") S PSJBACK=$$SDIMO^SDAMA203(CLINIC,DFN) I PSJBACK'<-1 Q
"RTN","PSJOE",106,0)
 ... Q:'PSJPDD  W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1
"RTN","PSJOE",107,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOE",108,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOE",109,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOE",110,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM,PSJOCFG S PSJLM=1,PSGORD=PSJORD,PSJOCFG="FN UD" D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD) S:$G(PSJTUD) PSJOCFG="FN UD" D @$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") K PSJOCFG Q
"RTN","PSJOE",111,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD,PSJOCFG="FN IV" D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI,PSJOCFG
"RTN","PSJOE",112,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOE",113,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE",114,0)
 I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOE",115,0)
 I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOE",116,0)
 ;Send SN to CPRS if auto-verify OFF and Order Set Entry and no 21st piece
"RTN","PSJOE",117,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",118,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOE",119,0)
 I $G(PSGOEAV),($G(PSGOES)=1) D SETOC ;Store allergy for order set /w auto vf 
"RTN","PSJOE",120,0)
 I '$G(PSGOEAV),($G(PSJORD)["P"),$S($G(PSJAGYSV):1,($G(PSJOCFG)="NEW UD"):1,1:0) D SETOC
"RTN","PSJOE",121,0)
 ; -- RTC 236646
"RTN","PSJOE",122,0)
 K ^TMP("PSODAOC",$J,"ALLERGY")
"RTN","PSJOE",123,0)
 D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",124,0)
 Q
"RTN","PSJOE",125,0)
SETOC ;
"RTN","PSJOE",126,0)
 ;RTC 178789 
"RTN","PSJOE",127,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSJORD
"RTN","PSJOE",128,0)
 D SETOC^PSJNEWOC(PSJORD)
"RTN","PSJOE",129,0)
 K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J),PSJAGYSV,PSJOCFG
"RTN","PSJOE",130,0)
 Q
"RTN","PSJOE",131,0)
EDIT(PSGP,PSGORD,PROMPT) ;
"RTN","PSJOE",132,0)
 N PSJOP,ANQX,PSGEDT
"RTN","PSJOE",133,0)
 S (ANQX,PSJOP)=0,PSGEDT=1
"RTN","PSJOE",134,0)
 S PSJOP=+Y(1)
"RTN","PSJOE",135,0)
 S PSJOP=$S(PSJOP=9:0,PSJOP=11:0,1:1)
"RTN","PSJOE",136,0)
 ;/RBN Begin modification for NCC moved code to ACT^PSGOEE
"RTN","PSJOE",137,0)
 I "DE"[$$GTSTATUS(PSGP,PSGORD) W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",138,0)
 I PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",139,0)
 N PSJEDITO S PSJEDITO=1
"RTN","PSJOE",140,0)
 S PSJAGYSV=1 ;Flag to store allergy data in 100.05.
"RTN","PSJOE",141,0)
 S PSGNEDFD="" D HOLDHDR,@$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") I 'Y D ABORT^PSGOEE Q
"RTN","PSJOE",142,0)
 I PSGORD["P" D ENF^PSGOEE Q
"RTN","PSJOE",143,0)
 D ACT^PSGOEE
"RTN","PSJOE",144,0)
 Q
"RTN","PSJOE",145,0)
RENEW(PSGP,PSGORD) ;
"RTN","PSJOE",146,0)
 ;PSJOCFG - If defined, it's for new order, renew or copy. ^PSJOCDSD using this flag to not display drug error.
"RTN","PSJOE",147,0)
 ;/RJS Begin modifications for PSJ*5.0*327
"RTN","PSJOE",148,0)
 I $$ISCLOZ^PSJCLOZ(,,PSGP,+PSGORD) D  Q
"RTN","PSJOE",149,0)
 .W !,"Clozapine orders cannot be renewed."
"RTN","PSJOE",150,0)
 .W !,"No order entered!"
"RTN","PSJOE",151,0)
 .D PAUSE^VALM1
"RTN","PSJOE",152,0)
 ;/RJS End modifications for PSJ*5.0*327
"RTN","PSJOE",153,0)
 NEW PSJOCFG
"RTN","PSJOE",154,0)
 S PSJOCFG="RENEW UD"
"RTN","PSJOE",155,0)
 D HOLDHDR
"RTN","PSJOE",156,0)
 I 'PSJSYSU,$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,15),$P($G(^(4)),U,16) W !!,"This order is already marked for renewal!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJOE",157,0)
 I 'PSGRRF D ^PSGOER K PSJOCFG Q
"RTN","PSJOE",158,0)
 D ^PSGOERI
"RTN","PSJOE",159,0)
 K PSJOCFG
"RTN","PSJOE",160,0)
 Q
"RTN","PSJOE",161,0)
GTSTATUS(DFN,ON)   ;
"RTN","PSJOE",162,0)
 I ON["P" Q $P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSJOE",163,0)
 I ON["U" Q $P($G(^PS(55,DFN,5,+ON,0)),U,9)
"RTN","PSJOE",164,0)
 Q $P($G(^PS(55,DFN,"IV",+ON,0)),U,17)
"RTN","PSJOE",165,0)
DC(DFN,PSJORD) ; DC IV, UD, or pending orders.
"RTN","PSJOE",166,0)
 D HOLDHDR
"RTN","PSJOE",167,0)
 S X=$$GTSTATUS(DFN,PSJORD) I X="D"!(X="DE")!(X="R") W !,$S(X="R":"This order has a pending renewal and cannot be DISCONTINUED.",1:"This order has already been DISCONTINUED.") D PAUSE^VALM1 Q
"RTN","PSJOE",168,0)
 D ENO^PSGOEC(DFN,PSJORD) ;,GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S VALMBCK="Q"
"RTN","PSJOE",169,0)
 S VALMBCK="Q"
"RTN","PSJOE",170,0)
 Q
"RTN","PSJOE",171,0)
HOLD(DFN,PSJORD) ; Change order's status from ACTIVE<->HOLD
"RTN","PSJOE",172,0)
 D HOLDHDR
"RTN","PSJOE",173,0)
 I PSJORD["V" D H^PSIVOPT(DFN,PSJORD,P(17),P(3))
"RTN","PSJOE",174,0)
 I PSJORD'["V" D H^PSGOE1(DFN,PSJORD)
"RTN","PSJOE",175,0)
 D GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S PSGACT=$$ENACTION^PSGOE1(DFN,PSJORD),VALMBCK="R"
"RTN","PSJOE",176,0)
 Q
"RTN","PSJOE",177,0)
COPY(PSGP,PSGORD)  ; Copy an order (does not discontinue original order)
"RTN","PSJOE",178,0)
 N PSJOCFG
"RTN","PSJOE",179,0)
 ; PSJ*5*327 - disallow copy for clozapine
"RTN","PSJOE",180,0)
 I $D(^PS(55,PSGP,5,+PSGORD,"SAND")) W !!,"You cannot copy a clozapine order." D PAUSE^VALM1 Q
"RTN","PSJOE",181,0)
 I $D(PSGCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",182,0)
 I PSGORD["P" W !!,"You cannot copy this "_$S($G(PSGSTAT)]"":PSGSTAT,1:"PENDING IV")_" order." D PAUSE^VALM1 Q
"RTN","PSJOE",183,0)
 I PSGORD["V" D  Q
"RTN","PSJOE",184,0)
 .I $G(PSIVCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",185,0)
 .S PSJOCFG="COPY IV"
"RTN","PSJOE",186,0)
 .D COPY^PSIVOD(PSGP,PSGORD) K PSJOCFG Q
"RTN","PSJOE",187,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")
"RTN","PSJOE",188,0)
 D ^PSJHVARS
"RTN","PSJOE",189,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSJOE",190,0)
 S PSJOCFG="COPY UD"
"RTN","PSJOE",191,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSJOE",192,0)
 S PSGCOPY=1,ANQX=0
"RTN","PSJOE",193,0)
 D FULL^VALM1,^PSGOD
"RTN","PSJOE",194,0)
 ;/RBN Begin modifications PSJ*5.0*327
"RTN","PSJOE",195,0)
 I $G(ANQX) K PSGCOPY Q
"RTN","PSJOE",196,0)
 ;/RBN End modifications PSJ*5.0*327
"RTN","PSJOE",197,0)
 S VALMBCK="R"
"RTN","PSJOE",198,0)
 K PSGCOPY,PSJOCFG
"RTN","PSJOE",199,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSJOE",200,0)
 I $G(PSGPXN) N PSGTMPXN S PSGTMPXN=PSGPXN
"RTN","PSJOE",201,0)
 D RESTORE^PSJHVARS I $G(PSGTMPXN) S PSGPXN=PSGTMPXN
"RTN","PSJOE",202,0)
 Q
"RTN","PSJOE",203,0)
UPDATE  ; Refresh array, actions, & display.
"RTN","PSJOE",204,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJOE",205,0)
 Q
"RTN","PSJOE",206,0)
FINISH ;
"RTN","PSJOE",207,0)
 D FINISH^PSGOEF,PAUSE^VALM1
"RTN","PSJOE",208,0)
 Q
"RTN","PSJOE",209,0)
LOG(DFN,PSGORD) ;
"RTN","PSJOE",210,0)
 D FULL^VALM1,ENLM^PSGOEL(DFN,PSGORD),PAUSE^VALM1 S VALMBCK="R"
"RTN","PSJOE",211,0)
 Q
"RTN","PSJOE",212,0)
NEWSEL ;
"RTN","PSJOE",213,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC,PSJAGYSV K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",214,0)
 K PSGRMVT,PSGRMV,PSGDUR,PSGRF,ND2P1,PSGOROE1
"RTN","PSJOE",215,0)
 ;; START NCC REMEDIATION >> 327*RJS  ; Freeze header text while processing order actions
"RTN","PSJOE",216,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",217,0)
 ;; END NCC REMEDIATION << 327*RJS
"RTN","PSJOE",218,0)
 S X=$P(XQORNOD(0),"=",2)
"RTN","PSJOE",219,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0)
"RTN","PSJOE",220,0)
 D ENCHK^PSGON I '$O(PSGODDD(0)) S VALMQUIT=1 Q
"RTN","PSJOE",221,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",222,0)
 .K PSJOCDSC,PSGDRG
"RTN","PSJOE",223,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA
"RTN","PSJOE",224,0)
 .Q:PSJORD=+PSJORD 
"RTN","PSJOE",225,0)
 .Q:PSJORD=""!($G(Y)<0)  Q:('$$LS^PSSLOCK(PSGP,PSJORD))  D
"RTN","PSJOE",226,0)
 ..S PSGORD=""
"RTN","PSJOE",227,0)
 ..S ON=PSJORD
"RTN","PSJOE",228,0)
 ..D DISACTIO(PSGP,PSJORD,$G(PSJPNV)) S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",229,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",230,0)
 ..I $G(PSJNOL) K PSJNOL I $D(ON),ON'=PSJORD D UNL^PSSLOCK(PSGP,ON)
"RTN","PSJOE",231,0)
 ..Q:$G(Y)<0
"RTN","PSJOE",232,0)
 I '$G(PSGOEAV),($G(PSJORD)["P"),$G(PSJAGYSV) D
"RTN","PSJOE",233,0)
 .;RTC 178789 
"RTN","PSJOE",234,0)
 .S ^TMP("PSODAOC",$J,"IP IEN")=PSJORD
"RTN","PSJOE",235,0)
 .D SETOC^PSJNEWOC(PSJORD)
"RTN","PSJOE",236,0)
 .K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J),PSJAGYSV
"RTN","PSJOE",237,0)
 S VALMBCK="Q"
"RTN","PSJOE",238,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",239,0)
 Q
"RTN","PSJOE",240,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJOE",241,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",242,0)
 Q
"RTN","PSJOE",243,0)
LOCKERR ;
"RTN","PSJOE",244,0)
 W !!,$C(7),"You are entering or editing an Inpatient Medication order in another session.",!,"Only one order entry/edit session is allowed for a user at a time.",!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJOE",245,0)
 Q
"RTN","PSJOE",246,0)
FLAG(DFN,PSJORD) ;Flag order through CPRS entry point.
"RTN","PSJOE",247,0)
 N ORIFN,NODE0
"RTN","PSJOE",248,0)
 S NODE0=$S(PSJORD["V":$G(^PS(55,DFN,"IV",+PSJORD,0)),PSJORD["U":$G(^PS(55,DFN,5,+PSJORD,0)),1:^PS(53.1,+PSJORD,0))
"RTN","PSJOE",249,0)
 S ORIFN=$P(NODE0,"^",21)
"RTN","PSJOE",250,0)
 D EN1^ORCFLAG(ORIFN)
"RTN","PSJOE",251,0)
 D PAUSE^VALM1
"RTN","PSJOE",252,0)
 Q
"RTN","PSJOE",253,0)
COMPLEX(DFN,ON) ;
"RTN","PSJOE",254,0)
 N NDP2,COM
"RTN","PSJOE",255,0)
 S NDP2=$S(ON["P":$G(^PS(53.1,+ON,.2)),ON["U":$G(^PS(55,DFN,5,+ON,.2)),ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:"")
"RTN","PSJOE",256,0)
 S COM=$P(NDP2,"^",8) I COM Q 1
"RTN","PSJOE",257,0)
 Q 0
"RTN","PSJOE",258,0)
CLOZSND ; SEND CLOZAPINE OVERRIDE MESSAGE AND ORDER TO HINES DB
"RTN","PSJOE",259,0)
 ; START NCC REMEDIATION >> 327*RJS
"RTN","PSJOE",260,0)
 D PSJFILE^PSJCLOZ(DFN),INPSND^YSCLTST5
"RTN","PSJOE",261,0)
 ; END NCC REMEDIATION << 327*RJS
"RTN","PSJOE",262,0)
 Q
"RTN","PSJOE1")
0^20^B42053305
"RTN","PSJOE1",1,0)
PSJOE1 ;BIR/CML3-UD OE FOR COMBINED OE ;12 June 2019 09:31:53
"RTN","PSJOE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,25,30,47,56,64,179,181,252,281,315,338,373,353,327**;16 DEC 97;Build 114
"RTN","PSJOE1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOE1",4,0)
 ; Reference to ^DICN via DBIA 10009
"RTN","PSJOE1",5,0)
 ; Reference to ^VALM via DBIA 10118
"RTN","PSJOE1",6,0)
 ; Reference to ^TMP("PSODAOC",$J) via DBIA 6071
"RTN","PSJOE1",7,0)
 ;
"RTN","PSJOE1",8,0)
 ;*353 Haz Meds cleanup var
"RTN","PSJOE1",9,0)
 ;
"RTN","PSJOE1",10,0)
 S PC=0 G AD
"RTN","PSJOE1",11,0)
 ;
"RTN","PSJOE1",12,0)
EN ;
"RTN","PSJOE1",13,0)
 S PC=0
"RTN","PSJOE1",14,0)
 ;
"RTN","PSJOE1",15,0)
AD ; Ask Drug
"RTN","PSJOE1",16,0)
 ;PSJOCFG - If defined, it's for new order, renew or copy. ^PSJOCDSD using this flag to not display drug error.
"RTN","PSJOE1",17,0)
 K PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1,ANQX ;*315
"RTN","PSJOE1",18,0)
 K PSGDRG,PSGDRGN    ;*353
"RTN","PSJOE1",19,0)
 N PSJNORD,PSGORQF,PSGSDX,PSGFDX,PSGNEFDO,PSGEDTOI,PSJOCFG,PSGDREQ S PSJOCFG="NEW UD" S PSJNORD=1 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC,@IOSTBM,IORC
"RTN","PSJOE1",20,0)
 K PSGORQF
"RTN","PSJOE1",21,0)
 D ^PSGOE7
"RTN","PSJOE1",22,0)
 I $G(PSGORQF) S PSJORQF=1 G DONE
"RTN","PSJOE1",23,0)
 S PC=1,PSJORQF=0 I X?1"S."1.E D ^PSGOES G AD
"RTN","PSJOE1",24,0)
 D ^PSGOE4:'$P(PSJSYSP0,"^",12),^PSGOE3:$P(PSJSYSP0,"^",12)
"RTN","PSJOE1",25,0)
 G:$G(PSGOROE1)=1 AD
"RTN","PSJOE1",26,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSJOE1",27,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGPD=PSGPDRG,PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJOE1",28,0)
 S:$D(PSJOCFG) PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC2^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC2^PSGMI(PSGNEFD) ;#373
"RTN","PSJOE1",29,0)
 S PSGAT=PSGS0Y,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT,PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSJOE1",30,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSJOE1",31,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSJOE1",32,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSJOE1",33,0)
 I $G(PSJACEPT)=1 D  I $G(ANQX) D DONE G AD
"RTN","PSJOE1",34,0)
 . D OC
"RTN","PSJOE1",35,0)
 . ;D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",+$G(PSGDRG))
"RTN","PSJOE1",36,0)
 ;If intervention is not log then quit
"RTN","PSJOE1",37,0)
 I $G(PSGORQF)=1 S PSJACEPT=0
"RTN","PSJOE1",38,0)
 S PSJNOO=-1 I $G(PSJACEPT)=1 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSJOE1",39,0)
 I $G(PSJNOO)<0 D 
"RTN","PSJOE1",40,0)
 . I $$ISCLOZ^PSJCLOZ(,PSGPD) K ^XTMP("PSJ4D-"_$G(DFN)) ;p327
"RTN","PSJOE1",41,0)
 I $G(PSJNOO)<0 K PSJACEPT W !,"No order created." G AD
"RTN","PSJOE1",42,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD
"RTN","PSJOE1",43,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJOE1",44,0)
 I $G(PSODAND) S ^TMP("PSJCOM",$J,+PSGORD,"SAND")=PSODAND
"RTN","PSJOE1",45,0)
 ;RTC 178746 - Don't store allergy here.
"RTN","PSJOE1",46,0)
 ;D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",47,0)
 I PSGOEAV D  G AD
"RTN","PSJOE1",48,0)
 .;; START NCC REMEDIATION >> 327*RJS
"RTN","PSJOE1",49,0)
 .I $$ISCLOZ^PSJCLOZ(,PSGPD) D
"RTN","PSJOE1",50,0)
 ..N DIE,DA,DR S DIE="^PS(55,"_PSGP_",5,",DA=+$G(PSGORD),DA(1)=PSGP,DR="301////"
"RTN","PSJOE1",51,0)
 ..I $G(PSGNTDD) S DR=DR_PSGNTDD
"RTN","PSJOE1",52,0)
 ..E  I $G(PSGETDD) S DR=DR_PSGETDD
"RTN","PSJOE1",53,0)
 ..E  I $G(PSGCTDD) S DR=DR_PSGCTDD
"RTN","PSJOE1",54,0)
 ..E  I $D(^TMP($J,"PSGCLOZ",PSGP,+$G(PSGORD),"SAND")) S DR=DR_$G(^TMP($J,"PSGCLOZ",PSGP,+$G(PSGORD),"SAND")) K ^TMP($J,"PSGCLOZ",PSGP,+$G(PSGORD),"SAND")
"RTN","PSJOE1",55,0)
 ..D ^DIE
"RTN","PSJOE1",56,0)
 ..D CLOZSND^PSJOE ; SEND OVERRIDE MESSAGE & XTMP TRANSACTION DATA
"RTN","PSJOE1",57,0)
 .;; END NCC REMEDIATION >> 327*RJS
"RTN","PSJOE1",58,0)
 . D SETOC^PSJNEWOC(PSGORD) ;RTC 17874
"RTN","PSJOE1",59,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSJOE1",60,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE1",61,0)
 ;RTC 178746 - store allergy if not verify the newly created order.
"RTN","PSJOE1",62,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="NEW UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",63,0)
 G AD
"RTN","PSJOE1",64,0)
 Q
"RTN","PSJOE1",65,0)
OC ;
"RTN","PSJOE1",66,0)
 NEW PSJDD,PSJALLGY,PSJALGY1
"RTN","PSJOE1",67,0)
 K PSGORQF
"RTN","PSJOE1",68,0)
 ;; START NCC REMEDIATION >> 327*RJS
"RTN","PSJOE1",69,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,PSGPD) I CLOZFLG D  Q:$G(ANQX)
"RTN","PSJOE1",70,0)
 .S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S (CHK,ANQX)=1 Q
"RTN","PSJOE1",71,0)
 .S (PSGNTDD,PSODAND)=X,PSGDN=$P(CLOZFLG,U,2)
"RTN","PSJOE1",72,0)
 ;; END NCC REMEDIATION >> 327*RJS
"RTN","PSJOE1",73,0)
 D FULL^VALM1
"RTN","PSJOE1",74,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSJOE1",75,0)
 I +$G(PSGEDTOI) D
"RTN","PSJOE1",76,0)
 . S PSJALGY1=1
"RTN","PSJOE1",77,0)
 . D ENDDC^PSGSICHK($G(PSGP),PSJDD)
"RTN","PSJOE1",78,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSJOE1",79,0)
 Q
"RTN","PSJOE1",80,0)
EDIT(PROMPT) ;
"RTN","PSJOE1",81,0)
 ; Edit fields in a UD order.
"RTN","PSJOE1",82,0)
 ; PROMPT=0 - Select fields to edit by number.
"RTN","PSJOE1",83,0)
 ; PROMPT=1 - Prompt to select fields for editing.
"RTN","PSJOE1",84,0)
 ;
"RTN","PSJOE1",85,0)
 ;* D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S PSGOEEG=3 D EDIT^PSGOEE ;$S(PSGOEEWF[53.1:3,1:5) D:Y EDIT^PSGOEE
"RTN","PSJOE1",86,0)
 D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S:$G(PSJNEWOE) PSGOEEWF="^PS(53.1," S PSGOEEG=$S('$D(PSGOEEWF):3,PSGOEEWF[53.1:3,1:5) D EDIT^PSGOEE
"RTN","PSJOE1",87,0)
 I $G(PSJNEWOE) S PSGOEENO=0,DR="",VALMBCK="R"
"RTN","PSJOE1",88,0)
 I '$G(PSJNEWOE) D ENNOU^PSGOEE0 I 'PSGOEENO,DR="" S VALMBCK="R" Q
"RTN","PSJOE1",89,0)
 I 'PSGOEENO,$D(PSGOES) D ENNOU^PSGOEE0  ; only update on order sets
"RTN","PSJOE1",90,0)
 ;*179 No longer call CKDT^PSGOEE from here.
"RTN","PSJOE1",91,0)
 ;I 'PSGOEENO,$G(PSGPDNX)=1 D CKDT^PSGOEE
"RTN","PSJOE1",92,0)
 I $G(PSGOEER)["101^PSGOE8" S PSGEDTOI=1
"RTN","PSJOE1",93,0)
 K VALMSG I PSGOEENO D
"RTN","PSJOE1",94,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS^PSGOEE,CHKDD^PSGOEE,CKDT^PSGOEE ;*373
"RTN","PSJOE1",95,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT
"RTN","PSJOE1",96,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSJOE1",97,0)
 D INIT^PSJLMUDE(PSGP,$G(PSGORD))
"RTN","PSJOE1",98,0)
 Q
"RTN","PSJOE1",99,0)
DONE ;
"RTN","PSJOE1",100,0)
 K %,DA,DIC,DIE,DR,DRG,DRGN,DRGO,ND,OC,ORIFN,ORIT,ORPK,ORSTOP,ORSTRT,ORSTS,ORTX,PC,PSGDO,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOROE1,PSGORD,PSGS0XT,PSGS0Y,PSGSCH,PSGSI,PSGX,Y,Z
"RTN","PSJOE1",101,0)
 K PSGEDTOI,PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2,ND2P1 ;*315
"RTN","PSJOE1",102,0)
 Q
"RTN","PSJOE1",103,0)
 ;
"RTN","PSJOE1",104,0)
GDO ;
"RTN","PSJOE1",105,0)
 W !!,"Drug is not found in Formulary List." F  S %=1 W !,"Would you like to try to search the list again" D YN^DICN Q:%  D TAM
"RTN","PSJOE1",106,0)
 Q:%<2
"RTN","PSJOE1",107,0)
FTD ;
"RTN","PSJOE1",108,0)
 R !!,"Enter FREE TEXT DRUG: ",PSGDRGN:DTIME E  W $C(7) S PSGDRGN="^" Q
"RTN","PSJOE1",109,0)
 Q:"^"[PSGDRGN  S X=$S(PSGDRGN'?.ANP:"Control character(s)",PSGDRGN["^":"Up-arrow ('^') in text",$L(PSGDRGN)>39:"Response longer than 39 characters",1:"") I X]"" W $C(7),"  ??",!?2,"(",X," not allowed.)" G FTD
"RTN","PSJOE1",110,0)
 Q:PSGDRGN'?1."?"
"RTN","PSJOE1",111,0)
 W !!?2,"ENTER DRUG ORDERED (1-39 CHARACTERS).",!?2,"Since the drug cannot be found in the DRUG file, enter the drug name here",!,"exactly as ordered.  Press the RETURN key (or enter an '^') to skip over this",!,"drug, or to again search the"
"RTN","PSJOE1",112,0)
 W " DRUG file for this one." G FTD
"RTN","PSJOE1",113,0)
 ;
"RTN","PSJOE1",114,0)
TAM ; Try Again Message
"RTN","PSJOE1",115,0)
 W !!,"  Enter a 'Y' to try again to find the drug ordered from the Formulary.  (The",!,"order cannot become active until a Formulary drug has been entered.)  Enter 'N'",!,"to enter the drug ordered as free text for later reference."
"RTN","PSJOE1",116,0)
 W "  Enter '^' to exit.",! Q
"RTN","PSJOEA")
0^36^B34137251
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;12 June 2019 09:31:53
"RTN","PSJOEA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,167,171,254,315,367,327**;16 DEC 97;Build 114
"RTN","PSJOEA",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 via DBIA #2191
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM via DBIA #10118
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK via DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT via DBIA #10035
"RTN","PSJOEA",8,0)
 ; Reference to SDIMO^SDAMA203 via DBIA #4133
"RTN","PSJOEA",9,0)
 ;
"RTN","PSJOEA",10,0)
LOCK(DFN,PSJORD) ; Check if the order is locked
"RTN","PSJOEA",11,0)
 N Q S Q=0
"RTN","PSJOEA",12,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",13,0)
 I Q Q 1
"RTN","PSJOEA",14,0)
 Q 0
"RTN","PSJOEA",15,0)
 ;
"RTN","PSJOEA",16,0)
SELECT ;
"RTN","PSJOEA",17,0)
 N PSJCLIN,O
"RTN","PSJOEA",18,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",19,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",20,0)
 .S PSGORD="" S ON=PSJO_"P"
"RTN","PSJOEA",21,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",22,0)
 K PSGCOMP,PSGFLG  ; CLEAN UP VARIABLE FOR COMPLEX ORDER MESSAGE  RJS*327
"RTN","PSJOEA",23,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",24,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",25,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",26,0)
 .L -^PS(53.1,PSJO) ; p367 
"RTN","PSJOEA",27,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") ; Q:$G(Y)<0 p367 commented quit out
"RTN","PSJOEA",28,0)
 ; p367 Unlock complex orders (file 100) after verification of all child orders in the complex order. 
"RTN","PSJOEA",29,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCVFY",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",30,0)
 .N PSJIDX S PSJIDX=$G(^TMP("PSJCVFY",$J,PSJO))
"RTN","PSJOEA",31,0)
 .D UNL^PSSLOCK(PSGP,PSJIDX) K ^TMP("PSJCVFY",$J,PSJO),PSJIDX
"RTN","PSJOEA",32,0)
 D DONE
"RTN","PSJOEA",33,0)
 Q
"RTN","PSJOEA",34,0)
 ;
"RTN","PSJOEA",35,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",36,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",37,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",38,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",39,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJAPPT
"RTN","PSJOEA",40,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",41,0)
 Q:$G(PSJCLIN)=-2
"RTN","PSJOEA",42,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",43,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",44,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",45,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",46,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",47,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",48,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",49,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",50,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",51,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",52,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",53,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",54,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",55,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",56,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",57,0)
 ..N VAIP S PSJCLIN=$G(^PS(53.1,+PSJORD,"DSS")),PSJAPPT=$P(PSJCLIN,"^",2),PSJCLIN=$P(PSJCLIN,"^")
"RTN","PSJOEA",58,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) D  Q:(PSJCLIN=-2)
"RTN","PSJOEA",59,0)
 ...I $$PATCH^XPDUTL("SD*5.3*285"),($$SDIMO^SDAMA203(PSJCLIN,DFN)>-1) Q
"RTN","PSJOEA",60,0)
 ...W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1,PSJCLIN=-2
"RTN","PSJOEA",61,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",62,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",63,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",64,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") D  Q
"RTN","PSJOEA",65,0)
 ...K ^TMP("PSJINTER",$J),PSJOVR
"RTN","PSJOEA",66,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",67,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",68,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",69,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",70,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",71,0)
 Q
"RTN","PSJOEA",72,0)
 ;
"RTN","PSJOEA",73,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",74,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",75,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",76,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",77,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",78,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",79,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",80,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",81,0)
 Q
"RTN","PSJOEA",82,0)
 ;
"RTN","PSJOEA",83,0)
UD ;
"RTN","PSJOEA",84,0)
 N DA,DR,DIE,PSJCMPDA D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA S PSJCMPDA=DA
"RTN","PSJOEA",85,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+PSJCMPDA_"U")
"RTN","PSJOEA",86,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2,ND2P1
"RTN","PSJOEA",87,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,PSJCMPDA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,PSJCMPDA,0)),"^",7)
"RTN","PSJOEA",88,0)
 S ND2=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",89,0)
 S ND2P1=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGRMVT=$P(ND2P1,"^",2) ;*315
"RTN","PSJOEA",90,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO) K PSJPREX
"RTN","PSJOEA",91,0)
 I $G(PSJCMPDA) D CMPLX2^PSJCOM1(PSGP,PSJORD,+PSJCMPDA_"U") I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA",92,0)
 Q
"RTN","PSJOEA",93,0)
IV ; 
"RTN","PSJOEA",94,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",95,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",96,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",97,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",98,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",99,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK K DA,DIK
"RTN","PSJOEA",100,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",101,0)
 Q
"RTN","PSJOEA",102,0)
 ;
"RTN","PSJOEA",103,0)
DONE ; Clean up
"RTN","PSJOEA",104,0)
 K PSGPD,PSGPDN,PSGSCH,PSIVACT,PSJNOO
"RTN","PSJOEA",105,0)
 Q
"RTN","PSJOEA1")
0^37^B31482767
"RTN","PSJOEA1",1,0)
PSJOEA1 ;BIR/MLM-INPATIENT ORDER ENTRY ;Jul 26, 2017@18:04:02
"RTN","PSJOEA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,171,254,382,327**;16 DEC 97;Build 114
"RTN","PSJOEA1",3,0)
 ;
"RTN","PSJOEA1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA1",6,0)
 ;
"RTN","PSJOEA1",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed.
"RTN","PSJOEA1",8,0)
 N COMQUIT,PSJCOMV,PSJOT,PSJSTAT,PSJSTAT2,PSGND2P5,DUR,ND14,PSJPREX S (PSJCOMV,COMQUIT)=0,PSJSTAT2="" K ^TMP("PSJINTER",$J)
"RTN","PSJOEA1",9,0)
 I '$D(^TMP("PSJCOM",$J)) Q
"RTN","PSJOEA1",10,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:COMQUIT  S PSJOT=$P(^PS(53.1,PSJO,0),"^",4) D
"RTN","PSJOEA1",11,0)
 . I '$D(^TMP("PSJCOM",$J,PSJO,0)) M ^TMP("PSJCOM",$J,PSJO)=^PS(53.1,PSJO) I '$D(^TMP("PSJCOM",$J,PSJO,0)) S COMQUIT=2 Q:COMQUIT
"RTN","PSJOEA1",12,0)
 . S PSJSTAT=$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)
"RTN","PSJOEA1",13,0)
 . I PSJSTAT="DE" S PSJSTAT=$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9) I PSJSTAT="" S COMQUIT=1 Q
"RTN","PSJOEA1",14,0)
 . S:PSJSTAT2="" PSJSTAT2=PSJSTAT S:PSJSTAT'=PSJSTAT2 COMQUIT=2 Q:COMQUIT  S PSJSTAT2=PSJSTAT
"RTN","PSJOEA1",15,0)
 I COMQUIT,PSJOT="U",$G(^TMP("PSJCOM",$J))'="A" S:$G(PSJOWALL)]"" $P(^PS(55,PSGP,5.1),U)=PSJOWALL
"RTN","PSJOEA1",16,0)
 I (COMQUIT=2)!(COMQUIT&($G(^TMP("PSJCOM",$J))'="A")) D  Q
"RTN","PSJOEA1",17,0)
 .K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSGCMPLX,PSGTMPSD
"RTN","PSJOEA1",18,0)
 .W !,"By not finishing all the orders, none of the orders will be updated." D PAUSE^VALM1
"RTN","PSJOEA1",19,0)
 I 'COMQUIT N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA1",20,0)
 .S PSGS0Y=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5),PSGS0XT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",6)
"RTN","PSJOEA1",21,0)
 .N EDITS0Y,EDITS0XT S EDITS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5),EDITS0XT=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",6) D
"RTN","PSJOEA1",22,0)
 ..S:EDITS0Y PSGS0Y=EDITS0Y I EDITS0XT!(",O,D,"[(","_EDITS0XT_",")) S PSGS0XT=EDITS0XT
"RTN","PSJOEA1",23,0)
 .N DIE,DA,DR S DR="28////^S X=$P(^TMP(""PSJCOM"",$J,+PSJO,0),""^"",9)",DA=+PSJO,DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",24,0)
 .N DIK,DA S DIK="^PS(53.1,",DA=+PSJO S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA1",25,0)
 .M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO)
"RTN","PSJOEA1",26,0)
 .S PSGND=$G(^PS(53.1,+PSJO,0)),PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2),ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P")
"RTN","PSJOEA1",27,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,24)="R" D
"RTN","PSJOEA1",28,0)
 ..N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D
"RTN","PSJOEA1",29,0)
 ...S:'$G(PSGP) PSGP=$G(DFN) Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",30,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA1",31,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA1",32,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA1",33,0)
 ...D START^PSGOTR(+PSJO_"P",+PSGORDR) I OEORD D
"RTN","PSJOEA1",34,0)
 ....K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD
"RTN","PSJOEA1",35,0)
 ....S:$P(PNDP2,U,8) DR=DR_";125////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA1",36,0)
 ....D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(DFN,PSGORDR)
"RTN","PSJOEA1",37,0)
 ..I '$G(COMQUIT) S ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P") I $G(ND14) S DA=+$P(PSGND,U,25) I DA D
"RTN","PSJOEA1",38,0)
 ...N PSGAT S PSGAT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",39,0)
 ...D UPDREN^PSGOER(DA,$P(ND14,U),$P(ND14,U,3),$P(ND14,U,4),$P($G(^PS(53.1,+PSJO,.2)),U,3),$P(ND14,U,2))
"RTN","PSJOEA1",40,0)
 ...K PSJPREX I $G(PSGORDR)["U" I $G(PSJORD)=+$G(PSJORD) D CMPLX2^PSJCOM1(DFN,PSJORD,PSGORDR) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA1",41,0)
 .I '$G(PSGP) S:$G(DFN) PSGP=DFN
"RTN","PSJOEA1",42,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,24)="R",$P(PSGND,U,25),$P($G(^PS(53.1,+PSJO,2)),U,2)<$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3) D
"RTN","PSJOEA1",43,0)
 ..K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",""IV"",",DR=".03////"_$P($G(^PS(53.1,+PSJO,2)),U,2)_";116////"_$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3)
"RTN","PSJOEA1",44,0)
 ..D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25)) L -^PS(53.1,+PSJO)
"RTN","PSJOEA1",45,0)
 .I $P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),(",N,A,"[$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)) D
"RTN","PSJOEA1",46,0)
 ..S:'$G(PSGP) PSGP=DFN S PSGS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",47,0)
 ..N DA,DR,DIE D ENGNN^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"P",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA1",48,0)
 ..S DR="28////^S X=$P(^TMP(""PSJCOM2"",$J,+PSJO,0),""^"",9)",DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",49,0)
 ..M ^PS(53.1,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^TMP("PSJCOM2",$J,DA)=^TMP("PSJCOM2",$J,+PSJO) N PSJOCHIL S PSJOCHIL=$P(^PS(53.1,DA,.2),"^",8) I PSJOCHIL S ^PS(53.1,"ACX",+PSJOCHIL,DA)=""
"RTN","PSJOEA1",50,0)
 ..M:$D(^TMP("PSJCOM",$J,PSJO,"DSS")) ^PS(53.1,DA,"DSS")=^TMP("PSJCOM",$J,PSJO,"DSS") ; p382 move clinic data to pending order file for corrected order
"RTN","PSJOEA1",51,0)
 ..I $P(^PS(53.1,+PSJO,2),"^",5)'=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5) S $P(^PS(53.1,+PSJO,2),"^",5)=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5)
"RTN","PSJOEA1",52,0)
 ..D EN1^PSJHL2(PSGP,"OD",+PSJO_"P"),EN1^PSJHL2(PSGP,"SN",+DA_"P")
"RTN","PSJOEA1",53,0)
 ..K ^PS(53.1,"ACX",PSJORD,PSJO) L -^PS(53.1,+PSJO) L -^PS(53.1,DA)
"RTN","PSJOEA1",54,0)
 ..D SETUDINT^PSGSICH1(PSJO_"P",DA_"P")
"RTN","PSJOEA1",55,0)
 I '$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:PSJCOMV  D
"RTN","PSJOEA1",56,0)
 .I '$D(^TMP("PSJCOM",$J,PSJO)) D  Q:$G(PSJCOMV)
"RTN","PSJOEA1",57,0)
 ..N EDITND0,PREV,REAS S EDITND0=$G(^PS(53.1,+PSJO,0)) S PREV=$P(EDITND0,"^",25),REAS=$P(EDITND0,"^",24)
"RTN","PSJOEA1",58,0)
 ..I PREV,REAS="E" I $P($G(^PS(53.1,+PREV,0)),"^",9)="DE" M ^TMP("PSJCOM",$J,+PSJO)=^PS(53.1,+PSJO) K ^TMP("PSJCOM",$J,+PREV),^PS(53.1,"ACX",+PREV) Q
"RTN","PSJOEA1",59,0)
 ..S PSJCOMV=1
"RTN","PSJOEA1",60,0)
 .I $P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",'$D(^TMP("PSJCOM2",$J,PSJO,0)) S PSJCOMV=1 Q
"RTN","PSJOEA1",61,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9)'="A" S PSJCOMV=1 Q
"RTN","PSJOEA1",62,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)'="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",17)'="A" S PSJCOMV=1
"RTN","PSJOEA1",63,0)
 I ($G(COMQUIT)=2)!(($G(COMQUIT)!PSJCOMV)&$G(^TMP("PSJCOM",$J))="A") K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J) W !,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJOEA1",64,0)
 ; 
"RTN","PSJOEA1",65,0)
 D CHK^PSJOEA2
"RTN","PSJOEA1",66,0)
 Q
"RTN","PSJRXLAB")
0^7^B37749956
"RTN","PSJRXLAB",1,0)
PSJRXLAB ;ALB/RTW -  drug+lab result print ; 12/8/18 10:36am
"RTN","PSJRXLAB",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**327**;DEC 1997;Build 114
"RTN","PSJRXLAB",3,0)
 ;RTW copied from routine PSORXLAB and modified for the Inpatient NCC Clozapine inpatient pharmacy project
"RTN","PSJRXLAB",4,0)
 ;FSIG and FSIG2(formerly EN2), are brought in from PSOUTLA and PSOUTLA1 
"RTN","PSJRXLAB",5,0)
 ;a routine which loop thru the last fill order of ^PS(55 and gets
"RTN","PSJRXLAB",6,0)
 ;patients with a specific drug. then gets the lrdfn from the 
"RTN","PSJRXLAB",7,0)
 ;patient file and loops thru the patients lab data to find
"RTN","PSJRXLAB",8,0)
 ;results within the date range you specify for the lab test
"RTN","PSJRXLAB",9,0)
 ;used to minitor the drug. it then prints the patient's name
"RTN","PSJRXLAB",10,0)
 ;ssn, last fill date, and the lab test results if any.
"RTN","PSJRXLAB",11,0)
 ;this is intended as a qa minitor and should not be run for
"RTN","PSJRXLAB",12,0)
 ;more than a 30 day fill date interval, or 1 year lab test interval.
"RTN","PSJRXLAB",13,0)
 ;External ref. to ^LAB(60, is supp. by DBIA# 333
"RTN","PSJRXLAB",14,0)
 ;External ref. to ^LR(LRDFN,"CH", is supp. by DBIA# 844
"RTN","PSJRXLAB",15,0)
 ;External ref. to ^PSDRUG( is supp. by DBIA# 221
"RTN","PSJRXLAB",16,0)
 ;External ref. to ^VA(200, is supp. by DBIA# 10060
"RTN","PSJRXLAB",17,0)
PSJSITE K ^UTILITY("DIQ1",$J),DIQ,^TMP($J,"ORDERNUM") S DA=$P($$SITE^VASITE(),"^")
"RTN","PSJRXLAB",18,0)
 N PSCNT S PSCNT=0
"RTN","PSJRXLAB",19,0)
 I $G(DA) D
"RTN","PSJRXLAB",20,0)
 .S DIC=4,DIQ(0)="I",DR=".01;99" D EN^DIQ1
"RTN","PSJRXLAB",21,0)
 .S SITE=$G(^UTILITY("DIQ1",$J,4,DA,.01,"I"))_" "_$G(^UTILITY("DIQ1",$J,4,DA,99,"I"))
"RTN","PSJRXLAB",22,0)
 .K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSJRXLAB",23,0)
 S Y=DT X ^DD("DD") S SITE=$G(SITE)_" "_Y
"RTN","PSJRXLAB",24,0)
BDATE S %DT="EXTA",%DT("A")="Beginning fill date: " D ^%DT G CLEAN:Y<0 S PSJBD=Y X ^DD("DD") S PSJBDR=Y
"RTN","PSJRXLAB",25,0)
EDATE S %DT("A")="Ending last fill date: " D ^%DT G CLEAN:Y<0 S PSJED=Y X ^DD("DD") S PSJEDR=Y
"RTN","PSJRXLAB",26,0)
LDATE S %DT("A")="Earliest date for lab results: " D ^%DT G CLEAN:Y<0 S LDATE=Y X ^DD("DD") S LDATER=Y
"RTN","PSJRXLAB",27,0)
DRUG R !,"Enter the key word in the Drug Generic name: ",PSJDRUG:DTIME G CLEAN:'$T I "^"[PSJDRUG G CLEAN
"RTN","PSJRXLAB",28,0)
 N DRGARRAY D LIST^DIC(50,,.01,"I",,,$$UP^XLFSTR(PSJDRUG),"B",,,"DRGARRAY")
"RTN","PSJRXLAB",29,0)
 I 'DRGARRAY("DILIST",0) W !,"No corresponding entry, try again or type return to exit" G DRUG
"RTN","PSJRXLAB",30,0)
 S PSJDRUG=$$UP^XLFSTR(PSJDRUG)
"RTN","PSJRXLAB",31,0)
LABT S DIC="^LAB(60,",DIC(0)="QEAM" D ^DIC K DIC G:Y<0 CLEAN S PSJLBT=$P(Y,"^"),PSJLABTN=$P(Y,"^",2) G:PSJLBT="" CLEAN
"RTN","PSJRXLAB",32,0)
 ;I '$D(^LAB(60,PSJLBT,.2)) W !!,$C(7),"Data Name missing !!",! K Y,PSJLBT G LABT
"RTN","PSJRXLAB",33,0)
 S PSJLABT=$$GET1^DIQ(60,PSJLBT,400,"I")
"RTN","PSJRXLAB",34,0)
 W !,"Enter the specimen used in the lab for this test, serum, plasma, blood etc."
"RTN","PSJRXLAB",35,0)
PSJSP S DIC="^LAB(61,",DIC(0)="QEAM" D ^DIC G:Y<0 CLEAN S PSJSP=$P(Y,"^") G:PSJSP="" CLEAN ;;I $P($G(^LAB(60,PSJLBT,1,PSJSP,0)),"^",7)']"" W !!,$C(7),"Specimen data missing !!",! ;K Y,PSJSP G PSJSP
"RTN","PSJRXLAB",36,0)
PSJUNIT S PSJUNIT=$S($G(PSJSP)]"":$$GET1^DIQ(60.01,PSJSP_","_PSJLBT,6),1:"")
"RTN","PSJRXLAB",37,0)
PSJANS R !,"Do you want Order info? N// ",PSJANS:DTIME G CLEAN:'$T S:PSJANS="" PSJANS="N" G:PSJANS="^" CLEAN2 I "YNyn"'[$E(PSJANS) W !,"ANSWER YES OR NO" G PSJANS
"RTN","PSJRXLAB",38,0)
DEVICE K IOP S %ZIS="MQ" D ^%ZIS G:POP CLEAN2
"RTN","PSJRXLAB",39,0)
 I $D(IO("Q")) K IO("Q") S ZTSAVE("*")="",ZTRTN="DQ^PSJRXLAB",ZTDESC="LAB LIST" D ^%ZTLOAD K ZTSK G CLEAN
"RTN","PSJRXLAB",40,0)
DQ S PSJLABQ=0 S PSJBD=PSJBD-1,PAGE=0 U IO W @IOF D HDR
"RTN","PSJRXLAB",41,0)
LOOP1 ;
"RTN","PSJRXLAB",42,0)
 K ^TMP($J,"PSORDT") D LIST^DIC(100,"",.01,"I",,PSJBD,,"AD",,,"^TMP($J,""PSORDT"")")
"RTN","PSJRXLAB",43,0)
 N PSJ F PSJ=1:1 Q:'$D(^TMP($J,"PSORDT","DILIST",1,PSJ))  S PSJBD=^TMP($J,"PSORDT","DILIST",1,PSJ) Q:PSJBD>PSJED  S PSJORDN=0 D LOOP2 Q:$G(PSJLABQ)
"RTN","PSJRXLAB",44,0)
 G CLEAN
"RTN","PSJRXLAB",45,0)
LOOP2 S PSJORDN=^TMP($J,"PSORDT","DILIST",2,PSJ) D CHECK1
"RTN","PSJRXLAB",46,0)
 Q
"RTN","PSJRXLAB",47,0)
CHECK1 ;
"RTN","PSJRXLAB",48,0)
 N PSJNUM
"RTN","PSJRXLAB",49,0)
 S PSJNUM=$$FIND1^DIC(100.045,","_PSJORDN_",","X","DRUG","ID") Q:'PSJNUM
"RTN","PSJRXLAB",50,0)
 S PSCNT=PSCNT+1
"RTN","PSJRXLAB",51,0)
 S ^TMP($J,"ORDERNUM",PSCNT)=PSJORDN
"RTN","PSJRXLAB",52,0)
 S PSJDGN=$$GET1^DIQ(100.045,PSJNUM_","_PSJORDN,1,"I"),PSJDRUGN=$$GET1^DIQ(50,PSJDGN,.01)
"RTN","PSJRXLAB",53,0)
 Q:'$G(PSJDGN)  I PSJDRUGN'[PSJDRUG Q
"RTN","PSJRXLAB",54,0)
 S PSJPROV=$$GET1^DIQ(100,PSJORDN,1,"I") Q:'PSJPROV
"RTN","PSJRXLAB",55,0)
 S PSJPROVN=$$GET1^DIQ(200,PSJPROV,.01),PSJPROT=$$GET1^DIQ(200,PSJPROV,9.21,"I")
"RTN","PSJRXLAB",56,0)
 S PSJTYPE="NONE" I PSJPROT S PSJTYPE=$P("FULL TIME^PART TIME^C & A^FEE^STAFF","^",PSJPROT)
"RTN","PSJRXLAB",57,0)
CHECK2 ;
"RTN","PSJRXLAB",58,0)
 S PSJPT=+$$GET1^DIQ(100,PSJORDN,.02,"I") Q:'PSJPT  W ! S DFN=PSJPT D PID^VADPT,PRINT2
"RTN","PSJRXLAB",59,0)
 S LRDFN=$$GET1^DIQ(2,PSJPT,63,"I")
"RTN","PSJRXLAB",60,0)
 I 'LRDFN W ?55,"No lab data exists",?81,$E(PSJPROVN,1,20),?106,PSJTYPE,! D:PSJANS["Y"!(PSJANS["y") PSJORDNI Q
"RTN","PSJRXLAB",61,0)
 S PSJLBENT=0,PSJINDIC=0
"RTN","PSJRXLAB",62,0)
LOOP3 ;
"RTN","PSJRXLAB",63,0)
 N LRARRAY,RESULT D LIST^DIC(63.04,","_LRDFN_",",,"I",,LDATE,,,,,"LRARRAY")
"RTN","PSJRXLAB",64,0)
 F J2=1:1 Q:'$D(LRARRAY("DILIST",1,J2))  S PSJLDATE=LRARRAY("DILIST",1,J2) Q:PSJLDATE>PSJBD
"RTN","PSJRXLAB",65,0)
 I J2>1 S J2=J2-1,PSJLDATE=LRARRAY("DILIST",1,J2),PSJLBENT=LRARRAY("DILIST",2,J2) D CHECK3 Q:$G(PSJLABQ)
"RTN","PSJRXLAB",66,0)
 I PSJINDIC=0 W ?55,"NO LAB DATA IN RANGE",?81,$E(PSJPROVN,1,20),?106,PSJTYPE,!
"RTN","PSJRXLAB",67,0)
 D:PSJANS["Y" PSJORDNI
"RTN","PSJRXLAB",68,0)
 I $D(RESULT(3)) F J4=3:1 Q:'$D(RESULT(J4))  W ?55,RESULT(J4),! I $Y>(IOSL-6) D  Q:$G(PSJLABQ)  W @IOF,SITE,! D HDR2
"RTN","PSJRXLAB",69,0)
 .I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) PSJLABQ=1
"RTN","PSJRXLAB",70,0)
 Q
"RTN","PSJRXLAB",71,0)
CHECK3 ;
"RTN","PSJRXLAB",72,0)
 N ARR,KEY,TERM K RESULT S RESULT="",KEY=PSJLBENT_","_LRDFN D GETS^DIQ(63.04,KEY,"*","I","ARR") S KEY=KEY_","
"RTN","PSJRXLAB",73,0)
 ; Loading of multiple results commented out MZR
"RTN","PSJRXLAB",74,0)
 ;S J3=1 F  S J3=$O(ARR(63.04,KEY,J3)) Q:'J3  I ARR(63.04,KEY,J3,"I") D
"RTN","PSJRXLAB",75,0)
 ;.I RESULT'="" S RESULT($I(TERM))=$P(^DD(63.04,J3,0),"^")_":"_ARR(63.04,KEY,J3,"I") Q
"RTN","PSJRXLAB",76,0)
 ;.S RESULT=$P(^DD(63.04,J3,0),"^")_":"_ARR(63.04,KEY,J3,"I")
"RTN","PSJRXLAB",77,0)
 I $D(ARR(63.04,KEY,PSJLABT,"I")) S RESULT=$P(^DD(63.04,PSJLABT,0),"^")_":"_ARR(63.04,KEY,PSJLABT,"I")
"RTN","PSJRXLAB",78,0)
 I RESULT'="" D RESULT
"RTN","PSJRXLAB",79,0)
 Q
"RTN","PSJRXLAB",80,0)
RESULT Q:ARR(63.04,KEY,.05,"I")'=PSJSP  Q:'ARR(63.04,KEY,.03,"I")
"RTN","PSJRXLAB",81,0)
 S Y=PSJLDATE X ^DD("DD") W ?55,$E(Y,1,11),?68,RESULT,! ;$P(^LR(LRDFN,"CH",PSJLBENT,PSJLABT),"^")_" "_PSJUNIT,?81,$E(PSJPROVN,1,20),?106,PSJTYPE W !
"RTN","PSJRXLAB",82,0)
 S PSJINDIC=1 Q
"RTN","PSJRXLAB",83,0)
 Q
"RTN","PSJRXLAB",84,0)
PRINT2 I $Y>(IOSL-6) D  Q:$G(PSJLABQ)  W @IOF,SITE,! D HDR2
"RTN","PSJRXLAB",85,0)
 .I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) PSJLABQ=1
"RTN","PSJRXLAB",86,0)
 W ?1,$E($$GET1^DIQ(2,PSJPT,.01),1,20),?25,VA("PID") S Y=PSJBD X ^DD("DD") W ?37,Y
"RTN","PSJRXLAB",87,0)
 Q
"RTN","PSJRXLAB",88,0)
HDR W SITE,!!,"Patients receiving "_PSJDRUG_" with fills between "_PSJBDR_" and "_PSJEDR,!," with date of collection and results for lab test "_PSJLABTN_" after ",LDATER,!
"RTN","PSJRXLAB",89,0)
HDR2 S PAGE=PAGE+1 W !,"Name",?25,"ID#",?37,"Fill Date",?55,"Lab Date",?68,"Results",?81,"Order Provider",?106,"Type",?116,"Page "_PAGE,!
"RTN","PSJRXLAB",90,0)
 F J=1:1:IOM-1 W "_"
"RTN","PSJRXLAB",91,0)
 W ! Q
"RTN","PSJRXLAB",92,0)
PSJORDNI N DTOUT,DUOUT Q:$G(PSJLABQ)  W "Order #: "_$$GET1^DIQ(100,PSJORDN,.01)_"   Drug: "_$$GET1^DIQ(50,PSJDGN,.01)
"RTN","PSJRXLAB",93,0)
 I $D(RESULT)>1 W ?55,RESULT(1)
"RTN","PSJRXLAB",94,0)
 N SIGNUM S SIGNUM=$$FIND1^DIC(100.045,","_PSJORDN_",","X","SIG","ID")
"RTN","PSJRXLAB",95,0)
 W !?1,"Sig: ",$$GET1^DIQ(100.0451,"1,"_SIGNUM_","_PSJORDN,.01)
"RTN","PSJRXLAB",96,0)
 I $D(RESULT(2)) W ?55,RESULT(2)
"RTN","PSJRXLAB",97,0)
 I $Y>(IOSL-6) D  Q:$G(PSJLABQ)  W @IOF,SITE,! D HDR2
"RTN","PSJRXLAB",98,0)
 .I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) PSJLABQ=1
"RTN","PSJRXLAB",99,0)
 W ! Q
"RTN","PSJRXLAB",100,0)
CLEAN I $L($G(IOF)) W @IOF
"RTN","PSJRXLAB",101,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSJRXLAB",102,0)
CLEAN2 K PSJINDIC,PSJPT,PSJLDATE,PAGE,PSJBD,PSJBDR,PSJLBENT,PSJLABT,PSJDGN,PSJDRUGN,PSJDRUG,J,J1,J2,PSJORDN,PSJPROV,PSJPROVN,LDATE,LDATER,PSJED,PSJEDR,PSJPROT,PSJTYPE,PSJLABTN,PSJLBT,PSJSP,PSJUNIT,PSJANS,DIC,LRDFN,POP,SITE,Y,%DT,PSJLABQ
"RTN","PSJRXLAB",103,0)
 K ZTDESC,ZTRTN,ZTSAVE,%ZIS,^TMP($J,"ORDERNUM"),^TMP($J,"PSORDT") Q
"RTN","PSJRXLAB",104,0)
 ;
"RTN","PSJRXLAB",105,0)
FQUIT Q
"SEC","^DIC",53.8,53.8,0,"AUDIT")
@
"SEC","^DIC",53.8,53.8,0,"DD")
@
"SEC","^DIC",53.8,53.8,0,"DEL")
@
"SEC","^DIC",53.8,53.8,0,"LAYGO")
@
"SEC","^DIC",53.8,53.8,0,"RD")
@
"SEC","^DIC",53.8,53.8,0,"WR")
@
"UP",55,55.06,-1)
55^5
"UP",55,55.06,0)
55.06
"VER")
8.0^22.2
"^DD",53.8,53.8,0)
FIELD^^2^7
"^DD",53.8,53.8,0,"DT")
3190510
"^DD",53.8,53.8,0,"IX","A",53.8,1)

"^DD",53.8,53.8,0,"IX","B",53.8,.01)

"^DD",53.8,53.8,0,"NM","CLOZAPINE MEDICATION OVERRIDES")

"^DD",53.8,53.8,0,"VRPK")
PSJ
"^DD",53.8,53.8,.01,0)
DATE TIME^MRDI^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",53.8,53.8,.01,1,0)
^.1
"^DD",53.8,53.8,.01,1,1,0)
53.8^B
"^DD",53.8,53.8,.01,1,1,1)
S ^PS(53.8,"B",$E(X,1,30),DA)=""
"^DD",53.8,53.8,.01,1,1,2)
K ^PS(53.8,"B",$E(X,1,30),DA)
"^DD",53.8,53.8,.01,3)
(No range limit on date)
"^DD",53.8,53.8,.01,21,0)
^^2^2^3160310^
"^DD",53.8,53.8,.01,21,1,0)
This is the date and time of the decision to override the prohibition on 
"^DD",53.8,53.8,.01,21,2,0)
dispensing Clozaril.
"^DD",53.8,53.8,.01,"DT")
3151222
"^DD",53.8,53.8,1,0)
ORDER NUMBER^RP100'I^OR(100,^0;2^Q
"^DD",53.8,53.8,1,1,0)
^.1
"^DD",53.8,53.8,1,1,1,0)
53.8^A
"^DD",53.8,53.8,1,1,1,1)
S ^PS(53.8,"A",$E(X,1,30),DA)=""
"^DD",53.8,53.8,1,1,1,2)
K ^PS(53.8,"A",$E(X,1,30),DA)
"^DD",53.8,53.8,1,1,1,"%D",0)
^^1^1^3160328^
"^DD",53.8,53.8,1,1,1,"%D",1,0)
Index on the ORDER field (#1).
"^DD",53.8,53.8,1,1,1,"DT")
3160328
"^DD",53.8,53.8,1,3)
Enter the order number.
"^DD",53.8,53.8,1,21,0)
^.001^1^1^3160328^^^
"^DD",53.8,53.8,1,21,1,0)
Contains the order number.
"^DD",53.8,53.8,1,"DT")
3160328
"^DD",53.8,53.8,2,0)
USER ENTERING^RP200'I^VA(200,^0;3^Q
"^DD",53.8,53.8,2,3)
Enter the name of the individual entering this order.
"^DD",53.8,53.8,2,21,0)
^^1^1^3160309^
"^DD",53.8,53.8,2,21,1,0)
This records the name of the individual entering the order.
"^DD",53.8,53.8,2,"DT")
3160310
"^DD",53.8,53.8,3,0)
APPROVING TEAM MEMBER^RP200'I^VA(200,^0;4^Q
"^DD",53.8,53.8,3,3)
Enter the name of the person who authorized the order to be filled.
"^DD",53.8,53.8,3,21,0)
^^2^2^3160309^
"^DD",53.8,53.8,3,21,1,0)
This is the member of the clozapine treatment team who authorized this 
"^DD",53.8,53.8,3,21,2,0)
order to be filled.
"^DD",53.8,53.8,3,"DT")
3160310
"^DD",53.8,53.8,4,0)
REASON FOR OVERRIDE^RP52.54'I^PS(52.54,^0;5^Q
"^DD",53.8,53.8,4,3)
Enter the reason for the override. Input must be between 5 and 100 characters in length.
"^DD",53.8,53.8,4,21,0)
^^2^2^3160315^
"^DD",53.8,53.8,4,21,1,0)
This field contains the reason for the Clozapine override as a pointer 
"^DD",53.8,53.8,4,21,2,0)
to file 52.54. It should be between 5 and 100 characters in length.
"^DD",53.8,53.8,4,"DT")
3160310
"^DD",53.8,53.8,5,0)
COMMENTS^RFI^^0;6^K:$L(X)>200!($L(X)<5) X
"^DD",53.8,53.8,5,3)
Enter comments describing the reason to override the lockout.  Input must be between 5 and 200 characters in length.
"^DD",53.8,53.8,5,21,0)
^.001^1^1^3160315^^^^
"^DD",53.8,53.8,5,21,1,0)
This is any information about why the order was filled.
"^DD",53.8,53.8,5,"DT")
3160310
"^DD",53.8,53.8,6,0)
SECOND APPROVING TEAM MEMBER^RP200'^VA(200,^1;1^Q
"^DD",53.8,53.8,6,3)
Enter the name of the approving team member.
"^DD",53.8,53.8,6,21,0)
^^1^1^3160516^^
"^DD",53.8,53.8,6,21,1,0)
This field records the name as a pointer to file 200.
"^DD",53.8,53.8,6,"DT")
3160516
"^DD",55,55.06,301,0)
CLOZAPINE DOSAGE (MG/DAY)^NJ4,0^^SAND;1^K:+X'=X!(X>3000)!(X<0)!(X?.E1"."1N.N) X
"^DD",55,55.06,301,3)
Type a number between 0 and 3000, 0 decimal digits.
"^DD",55,55.06,301,21,0)
^^2^2^3160606^
"^DD",55,55.06,301,21,1,0)
This is the total daily dosage of clozapine if this order is
"^DD",55,55.06,301,21,2,0)
for the drug clozapine.  This is used only for clozapine.
"^DD",55,55.06,301,"DT")
3160606
"^DIC",53.8,53.8,0)
CLOZAPINE MEDICATION OVERRIDES^53.8
"^DIC",53.8,53.8,0,"GL")
^PS(53.8,
"^DIC",53.8,53.8,"%",0)
^1.005^^0
"^DIC",53.8,53.8,"%D",0)
^^12^12^3160310^
"^DIC",53.8,53.8,"%D",1,0)
This file contains information regarding who, when and why the
"^DIC",53.8,53.8,"%D",2,0)
prohibition on a order for clozapine was overridden 
"^DIC",53.8,53.8,"%D",3,0)
member of the team.  Because of the nature of this drug and the
"^DIC",53.8,53.8,"%D",4,0)
restrictions placed upon dispensing it, all fields in this file
"^DIC",53.8,53.8,"%D",5,0)
are not to be edited through the VA FileManager, but are to be set
"^DIC",53.8,53.8,"%D",6,0)
ONLY through the order entry options of the inpatient pharmacy
"^DIC",53.8,53.8,"%D",7,0)
package.  Reports generated from this file should be generated only
"^DIC",53.8,53.8,"%D",8,0)
from the option provided by the package.  For these reasons, READ,
"^DIC",53.8,53.8,"%D",9,0)
WRITE, DELETE and LAYGO access to this file are severely restricted.
"^DIC",53.8,53.8,"%D",10,0)
 
"^DIC",53.8,53.8,"%D",11,0)
UNDER NO CIRCUMSTANCES SHOULD THE DATA DICTIONARY FOR THIS FILE
"^DIC",53.8,53.8,"%D",12,0)
                         BE MODIFIED
"^DIC",53.8,"B","CLOZAPINE MEDICATION OVERRIDES",53.8)

**INSTALL NAME**
OR*3.0*427
"BLD",10959,0)
OR*3.0*427^ORDER ENTRY/RESULTS REPORTING^0^3190612^y
"BLD",10959,1,0)
^^1^1^3180813^^^
"BLD",10959,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"BLD",10959,4,0)
^9.64PA^^
"BLD",10959,6.3)
105
"BLD",10959,"INID")
^n
"BLD",10959,"INIT")
ORY427ES
"BLD",10959,"KRN",0)
^9.67PA^779.2^20
"BLD",10959,"KRN",.4,0)
.4
"BLD",10959,"KRN",.401,0)
.401
"BLD",10959,"KRN",.402,0)
.402
"BLD",10959,"KRN",.403,0)
.403
"BLD",10959,"KRN",.5,0)
.5
"BLD",10959,"KRN",.84,0)
.84
"BLD",10959,"KRN",3.6,0)
3.6
"BLD",10959,"KRN",3.8,0)
3.8
"BLD",10959,"KRN",9.2,0)
9.2
"BLD",10959,"KRN",9.8,0)
9.8
"BLD",10959,"KRN",9.8,"NM",0)
^9.68A^15^15
"BLD",10959,"KRN",9.8,"NM",1,0)
ORY4270^^0^B16073184
"BLD",10959,"KRN",9.8,"NM",2,0)
ORY4271^^0^B41095023
"BLD",10959,"KRN",9.8,"NM",3,0)
ORY4272^^0^B28301234
"BLD",10959,"KRN",9.8,"NM",4,0)
ORY4273^^0^B13307046
"BLD",10959,"KRN",9.8,"NM",5,0)
ORY4274^^0^B13859060
"BLD",10959,"KRN",9.8,"NM",6,0)
ORY42701^^0^B71203449
"BLD",10959,"KRN",9.8,"NM",7,0)
ORY42702^^0^B78453694
"BLD",10959,"KRN",9.8,"NM",8,0)
ORY42703^^0^B78751328
"BLD",10959,"KRN",9.8,"NM",9,0)
ORY42704^^0^B84076912
"BLD",10959,"KRN",9.8,"NM",10,0)
ORY42705^^0^B62931901
"BLD",10959,"KRN",9.8,"NM",11,0)
ORY42706^^0^B67973600
"BLD",10959,"KRN",9.8,"NM",12,0)
ORY42707^^0^B69950041
"BLD",10959,"KRN",9.8,"NM",13,0)
ORY42708^^0^B34877645
"BLD",10959,"KRN",9.8,"NM",14,0)
ORY427ES^^0^B12947340
"BLD",10959,"KRN",9.8,"NM",15,0)
ORALWORD^^0^B87912660
"BLD",10959,"KRN",9.8,"NM","B","ORALWORD",15)

"BLD",10959,"KRN",9.8,"NM","B","ORY4270",1)

"BLD",10959,"KRN",9.8,"NM","B","ORY42701",6)

"BLD",10959,"KRN",9.8,"NM","B","ORY42702",7)

"BLD",10959,"KRN",9.8,"NM","B","ORY42703",8)

"BLD",10959,"KRN",9.8,"NM","B","ORY42704",9)

"BLD",10959,"KRN",9.8,"NM","B","ORY42705",10)

"BLD",10959,"KRN",9.8,"NM","B","ORY42706",11)

"BLD",10959,"KRN",9.8,"NM","B","ORY42707",12)

"BLD",10959,"KRN",9.8,"NM","B","ORY42708",13)

"BLD",10959,"KRN",9.8,"NM","B","ORY4271",2)

"BLD",10959,"KRN",9.8,"NM","B","ORY4272",3)

"BLD",10959,"KRN",9.8,"NM","B","ORY4273",4)

"BLD",10959,"KRN",9.8,"NM","B","ORY4274",5)

"BLD",10959,"KRN",9.8,"NM","B","ORY427ES",14)

"BLD",10959,"KRN",19,0)
19
"BLD",10959,"KRN",19.1,0)
19.1
"BLD",10959,"KRN",101,0)
101
"BLD",10959,"KRN",409.61,0)
409.61
"BLD",10959,"KRN",771,0)
771
"BLD",10959,"KRN",779.2,0)
779.2
"BLD",10959,"KRN",870,0)
870
"BLD",10959,"KRN",8989.51,0)
8989.51
"BLD",10959,"KRN",8989.52,0)
8989.52
"BLD",10959,"KRN",8994,0)
8994
"BLD",10959,"KRN","B",.4,.4)

"BLD",10959,"KRN","B",.401,.401)

"BLD",10959,"KRN","B",.402,.402)

"BLD",10959,"KRN","B",.403,.403)

"BLD",10959,"KRN","B",.5,.5)

"BLD",10959,"KRN","B",.84,.84)

"BLD",10959,"KRN","B",3.6,3.6)

"BLD",10959,"KRN","B",3.8,3.8)

"BLD",10959,"KRN","B",9.2,9.2)

"BLD",10959,"KRN","B",9.8,9.8)

"BLD",10959,"KRN","B",19,19)

"BLD",10959,"KRN","B",19.1,19.1)

"BLD",10959,"KRN","B",101,101)

"BLD",10959,"KRN","B",409.61,409.61)

"BLD",10959,"KRN","B",771,771)

"BLD",10959,"KRN","B",779.2,779.2)

"BLD",10959,"KRN","B",870,870)

"BLD",10959,"KRN","B",8989.51,8989.51)

"BLD",10959,"KRN","B",8989.52,8989.52)

"BLD",10959,"KRN","B",8994,8994)

"BLD",10959,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10959,"QUES",0)
^9.62^^
"BLD",10959,"REQB",0)
^9.611^1^1
"BLD",10959,"REQB",1,0)
OR*3.0*243^2
"BLD",10959,"REQB","B","OR*3.0*243",1)

"INIT")
ORY427ES
"MBREQ")
1
"PKG",35,-1)
1^1
"PKG",35,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",35,22,0)
^9.49I^1^1
"PKG",35,22,1,0)
3.0^3051119^2990416^1
"PKG",35,22,1,"PAH",1,0)
427^3190612^74
"PKG",35,22,1,"PAH",1,1,0)
^^1^1^3190612
"PKG",35,22,1,"PAH",1,1,1,0)
MENTAL HEALTH NCC PROJECT 5.01
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","ORALWORD")
0^15^B87912660
"RTN","ORALWORD",1,0)
ORALWORD ; SLC/JMH - Utilities for Checking if an order can be ordered ; 11/28/18 3:37pm
"RTN","ORALWORD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243,427**;Dec 17, 1997;Build 105
"RTN","ORALWORD",3,0)
 ;External reference $$CL^YSCLTST2 controlled by DBIA 4556
"RTN","ORALWORD",4,0)
 ;External reference $$OVERRIDE^YSCLTST2 controlled by DBIA 4556
"RTN","ORALWORD",5,0)
 ;Reference to ^DIQ supported by DBIA #2056
"RTN","ORALWORD",6,0)
 ;Reference to ^PSS50 supported by DBIA #4533
"RTN","ORALWORD",7,0)
 ;Reference to $$DEA^XUSER supported by DBIA #2343
"RTN","ORALWORD",8,0)
 ;
"RTN","ORALWORD",9,0)
ALLWORD(ORY,DFN,ORX,ORTYPE,PROV) ;
"RTN","ORALWORD",10,0)
 N OROI,ORYS,QOIEN,QPIEN,ORCLOZ,QOAA
"RTN","ORALWORD",11,0)
 S OROI=0
"RTN","ORALWORD",12,0)
 ;
"RTN","ORALWORD",13,0)
 ;ORTYPE used to determine the type of data coming into the call
"RTN","ORALWORD",14,0)
 ;ORYTPE="E" existing order, ORX equal the IEN from file 100 (used with
"RTN","ORALWORD",15,0)
 ;copy,edit functionality)
"RTN","ORALWORD",16,0)
 ;ORTYPE="Q" Quick Order, ORX equal the IEN from file 101.43
"RTN","ORALWORD",17,0)
 ;ORTYPE="N" New order, ORX equal the IEN from file 101.41
"RTN","ORALWORD",18,0)
 ;
"RTN","ORALWORD",19,0)
 I ORTYPE="E" S OROI=$G(^OR(100,ORX,.1,1,0))
"RTN","ORALWORD",20,0)
 I ORTYPE="Q" D
"RTN","ORALWORD",21,0)
 .S QPIEN=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM","")) Q:QPIEN'>0
"RTN","ORALWORD",22,0)
 .S QOIEN=$O(^ORD(101.41,ORX,6,"D",QPIEN,"")) Q:QOIEN'>0
"RTN","ORALWORD",23,0)
 .S OROI=$G(^ORD(101.41,ORX,6,QOIEN,1))
"RTN","ORALWORD",24,0)
 .S QOAA=$P($G(^ORD(101.41,ORX,5)),U,8)
"RTN","ORALWORD",25,0)
 I ORTYPE="N" S OROI=ORX
"RTN","ORALWORD",26,0)
 Q:OROI'>0
"RTN","ORALWORD",27,0)
 S ORY=0
"RTN","ORALWORD",28,0)
 ;checks if the orderable item (OROI) is a clozapine med
"RTN","ORALWORD",29,0)
 ;  if not returns ORY=0
"RTN","ORALWORD",30,0)
 S ORCLOZ=$$ISCLOZ(OROI),ORY=ORY_U_ORCLOZ,ORY(0)=U_ORCLOZ
"RTN","ORALWORD",31,0)
 Q:'ORCLOZ
"RTN","ORALWORD",32,0)
 N ORQUIT
"RTN","ORALWORD",33,0)
 S ORQUIT=0
"RTN","ORALWORD",34,0)
 I '$G(PROV) S PROV=DUZ
"RTN","ORALWORD",35,0)
 I $G(PROV) D
"RTN","ORALWORD",36,0)
 .I '$L($$DEA^XUSER(,PROV)) D
"RTN","ORALWORD",37,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",38,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",39,0)
 ..S ORY(1)="*** You are not authorized to place Clozapine orders."
"RTN","ORALWORD",40,0)
 ..S ORY(2)="You must have a DEA#.  Please contact your"
"RTN","ORALWORD",41,0)
 ..S ORY(3)="CAC or IRM for more information. ***"
"RTN","ORALWORD",42,0)
 .Q:ORQUIT
"RTN","ORALWORD",43,0)
 .I '$D(^XUSEC("YSCL AUTHORIZED",PROV)) D
"RTN","ORALWORD",44,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",45,0)
 ..S ORY(1)="*** You are not authorized to place Clozapine orders."
"RTN","ORALWORD",46,0)
 ..S ORY(2)="You must hold key YSCL AUTHORIZED.  Please contact your"
"RTN","ORALWORD",47,0)
 ..S ORY(3)="CAC or IRM for more information on this key. ***"
"RTN","ORALWORD",48,0)
 Q:ORQUIT
"RTN","ORALWORD",49,0)
 ;  if is a cloz med , check if patient (DFN) can have a clozapine med
"RTN","ORALWORD",50,0)
 S ORYS=$$CL^YSCLTST2(DFN)
"RTN","ORALWORD",51,0)
 ;    if yes returns ORY=0
"RTN","ORALWORD",52,0)
 I +ORYS>0 D BEFQUIT  Q
"RTN","ORALWORD",53,0)
 ;    if no 
"RTN","ORALWORD",54,0)
 ;      returns 
"RTN","ORALWORD",55,0)
 ;    ORY=1
"RTN","ORALWORD",56,0)
 ;    ORY(0)=CAPTION FOR DIALOG BOX
"RTN","ORALWORD",57,0)
 ;    ORY(1-N)=MESSAGE TO DISPLAY
"RTN","ORALWORD",58,0)
 S ORY=1_U_ORCLOZ,ORY(0)="Problem Ordering Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",59,0)
 ;patient not in clozapine patient program
"RTN","ORALWORD",60,0)
 ;; START NCC REMEDIATION >> 427*RJS
"RTN","ORALWORD",61,0)
 I +ORYS<0 D  Q
"RTN","ORALWORD",62,0)
 .S ORY(1)="*** This patient is not registered in the clozapine treatment "
"RTN","ORALWORD",63,0)
 .S ORY(2)="program or has been discontinued from the program. A new"
"RTN","ORALWORD",64,0)
 .S ORY(3)="registration number must be assigned. If this is not an emergency,"
"RTN","ORALWORD",65,0)
 .S ORY(4)="contact the NCCC. For emergency registration during non-NCCC duty"
"RTN","ORALWORD",66,0)
 .S ORY(5)="hours, a written order to the pharmacist can be used to process a"
"RTN","ORALWORD",67,0)
 .S ORY(6)="registration override. ***"
"RTN","ORALWORD",68,0)
 ;problem with lab tests
"RTN","ORALWORD",69,0)
 I +ORYS=0 D  Q
"RTN","ORALWORD",70,0)
 .I $$OVERRIDE^YSCLTST2(DFN) S ORY=0_U_ORCLOZ,ORY(0)=U_ORCLOZ D BEFQUIT  Q  ;override allowed
"RTN","ORALWORD",71,0)
 .I +$P(ORYS,"^",2),$P(ORYS,"^",4)<1000 D
"RTN","ORALWORD",72,0)
 ..N COUNT S COUNT=0
"RTN","ORALWORD",73,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="*** This clozapine drug may not be dispensed to the patient at this "
"RTN","ORALWORD",74,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="time based on the available lab tests related to the clozapine "
"RTN","ORALWORD",75,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="treatment program. Please contact the NCCC to request an override in"
"RTN","ORALWORD",76,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="order to proceed with dispensing this drug. ***"
"RTN","ORALWORD",77,0)
 ..D DISPRSLT
"RTN","ORALWORD",78,0)
 .I '$P(ORYS,U,2),$P(ORYS,U,4) D
"RTN","ORALWORD",79,0)
 ..N COUNT S COUNT=0
"RTN","ORALWORD",80,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="*** Permission to dispense clozapine has been denied based on the available"
"RTN","ORALWORD",81,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="lab tests related to the clozapine treatment program.***"
"RTN","ORALWORD",82,0)
 ..S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",83,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="The latest lab test results drawn in the past 7 days have ANC results but no"
"RTN","ORALWORD",84,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="matching WBC. Redo the lab tests or contact the NCCC for a National Override"
"RTN","ORALWORD",85,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="to dispense clozapine with no matching WBC results."
"RTN","ORALWORD",86,0)
 ..D DISPRSLT
"RTN","ORALWORD",87,0)
 .I '+$P(ORYS,"^",4) D MSG
"RTN","ORALWORD",88,0)
 Q
"RTN","ORALWORD",89,0)
MSG ;
"RTN","ORALWORD",90,0)
 N COUNT S COUNT=0
"RTN","ORALWORD",91,0)
 S COUNT=COUNT+1,ORY(COUNT)="*** Permission to dispense clozapine has been denied based on the"
"RTN","ORALWORD",92,0)
 S COUNT=COUNT+1,ORY(COUNT)="available lab tests related to the clozapine treatment program. ***"
"RTN","ORALWORD",93,0)
 S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",94,0)
 I $P($G(X0),U)["PSJ" D DISPRSLT S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",95,0)
 S COUNT=COUNT+1,ORY(COUNT)="For a National Override to dispense at the patient's normal"
"RTN","ORALWORD",96,0)
 S COUNT=COUNT+1,ORY(COUNT)="frequency, contact the NCCC."
"RTN","ORALWORD",97,0)
 S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",98,0)
 D:$D(X0)  ;; NCC REMEDIATION << 427 RTW Special Conditions selections for outpatient and inpatient RTW
"RTN","ORALWORD",99,0)
 .I $P(X0,U,1)["PSO" D
"RTN","ORALWORD",100,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="A local emergency override for an Outpatient can be approved for:"
"RTN","ORALWORD",101,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="(1) weather-related conditions, (2) mail order delays of clozapine,"
"RTN","ORALWORD",102,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="or (3) inpatient going on leave."
"RTN","ORALWORD",103,0)
 ..S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",104,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="For an Outpatient Special Conditions Local Override, a written prescription from"
"RTN","ORALWORD",105,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="the provider with documentation to the pharmacist is required to dispense"
"RTN","ORALWORD",106,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="a one-time emergency 4-day supply."
"RTN","ORALWORD",107,0)
 .I $P(X0,U,1)["PSJ" D
"RTN","ORALWORD",108,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="A local emergency override for an Inpatient can be approved for:"
"RTN","ORALWORD",109,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="IP Order Override with Outside Lab Results"
"RTN","ORALWORD",110,0)
 ..S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",111,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="For a Special Conditions Local Override, a written order from"
"RTN","ORALWORD",112,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="the provider with documentation to the pharmacist is required to"
"RTN","ORALWORD",113,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="dispense a one-time 4-day supply."
"RTN","ORALWORD",114,0)
 ..S COUNT=COUNT+1,ORY(COUNT)=""
"RTN","ORALWORD",115,0)
 ..S COUNT=COUNT+1,ORY(COUNT)="The provider must record the ANC from another facility including date/time in both the Provider Progress Note and Comment field in CPRS."
"RTN","ORALWORD",116,0)
 Q
"RTN","ORALWORD",117,0)
DISPRSLT ; Display Lab Tests
"RTN","ORALWORD",118,0)
 S COUNT=COUNT+1,ORY(COUNT)="Related Lab Test(s)"
"RTN","ORALWORD",119,0)
 S COUNT=COUNT+1,ORY(COUNT)="==================="
"RTN","ORALWORD",120,0)
 I $L($P(ORYS,U,3)) S COUNT=COUNT+1,ORY(COUNT)="WBC:  "_($P(ORYS,U,2)/1000)_" K/cmm"
"RTN","ORALWORD",121,0)
 E  S COUNT=COUNT+1,ORY(COUNT)="WBC:  NO TEST RESULTS FOUND"
"RTN","ORALWORD",122,0)
 I $L($P(ORYS,U,5)) S COUNT=COUNT+1,ORY(COUNT)="ANC:  "_($P(ORYS,U,4)/1000)_" K/cmm"
"RTN","ORALWORD",123,0)
 E  S COUNT=COUNT+1,ORY(COUNT)="ANC:  NO TEST RESULTS FOUND"
"RTN","ORALWORD",124,0)
 S COUNT=COUNT+1,ORY(COUNT)="Date/Time of last tests: "_$$DATE^ORU($P(ORYS,U,6))
"RTN","ORALWORD",125,0)
 Q
"RTN","ORALWORD",126,0)
 ;; END NCC REMEDIATION << 427*RTW
"RTN","ORALWORD",127,0)
BEFQUIT ;
"RTN","ORALWORD",128,0)
 Q:'$G(QOAA)
"RTN","ORALWORD",129,0)
 N QODS,QORF,ORMAX,ORCLPAT
"RTN","ORALWORD",130,0)
 S QODS=$O(^ORD(101.41,"AB","OR GTX DAYS SUPPLY","")) Q:QODS'>0
"RTN","ORALWORD",131,0)
 S QODS=$O(^ORD(101.41,ORX,6,"D",QODS,"")) Q:QOIEN'>0
"RTN","ORALWORD",132,0)
 S QODS=$G(^ORD(101.41,ORX,6,QODS,1))
"RTN","ORALWORD",133,0)
 S QORF=$O(^ORD(101.41,"AB","OR GTX REFILLS","")) Q:QORF'>0
"RTN","ORALWORD",134,0)
 S QORF=$O(^ORD(101.41,ORX,6,"D",QORF,"")) Q:QOIEN'>0
"RTN","ORALWORD",135,0)
 S QORF=$G(^ORD(101.41,ORX,6,QORF,1))
"RTN","ORALWORD",136,0)
 S QORF=QORF+1
"RTN","ORALWORD",137,0)
 S ORCLPAT=$P(ORYS,U,7)
"RTN","ORALWORD",138,0)
 S ORMAX=$S(ORYS="M":28,ORYS="B":14,ORYS="W":7,1:90)
"RTN","ORALWORD",139,0)
 I QORF*QODS>ORMAX D
"RTN","ORALWORD",140,0)
 .K ORY
"RTN","ORALWORD",141,0)
 .S ORY=1_U_ORCLOZ,ORY(0)="Problem Ordering Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",142,0)
 .S ORY(1)="*** This patient is only allowed an order with a maximum Days Supply of "_ORMAX_"."
"RTN","ORALWORD",143,0)
 .S ORY(2)="This includes the amounts added by any refills entered in with the order also."
"RTN","ORALWORD",144,0)
 Q
"RTN","ORALWORD",145,0)
ISCLOZ(OROI) ;
"RTN","ORALWORD",146,0)
 N ORPSOI,ORPSDRUG,ISCLOZ
"RTN","ORALWORD",147,0)
 S ORPSOI=$$GET1^DIQ(101.43,OROI,2)
"RTN","ORALWORD",148,0)
 I $P(ORPSOI,";",2)'="99PSP" Q 0
"RTN","ORALWORD",149,0)
 K ^TMP($J,"ORCLOZ")
"RTN","ORALWORD",150,0)
 D ASP^PSS50(+ORPSOI,,,"ORCLOZ")
"RTN","ORALWORD",151,0)
 S (ORPSDRUG,ISCLOZ)=0
"RTN","ORALWORD",152,0)
 F  S ORPSDRUG=$O(^TMP($J,"ORCLOZ",ORPSDRUG)) Q:'ORPSDRUG  D  Q:ISCLOZ
"RTN","ORALWORD",153,0)
 .K ^TMP($J,"ORCLOZ2")
"RTN","ORALWORD",154,0)
 .D CLOZ^PSS50(ORPSDRUG,,,,,"ORCLOZ2")
"RTN","ORALWORD",155,0)
 .I $G(^TMP($J,"ORCLOZ2",ORPSDRUG,"CLOZ",0))>0 S ISCLOZ=1
"RTN","ORALWORD",156,0)
 K ^TMP($J,"ORCLOZ"),^TMP($J,"ORCLOZ2")
"RTN","ORALWORD",157,0)
 Q ISCLOZ
"RTN","ORALWORD",158,0)
ALLWRN(ORY,ORN,REFILLS) ;allow order to be renewed
"RTN","ORALWORD",159,0)
 ;ORN is the order number
"RTN","ORALWORD",160,0)
 ;REFILLS is the number of refills to be included with the renewed order
"RTN","ORALWORD",161,0)
 N ORDS,ORQT,ORUPD,ORSCH,ORDUR,ORDFN,ORDRG,OROI,ORMAXDS,ORMAXQT,ORCLOZ,ORREF,ORMAXREF
"RTN","ORALWORD",162,0)
 ;default return 1 (ORY=1 means allow renew)
"RTN","ORALWORD",163,0)
 S ORY=1
"RTN","ORALWORD",164,0)
 ;get DFN (ORDFN)
"RTN","ORALWORD",165,0)
 S ORDFN=+$P(^OR(100,ORN,0),U,2)
"RTN","ORALWORD",166,0)
 Q:'ORDFN
"RTN","ORALWORD",167,0)
 ;get if order is a clozapine order (ORCLOZ)
"RTN","ORALWORD",168,0)
 S OROI=$G(^OR(100,ORN,.1,1,0)) Q:'OROI
"RTN","ORALWORD",169,0)
 S ORCLOZ=$$ISCLOZ(OROI)
"RTN","ORALWORD",170,0)
 ;quit if order is not clozapine
"RTN","ORALWORD",171,0)
 I 'ORCLOZ Q
"RTN","ORALWORD",172,0)
 ;get schedule from order (ORSCH)
"RTN","ORALWORD",173,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","SCHEDULE",0)),1))
"RTN","ORALWORD",174,0)
 ;get units per dose from order (ORUPD)
"RTN","ORALWORD",175,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DOSE",0)),1))
"RTN","ORALWORD",176,0)
 S ORSCH=$P(ORSCH,"&",3)
"RTN","ORALWORD",177,0)
 ;get duration from order (ORDUR)
"RTN","ORALWORD",178,0)
 I '$O(^OR(100,ORN,4.5,"ID","DURATION",0)) S ORDUR="~^"
"RTN","ORALWORD",179,0)
 E  S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DURATION",0)),1))
"RTN","ORALWORD",180,0)
 ;get days supply from order (ORDS)
"RTN","ORALWORD",181,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","SUPPLY",0)),1))
"RTN","ORALWORD",182,0)
 ;get drug (ptr50) from order (ORDRG)
"RTN","ORALWORD",183,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DRUG",0)),1))
"RTN","ORALWORD",184,0)
 ;get refills from order (ORREF)
"RTN","ORALWORD",185,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","REFILLS",0)),1))
"RTN","ORALWORD",186,0)
 ;get quantity from order (ORQT)
"RTN","ORALWORD",187,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","QTY",0)),1))
"RTN","ORALWORD",188,0)
 ;get max days supply for order (ORMAXDS)
"RTN","ORALWORD",189,0)
 S ORMAXDS=$$DEFSPLY^ORWDPS1(ORDFN)
"RTN","ORALWORD",190,0)
 ;if ds from order is > max ds return 0 (ORY=0)
"RTN","ORALWORD",191,0)
 I ORDS>ORMAXDS D  Q
"RTN","ORALWORD",192,0)
 .S ORY=0
"RTN","ORALWORD",193,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",194,0)
 .S ORY(1)="The Days Supply set for this order is greater than the Max Days Supply"
"RTN","ORALWORD",195,0)
 .S ORY(2)="    allowed for this patient."
"RTN","ORALWORD",196,0)
 ;get max quantity for order (ORMAXQT)
"RTN","ORALWORD",197,0)
 D DAY2QTY^ORWDPS2(.ORMAXQT,ORDS,ORUPD,ORSCH,ORDUR,ORDFN,ORDRG)
"RTN","ORALWORD",198,0)
 ;if qt from order is > max qt return 0 (ORY=0)
"RTN","ORALWORD",199,0)
 I ORQT>ORMAXQT D  Q
"RTN","ORALWORD",200,0)
 .S ORY=0
"RTN","ORALWORD",201,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",202,0)
 .S ORY(1)="The Quantity set for this order is greater than the Max Quantity"
"RTN","ORALWORD",203,0)
 .S ORY(2)="    allowed for this patient."
"RTN","ORALWORD",204,0)
 ;get max refills for order (ORMAXREF)
"RTN","ORALWORD",205,0)
 D MAXREF^ORWDPS2(.ORMAXREF,ORDFN,ORDRG,ORDS,OROI,1)
"RTN","ORALWORD",206,0)
 ;if refill from order is > max refills return 0 (ORY=0)
"RTN","ORALWORD",207,0)
 I ORREF>ORMAXREF D  Q
"RTN","ORALWORD",208,0)
 .S ORY=0
"RTN","ORALWORD",209,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",210,0)
 .S ORY(1)="The Refills field set for this order is greater than the Refills"
"RTN","ORALWORD",211,0)
 .S ORY(2)="    allowed for this patient with the order having a Days Supply "
"RTN","ORALWORD",212,0)
 .S ORY(3)="    of "_ORDS_"."
"RTN","ORALWORD",213,0)
 Q
"RTN","ORY4270")
0^1^B16073184
"RTN","ORY4270",1,0)
ORY4270 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ; 11/28/18 3:38pm
"RTN","ORY4270",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY4270",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY4270",4,0)
 ;Reference to ^%DT supported by DBIA #10003
"RTN","ORY4270",5,0)
 ;Reference to EN^DIQ1 supported by DBIA #10015
"RTN","ORY4270",6,0)
 ;
"RTN","ORY4270",7,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY4270",8,0)
S ;
"RTN","ORY4270",9,0)
 ;
"RTN","ORY4270",10,0)
 Q
"RTN","ORY4270",11,0)
 ;
"RTN","ORY4270",12,0)
WARN(RTN,MSG,LINES) ;
"RTN","ORY4270",13,0)
 ;
"RTN","ORY4270",14,0)
 Q:$G(OCXAUTO)
"RTN","ORY4270",15,0)
 ;
"RTN","ORY4270",16,0)
 N DASH,LINE,NLINE,PLINE
"RTN","ORY4270",17,0)
 ;
"RTN","ORY4270",18,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)-2))="-"
"RTN","ORY4270",19,0)
 W !!,"--------------",MSG,DASH
"RTN","ORY4270",20,0)
 ;
"RTN","ORY4270",21,0)
 W !,RTN,?10,"[NCCLAB1.AAC.DOMAIN] -> [",$$NETNAME^OCXSEND,"] Line"
"RTN","ORY4270",22,0)
 ;
"RTN","ORY4270",23,0)
 I $O(LINES($O(LINES(0)))) W "s: "
"RTN","ORY4270",24,0)
 E  W ": "
"RTN","ORY4270",25,0)
 ;
"RTN","ORY4270",26,0)
 S LINE=0 F  S LINE=$O(LINES(LINE)) Q:'LINE  D
"RTN","ORY4270",27,0)
 .W:($X>60) !,?40
"RTN","ORY4270",28,0)
 .S NLINE=LINE F  S PLINE=NLINE,NLINE=$O(LINES(NLINE)) Q:(NLINE-PLINE-1)
"RTN","ORY4270",29,0)
 .I (PLINE=LINE) W " ",LINE
"RTN","ORY4270",30,0)
 .E  W " ",LINE,"-",PLINE S LINE=PLINE
"RTN","ORY4270",31,0)
 ;
"RTN","ORY4270",32,0)
 W ! Q
"RTN","ORY4270",33,0)
 ;
"RTN","ORY4270",34,0)
TEXT(RTN,LINE) ;
"RTN","ORY4270",35,0)
 ;
"RTN","ORY4270",36,0)
 N TEXT X "S TEXT=$T(+"_(+LINE)_"^"_RTN_")" Q TEXT
"RTN","ORY4270",37,0)
 ;
"RTN","ORY4270",38,0)
HEADER ;
"RTN","ORY4270",39,0)
 ;
"RTN","ORY4270",40,0)
 W !," Created: MAR 7,2017 at 15:12  at  NCCLAB1.AAC.DOMAIN"
"RTN","ORY4270",41,0)
 W !," Current Date: ",$$NOW,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY4270",42,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY4270",43,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY4270",44,0)
 Q
"RTN","ORY4270",45,0)
 ;
"RTN","ORY4270",46,0)
GETFILE(FILE,RECNAME,ARRAY) ;
"RTN","ORY4270",47,0)
 ;
"RTN","ORY4270",48,0)
 N CHECK,GLNEXT,GLREF,LINES,REC,DD,FLD
"RTN","ORY4270",49,0)
 S REC=$$LOOKUP(FILE,RECNAME)
"RTN","ORY4270",50,0)
 I 'REC W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME Q 0
"RTN","ORY4270",51,0)
 I (REC=-1) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  duplicate local entries.",! Q 0
"RTN","ORY4270",52,0)
 I (REC=-2) W !!,$$FILENAME^OCXSENDD(FILE)," (",FILE,") local file not found." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY4270",53,0)
 I (REC<0) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  unknown lookup error." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY4270",54,0)
 I (REC>0) D
"RTN","ORY4270",55,0)
 .S CHECK=0,LINES=0
"RTN","ORY4270",56,0)
 .D GETREC($$FILE^OCXSENDD(FILE,"GLOBAL NAME"),"ARRAY(",REC,.ARRAY)
"RTN","ORY4270",57,0)
 .S GLREF="ARRAY" F  S GLREF=$Q(@GLREF) Q:'$L(GLREF)  Q:'($E(GLREF,1,6)="ARRAY(")  K:'$L(@GLREF) @GLREF
"RTN","ORY4270",58,0)
 ;
"RTN","ORY4270",59,0)
 Q REC
"RTN","ORY4270",60,0)
 ;
"RTN","ORY4270",61,0)
LKUPARRY(DD,KEY,ARRAY) ;
"RTN","ORY4270",62,0)
 ;
"RTN","ORY4270",63,0)
 N D0 S D0=0 F  S D0=$O(ARRAY(DD,D0)) Q:'D0  Q:($G(ARRAY(DD,D0,.01,"E"))=KEY)
"RTN","ORY4270",64,0)
 Q D0
"RTN","ORY4270",65,0)
 ;
"RTN","ORY4270",66,0)
LOOKUP(FILE,KEY) ;
"RTN","ORY4270",67,0)
 I $O(^TMP("OCXRULE",$J,"B",FILE,KEY,0)) Q 0
"RTN","ORY4270",68,0)
 N RECNAM,REC,D0,CNT,SHORT S (REC,CNT)=0
"RTN","ORY4270",69,0)
 S GL=$$FILE^OCXSENDD(FILE,"GLOBAL NAME") Q:'$L(GL) -2 S GL=$E(GL,1,$L(GL)-1)_")"
"RTN","ORY4270",70,0)
 S SHORT=$E(KEY,1,30),RECNAM=SHORT D  F  S RECNAM=$O(@GL@("B",RECNAM)) Q:'$L(RECNAM)  Q:'($E(RECNAM,1,$L(SHORT))=SHORT)  D
"RTN","ORY4270",71,0)
 .S D0=0 F  S D0=$O(@GL@("B",RECNAM,D0)) Q:'D0  I ($P($G(@GL@(D0,0)),U,1)=KEY) S CNT=CNT+1,REC=D0_U_RECNAME
"RTN","ORY4270",72,0)
 Q:(CNT>1) -1
"RTN","ORY4270",73,0)
 S:$L($P(REC,U,2)) ^TMP("OCXRULE",$J,"A",FILE,$P(REC,U,2))=""
"RTN","ORY4270",74,0)
 Q +REC
"RTN","ORY4270",75,0)
 ;
"RTN","ORY4270",76,0)
GETREC(GL,PATH,D0,REM) ;
"RTN","ORY4270",77,0)
 ;
"RTN","ORY4270",78,0)
 Q:'($P($G(@(GL_"0)")),U,2))
"RTN","ORY4270",79,0)
 N S1,DATA,DD
"RTN","ORY4270",80,0)
 S DATA="" D DIQ(GL,D0,.DATA)
"RTN","ORY4270",81,0)
 S DD=$O(DATA(0)) Q:'DD
"RTN","ORY4270",82,0)
 ;
"RTN","ORY4270",83,0)
 I $L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_""""_DD_":"_D0_""""
"RTN","ORY4270",84,0)
 I '$L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_","""_DD_":"_D0_""""
"RTN","ORY4270",85,0)
 M @(PATH_")")=DATA(DD,D0)
"RTN","ORY4270",86,0)
 ;
"RTN","ORY4270",87,0)
 S S1="" F  S S1=$O(@(GL_D0_","_$$SUB(S1)_")")) Q:'$L(S1)  I ($D(@(GL_D0_","_$$SUB(S1)_")"))>3) D
"RTN","ORY4270",88,0)
 .N D1,GLREF S GLREF=GL_D0_","_$$SUB(S1)_","
"RTN","ORY4270",89,0)
 .S D1=0 F  S D1=$O(@(GLREF_D1_")")) Q:'D1  D GETREC(GLREF,PATH,D1,.REM)
"RTN","ORY4270",90,0)
 ;
"RTN","ORY4270",91,0)
 Q
"RTN","ORY4270",92,0)
 ;
"RTN","ORY4270",93,0)
SUB(X) Q:'(X=+X) """"_X_"""" Q X
"RTN","ORY4270",94,0)
 ;
"RTN","ORY4270",95,0)
DIQ(DIC,DA,OCXARY) ;
"RTN","ORY4270",96,0)
 N DR,DIQ S DR=".01:99999",DIQ="OCXARY(",DIQ(0)="EN" D EN^DIQ1
"RTN","ORY4270",97,0)
 Q
"RTN","ORY4270",98,0)
 ;
"RTN","ORY4270",99,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY4270",100,0)
 ;
"RTN","ORY4270",101,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY4270",102,0)
 ;
"RTN","ORY42701")
0^6^B71203449
"RTN","ORY42701",1,0)
ORY42701 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42701",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42701",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42701",4,0)
 ;
"RTN","ORY42701",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42701",6,0)
S ;
"RTN","ORY42701",7,0)
 ;
"RTN","ORY42701",8,0)
 D DOT^ORY427ES
"RTN","ORY42701",9,0)
 ;
"RTN","ORY42701",10,0)
 ;
"RTN","ORY42701",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42701",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42701",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42701",14,0)
 ;
"RTN","ORY42701",15,0)
 G ^ORY42702
"RTN","ORY42701",16,0)
 ;
"RTN","ORY42701",17,0)
 Q
"RTN","ORY42701",18,0)
 ;
"RTN","ORY42701",19,0)
DATA ;
"RTN","ORY42701",20,0)
 ;
"RTN","ORY42701",21,0)
 ;;ROOT^OCXS(860.2,0)^ORDER CHECK RULE^860.2I
"RTN","ORY42701",22,0)
 ;;ROOT^OCXS(860.3,0)^ORDER CHECK ELEMENT^860.3
"RTN","ORY42701",23,0)
 ;;ROOT^OCXS(860.4,0)^ORDER CHECK DATA FIELD^860.4I
"RTN","ORY42701",24,0)
 ;;ROOT^OCXS(860.5,0)^ORDER CHECK DATA SOURCE^860.5
"RTN","ORY42701",25,0)
 ;;ROOT^OCXS(860.6,0)^ORDER CHECK DATA CONTEXT^860.6
"RTN","ORY42701",26,0)
 ;;ROOT^OCXS(860.8,0)^ORDER CHECK COMPILER FUNCTIONS^860.8
"RTN","ORY42701",27,0)
 ;;ROOT^OCXS(860.9,0)^ORDER CHECK NATIONAL TERM^860.9
"RTN","ORY42701",28,0)
 ;;ROOT^OCXS(863,0)^OCX MDD CLASS^863
"RTN","ORY42701",29,0)
 ;;ROOT^OCXS(863.1,0)^OCX MDD APPLICATION^863.1
"RTN","ORY42701",30,0)
 ;;ROOT^OCXS(863.2,0)^OCX MDD SUBJECT^863.2
"RTN","ORY42701",31,0)
 ;;ROOT^OCXS(863.3,0)^OCX MDD LINK^863.3I
"RTN","ORY42701",32,0)
 ;;ROOT^OCXS(863.4,0)^OCX MDD ATTRIBUTE^863.4
"RTN","ORY42701",33,0)
 ;;ROOT^OCXS(863.5,0)^OCX MDD VALUES^863.5
"RTN","ORY42701",34,0)
 ;;ROOT^OCXS(863.6,0)^OCX MDD METHOD^863.6
"RTN","ORY42701",35,0)
 ;;ROOT^OCXS(863.7,0)^OCX MDD PUBLIC FUNCTION^863.7
"RTN","ORY42701",36,0)
 ;;ROOT^OCXS(863.8,0)^OCX MDD PARAMETER^863.8
"RTN","ORY42701",37,0)
 ;;ROOT^OCXS(863.9,0)^OCX MDD CONDITION/FUNCTION^863.9I
"RTN","ORY42701",38,0)
 ;;ROOT^OCXS(864,0)^OCX MDD SITE PREFERENCES^864P
"RTN","ORY42701",39,0)
 ;;ROOT^OCXS(864.1,0)^OCX MDD DATATYPE^864.1
"RTN","ORY42701",40,0)
 ;;ROOT^OCXD(860.1,0)^ORDER CHECK PATIENT ACTIVE DATA^860.1P
"RTN","ORY42701",41,0)
 ;;ROOT^OCXD(860.7,0)^ORDER CHECK PATIENT RULE EVENT^860.7P
"RTN","ORY42701",42,0)
 ;;ROOT^OCXD(861,0)^ORDER CHECK RAW DATA LOG^861
"RTN","ORY42701",43,0)
 ;;SOF^863.8  OCX MDD PARAMETER
"RTN","ORY42701",44,0)
 ;;KEY^863.8:^COMPARISON VALUE
"RTN","ORY42701",45,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",46,0)
 ;;D^COMPARISON VALUE
"RTN","ORY42701",47,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",48,0)
 ;;D^CVAL
"RTN","ORY42701",49,0)
 ;;R^"863.8:",1,2
"RTN","ORY42701",50,0)
 ;;D^   This is a value to be compared with PRIMARY DATA FIELD
"RTN","ORY42701",51,0)
 ;;R^"863.8:",1,3
"RTN","ORY42701",52,0)
 ;;D^ in a truth conditional.
"RTN","ORY42701",53,0)
 ;;EOR^
"RTN","ORY42701",54,0)
 ;;KEY^863.8:^DATA TYPE
"RTN","ORY42701",55,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",56,0)
 ;;D^DATA TYPE
"RTN","ORY42701",57,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",58,0)
 ;;D^DATA TYPE
"RTN","ORY42701",59,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",60,0)
 ;;D^An MDD data type; i.e., an entry in the OCX MDD DATA TYPE file.
"RTN","ORY42701",61,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY42701",62,0)
 ;;D^QUERY
"RTN","ORY42701",63,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY42701",64,0)
 ;;D^Enter the datatype
"RTN","ORY42701",65,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY42701",66,0)
 ;;D^DIC
"RTN","ORY42701",67,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY42701",68,0)
 ;;D^864.1
"RTN","ORY42701",69,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY42701",70,0)
 ;;D^DATA TYPE
"RTN","ORY42701",71,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY42701",72,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY42701",73,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY42701",74,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY42701",75,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY42701",76,0)
 ;;D^B^C
"RTN","ORY42701",77,0)
 ;;EOR^
"RTN","ORY42701",78,0)
 ;;KEY^863.8:^DIC
"RTN","ORY42701",79,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",80,0)
 ;;D^DIC
"RTN","ORY42701",81,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",82,0)
 ;;D^DIC
"RTN","ORY42701",83,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",84,0)
 ;;D^An open reference used to specify the file in a DIC lookup
"RTN","ORY42701",85,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY42701",86,0)
 ;;D^DATA TYPE
"RTN","ORY42701",87,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY42701",88,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY42701",89,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY42701",90,0)
 ;;D^DIC
"RTN","ORY42701",91,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY42701",92,0)
 ;;D^1
"RTN","ORY42701",93,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42701",94,0)
 ;;D^QUERY
"RTN","ORY42701",95,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42701",96,0)
 ;;D^Enter the name of the file you are pointing to
"RTN","ORY42701",97,0)
 ;;EOR^
"RTN","ORY42701",98,0)
 ;;KEY^863.8:^DIC LOOKUP INDEX STRING
"RTN","ORY42701",99,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",100,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY42701",101,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",102,0)
 ;;D^DICIX
"RTN","ORY42701",103,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",104,0)
 ;;D^Contains the names of indices to be used in a DIC lookup in a comma
"RTN","ORY42701",105,0)
 ;;R^"863.8:",1,2
"RTN","ORY42701",106,0)
 ;;D^delimited string.
"RTN","ORY42701",107,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY42701",108,0)
 ;;D^DATA TYPE
"RTN","ORY42701",109,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY42701",110,0)
 ;;D^FREE TEXT
"RTN","ORY42701",111,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY42701",112,0)
 ;;D^QUERY
"RTN","ORY42701",113,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY42701",114,0)
 ;;D^Enter a DIC lookup index string
"RTN","ORY42701",115,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42701",116,0)
 ;;D^HELP MESSAGE
"RTN","ORY42701",117,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42701",118,0)
 ;;D^This is an '^' delimited string which contains the names of indices which are to be used in a DIC lookup; e.g., B^C^DOB.
"RTN","ORY42701",119,0)
 ;;EOR^
"RTN","ORY42701",120,0)
 ;;KEY^863.8:^FILE
"RTN","ORY42701",121,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",122,0)
 ;;D^FILE
"RTN","ORY42701",123,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",124,0)
 ;;D^FILE
"RTN","ORY42701",125,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",126,0)
 ;;D^The internal entry number of a file.
"RTN","ORY42701",127,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY42701",128,0)
 ;;D^QUERY
"RTN","ORY42701",129,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY42701",130,0)
 ;;D^File
"RTN","ORY42701",131,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY42701",132,0)
 ;;D^DATA TYPE
"RTN","ORY42701",133,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY42701",134,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY42701",135,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY42701",136,0)
 ;;D^DIC
"RTN","ORY42701",137,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY42701",138,0)
 ;;D^1
"RTN","ORY42701",139,0)
 ;;EOR^
"RTN","ORY42701",140,0)
 ;;KEY^863.8:^FM MASK
"RTN","ORY42701",141,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",142,0)
 ;;D^FM MASK
"RTN","ORY42701",143,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",144,0)
 ;;D^FM MASK
"RTN","ORY42701",145,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",146,0)
 ;;D^Tag^routine where code is located to parse the FM DD and override the parameter value
"RTN","ORY42701",147,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY42701",148,0)
 ;;D^QUERY
"RTN","ORY42701",149,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY42701",150,0)
 ;;D^Enter tag^routine where the FM MASK parser is located
"RTN","ORY42701",151,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY42701",152,0)
 ;;D^DATA TYPE
"RTN","ORY42701",153,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY42701",154,0)
 ;;D^LINE TAG
"RTN","ORY42701",155,0)
 ;;EOR^
"RTN","ORY42701",156,0)
 ;;KEY^863.8:^FREE TEXT MAXIMUM LENGTH
"RTN","ORY42701",157,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",158,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY42701",159,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",160,0)
 ;;D^FMAX
"RTN","ORY42701",161,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",162,0)
 ;;D^Maximum string length allowed
"RTN","ORY42701",163,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY42701",164,0)
 ;;D^245
"RTN","ORY42701",165,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42701",166,0)
 ;;D^QUERY
"RTN","ORY42701",167,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42701",168,0)
 ;;D^Maximum text string length allowed
"RTN","ORY42701",169,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY42701",170,0)
 ;;D^FM MASK
"RTN","ORY42701",171,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY42701",172,0)
 ;;D^FMAX^OCXF6
"RTN","ORY42701",173,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY42701",174,0)
 ;;D^DATA TYPE
"RTN","ORY42701",175,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY42701",176,0)
 ;;D^POSITIVE INTEGER
"RTN","ORY42701",177,0)
 ;;EOR^
"RTN","ORY42701",178,0)
 ;;KEY^863.8:^HELP MESSAGE
"RTN","ORY42701",179,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",180,0)
 ;;D^HELP MESSAGE
"RTN","ORY42701",181,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",182,0)
 ;;D^HELP
"RTN","ORY42701",183,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",184,0)
 ;;D^A text string 1-250 characters long which overrides the Fileman help
"RTN","ORY42701",185,0)
 ;;R^"863.8:",1,2
"RTN","ORY42701",186,0)
 ;;D^message.
"RTN","ORY42701",187,0)
 ;;R^"863.8:","863.84:10",.01,"E"
"RTN","ORY42701",188,0)
 ;;D^QUERY
"RTN","ORY42701",189,0)
 ;;R^"863.8:","863.84:10",1,"E"
"RTN","ORY42701",190,0)
 ;;D^Enter a brief help message
"RTN","ORY42701",191,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY42701",192,0)
 ;;D^DATA TYPE
"RTN","ORY42701",193,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY42701",194,0)
 ;;D^FREE TEXT
"RTN","ORY42701",195,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY42701",196,0)
 ;;D^FM MASK
"RTN","ORY42701",197,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY42701",198,0)
 ;;D^HELP^OCXF6
"RTN","ORY42701",199,0)
 ;;EOR^
"RTN","ORY42701",200,0)
 ;;KEY^863.8:^LOOP QUERY
"RTN","ORY42701",201,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",202,0)
 ;;D^LOOP QUERY
"RTN","ORY42701",203,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",204,0)
 ;;D^LOOP QUERY
"RTN","ORY42701",205,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",206,0)
 ;;D^Alternate query used when repeated answers are required
"RTN","ORY42701",207,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY42701",208,0)
 ;;D^DATA TYPE
"RTN","ORY42701",209,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY42701",210,0)
 ;;D^FREE TEXT
"RTN","ORY42701",211,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY42701",212,0)
 ;;D^QUERY
"RTN","ORY42701",213,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY42701",214,0)
 ;;D^Enter loop query text
"RTN","ORY42701",215,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42701",216,0)
 ;;D^HELP MESSAGE
"RTN","ORY42701",217,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42701",218,0)
 ;;D^This is the query text for all entries after the first one
"RTN","ORY42701",219,0)
 ;;EOR^
"RTN","ORY42701",220,0)
 ;;KEY^863.8:^MANDATORY MESSAGE
"RTN","ORY42701",221,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",222,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY42701",223,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",224,0)
 ;;D^MAND MSG
"RTN","ORY42701",225,0)
 ;;R^"863.8:",1,1
"RTN","ORY42701",226,0)
 ;;D^Message sent to user telling him that his entry is mandatory
"RTN","ORY42701",227,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY42701",228,0)
 ;;D^Mandatory answer.  You must enter a value or '^' to exit.
"RTN","ORY42701",229,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY42701",230,0)
 ;;D^QUERY
"RTN","ORY42701",231,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY42701",232,0)
 ;;D^Enter message
"RTN","ORY42701",233,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY42701",234,0)
 ;;D^DATA TYPE
"RTN","ORY42701",235,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY42701",236,0)
 ;;D^FREE TEXT
"RTN","ORY42701",237,0)
 ;;EOR^
"RTN","ORY42701",238,0)
 ;;KEY^863.8:^OCXO DATA DRIVE SOURCE
"RTN","ORY42701",239,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",240,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY42701",241,0)
 ;;EOR^
"RTN","ORY42701",242,0)
 ;;KEY^863.8:^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42701",243,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",244,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42701",245,0)
 ;;EOR^
"RTN","ORY42701",246,0)
 ;;KEY^863.8:^OCXO FILE POINTER
"RTN","ORY42701",247,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",248,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY42701",249,0)
 ;;EOR^
"RTN","ORY42701",250,0)
 ;;KEY^863.8:^OCXO GENERATE CODE FUNCTION
"RTN","ORY42701",251,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",252,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42701",253,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",254,0)
 ;;D^GEN
"RTN","ORY42701",255,0)
 ;;EOR^
"RTN","ORY42701",256,0)
 ;;KEY^863.8:^OCXO HL7 SEGMENT ID
"RTN","ORY42701",257,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",258,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY42701",259,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42701",260,0)
 ;;D^HL7SEGID
"RTN","ORY42701",261,0)
 ;;EOR^
"RTN","ORY42701",262,0)
 ;;KEY^863.8:^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY42701",263,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",264,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY42701",265,0)
 ;;EOR^
"RTN","ORY42701",266,0)
 ;;KEY^863.8:^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42701",267,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",268,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42701",269,0)
 ;;EOR^
"RTN","ORY42701",270,0)
 ;;KEY^863.8:^OCXO VARIABLE NAME
"RTN","ORY42701",271,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",272,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42701",273,0)
 ;;EOR^
"RTN","ORY42701",274,0)
 ;;KEY^863.8:^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42701",275,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",276,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42701",277,0)
 ;;EOR^
"RTN","ORY42701",278,0)
 ;;KEY^863.8:^PRIMARY DATA FIELD
"RTN","ORY42701",279,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42701",280,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42701",281,0)
 ;1;
"RTN","ORY42701",282,0)
 ;
"RTN","ORY42702")
0^7^B78453694
"RTN","ORY42702",1,0)
ORY42702 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42702",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42702",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42702",4,0)
 ;
"RTN","ORY42702",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42702",6,0)
S ;
"RTN","ORY42702",7,0)
 ;
"RTN","ORY42702",8,0)
 D DOT^ORY427ES
"RTN","ORY42702",9,0)
 ;
"RTN","ORY42702",10,0)
 ;
"RTN","ORY42702",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42702",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42702",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42702",14,0)
 ;
"RTN","ORY42702",15,0)
 G ^ORY42703
"RTN","ORY42702",16,0)
 ;
"RTN","ORY42702",17,0)
 Q
"RTN","ORY42702",18,0)
 ;
"RTN","ORY42702",19,0)
DATA ;
"RTN","ORY42702",20,0)
 ;
"RTN","ORY42702",21,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42702",22,0)
 ;;D^PDFLD
"RTN","ORY42702",23,0)
 ;;R^"863.8:",1,2
"RTN","ORY42702",24,0)
 ;;D^  Primary data field in a comparison expression that
"RTN","ORY42702",25,0)
 ;;R^"863.8:",1,3
"RTN","ORY42702",26,0)
 ;;D^ is to be tested.
"RTN","ORY42702",27,0)
 ;;EOR^
"RTN","ORY42702",28,0)
 ;;KEY^863.8:^QUERY
"RTN","ORY42702",29,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42702",30,0)
 ;;D^QUERY
"RTN","ORY42702",31,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42702",32,0)
 ;;D^QUERY
"RTN","ORY42702",33,0)
 ;;R^"863.8:",1,1
"RTN","ORY42702",34,0)
 ;;D^Used with methods that manage interactive dialogues.  Equivalent to DIC("A")
"RTN","ORY42702",35,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY42702",36,0)
 ;;D^DATA TYPE
"RTN","ORY42702",37,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY42702",38,0)
 ;;D^FREE TEXT
"RTN","ORY42702",39,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY42702",40,0)
 ;;D^QUERY
"RTN","ORY42702",41,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY42702",42,0)
 ;;D^Enter the query (free text string)
"RTN","ORY42702",43,0)
 ;;EOR^
"RTN","ORY42702",44,0)
 ;;KEY^863.8:^REPEAT THE QUERY
"RTN","ORY42702",45,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42702",46,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY42702",47,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42702",48,0)
 ;;D^LOOP
"RTN","ORY42702",49,0)
 ;;R^"863.8:",1,1
"RTN","ORY42702",50,0)
 ;;D^Set this = 1 to repetitively ask the user to enter a value
"RTN","ORY42702",51,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY42702",52,0)
 ;;D^DATA TYPE
"RTN","ORY42702",53,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY42702",54,0)
 ;;D^YES NO
"RTN","ORY42702",55,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY42702",56,0)
 ;;D^HELP MESSAGE
"RTN","ORY42702",57,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY42702",58,0)
 ;;D^Answer 'YES' if you want the user to repetitively enter a value.
"RTN","ORY42702",59,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42702",60,0)
 ;;D^QUERY
"RTN","ORY42702",61,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42702",62,0)
 ;;D^Is the query repetitive
"RTN","ORY42702",63,0)
 ;;EOR^
"RTN","ORY42702",64,0)
 ;;KEY^863.8:^TERMINATOR
"RTN","ORY42702",65,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42702",66,0)
 ;;D^TERMINATOR
"RTN","ORY42702",67,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42702",68,0)
 ;;D^TERMINATOR
"RTN","ORY42702",69,0)
 ;;R^"863.8:",1,1
"RTN","ORY42702",70,0)
 ;;D^A text string terminator; e.g., '?', ': ', '=>'
"RTN","ORY42702",71,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY42702",72,0)
 ;;D^:
"RTN","ORY42702",73,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY42702",74,0)
 ;;D^QUERY
"RTN","ORY42702",75,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY42702",76,0)
 ;;D^Enter text string terminator
"RTN","ORY42702",77,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY42702",78,0)
 ;;D^DATA TYPE
"RTN","ORY42702",79,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY42702",80,0)
 ;;D^FREE TEXT
"RTN","ORY42702",81,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY42702",82,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY42702",83,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY42702",84,0)
 ;;D^9
"RTN","ORY42702",85,0)
 ;;EOR^
"RTN","ORY42702",86,0)
 ;;KEY^863.8:^VALUE CALL
"RTN","ORY42702",87,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY42702",88,0)
 ;;D^VALUE CALL
"RTN","ORY42702",89,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY42702",90,0)
 ;;D^VAL CALL
"RTN","ORY42702",91,0)
 ;;R^"863.8:",.03,"E"
"RTN","ORY42702",92,0)
 ;;D^NO
"RTN","ORY42702",93,0)
 ;;R^"863.8:",1,1
"RTN","ORY42702",94,0)
 ;;D^tag^routine which manages the dialogue for collecting and validating a value
"RTN","ORY42702",95,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY42702",96,0)
 ;;D^QUERY
"RTN","ORY42702",97,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY42702",98,0)
 ;;D^Enter tag^routine
"RTN","ORY42702",99,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY42702",100,0)
 ;;D^DATA TYPE
"RTN","ORY42702",101,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY42702",102,0)
 ;;D^LINE TAG
"RTN","ORY42702",103,0)
 ;;EOR^
"RTN","ORY42702",104,0)
 ;;EOF^OCXS(863.8)^1
"RTN","ORY42702",105,0)
 ;;SOF^864.1  OCX MDD DATATYPE
"RTN","ORY42702",106,0)
 ;;KEY^864.1:^BOOLEAN
"RTN","ORY42702",107,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY42702",108,0)
 ;;D^BOOLEAN
"RTN","ORY42702",109,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY42702",110,0)
 ;;D^BOOL
"RTN","ORY42702",111,0)
 ;;EOR^
"RTN","ORY42702",112,0)
 ;;KEY^864.1:^FREE TEXT
"RTN","ORY42702",113,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY42702",114,0)
 ;;D^FREE TEXT
"RTN","ORY42702",115,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY42702",116,0)
 ;;D^FT
"RTN","ORY42702",117,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY42702",118,0)
 ;;D^GENERIC
"RTN","ORY42702",119,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY42702",120,0)
 ;;D^VALUE CALL
"RTN","ORY42702",121,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY42702",122,0)
 ;;D^FT^OCXFDFT
"RTN","ORY42702",123,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY42702",124,0)
 ;;D^QUERY
"RTN","ORY42702",125,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY42702",126,0)
 ;;D^Enter a free text string
"RTN","ORY42702",127,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY42702",128,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY42702",129,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY42702",130,0)
 ;;D^240
"RTN","ORY42702",131,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY42702",132,0)
 ;;D^HELP MESSAGE
"RTN","ORY42702",133,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY42702",134,0)
 ;;D^Enter a free text string.  Do not use control characters.  |FTMM HELP|
"RTN","ORY42702",135,0)
 ;;R^"864.1:","864.11:5",.01,"E"
"RTN","ORY42702",136,0)
 ;;D^LOOP QUERY
"RTN","ORY42702",137,0)
 ;;R^"864.1:","864.11:5",1,"E"
"RTN","ORY42702",138,0)
 ;;D^Enter another free text string
"RTN","ORY42702",139,0)
 ;;R^"864.1:","864.11:6",.01,"E"
"RTN","ORY42702",140,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY42702",141,0)
 ;;R^"864.1:","864.11:6",1,"E"
"RTN","ORY42702",142,0)
 ;;D^0
"RTN","ORY42702",143,0)
 ;;EOR^
"RTN","ORY42702",144,0)
 ;;KEY^864.1:^GENERIC
"RTN","ORY42702",145,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY42702",146,0)
 ;;D^GENERIC
"RTN","ORY42702",147,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY42702",148,0)
 ;;D^GENERIC
"RTN","ORY42702",149,0)
 ;;R^"864.1:","864.11:11",.01,"E"
"RTN","ORY42702",150,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY42702",151,0)
 ;;R^"864.1:","864.11:11",1,"E"
"RTN","ORY42702",152,0)
 ;;D^This answer is mandatory.  Enter a response or press '^' to exit.
"RTN","ORY42702",153,0)
 ;;R^"864.1:","864.11:12",.01,"E"
"RTN","ORY42702",154,0)
 ;;D^TERMINATOR
"RTN","ORY42702",155,0)
 ;;R^"864.1:","864.11:12",1,"E"
"RTN","ORY42702",156,0)
 ;;D^:
"RTN","ORY42702",157,0)
 ;;R^"864.1:","864.11:13",.01,"E"
"RTN","ORY42702",158,0)
 ;;D^LOOP QUERY
"RTN","ORY42702",159,0)
 ;;R^"864.1:","864.11:13",1,"E"
"RTN","ORY42702",160,0)
 ;;D^Enter another value
"RTN","ORY42702",161,0)
 ;;R^"864.1:","864.11:7",.01,"E"
"RTN","ORY42702",162,0)
 ;;D^VALUE CALL
"RTN","ORY42702",163,0)
 ;;R^"864.1:","864.11:7",1,"E"
"RTN","ORY42702",164,0)
 ;;D^GEN^OCXFDMOM
"RTN","ORY42702",165,0)
 ;;R^"864.1:","864.11:8",.01,"E"
"RTN","ORY42702",166,0)
 ;;D^QUERY
"RTN","ORY42702",167,0)
 ;;R^"864.1:","864.11:8",1,"E"
"RTN","ORY42702",168,0)
 ;;D^Enter a value
"RTN","ORY42702",169,0)
 ;;R^"864.1:","864.11:9",.01,"E"
"RTN","ORY42702",170,0)
 ;;D^HELP MESSAGE
"RTN","ORY42702",171,0)
 ;;R^"864.1:","864.11:9",1,"E"
"RTN","ORY42702",172,0)
 ;;D^ 
"RTN","ORY42702",173,0)
 ;;EOR^
"RTN","ORY42702",174,0)
 ;;KEY^864.1:^NUMERIC
"RTN","ORY42702",175,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY42702",176,0)
 ;;D^NUMERIC
"RTN","ORY42702",177,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY42702",178,0)
 ;;D^NUMERIC
"RTN","ORY42702",179,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY42702",180,0)
 ;;D^GENERIC
"RTN","ORY42702",181,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY42702",182,0)
 ;;D^VALUE CALL
"RTN","ORY42702",183,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY42702",184,0)
 ;;D^NU^OCXFDNU
"RTN","ORY42702",185,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY42702",186,0)
 ;;D^QUERY
"RTN","ORY42702",187,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY42702",188,0)
 ;;D^Enter a number
"RTN","ORY42702",189,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY42702",190,0)
 ;;D^LOOP QUERY
"RTN","ORY42702",191,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY42702",192,0)
 ;;D^Enter another number
"RTN","ORY42702",193,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY42702",194,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY42702",195,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY42702",196,0)
 ;;D^0
"RTN","ORY42702",197,0)
 ;;EOR^
"RTN","ORY42702",198,0)
 ;;EOF^OCXS(864.1)^1
"RTN","ORY42702",199,0)
 ;;SOF^863.7  OCX MDD PUBLIC FUNCTION
"RTN","ORY42702",200,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY42702",201,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",202,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY42702",203,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",204,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",205,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",206,0)
 ;;D^FALSE^OCXF23
"RTN","ORY42702",207,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",208,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",209,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",210,0)
 ;;D^1
"RTN","ORY42702",211,0)
 ;;EOR^
"RTN","ORY42702",212,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY42702",213,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",214,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY42702",215,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",216,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",217,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",218,0)
 ;;D^TRUE^OCXF23
"RTN","ORY42702",219,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",220,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",221,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",222,0)
 ;;D^1
"RTN","ORY42702",223,0)
 ;;EOR^
"RTN","ORY42702",224,0)
 ;;KEY^863.7:^GCC FREE TEXT EQUALS
"RTN","ORY42702",225,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",226,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY42702",227,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",228,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",229,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",230,0)
 ;;D^AEQ^OCXF22
"RTN","ORY42702",231,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",232,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",233,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",234,0)
 ;;D^1
"RTN","ORY42702",235,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY42702",236,0)
 ;;D^COMPARISON VALUE
"RTN","ORY42702",237,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY42702",238,0)
 ;;D^2
"RTN","ORY42702",239,0)
 ;;EOR^
"RTN","ORY42702",240,0)
 ;;KEY^863.7:^GCC FREE TEXT STARTS WITH
"RTN","ORY42702",241,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",242,0)
 ;;D^GCC FREE TEXT STARTS WITH
"RTN","ORY42702",243,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",244,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",245,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",246,0)
 ;;D^START^OCXF22
"RTN","ORY42702",247,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",248,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",249,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",250,0)
 ;;D^1
"RTN","ORY42702",251,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY42702",252,0)
 ;;D^COMPARISON VALUE
"RTN","ORY42702",253,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY42702",254,0)
 ;;D^2
"RTN","ORY42702",255,0)
 ;;EOR^
"RTN","ORY42702",256,0)
 ;;KEY^863.7:^GCC NUMERIC GREATER THAN
"RTN","ORY42702",257,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",258,0)
 ;;D^GCC NUMERIC GREATER THAN
"RTN","ORY42702",259,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",260,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",261,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",262,0)
 ;;D^GRT^OCXF20
"RTN","ORY42702",263,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",264,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",265,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",266,0)
 ;;D^1
"RTN","ORY42702",267,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY42702",268,0)
 ;;D^COMPARISON VALUE
"RTN","ORY42702",269,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY42702",270,0)
 ;;D^2
"RTN","ORY42702",271,0)
 ;;EOR^
"RTN","ORY42702",272,0)
 ;;KEY^863.7:^GCC NUMERIC LESS THAN
"RTN","ORY42702",273,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY42702",274,0)
 ;;D^GCC NUMERIC LESS THAN
"RTN","ORY42702",275,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY42702",276,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY42702",277,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY42702",278,0)
 ;;D^LESS^OCXF20
"RTN","ORY42702",279,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY42702",280,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY42702",281,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY42702",282,0)
 ;;D^1
"RTN","ORY42702",283,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY42702",284,0)
 ;;D^COMPARISON VALUE
"RTN","ORY42702",285,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY42702",286,0)
 ;;D^2
"RTN","ORY42702",287,0)
 ;;EOR^
"RTN","ORY42702",288,0)
 ;;EOF^OCXS(863.7)^1
"RTN","ORY42702",289,0)
 ;;SOF^863.9  OCX MDD CONDITION/FUNCTION
"RTN","ORY42702",290,0)
 ;;KEY^863.9:^EQ FREE TEXT
"RTN","ORY42702",291,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42702",292,0)
 ;;D^EQ FREE TEXT
"RTN","ORY42702",293,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42702",294,0)
 ;;D^FREE TEXT
"RTN","ORY42702",295,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42702",296,0)
 ;;D^IS EQUAL TO
"RTN","ORY42702",297,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY42702",298,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42702",299,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY42702",300,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY42702",301,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY42702",302,0)
 ;;D^EQUALS
"RTN","ORY42702",303,0)
 ;;EOR^
"RTN","ORY42702",304,0)
 ;;KEY^863.9:^GREATER THAN
"RTN","ORY42702",305,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42702",306,0)
 ;;D^GREATER THAN
"RTN","ORY42702",307,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42702",308,0)
 ;;D^NUMERIC
"RTN","ORY42702",309,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42702",310,0)
 ;;D^IS GREATER THAN
"RTN","ORY42702",311,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY42702",312,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42702",313,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY42702",314,0)
 ;;D^GCC NUMERIC GREATER THAN
"RTN","ORY42702",315,0)
 ;;EOR^
"RTN","ORY42702",316,0)
 ;;KEY^863.9:^LESS THAN
"RTN","ORY42702",317,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42702",318,0)
 ;;D^LESS THAN
"RTN","ORY42702",319,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42702",320,0)
 ;;D^NUMERIC
"RTN","ORY42702",321,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42702",322,0)
 ;;D^IS LESS THAN
"RTN","ORY42702",323,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY42702",324,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42702",325,0)
 ;1;
"RTN","ORY42702",326,0)
 ;
"RTN","ORY42703")
0^8^B78751328
"RTN","ORY42703",1,0)
ORY42703 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42703",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42703",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42703",4,0)
 ;
"RTN","ORY42703",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42703",6,0)
S ;
"RTN","ORY42703",7,0)
 ;
"RTN","ORY42703",8,0)
 D DOT^ORY427ES
"RTN","ORY42703",9,0)
 ;
"RTN","ORY42703",10,0)
 ;
"RTN","ORY42703",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42703",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42703",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42703",14,0)
 ;
"RTN","ORY42703",15,0)
 G ^ORY42704
"RTN","ORY42703",16,0)
 ;
"RTN","ORY42703",17,0)
 Q
"RTN","ORY42703",18,0)
 ;
"RTN","ORY42703",19,0)
DATA ;
"RTN","ORY42703",20,0)
 ;
"RTN","ORY42703",21,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY42703",22,0)
 ;;D^GCC NUMERIC LESS THAN
"RTN","ORY42703",23,0)
 ;;EOR^
"RTN","ORY42703",24,0)
 ;;KEY^863.9:^LOGICAL FALSE
"RTN","ORY42703",25,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42703",26,0)
 ;;D^LOGICAL FALSE
"RTN","ORY42703",27,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42703",28,0)
 ;;D^BOOLEAN
"RTN","ORY42703",29,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY42703",30,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY42703",31,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42703",32,0)
 ;;D^IS FALSE
"RTN","ORY42703",33,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY42703",34,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42703",35,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY42703",36,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY42703",37,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY42703",38,0)
 ;;D^FALSE
"RTN","ORY42703",39,0)
 ;;EOR^
"RTN","ORY42703",40,0)
 ;;KEY^863.9:^LOGICAL TRUE
"RTN","ORY42703",41,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42703",42,0)
 ;;D^LOGICAL TRUE
"RTN","ORY42703",43,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42703",44,0)
 ;;D^BOOLEAN
"RTN","ORY42703",45,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY42703",46,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY42703",47,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42703",48,0)
 ;;D^IS TRUE
"RTN","ORY42703",49,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY42703",50,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42703",51,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY42703",52,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY42703",53,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY42703",54,0)
 ;;D^TRUE
"RTN","ORY42703",55,0)
 ;;EOR^
"RTN","ORY42703",56,0)
 ;;KEY^863.9:^STARTS WITH
"RTN","ORY42703",57,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY42703",58,0)
 ;;D^STARTS WITH
"RTN","ORY42703",59,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY42703",60,0)
 ;;D^FREE TEXT
"RTN","ORY42703",61,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY42703",62,0)
 ;;D^STARTS WITH
"RTN","ORY42703",63,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY42703",64,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY42703",65,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY42703",66,0)
 ;;D^GCC FREE TEXT STARTS WITH
"RTN","ORY42703",67,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY42703",68,0)
 ;;D^BEGINS WITH
"RTN","ORY42703",69,0)
 ;;EOR^
"RTN","ORY42703",70,0)
 ;;EOF^OCXS(863.9)^1
"RTN","ORY42703",71,0)
 ;;SOF^863.4  OCX MDD ATTRIBUTE
"RTN","ORY42703",72,0)
 ;;KEY^863.4:^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42703",73,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",74,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42703",75,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",76,0)
 ;;D^DATA TYPE
"RTN","ORY42703",77,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",78,0)
 ;;D^BOOLEAN
"RTN","ORY42703",79,0)
 ;;EOR^
"RTN","ORY42703",80,0)
 ;;KEY^863.4:^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42703",81,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",82,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42703",83,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",84,0)
 ;;D^DATA TYPE
"RTN","ORY42703",85,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",86,0)
 ;;D^NUMERIC
"RTN","ORY42703",87,0)
 ;;EOR^
"RTN","ORY42703",88,0)
 ;;KEY^863.4:^CLOZAPINE LAB RESULTS
"RTN","ORY42703",89,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",90,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY42703",91,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",92,0)
 ;;D^DATA TYPE
"RTN","ORY42703",93,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",94,0)
 ;;D^FREE TEXT
"RTN","ORY42703",95,0)
 ;;EOR^
"RTN","ORY42703",96,0)
 ;;KEY^863.4:^CLOZAPINE MED
"RTN","ORY42703",97,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",98,0)
 ;;D^CLOZAPINE MED
"RTN","ORY42703",99,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",100,0)
 ;;D^DATA TYPE
"RTN","ORY42703",101,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",102,0)
 ;;D^BOOLEAN
"RTN","ORY42703",103,0)
 ;;EOR^
"RTN","ORY42703",104,0)
 ;;KEY^863.4:^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42703",105,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",106,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42703",107,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",108,0)
 ;;D^DATA TYPE
"RTN","ORY42703",109,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",110,0)
 ;;D^BOOLEAN
"RTN","ORY42703",111,0)
 ;;EOR^
"RTN","ORY42703",112,0)
 ;;KEY^863.4:^DISPENSE DRUG
"RTN","ORY42703",113,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",114,0)
 ;;D^DISPENSE DRUG
"RTN","ORY42703",115,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",116,0)
 ;;D^DATA TYPE
"RTN","ORY42703",117,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",118,0)
 ;;D^FREE TEXT
"RTN","ORY42703",119,0)
 ;;EOR^
"RTN","ORY42703",120,0)
 ;;KEY^863.4:^FILLER
"RTN","ORY42703",121,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",122,0)
 ;;D^FILLER
"RTN","ORY42703",123,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",124,0)
 ;;D^DATA TYPE
"RTN","ORY42703",125,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",126,0)
 ;;D^FREE TEXT
"RTN","ORY42703",127,0)
 ;;EOR^
"RTN","ORY42703",128,0)
 ;;KEY^863.4:^HL7 FILLER
"RTN","ORY42703",129,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",130,0)
 ;;D^HL7 FILLER
"RTN","ORY42703",131,0)
 ;;R^"863.4:",.02,"E"
"RTN","ORY42703",132,0)
 ;;D^HL7FILLR
"RTN","ORY42703",133,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",134,0)
 ;;D^DATA TYPE
"RTN","ORY42703",135,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",136,0)
 ;;D^FREE TEXT
"RTN","ORY42703",137,0)
 ;;EOR^
"RTN","ORY42703",138,0)
 ;;KEY^863.4:^IEN
"RTN","ORY42703",139,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",140,0)
 ;;D^IEN
"RTN","ORY42703",141,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",142,0)
 ;;D^DATA TYPE
"RTN","ORY42703",143,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",144,0)
 ;;D^NUMERIC
"RTN","ORY42703",145,0)
 ;;EOR^
"RTN","ORY42703",146,0)
 ;;KEY^863.4:^ORDER MODE
"RTN","ORY42703",147,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",148,0)
 ;;D^ORDER MODE
"RTN","ORY42703",149,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",150,0)
 ;;D^DATA TYPE
"RTN","ORY42703",151,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",152,0)
 ;;D^FREE TEXT
"RTN","ORY42703",153,0)
 ;;EOR^
"RTN","ORY42703",154,0)
 ;;KEY^863.4:^ORDER PATIENT
"RTN","ORY42703",155,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY42703",156,0)
 ;;D^ORDER PATIENT
"RTN","ORY42703",157,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY42703",158,0)
 ;;D^DATA TYPE
"RTN","ORY42703",159,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY42703",160,0)
 ;;D^NUMERIC
"RTN","ORY42703",161,0)
 ;;EOR^
"RTN","ORY42703",162,0)
 ;;EOF^OCXS(863.4)^1
"RTN","ORY42703",163,0)
 ;;SOF^863.2  OCX MDD SUBJECT
"RTN","ORY42703",164,0)
 ;;KEY^863.2:^PATIENT
"RTN","ORY42703",165,0)
 ;;R^"863.2:",.01,"E"
"RTN","ORY42703",166,0)
 ;;D^PATIENT
"RTN","ORY42703",167,0)
 ;;R^"863.2:","863.21:1",.01,"E"
"RTN","ORY42703",168,0)
 ;;D^FILE
"RTN","ORY42703",169,0)
 ;;R^"863.2:","863.21:1",1,"E"
"RTN","ORY42703",170,0)
 ;;D^2
"RTN","ORY42703",171,0)
 ;;EOR^
"RTN","ORY42703",172,0)
 ;;EOF^OCXS(863.2)^1
"RTN","ORY42703",173,0)
 ;;SOF^863.3  OCX MDD LINK
"RTN","ORY42703",174,0)
 ;;KEY^863.3:^PATIENT.CLOZAPINE MED
"RTN","ORY42703",175,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",176,0)
 ;;D^PATIENT.CLOZAPINE MED
"RTN","ORY42703",177,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",178,0)
 ;;D^PATIENT
"RTN","ORY42703",179,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",180,0)
 ;;D^CLOZAPINE MED
"RTN","ORY42703",181,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42703",182,0)
 ;;D^3555
"RTN","ORY42703",183,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",184,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42703",185,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42703",186,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY42703",187,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",188,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",189,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",190,0)
 ;;D^1
"RTN","ORY42703",191,0)
 ;;EOR^
"RTN","ORY42703",192,0)
 ;;KEY^863.3:^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY42703",193,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",194,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY42703",195,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",196,0)
 ;;D^PATIENT
"RTN","ORY42703",197,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",198,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42703",199,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",200,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42703",201,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42703",202,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY42703",203,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",204,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",205,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",206,0)
 ;;D^3
"RTN","ORY42703",207,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42703",208,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY42703",209,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42703",210,0)
 ;;D^1
"RTN","ORY42703",211,0)
 ;;EOR^
"RTN","ORY42703",212,0)
 ;;KEY^863.3:^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY42703",213,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",214,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY42703",215,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",216,0)
 ;;D^PATIENT
"RTN","ORY42703",217,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",218,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42703",219,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",220,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42703",221,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42703",222,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY42703",223,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",224,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",225,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",226,0)
 ;;D^3
"RTN","ORY42703",227,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42703",228,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY42703",229,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42703",230,0)
 ;;D^2
"RTN","ORY42703",231,0)
 ;;EOR^
"RTN","ORY42703",232,0)
 ;;KEY^863.3:^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY42703",233,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",234,0)
 ;;D^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY42703",235,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",236,0)
 ;;D^PATIENT
"RTN","ORY42703",237,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",238,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY42703",239,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",240,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42703",241,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42703",242,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,"",|DISP DRUG IEN|)
"RTN","ORY42703",243,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",244,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",245,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",246,0)
 ;;D^4
"RTN","ORY42703",247,0)
 ;;EOR^
"RTN","ORY42703",248,0)
 ;;KEY^863.3:^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY42703",249,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",250,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY42703",251,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",252,0)
 ;;D^PATIENT
"RTN","ORY42703",253,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",254,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42703",255,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42703",256,0)
 ;;D^999
"RTN","ORY42703",257,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",258,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY42703",259,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42703",260,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY42703",261,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",262,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",263,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",264,0)
 ;;D^2
"RTN","ORY42703",265,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42703",266,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY42703",267,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42703",268,0)
 ;;D^1
"RTN","ORY42703",269,0)
 ;;EOR^
"RTN","ORY42703",270,0)
 ;;KEY^863.3:^PATIENT.HL7_FILLER
"RTN","ORY42703",271,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",272,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY42703",273,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",274,0)
 ;;D^PATIENT
"RTN","ORY42703",275,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY42703",276,0)
 ;;D^HL7
"RTN","ORY42703",277,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",278,0)
 ;;D^HL7 FILLER
"RTN","ORY42703",279,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",280,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42703",281,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",282,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42703",283,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42703",284,0)
 ;;D^2
"RTN","ORY42703",285,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42703",286,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42703",287,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42703",288,0)
 ;;D^OCXODATA("ORC",3)
"RTN","ORY42703",289,0)
 ;;R^"863.3:","863.32:4",.01,"E"
"RTN","ORY42703",290,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY42703",291,0)
 ;;R^"863.3:","863.32:5",.01,"E"
"RTN","ORY42703",292,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY42703",293,0)
 ;;R^"863.3:","863.32:5",1,"E"
"RTN","ORY42703",294,0)
 ;;D^HL7
"RTN","ORY42703",295,0)
 ;;R^"863.3:","863.32:6",.01,"E"
"RTN","ORY42703",296,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY42703",297,0)
 ;;EOR^
"RTN","ORY42703",298,0)
 ;;KEY^863.3:^PATIENT.HL7_PATIENT_ID
"RTN","ORY42703",299,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",300,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY42703",301,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",302,0)
 ;;D^PATIENT
"RTN","ORY42703",303,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY42703",304,0)
 ;;D^HL7
"RTN","ORY42703",305,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",306,0)
 ;;D^IEN
"RTN","ORY42703",307,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42703",308,0)
 ;;D^99
"RTN","ORY42703",309,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42703",310,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY42703",311,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42703",312,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42703",313,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42703",314,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42703",315,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42703",316,0)
 ;;D^OCXODATA("PID",3)
"RTN","ORY42703",317,0)
 ;;EOR^
"RTN","ORY42703",318,0)
 ;;KEY^863.3:^PATIENT.IEN
"RTN","ORY42703",319,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42703",320,0)
 ;;D^PATIENT.IEN
"RTN","ORY42703",321,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42703",322,0)
 ;;D^PATIENT
"RTN","ORY42703",323,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42703",324,0)
 ;1;
"RTN","ORY42703",325,0)
 ;
"RTN","ORY42704")
0^9^B84076912
"RTN","ORY42704",1,0)
ORY42704 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42704",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42704",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42704",4,0)
 ;
"RTN","ORY42704",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42704",6,0)
S ;
"RTN","ORY42704",7,0)
 ;
"RTN","ORY42704",8,0)
 D DOT^ORY427ES
"RTN","ORY42704",9,0)
 ;
"RTN","ORY42704",10,0)
 ;
"RTN","ORY42704",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42704",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42704",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42704",14,0)
 ;
"RTN","ORY42704",15,0)
 G ^ORY42705
"RTN","ORY42704",16,0)
 ;
"RTN","ORY42704",17,0)
 Q
"RTN","ORY42704",18,0)
 ;
"RTN","ORY42704",19,0)
DATA ;
"RTN","ORY42704",20,0)
 ;
"RTN","ORY42704",21,0)
 ;;D^IEN
"RTN","ORY42704",22,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42704",23,0)
 ;;D^99
"RTN","ORY42704",24,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42704",25,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42704",26,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42704",27,0)
 ;;D^DFN
"RTN","ORY42704",28,0)
 ;;EOR^
"RTN","ORY42704",29,0)
 ;;KEY^863.3:^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY42704",30,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42704",31,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY42704",32,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42704",33,0)
 ;;D^PATIENT
"RTN","ORY42704",34,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42704",35,0)
 ;;D^ORDER PATIENT
"RTN","ORY42704",36,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42704",37,0)
 ;;D^5567
"RTN","ORY42704",38,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42704",39,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42704",40,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42704",41,0)
 ;;D^OCXORD
"RTN","ORY42704",42,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42704",43,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42704",44,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42704",45,0)
 ;;D^1
"RTN","ORY42704",46,0)
 ;;EOR^
"RTN","ORY42704",47,0)
 ;;KEY^863.3:^PATIENT.OPS_DRUG_ID
"RTN","ORY42704",48,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42704",49,0)
 ;;D^PATIENT.OPS_DRUG_ID
"RTN","ORY42704",50,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42704",51,0)
 ;;D^PATIENT
"RTN","ORY42704",52,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42704",53,0)
 ;;D^DISPENSE DRUG
"RTN","ORY42704",54,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42704",55,0)
 ;;D^33
"RTN","ORY42704",56,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42704",57,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42704",58,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42704",59,0)
 ;;D^OCXPSD
"RTN","ORY42704",60,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42704",61,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42704",62,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42704",63,0)
 ;;D^2
"RTN","ORY42704",64,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY42704",65,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY42704",66,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY42704",67,0)
 ;;D^4
"RTN","ORY42704",68,0)
 ;;EOR^
"RTN","ORY42704",69,0)
 ;;KEY^863.3:^PATIENT.OPS_FILLER
"RTN","ORY42704",70,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42704",71,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY42704",72,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42704",73,0)
 ;;D^PATIENT
"RTN","ORY42704",74,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY42704",75,0)
 ;;D^OPS
"RTN","ORY42704",76,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42704",77,0)
 ;;D^FILLER
"RTN","ORY42704",78,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42704",79,0)
 ;;D^99
"RTN","ORY42704",80,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42704",81,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42704",82,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42704",83,0)
 ;;D^OCXPSD
"RTN","ORY42704",84,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY42704",85,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY42704",86,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY42704",87,0)
 ;;D^1
"RTN","ORY42704",88,0)
 ;;EOR^
"RTN","ORY42704",89,0)
 ;;KEY^863.3:^PATIENT.OPS_ORD_MODE
"RTN","ORY42704",90,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY42704",91,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY42704",92,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY42704",93,0)
 ;;D^PATIENT
"RTN","ORY42704",94,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY42704",95,0)
 ;;D^OPS
"RTN","ORY42704",96,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY42704",97,0)
 ;;D^ORDER MODE
"RTN","ORY42704",98,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY42704",99,0)
 ;;D^99
"RTN","ORY42704",100,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY42704",101,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY42704",102,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY42704",103,0)
 ;;D^OCXPSM
"RTN","ORY42704",104,0)
 ;;EOR^
"RTN","ORY42704",105,0)
 ;;EOF^OCXS(863.3)^1
"RTN","ORY42704",106,0)
 ;;SOF^860.9  ORDER CHECK NATIONAL TERM
"RTN","ORY42704",107,0)
 ;;KEY^860.9:^ANGIOGRAM (PERIPHERAL)
"RTN","ORY42704",108,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",109,0)
 ;;D^ANGIOGRAM (PERIPHERAL)
"RTN","ORY42704",110,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",111,0)
 ;;D^101.43
"RTN","ORY42704",112,0)
 ;;EOR^
"RTN","ORY42704",113,0)
 ;;KEY^860.9:^BLOOD SPECIMEN
"RTN","ORY42704",114,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",115,0)
 ;;D^BLOOD SPECIMEN
"RTN","ORY42704",116,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",117,0)
 ;;D^61
"RTN","ORY42704",118,0)
 ;;EOR^
"RTN","ORY42704",119,0)
 ;;KEY^860.9:^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY42704",120,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",121,0)
 ;;D^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY42704",122,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",123,0)
 ;;D^101.43
"RTN","ORY42704",124,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY42704",125,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY42704",126,0)
 ;;EOR^
"RTN","ORY42704",127,0)
 ;;KEY^860.9:^DNR
"RTN","ORY42704",128,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",129,0)
 ;;D^DNR
"RTN","ORY42704",130,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",131,0)
 ;;D^101.43
"RTN","ORY42704",132,0)
 ;;EOR^
"RTN","ORY42704",133,0)
 ;;KEY^860.9:^EGFR
"RTN","ORY42704",134,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",135,0)
 ;;D^EGFR
"RTN","ORY42704",136,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",137,0)
 ;;D^60
"RTN","ORY42704",138,0)
 ;;EOR^
"RTN","ORY42704",139,0)
 ;;KEY^860.9:^FOOD-DRUG INTERACTION MED
"RTN","ORY42704",140,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",141,0)
 ;;D^FOOD-DRUG INTERACTION MED
"RTN","ORY42704",142,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",143,0)
 ;;D^101.43
"RTN","ORY42704",144,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY42704",145,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY42704",146,0)
 ;;EOR^
"RTN","ORY42704",147,0)
 ;;KEY^860.9:^NPO
"RTN","ORY42704",148,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",149,0)
 ;;D^NPO
"RTN","ORY42704",150,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",151,0)
 ;;D^101.43
"RTN","ORY42704",152,0)
 ;;EOR^
"RTN","ORY42704",153,0)
 ;;KEY^860.9:^ONE TIME MED
"RTN","ORY42704",154,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",155,0)
 ;;D^ONE TIME MED
"RTN","ORY42704",156,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",157,0)
 ;;D^51.1
"RTN","ORY42704",158,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY42704",159,0)
 ;;D^I $E($P(^(0),U,4),1,2)="PS"
"RTN","ORY42704",160,0)
 ;;EOR^
"RTN","ORY42704",161,0)
 ;;KEY^860.9:^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY42704",162,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",163,0)
 ;;D^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY42704",164,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",165,0)
 ;;D^101.43
"RTN","ORY42704",166,0)
 ;;EOR^
"RTN","ORY42704",167,0)
 ;;KEY^860.9:^PROTHROMBIN TIME
"RTN","ORY42704",168,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",169,0)
 ;;D^PROTHROMBIN TIME
"RTN","ORY42704",170,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",171,0)
 ;;D^101.43
"RTN","ORY42704",172,0)
 ;;EOR^
"RTN","ORY42704",173,0)
 ;;KEY^860.9:^SERUM CREATININE
"RTN","ORY42704",174,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",175,0)
 ;;D^SERUM CREATININE
"RTN","ORY42704",176,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",177,0)
 ;;D^60
"RTN","ORY42704",178,0)
 ;;EOR^
"RTN","ORY42704",179,0)
 ;;KEY^860.9:^SERUM SPECIMEN
"RTN","ORY42704",180,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",181,0)
 ;;D^SERUM SPECIMEN
"RTN","ORY42704",182,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",183,0)
 ;;D^61
"RTN","ORY42704",184,0)
 ;;EOR^
"RTN","ORY42704",185,0)
 ;;KEY^860.9:^SERUM UREA NITROGEN
"RTN","ORY42704",186,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",187,0)
 ;;D^SERUM UREA NITROGEN
"RTN","ORY42704",188,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",189,0)
 ;;D^60
"RTN","ORY42704",190,0)
 ;;EOR^
"RTN","ORY42704",191,0)
 ;;KEY^860.9:^THROMBOPLASTIN TIME PARTIAL
"RTN","ORY42704",192,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",193,0)
 ;;D^THROMBOPLASTIN TIME PARTIAL
"RTN","ORY42704",194,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",195,0)
 ;;D^60
"RTN","ORY42704",196,0)
 ;;EOR^
"RTN","ORY42704",197,0)
 ;;KEY^860.9:^WBC
"RTN","ORY42704",198,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY42704",199,0)
 ;;D^WBC
"RTN","ORY42704",200,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY42704",201,0)
 ;;D^60
"RTN","ORY42704",202,0)
 ;;EOR^
"RTN","ORY42704",203,0)
 ;;EOF^OCXS(860.9)^1
"RTN","ORY42704",204,0)
 ;;SOF^860.8  ORDER CHECK COMPILER FUNCTIONS
"RTN","ORY42704",205,0)
 ;;KEY^860.8:^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY42704",206,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42704",207,0)
 ;;D^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY42704",208,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42704",209,0)
 ;;D^DT2INT
"RTN","ORY42704",210,0)
 ;;R^"860.8:",1,1
"RTN","ORY42704",211,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY42704",212,0)
 ;;R^"860.8:",1,2
"RTN","ORY42704",213,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY42704",214,0)
 ;;R^"860.8:",1,3
"RTN","ORY42704",215,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY42704",216,0)
 ;;R^"860.8:",100,1
"RTN","ORY42704",217,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY42704",218,0)
 ;;R^"860.8:",100,2
"RTN","ORY42704",219,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY42704",220,0)
 ;;R^"860.8:",100,3
"RTN","ORY42704",221,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY42704",222,0)
 ;;R^"860.8:",100,4
"RTN","ORY42704",223,0)
 ;;D^  ; ;
"RTN","ORY42704",224,0)
 ;;R^"860.8:",100,5
"RTN","ORY42704",225,0)
 ;;D^  ; Q:'$L($G(OCXDT)) ""
"RTN","ORY42704",226,0)
 ;;R^"860.8:",100,6
"RTN","ORY42704",227,0)
 ;;D^  ; N OCXDIFF,OCXVAL S (OCXDIFF,OCXVAL)=0
"RTN","ORY42704",228,0)
 ;;R^"860.8:",100,7
"RTN","ORY42704",229,0)
 ;;D^  ; ;
"RTN","ORY42704",230,0)
 ;;R^"860.8:",100,8
"RTN","ORY42704",231,0)
 ;;D^  ; I $L(OCXDT),'OCXDT,(OCXDT[" at ") D  ; EXTERNAL EXPERT SYSTEM FORMAT 1 TO EXTERNAL FORMAT
"RTN","ORY42704",232,0)
 ;;R^"860.8:",100,9
"RTN","ORY42704",233,0)
 ;;D^  ; .N OCXHR,OCXMIN,OCXTIME
"RTN","ORY42704",234,0)
 ;;R^"860.8:",100,10
"RTN","ORY42704",235,0)
 ;;D^  ; .S OCXTIME=$P($P(OCXDT," at ",2),".",1),OCXHR=$P(OCXTIME,":",1),OCXMIN=$P(OCXTIME,":",2)
"RTN","ORY42704",236,0)
 ;;R^"860.8:",100,11
"RTN","ORY42704",237,0)
 ;;D^  ; .S:(OCXDT["Midnight") OCXHR=00
"RTN","ORY42704",238,0)
 ;;R^"860.8:",100,12
"RTN","ORY42704",239,0)
 ;;D^  ; .S:(OCXDT["PM") OCXHR=OCXHR+12
"RTN","ORY42704",240,0)
 ;;R^"860.8:",100,13
"RTN","ORY42704",241,0)
 ;;D^  ; .S OCXDT=$P(OCXDT," at ")_"@"_$E(OCXHR+100,2,3)_$E(OCXMIN+100,2,3)
"RTN","ORY42704",242,0)
 ;;R^"860.8:",100,14
"RTN","ORY42704",243,0)
 ;;D^  ; ;
"RTN","ORY42704",244,0)
 ;;R^"860.8:",100,15
"RTN","ORY42704",245,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 2 TO EXTERNAL FORMAT
"RTN","ORY42704",246,0)
 ;;R^"860.8:",100,16
"RTN","ORY42704",247,0)
 ;;D^  ; .N OCXMON
"RTN","ORY42704",248,0)
 ;;R^"860.8:",100,17
"RTN","ORY42704",249,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY42704",250,0)
 ;;R^"860.8:",100,18
"RTN","ORY42704",251,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY42704",252,0)
 ;;R^"860.8:",100,19
"RTN","ORY42704",253,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)
"RTN","ORY42704",254,0)
 ;;R^"860.8:",100,20
"RTN","ORY42704",255,0)
 ;;D^  ; ;
"RTN","ORY42704",256,0)
 ;;R^"860.8:",100,21
"RTN","ORY42704",257,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 3 TO EXTERNAL FORMAT
"RTN","ORY42704",258,0)
 ;;R^"860.8:",100,22
"RTN","ORY42704",259,0)
 ;;D^  ; .N OCXMON
"RTN","ORY42704",260,0)
 ;;R^"860.8:",100,23
"RTN","ORY42704",261,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY42704",262,0)
 ;;R^"860.8:",100,24
"RTN","ORY42704",263,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_","_$P($P(OCXDT," ",1),"/",3)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY42704",264,0)
 ;;R^"860.8:",100,25
"RTN","ORY42704",265,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_", "_$P($P(OCXDT," ",1),"/",3)
"RTN","ORY42704",266,0)
 ;;R^"860.8:",100,26
"RTN","ORY42704",267,0)
 ;;D^  ; ;
"RTN","ORY42704",268,0)
 ;;R^"860.8:",100,27
"RTN","ORY42704",269,0)
 ;;D^  ; I $L(OCXDT),'OCXDT D  ; EXTERNAL FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY42704",270,0)
 ;;R^"860.8:",100,28
"RTN","ORY42704",271,0)
 ;;D^  ; .I (OCXDT["@0000") S OCXDT=$P(OCXDT,"@",1),OCXDIFF=1
"RTN","ORY42704",272,0)
 ;;R^"860.8:",100,29
"RTN","ORY42704",273,0)
 ;;D^  ; .N %DT,X,Y S X=OCXDT,%DT="" S:(OCXDT["@")!(OCXDT="N") %DT="T" D ^%DT S OCXDT=+Y
"RTN","ORY42704",274,0)
 ;;R^"860.8:",100,30
"RTN","ORY42704",275,0)
 ;;D^  ; ;
"RTN","ORY42704",276,0)
 ;;R^"860.8:",100,31
"RTN","ORY42704",277,0)
 ;;D^  ; I ($L(OCXDT\1)>7) S OCXDT=$$HL7TFM^XLFDT(OCXDT)  ; HL7 FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY42704",278,0)
 ;;R^"860.8:",100,32
"RTN","ORY42704",279,0)
 ;1;
"RTN","ORY42704",280,0)
 ;
"RTN","ORY42705")
0^10^B62931901
"RTN","ORY42705",1,0)
ORY42705 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42705",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42705",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42705",4,0)
 ;
"RTN","ORY42705",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42705",6,0)
S ;
"RTN","ORY42705",7,0)
 ;
"RTN","ORY42705",8,0)
 D DOT^ORY427ES
"RTN","ORY42705",9,0)
 ;
"RTN","ORY42705",10,0)
 ;
"RTN","ORY42705",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42705",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42705",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42705",14,0)
 ;
"RTN","ORY42705",15,0)
 G ^ORY42706
"RTN","ORY42705",16,0)
 ;
"RTN","ORY42705",17,0)
 Q
"RTN","ORY42705",18,0)
 ;
"RTN","ORY42705",19,0)
DATA ;
"RTN","ORY42705",20,0)
 ;
"RTN","ORY42705",21,0)
 ;;D^  ; ;
"RTN","ORY42705",22,0)
 ;;R^"860.8:",100,33
"RTN","ORY42705",23,0)
 ;;D^  ; I ($L(OCXDT\1)=7) S OCXDT=$$FMTH^XLFDT(+OCXDT)   ; INTERNAL FILEMAN FORMAT TO $H FORMAT
"RTN","ORY42705",24,0)
 ;;R^"860.8:",100,34
"RTN","ORY42705",25,0)
 ;;D^  ; ;
"RTN","ORY42705",26,0)
 ;;R^"860.8:",100,35
"RTN","ORY42705",27,0)
 ;;D^  ; I (OCXDT?5N1","1.5N) S OCXVAL=(OCXDT*86400)+$P(OCXDT,",",2)     ;  $H FORMAT TO EXPERT SYSTEM INTERNAL FORMAT
"RTN","ORY42705",28,0)
 ;;R^"860.8:",100,36
"RTN","ORY42705",29,0)
 ;;D^  ; ;
"RTN","ORY42705",30,0)
 ;;R^"860.8:",100,37
"RTN","ORY42705",31,0)
 ;;D^  ; Q OCXVAL
"RTN","ORY42705",32,0)
 ;;R^"860.8:",100,38
"RTN","ORY42705",33,0)
 ;;D^  ; ;
"RTN","ORY42705",34,0)
 ;;EOR^
"RTN","ORY42705",35,0)
 ;;KEY^860.8:^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY42705",36,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",37,0)
 ;;D^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY42705",38,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",39,0)
 ;;D^INT2DT
"RTN","ORY42705",40,0)
 ;;R^"860.8:",1,1
"RTN","ORY42705",41,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY42705",42,0)
 ;;R^"860.8:",1,2
"RTN","ORY42705",43,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY42705",44,0)
 ;;R^"860.8:",1,3
"RTN","ORY42705",45,0)
 ;;D^  ; ;
"RTN","ORY42705",46,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",47,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY42705",48,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",49,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY42705",50,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",51,0)
 ;;D^  ; ;
"RTN","ORY42705",52,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",53,0)
 ;;D^  ; Q:'$L($G(OCXDT)) "" S OCXF=+$G(OCXF)
"RTN","ORY42705",54,0)
 ;;R^"860.8:",100,5
"RTN","ORY42705",55,0)
 ;;D^  ; N OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXCYR
"RTN","ORY42705",56,0)
 ;;R^"860.8:",100,6
"RTN","ORY42705",57,0)
 ;;D^  ; S (OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXAP)=""
"RTN","ORY42705",58,0)
 ;;R^"860.8:",100,7
"RTN","ORY42705",59,0)
 ;;D^  ; S OCXSEC=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY42705",60,0)
 ;;R^"860.8:",100,8
"RTN","ORY42705",61,0)
 ;;D^  ; S OCXMIN=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY42705",62,0)
 ;;R^"860.8:",100,9
"RTN","ORY42705",63,0)
 ;;D^  ; S OCXHR=$E(OCXDT#24+100,2,3),OCXDT=OCXDT\24
"RTN","ORY42705",64,0)
 ;;R^"860.8:",100,10
"RTN","ORY42705",65,0)
 ;;D^  ; S OCXCYR=($H\1461)*4+1841+(($H#1461)\365)
"RTN","ORY42705",66,0)
 ;;R^"860.8:",100,11
"RTN","ORY42705",67,0)
 ;;D^  ; S OCXYR=(OCXDT\1461)*4+1841,OCXDT=OCXDT#1461
"RTN","ORY42705",68,0)
 ;;R^"860.8:",100,12
"RTN","ORY42705",69,0)
 ;;D^  ; S OCXLPYR=(OCXDT\365),OCXDT=OCXDT-(OCXLPYR*365),OCXYR=OCXYR+OCXLPYR
"RTN","ORY42705",70,0)
 ;;R^"860.8:",100,13
"RTN","ORY42705",71,0)
 ;;D^  ; S OCXCNT="031^059^090^120^151^181^212^243^273^304^334^365"
"RTN","ORY42705",72,0)
 ;;R^"860.8:",100,14
"RTN","ORY42705",73,0)
 ;;D^  ; S:(OCXLPYR=3) OCXCNT="031^060^091^121^152^182^213^244^274^305^335^366"
"RTN","ORY42705",74,0)
 ;;R^"860.8:",100,15
"RTN","ORY42705",75,0)
 ;;D^  ; F OCXMON=1:1:12 Q:(OCXDT<$P(OCXCNT,U,OCXMON))
"RTN","ORY42705",76,0)
 ;;R^"860.8:",100,16
"RTN","ORY42705",77,0)
 ;;D^  ; S OCXDAY=OCXDT-$P(OCXCNT,U,OCXMON-1)+1
"RTN","ORY42705",78,0)
 ;;R^"860.8:",100,17
"RTN","ORY42705",79,0)
 ;;D^  ; I OCXF S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,OCXMON)
"RTN","ORY42705",80,0)
 ;;R^"860.8:",100,18
"RTN","ORY42705",81,0)
 ;;D^  ; E  S OCXMON=$E(OCXMON+100,2,3)
"RTN","ORY42705",82,0)
 ;;R^"860.8:",100,19
"RTN","ORY42705",83,0)
 ;;D^  ; S OCXAP=$S('OCXHR:"Midnight",(OCXHR=12):"Noon",(OCXHR<12):"AM",1:"PM")
"RTN","ORY42705",84,0)
 ;;R^"860.8:",100,20
"RTN","ORY42705",85,0)
 ;;D^  ; I OCXF S OCXHR=OCXHR#12 S:'OCXHR OCXHR=12
"RTN","ORY42705",86,0)
 ;;R^"860.8:",100,21
"RTN","ORY42705",87,0)
 ;;D^  ; Q:'OCXF $E(OCXMON+100,2,3)_"/"_$E(OCXDAY+100,2,3)_$S((OCXCYR=OCXYR):" "_OCXHR_":"_OCXMIN,1:"/"_$E(OCXYR,3,4))
"RTN","ORY42705",88,0)
 ;;R^"860.8:",100,22
"RTN","ORY42705",89,0)
 ;;D^  ; Q:(OCXHR+OCXMIN+OCXSEC) OCXMON_" "_OCXDAY_","_OCXYR_" at "_OCXHR_":"_OCXMIN_"."_OCXSEC_" "_OCXAP
"RTN","ORY42705",90,0)
 ;;R^"860.8:",100,23
"RTN","ORY42705",91,0)
 ;;D^  ; Q OCXMON_" "_OCXDAY_","_OCXYR
"RTN","ORY42705",92,0)
 ;;R^"860.8:",100,24
"RTN","ORY42705",93,0)
 ;;D^  ; ;
"RTN","ORY42705",94,0)
 ;;EOR^
"RTN","ORY42705",95,0)
 ;;KEY^860.8:^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY42705",96,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",97,0)
 ;;D^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY42705",98,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",99,0)
 ;;D^TIMELOG
"RTN","ORY42705",100,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",101,0)
 ;;D^  ;TIMELOG(OCXMODE,OCXCALL) ; Log an entry in the Elapsed time log.
"RTN","ORY42705",102,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",103,0)
 ;;D^  ; ;
"RTN","ORY42705",104,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",105,0)
 ;;D^  ; ;
"RTN","ORY42705",106,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",107,0)
 ;;D^  ; Q 0
"RTN","ORY42705",108,0)
 ;;R^"860.8:",100,5
"RTN","ORY42705",109,0)
 ;;D^  ; ;
"RTN","ORY42705",110,0)
 ;;EOR^
"RTN","ORY42705",111,0)
 ;;KEY^860.8:^EQUALS TERM OPERATOR
"RTN","ORY42705",112,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",113,0)
 ;;D^EQUALS TERM OPERATOR
"RTN","ORY42705",114,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",115,0)
 ;;D^EQTERM
"RTN","ORY42705",116,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",117,0)
 ;;D^  ;EQTERM(DATA,TERM) ;
"RTN","ORY42705",118,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",119,0)
 ;;D^  ; ;
"RTN","ORY42705",120,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",121,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DATA: ",$G(DATA),"   TERM: ",$G(TERM)
"RTN","ORY42705",122,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",123,0)
 ;;D^  ; N OCXF,OCXL
"RTN","ORY42705",124,0)
 ;;R^"860.8:",100,5
"RTN","ORY42705",125,0)
 ;;D^  ; ;
"RTN","ORY42705",126,0)
 ;;R^"860.8:",100,6
"RTN","ORY42705",127,0)
 ;;D^  ; S OCXL="",OCXF=$$TERMLKUP(TERM,.OCXL)
"RTN","ORY42705",128,0)
 ;;R^"860.8:",100,7
"RTN","ORY42705",129,0)
 ;;D^T-; Q:'OCXF 0
"RTN","ORY42705",130,0)
 ;;R^"860.8:",100,8
"RTN","ORY42705",131,0)
 ;;D^T+; I 'OCXF W:$G(OCXTRACE) !,"%%%%",?20," Term '",TERM,"' not in Order Check National Term File" Q 0
"RTN","ORY42705",132,0)
 ;;R^"860.8:",100,9
"RTN","ORY42705",133,0)
 ;;D^T+; I '$O(OCXL(0)) W:$G(OCXTRACE) !,"%%%%",?20," There are no local terms listed for the National Term '",TERM,"'." Q 0
"RTN","ORY42705",134,0)
 ;;R^"860.8:",100,10
"RTN","ORY42705",135,0)
 ;;D^T+; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) W:$G(OCXTRACE) !,"%%%%",?20," Data equals Term" Q 1
"RTN","ORY42705",136,0)
 ;;R^"860.8:",100,11
"RTN","ORY42705",137,0)
 ;;D^T-; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) Q 1
"RTN","ORY42705",138,0)
 ;;R^"860.8:",100,12
"RTN","ORY42705",139,0)
 ;;D^T-; Q 0
"RTN","ORY42705",140,0)
 ;;R^"860.8:",100,13
"RTN","ORY42705",141,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20," Data does not equal Term" Q 0
"RTN","ORY42705",142,0)
 ;;R^"860.8:",100,14
"RTN","ORY42705",143,0)
 ;;D^  ; ;
"RTN","ORY42705",144,0)
 ;;EOR^
"RTN","ORY42705",145,0)
 ;;KEY^860.8:^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY42705",146,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",147,0)
 ;;D^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY42705",148,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",149,0)
 ;;D^FILE
"RTN","ORY42705",150,0)
 ;;R^"860.8:",1,1
"RTN","ORY42705",151,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function files data
"RTN","ORY42705",152,0)
 ;;R^"860.8:",1,2
"RTN","ORY42705",153,0)
 ;;D^  ; ;     in the Order Check Patient Data File
"RTN","ORY42705",154,0)
 ;;R^"860.8:",1,3
"RTN","ORY42705",155,0)
 ;;D^  ; ;
"RTN","ORY42705",156,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",157,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function logs a validated event/element.
"RTN","ORY42705",158,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",159,0)
 ;;D^  ; ;
"RTN","ORY42705",160,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",161,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DFN: ",DFN,"   OCXELE: ",+$G(OCXELE),"   OCXDFL: ",$G(OCXDFL)
"RTN","ORY42705",162,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",163,0)
 ;;D^  ; N OCXTIMN,OCXTIML,OCXTIMT1,OCXTIMT2,OCXDATA,OCXPC,OCXPC,OCXVAL,OCXSUB,OCXDFI
"RTN","ORY42705",164,0)
 ;;R^"860.8:",100,5
"RTN","ORY42705",165,0)
 ;;D^  ; S DFN=+$G(DFN),OCXELE=+$G(OCXELE)
"RTN","ORY42705",166,0)
 ;;R^"860.8:",100,6
"RTN","ORY42705",167,0)
 ;;D^  ; ;
"RTN","ORY42705",168,0)
 ;;R^"860.8:",100,7
"RTN","ORY42705",169,0)
 ;;D^  ; Q:'DFN 1 Q:'OCXELE 1 K OCXDATA
"RTN","ORY42705",170,0)
 ;;R^"860.8:",100,8
"RTN","ORY42705",171,0)
 ;;D^  ; ;
"RTN","ORY42705",172,0)
 ;;R^"860.8:",100,9
"RTN","ORY42705",173,0)
 ;;D^  ; S OCXDATA(DFN,OCXELE)=1
"RTN","ORY42705",174,0)
 ;;R^"860.8:",100,10
"RTN","ORY42705",175,0)
 ;;D^  ; F OCXPC=1:1:$L(OCXDFL,",") S OCXDFI=$P(OCXDFL,",",OCXPC) I OCXDFI D
"RTN","ORY42705",176,0)
 ;;R^"860.8:",100,11
"RTN","ORY42705",177,0)
 ;;D^  ; .S OCXVAL=$G(OCXDF(+OCXDFI)),OCXDATA(DFN,OCXELE,+OCXDFI)=OCXVAL
"RTN","ORY42705",178,0)
 ;;R^"860.8:",100,12
"RTN","ORY42705",179,0)
 ;;D^T+; .I $G(OCXTRACE) W !,"%%%%",?20,"   ",$P($G(^OCXS(860.4,+OCXDFI,0)),U,1)," = """,OCXVAL,""""
"RTN","ORY42705",180,0)
 ;;R^"860.8:",100,13
"RTN","ORY42705",181,0)
 ;;D^  ; ;
"RTN","ORY42705",182,0)
 ;;R^"860.8:",100,14
"RTN","ORY42705",183,0)
 ;;D^  ; M ^TMP("OCXCHK",$J,DFN)=OCXDATA(DFN)
"RTN","ORY42705",184,0)
 ;;R^"860.8:",100,15
"RTN","ORY42705",185,0)
 ;;D^  ; ;
"RTN","ORY42705",186,0)
 ;;R^"860.8:",100,16
"RTN","ORY42705",187,0)
 ;;D^  ; Q 0
"RTN","ORY42705",188,0)
 ;;R^"860.8:",100,17
"RTN","ORY42705",189,0)
 ;;D^  ; ;
"RTN","ORY42705",190,0)
 ;;EOR^
"RTN","ORY42705",191,0)
 ;;KEY^860.8:^GENERATE STRING CHECKSUM
"RTN","ORY42705",192,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",193,0)
 ;;D^GENERATE STRING CHECKSUM
"RTN","ORY42705",194,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",195,0)
 ;;D^CKSUM
"RTN","ORY42705",196,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",197,0)
 ;;D^  ;CKSUM(STR) ;
"RTN","ORY42705",198,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",199,0)
 ;;D^  ; ;
"RTN","ORY42705",200,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",201,0)
 ;;D^  ; N CKSUM,PTR,ASC S CKSUM=0
"RTN","ORY42705",202,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",203,0)
 ;;D^  ; S STR=$TR(STR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORY42705",204,0)
 ;;R^"860.8:",100,5
"RTN","ORY42705",205,0)
 ;;D^  ; F PTR=$L(STR):-1:1 S ASC=$A(STR,PTR)-42 I (ASC>0),(ASC<51) S CKSUM=CKSUM*2+ASC
"RTN","ORY42705",206,0)
 ;;R^"860.8:",100,6
"RTN","ORY42705",207,0)
 ;;D^  ; Q +CKSUM
"RTN","ORY42705",208,0)
 ;;R^"860.8:",100,7
"RTN","ORY42705",209,0)
 ;;D^  ; ;
"RTN","ORY42705",210,0)
 ;;EOR^
"RTN","ORY42705",211,0)
 ;;KEY^860.8:^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY42705",212,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42705",213,0)
 ;;D^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY42705",214,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42705",215,0)
 ;;D^GETDATA
"RTN","ORY42705",216,0)
 ;;R^"860.8:",100,1
"RTN","ORY42705",217,0)
 ;;D^  ;GETDATA(DFN,OCXL,OCXDFI) ;     This Local Extrinsic Function returns runtime data
"RTN","ORY42705",218,0)
 ;;R^"860.8:",100,2
"RTN","ORY42705",219,0)
 ;;D^  ; ;
"RTN","ORY42705",220,0)
 ;;R^"860.8:",100,3
"RTN","ORY42705",221,0)
 ;;D^  ; N OCXE,VAL,PC S VAL=""
"RTN","ORY42705",222,0)
 ;;R^"860.8:",100,4
"RTN","ORY42705",223,0)
 ;;D^  ; F PC=1:1:$L(OCXL,U) S OCXE=$P(OCXL,U,PC) I OCXE S VAL=$G(^TMP("OCXCHK",$J,DFN,OCXE,OCXDFI)) Q:$L(VAL)
"RTN","ORY42705",224,0)
 ;1;
"RTN","ORY42705",225,0)
 ;
"RTN","ORY42706")
0^11^B67973600
"RTN","ORY42706",1,0)
ORY42706 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42706",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42706",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42706",4,0)
 ;
"RTN","ORY42706",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42706",6,0)
S ;
"RTN","ORY42706",7,0)
 ;
"RTN","ORY42706",8,0)
 D DOT^ORY427ES
"RTN","ORY42706",9,0)
 ;
"RTN","ORY42706",10,0)
 ;
"RTN","ORY42706",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42706",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42706",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42706",14,0)
 ;
"RTN","ORY42706",15,0)
 G ^ORY42707
"RTN","ORY42706",16,0)
 ;
"RTN","ORY42706",17,0)
 Q
"RTN","ORY42706",18,0)
 ;
"RTN","ORY42706",19,0)
DATA ;
"RTN","ORY42706",20,0)
 ;
"RTN","ORY42706",21,0)
 ;;R^"860.8:",100,5
"RTN","ORY42706",22,0)
 ;;D^  ; Q VAL
"RTN","ORY42706",23,0)
 ;;R^"860.8:",100,6
"RTN","ORY42706",24,0)
 ;;D^  ; ;
"RTN","ORY42706",25,0)
 ;;EOR^
"RTN","ORY42706",26,0)
 ;;KEY^860.8:^IN LIST OPERATOR
"RTN","ORY42706",27,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42706",28,0)
 ;;D^IN LIST OPERATOR
"RTN","ORY42706",29,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42706",30,0)
 ;;D^LIST
"RTN","ORY42706",31,0)
 ;;R^"860.8:",100,1
"RTN","ORY42706",32,0)
 ;;D^  ;LIST(DATA,LIST) ;   IS THE DATA FIELD IN THE LIST
"RTN","ORY42706",33,0)
 ;;R^"860.8:",100,2
"RTN","ORY42706",34,0)
 ;;D^  ; ;
"RTN","ORY42706",35,0)
 ;;R^"860.8:",100,3
"RTN","ORY42706",36,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20,"     $$LIST(""",DATA,""",""",LIST,""")"
"RTN","ORY42706",37,0)
 ;;R^"860.8:",100,4
"RTN","ORY42706",38,0)
 ;;D^  ; S:'($E(LIST,1)=",") LIST=","_LIST S:'($E(LIST,$L(LIST))=",") LIST=LIST_"," S DATA=","_DATA_","
"RTN","ORY42706",39,0)
 ;;R^"860.8:",100,5
"RTN","ORY42706",40,0)
 ;;D^  ; Q (LIST[DATA)
"RTN","ORY42706",41,0)
 ;;R^"860.8:",100,6
"RTN","ORY42706",42,0)
 ;;D^  ; ;
"RTN","ORY42706",43,0)
 ;;EOR^
"RTN","ORY42706",44,0)
 ;;KEY^860.8:^LOCAL TERM LOOKUP
"RTN","ORY42706",45,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42706",46,0)
 ;;D^LOCAL TERM LOOKUP
"RTN","ORY42706",47,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42706",48,0)
 ;;D^TERMLKUP
"RTN","ORY42706",49,0)
 ;;R^"860.8:",1,2
"RTN","ORY42706",50,0)
 ;;D^  This function allows a local site to define to Order Checking
"RTN","ORY42706",51,0)
 ;;R^"860.8:",1,3
"RTN","ORY42706",52,0)
 ;;D^ a term specific to that site. (ie. Lab Test Name, Radiology
"RTN","ORY42706",53,0)
 ;;R^"860.8:",1,4
"RTN","ORY42706",54,0)
 ;;D^ procedure name, etc.)
"RTN","ORY42706",55,0)
 ;;R^"860.8:",100,1
"RTN","ORY42706",56,0)
 ;;D^  ;TERMLKUP(OCXTERM,OCXFILE) ;
"RTN","ORY42706",57,0)
 ;;R^"860.8:",100,2
"RTN","ORY42706",58,0)
 ;;D^  ; ;
"RTN","ORY42706",59,0)
 ;;R^"860.8:",100,3
"RTN","ORY42706",60,0)
 ;;D^  ; Q
"RTN","ORY42706",61,0)
 ;;R^"860.8:",100,4
"RTN","ORY42706",62,0)
 ;;D^  ; ;
"RTN","ORY42706",63,0)
 ;;EOR^
"RTN","ORY42706",64,0)
 ;;KEY^860.8:^NEW RULE MESSAGE
"RTN","ORY42706",65,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42706",66,0)
 ;;D^NEW RULE MESSAGE
"RTN","ORY42706",67,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42706",68,0)
 ;;D^NEWRULE
"RTN","ORY42706",69,0)
 ;;R^"860.8:",100,1
"RTN","ORY42706",70,0)
 ;;D^  ;NEWRULE(OCXDFN,OCXORD,OCXRUL,OCXREL,OCXNOTF,OCXMESS) ; Has this rule already been triggered for this order number
"RTN","ORY42706",71,0)
 ;;R^"860.8:",100,2
"RTN","ORY42706",72,0)
 ;;D^  ; ;
"RTN","ORY42706",73,0)
 ;;R^"860.8:",100,3
"RTN","ORY42706",74,0)
 ;;D^L+; S OCXERR=$$TIMELOG("M","NEWRULE("_(+$G(OCXDFN))_","_(+$G(OCXORD))_","_(+$G(OCXRUL))_","_(+$G(OCXREL))_","_(+$G(OCXNOTF))_","_$G(OCXMESS)_")")
"RTN","ORY42706",75,0)
 ;;R^"860.8:",100,4
"RTN","ORY42706",76,0)
 ;;D^  ; ;
"RTN","ORY42706",77,0)
 ;;R^"860.8:",100,5
"RTN","ORY42706",78,0)
 ;;D^  ; Q:'$G(OCXDFN) 0 Q:'$G(OCXRUL) 0
"RTN","ORY42706",79,0)
 ;;R^"860.8:",100,6
"RTN","ORY42706",80,0)
 ;;D^  ; Q:'$G(OCXREL) 0  Q:'$G(OCXNOTF) 0  Q:'$L($G(OCXMESS)) 0
"RTN","ORY42706",81,0)
 ;;R^"860.8:",100,7
"RTN","ORY42706",82,0)
 ;;D^  ; S OCXORD=+$G(OCXORD),OCXDFN=+OCXDFN
"RTN","ORY42706",83,0)
 ;;R^"860.8:",100,8
"RTN","ORY42706",84,0)
 ;;D^  ; ;
"RTN","ORY42706",85,0)
 ;;R^"860.8:",100,9
"RTN","ORY42706",86,0)
 ;;D^  ; N OCXNDX,OCXDATA,OCXDFI,OCXELE,OCXGR,OCXTIME,OCXCKSUM,OCXTSP,OCXTSPL
"RTN","ORY42706",87,0)
 ;;R^"860.8:",100,10
"RTN","ORY42706",88,0)
 ;;D^  ; ;
"RTN","ORY42706",89,0)
 ;;R^"860.8:",100,11
"RTN","ORY42706",90,0)
 ;;D^  ; S OCXTIME=(+$H)
"RTN","ORY42706",91,0)
 ;;R^"860.8:",100,12
"RTN","ORY42706",92,0)
 ;;D^  ; S OCXCKSUM=$$CKSUM(OCXMESS)
"RTN","ORY42706",93,0)
 ;;R^"860.8:",100,13
"RTN","ORY42706",94,0)
 ;;D^  ; ;
"RTN","ORY42706",95,0)
 ;;R^"860.8:",100,14
"RTN","ORY42706",96,0)
 ;;D^  ; S OCXTSP=($H*86400)+$P($H,",",2)
"RTN","ORY42706",97,0)
 ;;R^"860.8:",100,15
"RTN","ORY42706",98,0)
 ;;D^  ; S OCXTSPL=($G(^OCXD(860.7,"AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM))+$G(OCXTSPI,300))
"RTN","ORY42706",99,0)
 ;;R^"860.8:",100,16
"RTN","ORY42706",100,0)
 ;;D^  ; ;
"RTN","ORY42706",101,0)
 ;;R^"860.8:",100,17
"RTN","ORY42706",102,0)
 ;;D^  ; Q:(OCXTSPL>OCXTSP) 0
"RTN","ORY42706",103,0)
 ;;R^"860.8:",100,18
"RTN","ORY42706",104,0)
 ;;D^  ; ;
"RTN","ORY42706",105,0)
 ;;R^"860.8:",100,19
"RTN","ORY42706",106,0)
 ;;D^  ; K OCXDATA
"RTN","ORY42706",107,0)
 ;;R^"860.8:",100,20
"RTN","ORY42706",108,0)
 ;;D^  ; S OCXDATA(OCXDFN,0)=OCXDFN
"RTN","ORY42706",109,0)
 ;;R^"860.8:",100,21
"RTN","ORY42706",110,0)
 ;;D^  ; S OCXDATA("B",OCXDFN,OCXDFN)=""
"RTN","ORY42706",111,0)
 ;;R^"860.8:",100,22
"RTN","ORY42706",112,0)
 ;;D^  ; S OCXDATA("AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM)=OCXTSP
"RTN","ORY42706",113,0)
 ;;R^"860.8:",100,23
"RTN","ORY42706",114,0)
 ;;D^  ; ;
"RTN","ORY42706",115,0)
 ;;R^"860.8:",100,24
"RTN","ORY42706",116,0)
 ;;D^  ; S OCXGR="^OCXD(860.7"
"RTN","ORY42706",117,0)
 ;;R^"860.8:",100,25
"RTN","ORY42706",118,0)
 ;;D^T+; D SETAP(OCXGR_")",0,"Patient",$P($G(^DPT(OCXDFN,0)),U,1),.OCXDATA,OCXDFN)
"RTN","ORY42706",119,0)
 ;;R^"860.8:",100,26
"RTN","ORY42706",120,0)
 ;;D^T-; D SETAP(OCXGR_")",0,.OCXDATA,OCXDFN)
"RTN","ORY42706",121,0)
 ;;R^"860.8:",100,27
"RTN","ORY42706",122,0)
 ;;D^  ; ;
"RTN","ORY42706",123,0)
 ;;R^"860.8:",100,28
"RTN","ORY42706",124,0)
 ;;D^  ; K OCXDATA
"RTN","ORY42706",125,0)
 ;;R^"860.8:",100,29
"RTN","ORY42706",126,0)
 ;;D^  ; S OCXDATA(OCXRUL,0)=OCXRUL_U_(OCXTIME)_U_(+OCXORD)
"RTN","ORY42706",127,0)
 ;;R^"860.8:",100,30
"RTN","ORY42706",128,0)
 ;;D^  ; S OCXDATA(OCXRUL,"M")=OCXMESS
"RTN","ORY42706",129,0)
 ;;R^"860.8:",100,31
"RTN","ORY42706",130,0)
 ;;D^  ; S OCXDATA("B",OCXRUL,OCXRUL)=""
"RTN","ORY42706",131,0)
 ;;R^"860.8:",100,32
"RTN","ORY42706",132,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXDFN_",1"
"RTN","ORY42706",133,0)
 ;;R^"860.8:",100,33
"RTN","ORY42706",134,0)
 ;;D^T+; D SETAP(OCXGR_")","860.71P","Rule",$P($G(^OCXS(860.2,OCXRUL,0)),U,1),.OCXDATA,OCXRUL)
"RTN","ORY42706",135,0)
 ;;R^"860.8:",100,34
"RTN","ORY42706",136,0)
 ;;D^T-; D SETAP(OCXGR_")","860.71P",.OCXDATA,OCXRUL)
"RTN","ORY42706",137,0)
 ;;R^"860.8:",100,35
"RTN","ORY42706",138,0)
 ;;D^  ; ;
"RTN","ORY42706",139,0)
 ;;R^"860.8:",100,36
"RTN","ORY42706",140,0)
 ;;D^  ; K OCXDATA
"RTN","ORY42706",141,0)
 ;;R^"860.8:",100,37
"RTN","ORY42706",142,0)
 ;;D^  ; S OCXDATA(OCXREL,0)=OCXREL
"RTN","ORY42706",143,0)
 ;;R^"860.8:",100,38
"RTN","ORY42706",144,0)
 ;;D^  ; S OCXDATA("B",OCXREL,OCXREL)=""
"RTN","ORY42706",145,0)
 ;;R^"860.8:",100,39
"RTN","ORY42706",146,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXRUL_",1"
"RTN","ORY42706",147,0)
 ;;R^"860.8:",100,40
"RTN","ORY42706",148,0)
 ;;D^T+; D SETAP(OCXGR_")","860.712","Relation",OCXREL,.OCXDATA,OCXREL)
"RTN","ORY42706",149,0)
 ;;R^"860.8:",100,41
"RTN","ORY42706",150,0)
 ;;D^T-; D SETAP(OCXGR_")","860.712",.OCXDATA,OCXREL)
"RTN","ORY42706",151,0)
 ;;R^"860.8:",100,42
"RTN","ORY42706",152,0)
 ;;D^  ; ;
"RTN","ORY42706",153,0)
 ;;R^"860.8:",100,43
"RTN","ORY42706",154,0)
 ;;D^  ; S OCXELE=0 F  S OCXELE=$O(^OCXS(860.2,OCXRUL,"C","C",OCXELE)) Q:'OCXELE  D
"RTN","ORY42706",155,0)
 ;;R^"860.8:",100,44
"RTN","ORY42706",156,0)
 ;;D^  ; .;
"RTN","ORY42706",157,0)
 ;;R^"860.8:",100,45
"RTN","ORY42706",158,0)
 ;;D^  ; .N OCXGR1
"RTN","ORY42706",159,0)
 ;;R^"860.8:",100,46
"RTN","ORY42706",160,0)
 ;;D^  ; .S OCXGR1=OCXGR_","_OCXREL_",1"
"RTN","ORY42706",161,0)
 ;;R^"860.8:",100,47
"RTN","ORY42706",162,0)
 ;;D^  ; .K OCXDATA
"RTN","ORY42706",163,0)
 ;;R^"860.8:",100,48
"RTN","ORY42706",164,0)
 ;;D^  ; .S OCXDATA(OCXELE,0)=OCXELE
"RTN","ORY42706",165,0)
 ;;R^"860.8:",100,49
"RTN","ORY42706",166,0)
 ;;D^  ; .S OCXDATA(OCXELE,"TIME")=OCXTIME
"RTN","ORY42706",167,0)
 ;;R^"860.8:",100,50
"RTN","ORY42706",168,0)
 ;;D^  ; .S OCXDATA(OCXELE,"LOG")=$G(OCXOLOG)
"RTN","ORY42706",169,0)
 ;;R^"860.8:",100,51
"RTN","ORY42706",170,0)
 ;;D^  ; .S OCXDATA("B",OCXELE,OCXELE)=""
"RTN","ORY42706",171,0)
 ;;R^"860.8:",100,52
"RTN","ORY42706",172,0)
 ;;D^  ; .K ^OCXD(860.7,OCXDFN,1,OCXRUL,1,OCXREL,1,OCXELE)
"RTN","ORY42706",173,0)
 ;;R^"860.8:",100,53
"RTN","ORY42706",174,0)
 ;;D^T+; .D SETAP(OCXGR1_")","860.7122P","Element",$P($G(^OCXS(860.3,OCXELE,0)),U,1),.OCXDATA,OCXELE)
"RTN","ORY42706",175,0)
 ;;R^"860.8:",100,54
"RTN","ORY42706",176,0)
 ;;D^T-; .D SETAP(OCXGR1_")","860.7122P",.OCXDATA,OCXELE)
"RTN","ORY42706",177,0)
 ;;R^"860.8:",100,55
"RTN","ORY42706",178,0)
 ;;D^  ; .;
"RTN","ORY42706",179,0)
 ;;R^"860.8:",100,56
"RTN","ORY42706",180,0)
 ;;D^  ; .S OCXDFI=0 F  S OCXDFI=$O(^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)) Q:'OCXDFI  D
"RTN","ORY42706",181,0)
 ;;R^"860.8:",100,57
"RTN","ORY42706",182,0)
 ;;D^  ; ..N OCXGR2
"RTN","ORY42706",183,0)
 ;;R^"860.8:",100,58
"RTN","ORY42706",184,0)
 ;;D^  ; ..S OCXGR2=OCXGR1_","_OCXELE_",1"
"RTN","ORY42706",185,0)
 ;;R^"860.8:",100,59
"RTN","ORY42706",186,0)
 ;;D^  ; ..K OCXDATA
"RTN","ORY42706",187,0)
 ;;R^"860.8:",100,60
"RTN","ORY42706",188,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,0)=OCXDFI
"RTN","ORY42706",189,0)
 ;;R^"860.8:",100,61
"RTN","ORY42706",190,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,"VAL")=^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)
"RTN","ORY42706",191,0)
 ;;R^"860.8:",100,62
"RTN","ORY42706",192,0)
 ;;D^  ; ..S OCXDATA("B",OCXDFI,OCXDFI)=""
"RTN","ORY42706",193,0)
 ;;R^"860.8:",100,63
"RTN","ORY42706",194,0)
 ;;D^T+; ..D SETAP(OCXGR2_")","860.71223P","Data Field",$P($G(^OCXS(860.4,OCXDFI,0)),U,1),.OCXDATA,OCXDFI)
"RTN","ORY42706",195,0)
 ;;R^"860.8:",100,64
"RTN","ORY42706",196,0)
 ;;D^T-; ..D SETAP(OCXGR2_")","860.71223P",.OCXDATA,OCXDFI)
"RTN","ORY42706",197,0)
 ;;R^"860.8:",100,65
"RTN","ORY42706",198,0)
 ;;D^  ; ;
"RTN","ORY42706",199,0)
 ;;R^"860.8:",100,66
"RTN","ORY42706",200,0)
 ;;D^  ; Q 1
"RTN","ORY42706",201,0)
 ;;R^"860.8:",100,67
"RTN","ORY42706",202,0)
 ;;D^  ; ;
"RTN","ORY42706",203,0)
 ;;R^"860.8:",100,68
"RTN","ORY42706",204,0)
 ;;D^T+;SETAP(ROOT,DD,ITEM,ITEMNAME,DATA,DA) ;  Set Rule Event data
"RTN","ORY42706",205,0)
 ;;R^"860.8:",100,69
"RTN","ORY42706",206,0)
 ;;D^T-;SETAP(ROOT,DD,DATA,DA) ;  Set Rule Event data
"RTN","ORY42706",207,0)
 ;;R^"860.8:",100,70
"RTN","ORY42706",208,0)
 ;;D^  ; M @ROOT=DATA
"RTN","ORY42706",209,0)
 ;;R^"860.8:",100,71
"RTN","ORY42706",210,0)
 ;;D^  ; I +$G(DD) S @ROOT@(0)="^"_($G(DD))_"^"_($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY42706",211,0)
 ;;R^"860.8:",100,72
"RTN","ORY42706",212,0)
 ;;D^  ; I '$G(DD) S $P(@ROOT@(0),U,3,4)=($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY42706",213,0)
 ;;R^"860.8:",100,73
"RTN","ORY42706",214,0)
 ;;D^T+; W:$G(OCXTRACE) !,"File Active Data ",$G(ITEM),": ",$G(ITEMNAME)
"RTN","ORY42706",215,0)
 ;;R^"860.8:",100,74
"RTN","ORY42706",216,0)
 ;;D^  ; ;
"RTN","ORY42706",217,0)
 ;;R^"860.8:",100,75
"RTN","ORY42706",218,0)
 ;;D^  ; Q
"RTN","ORY42706",219,0)
 ;;R^"860.8:",100,76
"RTN","ORY42706",220,0)
 ;;D^  ; ;
"RTN","ORY42706",221,0)
 ;;R^"860.8:",100,77
"RTN","ORY42706",222,0)
 ;;D^  ; ;
"RTN","ORY42706",223,0)
 ;;EOR^
"RTN","ORY42706",224,0)
 ;;KEY^860.8:^RETURN POINTED TO VALUE
"RTN","ORY42706",225,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42706",226,0)
 ;;D^RETURN POINTED TO VALUE
"RTN","ORY42706",227,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42706",228,0)
 ;;D^POINTER
"RTN","ORY42706",229,0)
 ;;R^"860.8:",1,1
"RTN","ORY42706",230,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY42706",231,0)
 ;;R^"860.8:",1,2
"RTN","ORY42706",232,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY42706",233,0)
 ;;R^"860.8:",100,1
"RTN","ORY42706",234,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY42706",235,0)
 ;;R^"860.8:",100,2
"RTN","ORY42706",236,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY42706",237,0)
 ;;R^"860.8:",100,3
"RTN","ORY42706",238,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20,"   FILE: ",$G(OCXFILE),"  D0: ",$G(D0)
"RTN","ORY42706",239,0)
 ;;R^"860.8:",100,4
"RTN","ORY42706",240,0)
 ;;D^  ; Q:'$G(D0) "" Q:'$L($G(OCXFILE)) ""
"RTN","ORY42706",241,0)
 ;;R^"860.8:",100,5
"RTN","ORY42706",242,0)
 ;;D^  ; N GLREF
"RTN","ORY42706",243,0)
 ;;R^"860.8:",100,6
"RTN","ORY42706",244,0)
 ;;D^  ; I '(OCXFILE=(+OCXFILE)) S GLREF=U_OCXFILE
"RTN","ORY42706",245,0)
 ;;R^"860.8:",100,7
"RTN","ORY42706",246,0)
 ;;D^  ; E  S GLREF=$$FILE^OCXBDTD(+OCXFILE,"GLOBAL NAME") Q:'$L(GLREF) ""
"RTN","ORY42706",247,0)
 ;1;
"RTN","ORY42706",248,0)
 ;
"RTN","ORY42707")
0^12^B69950041
"RTN","ORY42707",1,0)
ORY42707 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42707",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42707",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42707",4,0)
 ;
"RTN","ORY42707",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42707",6,0)
S ;
"RTN","ORY42707",7,0)
 ;
"RTN","ORY42707",8,0)
 D DOT^ORY427ES
"RTN","ORY42707",9,0)
 ;
"RTN","ORY42707",10,0)
 ;
"RTN","ORY42707",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42707",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42707",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42707",14,0)
 ;
"RTN","ORY42707",15,0)
 G ^ORY42708
"RTN","ORY42707",16,0)
 ;
"RTN","ORY42707",17,0)
 Q
"RTN","ORY42707",18,0)
 ;
"RTN","ORY42707",19,0)
DATA ;
"RTN","ORY42707",20,0)
 ;
"RTN","ORY42707",21,0)
 ;;R^"860.8:",100,8
"RTN","ORY42707",22,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," GLREF: ",GLREF,"  RESOLVES TO: ",$P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY42707",23,0)
 ;;R^"860.8:",100,9
"RTN","ORY42707",24,0)
 ;;D^  ; Q $P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY42707",25,0)
 ;;R^"860.8:",100,10
"RTN","ORY42707",26,0)
 ;;D^  ; ;
"RTN","ORY42707",27,0)
 ;;EOR^
"RTN","ORY42707",28,0)
 ;;KEY^860.8:^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY42707",29,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY42707",30,0)
 ;;D^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY42707",31,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY42707",32,0)
 ;;D^CLIST
"RTN","ORY42707",33,0)
 ;;R^"860.8:",100,1
"RTN","ORY42707",34,0)
 ;;D^  ;CLIST(DATA,LIST) ;   DOES THE DATA FIELD CONTAIN AN ELEMENT IN THE LIST
"RTN","ORY42707",35,0)
 ;;R^"860.8:",100,2
"RTN","ORY42707",36,0)
 ;;D^  ; ;
"RTN","ORY42707",37,0)
 ;;R^"860.8:",100,3
"RTN","ORY42707",38,0)
 ;;D^T+; W:$G(OCXTRACE) !!,"$$CLIST(",DATA,",""",LIST,""")"
"RTN","ORY42707",39,0)
 ;;R^"860.8:",100,4
"RTN","ORY42707",40,0)
 ;;D^  ; N PC F PC=1:1:$L(LIST,","),0 I PC,$L($P(LIST,",",PC)),(DATA[$P(LIST,",",PC)) Q
"RTN","ORY42707",41,0)
 ;;R^"860.8:",100,5
"RTN","ORY42707",42,0)
 ;;D^  ; Q ''PC
"RTN","ORY42707",43,0)
 ;;EOR^
"RTN","ORY42707",44,0)
 ;;EOF^OCXS(860.8)^1
"RTN","ORY42707",45,0)
 ;;SOF^860.6  ORDER CHECK DATA CONTEXT
"RTN","ORY42707",46,0)
 ;;KEY^860.6:^CPRS ORDER PRESCAN
"RTN","ORY42707",47,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY42707",48,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",49,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY42707",50,0)
 ;;D^OEPS
"RTN","ORY42707",51,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY42707",52,0)
 ;;D^DATA DRIVEN
"RTN","ORY42707",53,0)
 ;;EOR^
"RTN","ORY42707",54,0)
 ;;KEY^860.6:^CPRS ORDER PROTOCOL
"RTN","ORY42707",55,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY42707",56,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY42707",57,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY42707",58,0)
 ;;D^OERR
"RTN","ORY42707",59,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY42707",60,0)
 ;;D^DATA DRIVEN
"RTN","ORY42707",61,0)
 ;;EOR^
"RTN","ORY42707",62,0)
 ;;KEY^860.6:^DATABASE LOOKUP
"RTN","ORY42707",63,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY42707",64,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",65,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY42707",66,0)
 ;;D^DL
"RTN","ORY42707",67,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY42707",68,0)
 ;;D^PACKAGE LOOKUP
"RTN","ORY42707",69,0)
 ;;EOR^
"RTN","ORY42707",70,0)
 ;;KEY^860.6:^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",71,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY42707",72,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",73,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY42707",74,0)
 ;;D^HL7
"RTN","ORY42707",75,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY42707",76,0)
 ;;D^DATA DRIVEN
"RTN","ORY42707",77,0)
 ;;EOR^
"RTN","ORY42707",78,0)
 ;;EOF^OCXS(860.6)^1
"RTN","ORY42707",79,0)
 ;;SOF^860.5  ORDER CHECK DATA SOURCE
"RTN","ORY42707",80,0)
 ;;KEY^860.5:^DATABASE LOOKUP
"RTN","ORY42707",81,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY42707",82,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",83,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY42707",84,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",85,0)
 ;;EOR^
"RTN","ORY42707",86,0)
 ;;KEY^860.5:^HL7 COMMON ORDER SEGMENT
"RTN","ORY42707",87,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY42707",88,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY42707",89,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY42707",90,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",91,0)
 ;;EOR^
"RTN","ORY42707",92,0)
 ;;KEY^860.5:^HL7 PATIENT ID SEGMENT
"RTN","ORY42707",93,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY42707",94,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY42707",95,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY42707",96,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",97,0)
 ;;EOR^
"RTN","ORY42707",98,0)
 ;;KEY^860.5:^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY42707",99,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY42707",100,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY42707",101,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY42707",102,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY42707",103,0)
 ;;EOR^
"RTN","ORY42707",104,0)
 ;;KEY^860.5:^ORDER ENTRY ORDER PRESCAN
"RTN","ORY42707",105,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY42707",106,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY42707",107,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY42707",108,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",109,0)
 ;;EOR^
"RTN","ORY42707",110,0)
 ;;EOF^OCXS(860.5)^1
"RTN","ORY42707",111,0)
 ;;SOF^860.4  ORDER CHECK DATA FIELD
"RTN","ORY42707",112,0)
 ;;KEY^860.4:^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42707",113,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",114,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42707",115,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",116,0)
 ;;D^CLOZ ANC FLAG
"RTN","ORY42707",117,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",118,0)
 ;;D^BOOLEAN
"RTN","ORY42707",119,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",120,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",121,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",122,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",123,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",124,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY42707",125,0)
 ;;EOR^
"RTN","ORY42707",126,0)
 ;;KEY^860.4:^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42707",127,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",128,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42707",129,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",130,0)
 ;;D^CLOZ ANC RSLT
"RTN","ORY42707",131,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",132,0)
 ;;D^NUMERIC
"RTN","ORY42707",133,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",134,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",135,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",136,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",137,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",138,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY42707",139,0)
 ;;EOR^
"RTN","ORY42707",140,0)
 ;;KEY^860.4:^CLOZAPINE LAB RESULTS
"RTN","ORY42707",141,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",142,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY42707",143,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",144,0)
 ;;D^CLOZ LAB RSLTS
"RTN","ORY42707",145,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",146,0)
 ;;D^FREE TEXT
"RTN","ORY42707",147,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",148,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",149,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",150,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",151,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",152,0)
 ;;D^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY42707",153,0)
 ;;EOR^
"RTN","ORY42707",154,0)
 ;;KEY^860.4:^CLOZAPINE MED
"RTN","ORY42707",155,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",156,0)
 ;;D^CLOZAPINE MED
"RTN","ORY42707",157,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",158,0)
 ;;D^CLOZAPINE
"RTN","ORY42707",159,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",160,0)
 ;;D^BOOLEAN
"RTN","ORY42707",161,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",162,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",163,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",164,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",165,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",166,0)
 ;;D^PATIENT.CLOZAPINE MED
"RTN","ORY42707",167,0)
 ;;EOR^
"RTN","ORY42707",168,0)
 ;;KEY^860.4:^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42707",169,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",170,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42707",171,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",172,0)
 ;;D^CLOZ WBC FLAG
"RTN","ORY42707",173,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",174,0)
 ;;D^BOOLEAN
"RTN","ORY42707",175,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",176,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",177,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",178,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",179,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",180,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY42707",181,0)
 ;;EOR^
"RTN","ORY42707",182,0)
 ;;KEY^860.4:^FILLER
"RTN","ORY42707",183,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",184,0)
 ;;D^FILLER
"RTN","ORY42707",185,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",186,0)
 ;;D^FILL
"RTN","ORY42707",187,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",188,0)
 ;;D^FREE TEXT
"RTN","ORY42707",189,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY42707",190,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",191,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY42707",192,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY42707",193,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY42707",194,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY42707",195,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY42707",196,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",197,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY42707",198,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY42707",199,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY42707",200,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY42707",201,0)
 ;;EOR^
"RTN","ORY42707",202,0)
 ;;KEY^860.4:^ORDER MODE
"RTN","ORY42707",203,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",204,0)
 ;;D^ORDER MODE
"RTN","ORY42707",205,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",206,0)
 ;;D^FREE TEXT
"RTN","ORY42707",207,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY42707",208,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",209,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY42707",210,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY42707",211,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY42707",212,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY42707",213,0)
 ;;EOR^
"RTN","ORY42707",214,0)
 ;;KEY^860.4:^PATIENT IEN
"RTN","ORY42707",215,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",216,0)
 ;;D^PATIENT IEN
"RTN","ORY42707",217,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",218,0)
 ;;D^NUMERIC
"RTN","ORY42707",219,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.01,"E"
"RTN","ORY42707",220,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY42707",221,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.02,"E"
"RTN","ORY42707",222,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY42707",223,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",1,"E"
"RTN","ORY42707",224,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY42707",225,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY42707",226,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",227,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY42707",228,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY42707",229,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY42707",230,0)
 ;;D^PATIENT.IEN
"RTN","ORY42707",231,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY42707",232,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY42707",233,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY42707",234,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY42707",235,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY42707",236,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY42707",237,0)
 ;;EOR^
"RTN","ORY42707",238,0)
 ;;KEY^860.4:^PHARMACY LOCAL ID
"RTN","ORY42707",239,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY42707",240,0)
 ;;D^PHARMACY LOCAL ID
"RTN","ORY42707",241,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY42707",242,0)
 ;;D^DISP DRUG IEN
"RTN","ORY42707",243,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY42707",244,0)
 ;;D^FREE TEXT
"RTN","ORY42707",245,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY42707",246,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",247,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY42707",248,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY42707",249,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY42707",250,0)
 ;;D^PATIENT.OPS_DRUG_ID
"RTN","ORY42707",251,0)
 ;;EOR^
"RTN","ORY42707",252,0)
 ;;EOF^OCXS(860.4)^1
"RTN","ORY42707",253,0)
 ;;SOF^860.3  ORDER CHECK ELEMENT
"RTN","ORY42707",254,0)
 ;;KEY^860.3:^CLOZAPINE ANC < 1.0
"RTN","ORY42707",255,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY42707",256,0)
 ;;D^CLOZAPINE ANC < 1.0
"RTN","ORY42707",257,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY42707",258,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42707",259,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY42707",260,0)
 ;;D^4
"RTN","ORY42707",261,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY42707",262,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42707",263,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY42707",264,0)
 ;;D^LESS THAN
"RTN","ORY42707",265,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY42707",266,0)
 ;;D^1.0
"RTN","ORY42707",267,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY42707",268,0)
 ;;D^5
"RTN","ORY42707",269,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY42707",270,0)
 ;1;
"RTN","ORY42707",271,0)
 ;
"RTN","ORY42708")
0^13^B34877645
"RTN","ORY42708",1,0)
ORY42708 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;MAR 7,2017 at 15:12
"RTN","ORY42708",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY42708",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY42708",4,0)
 ;
"RTN","ORY42708",5,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY42708",6,0)
S ;
"RTN","ORY42708",7,0)
 ;
"RTN","ORY42708",8,0)
 D DOT^ORY427ES
"RTN","ORY42708",9,0)
 ;
"RTN","ORY42708",10,0)
 ;
"RTN","ORY42708",11,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY42708",12,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY42708",13,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY42708",14,0)
 ;
"RTN","ORY42708",15,0)
 ;
"RTN","ORY42708",16,0)
 ;
"RTN","ORY42708",17,0)
 Q
"RTN","ORY42708",18,0)
 ;
"RTN","ORY42708",19,0)
DATA ;
"RTN","ORY42708",20,0)
 ;
"RTN","ORY42708",21,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42708",22,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY42708",23,0)
 ;;D^LOGICAL TRUE
"RTN","ORY42708",24,0)
 ;;EOR^
"RTN","ORY42708",25,0)
 ;;KEY^860.3:^CLOZAPINE ANC >= 1.0 & < 1.5
"RTN","ORY42708",26,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY42708",27,0)
 ;;D^CLOZAPINE ANC >= 1.0 & < 1.5
"RTN","ORY42708",28,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY42708",29,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42708",30,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY42708",31,0)
 ;;D^1
"RTN","ORY42708",32,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY42708",33,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42708",34,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY42708",35,0)
 ;;D^GREATER THAN
"RTN","ORY42708",36,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY42708",37,0)
 ;;D^.999
"RTN","ORY42708",38,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY42708",39,0)
 ;;D^2
"RTN","ORY42708",40,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY42708",41,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY42708",42,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY42708",43,0)
 ;;D^LESS THAN
"RTN","ORY42708",44,0)
 ;;R^"860.3:","860.31:2",3,"E"
"RTN","ORY42708",45,0)
 ;;D^1.5
"RTN","ORY42708",46,0)
 ;;R^"860.3:","860.31:3",.01,"E"
"RTN","ORY42708",47,0)
 ;;D^3
"RTN","ORY42708",48,0)
 ;;R^"860.3:","860.31:3",1,"E"
"RTN","ORY42708",49,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42708",50,0)
 ;;R^"860.3:","860.31:3",2,"E"
"RTN","ORY42708",51,0)
 ;;D^LOGICAL TRUE
"RTN","ORY42708",52,0)
 ;;EOR^
"RTN","ORY42708",53,0)
 ;;KEY^860.3:^CLOZAPINE DRUG SELECTED
"RTN","ORY42708",54,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY42708",55,0)
 ;;D^CLOZAPINE DRUG SELECTED
"RTN","ORY42708",56,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY42708",57,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42708",58,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY42708",59,0)
 ;;D^1
"RTN","ORY42708",60,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY42708",61,0)
 ;;D^ORDER MODE
"RTN","ORY42708",62,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY42708",63,0)
 ;;D^EQ FREE TEXT
"RTN","ORY42708",64,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY42708",65,0)
 ;;D^SELECT
"RTN","ORY42708",66,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY42708",67,0)
 ;;D^2
"RTN","ORY42708",68,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY42708",69,0)
 ;;D^FILLER
"RTN","ORY42708",70,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY42708",71,0)
 ;;D^STARTS WITH
"RTN","ORY42708",72,0)
 ;;R^"860.3:","860.31:2",3,"E"
"RTN","ORY42708",73,0)
 ;;D^PS
"RTN","ORY42708",74,0)
 ;;R^"860.3:","860.31:5",.01,"E"
"RTN","ORY42708",75,0)
 ;;D^5
"RTN","ORY42708",76,0)
 ;;R^"860.3:","860.31:5",1,"E"
"RTN","ORY42708",77,0)
 ;;D^CLOZAPINE MED
"RTN","ORY42708",78,0)
 ;;R^"860.3:","860.31:5",2,"E"
"RTN","ORY42708",79,0)
 ;;D^LOGICAL TRUE
"RTN","ORY42708",80,0)
 ;;EOR^
"RTN","ORY42708",81,0)
 ;;KEY^860.3:^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY42708",82,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY42708",83,0)
 ;;D^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY42708",84,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY42708",85,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42708",86,0)
 ;;R^"860.3:","860.31:6",.01,"E"
"RTN","ORY42708",87,0)
 ;;D^6
"RTN","ORY42708",88,0)
 ;;R^"860.3:","860.31:6",1,"E"
"RTN","ORY42708",89,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY42708",90,0)
 ;;R^"860.3:","860.31:6",2,"E"
"RTN","ORY42708",91,0)
 ;;D^LOGICAL FALSE
"RTN","ORY42708",92,0)
 ;;EOR^
"RTN","ORY42708",93,0)
 ;;KEY^860.3:^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY42708",94,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY42708",95,0)
 ;;D^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY42708",96,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY42708",97,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY42708",98,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY42708",99,0)
 ;;D^4
"RTN","ORY42708",100,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY42708",101,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY42708",102,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY42708",103,0)
 ;;D^LOGICAL FALSE
"RTN","ORY42708",104,0)
 ;;EOR^
"RTN","ORY42708",105,0)
 ;;EOF^OCXS(860.3)^1
"RTN","ORY42708",106,0)
 ;;SOF^860.2  ORDER CHECK RULE
"RTN","ORY42708",107,0)
 ;;KEY^860.2:^CLOZAPINE
"RTN","ORY42708",108,0)
 ;;R^"860.2:",.01,"E"
"RTN","ORY42708",109,0)
 ;;D^CLOZAPINE
"RTN","ORY42708",110,0)
 ;;R^"860.2:","860.21:1",.01,"E"
"RTN","ORY42708",111,0)
 ;;D^NO WBC W/IN 7 DAYS
"RTN","ORY42708",112,0)
 ;;R^"860.2:","860.21:1",.02,"E"
"RTN","ORY42708",113,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY42708",114,0)
 ;;R^"860.2:","860.21:1",1,"E"
"RTN","ORY42708",115,0)
 ;;D^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY42708",116,0)
 ;;R^"860.2:","860.21:1",2,"E"
"RTN","ORY42708",117,0)
 ;;D^CLOZAPINE AND NO WBC W/IN 7 DAYS
"RTN","ORY42708",118,0)
 ;;R^"860.2:","860.21:10",.01,"E"
"RTN","ORY42708",119,0)
 ;;D^1.0 >= ANC < 1.5
"RTN","ORY42708",120,0)
 ;;R^"860.2:","860.21:10",.02,"E"
"RTN","ORY42708",121,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY42708",122,0)
 ;;R^"860.2:","860.21:10",1,"E"
"RTN","ORY42708",123,0)
 ;;D^CLOZAPINE ANC >= 1.0 & < 1.5
"RTN","ORY42708",124,0)
 ;;R^"860.2:","860.21:4",.01,"E"
"RTN","ORY42708",125,0)
 ;;D^ANC < 1.0
"RTN","ORY42708",126,0)
 ;;R^"860.2:","860.21:4",.02,"E"
"RTN","ORY42708",127,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY42708",128,0)
 ;;R^"860.2:","860.21:4",1,"E"
"RTN","ORY42708",129,0)
 ;;D^CLOZAPINE ANC < 1.0
"RTN","ORY42708",130,0)
 ;;R^"860.2:","860.21:6",.01,"E"
"RTN","ORY42708",131,0)
 ;;D^NO ANC W/IN 7 DAYS
"RTN","ORY42708",132,0)
 ;;R^"860.2:","860.21:6",.02,"E"
"RTN","ORY42708",133,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY42708",134,0)
 ;;R^"860.2:","860.21:6",1,"E"
"RTN","ORY42708",135,0)
 ;;D^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY42708",136,0)
 ;;R^"860.2:","860.21:7",.01,"E"
"RTN","ORY42708",137,0)
 ;;D^CLOZAPINE
"RTN","ORY42708",138,0)
 ;;R^"860.2:","860.21:7",.02,"E"
"RTN","ORY42708",139,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY42708",140,0)
 ;;R^"860.2:","860.21:7",1,"E"
"RTN","ORY42708",141,0)
 ;;D^CLOZAPINE DRUG SELECTED
"RTN","ORY42708",142,0)
 ;;R^"860.2:","860.22:1",.01,"E"
"RTN","ORY42708",143,0)
 ;;D^1
"RTN","ORY42708",144,0)
 ;;R^"860.2:","860.22:1",1,"E"
"RTN","ORY42708",145,0)
 ;;D^CLOZAPINE AND (NO WBC W/IN 7 DAYS OR NO ANC W/IN 7 DAYS)
"RTN","ORY42708",146,0)
 ;;R^"860.2:","860.22:1",2,"E"
"RTN","ORY42708",147,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY42708",148,0)
 ;;R^"860.2:","860.22:1",6,"E"
"RTN","ORY42708",149,0)
 ;;D^Clozapine orders require a CBC/Diff within past 7 days.  Please order CBC/Diff with WBC and ANC immediately.  Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY42708",150,0)
 ;;R^"860.2:","860.22:2",.01,"E"
"RTN","ORY42708",151,0)
 ;;D^2
"RTN","ORY42708",152,0)
 ;;R^"860.2:","860.22:2",1,"E"
"RTN","ORY42708",153,0)
 ;;D^CLOZAPINE AND ANC < 1.0
"RTN","ORY42708",154,0)
 ;;R^"860.2:","860.22:2",2,"E"
"RTN","ORY42708",155,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY42708",156,0)
 ;;R^"860.2:","860.22:2",6,"E"
"RTN","ORY42708",157,0)
 ;;D^Moderate/Severe Neutropenia - please repeat CBC/Diff including WBC and ANC tests immediately and Daily until ANC stabilizes to greater than or equal to 1000. Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY42708",158,0)
 ;;R^"860.2:","860.22:3",.01,"E"
"RTN","ORY42708",159,0)
 ;;D^3
"RTN","ORY42708",160,0)
 ;;R^"860.2:","860.22:3",1,"E"
"RTN","ORY42708",161,0)
 ;;D^CLOZAPINE AND (1.0 >= ANC < 1.5)
"RTN","ORY42708",162,0)
 ;;R^"860.2:","860.22:3",2,"E"
"RTN","ORY42708",163,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY42708",164,0)
 ;;R^"860.2:","860.22:3",6,"E"
"RTN","ORY42708",165,0)
 ;;D^Mild Neutropenia - please repeat CBC/Diff including WBC and ANC tests immediately and 3X weekly until ANC stabilizes to greater than or equal to 1500. Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY42708",166,0)
 ;;EOR^
"RTN","ORY42708",167,0)
 ;;EOF^OCXS(860.2)^1
"RTN","ORY42708",168,0)
 ;1;
"RTN","ORY42708",169,0)
 ;
"RTN","ORY4271")
0^2^B41095023
"RTN","ORY4271",1,0)
ORY4271 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ; 11/28/18 3:39pm
"RTN","ORY4271",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY4271",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY4271",4,0)
 ;
"RTN","ORY4271",5,0)
 ;Reference to ^%DT supported by DBIA #10003
"RTN","ORY4271",6,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY4271",7,0)
S ;
"RTN","ORY4271",8,0)
 ;
"RTN","ORY4271",9,0)
 Q
"RTN","ORY4271",10,0)
 ;
"RTN","ORY4271",11,0)
 ;
"RTN","ORY4271",12,0)
COMPARE(L,R) ;
"RTN","ORY4271",13,0)
 ;
"RTN","ORY4271",14,0)
 Q:$$RES("R") 1
"RTN","ORY4271",15,0)
 ;
"RTN","ORY4271",16,0)
 Q:'$L($O(L(""))) $$ADDREC^ORY4272("R")
"RTN","ORY4271",17,0)
 ;
"RTN","ORY4271",18,0)
 N C,OCXDD M C=L,C=R S OCXDD=$O(C("")) Q $$MULT("C",OCXDD)
"RTN","ORY4271",19,0)
 ;
"RTN","ORY4271",20,0)
 Q 0
"RTN","ORY4271",21,0)
 ;
"RTN","ORY4271",22,0)
RES(REF) ;
"RTN","ORY4271",23,0)
 ;
"RTN","ORY4271",24,0)
 N QUIT,SUB
"RTN","ORY4271",25,0)
 S QUIT=0
"RTN","ORY4271",26,0)
 S SUB="" F  S SUB=$O(@REF@(SUB)) Q:'$L(SUB)  I (SUB[":") D  Q:QUIT
"RTN","ORY4271",27,0)
 .N DD,DA
"RTN","ORY4271",28,0)
 .S DD=$P(SUB,":",1),DA=$P(SUB,":",2)
"RTN","ORY4271",29,0)
 .I $L(DA),'(DA=+DA) D  Q:QUIT
"RTN","ORY4271",30,0)
 ..N DANEW,SUBNEW
"RTN","ORY4271",31,0)
 ..S DANEW=$O(^OCXS($P(DA,U,2),"B",$P(DA,U,1),0))
"RTN","ORY4271",32,0)
 ..I 'DANEW W !!,$P($G(^OCXS(+$P(DA,U,2),0)),U,1),": ",$P(DA,U,1),"  could not resolve name.",!!,"    End Transport." S QUIT=1 Q
"RTN","ORY4271",33,0)
 ..S SUBNEW=DD_":"_DANEW
"RTN","ORY4271",34,0)
 ..I $D(@REF@(SUBNEW)) W !!," multiple #",DANEW," already existed." S QUIT=1 Q
"RTN","ORY4271",35,0)
 ..M @REF@(SUBNEW)=@REF@(SUB)
"RTN","ORY4271",36,0)
 ..K @REF@(SUB)
"RTN","ORY4271",37,0)
 ..S SUB=""
"RTN","ORY4271",38,0)
 .I $L(SUB),($D(@REF@(SUB))>9) S QUIT=$$RES($NA(@REF@(SUB)))
"RTN","ORY4271",39,0)
 ;
"RTN","ORY4271",40,0)
 Q QUIT
"RTN","ORY4271",41,0)
 ;
"RTN","ORY4271",42,0)
MULT(CREF,OCXDD) ;
"RTN","ORY4271",43,0)
 ;
"RTN","ORY4271",44,0)
 N OCXSUB,LREF,RREF,QUIT,OCXFLD
"RTN","ORY4271",45,0)
 S LREF="L"_$E(CREF,2,$L(CREF)),RREF="R"_$E(CREF,2,$L(CREF))
"RTN","ORY4271",46,0)
 ;
"RTN","ORY4271",47,0)
 S QUIT=0,OCXFLD="" F  S OCXFLD=$O(@CREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  D  Q:QUIT
"RTN","ORY4271",48,0)
 .I (OCXFLD[":") D  Q:QUIT
"RTN","ORY4271",49,0)
 ..Q:$$EXFLD(+OCXFLD,0)
"RTN","ORY4271",50,0)
 ..I '$D(@LREF@(OCXDD,OCXFLD,.01,"E")) D  M @LREF@(OCXDD,OCXFLD)=@RREF@(OCXDD,OCXFLD)
"RTN","ORY4271",51,0)
 ...D WARN("Missing multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY4271",52,0)
 ...S QUIT=$$ADDMULT^ORY4273(CREF,OCXDD,OCXFLD)
"RTN","ORY4271",53,0)
 ..I '$D(@RREF@(OCXDD,OCXFLD,.01,"E")) D  M @RREF@(OCXDD,OCXFLD)=@LREF@(OCXDD,OCXFLD)
"RTN","ORY4271",54,0)
 ...D WARN("Extra multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY4271",55,0)
 ...S QUIT=$$DELMULT^ORY4273($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY4271",56,0)
 .;
"RTN","ORY4271",57,0)
 .I (OCXFLD=+OCXFLD),'$$EXFLD(+OCXDD,OCXFLD) D
"RTN","ORY4271",58,0)
 ..I ($O(@CREF@(OCXDD,OCXFLD,""))="E") D  Q
"RTN","ORY4271",59,0)
 ...I $L($G(@RREF@(OCXDD,OCXFLD,"E"))),'$L($G(@LREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY4271",60,0)
 ....D WARN("Data Value Missing in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",61,0)
 ....S QUIT=$$EDITFLD^ORY4274(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",62,0)
 ...I $L($G(@LREF@(OCXDD,OCXFLD,"E"))),'$L($G(@RREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY4271",63,0)
 ....D WARN("Extra Data Value in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",64,0)
 ....S QUIT=$$DELFLD^ORY4274(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",65,0)
 ...I '(@LREF@(OCXDD,OCXFLD,"E")=@RREF@(OCXDD,OCXFLD,"E")) D
"RTN","ORY4271",66,0)
 ....D WARN("Inconsistent Data",CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",67,0)
 ....S QUIT=$$EDITFLD^ORY4274(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY4271",68,0)
 ..S OCXSUB=0 F  Q:QUIT  S OCXSUB=$O(@CREF@(OCXDD,OCXFLD,OCXSUB)) Q:'OCXSUB  I '($G(@RREF@(OCXDD,OCXFLD,OCXSUB))=$G(@LREF@(OCXDD,OCXFLD,OCXSUB))) D  Q
"RTN","ORY4271",69,0)
 ...D WARN("Inconsistent word Data",CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY4271",70,0)
 ...S QUIT=$$LOADWORD^ORY4272(RREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY4271",71,0)
 .;
"RTN","ORY4271",72,0)
 .I 'QUIT,(OCXFLD[":") S QUIT=$$MULT($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY4271",73,0)
 Q QUIT
"RTN","ORY4271",74,0)
 ;
"RTN","ORY4271",75,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY4271",76,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY4271",77,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY4271",78,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY4271",79,0)
 ;
"RTN","ORY4271",80,0)
EXFLD(FILE,OCXFLD) ;
"RTN","ORY4271",81,0)
 N OCXFNAM
"RTN","ORY4271",82,0)
 S OCXFNAM=$$FIELD^OCXSENDD(FILE,OCXFLD,"LABEL")
"RTN","ORY4271",83,0)
 I (OCXFNAM["UNIQUE OBJECT IDENTIFIER") Q 1
"RTN","ORY4271",84,0)
 I (FILE=860.2),(OCXFLD=.02) Q 1
"RTN","ORY4271",85,0)
 I (FILE=860.22),(OCXFLD=4) Q 1
"RTN","ORY4271",86,0)
 I (FILE=860.3),(OCXFLD=3) Q 1
"RTN","ORY4271",87,0)
 I (FILE=860.9),(OCXFLD=1) Q 1
"RTN","ORY4271",88,0)
 I (FILE=860.91) Q 1
"RTN","ORY4271",89,0)
 I (FILE=860.801) Q 1
"RTN","ORY4271",90,0)
 I (FILE=860.81) Q 1
"RTN","ORY4271",91,0)
 I (FILE=861.01) Q 1
"RTN","ORY4271",92,0)
 I (FILE=863.02) Q 1
"RTN","ORY4271",93,0)
 I (FILE=863.54) Q 1
"RTN","ORY4271",94,0)
 I (FILE=863.61) Q 1
"RTN","ORY4271",95,0)
 I (FILE=863.72) Q 1
"RTN","ORY4271",96,0)
 I (FILE=863.81) Q 1
"RTN","ORY4271",97,0)
 I ($E(OCXFNAM,1)="*") Q 1
"RTN","ORY4271",98,0)
 Q 0
"RTN","ORY4271",99,0)
 ;
"RTN","ORY4271",100,0)
WARN(MSG,CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY4271",101,0)
 ;
"RTN","ORY4271",102,0)
 Q:$G(OCXAUTO)
"RTN","ORY4271",103,0)
 ;
"RTN","ORY4271",104,0)
 N D0,DASH,OCXDDPTH,OCXDPTR,FILE,FILEID,LREF,OCXPTR,RREF
"RTN","ORY4271",105,0)
 ;
"RTN","ORY4271",106,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)))="-"
"RTN","ORY4271",107,0)
 W !!,"------------",MSG,DASH
"RTN","ORY4271",108,0)
 D DSPHDR(CREF,OCXDD,OCXFLD)
"RTN","ORY4271",109,0)
 I $D(OCXSUB) D DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY4271",110,0)
 I '$D(OCXSUB) D DSPREC(CREF,OCXDD,OCXFLD)
"RTN","ORY4271",111,0)
 ;
"RTN","ORY4271",112,0)
 W ! Q
"RTN","ORY4271",113,0)
 ;
"RTN","ORY4271",114,0)
DSPREC(CREF,OCXDD,OCXFLD) ;
"RTN","ORY4271",115,0)
 ;
"RTN","ORY4271",116,0)
 N OCXDPTR,OCXDDPTH,LEVL,OCXCREF,OCXSUB
"RTN","ORY4271",117,0)
 S OCXCREF=$$APPEND($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY4271",118,0)
 S OCXDDPTH=$P($P(OCXCREF,"(",2),")",1),LEVL=$L(OCXDDPTH,",")
"RTN","ORY4271",119,0)
 S OCXSUB="" F  S OCXSUB=$O(@OCXCREF@(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","ORY4271",120,0)
 .;
"RTN","ORY4271",121,0)
 .I '(OCXSUB[":"),'((OCXSUB=.01)&$O(@OCXCREF@(OCXSUB))) D
"RTN","ORY4271",122,0)
 ..N LINE
"RTN","ORY4271",123,0)
 ..Q:$$EXFLD(+OCXFLD,OCXSUB)
"RTN","ORY4271",124,0)
 ..I OCXFLD W !,?(5+((LEVL)*4)),$$FIELD^OCXSENDD(+OCXFLD,OCXSUB,"LABEL"),": ",$G(@OCXCREF@(OCXSUB,"E"))
"RTN","ORY4271",125,0)
 ..S LINE=0 F  S LINE=$O(@OCXCREF@(OCXSUB,LINE)) Q:'LINE  D
"RTN","ORY4271",126,0)
 ...W !,?(5+(LEVL*4)),$J(LINE,3),">",@OCXCREF@(OCXSUB,LINE)
"RTN","ORY4271",127,0)
 .;
"RTN","ORY4271",128,0)
 .I (OCXSUB[":") D
"RTN","ORY4271",129,0)
 ..N D0,OCXDD,FILENAME
"RTN","ORY4271",130,0)
 ..S D0=+$P(OCXSUB,":",2),OCXDD=+OCXSUB
"RTN","ORY4271",131,0)
 ..S FILENAME=$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY4271",132,0)
 ..I $L(FILENAME) W !,?(5+($L(LEVL)*4)),FILENAME
"RTN","ORY4271",133,0)
 ..E  W !!,?(5+(LEVL*4)),FILENAME
"RTN","ORY4271",134,0)
 ..W " ",D0,": ",$G(@OCXCREF@(OCXSUB,.01,"E"))
"RTN","ORY4271",135,0)
 ..D DSPREC($$APPEND(CREF,OCXDD),OCXFLD,OCXSUB)
"RTN","ORY4271",136,0)
 ;
"RTN","ORY4271",137,0)
 Q
"RTN","ORY4271",138,0)
 ;
"RTN","ORY4271",139,0)
DSPHDR(CREF,OCXDD,OCXFLD) ;
"RTN","ORY4271",140,0)
 ;
"RTN","ORY4271",141,0)
 N D0,FILE,FILEID,OCXPTR,OCXDDPTH
"RTN","ORY4271",142,0)
 S OCXDDPTH=$P($P($$APPEND($$APPEND(CREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY4271",143,0)
 S FILE="" F OCXPTR=1:1:$L(OCXDDPTH,",") D
"RTN","ORY4271",144,0)
 .N OCXDD,D0,FILEID
"RTN","ORY4271",145,0)
 .S FILEID=$P(OCXDDPTH,",",OCXPTR)
"RTN","ORY4271",146,0)
 .I (FILEID[":") D
"RTN","ORY4271",147,0)
 ..S D0=+$P(FILEID,":",2),OCXDD=+$E(FILEID,2,$L(FILEID))
"RTN","ORY4271",148,0)
 ..W !,?(5+(OCXPTR*4)),$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY4271",149,0)
 ..S:$L(FILE) FILE=FILE_"," S FILE=FILE_FILEID
"RTN","ORY4271",150,0)
 ..I $D(@("L("_FILE_",.01,""E"")")) W ": ",@("L("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY4271",151,0)
 ..E  I $D(@("R("_FILE_",.01,""E"")")) W ": ",@("R("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY4271",152,0)
 ;
"RTN","ORY4271",153,0)
 Q
"RTN","ORY4271",154,0)
 ;
"RTN","ORY4271",155,0)
DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY4271",156,0)
 ;
"RTN","ORY4271",157,0)
 N OCXDPTR,LREF,RREF,OCXDDPTH
"RTN","ORY4271",158,0)
 ;
"RTN","ORY4271",159,0)
 S OCXDDPTH=$P($P($$APPEND(CREF,OCXDD),"(",2),")",1)
"RTN","ORY4271",160,0)
 S LREF="L("_OCXDDPTH_")",RREF="R("_OCXDDPTH_")"
"RTN","ORY4271",161,0)
 W !,?(5+(($L(OCXDDPTH,",")+1)*4)),$$FIELD^OCXSENDD(OCXDD,OCXFLD,"LABEL")," field [",OCXFLD,"]"
"RTN","ORY4271",162,0)
 I OCXSUB W " Line #",OCXSUB
"RTN","ORY4271",163,0)
 ;
"RTN","ORY4271",164,0)
 W:($D(@RREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(R) NCCLAB1.AAC.DOMAIN: ",@RREF@(OCXFLD,OCXSUB)
"RTN","ORY4271",165,0)
 W:($D(@LREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(L) ",$$NETNAME^OCXSEND,": ",@LREF@(OCXFLD,OCXSUB)
"RTN","ORY4271",166,0)
 ;
"RTN","ORY4271",167,0)
 Q
"RTN","ORY4271",168,0)
 ;
"RTN","ORY4271",169,0)
 W !,?10 Q 0 Q $$PAUSE
"RTN","ORY4271",170,0)
 ;
"RTN","ORY4271",171,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY4271",172,0)
 ;
"RTN","ORY4271",173,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY4271",174,0)
 ;
"RTN","ORY4272")
0^3^B28301234
"RTN","ORY4272",1,0)
ORY4272 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ; 11/28/18 3:41pm
"RTN","ORY4272",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY4272",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY4272",4,0)
 ;Reference to ^%DT supported by DBIA #10003
"RTN","ORY4272",5,0)
 ;Reference to ^DIR supported by DBIA #10026
"RTN","ORY4272",6,0)
 ;Reference to ^DIC supported by DBIA #2051
"RTN","ORY4272",7,0)
 ;Reference to ^DIE supported by DBIA #2053
"RTN","ORY4272",8,0)
 ;Reference to $$IENS^DILF supported by DBIA #2054
"RTN","ORY4272",9,0)
 ;Reference to $$ROOT^DILFD supported by DBIA #2055
"RTN","ORY4272",10,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY4272",11,0)
S ;
"RTN","ORY4272",12,0)
 ;  Record Utilities
"RTN","ORY4272",13,0)
 Q
"RTN","ORY4272",14,0)
 ;
"RTN","ORY4272",15,0)
ADDREC(OCXCREF) ;
"RTN","ORY4272",16,0)
 ;
"RTN","ORY4272",17,0)
 N QUIT,OCXDD,OCXDA,OCXGREF,OCXNAME
"RTN","ORY4272",18,0)
 S OCXDD=$O(@OCXCREF@("")) Q:'OCXDD 0
"RTN","ORY4272",19,0)
 S OCXNAME=$G(@OCXCREF@(OCXDD,.01,"E"))
"RTN","ORY4272",20,0)
 ;
"RTN","ORY4272",21,0)
 W "   record missing..."
"RTN","ORY4272",22,0)
 I (OCXFLAG["D") Q 0
"RTN","ORY4272",23,0)
 ;
"RTN","ORY4272",24,0)
 S OCXDA=0 D CREATE(OCXCREF,OCXDD,.OCXDA,0)
"RTN","ORY4272",25,0)
 S:$L(OCXNAME) ^TMP("OCXRULE",$J,"A",+OCXDD,OCXNAME)=""
"RTN","ORY4272",26,0)
 ;
"RTN","ORY4272",27,0)
 Q 0
"RTN","ORY4272",28,0)
 ;
"RTN","ORY4272",29,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY4272",30,0)
 ;
"RTN","ORY4272",31,0)
 N OCXFLD,OCXGREF,OCXKEY
"RTN","ORY4272",32,0)
 ;
"RTN","ORY4272",33,0)
 I $L(OCXDA),'(OCXDA=+OCXDA) W !!,"Unresolved subscript." Q
"RTN","ORY4272",34,0)
 ;
"RTN","ORY4272",35,0)
 S OCXKEY=@OCXCREF@(OCXDD,.01,"E")
"RTN","ORY4272",36,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)
"RTN","ORY4272",37,0)
 I 'OCXDA D
"RTN","ORY4272",38,0)
 .S OCXDA=$O(^TMP("OCXRULE",$J,"B",+OCXDD,OCXKEY,0)) Q:OCXDA
"RTN","ORY4272",39,0)
 .S OCXDA=$O(@(OCXGREF_""" "")"),-1)+1
"RTN","ORY4272",40,0)
 .F OCXDA=OCXDA:1 Q:'$D(@(OCXGREF_OCXDA_",0)"))
"RTN","ORY4272",41,0)
 .I $D(@(OCXGREF_OCXDA_",0)")) S OCXDA=0
"RTN","ORY4272",42,0)
 ;
"RTN","ORY4272",43,0)
 I 'OCXDA W !!,"Error adding record..." Q
"RTN","ORY4272",44,0)
 ;
"RTN","ORY4272",45,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY4272",46,0)
 ;
"RTN","ORY4272",47,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY4271(+OCXDD,OCXFLD) D
"RTN","ORY4272",48,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY4272",49,0)
 .I $O(@OCXCREF@(OCXDD,OCXFLD,0)) D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,OCXCREF)
"RTN","ORY4272",50,0)
 ;
"RTN","ORY4272",51,0)
 D PUSH(.OCXDA)
"RTN","ORY4272",52,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY4272",53,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY4272",54,0)
 D POP(.OCXDA)
"RTN","ORY4272",55,0)
 Q
"RTN","ORY4272",56,0)
 ;
"RTN","ORY4272",57,0)
LOADWORD(RREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY4272",58,0)
 ;
"RTN","ORY4272",59,0)
 N QUIT,DDPATH,INDEX,OCXDA,OCXGREF
"RTN","ORY4272",60,0)
 S DDPATH=$P($P($$APPEND(RREF,OCXDD),"(",2),")",1)
"RTN","ORY4272",61,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY4272",62,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY4272",63,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY4272",64,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to reload the local '"_$$FIELD^OCXSENDD(+OCXDD,+OCXFLD,"LABEL")_"' field ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY4272",65,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,$L(DDPATH,",")-1) Q:'$L(OCXGREF)
"RTN","ORY4272",66,0)
 D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,RREF)
"RTN","ORY4272",67,0)
 Q 0
"RTN","ORY4272",68,0)
 ;
"RTN","ORY4272",69,0)
GETREF(OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY4272",70,0)
 ;
"RTN","ORY4272",71,0)
 Q:'OCXDD ""
"RTN","ORY4272",72,0)
 ;
"RTN","ORY4272",73,0)
 N OCXIENS,OCXERR,OCXX
"RTN","ORY4272",74,0)
 S OCXIENS=$$IENS^DILF(.OCXDA),OCXERR=""
"RTN","ORY4272",75,0)
 S OCXX=$$ROOT^DILFD(OCXDD,OCXIENS,0,OCXERR)
"RTN","ORY4272",76,0)
 Q OCXX
"RTN","ORY4272",77,0)
 ;
"RTN","ORY4272",78,0)
WORD(DD,GREF,FLD,DA,RREF) ;
"RTN","ORY4272",79,0)
 ;
"RTN","ORY4272",80,0)
 N SUB,GLROOT,LINE
"RTN","ORY4272",81,0)
 S SUB=$P($$FIELD^OCXSENDD(+DD,FLD,"GLOBAL SUBSCRIPT LOCATION"),";",1) S:'(SUB=+SUB) SUB=""""_SUB_""""
"RTN","ORY4272",82,0)
 S GLROOT=GREF_DA_","_SUB_")" K @GLROOT
"RTN","ORY4272",83,0)
 S LINE=0 F  S LINE=$O(@RREF@(DD,FLD,LINE)) Q:'LINE  D
"RTN","ORY4272",84,0)
 .S @GLROOT@($O(@GLROOT@(""),-1)+1,0)=@RREF@(DD,FLD,LINE)
"RTN","ORY4272",85,0)
 S LINE=$O(@GLROOT@(""),-1),@GLROOT@(0)=U_U_LINE_U_LINE_U_$$DATE("T")_U
"RTN","ORY4272",86,0)
 ;
"RTN","ORY4272",87,0)
 Q
"RTN","ORY4272",88,0)
 ;
"RTN","ORY4272",89,0)
DATE(X) N %DT,Y S %DT="" D ^%DT Q +Y
"RTN","ORY4272",90,0)
 ;
"RTN","ORY4272",91,0)
DIE(OCXDD,OCXDIC,OCXFLD,OCXVAL,OCXDA,OCXLVL) ;
"RTN","ORY4272",92,0)
 ;
"RTN","ORY4272",93,0)
 N DIC,DIE,X,Y,DR,DA,OCXDVAL,OCXPTR,OCXGREF,D0,OCXSCR
"RTN","ORY4272",94,0)
 S (D0,DA)=OCXDA,(DIC,DIE)=OCXDIC,DR=""
"RTN","ORY4272",95,0)
 S:OCXLVL D0=OCXDA(1),DR="S DA(1)="_(+D0)_",D0="_(+D0)_";"
"RTN","ORY4272",96,0)
 S:OCXVAL="?" OCXVAL="? " S DR=DR_OCXFLD_"///^S X=OCXVAL"
"RTN","ORY4272",97,0)
 I '(OCXVAL="@") W !,?(OCXLVL*5),$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"LABEL"),": ",OCXVAL
"RTN","ORY4272",98,0)
 ;
"RTN","ORY4272",99,0)
 I '(OCXVAL="@") D
"RTN","ORY4272",100,0)
 .N OCXIEN,SHORT
"RTN","ORY4272",101,0)
 .S OCXPTR=+$P($$FIELD^OCXSENDD(+OCXDD,OCXFLD,"SPECIFIER"),"P",2)
"RTN","ORY4272",102,0)
 .Q:'OCXPTR
"RTN","ORY4272",103,0)
 .S OCXGREF="^"_$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"POINTER")
"RTN","ORY4272",104,0)
 .I '($E(OCXGREF,1,4)="^OCX"),'(OCXGREF="^ORD(100.9,"),'(OCXGREF="^ORD(100.8,") Q
"RTN","ORY4272",105,0)
 .Q:$$DIC(OCXGREF,OCXVAL,0)
"RTN","ORY4272",106,0)
 .S OCXIEN=$$DIC(OCXGREF,OCXVAL,1)
"RTN","ORY4272",107,0)
 .S ^TMP("OCXRULE",$J,"B",OCXPTR,OCXVAL,OCXIEN)=""
"RTN","ORY4272",108,0)
 ;
"RTN","ORY4272",109,0)
 S OCXSCR=1
"RTN","ORY4272",110,0)
 D ^DIE
"RTN","ORY4272",111,0)
 ;
"RTN","ORY4272",112,0)
 ; I $D(Y) -> DIE FILER ERROR
"RTN","ORY4272",113,0)
 I $D(Y) W "   ^DIE filer data error..." S OCXDIER=$G(OCXDIER)+1
"RTN","ORY4272",114,0)
 I '$D(Y) W "    ...Correct data Filed"
"RTN","ORY4272",115,0)
 ;
"RTN","ORY4272",116,0)
 Q
"RTN","ORY4272",117,0)
 ;
"RTN","ORY4272",118,0)
DIC(DIC,X,OCXADD) N OCXSCR S DIC(0)="",OCXSCR=1 S:OCXADD DIC(0)="L" D ^DIC Q:(+Y>0) +Y Q 0
"RTN","ORY4272",119,0)
 ;
"RTN","ORY4272",120,0)
PUSH(OCXDA) ;
"RTN","ORY4272",121,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY4272",122,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY4272",123,0)
 Q
"RTN","ORY4272",124,0)
 ;
"RTN","ORY4272",125,0)
POP(OCXDA) ;
"RTN","ORY4272",126,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY4272",127,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY4272",128,0)
 Q
"RTN","ORY4272",129,0)
 ;
"RTN","ORY4272",130,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY4272",131,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY4272",132,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY4272",133,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY4272",134,0)
 ;
"RTN","ORY4272",135,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY4272",136,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY4272",137,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY4272",138,0)
 S DIR(0)=OCXZ0
"RTN","ORY4272",139,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY4272",140,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY4272",141,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY4272",142,0)
 D ^DIR
"RTN","ORY4272",143,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY4272",144,0)
 Q Y
"RTN","ORY4272",145,0)
 ;
"RTN","ORY4272",146,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY4272",147,0)
 ;
"RTN","ORY4273")
0^4^B13307046
"RTN","ORY4273",1,0)
ORY4273 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ; 11/28/18 4:20am
"RTN","ORY4273",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY4273",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY4273",4,0)
 ;
"RTN","ORY4273",5,0)
 ; Reference to ^DIR supported by DBIA #10026
"RTN","ORY4273",6,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY4273",7,0)
S ;
"RTN","ORY4273",8,0)
 ;  Multiple Utilities
"RTN","ORY4273",9,0)
 Q
"RTN","ORY4273",10,0)
 ;
"RTN","ORY4273",11,0)
ADDMULT(OCXCREF,OCXDD,OCXFLD) ;
"RTN","ORY4273",12,0)
 ;
"RTN","ORY4273",13,0)
 ;
"RTN","ORY4273",14,0)
 N QUIT,OCXDA,OCXGREF,OCXNAME,DDPATH,INDEX
"RTN","ORY4273",15,0)
 ;
"RTN","ORY4273",16,0)
 S DDPATH=$P($P($$APPEND($$APPEND(OCXCREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY4273",17,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY4273",18,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY4273",19,0)
 ;
"RTN","ORY4273",20,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY4273",21,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to add a local '"_$$FILENAME^OCXSENDD(+OCXFLD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY4273",22,0)
 ;
"RTN","ORY4273",23,0)
 S OCXGREF=$$GETREF^ORY4272(+OCXFLD,.OCXDA,1)
"RTN","ORY4273",24,0)
 D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,1)
"RTN","ORY4273",25,0)
 ;
"RTN","ORY4273",26,0)
 Q 0
"RTN","ORY4273",27,0)
 ;
"RTN","ORY4273",28,0)
DELMULT(OCXCREF,OCXDD) ;
"RTN","ORY4273",29,0)
 ;
"RTN","ORY4273",30,0)
 N QUIT,OCXGREF,DA,INDEX,DDPATH
"RTN","ORY4273",31,0)
 ;
"RTN","ORY4273",32,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY4273",33,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY4273",34,0)
 ;
"RTN","ORY4273",35,0)
 S DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY4273",36,0)
 F INDEX=1:1:$L(DDPATH,",") S DA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY4273",37,0)
 S DA=$G(DA(0)) K DA(0)
"RTN","ORY4273",38,0)
 S OCXGREF=$$GETREF^ORY4272(+OCXDD,.DA,1)
"RTN","ORY4273",39,0)
 ;
"RTN","ORY4273",40,0)
 D DIE^ORY4272(+OCXDD,OCXGREF,.01,"@",.DA,$L(DDPATH,",")-1)
"RTN","ORY4273",41,0)
 K @OCXCREF@(OCXDD) W !!,"  deleted..."
"RTN","ORY4273",42,0)
 ;
"RTN","ORY4273",43,0)
 Q 0
"RTN","ORY4273",44,0)
 ;
"RTN","ORY4273",45,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY4273",46,0)
 ;
"RTN","ORY4273",47,0)
 N OCXFLD,OCXGREF
"RTN","ORY4273",48,0)
 ;
"RTN","ORY4273",49,0)
 S OCXGREF=$$GETREF^ORY4272(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY4273",50,0)
 ;
"RTN","ORY4273",51,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY4273",52,0)
 ;
"RTN","ORY4273",53,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY4271(+OCXDD,OCXFLD) D
"RTN","ORY4273",54,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY4272(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY4273",55,0)
 ;
"RTN","ORY4273",56,0)
 D PUSH(.OCXDA)
"RTN","ORY4273",57,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY4273",58,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY4273",59,0)
 D POP(.OCXDA)
"RTN","ORY4273",60,0)
 Q
"RTN","ORY4273",61,0)
 ;
"RTN","ORY4273",62,0)
PUSH(OCXDA) ;
"RTN","ORY4273",63,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY4273",64,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY4273",65,0)
 Q
"RTN","ORY4273",66,0)
 ;
"RTN","ORY4273",67,0)
POP(OCXDA) ;
"RTN","ORY4273",68,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY4273",69,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY4273",70,0)
 Q
"RTN","ORY4273",71,0)
 ;
"RTN","ORY4273",72,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY4273",73,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY4273",74,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY4273",75,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY4273",76,0)
 ;
"RTN","ORY4273",77,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY4273",78,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY4273",79,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY4273",80,0)
 S DIR(0)=OCXZ0
"RTN","ORY4273",81,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY4273",82,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY4273",83,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY4273",84,0)
 D ^DIR
"RTN","ORY4273",85,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY4273",86,0)
 Q Y
"RTN","ORY4273",87,0)
 ;
"RTN","ORY4273",88,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY4273",89,0)
 ;
"RTN","ORY4274")
0^5^B13859060
"RTN","ORY4274",1,0)
ORY4274 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ; 11/28/18 4:20am
"RTN","ORY4274",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY4274",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY4274",4,0)
 ;
"RTN","ORY4274",5,0)
 ; Reference to ^DIR supported by DBIA #10026
"RTN","ORY4274",6,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY4274",7,0)
S ;
"RTN","ORY4274",8,0)
 ;  Field Utilities
"RTN","ORY4274",9,0)
 Q
"RTN","ORY4274",10,0)
 ;
"RTN","ORY4274",11,0)
EDITFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY4274",12,0)
 ;
"RTN","ORY4274",13,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT
"RTN","ORY4274",14,0)
 ;
"RTN","ORY4274",15,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY4274",16,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY4274",17,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY4274",18,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY4274",19,0)
 I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D
"RTN","ORY4274",20,0)
 .N RESP
"RTN","ORY4274",21,0)
 .Q:(OCXFLAG["D")
"RTN","ORY4274",22,0)
 .I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to change the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' field ?","YES") I 'RESP S QUIT=(RESP[U) Q
"RTN","ORY4274",23,0)
 .S OCXGREF=$$GETREF^ORY4272(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY4274",24,0)
 .D DIE^ORY4272(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL-1)
"RTN","ORY4274",25,0)
 ;
"RTN","ORY4274",26,0)
 Q QUIT
"RTN","ORY4274",27,0)
 ;
"RTN","ORY4274",28,0)
DELFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY4274",29,0)
 ;
"RTN","ORY4274",30,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT,RESP
"RTN","ORY4274",31,0)
 ;
"RTN","ORY4274",32,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY4274",33,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY4274",34,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY4274",35,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY4274",36,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY4274",37,0)
 I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to Delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' value ?","YES") I 'RESP S QUIT=(RESP[U) Q QUIT
"RTN","ORY4274",38,0)
 S OCXGREF=$$GETREF^ORY4272(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY4274",39,0)
 D DIE^ORY4272(OCXDD,OCXGREF,OCXFLD,"@",.OCXDA,OCXLVL-1)
"RTN","ORY4274",40,0)
 ;
"RTN","ORY4274",41,0)
 Q QUIT
"RTN","ORY4274",42,0)
 ;
"RTN","ORY4274",43,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY4274",44,0)
 ;
"RTN","ORY4274",45,0)
 N OCXFLD,OCXGREF
"RTN","ORY4274",46,0)
 ;
"RTN","ORY4274",47,0)
 S OCXGREF=$$GETREF^ORY4272(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY4274",48,0)
 ;
"RTN","ORY4274",49,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY4274",50,0)
 ;
"RTN","ORY4274",51,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY4271(+OCXDD,OCXFLD) D
"RTN","ORY4274",52,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY4272(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY4274",53,0)
 ;
"RTN","ORY4274",54,0)
 D PUSH(.OCXDA)
"RTN","ORY4274",55,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY4274",56,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY4274",57,0)
 D POP(.OCXDA)
"RTN","ORY4274",58,0)
 Q
"RTN","ORY4274",59,0)
 ;
"RTN","ORY4274",60,0)
PUSH(OCXDA) ;
"RTN","ORY4274",61,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY4274",62,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY4274",63,0)
 Q
"RTN","ORY4274",64,0)
 ;
"RTN","ORY4274",65,0)
POP(OCXDA) ;
"RTN","ORY4274",66,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY4274",67,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY4274",68,0)
 Q
"RTN","ORY4274",69,0)
 ;
"RTN","ORY4274",70,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY4274",71,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY4274",72,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY4274",73,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY4274",74,0)
 ;
"RTN","ORY4274",75,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY4274",76,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY4274",77,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY4274",78,0)
 S DIR(0)=OCXZ0
"RTN","ORY4274",79,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY4274",80,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY4274",81,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY4274",82,0)
 D ^DIR
"RTN","ORY4274",83,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY4274",84,0)
 Q Y
"RTN","ORY4274",85,0)
 ;
"RTN","ORY4274",86,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY4274",87,0)
 ;
"RTN","ORY427ES")
0^14^B12947340
"RTN","ORY427ES",1,0)
ORY427ES ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE ;10 May 2019 16:19:28
"RTN","ORY427ES",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**427**;Dec 17,1997;Build 105
"RTN","ORY427ES",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY427ES",4,0)
 ;Reference to BMES^XPDUTL supported by DBIA #10141
"RTN","ORY427ES",5,0)
 ;Reference to ^DIR supported by DBIA #10026
"RTN","ORY427ES",6,0)
 ; This is a post intall routine and can be deleted after install of patch OR*3*427
"RTN","ORY427ES",7,0)
S ;
"RTN","ORY427ES",8,0)
 ;
"RTN","ORY427ES",9,0)
 N OCXDIER,QUIT,LINE,TEXT,REMOTE,LOCAL,D0,OPCODE,REF,OCXFLAG S QUIT=0
"RTN","ORY427ES",10,0)
 N OCXAUTO,OCZSCR
"RTN","ORY427ES",11,0)
 ;
"RTN","ORY427ES",12,0)
 D DOT
"RTN","ORY427ES",13,0)
 I $L($T(VERSION^OCXOCMP)),($$VERSION^OCXOCMP="ORDER CHECK EXPERT version 1.01 released OCT 29,1998"),1
"RTN","ORY427ES",14,0)
 E  D  Q
"RTN","ORY427ES",15,0)
 .W !
"RTN","ORY427ES",16,0)
 .W !,"Rule Transport aborted, version mismatch."
"RTN","ORY427ES",17,0)
 .W !,"Current Local version: ",$$VERSION^OCXOCMP
"RTN","ORY427ES",18,0)
 .W !,"   Rule Transport Version: ORDER CHECK EXPERT version 1.01 released OCT 29,1998"
"RTN","ORY427ES",19,0)
 I '$D(DTIME) W !!,"DTIME not defined !!",!! Q
"RTN","ORY427ES",20,0)
 W !!,"Order Check Expert System Rule Transporter"
"RTN","ORY427ES",21,0)
 W !," Created: MAR 7,2017 at 15:12  at  NCCLAB1.AAC.DOMAIN"
"RTN","ORY427ES",22,0)
 W !," Current Date: ",$$NOW^ORY4270,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY427ES",23,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY427ES",24,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY427ES",25,0)
 S OCXFLAG="O"
"RTN","ORY427ES",26,0)
 ;
"RTN","ORY427ES",27,0)
RUN ;
"RTN","ORY427ES",28,0)
 ;
"RTN","ORY427ES",29,0)
 W !,"Loading Data " D ^ORY42701
"RTN","ORY427ES",30,0)
 ;
"RTN","ORY427ES",31,0)
 S LINE=0 F  S LINE=$O(^TMP("OCXRULE",$J,LINE)) Q:'LINE   D  Q:QUIT
"RTN","ORY427ES",32,0)
 .D:'(LINE#50) STATUS^OCXOPOST(LINE,$O(^TMP("OCXRULE",$J," "),-1))
"RTN","ORY427ES",33,0)
 .S TEXT=$G(^TMP("OCXRULE",$J,LINE)) I $L(TEXT) D  Q:QUIT
"RTN","ORY427ES",34,0)
 ..S TEXT=$P(TEXT,";",2,999),OPCODE=$P(TEXT,U,1),TEXT=$P(TEXT,U,2,999)
"RTN","ORY427ES",35,0)
 ..;
"RTN","ORY427ES",36,0)
 ..I OPCODE="KEY" D DOT S LOCAL="",D0=$$GETFILE^ORY4270(+$P(TEXT,U,1),$P(TEXT,U,2),.LOCAL) S QUIT=(D0=(-10)) Q
"RTN","ORY427ES",37,0)
 ..I OPCODE="R" S REF="REMOTE("_$P(TEXT,":",1)_":"_D0_$P(TEXT,":",2,99)_")" Q
"RTN","ORY427ES",38,0)
 ..I OPCODE="D",$D(REF) S @REF=$P(TEXT,U,1,999) K REF Q
"RTN","ORY427ES",39,0)
 ..;
"RTN","ORY427ES",40,0)
 ..I OPCODE="EOR" S QUIT=$$COMPARE^ORY4271(.LOCAL,.REMOTE) K LOCAL,REMOTE Q
"RTN","ORY427ES",41,0)
 ..I OPCODE="EOF" K LOCAL,REMOTE Q
"RTN","ORY427ES",42,0)
 ..I OPCODE="SOF" W !,"  Installing '",TEXT,"' records... " Q
"RTN","ORY427ES",43,0)
 ..I OPCODE="ROOT" D  Q
"RTN","ORY427ES",44,0)
 ...N FILE,DATA
"RTN","ORY427ES",45,0)
 ...S FILE=U_$P(TEXT,U,1),DATA=$P(TEXT,U,2,3)
"RTN","ORY427ES",46,0)
 ...I ($P($G(@FILE),U,1,2)=DATA) Q
"RTN","ORY427ES",47,0)
 ...S $P(@FILE,U,1,2)=DATA
"RTN","ORY427ES",48,0)
 ...W !,"  Restoring file #",(+$P(DATA,U,2))," zero node"
"RTN","ORY427ES",49,0)
 ..;
"RTN","ORY427ES",50,0)
 ..W !,"Unknown OpCode: ",OPCODE,"  in: ",TEXT S QUIT=$$PAUSE^ORY4270 W !
"RTN","ORY427ES",51,0)
 ;
"RTN","ORY427ES",52,0)
 K ^TMP("OCXRULE",$J)
"RTN","ORY427ES",53,0)
 ;
"RTN","ORY427ES",54,0)
 I $D(^OCXS) D
"RTN","ORY427ES",55,0)
 .N FILE,DO,PD0,CNT
"RTN","ORY427ES",56,0)
 .S FILE=0 F  S FILE=$O(^OCXS(FILE)) Q:'FILE  D
"RTN","ORY427ES",57,0)
 ..S D0=0 F CNT=0:1 S PD0=D0,D0=$O(^OCXS(FILE,D0)) Q:'D0
"RTN","ORY427ES",58,0)
 ..S $P(^OCXS(FILE,0),U,3,4)=CNT_U_PD0
"RTN","ORY427ES",59,0)
 ;
"RTN","ORY427ES",60,0)
 I $G(OCXDIER) D
"RTN","ORY427ES",61,0)
 .W !!!!!!!
"RTN","ORY427ES",62,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY427ES",63,0)
 .W !,?7,+$G(OCXDIER)," data filing error",$S(($G(OCXDIER)=1):"",1:"s"),"."
"RTN","ORY427ES",64,0)
 .W !,?7,"Some expert system rules may be incomplete."
"RTN","ORY427ES",65,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY427ES",66,0)
 I '$G(OCXDIER) W !!,?5," No data filing errors."
"RTN","ORY427ES",67,0)
 W !!,"Transport Finished..."
"RTN","ORY427ES",68,0)
 ;
"RTN","ORY427ES",69,0)
 D
"RTN","ORY427ES",70,0)
 .N OCXOETIM
"RTN","ORY427ES",71,0)
 .D BMES^XPDUTL("---Creating Order Check Routines-----------------------------------")
"RTN","ORY427ES",72,0)
 .D AUTO^OCXOCMP
"RTN","ORY427ES",73,0)
 ;
"RTN","ORY427ES",74,0)
 Q
"RTN","ORY427ES",75,0)
 ;
"RTN","ORY427ES",76,0)
DOT Q:$G(OCXAUTO)  W:($X>70) ! W " ." Q
"RTN","ORY427ES",77,0)
 ;
"RTN","ORY427ES",78,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY427ES",79,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY427ES",80,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY427ES",81,0)
 S DIR(0)=OCXZ0
"RTN","ORY427ES",82,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY427ES",83,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY427ES",84,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY427ES",85,0)
 D ^DIR
"RTN","ORY427ES",86,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY427ES",87,0)
 Q Y
"RTN","ORY427ES",88,0)
 ;
"VER")
8.0^22.2
**END**
**END**
