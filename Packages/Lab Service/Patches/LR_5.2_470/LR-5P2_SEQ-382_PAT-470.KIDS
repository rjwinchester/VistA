Released LR*5.2*470 SEQ #382
Extracted from mail message
**KIDS**:LR*5.2*470^

**INSTALL NAME**
LR*5.2*470
"BLD",10374,0)
LR*5.2*470^LAB SERVICE^0^3161222^y
"BLD",10374,1,0)
^^14^14^3161222^
"BLD",10374,1,1,0)
This is a general maintenance patch for the laboratory
"BLD",10374,1,2,0)
package by the Vista Maintenance team that addresses
"BLD",10374,1,3,0)
issues with some patients test results not getting transmitted
"BLD",10374,1,4,0)
to the HDR (Health Data Repository) and with some lab orders
"BLD",10374,1,5,0)
that have the wrong status in file #100 (ORDER).
"BLD",10374,1,6,0)
 
"BLD",10374,1,7,0)
ASSOCIATED REMEDY TICKET:
"BLD",10374,1,8,0)
========================
"BLD",10374,1,9,0)
1. INC000001243211  -  Failure of merged lab collect orders
"BLD",10374,1,10,0)
                       to transmit to HDR
"BLD",10374,1,11,0)
 
"BLD",10374,1,12,0)
 
"BLD",10374,1,13,0)
2. INC000000775621  -  Lab order merging leads to incorrect
"BLD",10374,1,14,0)
                       status of file 100 orders
"BLD",10374,4,0)
^9.64PA^^
"BLD",10374,6.3)
1
"BLD",10374,"KRN",0)
^9.67PA^779.2^20
"BLD",10374,"KRN",.4,0)
.4
"BLD",10374,"KRN",.401,0)
.401
"BLD",10374,"KRN",.402,0)
.402
"BLD",10374,"KRN",.403,0)
.403
"BLD",10374,"KRN",.5,0)
.5
"BLD",10374,"KRN",.84,0)
.84
"BLD",10374,"KRN",3.6,0)
3.6
"BLD",10374,"KRN",3.8,0)
3.8
"BLD",10374,"KRN",9.2,0)
9.2
"BLD",10374,"KRN",9.8,0)
9.8
"BLD",10374,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10374,"KRN",9.8,"NM",1,0)
LR7OB1^^0^B16381843
"BLD",10374,"KRN",9.8,"NM","B","LR7OB1",1)

"BLD",10374,"KRN",19,0)
19
"BLD",10374,"KRN",19.1,0)
19.1
"BLD",10374,"KRN",101,0)
101
"BLD",10374,"KRN",409.61,0)
409.61
"BLD",10374,"KRN",771,0)
771
"BLD",10374,"KRN",779.2,0)
779.2
"BLD",10374,"KRN",870,0)
870
"BLD",10374,"KRN",8989.51,0)
8989.51
"BLD",10374,"KRN",8989.52,0)
8989.52
"BLD",10374,"KRN",8994,0)
8994
"BLD",10374,"KRN","B",.4,.4)

"BLD",10374,"KRN","B",.401,.401)

"BLD",10374,"KRN","B",.402,.402)

"BLD",10374,"KRN","B",.403,.403)

"BLD",10374,"KRN","B",.5,.5)

"BLD",10374,"KRN","B",.84,.84)

"BLD",10374,"KRN","B",3.6,3.6)

"BLD",10374,"KRN","B",3.8,3.8)

"BLD",10374,"KRN","B",9.2,9.2)

"BLD",10374,"KRN","B",9.8,9.8)

"BLD",10374,"KRN","B",19,19)

"BLD",10374,"KRN","B",19.1,19.1)

"BLD",10374,"KRN","B",101,101)

"BLD",10374,"KRN","B",409.61,409.61)

"BLD",10374,"KRN","B",771,771)

"BLD",10374,"KRN","B",779.2,779.2)

"BLD",10374,"KRN","B",870,870)

"BLD",10374,"KRN","B",8989.51,8989.51)

"BLD",10374,"KRN","B",8989.52,8989.52)

"BLD",10374,"KRN","B",8994,8994)

"BLD",10374,"QUES",0)
^9.62^^
"BLD",10374,"REQB",0)
^9.611^1^1
"BLD",10374,"REQB",1,0)
LR*5.2*238^2
"BLD",10374,"REQB","B","LR*5.2*238",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
470^3161222
"PKG",26,22,1,"PAH",1,1,0)
^^14^14^3161222
"PKG",26,22,1,"PAH",1,1,1,0)
This is a general maintenance patch for the laboratory
"PKG",26,22,1,"PAH",1,1,2,0)
package by the Vista Maintenance team that addresses
"PKG",26,22,1,"PAH",1,1,3,0)
issues with some patients test results not getting transmitted
"PKG",26,22,1,"PAH",1,1,4,0)
to the HDR (Health Data Repository) and with some lab orders
"PKG",26,22,1,"PAH",1,1,5,0)
that have the wrong status in file #100 (ORDER).
"PKG",26,22,1,"PAH",1,1,6,0)
 
"PKG",26,22,1,"PAH",1,1,7,0)
ASSOCIATED REMEDY TICKET:
"PKG",26,22,1,"PAH",1,1,8,0)
========================
"PKG",26,22,1,"PAH",1,1,9,0)
1. INC000001243211  -  Failure of merged lab collect orders
"PKG",26,22,1,"PAH",1,1,10,0)
                       to transmit to HDR
"PKG",26,22,1,"PAH",1,1,11,0)
 
"PKG",26,22,1,"PAH",1,1,12,0)
 
"PKG",26,22,1,"PAH",1,1,13,0)
2. INC000000775621  -  Lab order merging leads to incorrect
"PKG",26,22,1,"PAH",1,1,14,0)
                       status of file 100 orders
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LR7OB1")
0^1^B16381843^B14695153
"RTN","LR7OB1",1,0)
LR7OB1 ;slc/dcm - Build message, backdoor Lab from file 69 ; 5/12/16 4:33pm
"RTN","LR7OB1",2,0)
 ;;5.2;LAB SERVICE;**121,187,238,470**;Sep 27, 1994;Build 1
"RTN","LR7OB1",3,0)
 ;
"RTN","LR7OB1",4,0)
NEW(ODT,SN,CONTROL,NAT,TESTS,LRSTATI) ;Set-up order message
"RTN","LR7OB1",5,0)
 ;Need ODT & SN of entry in ^LRO(69,ODT,1,SN)
"RTN","LR7OB1",6,0)
 ;CONTROL=Order Control (SN=new order)
"RTN","LR7OB1",7,0)
 ;NAT=Nature of order
"RTN","LR7OB1",8,0)
 ;TESTS=Array of tests to be updated (optional). If this array is not included then all tests for the LRSN entry will be updated/included
"RTN","LR7OB1",9,0)
 ;LRSTATI=Status of order (ptr to ^ORD(100.01,IFN))
"RTN","LR7OB1",10,0)
 Q:'$L($T(MSG^XQOR))
"RTN","LR7OB1",11,0)
 Q:'$D(^LRO(69,$G(ODT),1,$G(SN),0))  N LRX0 S LRX0=^(0)
"RTN","LR7OB1",12,0)
 I $$VER^LR7OU1>2.5,'$G(^ORD(100.99,1,"CONV")) N Y,DFN,LRDPF S Y=$G(^LR(+LRX0,0)),DFN=$P(Y,"^",3),LRDPF=$P(Y,"^",2)_$G(^DIC(+$P(Y,"^",2),0,"GL")) D
"RTN","LR7OB1",13,0)
 . Q:'$D(^ORD(100.99,1,"PTCONV",DFN))
"RTN","LR7OB1",14,0)
 . S $P(^LRO(69,ODT,1,SN,0),"^",11)=1 ;Keeps this order from being converted
"RTN","LR7OB1",15,0)
 . D EN^LR7OV2(DFN_";"_$P(LRDPF,"^",2),1)
"RTN","LR7OB1",16,0)
 Q:$P($G(^LR(+LRX0,0)),"^",2)'=2  ;Only allow messages for patients (file 2)
"RTN","LR7OB1",17,0)
 N MSG,ORCHMSG,ORBBMSG,ORAPMSG,I,LRNIFN,LRTMPO
"RTN","LR7OB1",18,0)
 K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J)
"RTN","LR7OB1",19,0)
 D ORD1(ODT,SN,.TESTS)
"RTN","LR7OB1",20,0)
 I '$D(LRTMPO("LRIFN")) D EN1^LR7OB0(ODT,SN,CONTROL,$G(NAT)),CALL(CONTROL) K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J) Q
"RTN","LR7OB1",21,0)
 S LRNIFN=0 F  S LRNIFN=$O(LRTMPO("LRIFN",LRNIFN)) Q:LRNIFN<1  S X=LRTMPO("LRIFN",LRNIFN) D
"RTN","LR7OB1",22,0)
 . I $P(X,"^",7)="P" Q  ;Test purged from CPRS
"RTN","LR7OB1",23,0)
 . I $L($P(X,"^",14)),'$$TWOORIFN() N ODT,SN D  Q
"RTN","LR7OB1",24,0)
 .. S ODT=+$P(X,"^",14),SN=$P($P(X,"^",14),";",2)
"RTN","LR7OB1",25,0)
 .. I $D(^LRO(69,+ODT,1,+SN,0)) S:CONTROL="RE" LRSTATI=2 D EN1^LR7OB0(ODT,SN,CONTROL,$G(NAT)),CALL(CONTROL) K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J)
"RTN","LR7OB1",26,0)
 . D EN1^LR7OB0(ODT,SN,CONTROL,$G(NAT)),CALL(CONTROL) K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J)
"RTN","LR7OB1",27,0)
 Q
"RTN","LR7OB1",28,0)
CALL(CNTRL) ;Make protocol calls
"RTN","LR7OB1",29,0)
 Q:'$L($T(MSG^XQOR))
"RTN","LR7OB1",30,0)
 S:'$D(CNTRL) CNTRL=""
"RTN","LR7OB1",31,0)
 I $D(^TMP("LRCH",$J)) S ORCHMSG="^TMP(""LRCH"",$J)" D MSG^XQOR("LR7O CH EVSEND OR",.ORCHMSG),RESULTS(ORCHMSG,CNTRL) ;Message from lab
"RTN","LR7OB1",32,0)
 I $D(^TMP("LRBB",$J)) S ORBBMSG="^TMP(""LRBB"",$J)" D MSG^XQOR("LR7O BB EVSEND OR",.ORBBMSG),RESULTS(ORBBMSG,CNTRL) ;New order from Blood bank
"RTN","LR7OB1",33,0)
 I $D(^TMP("LRAP",$J)) S ORAPMSG="^TMP(""LRAP"",$J)" D MSG^XQOR("LR7O AP EVSEND OR",.ORAPMSG),RESULTS(ORAPMSG,CNTRL) ;New order from Anatomic Path
"RTN","LR7OB1",34,0)
 Q
"RTN","LR7OB1",35,0)
RESULTS(OREMSG,CNTRL) ;Results only protocol
"RTN","LR7OB1",36,0)
 Q:$G(CNTRL)'="RE"  Q:'$D(OREMSG)
"RTN","LR7OB1",37,0)
 D MSG^XQOR("LR7O ALL EVSEND RESULTS",.OREMSG)
"RTN","LR7OB1",38,0)
 Q
"RTN","LR7OB1",39,0)
ACC(AC,ACDT,ACN,CONTROL,NAT) ;Set-up order message for BB,SP,EM,CY,AU accessions
"RTN","LR7OB1",40,0)
 ;ACC=Accession area ptr
"RTN","LR7OB1",41,0)
 ;ACDT=Accession Date
"RTN","LR7OB1",42,0)
 ;ACN=Accession #
"RTN","LR7OB1",43,0)
 Q:'$L($T(MSG^XQOR))
"RTN","LR7OB1",44,0)
 N MSG,CHMSG,BBMSG,APMSG
"RTN","LR7OB1",45,0)
 K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J)
"RTN","LR7OB1",46,0)
 D EN2^LR7OB0(AC,ACDT,ACN,CONTROL,.CHMSG,.BBMSG,.APMSG,$G(NAT))
"RTN","LR7OB1",47,0)
 D CALL(CONTROL)
"RTN","LR7OB1",48,0)
 K ^TMP("LRAP",$J),^TMP("LRCH",$J),^TMP("LRBB",$J)
"RTN","LR7OB1",49,0)
 Q
"RTN","LR7OB1",50,0)
ORD(ORD) ;Set test nodes in LRTMPO("LRIFN" for given Lab #
"RTN","LR7OB1",51,0)
 ;ORD=Lab order #
"RTN","LR7OB1",52,0)
 Q:'$G(ORD)  I $D(LRTMPO("LRIFN")) K LRTMPO("LRIFN")
"RTN","LR7OB1",53,0)
 N IFN,ODT,SN,X
"RTN","LR7OB1",54,0)
 S (CTR,ODT)=0
"RTN","LR7OB1",55,0)
 F  S ODT=$O(^LRO(69,"C",ORD,ODT)) Q:ODT<1  S SN=0 F  S SN=$O(^LRO(69,"C",ORD,ODT,SN)) Q:SN<1  S IFN=0 F  S IFN=$O(^LRO(69,ODT,1,SN,2,IFN)) Q:IFN<1  S X=$G(^(IFN,0)) I X D
"RTN","LR7OB1",56,0)
 . S CTR=CTR+1,LRTMPO("LRIFN",CTR)=X
"RTN","LR7OB1",57,0)
 Q
"RTN","LR7OB1",58,0)
ORD1(ODT,SN,TST) ;Set test nodes in LRTMPO("LRIFN"  for given LRODT & LRSN (includes combined tests)
"RTN","LR7OB1",59,0)
 ;ODT=LRODT
"RTN","LR7OB1",60,0)
 ;SN=LRSN
"RTN","LR7OB1",61,0)
 ; TST=Array of tests to be included (optional).  If TST is not passed, then all tests for a given LRSN will be included
"RTN","LR7OB1",62,0)
 ; Screen out orders with ORIFN if CONTROL=SN (new order)
"RTN","LR7OB1",63,0)
 Q:'$G(ODT)  Q:'$G(SN)  I $D(LRTMPO("LRIFN")) K LRTMPO("LRIFN")
"RTN","LR7OB1",64,0)
 N IFN,X,CTR
"RTN","LR7OB1",65,0)
 S (CTR,IFN)=0
"RTN","LR7OB1",66,0)
 F  S IFN=$O(^LRO(69,ODT,1,SN,2,IFN)) Q:IFN<1  S X=$G(^(IFN,0)) I X D
"RTN","LR7OB1",67,0)
 . I CONTROL="SN",$P(X,"^",7) S LRTMPO("LRIFN")="" Q  ;Don't send a SN for existing order
"RTN","LR7OB1",68,0)
 . I $S($O(TST(0)):$D(TST(+X)),1:1) S CTR=CTR+1,LRTMPO("LRIFN",CTR)=X D  Q
"RTN","LR7OB1",69,0)
 .. I $P(X,"^",14),'$$TWOORIFN() S X=$P(X,"^",14) D
"RTN","LR7OB1",70,0)
 ... I $D(^LRO(69,+X,1,+$P(X,";",2),2,+$P(X,";",3),0)) S X=^(0),CTR=CTR+1,LRTMPO("LRIFN",CTR)=X
"RTN","LR7OB1",71,0)
 Q
"RTN","LR7OB1",72,0)
TWOORIFN() ;
"RTN","LR7OB1",73,0)
 ; function to determine if a merged test has 2 different
"RTN","LR7OB1",74,0)
 ; file 100 order numbers
"RTN","LR7OB1",75,0)
 ;
"RTN","LR7OB1",76,0)
 ;  returns:
"RTN","LR7OB1",77,0)
 ;       0 - test has only 1 file 100 order number
"RTN","LR7OB1",78,0)
 ;       1 - test has more than 1 file 100 order numbers
"RTN","LR7OB1",79,0)
 ;
"RTN","LR7OB1",80,0)
 N ODT,SN,IFN,LRX
"RTN","LR7OB1",81,0)
 S LRX=$P(X,"^",14),ODT=$P(LRX,";",1),SN=$P(LRX,";",2),IFN=$P(LRX,";",3)
"RTN","LR7OB1",82,0)
 ;
"RTN","LR7OB1",83,0)
 I ODT=""!(SN="")!(IFN="") Q 0
"RTN","LR7OB1",84,0)
 ;
"RTN","LR7OB1",85,0)
 S LRX=$G(^LRO(69,ODT,1,SN,2,IFN,0))
"RTN","LR7OB1",86,0)
 I LRX="" Q 0
"RTN","LR7OB1",87,0)
 ;
"RTN","LR7OB1",88,0)
 I $P(X,"^",7)'="",$P(LRX,"^",7)'="",$P(X,"^",7)'=$P(LRX,"^",7) Q 1
"RTN","LR7OB1",89,0)
 ;
"RTN","LR7OB1",90,0)
 Q 0
"VER")
8.0^22.0
"BLD",10374,6)
^382
**END**
**END**

