Released LR*5.2*459 SEQ #364
Extracted from mail message
**KIDS**:LR*5.2*459^

**INSTALL NAME**
LR*5.2*459
"BLD",9959,0)
LR*5.2*459^LAB SERVICE^0^3150528^y
"BLD",9959,1,0)
^^5^5^3150528^^
"BLD",9959,1,1,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"BLD",9959,1,2,0)
 
"BLD",9959,1,3,0)
1.      Lab results search routine expands start/end search times.
"BLD",9959,1,4,0)
 
"BLD",9959,1,5,0)
2.      QC labels print with accession labels.
"BLD",9959,4,0)
^9.64PA^^
"BLD",9959,6.3)
1
"BLD",9959,"ABPKG")
n
"BLD",9959,"KRN",0)
^9.67PA^779.2^20
"BLD",9959,"KRN",.4,0)
.4
"BLD",9959,"KRN",.401,0)
.401
"BLD",9959,"KRN",.402,0)
.402
"BLD",9959,"KRN",.403,0)
.403
"BLD",9959,"KRN",.5,0)
.5
"BLD",9959,"KRN",.84,0)
.84
"BLD",9959,"KRN",3.6,0)
3.6
"BLD",9959,"KRN",3.8,0)
3.8
"BLD",9959,"KRN",9.2,0)
9.2
"BLD",9959,"KRN",9.8,0)
9.8
"BLD",9959,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9959,"KRN",9.8,"NM",1,0)
LR7OR1^^0^B34879723
"BLD",9959,"KRN",9.8,"NM",2,0)
LRLL4^^0^B4086909
"BLD",9959,"KRN",9.8,"NM","B","LR7OR1",1)

"BLD",9959,"KRN",9.8,"NM","B","LRLL4",2)

"BLD",9959,"KRN",19,0)
19
"BLD",9959,"KRN",19.1,0)
19.1
"BLD",9959,"KRN",101,0)
101
"BLD",9959,"KRN",409.61,0)
409.61
"BLD",9959,"KRN",771,0)
771
"BLD",9959,"KRN",779.2,0)
779.2
"BLD",9959,"KRN",870,0)
870
"BLD",9959,"KRN",8989.51,0)
8989.51
"BLD",9959,"KRN",8989.52,0)
8989.52
"BLD",9959,"KRN",8994,0)
8994
"BLD",9959,"KRN","B",.4,.4)

"BLD",9959,"KRN","B",.401,.401)

"BLD",9959,"KRN","B",.402,.402)

"BLD",9959,"KRN","B",.403,.403)

"BLD",9959,"KRN","B",.5,.5)

"BLD",9959,"KRN","B",.84,.84)

"BLD",9959,"KRN","B",3.6,3.6)

"BLD",9959,"KRN","B",3.8,3.8)

"BLD",9959,"KRN","B",9.2,9.2)

"BLD",9959,"KRN","B",9.8,9.8)

"BLD",9959,"KRN","B",19,19)

"BLD",9959,"KRN","B",19.1,19.1)

"BLD",9959,"KRN","B",101,101)

"BLD",9959,"KRN","B",409.61,409.61)

"BLD",9959,"KRN","B",771,771)

"BLD",9959,"KRN","B",779.2,779.2)

"BLD",9959,"KRN","B",870,870)

"BLD",9959,"KRN","B",8989.51,8989.51)

"BLD",9959,"KRN","B",8989.52,8989.52)

"BLD",9959,"KRN","B",8994,8994)

"BLD",9959,"QUES",0)
^9.62^^
"BLD",9959,"REQB",0)
^9.611^1^1
"BLD",9959,"REQB",1,0)
LR*5.2*427^2
"BLD",9959,"REQB","B","LR*5.2*427",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
459^3150528
"PKG",26,22,1,"PAH",1,1,0)
^^5^5^3150528
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1.      Lab results search routine expands start/end search times.
"PKG",26,22,1,"PAH",1,1,4,0)
 
"PKG",26,22,1,"PAH",1,1,5,0)
2.      QC labels print with accession labels.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LR7OR1")
0^1^B34879723^B35364190
"RTN","LR7OR1",1,0)
LR7OR1 ;DALIO/JMC - Get Lab results ;03/13/13  09:08
"RTN","LR7OR1",2,0)
 ;;5.2;LAB SERVICE;**121,187,219,230,256,310,340,348,350,427,459**;Sep 27, 1994;Build 1
"RTN","LR7OR1",3,0)
 ;
"RTN","LR7OR1",4,0)
RR(DFN,ORD,SDATE,EDATE,SUB,TEST,FLAG,COUNT,SPEC,UNVER) ;Get LAB results for patient
"RTN","LR7OR1",5,0)
 ;DFN = Patient DFN, ptr to file 2 (Required)
"RTN","LR7OR1",6,0)
 ;ORD = Lab Link from OE/RR (ORPK node) (Optional)
"RTN","LR7OR1",7,0)
 ;SDATE = start date to begin search in fileman format (Optional)
"RTN","LR7OR1",8,0)
 ;EDATE = end date to end search in fileman format (Optional)
"RTN","LR7OR1",9,0)
 ;SUB =set to CH,MI,AP or ALL to specify lab (Optional)
"RTN","LR7OR1",10,0)
 ;    subsection. A null entry will imply ALL.
"RTN","LR7OR1",11,0)
 ;TEST = Test to do lookup on (Optional). A null parameter will get all tests
"RTN","LR7OR1",12,0)
 ;FLAG = L for local test ID, N for National test ID (Optional)
"RTN","LR7OR1",13,0)
 ;    this is specified for both input and output
"RTN","LR7OR1",14,0)
 ;COUNT =Count of results to return. Each Date/time counts as 1 (optional)
"RTN","LR7OR1",15,0)
 ;SPEC =ptr file 61 to specify specimen (optional).
"RTN","LR7OR1",16,0)
 ;      If specified, no AP results are returned.
"RTN","LR7OR1",17,0)
 ;UNVER =1 to include unverified data
"RTN","LR7OR1",18,0)
 ;Output is set in ^TMP("LRRR",$J,dfn,subscript,inverse d/t,seq)=
"RTN","LR7OR1",19,0)
 ; testID^result^flag^units^refrange^resultstatus(F or P)^^^natlCode^natlName^system^Verifyby^^Theraputicflag(T or "")^PrintName^Accession^Order#^Specimen
"RTN","LR7OR1",20,0)
 ;
"RTN","LR7OR1",21,0)
 N LRDFN,LRDPF,SEX,AGE,DOB,ORDT,ORSN,II,III,DRAW,TSTY,SS,CT1
"RTN","LR7OR1",22,0)
 ;
"RTN","LR7OR1",23,0)
 Q:'$G(DFN)
"RTN","LR7OR1",24,0)
 S LRDFN=$$LRDFN(DFN),LRDPF="2^DPT("
"RTN","LR7OR1",25,0)
 Q:'LRDFN
"RTN","LR7OR1",26,0)
 ;
"RTN","LR7OR1",27,0)
 S SEX=$P($G(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")),"^",2)
"RTN","LR7OR1",28,0)
 S DOB=$P($G(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")),"^",3),AGE=$S($D(DT)&(DOB?7N):DT-DOB\10000,1:"??")
"RTN","LR7OR1",29,0)
 D DTRNG
"RTN","LR7OR1",30,0)
 S SUB=$S($G(SUB)="ALL":"CHMIAP",$L($G(SUB)):SUB,1:"CHMIAP"),FLAG=$S('$L($G(FLAG)):"L",1:FLAG)
"RTN","LR7OR1",31,0)
 ;
"RTN","LR7OR1",32,0)
 I $G(TEST),FLAG="L",'$D(^LAB(60,TEST)) Q  ;No-Match on Local testID
"RTN","LR7OR1",33,0)
 I $G(TEST),FLAG="N" S TEST=$O(^LAB(60,"AC",TEST,0)) Q:'TEST  ;No-Match on National testID
"RTN","LR7OR1",34,0)
 I $G(TEST) S SUB=$P(^LAB(60,TEST,0),"^",4) Q:'$L(SUB)  ;Test with no subscript
"RTN","LR7OR1",35,0)
 ;
"RTN","LR7OR1",36,0)
 K ^TMP("LRRR",$J),^TMP("LRAPI",$J)
"RTN","LR7OR1",37,0)
 ;
"RTN","LR7OR1",38,0)
 S COUNT=$S($G(COUNT):COUNT,1:9999999),CT1=1
"RTN","LR7OR1",39,0)
 ;
"RTN","LR7OR1",40,0)
 I $G(ORD) S ORDT=0 D  Q
"RTN","LR7OR1",41,0)
 . I $G(TEST) Q:'$D(^LAB(60,TEST,0))  S X=^(0) I $P(X,"^",4)="CH" D
"RTN","LR7OR1",42,0)
 . . I $P(X,"^",5)'="" S TSTY($P($P(X,"^",5),";",2))=TEST
"RTN","LR7OR1",43,0)
 . . I $P(X,"^",5)="" D EN^LR7OU1(TEST)
"RTN","LR7OR1",44,0)
 . I ORD["^" S ORDT=$P(ORD,"^"),ORSN=$P(ORD,"^",2) I ORDT,ORSN D SN Q  ;OE/RR 2.5 unconverted orders
"RTN","LR7OR1",45,0)
 . I ORD'[";" F  S ORDT=$O(^LRO(69,"C",ORD,ORDT)) Q:ORDT<1  S ORSN=0 F  S ORSN=$O(^LRO(69,"C",ORD,ORDT,ORSN)) Q:ORSN<1  D SN ;Early CPRS when only LR# stored
"RTN","LR7OR1",46,0)
 . I ORD[";" S ORDT=$P(ORD,";",2),ORSN=$P(ORD,";",3) I ORDT,ORSN D SN
"RTN","LR7OR1",47,0)
 I SUB["CH" D CH^LR7OR2(SDATE,EDATE,$G(TEST),COUNT,$G(SPEC),$G(UNVER))
"RTN","LR7OR1",48,0)
 I SUB["MI" D MI(SDATE,EDATE,COUNT,$G(SPEC))
"RTN","LR7OR1",49,0)
 ;I SUB["BB" D BB(SDATE,EDATE,COUNT,$G(SPEC))
"RTN","LR7OR1",50,0)
 I SUB["AP",'$G(SPEC) D AP(SDATE,EDATE,COUNT)
"RTN","LR7OR1",51,0)
 Q
"RTN","LR7OR1",52,0)
 ;
"RTN","LR7OR1",53,0)
 ;
"RTN","LR7OR1",54,0)
MI(SDATE,EDATE,COUNT,SPEC) ;Get MI Subscript data
"RTN","LR7OR1",55,0)
 Q:'$D(SDATE)  Q:'$D(EDATE)  Q:'$D(COUNT)  Q:'$D(CT1)
"RTN","LR7OR1",56,0)
 K ^TMP("LRX",$J)
"RTN","LR7OR1",57,0)
 S IVDT=SDATE F  S IVDT=$O(^LR(LRDFN,"MI",IVDT)) Q:IVDT<1!(IVDT>EDATE)!(CT1>COUNT)  K LRX S CTR=99,CT1=CT1+1 D MI^LR7OB63A(SPEC) M ^TMP("LRRR",$J,DFN,"MI",IVDT)=^TMP("LRX",$J,69,99,63)
"RTN","LR7OR1",58,0)
 K ^TMP("LRX",$J)
"RTN","LR7OR1",59,0)
 Q
"RTN","LR7OR1",60,0)
 ;
"RTN","LR7OR1",61,0)
 ;
"RTN","LR7OR1",62,0)
BB(SDATE,EDATE,COUNT,SPEC) ;Get BB Subscript data
"RTN","LR7OR1",63,0)
 Q
"RTN","LR7OR1",64,0)
 Q:'$D(SDATE)  Q:'$D(EDATE)  Q:'$D(COUNT)  Q:'$D(CT1)
"RTN","LR7OR1",65,0)
 K ^TMP("LRX",$J)
"RTN","LR7OR1",66,0)
 S IVDT=SDATE F  S IVDT=$O(^LR(LRDFN,"BB",IVDT)) Q:IVDT<1!(IVDT>EDATE)!(CT1>COUNT)  K LRX S CTR=99,CT1=CT1+1 D BB1^LR7OB63(SPEC) M ^TMP("LRRR",$J,DFN,"BB",IVDT)=^TMP("LRX",$J,69,99,63)
"RTN","LR7OR1",67,0)
 K ^TMP("LRX",$J)
"RTN","LR7OR1",68,0)
 Q
"RTN","LR7OR1",69,0)
 ;
"RTN","LR7OR1",70,0)
 ;
"RTN","LR7OR1",71,0)
AP(SDATE,EDATE,COUNT) ;Get AP Subscript data (EM,CY,AU,SP)
"RTN","LR7OR1",72,0)
 N LRSS K ^TMP("LRX",$J)
"RTN","LR7OR1",73,0)
 Q:'$D(SDATE)  Q:'$D(EDATE)  Q:'$D(COUNT)  Q:'$D(CT1)
"RTN","LR7OR1",74,0)
 S CTR=99 D AU^LR7OB63D M ^TMP("LRRR",$J,DFN,"AU")=^TMP("LRX",$J,69,99,63)
"RTN","LR7OR1",75,0)
 F LRSS="EM","CY","SP" S IVDT=SDATE F  S IVDT=$O(^LR(LRDFN,LRSS,IVDT)) Q:IVDT<1!(IVDT>EDATE)!(CT1>COUNT)  K LRX S CTR=99,CT1=CT1+1 D SS^LR7OB63C(LRSS) M ^TMP("LRRR",$J,DFN,LRSS,IVDT)=^TMP("LRX",$J,69,99,63)
"RTN","LR7OR1",76,0)
 K ^TMP("LRX",$J)
"RTN","LR7OR1",77,0)
 Q
"RTN","LR7OR1",78,0)
 ;
"RTN","LR7OR1",79,0)
 ;
"RTN","LR7OR1",80,0)
TEST ;Test the RR entry point
"RTN","LR7OR1",81,0)
 N X1,X2,X3,X4,X5,DIC,%DT,X,Y
"RTN","LR7OR1",82,0)
 K ^TMP("LRRR",$J),^TMP("LRAPI",$J) S (X1,X2,X3,X4,X5)=""
"RTN","LR7OR1",83,0)
 D ^LRDPA Q:'DFN
"RTN","LR7OR1",84,0)
O1 W !,"Select Lab Order #: " R X:DTIME Q:'$T!(X["^")
"RTN","LR7OR1",85,0)
 I $L(X),'$D(^LRO(69,"C",X)) W !!,X_" is not a valid order number." G O1
"RTN","LR7OR1",86,0)
 I $L(X),$D(^LRO(69,"C",X)) S X5=X,DIC=60,DIC(0)="AEQM",DIC("A")="Select Test (optional): " D ^DIC S X3=$S(Y>0:+Y,1:"") Q:Y<0&(X["^")  G T2
"RTN","LR7OR1",87,0)
 S %DT="AETS",%DT("A")="Select Start Date: " D ^%DT S X1=$S(Y>0:Y,1:"") I Y<0,X["^" Q
"RTN","LR7OR1",88,0)
 S %DT="AETS",%DT("A")="Select End Date: " D ^%DT S X2=$S(Y>0:Y,1:"") I Y<0,X["^" Q
"RTN","LR7OR1",89,0)
 S DIC=60,DIC(0)="AEQM",DIC("A")="Look for specific Test: " D ^DIC S X3=$S(Y>0:+Y,1:"") I Y<0,X["^" Q
"RTN","LR7OR1",90,0)
 I 'X3 D
"RTN","LR7OR1",91,0)
T1 . W !,"Enter a lab area to search on (ALL,CH,MI,AP): " R X:DTIME Q:'$T!(X["^")
"RTN","LR7OR1",92,0)
 . IF "ALLCHMIAP"'[X W !!,"Bad input, enter ALL, CH, MI, or AP" G T1
"RTN","LR7OR1",93,0)
 . S X4=$S("ALLCHMIAP"[X:X,1:"")
"RTN","LR7OR1",94,0)
T2 D RR(DFN,X5,X1,X2,X4,X3)
"RTN","LR7OR1",95,0)
 W !!,$S($D(^TMP("LRRR",$J)):"Data found!",1:"NO Data found!")
"RTN","LR7OR1",96,0)
 Q
"RTN","LR7OR1",97,0)
 ;
"RTN","LR7OR1",98,0)
 ;
"RTN","LR7OR1",99,0)
DTRNG ; Date range setup
"RTN","LR7OR1",100,0)
 I $G(EDATE)<$G(SDATE) S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","LR7OR1",101,0)
 I $G(EDATE) S EDATE=$S($L(EDATE,".")=2:EDATE+.000001,1:EDATE+1)
"RTN","LR7OR1",102,0)
 ;I $G(SDATE) S SDATE=$S($L(SDATE,".")=2:SDATE-.000001,1:SDATE)
"RTN","LR7OR1",103,0)
 S SDATE=$S($G(SDATE):9999999-SDATE,1:9999999),EDATE=$S($G(EDATE):9999999-EDATE,1:1)
"RTN","LR7OR1",104,0)
 S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","LR7OR1",105,0)
 Q
"RTN","LR7OR1",106,0)
 ;
"RTN","LR7OR1",107,0)
 ;
"RTN","LR7OR1",108,0)
SN ; Get the subs
"RTN","LR7OR1",109,0)
 ;
"RTN","LR7OR1",110,0)
 N I,II,III,LRPLSAVE
"RTN","LR7OR1",111,0)
 ;
"RTN","LR7OR1",112,0)
 ; Set flag to not print performing lab in called routines, wait for control returns to this routine.
"RTN","LR7OR1",113,0)
 S LRPLSAVE=1
"RTN","LR7OR1",114,0)
 ;
"RTN","LR7OR1",115,0)
 D 69^LR7OB69(ORDT,ORSN) Q:'$D(^TMP("LRX",$J,69))
"RTN","LR7OR1",116,0)
 ;
"RTN","LR7OR1",117,0)
 ; List performing laboratories
"RTN","LR7OR1",118,0)
 I $G(LRPLSAVE(0)) D
"RTN","LR7OR1",119,0)
 . N CTR,IVDT
"RTN","LR7OR1",120,0)
 . S CTR=LRPLSAVE(0),IVDT=0
"RTN","LR7OR1",121,0)
 . F  S IVDT=$O(LRPLSAVE("CH",IVDT)) Q:IVDT<1  D
"RTN","LR7OR1",122,0)
 . . D PLS^LR7OB63
"RTN","LR7OR1",123,0)
 ;
"RTN","LR7OR1",124,0)
 S II=0
"RTN","LR7OR1",125,0)
 F  S II=$O(^TMP("LRX",$J,69,II)) Q:II<1  D
"RTN","LR7OR1",126,0)
 . S DRAW=$P($G(^TMP("LRX",$J,69,II,68)),"^",4),SS=$P($G(^LRO(68,+$P(^TMP("LRX",$J,69,II),"^",4),0)),"^",2)
"RTN","LR7OR1",127,0)
 . S III=0
"RTN","LR7OR1",128,0)
 . F  S III=$O(^TMP("LRX",$J,69,II,63,III)) Q:III<1  I $S($D(TSTY):$D(TSTY(III)),1:1) D
"RTN","LR7OR1",129,0)
 . . I $P(^TMP("LRX",$J,69,II,63,III),U,6)="" Q
"RTN","LR7OR1",130,0)
 . . S I=III
"RTN","LR7OR1",131,0)
 . . I $D(^TMP("LRRR",$J,DFN,SS,9999999-DRAW,I)) F  S I=I+.00000001 I '$D(^TMP("LRRR",$J,DFN,SS,9999999-DRAW,I)) Q
"RTN","LR7OR1",132,0)
 . . S ^TMP("LRRR",$J,DFN,SS,9999999-DRAW,I)=^TMP("LRX",$J,69,II,63,III)
"RTN","LR7OR1",133,0)
 . I $D(^TMP("LRX",$J,69,II,63,"N")),$O(^TMP("LRRR",$J,DFN,SS,9999999-DRAW,0)) M ^TMP("LRRR",$J,DFN,SS,9999999-DRAW,"N")=^TMP("LRX",$J,69,II,63,"N")
"RTN","LR7OR1",134,0)
 ;
"RTN","LR7OR1",135,0)
 F I="LRPLS","LRPLS-ADDR" K ^TMP(I,$J)
"RTN","LR7OR1",136,0)
 ;
"RTN","LR7OR1",137,0)
 Q
"RTN","LR7OR1",138,0)
 ;
"RTN","LR7OR1",139,0)
 ;
"RTN","LR7OR1",140,0)
LRDFN(IFN,FILEROOT)  ;Get LRDFN
"RTN","LR7OR1",141,0)
 ; IFN=Internal file number
"RTN","LR7OR1",142,0)
 ; FILEROOT=Root of file to get LRDFN (optional) "DPT(" is default
"RTN","LR7OR1",143,0)
 Q:'$G(IFN) ""
"RTN","LR7OR1",144,0)
 I '$L($G(FILEROOT)) S FILEROOT="DPT("
"RTN","LR7OR1",145,0)
 S X=$S($D(@("^"_FILEROOT_+IFN_",""LR"")")):+^("LR"),1:"")
"RTN","LR7OR1",146,0)
 I X,'$D(^LR(X,0)) S X=""
"RTN","LR7OR1",147,0)
 Q X
"RTN","LRLL4")
0^2^B4086909^B4030286
"RTN","LRLL4",1,0)
LRLL4 ;SLC/RWF - LOAD LIST BUILD, CONT. (Control's) ;2/6/91  07:44 ;
"RTN","LRLL4",2,0)
 ;;5.2;LAB SERVICE;**459**;Sep 27, 1994;Build 1
"RTN","LRLL4",3,0)
CONTROL ;from LRLL2
"RTN","LRLL4",4,0)
 S LRIFN=+LRCTRL(LRTRAY,LRCUP),LRTST=$P(LRCTRL(LRTRAY,LRCUP),U,2,99)
"RTN","LRLL4",5,0)
LRCTRL ;from LRLL1, LRLL2
"RTN","LRLL4",6,0)
 N LRLBL
"RTN","LRLL4",7,0)
 S LRPWL=LRAA,LRPWDT=LRAD,LRPWLE=LRAN,LRODT=DT,LRNOLABL=1,LRSTART=LRST D LOAD^LRCONJAM S LRST=LRSTART
"RTN","LRLL4",8,0)
 I '$D(^LRO(69,DT,1,LRSN,0)) W !,"CONTROL FAILED TO ADD" Q
"RTN","LRLL4",9,0)
 S I=$O(^LRO(69,DT,1,LRSN,2,0)) Q:I<1  S X=^(I,0),LRAD=$P(X,U,3),LRAA=$P(X,U,4),LRAN=$P(X,U,5)
"RTN","LRLL4",10,0)
 S ^TMP($J,LRTRAY,LRCUP)=LRAA_U_LRAD_U_LRAN_U_LRPROF_U_62.3 S I=0 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<1  S $P(^(I,0),U,3)=1,^TMP($J,LRTRAY,LRCUP,I)=^(0)
"RTN","LRLL4",11,0)
 S LRAA=LRPWL,LRAD=LRPWDT,LRAN=LRPWLE K LRPWL,LRPWDT,LRPWLE,LRSN W "#" Q
"RTN","LRLL4",12,0)
AC S LRTK=LRSTAR-.00001 F  S LRTK=$O(^LRO(68,LRAA,1,LRAD,1,"E",LRTK)) Q:LRTK<1!(+LRLST>1&(LRTK\1>+LRLST))  D AC1
"RTN","LRLL4",13,0)
 Q
"RTN","LRLL4",14,0)
AC1 S LRAN=0 F  S LRAN=$O(^LRO(68,LRAA,1,LRAD,1,"E",LRTK,LRAN)) Q:LRAN<1  I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2 S LRADD=1,LRDFN=+^(0),LRDPF=$P(^(0),U,2),LRIDT=9999999-$S($D(^(3)):^(3),1:0) D TCHK^LRLL2
"RTN","LRLL4",15,0)
 Q
"VER")
8.0^22.0
"BLD",9959,6)
^364
**END**
**END**

