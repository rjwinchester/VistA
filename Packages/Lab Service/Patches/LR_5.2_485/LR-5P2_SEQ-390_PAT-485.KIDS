Released LR*5.2*485 SEQ #390
Extracted from mail message
**KIDS**:LR*5.2*485^

**INSTALL NAME**
LR*5.2*485
"BLD",10522,0)
LR*5.2*485^LAB SERVICE^0^3170426^y
"BLD",10522,1,0)
^^4^4^3170426^
"BLD",10522,1,1,0)
This patch addresses one (1) VistA Laboratory Anatomic Pathology issue:
"BLD",10522,1,2,0)
 
"BLD",10522,1,3,0)
I13556053FY17: Multiple orders associated with one Anatomic Pathology
"BLD",10522,1,4,0)
               accession
"BLD",10522,4,0)
^9.64PA^^
"BLD",10522,6.3)
1
"BLD",10522,"ABPKG")
n
"BLD",10522,"KRN",0)
^9.67PA^779.2^20
"BLD",10522,"KRN",.4,0)
.4
"BLD",10522,"KRN",.401,0)
.401
"BLD",10522,"KRN",.402,0)
.402
"BLD",10522,"KRN",.403,0)
.403
"BLD",10522,"KRN",.5,0)
.5
"BLD",10522,"KRN",.84,0)
.84
"BLD",10522,"KRN",3.6,0)
3.6
"BLD",10522,"KRN",3.8,0)
3.8
"BLD",10522,"KRN",9.2,0)
9.2
"BLD",10522,"KRN",9.8,0)
9.8
"BLD",10522,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10522,"KRN",9.8,"NM",1,0)
LRAPLG1^^0^B185001955
"BLD",10522,"KRN",9.8,"NM","B","LRAPLG1",1)

"BLD",10522,"KRN",19,0)
19
"BLD",10522,"KRN",19.1,0)
19.1
"BLD",10522,"KRN",101,0)
101
"BLD",10522,"KRN",409.61,0)
409.61
"BLD",10522,"KRN",771,0)
771
"BLD",10522,"KRN",779.2,0)
779.2
"BLD",10522,"KRN",870,0)
870
"BLD",10522,"KRN",8989.51,0)
8989.51
"BLD",10522,"KRN",8989.52,0)
8989.52
"BLD",10522,"KRN",8994,0)
8994
"BLD",10522,"KRN","B",.4,.4)

"BLD",10522,"KRN","B",.401,.401)

"BLD",10522,"KRN","B",.402,.402)

"BLD",10522,"KRN","B",.403,.403)

"BLD",10522,"KRN","B",.5,.5)

"BLD",10522,"KRN","B",.84,.84)

"BLD",10522,"KRN","B",3.6,3.6)

"BLD",10522,"KRN","B",3.8,3.8)

"BLD",10522,"KRN","B",9.2,9.2)

"BLD",10522,"KRN","B",9.8,9.8)

"BLD",10522,"KRN","B",19,19)

"BLD",10522,"KRN","B",19.1,19.1)

"BLD",10522,"KRN","B",101,101)

"BLD",10522,"KRN","B",409.61,409.61)

"BLD",10522,"KRN","B",771,771)

"BLD",10522,"KRN","B",779.2,779.2)

"BLD",10522,"KRN","B",870,870)

"BLD",10522,"KRN","B",8989.51,8989.51)

"BLD",10522,"KRN","B",8989.52,8989.52)

"BLD",10522,"KRN","B",8994,8994)

"BLD",10522,"QUES",0)
^9.62^^
"BLD",10522,"REQB",0)
^9.611^1^1
"BLD",10522,"REQB",1,0)
LR*5.2*479^1
"BLD",10522,"REQB","B","LR*5.2*479",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
485^3170426
"PKG",26,22,1,"PAH",1,1,0)
^^4^4^3170426
"PKG",26,22,1,"PAH",1,1,1,0)
This patch addresses one (1) VistA Laboratory Anatomic Pathology issue:
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
I13556053FY17: Multiple orders associated with one Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,4,0)
               accession
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRAPLG1")
0^1^B185001955^B181849693
"RTN","LRAPLG1",1,0)
LRAPLG1 ;DALOI/CKA,JMC,PMK - LOG-IN CONT. ;02/17/17  13:42
"RTN","LRAPLG1",2,0)
 ;;5.2;LAB SERVICE;**72,121,248,308,350,427,433,462,479,485**;Sep 27, 1994;Build 1
"RTN","LRAPLG1",3,0)
 ;
"RTN","LRAPLG1",4,0)
 ; Reference to DISP^SROSPLG supported by IA #893
"RTN","LRAPLG1",5,0)
 ;
"RTN","LRAPLG1",6,0)
START ; Start logging in the specimens.
"RTN","LRAPLG1",7,0)
 N LRFND,LRMSG,LRXX
"RTN","LRAPLG1",8,0)
 ;
"RTN","LRAPLG1",9,0)
 ; Lock ^LR( and ^LRO
"RTN","LRAPLG1",10,0)
 D LOCK^DILF("^LR(LRDFN,LRSS)")
"RTN","LRAPLG1",11,0)
 I '$T D  Q
"RTN","LRAPLG1",12,0)
 . S LRMSG="This record is locked by another user. Please try later."
"RTN","LRAPLG1",13,0)
 . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPLG1",14,0)
 ;
"RTN","LRAPLG1",15,0)
 D LOCK^DILF("^LRO(68,LRAA,1,LRAD,1,0)")
"RTN","LRAPLG1",16,0)
 I '$T D  Q
"RTN","LRAPLG1",17,0)
 . L -^LR(LRDFN,LRSS)
"RTN","LRAPLG1",18,0)
 . S LRMSG="Someone else is logging in specimens.  Please wait and try again."
"RTN","LRAPLG1",19,0)
 . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPLG1",20,0)
 ;
"RTN","LRAPLG1",21,0)
 ; Check that accession date exists first
"RTN","LRAPLG1",22,0)
 D CHECK68^LRWLST1(LRAA,LRAD)
"RTN","LRAPLG1",23,0)
 ;
"RTN","LRAPLG1",24,0)
EN ;
"RTN","LRAPLG1",25,0)
 N LRAPDAN
"RTN","LRAPLG1",26,0)
 ;
"RTN","LRAPLG1",27,0)
 S (LRI,LRIDT)=""
"RTN","LRAPLG1",28,0)
 S LRAN=1
"RTN","LRAPLG1",29,0)
 S LRAPDAN=$$GET^XPAR("ALL","LR AP DEFAULT ACCESSION NUMBER","`"_LRAA,"Q")
"RTN","LRAPLG1",30,0)
 I LRAPDAN=2 S LRAN=+$P(^LRO(68,LRAA,1,LRAD,1,0),U,3)
"RTN","LRAPLG1",31,0)
 F  Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN))  S LRAN=LRAN+1
"RTN","LRAPLG1",32,0)
 W !!,"Assign ",LRO(68)," (",LRABV,") accession #: ",LRAN S %=1 D YN^LRU
"RTN","LRAPLG1",33,0)
 I %<1 L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",34,0)
 ;
"RTN","LRAPLG1",35,0)
 I %=1,$D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,LRAN)) D  Q:$D(LRFND)
"RTN","LRAPLG1",36,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),$P(^(0),U) S X=LRAN D ^LRUTELL S LRFND=1
"RTN","LRAPLG1",37,0)
 . I '$D(LRFND) D ^LRAPLG2
"RTN","LRAPLG1",38,0)
 . I $D(LRFND) L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",39,0)
 . S %=0
"RTN","LRAPLG1",40,0)
 ;
"RTN","LRAPLG1",41,0)
 I %=1 D CRE868 I $D(LRMSG) G EN
"RTN","LRAPLG1",42,0)
 ;
"RTN","LRAPLG1",43,0)
 I %=2 D OS I $D(LRFND) K LRFND L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",44,0)
 ;
"RTN","LRAPLG1",45,0)
 L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPLG1",46,0)
 ;
"RTN","LRAPLG1",47,0)
 S LRAC=$P(^LRO(68,LRAA,0),U,11)_" "_$S(LRAD["0000":$E(LRAD,2,3),1:$E(LRAD,4,7))_" "_LRAN
"RTN","LRAPLG1",48,0)
 ;
"RTN","LRAPLG1",49,0)
AU ; Autopsy Specific
"RTN","LRAPLG1",50,0)
 I LRSS="AU" D ^LRAUAW Q
"RTN","LRAPLG1",51,0)
 S:'$D(^LR(LRDFN,LRSS,0)) ^(0)="^"_LRSF_"DA^0^0"
"RTN","LRAPLG1",52,0)
 ;
"RTN","LRAPLG1",53,0)
 ; If orginal login then create entry in file #63
"RTN","LRAPLG1",54,0)
LR7OFA0 ;
"RTN","LRAPLG1",55,0)
 I LRIDT="" D CRE863
"RTN","LRAPLG1",56,0)
 I LRI="" Q
"RTN","LRAPLG1",57,0)
 ;
"RTN","LRAPLG1",58,0)
 K DA,DTOUT,DIWESUB
"RTN","LRAPLG1",59,0)
 ;S DIWESUB=$E(PNM,1,27-$L(LRACC))_" ["_LRACC_"]"
"RTN","LRAPLG1",60,0)
 S LR(.07)=$S($D(SRDOC):SRDOC,1:"") K SRDOC
"RTN","LRAPLG1",61,0)
 S:LR(.07) LR(.07)=$P($G(^VA(200,LR(.07),0)),"^")
"RTN","LRAPLG1",62,0)
 S DA=LRI,DA(1)=LRDFN
"RTN","LRAPLG1",63,0)
 S DIC(0)="EQLMF",DLAYGO=63,DIE="^LR(LRDFN,LRSS,"
"RTN","LRAPLG1",64,0)
 D @LR("L")
"RTN","LRAPLG1",65,0)
 D ^DIE K DLAYGO
"RTN","LRAPLG1",66,0)
 S:'$D(LRRC) LRRC=LRNT
"RTN","LRAPLG1",67,0)
 ;
"RTN","LRAPLG1",68,0)
 ; Check if topography and collection sample entered on each specimen.
"RTN","LRAPLG1",69,0)
 ; If not entered then define Y to cause entry to be deleted.
"RTN","LRAPLG1",70,0)
 I LRSS?1(1"SP",1"CY",1"EM") D
"RTN","LRAPLG1",71,0)
 . N I,LRJ,X
"RTN","LRAPLG1",72,0)
 . S LRJ=0
"RTN","LRAPLG1",73,0)
 . F  S LRJ=$O(^LR(LRDFN,LRSS,LRI,.1,LRJ)) Q:LRJ<1  D  Q:$D(Y)
"RTN","LRAPLG1",74,0)
 . . S X=$G(^LR(LRDFN,LRSS,LRI,.1,LRJ,0))
"RTN","LRAPLG1",75,0)
 . . F I=6,7 I $P(X,"^",I)="" S Y="" Q
"RTN","LRAPLG1",76,0)
 ;
"RTN","LRAPLG1",77,0)
 ; Delete entry if prompts not answered unless report has been released.
"RTN","LRAPLG1",78,0)
 I $D(DTOUT)!$D(Y) D  Q
"RTN","LRAPLG1",79,0)
 . N DA,DIK
"RTN","LRAPLG1",80,0)
 . I LRSS?1(1"SP",1"CY",1"EM"),($P(^LR(LRDFN,LRSS,LRI,0),"^",11)!$P(^LR(LRDFN,LRSS,LRI,0),"^",15)) Q
"RTN","LRAPLG1",81,0)
 . W $C(7),!!,"All Prompts not answered - <ENTRY DELETED>"
"RTN","LRAPLG1",82,0)
 . S DA(1)=LRDFN,DA=LRI
"RTN","LRAPLG1",83,0)
 . S DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",84,0)
 . D ^DIK,X,END
"RTN","LRAPLG1",85,0)
 ;
"RTN","LRAPLG1",86,0)
 D GETSTCS ; Store specimen topography, coll sample in temp array
"RTN","LRAPLG1",87,0)
 ;
"RTN","LRAPLG1",88,0)
TST ; Get the ordered test and store in temp array
"RTN","LRAPLG1",89,0)
 N II
"RTN","LRAPLG1",90,0)
 D ORDTST
"RTN","LRAPLG1",91,0)
 ; Delete entry if no ordered tests unless report has been released.
"RTN","LRAPLG1",92,0)
 I II=2 D  Q
"RTN","LRAPLG1",93,0)
 . I LRSS?1(1"SP",1"CY",1"EM"),($P(^LR(LRDFN,LRSS,LRI,0),"^",11)!$P(^LR(LRDFN,LRSS,LRI,0),"^",15)) Q
"RTN","LRAPLG1",94,0)
 . N DA,DIK
"RTN","LRAPLG1",95,0)
 . W $C(7),!!,"No ordered test selected - <ENTRY DELETED>"
"RTN","LRAPLG1",96,0)
 . S DA(1)=LRDFN,DA=LRI,DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",97,0)
 . D ^DIK,X,END
"RTN","LRAPLG1",98,0)
 ;
"RTN","LRAPLG1",99,0)
 I LRSS="CY",LRCAPA D CK^LRAPCWK
"RTN","LRAPLG1",100,0)
 ;
"RTN","LRAPLG1",101,0)
 ; Check for surgery case references and move info if user wants surgical case info copied to Lab.
"RTN","LRAPLG1",102,0)
 I LRSS="SP" D SPMOVE
"RTN","LRAPLG1",103,0)
 ;
"RTN","LRAPLG1",104,0)
 ; Fill out the stub accession with related info
"RTN","LRAPLG1",105,0)
 I '$D(LRC(5)) S LRC(5)=""
"RTN","LRAPLG1",106,0)
 D ^LRUWLF
"RTN","LRAPLG1",107,0)
 ;
"RTN","LRAPLG1",108,0)
 I LRCAPA D
"RTN","LRAPLG1",109,0)
 . I LRSS="CY" D ^LRAPCWK
"RTN","LRAPLG1",110,0)
 . I LRSS?1(1"SP",1"EM") D ^LRAPSWK
"RTN","LRAPLG1",111,0)
 ;
"RTN","LRAPLG1",112,0)
 I LRSS?1(1"SP",1"CY",1"EM") D ^LRSPGD
"RTN","LRAPLG1",113,0)
 ;
"RTN","LRAPLG1",114,0)
 I $T(ADD^MAGTP005)'="" N MAGNEWCASE S MAGNEWCASE=1 D ADD^MAGTP005(LRAC) ; add case to file #2005.42 - P433
"RTN","LRAPLG1",115,0)
 ;
"RTN","LRAPLG1",116,0)
 D OERR^LR7OB63D,LDSI
"RTN","LRAPLG1",117,0)
 ;
"RTN","LRAPLG1",118,0)
 I $T(NEW^MAGT7MA)'="" D NEW^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRAPLG1",119,0)
 ;
"RTN","LRAPLG1",120,0)
 Q
"RTN","LRAPLG1",121,0)
 ;
"RTN","LRAPLG1",122,0)
 ;
"RTN","LRAPLG1",123,0)
LDSI ; LDSI tasks
"RTN","LRAPLG1",124,0)
 ;
"RTN","LRAPLG1",125,0)
 N LRLLOC,LRALOC,LRPRAC,LROUTINE,LROPL,LRODT,LRNT,LRFILE,LRIENS,LRORD,LRSRDT,LRTST
"RTN","LRAPLG1",126,0)
 ;
"RTN","LRAPLG1",127,0)
 ; Get variables for ORUT node
"RTN","LRAPLG1",128,0)
 S LROUTINE=$P($G(^LAB(69.9,1,3)),"^",2)    ;default urgency
"RTN","LRAPLG1",129,0)
 S LRPROVL=LRMD(1)    ;Ordering provider-CKA
"RTN","LRAPLG1",130,0)
 ; Get ORDER TYPE
"RTN","LRAPLG1",131,0)
 ;;*
"RTN","LRAPLG1",132,0)
 S:$G(LRORDR)="" LRORDR="WC" ;Default to 'Ward Collect' for now
"RTN","LRAPLG1",133,0)
 ;;;*
"RTN","LRAPLG1",134,0)
 S LRNT=$$NOW^XLFDT() ;Date ordered = current date/time
"RTN","LRAPLG1",135,0)
 S LRODT=$P(LRNT,".")
"RTN","LRAPLG1",136,0)
 ; Get Provider, Location abbrev, Collection date/time
"RTN","LRAPLG1",137,0)
 S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:"")
"RTN","LRAPLG1",138,0)
 S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPLG1",139,0)
 S LRPRAC=$$GET1^DIQ(LRFILE,LRIENS,.07,"I")
"RTN","LRAPLG1",140,0)
 S LRLLOC=$$GET1^DIQ(LRFILE,LRIENS,.08,"I")
"RTN","LRAPLG1",141,0)
 I LRLLOC="" S LRLLOC="NO ABRV"
"RTN","LRAPLG1",142,0)
 S LRSDT=+$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPLG1",143,0)
 S LRSRDT=$$GET1^DIQ(LRFILE,LRIENS,.1,"I") ; Specimen received date/time
"RTN","LRAPLG1",144,0)
 ; Get CPRS Order #
"RTN","LRAPLG1",145,0)
 S ORIFN="" ; Default to blank for now
"RTN","LRAPLG1",146,0)
 ;
"RTN","LRAPLG1",147,0)
 ; Get Lab Order #, update file #69 and #68
"RTN","LRAPLG1",148,0)
LDSI1 S (LRORD,LRSPEC,LRTST,LRSAMP,LRADD,LROT)="",LRCNT=1
"RTN","LRAPLG1",149,0)
 F  S LRSPEC=$O(LRXX(LRSPEC)) Q:'LRSPEC  D
"RTN","LRAPLG1",150,0)
 . N LRRECINF
"RTN","LRAPLG1",151,0)
 . S LRSAMP=$P(LRXX(LRSPEC),"^",1),LRNLT=$P(LRXX(LRSPEC),"^",2),LRTST=$P(LRXX(LRSPEC),"^",3)
"RTN","LRAPLG1",152,0)
 . Q:'LRTST
"RTN","LRAPLG1",153,0)
 . ;I LRORD,$G(^LAB(69.9,1,21661)) S LRADD=1 D ZSN^LR7OFAO("",.LRRECINF)
"RTN","LRAPLG1",154,0)
 . ; Get Lab Order # first time thru
"RTN","LRAPLG1",155,0)
 . D:'LRORD EN^LR7OFAO(LRODT,LRDFN,LRSAMP,LRORDR,LRNT,LRPRAC,LRLLOC,LRSDT,ORIFN,LRSPEC,LRSS,LRTST,LRUID,.LRRECINF)
"RTN","LRAPLG1",156,0)
 . S LRSN=+$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,5),LRCDT=0,LREAL=""
"RTN","LRAPLG1",157,0)
 . I LRSN>0 S LRCDT=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",1,2),LREAL=$P(LRCDT,"^",2),LRCDT=+LRCDT
"RTN","LRAPLG1",158,0)
 . D UPD68,UPD63
"RTN","LRAPLG1",159,0)
 . S LRCNT=LRCNT+1
"RTN","LRAPLG1",160,0)
 ;
"RTN","LRAPLG1",161,0)
 Q
"RTN","LRAPLG1",162,0)
 ;
"RTN","LRAPLG1",163,0)
 ;
"RTN","LRAPLG1",164,0)
UPD68 ; Update #68 with required test data
"RTN","LRAPLG1",165,0)
 N LRFILE,LRERR,IEN,LRIEN
"RTN","LRAPLG1",166,0)
 S LRFILE=68.04,IEN(1)=LRTST
"RTN","LRAPLG1",167,0)
 S LRIEN="?+1,"_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPLG1",168,0)
 S FDA(3,LRFILE,LRIEN,.01)=LRTST
"RTN","LRAPLG1",169,0)
 S FDA(3,LRFILE,LRIEN,1)=LROUTINE
"RTN","LRAPLG1",170,0)
 ;;*
"RTN","LRAPLG1",171,0)
 S FDA(3,LRFILE,LRIEN,8.1)=LRTST
"RTN","LRAPLG1",172,0)
 ;;;*
"RTN","LRAPLG1",173,0)
 D UPDATE^DIE("","FDA(3)","IEN","LRERR(3)")
"RTN","LRAPLG1",174,0)
 I $D(LRERR(3)) D LRMSG("UPD68-3~LRAPLG1",.LRERR)
"RTN","LRAPLG1",175,0)
 ;
"RTN","LRAPLG1",176,0)
 ;
"RTN","LRAPLG1",177,0)
 ; Update #68 with specimen data
"RTN","LRAPLG1",178,0)
 K LRFILE,FDAIEN,IEN
"RTN","LRAPLG1",179,0)
 S LRFILE=68.05
"RTN","LRAPLG1",180,0)
 ; Check or Set top node for 68.05
"RTN","LRAPLG1",181,0)
 S FDAIEN="?+"_LRCNT_","_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPLG1",182,0)
 S FDA(31,LRFILE,FDAIEN,.01)=LRSPEC
"RTN","LRAPLG1",183,0)
 S FDA(31,LRFILE,FDAIEN,1)=LRSAMP
"RTN","LRAPLG1",184,0)
 D UPDATE^DIE("","FDA(31)","IEN","LRERR(31)")
"RTN","LRAPLG1",185,0)
 I $D(LRERR(31)) D LRMSG("UPD68-31~LRAPLG1",.LRERR)
"RTN","LRAPLG1",186,0)
 ;
"RTN","LRAPLG1",187,0)
 Q
"RTN","LRAPLG1",188,0)
 ;
"RTN","LRAPLG1",189,0)
 ;
"RTN","LRAPLG1",190,0)
UPD63 ; Update ORUT Node in #63
"RTN","LRAPLG1",191,0)
 S LRTSORU=LRTST,LRURG=9,LRI=LRIDT
"RTN","LRAPLG1",192,0)
 D SLRSS^LRWLST11
"RTN","LRAPLG1",193,0)
 D ORUT^LRWLST11
"RTN","LRAPLG1",194,0)
 ;
"RTN","LRAPLG1",195,0)
 ;
"RTN","LRAPLG1",196,0)
 Q
"RTN","LRAPLG1",197,0)
 ;
"RTN","LRAPLG1",198,0)
 ;
"RTN","LRAPLG1",199,0)
X ; from LRAUAW
"RTN","LRAPLG1",200,0)
 I "CYEMSP"[LRSS K ^LR(LRXREF,LRH(2),LRABV,LRAN)
"RTN","LRAPLG1",201,0)
 I LRSS="AU" D
"RTN","LRAPLG1",202,0)
 . I $D(^LR(LRDFN,"AV")) K ^LR(LRDFN,"AV")
"RTN","LRAPLG1",203,0)
 . I $D(^LR(LRDFN,"AW")) K ^LR(LRDFN,"AW")
"RTN","LRAPLG1",204,0)
 . I $D(^LR(LRDFN,"AWI")) K ^LR(LRDFN,"AWI")
"RTN","LRAPLG1",205,0)
 . I $D(LRRC) K ^LR("AAUA",+$E(LRRC,1,3),LRABV,LRAN),^LR("AAU",+LRRC,LRDFN)
"RTN","LRAPLG1",206,0)
 I $G(LRRC)>1 K:LRSS?1(1"SP",1"CY",1"EM") ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRAPLG1",207,0)
 K LRRC
"RTN","LRAPLG1",208,0)
 Q
"RTN","LRAPLG1",209,0)
 ;
"RTN","LRAPLG1",210,0)
 ;
"RTN","LRAPLG1",211,0)
OS ; User choosing accession number
"RTN","LRAPLG1",212,0)
 N DIR,DIROUT,DIRUT,DTOUT,LRSPEC,X,Y
"RTN","LRAPLG1",213,0)
 S DIR(0)="N^1:999999:0^D OSDIR^LRAPLG1"
"RTN","LRAPLG1",214,0)
 S DIR("A")="Enter Accession #"
"RTN","LRAPLG1",215,0)
 D ^DIR
"RTN","LRAPLG1",216,0)
 I $D(DIRUT) S LRFND=1 Q
"RTN","LRAPLG1",217,0)
 S LRAN=Y
"RTN","LRAPLG1",218,0)
 ;
"RTN","LRAPLG1",219,0)
 ;Do not allow edits to accessions already on file.
"RTN","LRAPLG1",220,0)
 ;Otherwise, several orders will be created for the same order number
"RTN","LRAPLG1",221,0)
 ;and CPRS will not display the edited/updated information.
"RTN","LRAPLG1",222,0)
 ;
"RTN","LRAPLG1",223,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPLG1",224,0)
 . W !!,?5,"This accession has already been logged in."
"RTN","LRAPLG1",225,0)
 . W !,?5,"""Log-in menu, anat path"" should NOT be used to edit an accession."
"RTN","LRAPLG1",226,0)
 . W !,?5,"Use ""Edit/modify data, anat path"" instead."
"RTN","LRAPLG1",227,0)
 . S LRFND=1
"RTN","LRAPLG1",228,0)
 ;
"RTN","LRAPLG1",229,0)
 I $D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,LRAN)) D ^LRAPLG2 Q
"RTN","LRAPLG1",230,0)
 ;
"RTN","LRAPLG1",231,0)
 D CRE868
"RTN","LRAPLG1",232,0)
 I $D(LRMSG) S LRFND=1
"RTN","LRAPLG1",233,0)
 Q
"RTN","LRAPLG1",234,0)
 ;
"RTN","LRAPLG1",235,0)
 ;
"RTN","LRAPLG1",236,0)
 ;
"RTN","LRAPLG1",237,0)
OSDIR ; Called from DIR call in OS above
"RTN","LRAPLG1",238,0)
 ;
"RTN","LRAPLG1",239,0)
 ;ZEXCEPT: LRAA,LRAD,LRDFN,X
"RTN","LRAPLG1",240,0)
 ;
"RTN","LRAPLG1",241,0)
 ; Accession number doesn't exist in file #68 - quit, OK to use this number
"RTN","LRAPLG1",242,0)
 I $O(^LRO(68,LRAA,1,LRAD,1,+X,""))="" Q
"RTN","LRAPLG1",243,0)
 ;
"RTN","LRAPLG1",244,0)
 N LRX
"RTN","LRAPLG1",245,0)
 S LRX=$G(^LRO(68,LRAA,1,LRAD,1,+X,0))
"RTN","LRAPLG1",246,0)
 I LRX<1 K X Q
"RTN","LRAPLG1",247,0)
 ;
"RTN","LRAPLG1",248,0)
 ; Stub entry which matches on LRDFN
"RTN","LRAPLG1",249,0)
 I LRX=LRDFN Q
"RTN","LRAPLG1",250,0)
 ;
"RTN","LRAPLG1",251,0)
 I $P(LRX,U)'=LRDFN S X=+X D ^LRUTELL K X
"RTN","LRAPLG1",252,0)
 ;
"RTN","LRAPLG1",253,0)
 Q
"RTN","LRAPLG1",254,0)
 ;
"RTN","LRAPLG1",255,0)
 ;
"RTN","LRAPLG1",256,0)
ORDTST ; Prompt for ordered test(s); translate to NLT code for storage in ORUT
"RTN","LRAPLG1",257,0)
 ; Add NLT code to temp array LRXX (This code currently assumes one ordered test per accession)
"RTN","LRAPLG1",258,0)
 ;
"RTN","LRAPLG1",259,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRNLT,LRWKCD,XX
"RTN","LRAPLG1",260,0)
 S (LRNLT,LRWKCD)="",II=0
"RTN","LRAPLG1",261,0)
 S DIR(0)="P^LAB(60,:AEMOQ",DIR("B")=$G(LRTST(0))
"RTN","LRAPLG1",262,0)
 S DIR("S")="I $P(^LAB(60,Y,0),""^"",4)=LRSS,""IBO""[$P(^LAB(60,Y,0),""^"",3),$P($G(^LAB(60,Y,64)),""^"")"
"RTN","LRAPLG1",263,0)
 D ^DIR
"RTN","LRAPLG1",264,0)
 I $D(DIRUT) S II=2 Q
"RTN","LRAPLG1",265,0)
 S LRWKCD=+$G(^LAB(60,+Y,64)),LRNLT=$P($G(^LAM(LRWKCD,0)),"^",2),II=1
"RTN","LRAPLG1",266,0)
 S XX=0
"RTN","LRAPLG1",267,0)
 F  S XX=$O(LRXX(XX)) Q:'XX  S $P(LRXX(XX),"^",2)=LRNLT_"^"_+Y
"RTN","LRAPLG1",268,0)
 ;
"RTN","LRAPLG1",269,0)
 Q
"RTN","LRAPLG1",270,0)
 ;
"RTN","LRAPLG1",271,0)
 ;
"RTN","LRAPLG1",272,0)
GETSTCS ;Get spec top and coll samp
"RTN","LRAPLG1",273,0)
 N LRI
"RTN","LRAPLG1",274,0)
 K LRXX
"RTN","LRAPLG1",275,0)
 S LRI=0,(LRXX,X)=""
"RTN","LRAPLG1",276,0)
 F  S LRI=$O(^LR(LRDFN,LRSS,LRIDT,.1,LRI)) Q:'LRI  D
"RTN","LRAPLG1",277,0)
 . S X=$G(^LR(LRDFN,LRSS,LRIDT,.1,LRI,0))
"RTN","LRAPLG1",278,0)
 . I $P(X,"^",6)'="" S LRXX($P(X,"^",6))=$P(X,"^",7)_"^"
"RTN","LRAPLG1",279,0)
 Q
"RTN","LRAPLG1",280,0)
 ;
"RTN","LRAPLG1",281,0)
 ;
"RTN","LRAPLG1",282,0)
CRE868 ; Create accession number in file 68
"RTN","LRAPLG1",283,0)
 N LRFDA,LRFDAIEN,LRIEN
"RTN","LRAPLG1",284,0)
 K LRMSG
"RTN","LRAPLG1",285,0)
 S LRIEN="+1,"_LRAD_","_LRAA_","
"RTN","LRAPLG1",286,0)
 S LRFDAIEN(1)=LRAN
"RTN","LRAPLG1",287,0)
 S LRFDA(1,68.02,LRIEN,.01)=LRDFN
"RTN","LRAPLG1",288,0)
 D UPDATE^DIE("S","LRFDA(1)","LRFDAIEN","LRMSG")
"RTN","LRAPLG1",289,0)
 I $D(LRMSG) S LRSD=LRAD D LRMSG("EN~LRAPGL1",.LRMSG) Q
"RTN","LRAPLG1",290,0)
 S X=LRAN
"RTN","LRAPLG1",291,0)
 Q
"RTN","LRAPLG1",292,0)
 ;
"RTN","LRAPLG1",293,0)
 ;
"RTN","LRAPLG1",294,0)
CRE863 ; Create entry in file #63
"RTN","LRAPLG1",295,0)
 ;
"RTN","LRAPLG1",296,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRAPLG1",297,0)
 S DIR(0)="DO^:NOW:ET"
"RTN","LRAPLG1",298,0)
 S DIR("A")="Date/time Specimen taken",DIR("B")="NOW"
"RTN","LRAPLG1",299,0)
 ;;
"RTN","LRAPLG1",300,0)
 I '$G(LRAPDIAL) D ^DIR K DIR I Y<1 D END Q
"RTN","LRAPLG1",301,0)
 I $G(LRAPDIAL) S Y=LRCDT
"RTN","LRAPLG1",302,0)
 ;;;*
"RTN","LRAPLG1",303,0)
 S (LRY,LRSD)=Y,LRI=9999999-LRY
"RTN","LRAPLG1",304,0)
 ;
"RTN","LRAPLG1",305,0)
 ; Process and get unique LRI
"RTN","LRAPLG1",306,0)
 F  Q:'$D(^LR(LRDFN,LRSS,LRI,0))  D
"RTN","LRAPLG1",307,0)
 . S (LRSD,LRY)=$$FMADD^XLFDT(LRY,,,,1)
"RTN","LRAPLG1",308,0)
 . S LRI=9999999-LRY
"RTN","LRAPLG1",309,0)
 ;
"RTN","LRAPLG1",310,0)
 N LRFDA,LRIEN,LRFILE,LRFDAIEN
"RTN","LRAPLG1",311,0)
 K DIERR,LRMSG
"RTN","LRAPLG1",312,0)
 S LRACC=LRAC,LRNT=$$NOW^XLFDT()
"RTN","LRAPLG1",313,0)
 S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:63.08)
"RTN","LRAPLG1",314,0)
 S LRFDAIEN(1)=LRI
"RTN","LRAPLG1",315,0)
 S LRIEN="+1,"_LRDFN_","
"RTN","LRAPLG1",316,0)
 S LRFDA(2,LRFILE,LRIEN,.01)=LRSD ;DATE/TIME SPECIMEN TAKEN
"RTN","LRAPLG1",317,0)
 S LRFDA(2,LRFILE,LRIEN,.06)=LRACC
"RTN","LRAPLG1",318,0)
 ;;*
"RTN","LRAPLG1",319,0)
 I $G(LRAPDIAL) D   ; STORE ORDERING PROVIDER  - LRAPDIAL SET IN LRAPKOE
"RTN","LRAPLG1",320,0)
 . I $G(LRPHY) S LRFDA(2,LRFILE,LRIEN,.02)=+$G(LRPHY) ;Pathologist
"RTN","LRAPLG1",321,0)
 . I $G(LRORPROV) S LRFDA(2,LRFILE,LRIEN,.07)=LRORPROV ; ORDERING PROVIDER
"RTN","LRAPLG1",322,0)
 . I $G(LRLLOC)'="" S LRFDA(2,LRFILE,LRIEN,.08)=LRLLOC ; ORDER LOCATION
"RTN","LRAPLG1",323,0)
 . I $G(LRSUBBY)'="" S LRFDA(2,LRFILE,LRIEN,.011)=LRSUBBY ; SUBMIT BY
"RTN","LRAPLG1",324,0)
 . S LRFDA(2,LRFILE,LRIEN,.1)=LRNT ;DATE/TIME SPECIMEN RECIEVED
"RTN","LRAPLG1",325,0)
 ;;;*
"RTN","LRAPLG1",326,0)
 ;
"RTN","LRAPLG1",327,0)
 D UPDATE^DIE("","LRFDA(2)","LRFDAIEN","LRMSG")
"RTN","LRAPLG1",328,0)
 L -^LR(LRDFN,LRSS)
"RTN","LRAPLG1",329,0)
 I $D(LRMSG) D LRMSG("F~LRAPLG1",.LRMSG) Q
"RTN","LRAPLG1",330,0)
 ;
"RTN","LRAPLG1",331,0)
 S (LRI,LRIDT)=LRFDAIEN(1)
"RTN","LRAPLG1",332,0)
 ;
"RTN","LRAPLG1",333,0)
 Q
"RTN","LRAPLG1",334,0)
 ;
"RTN","LRAPLG1",335,0)
 ;
"RTN","LRAPLG1",336,0)
SPMOVE ; Copy surgery information into lab package
"RTN","LRAPLG1",337,0)
 ;  - store surgery package reference to retrieve surgeon/attending.
"RTN","LRAPLG1",338,0)
 ;  - LRFLAG used to determine if data copied from Surgery packge and moved to Lab and generate notice.
"RTN","LRAPLG1",339,0)
 ;         if no data before and data after call to SROSPLG then add disclaimer.
"RTN","LRAPLG1",340,0)
 ;
"RTN","LRAPLG1",341,0)
 S X="SROSPLG" X ^%ZOSF("TEST")
"RTN","LRAPLG1",342,0)
 I '$T Q
"RTN","LRAPLG1",343,0)
 ;
"RTN","LRAPLG1",344,0)
 N I,LRFIELD,LRFLAG,LRJ,LRSREF,LRSRTN,LRWP
"RTN","LRAPLG1",345,0)
 S LRFLAG="",LRSRTN=$G(SRTN)
"RTN","LRAPLG1",346,0)
 I LRSRTN D
"RTN","LRAPLG1",347,0)
 . N LRDATA,LRDIE
"RTN","LRAPLG1",348,0)
 . S LRDATA(.01)=LRDFN_","_LRSS_","_LRI_",0"
"RTN","LRAPLG1",349,0)
 . S LRDATA(.02)=1
"RTN","LRAPLG1",350,0)
 . S LRDATA(1)=LRSRTN_";SRF("
"RTN","LRAPLG1",351,0)
 . D SETREF^LRUEPR(LRDFN,LRDATA(.01),.LRDATA,1)
"RTN","LRAPLG1",352,0)
 . F I=.2,.3,.4,.5 I '$O(^LR(LRDFN,LRSS,LRI,I,0)) S $P(LRFLAG,"^",I*10)=1
"RTN","LRAPLG1",353,0)
 ;
"RTN","LRAPLG1",354,0)
 D DISP^SROSPLG
"RTN","LRAPLG1",355,0)
 ;
"RTN","LRAPLG1",356,0)
 ; Create notation on where info came from if site wants reference.
"RTN","LRAPLG1",357,0)
 ;  also store referece as external package reference.
"RTN","LRAPLG1",358,0)
 S LRSREF=$$GET^XPAR("DIV^PKG","LR AP SURGERY REFERENCE",1,"Q")
"RTN","LRAPLG1",359,0)
 S LRFIELD(.013)="(#60) BRIEF CLIN HISTORY"
"RTN","LRAPLG1",360,0)
 S LRFIELD(.014)="(#32) PRINCIPAL PRE-OP DIAGNOSIS, (#.72) OTHER PREOP DIAGNOSIS"
"RTN","LRAPLG1",361,0)
 S LRFIELD(.015)="(#59) OPERATIVE FINDINGS"
"RTN","LRAPLG1",362,0)
 S LRFIELD(.016)="(#34) PRINCIPAL POST-OP DIAG, (#.74) OTHER POSTOP DIAGS"
"RTN","LRAPLG1",363,0)
 S LRWP(1)=" "
"RTN","LRAPLG1",364,0)
 F LRJ=.2,.3,.4,.5 I $P(LRFLAG,"^",LRJ*10),$O(^LR(LRDFN,LRSS,LRI,LRJ,0)) D
"RTN","LRAPLG1",365,0)
 . N LRDATA,LRDIE
"RTN","LRAPLG1",366,0)
 . S LRFIELD=$P("^.013^.014^.015^.016","^",LRJ*10)
"RTN","LRAPLG1",367,0)
 . S LRWP(2)="Information automatically documented from SURGERY package case #"_LRSRTN_" Field "_LRFIELD(LRFIELD)
"RTN","LRAPLG1",368,0)
 . I LRSREF=1 D WP^DIE(63.08,LRI_","_LRDFN_",",LRFIELD,"A","LRWP","LRDIE(LRFIELD)")
"RTN","LRAPLG1",369,0)
 . S LRDATA(.01)=LRDFN_","_LRSS_","_LRI_","_LRJ_",0"
"RTN","LRAPLG1",370,0)
 . S LRDATA(.02)=1
"RTN","LRAPLG1",371,0)
 . S LRDATA(1)=LRSRTN_";SRF(;"_LRWP(2)
"RTN","LRAPLG1",372,0)
 . D SETREF^LRUEPR(LRDFN,LRDATA(.01),.LRDATA,1)
"RTN","LRAPLG1",373,0)
 ;
"RTN","LRAPLG1",374,0)
 Q
"RTN","LRAPLG1",375,0)
 ;
"RTN","LRAPLG1",376,0)
 ;
"RTN","LRAPLG1",377,0)
LRMSG(LRRNAME,LRFMERR) ;
"RTN","LRAPLG1",378,0)
 ; Filing error notification
"RTN","LRAPLG1",379,0)
 ; Inputs
"RTN","LRAPLG1",380,0)
 ;  LRRNAME: Routine name  (TAG~RTN)
"RTN","LRAPLG1",381,0)
 ;  LRFMERR:<byref> FileMan error local array
"RTN","LRAPLG1",382,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRDIE
"RTN","LRAPLG1",383,0)
 S LRRNAME=$TR($G(LRRNAME),"^","~")
"RTN","LRAPLG1",384,0)
 M LRDIE=LRFMERR
"RTN","LRAPLG1",385,0)
 D MAILALRT^LRWLST12(LRRNAME,.LRFMERR)
"RTN","LRAPLG1",386,0)
 S DIR(0)="EA"
"RTN","LRAPLG1",387,0)
 S DIR("A",1)="Filing error in "_LRRNAME_" for this accession/specimen"
"RTN","LRAPLG1",388,0)
 S DIR("A")="Press the return key to continue"
"RTN","LRAPLG1",389,0)
 D ^DIR
"RTN","LRAPLG1",390,0)
 Q
"RTN","LRAPLG1",391,0)
 ;
"RTN","LRAPLG1",392,0)
 ;
"RTN","LRAPLG1",393,0)
OUT ;
"RTN","LRAPLG1",394,0)
 ; Exit point
"RTN","LRAPLG1",395,0)
 Q
"RTN","LRAPLG1",396,0)
 ;
"RTN","LRAPLG1",397,0)
 ;
"RTN","LRAPLG1",398,0)
END ; from LRAUAW, LRAPLG2
"RTN","LRAPLG1",399,0)
 ; Lock Accession file
"RTN","LRAPLG1",400,0)
 D LOCK^DILF("^LRO(68,LRAA,1,LRAD,1,0)")
"RTN","LRAPLG1",401,0)
 I '$T D EN^DDIOL("Someone else is logging in specimens.  Please wait and try again.","","!!") Q
"RTN","LRAPLG1",402,0)
 ;
"RTN","LRAPLG1",403,0)
 N DIK,DA
"RTN","LRAPLG1",404,0)
 S DA=LRAN,DA(1)=LRAD,DA(2)=LRAA
"RTN","LRAPLG1",405,0)
 S DIK="^LRO(68,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","LRAPLG1",406,0)
 D ^DIK
"RTN","LRAPLG1",407,0)
 ;
"RTN","LRAPLG1",408,0)
 L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPLG1",409,0)
 Q
"RTN","LRAPLG1",410,0)
 ;
"RTN","LRAPLG1",411,0)
 ;
"RTN","LRAPLG1",412,0)
FIX ; Entry point to delete an orphan AP entry in file #63
"RTN","LRAPLG1",413,0)
 ;
"RTN","LRAPLG1",414,0)
 N DA,DFN,DIC,DIK,DIR,DIROUT,DIRUT,DIQ,DR,DTOUT
"RTN","LRAPLG1",415,0)
 N LRAA,LRABV,LRAC,LRAD,LRAN,LRDFN,LRDPA,LRDPF,LRH,LRI,LRRC,LRSS,LRWHN,LRXR,LRXREF
"RTN","LRAPLG1",416,0)
 N AGE,PNM,SEX,X,Y
"RTN","LRAPLG1",417,0)
 ;
"RTN","LRAPLG1",418,0)
 D ^LRAP Q:'$D(Y)
"RTN","LRAPLG1",419,0)
 D XR^LRU
"RTN","LRAPLG1",420,0)
 ;
"RTN","LRAPLG1",421,0)
 I LRSS'?1(1"SP",1"CY",1"EM") W !,"This program only supports SP, CY and EM subscripts",! Q
"RTN","LRAPLG1",422,0)
 ;
"RTN","LRAPLG1",423,0)
 S LRH(2)=$E(LRAD,1,3),LRWHN=$E(LRAD,2,3)
"RTN","LRAPLG1",424,0)
 ;
"RTN","LRAPLG1",425,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRAPLG1",426,0)
 I $P(^LR(LRDFN,LRSS,LRI,0),"^",11)'="" W !,"Report has been released!",! Q
"RTN","LRAPLG1",427,0)
 I $D(^LR(LRDFN,LRSS,LRI,2005)) D  Q
"RTN","LRAPLG1",428,0)
 . W !,"Report has associated images in IMAGING package!"
"RTN","LRAPLG1",429,0)
 . W !,"Disposition these images before deleting this entry!",!
"RTN","LRAPLG1",430,0)
 ;
"RTN","LRAPLG1",431,0)
 K DR
"RTN","LRAPLG1",432,0)
 S DIC="^LR("_LRDFN_","""_LRSS_""",",DA(1)=LRDFN,DA=LRI,DIQ(0)="ACR"
"RTN","LRAPLG1",433,0)
 D EN^DIQ
"RTN","LRAPLG1",434,0)
 ;
"RTN","LRAPLG1",435,0)
 S DIR(0)="Y",DIR("A")="DELETE this entry",DIR("B")="NO"
"RTN","LRAPLG1",436,0)
 D ^DIR
"RTN","LRAPLG1",437,0)
 I Y<1 Q
"RTN","LRAPLG1",438,0)
 ;
"RTN","LRAPLG1",439,0)
 K DIR
"RTN","LRAPLG1",440,0)
 S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","LRAPLG1",441,0)
 D ^DIR
"RTN","LRAPLG1",442,0)
 I Y<1 Q
"RTN","LRAPLG1",443,0)
 ;
"RTN","LRAPLG1",444,0)
 ; Lock record
"RTN","LRAPLG1",445,0)
 D LOCK^DILF("^LR(LRDFN,LRSS,LRI)")
"RTN","LRAPLG1",446,0)
 I '$T D  Q
"RTN","LRAPLG1",447,0)
 . D EN^DDIOL("Someone else is accessing this record.  Please wait and try again.","","!!")
"RTN","LRAPLG1",448,0)
 . D KVA^VADPT,V^LRU
"RTN","LRAPLG1",449,0)
 ;
"RTN","LRAPLG1",450,0)
 K DA,DIK
"RTN","LRAPLG1",451,0)
 S DA=LRI,DA(1)=LRDFN,DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",452,0)
 D ^DIK
"RTN","LRAPLG1",453,0)
 ;
"RTN","LRAPLG1",454,0)
 ; Cleanup some cross-references.
"RTN","LRAPLG1",455,0)
 I LRSS?1(1"SP",1"CY",1"EM") D
"RTN","LRAPLG1",456,0)
 . K ^LR(LRXREF,LRH(2),LRABV,LRAN,LRDFN,LRI)
"RTN","LRAPLG1",457,0)
 . I $G(LRRC)>1 K ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRAPLG1",458,0)
 ;
"RTN","LRAPLG1",459,0)
 I LRSS="AU" D
"RTN","LRAPLG1",460,0)
 . I $D(^LR(LRDFN,"AV")) K ^LR(LRDFN,"AV")
"RTN","LRAPLG1",461,0)
 . I $D(^LR(LRDFN,"AW")) K ^LR(LRDFN,"AW")
"RTN","LRAPLG1",462,0)
 . I $D(^LR(LRDFN,"AWI")) K ^LR(LRDFN,"AWI")
"RTN","LRAPLG1",463,0)
 . I $D(LRRC) K ^LR("AAUA",+$E(LRRC,1,3),LRABV,LRAN),^LR("AAU",+LRRC,LRDFN)
"RTN","LRAPLG1",464,0)
 ;
"RTN","LRAPLG1",465,0)
 ; Release lock
"RTN","LRAPLG1",466,0)
 L -^LR(LRDFN,LRSS,LRI)
"RTN","LRAPLG1",467,0)
 ;
"RTN","LRAPLG1",468,0)
 W !!,"Entry deleted",!
"RTN","LRAPLG1",469,0)
 D KVA^VADPT,V^LRU
"RTN","LRAPLG1",470,0)
 ;
"RTN","LRAPLG1",471,0)
 Q
"VER")
8.0^22.2
"BLD",10522,6)
^390
**END**
**END**

