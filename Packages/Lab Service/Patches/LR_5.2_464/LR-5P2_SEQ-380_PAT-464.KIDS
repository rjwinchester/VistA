Released LR*5.2*464 SEQ #380
Extracted from mail message
**KIDS**:LR*5.2*464^

**INSTALL NAME**
LR*5.2*464
"BLD",9613,0)
LR*5.2*464^LAB SERVICE^0^3160926^y
"BLD",9613,1,0)
^^12^12^3160719^^^
"BLD",9613,1,1,0)
The NSR20140715 Surgical Pathology Report Enhancements for Readability 
"BLD",9613,1,2,0)
intake modifies the Laboratory Surgical Pathology report by lining up the 
"BLD",9613,1,3,0)
columns so that the report is more legible. 
"BLD",9613,1,4,0)
 
"BLD",9613,1,5,0)
This intake has been implemented locally at the Kansas City, Kansas VAMC. 
"BLD",9613,1,6,0)
 
"BLD",9613,1,7,0)
The NSR for this intake addresses the following requirement: 
"BLD",9613,1,8,0)
 
"BLD",9613,1,9,0)
* VHBAO: NEED502503 Surgical Pathology Report Enhancement: As a health 
"BLD",9613,1,10,0)
care provider, I need to view the Laboratory Surgical Pathology Report 
"BLD",9613,1,11,0)
columns in-line, so the report is legible and I can provide timely care 
"BLD",9613,1,12,0)
for the patient. 
"BLD",9613,4,0)
^9.64PA^^
"BLD",9613,6.3)
12
"BLD",9613,"ABPKG")
n
"BLD",9613,"KRN",0)
^9.67PA^779.2^20
"BLD",9613,"KRN",.4,0)
.4
"BLD",9613,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9613,"KRN",.401,0)
.401
"BLD",9613,"KRN",.402,0)
.402
"BLD",9613,"KRN",.403,0)
.403
"BLD",9613,"KRN",.5,0)
.5
"BLD",9613,"KRN",.84,0)
.84
"BLD",9613,"KRN",3.6,0)
3.6
"BLD",9613,"KRN",3.8,0)
3.8
"BLD",9613,"KRN",9.2,0)
9.2
"BLD",9613,"KRN",9.8,0)
9.8
"BLD",9613,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",9613,"KRN",9.8,"NM",1,0)
LR7OSAP1^^0^B26708741
"BLD",9613,"KRN",9.8,"NM",2,0)
LRSPRPT^^0^B66074919
"BLD",9613,"KRN",9.8,"NM",3,0)
LRAPBR1^^0^B133918664
"BLD",9613,"KRN",9.8,"NM",4,0)
LRSPRPTA^^0^B16221916
"BLD",9613,"KRN",9.8,"NM",5,0)
LRAPAUSR^^0^B35041396
"BLD",9613,"KRN",9.8,"NM",6,0)
LRAURPT^^0^B57531711
"BLD",9613,"KRN",9.8,"NM",7,0)
LRAPBR4^^0^B44485116
"BLD",9613,"KRN",9.8,"NM","B","LR7OSAP1",1)
 
"BLD",9613,"KRN",9.8,"NM","B","LRAPAUSR",5)
 
"BLD",9613,"KRN",9.8,"NM","B","LRAPBR1",3)
 
"BLD",9613,"KRN",9.8,"NM","B","LRAPBR4",7)
 
"BLD",9613,"KRN",9.8,"NM","B","LRAURPT",6)
 
"BLD",9613,"KRN",9.8,"NM","B","LRSPRPT",2)
 
"BLD",9613,"KRN",9.8,"NM","B","LRSPRPTA",4)
 
"BLD",9613,"KRN",19,0)
19
"BLD",9613,"KRN",19.1,0)
19.1
"BLD",9613,"KRN",101,0)
101
"BLD",9613,"KRN",409.61,0)
409.61
"BLD",9613,"KRN",771,0)
771
"BLD",9613,"KRN",779.2,0)
779.2
"BLD",9613,"KRN",870,0)
870
"BLD",9613,"KRN",8989.51,0)
8989.51
"BLD",9613,"KRN",8989.52,0)
8989.52
"BLD",9613,"KRN",8994,0)
8994
"BLD",9613,"KRN","B",.4,.4)
 
"BLD",9613,"KRN","B",.401,.401)
 
"BLD",9613,"KRN","B",.402,.402)
 
"BLD",9613,"KRN","B",.403,.403)
 
"BLD",9613,"KRN","B",.5,.5)
 
"BLD",9613,"KRN","B",.84,.84)
 
"BLD",9613,"KRN","B",3.6,3.6)
 
"BLD",9613,"KRN","B",3.8,3.8)
 
"BLD",9613,"KRN","B",9.2,9.2)
 
"BLD",9613,"KRN","B",9.8,9.8)
 
"BLD",9613,"KRN","B",19,19)
 
"BLD",9613,"KRN","B",19.1,19.1)
 
"BLD",9613,"KRN","B",101,101)
 
"BLD",9613,"KRN","B",409.61,409.61)
 
"BLD",9613,"KRN","B",771,771)
 
"BLD",9613,"KRN","B",779.2,779.2)
 
"BLD",9613,"KRN","B",870,870)
 
"BLD",9613,"KRN","B",8989.51,8989.51)
 
"BLD",9613,"KRN","B",8989.52,8989.52)
 
"BLD",9613,"KRN","B",8994,8994)
 
"BLD",9613,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9613,"QUES",0)
^9.62^^
"BLD",9613,"REQB",0)
^9.611^3^3
"BLD",9613,"REQB",1,0)
LR*5.2*315^2
"BLD",9613,"REQB",2,0)
LR*5.2*416^2
"BLD",9613,"REQB",3,0)
LR*5.2*427^2
"BLD",9613,"REQB","B","LR*5.2*315",1)
 
"BLD",9613,"REQB","B","LR*5.2*416",2)
 
"BLD",9613,"REQB","B","LR*5.2*427",3)
 
"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)
 
"PKG",26,20,"B",2,1)
 
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950611
"PKG",26,22,1,"PAH",1,0)
464^3160926
"PKG",26,22,1,"PAH",1,1,0)
^^12^12^3160926
"PKG",26,22,1,"PAH",1,1,1,0)
The NSR20140715 Surgical Pathology Report Enhancements for Readability 
"PKG",26,22,1,"PAH",1,1,2,0)
intake modifies the Laboratory Surgical Pathology report by lining up the 
"PKG",26,22,1,"PAH",1,1,3,0)
columns so that the report is more legible. 
"PKG",26,22,1,"PAH",1,1,4,0)
 
"PKG",26,22,1,"PAH",1,1,5,0)
This intake has been implemented locally at the Kansas City, Kansas VAMC. 
"PKG",26,22,1,"PAH",1,1,6,0)
 
"PKG",26,22,1,"PAH",1,1,7,0)
The NSR for this intake addresses the following requirement: 
"PKG",26,22,1,"PAH",1,1,8,0)
 
"PKG",26,22,1,"PAH",1,1,9,0)
* VHBAO: NEED502503 Surgical Pathology Report Enhancement: As a health 
"PKG",26,22,1,"PAH",1,1,10,0)
care provider, I need to view the Laboratory Surgical Pathology Report 
"PKG",26,22,1,"PAH",1,1,11,0)
columns in-line, so the report is legible and I can provide timely care 
"PKG",26,22,1,"PAH",1,1,12,0)
for the patient. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","LR7OSAP1")
0^1^B26708741^B26800282
"RTN","LR7OSAP1",1,0)
LR7OSAP1 ;slc/dcm/wty/kll - Silent AP rpt cont. ;3/28/2002
"RTN","LR7OSAP1",2,0)
 ;;5.2;LAB SERVICE;**121,227,230,259,317,315,464**;Sep 27, 1994;Build 12
"RTN","LR7OSAP1",3,0)
 Q:'$D(^XUSEC("LRLAB",DUZ))
"RTN","LR7OSAP1",4,0)
 D LN
"RTN","LR7OSAP1",5,0)
 S $P(LR("%"),"-",GIOM)="",^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR("%"))
"RTN","LR7OSAP1",6,0)
 D LN
"RTN","LR7OSAP1",7,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"SNOMED/ICD codes:")
"RTN","LR7OSAP1",8,0)
 S C=0
"RTN","LR7OSAP1",9,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,2,C)) Q:'C  S T=+^(C,0),T=^LAB(61,T,0) D
"RTN","LR7OSAP1",10,0)
 . D LN
"RTN","LR7OSAP1",11,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"T-"_$P(T,"^",2)_": "),X=$P(T,"^")
"RTN","LR7OSAP1",12,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",13,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",14,0)
 . D M
"RTN","LR7OSAP1",15,0)
 D LINE^LR7OSUM4
"RTN","LR7OSAP1",16,0)
 N LRX
"RTN","LR7OSAP1",17,0)
 S C=0
"RTN","LR7OSAP1",18,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,3,C)) Q:'C  S LRX=+^(C,0) D
"RTN","LR7OSAP1",19,0)
 . S LRX=$$ICDDX^ICDCODE(LRX,,,1)
"RTN","LR7OSAP1",20,0)
 . I +LRX=-1 Q
"RTN","LR7OSAP1",21,0)
 . D LN
"RTN","LR7OSAP1",22,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"ICD code: "_$P(LRX,"^",2))
"RTN","LR7OSAP1",23,0)
 . S X=$P(LRX,"^",4)
"RTN","LR7OSAP1",24,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",25,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(20,CCNT,X)
"RTN","LR7OSAP1",26,0)
 Q
"RTN","LR7OSAP1",27,0)
M ;
"RTN","LR7OSAP1",28,0)
 S B=0
"RTN","LR7OSAP1",29,0)
 F  S B=$O(^LR(LRDFN,LRSS,LRI,2,C,2,B)) Q:'B  S M=+^(B,0),M=$G(^LAB(61.1,M,0)) I $L(M) D
"RTN","LR7OSAP1",30,0)
 . D LN
"RTN","LR7OSAP1",31,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,"M-"_$P(M,"^",2)_": "),X=$P(M,"^")
"RTN","LR7OSAP1",32,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",33,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",34,0)
 . D EX
"RTN","LR7OSAP1",35,0)
 F B=1.4,3.3,4.5 S F=0 F  S F=$O(^LR(LRDFN,LRSS,LRI,2,C,$P(B,"."),F)) Q:'F  D A
"RTN","LR7OSAP1",36,0)
 Q
"RTN","LR7OSAP1",37,0)
A ;
"RTN","LR7OSAP1",38,0)
 S M=+^LR(LRDFN,LRSS,LRI,2,C,$P(B,"."),F,0),E="61."_$P(B,".",2),M=^LAB(E,M,0)
"RTN","LR7OSAP1",39,0)
 D LN
"RTN","LR7OSAP1",40,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$S(B=1.4:"D-",B=3.3:"F-",B=4.5:"P-",1:"")_$P(M,"^",2)),X=$P(M,"^")
"RTN","LR7OSAP1",41,0)
 D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",42,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_": "_X
"RTN","LR7OSAP1",43,0)
 Q
"RTN","LR7OSAP1",44,0)
EX ;
"RTN","LR7OSAP1",45,0)
 S G=0
"RTN","LR7OSAP1",46,0)
 F  S G=$O(^LR(LRDFN,LRSS,LRI,2,C,2,B,1,G)) Q:'G  S E=+^(G,0),E=$G(^LAB(61.2,E,0)) I $L(E) D
"RTN","LR7OSAP1",47,0)
 . D LN
"RTN","LR7OSAP1",48,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(10,CCNT,"E-"_$P(E,"^",2)_": "),X=$P(E,"^")
"RTN","LR7OSAP1",49,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",50,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",51,0)
 Q
"RTN","LR7OSAP1",52,0)
LN ;Increment the counter
"RTN","LR7OSAP1",53,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSAP1",54,0)
 Q
"RTN","LR7OSAP1",55,0)
MOD ;Modified report stuff
"RTN","LR7OSAP1",56,0)
 N A,B
"RTN","LR7OSAP1",57,0)
 D LN
"RTN","LR7OSAP1",58,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(28,CCNT,"*+* MODIFIED REPORT *+*")
"RTN","LR7OSAP1",59,0)
 D LN
"RTN","LR7OSAP1",60,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Last modified: ")
"RTN","LR7OSAP1",61,0)
 S B=0
"RTN","LR7OSAP1",62,0)
 F A=0:0 S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A  S B=A
"RTN","LR7OSAP1",63,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,LR(0),B,0))  S A=^(0),Y=+A,A=$P(A,"^",2),A=$P($G(^VA(200,A,0),A),"^")
"RTN","LR7OSAP1",64,0)
 D D^LRU
"RTN","LR7OSAP1",65,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_Y_" typed by "_A_")"
"RTN","LR7OSAP1",66,0)
 D:$D(LRQ(9)) M1
"RTN","LR7OSAP1",67,0)
 Q
"RTN","LR7OSAP1",68,0)
MODSR ;Modified Supplementary Report Audit Info
"RTN","LR7OSAP1",69,0)
 N LRTEXT,LRSP1,LRSP2,LRFILE,LRIENS,LRR1,LRR2
"RTN","LR7OSAP1",70,0)
 S LRFILE=$S(LRSS="CY":63.9072,LRSS="SP":63.8172,LRSS="EM":63.2072,1:"")
"RTN","LR7OSAP1",71,0)
 Q:LRFILE=""
"RTN","LR7OSAP1",72,0)
 D LN
"RTN","LR7OSAP1",73,0)
 S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED"
"RTN","LR7OSAP1",74,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP1",75,0)
 D LN
"RTN","LR7OSAP1",76,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Added/Last modified: ")
"RTN","LR7OSAP1",77,0)
 S LRIENS=C_","_LRI_","_LRDFN_","
"RTN","LR7OSAP1",78,0)
 S LRSP1=0
"RTN","LR7OSAP1",79,0)
 F  S LRSP1=$O(^LR(LRDFN,LRSS,LRI,1.2,C,2,LRSP1)) Q:'LRSP1  D
"RTN","LR7OSAP1",80,0)
 .S LRSP2=LRSP1
"RTN","LR7OSAP1",81,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,C,2,LRSP2,0))
"RTN","LR7OSAP1",82,0)
 S LRS2=^(0),Y=+LRS2,LRS2A=$P(LRS2,"^",2),LRSGN=" typed by "
"RTN","LR7OSAP1",83,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LR7OSAP1",84,0)
 I $P(LRS2,"^",3) S Y=$P(LRS2,"^",4),LRS2A=$P(LRS2,"^",3),LRSGN=" signed by "
"RTN","LR7OSAP1",85,0)
 D D^LRU
"RTN","LR7OSAP1",86,0)
 S LRS2A=$S($D(^VA(200,LRS2A,0)):$P(^(0),"^"),1:LRS2A)
"RTN","LR7OSAP1",87,0)
 S LRR1=Y,LRR2=LRS2A
"RTN","LR7OSAP1",88,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_LRR1_LRSGN_LRR2_")"
"RTN","LR7OSAP1",89,0)
 ;If RELEASED SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LR7OSAP1",90,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,C,0),"^",3)=1 D
"RTN","LR7OSAP1",91,0)
 .D LN
"RTN","LR7OSAP1",92,0)
 .S LRTEXT="NOT VERIFIED"
"RTN","LR7OSAP1",93,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(25,CCNT,"**-* "_LRTEXT_" *-**")
"RTN","LR7OSAP1",94,0)
 Q
"RTN","LR7OSAP1",95,0)
M1 ;
"RTN","LR7OSAP1",96,0)
 S A=0
"RTN","LR7OSAP1",97,0)
 F  S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A  S LRT=^(A,0),Y=+LRT,X=$P(LRT,"^",2),X=$P($G(^VA(200,X,0),X),"^") D
"RTN","LR7OSAP1",98,0)
 . D D^LRU,LN
"RTN","LR7OSAP1",99,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Date modified:"_Y_" typed by "_X)
"RTN","LR7OSAP1",100,0)
 . D F
"RTN","LR7OSAP1",101,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(13,CCNT,"==========Text below appears on final report==========")
"RTN","LR7OSAP1",102,0)
 Q
"RTN","LR7OSAP1",103,0)
 ;
"RTN","LR7OSAP1",104,0)
F ;
"RTN","LR7OSAP1",105,0)
 S B=0
"RTN","LR7OSAP1",106,0)
 F  S B=$O(^LR(LRDFN,LRSS,LRI,LR(0),A,1,B)) Q:'B  S LRT=^(B,0),X=LRT D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSAP1",107,0)
 Q
"RTN","LR7OSAP1",108,0)
WRAP(ROOT,FMT) ;Wrap text
"RTN","LR7OSAP1",109,0)
 I '$L($G(ROOT)) Q ""
"RTN","LR7OSAP1",110,0)
 S:'$G(FMT) FMT=79
"RTN","LR7OSAP1",111,0)
 N X,LRI,LRTX,LRINDX
"RTN","LR7OSAP1",112,0)
 S LRINDX=0,LRI=0
"RTN","LR7OSAP1",113,0)
 F  S LRI=$O(@ROOT@(LRI)) Q:LRI'>0  D
"RTN","LR7OSAP1",114,0)
 . S X=$S($L($G(@ROOT@(LRI))):@ROOT@(LRI),$L($G(@ROOT@(LRI,0))):@ROOT@(LRI,0),1:""),LRINDX=LRINDX+1
"RTN","LR7OSAP1",115,0)
 . S LRTX(LRI)=X
"RTN","LR7OSAP1",116,0)
 S LRI=0
"RTN","LR7OSAP1",117,0)
 F  S LRI=$O(LRTX(LRI)) Q:'LRI  D LN^LR7OSAP S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LRTX(LRI))
"RTN","LR7OSAP1",118,0)
 Q
"RTN","LR7OSAP1",119,0)
FMT(LENGTH,INDEX,TEXT) ;Format text
"RTN","LR7OSAP1",120,0)
 N X,Y,J
"RTN","LR7OSAP1",121,0)
 S Y=1
"RTN","LR7OSAP1",122,0)
 S:'$D(LRTX(INDEX)) LRTX(INDEX)=""
"RTN","LR7OSAP1",123,0)
 S X=$L(TEXT)+$L(LRTX(INDEX))+1
"RTN","LR7OSAP1",124,0)
 I X<255 S TEXT=$S($L(LRTX(INDEX)):LRTX(INDEX)_" "_TEXT,1:TEXT)
"RTN","LR7OSAP1",125,0)
 I X'<255 S INDEX=INDEX+1,LRTX(INDEX)=""
"RTN","LR7OSAP1",126,0)
 S LRTX(INDEX)=""
"RTN","LR7OSAP1",127,0)
 F J=1:1 S X=$P(TEXT," ",J) Q:J>$L(TEXT," ")  D
"RTN","LR7OSAP1",128,0)
 . Q:'$L(X)
"RTN","LR7OSAP1",129,0)
 . I ($L(X)+$L(LRTX(INDEX)))>LENGTH S Y=1,INDEX=INDEX+1,LRTX(INDEX)=""
"RTN","LR7OSAP1",130,0)
 . S LRTX(INDEX)=$S(Y:X,1:LRTX(INDEX)_" "_X),Y=0
"RTN","LR7OSAP1",131,0)
 S LRTX(INDEX)=$$STRIP(LRTX(INDEX))
"RTN","LR7OSAP1",132,0)
 Q INDEX
"RTN","LR7OSAP1",133,0)
STRIP(TEXT) ; Strips white space from text
"RTN","LR7OSAP1",134,0)
 N LRI,LRX
"RTN","LR7OSAP1",135,0)
 S LRX="" F LRI=1:1:$L(TEXT," ") S:$A($P(TEXT," ",LRI))>0 LRX=LRX_$S(LRI=1:"",1:" ")_$P(TEXT," ",LRI)
"RTN","LR7OSAP1",136,0)
 S TEXT=LRX
"RTN","LR7OSAP1",137,0)
 Q TEXT
"RTN","LRAPAUSR")
0^5^B35041396^B34793694
"RTN","LRAPAUSR",1,0)
LRAPAUSR ;AVAMC/REG/WTY - AUTOPSY SUPPLEMENTARY REPORT;9/14/01
"RTN","LRAPAUSR",2,0)
 ;;5.2;LAB SERVICE;**1,173,248,259,317,464**;Sep 27, 1994;Build 12
"RTN","LRAPAUSR",3,0)
 ;
"RTN","LRAPAUSR",4,0)
 ;Reference to ^DD(63 supported by IA #10155
"RTN","LRAPAUSR",5,0)
 ;
"RTN","LRAPAUSR",6,0)
 S X="T",%DT="" D ^%DT,D^LRU S LRH(3)=Y,LRFLG=1
"RTN","LRAPAUSR",7,0)
 W !!,LRO(68)," Autopsy Supplementary Reports" D XR^LRU
"RTN","LRAPAUSR",8,0)
 S LRS(1)=$P(^LRO(69.2,LRAA,0),U,3),LRS(2)=$P(^(0),U,4)
"RTN","LRAPAUSR",9,0)
 D EN2^LRUA
"RTN","LRAPAUSR",10,0)
 G END:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRAPAUSR",11,0)
 S XTMP="Someone else is building a print queue for this Accession Area"
"RTN","LRAPAUSR",12,0)
 L +^LRO(69.2,LRAA,3):5 I '$T D EN^DDIOL(XTMP,"","$C(7),!!") K XTMP Q
"RTN","LRAPAUSR",13,0)
GETP ;Add a patient to the report queue
"RTN","LRAPAUSR",14,0)
 W ! S X="" D ^LRUPS G GETP:LRAN["?" I LRAN=-1 L -^LRO(69.2,LRAA,3) Q
"RTN","LRAPAUSR",15,0)
 S FDAIEN(2)=LRAN
"RTN","LRAPAUSR",16,0)
 S FDA(1,69.29,"+2,"_+LRAA_",",.01)=LRDFN
"RTN","LRAPAUSR",17,0)
 D UPDATE^DIE("","FDA(1)","FDAIEN") K FDAIEN G GETP
"RTN","LRAPAUSR",18,0)
CH I '$O(^LRO(69.2,LRAA,3,0)) D  Q
"RTN","LRAPAUSR",19,0)
 .W $C(7),!!,"No AUTOPSY SUPPLEMENTARY REPORTS currently on the "
"RTN","LRAPAUSR",20,0)
 .W "print queue.",!!
"RTN","LRAPAUSR",21,0)
SPC R !,"(D)ouble or (S)ingle spacing of report(s): ",X:DTIME
"RTN","LRAPAUSR",22,0)
 Q:X=""!(X[U)
"RTN","LRAPAUSR",23,0)
 I $E(X)'="D"&($E(X)'="S") D  G SPC
"RTN","LRAPAUSR",24,0)
 .W $C(7),!,"Enter 'S' for single or 'D' for double spacing of reports"
"RTN","LRAPAUSR",25,0)
 S LRS=$S(X="D":"D",1:"")_"W" Q:LRAPX=3
"RTN","LRAPAUSR",26,0)
 W !!,"Save supplementary report list for reprinting "
"RTN","LRAPAUSR",27,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRAPAUSR",28,0)
DEV ;
"RTN","LRAPAUSR",29,0)
 W !
"RTN","LRAPAUSR",30,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRAPAUSR",31,0)
 I POP W ! Q
"RTN","LRAPAUSR",32,0)
 I $D(IO("Q")) D  Q
"RTN","LRAPAUSR",33,0)
 .S ZTDESC="ANAT PATH FINAL REPORT"
"RTN","LRAPAUSR",34,0)
 .S ZTSAVE("LR*")="",ZTRTN="QUE^LRAPAUSR"
"RTN","LRAPAUSR",35,0)
 .D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued, #",ZTSK W !
"RTN","LRAPAUSR",36,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","LRAPAUSR",37,0)
QUE U IO D L^LRU,S^LRU,EN^LRUA
"RTN","LRAPAUSR",38,0)
 ;LRSF515=1 indicates that an SF515 is being generated.
"RTN","LRAPAUSR",39,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRAPAUSR",40,0)
 S (LRS(5),LRAURPT)=1
"RTN","LRAPAUSR",41,0)
 I $D(LRAP) S LRDFN=LRAP D EN Q:LR("Q")  K LRAP G LST
"RTN","LRAPAUSR",42,0)
 F LRAN=0:0 S LRAN=$O(^LRO(69.2,LRAA,3,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRAPAUSR",43,0)
 .S LRDFN=+^(LRAN,0) D EN
"RTN","LRAPAUSR",44,0)
LST K:'$D(LRSAV) ^LRO(69.2,LRAA,3) K LRAURPT
"RTN","LRAPAUSR",45,0)
 S:'$D(^LRO(69.2,LRAA,3,0)) ^(0)="^69.29A^0^0"
"RTN","LRAPAUSR",46,0)
 I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRAPAUSR",47,0)
 K LRSAV D K^LRU
"RTN","LRAPAUSR",48,0)
 W:IOST?1"P-".E @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRAPAUSR",49,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRAPAUSR",50,0)
 Q
"RTN","LRAPAUSR",51,0)
W W !,LR("%") Q
"RTN","LRAPAUSR",52,0)
E K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF=LRS Q
"RTN","LRAPAUSR",53,0)
 ;
"RTN","LRAPAUSR",54,0)
EN S LRQ=0,X=^LR(LRDFN,0) Q:'$O(^LR(LRDFN,84,0))  D ^LRUP
"RTN","LRAPAUSR",55,0)
 I '$D(^LR(LRDFN,"AU")) L +^LRO(69.2,LRAA,3,LRAN):5 Q:'$T  D  Q
"RTN","LRAPAUSR",56,0)
 .S DIK="^LRO(69.2,LRAA,3,",DA=LRAN,DA(1)=0
"RTN","LRAPAUSR",57,0)
 .D ^DIK K KA,DIK
"RTN","LRAPAUSR",58,0)
 .L -^LRO(69.2,LRAA,3,LRAN)
"RTN","LRAPAUSR",59,0)
 S X=^LR(LRDFN,"AU"),LRAC=$P(X,"^",6),LRM(2)=$P(X,"^",7)
"RTN","LRAPAUSR",60,0)
 S LRM(1)=$P(X,"^",12),LRW(9)=$P(X,"^",13),LRM(3)=$P(X,"^",10)
"RTN","LRAPAUSR",61,0)
 S Y=$P(X,"^"),LRH(2)=$E(Y,2,3) D D^LRU S LRH(1)=Y
"RTN","LRAPAUSR",62,0)
 S LRLLOC=$P(X,"^",5),AGE=$P(X,"^",9)
"RTN","LRAPAUSR",63,0)
 ;Define the service
"RTN","LRAPAUSR",64,0)
 S Y=$P(X,"^",8),C=$P(^DD(63,14.5,0),U,3)
"RTN","LRAPAUSR",65,0)
 D Y^DIQ S LRSVC=Y
"RTN","LRAPAUSR",66,0)
 ;Define autopsy type
"RTN","LRAPAUSR",67,0)
 S Y=$P(X,"^",11),C=$P(^DD(63,13.7,0),U,3)
"RTN","LRAPAUSR",68,0)
 D Y^DIQ S LRS(3)=Y
"RTN","LRAPAUSR",69,0)
 S DA=LRDFN D D^LRAUAW S Y=LR(63,12) D D^LRU S LRH=Y,X=LRM(1)
"RTN","LRAPAUSR",70,0)
 D:X D^LRUA S LRM(1)=X,X=LRM(2) D:X D^LRUA S LRM(2)=X,X=LRM(3)
"RTN","LRAPAUSR",71,0)
 D:X D^LRUA S LRM(3)=X
"RTN","LRAPAUSR",72,0)
 D H Q:LR("Q")  S LR("F")=1
"RTN","LRAPAUSR",73,0)
 W:LRH(1)="" !?20,"+*+* REPORT INCOMPLETE *+*+"
"RTN","LRAPAUSR",74,0)
 S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA!(LR("Q"))  D
"RTN","LRAPAUSR",75,0)
 .S LRB=^LR(LRDFN,84,LRA,0)
"RTN","LRAPAUSR",76,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",77,0)
 .W !!,"SUPPLEMENTARY REPORT DATE: "
"RTN","LRAPAUSR",78,0)
 .S Y=LRB D D^LRU W Y
"RTN","LRAPAUSR",79,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",80,0)
 .D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA
"RTN","LRAPAUSR",81,0)
 .D WRT
"RTN","LRAPAUSR",82,0)
 Q:LR("Q")  D FT Q
"RTN","LRAPAUSR",83,0)
WRT D E S LRC=0
"RTN","LRAPAUSR",84,0)
 S DIWF="X"   ;464
"RTN","LRAPAUSR",85,0)
 F LRZ=0:1 S LRC=$O(^LR(LRDFN,84,LRA,1,LRC)) Q:'LRC!(LR("Q"))  D
"RTN","LRAPAUSR",86,0)
 .D:$Y>(IOSL-13) FT,H S LR("F")=1 Q:LR("Q")
"RTN","LRAPAUSR",87,0)
 .S X=^LR(LRDFN,84,LRA,1,LRC,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRAPAUSR",88,0)
 Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRAPAUSR",89,0)
 Q
"RTN","LRAPAUSR",90,0)
SUPA ;Print supplementary report audit information
"RTN","LRAPAUSR",91,0)
 W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED*+*"
"RTN","LRAPAUSR",92,0)
 W !,"(Added/Last modified: "
"RTN","LRAPAUSR",93,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRAPAUSR",94,0)
 .S B=A
"RTN","LRAPAUSR",95,0)
 Q:LR("Q")
"RTN","LRAPAUSR",96,0)
 Q:'$D(^LR(LRDFN,84,LRA,2,B,0))
"RTN","LRAPAUSR",97,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",A2=$P(A,"^",2)
"RTN","LRAPAUSR",98,0)
 I $P(A,"^",3) D
"RTN","LRAPAUSR",99,0)
 .S LRSGN=" signed by ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRAPAUSR",100,0)
 S A2=$S($D(^VA(200,A2,0)):$P(^(0),"^"),1:A2)
"RTN","LRAPAUSR",101,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPAUSR",102,0)
 D D^LRU W Y,LRSGN,A2,")"
"RTN","LRAPAUSR",103,0)
 ;If RELEASE SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LRAPAUSR",104,0)
 I $P(^LR(LRDFN,84,LRA,0),"^",3) W !,?25,"**-* NOT VERIFIED *-**"
"RTN","LRAPAUSR",105,0)
 D:$D(LRQ(9)) SUPM
"RTN","LRAPAUSR",106,0)
 Q
"RTN","LRAPAUSR",107,0)
SUPM ;Print previous versions of supplementary reports
"RTN","LRAPAUSR",108,0)
 ;This is used by menu option 'Print path modifications [LRAPMOD]'
"RTN","LRAPAUSR",109,0)
 ;
"RTN","LRAPAUSR",110,0)
 S A=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRAPAUSR",111,0)
 .S LRT=^LR(LRDFN,84,LRA,2,A,0)
"RTN","LRAPAUSR",112,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",113,0)
 .S Y=+LRT,Y2="modified: ",X=$P(LRT,"^",2),LRSGN="  typed by "
"RTN","LRAPAUSR",114,0)
 .;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPAUSR",115,0)
 .I $P(LRT,"^",3) S LRSGN=" signed by",X=$P(LRT,"^",3),Y=$P(LRT,"^",4),Y2="released: "
"RTN","LRAPAUSR",116,0)
 .S X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRAPAUSR",117,0)
 .D D^LRU W !,"Date ",Y2,Y,LRSGN,X
"RTN","LRAPAUSR",118,0)
 .K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRAPAUSR",119,0)
 .S B=0
"RTN","LRAPAUSR",120,0)
 .F LRZ=0:1 S B=$O(^LR(LRDFN,84,LRA,2,A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRAPAUSR",121,0)
 ..S LRT=^LR(LRDFN,84,LRA,2,A,1,B,0)
"RTN","LRAPAUSR",122,0)
 ..D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",123,0)
 ..S X=LRT D ^DIWP
"RTN","LRAPAUSR",124,0)
 .Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRAPAUSR",125,0)
 Q:LR("Q")
"RTN","LRAPAUSR",126,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRAPAUSR",127,0)
 Q
"RTN","LRAPAUSR",128,0)
H ;Header
"RTN","LRAPAUSR",129,0)
 I $D(LR("F")),IOST?1"C".E D CONT  Q:LR("Q")
"RTN","LRAPAUSR",130,0)
 W:($D(LR("F"))) @IOF
"RTN","LRAPAUSR",131,0)
 S LRQ=LRQ+1
"RTN","LRAPAUSR",132,0)
 ;W:IOST?1"C".E!(IOST'?1"C".E&('$D(LRFLG))) @IOF,!
"RTN","LRAPAUSR",133,0)
 ;K LRFLG
"RTN","LRAPAUSR",134,0)
 W ! D W
"RTN","LRAPAUSR",135,0)
 W !?5,"CLINICAL RECORD |",?40,"AUTOPSY SUPPLEMENTARY REPORT"
"RTN","LRAPAUSR",136,0)
 W ?73,"Pg ",LRQ,!,LR("%")
"RTN","LRAPAUSR",137,0)
 W !,"Date died: ",LRH,?40,"| Autopsy date: ",LRH(1)
"RTN","LRAPAUSR",138,0)
 W !,"Resident: ",LRM(2),?40,"| ",LRS(3)
"RTN","LRAPAUSR",139,0)
 W ?56,"Autopsy No. ",$S(LRQ(8)]"":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAPAUSR",140,0)
 W !,LR("%")
"RTN","LRAPAUSR",141,0)
 Q
"RTN","LRAPAUSR",142,0)
FT ;Footer
"RTN","LRAPAUSR",143,0)
 Q:LR("Q")
"RTN","LRAPAUSR",144,0)
 I IOSL'>66 F  Q:$Y>(IOSL-13)  W !
"RTN","LRAPAUSR",145,0)
 D W W !!,"Pathologist: ",LRM(3),?52,LRW(9),?55,"| Date ",$E(LRH(3),1,12)
"RTN","LRAPAUSR",146,0)
 D W W !,LRQ(1),?(IOM-30),"AUTOPSY SUPPLEMENTARY REPORT"
"RTN","LRAPAUSR",147,0)
 W !,$E(LRP,1,30),?31,SSN,?49,"SEX:",SEX,?55,"DOB:",DOB,!,LRLLOC
"RTN","LRAPAUSR",148,0)
 W ?31,LRM(1),?55,"AGE AT DEATH: ",AGE
"RTN","LRAPAUSR",149,0)
 Q
"RTN","LRAPAUSR",150,0)
SGL ;Entry point for printing single report
"RTN","LRAPAUSR",151,0)
 S X="" D ^LRUPS G:LRAN="?" SGL Q:LRAN=-1
"RTN","LRAPAUSR",152,0)
 I $D(LR("AU1")),'$P(^LR(LRDFN,"AU"),U,15) D  Q
"RTN","LRAPAUSR",153,0)
 .W $C(7),!!,"Report not verified."
"RTN","LRAPAUSR",154,0)
 D SPC Q:X=""!(X[U)
"RTN","LRAPAUSR",155,0)
 S LRAP=LRDFN,LRSAV=1
"RTN","LRAPAUSR",156,0)
 D EN2^LRUA
"RTN","LRAPAUSR",157,0)
 G DEV
"RTN","LRAPAUSR",158,0)
CONT ;
"RTN","LRAPAUSR",159,0)
 K DIR S DIR(0)="E"
"RTN","LRAPAUSR",160,0)
 D ^DIR W !
"RTN","LRAPAUSR",161,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRAPAUSR",162,0)
 Q
"RTN","LRAPAUSR",163,0)
END ;
"RTN","LRAPAUSR",164,0)
 W $C(7),!!,"OK to delete the AUTOPSY SUPPLEMENTARY REPORT list "
"RTN","LRAPAUSR",165,0)
 S %=2 D YN^LRU
"RTN","LRAPAUSR",166,0)
 I %=1 K ^LRO(69.2,LRAA,3) S ^LRO(69.2,LRAA,3,0)="^69.29A^0^0" D  Q
"RTN","LRAPAUSR",167,0)
 .W $C(7),!,"LIST DELETED !",!
"RTN","LRAPAUSR",168,0)
 W !!,"OK, LET'S FORGET IT.",!
"RTN","LRAPAUSR",169,0)
 Q
"RTN","LRAPAUSR",170,0)
TOP S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2)
"RTN","LRAPAUSR",171,0)
 D FT,H S X=Z,LR("F")=1
"RTN","LRAPAUSR",172,0)
 Q
"RTN","LRAPBR1")
0^3^B133918664^B133054463
"RTN","LRAPBR1",1,0)
LRAPBR1 ;DALOI/STAFF - AP Browser Print Cont. ; 26 Jul 2016  5:01 PM
"RTN","LRAPBR1",2,0)
 ;;5.2;LAB SERVICE;**259,317,363,350,427,464**;Sep 27, 1994;Build 12
"RTN","LRAPBR1",3,0)
 ;
"RTN","LRAPBR1",4,0)
 ;
"RTN","LRAPBR1",5,0)
ENTER ; from LRAPBR
"RTN","LRAPBR1",6,0)
 N LRCNT,LRTMP,LRA1,LRADESC,LRLENG1,LRLENG2,LRFILE,LRAPMD
"RTN","LRAPBR1",7,0)
 N LRFLD,LRV,LRV1,LRV2,LRX,LRB1,LRTEXT,LRSPCE,LRIENS,LRAPMR
"RTN","LRAPBR1",8,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,0))
"RTN","LRAPBR1",9,0)
 S:'LRTIU GROOT="^TMP(""LRAPBR"",$J,"
"RTN","LRAPBR1",10,0)
 S:LRTIU GROOT="^TMP(""TIUP"",$J,"
"RTN","LRAPBR1",11,0)
 ;
"RTN","LRAPBR1",12,0)
 D GETPCP^LRAPUTL(.LRPRAC,LRDFN,LRSS,LRI)
"RTN","LRAPBR1",13,0)
 ;
"RTN","LRAPBR1",14,0)
 ; If reporting lab available then use instead of VistA site name.
"RTN","LRAPBR1",15,0)
 S LRX=+$G(^LR(LRDFN,LRSS,LRI,"RF"))
"RTN","LRAPBR1",16,0)
 I LRX S LRQ(1)=$$NAME^XUAF4(LRX)
"RTN","LRAPBR1",17,0)
 ;
"RTN","LRAPBR1",18,0)
 S LRQ=0 D ^LRUA,HEADER
"RTN","LRAPBR1",19,0)
 S LR("F")=1
"RTN","LRAPBR1",20,0)
 D DASH
"RTN","LRAPBR1",21,0)
 D:LRTIU GLENTRY("$TEXT",,1)
"RTN","LRAPBR1",22,0)
 D GLENTRY("Submitted by: "_LRW(5),"",1)
"RTN","LRAPBR1",23,0)
 D GLENTRY("Date obtained: "_LRTK,44)
"RTN","LRAPBR1",24,0)
 D:LRA DASH
"RTN","LRAPBR1",25,0)
 ;
"RTN","LRAPBR1",26,0)
 S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",27,0)
 ;
"RTN","LRAPBR1",28,0)
 ;
"RTN","LRAPBR1",29,0)
MAIN ;
"RTN","LRAPBR1",30,0)
 D SPEC
"RTN","LRAPBR1",31,0)
 D MODCHK
"RTN","LRAPBR1",32,0)
 D SUPBNNR
"RTN","LRAPBR1",33,0)
 ; DALOI/LMT - LR,427 - Removed comments from report to restore pre-LR,350 behavior
"RTN","LRAPBR1",34,0)
 ;D COMMENT
"RTN","LRAPBR1",35,0)
 D DIAG
"RTN","LRAPBR1",36,0)
 D DOC
"RTN","LRAPBR1",37,0)
 D WPFLD
"RTN","LRAPBR1",38,0)
 D SUPRPT
"RTN","LRAPBR1",39,0)
 D SSJR
"RTN","LRAPBR1",40,0)
 Q
"RTN","LRAPBR1",41,0)
 ;
"RTN","LRAPBR1",42,0)
 ;
"RTN","LRAPBR1",43,0)
SPEC ; List specimens
"RTN","LRAPBR1",44,0)
 ;
"RTN","LRAPBR1",45,0)
 ;ZEXCEPT: LRDFN,LRI,LRIENS,LRSF,LRSS
"RTN","LRAPBR1",46,0)
 ;
"RTN","LRAPBR1",47,0)
 N LRB,LRFILE,LRX
"RTN","LRAPBR1",48,0)
 ;
"RTN","LRAPBR1",49,0)
 D GLENTRY("Specimen (Received "_LRTK(1)_"):","",1)
"RTN","LRAPBR1",50,0)
 ;
"RTN","LRAPBR1",51,0)
 S LRFILE=+$$GET1^DID(LRSF,.012,"","SPECIFIER")
"RTN","LRAPBR1",52,0)
 S LRB=0
"RTN","LRAPBR1",53,0)
 F  S LRB=$O(^LR(LRDFN,LRSS,LRI,.1,LRB)) Q:LRB<1  D
"RTN","LRAPBR1",54,0)
 . S LRX=$$GET1^DIQ(LRFILE,LRB_","_LRIENS,.01)
"RTN","LRAPBR1",55,0)
 . D GLENTRY(LRX,"",1)
"RTN","LRAPBR1",56,0)
 ;
"RTN","LRAPBR1",57,0)
 Q
"RTN","LRAPBR1",58,0)
 ;
"RTN","LRAPBR1",59,0)
 ;
"RTN","LRAPBR1",60,0)
MODCHK ; Display modified banner if required
"RTN","LRAPBR1",61,0)
 S LRAPMR=$$GET1^DIQ(LRSF,LRIENS,.17,"I")
"RTN","LRAPBR1",62,0)
 Q:'LRAPMR
"RTN","LRAPBR1",63,0)
 S LRAPMD=$$GET1^DIQ(LRSF,LRIENS,.172,"I")
"RTN","LRAPBR1",64,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",65,0)
 S LRTEXT=""
"RTN","LRAPBR1",66,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR1",67,0)
 . S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR1",68,0)
 S LRTEXT=LRTEXT_" MODIFIED "
"RTN","LRAPBR1",69,0)
 S LRTEXT=LRTEXT_$S(LRAPMD:"DIAGNOSIS ",1:"REPORT ")
"RTN","LRAPBR1",70,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR1",71,0)
 . S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR1",72,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR1",73,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",74,0)
 Q
"RTN","LRAPBR1",75,0)
 ;
"RTN","LRAPBR1",76,0)
 ;
"RTN","LRAPBR1",77,0)
SUPBNNR ; Display supplementary report header if one or more has been added
"RTN","LRAPBR1",78,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4) D
"RTN","LRAPBR1",79,0)
 . S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRAPBR1",80,0)
 . D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",81,0)
 . S LRTEXT="*+* REFER TO BOTTOM OF REPORT *+*"
"RTN","LRAPBR1",82,0)
 . D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",83,0)
 . D GLENTRY("","",1)
"RTN","LRAPBR1",84,0)
 Q
"RTN","LRAPBR1",85,0)
 ;
"RTN","LRAPBR1",86,0)
 ;
"RTN","LRAPBR1",87,0)
DIAG ; Display the Brief Clinical History, Preoperative Diagnosis, Operative Findings, and Postoperative Diagnosis
"RTN","LRAPBR1",88,0)
 S LRFILE=LRSF,LRCNT=0,LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",89,0)
 F LRFLD=.013:.001:.016 D
"RTN","LRAPBR1",90,0)
 . D:LRA DASH
"RTN","LRAPBR1",91,0)
 . S LRCNT=LRCNT+1
"RTN","LRAPBR1",92,0)
 . D GLENTRY($P($T(TEXT1+LRCNT),";",3),"",1)
"RTN","LRAPBR1",93,0)
 . D WP
"RTN","LRAPBR1",94,0)
 Q
"RTN","LRAPBR1",95,0)
 ;
"RTN","LRAPBR1",96,0)
 ;
"RTN","LRAPBR1",97,0)
DOC ; Pathologist information
"RTN","LRAPBR1",98,0)
 ;
"RTN","LRAPBR1",99,0)
 N LRIENS,LRX
"RTN","LRAPBR1",100,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",101,0)
 ;
"RTN","LRAPBR1",102,0)
 ; Retrieve surgeon/attending
"RTN","LRAPBR1",103,0)
 D ATTEND(.LRMD)
"RTN","LRAPBR1",104,0)
 D GLENTRY("Surgeon/physician: "_LRMD,27,1)
"RTN","LRAPBR1",105,0)
 I LRMD("SR-SURGEON")'="" D GLENTRY(LRMD("SR-SURGEON"),28,1)
"RTN","LRAPBR1",106,0)
 I LRMD("SR-ATTEND")'="" D GLENTRY(LRMD("SR-ATTEND"),26,1)
"RTN","LRAPBR1",107,0)
 ;I +$G(LRMD("ERR"))=601 D GLENTRY($P(LRMD("ERR"),"^",2),26,1)
"RTN","LRAPBR1",108,0)
 ;
"RTN","LRAPBR1",109,0)
 D:LRA GLENTRY(LR("%1"),"",1)
"RTN","LRAPBR1",110,0)
 D DASH
"RTN","LRAPBR1",111,0)
 D HEADER2
"RTN","LRAPBR1",112,0)
 D:LRA DASH
"RTN","LRAPBR1",113,0)
 I LRRC="" D
"RTN","LRAPBR1",114,0)
 . D GLENTRY("+*+* REPORT INCOMPLETE *+*+",20,1)
"RTN","LRAPBR1",115,0)
 . D GLENTRY("","",1)
"RTN","LRAPBR1",116,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",117,0)
 I LRRMD'="" D
"RTN","LRAPBR1",118,0)
 . S LRCNT=0 F LRA1="SP","CY","EM" D
"RTN","LRAPBR1",119,0)
 . . S LRCNT=LRCNT+1
"RTN","LRAPBR1",120,0)
 . . S LRTMP(LRA1)=$P($T(TEXT2+LRCNT),";",4)
"RTN","LRAPBR1",121,0)
 . S LRTMP=LRTMP(LRSS)
"RTN","LRAPBR1",122,0)
 . D GLENTRY(LRTMP_" "_LRRMD,31)
"RTN","LRAPBR1",123,0)
 Q
"RTN","LRAPBR1",124,0)
 ;
"RTN","LRAPBR1",125,0)
 ;
"RTN","LRAPBR1",126,0)
WPFLD ; Display Frozen Section, Gross Description, Microscopic Description and Surgical Path Diagnosis
"RTN","LRAPBR1",127,0)
 F LRCNT=1:1:4 D
"RTN","LRAPBR1",128,0)
 . S X=$T(FIELDS+LRCNT)
"RTN","LRAPBR1",129,0)
 . S LRV=$P(X,";",3),LRV1=$P(X,";",4),LRV2=$P(X,";",5)
"RTN","LRAPBR1",130,0)
 . D TEXTCHK
"RTN","LRAPBR1",131,0)
 . I $P($G(^LR(LRDFN,LRSS,LRI,LRV,0)),U,4) D
"RTN","LRAPBR1",132,0)
 . . D GLENTRY("","",1),GLENTRY(LR(69.2,LRV1),"",1)
"RTN","LRAPBR1",133,0)
 . . S LRFILE=LRSF,LRIENS=LRI_","_LRDFN_",",LRFLD=LRV
"RTN","LRAPBR1",134,0)
 . . I $P($G(^LR(LRDFN,LRSS,LRI,LRV2,0)),U,4) D
"RTN","LRAPBR1",135,0)
 . . . S LRFILE1=+$$GET1^DID(LRSF,LRV2,"","SPECIFIER")
"RTN","LRAPBR1",136,0)
 . . . D GLENTRY("*+* MODIFIED REPORT *+*",28,1)
"RTN","LRAPBR1",137,0)
 . . . D GLENTRY("(Last modified: ","",1)
"RTN","LRAPBR1",138,0)
 . . . S (LRA1,LRB1)=0
"RTN","LRAPBR1",139,0)
 . . . F  S LRA1=$O(^LR(LRDFN,LRSS,LRI,LRV2,LRA1)) Q:'LRA1  S LRB1=LRA1
"RTN","LRAPBR1",140,0)
 . . . Q:'$D(^LR(LRDFN,LRSS,LRI,LRV2,LRB1,0))
"RTN","LRAPBR1",141,0)
 . . . S LRSR1=$$GET1^DIQ(LRFILE1,LRB1_","_LRIENS,.01)
"RTN","LRAPBR1",142,0)
 . . . S LRSR2=$$GET1^DIQ(LRFILE1,LRB1_","_LRIENS,.02)
"RTN","LRAPBR1",143,0)
 . . . S LRTEXT=LRSR1_" typed by "_LRSR2_")"
"RTN","LRAPBR1",144,0)
 . . . D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR1",145,0)
 . . D WP
"RTN","LRAPBR1",146,0)
 Q
"RTN","LRAPBR1",147,0)
 ;
"RTN","LRAPBR1",148,0)
 ;
"RTN","LRAPBR1",149,0)
SUPRPT ; Supplementary Report
"RTN","LRAPBR1",150,0)
 N LRA2
"RTN","LRAPBR1",151,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4) D
"RTN","LRAPBR1",152,0)
 . S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPBR1",153,0)
 . S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPBR1",154,0)
 . D GLENTRY("","",1),GLENTRY("SUPPLEMENTARY REPORT(S):","",1)
"RTN","LRAPBR1",155,0)
 . S LRV=0 F  S LRV=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV)) Q:'LRV  D
"RTN","LRAPBR1",156,0)
 . . S LRIENS=LRV_","_LRIENS1
"RTN","LRAPBR1",157,0)
 . . S LRSR1=$$GET1^DIQ(LRFILE,LRIENS,.01)
"RTN","LRAPBR1",158,0)
 . . S LRSR2=+$$GET1^DIQ(LRFILE,LRIENS,.02)
"RTN","LRAPBR1",159,0)
 . . D GLENTRY("Supplementary Report Date: "_LRSR1,3,1)
"RTN","LRAPBR1",160,0)
 . . I $D(LR("R")),'LRSR2 D GLENTRY(" not verified",BTAB) Q
"RTN","LRAPBR1",161,0)
 . . I $P($G(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,0)),U,4) D
"RTN","LRAPBR1",162,0)
 . . . S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRAPBR1",163,0)
 . . . D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",164,0)
 . . . D GLENTRY("(Added/Last","",1)
"RTN","LRAPBR1",165,0)
 . . . S (LRA1,LRB1)=0
"RTN","LRAPBR1",166,0)
 . . . F  S LRA1=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,LRA1)) Q:'LRA1  D
"RTN","LRAPBR1",167,0)
 . . . . S LRB1=LRA1
"RTN","LRAPBR1",168,0)
 . . . Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,LRB1,0))
"RTN","LRAPBR1",169,0)
 . . . S LRA2=^(0),Y=+LRA2,LRA2A=$P(LRA2,"^",2),LRSGN=" Typed by ",LRDSC=" modified: "
"RTN","LRAPBR1",170,0)
 . . . I $P(LRA2,"^",3) S LRSGN=" Signed by ",LRDSC=" released: ",LRA2A=$P(LRA2,"^",3),Y=$P(LRA2,"^",4)
"RTN","LRAPBR1",171,0)
 . . . S LRA2A=$S($D(^VA(200,LRA2A,0)):$P(^(0),"^"),1:LRA2A)
"RTN","LRAPBR1",172,0)
 . . . D D^LRU
"RTN","LRAPBR1",173,0)
 . . . D GLENTRY(LRDSC_Y_LRSGN_LRA2A_")",BTAB)
"RTN","LRAPBR1",174,0)
 . . S LRFLD=1 D WP
"RTN","LRAPBR1",175,0)
 . . D GLENTRY("","",1)
"RTN","LRAPBR1",176,0)
 Q
"RTN","LRAPBR1",177,0)
 ;
"RTN","LRAPBR1",178,0)
 ;
"RTN","LRAPBR1",179,0)
COMMENT ; Print comment field (#99)
"RTN","LRAPBR1",180,0)
 ;
"RTN","LRAPBR1",181,0)
 N LRB
"RTN","LRAPBR1",182,0)
 I '$O(^LR(LRDFN,LRSS,LRI,99,0)) Q
"RTN","LRAPBR1",183,0)
 ;
"RTN","LRAPBR1",184,0)
 D GLENTRY("Comment:","",1)
"RTN","LRAPBR1",185,0)
 ;
"RTN","LRAPBR1",186,0)
 S LRB=0
"RTN","LRAPBR1",187,0)
 F  S LRB=$O(^LR(LRDFN,LRSS,LRI,99,LRB)) Q:'LRB  D
"RTN","LRAPBR1",188,0)
 . S LRB(0)=^LR(LRDFN,LRSS,LRI,99,LRB,0)
"RTN","LRAPBR1",189,0)
 . D GLENTRY(LRB(0),"",1)
"RTN","LRAPBR1",190,0)
 ;
"RTN","LRAPBR1",191,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",192,0)
 ;
"RTN","LRAPBR1",193,0)
 Q
"RTN","LRAPBR1",194,0)
 ;
"RTN","LRAPBR1",195,0)
 ;
"RTN","LRAPBR1",196,0)
SSJR ; Print special studies/journal references
"RTN","LRAPBR1",197,0)
 D ^LRAPBR3
"RTN","LRAPBR1",198,0)
 S LREFLG=1
"RTN","LRAPBR1",199,0)
 Q
"RTN","LRAPBR1",200,0)
 ;
"RTN","LRAPBR1",201,0)
 ;
"RTN","LRAPBR1",202,0)
PPL ; Print performing laboratories.
"RTN","LRAPBR1",203,0)
 N LRPL,LRJ
"RTN","LRAPBR1",204,0)
 ;
"RTN","LRAPBR1",205,0)
 D RETLST^LRRPL(.LRPL,LRDFN,LRSS,LRI,0)
"RTN","LRAPBR1",206,0)
 I $G(LRPL)<1 Q
"RTN","LRAPBR1",207,0)
 ;
"RTN","LRAPBR1",208,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",209,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",210,0)
 ;
"RTN","LRAPBR1",211,0)
 D GLENTRY("Performing Laboratory:","",1)
"RTN","LRAPBR1",212,0)
 S LRJ=0
"RTN","LRAPBR1",213,0)
 F  S LRJ=$O(LRPL(LRJ)) Q:'LRJ  D GLENTRY(LRPL(LRJ),"",1)
"RTN","LRAPBR1",214,0)
 ;
"RTN","LRAPBR1",215,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",216,0)
 ;
"RTN","LRAPBR1",217,0)
 Q
"RTN","LRAPBR1",218,0)
 ;
"RTN","LRAPBR1",219,0)
 ;
"RTN","LRAPBR1",220,0)
WP ; Display word processing fields
"RTN","LRAPBR1",221,0)
 K LRTMP,^UTILITY($J,"W")
"RTN","LRAPBR1",222,0)
 N X,DIWR,DIWL,LRINC
"RTN","LRAPBR1",223,0)
 S X=$$GET1^DIQ(LRFILE,LRIENS,LRFLD,"","LRTMP",)
"RTN","LRAPBR1",224,0)
 S DIWR=IOM-5,DIWL=5,DIWF=$G(DIWF)
"RTN","LRAPBR1",225,0)
 S X=+$$GET1^DID(LRFILE,LRFLD,"","SPECIFIER")
"RTN","LRAPBR1",226,0)
 I $$GET1^DID(X,.01,"","SPECIFIER")["L",DIWF'["N" S DIWF=DIWF_"N"
"RTN","LRAPBR1",227,0)
 I DIWF'["N" S DIWF=DIWF_"N"  ;LR*5.2*464
"RTN","LRAPBR1",228,0)
 S LRINC=0
"RTN","LRAPBR1",229,0)
 F  S LRINC=$O(LRTMP(LRINC)) Q:'LRINC  S X=LRTMP(LRINC) D ^DIWP
"RTN","LRAPBR1",230,0)
 S LRINC=0
"RTN","LRAPBR1",231,0)
 F  S LRINC=$O(^UTILITY($J,"W",DIWL,LRINC)) Q:'LRINC  D GLENTRY(^UTILITY($J,"W",DIWL,LRINC,0),DIWL,1)
"RTN","LRAPBR1",232,0)
 K ^UTILITY($J,"W")
"RTN","LRAPBR1",233,0)
 Q
"RTN","LRAPBR1",234,0)
 ;
"RTN","LRAPBR1",235,0)
 ;
"RTN","LRAPBR1",236,0)
HEADER ;
"RTN","LRAPBR1",237,0)
 D:LRTIU GLENTRY("$APHDR",,1)
"RTN","LRAPBR1",238,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",239,0)
 ;
"RTN","LRAPBR1",240,0)
 ; Print names of facilities printing/releasing this report.
"RTN","LRAPBR1",241,0)
 N LRN,LRPL,LRRL,LRX
"RTN","LRAPBR1",242,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")>1,'LRTIU D
"RTN","LRAPBR1",243,0)
 . D PFAC^LRRP1(DUZ(2),"",1,.LRPL)
"RTN","LRAPBR1",244,0)
 . S LRN=0
"RTN","LRAPBR1",245,0)
 . F  S LRN=$O(LRPL(LRN)) Q:'LRN  D GLENTRY(LRPL(LRN),"",1)
"RTN","LRAPBR1",246,0)
 ;
"RTN","LRAPBR1",247,0)
 ; Display reporting lab
"RTN","LRAPBR1",248,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")#2 D
"RTN","LRAPBR1",249,0)
 . S LRX=+$G(^LR(LRDFN,LRSS,LRI,"RF"))
"RTN","LRAPBR1",250,0)
 . I LRX<1 Q
"RTN","LRAPBR1",251,0)
 . D RL^LRRP1(LRX,1,.LRRL),GLENTRY("","",1)
"RTN","LRAPBR1",252,0)
 . S LRN=0
"RTN","LRAPBR1",253,0)
 . F  S LRN=$O(LRRL(LRN)) Q:'LRN  D GLENTRY(LRRL(LRN),"",1)
"RTN","LRAPBR1",254,0)
 ;
"RTN","LRAPBR1",255,0)
 D DASH
"RTN","LRAPBR1",256,0)
 D GLENTRY("MEDICAL RECORD |",5,1)
"RTN","LRAPBR1",257,0)
 D GLENTRY(LRAA1,40)
"RTN","LRAPBR1",258,0)
 D DASH
"RTN","LRAPBR1",259,0)
 ;
"RTN","LRAPBR1",260,0)
 ;
"RTN","LRAPBR1",261,0)
HEADER2 ;
"RTN","LRAPBR1",262,0)
 ;
"RTN","LRAPBR1",263,0)
 S LRADESC="Accession No. "_$S(LRQ(8)]"":LRQ(8)_LRW(1)_" "_LRAC,1:LRAC)
"RTN","LRAPBR1",264,0)
 S LRLENG1=$L(LRQ(1)),LRLENG2=$L(LRADESC),LRSPCE=IOM-LRLENG2-14
"RTN","LRAPBR1",265,0)
 S:LRLENG1>LRSPCE LRQ(1)=$E(LRQ(1),1,LRSPCE)
"RTN","LRAPBR1",266,0)
 ;
"RTN","LRAPBR1",267,0)
 D GLENTRY("PATHOLOGY REPORT",30,1)
"RTN","LRAPBR1",268,0)
 I '$G(^LR(LRDFN,LRSS,LRI,"RF")) D GLENTRY("Laboratory: "_LRQ(1),"",1)
"RTN","LRAPBR1",269,0)
 D GLENTRY(LRADESC,IOM-LRLENG2-1)
"RTN","LRAPBR1",270,0)
 Q
"RTN","LRAPBR1",271,0)
 ;
"RTN","LRAPBR1",272,0)
 ;
"RTN","LRAPBR1",273,0)
FOOTER ; Footer-called from ^LRAPBR
"RTN","LRAPBR1",274,0)
 D:LRTIU GLENTRY("$FTR",,1)
"RTN","LRAPBR1",275,0)
 D DASH
"RTN","LRAPBR1",276,0)
 S LRTEXT=$S('$D(LR("W")):"",1:"See signed copy in chart")
"RTN","LRAPBR1",277,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR1",278,0)
 S LRTEXT="("_$S($D(LREFLG):"End of report",1:"See next page")_")"
"RTN","LRAPBR1",279,0)
 D GLENTRY(LRTEXT,57)
"RTN","LRAPBR1",280,0)
 D GLENTRY(LRPMD,"",1),GLENTRY(LRW(9),52),GLENTRY("| Date "_LRRC,55)
"RTN","LRAPBR1",281,0)
 D DASH
"RTN","LRAPBR1",282,0)
 D GLENTRY(LRP,"",1)
"RTN","LRAPBR1",283,0)
 S LRTEXT=$S('$D(LR("W")):"STANDARD FORM 515",1:"WORK COPY ONLY !!")
"RTN","LRAPBR1",284,0)
 D GLENTRY(LRTEXT,50)
"RTN","LRAPBR1",285,0)
 D GLENTRY("ID:"_SSN,"",1)
"RTN","LRAPBR1",286,0)
 D GLENTRY("SEX:"_SEX,16),GLENTRY(" DOB:"_DOB,BTAB)
"RTN","LRAPBR1",287,0)
 I AGE D
"RTN","LRAPBR1",288,0)
 . S LRTEXT=$S($G(VADM(6))]"":" AGE AT DEATH: ",1:" AGE: ")_AGE
"RTN","LRAPBR1",289,0)
 . D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR1",290,0)
 D GLENTRY(" LOC:"_LRLLOC,BTAB)
"RTN","LRAPBR1",291,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",292,0)
 I LRADM'="" D GLENTRY("ADM:"_$P(LRADM,"@"),BTAB)
"RTN","LRAPBR1",293,0)
 I LRADX'="" D GLENTRY("DX:"_$E(LRADX,1,26),17)
"RTN","LRAPBR1",294,0)
 D GLENTRY("PCP:",46)
"RTN","LRAPBR1",295,0)
 I LRPRAC'="" D GLENTRY($E(LRPRAC(1),1,28),51)
"RTN","LRAPBR1",296,0)
 Q
"RTN","LRAPBR1",297,0)
 ;
"RTN","LRAPBR1",298,0)
 ;
"RTN","LRAPBR1",299,0)
ESIGLN ; Write signature block name, title, and date of signature
"RTN","LRAPBR1",300,0)
 D GLENTRY(,,1)
"RTN","LRAPBR1",301,0)
 I $D(^VA(200,DUZ,0)) D
"RTN","LRAPBR1",302,0)
 . S LRFILE=200,LRFLD=20.2,LRFLD2=20.3
"RTN","LRAPBR1",303,0)
 . S X=$$GET1^DIQ(LRFILE,DUZ,LRFLD)
"RTN","LRAPBR1",304,0)
 ; Compare DUZ to pathologist, if different, use proxy signature
"RTN","LRAPBR1",305,0)
 S:LRSS="AU" LRPATH=$$GET1^DIQ(63,LRDFN,13.6,"I")
"RTN","LRAPBR1",306,0)
 I LRSS'="AU" D
"RTN","LRAPBR1",307,0)
 . S LRFL2=$S(LRSS="EM":63.02,LRSS="CY":63.09,LRSS="SP":63.08,1:0)
"RTN","LRAPBR1",308,0)
 . S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",309,0)
 . S LRPATH=$$GET1^DIQ(LRFL2,LRIENS,.02,"I")
"RTN","LRAPBR1",310,0)
 S LRPATH2=""
"RTN","LRAPBR1",311,0)
 S:LRPATH'=DUZ LRPATH2=" FOR "_$$GET1^DIQ(LRFILE,LRPATH,LRFLD)
"RTN","LRAPBR1",312,0)
 S LRTEXT="/es/ "_X_LRPATH2
"RTN","LRAPBR1",313,0)
 ; S LRTEXT="/es/ "_X
"RTN","LRAPBR1",314,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",315,0)
 S LRTEXT=$$GET1^DIQ(LRFILE,DUZ,LRFLD2)
"RTN","LRAPBR1",316,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",317,0)
 S LRTEXT="Signed "_$$FMTE^XLFDT(LRNTIME,"1MZ")
"RTN","LRAPBR1",318,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",319,0)
 Q
"RTN","LRAPBR1",320,0)
 ;
"RTN","LRAPBR1",321,0)
 ;
"RTN","LRAPBR1",322,0)
DASH ; Display a line of dashes
"RTN","LRAPBR1",323,0)
 D GLENTRY(LR("%"),"",1)
"RTN","LRAPBR1",324,0)
 Q
"RTN","LRAPBR1",325,0)
 ;
"RTN","LRAPBR1",326,0)
 ;
"RTN","LRAPBR1",327,0)
GLENTRY(LRPR1,LRPR2,LRPR3) ; Write to global
"RTN","LRAPBR1",328,0)
 ; LRPR1 = Text to be written to global
"RTN","LRAPBR1",329,0)
 ; LRPR2 = Tab position
"RTN","LRAPBR1",330,0)
 ; LRPR3 = 1 means start a new line.  Otherwise, write an current line.
"RTN","LRAPBR1",331,0)
 S LRPR1=$G(LRPR1)
"RTN","LRAPBR1",332,0)
 S LRPR2=+$G(LRPR2)
"RTN","LRAPBR1",333,0)
 S LRPR3=+$G(LRPR3)
"RTN","LRAPBR1",334,0)
 D:LRPR3 NEWLN^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR1",335,0)
 D:'LRPR3 GLBWRT^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR1",336,0)
 Q
"RTN","LRAPBR1",337,0)
 ;
"RTN","LRAPBR1",338,0)
 ;
"RTN","LRAPBR1",339,0)
TEXT1 ;Text for top of report
"RTN","LRAPBR1",340,0)
 ;;BRIEF CLINICAL HISTORY:
"RTN","LRAPBR1",341,0)
 ;;PREOPERATIVE DIAGNOSIS:
"RTN","LRAPBR1",342,0)
 ;;OPERATIVE FINDINGS:
"RTN","LRAPBR1",343,0)
 ;;POSTOPERATIVE DIAGNOSIS:
"RTN","LRAPBR1",344,0)
 ;
"RTN","LRAPBR1",345,0)
TEXT2 ;Descriptive text based on section
"RTN","LRAPBR1",346,0)
 ;;SP;Pathology Resident:
"RTN","LRAPBR1",347,0)
 ;;CY;Screened by:
"RTN","LRAPBR1",348,0)
 ;;EM;Prepared by:
"RTN","LRAPBR1",349,0)
 ;
"RTN","LRAPBR1",350,0)
FIELDS ;Field numbers for word processing fields
"RTN","LRAPBR1",351,0)
 ;;1.3;.13;6
"RTN","LRAPBR1",352,0)
 ;;1;.03;7
"RTN","LRAPBR1",353,0)
 ;;1.1;.04;4
"RTN","LRAPBR1",354,0)
 ;;1.4;.14;5
"RTN","LRAPBR1",355,0)
 ;
"RTN","LRAPBR1",356,0)
TEXTCHK ; update text line counter if it is missing (Remedy 116253)
"RTN","LRAPBR1",357,0)
 N I,X,DATA
"RTN","LRAPBR1",358,0)
 S I=0
"RTN","LRAPBR1",359,0)
 K ^TMP("WP",$J)
"RTN","LRAPBR1",360,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,LRV,0))
"RTN","LRAPBR1",361,0)
 I X'="",$L(X,"^")=1 D
"RTN","LRAPBR1",362,0)
 . F  S I=$O(^LR(LRDFN,LRSS,LRI,LRV,I)) Q:I=""  D
"RTN","LRAPBR1",363,0)
 . . S DATA=$G(^LR(LRDFN,LRSS,LRI,LRV,I,0))
"RTN","LRAPBR1",364,0)
 . . S ^TMP("WP",$J,I,0)=DATA
"RTN","LRAPBR1",365,0)
 I $D(^TMP("WP",$J)) D
"RTN","LRAPBR1",366,0)
 . D WP^DIE(63.08,LRI_","_LRDFN_",",LRV,"","^TMP(""WP"",$J)")
"RTN","LRAPBR1",367,0)
 . K ^TMP("WP",$J)
"RTN","LRAPBR1",368,0)
 Q
"RTN","LRAPBR1",369,0)
 ;
"RTN","LRAPBR1",370,0)
 ;
"RTN","LRAPBR1",371,0)
ATTEND(LRMD) ; Retrieve surgeon/attending
"RTN","LRAPBR1",372,0)
 ; Call with LRMD = current ordering provider array, pass by reference
"RTN","LRAPBR1",373,0)
 ;
"RTN","LRAPBR1",374,0)
 ; Update ordering provider/surgeon if Surgery package indicates change
"RTN","LRAPBR1",375,0)
 ;
"RTN","LRAPBR1",376,0)
 N LRIENS,LRX
"RTN","LRAPBR1",377,0)
 S LRIENS=LRDFN_","_LRSS_","_LRI_",0",(LRMD("SR-ATTEND"),LRMD("SR-SURGEON"))=""
"RTN","LRAPBR1",378,0)
 S LRX=$O(^LR(LRDFN,"EPR","AD",LRIENS,1,0))
"RTN","LRAPBR1",379,0)
 I LRX<1 Q
"RTN","LRAPBR1",380,0)
 ;
"RTN","LRAPBR1",381,0)
 N LRDATA,LRJ,LRORDP,LRREF,LRSRDATA,LRSRTN
"RTN","LRAPBR1",382,0)
 S LRREF=LRX_","_LRDFN_","
"RTN","LRAPBR1",383,0)
 D GETDATA^LRUEPR(.LRDATA,LRREF)
"RTN","LRAPBR1",384,0)
 S LRSRTN=LRDATA(63.00013,LRREF,1,"I")
"RTN","LRAPBR1",385,0)
 ;
"RTN","LRAPBR1",386,0)
 I $P(LRSRTN,";",2)'="SRF(" Q
"RTN","LRAPBR1",387,0)
 ;
"RTN","LRAPBR1",388,0)
 S LRORDP=+$P(^LR(LRDFN,LRSS,LRI,0),"^",7) ; Retrieve current surgeon/provider from file #63
"RTN","LRAPBR1",389,0)
 D SRCASE^LRUEPR(.LRSRDATA,+LRSRTN)
"RTN","LRAPBR1",390,0)
 ;
"RTN","LRAPBR1",391,0)
 I $G(LRSRDATA("ERR")) D  Q
"RTN","LRAPBR1",392,0)
 . S LRMD("ERR")=LRSRDATA("ERR")
"RTN","LRAPBR1",393,0)
 . D SRCASERR^LRUEPR(LRREF,LRSRTN,LRSRDATA("ERR"))
"RTN","LRAPBR1",394,0)
 ;
"RTN","LRAPBR1",395,0)
 F LRJ=.14,123 D
"RTN","LRAPBR1",396,0)
 . S LRX=LRSRDATA(130,+LRSRTN_",",LRJ,"I")
"RTN","LRAPBR1",397,0)
 . I LRX,LRORDP,LRX'=LRORDP S LRMD("SR-SURGEON")=$S(LRJ=.14:" Current Surgeon",LRJ=123:"Current Provider",1:"")_": "_$$NAME^XUSER(LRX,"G")
"RTN","LRAPBR1",398,0)
 F LRJ=.164,124 D
"RTN","LRAPBR1",399,0)
 . S LRX=LRSRDATA(130,+LRSRTN_",",LRJ,"I")
"RTN","LRAPBR1",400,0)
 . I LRX S LRMD("SR-ATTEND")=$S(LRJ=.164:" Attending Surgeon",LRJ=124:"Attending Provider",1:"")_": "_$$NAME^XUSER(LRX,"G")
"RTN","LRAPBR1",401,0)
 ;
"RTN","LRAPBR1",402,0)
 Q
"RTN","LRAPBR4")
0^7^B44485116^B44190167
"RTN","LRAPBR4",1,0)
LRAPBR4 ;DALOI/STAFF - Autopsy Browser Display ;04/06/10  15:52
"RTN","LRAPBR4",2,0)
 ;;5.2;LAB SERVICE;**259,317,350,416,464**;Sep 27, 1994;Build 12
"RTN","LRAPBR4",3,0)
 ;
"RTN","LRAPBR4",4,0)
 ; Reference to ^DPT supported by IA #918
"RTN","LRAPBR4",5,0)
 ;
"RTN","LRAPBR4",6,0)
 Q
"RTN","LRAPBR4",7,0)
 ;
"RTN","LRAPBR4",8,0)
ENTER ; Entry point
"RTN","LRAPBR4",9,0)
 N LRTEXT,LRFILE,LRFIELD,LRTMP,LRFLG
"RTN","LRAPBR4",10,0)
 D INIT
"RTN","LRAPBR4",11,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",12,0)
 D HEADER
"RTN","LRAPBR4",13,0)
 D BODY
"RTN","LRAPBR4",14,0)
 D:'LRTIU POW
"RTN","LRAPBR4",15,0)
 D:LRTIU ESIGLN^LRAPBR1
"RTN","LRAPBR4",16,0)
 D FOOTER
"RTN","LRAPBR4",17,0)
 Q
"RTN","LRAPBR4",18,0)
 ;
"RTN","LRAPBR4",19,0)
 ;
"RTN","LRAPBR4",20,0)
INIT ; Initialize variables
"RTN","LRAPBR4",21,0)
 S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAPBR4",22,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",23,0)
 F LRTMP=1:1 D  Q:LRFIELD="Q"
"RTN","LRAPBR4",24,0)
 . S X=$T(VART1+LRTMP)
"RTN","LRAPBR4",25,0)
 . S LRFIELD=$P(X,";",2),VAR=$P(X,";",3),LRFLG=$P(X,";",4)
"RTN","LRAPBR4",26,0)
 . Q:LRFIELD="Q"
"RTN","LRAPBR4",27,0)
 . S @VAR=$$GET1^DIQ(63,LRDFN_",",LRFIELD,LRFLG)
"RTN","LRAPBR4",28,0)
 . I VAR["LRM",@VAR S X=@VAR D D^LRUA S @VAR=X
"RTN","LRAPBR4",29,0)
 S LRH(2)=$E(LRH(2),2,3)
"RTN","LRAPBR4",30,0)
 ;
"RTN","LRAPBR4",31,0)
 ; Get date of death (LRH)
"RTN","LRAPBR4",32,0)
 S DA=LRDFN D D^LRAUAW
"RTN","LRAPBR4",33,0)
 S Y=LR(63,12) D D^LRU S LRH=Y
"RTN","LRAPBR4",34,0)
 ;
"RTN","LRAPBR4",35,0)
 S LCT=0
"RTN","LRAPBR4",36,0)
 S:'LRTIU GROOT="^TMP(""LRAPBR"",$J,"
"RTN","LRAPBR4",37,0)
 S:LRTIU GROOT="^TMP(""TIUP"",$J,"
"RTN","LRAPBR4",38,0)
 K ^TMP("LRAPBR",$J)
"RTN","LRAPBR4",39,0)
 ;
"RTN","LRAPBR4",40,0)
 ; If reporting lab available then use instead of VistA site name.
"RTN","LRAPBR4",41,0)
 S LRX=$P($G(^LR(LRDFN,"AU")),"^",18)
"RTN","LRAPBR4",42,0)
 I LRX S LRQ(1)=$$NAME^XUAF4(LRX)
"RTN","LRAPBR4",43,0)
 ;
"RTN","LRAPBR4",44,0)
 Q
"RTN","LRAPBR4",45,0)
 ;
"RTN","LRAPBR4",46,0)
 ;
"RTN","LRAPBR4",47,0)
BODY ; Report body
"RTN","LRAPBR4",48,0)
 D:LRTIU GLENTRY("$TEXT",,1)
"RTN","LRAPBR4",49,0)
 S LR("F")=1
"RTN","LRAPBR4",50,0)
 I LRH(1)="" D
"RTN","LRAPBR4",51,0)
 . D GLENTRY("+*+* REPORT INCOMPLETE *+*+",20,1)
"RTN","LRAPBR4",52,0)
 . D GLENTRY(,,1)
"RTN","LRAPBR4",53,0)
 D MODAUCK
"RTN","LRAPBR4",54,0)
 ; Display supplementary report header if one or more has been added
"RTN","LRAPBR4",55,0)
 I $P($G(^LR(LRDFN,84,0)),U,4) D
"RTN","LRAPBR4",56,0)
 . S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRAPBR4",57,0)
 . S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",58,0)
 . D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",59,0)
 . S LRTEXT="*+* REFER TO BOTTOM OF REPORT *+*"
"RTN","LRAPBR4",60,0)
 . S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",61,0)
 . D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",62,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",63,0)
 F LRV=81,82,84 D
"RTN","LRAPBR4",64,0)
 . D:LRV'=84 GLENTRY(,,1)
"RTN","LRAPBR4",65,0)
 . D:LRV=81 GLENTRY(LRAU(1),0)
"RTN","LRAPBR4",66,0)
 . D:LRV=82 GLENTRY(LRAU(2),0)
"RTN","LRAPBR4",67,0)
 . I LRV'=84 D
"RTN","LRAPBR4",68,0)
 . . D GLENTRY(,,1)
"RTN","LRAPBR4",69,0)
 . . S LRFILE=63,LRIENS=LRDFN_","
"RTN","LRAPBR4",70,0)
 . . S LRFIELD=$S(LRV=81:32.2,1:32.3)
"RTN","LRAPBR4",71,0)
 . . D WP
"RTN","LRAPBR4",72,0)
 . I LRV=84 D
"RTN","LRAPBR4",73,0)
 . . N LRIENS1,LRIENS
"RTN","LRAPBR4",74,0)
 . . S LRFILE=63.324
"RTN","LRAPBR4",75,0)
 .  . S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA  D
"RTN","LRAPBR4",76,0)
 . . . S LRIENS1=LRA_","_LRDFN_","
"RTN","LRAPBR4",77,0)
 . . . D GLENTRY("SUPPLEMENTARY REPORT DATE: ",0,1)
"RTN","LRAPBR4",78,0)
 . . . S LRB=$$GET1^DIQ(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",79,0)
 . . . D GLENTRY(LRB,BTAB)
"RTN","LRAPBR4",80,0)
 . . . D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA
"RTN","LRAPBR4",81,0)
 . . . S LRFIELD=1,LRIENS=LRIENS1 D WP
"RTN","LRAPBR4",82,0)
 . . . D GLENTRY(,,1)
"RTN","LRAPBR4",83,0)
 . I LRV'=84 D DASH,GLENTRY(,,1)
"RTN","LRAPBR4",84,0)
 D ^LRAPBR5
"RTN","LRAPBR4",85,0)
 Q
"RTN","LRAPBR4",86,0)
 ;
"RTN","LRAPBR4",87,0)
 ;
"RTN","LRAPBR4",88,0)
WP ; Display word procesing fields
"RTN","LRAPBR4",89,0)
 K LRTMP,^UTILITY($J,"W")
"RTN","LRAPBR4",90,0)
 N LRX,DIWR,DIWL,LRA1
"RTN","LRAPBR4",91,0)
 S LRX=$$GET1^DIQ(LRFILE,LRIENS,LRFIELD,"","LRTMP","LRERR(1)")
"RTN","LRAPBR4",92,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRAPBR4",93,0)
 S LRX=+$$GET1^DID(LRFILE,LRFIELD,"","SPECIFIER","LRERR(2)")
"RTN","LRAPBR4",94,0)
 I $$GET1^DID(LRX,.01,"","SPECIFIER","LRERR(2)")["L" S DIWF="N"
"RTN","LRAPBR4",95,0)
 S DIWF="X"  ;464
"RTN","LRAPBR4",96,0)
 S LRA1=0 F  S LRA1=$O(LRTMP(LRA1)) Q:'LRA1  S X=LRTMP(LRA1) D ^DIWP
"RTN","LRAPBR4",97,0)
 S LRA1=0 F  S LRA1=$O(^UTILITY($J,"W",DIWL,LRA1)) Q:'LRA1  D
"RTN","LRAPBR4",98,0)
 .D GLENTRY(^UTILITY($J,"W",DIWL,LRA1,0),DIWL,1)
"RTN","LRAPBR4",99,0)
 K ^UTILITY($J,"W")
"RTN","LRAPBR4",100,0)
 Q
"RTN","LRAPBR4",101,0)
 ;
"RTN","LRAPBR4",102,0)
 ;
"RTN","LRAPBR4",103,0)
SUPA ; Print supplementary report audit information
"RTN","LRAPBR4",104,0)
 N LRFILE,LRIENS1,LRWP
"RTN","LRAPBR4",105,0)
 S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRAPBR4",106,0)
 S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",107,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",108,0)
 S LRTEXT="(Added/Last" D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",109,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A  D
"RTN","LRAPBR4",110,0)
 .S B=A
"RTN","LRAPBR4",111,0)
 Q:'$D(^LR(LRDFN,84,LRA,2,B,0))
"RTN","LRAPBR4",112,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",LRDSC=" modified: ",A2=$P(A,"^",2)
"RTN","LRAPBR4",113,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPBR4",114,0)
 I $P(A,"^",3) S LRSGN=" signed by ",LRDSC=" released: ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRAPBR4",115,0)
 S A2=$S($D(^VA(200,A2,0)):$P(^(0),"^"),1:A2)
"RTN","LRAPBR4",116,0)
 ;S LRFILE=63.3242,LRIENS1=B_","_LRA_","_LRDFN_","
"RTN","LRAPBR4",117,0)
 ;D GETS^DIQ(LRFILE,LRIENS1,"*","","LRWP")
"RTN","LRAPBR4",118,0)
 ;S Y=LRWP(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",119,0)
 ;S A=LRWP(LRFILE,LRIENS1,.02)
"RTN","LRAPBR4",120,0)
 D D^LRU
"RTN","LRAPBR4",121,0)
 S LRTEXT=LRDSC_Y_LRSGN_A2_")" D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",122,0)
 Q
"RTN","LRAPBR4",123,0)
 ;
"RTN","LRAPBR4",124,0)
 ;
"RTN","LRAPBR4",125,0)
HEADER ;
"RTN","LRAPBR4",126,0)
 S LRQ=LRQ+1
"RTN","LRAPBR4",127,0)
 D:LRTIU GLENTRY("$APHDR",,1)
"RTN","LRAPBR4",128,0)
 F I=1:1:2 D GLENTRY(,,1)
"RTN","LRAPBR4",129,0)
 ;
"RTN","LRAPBR4",130,0)
 ; Print names of facilities printing/releasing this report.
"RTN","LRAPBR4",131,0)
 N LRN,LRPL,LRRL,LRX
"RTN","LRAPBR4",132,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")>1,'LRTIU D
"RTN","LRAPBR4",133,0)
 . D PFAC^LRRP1(DUZ(2),"",1,.LRPL)
"RTN","LRAPBR4",134,0)
 . S LRN=0
"RTN","LRAPBR4",135,0)
 . F  S LRN=$O(LRPL(LRN)) Q:'LRN  D GLENTRY(LRPL(LRN),"",1)
"RTN","LRAPBR4",136,0)
 ;
"RTN","LRAPBR4",137,0)
 ; Display reporting lab
"RTN","LRAPBR4",138,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")#2 D
"RTN","LRAPBR4",139,0)
 . S LRX=+$P($G(^LR(LRDFN,"AU")),"^",18)
"RTN","LRAPBR4",140,0)
 . I LRX<1 Q
"RTN","LRAPBR4",141,0)
 . D RL^LRRP1(LRX,1,.LRRL),GLENTRY("","",1)
"RTN","LRAPBR4",142,0)
 . S LRN=0
"RTN","LRAPBR4",143,0)
 . F  S LRN=$O(LRRL(LRN)) Q:'LRN  D GLENTRY(LRRL(LRN),"",1)
"RTN","LRAPBR4",144,0)
 ;
"RTN","LRAPBR4",145,0)
 D DASH
"RTN","LRAPBR4",146,0)
 S LRTEXT="CLINICAL RECORD |" D GLENTRY(LRTEXT,5,1)
"RTN","LRAPBR4",147,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",148,0)
 D DASH
"RTN","LRAPBR4",149,0)
 S LRTEXT="Date died: "_LRH D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",150,0)
 S LRTEXT="| Autopsy date: "_LRH(1) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",151,0)
 S LRTEXT="Resident: "_LRM(2) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",152,0)
 S LRTEXT="| "_$E(LRS(3),1,13) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",153,0)
 S LRTEXT="Autopsy No. "_$S(LRQ(8)'="":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAPBR4",154,0)
 D GLENTRY(LRTEXT,56)
"RTN","LRAPBR4",155,0)
 D DASH
"RTN","LRAPBR4",156,0)
 Q
"RTN","LRAPBR4",157,0)
 ;
"RTN","LRAPBR4",158,0)
 ;
"RTN","LRAPBR4",159,0)
MODAUCK ; Display modified banner if required
"RTN","LRAPBR4",160,0)
 S LRAPMR=$$GET1^DIQ(63,LRDFN,102,"I")
"RTN","LRAPBR4",161,0)
 Q:'LRAPMR
"RTN","LRAPBR4",162,0)
 S LRAPMD=$$GET1^DIQ(63,LRDFN,102.2,"I")
"RTN","LRAPBR4",163,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",164,0)
 S LRTEXT=""
"RTN","LRAPBR4",165,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR4",166,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR4",167,0)
 S LRTEXT=LRTEXT_" MODIFIED "
"RTN","LRAPBR4",168,0)
 S LRTEXT=LRTEXT_$S(LRAPMD:"DIAGNOSIS ",1:"REPORT ")
"RTN","LRAPBR4",169,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR4",170,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR4",171,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR4",172,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",173,0)
 Q
"RTN","LRAPBR4",174,0)
 ;
"RTN","LRAPBR4",175,0)
 ;
"RTN","LRAPBR4",176,0)
POW ; Determine POW or Persian Gulf status
"RTN","LRAPBR4",177,0)
 I $P($G(^LR(LRDFN,0)),"^",2)=2 D
"RTN","LRAPBR4",178,0)
 .S LRPOW=0
"RTN","LRAPBR4",179,0)
 .I $D(^DPT(DFN,.52)) S:$P(^(.52),U,5)="Y" LRPOW=1
"RTN","LRAPBR4",180,0)
 .I $D(^DPT(DFN,.322)) S:$P($G(^(.322)),"^",10)="Y" LRPOW=1
"RTN","LRAPBR4",181,0)
 .D ^LRAPBRPW
"RTN","LRAPBR4",182,0)
 .K LRPOW
"RTN","LRAPBR4",183,0)
 Q
"RTN","LRAPBR4",184,0)
 ;
"RTN","LRAPBR4",185,0)
 ;
"RTN","LRAPBR4",186,0)
FOOTER ; Report footer
"RTN","LRAPBR4",187,0)
 D:LRTIU GLENTRY("$FTR",,1)
"RTN","LRAPBR4",188,0)
 D DASH
"RTN","LRAPBR4",189,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",190,0)
 I LRH(3)=""&(LRH(17)'="") D
"RTN","LRAPBR4",191,0)
 . S LRTEXT="| Provisional Anatomic Dx"
"RTN","LRAPBR4",192,0)
 . D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",193,0)
 S LRTEXT="Pathologist: "_LRM(3) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",194,0)
 D GLENTRY(LRW(9),52)
"RTN","LRAPBR4",195,0)
 S LRTEXT="| Date " D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",196,0)
 S LRTEXT=$E($S(LRH(3)'="":LRH(3),1:LRH(17)),1,12) D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",197,0)
 D DASH
"RTN","LRAPBR4",198,0)
 S LRTEXT=$E(LRQ(1),1,IOM-20) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",199,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,IOM-17)
"RTN","LRAPBR4",200,0)
 S LRTEXT="Patient: "_$E(LRP,1,30) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",201,0)
 D GLENTRY(SSN,43),GLENTRY("SEX:"_SEX,56),GLENTRY("DOB:"_DOB,63)
"RTN","LRAPBR4",202,0)
 D GLENTRY($E(LRLLOC,1,22),0,1)
"RTN","LRAPBR4",203,0)
 S LRTEXT="Physician: "_$E(LRM(1),1,28) D GLENTRY(LRTEXT,23)
"RTN","LRAPBR4",204,0)
 S LRTEXT="AGE AT DEATH:"_$J(AGE,3) D GLENTRY(LRTEXT,63)
"RTN","LRAPBR4",205,0)
 Q
"RTN","LRAPBR4",206,0)
 ;
"RTN","LRAPBR4",207,0)
 ;
"RTN","LRAPBR4",208,0)
DASH ;
"RTN","LRAPBR4",209,0)
 D GLENTRY(LR("%"),0,1)
"RTN","LRAPBR4",210,0)
 Q
"RTN","LRAPBR4",211,0)
 ;
"RTN","LRAPBR4",212,0)
 ;
"RTN","LRAPBR4",213,0)
GLENTRY(LRPR1,LRPR2,LRPR3) ; Write to global
"RTN","LRAPBR4",214,0)
 ; LRPR1 = Text to be written to global
"RTN","LRAPBR4",215,0)
 ; LRPR2 = Tab position
"RTN","LRAPBR4",216,0)
 ; LRPR3 = 1 means start a new line.  Othewise, write on current line.
"RTN","LRAPBR4",217,0)
 S LRPR1=$G(LRPR1),LRPR2=+$G(LRPR2),LRPR3=+$G(LRPR3)
"RTN","LRAPBR4",218,0)
 D:LRPR3 NEWLN^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",219,0)
 D:'LRPR3 GLBWRT^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",220,0)
 Q
"RTN","LRAPBR4",221,0)
 ;
"RTN","LRAPBR4",222,0)
 ;
"RTN","LRAPBR4",223,0)
VART1 ;Setup variables
"RTN","LRAPBR4",224,0)
 ;14;LRAC;I;AUTOPSY ACCESSION #
"RTN","LRAPBR4",225,0)
 ;13.5;LRM(2);I;RESIDENT PATHOLOGIST
"RTN","LRAPBR4",226,0)
 ;12.1;LRM(1);I;PHYSICIAN
"RTN","LRAPBR4",227,0)
 ;13.01;LRW(9);I;AUTOPSY TYPIST
"RTN","LRAPBR4",228,0)
 ;13.6;LRM(3);I;SENIOR PATHOLOGIST
"RTN","LRAPBR4",229,0)
 ;11;LRH(1);;AUTOPSY DATE/TIME
"RTN","LRAPBR4",230,0)
 ;11;LRH(2);I;AUTOPSY DATE/TIME 2 DIGIT YEAR
"RTN","LRAPBR4",231,0)
 ;13;LRH(3);;DATE AUTOPSY REPORT COMPLETED
"RTN","LRAPBR4",232,0)
 ;14.9;LRH(17);;PROVISIONAL ANAT DX DATE
"RTN","LRAPBR4",233,0)
 ;14.1;LRLLOC;I;LOCATION
"RTN","LRAPBR4",234,0)
 ;12.5;AGE;I;AGE AT DEATH
"RTN","LRAPBR4",235,0)
 ;14.5;LRSVC;;SERVICE
"RTN","LRAPBR4",236,0)
 ;13.7;LRS(3);;AUTOPSY TYPE
"RTN","LRAPBR4",237,0)
 ;Q
"RTN","LRAURPT")
0^6^B57531711^B57247419
"RTN","LRAURPT",1,0)
LRAURPT ;AVAMC/REG/WTY - AUTOPSY RPT ;9/22/00
"RTN","LRAURPT",2,0)
 ;;5.2;LAB SERVICE;**1,72,173,248,259,464**;Sep 27, 1994;Build 12
"RTN","LRAURPT",3,0)
 ;
"RTN","LRAURPT",4,0)
 ;Reference to ^DD(63 supported by IA #10155
"RTN","LRAURPT",5,0)
 ;WTY;24-AUG-01;Added ICD to the print coding question
"RTN","LRAURPT",6,0)
 ;
"RTN","LRAURPT",7,0)
 N LRPTR,LREL
"RTN","LRAURPT",8,0)
 W !!,LRO(68)," Autopsy Protocols" D XR^LRU,EN2^LRUA S LRD("V")=""
"RTN","LRAURPT",9,0)
 G END:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRAURPT",10,0)
 L +^LRO(69.2,LRAA,2):5
"RTN","LRAURPT",11,0)
 I '$T D EN^DDIOL("Someone else is building a print queue for this Accession Area","","$C(7),!!") Q
"RTN","LRAURPT",12,0)
GETP ;Add a patient to the report queue
"RTN","LRAURPT",13,0)
 W ! S X="" D ^LRUPS G GETP:LRAN["?" I LRAN=-1 L -^LRO(69.2,LRAA,2) Q
"RTN","LRAURPT",14,0)
 G:$D(^LRO(69.2,LRAA,2,LRAN,0)) GETP
"RTN","LRAURPT",15,0)
 S FDAIEN(2)=LRAN
"RTN","LRAURPT",16,0)
 S FDA(2,69.23,"+2,"_+LRAA_",",.01)=LRDFN
"RTN","LRAURPT",17,0)
 D UPDATE^DIE("","FDA(2)","FDAIEN") K FDAIEN G GETP
"RTN","LRAURPT",18,0)
CH ;Check Queue
"RTN","LRAURPT",19,0)
 I '$O(^LRO(69.2,LRAA,2,0)) D  Q
"RTN","LRAURPT",20,0)
 .W $C(7),!!,"No AUTOPSY PROTOCOLS currently on the print queue.",!!
"RTN","LRAURPT",21,0)
 ;Variable LR("DVD") is used to divide reports displayed in the browser
"RTN","LRAURPT",22,0)
 K LR("DVD")
"RTN","LRAURPT",23,0)
 S $P(LR("DVD"),"|",IOM)=""
"RTN","LRAURPT",24,0)
SPC ;Spacing
"RTN","LRAURPT",25,0)
 I LRAPX=4 D
"RTN","LRAURPT",26,0)
 .W !!,"The following two questions apply only to reports not stored in "
"RTN","LRAURPT",27,0)
 .W "TIU."
"RTN","LRAURPT",28,0)
 .W !,"If the report is stored in TIU it will be printed in its "
"RTN","LRAURPT",29,0)
 .W "original format.",!
"RTN","LRAURPT",30,0)
 R !,"(D)ouble or (S)ingle spacing of report(s): ",X:DTIME
"RTN","LRAURPT",31,0)
 Q:X=""!(X[U)
"RTN","LRAURPT",32,0)
 I $E(X)'="D"&($E(X)'="S") D  G SPC
"RTN","LRAURPT",33,0)
 .W $C(7),!,"Enter 'S' for single or 'D' for double "
"RTN","LRAURPT",34,0)
 .W "spacing of reports"
"RTN","LRAURPT",35,0)
 S LRS=$S(X="D":"D",1:"")_"W"
"RTN","LRAURPT",36,0)
 W !!,"Print special studies, journal references, weights, and "
"RTN","LRAURPT",37,0)
 W "measures: "
"RTN","LRAURPT",38,0)
 S %=1 D YN^LRU Q:%<1  S:%=1 LRD=1
"RTN","LRAURPT",39,0)
 Q:LRAPX=3
"RTN","LRAURPT",40,0)
 W !!,"Save protocol list for reprinting "
"RTN","LRAURPT",41,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRAURPT",42,0)
DEV ;Device Handling
"RTN","LRAURPT",43,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRAURPT",44,0)
 I POP W ! S LR("Q")=1 Q
"RTN","LRAURPT",45,0)
 I $D(IO("Q")) D  Q
"RTN","LRAURPT",46,0)
 .S ZTDESC="Print AU Anat Path Reports"
"RTN","LRAURPT",47,0)
 .S ZTSAVE("LR*")="",ZTRTN="QUE^LRAURPT"
"RTN","LRAURPT",48,0)
 .D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued, #",ZTSK W !
"RTN","LRAURPT",49,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","LRAURPT",50,0)
 .S LR("Q")=1
"RTN","LRAURPT",51,0)
QUE ;
"RTN","LRAURPT",52,0)
 U IO D L^LRU,S^LRU,EN^LRUA
"RTN","LRAURPT",53,0)
 N LRFFF
"RTN","LRAURPT",54,0)
 S LRQUIT=0,LR("Q")=+$G(LR("Q"))
"RTN","LRAURPT",55,0)
 ;LRSF515=1 means an SF515 is being generated.
"RTN","LRAURPT",56,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRAURPT",57,0)
 S:'$D(LRFOC) LRFOC=0 ;Final office copy
"RTN","LRAURPT",58,0)
 S LRFFF=1  ;Flag used to determine whether to perform final form feed
"RTN","LRAURPT",59,0)
 I LRFOC S LRFFF=0  ;If final office copy, don't perform final form feed
"RTN","LRAURPT",60,0)
 S LR(.21)=+$G(^LRO(69.2,LRAA,.2)),(LRS(5),LRAURPT)=1
"RTN","LRAURPT",61,0)
PSGL ;Single Report
"RTN","LRAURPT",62,0)
 I $D(LRAP) D  G LST
"RTN","LRAURPT",63,0)
 .S LRDFN=LRAP
"RTN","LRAURPT",64,0)
 .I +$G(LRPTR) D  Q
"RTN","LRAURPT",65,0)
 ..D:$D(LR("AU1")) EN
"RTN","LRAURPT",66,0)
 ..Q:LR("Q")
"RTN","LRAURPT",67,0)
 ..D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRAURPT",68,0)
 ..S LRFFF=0 ;Don't do final form feed.  It's done by LRAPTIUP.
"RTN","LRAURPT",69,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",70,0)
 ..K LRAP S LR("F")=1
"RTN","LRAURPT",71,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",72,0)
 ..Q:LR("Q")
"RTN","LRAURPT",73,0)
 ..I 'LRFOC S LR("Q")=1 Q
"RTN","LRAURPT",74,0)
 ..S LRI="" D FOC^LRSPRPT
"RTN","LRAURPT",75,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",76,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",77,0)
 .D EN
"RTN","LRAURPT",78,0)
 .K LRAP
"RTN","LRAURPT",79,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",80,0)
 .Q:LR("Q")
"RTN","LRAURPT",81,0)
 .I 'LRFOC S LR("Q")=1 Q
"RTN","LRAURPT",82,0)
 .W !
"RTN","LRAURPT",83,0)
 .W:IOST?1"P-".E @IOF
"RTN","LRAURPT",84,0)
 .S LRI="" D FOC^LRSPRPT
"RTN","LRAURPT",85,0)
 .I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",86,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",87,0)
PQUE ;Print all on queue
"RTN","LRAURPT",88,0)
 S LRAN=0
"RTN","LRAURPT",89,0)
 F  S LRAN=$O(^LRO(69.2,LRAA,2,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRAURPT",90,0)
 .S (LRQUIT,LRQ)=0
"RTN","LRAURPT",91,0)
 .I 'LRFOC S LRFFF=1
"RTN","LRAURPT",92,0)
 .K LR("F")
"RTN","LRAURPT",93,0)
 .S LRDFN=+^LRO(69.2,LRAA,2,LRAN,0)
"RTN","LRAURPT",94,0)
 .D RELEASE^LRAPUTL(.LREL,LRDFN,LRSS)
"RTN","LRAURPT",95,0)
 .I +$G(LREL(1)) D
"RTN","LRAURPT",96,0)
 ..D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS)
"RTN","LRAURPT",97,0)
 .I +$G(LRPTR) D  Q
"RTN","LRAURPT",98,0)
 ..D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRAURPT",99,0)
 ..S LRFFF=0
"RTN","LRAURPT",100,0)
 ..W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRAURPT",101,0)
 ..K LRPTR
"RTN","LRAURPT",102,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",103,0)
 ..S LR("F")=1
"RTN","LRAURPT",104,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",105,0)
 ..Q:LR("Q")!('LRFOC)
"RTN","LRAURPT",106,0)
 ..D FOC^LRSPRPT
"RTN","LRAURPT",107,0)
 ..W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRAURPT",108,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",109,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRAURPT",110,0)
 .W:IOST?1"C-".E @IOF
"RTN","LRAURPT",111,0)
 .D EN
"RTN","LRAURPT",112,0)
 .W:IOST?1"P-".E @IOF
"RTN","LRAURPT",113,0)
 .W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRAURPT",114,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRAURPT",115,0)
 .Q:LR("Q")!('LRFOC)
"RTN","LRAURPT",116,0)
 .W !
"RTN","LRAURPT",117,0)
 .D FOC^LRSPRPT
"RTN","LRAURPT",118,0)
 .W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRAURPT",119,0)
 .I LRQUIT S LR("Q")=1 Q
"RTN","LRAURPT",120,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRAURPT",121,0)
 S LRFFF=0
"RTN","LRAURPT",122,0)
LST ;
"RTN","LRAURPT",123,0)
 K:'$D(LRSAV) ^LRO(69.2,LRAA,2) K LRAURPT
"RTN","LRAURPT",124,0)
 S:'$D(^LRO(69.2,LRAA,2,0)) ^(0)="^69.23A^0^0"
"RTN","LRAURPT",125,0)
 K LRSAV D K^LRU
"RTN","LRAURPT",126,0)
 D:'$D(LR("AU1")) DEVEND
"RTN","LRAURPT",127,0)
 Q
"RTN","LRAURPT",128,0)
W ;
"RTN","LRAURPT",129,0)
 W !,LR("%")
"RTN","LRAURPT",130,0)
 Q
"RTN","LRAURPT",131,0)
F D E
"RTN","LRAURPT",132,0)
 S A=0 F LRZ=0:1 S A=$O(^LR(LRDFN,LRV,A)) Q:'A!(LR("Q"))  D
"RTN","LRAURPT",133,0)
 .D:$Y>(IOSL-12) FT,H Q:LR("Q")
"RTN","LRAURPT",134,0)
 .S X=^LR(LRDFN,LRV,A,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRAURPT",135,0)
 Q:LR("Q")  D:LRZ ^DIWW Q
"RTN","LRAURPT",136,0)
E K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF=LRS
"RTN","LRAURPT",137,0)
 Q
"RTN","LRAURPT",138,0)
EN ;
"RTN","LRAURPT",139,0)
 S LR("SPSM")=1 ;Set this flag to suppress SNOMED codes 
"RTN","LRAURPT",140,0)
 S LRQ=0,X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAURPT",141,0)
 I '$D(^LR(LRDFN,"AU")) L +^LRO(69.2,LRAA,2,LRAN):5 Q:'$T  D  Q
"RTN","LRAURPT",142,0)
 .S DIK="^LRO(69.2,LRAA,2,",DA=LRAN,DA(1)=0
"RTN","LRAURPT",143,0)
 .D ^DIK K DA,DIK
"RTN","LRAURPT",144,0)
 .L -^LRO(69.2,LRAA,2,LRAN)
"RTN","LRAURPT",145,0)
 S X=^LR(LRDFN,"AU"),LRAC=$P(X,"^",6),LRM(2)=$P(X,"^",7)
"RTN","LRAURPT",146,0)
 S LRM(1)=$P(X,"^",12),LRW(9)=$P(X,"^",13),LRM(3)=$P(X,"^",10)
"RTN","LRAURPT",147,0)
 S Y=$P(X,"^"),LRH(2)=$E(Y,2,3) D D^LRU
"RTN","LRAURPT",148,0)
 S LRH(1)=Y,Y=$P(X,"^",3) D D^LRU
"RTN","LRAURPT",149,0)
 S LRH(3)=Y,Y=$P(X,"^",17) D D^LRU S LRH(17)=Y
"RTN","LRAURPT",150,0)
 S LRLLOC=$P(X,"^",5),AGE=$P(X,"^",9)
"RTN","LRAURPT",151,0)
 S Y=$P(X,"^",8),C=$P(^DD(63,14.5,0),U,3)
"RTN","LRAURPT",152,0)
 D Y^DIQ S LRSVC=Y
"RTN","LRAURPT",153,0)
 S Y=$P(X,"^",11),C=$P(^DD(63,13.7,0),U,3)
"RTN","LRAURPT",154,0)
 D Y^DIQ S LRS(3)=Y
"RTN","LRAURPT",155,0)
 S DA=LRDFN D D^LRAUAW S Y=LR(63,12) D D^LRU S LRH=Y,X=LRM(1)
"RTN","LRAURPT",156,0)
 D:X D^LRUA S LRM(1)=X,X=LRM(2)
"RTN","LRAURPT",157,0)
 D:X D^LRUA S LRM(2)=X,X=LRM(3)
"RTN","LRAURPT",158,0)
 D:X D^LRUA S LRM(3)=X
"RTN","LRAURPT",159,0)
 Q:+$G(LRPTR)
"RTN","LRAURPT",160,0)
 D H Q:LR("Q")  S LR("F")=1
"RTN","LRAURPT",161,0)
 W:LRH(1)="" !?20,"**** REPORT INCOMPLETE ****",!
"RTN","LRAURPT",162,0)
 W !!,LRAU(1),! S LRV=81 D F
"RTN","LRAURPT",163,0)
 D:$Y>(IOSL-12) FT,H Q:LR("Q")  W !!,LR("%")
"RTN","LRAURPT",164,0)
 W !,LRAU(2),! S LRV=82 D F
"RTN","LRAURPT",165,0)
 I $O(^LR(LRDFN,84,0)),LR(.21) D FT,H Q:LR("Q")
"RTN","LRAURPT",166,0)
 S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA!(LR("Q"))  D
"RTN","LRAURPT",167,0)
 .S LRB=^LR(LRDFN,84,LRA,0) D:$Y>(IOSL-12) FT,H Q:LR("Q")
"RTN","LRAURPT",168,0)
 .W !!,"SUPPLEMENTARY REPORT DATE: "
"RTN","LRAURPT",169,0)
 .S Y=LRB D D^LRU W Y
"RTN","LRAURPT",170,0)
 .D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA^LRAPAUSR
"RTN","LRAURPT",171,0)
 .D WRT
"RTN","LRAURPT",172,0)
 Q:LR("Q")
"RTN","LRAURPT",173,0)
 D:$G(LRD) ^LRAPT2
"RTN","LRAURPT",174,0)
 Q:LR("Q")
"RTN","LRAURPT",175,0)
 D FT
"RTN","LRAURPT",176,0)
 Q
"RTN","LRAURPT",177,0)
WRT D E S LRC=0
"RTN","LRAURPT",178,0)
 S DIWF="X"   ;464
"RTN","LRAURPT",179,0)
 F LRZ=0:1 S LRC=$O(^LR(LRDFN,84,LRA,1,LRC)) Q:'LRC!(LR("Q"))  D
"RTN","LRAURPT",180,0)
 .D:$Y>(IOSL-12) FT,H Q:LR("Q")
"RTN","LRAURPT",181,0)
 .S X=^LR(LRDFN,84,LRA,1,LRC,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRAURPT",182,0)
 Q:LR("Q")  D:LRZ ^DIWW Q
"RTN","LRAURPT",183,0)
H ;
"RTN","LRAURPT",184,0)
 Q:LR("Q")
"RTN","LRAURPT",185,0)
 I $D(LR("F")),IOST?1"C".E D CONT  Q:LR("Q")
"RTN","LRAURPT",186,0)
 S LRQ=LRQ+1
"RTN","LRAURPT",187,0)
 W:($D(LR("F"))) @IOF
"RTN","LRAURPT",188,0)
 W !! D W
"RTN","LRAURPT",189,0)
 W !?5,"CLINICAL RECORD |",?40,"AUTOPSY PROTOCOL",?73,"Pg ",LRQ
"RTN","LRAURPT",190,0)
 W !,LR("%")
"RTN","LRAURPT",191,0)
 W !,"Date died: ",LRH,?40,"| Autopsy date: ",LRH(1)
"RTN","LRAURPT",192,0)
 W !,"Resident: ",LRM(2),?40,"| ",$E(LRS(3),1,13)
"RTN","LRAURPT",193,0)
 W ?56,"Autopsy No. ",$S(LRQ(8)]"":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAURPT",194,0)
 W !,LR("%")
"RTN","LRAURPT",195,0)
 Q
"RTN","LRAURPT",196,0)
FT ;Footer
"RTN","LRAURPT",197,0)
 Q:LR("Q")
"RTN","LRAURPT",198,0)
 I IOSL'>66 F  Q:$Y>(IOSL-12)  W !
"RTN","LRAURPT",199,0)
 D W W !
"RTN","LRAURPT",200,0)
 W:LRH(3)=""&(LRH(17)]"") ?55,"| Provisional Anatomic Dx"
"RTN","LRAURPT",201,0)
 W !,"Pathologist: ",LRM(3),?52,LRW(9),?55,"| Date "
"RTN","LRAURPT",202,0)
 W $E($S(LRH(3)]"":LRH(3),1:LRH(17)),1,12)
"RTN","LRAURPT",203,0)
 D W W !,LRQ(1),?IOM-17,"AUTOPSY PROTOCOL"
"RTN","LRAURPT",204,0)
 W !,"Patient: ",$E(LRP,1,30),?43,SSN,?56,"SEX:",SEX,?63,"DOB:",DOB
"RTN","LRAURPT",205,0)
 W !,$E(LRLLOC,1,22),?23,"Physician: ",$E(LRM(1),1,28)
"RTN","LRAURPT",206,0)
 W ?63,"AGE AT DEATH:",$J(AGE,3)
"RTN","LRAURPT",207,0)
 Q
"RTN","LRAURPT",208,0)
SGL ;Print single report entry point
"RTN","LRAURPT",209,0)
 K LRD("V") S X="" D ^LRUPS G:LRAN="?" SGL Q:LRAN=-1
"RTN","LRAURPT",210,0)
 D RELEASE^LRAPUTL(.LREL,LRDFN,LRSS)
"RTN","LRAURPT",211,0)
 I $D(LR("AU1")),'+$G(LREL(1)) D  Q
"RTN","LRAURPT",212,0)
 .W $C(7),!!,"Report not verified." S LR("AU1")=2
"RTN","LRAURPT",213,0)
 I +$G(LREL(1)) D
"RTN","LRAURPT",214,0)
 .D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS)
"RTN","LRAURPT",215,0)
 I $D(LR("AU1"))!(+$G(LRPTR)) S LRS="W",LRD=1
"RTN","LRAURPT",216,0)
 E  D SPC Q:X=""!(X[U)
"RTN","LRAURPT",217,0)
 D EN2^LRUA
"RTN","LRAURPT",218,0)
 S LRAP=LRDFN,LRSAV=1
"RTN","LRAURPT",219,0)
 G DEV
"RTN","LRAURPT",220,0)
DEVEND ;Close device
"RTN","LRAURPT",221,0)
 I IOST?1"P-".E W:LRFFF @IOF
"RTN","LRAURPT",222,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRAURPT",223,0)
 Q
"RTN","LRAURPT",224,0)
CONT ;
"RTN","LRAURPT",225,0)
 K DIR S DIR(0)="E"
"RTN","LRAURPT",226,0)
 D ^DIR W !
"RTN","LRAURPT",227,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRAURPT",228,0)
 Q
"RTN","LRAURPT",229,0)
END ;
"RTN","LRAURPT",230,0)
 W $C(7),!!,"OK to delete the AUTOPSY PROTOCOL list "
"RTN","LRAURPT",231,0)
 S %=2 D YN^LRU
"RTN","LRAURPT",232,0)
 I %=1 D  Q
"RTN","LRAURPT",233,0)
 .K ^LRO(69.2,LRAA,2)
"RTN","LRAURPT",234,0)
 .S ^LRO(69.2,LRAA,2,0)="^69.23A^0^0"
"RTN","LRAURPT",235,0)
 .W $C(7),!,"LIST DELETED !",!
"RTN","LRAURPT",236,0)
 W !!,"OK, LET'S FORGET IT.",!
"RTN","LRAURPT",237,0)
 Q
"RTN","LRAURPT",238,0)
TOP ;
"RTN","LRAURPT",239,0)
 S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2)
"RTN","LRAURPT",240,0)
 D FT,H S X=Z
"RTN","LRAURPT",241,0)
 Q
"RTN","LRSPRPT")
0^2^B66074919^B65490213
"RTN","LRSPRPT",1,0)
LRSPRPT ;DALOI/STAFF - CY/EM/SP PATIENT RPT ; 30 Aug 2016  5:20 PM
"RTN","LRSPRPT",2,0)
 ;;5.2;LAB SERVICE;**1,72,248,259,317,350,416,464**;Sep 27, 1994;Build 12
"RTN","LRSPRPT",3,0)
 ;
"RTN","LRSPRPT",4,0)
 W !!?20,LRO(68)," FINAL PATIENT REPORTS"
"RTN","LRSPRPT",5,0)
 K LRSAV,LRAP,LRS(99)
"RTN","LRSPRPT",6,0)
 D EN2^LRUA
"RTN","LRSPRPT",7,0)
 G END^LRSPRPT1:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRSPRPT",8,0)
GETP ;
"RTN","LRSPRPT",9,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",10,0)
 G:$D(^LRO(69.2,LRAA,2,LRAN,0)) GETP
"RTN","LRSPRPT",11,0)
 D LOCK^DILF("^LRO(69.2,LRAA,2)")
"RTN","LRSPRPT",12,0)
 I '$T D  G GETP
"RTN","LRSPRPT",13,0)
 . N MSG
"RTN","LRSPRPT",14,0)
 . S MSG(1)="The final reports queue is in use by another person.",MSG(1,"F")="!!"
"RTN","LRSPRPT",15,0)
 . S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRSPRPT",16,0)
 . D EN^DDIOL(.MSG)
"RTN","LRSPRPT",17,0)
 S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN_"^"_LRI
"RTN","LRSPRPT",18,0)
 S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRSPRPT",19,0)
 L -^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",20,0)
 G GETP
"RTN","LRSPRPT",21,0)
 ;
"RTN","LRSPRPT",22,0)
 ;
"RTN","LRSPRPT",23,0)
CH ;
"RTN","LRSPRPT",24,0)
 S LRAPX(1)=2 D EN^LRSPRPT2 Q:$G(%)<1
"RTN","LRSPRPT",25,0)
 W !!,"Save final report list for reprinting "
"RTN","LRSPRPT",26,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRSPRPT",27,0)
 ; Variable LR("DVD") is used to divide reports displayed in the browser
"RTN","LRSPRPT",28,0)
 K LR("DVD")
"RTN","LRSPRPT",29,0)
 S $P(LR("DVD"),"|",IOM)=""
"RTN","LRSPRPT",30,0)
DEV ; from LRAPMOD
"RTN","LRSPRPT",31,0)
 W !
"RTN","LRSPRPT",32,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRSPRPT",33,0)
 I POP W ! D END Q
"RTN","LRSPRPT",34,0)
 I $D(IO("Q")) D  Q
"RTN","LRSPRPT",35,0)
 . N ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","LRSPRPT",36,0)
 . S ZTDESC="ANAT PATH FINAL REPORT"
"RTN","LRSPRPT",37,0)
 . S ZTSAVE("LR*")="",ZTRTN="QUE^LRSPRPT"
"RTN","LRSPRPT",38,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","LRSPRPT",39,0)
 . D EN^DDIOL("Request "_$S($G(ZTSK):"queued - Task #"_ZTSK,1:"NOT queued"),"","!")
"RTN","LRSPRPT",40,0)
 . D END
"RTN","LRSPRPT",41,0)
 ;
"RTN","LRSPRPT",42,0)
QUE ;
"RTN","LRSPRPT",43,0)
 U IO
"RTN","LRSPRPT",44,0)
 N LRFFF
"RTN","LRSPRPT",45,0)
 ; LRSF515=1 means generating an SF515
"RTN","LRSPRPT",46,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRSPRPT",47,0)
 S:'$D(LRFOC) LRFOC=0
"RTN","LRSPRPT",48,0)
 S:'$D(LRQUIT) LRQUIT=0
"RTN","LRSPRPT",49,0)
 S LRFFF=1  ;Flag to perform final form feed
"RTN","LRSPRPT",50,0)
 I LRFOC S LRFFF=0  ;If final office copy, don't perform final form feed
"RTN","LRSPRPT",51,0)
 S LR(.21)=+$G(^LRO(69.2,LRAA,.2)),LR("DIWF")="W"
"RTN","LRSPRPT",52,0)
 S LRA=$S($D(^LRO(69.2,LRAA,0)):$P(^(0),U,9),1:1) S:LRA="" LRA=1
"RTN","LRSPRPT",53,0)
 D L^LRU,S^LRU,L1^LRU,SET^LRUA
"RTN","LRSPRPT",54,0)
 ;
"RTN","LRSPRPT",55,0)
PSGL ; Single Report
"RTN","LRSPRPT",56,0)
 I $D(LRAP) D  G LST
"RTN","LRSPRPT",57,0)
 . S LRDFN=$P(LRAP,"^"),LRI=$P(LRAP,"^",2)
"RTN","LRSPRPT",58,0)
 . I +$G(LRPTR) D  Q
"RTN","LRSPRPT",59,0)
 . . D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",60,0)
 . . S LRFFF=0 ;Don't do final form feed.  It's done by LRAPTIUP.
"RTN","LRSPRPT",61,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",62,0)
 . . K LRAP S LR("F")=1
"RTN","LRSPRPT",63,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",64,0)
 . . Q:LR("Q")
"RTN","LRSPRPT",65,0)
 . . I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",66,0)
 . . D FOC
"RTN","LRSPRPT",67,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",68,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",69,0)
 . W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",70,0)
 . D EN
"RTN","LRSPRPT",71,0)
 . K LRAP
"RTN","LRSPRPT",72,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",73,0)
 . Q:LR("Q")
"RTN","LRSPRPT",74,0)
 . I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",75,0)
 . W !
"RTN","LRSPRPT",76,0)
 . W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",77,0)
 . D FOC
"RTN","LRSPRPT",78,0)
 . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",79,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",80,0)
 ;
"RTN","LRSPRPT",81,0)
PQUE ;Report from queue
"RTN","LRSPRPT",82,0)
 S LRAN=0
"RTN","LRSPRPT",83,0)
 F  S LRAN=$O(^LRO(69.2,LRAA,2,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRSPRPT",84,0)
 . S LRQUIT=0
"RTN","LRSPRPT",85,0)
 . I 'LRFOC S LRFFF=1
"RTN","LRSPRPT",86,0)
 . K LR("F")
"RTN","LRSPRPT",87,0)
 . S X=^LRO(69.2,LRAA,2,LRAN,0),LRDFN=+X,LRI=$P(X,"^",2)
"RTN","LRSPRPT",88,0)
 . D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",89,0)
 . I +$G(LRPTR) D  Q
"RTN","LRSPRPT",90,0)
 . . D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",91,0)
 . . S LRFFF=0
"RTN","LRSPRPT",92,0)
 . . W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",93,0)
 . . K LRPTR
"RTN","LRSPRPT",94,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",95,0)
 . . S LR("F")=1
"RTN","LRSPRPT",96,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",97,0)
 . . Q:LR("Q")!('LRFOC)
"RTN","LRSPRPT",98,0)
 . . D FOC
"RTN","LRSPRPT",99,0)
 . . W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",100,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",101,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",102,0)
 . W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",103,0)
 . D EN
"RTN","LRSPRPT",104,0)
 . W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",105,0)
 . W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",106,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",107,0)
 . Q:LR("Q")
"RTN","LRSPRPT",108,0)
 . Q:'LRFOC
"RTN","LRSPRPT",109,0)
 . W !
"RTN","LRSPRPT",110,0)
 . D FOC
"RTN","LRSPRPT",111,0)
 . W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",112,0)
 . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",113,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",114,0)
 S LRFFF=0
"RTN","LRSPRPT",115,0)
 ;
"RTN","LRSPRPT",116,0)
LST ;
"RTN","LRSPRPT",117,0)
 K LRRMD,LRPMD,LRAP
"RTN","LRSPRPT",118,0)
 K:'$D(LRSAV) ^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",119,0)
 S ^LRO(69.2,LRAA,2,0)="^69.23A^^0"
"RTN","LRSPRPT",120,0)
 K LRSAV,LRV,LRW,LRZ
"RTN","LRSPRPT",121,0)
 I IOST?1"P-".E W:LRFFF @IOF
"RTN","LRSPRPT",122,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRSPRPT",123,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRSPRPT",124,0)
 D END
"RTN","LRSPRPT",125,0)
 Q
"RTN","LRSPRPT",126,0)
 ;
"RTN","LRSPRPT",127,0)
 ;
"RTN","LRSPRPT",128,0)
W ;
"RTN","LRSPRPT",129,0)
 W !,LR("%")
"RTN","LRSPRPT",130,0)
 Q
"RTN","LRSPRPT",131,0)
 ;
"RTN","LRSPRPT",132,0)
 ;
"RTN","LRSPRPT",133,0)
F ;
"RTN","LRSPRPT",134,0)
 ; N A,DIWF,DIWL,DIWR
"RTN","LRSPRPT",135,0)
 D E
"RTN","LRSPRPT",136,0)
 S A=0,DIWF=$TR(DIWF,"W","")
"RTN","LRSPRPT",137,0)
 F  S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A  S X=^LR(LRDFN,LRSS,LRI,LRV,A,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRSPRPT",138,0)
 S A=0
"RTN","LRSPRPT",139,0)
 F  S A=$O(^UTILITY($J,"W",DIWL,A)) Q:'A  D:$Y>(IOSL-11) F^LRAPF,^LRAPF Q:LR("Q")  W !,^UTILITY($J,"W",DIWL,A,0)
"RTN","LRSPRPT",140,0)
 I $Y<(IOSL-11) W !
"RTN","LRSPRPT",141,0)
 K ^UTILITY($J,"W")
"RTN","LRSPRPT",142,0)
 Q
"RTN","LRSPRPT",143,0)
 ;
"RTN","LRSPRPT",144,0)
 ;
"RTN","LRSPRPT",145,0)
E ;
"RTN","LRSPRPT",146,0)
 K ^UTILITY($J,"W")
"RTN","LRSPRPT",147,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRSPRPT",148,0)
 ;
"RTN","LRSPRPT",149,0)
 ; Set gross description field to value from file #69.2
"RTN","LRSPRPT",150,0)
 ;I LRV=1 S DIWF=LR("DIWF")
"RTN","LRSPRPT",151,0)
 S DIWF=LR("DIWF")
"RTN","LRSPRPT",152,0)
 ;
"RTN","LRSPRPT",153,0)
 Q
"RTN","LRSPRPT",154,0)
 ;
"RTN","LRSPRPT",155,0)
 ;
"RTN","LRSPRPT",156,0)
EN ; from LRSPT
"RTN","LRSPRPT",157,0)
 ; Moved to LRSPRPTA due to size limits on routine
"RTN","LRSPRPT",158,0)
 D EN^LRSPRPTA
"RTN","LRSPRPT",159,0)
 Q
"RTN","LRSPRPT",160,0)
 ;
"RTN","LRSPRPT",161,0)
 ;
"RTN","LRSPRPT",162,0)
S ;
"RTN","LRSPRPT",163,0)
 S Y=+X,X=$P(X,U,2) D D^LRU
"RTN","LRSPRPT",164,0)
 W !?3,"Date: ",Y
"RTN","LRSPRPT",165,0)
 I $D(LR("R")),'X W " not verified" Q
"RTN","LRSPRPT",166,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",167,0)
 D:$P($G(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,0)),U,4) SUPA
"RTN","LRSPRPT",168,0)
 D E S B=0
"RTN","LRSPRPT",169,0)
 F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",170,0)
 . D:$Y>(IOSL-14) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",171,0)
 . ;S DIWF="W"  ;LR*5.2*464
"RTN","LRSPRPT",172,0)
 . S DIWF="WN"  ;LR*5.2*464
"RTN","LRSPRPT",173,0)
 . S X=^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B,0) D ^DIWP Q:LR("Q")
"RTN","LRSPRPT",174,0)
 Q:LR("Q")
"RTN","LRSPRPT",175,0)
 D:LRZ ^DIWW
"RTN","LRSPRPT",176,0)
 Q
"RTN","LRSPRPT",177,0)
 ;
"RTN","LRSPRPT",178,0)
 ;
"RTN","LRSPRPT",179,0)
SGL ; Print Single Report
"RTN","LRSPRPT",180,0)
 N LRPTR
"RTN","LRSPRPT",181,0)
 S LRAPX(1)=""
"RTN","LRSPRPT",182,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",183,0)
 I '$P(^LR(LRDFN,LRSS,LRI,0),"^",11) D  G SGL
"RTN","LRSPRPT",184,0)
 . W $C(7)," Sorry, report not verified.",!
"RTN","LRSPRPT",185,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",186,0)
 S LRAP=LRDFN_"^"_LRI,LRSAV=1
"RTN","LRSPRPT",187,0)
 D EN2^LRUA
"RTN","LRSPRPT",188,0)
 G DEV
"RTN","LRSPRPT",189,0)
 ;
"RTN","LRSPRPT",190,0)
 ;
"RTN","LRSPRPT",191,0)
A ;
"RTN","LRSPRPT",192,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",193,0)
 . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",194,0)
 . W !,$P(^LR(LRDFN,LRSS,LRI,LRV,A,0),"^")
"RTN","LRSPRPT",195,0)
 Q
"RTN","LRSPRPT",196,0)
 ;
"RTN","LRSPRPT",197,0)
 ;
"RTN","LRSPRPT",198,0)
TOP ;
"RTN","LRSPRPT",199,0)
 S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2) D F^LRAPF,^LRAPF S X=Z
"RTN","LRSPRPT",200,0)
 Q
"RTN","LRSPRPT",201,0)
 ;
"RTN","LRSPRPT",202,0)
 ;
"RTN","LRSPRPT",203,0)
SUPA ; Print supplementary report audit information
"RTN","LRSPRPT",204,0)
 W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRSPRPT",205,0)
 W !,"(Added/Last modified: "
"RTN","LRSPRPT",206,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",207,0)
 . S B=A
"RTN","LRSPRPT",208,0)
 Q:LR("Q")
"RTN","LRSPRPT",209,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0))
"RTN","LRSPRPT",210,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",A=$P(A,"^",2)
"RTN","LRSPRPT",211,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0),"^",3) D
"RTN","LRSPRPT",212,0)
 . S A=^(0),LRSGN=" signed by ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRSPRPT",213,0)
 . S A=A2
"RTN","LRSPRPT",214,0)
 S A=$S($D(^VA(200,A,0)):$P(^(0),"^"),1:A)
"RTN","LRSPRPT",215,0)
 ; If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRSPRPT",216,0)
 D D^LRU W Y,LRSGN,A,")"
"RTN","LRSPRPT",217,0)
 ; If RELEASE SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LRSPRPT",218,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,0),"^",3) W !,?25,"**-* NOT VERIFIED *-**"
"RTN","LRSPRPT",219,0)
 D:$D(LRQ(9)) SUPM
"RTN","LRSPRPT",220,0)
 Q
"RTN","LRSPRPT",221,0)
 ;
"RTN","LRSPRPT",222,0)
 ;
"RTN","LRSPRPT",223,0)
SUPM ; Print previous versions of supplementary reports
"RTN","LRSPRPT",224,0)
 ; This is used by menu option 'Print path modifications [LRAPMOD]'
"RTN","LRSPRPT",225,0)
 ;
"RTN","LRSPRPT",226,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",227,0)
 . S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,0)
"RTN","LRSPRPT",228,0)
 . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",229,0)
 . S Y=+LRT,Y2=" modified: ",X=$P(LRT,"^",2),LRSGN="  typed by "
"RTN","LRSPRPT",230,0)
 . ; If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRSPRPT",231,0)
 . I $P(LRT,"^",3) S LRSGN=" signed by ",X=$P(LRT,"^",3),Y=$P(LRT,"^",4),Y2=" released: "
"RTN","LRSPRPT",232,0)
 . S X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRSPRPT",233,0)
 . D D^LRU W !,"Date ",Y2,Y,LRSGN,X
"RTN","LRSPRPT",234,0)
 . K ^UTILITY($J)
"RTN","LRSPRPT",235,0)
 . S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRSPRPT",236,0)
 . S B=0
"RTN","LRSPRPT",237,0)
 . F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",238,0)
 . . S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B,0)
"RTN","LRSPRPT",239,0)
 . . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",240,0)
 . . S X=LRT D ^DIWP
"RTN","LRSPRPT",241,0)
 . Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRSPRPT",242,0)
 Q:LR("Q")
"RTN","LRSPRPT",243,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRSPRPT",244,0)
 Q
"RTN","LRSPRPT",245,0)
 ;
"RTN","LRSPRPT",246,0)
 ;
"RTN","LRSPRPT",247,0)
CONT ;
"RTN","LRSPRPT",248,0)
 K DIR S DIR(0)="E"
"RTN","LRSPRPT",249,0)
 D ^DIR W !
"RTN","LRSPRPT",250,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRSPRPT",251,0)
 Q
"RTN","LRSPRPT",252,0)
 ;
"RTN","LRSPRPT",253,0)
 ;
"RTN","LRSPRPT",254,0)
FOC ; Print final office copy page (SNOMEDS)
"RTN","LRSPRPT",255,0)
 N LRADC,LRCTR
"RTN","LRSPRPT",256,0)
 I '$D(LRAP) D
"RTN","LRSPRPT",257,0)
 . D:LRSS'="AU" ^LRUA
"RTN","LRSPRPT",258,0)
 . I LRSS="AU" S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRSPRPT",259,0)
 I LRSS="AU" D
"RTN","LRSPRPT",260,0)
 . S LRADC=$E($P(^LR(LRDFN,LRSS),"^"),1,3)_"0000"
"RTN","LRSPRPT",261,0)
 . S:+$G(LRDPF)=2 LRDEM("DTH")=$P(VADM(6),"^",2)
"RTN","LRSPRPT",262,0)
 . ; Get DATE DIED from Referral File for Referral Patients
"RTN","LRSPRPT",263,0)
 . S:+$G(LRDPF)'=2 LRDEM("DTH")=$$GET1^DIQ(67,DFN_",",.351)
"RTN","LRSPRPT",264,0)
 . S LRDEM("AUDT")=$$GET1^DIQ(63,LRDFN_",",11)
"RTN","LRSPRPT",265,0)
 . S LRDEM("AUTYP")=$$GET1^DIQ(63,LRDFN_",",13.7)
"RTN","LRSPRPT",266,0)
 . S LRDEM("PRO")=$$GET1^DIQ(63,LRDFN_",",13.5)
"RTN","LRSPRPT",267,0)
 I LRSS'="AU" D
"RTN","LRSPRPT",268,0)
 . S LRADC=$E($P(^LR(LRDFN,LRSS,LRI,0),"^",10),1,3)_"0000"
"RTN","LRSPRPT",269,0)
 . S LRDEM("PRO")=LRMD
"RTN","LRSPRPT",270,0)
 S LRDEM("PNM")=LRP,LRDEM("SSN")=SSN
"RTN","LRSPRPT",271,0)
 S LRDEM("SEX")=SEX,LRDEM("AGE")=AGE,LRDEM("DOB")=DOB
"RTN","LRSPRPT",272,0)
 D INIT^LRAPSNMD(LRDFN,LRSS,$G(LRI),LRSF,LRAA,LRAN,LRADC,.LRDEM,0)
"RTN","LRSPRPT",273,0)
 Q
"RTN","LRSPRPT",274,0)
 ;
"RTN","LRSPRPT",275,0)
 ;
"RTN","LRSPRPT",276,0)
END ;
"RTN","LRSPRPT",277,0)
 D V^LRU
"RTN","LRSPRPT",278,0)
 K LRSF515
"RTN","LRSPRPT",279,0)
 Q
"RTN","LRSPRPTA")
0^4^B16221916^B14810851
"RTN","LRSPRPTA",1,0)
LRSPRPTA ;DALOI/STAFF - CY/EM/SP PATIENT RPT (cont'd) ;03/21/13  15:29
"RTN","LRSPRPTA",2,0)
 ;;5.2;LAB SERVICE;**350,427,464**;Sep 27, 1994;Build 12
"RTN","LRSPRPTA",3,0)
 ;
"RTN","LRSPRPTA",4,0)
 ; Continuation of LRSPRPT.
"RTN","LRSPRPTA",5,0)
 ;
"RTN","LRSPRPTA",6,0)
EN ; from LRSPRPT
"RTN","LRSPRPTA",7,0)
 ; Suppress SNOMED codes except on Preliminary
"RTN","LRSPRPTA",8,0)
 S LR("SPSM")=$S($G(LRPRE):0,1:1)
"RTN","LRSPRPTA",9,0)
 S LR(.21)=+$G(^LRO(69.2,+$G(LRAA),.2))
"RTN","LRSPRPTA",10,0)
 K LRO Q:'$D(^LR(LRDFN,LRSS,LRI,0))
"RTN","LRSPRPTA",11,0)
 S LRQ=0
"RTN","LRSPRPTA",12,0)
 D ^LRUA
"RTN","LRSPRPTA",13,0)
 ;
"RTN","LRSPRPTA",14,0)
 D GETPCP^LRAPUTL(.LRPRAC,LRDFN,LRSS,LRI)
"RTN","LRSPRPTA",15,0)
 ;
"RTN","LRSPRPTA",16,0)
 D ^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",17,0)
 S LR("F")=1 W !,"Submitted by: ",LRW(5),?44,"Date obtained: ",LRTK
"RTN","LRSPRPTA",18,0)
 D:LRA W^LRSPRPT
"RTN","LRSPRPTA",19,0)
 W !,"Specimen (Received ",LRTK(1),"):" S LRV=.1 D A^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",20,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),"^",4) D
"RTN","LRSPRPTA",21,0)
 . W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRSPRPTA",22,0)
 . W !?19,"*+* REFER TO BOTTOM OF REPORT *+*",!
"RTN","LRSPRPTA",23,0)
 ;
"RTN","LRSPRPTA",24,0)
 ; DALOI/LMT - LR,427 - Removed comments from report to restore pre-LR,350 behavior
"RTN","LRSPRPTA",25,0)
 ;I $O(^LR(LRDFN,LRSS,LRI,99,0)) W !,"Comment:"
"RTN","LRSPRPTA",26,0)
 ;S LRB=0
"RTN","LRSPRPTA",27,0)
 ;F  S LRB=$O(^LR(LRDFN,LRSS,LRI,99,LRB)) Q:'LRB!(LR("Q"))  D
"RTN","LRSPRPTA",28,0)
 ;. W !,^LR(LRDFN,LRSS,LRI,99,LRB,0)
"RTN","LRSPRPTA",29,0)
 ;. I $G(LRSF515),$Y>(IOSL-11) D F^LRAPF,^LRAPF
"RTN","LRSPRPTA",30,0)
 ;
"RTN","LRSPRPTA",31,0)
 S LR("DIWF","X")=$G(LR("DIWF")),LR("DIWF")="N"  ;LR*5.S*464
"RTN","LRSPRPTA",32,0)
 D:LRA W^LRSPRPT W !,"Brief Clinical History:" S LRV=.2 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",33,0)
 D:LRA W^LRSPRPT W !,"Preoperative Diagnosis:" S LRV=.3 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",34,0)
 D:LRA W^LRSPRPT W !,"Operative Findings:" S LRV=.4 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",35,0)
 D:LRA W^LRSPRPT W !,"Postoperative Diagnosis:" S LRV=.5 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",36,0)
 S LR("DIWF")=LR("DIWF","X") K LR("DIWF","X")  ;LR*5.2*464
"RTN","LRSPRPTA",37,0)
 ;
"RTN","LRSPRPTA",38,0)
 ;
"RTN","LRSPRPTA",39,0)
 ; Retrieve surgeon/attending
"RTN","LRSPRPTA",40,0)
 D ATTEND^LRAPBR1(.LRMD)
"RTN","LRSPRPTA",41,0)
 I LRMD'="" W !?27,"Surgeon/physician: ",LRMD
"RTN","LRSPRPTA",42,0)
 I LRMD("SR-SURGEON")'="" w !,?28,LRMD("SR-SURGEON")
"RTN","LRSPRPTA",43,0)
 I LRMD("SR-ATTEND")'="" W !,?26,LRMD("SR-ATTEND")
"RTN","LRSPRPTA",44,0)
 ;I +$G(LRMD("ERR"))=601 W !,?26,$P(LRMD("ERR"),"^",2)
"RTN","LRSPRPTA",45,0)
 ;
"RTN","LRSPRPTA",46,0)
 I LRA W !,LR("%1")
"RTN","LRSPRPTA",47,0)
 ;
"RTN","LRSPRPTA",48,0)
 I $Y>(IOSL-14) D  Q:LR("Q")
"RTN","LRSPRPTA",49,0)
 . D F^LRAPF,^LRAPF
"RTN","LRSPRPTA",50,0)
 E  D P^LRAPF
"RTN","LRSPRPTA",51,0)
 ;I $Y>(IOSL-8) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",52,0)
 D:LRA W^LRSPRPT
"RTN","LRSPRPTA",53,0)
 W:LRRC="" !?20,"+*+* REPORT INCOMPLETE *+*+",!
"RTN","LRSPRPTA",54,0)
 I $Y>(IOSL-11) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",55,0)
 ;
"RTN","LRSPRPTA",56,0)
 W !
"RTN","LRSPRPTA",57,0)
 I LRRMD'="" W ?31,$S(LRSS="SP":"Pathology Resident: ",LRSS="CY":"Screened by: ",LRSS="EM":"Prepared by: ",1:" "),LRRMD
"RTN","LRSPRPTA",58,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.3,0)) D  Q:LR("Q")
"RTN","LRSPRPTA",59,0)
 . I $Y>(IOSL-11) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",60,0)
 . W !,LR(69.2,.13)
"RTN","LRSPRPTA",61,0)
 . I $P($G(^LR(LRDFN,LRSS,LRI,6,0)),U,4) S LR(0)=6 D ^LRSPRPTM
"RTN","LRSPRPTA",62,0)
 ;
"RTN","LRSPRPTA",63,0)
 S LR("DIWF")="N"  ;LR*5.2*464  Setting default WP flag to NoWrap
"RTN","LRSPRPTA",64,0)
 S LRV=1.3 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",65,0)
 I $O(^LR(LRDFN,LRSS,LRI,1,0)) D  Q:LR("Q")
"RTN","LRSPRPTA",66,0)
 . I $Y>(IOSL-11) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",67,0)
 . W !,LR(69.2,.03)
"RTN","LRSPRPTA",68,0)
 . I $P($G(^LR(LRDFN,LRSS,LRI,7,0)),U,4) S LR(0)=7 D ^LRSPRPTM
"RTN","LRSPRPTA",69,0)
 ;
"RTN","LRSPRPTA",70,0)
 S LRV=1,LR("DIWF")="N" D F^LRSPRPT Q:LR("Q")  ;LR*5.2*464
"RTN","LRSPRPTA",71,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.1,0)) D  Q:LR("Q")
"RTN","LRSPRPTA",72,0)
 . I $Y>(IOSL-11) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",73,0)
 . W !,LR(69.2,.04)
"RTN","LRSPRPTA",74,0)
 . I $P($G(^LR(LRDFN,LRSS,LRI,4,0)),"^",4) S LR(0)=4 D ^LRSPRPTM
"RTN","LRSPRPTA",75,0)
 ;
"RTN","LRSPRPTA",76,0)
 S LRV=1.1 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",77,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.4,0)) D  Q:LR("Q")
"RTN","LRSPRPTA",78,0)
 . I $Y>(IOSL-11) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",79,0)
 . W !,LR(69.2,.14)
"RTN","LRSPRPTA",80,0)
 . I $P($G(^LR(LRDFN,LRSS,LRI,5,0)),U,4) S LR(0)=5 D ^LRSPRPTM
"RTN","LRSPRPTA",81,0)
 ;
"RTN","LRSPRPTA",82,0)
 S LRV=1.4 D F^LRSPRPT Q:LR("Q")
"RTN","LRSPRPTA",83,0)
 ;
"RTN","LRSPRPTA",84,0)
 ; Supplementary Report
"RTN","LRSPRPTA",85,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.2,0)) D:LR(.21) F^LRAPF,^LRAPF Q:LR("Q")  D
"RTN","LRSPRPTA",86,0)
 . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",87,0)
 . W !,"Supplementary Report:"
"RTN","LRSPRPTA",88,0)
 . S LRV=0 F  S LRV=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV)) Q:'LRV!(LR("Q"))  D
"RTN","LRSPRPTA",89,0)
 . . S X=^LR(LRDFN,LRSS,LRI,1.2,LRV,0) D S^LRSPRPT
"RTN","LRSPRPTA",90,0)
 D ^LRSPRPT1 Q:LR("Q")
"RTN","LRSPRPTA",91,0)
 ;
"RTN","LRSPRPTA",92,0)
 ; Print performing laboratory if designated
"RTN","LRSPRPTA",93,0)
 D PPL
"RTN","LRSPRPTA",94,0)
 ;
"RTN","LRSPRPTA",95,0)
 ; Don't set the final flag and print the footer if prelim
"RTN","LRSPRPTA",96,0)
 Q:+$G(LRPRE)
"RTN","LRSPRPTA",97,0)
 S LRO=1 D F^LRAPF
"RTN","LRSPRPTA",98,0)
 Q
"RTN","LRSPRPTA",99,0)
 ;
"RTN","LRSPRPTA",100,0)
 ;
"RTN","LRSPRPTA",101,0)
PPL ; Print any performing laboratories
"RTN","LRSPRPTA",102,0)
 ;
"RTN","LRSPRPTA",103,0)
 N LRPL,LRJ,LRX
"RTN","LRSPRPTA",104,0)
 ;
"RTN","LRSPRPTA",105,0)
 D RETLST^LRRPL(.LRPL,LRDFN,LRSS,LRI,0)
"RTN","LRSPRPTA",106,0)
 I $G(LRPL)<1 Q
"RTN","LRSPRPTA",107,0)
 ;
"RTN","LRSPRPTA",108,0)
 ; Start new page if space on existing page too small to display a significant portion of labs
"RTN","LRSPRPTA",109,0)
 I $Y>(IOSL-15) D F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTA",110,0)
 ;
"RTN","LRSPRPTA",111,0)
 W !!,$$REPEAT^XLFSTR("=",IOM)
"RTN","LRSPRPTA",112,0)
 W !,"Performing Laboratory:",!
"RTN","LRSPRPTA",113,0)
 S LRJ=0
"RTN","LRSPRPTA",114,0)
 F  S LRJ=$O(LRPL(LRJ)) Q:'LRJ  D  Q:LR("Q")
"RTN","LRSPRPTA",115,0)
 . I $Y>(IOSL-12) D F^LRAPF,^LRAPF Q:LR("Q")  W !,"Performing Laboratory (cont'd):",!
"RTN","LRSPRPTA",116,0)
 . W !,LRPL(LRJ)
"RTN","LRSPRPTA",117,0)
 ;
"RTN","LRSPRPTA",118,0)
 Q
"VER")
8.0^22.0
"BLD",9613,6)
^380
**END**
**END**

