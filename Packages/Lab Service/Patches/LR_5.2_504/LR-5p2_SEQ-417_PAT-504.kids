Released LR*5.2*504 SEQ #417
Extracted from mail message
**KIDS**:LR*5.2*504^

**INSTALL NAME**
LR*5.2*504
"BLD",11062,0)
LR*5.2*504^LAB SERVICE^0^3181210^y
"BLD",11062,1,0)
^^20^20^3181207^
"BLD",11062,1,1,0)
R18600337FY18: Missing Anatomic Pathology Alerts
"BLD",11062,1,2,0)
R19264009FY18 (d)
"BLD",11062,1,3,0)
 
"BLD",11062,1,4,0)
Problem:
"BLD",11062,1,5,0)
-------
"BLD",11062,1,6,0)
 
"BLD",11062,1,7,0)
Alerts might not be generated after Anatomic Pathology cases are verified.
"BLD",11062,1,8,0)
 
"BLD",11062,1,9,0)
Resolution: 
"BLD",11062,1,10,0)
----------
"BLD",11062,1,11,0)
 
"BLD",11062,1,12,0)
The root cause of this issue is not yet known.  In the meantime, this 
"BLD",11062,1,13,0)
patch provides an option which will search for missing Anatomic
"BLD",11062,1,14,0)
Pathology alerts as well as other issues known to occur along with 
"BLD",11062,1,15,0)
missing alerts such as fields in the ORDERS (#100) file which are set 
"BLD",11062,1,16,0)
incorrectly.
"BLD",11062,1,17,0)
 
"BLD",11062,1,18,0)
Refer to the FORUM patch description for detailed information on alerts 
"BLD",11062,1,19,0)
and MailMan messages which are generated after the search option 
"BLD",11062,1,20,0)
completes.
"BLD",11062,4,0)
^9.64PA^^
"BLD",11062,6.3)
33
"BLD",11062,"ABPKG")
n
"BLD",11062,"KRN",0)
^9.67PA^779.2^20
"BLD",11062,"KRN",.4,0)
.4
"BLD",11062,"KRN",.4,"NM",0)
^9.68A^^
"BLD",11062,"KRN",.401,0)
.401
"BLD",11062,"KRN",.402,0)
.402
"BLD",11062,"KRN",.403,0)
.403
"BLD",11062,"KRN",.5,0)
.5
"BLD",11062,"KRN",.84,0)
.84
"BLD",11062,"KRN",3.6,0)
3.6
"BLD",11062,"KRN",3.8,0)
3.8
"BLD",11062,"KRN",9.2,0)
9.2
"BLD",11062,"KRN",9.8,0)
9.8
"BLD",11062,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11062,"KRN",9.8,"NM",1,0)
LRAPUALT^^0^B158177199
"BLD",11062,"KRN",9.8,"NM","B","LRAPUALT",1)

"BLD",11062,"KRN",19,0)
19
"BLD",11062,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",11062,"KRN",19,"NM",2,0)
LRAPSUPER^^2
"BLD",11062,"KRN",19,"NM",3,0)
LRAPALERT^^0
"BLD",11062,"KRN",19,"NM","B","LRAPALERT",3)

"BLD",11062,"KRN",19,"NM","B","LRAPSUPER",2)

"BLD",11062,"KRN",19.1,0)
19.1
"BLD",11062,"KRN",101,0)
101
"BLD",11062,"KRN",409.61,0)
409.61
"BLD",11062,"KRN",771,0)
771
"BLD",11062,"KRN",779.2,0)
779.2
"BLD",11062,"KRN",870,0)
870
"BLD",11062,"KRN",8989.51,0)
8989.51
"BLD",11062,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",11062,"KRN",8989.51,"NM",1,0)
LR AP ALERT SEARCH END^^0
"BLD",11062,"KRN",8989.51,"NM","B","LR AP ALERT SEARCH END",1)

"BLD",11062,"KRN",8989.52,0)
8989.52
"BLD",11062,"KRN",8994,0)
8994
"BLD",11062,"KRN","B",.4,.4)

"BLD",11062,"KRN","B",.401,.401)

"BLD",11062,"KRN","B",.402,.402)

"BLD",11062,"KRN","B",.403,.403)

"BLD",11062,"KRN","B",.5,.5)

"BLD",11062,"KRN","B",.84,.84)

"BLD",11062,"KRN","B",3.6,3.6)

"BLD",11062,"KRN","B",3.8,3.8)

"BLD",11062,"KRN","B",9.2,9.2)

"BLD",11062,"KRN","B",9.8,9.8)

"BLD",11062,"KRN","B",19,19)

"BLD",11062,"KRN","B",19.1,19.1)

"BLD",11062,"KRN","B",101,101)

"BLD",11062,"KRN","B",409.61,409.61)

"BLD",11062,"KRN","B",771,771)

"BLD",11062,"KRN","B",779.2,779.2)

"BLD",11062,"KRN","B",870,870)

"BLD",11062,"KRN","B",8989.51,8989.51)

"BLD",11062,"KRN","B",8989.52,8989.52)

"BLD",11062,"KRN","B",8994,8994)

"BLD",11062,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11062,"QUES",0)
^9.62^^
"BLD",11062,"REQB",0)
^9.611^^0
"KRN",19,8631,-1)
2^2
"KRN",19,8631,0)
LRAPSUPER^Supervisor, anat path^^M^66481^LRAPSUPER^^^^^^26
"KRN",19,8631,10,0)
^19.01IP^16^13
"KRN",19,8631,10,16,0)
14324^AL
"KRN",19,8631,10,16,"^")
LRAPALERT
"KRN",19,8631,"U")
SUPERVISOR, ANAT PATH
"KRN",19,14324,-1)
0^3
"KRN",19,14324,0)
LRAPALERT^Missing AP Alert Search^^R^^^^^^^y^LAB SERVICE^^
"KRN",19,14324,1,0)
^^4^4^3180501^
"KRN",19,14324,1,1,0)
This option will search Anatomic Pathology accessions which have been 
"KRN",19,14324,1,2,0)
verified.  If issues are found such as alerts which were not queued or 
"KRN",19,14324,1,3,0)
the Orders (#100) file not set correctly, a MailMan message and alert are 
"KRN",19,14324,1,4,0)
sent to the person invoking the option as well as the MailMan group "LMI".
"KRN",19,14324,10.1)
Alert Search
"KRN",19,14324,20)

"KRN",19,14324,25)
EN^LRAPUALT
"KRN",19,14324,200.9)
y
"KRN",19,14324,"U")
MISSING AP ALERT SEARCH
"KRN",8989.51,889,-1)
0^1
"KRN",8989.51,889,0)
LR AP ALERT SEARCH END^LR AP Alert Search End Date/Time^0^LR AP Alert Search End Date/Time^LR AP Alert Search End Date/Time^0
"KRN",8989.51,889,1)
D^::T^This value equals the last time that TaskMan ran option Missing AP Alert Search.
"KRN",8989.51,889,6)
D^::T
"KRN",8989.51,889,20,0)
^^11^11^3181206^
"KRN",8989.51,889,20,1,0)
This parameter only applies to a search initiated by Taskman when the
"KRN",8989.51,889,20,2,0)
option "Missing AP Alert Search" is defined to run automatically in
"KRN",8989.51,889,20,3,0)
TaskMan.  Users may manually run the search using the option "Missing AP
"KRN",8989.51,889,20,4,0)
Alert Search" without affecting the date/time set in this parameter.
"KRN",8989.51,889,20,5,0)
 
"KRN",8989.51,889,20,6,0)
The value for this parameter equals the last date/time that was searched 
"KRN",8989.51,889,20,7,0)
in order to find verified Anatomic Pathology cases which did not have an 
"KRN",8989.51,889,20,8,0)
alert generated.  Some sites are finding that alerts do not generate at 
"KRN",8989.51,889,20,9,0)
times.  The issue cannot be reproduced at will.  A suspected cause is 
"KRN",8989.51,889,20,10,0)
that a session is disconnected after verification but before the alert is 
"KRN",8989.51,889,20,11,0)
queued.
"KRN",8989.51,889,30,0)
^8989.513I^1^1
"KRN",8989.51,889,30,1,0)
1^4.2
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
504^3181210
"PKG",26,22,1,"PAH",1,1,0)
^^20^20^3181210
"PKG",26,22,1,"PAH",1,1,1,0)
R18600337FY18: Missing Anatomic Pathology Alerts
"PKG",26,22,1,"PAH",1,1,2,0)
R19264009FY18 (d)
"PKG",26,22,1,"PAH",1,1,3,0)
 
"PKG",26,22,1,"PAH",1,1,4,0)
Problem:
"PKG",26,22,1,"PAH",1,1,5,0)
-------
"PKG",26,22,1,"PAH",1,1,6,0)
 
"PKG",26,22,1,"PAH",1,1,7,0)
Alerts might not be generated after Anatomic Pathology cases are verified.
"PKG",26,22,1,"PAH",1,1,8,0)
 
"PKG",26,22,1,"PAH",1,1,9,0)
Resolution: 
"PKG",26,22,1,"PAH",1,1,10,0)
----------
"PKG",26,22,1,"PAH",1,1,11,0)
 
"PKG",26,22,1,"PAH",1,1,12,0)
The root cause of this issue is not yet known.  In the meantime, this 
"PKG",26,22,1,"PAH",1,1,13,0)
patch provides an option which will search for missing Anatomic
"PKG",26,22,1,"PAH",1,1,14,0)
Pathology alerts as well as other issues known to occur along with 
"PKG",26,22,1,"PAH",1,1,15,0)
missing alerts such as fields in the ORDERS (#100) file which are set 
"PKG",26,22,1,"PAH",1,1,16,0)
incorrectly.
"PKG",26,22,1,"PAH",1,1,17,0)
 
"PKG",26,22,1,"PAH",1,1,18,0)
Refer to the FORUM patch description for detailed information on alerts 
"PKG",26,22,1,"PAH",1,1,19,0)
and MailMan messages which are generated after the search option 
"PKG",26,22,1,"PAH",1,1,20,0)
completes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRAPUALT")
0^1^B158177199^n/a
"RTN","LRAPUALT",1,0)
LRAPUALT ;HPS/DSK - MISSING ANATOMIC PATHOLOGY ALERT SEARCH ;May 1, 2018@16:24
"RTN","LRAPUALT",2,0)
 ;;5.2;LAB SERVICE;**504**;Sep 27, 1994;Build 33
"RTN","LRAPUALT",3,0)
 ;
"RTN","LRAPUALT",4,0)
 Q
"RTN","LRAPUALT",5,0)
 ; 
"RTN","LRAPUALT",6,0)
 ;Reference to ^DPT supported by IA# 10035
"RTN","LRAPUALT",7,0)
 ;Reference to ^OR(100 supported by IA# 4167
"RTN","LRAPUALT",8,0)
 ;Reference to ^XTV(8992.1 supported by IA# 6914
"RTN","LRAPUALT",9,0)
 ;Reference to DD^%DT supported by IA #10003
"RTN","LRAPUALT",10,0)
 ;Reference to NOW^%DTC supported by IA #10000
"RTN","LRAPUALT",11,0)
 ;Reference to ^XLFDT calls supported by IA #10103
"RTN","LRAPUALT",12,0)
 ;Reference to ^XPAR calls supported by IA #2263
"RTN","LRAPUALT",13,0)
 ;Reference to %ZTLOAD supported by IA #10063
"RTN","LRAPUALT",14,0)
 ;Reference to $$SENDMSG^XMXAPI supported by IA #2729
"RTN","LRAPUALT",15,0)
 ;Reference to $$SETUP1^XQALERT supported by IA #10081
"RTN","LRAPUALT",16,0)
 ;
"RTN","LRAPUALT",17,0)
EN ;
"RTN","LRAPUALT",18,0)
 N LRQUIT,LRTASK,LRSDATE,LREDATE,LRSUB,LRDUZ
"RTN","LRAPUALT",19,0)
 ;
"RTN","LRAPUALT",20,0)
 S LRQUIT=0
"RTN","LRAPUALT",21,0)
 D DATE
"RTN","LRAPUALT",22,0)
 Q:LRQUIT
"RTN","LRAPUALT",23,0)
 D QUEUE
"RTN","LRAPUALT",24,0)
 Q
"RTN","LRAPUALT",25,0)
 ;
"RTN","LRAPUALT",26,0)
DATE ;
"RTN","LRAPUALT",27,0)
 I '$G(ZTQUEUED) D  Q
"RTN","LRAPUALT",28,0)
 . W !!,?5,"This option will search for missing Anatomic Pathology alerts"
"RTN","LRAPUALT",29,0)
 . W !,?5,"on verified accessions as well as other issues such as"
"RTN","LRAPUALT",30,0)
 . W !,?5,"incorrect settings in the Orders (#100) file."
"RTN","LRAPUALT",31,0)
 . W !!,?5,"This routine will run in the background and send an alert as well as"
"RTN","LRAPUALT",32,0)
 . W !,?5,"a MailMan message to you as well as the MailMan group ""LMI"" if any"
"RTN","LRAPUALT",33,0)
 . W !,?5,"missing Anatomic Pathology alerts are found."
"RTN","LRAPUALT",34,0)
 . W !!,?5,"The search may take upwards of 20 minutes to run the first time"
"RTN","LRAPUALT",35,0)
 . W !,?5,"or if it is run infrequently.",!
"RTN","LRAPUALT",36,0)
 . W !!,"The dates for the following prompts pertain to the dates that an"
"RTN","LRAPUALT",37,0)
 . W !,"Anatomic Pathology case is verified."
"RTN","LRAPUALT",38,0)
 . W !,"   (The date range cannot be more than a year due to the possibility that"
"RTN","LRAPUALT",39,0)
 . W !,"   the search may take a long time to complete.)",!
"RTN","LRAPUALT",40,0)
 . D ASK
"RTN","LRAPUALT",41,0)
 ;
"RTN","LRAPUALT",42,0)
 ;Search all verified cases from start date to current for TaskMan executions
"RTN","LRAPUALT",43,0)
 S LREDATE=$$NOW^XLFDT()
"RTN","LRAPUALT",44,0)
 ;
"RTN","LRAPUALT",45,0)
 ;Check parameter setting for the last date/time that TaskMan ran the search
"RTN","LRAPUALT",46,0)
 S LRSDATE=$$GET^XPAR("SYS","LR AP ALERT SEARCH END",1,"Q")
"RTN","LRAPUALT",47,0)
 ;
"RTN","LRAPUALT",48,0)
 ;If report hasn't been run before, generate for previous 30 days
"RTN","LRAPUALT",49,0)
 I LRSDATE="" S LRSDATE=$$FMADD^XLFDT(LREDATE,-30)
"RTN","LRAPUALT",50,0)
 ;
"RTN","LRAPUALT",51,0)
 ;Save end date/time in parameter to use next time that TaskMan searches
"RTN","LRAPUALT",52,0)
 D EN^XPAR("SYS","LR AP ALERT SEARCH END",,LREDATE,"")
"RTN","LRAPUALT",53,0)
 Q
"RTN","LRAPUALT",54,0)
 ;
"RTN","LRAPUALT",55,0)
ASK ;
"RTN","LRAPUALT",56,0)
 ;Only used for manual execution of routine "Missing AP Alert Search"
"RTN","LRAPUALT",57,0)
 ;(not used by TaskMan).
"RTN","LRAPUALT",58,0)
 ;
"RTN","LRAPUALT",59,0)
 N DIR
"RTN","LRAPUALT",60,0)
 S DIR(0)="DO",DIR("A")="Date to begin search"
"RTN","LRAPUALT",61,0)
 D ^DIR
"RTN","LRAPUALT",62,0)
 I $G(Y)=""!($D(DTOUT))!($D(DUOUT)) S LRQUIT=1 Q
"RTN","LRAPUALT",63,0)
 S LRSDATE=$P(Y,".")
"RTN","LRAPUALT",64,0)
 D DD^%DT W ?40,$G(Y)
"RTN","LRAPUALT",65,0)
 S DIR(0)="DO",DIR("A")="Date to end search"
"RTN","LRAPUALT",66,0)
 D ^DIR
"RTN","LRAPUALT",67,0)
 I $G(Y)=""!($D(DTOUT))!($D(DUOUT)) S LRQUIT=1 Q
"RTN","LRAPUALT",68,0)
 S LREDATE=$P(Y,".")
"RTN","LRAPUALT",69,0)
  I LRSDATE>LREDATE D  G ASK
"RTN","LRAPUALT",70,0)
 . W !,?5,"The start date cannot be greater than the end date.",!
"RTN","LRAPUALT",71,0)
 D DD^%DT W ?40,$G(Y)
"RTN","LRAPUALT",72,0)
 I $$FMDIFF^XLFDT(LREDATE,LRSDATE)>365 D  G ASK
"RTN","LRAPUALT",73,0)
 . W !!,"A maximum of a year's worth of orders may be searched due to"
"RTN","LRAPUALT",74,0)
 . W !,"potential journaling or other system issues.",!
"RTN","LRAPUALT",75,0)
 S LREDATE=LREDATE_".2359"
"RTN","LRAPUALT",76,0)
 Q
"RTN","LRAPUALT",77,0)
 ;
"RTN","LRAPUALT",78,0)
QUEUE ;
"RTN","LRAPUALT",79,0)
 S LRSUB="LR AP ALERT TRACE "_LREDATE
"RTN","LRAPUALT",80,0)
 L +^XTMP(LRSUB):5
"RTN","LRAPUALT",81,0)
 ;
"RTN","LRAPUALT",82,0)
 ;For the lock to fail, two processes must be starting the same date/time, but
"RTN","LRAPUALT",83,0)
 ;checking anyway.
"RTN","LRAPUALT",84,0)
 I '$T,'$G(ZTQUEUED) D  Q
"RTN","LRAPUALT",85,0)
 . W !!,"Someone else (or TaskMan) is currently executing this option. Please try later."
"RTN","LRAPUALT",86,0)
 ;
"RTN","LRAPUALT",87,0)
 L -^XTMP(LRSUB)
"RTN","LRAPUALT",88,0)
 ;
"RTN","LRAPUALT",89,0)
 ;store DUZ if a user is manually executing the option
"RTN","LRAPUALT",90,0)
 S LRDUZ=$S('$G(ZTQUEUED):DUZ,1:"")
"RTN","LRAPUALT",91,0)
 ;
"RTN","LRAPUALT",92,0)
 S LRTASK=0
"RTN","LRAPUALT",93,0)
 S LRTASK=$$TASK()
"RTN","LRAPUALT",94,0)
 I '$G(ZTQUEUED),LRTASK D  Q
"RTN","LRAPUALT",95,0)
 . W !!,"Task #: ",+LRTASK," has been queued to run on "
"RTN","LRAPUALT",96,0)
 . W $$HTE^XLFDT($P(LRTASK,"^",2))
"RTN","LRAPUALT",97,0)
 I '$G(ZTQUEUED),'LRTASK D
"RTN","LRAPUALT",98,0)
 . W !!,"Task not queued for unknown reason. Please try again."
"RTN","LRAPUALT",99,0)
 Q
"RTN","LRAPUALT",100,0)
 ;
"RTN","LRAPUALT",101,0)
TASK() ;
"RTN","LRAPUALT",102,0)
 N ZTRTN,ZTDESC
"RTN","LRAPUALT",103,0)
 S ZTSAVE("LRDUZ")=""
"RTN","LRAPUALT",104,0)
 S ZTSAVE("LRSDATE")=""
"RTN","LRAPUALT",105,0)
 S ZTSAVE("LREDATE")=""
"RTN","LRAPUALT",106,0)
 S ZTSAVE("LRSUB")=""
"RTN","LRAPUALT",107,0)
 S ZTRTN="START^LRAPUALT"
"RTN","LRAPUALT",108,0)
 S ZTDESC="Missing AP Alert Search"
"RTN","LRAPUALT",109,0)
 S ZTIO=""
"RTN","LRAPUALT",110,0)
 D ^%ZTLOAD
"RTN","LRAPUALT",111,0)
 Q +$G(ZTSK)_"^"_$G(ZTSK("D"))
"RTN","LRAPUALT",112,0)
 ;
"RTN","LRAPUALT",113,0)
START ;
"RTN","LRAPUALT",114,0)
 L +^XTMP(LRSUB):20
"RTN","LRAPUALT",115,0)
 I '$T D LOCKED Q
"RTN","LRAPUALT",116,0)
 ;
"RTN","LRAPUALT",117,0)
 N LRAREA,LRSS,X,%,LRDT,LRDTTM
"RTN","LRAPUALT",118,0)
 D NOW^%DTC
"RTN","LRAPUALT",119,0)
 ;Keep date/time stamp in case running this routine manually multiple times a day
"RTN","LRAPUALT",120,0)
 ;and monitoring for missing alerts since the last time the routine ran
"RTN","LRAPUALT",121,0)
 ;
"RTN","LRAPUALT",122,0)
 S LRDT=X,LRDTTM=%
"RTN","LRAPUALT",123,0)
 ;
"RTN","LRAPUALT",124,0)
 ;Keep data for 90 days for future research, if needed
"RTN","LRAPUALT",125,0)
 S ^XTMP(LRSUB,0)=$$FMADD^XLFDT(LRDT,90)_"^"_LRDT_"^Missing AP Alert research"
"RTN","LRAPUALT",126,0)
 ;
"RTN","LRAPUALT",127,0)
 ;Kill message text if not killed previously for some reason
"RTN","LRAPUALT",128,0)
 K ^XTMP("AP ALERT MESSAGE "_LREDATE)
"RTN","LRAPUALT",129,0)
 ;
"RTN","LRAPUALT",130,0)
 ;LRLINE for Mail Message line count
"RTN","LRAPUALT",131,0)
 S LRLINE=4
"RTN","LRAPUALT",132,0)
 ;
"RTN","LRAPUALT",133,0)
 ;Find all accession areas for CY, EM, and SP LR subscripts
"RTN","LRAPUALT",134,0)
 ;
"RTN","LRAPUALT",135,0)
 S LRSS=0
"RTN","LRAPUALT",136,0)
 F  S LRSS=$O(^LRO(68,LRSS)) Q:'LRSS  D
"RTN","LRAPUALT",137,0)
 . S LRAREA=$P($G(^LRO(68,LRSS,0)),"^",2)
"RTN","LRAPUALT",138,0)
 . I "CYEMSP"[LRAREA D LRSS
"RTN","LRAPUALT",139,0)
 D END
"RTN","LRAPUALT",140,0)
 Q
"RTN","LRAPUALT",141,0)
 ;
"RTN","LRAPUALT",142,0)
LRSS ;
"RTN","LRAPUALT",143,0)
 ;Check to see if a yearly, monthly or daily accession area
"RTN","LRAPUALT",144,0)
 ;even though Anatomic Pathology accession areas are normally yearly
"RTN","LRAPUALT",145,0)
 N LRTYPE,LRAD
"RTN","LRAPUALT",146,0)
 S LRTYPE=$P(^LRO(68,LRSS,0),"^",3)
"RTN","LRAPUALT",147,0)
 ;
"RTN","LRAPUALT",148,0)
 ;No other types should exist, but checking to be sure
"RTN","LRAPUALT",149,0)
 I ",Y,M,D,"'[LRTYPE Q
"RTN","LRAPUALT",150,0)
 ;
"RTN","LRAPUALT",151,0)
 ;A daily accession area might have some cases re-checked due to logic below.
"RTN","LRAPUALT",152,0)
 ;However, Anatomic Pathology accession areas are normally not daily.
"RTN","LRAPUALT",153,0)
 S LRAD=$S(LRTYPE="Y":$E(LRSDATE,1,3)-1_"000",LRTYPE="M":$E(LRSDATE,1,5)-1_"00",1:$P(LRSDATE,".")-1_".2359")
"RTN","LRAPUALT",154,0)
 ;
"RTN","LRAPUALT",155,0)
 ;Yearly area: If LRAD year is greater than end date's year - quit
"RTN","LRAPUALT",156,0)
 ;Monthly area: If LRAD year/month is greater than end date's year/month - quit
"RTN","LRAPUALT",157,0)
 ;Daily area: If LRAD year/month/day is greater than end date - quit
"RTN","LRAPUALT",158,0)
 ;All checks are needed if user manually executed the search.
"RTN","LRAPUALT",159,0)
 ;(Note: The line below is long but is more efficient by not looping through
"RTN","LRAPUALT",160,0)
 ;       all date levels if manually manually executed the search.)
"RTN","LRAPUALT",161,0)
 ;
"RTN","LRAPUALT",162,0)
 F  S LRAD=$O(^LRO(68,LRSS,1,LRAD)) Q:'LRAD  Q:$E(LRAD,1,3)>$E(LREDATE,1,3)  Q:$E(LRAD,1,5)>$E(LREDATE,1,5)  Q:LRAD>$P(LREDATE,".")  D
"RTN","LRAPUALT",163,0)
 . ;only looping through accessions starting with start date's year
"RTN","LRAPUALT",164,0)
 . I $E(LRAD,1,3)'<$E(LRSDATE,1,3) D LRAC
"RTN","LRAPUALT",165,0)
 Q
"RTN","LRAPUALT",166,0)
 ;
"RTN","LRAPUALT",167,0)
LRAC ;Cycle through accessions by verified date/time
"RTN","LRAPUALT",168,0)
 N LRVER,LRAC
"RTN","LRAPUALT",169,0)
 ;
"RTN","LRAPUALT",170,0)
 ;Start of search will be by date/time for TaskMan and by date for a user
"RTN","LRAPUALT",171,0)
 ;TaskMan searches might be defined to run several times daily.
"RTN","LRAPUALT",172,0)
 S LRVER=$S(LRDUZ]"":LRSDATE-1_".2359",1:LRSDATE)
"RTN","LRAPUALT",173,0)
 ;
"RTN","LRAPUALT",174,0)
 F  S LRVER=$O(^LRO(68,LRSS,1,LRAD,1,"AC",LRVER)) Q:LRVER>LREDATE  Q:LRVER=""  D
"RTN","LRAPUALT",175,0)
 . S LRAC=0
"RTN","LRAPUALT",176,0)
 . F  S LRAC=$O(^LRO(68,LRSS,1,LRAD,1,"AC",LRVER,LRAC)) Q:LRAC=""  D
"RTN","LRAPUALT",177,0)
 . . ;
"RTN","LRAPUALT",178,0)
 . . ;Are results verified? 
"RTN","LRAPUALT",179,0)
 . . ;Since multiple tests may be on file in file 68, it's
"RTN","LRAPUALT",180,0)
 . . ;easier to look in file 69 for the completion status
"RTN","LRAPUALT",181,0)
 . . D CHK69
"RTN","LRAPUALT",182,0)
 Q
"RTN","LRAPUALT",183,0)
 ;
"RTN","LRAPUALT",184,0)
CHK69 ;
"RTN","LRAPUALT",185,0)
 N LRLABNM,LRODT,LRSN,LRRL
"RTN","LRAPUALT",186,0)
 S LRLABNM=$G(^LRO(68,LRSS,1,LRAD,1,LRAC,.1))
"RTN","LRAPUALT",187,0)
 I LRLABNM="" S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)="No Lab Number in file 68" Q
"RTN","LRAPUALT",188,0)
 ;
"RTN","LRAPUALT",189,0)
 ;There should only be one file 69 entry, but running a loop
"RTN","LRAPUALT",190,0)
 ;just in case
"RTN","LRAPUALT",191,0)
 ;
"RTN","LRAPUALT",192,0)
 S LRRL="",(LRODT,LRSN)=0
"RTN","LRAPUALT",193,0)
 F  S LRODT=$O(^LRO(69,"C",LRLABNM,LRODT)) Q:LRODT=""  D
"RTN","LRAPUALT",194,0)
 . F  S LRSN=$O(^LRO(69,"C",LRLABNM,LRODT,LRSN)) Q:LRSN=""  D
"RTN","LRAPUALT",195,0)
 . . S LRRL=$P($G(^LRO(69,LRODT,1,LRSN,3)),"^",2)
"RTN","LRAPUALT",196,0)
 . . I LRRL]"" D CHK100
"RTN","LRAPUALT",197,0)
 Q
"RTN","LRAPUALT",198,0)
 ;
"RTN","LRAPUALT",199,0)
CHK100 ;check the orders file
"RTN","LRAPUALT",200,0)
 ;get CPRS order number
"RTN","LRAPUALT",201,0)
 ;multiple order numbers can be present per file 69 specimen number
"RTN","LRAPUALT",202,0)
 ;but Anatomic Pathology should only have one CPRS order number
"RTN","LRAPUALT",203,0)
 N LRCPRS,LRFULL,LRPKG,LRSTATUS,LRRES,LRADFN
"RTN","LRAPUALT",204,0)
 S LRCPRS=$P($G(^LRO(69,LRODT,1,LRSN,0)),"^",11)
"RTN","LRAPUALT",205,0)
 I LRCPRS="" S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)="No CPRS order number" Q
"RTN","LRAPUALT",206,0)
 ;
"RTN","LRAPUALT",207,0)
 ;Need full accession number (ex. "SP 18 34") when checking
"RTN","LRAPUALT",208,0)
 ;for missing alerts and for possible MailMan messages
"RTN","LRAPUALT",209,0)
 S LRFULL=$G(^LRO(68,LRSS,1,LRAD,1,LRAC,.2))
"RTN","LRAPUALT",210,0)
 ;
"RTN","LRAPUALT",211,0)
 ;This should never be null, but checking nevertheless.
"RTN","LRAPUALT",212,0)
 I LRFULL="" S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)="No accession in File 68 at .2 level." Q
"RTN","LRAPUALT",213,0)
 ;
"RTN","LRAPUALT",214,0)
 ;Setting date/time levels in ^XTMP using variable LRDTTM
"RTN","LRAPUALT",215,0)
 ;so will only have to check recent dates/times the search was executed
"RTN","LRAPUALT",216,0)
 ;if reviewing the global and the search runs multiple times daily
"RTN","LRAPUALT",217,0)
 ;
"RTN","LRAPUALT",218,0)
 ;is package reference missing
"RTN","LRAPUALT",219,0)
 S LRPKG=$P($G(^OR(100,LRCPRS,4)),";",4,5)
"RTN","LRAPUALT",220,0)
 I LRPKG="" D
"RTN","LRAPUALT",221,0)
 . D MSGINIT
"RTN","LRAPUALT",222,0)
 . S LRLINE=LRLINE+1
"RTN","LRAPUALT",223,0)
 . S ^XTMP("AP ALERT MESSAGE "_LREDATE,LRLINE)="   - is missing package reference for order "_LRCPRS_"."
"RTN","LRAPUALT",224,0)
 . S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC,"NO_PKG_REF")=LRCPRS_"^Missing package reference"
"RTN","LRAPUALT",225,0)
 ;
"RTN","LRAPUALT",226,0)
 ;is status correct
"RTN","LRAPUALT",227,0)
 S LRSTATUS=$P($G(^OR(100,LRCPRS,3)),"^",3)
"RTN","LRAPUALT",228,0)
 I LRSTATUS'=2 D
"RTN","LRAPUALT",229,0)
 . I '$D(^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)) D MSGINIT
"RTN","LRAPUALT",230,0)
 . S LRLINE=LRLINE+1
"RTN","LRAPUALT",231,0)
 . S ^XTMP("AP ALERT MESSAGE "_LREDATE,LRLINE)="   - has incorrect status of "_LRSTATUS_" for order "_LRCPRS_"."
"RTN","LRAPUALT",232,0)
 . S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC,"INCORRECT_STATUS")=LRCPRS_"^Incorrect status of "_LRSTATUS
"RTN","LRAPUALT",233,0)
 ;
"RTN","LRAPUALT",234,0)
 ;Is Results Date/Time set
"RTN","LRAPUALT",235,0)
 S LRRES=$P($G(^OR(100,LRCPRS,7)),"^")
"RTN","LRAPUALT",236,0)
 I LRRES="" D
"RTN","LRAPUALT",237,0)
 . I '$D(^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)) D MSGINIT
"RTN","LRAPUALT",238,0)
 . S LRLINE=LRLINE+1
"RTN","LRAPUALT",239,0)
 . S ^XTMP("AP ALERT MESSAGE "_LREDATE,LRLINE)="   - has no results date/time for order "_LRCPRS_"."
"RTN","LRAPUALT",240,0)
 . S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC,"NO_RESULTS_DATE/TIME")=LRCPRS_"^No results date/time"
"RTN","LRAPUALT",241,0)
 ;
"RTN","LRAPUALT",242,0)
 ;was alert generated?
"RTN","LRAPUALT",243,0)
 ;alerts are only sent for Patient (#2) file
"RTN","LRAPUALT",244,0)
 S LRADFN=$P(^OR(100,LRCPRS,0),"^",2)
"RTN","LRAPUALT",245,0)
 I $P(LRADFN,";",2)["DPT" D
"RTN","LRAPUALT",246,0)
 . S LRADFN=$P(LRADFN,";")
"RTN","LRAPUALT",247,0)
 . D CHKALERT
"RTN","LRAPUALT",248,0)
 Q
"RTN","LRAPUALT",249,0)
 ;
"RTN","LRAPUALT",250,0)
MSGINIT ;
"RTN","LRAPUALT",251,0)
 ;First time issue found for this accession
"RTN","LRAPUALT",252,0)
 S LRLINE=LRLINE+1
"RTN","LRAPUALT",253,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,LRLINE)="  "_LRFULL_":"
"RTN","LRAPUALT",254,0)
 Q
"RTN","LRAPUALT",255,0)
 ;
"RTN","LRAPUALT",256,0)
CHKALERT ;
"RTN","LRAPUALT",257,0)
 N LRALERT,LRHIT,LRPNM
"RTN","LRAPUALT",258,0)
 S LRALERT="",LRHIT=0
"RTN","LRAPUALT",259,0)
 F  S LRALERT=$O(^XTV(8992.1,"C",LRADFN,LRALERT)) Q:LRALERT=""  Q:LRHIT  D
"RTN","LRAPUALT",260,0)
 . I $P($G(^XTV(8992.1,LRALERT,2)),"^",2)=LRFULL S LRHIT=1
"RTN","LRAPUALT",261,0)
 I 'LRHIT D
"RTN","LRAPUALT",262,0)
 . S LRPNM=$P(^DPT(LRADFN,0),"^")
"RTN","LRAPUALT",263,0)
 . I '$D(^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)) D MSGINIT
"RTN","LRAPUALT",264,0)
 . S LRLINE=LRLINE+1
"RTN","LRAPUALT",265,0)
 . S ^XTMP("AP ALERT MESSAGE "_LREDATE,LRLINE)="   - *** did not generate an alert. ***"
"RTN","LRAPUALT",266,0)
 . ;not sending patient name in MailMan message in case this would violate CRISP
"RTN","LRAPUALT",267,0)
 . ;setting into ^XTMP to aid in research if needed
"RTN","LRAPUALT",268,0)
 . S ^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC,"NO_ALERT")=LRFULL_"^"_LRCPRS_"^"_LRPNM_"^Missing alert"
"RTN","LRAPUALT",269,0)
 . S ^XTMP("AP NO ALERT "_LREDATE)=""
"RTN","LRAPUALT",270,0)
 Q
"RTN","LRAPUALT",271,0)
 ;
"RTN","LRAPUALT",272,0)
END ;Send alerts and MailMan messages
"RTN","LRAPUALT",273,0)
 ;LRDUZ is null if search executed by TaskMan
"RTN","LRAPUALT",274,0)
 ;
"RTN","LRAPUALT",275,0)
 ;Issues were found
"RTN","LRAPUALT",276,0)
 I $D(^XTMP("AP ALERT MESSAGE "_LREDATE)) D
"RTN","LRAPUALT",277,0)
 . D MAIL
"RTN","LRAPUALT",278,0)
 . I $D(^XTMP("AP NO ALERT "_LREDATE)) D ALERT Q
"RTN","LRAPUALT",279,0)
 . ;Issues were found by none are missing alerts
"RTN","LRAPUALT",280,0)
 . D ALERT3
"RTN","LRAPUALT",281,0)
 ;
"RTN","LRAPUALT",282,0)
 ;No issues were found
"RTN","LRAPUALT",283,0)
 ;Do not send alert and MailMan message if executed by TaskMan
"RTN","LRAPUALT",284,0)
 I '$D(^XTMP("AP ALERT MESSAGE "_LREDATE)),LRDUZ]"" D
"RTN","LRAPUALT",285,0)
 . D MAIL2,ALERT2
"RTN","LRAPUALT",286,0)
 ;
"RTN","LRAPUALT",287,0)
 K ^XTMP("AP ALERT MESSAGE "_LREDATE),^XTMP("AP NO ALERT "_LREDATE)
"RTN","LRAPUALT",288,0)
 S ^XTMP(LRSUB,LRDTTM,.1)=$S($D(^XTMP(LRSUB,LRDTTM)):"Issue(s) found",1:"Nothing found")
"RTN","LRAPUALT",289,0)
 S ^XTMP(LRSUB,LRDTTM,.2)="Date Range: "_$$FMTE^XLFDT(LRSDATE)_" to: "_$$FMTE^XLFDT(LREDATE)
"RTN","LRAPUALT",290,0)
 L -^XTMP(LRSUB)
"RTN","LRAPUALT",291,0)
 Q
"RTN","LRAPUALT",292,0)
 ;
"RTN","LRAPUALT",293,0)
MAIL ;
"RTN","LRAPUALT",294,0)
 N LRMRANGE,LRMTEXT,LRMSUB,LRMY,LRMZ,LRMIN
"RTN","LRAPUALT",295,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,1)="Anatomic Pathology Alert Search Issues Found"
"RTN","LRAPUALT",296,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,2)=" "
"RTN","LRAPUALT",297,0)
 S LRMRANGE=$S(LRDUZ]"":"Date ",1:"Date/Time ")_"Range Searched: "_$$FMTE^XLFDT(LRSDATE)
"RTN","LRAPUALT",298,0)
 S LRMRANGE=LRMRANGE_" to: "_$S(LRDUZ]"":$P($$FMTE^XLFDT(LREDATE),"@"),1:$$FMTE^XLFDT(LREDATE))
"RTN","LRAPUALT",299,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,3)=LRMRANGE
"RTN","LRAPUALT",300,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,4)=" "
"RTN","LRAPUALT",301,0)
 S LRMTEXT="^XTMP(""AP ALERT MESSAGE ""_LREDATE)"
"RTN","LRAPUALT",302,0)
 S LRMSUB="Anatomic Pathology Alert Search Issues Found"
"RTN","LRAPUALT",303,0)
 ;
"RTN","LRAPUALT",304,0)
 ;send to user if manually running the routine
"RTN","LRAPUALT",305,0)
 I LRDUZ]"" S LRMY(LRDUZ)=""
"RTN","LRAPUALT",306,0)
 S LRMY("G.LMI")=""
"RTN","LRAPUALT",307,0)
 ;
"RTN","LRAPUALT",308,0)
 S LRMIN("FROM")="Anatomic Pathology Missing Alert Search"
"RTN","LRAPUALT",309,0)
 D SENDMSG^XMXAPI(DUZ,LRMSUB,LRMTEXT,.LRMY,.LRMIN,.LRMZ,"")
"RTN","LRAPUALT",310,0)
 Q
"RTN","LRAPUALT",311,0)
 ;
"RTN","LRAPUALT",312,0)
ALERT ;
"RTN","LRAPUALT",313,0)
 ;Individual alerts are sent for each accession which is missing an alert
"RTN","LRAPUALT",314,0)
 ;"X" prefixed variables are needed for sending alerts
"RTN","LRAPUALT",315,0)
 N LRTXT,XQAMSG,XQA,XQAID,LRSS,LRAD,LRAC,LRALERT
"RTN","LRAPUALT",316,0)
 S LRTXT="*** ALERT NOT SENT FOR ACCESSION: "
"RTN","LRAPUALT",317,0)
 S (LRSS,LRAD,LRAC)=""
"RTN","LRAPUALT",318,0)
 F  S LRSS=$O(^XTMP(LRSUB,LRDTTM,LRSS)) Q:LRSS=""  D
"RTN","LRAPUALT",319,0)
 . F  S LRAD=$O(^XTMP(LRSUB,LRDTTM,LRSS,LRAD)) Q:LRAD=""  D
"RTN","LRAPUALT",320,0)
 . . F  S LRAC=$O(^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC)) Q:LRAC=""  D
"RTN","LRAPUALT",321,0)
 . . . S LRFULL=$P($G(^XTMP(LRSUB,LRDTTM,LRSS,LRAD,LRAC,"NO_ALERT")),"^")
"RTN","LRAPUALT",322,0)
 . . . Q:LRFULL=""
"RTN","LRAPUALT",323,0)
 . . . ;need to re-set XQAID and XQA because it is killed if sending multiple
"RTN","LRAPUALT",324,0)
 . . . ;alerts
"RTN","LRAPUALT",325,0)
 . . . S XQAID="Missing Alert"
"RTN","LRAPUALT",326,0)
 . . . I LRDUZ]"" S XQA(LRDUZ)=""
"RTN","LRAPUALT",327,0)
 . . . S XQA("G.LMI")=""
"RTN","LRAPUALT",328,0)
 . . . S XQAMSG=LRTXT_LRFULL_" ***"
"RTN","LRAPUALT",329,0)
 . . . S LRALERT=$$SETUP1^XQALERT
"RTN","LRAPUALT",330,0)
 Q
"RTN","LRAPUALT",331,0)
 ;
"RTN","LRAPUALT",332,0)
MAIL2 ;
"RTN","LRAPUALT",333,0)
 ;This section is only called if a user manually invoked the option.
"RTN","LRAPUALT",334,0)
 N LRMRANGE,LRMTEXT,LRMSUB,LRMY,LRMZ,LRMIN
"RTN","LRAPUALT",335,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,1)=" "
"RTN","LRAPUALT",336,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,2)="No missing Anatomic Pathology alert issues found on "
"RTN","LRAPUALT",337,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,2)=^XTMP("AP ALERT MESSAGE "_LREDATE,2)_$$FMTE^XLFDT(LRDTTM,"MZ")_"."
"RTN","LRAPUALT",338,0)
 S LRMRANGE="Date Range Searched: "_$$FMTE^XLFDT(LRSDATE)
"RTN","LRAPUALT",339,0)
 S LRMRANGE=LRMRANGE_" to: "_$S(LRDUZ]"":$P($$FMTE^XLFDT(LREDATE),"@"),1:$$FMTE^XLFDT(LREDATE))
"RTN","LRAPUALT",340,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,3)=LRMRANGE
"RTN","LRAPUALT",341,0)
 S ^XTMP("AP ALERT MESSAGE "_LREDATE,4)=" "
"RTN","LRAPUALT",342,0)
 S LRMTEXT="^XTMP(""AP ALERT MESSAGE ""_LREDATE)"
"RTN","LRAPUALT",343,0)
 S LRMSUB="No Anatomic Pathology Alert Search Issues Found"
"RTN","LRAPUALT",344,0)
 ;
"RTN","LRAPUALT",345,0)
 ;send to person running the routine
"RTN","LRAPUALT",346,0)
 S LRMY(LRDUZ)=""
"RTN","LRAPUALT",347,0)
 S LRMY("G.LMI")=""
"RTN","LRAPUALT",348,0)
 ;
"RTN","LRAPUALT",349,0)
 S LRMIN("FROM")="Anatomic Pathology Missing Alert Search"
"RTN","LRAPUALT",350,0)
 D SENDMSG^XMXAPI(LRDUZ,LRMSUB,LRMTEXT,.LRMY,.LRMIN,.LRMZ,"")
"RTN","LRAPUALT",351,0)
 K ^XTMP("AP ALERT MESSAGE "_LREDATE)
"RTN","LRAPUALT",352,0)
 Q
"RTN","LRAPUALT",353,0)
 ;
"RTN","LRAPUALT",354,0)
ALERT2 ;
"RTN","LRAPUALT",355,0)
 ;This section is only called if a user manually invoked the search option.
"RTN","LRAPUALT",356,0)
 N XQAMSG,XQA,XQAID,LRALERT
"RTN","LRAPUALT",357,0)
 S XQAID="Missing Alert Search"
"RTN","LRAPUALT",358,0)
 S XQA(LRDUZ)=""
"RTN","LRAPUALT",359,0)
 S XQA("G.LMI")=""
"RTN","LRAPUALT",360,0)
 S XQAMSG="No Missing AP Alerts Found on "_$$FMTE^XLFDT(LRDTTM,"MZ")
"RTN","LRAPUALT",361,0)
 S LRALERT=$$SETUP1^XQALERT
"RTN","LRAPUALT",362,0)
 Q
"RTN","LRAPUALT",363,0)
 ;
"RTN","LRAPUALT",364,0)
ALERT3 ;
"RTN","LRAPUALT",365,0)
 N XQAMSG,XQA,XQAID,LRALERT
"RTN","LRAPUALT",366,0)
 S XQAID="Missing Alert Search"
"RTN","LRAPUALT",367,0)
 I LRDUZ]"" S XQA(LRDUZ)=""
"RTN","LRAPUALT",368,0)
 S XQA("G.LMI")=""
"RTN","LRAPUALT",369,0)
 S XQAMSG="Issues(s) found but no missing AP alerts on "_$$FMTE^XLFDT(LRDTTM,"MZ")
"RTN","LRAPUALT",370,0)
 S LRALERT=$$SETUP1^XQALERT
"RTN","LRAPUALT",371,0)
 Q
"RTN","LRAPUALT",372,0)
 ;
"RTN","LRAPUALT",373,0)
LOCKED ;Routine was already being executed by time a user or TaskMan started
"RTN","LRAPUALT",374,0)
 ;This should be a rare occurrence.
"RTN","LRAPUALT",375,0)
 N XQAMSG,XQA,XQAID,LRALERT,%
"RTN","LRAPUALT",376,0)
 D NOW^%DTC
"RTN","LRAPUALT",377,0)
 S XQAID="Missing Alert Search"
"RTN","LRAPUALT",378,0)
 I LRDUZ]"" S XQA(LRDUZ)=""
"RTN","LRAPUALT",379,0)
 S XQA("G.LMI")=""
"RTN","LRAPUALT",380,0)
 S XQAMSG="Missing Alert Search already running - "_$$FMTE^XLFDT(%,"MZ")
"RTN","LRAPUALT",381,0)
 S LRALERT=$$SETUP1^XQALERT
"RTN","LRAPUALT",382,0)
 Q
"VER")
8.0^22.2
"BLD",11062,6)
^417
**END**
**END**

