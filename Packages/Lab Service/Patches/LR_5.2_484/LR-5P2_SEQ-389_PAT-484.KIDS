Released LR*5.2*484 SEQ #389
Extracted from mail message
**KIDS**:LR*5.2*484^

**INSTALL NAME**
LR*5.2*484
"BLD",10197,0)
LR*5.2*484^LAB SERVICE^0^3170601^y
"BLD",10197,1,0)
^^1^1^3170523^^
"BLD",10197,1,1,0)
Please see FORUM for full patch description and installation instructions.
"BLD",10197,4,0)
^9.64PA^^
"BLD",10197,6.3)
2
"BLD",10197,"ABPKG")
n
"BLD",10197,"KRN",0)
^9.67PA^779.2^20
"BLD",10197,"KRN",.4,0)
.4
"BLD",10197,"KRN",.401,0)
.401
"BLD",10197,"KRN",.402,0)
.402
"BLD",10197,"KRN",.403,0)
.403
"BLD",10197,"KRN",.5,0)
.5
"BLD",10197,"KRN",.84,0)
.84
"BLD",10197,"KRN",3.6,0)
3.6
"BLD",10197,"KRN",3.8,0)
3.8
"BLD",10197,"KRN",9.2,0)
9.2
"BLD",10197,"KRN",9.8,0)
9.8
"BLD",10197,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",10197,"KRN",9.8,"NM",1,0)
LRVRAR^^0^B72283699
"BLD",10197,"KRN",9.8,"NM",3,0)
LRVER1^^0^B49802550
"BLD",10197,"KRN",9.8,"NM",4,0)
LRLNCV^^0^B8979547
"BLD",10197,"KRN",9.8,"NM","B","LRLNCV",4)

"BLD",10197,"KRN",9.8,"NM","B","LRVER1",3)

"BLD",10197,"KRN",9.8,"NM","B","LRVRAR",1)

"BLD",10197,"KRN",19,0)
19
"BLD",10197,"KRN",19.1,0)
19.1
"BLD",10197,"KRN",101,0)
101
"BLD",10197,"KRN",409.61,0)
409.61
"BLD",10197,"KRN",771,0)
771
"BLD",10197,"KRN",779.2,0)
779.2
"BLD",10197,"KRN",870,0)
870
"BLD",10197,"KRN",8989.51,0)
8989.51
"BLD",10197,"KRN",8989.52,0)
8989.52
"BLD",10197,"KRN",8994,0)
8994
"BLD",10197,"KRN","B",.4,.4)

"BLD",10197,"KRN","B",.401,.401)

"BLD",10197,"KRN","B",.402,.402)

"BLD",10197,"KRN","B",.403,.403)

"BLD",10197,"KRN","B",.5,.5)

"BLD",10197,"KRN","B",.84,.84)

"BLD",10197,"KRN","B",3.6,3.6)

"BLD",10197,"KRN","B",3.8,3.8)

"BLD",10197,"KRN","B",9.2,9.2)

"BLD",10197,"KRN","B",9.8,9.8)

"BLD",10197,"KRN","B",19,19)

"BLD",10197,"KRN","B",19.1,19.1)

"BLD",10197,"KRN","B",101,101)

"BLD",10197,"KRN","B",409.61,409.61)

"BLD",10197,"KRN","B",771,771)

"BLD",10197,"KRN","B",779.2,779.2)

"BLD",10197,"KRN","B",870,870)

"BLD",10197,"KRN","B",8989.51,8989.51)

"BLD",10197,"KRN","B",8989.52,8989.52)

"BLD",10197,"KRN","B",8994,8994)

"BLD",10197,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10197,"QUES",0)
^9.62^^
"BLD",10197,"REQB",0)
^9.611^3^3
"BLD",10197,"REQB",1,0)
LR*5.2*458^1
"BLD",10197,"REQB",2,0)
LR*5.2*475^1
"BLD",10197,"REQB",3,0)
LR*5.2*468^1
"BLD",10197,"REQB","B","LR*5.2*458",1)

"BLD",10197,"REQB","B","LR*5.2*468",3)

"BLD",10197,"REQB","B","LR*5.2*475",2)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^^0
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950611
"PKG",26,22,1,"PAH",1,0)
484^3170601
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3170601
"PKG",26,22,1,"PAH",1,1,1,0)
Please see FORUM for full patch description and installation instructions.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LRLNCV")
0^4^B8979547^B8729767
"RTN","LRLNCV",1,0)
LRLNCV ;DALOI/CA-VALIDATE LOINC MAPPING ;18-JUL-2001
"RTN","LRLNCV",2,0)
 ;;5.2;LAB SERVICE;**232,278,468,484**;Sep 27,1994;Build 2
"RTN","LRLNCV",3,0)
 ;
"RTN","LRLNCV",4,0)
 ; 5.2;LAB SERVICE; CHANGE FOR PATCH LR*5.2*468; Feb 10 2016
"RTN","LRLNCV",5,0)
 ;
"RTN","LRLNCV",6,0)
 ;=================================================================
"RTN","LRLNCV",7,0)
 ; Ask VistA test in Lab Test file #60
"RTN","LRLNCV",8,0)
START ;entry point from option LR LOINC VALIDATE
"RTN","LRLNCV",9,0)
 S LREND=0 D TEST
"RTN","LRLNCV",10,0)
 I $G(LREND) G EXIT
"RTN","LRLNCV",11,0)
 ;
"RTN","LRLNCV",12,0)
 W !!,"NAME OF NLT CODE: ",$P(^LAM(LRNLT,0),U)
"RTN","LRLNCV",13,0)
 W !,"NLT CODE: ",$P(^LAM(LRNLT,0),U,2) S LRNLTN=$P($G(^LAM(LRNLT,0)),U,2)
"RTN","LRLNCV",14,0)
 S LRDEF=+$G(^LAM(LRNLT,9))
"RTN","LRLNCV",15,0)
 I LRDEF W !,"DEFAULT LOINC CODE: ",$S(LRDEF:LRDEF_"  "_$P(^LAB(95.3,LRDEF,80),U),1:"NONE")
"RTN","LRLNCV",16,0)
ASKSPEC ; Ask Specimen- Lookup in Specimen multiple in Lab Test file #60
"RTN","LRLNCV",17,0)
 W !!
"RTN","LRLNCV",18,0)
LOOK61 K DIR,DA
"RTN","LRLNCV",19,0)
 S DIR(0)="PO^61:EZMN",DIR("S")="I $P(^(0),U,9)"
"RTN","LRLNCV",20,0)
 S DIR("A")="Select a Specimen source that has a LEDI HL7 code"
"RTN","LRLNCV",21,0)
 S DIC("A")="Specimen source: "
"RTN","LRLNCV",22,0)
 D ^DIR
"RTN","LRLNCV",23,0)
 I $D(DUOUT)!($D(DTOUT))!(Y<1) G START
"RTN","LRLNCV",24,0)
 S LRSPEC=+Y
"RTN","LRLNCV",25,0)
SUFFIX ;Set LRCDEF Value
"RTN","LRLNCV",26,0)
 S LREND=0,DIC="^LRO(68.2,",DIC(0)="AQEM",DIC("A")="Work Load Area: ",DIC("S")="I $D(^(""SUF"")),+^(""SUF"")" D ^DIC S:Y<1 LREND=1 K DIC
"RTN","LRLNCV",27,0)
 I $G(LREND) G START
"RTN","LRLNCV",28,0)
 S LRCDEF=$P(^LRO(68.2,+Y,"SUF"),U,3)
"RTN","LRLNCV",29,0)
LOINC S LRMSG=1
"RTN","LRLNCV",30,0)
 ;START OF CHANGE FOR LR*5.2*468
"RTN","LRLNCV",31,0)
 ;S LRLOINC=$$LNC^LRVER1(LRNLTN,LRCDEF,LRSPEC)
"RTN","LRLNCV",32,0)
 ; START OF CHANGE FOR LR*5.2*484
"RTN","LRLNCV",33,0)
 ; S LRLOINC=$$LNC^LRVER1(LRNLTN,LRCDEF,LRSPEC,$G(LRIEN))
"RTN","LRLNCV",34,0)
 S LRLOINC=$$LNCM^LRVER1(LRNLTN,LRCDEF,LRSPEC,$G(LRIEN))
"RTN","LRLNCV",35,0)
 ;END OF CHANGE FOR LR*5.2*484
"RTN","LRLNCV",36,0)
 ;END OF CHANGE FOR LR*5.2*468
"RTN","LRLNCV",37,0)
 I LRLOINC S LRLOINC=LRLOINC_"-"_$P($G(^LAB(95.3,LRLOINC,0)),U,15)
"RTN","LRLNCV",38,0)
 I 'LRLOINC W !!,"TEST NOT MAPPED",!! D EXIT G START
"RTN","LRLNCV",39,0)
 S LRDA=$P(LRMSGM,"-",2),LRDA=+$O(^LAM("C",LRDA,0))
"RTN","LRLNCV",40,0)
 S LRDAN="Unknown code number"
"RTN","LRLNCV",41,0)
 I $G(LRDA),$D(^LAM(LRDA,0)) S LRDAN=$P($G(^LAM(LRDA,0)),U)
"RTN","LRLNCV",42,0)
 W !!,"LOINC Code: ",LRLOINC,!,$G(^LAB(95.3,+LRLOINC,80)),!
"RTN","LRLNCV",43,0)
 W !,$$CJ^XLFSTR("LOINC code was located @ NLT CODE: "_LRDAN,IOM)
"RTN","LRLNCV",44,0)
 W !,$$CJ^XLFSTR($P(LRMSGM,"-",2,99),IOM)
"RTN","LRLNCV",45,0)
 D EXIT G START
"RTN","LRLNCV",46,0)
 Q
"RTN","LRLNCV",47,0)
EXIT K DA,DIC,DIE,DINUM,DIR,DIRUT,DR,DTOUT,DUOUT,LREND,LRLOINC,LRIEN,LRMSG,LRNLT,LRSPEC,LRSPECN,LRSUF,LRTEST,S,Y
"RTN","LRLNCV",48,0)
 K DD,DO,DLAYGO,LRDEF,X
"RTN","LRLNCV",49,0)
 QUIT
"RTN","LRLNCV",50,0)
TEST W !!
"RTN","LRLNCV",51,0)
 K DIR
"RTN","LRLNCV",52,0)
 S DIR(0)="PO^60:QENMZ,",DIR("A")="VistA Lab Test"
"RTN","LRLNCV",53,0)
 S DIR("?")="Select Lab test"
"RTN","LRLNCV",54,0)
 D ^DIR K DIR
"RTN","LRLNCV",55,0)
 I $D(DIRUT)!'Y K DIRUT S LREND=1 Q
"RTN","LRLNCV",56,0)
 S LRIEN=+Y,LRTEST=$P(Y,U,2)
"RTN","LRLNCV",57,0)
 ;Check for RESULT NLT CODE and if not one let enter
"RTN","LRLNCV",58,0)
 I '$P($G(^LAB(60,+$G(LRIEN),64)),U,2) D
"RTN","LRLNCV",59,0)
 .W $$CJ^XLFSTR("There is not a RESULT NLT CODE for "_LRTEST,IOM)
"RTN","LRLNCV",60,0)
 .W $$CJ^XLFSTR("You MAY select one now to continue with the LOINC lookup",IOM),!
"RTN","LRLNCV",61,0)
 K DIE,DR,DA S DA=LRIEN,DIE="^LAB(60,",DR=64.1
"RTN","LRLNCV",62,0)
 D ^DIE
"RTN","LRLNCV",63,0)
 I $D(DUOUT)!($D(DTOUT)) G START
"RTN","LRLNCV",64,0)
 I '$P($G(^LAB(60,+$G(LRIEN),64)),U,2) D
"RTN","LRLNCV",65,0)
 .S DIC=DIE,DR=0 W !! W ?5,"IEN: [",DA,"] ",$P(^LAB(60,LRIEN,0),U) S S=$Y D EN^LRDIQ W !
"RTN","LRLNCV",66,0)
 W !
"RTN","LRLNCV",67,0)
 S LRNLT=$P($G(^LAB(60,+$G(LRIEN),64)),U,2)
"RTN","LRLNCV",68,0)
 I 'LRNLT G TEST
"RTN","LRLNCV",69,0)
 Q
"RTN","LRVER1")
0^3^B49802550^B40561385
"RTN","LRVER1",1,0)
LRVER1 ;DALOI/STAFF - LAB ROUTINE DATA VERIFICATION ;01/20/11  18:00
"RTN","LRVER1",2,0)
 ;;5.2;LAB SERVICE;**42,153,201,215,239,240,263,232,286,291,350,468,484**;Sep 27, 1994;Build 2
"RTN","LRVER1",3,0)
 ;
"RTN","LRVER1",4,0)
 ;5.2;LAB SERVICE; CHANGE FOR PATCH LR*5.2*468; Feb 10 2016
"RTN","LRVER1",5,0)
 ;
"RTN","LRVER1",6,0)
VER ; from LRGVP
"RTN","LRVER1",7,0)
 N LRBEY
"RTN","LRVER1",8,0)
 S LRLLOC=0,LRCW=8,LROUTINE=$P(^LAB(69.9,1,3),U,2) I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRVER1",9,0)
 S LRCDT=$S($D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)):$P(^(3),U,1,2),1:$P(^(0),U,3)_U),LREAL=$P(LRCDT,U,2)
"RTN","LRVER1",10,0)
 S LRCDT=+LRCDT,LRSAMP=$S($D(^LRO(69,LRODT,1,LRSN,0)):$P(^(0),U,3),1:"")
"RTN","LRVER1",11,0)
 S LRIDT=$S($P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5):$P(^(3),U,5),1:"")
"RTN","LRVER1",12,0)
 S:'LRIDT LRIDT=9999999-LRCDT
"RTN","LRVER1",13,0)
 ;
"RTN","LRVER1",14,0)
 ; Setup LRUID when called from LRGVP (group data review)
"RTN","LRVER1",15,0)
 I $G(LRUID)="" N LRUID S LRUID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^")
"RTN","LRVER1",16,0)
 ;
"RTN","LRVER1",17,0)
 D EXP
"RTN","LRVER1",18,0)
LD S LRSS="CH" ;ONLY WORKS FOR 'CH'
"RTN","LRVER1",19,0)
 S LRMETH=LRSS IF $D(^LR(LRDFN,LRSS,LRIDT,0)) S LRMETH=$P($P(^(0),U,8),";",1)
"RTN","LRVER1",20,0)
 W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRVER1",21,0)
 K ^TMP("LR",$J,"TMP"),LRORD,LRM
"RTN","LRVER1",22,0)
 D ^LRVER2
"RTN","LRVER1",23,0)
 K LRDL
"RTN","LRVER1",24,0)
 Q
"RTN","LRVER1",25,0)
 ;
"RTN","LRVER1",26,0)
 ;
"RTN","LRVER1",27,0)
EXP ; Get the list of tests for this ACC. from LRGVG1
"RTN","LRVER1",28,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",29,0)
 N I,N,IX,LRNLT,T1,X
"RTN","LRVER1",30,0)
 K LRTEST,LRNAME,LRSM60
"RTN","LRVER1",31,0)
 S LRALERT=LROUTINE,N=0,I=0,IX=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1,0))
"RTN","LRVER1",32,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  D
"RTN","LRVER1",33,0)
 . S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRVER1",34,0)
 . I 'X Q
"RTN","LRVER1",35,0)
 . I $P(X,"^",6)="*Not Performed" Q
"RTN","LRVER1",36,0)
 . S N=N+1,LRTEST(N)=I,LRNLT=$S($P(X,"^",2)>50:$P(X,U,9),1:$P(X,"^"))
"RTN","LRVER1",37,0)
 . I $P(X,"^",9),$P(X,"^")'=$P(X,"^",9),'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,$P(X,"^",9))) S LRNLT=$P(X,"^",9)
"RTN","LRVER1",38,0)
 . S LRTEST(N,"P")=LRNLT_U_$$NLT(LRNLT)
"RTN","LRVER1",39,0)
 . S LRAL=$P(X,U,2)#50
"RTN","LRVER1",40,0)
 . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRVER1",41,0)
 ;
"RTN","LRVER1",42,0)
 S LRNTN=N
"RTN","LRVER1",43,0)
 F T1=1:1:N I $D(^LAB(60,+LRTEST(T1),0)) D
"RTN","LRVER1",44,0)
 . S LRTEST(T1)=LRTEST(T1)_U_^(0)
"RTN","LRVER1",45,0)
 . S LRNAME(T1)=$P(LRTEST(T1),U,2),LRNAME(T1,+LRTEST(T1))=""
"RTN","LRVER1",46,0)
 . S:$G(^(1,IX,3)) LRSM60(+$P(LRTEST(T1),";",2))=^(3)
"RTN","LRVER1",47,0)
 . D EX1
"RTN","LRVER1",48,0)
 K IX
"RTN","LRVER1",49,0)
 N X1,X
"RTN","LRVER1",50,0)
 S X=$P($H,","),X(1)=$P($H,",",2),I=0
"RTN","LRVER1",51,0)
 F  S I=$O(LRSM60(I)) Q:'I  S X1=X-LRSM60(I)_","_X(1),LRSM60(I)=9999999-$$HTFM^XLFDT(X1)
"RTN","LRVER1",52,0)
 Q
"RTN","LRVER1",53,0)
 ;
"RTN","LRVER1",54,0)
 ;
"RTN","LRVER1",55,0)
EX1 ; Expand the list of tests to edit.
"RTN","LRVER1",56,0)
 Q:'$D(LRTEST(T1))
"RTN","LRVER1",57,0)
 S X=LRTEST(T1),^TMP("LR",$J,"VTO",+X)=$P($P(X,U,6),";",2)
"RTN","LRVER1",58,0)
 S ^TMP("LR",$J,"VTO",+X,"P")=LRTEST(T1,"P"),S1=0,J=0
"RTN","LRVER1",59,0)
 D EX2
"RTN","LRVER1",60,0)
 K S1,J
"RTN","LRVER1",61,0)
 Q
"RTN","LRVER1",62,0)
 ;
"RTN","LRVER1",63,0)
EX2 ;
"RTN","LRVER1",64,0)
 S:'$D(LRCFL) LRCFL=""
"RTN","LRVER1",65,0)
 S LRSUB=$P(X,U,6)
"RTN","LRVER1",66,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRVER1",67,0)
 ;
"RTN","LRVER1",68,0)
 ; If atomic test then setup and quit
"RTN","LRVER1",69,0)
 I LRSUB'="" D  Q
"RTN","LRVER1",70,0)
 . S S2=$P(LRSUB,";",2)
"RTN","LRVER1",71,0)
 . D:'$D(^TMP("LR",$J,"TMP",S2)) ORD
"RTN","LRVER1",72,0)
 ;
"RTN","LRVER1",73,0)
 ; Explode panel tests
"RTN","LRVER1",74,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",75,0)
 S S1=S1+1,S1(S1)=X,S1(S1,1)=J
"RTN","LRVER1",76,0)
 S J=0
"RTN","LRVER1",77,0)
 F  S J=$O(^LAB(60,+S1(S1),2,J)) Q:J<1  D
"RTN","LRVER1",78,0)
 . S Y=+^(J,0),X=Y_U_^LAB(60,Y,0)
"RTN","LRVER1",79,0)
 . I $P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),4,Y,0)),"^",6)="*Not Performed" Q
"RTN","LRVER1",80,0)
 . D EX2
"RTN","LRVER1",81,0)
 S X=S1(S1),J=S1(S1,1),S1=S1-1
"RTN","LRVER1",82,0)
 Q
"RTN","LRVER1",83,0)
 ;
"RTN","LRVER1",84,0)
 ;
"RTN","LRVER1",85,0)
ORD ;
"RTN","LRVER1",86,0)
 ; LRNX is set by caller
"RTN","LRVER1",87,0)
 S LRNX=+$G(LRNX)+1,LRORD(LRNX)=S2
"RTN","LRVER1",88,0)
 S LRBEY($P(LRTEST(T1),U,1),S2)=""   ; CIDC
"RTN","LRVER1",89,0)
 S ^TMP("LR",$J,"TMP",S2)=+X
"RTN","LRVER1",90,0)
 ; If panel being exploded then set parent("P" node)
"RTN","LRVER1",91,0)
 ;  to file #60 test being exploded
"RTN","LRVER1",92,0)
 I $G(LRTEST(T1,"P")) D
"RTN","LRVER1",93,0)
 . I +LRTEST(T1)'=+LRTEST(T1,"P") S ^TMP("LR",$J,"TMP",S2,"P")=LRTEST(T1,"P")_"!"_$$RNLT(+X)
"RTN","LRVER1",94,0)
 . E  S ^TMP("LR",$J,"TMP",S2,"P")=+LRTEST(T1)_U_$$NLT(+LRTEST(T1))_"!"_$$RNLT(+X)
"RTN","LRVER1",95,0)
 ;
"RTN","LRVER1",96,0)
 I $P(X,U,18) D
"RTN","LRVER1",97,0)
 . S LRM(S2)=+X
"RTN","LRVER1",98,0)
 . S LRM(S2,"P")=$G(^TMP("LR",$J,"TMP",S2,"P"))
"RTN","LRVER1",99,0)
 . S LRMX(+X)=""
"RTN","LRVER1",100,0)
 Q
"RTN","LRVER1",101,0)
 ;
"RTN","LRVER1",102,0)
 ;
"RTN","LRVER1",103,0)
NLT(X) ;
"RTN","LRVER1",104,0)
 N Y
"RTN","LRVER1",105,0)
 S Y=$S($P($G(^LAM(+$G(^LAB(60,+X,64)),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",106,0)
 Q Y
"RTN","LRVER1",107,0)
 ;
"RTN","LRVER1",108,0)
 ;
"RTN","LRVER1",109,0)
RNLT(X) ;
"RTN","LRVER1",110,0)
 I 'X Q ""
"RTN","LRVER1",111,0)
 N Y
"RTN","LRVER1",112,0)
 S Y(1)=+$P($G(^LAB(60,X,64)),U,2)
"RTN","LRVER1",113,0)
 S Y=$S($P($G(^LAM(Y(1),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",114,0)
 ; START OF CHANGE FOR LR*5.2*468
"RTN","LRVER1",115,0)
 ;I Y S $P(Y,"!",2)=$$LNC(Y,$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",116,0)
 I Y S $P(Y,"!",2)=$$LNC(Y,$G(LRCDEF),$G(LRSPEC),X)
"RTN","LRVER1",117,0)
 ; END OF CHANGE FOR LR*5.2*468
"RTN","LRVER1",118,0)
 S $P(Y,"!",3)=$G(LRCDEF),$P(Y,"!",6)=X
"RTN","LRVER1",119,0)
 Q Y
"RTN","LRVER1",120,0)
 ;
"RTN","LRVER1",121,0)
 ;
"RTN","LRVER1",122,0)
 ; THE FOLLOWING ENTRY POINT WAS CHANGED BY PATCH LR*5.2.468 TO RECEIVE LAB TEST IEN
"RTN","LRVER1",123,0)
LNC(LRNLT,LRCDEF,LRSPEC,LRLTST) ;return the LOINC code for WKLD Code/Specimen
"RTN","LRVER1",124,0)
 ; orig entry point code
"RTN","LRVER1",125,0)
 ; (LRNLT,LRCDEF,LRSPEC) ;reture the LOINC code for WKLD Code/Specimen
"RTN","LRVER1",126,0)
 ; END OF CHANGE FOR LR*5.2*468
"RTN","LRVER1",127,0)
 ; Call with (nlt code,method suffix,test specimen)
"RTN","LRVER1",128,0)
 ; TA = Time Aspect
"RTN","LRVER1",129,0)
 ; START OF CHANGE FOR LR*5.2*468 check for new VUID LOINC in LAB(60,test,1,specimen N6,P1 (#30)
"RTN","LRVER1",130,0)
 N LRMLTF,BL,C S LRLTST=$G(LRLTST)+0,LRSPEC=+LRSPEC
"RTN","LRVER1",131,0)
 I LRSPEC&(LRLTST>0) S (LRMLTF,BL,C)="" D  I BL'="" D LNCSET Q BL
"RTN","LRVER1",132,0)
 . S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRVER1",133,0)
 . S LRMLTF=$$GET1^DIQ(60.01,LRSPEC_","_LRLTST,30,"I") I LRMLTF="" Q  ; does not have a vuid associated
"RTN","LRVER1",134,0)
 . S BL=$$GET1^DIQ(66.3,LRMLTF_",",.04,"I")
"RTN","LRVER1",135,0)
 . ; fix to strip off the check digit per agreement 20160920
"RTN","LRVER1",136,0)
 . I BL'="" S BL=$P(BL,"-",1)
"RTN","LRVER1",137,0)
 K LRMLTF,BL,C
"RTN","LRVER1",138,0)
 ; END OF CHANGE FOR LR*5.2*468
"RTN","LRVER1",139,0)
 ; START OF CHANGE FOR LR*5.2*484
"RTN","LRVER1",140,0)
 G LNCO
"RTN","LRVER1",141,0)
 ; new entry point for mapping routine LRLNCV to skip checking of MLTF
"RTN","LRVER1",142,0)
LNCM(LRNLT,LRCDEF,LRSPEC,LRLTST) ; entry for LRLNCV
"RTN","LRVER1",143,0)
LNCO ; skip around point for LNC
"RTN","LRVER1",144,0)
 ; END OF CHANGE FOR LR*5.2*484
"RTN","LRVER1",145,0)
 N X,N,Y,LRSPECN,VAL,ERR,TA S X=""
"RTN","LRVER1",146,0)
 Q:'LRNLT X
"RTN","LRVER1",147,0)
 K LRMSGM
"RTN","LRVER1",148,0)
 S:$G(LRCDEF)="" LRCDEF="0000"
"RTN","LRVER1",149,0)
 I $P(LRCDEF,".",2) S LRCDEF=$P(LRCDEF,".",2)
"RTN","LRVER1",150,0)
 S LRCDEF=$S($P(LRNLT,".",2):$P(LRNLT,".",2),1:LRCDEF)
"RTN","LRVER1",151,0)
 I $L(LRCDEF)'=4 S LRCDEF=LRCDEF_$E("0000",$L(LRCDEF),($L(LRCDEF-4)))
"RTN","LRVER1",152,0)
 S LRCDEF=LRCDEF_" "
"RTN","LRVER1",153,0)
 S LRSPEC=+LRSPEC
"RTN","LRVER1",154,0)
 ;Get time aspect from 61
"RTN","LRVER1",155,0)
 S TA=$$GET1^DIQ(61,LRSPEC_",",.0961,"I")
"RTN","LRVER1",156,0)
 S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRVER1",157,0)
 S LRNLT=$P(LRNLT,".")_"."
"RTN","LRVER1",158,0)
 ;Check for WKLD CODE_LOAD/WORK LIST method suffix
"RTN","LRVER1",159,0)
 S VAL(1)=LRNLT_LRCDEF
"RTN","LRVER1",160,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",161,0)
 ;Looking for specimen specific LOINC
"RTN","LRVER1",162,0)
 I N,LRSPEC D  I X D MSG(1) Q X
"RTN","LRVER1",163,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",164,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",165,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",166,0)
 ;Looking LOINC default
"RTN","LRVER1",167,0)
 I N S X=$$LDEF(N) I X D MSG(2) Q X
"RTN","LRVER1",168,0)
 I LRCDEF="0000 " Q ""
"RTN","LRVER1",169,0)
 ;Looking for WKLD CODE_GENERIC suffix
"RTN","LRVER1",170,0)
 K VAL
"RTN","LRVER1",171,0)
 S VAL(1)=LRNLT_"0000 "
"RTN","LRVER1",172,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",173,0)
 I 'N Q ""
"RTN","LRVER1",174,0)
 ;Looking for WKLD CODE_GENERIC specimen specific LOINC
"RTN","LRVER1",175,0)
 I LRSPEC D  I X D MSG(3) Q X
"RTN","LRVER1",176,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",177,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",178,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",179,0)
 ;Looking for WKLD CODE_GENERIC default LOINC
"RTN","LRVER1",180,0)
 I 'X,N S X=$$LDEF(N) I X D MSG(4)
"RTN","LRVER1",181,0)
 I 'X S X=""
"RTN","LRVER1",182,0)
 Q X
"RTN","LRVER1",183,0)
 ;
"RTN","LRVER1",184,0)
 ; START OF CHANGE FOR LR*5.2*484
"RTN","LRVER1",185,0)
LNCSET ; set up string for MLTF msg
"RTN","LRVER1",186,0)
 ;
"RTN","LRVER1",187,0)
 S:$G(LRCDEF)="" LRCDEF="0000"
"RTN","LRVER1",188,0)
 I $P(LRCDEF,".",2) S LRCDEF=$P(LRCDEF,".",2)
"RTN","LRVER1",189,0)
 S LRCDEF=$S($P(LRNLT,".",2):$P(LRNLT,".",2),1:LRCDEF)
"RTN","LRVER1",190,0)
 I $L(LRCDEF)'=4 S LRCDEF=LRCDEF_$E("0000",$L(LRCDEF),($L(LRCDEF-4)))
"RTN","LRVER1",191,0)
 S LRCDEF=LRCDEF_" "
"RTN","LRVER1",192,0)
 ;Get time aspect from 61
"RTN","LRVER1",193,0)
 S TA=$$GET1^DIQ(61,LRSPEC_",",.0961,"I")
"RTN","LRVER1",194,0)
 S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRVER1",195,0)
 S LRNLT=$P(LRNLT,".")_"."
"RTN","LRVER1",196,0)
 I $G(TA) S TANAME=$$GET1^DIQ(64.061,TA_",",.01,"E") ;TA Name
"RTN","LRVER1",197,0)
 S LRMSGM="1-"_LRNLT_$E(LRCDEF,1,4)_" - "_LRSPECN
"RTN","LRVER1",198,0)
 I $G(TA) S LRMSGM=LRMSGM_" Time Aspect "_TANAME
"RTN","LRVER1",199,0)
 Q
"RTN","LRVER1",200,0)
 ;
"RTN","LRVER1",201,0)
 ; END OF CHANGE FOR LR*5.2*484
"RTN","LRVER1",202,0)
LDEF(Y) ;Find the default LOINC code for WKLD CODE
"RTN","LRVER1",203,0)
 I 'Y Q ""
"RTN","LRVER1",204,0)
 S X=$$GET1^DIQ(64,Y_",",25,"I")
"RTN","LRVER1",205,0)
 I 'X S X=""
"RTN","LRVER1",206,0)
 Q X
"RTN","LRVER1",207,0)
 ;
"RTN","LRVER1",208,0)
 ;
"RTN","LRVER1",209,0)
TMPSB(LRSB) ; Get LOINC code from ^TMP("LR",$J,"TMP",LRSB,"P")
"RTN","LRVER1",210,0)
 S NODE=$G(^TMP("LR",$J,"TMP",LRSB,"P"))
"RTN","LRVER1",211,0)
 I 'NODE Q ""
"RTN","LRVER1",212,0)
 ; START CHANGE FOR LR*5.2*468
"RTN","LRVER1",213,0)
 ; S $P(NODE,"!",3)=$$LNC($P(NODE,"!",2),$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",214,0)
 S $P(NODE,"!",3)=$$LNC($P(NODE,"!",2),$G(LRCDEF),$G(LRSPEC),$G(LRTS))
"RTN","LRVER1",215,0)
 ; END CHANGE FOR LR*5.2*468
"RTN","LRVER1",216,0)
 S $P(NODE,"!",4)=$G(LRCDEF)
"RTN","LRVER1",217,0)
 Q $P(NODE,U,2)
"RTN","LRVER1",218,0)
 ;
"RTN","LRVER1",219,0)
 ;
"RTN","LRVER1",220,0)
MSG(VAL) ;Set output message
"RTN","LRVER1",221,0)
 Q:'$G(LRMSG)
"RTN","LRVER1",222,0)
 S LRMSGM="0-No LOINC Code Defined for "_LRNLT_LRCDEF
"RTN","LRVER1",223,0)
 N TANAME
"RTN","LRVER1",224,0)
 I $G(TA) S TANAME=$$GET1^DIQ(64.061,TA_",",.01,"E") ;TA Name
"RTN","LRVER1",225,0)
 I VAL=1 S LRMSGM="1-"_LRNLT_$E(LRCDEF,1,4)_" - "_LRSPECN
"RTN","LRVER1",226,0)
 I VAL=2 S LRMSGM="2-"_LRNLT_$E(LRCDEF,1,4)_" - Default LOINC"
"RTN","LRVER1",227,0)
 I VAL=3 S LRMSGM="3-"_LRNLT_"0000 - "_LRSPECN
"RTN","LRVER1",228,0)
 I VAL=4 S LRMSGM="4-"_LRNLT_"0000 - Default LOINC"
"RTN","LRVER1",229,0)
 I $G(TA) S LRMSGM=LRMSGM_" Time Aspect "_TANAME
"RTN","LRVER1",230,0)
 W:$G(LRDBUG) !,LRMSGM,!
"RTN","LRVER1",231,0)
 Q
"RTN","LRVRAR")
0^1^B72283699^B71328911
"RTN","LRVRAR",1,0)
LRVRAR ;DALOI/STAFF - AUTO RELEASE VERIFICATION ;9/26/16  12:37
"RTN","LRVRAR",2,0)
 ;;5.2;LAB SERVICE;**458,475,484**;Sep 27, 1994;Build 2
"RTN","LRVRAR",3,0)
 ;
"RTN","LRVRAR",4,0)
 ; ZEXCEPT is used to identify variables which are external to a specific TAG
"RTN","LRVRAR",5,0)
 ;         used in conjunction with Eclipse M-editor.
"RTN","LRVRAR",6,0)
 ;
"RTN","LRVRAR",7,0)
 ; Variables:
"RTN","LRVRAR",8,0)
 ;           DUZ = set to IEN of LRLAB,AUTO RELEASE application proxy in file #200
"RTN","LRVRAR",9,0)
 ;
"RTN","LRVRAR",10,0)
 ;         LRDUZ = set to IEN of either:
"RTN","LRVRAR",11,0)
 ;                     1. File #200 entry of LRLAB,AUTO VERIFY application proxy (LRDUZ("AV") if results were auto verified.
"RTN","LRVRAR",12,0)
 ;                     2. File #200 entry of LRLAB,AUTO RELEASE application proxy (LRDUZ("AR") when results are auto released.
"RTN","LRVRAR",13,0)
 ;
"RTN","LRVRAR",14,0)
 ;         LRDUZ("AR") = set to IEN of LRLAB,AUTO RELEASE application proxy in file #200
"RTN","LRVRAR",15,0)
 ;         LRDUZ("AV") = set to IEN of LRLAB,AUTO VERIFY application proxy in file #200
"RTN","LRVRAR",16,0)
 ;
"RTN","LRVRAR",17,0)
 ;         The variable LRDUZ is set in different places to one of the values in the LRDUZ array to represent the "user"
"RTN","LRVRAR",18,0)
 ;         for the software to use within the context of the operation to record who released the results and who performed
"RTN","LRVRAR",19,0)
 ;         the testing.
"RTN","LRVRAR",20,0)
 ;
"RTN","LRVRAR",21,0)
 ;
"RTN","LRVRAR",22,0)
EN ; Entry Point
"RTN","LRVRAR",23,0)
 ;  - call with LRLL=Load/Worklist IEN
"RTN","LRVRAR",24,0)
 ;
"RTN","LRVRAR",25,0)
 ;ZEXCEPT: LRLL,ZTREQ,ZTSTOP
"RTN","LRVRAR",26,0)
 ;
"RTN","LRVRAR",27,0)
 N DIQUIET,LA7624,LA76248,LA76249,LA7AAT,LAMSG,LRANYAA,LRAUTORELEASE,LRAUTOVERIFY,LRDELTACHKOK,LREND,LRERR,LRSQ
"RTN","LRVRAR",28,0)
 ;
"RTN","LRVRAR",29,0)
 S LRLL=+$G(LRLL)
"RTN","LRVRAR",30,0)
 ;
"RTN","LRVRAR",31,0)
 ; If no entries to process then quit
"RTN","LRVRAR",32,0)
 I '$D(^LAH(LRLL,1,"AUTOREL")) S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","LRVRAR",33,0)
 ;
"RTN","LRVRAR",34,0)
 ; See if already running and/or no one else is using this loasd list, i.e. user using EA (LRVR) to verify instrument data.
"RTN","LRVRAR",35,0)
 L +^LAH("Z",LRLL):DILOCKTM+10
"RTN","LRVRAR",36,0)
 E  S ZTREQ=$$HADD^XLFDT($H,0,0,5,0) D END Q
"RTN","LRVRAR",37,0)
 ;
"RTN","LRVRAR",38,0)
 D INIT^LRVRARU
"RTN","LRVRAR",39,0)
 I LREND D  Q
"RTN","LRVRAR",40,0)
 . D XQA^LA7UXQA(2,0,0,0,LAMSG,"")
"RTN","LRVRAR",41,0)
 . D END
"RTN","LRVRAR",42,0)
 ;
"RTN","LRVRAR",43,0)
 S LRSQ=0
"RTN","LRVRAR",44,0)
 F  S LRSQ=$O(^LAH(LRLL,1,"AUTOREL",LRSQ)) Q:LRSQ<1  D
"RTN","LRVRAR",45,0)
 . I $$S^%ZTLOAD("Processing loadlist "_$P(LRLL(0),"^")_", entry #"_LRSQ) S ZTSTOP=1 Q  ; Task has been requested to stop
"RTN","LRVRAR",46,0)
 . K LRERR
"RTN","LRVRAR",47,0)
 . S LA7624=$P(^LAH(LRLL,1,"AUTOREL",LRSQ),U,2)
"RTN","LRVRAR",48,0)
 . ; Interface message number in ^LAHM(62.49
"RTN","LRVRAR",49,0)
 . S LA76249=+$P($G(^LAH(LRLL,1,LRSQ,0)),U,13)
"RTN","LRVRAR",50,0)
 . ; File #62.48 configuration link
"RTN","LRVRAR",51,0)
 . S LA76248=""
"RTN","LRVRAR",52,0)
 . I LA76249 S LA76248=$$GET1^DIQ(62.49,LA76249_",",.5,"I")
"RTN","LRVRAR",53,0)
 . D LOOK,NEXT
"RTN","LRVRAR",54,0)
 D END
"RTN","LRVRAR",55,0)
 Q
"RTN","LRVRAR",56,0)
 ;
"RTN","LRVRAR",57,0)
 ;
"RTN","LRVRAR",58,0)
NEXT ; Clean up between entries
"RTN","LRVRAR",59,0)
 ;
"RTN","LRVRAR",60,0)
 ;ZEXCEPT: LRERR,LRLL,LRSQ,LRUID
"RTN","LRVRAR",61,0)
 ;
"RTN","LRVRAR",62,0)
 ; If no errors then remove record from LAH.
"RTN","LRVRAR",63,0)
 I $G(LRERR)<1 D ZAPALL^LRVR3(LRLL,LRSQ)
"RTN","LRVRAR",64,0)
 ;
"RTN","LRVRAR",65,0)
 D CLEAN^LRVRARU
"RTN","LRVRAR",66,0)
 Q
"RTN","LRVRAR",67,0)
 ;
"RTN","LRVRAR",68,0)
 ;
"RTN","LRVRAR",69,0)
END ; Clean up and quit
"RTN","LRVRAR",70,0)
 ;ZEXCEPT: LRLL,ZTQUEUED,ZTREQ
"RTN","LRVRAR",71,0)
 ;
"RTN","LRVRAR",72,0)
 ; Release locks
"RTN","LRVRAR",73,0)
 L -^LAH("Z",LRLL)
"RTN","LRVRAR",74,0)
 ;
"RTN","LRVRAR",75,0)
 D SPALERT^LRVRARU,KVAR^VADPT,KILL^XUSCLEAN
"RTN","LRVRAR",76,0)
 K ^TMP("LR",$J)
"RTN","LRVRAR",77,0)
 I $D(ZTQUEUED),'$P($G(ZTREQ),"^") S ZTREQ="@"
"RTN","LRVRAR",78,0)
 Q
"RTN","LRVRAR",79,0)
 ;
"RTN","LRVRAR",80,0)
 ;
"RTN","LRVRAR",81,0)
LOOK ; Check for data
"RTN","LRVRAR",82,0)
 ;
"RTN","LRVRAR",83,0)
 ;ZEXCEPT: DFN,ERR,LRAA,LRAD,LRAN,LRDFN,LRDPF,LREND,LRERR,LRIDT,LRLL,LRLLOC,LRODT,LRORD,LRORU3,LRSN,LRSQ,PNM,X,ZTREQ
"RTN","LRVRAR",84,0)
 ;
"RTN","LRVRAR",85,0)
 N LRCDT,LRLDT,LRLOCKER,LRSS,LRUID
"RTN","LRVRAR",86,0)
 ;
"RTN","LRVRAR",87,0)
 K LRDFN,LRERR,ERR,LRDPF,PNM,X
"RTN","LRVRAR",88,0)
 S (LREND,LRERR)=0
"RTN","LRVRAR",89,0)
 ;
"RTN","LRVRAR",90,0)
 S LRUID=$P($G(^LAH(LRLL,1,LRSQ,.3)),U)
"RTN","LRVRAR",91,0)
 I LRUID="" D  Q
"RTN","LRVRAR",92,0)
 . ; JMC/5/6/15 - need to write error message when UID not found with data in LAH
"RTN","LRVRAR",93,0)
 . S LREND=1
"RTN","LRVRAR",94,0)
 ;
"RTN","LRVRAR",95,0)
 D UID^LRVRA
"RTN","LRVRAR",96,0)
 ;
"RTN","LRVRAR",97,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0)
"RTN","LRVRAR",98,0)
 S LRDFN=+X,LRDPF=$P(X,U,2),DFN=$P(^LR(LRDFN,0),U,3)
"RTN","LRVRAR",99,0)
 S LRODT=+$P(X,U,4),LRSN=+$P(X,U,5),LRLLOC=$P(X,U,7)
"RTN","LRVRAR",100,0)
 S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRVRAR",101,0)
 ;
"RTN","LRVRAR",102,0)
 S:'$L(LRLLOC) LRLLOC=0
"RTN","LRVRAR",103,0)
 S LRORD=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.1)),"^")
"RTN","LRVRAR",104,0)
 ;
"RTN","LRVRAR",105,0)
 S X(3)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,3))
"RTN","LRVRAR",106,0)
 S LRCDT=$P(X(3),U,1)
"RTN","LRVRAR",107,0)
 S LRIDT=$P(X(3),U,5)
"RTN","LRVRAR",108,0)
 S:'LRIDT LRIDT=9999999-X(3)
"RTN","LRVRAR",109,0)
 S LRORU3=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRVRAR",110,0)
 ;
"RTN","LRVRAR",111,0)
 D DEM^LRX
"RTN","LRVRAR",112,0)
 I $G(LREND) S LRDFN=0 Q
"RTN","LRVRAR",113,0)
 ;
"RTN","LRVRAR",114,0)
 ; Lock records in file #63 and 68
"RTN","LRVRAR",115,0)
 L +(^LR(LRDFN,LRSS,LRIDT),^LRO(68,LRAA,1,LRAD,1,LRAN)):DILOCKTM+10
"RTN","LRVRAR",116,0)
 I '$T D  Q
"RTN","LRVRAR",117,0)
 . S ZTREQ=$$HADD^XLFDT($H,0,0,5,0)
"RTN","LRVRAR",118,0)
 . S LRERR=1
"RTN","LRVRAR",119,0)
 ;
"RTN","LRVRAR",120,0)
 D DATA
"RTN","LRVRAR",121,0)
 ;
"RTN","LRVRAR",122,0)
 L -(^LR(LRDFN,LRSS,LRIDT),^LRO(68,LRAA,1,LRAD,1,LRAN))
"RTN","LRVRAR",123,0)
 ;
"RTN","LRVRAR",124,0)
 ; If error encountered then remove from auto release queue/process
"RTN","LRVRAR",125,0)
 I $G(LRERR)>0 D
"RTN","LRVRAR",126,0)
 . K ^LAH(LRLL,1,"AUTOREL",LRSQ)
"RTN","LRVRAR",127,0)
 . K ^LAH(LRLL,1,"AUTOREL-UID",LRUID,LRSQ)
"RTN","LRVRAR",128,0)
 ;
"RTN","LRVRAR",129,0)
 Q
"RTN","LRVRAR",130,0)
 ;
"RTN","LRVRAR",131,0)
 ;
"RTN","LRVRAR",132,0)
DATA ;Process data and store in LR global
"RTN","LRVRAR",133,0)
 ;
"RTN","LRVRAR",134,0)
 ;ZEXCEPT: LA76248,LA76249,LA7AAT,LR642,LRAA,LRALERT,LRAUTOVERIFY,LRCDT,LRCNT,LRCOM,LRCUP,LRDATA,LRDFN,LRDFWKLD,LREII,LRERR
"RTN","LRVRAR",135,0)
 ;ZEXCEPT: LRIDT,LRLDT,LRLL,LRMETH,LRNOW,LROKTORELEASE,LROUTINE,LRSAMP,LRSB,LRSPEC,LRSQ,LRSS,LRSTORE,LRTM60,LRTRAY
"RTN","LRVRAR",136,0)
 ;ZEXCEPT: LRTS,LRTST,LRUID,LRUSI,LRVF,LRVTS,LRX,LRY,LRZ
"RTN","LRVRAR",137,0)
 ;
"RTN","LRVRAR",138,0)
 K LRCNT,LRDATA,LRERR,LREII,LRLDT,LRNOW,LRSAMP,LRSB,LRSPEC,LRTM60,LRTRAY,LRCUP,LRTS,LRVF,LRX,LRY,LRZ
"RTN","LRVRAR",139,0)
 S (LR642,LRCNT,LRERR)=0
"RTN","LRVRAR",140,0)
 ;
"RTN","LRVRAR",141,0)
 ; Get type of HL7 application ACK
"RTN","LRVRAR",142,0)
 S LA7AAT(1)=$P($G(^LAH(LRLL,1,"AUTOREL-UID",LRUID,LRSQ,LA76249)),U)
"RTN","LRVRAR",143,0)
 ;
"RTN","LRVRAR",144,0)
 ; Setup workload suffix and workload variables
"RTN","LRVRAR",145,0)
 I LR642<1 S LR642=LRDFWKLD
"RTN","LRVRAR",146,0)
 D WKLD^LRVRARU(LR642)
"RTN","LRVRAR",147,0)
 D WKLDC^LRVRARU(LRLL,LRAA)
"RTN","LRVRAR",148,0)
 ;
"RTN","LRVRAR",149,0)
 S LRSPEC=$P(^LR(LRDFN,"CH",LRIDT,0),U,5)
"RTN","LRVRAR",150,0)
 ;
"RTN","LRVRAR",151,0)
 ; Check if verified results exist in ^LR then delete results from LAH and mark as error.
"RTN","LRVRAR",152,0)
 S LRVF=+$P(^LR(LRDFN,"CH",LRIDT,0),U,3)
"RTN","LRVRAR",153,0)
 I LRVF D
"RTN","LRVRAR",154,0)
 . S LRX=1
"RTN","LRVRAR",155,0)
 . F  S LRX=$O(^LR(LRDFN,"CH",LRIDT,LRX)) Q:LRX'>0  D
"RTN","LRVRAR",156,0)
 . . S LRZ=^LR(LRDFN,"CH",LRIDT,LRX)
"RTN","LRVRAR",157,0)
 . . I $P(LRZ,U)'="",$P(LRZ,U)'="pending",$D(^LAH(LRLL,1,LRSQ,LRX)) K ^LAH(LRLL,1,LRSQ,LRX) S:LRERR=0 LRERR=$$CREATE^LA7LOG(307,1)
"RTN","LRVRAR",158,0)
 I LRERR D SENDACK^LRVRARU Q
"RTN","LRVRAR",159,0)
 ;
"RTN","LRVRAR",160,0)
 ; Check if results have datanames/tests on this profile and user is valid
"RTN","LRVRAR",161,0)
 S LRDATA=1
"RTN","LRVRAR",162,0)
 F  S LRDATA=$O(^LAH(LRLL,1,LRSQ,LRDATA)) Q:LRDATA<1  D  Q:LRERR
"RTN","LRVRAR",163,0)
 . S LRDATA(LRDATA)=^LAH(LRLL,1,LRSQ,LRDATA)
"RTN","LRVRAR",164,0)
 . I $P(LRDATA(LRDATA),"^",4)<1 S LRERR=$$CREATE^LA7LOG(111,1) Q
"RTN","LRVRAR",165,0)
 . S LROKTORELEASE=$$OKTOREL
"RTN","LRVRAR",166,0)
 . I 'LROKTORELEASE D  Q
"RTN","LRVRAR",167,0)
 . . N LRDUZ
"RTN","LRVRAR",168,0)
 . . I $P(LROKTORELEASE,U,2) S LRDUZ=$P(LROKTORELEASE,U,3),LRERR=$$CREATE^LA7LOG($P(LROKTORELEASE,U,2),1)
"RTN","LRVRAR",169,0)
 . S LRDUZ("USER")=$P(LROKTORELEASE,U,2)
"RTN","LRVRAR",170,0)
 . S LRAUTOVERIFY=LROKTORELEASE-1
"RTN","LRVRAR",171,0)
 . S LREII=$P(LRDATA(LRDATA),U,11)
"RTN","LRVRAR",172,0)
 . S LREII=LREII_";"_$S(LRAUTOVERIFY:"LRAV",1:"LRTV")
"RTN","LRVRAR",173,0)
 . S $P(LRDATA(LRDATA),U,11)=LREII ; Store auto verify or tech verify with EII.
"RTN","LRVRAR",174,0)
 . S LRTST=+$G(LRVTS(LRDATA))
"RTN","LRVRAR",175,0)
 . I 'LRTST S LRERR=$$CREATE^LA7LOG(116,1) Q
"RTN","LRVRAR",176,0)
 . I '$D(^TMP("LR",$J,"VTO",LRTST)) S LRERR=$$CREATE^LA7LOG(118,1) Q
"RTN","LRVRAR",177,0)
 ;
"RTN","LRVRAR",178,0)
 I LRERR D SENDACK^LRVRARU Q
"RTN","LRVRAR",179,0)
 ;
"RTN","LRVRAR",180,0)
 ; Calculate days back for delta checks
"RTN","LRVRAR",181,0)
 S LRTM60=$$LRTM60^LRVR(LRCDT)
"RTN","LRVRAR",182,0)
 ; Find previous specimen
"RTN","LRVRAR",183,0)
 S LRLDT=LRIDT
"RTN","LRVRAR",184,0)
 D FINDPS^LRGV2
"RTN","LRVRAR",185,0)
 ;
"RTN","LRVRAR",186,0)
 ; Store ^LR( data [results]
"RTN","LRVRAR",187,0)
 K LRCOM
"RTN","LRVRAR",188,0)
 S LRVF=0,LRALERT=LROUTINE,LRUSI="LRAR"
"RTN","LRVRAR",189,0)
 ;
"RTN","LRVRAR",190,0)
 ; Store any new methods with existing methods on file.
"RTN","LRVRAR",191,0)
 S LRMETH=$P(^LAH(LRLL,1,LRSQ,0),U,7)_"(AR)"
"RTN","LRVRAR",192,0)
 I $P($G(^LR(LRDFN,LRSS,LRIDT,0)),U,8)'="" D
"RTN","LRVRAR",193,0)
 . N I,X
"RTN","LRVRAR",194,0)
 . S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,8)
"RTN","LRVRAR",195,0)
 . F I=1:1:$L(X,";") I $P(X,";",I)'="",LRMETH'[$P(X,";",I) S LRMETH=LRMETH_";"_$P(X,";",I)
"RTN","LRVRAR",196,0)
 I LRMETH'="" S $P(^LR(LRDFN,LRSS,LRIDT,0),U,8)=LRMETH
"RTN","LRVRAR",197,0)
 ;
"RTN","LRVRAR",198,0)
 M LRSB=LRDATA
"RTN","LRVRAR",199,0)
 D TEST^LRVR1
"RTN","LRVRAR",200,0)
 S LRSB=1,LRNOW=$$NOW^XLFDT
"RTN","LRVRAR",201,0)
 F  S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  D STORE Q:LRERR
"RTN","LRVRAR",202,0)
 ;
"RTN","LRVRAR",203,0)
 I LRERR D SENDACK^LRVRARU Q
"RTN","LRVRAR",204,0)
 ;
"RTN","LRVRAR",205,0)
 ; Set releasing user to auto release proxy.
"RTN","LRVRAR",206,0)
 S LRDUZ=LRDUZ("AR")
"RTN","LRVRAR",207,0)
 ;
"RTN","LRVRAR",208,0)
 ; Call to set data and comments
"RTN","LRVRAR",209,0)
 I $O(LRSB(0)) D
"RTN","LRVRAR",210,0)
 . D LRSBCOM^LRVR4,A3^LRVR3
"RTN","LRVRAR",211,0)
 . S LRSTORE=LRSTORE+1
"RTN","LRVRAR",212,0)
 . I $G(LA76248) S LRSTORE(LA76248)=$G(LRSTORE(LA76248))+1
"RTN","LRVRAR",213,0)
 ;
"RTN","LRVRAR",214,0)
 ; Send application ack back to sending application interface
"RTN","LRVRAR",215,0)
 D SENDACK^LRVRARU
"RTN","LRVRAR",216,0)
 Q
"RTN","LRVRAR",217,0)
 ;
"RTN","LRVRAR",218,0)
 ;
"RTN","LRVRAR",219,0)
STORE ; Store the data in LR global
"RTN","LRVRAR",220,0)
 ;
"RTN","LRVRAR",221,0)
 ;ZEXCEPT: LRAUTOVERIFY,LRDEL,LRDELTACHKOK,LRDFN,LRDUZ,LRERR,LRIDT,LRLDT,LRNOW,LRSB,LRSS
"RTN","LRVRAR",222,0)
 ;
"RTN","LRVRAR",223,0)
 N I,LRNGS,LRQ,LRTS,LRX,LRY,X,X1,Y
"RTN","LRVRAR",224,0)
 ;
"RTN","LRVRAR",225,0)
 I '$G(^TMP("LR",$J,"TMP",LRSB,"P")) S LRERR=$$CREATE^LA7LOG(117,1) Q
"RTN","LRVRAR",226,0)
 ;
"RTN","LRVRAR",227,0)
 ; START CHANGE FOR LR*5.2*484
"RTN","LRVRAR",228,0)
 S LRTS=$G(^TMP("LR",$J,"TMP",LRSB))
"RTN","LRVRAR",229,0)
 ; END CHANGE FOR LR*5.2*484
"RTN","LRVRAR",230,0)
 ;
"RTN","LRVRAR",231,0)
 S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVRAR",232,0)
 F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVRAR",233,0)
 S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVRAR",234,0)
 S LRTS=$G(^TMP("LR",$J,"TMP",LRSB))
"RTN","LRVRAR",235,0)
 D V25^LRVER5
"RTN","LRVRAR",236,0)
 S LRX=LRNGS,LRY=$P(LRSB(LRSB),U,5)
"RTN","LRVRAR",237,0)
 ;
"RTN","LRVRAR",238,0)
 ; Do delta checking if enabled
"RTN","LRVRAR",239,0)
 I LRDELTACHKOK D
"RTN","LRVRAR",240,0)
 . S X=$P(LRSB(LRSB),"^"),Y=0,(LRQ,X1)=""
"RTN","LRVRAR",241,0)
 . I LRLDT>0 S X1=$P($G(^LR(LRDFN,LRSS,LRLDT,LRSB)),U)
"RTN","LRVRAR",242,0)
 . I LRDEL'="" S LRQ=1 D XDELTACK^LRVERA ;S:Y LRDELTA=Y
"RTN","LRVRAR",243,0)
 ;
"RTN","LRVRAR",244,0)
 ; Store the file #60 units/ranges/etc values which don't come from the
"RTN","LRVRAR",245,0)
 ; middleware so verified results can be edited in vista with the
"RTN","LRVRAR",246,0)
 ; configuration values at the time of original verification
"RTN","LRVRAR",247,0)
 ; (#.01) SITE/SPECIMEN [1P:61] ^ (#1) REFERENCE LOW [2F] ^ (#2) REFERENCE HIGH [3F] ^ (#3) CRITICAL LOW [4F] ^ (#4) CRITICAL HIGH [5F] ^  ^ (#6) UNITS [7F] ^ (#7) TYPE OF DELTA CHECK [8P:62.1] ^
"RTN","LRVRAR",248,0)
 ; (#8) DELTA VALUE [9F] ^ (#9) DEFAULT VALUE [10F] ^ (#9.2) THERAPEUTIC LOW [11F] ^ (#9.3) THERAPEUTIC HIGH [12F] ^
"RTN","LRVRAR",249,0)
 F I=1,4,5,8:1:12 I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,U,I)
"RTN","LRVRAR",250,0)
 S $P(LRSB(LRSB),U,5)=LRY
"RTN","LRVRAR",251,0)
 ;
"RTN","LRVRAR",252,0)
 S $P(LRSB(LRSB),U,6)=LRNOW
"RTN","LRVRAR",253,0)
 ;
"RTN","LRVRAR",254,0)
 ; Store performing lab based on LRDUZ(2) from load/list profile.
"RTN","LRVRAR",255,0)
 S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRVRAR",256,0)
 ;
"RTN","LRVRAR",257,0)
 S ^LR(LRDFN,"CH",LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRVRAR",258,0)
 ;
"RTN","LRVRAR",259,0)
 Q
"RTN","LRVRAR",260,0)
 ;
"RTN","LRVRAR",261,0)
 ;
"RTN","LRVRAR",262,0)
OKTOREL() ; Determine if it's OK to store these results for auto release
"RTN","LRVRAR",263,0)
 ;
"RTN","LRVRAR",264,0)
 ;ZEXCEPT: LRDATA,LRDUZ,LRLL,LRSQ
"RTN","LRVRAR",265,0)
 ;
"RTN","LRVRAR",266,0)
 ; Returns OK = "" (no "user")
"RTN","LRVRAR",267,0)
 ;            = 0  (results not flagged for auto release)
"RTN","LRVRAR",268,0)
 ;            = 0^error code (62.485)^invalid user duz
"RTN","LRVRAR",269,0)
 ;            = 1^duz of user  (tech verify)
"RTN","LRVRAR",270,0)
 ;            = 2  (auto verify user)
"RTN","LRVRAR",271,0)
 ;
"RTN","LRVRAR",272,0)
 N OK,LRX,LRY
"RTN","LRVRAR",273,0)
 ;
"RTN","LRVRAR",274,0)
 S OK=""
"RTN","LRVRAR",275,0)
 ;
"RTN","LRVRAR",276,0)
 I $P($G(^LAH(LRLL,1,LRSQ,LRDATA)),U)="" S OK=0
"RTN","LRVRAR",277,0)
 ;
"RTN","LRVRAR",278,0)
 ; Results not flagged for auto release.
"RTN","LRVRAR",279,0)
 I '$D(^LAH(LRLL,1,"AUTOREL",LRSQ,LRDATA)) S OK=0
"RTN","LRVRAR",280,0)
 ;
"RTN","LRVRAR",281,0)
 ; Retrieve stored auto release setting when this result arrived.
"RTN","LRVRAR",282,0)
 S LRX=$P(^LAH(LRLL,1,"AUTOREL",LRSQ,LRDATA),U,2)
"RTN","LRVRAR",283,0)
 ;
"RTN","LRVRAR",284,0)
 ; Retrieve user id/duz received with results.
"RTN","LRVRAR",285,0)
 S LRY=$P(LRDATA(LRDATA),U,4)
"RTN","LRVRAR",286,0)
 ;
"RTN","LRVRAR",287,0)
 I OK="" D
"RTN","LRVRAR",288,0)
 . ; If no user or auto release proxy then log error
"RTN","LRVRAR",289,0)
 . I LRY<1 S OK="0^303" Q
"RTN","LRVRAR",290,0)
 . I LRY=LRDUZ("AR") S OK="0^304"_U_LRY Q
"RTN","LRVRAR",291,0)
 . ;
"RTN","LRVRAR",292,0)
 . ; If auto release on for auto or tech verify
"RTN","LRVRAR",293,0)
 . I LRX=1 D  Q
"RTN","LRVRAR",294,0)
 . . I LRY=LRDUZ("AV") S OK=2 Q
"RTN","LRVRAR",295,0)
 . . S OK=1_U_LRY Q
"RTN","LRVRAR",296,0)
 . ;
"RTN","LRVRAR",297,0)
 . ; If auto release on for auto verify only
"RTN","LRVRAR",298,0)
 . I LRX=2 D  Q
"RTN","LRVRAR",299,0)
 . . I LRY=LRDUZ("AV") S OK=2 Q
"RTN","LRVRAR",300,0)
 . . S OK="0^305"_U_LRY
"RTN","LRVRAR",301,0)
 . ;
"RTN","LRVRAR",302,0)
 . ; If auto release on for tech verify only
"RTN","LRVRAR",303,0)
 . I LRX=3 D  Q
"RTN","LRVRAR",304,0)
 . . I LRY'=LRDUZ("AV"),LRY'=LRDUZ("AR") S OK=1_U_LRY Q
"RTN","LRVRAR",305,0)
 . . S OK="0^306"_U_LRY
"RTN","LRVRAR",306,0)
 ;
"RTN","LRVRAR",307,0)
 ; Check if tech verify that user owns LRVERIFY security key.
"RTN","LRVRAR",308,0)
 I $P(OK,U)=1 D
"RTN","LRVRAR",309,0)
 . N LRKEY
"RTN","LRVRAR",310,0)
 . ;
"RTN","LRVRAR",311,0)
 . ; check if user is active
"RTN","LRVRAR",312,0)
 . I '$$ACTIVE^XUSER($P(OK,U,2)) S OK="0^302^"_$P(OK,U,2) Q
"RTN","LRVRAR",313,0)
 . ;
"RTN","LRVRAR",314,0)
 . ; check that user has LRVERIFY key
"RTN","LRVRAR",315,0)
 . D OWNSKEY^XUSRB(.LRKEY,"LRVERIFY",$P(OK,U,2))
"RTN","LRVRAR",316,0)
 . I LRKEY(0)=1 Q
"RTN","LRVRAR",317,0)
 . S OK="0^301^"_$P(OK,U,2)
"RTN","LRVRAR",318,0)
 ;
"RTN","LRVRAR",319,0)
 Q OK
"VER")
8.0^22.2
"BLD",10197,6)
^389
**END**
**END**

