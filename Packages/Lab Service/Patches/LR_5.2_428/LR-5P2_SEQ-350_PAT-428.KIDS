Released LR*5.2*428 SEQ #350
Extracted from mail message
**KIDS**:LR*5.2*428^

**INSTALL NAME**
LR*5.2*428
"BLD",9238,0)
LR*5.2*428^LAB SERVICE^0^3140305^y
"BLD",9238,1,0)
^^3^3^3130508^
"BLD",9238,1,1,0)
1. Cannot add NHCU station number to Associated Division in File #68
"BLD",9238,1,2,0)
 
"BLD",9238,1,3,0)
2. AP Edit Log-In option handles patient location edit incorrect
"BLD",9238,4,0)
^9.64PA^68^1
"BLD",9238,4,68,0)
68
"BLD",9238,4,68,2,0)
^9.641^68.03^1
"BLD",9238,4,68,2,68.03,0)
ASSOCIATED DIVISION  (sub-file)
"BLD",9238,4,68,2,68.03,1,0)
^9.6411^.01^1
"BLD",9238,4,68,2,68.03,1,.01,0)
ASSOCIATED DIVISION
"BLD",9238,4,68,222)
y^n^p^^^^n^^n
"BLD",9238,4,68,224)

"BLD",9238,4,"APDD",68,68.03)

"BLD",9238,4,"APDD",68,68.03,.01)

"BLD",9238,4,"B",68,68)

"BLD",9238,6)
2^
"BLD",9238,6.3)
16
"BLD",9238,"ABPKG")
n
"BLD",9238,"INI")

"BLD",9238,"INID")
^^
"BLD",9238,"INIT")

"BLD",9238,"KRN",0)
^9.67PA^779.2^20
"BLD",9238,"KRN",.4,0)
.4
"BLD",9238,"KRN",.401,0)
.401
"BLD",9238,"KRN",.402,0)
.402
"BLD",9238,"KRN",.403,0)
.403
"BLD",9238,"KRN",.5,0)
.5
"BLD",9238,"KRN",.84,0)
.84
"BLD",9238,"KRN",3.6,0)
3.6
"BLD",9238,"KRN",3.8,0)
3.8
"BLD",9238,"KRN",9.2,0)
9.2
"BLD",9238,"KRN",9.8,0)
9.8
"BLD",9238,"KRN",9.8,"NM",0)
^9.68A^3^1
"BLD",9238,"KRN",9.8,"NM",3,0)
LRAPED^^0^B63450005
"BLD",9238,"KRN",9.8,"NM","B","LRAPED",3)

"BLD",9238,"KRN",19,0)
19
"BLD",9238,"KRN",19,"NM",0)
^9.68A^^
"BLD",9238,"KRN",19.1,0)
19.1
"BLD",9238,"KRN",101,0)
101
"BLD",9238,"KRN",409.61,0)
409.61
"BLD",9238,"KRN",771,0)
771
"BLD",9238,"KRN",779.2,0)
779.2
"BLD",9238,"KRN",870,0)
870
"BLD",9238,"KRN",8989.51,0)
8989.51
"BLD",9238,"KRN",8989.52,0)
8989.52
"BLD",9238,"KRN",8994,0)
8994
"BLD",9238,"KRN","B",.4,.4)

"BLD",9238,"KRN","B",.401,.401)

"BLD",9238,"KRN","B",.402,.402)

"BLD",9238,"KRN","B",.403,.403)

"BLD",9238,"KRN","B",.5,.5)

"BLD",9238,"KRN","B",.84,.84)

"BLD",9238,"KRN","B",3.6,3.6)

"BLD",9238,"KRN","B",3.8,3.8)

"BLD",9238,"KRN","B",9.2,9.2)

"BLD",9238,"KRN","B",9.8,9.8)

"BLD",9238,"KRN","B",19,19)

"BLD",9238,"KRN","B",19.1,19.1)

"BLD",9238,"KRN","B",101,101)

"BLD",9238,"KRN","B",409.61,409.61)

"BLD",9238,"KRN","B",771,771)

"BLD",9238,"KRN","B",779.2,779.2)

"BLD",9238,"KRN","B",870,870)

"BLD",9238,"KRN","B",8989.51,8989.51)

"BLD",9238,"KRN","B",8989.52,8989.52)

"BLD",9238,"KRN","B",8994,8994)

"BLD",9238,"QDEF")
^^^^^^^^^^YES
"BLD",9238,"QUES",0)
^9.62^^
"BLD",9238,"REQB",0)
^9.611^1^1
"BLD",9238,"REQB",1,0)
LR*5.2*433^2
"BLD",9238,"REQB","B","LR*5.2*433",1)

"FIA",68)
ACCESSION
"FIA",68,0)
^LRO(68,
"FIA",68,0,0)
68I
"FIA",68,0,1)
y^n^p^^^^n^^n
"FIA",68,0,10)

"FIA",68,0,11)

"FIA",68,0,"RLRO")

"FIA",68,0,"VR")
5.2^LR
"FIA",68,68)
1
"FIA",68,68,.091)

"FIA",68,68.03)
1
"FIA",68,68.03,.01)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
428^3140305^33232
"PKG",26,22,1,"PAH",1,1,0)
^^3^3^3140305
"PKG",26,22,1,"PAH",1,1,1,0)
1. Cannot add NHCU station number to Associated Division in File #68
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
2. AP Edit Log-In option handles patient location edit incorrect
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRAPED")
0^3^B63450005^B33912945
"RTN","LRAPED",1,0)
LRAPED ;DALOI/STAFF,PMK - ANATOMIC PATH EDIT LOG-IN ;17 Sep 2013 7:31 AM
"RTN","LRAPED",2,0)
 ;;5.2;LAB SERVICE;**1,31,72,115,259,350,427,433,428**;Sep 27, 1994;Build 16
"RTN","LRAPED",3,0)
 ;
"RTN","LRAPED",4,0)
 ;RB LR*5.2*428 Added code to insure a defined site hospital location
"RTN","LRAPED",5,0)
 ;              can be entered when editing the patient location field.
"RTN","LRAPED",6,0)
 ;              This insures the correct location and patient type will
"RTN","LRAPED",7,0)
 ;              be propagated to corresponding fields in file #68 and
"RTN","LRAPED",8,0)
 ;              #69. This insures the log book reflects the correct
"RTN","LRAPED",9,0)
 ;              patient location and CPT data transfer to PCE will be
"RTN","LRAPED",10,0)
 ;              based on an accurate patient type.
"RTN","LRAPED",11,0)
 ;
"RTN","LRAPED",12,0)
 N LRTMP,LRREL,LRCOMP,LRMSG
"RTN","LRAPED",13,0)
 D ^LRAP Q:'$D(Y)
"RTN","LRAPED",14,0)
 D XR^LRU
"RTN","LRAPED",15,0)
 I LRCAPA D @(LRSS_"^LRAPSWK") G:'$D(X) END
"RTN","LRAPED",16,0)
 W !!,"EDIT ",LRO(68)," (",LRABV,") Log-In/Clinical Hx for ",LRH(0)," "
"RTN","LRAPED",17,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPED",18,0)
 I %=2 D  G:Y<1 END
"RTN","LRAPED",19,0)
 . S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: "
"RTN","LRAPED",20,0)
 . D ^%DT K %DT
"RTN","LRAPED",21,0)
 . Q:Y<1
"RTN","LRAPED",22,0)
 . S LRAD=$E(Y,1,3)_"0000",Y=LRAD D D^LRU S LRH(0)=Y
"RTN","LRAPED",23,0)
 S LRC=$E(LRAD,1,3)
"RTN","LRAPED",24,0)
G ;
"RTN","LRAPED",25,0)
 W !!,"Enter ",LRO(68)," Accession #: " R LRAN:DTIME
"RTN","LRAPED",26,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPED",27,0)
 I LRAN'?1N.N!($E(LRAN)=0) D  G G
"RTN","LRAPED",28,0)
 .W $C(7),!," ENTER NUMBERS ONLY, No leading zero's"
"RTN","LRAPED",29,0)
 D EDIT I $G(END)=1 K END    ;LR*5.2*428 quit if not valid location
"RTN","LRAPED",30,0)
 ;
"RTN","LRAPED",31,0)
 I $T(EDIT^MAGT7MA)'="" D EDIT^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRAPED",32,0)
 ;
"RTN","LRAPED",33,0)
 G G
"RTN","LRAPED",34,0)
 ;
"RTN","LRAPED",35,0)
 ;
"RTN","LRAPED",36,0)
EDIT ;
"RTN","LRAPED",37,0)
 N LRDIWESUB,LRFILE,LRACC
"RTN","LRAPED",38,0)
 S LRDFN=$O(^LR(LRXREF,LRC,LRABV,LRAN,0))
"RTN","LRAPED",39,0)
 I 'LRDFN W $C(7),"  Not in file" Q
"RTN","LRAPED",40,0)
 I '$D(^LR(LRDFN,0)) K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN) Q
"RTN","LRAPED",41,0)
 S X=^LR(LRDFN,0) D ^LRUP W !,LRP," ID: ",SSN," OK "
"RTN","LRAPED",42,0)
 S %=1 D YN^LRU Q:%'=1
"RTN","LRAPED",43,0)
 D @($S("CYEMSP"[LRSS:"I",1:"A"))
"RTN","LRAPED",44,0)
 Q
"RTN","LRAPED",45,0)
 ;
"RTN","LRAPED",46,0)
 ;
"RTN","LRAPED",47,0)
I ;Non-autopsy sections (SP,CY,EM)
"RTN","LRAPED",48,0)
 D GETDEF^LRAP
"RTN","LRAPED",49,0)
 S LRI=+$O(^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,0))
"RTN","LRAPED",50,0)
 I '$D(^LR(LRDFN,LRSS,LRI,0)) D  Q
"RTN","LRAPED",51,0)
 . W $C(7),!,"Entry in x-ref but not in file ! X-ref deleted."
"RTN","LRAPED",52,0)
 . K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,LRI)
"RTN","LRAPED",53,0)
 S X=^LR(LRDFN,LRSS,LRI,0),LRRC=$P(X,"^",10)
"RTN","LRAPED",54,0)
 S DA=LRI,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""",",(LRB,Y)=+X
"RTN","LRAPED",55,0)
 D D^LRU W !,"Specimen date: ",Y
"RTN","LRAPED",56,0)
 I $P(^LR(LRDFN,LRSS,LRI,0),"^",11)!($P(^(0),"^",3)) D  Q
"RTN","LRAPED",57,0)
 . W $C(7),!!,"Report released or completed.  Cannot edit Log-in data."
"RTN","LRAPED",58,0)
 D:LRCAPA C^LRAPSWK
"RTN","LRAPED",59,0)
 ;
"RTN","LRAPED",60,0)
DIE ;
"RTN","LRAPED",61,0)
 ;
"RTN","LRAPED",62,0)
 W ! D CK^LRU
"RTN","LRAPED",63,0)
 I $D(LR("CK")) K LR("CK") Q
"RTN","LRAPED",64,0)
 S LRACC=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",6)
"RTN","LRAPED",65,0)
 ;
"RTN","LRAPED",66,0)
 S LRDIWESUB="["_LRACC_"]"
"RTN","LRAPED",67,0)
 ;
"RTN","LRAPED",68,0)
 ;LR*5.2*428 START: ASK LOCATION PER FILE 44 DEFINED
"RTN","LRAPED",69,0)
 S LRLLOC=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",8)
"RTN","LRAPED",70,0)
 D ASK I $G(END)=1 Q
"RTN","LRAPED",71,0)
 ;
"RTN","LRAPED",72,0)
 S DA=LRI,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""","
"RTN","LRAPED",73,0)
 S DR=".08///^S X=LRLLOC" D ^DIE K DR
"RTN","LRAPED",74,0)
 ;SET Associated files 68 & 69 LOCATION & TYPE fields
"RTN","LRAPED",75,0)
 D UIDEX      ;propagate LOCATION/TYPE info to files 68 & 69 fields
"RTN","LRAPED",76,0)
 ;LR*5.2*428 END: ASK LOCATION PER FILE 44 DEFINED
"RTN","LRAPED",77,0)
 ;
"RTN","LRAPED",78,0)
 S DA=LRI,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""","  ;LR*5.1*428 restore previous DIE setup
"RTN","LRAPED",79,0)
 D SET,^DIE
"RTN","LRAPED",80,0)
 I $D(Y) D HELP G DIE
"RTN","LRAPED",81,0)
 D CK
"RTN","LRAPED",82,0)
 D:$O(^LR(LRDFN,LRSS,LRI,.1,0))&("SPCYEM"[LRSS)&(LRCAPA) C1^LRAPSWK
"RTN","LRAPED",83,0)
 D FRE^LRU
"RTN","LRAPED",84,0)
 Q
"RTN","LRAPED",85,0)
 ;
"RTN","LRAPED",86,0)
 ;
"RTN","LRAPED",87,0)
SET ; Setup fields for SP, CY and EM subscripts to edit.
"RTN","LRAPED",88,0)
 ;
"RTN","LRAPED",89,0)
 ;N LRFIELD,LRFILE
"RTN","LRAPED",90,0)
 ;S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:"")
"RTN","LRAPED",91,0)
 ;F LRFIELD=.013,.014,.015,.016 S LRDIWESUB(LRFILE,LRFIELD)=$$SET2(LRFILE,LRFIELD,LRACC)
"RTN","LRAPED",92,0)
 ;
"RTN","LRAPED",93,0)
 S (LRJ,LRE,LRF)=""
"RTN","LRAPED",94,0)
 S DR=".07;S LRJ=X;S:LRJ LRJ=$P(^VA(200,LRJ,0),U);"     ;LR*5.2*428 Remove .08 field edit
"RTN","LRAPED",95,0)
 S DR=DR_".011//^S X=LRJ;.012;.013;.014;.015;.016;.1;S LRG=X;.02;.021;"
"RTN","LRAPED",96,0)
 S DR=DR_".99;S LRF=X"
"RTN","LRAPED",97,0)
 ;
"RTN","LRAPED",98,0)
 I LRSS="SP" D
"RTN","LRAPED",99,0)
 . S DR(2,63.812)=".01;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",100,0)
 . S DR(2,63.812)=DR(2,63.812)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U)"
"RTN","LRAPED",101,0)
 ;
"RTN","LRAPED",102,0)
 I LRSS="CY" D
"RTN","LRAPED",103,0)
 . S DR(2,63.902)=".01;S LR(63.902)=X;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",104,0)
 . S DR(2,63.902)=DR(2,63.902)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U);S:'LRCAPA Y=""@2"";.02;@2"
"RTN","LRAPED",105,0)
 ;
"RTN","LRAPED",106,0)
 I LRSS="EM" D
"RTN","LRAPED",107,0)
 . S DR(2,63.202)=".01;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",108,0)
 . S DR(2,63.202)=DR(2,63.202)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U)"
"RTN","LRAPED",109,0)
 Q
"RTN","LRAPED",110,0)
 ;
"RTN","LRAPED",111,0)
 ;
"RTN","LRAPED",112,0)
SET1 ; Setup autopsy fields to edit.
"RTN","LRAPED",113,0)
 ;
"RTN","LRAPED",114,0)
 S LRJ="",DA=LRDFN,DIE="^LR(",DR="11;S LRRC=X;14.1;S LRLLOC=X;14.5;"
"RTN","LRAPED",115,0)
 S DR=DR_"14.6;S LRSVC=X;12.1;S LRMD=X;13.5:13.8"
"RTN","LRAPED",116,0)
 S:%=1 DR=DR_";16:24;26:31;25;31.1:31.4;25.1:25.9"
"RTN","LRAPED",117,0)
 D D^LRAUAW
"RTN","LRAPED",118,0)
 S (Y,LRB)=LR(63,12),LRI=9999999-$P(LRB,".")
"RTN","LRAPED",119,0)
 Q
"RTN","LRAPED",120,0)
 ;
"RTN","LRAPED",121,0)
 ;
"RTN","LRAPED",122,0)
SET2(FILE,FIELD,PREFIX) ; Build field name with specified prefix.
"RTN","LRAPED",123,0)
 ; Call with  FILE = file or subfile number
"RTN","LRAPED",124,0)
 ;           FIELD = field number of WP field
"RTN","LRAPED",125,0)
 ;          PREFIX = prefix for subject header
"RTN","LRAPED",126,0)
 ;
"RTN","LRAPED",127,0)
 N LABEL
"RTN","LRAPED",128,0)
 S LABEL=$$GET1^DID(FILE,FIELD,"","LABEL")
"RTN","LRAPED",129,0)
 I LABEL'="" S LABEL=PREFIX_" "_LABEL
"RTN","LRAPED",130,0)
 ;
"RTN","LRAPED",131,0)
 Q LABEL
"RTN","LRAPED",132,0)
 ;
"RTN","LRAPED",133,0)
 ;
"RTN","LRAPED",134,0)
A ;Autopsy
"RTN","LRAPED",135,0)
 S LRREL=+$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPED",136,0)
 S LRCOMP=+$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPED",137,0)
 I LRREL!LRCOMP D  Q
"RTN","LRAPED",138,0)
 . D EN^DDIOL($C(7)_"Report released or completed.  Cannot edit Log-in data.","","!!")
"RTN","LRAPED",139,0)
 W !!,"Edit Weights & Measurements " S %=2 D YN^LRU Q:%<1
"RTN","LRAPED",140,0)
 S LRRC=$P(^LR(LRDFN,"AU"),U),DA=LRDFN,DIE="^LR("
"RTN","LRAPED",141,0)
 D SET1,D^LRU
"RTN","LRAPED",142,0)
 W !!,"Date Died: ",Y
"RTN","LRAPED",143,0)
 I 'LRB D  Q
"RTN","LRAPED",144,0)
 . W $C(7),"?  Must have date died entered in ",LR(63,.02)," File."
"RTN","LRAPED",145,0)
 ;
"RTN","LRAPED",146,0)
 S LRACC=$P($G(^LR(LRDFN,"AU")),"^",6)
"RTN","LRAPED",147,0)
 ;
"RTN","LRAPED",148,0)
AU ;
"RTN","LRAPED",149,0)
 ;
"RTN","LRAPED",150,0)
 S LRDIWESUB="["_LRACC_"]"
"RTN","LRAPED",151,0)
 W ! D ^DIE
"RTN","LRAPED",152,0)
 I $D(Y) D HELP G AU
"RTN","LRAPED",153,0)
 D CK1
"RTN","LRAPED",154,0)
 Q
"RTN","LRAPED",155,0)
 ;
"RTN","LRAPED",156,0)
 ;
"RTN","LRAPED",157,0)
CK ;
"RTN","LRAPED",158,0)
 I '$D(^LR(LRDFN,LRSS,LRI)) D K
"RTN","LRAPED",159,0)
 Q
"RTN","LRAPED",160,0)
 ;
"RTN","LRAPED",161,0)
 ;
"RTN","LRAPED",162,0)
CK1 ;
"RTN","LRAPED",163,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  S X=^(0)
"RTN","LRAPED",164,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)) ^(3)=LRB_"^^^^"_LRI
"RTN","LRAPED",165,0)
 S LRTMP=$P(X,U,1,2)_U_LRRC_U_$P(X,U,4,6)_U_LRLLOC_U_LRMD_U_LRSVC
"RTN","LRAPED",166,0)
 S LRTMP=LRTMP_U_$P(X,U,10)
"RTN","LRAPED",167,0)
 S ^LRO(68,LRAA,1,LRAD,1,LRAN,0)=LRTMP
"RTN","LRAPED",168,0)
 S LRD=+$P(X,U,3)
"RTN","LRAPED",169,0)
 K ^LRO(68,LRAA,1,LRAD,1,"E",LRD,LRAN)
"RTN","LRAPED",170,0)
 S ^LRO(68,LRAA,1,LRAD,1,"E",LRRC,LRAN)=""
"RTN","LRAPED",171,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,3),^(3)=LRB_U_$P(X,U,2,99)
"RTN","LRAPED",172,0)
 Q
"RTN","LRAPED",173,0)
 ;
"RTN","LRAPED",174,0)
 ;
"RTN","LRAPED",175,0)
K ;
"RTN","LRAPED",176,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN))  D K^LRUDEL
"RTN","LRAPED",177,0)
 L +^LRO(68,LRAA):999
"RTN","LRAPED",178,0)
 K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LRO(68,LRAA,1,LRAD,1,"E",LRRC,LRAN)
"RTN","LRAPED",179,0)
 K ^LRO(68,LRAA,1,"AC",DUZ(2),LRAD,LRAN)
"RTN","LRAPED",180,0)
 S X=^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPED",181,0)
 S LRTMP=$P(X,"^",1,2)_"^"_(LRAN-1)_"^"_($P(X,"^",4)-1)
"RTN","LRAPED",182,0)
 S ^LRO(68,LRAA,1,LRAD,1,0)=LRTMP
"RTN","LRAPED",183,0)
 L -^LRO(68,LRAA)
"RTN","LRAPED",184,0)
 F A=1,2,3,4 D
"RTN","LRAPED",185,0)
 . I $D(^LRO(69.2,LRAA,A,LRAN)) K ^(LRAN) D
"RTN","LRAPED",186,0)
 . . S X(1)=$O(^LRO(69.2,LRAA,A,0)) S:'X(1) X(1)=0
"RTN","LRAPED",187,0)
 . . I $D(^LRO(69.2,LRAA,A,0)) D
"RTN","LRAPED",188,0)
 . . . L +^LRO(69.2,LRAA,A):999
"RTN","LRAPED",189,0)
 . . . S X=^LRO(69.2,LRAA,A,0)
"RTN","LRAPED",190,0)
 . . . S LRTMP=$P(X,"^",1,2)_"^"_X(1)_"^"_$S(X(1)=0:X(1),1:($P(X,"^",4)-1))
"RTN","LRAPED",191,0)
 . . . S ^LRO(69.2,LRAA,A,0)=LRTMP
"RTN","LRAPED",192,0)
 . . . L -^LRO(69.2,LRAA,A)
"RTN","LRAPED",193,0)
 Q
"RTN","LRAPED",194,0)
 ;
"RTN","LRAPED",195,0)
 ;
"RTN","LRAPED",196,0)
HELP ;
"RTN","LRAPED",197,0)
 W $C(7),!!,"Please do not exit EDIT with an ""^""."
"RTN","LRAPED",198,0)
 W !,"Press RETURN key repeatedly to complete the edit.",!!
"RTN","LRAPED",199,0)
 Q
"RTN","LRAPED",200,0)
 ;
"RTN","LRAPED",201,0)
 ;LR*5.2*428 Added location query to insure location defined in file 44
"RTN","LRAPED",202,0)
ASK W !,"PATIENT LOCATION: ",LRLLOC,$S(LRLLOC]"":"// ",1:"") R X:DTIME G:X[U ASKOUT I '$T&(LRLLOC="") W "   Must enter defined location" G ASK
"RTN","LRAPED",203,0)
 I $L(X)>30!(X'?.ANP) W "  Enter 2 - 30 alpha-numeric name" G ASK
"RTN","LRAPED",204,0)
 K DIC S DIC("S")="I '$G(^(""OOS""))"
"RTN","LRAPED",205,0)
 S LROLLOC="",DIC=44,DIC(0)="EMOQZ" S:X="" X=LRLLOC D ^DIC K DIC G ASK:X["?"
"RTN","LRAPED",206,0)
 I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) G ASKOUT
"RTN","LRAPED",207,0)
 I Y<0 W "  You must select a standard location." G ASK
"RTN","LRAPED",208,0)
 S (LRE,LROLLOC)=+Y,LRLLOC=$P(Y(0),U),LRLOCTYP=$P(Y(0),U,3)
"RTN","LRAPED",209,0)
 S:'$L(LRLLOC) LRLLOC="NO ABRV"
"RTN","LRAPED",210,0)
INACT K LRIA,LRRA I $D(^SC(+Y,"I")) S LRIA=+^("I"),LRRA=$P(^("I"),U,2)
"RTN","LRAPED",211,0)
 I $S('$D(LRIA):0,'LRIA:0,LRIA>DT:0,LRRA'>DT&(LRRA):0,1:1) W $C(7),"  Location is inactive, Not allowed." G ASK
"RTN","LRAPED",212,0)
ASKQ K DIC,LRIA,LRRA,% Q
"RTN","LRAPED",213,0)
ASKOUT W !,"  VALID LOCATION REQUIRED TO CONTINUE, EXITING SELECTED ACCESSION" S END=1 G ASKQ
"RTN","LRAPED",214,0)
 ;
"RTN","LRAPED",215,0)
END ;
"RTN","LRAPED",216,0)
 D V^LRU K DUOUT,DIRUT,DTOUT
"RTN","LRAPED",217,0)
 Q
"RTN","LRAPED",218,0)
 ;
"RTN","LRAPED",219,0)
UIDEX ;LR*5.2*428 Propagate location/type to file 68 & 69 associated fields
"RTN","LRAPED",220,0)
 ;Find 68 link using UID from file 63 accession
"RTN","LRAPED",221,0)
 N X1,X2,X3,X4,X5 S (X1,X2,X3)=0
"RTN","LRAPED",222,0)
 S LRUID=$P($G(^LR(LRDFN,LRSS,LRI,"ORU")),U) G:LRUID="" UIDEXQ
"RTN","LRAPED",223,0)
 S X1=$O(^LRO(68,"C",LRUID,X1)) G:'X1 UIDEXQ
"RTN","LRAPED",224,0)
 S X2=$O(^LRO(68,"C",LRUID,X1,X2)) G:'X2 UIDEXQ
"RTN","LRAPED",225,0)
 S X3=$O(^LRO(68,"C",LRUID,X1,X2,X3)) G:'X3 UIDEXQ
"RTN","LRAPED",226,0)
 S DIE="^LRO(68,X1,1,X2,1,",DA=X3,DR="6////^S X=LRLLOC;92///^S X=LRLOCTYP"
"RTN","LRAPED",227,0)
 D ^DIE K DR,DIE,DA,LRUID
"RTN","LRAPED",228,0)
 ;Find 69 link using date/accession number in file 68
"RTN","LRAPED",229,0)
 S X4=$P(^LRO(68,X1,1,X2,1,X3,0),U,4),X5=$P(^LRO(68,X1,1,X2,1,X3,0),U,5)
"RTN","LRAPED",230,0)
 I X4&X5&$D(^LRO(69,X4,1,X5,0)) D
"RTN","LRAPED",231,0)
 . S DIE="^LRO(69,X4,1,",DA=X5,DA(1)=X4,DR="8////^S X=LROLLOC"
"RTN","LRAPED",232,0)
 D ^DIE
"RTN","LRAPED",233,0)
UIDEXQ K DR,DIE,DA,LRLLOC,LRLOCTYP,LROLLOC
"RTN","LRAPED",234,0)
 Q
"UP",68,68.03,-1)
68^3
"UP",68,68.03,0)
68.03
"VER")
8.0^22.0
"^DD",68,68,.091,0)
ASSOCIATED DIVISION^68.03PA^^3;0
"^DD",68,68,.091,"DT")
2950731
"^DD",68,68.03,0)
ASSOCIATED DIVISION SUB-FIELD^^.01^1
"^DD",68,68.03,0,"NM","ASSOCIATED DIVISION")

"^DD",68,68.03,.01,0)
ASSOCIATED DIVISION^M*P4'X^DIC(4,^0;1^S DIC("S")="I $E(+$G(^DIC(4,+Y,99)),1,3)=+$P($$SITE^VASITE,U,3)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",68,68.03,.01,1,0)
^.1
"^DD",68,68.03,.01,1,1,0)
68.03^B
"^DD",68,68.03,.01,1,1,1)
S ^LRO(68,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",68,68.03,.01,1,1,2)
K ^LRO(68,DA(1),3,"B",$E(X,1,30),DA)
"^DD",68,68.03,.01,12)
Allows only divisions related to site.
"^DD",68,68.03,.01,12.1)
S DIC("S")="I $E(+$G(^DIC(4,+Y,99)),1,3)=+$P($$SITE^VASITE,U,3)"
"^DD",68,68.03,.01,"DT")
3140305
"BLD",9238,6)
^350
**END**
**END**

