Released LR*5.2*523 SEQ #425
Extracted from mail message
**KIDS**:LR*5.2*523^

**INSTALL NAME**
LR*5.2*523
"BLD",11148,0)
LR*5.2*523^LAB SERVICE^0^3190517^y
"BLD",11148,1,0)
^^1^1^3190516^
"BLD",11148,1,1,0)
Most Recent report in CPRS buttons greyed out
"BLD",11148,4,0)
^9.64PA^^
"BLD",11148,6)
2^
"BLD",11148,6.3)
4
"BLD",11148,"ABPKG")
n
"BLD",11148,"KRN",0)
^9.67PA^1.5^24
"BLD",11148,"KRN",.4,0)
.4
"BLD",11148,"KRN",.401,0)
.401
"BLD",11148,"KRN",.402,0)
.402
"BLD",11148,"KRN",.403,0)
.403
"BLD",11148,"KRN",.5,0)
.5
"BLD",11148,"KRN",.84,0)
.84
"BLD",11148,"KRN",1.5,0)
1.5
"BLD",11148,"KRN",1.6,0)
1.6
"BLD",11148,"KRN",1.61,0)
1.61
"BLD",11148,"KRN",1.62,0)
1.62
"BLD",11148,"KRN",3.6,0)
3.6
"BLD",11148,"KRN",3.8,0)
3.8
"BLD",11148,"KRN",9.2,0)
9.2
"BLD",11148,"KRN",9.8,0)
9.8
"BLD",11148,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11148,"KRN",9.8,"NM",1,0)
LR7OGM^^0^B47777096
"BLD",11148,"KRN",9.8,"NM",2,0)
LR7OGMC^^0^B38181513
"BLD",11148,"KRN",9.8,"NM","B","LR7OGM",1)

"BLD",11148,"KRN",9.8,"NM","B","LR7OGMC",2)

"BLD",11148,"KRN",19,0)
19
"BLD",11148,"KRN",19.1,0)
19.1
"BLD",11148,"KRN",101,0)
101
"BLD",11148,"KRN",409.61,0)
409.61
"BLD",11148,"KRN",771,0)
771
"BLD",11148,"KRN",779.2,0)
779.2
"BLD",11148,"KRN",870,0)
870
"BLD",11148,"KRN",8989.51,0)
8989.51
"BLD",11148,"KRN",8989.52,0)
8989.52
"BLD",11148,"KRN",8994,0)
8994
"BLD",11148,"KRN","B",.4,.4)

"BLD",11148,"KRN","B",.401,.401)

"BLD",11148,"KRN","B",.402,.402)

"BLD",11148,"KRN","B",.403,.403)

"BLD",11148,"KRN","B",.5,.5)

"BLD",11148,"KRN","B",.84,.84)

"BLD",11148,"KRN","B",1.5,1.5)

"BLD",11148,"KRN","B",1.6,1.6)

"BLD",11148,"KRN","B",1.61,1.61)

"BLD",11148,"KRN","B",1.62,1.62)

"BLD",11148,"KRN","B",3.6,3.6)

"BLD",11148,"KRN","B",3.8,3.8)

"BLD",11148,"KRN","B",9.2,9.2)

"BLD",11148,"KRN","B",9.8,9.8)

"BLD",11148,"KRN","B",19,19)

"BLD",11148,"KRN","B",19.1,19.1)

"BLD",11148,"KRN","B",101,101)

"BLD",11148,"KRN","B",409.61,409.61)

"BLD",11148,"KRN","B",771,771)

"BLD",11148,"KRN","B",779.2,779.2)

"BLD",11148,"KRN","B",870,870)

"BLD",11148,"KRN","B",8989.51,8989.51)

"BLD",11148,"KRN","B",8989.52,8989.52)

"BLD",11148,"KRN","B",8994,8994)

"BLD",11148,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11148,"QUES",0)
^9.62^^
"BLD",11148,"REQB",0)
^9.611^2^2
"BLD",11148,"REQB",1,0)
LR*5.2*520^2
"BLD",11148,"REQB",2,0)
LR*5.2*516^2
"BLD",11148,"REQB","B","LR*5.2*516",2)

"BLD",11148,"REQB","B","LR*5.2*520",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950611
"PKG",26,22,1,"PAH",1,0)
523^3190517^520824660
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3190517
"PKG",26,22,1,"PAH",1,1,1,0)
Most Recent report in CPRS buttons greyed out
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LR7OGM")
0^1^B47777096^B42661615
"RTN","LR7OGM",1,0)
LR7OGM ;DALOI/STAFF- Interim report rpc memo ;11/19/09  17:38
"RTN","LR7OGM",2,0)
 ;;5.2;LAB SERVICE;**187,220,312,286,395,350,523**;Sep 27, 1994;Build 4
"RTN","LR7OGM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","LR7OGM",4,0)
 ;
"RTN","LR7OGM",5,0)
TEST ; test use only
"RTN","LR7OGM",6,0)
 N TESTS,I K TESTS,^TMP("LR7OGX",$J)
"RTN","LR7OGM",7,0)
 ;S TESTS(548)=548
"RTN","LR7OGM",8,0)
 ;F I=1:1:10 I $D(^LAB(60,I,0)) S TESTS(I)=I
"RTN","LR7OGM",9,0)
 D SELECT(16,3090730,2700202,.TESTS,1,0)
"RTN","LR7OGM",10,0)
 S I=0 F  S I=$O(^TMP("LR7OGX",$J,"OUTPUT",I)) Q:I<1  W !,^(I)
"RTN","LR7OGM",11,0)
 K ^TMP("LR7OGX",$J)
"RTN","LR7OGM",12,0)
 Q
"RTN","LR7OGM",13,0)
 ;
"RTN","LR7OGM",14,0)
INTERIM(ROOT,DFN,SDATE,EDATE) ; from ORWLRR
"RTN","LR7OGM",15,0)
 N FORMAT,MICROCHK,TESTS K TESTS
"RTN","LR7OGM",16,0)
 S (FORMAT,MICROCHK)=""
"RTN","LR7OGM",17,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",18,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",19,0)
 Q
"RTN","LR7OGM",20,0)
 ;
"RTN","LR7OGM",21,0)
INTERIMG(ROOT,DFN,SDATE,DIR,FORMAT) ; from ORWLRR
"RTN","LR7OGM",22,0)
 N MICROCHK,TESTS K TESTS
"RTN","LR7OGM",23,0)
 S MICROCHK=1,FORMAT=$G(FORMAT,1)
"RTN","LR7OGM",24,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",25,0)
 D SELECT(DFN,SDATE,DIR,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",26,0)
 Q
"RTN","LR7OGM",27,0)
 ;
"RTN","LR7OGM",28,0)
INTERIMS(ROOT,DFN,SDATE,EDATE,TESTLIST) ; from ORWLRR
"RTN","LR7OGM",29,0)
 N FORMAT,MICROCHK,NUM,TESTS K TESTS
"RTN","LR7OGM",30,0)
 S (FORMAT,MICROCHK)=""
"RTN","LR7OGM",31,0)
 S NUM=0 F  S NUM=$O(TESTLIST(NUM)) Q:NUM<1  S TESTS(+TESTLIST(NUM))=""
"RTN","LR7OGM",32,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",33,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",34,0)
 Q
"RTN","LR7OGM",35,0)
 ;
"RTN","LR7OGM",36,0)
MICRO(ROOT,DFN,SDATE,EDATE) ; from ORWLRR
"RTN","LR7OGM",37,0)
 N FORMAT,MICROCHK,TESTS K TESTS
"RTN","LR7OGM",38,0)
 S FORMAT="",MICROCHK=-1
"RTN","LR7OGM",39,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",40,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",41,0)
 Q
"RTN","LR7OGM",42,0)
 ;
"RTN","LR7OGM",43,0)
SELECT(DFN,SDATE,EDATE,TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",44,0)
 ; get patient info, and expand tests
"RTN","LR7OGM",45,0)
 ; route setup chem and/or micro data
"RTN","LR7OGM",46,0)
 ; 9th piece of output indicates format (2: CH of CH/MI exact date/time, 3: MI of CH/MI, else 1 or "")
"RTN","LR7OGM",47,0)
 N AGE,ALL,ASK,AVAIL,CNIDT,DIRECT,DONE,EDT,FOK,I,IDT,LRCAN,LRDFN,MICROSUB,MNIDT,NEWOLD,OUTCNT,PNM,ROUTE,SEX,SDT,SKIP
"RTN","LR7OGM",48,0)
 K MICROSUB
"RTN","LR7OGM",49,0)
 K ^TMP("LR7OG",$J),^TMP("LR7OGX",$J,"OUTPUT"),^TMP("LRPLS",$J)
"RTN","LR7OGM",50,0)
 S OUTCNT=1,(DONE,SKIP)=0
"RTN","LR7OGM",51,0)
 D DEMO^LR7OGU(DFN,.LRDFN,.PNM,.AGE,.SEX)
"RTN","LR7OGM",52,0)
 I '$G(LRDFN) Q
"RTN","LR7OGM",53,0)
 D NEWOLD^LR7OGMU(.NEWOLD,DFN)
"RTN","LR7OGM",54,0)
 ;LR*523 Make NEWOLD date format match IDT format - reverse date
"RTN","LR7OGM",55,0)
 S $P(NEWOLD,U)=9999999-$P(NEWOLD,U),$P(NEWOLD,U,2)=9999999-$P(NEWOLD,U,2)
"RTN","LR7OGM",56,0)
 S ^TMP("LR7OG",$J,"G")=DFN_U_PNM_U_LRDFN_U_AGE_U_SEX_"^8"
"RTN","LR7OGM",57,0)
 S ALL=$S($O(TESTS(0)):0,1:1)
"RTN","LR7OGM",58,0)
 I 'ALL D TESTSGET^LR7OGU(.TESTS,.MICROSUB)
"RTN","LR7OGM",59,0)
 S DIRECT=1
"RTN","LR7OGM",60,0)
 I FORMAT S DIRECT=EDATE,EDATE=2700101
"RTN","LR7OGM",61,0)
 S EDATE=EDATE\1
"RTN","LR7OGM",62,0)
 S (IDT,SDT)=9999999-SDATE,EDT=9999999-EDATE
"RTN","LR7OGM",63,0)
 I FORMAT>1 S FOK=0 D  I FOK Q
"RTN","LR7OGM",64,0)
 . I DIRECT=1 D  Q
"RTN","LR7OGM",65,0)
 . . I FORMAT=2 D  Q
"RTN","LR7OGM",66,0)
 . . . D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",67,0)
 . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",68,0)
 . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",69,0)
 . . . S FOK=1
"RTN","LR7OGM",70,0)
 . . I FORMAT=3 D  Q
"RTN","LR7OGM",71,0)
 . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",72,0)
 . I DIRECT=-1 D  Q
"RTN","LR7OGM",73,0)
 . . I FORMAT=2 D  Q
"RTN","LR7OGM",74,0)
 . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",75,0)
 . . I FORMAT=3 D  Q
"RTN","LR7OGM",76,0)
 . . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",77,0)
 . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",78,0)
 . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=2
"RTN","LR7OGM",79,0)
 . . . S FOK=1
"RTN","LR7OGM",80,0)
 I ALL S ASK="BOTH"
"RTN","LR7OGM",81,0)
 E  I $O(MICROSUB(0)) D
"RTN","LR7OGM",82,0)
 . S ASK="MI" I $O(^TMP("LR7OG",$J,"TMP",0)) S ASK="BOTH"
"RTN","LR7OGM",83,0)
 E  S ASK="CH"
"RTN","LR7OGM",84,0)
 S I=IDT,CNIDT=0 F  S I=$O(^LR(LRDFN,"CH",I),DIRECT) Q:'I  S CNIDT=I Q
"RTN","LR7OGM",85,0)
 S I=IDT,MNIDT=0 F  S I=$O(^LR(LRDFN,"MI",I),DIRECT) Q:'I  S MNIDT=I Q
"RTN","LR7OGM",86,0)
 S AVAIL="NONE"
"RTN","LR7OGM",87,0)
 I CNIDT,CNIDT'>EDT D
"RTN","LR7OGM",88,0)
 . S AVAIL="CH" I MNIDT,MNIDT'>EDT S AVAIL="BOTH"
"RTN","LR7OGM",89,0)
 E  I MNIDT,MNIDT'>EDT S AVAIL="MI"
"RTN","LR7OGM",90,0)
 I DIRECT=-1 S AVAIL="BOTH"
"RTN","LR7OGM",91,0)
 S ROUTE="NONE"
"RTN","LR7OGM",92,0)
 I ASK="BOTH" S ROUTE=AVAIL
"RTN","LR7OGM",93,0)
 I ASK="CH",AVAIL="CH"!(AVAIL="BOTH") S ROUTE="CH"
"RTN","LR7OGM",94,0)
 I ASK="MI",AVAIL="MI"!(AVAIL="BOTH") S ROUTE="MI"
"RTN","LR7OGM",95,0)
 I MICROCHK=-1 S ROUTE="MI"
"RTN","LR7OGM",96,0)
 I ROUTE="NONE" D  Q
"RTN","LR7OGM",97,0)
 . K ^TMP("LR7OG",$J)
"RTN","LR7OGM",98,0)
 ;
"RTN","LR7OGM",99,0)
 ; Print "printed at" header on start of report.
"RTN","LR7OGM",100,0)
 I 'FORMAT,$$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")>1 D PFAC^LR7OGMP
"RTN","LR7OGM",101,0)
 ;
"RTN","LR7OGM",102,0)
 I ROUTE="CH" D  Q
"RTN","LR7OGM",103,0)
 . F  S IDT=$O(^LR(LRDFN,"CH",IDT),DIRECT) Q:IDT<1  Q:IDT>EDT  D  Q:DONE
"RTN","LR7OGM",104,0)
 . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",105,0)
 . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",106,0)
 . I 'FORMAT,$D(^TMP("LRPLS",$J)) D PLS^LR7OGMP
"RTN","LR7OGM",107,0)
 . K ^TMP("LR7OG",$J),^TMP("LRPLS",$J)
"RTN","LR7OGM",108,0)
 ;
"RTN","LR7OGM",109,0)
 I ROUTE="MI" D  Q
"RTN","LR7OGM",110,0)
 . F  S IDT=$O(^LR(LRDFN,"MI",IDT),DIRECT) Q:IDT<1  Q:IDT>EDT  D  Q:DONE
"RTN","LR7OGM",111,0)
 . . D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",112,0)
 . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",113,0)
 . K ^TMP("LR7OG",$J)
"RTN","LR7OGM",114,0)
 F  D  Q:DONE
"RTN","LR7OGM",115,0)
 . S I=IDT,CNIDT=0 F  S I=$O(^LR(LRDFN,"CH",I),DIRECT) Q:'I  S CNIDT=I Q
"RTN","LR7OGM",116,0)
 . S I=IDT,MNIDT=0 F  S I=$O(^LR(LRDFN,"MI",I),DIRECT) Q:'I  S MNIDT=I Q
"RTN","LR7OGM",117,0)
 . I 'CNIDT,'MNIDT S DONE=1 Q
"RTN","LR7OGM",118,0)
 . D  I IDT>EDT S DONE=1 Q
"RTN","LR7OGM",119,0)
 . . I CNIDT=MNIDT D  Q  ; both chem and micro at this date/time
"RTN","LR7OGM",120,0)
 . . . S IDT=CNIDT
"RTN","LR7OGM",121,0)
 . . . I IDT'>EDT D
"RTN","LR7OGM",122,0)
 . . . . I FORMAT D  Q
"RTN","LR7OGM",123,0)
 . . . . . I SDT=(9999999-2700101)!(DIRECT=-1) D  Q
"RTN","LR7OGM",124,0)
 . . . . . . D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",125,0)
 . . . . . . I SKIP S SKIP=0 D  Q
"RTN","LR7OGM",126,0)
 . . . . . . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",127,0)
 . . . . . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",128,0)
 . . . . . . . I $P(NEWOLD,U),$P(NEWOLD,U)'=IDT D  Q
"RTN","LR7OGM",129,0)
 . . . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",130,0)
 . . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",131,0)
 . . . . . . ;LR 523 Check if a CH test at same date/time is displayable
"RTN","LR7OGM",132,0)
 . . . . . . ; necessary to correctly enable/disable NEXT button
"RTN","LR7OGM",133,0)
 . . . . . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,4,.DONE,.SKIP)
"RTN","LR7OGM",134,0)
 . . . . . . I SKIP S SKIP=0,$P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=($S(DIRECT=-1:1,1:2)) Q
"RTN","LR7OGM",135,0)
 . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",136,0)
 . . . . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",137,0)
 . . . . . I SKIP S SKIP=0 D  Q
"RTN","LR7OGM",138,0)
 . . . . . . D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",139,0)
 . . . . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",140,0)
 . . . . . . I $P(NEWOLD,U),$P(NEWOLD,U)'=IDT D  Q
"RTN","LR7OGM",141,0)
 . . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",142,0)
 . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",143,0)
 . . . . . I $P(NEWOLD,U),$P(NEWOLD,U)'=IDT D  Q
"RTN","LR7OGM",144,0)
 . . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=2
"RTN","LR7OGM",145,0)
 . . . . . S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=2
"RTN","LR7OGM",146,0)
 . . . . I MICROCHK'=1 D  Q:DONE
"RTN","LR7OGM",147,0)
 . . . . . D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",148,0)
 . . . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",149,0)
 . . . . . I FORMAT S MICROCHK=1
"RTN","LR7OGM",150,0)
 . . . . D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",151,0)
 . . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",152,0)
 . . I 'MNIDT D  Q  ; no micro since this date/time, only chem at this date/time
"RTN","LR7OGM",153,0)
 . . . S IDT=CNIDT
"RTN","LR7OGM",154,0)
 . . . I IDT'>EDT D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",155,0)
 . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",156,0)
 . . I 'CNIDT D  Q  ; no chem since this date/time, only micro at this date/time
"RTN","LR7OGM",157,0)
 . . . S IDT=MNIDT
"RTN","LR7OGM",158,0)
 . . . I IDT'>EDT D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",159,0)
 . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",160,0)
 . . I (DIRECT=1&(CNIDT<MNIDT))!(DIRECT=-1&(CNIDT>MNIDT)) D  Q  ;chem and micro data, chem is more recent
"RTN","LR7OGM",161,0)
 . . . S IDT=CNIDT
"RTN","LR7OGM",162,0)
 . . . I IDT'>EDT D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",163,0)
 . . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",164,0)
 . . S IDT=MNIDT
"RTN","LR7OGM",165,0)
 . . I IDT'>EDT D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE,.SKIP)
"RTN","LR7OGM",166,0)
 . . I SKIP S SKIP=0 Q
"RTN","LR7OGM",167,0)
 ;
"RTN","LR7OGM",168,0)
 I 'FORMAT,$D(^TMP("LRPLS",$J)) D PLS^LR7OGMP
"RTN","LR7OGM",169,0)
 ;
"RTN","LR7OGM",170,0)
 K ^TMP("LR7OG",$J),^TMP("LRPLS",$J),^TMP("LRPLS-ADDR",$J)
"RTN","LR7OGM",171,0)
 Q
"RTN","LR7OGMC")
0^2^B38181513^B37375586
"RTN","LR7OGMC",1,0)
LR7OGMC ;DALOI/STAFF- Interim report rpc memo chem ;11/19/09  17:59
"RTN","LR7OGMC",2,0)
 ;;5.2;LAB SERVICE;**187,230,312,286,356,372,395,350,516,523**;Sep 27, 1994;Build 4
"RTN","LR7OGMC",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","LR7OGMC",4,0)
 ;
"RTN","LR7OGMC",5,0)
 ; sets lab data into ^TMP("LR7OG",$J,"TP"
"RTN","LR7OGMC",6,0)
 ; ^TMP("LR7OG",$J,"G")=dfn^pnm^lrdfn^age^sex^lrcw
"RTN","LR7OGMC",7,0)
 ; ^TMP("LR7OG",$J,"TMP",LR Subscript)=ifn of test from 60
"RTN","LR7OGMC",8,0)
 ; ^TMP("LR7OG",$J,"T",ifn 60)=^LAB(60,IFN,0)
"RTN","LR7OGMC",9,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time)=zero node from data
"RTN","LR7OGMC",10,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,printorder)=test#^name^printname^^printcode^dataname^result^flag^units^range^performing site
"RTN","LR7OGMC",11,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,printorder,#)=interpretation
"RTN","LR7OGMC",12,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,"C",#)=comment
"RTN","LR7OGMC",13,0)
 ; ALL = 1 when coming from INTERIMG^LR7OGM (Most Recent)
"RTN","LR7OGMC",14,0)
 ;
"RTN","LR7OGMC",15,0)
 ;
"RTN","LR7OGMC",16,0)
CH(LRDFN,IDT,ALL,OUTCNT,FORMAT,DONE,SKIP) ; from LR7OGM
"RTN","LR7OGMC",17,0)
 N ACC,AREA,ACDT,CDT,CHSUB,CMNT,GOTNP,INTP,LABSUB,LRAAT,LRAD,NUM,PNODE
"RTN","LR7OGMC",18,0)
 N PORDER,SPEC,TCNT,TESTNUM,TESTSUB,UID,ZERO
"RTN","LR7OGMC",19,0)
 ;
"RTN","LR7OGMC",20,0)
 S GOTNP=0,ZERO=$G(^LR(LRDFN,"CH",IDT,0)),UID=$P($G(^("ORU")),"^")
"RTN","LR7OGMC",21,0)
 I UID'="" S UID=$$CHECKUID^LRWU4(UID)
"RTN","LR7OGMC",22,0)
 S AREA=$P(UID,"^",2),ACDT=$P(UID,"^",3),NUM=$P(UID,"^",4)
"RTN","LR7OGMC",23,0)
 S CDT=+ZERO,LABSUB="CH",TCNT=0,SPEC=$P(ZERO,U,5)
"RTN","LR7OGMC",24,0)
 ;
"RTN","LR7OGMC",25,0)
 D GETNP ;Check for NP comments
"RTN","LR7OGMC",26,0)
 I FORMAT,GOTNP S SKIP=1 Q
"RTN","LR7OGMC",27,0)
 I GOTNP,'$P(ZERO,U,3) D  Q
"RTN","LR7OGMC",28,0)
 . D ACC:UID
"RTN","LR7OGMC",29,0)
 . I $O(^TMP("LR7OG",$J,"TP",CDT,0)) K:FORMAT ^TMP("LR7OG",$J,"TP",CDT) D CHKNP Q
"RTN","LR7OGMC",30,0)
 ;
"RTN","LR7OGMC",31,0)
 D ACC:UID,VER
"RTN","LR7OGMC",32,0)
 I '$O(^TMP("LR7OG",$J,"TP",CDT,0)) S SKIP=1 Q
"RTN","LR7OGMC",33,0)
 I '$O(^LR(LRDFN,"CH",IDT,1)) D CHKNP
"RTN","LR7OGMC",34,0)
 ;
"RTN","LR7OGMC",35,0)
 ;LR 523 quit out when only calling for info only for LR7OGM
"RTN","LR7OGMC",36,0)
 I FORMAT=4 Q
"RTN","LR7OGMC",37,0)
 ;
"RTN","LR7OGMC",38,0)
 I FORMAT D
"RTN","LR7OGMC",39,0)
 . S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)="0^CH^"_(9999999-IDT)
"RTN","LR7OGMC",40,0)
 . S OUTCNT=OUTCNT+1,DONE=1
"RTN","LR7OGMC",41,0)
 . I 'GOTNP D GRID^LR7OGMG(.OUTCNT)
"RTN","LR7OGMC",42,0)
 ;
"RTN","LR7OGMC",43,0)
 I 'FORMAT D PRINT^LR7OGMP(.OUTCNT)
"RTN","LR7OGMC",44,0)
 ;
"RTN","LR7OGMC",45,0)
 K ^TMP("LR7OG",$J,"TP")
"RTN","LR7OGMC",46,0)
 ;
"RTN","LR7OGMC",47,0)
 Q
"RTN","LR7OGMC",48,0)
 ;
"RTN","LR7OGMC",49,0)
 ;
"RTN","LR7OGMC",50,0)
ACC ;Check Accession
"RTN","LR7OGMC",51,0)
 N ANODE,X0,LRODT,LRSN,LROD0,LROD1,X,STATUS,LROS
"RTN","LR7OGMC",52,0)
 ;
"RTN","LR7OGMC",53,0)
 K ^TMP("LR7OG",$J,"ACC")
"RTN","LR7OGMC",54,0)
 ;
"RTN","LR7OGMC",55,0)
 I '$D(^LRO(68,+AREA,1,+ACDT,1,+NUM)) Q
"RTN","LR7OGMC",56,0)
 ;
"RTN","LR7OGMC",57,0)
 S X0=$G(^LRO(68,+AREA,1,+ACDT,1,+NUM,0)),LRODT=$P(X0,"^",4),LRSN=$P(X0,"^",5),LROD0=$G(^LRO(69,+LRODT,1,LRSN,0)),LROD1=$G(^(1))
"RTN","LR7OGMC",58,0)
 ;
"RTN","LR7OGMC",59,0)
 S TESTNUM=0
"RTN","LR7OGMC",60,0)
 F  S TESTNUM=$O(^LRO(68,+AREA,1,+ACDT,1,+NUM,4,TESTNUM)) Q:'TESTNUM  S ANODE=^(TESTNUM,0) D
"RTN","LR7OGMC",61,0)
 . I $P(ANODE,U,6)'="*Not Performed" Q:$P(ANODE,U,5)  ;complete date
"RTN","LR7OGMC",62,0)
 . I FORMAT,$P(ANODE,U,6)="*Not Performed" Q  ;Don't show NP'd results on Most Recent Report
"RTN","LR7OGMC",63,0)
 . I 'ALL,'$D(^TMP("LR7OG",$J,"T",TESTNUM)),'$D(TESTS(TESTNUM)) Q  ;Selected test not in accession
"RTN","LR7OGMC",64,0)
 . I TESTNUM'=$P(ANODE,"^",9),$P($G(^LRO(68,+AREA,1,+ACDT,1,+NUM,4,+$P(ANODE,"^",9),0)),"^",5) Q  ;complete date on parent
"RTN","LR7OGMC",65,0)
 . S ^TMP("LR7OG",$J,"ACC",TESTNUM)=ANODE
"RTN","LR7OGMC",66,0)
 ;
"RTN","LR7OGMC",67,0)
 I '$O(^TMP("LR7OG",$J,"ACC",0)) Q
"RTN","LR7OGMC",68,0)
 ;
"RTN","LR7OGMC",69,0)
 S TESTNUM=0
"RTN","LR7OGMC",70,0)
 F  S TESTNUM=$O(^TMP("LR7OG",$J,"ACC",TESTNUM)) Q:'TESTNUM  S ANODE=^(TESTNUM) D
"RTN","LR7OGMC",71,0)
 . Q:'$D(^LAB(60,TESTNUM,.1))  S PNODE=^(.1) I '("BO"[$P($G(^(0)),U,3)) Q
"RTN","LR7OGMC",72,0)
 . S PORDER=$P(PNODE,U,6),PORDER=$S(PORDER:PORDER,1:1/1000000)
"RTN","LR7OGMC",73,0)
 . F  Q:'$D(^TMP("LR7OG",$J,"TP",CDT,PORDER))  Q:TESTNUM=+^(PORDER)  S PORDER=PORDER+1
"RTN","LR7OGMC",74,0)
 . I $D(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q
"RTN","LR7OGMC",75,0)
 . S LROS="Collected - Specimen In Lab"
"RTN","LR7OGMC",76,0)
 . I LROD1'="" S X=$P(LROD1,U,4),LROS=$S(X="C":"Collected - Specimen In Lab",X="U":"Uncollected, cancelled",1:"On Collection List")
"RTN","LR7OGMC",77,0)
 . S STATUS=$S($P(ANODE,"^",6)="*Not Performed":"Test Not Performed",1:LROS)
"RTN","LR7OGMC",78,0)
 . S ^TMP("LR7OG",$J,"TP",CDT,PORDER)=TESTNUM_U_$P(^LAB(60,TESTNUM,0),U)_U_$P(PNODE,U)_U_$P(PNODE,U,2)_U_"X"_U_$P(^(0),U,5)_U_STATUS
"RTN","LR7OGMC",79,0)
 . S TCNT=TCNT+1
"RTN","LR7OGMC",80,0)
 ;
"RTN","LR7OGMC",81,0)
 K ^TMP("LR7OG",$J,"ACC")
"RTN","LR7OGMC",82,0)
 I TCNT S ^TMP("LR7OG",$J,"TP",CDT)=ZERO
"RTN","LR7OGMC",83,0)
 ;
"RTN","LR7OGMC",84,0)
 Q
"RTN","LR7OGMC",85,0)
 ;
"RTN","LR7OGMC",86,0)
 ;
"RTN","LR7OGMC",87,0)
VER ; Check Verified Results
"RTN","LR7OGMC",88,0)
 Q:'$P(ZERO,U,3)
"RTN","LR7OGMC",89,0)
 ;
"RTN","LR7OGMC",90,0)
 I ALL D
"RTN","LR7OGMC",91,0)
 . S TESTSUB=1
"RTN","LR7OGMC",92,0)
 . F  S TESTSUB=$O(^LR(LRDFN,"CH",IDT,TESTSUB)) Q:TESTSUB<1  S TESTNUM=$O(^LAB(60,"C","CH;"_TESTSUB_";1",0)) D CHSETUP
"RTN","LR7OGMC",93,0)
 ;
"RTN","LR7OGMC",94,0)
 I 'ALL D
"RTN","LR7OGMC",95,0)
 . S TESTSUB=1
"RTN","LR7OGMC",96,0)
 . F  S TESTSUB=$O(^TMP("LR7OG",$J,"TMP",TESTSUB)) Q:TESTSUB<1  S TESTNUM=+^(TESTSUB) D CHSETUP
"RTN","LR7OGMC",97,0)
 ;
"RTN","LR7OGMC",98,0)
 I TCNT D
"RTN","LR7OGMC",99,0)
 . S ^TMP("LR7OG",$J,"TP",CDT)=ZERO,CMNT=0
"RTN","LR7OGMC",100,0)
 . F  S CMNT=+$O(^LR(LRDFN,LABSUB,IDT,1,CMNT)) Q:CMNT<1  S ^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)=^(CMNT,0) S TCNT=TCNT+1
"RTN","LR7OGMC",101,0)
 Q
"RTN","LR7OGMC",102,0)
 ;
"RTN","LR7OGMC",103,0)
 ;
"RTN","LR7OGMC",104,0)
CHSETUP ; within scope of CH
"RTN","LR7OGMC",105,0)
 ;
"RTN","LR7OGMC",106,0)
 N LRX
"RTN","LR7OGMC",107,0)
 I 'TESTNUM Q
"RTN","LR7OGMC",108,0)
 Q:'$D(^LAB(60,TESTNUM,.1))  S PNODE=^(.1) I '("BO"[$P($G(^(0)),U,3)) Q
"RTN","LR7OGMC",109,0)
 Q:'$D(^LR(LRDFN,LABSUB,IDT,TESTSUB))  Q:'$L($P(^(TESTSUB),U))
"RTN","LR7OGMC",110,0)
 ;
"RTN","LR7OGMC",111,0)
 S PORDER=$P(PNODE,U,6),PORDER=$S(PORDER:PORDER,1:TESTSUB/1000000)
"RTN","LR7OGMC",112,0)
 F  Q:'$D(^TMP("LR7OG",$J,"TP",CDT,PORDER))  Q:TESTNUM=+^(PORDER)  S PORDER=PORDER+1
"RTN","LR7OGMC",113,0)
 ;
"RTN","LR7OGMC",114,0)
 I $D(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q
"RTN","LR7OGMC",115,0)
 ;
"RTN","LR7OGMC",116,0)
 S LRX=$$TSTRES^LRRPU(LRDFN,LABSUB,IDT,TESTSUB,TESTNUM)
"RTN","LR7OGMC",117,0)
 S ^TMP("LR7OG",$J,"TP",CDT,PORDER)=TESTNUM_U_$P(^LAB(60,TESTNUM,0),U)_U_$P(PNODE,U)_U_$P(PNODE,U,2)_U_$P(PNODE,U,3)_U_$P(^(0),U,5)_U_$P(LRX,U)_U_$P(LRX,U,2)_U_$P(LRX,U,5)_U_$$EN^LRLRRVF($P(LRX,U,3),$P(LRX,U,4))_U_$P(LRX,U,6)
"RTN","LR7OGMC",118,0)
 ;
"RTN","LR7OGMC",119,0)
 ; Save performing lab ien in list
"RTN","LR7OGMC",120,0)
 I $P(LRX,U,6) S ^TMP("LRPLS",$J,$P(LRX,U,6))=""
"RTN","LR7OGMC",121,0)
 ;
"RTN","LR7OGMC",122,0)
 S TCNT=TCNT+1
"RTN","LR7OGMC",123,0)
 I $D(^LAB(60,TESTNUM,1,SPEC,1,0)) D
"RTN","LR7OGMC",124,0)
 . S INTP=0
"RTN","LR7OGMC",125,0)
 . F  S INTP=+$O(^LAB(60,TESTNUM,1,SPEC,1,INTP)) Q:INTP<1  D
"RTN","LR7OGMC",126,0)
 . . S ^TMP("LR7OG",$J,"TP",CDT,PORDER,INTP)=^(INTP,0)
"RTN","LR7OGMC",127,0)
 . . S TCNT=TCNT+1
"RTN","LR7OGMC",128,0)
 Q
"RTN","LR7OGMC",129,0)
 ;
"RTN","LR7OGMC",130,0)
 ;
"RTN","LR7OGMC",131,0)
CMT ; Retrieve specimen comments
"RTN","LR7OGMC",132,0)
 ;
"RTN","LR7OGMC",133,0)
 S ^TMP("LR7OG",$J,"TP",CDT)=ZERO,CMNT=0
"RTN","LR7OGMC",134,0)
 F  S CMNT=+$O(^LR(LRDFN,LABSUB,IDT,1,CMNT)) Q:CMNT<1  S ^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)=^(CMNT,0) S TCNT=TCNT+1
"RTN","LR7OGMC",135,0)
 ;
"RTN","LR7OGMC",136,0)
 Q
"RTN","LR7OGMC",137,0)
 ;
"RTN","LR7OGMC",138,0)
 ;
"RTN","LR7OGMC",139,0)
CHKNP ; Check for NP comments and no verified results.
"RTN","LR7OGMC",140,0)
 ;
"RTN","LR7OGMC",141,0)
 N LRCAN,X
"RTN","LR7OGMC",142,0)
 S LRCAN=0
"RTN","LR7OGMC",143,0)
 ;*LR*5.2*516
"RTN","LR7OGMC",144,0)
 ;F  S LRCAN=+$O(^LR(LRDFN,"CH",IDT,1,LRCAN)) Q:LRCAN<1  S X=^(LRCAN,0) Q:(($E(X)="*")&(X["Not Performed:"))
"RTN","LR7OGMC",145,0)
 ;
"RTN","LR7OGMC",146,0)
 ; Print if cancel comment and no unverified results.
"RTN","LR7OGMC",147,0)
 ;I LRCAN<1 Q
"RTN","LR7OGMC",148,0)
 N LRTOTO,LRNPCNT
"RTN","LR7OGMC",149,0)
 S LRTOTO=$P($G(^LR(LRDFN,"CH",IDT,"ORUT",0)),U,4) ;total number of orders
"RTN","LR7OGMC",150,0)
 S LRNPCNT=0
"RTN","LR7OGMC",151,0)
 F  S LRCAN=+$O(^LR(LRDFN,"CH",IDT,1,LRCAN)) Q:LRCAN<1  D
"RTN","LR7OGMC",152,0)
 . S X=^(LRCAN,0)
"RTN","LR7OGMC",153,0)
 . I (($E(X)="*")&(X["Not Performed:")) S LRNPCNT=LRNPCNT+1
"RTN","LR7OGMC",154,0)
 ;quit if all orders are marked Not performed:
"RTN","LR7OGMC",155,0)
 I FORMAT!(LRTOTO=LRNPCNT) Q
"RTN","LR7OGMC",156,0)
 ;
"RTN","LR7OGMC",157,0)
 D CMT
"RTN","LR7OGMC",158,0)
 D PRINT^LR7OGMP(.OUTCNT)
"RTN","LR7OGMC",159,0)
 K ^TMP("LR7OG",$J,"TP")
"RTN","LR7OGMC",160,0)
 Q
"RTN","LR7OGMC",161,0)
 ;
"RTN","LR7OGMC",162,0)
 ;
"RTN","LR7OGMC",163,0)
GETNP ;Set NP flag (Not Performed)
"RTN","LR7OGMC",164,0)
 N LRCAN,X
"RTN","LR7OGMC",165,0)
 S LRCAN=0
"RTN","LR7OGMC",166,0)
 ;*LR*5.2*516
"RTN","LR7OGMC",167,0)
 ;F  S LRCAN=+$O(^LR(LRDFN,"CH",IDT,1,LRCAN)) Q:LRCAN<1  S X=^(LRCAN,0) Q:(($E(X)="*")&(X["Not Performed:"))
"RTN","LR7OGMC",168,0)
 ;Q:LRCAN<1
"RTN","LR7OGMC",169,0)
 S LRTOTO=$P($G(^LR(LRDFN,"CH",IDT,"ORUT",0)),U,4) ;total number of orders
"RTN","LR7OGMC",170,0)
 S LRNPCNT=0
"RTN","LR7OGMC",171,0)
 F  S LRCAN=+$O(^LR(LRDFN,"CH",IDT,1,LRCAN)) Q:LRCAN<1  D
"RTN","LR7OGMC",172,0)
 . S X=^(LRCAN,0)
"RTN","LR7OGMC",173,0)
 . I (($E(X)="*")&(X["Not Performed:")) S LRNPCNT=LRNPCNT+1
"RTN","LR7OGMC",174,0)
 ;quit if not all orders are marked Not performed:
"RTN","LR7OGMC",175,0)
 I LRTOTO'=LRNPCNT Q
"RTN","LR7OGMC",176,0)
 I $G(FORMAT) Q:$O(^LR(LRDFN,"CH",IDT,1))
"RTN","LR7OGMC",177,0)
 S GOTNP=1
"RTN","LR7OGMC",178,0)
 Q
"VER")
8.0^22.2
"BLD",11148,6)
^425
**END**
**END**

