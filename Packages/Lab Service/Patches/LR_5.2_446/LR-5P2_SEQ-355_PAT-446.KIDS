Released LR*5.2*446 SEQ #355
Extracted from mail message
**KIDS**:LR*5.2*446^

**INSTALL NAME**
LR*5.2*446
"BLD",9706,0)
LR*5.2*446^LAB SERVICE^0^3140723^y
"BLD",9706,1,0)
^^7^7^3140723^^^
"BLD",9706,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package:
"BLD",9706,1,2,0)
 
"BLD",9706,1,3,0)
1.      Semi-colon in lab test name prevents results entry.
"BLD",9706,1,4,0)
 
"BLD",9706,1,5,0)
2.      Confusing times in phlebotomy log.
"BLD",9706,1,6,0)
 
"BLD",9706,1,7,0)
3.      No warnings when panel test can't be accessioned.
"BLD",9706,4,0)
^9.64PA^^
"BLD",9706,6.3)
1
"BLD",9706,"ABPKG")
n
"BLD",9706,"KRN",0)
^9.67PA^779.2^20
"BLD",9706,"KRN",.4,0)
.4
"BLD",9706,"KRN",.401,0)
.401
"BLD",9706,"KRN",.402,0)
.402
"BLD",9706,"KRN",.403,0)
.403
"BLD",9706,"KRN",.5,0)
.5
"BLD",9706,"KRN",.84,0)
.84
"BLD",9706,"KRN",3.6,0)
3.6
"BLD",9706,"KRN",3.8,0)
3.8
"BLD",9706,"KRN",9.2,0)
9.2
"BLD",9706,"KRN",9.8,0)
9.8
"BLD",9706,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",9706,"KRN",9.8,"NM",1,0)
LRGP2^^0^B20236690
"BLD",9706,"KRN",9.8,"NM",2,0)
LRHYB^^0^B41402354
"BLD",9706,"KRN",9.8,"NM",3,0)
LRHY0^^0^B38508481
"BLD",9706,"KRN",9.8,"NM",4,0)
LRHY01^^0^B41628624
"BLD",9706,"KRN",9.8,"NM",5,0)
LRHYA^^0^B29657209
"BLD",9706,"KRN",9.8,"NM",6,0)
LRHYBC1^^0^B68703748
"BLD",9706,"KRN",9.8,"NM","B","LRGP2",1)

"BLD",9706,"KRN",9.8,"NM","B","LRHY0",3)

"BLD",9706,"KRN",9.8,"NM","B","LRHY01",4)

"BLD",9706,"KRN",9.8,"NM","B","LRHYA",5)

"BLD",9706,"KRN",9.8,"NM","B","LRHYB",2)

"BLD",9706,"KRN",9.8,"NM","B","LRHYBC1",6)

"BLD",9706,"KRN",19,0)
19
"BLD",9706,"KRN",19,"NM",0)
^9.68A^^
"BLD",9706,"KRN",19.1,0)
19.1
"BLD",9706,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9706,"KRN",101,0)
101
"BLD",9706,"KRN",101,"NM",0)
^9.68A^^
"BLD",9706,"KRN",409.61,0)
409.61
"BLD",9706,"KRN",771,0)
771
"BLD",9706,"KRN",779.2,0)
779.2
"BLD",9706,"KRN",870,0)
870
"BLD",9706,"KRN",8989.51,0)
8989.51
"BLD",9706,"KRN",8989.52,0)
8989.52
"BLD",9706,"KRN",8994,0)
8994
"BLD",9706,"KRN","B",.4,.4)

"BLD",9706,"KRN","B",.401,.401)

"BLD",9706,"KRN","B",.402,.402)

"BLD",9706,"KRN","B",.403,.403)

"BLD",9706,"KRN","B",.5,.5)

"BLD",9706,"KRN","B",.84,.84)

"BLD",9706,"KRN","B",3.6,3.6)

"BLD",9706,"KRN","B",3.8,3.8)

"BLD",9706,"KRN","B",9.2,9.2)

"BLD",9706,"KRN","B",9.8,9.8)

"BLD",9706,"KRN","B",19,19)

"BLD",9706,"KRN","B",19.1,19.1)

"BLD",9706,"KRN","B",101,101)

"BLD",9706,"KRN","B",409.61,409.61)

"BLD",9706,"KRN","B",771,771)

"BLD",9706,"KRN","B",779.2,779.2)

"BLD",9706,"KRN","B",870,870)

"BLD",9706,"KRN","B",8989.51,8989.51)

"BLD",9706,"KRN","B",8989.52,8989.52)

"BLD",9706,"KRN","B",8994,8994)

"BLD",9706,"QUES",0)
^9.62^^
"BLD",9706,"REQB",0)
^9.611^5^5
"BLD",9706,"REQB",1,0)
LR*5.2*350^2
"BLD",9706,"REQB",2,0)
LR*5.2*430^2
"BLD",9706,"REQB",3,0)
LR*5.2*405^2
"BLD",9706,"REQB",4,0)
LR*5.2*417^2
"BLD",9706,"REQB",5,0)
LR*5.2*435^2
"BLD",9706,"REQB","B","LR*5.2*350",1)

"BLD",9706,"REQB","B","LR*5.2*405",3)

"BLD",9706,"REQB","B","LR*5.2*417",4)

"BLD",9706,"REQB","B","LR*5.2*430",2)

"BLD",9706,"REQB","B","LR*5.2*435",5)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
446^3140723
"PKG",26,22,1,"PAH",1,1,0)
^^7^7^3140723
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package:
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1.      Semi-colon in lab test name prevents results entry.
"PKG",26,22,1,"PAH",1,1,4,0)
 
"PKG",26,22,1,"PAH",1,1,5,0)
2.      Confusing times in phlebotomy log.
"PKG",26,22,1,"PAH",1,1,6,0)
 
"PKG",26,22,1,"PAH",1,1,7,0)
3.      No warnings when panel test can't be accessioned.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","LRGP2")
0^1^B20236690^B20133526
"RTN","LRGP2",1,0)
LRGP2 ;DALOI/STAFF - COMMON PARTS TO INSTRUMENT GROUP VERIFY/CHECK ;11/18/11  15:52
"RTN","LRGP2",2,0)
 ;;5.2;LAB SERVICE;**153,221,263,290,350,446**;Sep 27, 1994;Build 1
"RTN","LRGP2",3,0)
 ;
"RTN","LRGP2",4,0)
 Q
"RTN","LRGP2",5,0)
 ;
"RTN","LRGP2",6,0)
 ;
"RTN","LRGP2",7,0)
EXPLODE ; from LRGP1, LRVR
"RTN","LRGP2",8,0)
 N %,C,DIC,DIR,DIROUT,DIRUT,DUOUT,LREND,LRI,LRTEST,LRX,I,X,X1,Y
"RTN","LRGP2",9,0)
 I $G(LRORDR)'="P" K ^TMP("LR",$J)
"RTN","LRGP2",10,0)
 S LRCFL="",LRI=0 S:'$D(LRNX) LRNX=0
"RTN","LRGP2",11,0)
 F  S LRI=$O(^LRO(68.2,LRLL,10,LRPROF,1,LRI)) Q:LRI<1  I $D(^(LRI,0))#2 D
"RTN","LRGP2",12,0)
 . S LRI(0)=$G(^LRO(68.2,LRLL,10,LRPROF,1,LRI,0))
"RTN","LRGP2",13,0)
 . S LRX=$P(LRI(0),"^") K LRTEST
"RTN","LRGP2",14,0)
 . I '$P(LRI(0),U,3) D EX6(LRX)
"RTN","LRGP2",15,0)
 . S:'$D(^TMP("LR",$J,"VTO",LRX))#2 ^(LRX)=""
"RTN","LRGP2",16,0)
 K LRVTS S LRVTS=11,LRI=0
"RTN","LRGP2",17,0)
 F  S LRI=+$O(^TMP("LR",$J,"T",LRI)) Q:LRI<1  D
"RTN","LRGP2",18,0)
 . S X=$P(^TMP("LR",$J,"T",LRI),"^",5)
"RTN","LRGP2",19,0)
 . I $P(X,";",2)<1 Q  ; Invalid data name number
"RTN","LRGP2",20,0)
 . S LRVTS($P(X,";",2))=LRI,LRVTS=LRVTS+1
"RTN","LRGP2",21,0)
 . S ^TMP("LR",$J,"VTO",LRI)=$P(X,";",2)
"RTN","LRGP2",22,0)
 Q:$G(LRORDR)="P"
"RTN","LRGP2",23,0)
EX3 ;
"RTN","LRGP2",24,0)
 G:$G(LREND) STOP
"RTN","LRGP2",25,0)
 ;
"RTN","LRGP2",26,0)
 K DIR,DIROUT,DIRUT,DUOUT,X,Y
"RTN","LRGP2",27,0)
 S DIR(0)="YO",DIR("A")="Would you like to see the test list",DIR("B")="No"
"RTN","LRGP2",28,0)
 D ^DIR
"RTN","LRGP2",29,0)
 I $S($G(DIRUT):1,$G(LREND):1,1:0) K ^TMP("LR",$J),LRVTS Q
"RTN","LRGP2",30,0)
 I Y=1 D
"RTN","LRGP2",31,0)
 . W @IOF,!,"The ("_$P(^LRO(68.2,LRLL,0),U)_") ["_$P(^LRO(68.2,LRLL,10,LRPROF,0),U)_"] Profile has"
"RTN","LRGP2",32,0)
 . D LIST
"RTN","LRGP2",33,0)
 ;
"RTN","LRGP2",34,0)
 K DIR,DIROUT,DIRUT,DUOUT,X,Y
"RTN","LRGP2",35,0)
 S DIR("A",1)=" "
"RTN","LRGP2",36,0)
 S DIR("A")="Do you wish to modify the test list"
"RTN","LRGP2",37,0)
 S DIR("?")="i.e. would you like to add or subtract ATOMIC tests?"
"RTN","LRGP2",38,0)
 S DIR("B")="NO"
"RTN","LRGP2",39,0)
 S DIR(0)="Y" D ^DIR
"RTN","LRGP2",40,0)
 I $D(DIRUT) S LREND=1 G STOP
"RTN","LRGP2",41,0)
 I Y=1 D EX1 G:'$G(LREND) EX3
"RTN","LRGP2",42,0)
 ;
"RTN","LRGP2",43,0)
STOP ;
"RTN","LRGP2",44,0)
 I $G(LREND) K ^TMP("LR",$J),LRVTS S LREND=0 Q
"RTN","LRGP2",45,0)
 ;
"RTN","LRGP2",46,0)
EX2 ;
"RTN","LRGP2",47,0)
 K LRVTS,DIC
"RTN","LRGP2",48,0)
 S LRVTS=11,LRI=0,C=0
"RTN","LRGP2",49,0)
 F  S LRI=$O(^TMP("LR",$J,"T",LRI)) Q:LRI<1  D
"RTN","LRGP2",50,0)
 . S X=$P(^TMP("LR",$J,"T",LRI),U,5),LRVTS($P(X,";",2))=LRI
"RTN","LRGP2",51,0)
 . S LRVTS=LRVTS+1
"RTN","LRGP2",52,0)
 . S ^TMP("LR",$J,"VTO",LRI)=$P(X,";",2)
"RTN","LRGP2",53,0)
 . S C=C+1
"RTN","LRGP2",54,0)
 . I $P($G(^LAB(60,LRI,4)),U,2) S LRCFL=LRCFL_$P(^(4),U,2)_U
"RTN","LRGP2",55,0)
 S (X,X1)=0 F  S X=$O(^TMP("LR",$J,"VTO",X)) Q:X<1  S X1=X1+1
"RTN","LRGP2",56,0)
 I C>0 W !,"You have selected ",X1," tests to work with."
"RTN","LRGP2",57,0)
 I C<1 D
"RTN","LRGP2",58,0)
 . W !,$C(7),">> Please check the PROFILE you have selected."
"RTN","LRGP2",59,0)
 . W !,">> At least one should be build name only = no "
"RTN","LRGP2",60,0)
 K ^TMP("LR",$J,"T")
"RTN","LRGP2",61,0)
 Q
"RTN","LRGP2",62,0)
 ;
"RTN","LRGP2",63,0)
 ;
"RTN","LRGP2",64,0)
EX1 ;
"RTN","LRGP2",65,0)
 N DIC,DIR,DIRUT,DIROUT,DTOUT,X,X1,Y
"RTN","LRGP2",66,0)
 ;
"RTN","LRGP2",67,0)
 S DIR("A")="Do you want to add ATOMIC test(s) to this panel",DIR("B")="NO",DIR(0)="YO"
"RTN","LRGP2",68,0)
 D ^DIR
"RTN","LRGP2",69,0)
 I $D(DIRUT) S LREND=1 Q
"RTN","LRGP2",70,0)
 I Y=1 D
"RTN","LRGP2",71,0)
 . K LRVTS,DIC
"RTN","LRGP2",72,0)
 . S DIC("A")="Select ATOMIC test(s) you wish to add: ",DIC="^LAB(60,",DIC(0)="AEMOQZ" ; ,DIC("S")="I $G(^(.2))"
"RTN","LRGP2",73,0)
 . F  D ^DIC Q:Y<1  K LRTEST D EX6(+Y)
"RTN","LRGP2",74,0)
 . W @IOF,!?5,"The List now has" D LIST
"RTN","LRGP2",75,0)
 ;
"RTN","LRGP2",76,0)
EX4 ;
"RTN","LRGP2",77,0)
 K DIR
"RTN","LRGP2",78,0)
 S DIR("A",1)=" "
"RTN","LRGP2",79,0)
 S DIR("A")="Do you wish to exclude ATOMIC tests in this panel"
"RTN","LRGP2",80,0)
 S DIR("B")="NO",DIR(0)="YO"
"RTN","LRGP2",81,0)
 D ^DIR
"RTN","LRGP2",82,0)
 I $D(DIRUT) S LREND=1 Q
"RTN","LRGP2",83,0)
 I Y=1 D
"RTN","LRGP2",84,0)
 . N LREXCL,%
"RTN","LRGP2",85,0)
 . W !!,$$CJ^XLFSTR("Tests removed from this panel will not be included for review or editing.",IOM),!!
"RTN","LRGP2",86,0)
 . K DIC
"RTN","LRGP2",87,0)
 . S LREXCL="",DIC("A")="Select ATOMIC test(s) you wish to exclude: ",DIC="^LAB(60,",DIC(0)="AEMOQ"
"RTN","LRGP2",88,0)
 . S DIC("S")="I $D(^TMP(""LR"",$J,""T"",Y))"
"RTN","LRGP2",89,0)
 . F  D ^DIC Q:Y<1  D
"RTN","LRGP2",90,0)
 . . S X1=$P($P(^TMP("LR",$J,"T",+Y),U,5),";",2)
"RTN","LRGP2",91,0)
 . . I X1 K LRVTS(X1)
"RTN","LRGP2",92,0)
 . . K ^TMP("LR",$J,"VTO",+Y),^TMP("LR",$J,"T",+Y) S LREXCL(+Y)=$P(Y,U,2) D
"RTN","LRGP2",93,0)
 . . .N I,X
"RTN","LRGP2",94,0)
 . . .S I=0 F  S I=$O(^LAB(60,+Y,2,0)) Q:I<1  I $D(^(I,0)) S X=+^(0) D
"RTN","LRGP2",95,0)
 . . . . I X K ^TMP("LR",$J,"VTO",X),^TMP("LR",$J,"T",X) S LREXCL(X)=$P($G(^LAB(60,X,0)),U)
"RTN","LRGP2",96,0)
 . I $O(LREXCL(0)) D
"RTN","LRGP2",97,0)
 . . N I
"RTN","LRGP2",98,0)
 . . W @IOF,!,"Excluding" S I=0 F  S I=$O(LREXCL(I)) Q:I<1  W !,LREXCL(I) K LRVTS(I) H 2
"RTN","LRGP2",99,0)
 Q
"RTN","LRGP2",100,0)
 ;
"RTN","LRGP2",101,0)
 ;
"RTN","LRGP2",102,0)
LIST ;
"RTN","LRGP2",103,0)
 N LRI,DIR,DIRUT,DTOUT,DUOUT,X
"RTN","LRGP2",104,0)
 W " the following tests: "
"RTN","LRGP2",105,0)
 S LRI=0,DIR(0)="E"
"RTN","LRGP2",106,0)
 F  S LRI=$O(^TMP("LR",$J,"VTO",LRI)) Q:LRI<1!($D(DUOUT))  D
"RTN","LRGP2",107,0)
 . W !,?10,$P($G(^LAB(60,LRI,0)),U)
"RTN","LRGP2",108,0)
 . I $Y>(IOSL-4) W ! D ^DIR W @IOF I $D(DIRUT) S LREND=1
"RTN","LRGP2",109,0)
 Q
"RTN","LRGP2",110,0)
 ;
"RTN","LRGP2",111,0)
 ;
"RTN","LRGP2",112,0)
YESNO ;
"RTN","LRGP2",113,0)
 W !
"RTN","LRGP2",114,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRGP2",115,0)
 S DIR("B")=$S($G(%)=1:"Yes",$G(%)=2:"No",1:"")
"RTN","LRGP2",116,0)
 S DIR(0)="Y" D ^DIR S %=Y
"RTN","LRGP2",117,0)
 Q
"RTN","LRGP2",118,0)
 ;
"RTN","LRGP2",119,0)
 ;
"RTN","LRGP2",120,0)
EX6(LRX) ; Expand test list
"RTN","LRGP2",121,0)
 ;
"RTN","LRGP2",122,0)
 N T1
"RTN","LRGP2",123,0)
 ;
"RTN","LRGP2",124,0)
 S (T1,LRTEST)=LRX,LRTEST(T1)=LRX_U_$G(^LAB(60,T1,0))
"RTN","LRGP2",125,0)
 S LRTEST(T1,"P")=LRTEST
"RTN","LRGP2",126,0)
 D ^LREXPD
"RTN","LRGP2",127,0)
 S:'$D(^TMP("LR",$J,"VTO",LRX))#2 ^(LRX)=""
"RTN","LRGP2",128,0)
 Q
"RTN","LRHY0")
0^3^B38508481^B38320113
"RTN","LRHY0",1,0)
LRHY0 ;DALOI/HOAK - HOWDY MAIN DRIVER ;10/15/10 11:00am
"RTN","LRHY0",2,0)
 ;;5.2;LAB SERVICE;**405,435,446**;Sep 27, 1994;Build 1
"RTN","LRHY0",3,0)
 ;
"RTN","LRHY0",4,0)
PICK ;
"RTN","LRHY0",5,0)
 ;  pick the site from Howdy Site FILE 69.86
"RTN","LRHY0",6,0)
 S LREND=0
"RTN","LRHY0",7,0)
 S DIC(0)="AEMQZ"
"RTN","LRHY0",8,0)
 S DIC=69.86
"RTN","LRHY0",9,0)
 D ^DIC
"RTN","LRHY0",10,0)
 I Y=-1 S LREND=1 QUIT
"RTN","LRHY0",11,0)
 S LRHYSITE=+Y
"RTN","LRHY0",12,0)
 K DIC
"RTN","LRHY0",13,0)
 ;
"RTN","LRHY0",14,0)
 I $G(^LRHY(69.86,LRHYSITE,0))["ALTER" S LRDEV=$O(^%ZIS(1,"B","NULL DEVICE",0)) G ALT
"RTN","LRHY0",15,0)
 ;
"RTN","LRHY0",16,0)
 ; Pick a printer
"RTN","LRHY0",17,0)
 S LRDEV=0
"RTN","LRHY0",18,0)
 K DIC
"RTN","LRHY0",19,0)
 S DIC(0)="EMQZ" K Y S LRHYCT2=1
"RTN","LRHY0",20,0)
 F  S LRDEV=$O(^LRHY(69.86,LRHYSITE,10,"B",LRDEV)) Q:+LRDEV'>0  D
"RTN","LRHY0",21,0)
 .  W !,LRHYCT2,". ",$P(^%ZIS(1,LRDEV,0),U)
"RTN","LRHY0",22,0)
 .  S LRX(LRHYCT2)=LRDEV S LRHYCT2=LRHYCT2+1
"RTN","LRHY0",23,0)
CHOOO W !,"Choose a label printer: " R X:DTIME W !
"RTN","LRHY0",24,0)
 I U[X S LREND=1 QUIT
"RTN","LRHY0",25,0)
 I X="" W !,"NOTHING SELECTED" S LREND=1 H 1 QUIT
"RTN","LRHY0",26,0)
 I '$D(LRX(X)) W !,"NUMBER NOT IN RANGE" H 1 G CHOOO
"RTN","LRHY0",27,0)
 I U[X S LREND=1 QUIT
"RTN","LRHY0",28,0)
 I 'X I $G(X)'="" W !,"enter the number please" G CHOOO
"RTN","LRHY0",29,0)
 S LRDEV=LRX(X)
"RTN","LRHY0",30,0)
 ;
"RTN","LRHY0",31,0)
 ;
"RTN","LRHY0",32,0)
ALT ;
"RTN","LRHY0",33,0)
 W ?11,$P(^%ZIS(1,LRDEV,0),U) H 2
"RTN","LRHY0",34,0)
 K DIC
"RTN","LRHY0",35,0)
 K LRHYCT2
"RTN","LRHY0",36,0)
 D USER^LRHYU
"RTN","LRHY0",37,0)
 ;
"RTN","LRHY0",38,0)
 ;
"RTN","LRHY0",39,0)
 QUIT
"RTN","LRHY0",40,0)
 ;
"RTN","LRHY0",41,0)
VET ; Primary API for Howdy!  Called by [LRHY PATIENT CARD SCAN] option.
"RTN","LRHY0",42,0)
 D XTMP^LRHYU
"RTN","LRHY0",43,0)
 N LRNPZZX,LRNODUP,LRLLOC,LRTSTZ99,LRACC,LRCDT,LRDPF,LRI
"RTN","LRHY0",44,0)
 N LRORD3,LRHYFIX,LRPLICK,LRPR,LRPRAC,LRQUIET,LRRB,LRSAMP,LRSND
"RTN","LRHY0",45,0)
 N LRSS,LRST,LRSTATUS,LRSUB1,LRTIC,LRTIM,LRTN,LRTREA,LRTS,LRTSORU
"RTN","LRHY0",46,0)
 N LRTST6,LRTT,LRUN,LRWLO,LRWLC,LRWRD,LRXYZ,LR3DTIME,LR3DTN
"RTN","LRHY0",47,0)
 N LR3SN,LRDT0,LREAL,LRFUTURE,LRGOTIT,LRHOWDY,LRHYHOK,LRIENZZ
"RTN","LRHY0",48,0)
 N LRNOTST,LRLBLBP,LRLLOC66,LRMAX2,LRNLT,LRNODUP,LRNONE,LRNPZZX,LRODT
"RTN","LRHY0",49,0)
 N LRODT0,LRHYOK,LRORD24,LRORU3,LRPAST,LRPIX,LRAHEAD,LRCHK,LRHYCT,LRCOL99
"RTN","LRHY0",50,0)
 N LRDT0,LRDUPT,LRHT1,LRIX,LROLLOC,LRX,LR3X
"RTN","LRHY0",51,0)
 K LRCCOMX,LRDUX,LREDT,LRDX,DIB,DIK
"RTN","LRHY0",52,0)
 K LR3D,LR33ORD,LR3T,LRANX6,LRCSQ,LRUP,LRHY3DT,LRHY3SN3
"RTN","LRHY0",53,0)
 K LRHYDJOB,LRHYSPC7,LRHYURG3,LRS3333,LRTAT,LREXORD
"RTN","LRHY0",54,0)
 K LRMERG,LRODRNUM,LRORDNUM,LRUNC,LRPARAM
"RTN","LRHY0",55,0)
 K LRHYCT3,LRHYCTC,IOTLC,LRC,LRHYCT3,LRHYCTC,LRHYTOK,LRKIL,LRLABNOD
"RTN","LRHY0",56,0)
 K LRLABSTP,LRLINE,LRLWC,LRN5,LRNONONO,LRNOT,LRNOTEST,LRNOUP,LRNT,LRNX0
"RTN","LRHY0",57,0)
 K LRODRUM,LRONE,LRORDSIZ,LRORDT,LRORDT1,LRM1,LRM2,LRM3,LRPHONE,LRORIEN
"RTN","LRHY0",58,0)
 K LRS,LRSC0,LRSDT,LRSN1,LRSPIEN,LRSSN,LRSTAR,LRSTOP,LRSTUCK
"RTN","LRHY0",59,0)
 K LRT0,LRTECH,LRTKX,LRTM7,LRTOTAL,LRTST,LRTUBE,LRTXT,LRUDT,LRUNK,LRURG7
"RTN","LRHY0",60,0)
 K LRURGA,LRURGNCY,LRURGT,LRURGZ19,LRX1,LRX2,LRX3,LRY1,LRYTAT,LR3,LR3MULT
"RTN","LRHY0",61,0)
 K LR3NX0,LR3ODT,M9,V,LRHYORDZ
"RTN","LRHY0",62,0)
 K LABCNT,LN,LR0NODE,LR68,LR6987,LR700,LR7LESS
"RTN","LRHY0",63,0)
 K LR7MORE,LRAANAME,LRAAZ,LRAC1,LRACCER,LRACCTM,LRACCXX
"RTN","LRHY0",64,0)
 K LRACNODE,LRACO,LRACTM,LRADD,LRBAR0,LRBAR1,LRBBRD
"RTN","LRHY0",65,0)
 K LRBINGO,LRCEN,LRCNTX,LRCTYPE,LRD,LRDA,LRDRAW0
"RTN","LRHY0",66,0)
 K LRDRAW1,LRDRAW7,LRDT,LRDTX,LRDUP,LRDUX,LREDT,LRDX
"RTN","LRHY0",67,0)
 K LRFINX
"RTN","LRHY0",68,0)
 ;
"RTN","LRHY0",69,0)
VET1 ; Code below executes to handle Patient episode.
"RTN","LRHY0",70,0)
 ; Then, Howdy waits here for next Patient
"RTN","LRHY0",71,0)
 ;
"RTN","LRHY0",72,0)
 I '$G(LRDEV) D PICK Q:LREND
"RTN","LRHY0",73,0)
 ;
"RTN","LRHY0",74,0)
 K LRDFN,PNM,LRSN,SSN,LRIDT,LRAA,LRAN,LRAD
"RTN","LRHY0",75,0)
 K ^TMP("LRHYDY",$J)
"RTN","LRHY0",76,0)
 D ^LRPARAM ; Set Howdy up as Lab user
"RTN","LRHY0",77,0)
 S LRHOWDY=1
"RTN","LRHY0",78,0)
 S LRHYCT=$G(LRHYCT,0)
"RTN","LRHY0",79,0)
 I LRHYCT=2 W !,"Please ask the clerk for assistance." K LRHYCT QUIT
"RTN","LRHY0",80,0)
 S LRODT=DT
"RTN","LRHY0",81,0)
 W @IOF
"RTN","LRHY0",82,0)
 K X
"RTN","LRHY0",83,0)
 ; 
"RTN","LRHY0",84,0)
 W !!,"Please swipe your ID CARD or Type SSN: "
"RTN","LRHY0",85,0)
 ;  %ZOSF("EOFF") = U $I:NOECHO
"RTN","LRHY0",86,0)
 ;  %ZOSF("EON") = U $I:ECHO
"RTN","LRHY0",87,0)
 X ^%ZOSF("EOFF")
"RTN","LRHY0",88,0)
 R X:9999999 W !
"RTN","LRHY0",89,0)
 I X=U X ^%ZOSF("EON") D BAKUSER^LRHYU QUIT
"RTN","LRHY0",90,0)
 X ^%ZOSF("EON")
"RTN","LRHY0",91,0)
 ; Code is set to read all types of VIC card as of 9/05/2005
"RTN","LRHY0",92,0)
 ;I $E(X,1,9)["-" D
"RTN","LRHY0",93,0)
 ;.  S X=$P(X,"-")_$P(X,"-",2)_$P(X,"-",3)
"RTN","LRHY0",94,0)
 ;I $E(X,1,1)'=0 I '$E(X,1,1) S X=$E(X,2,10)
"RTN","LRHY0",95,0)
 ;I $L(X)>10 S X=$E(X,2,10)
"RTN","LRHY0",96,0)
 ;I $L(X)'=9 W !,"Didn't read that Partner. " W:LRHYCT'=2 "Try again." H 2 S LRHYCT=LRHYCT+1 G VET
"RTN","LRHY0",97,0)
 ;
"RTN","LRHY0",98,0)
 K DFN,LRDFN,LRDPA,LRDPF,PNM,LRHYCT
"RTN","LRHY0",99,0)
 ; 
"RTN","LRHY0",100,0)
 ;S DFN=$O(^DPT("SSN",X,0))
"RTN","LRHY0",101,0)
 ;
"RTN","LRHY0",102,0)
 ; NEW CODE FOR VIC 4.0
"RTN","LRHY0",103,0)
 D RPCVIC^DPTLK(.DFN,X)
"RTN","LRHY0",104,0)
 ;
"RTN","LRHY0",105,0)
 I DFN<1 W !,"No record for this person." R X:15 G VET
"RTN","LRHY0",106,0)
 S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","LRHY0",107,0)
 ;
"RTN","LRHY0",108,0)
 I LRDFN D PT^LRX
"RTN","LRHY0",109,0)
 I 'LRDFN W !,"No Lab Data Available... Please check with clerk at the Desk." H 5 D LOG K X G VET
"RTN","LRHY0",110,0)
 K ^TMP("LRHYDY",$J,"LRHYDY",$J,LRDFN)
"RTN","LRHY0",111,0)
 ;
"RTN","LRHY0",112,0)
 ; this call checks order against the 69.86
"RTN","LRHY0",113,0)
 D ORDCHK^LRHYB
"RTN","LRHY0",114,0)
 ;
"RTN","LRHY0",115,0)
 ;
"RTN","LRHY0",116,0)
 ;
"RTN","LRHY0",117,0)
 I $G(LRMULT) W !!!,"Please check with clerk at the Desk" H 5 D LOG K X G VET
"RTN","LRHY0",118,0)
 I '$G(LRORD) S LREND=1 W !,$G(LRCTYPE)," No Orders found. Please check with clerk at the Desk" H 5 D LOG K X G VET
"RTN","LRHY0",119,0)
 D NOW^%DTC
"RTN","LRHY0",120,0)
 ;
"RTN","LRHY0",121,0)
 ;
"RTN","LRHY0",122,0)
 ;
"RTN","LRHY0",123,0)
PRT1 ;
"RTN","LRHY0",124,0)
 ;
"RTN","LRHY0",125,0)
 W @IOF
"RTN","LRHY0",126,0)
 D SCRNON^LRHYUTL
"RTN","LRHY0",127,0)
 S PNMALL="Howdy "_$P(PNM,",",2)_" "_$P(PNM,",")
"RTN","LRHY0",128,0)
 W !
"RTN","LRHY0",129,0)
 W IODHLT,"     ",PNMALL
"RTN","LRHY0",130,0)
 W !
"RTN","LRHY0",131,0)
 W IODHLB,"     ",PNMALL
"RTN","LRHY0",132,0)
 W !
"RTN","LRHY0",133,0)
 W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,40)),IOM)
"RTN","LRHY0",134,0)
 W !,$$CJ^XLFSTR("Your Host is: "_$G(^LRHY(69.86,LRHYSITE,42)),IOM)
"RTN","LRHY0",135,0)
 W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,44)),IOM)
"RTN","LRHY0",136,0)
 W !
"RTN","LRHY0",137,0)
 W IODHLT,"    Orders for date: "_$$Y2K^LRX(DT)
"RTN","LRHY0",138,0)
 W !
"RTN","LRHY0",139,0)
 W IODHLB,"    Orders for date: "_$$Y2K^LRX(DT)
"RTN","LRHY0",140,0)
 W !
"RTN","LRHY0",141,0)
 S LRXYZ=0
"RTN","LRHY0",142,0)
 F  S LRXYZ=$O(^LRHY(69.86,LRHYSITE,32,LRXYZ)) Q:+LRXYZ'>0  D
"RTN","LRHY0",143,0)
 .  W !
"RTN","LRHY0",144,0)
 .  W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,32,LRXYZ,0)),IOM)
"RTN","LRHY0",145,0)
 .  W !
"RTN","LRHY0",146,0)
 W *7 H 1 W *7 H 1 W *7
"RTN","LRHY0",147,0)
 ;
"RTN","LRHY0",148,0)
 I $D(^LRHY(69.86,7,54,"B")) D BINBRD^LRHYBC1
"RTN","LRHY0",149,0)
 H 5
"RTN","LRHY0",150,0)
QUITH ; 
"RTN","LRHY0",151,0)
 D SCRNOFF^LRHYUTL ; Turn off screen variables
"RTN","LRHY0",152,0)
 K LRDFN,PNM,LRSN,SSN,LRIDT,LRAA,LRAN,LRAD,LRHYCT
"RTN","LRHY0",153,0)
 K LRNPZZX,LRNODUP,LRLLOC,LRTSTZ99,LRACC,LRCDT,LRDPF,LRI
"RTN","LRHY0",154,0)
 K LRORD3,LRHYFIX,LRPLICK,LRPR,LRPRAC,LRQUIET,LRRB,LRSAMP,LRSND
"RTN","LRHY0",155,0)
 K LRSS,LRST,LRSTATUS,LRSUB1,LRTIC,LRTIM,LRTN,LRTREA,LRTS,LRTSORU
"RTN","LRHY0",156,0)
 K LRTST6,LRTT,LRUN,LRWLO,LRWLC,LRWRD,LRXYZ,LR3DTIME,LR3DTN,LREXORD
"RTN","LRHY0",157,0)
 K LR3SN,LRDT0,LREAL,LRFUTURE,LRGOTIT,LRHOWDY,LRHYHOK,LRIENZZ
"RTN","LRHY0",158,0)
 K LRNOTST,LRLBLBP,LRLLOC66,LRMAX2,LRNLT,LRNODUP,LRNONE,LRNPZZX,LRODT
"RTN","LRHY0",159,0)
 K LRODT0,LRHYOK,LRORD24,LRORU3,LRPAST,LRPIX,LRAHEAD,LRCHK,LRHYCT,LRCOL99
"RTN","LRHY0",160,0)
 K LRDT0,LRDUPT,LRHT1,LRIX,LROLLOC,LRX,LR3X
"RTN","LRHY0",161,0)
 K VAIN
"RTN","LRHY0",162,0)
 ;
"RTN","LRHY0",163,0)
 ;
"RTN","LRHY0",164,0)
 G VET1
"RTN","LRHY0",165,0)
 ;
"RTN","LRHY0",166,0)
 ;
"RTN","LRHY0",167,0)
 ;
"RTN","LRHY0",168,0)
ORDCHK ; This block to be used for future version
"RTN","LRHY0",169,0)
 QUIT
"RTN","LRHY0",170,0)
LOG ; Howdy will default to the clerks judgement when multiple orders found.
"RTN","LRHY0",171,0)
 I $G(LRMULT) QUIT
"RTN","LRHY0",172,0)
 Q:$G(LRSKIPNO)
"RTN","LRHY0",173,0)
 ;
"RTN","LRHY0",174,0)
 W !,"NO ORDERS"
"RTN","LRHY0",175,0)
 ;
"RTN","LRHY0",176,0)
 K LRDPF,PNM
"RTN","LRHY0",177,0)
 D PT^LRX
"RTN","LRHY0",178,0)
 D NOW^%DTC
"RTN","LRHY0",179,0)
 I '$G(LRDFN) S ^TMP("LRHYDY",$J,"LR NO ORDERS",%)=$G(DFN) QUIT
"RTN","LRHY0",180,0)
 S ^TMP("LRHYDY",$J,"LR NO ORDERS",%)=$G(PNM)_U_$G(^LR(LRDFN,.1))_U_$G(SSN)
"RTN","LRHY0",181,0)
 QUIT
"RTN","LRHY0",182,0)
 ;
"RTN","LRHY0",183,0)
 ;
"RTN","LRHY0",184,0)
LOG1 ; Howdy will default to the clerks judgement when multiple orders found.
"RTN","LRHY0",185,0)
 K LRORD,LRDPT,PNM
"RTN","LRHY0",186,0)
 W !,"MULTIPLE ORDERS"
"RTN","LRHY0",187,0)
 K LRDPF,PNM
"RTN","LRHY0",188,0)
 D PT^LRX
"RTN","LRHY0",189,0)
 D NOW^%DTC
"RTN","LRHY0",190,0)
 S ^TMP("LRHYDY",$J,"LR MULTIPLE ORDERS",%)=$G(PNM)_U_$G(^LR(LRDFN,.1))_U_$G(SSN)
"RTN","LRHY0",191,0)
 S LRSKIPNO=1
"RTN","LRHY0",192,0)
 QUIT
"RTN","LRHY0",193,0)
ORDERS ;
"RTN","LRHY0",194,0)
 QUIT
"RTN","LRHY01")
0^4^B41628624^B41442608
"RTN","LRHY01",1,0)
LRHY01 ;DALOI/HOAK - HOWDY MAIN DRIVER ;10/15/10 11:02am
"RTN","LRHY01",2,0)
 ;;5.2;LAB SERVICE;**405,435,446**;Sep 27, 1994;Build 1
"RTN","LRHY01",3,0)
 ;
"RTN","LRHY01",4,0)
PICK ;
"RTN","LRHY01",5,0)
 ;  pick the site from Howdy Site FILE 69.86
"RTN","LRHY01",6,0)
 S LREND=0
"RTN","LRHY01",7,0)
 S DIC(0)="AEMQZ"
"RTN","LRHY01",8,0)
 S DIC=69.86
"RTN","LRHY01",9,0)
 D ^DIC
"RTN","LRHY01",10,0)
 I Y=-1 S LREND=1 QUIT
"RTN","LRHY01",11,0)
 S LRHYSITE=+Y
"RTN","LRHY01",12,0)
 K DIC
"RTN","LRHY01",13,0)
 ;
"RTN","LRHY01",14,0)
 N LRHY S LRHY="NUL" S LRHY=$O(^%ZIS(1,"B",LRHY))
"RTN","LRHY01",15,0)
 S LRDEV=$O(^%ZIS(1,"B",LRHY,0))
"RTN","LRHY01",16,0)
 D BINGO
"RTN","LRHY01",17,0)
 G ALT
"RTN","LRHY01",18,0)
 ;
"RTN","LRHY01",19,0)
 ; Pick a printer
"RTN","LRHY01",20,0)
 S LRDEV=0
"RTN","LRHY01",21,0)
 K DIC
"RTN","LRHY01",22,0)
 S DIC(0)="EMQZ" K Y S LRHYCT2=1
"RTN","LRHY01",23,0)
 F  S LRDEV=$O(^LRHY(69.86,LRHYSITE,10,"B",LRDEV)) Q:+LRDEV'>0  D
"RTN","LRHY01",24,0)
 .  W !,LRHYCT2,". ",$P(^%ZIS(1,LRDEV,0),U)
"RTN","LRHY01",25,0)
 .  S LRX(LRHYCT2)=LRDEV S LRHYCT2=LRHYCT2+1
"RTN","LRHY01",26,0)
CHOOO W !,"Choose a label printer: " R X:DTIME W !
"RTN","LRHY01",27,0)
 I X="" W !,"NOTHING SELECTED" S LREND=1 QUIT
"RTN","LRHY01",28,0)
 I U[X S LREND=1 QUIT
"RTN","LRHY01",29,0)
 I 'X I $G(X)'="" W !,"enter the number please" G CHOOO
"RTN","LRHY01",30,0)
 S LRDEV=LRX(X)
"RTN","LRHY01",31,0)
 ;
"RTN","LRHY01",32,0)
ALT ;
"RTN","LRHY01",33,0)
 W ?11,$P(^%ZIS(1,LRDEV,0),U) H 2
"RTN","LRHY01",34,0)
 K DIC
"RTN","LRHY01",35,0)
 K LRHYCT2
"RTN","LRHY01",36,0)
 ;
"RTN","LRHY01",37,0)
 QUIT
"RTN","LRHY01",38,0)
 ;
"RTN","LRHY01",39,0)
VET ; Primary API for Howdy!  Called by [LRHY PATIENT CARD SCAN] option.
"RTN","LRHY01",40,0)
 D XTMP^LRHYU
"RTN","LRHY01",41,0)
 N LRDFN,PNM,LRSN,SSN,LRIDT,LRAA,LRAN,LRAD
"RTN","LRHY01",42,0)
 N LRNPZZX,LRNODUP,LRLLOC,LRTSTZ99,LRACC,LRCDT,LRDPF,LRI
"RTN","LRHY01",43,0)
 N LRORD3,LRHYFIX,LRPLICK,LRPR,LRPRAC,LRQUIET,LRRB,LRSAMP,LRSND
"RTN","LRHY01",44,0)
 N LRSS,LRST,LRSTATUS,LRSUB1,LRTIC,LRTIM,LRTN,LRTREA,LRTS,LRTSORU
"RTN","LRHY01",45,0)
 N LRTST6,LRTT,LRUN,LRWLO,LRWLC,LRWRD,LRXYZ,LR3DTIME,LR3DTN,LREXORD
"RTN","LRHY01",46,0)
 N LR3SN,LRDT0,LREAL,LRFUTURE,LRGOTIT,LRHOWDY,LRHYHOK,LRIENZZ
"RTN","LRHY01",47,0)
 N LRNOTST,LRLBLBP,LRLLOC66,LRMAX2,LRNLT,LRNODUP,LRNONE,LRNPZZX,LRODT
"RTN","LRHY01",48,0)
 N LRODT0,LRHYOK,LRORD24,LRORU3,LRPAST,LRPIX,LRAHEAD,LRCHK,LRHYCT,LRCOL99
"RTN","LRHY01",49,0)
 N LRDT0,LRDUPT,LRHT1,LRIX,LROLLOC,LRX,LR3X
"RTN","LRHY01",50,0)
 K LR3D,LR33ORD,LR3T,LRANX6,LRCSQ,LRUP,LRHY3DT,LRHY3SN3
"RTN","LRHY01",51,0)
 K LRHYDJOB,LRHYSPC7,LRHYURG3,LRS3333,LRTAT
"RTN","LRHY01",52,0)
 K LRHY3DT3
"RTN","LRHY01",53,0)
 K LRHY3DT3
"RTN","LRHY01",54,0)
 K LRCCOMX
"RTN","LRHY01",55,0)
 K LRFINX
"RTN","LRHY01",56,0)
 ;
"RTN","LRHY01",57,0)
VET1 ; Code below executes to handle Patient episode.
"RTN","LRHY01",58,0)
 ; Then, Howdy waits here for next Patient
"RTN","LRHY01",59,0)
 I '$G(LRDEV) D PICK Q:LREND
"RTN","LRHY01",60,0)
 K LRDFN,PNM,LRSN,SSN,LRIDT,LRAA,LRAN,LRAD
"RTN","LRHY01",61,0)
 K ^TMP("LRHYDY",$J)
"RTN","LRHY01",62,0)
 D ^LRPARAM ; Set Howdy up as Lab user
"RTN","LRHY01",63,0)
 S LRHOWDY=1
"RTN","LRHY01",64,0)
 S LRHYCT=$G(LRHYCT,0)
"RTN","LRHY01",65,0)
 I LRHYCT=2 W !,"Please ask the clerk for assistance." K LRHYCT QUIT
"RTN","LRHY01",66,0)
 S LRODT=DT
"RTN","LRHY01",67,0)
 W @IOF
"RTN","LRHY01",68,0)
 K X
"RTN","LRHY01",69,0)
 ; 
"RTN","LRHY01",70,0)
 W !!,"Please swipe your ID CARD or Type SSN: "
"RTN","LRHY01",71,0)
 ;  %ZOSF("EOFF") = U $I:NOECHO
"RTN","LRHY01",72,0)
 ;  %ZOSF("EON") = U $I:ECHO
"RTN","LRHY01",73,0)
 X ^%ZOSF("EOFF")
"RTN","LRHY01",74,0)
 R X:9999999 W !
"RTN","LRHY01",75,0)
 I X=U X ^%ZOSF("EON") D BAKUSER^LRHYU QUIT
"RTN","LRHY01",76,0)
 X ^%ZOSF("EON")
"RTN","LRHY01",77,0)
 ; Code is set to read all types of VIC card as of 9/05/2005
"RTN","LRHY01",78,0)
 ;I $E(X,1,9)["-" D
"RTN","LRHY01",79,0)
 ;.  S X=$P(X,"-")_$P(X,"-",2)_$P(X,"-",3)
"RTN","LRHY01",80,0)
 ;I $E(X,1,1)'=0 I '$E(X,1,1) S X=$E(X,2,10)
"RTN","LRHY01",81,0)
 ;I $L(X)>10 S X=$E(X,2,10)
"RTN","LRHY01",82,0)
 ;I $L(X)'=9 W !,"Didn't read that Partner. " W:LRHYCT'=2 "Try again." H 2 S LRHYCT=LRHYCT+1 G VET
"RTN","LRHY01",83,0)
 K DFN,LRDFN,LRDPA,LRDPF,PNM,LRHYCT
"RTN","LRHY01",84,0)
 ; 
"RTN","LRHY01",85,0)
 ;S DFN=$O(^DPT("SSN",X,0))
"RTN","LRHY01",86,0)
 ;
"RTN","LRHY01",87,0)
 ; NEW CODE FOR VIC 4.0
"RTN","LRHY01",88,0)
 D RPCVIC^DPTLK(.DFN,X)
"RTN","LRHY01",89,0)
 ;
"RTN","LRHY01",90,0)
 I DFN<1 W !,"No record for this person." R X:15 G VET
"RTN","LRHY01",91,0)
 S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","LRHY01",92,0)
 ;
"RTN","LRHY01",93,0)
 I LRDFN D PT^LRX
"RTN","LRHY01",94,0)
 I 'LRDFN W !,"No Lab Data Available... Please check with clerk at the Desk." H 5 D LOG K X G VET
"RTN","LRHY01",95,0)
 K ^TMP("LRHYDY",$J,"LRHYDY",$J,LRDFN)
"RTN","LRHY01",96,0)
 ;
"RTN","LRHY01",97,0)
 ; this call checks order against the 69.86
"RTN","LRHY01",98,0)
 D ORDCHK^LRHYB
"RTN","LRHY01",99,0)
 ;
"RTN","LRHY01",100,0)
 ;
"RTN","LRHY01",101,0)
 ;
"RTN","LRHY01",102,0)
 I $G(LRMULT) W !!!,"Please check with clerk at the Desk" H 5 D LOG K X G VET
"RTN","LRHY01",103,0)
 I '$G(LRORD) S LREND=1 W !,$G(LRCTYPE)," No Orders found. Please check with clerk at the Desk" H 5 D LOG K X G VET
"RTN","LRHY01",104,0)
 D NOW^%DTC
"RTN","LRHY01",105,0)
 ;
"RTN","LRHY01",106,0)
 ;
"RTN","LRHY01",107,0)
 ;
"RTN","LRHY01",108,0)
PRT1 ;
"RTN","LRHY01",109,0)
 ;
"RTN","LRHY01",110,0)
 W @IOF
"RTN","LRHY01",111,0)
 D SCRNON^LRHYUTL
"RTN","LRHY01",112,0)
 S PNMALL="Howdy "_$P(PNM,",",2)_" "_$P(PNM,",")
"RTN","LRHY01",113,0)
 W !
"RTN","LRHY01",114,0)
 W IODHLT,"     ",PNMALL
"RTN","LRHY01",115,0)
 W !
"RTN","LRHY01",116,0)
 W IODHLB,"     ",PNMALL
"RTN","LRHY01",117,0)
 W !
"RTN","LRHY01",118,0)
 W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,40)),IOM)
"RTN","LRHY01",119,0)
 W !,$$CJ^XLFSTR("Your Host is: "_$G(^LRHY(69.86,LRHYSITE,42)),IOM)
"RTN","LRHY01",120,0)
 W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,44)),IOM)
"RTN","LRHY01",121,0)
 W !
"RTN","LRHY01",122,0)
 W IODHLT,"    Orders for date: "_$$Y2K^LRX(DT)
"RTN","LRHY01",123,0)
 W !
"RTN","LRHY01",124,0)
 W IODHLB,"    Orders for date: "_$$Y2K^LRX(DT)
"RTN","LRHY01",125,0)
 W !
"RTN","LRHY01",126,0)
 S LRXYZ=0
"RTN","LRHY01",127,0)
 F  S LRXYZ=$O(^LRHY(69.86,LRHYSITE,32,LRXYZ)) Q:+LRXYZ'>0  D
"RTN","LRHY01",128,0)
 .  W !
"RTN","LRHY01",129,0)
 .  W !,$$CJ^XLFSTR($G(^LRHY(69.86,LRHYSITE,32,LRXYZ,0)),IOM)
"RTN","LRHY01",130,0)
 .  W !
"RTN","LRHY01",131,0)
 W *7 H 1 W *7 H 1 W *7
"RTN","LRHY01",132,0)
 ;
"RTN","LRHY01",133,0)
 I $D(^LRHY(69.86,LRHYSITE,54,"B")) D LRHYBING
"RTN","LRHY01",134,0)
 H 5
"RTN","LRHY01",135,0)
QUITH ; 
"RTN","LRHY01",136,0)
 D SCRNOFF^LRHYUTL ; Turn off screen variables
"RTN","LRHY01",137,0)
 K LRDFN,PNM,LRSN,SSN,LRIDT,LRAA,LRAN,LRAD,LRHYCT
"RTN","LRHY01",138,0)
 K LRNPZZX,LRNODUP,LRLLOC,LRTSTZ99,LRACC,LRCDT,LRDPF,LRI
"RTN","LRHY01",139,0)
 K LRORD3,LRHYFIX,LRPLICK,LRPR,LRPRAC,LRQUIET,LRRB,LRSAMP,LRSND
"RTN","LRHY01",140,0)
 K LRSS,LRST,LRSTATUS,LRSUB1,LRTIC,LRTIM,LRTN,LRTREA,LRTS,LRTSORU
"RTN","LRHY01",141,0)
 K LRTST6,LRTT,LRUN,LRWLO,LRWLC,LRWRD,LRXYZ,LR3DTIME,LR3DTN
"RTN","LRHY01",142,0)
 K LR3SN,LRDT0,LREAL,LRFUTURE,LRGOTIT,LRHOWDY,LRHYHOK,LRIENZZ,LREXORD
"RTN","LRHY01",143,0)
 K LRNOTST,LRLBLBP,LRLLOC66,LRMAX2,LRNLT,LRNODUP,LRNONE,LRNPZZX,LRODT
"RTN","LRHY01",144,0)
 K LRODT0,LRHYOK,LRORD24,LRORU3,LRPAST,LRPIX,LRAHEAD,LRCHK,LRHYCT,LRCOL99
"RTN","LRHY01",145,0)
 K LRDT0,LRDUPT,LRHT1,LRIX,LROLLOC,LRX,LR3X
"RTN","LRHY01",146,0)
 K VAIN
"RTN","LRHY01",147,0)
 ;
"RTN","LRHY01",148,0)
 ;
"RTN","LRHY01",149,0)
 G VET1
"RTN","LRHY01",150,0)
 ;
"RTN","LRHY01",151,0)
 ;
"RTN","LRHY01",152,0)
 ;
"RTN","LRHY01",153,0)
ORDCHK ; This block to be used for future version
"RTN","LRHY01",154,0)
 QUIT
"RTN","LRHY01",155,0)
LOG ; Howdy will default to the clerks judgement when multiple orders found.
"RTN","LRHY01",156,0)
 Q:$G(LRSKIPNO)
"RTN","LRHY01",157,0)
 ;
"RTN","LRHY01",158,0)
 W !,"NO ORDERS"
"RTN","LRHY01",159,0)
 ;
"RTN","LRHY01",160,0)
 K LRDPF,PNM
"RTN","LRHY01",161,0)
 D PT^LRX
"RTN","LRHY01",162,0)
 D NOW^%DTC
"RTN","LRHY01",163,0)
 I '$G(LRDFN) S ^TMP("LRHYDY",$J,"LR NO ORDERS",%)=$G(DFN) QUIT
"RTN","LRHY01",164,0)
 S ^TMP("LRHYDY",$J,"LR NO ORDERS",%)=$G(PNM)_U_$G(^LR(LRDFN,.1))_U_$G(SSN)
"RTN","LRHY01",165,0)
 QUIT
"RTN","LRHY01",166,0)
 ;
"RTN","LRHY01",167,0)
 ;
"RTN","LRHY01",168,0)
LOG1 ; Howdy will default to the clerks judgement when multiple orders found.
"RTN","LRHY01",169,0)
 K LRORD,LRDPT,PNM
"RTN","LRHY01",170,0)
 W !,"MULTIPLE ORDERS"
"RTN","LRHY01",171,0)
 K LRDPF,PNM
"RTN","LRHY01",172,0)
 D PT^LRX
"RTN","LRHY01",173,0)
 D NOW^%DTC
"RTN","LRHY01",174,0)
 S ^TMP("LRHYDY",$J,"LR MULTIPLE ORDERS",%)=$G(PNM)_U_$G(^LR(LRDFN,.1))_U_$G(SSN)
"RTN","LRHY01",175,0)
 S LRSKIPNO=1
"RTN","LRHY01",176,0)
 QUIT
"RTN","LRHY01",177,0)
ORDERS ;
"RTN","LRHY01",178,0)
 QUIT
"RTN","LRHY01",179,0)
 ;
"RTN","LRHY01",180,0)
BINGO ;
"RTN","LRHY01",181,0)
 S LRBINGO=0
"RTN","LRHY01",182,0)
 K DIC S DIC(0)="EMQZ" K Y S LRHYCT3=1
"RTN","LRHY01",183,0)
 F  S LRBINGO=$O(^LRHY(69.86,LRHYSITE,54,"B",LRBINGO)) Q:+LRBINGO'>0  D
"RTN","LRHY01",184,0)
 .  W !!,LRHYCT3,". ",$P(^%ZIS(1,LRBINGO,0),U) W !
"RTN","LRHY01",185,0)
 .  S LRX(LRHYCT3)=LRBINGO S LRHYCT3=LRHYCT3+1
"RTN","LRHY01",186,0)
 N LRHYX W !,"Choose PPOC Bingo Board: " R LRHYX:DTIME W !
"RTN","LRHY01",187,0)
 I LRHYX[U W !,"NOTHING SELECTED " QUIT
"RTN","LRHY01",188,0)
 I LRHYX="" W !,"NOTHING SELECTED " QUIT
"RTN","LRHY01",189,0)
 I '+LRHYX W !,"CHOOSE A NUMBER " H 2 G BINGO
"RTN","LRHY01",190,0)
 Q:LRHYX[U
"RTN","LRHY01",191,0)
 I $G(LRHYX)["?" W !,"Choose  NUMBER " H 2 G BINGO
"RTN","LRHY01",192,0)
 I $D(LRX) S LRBINGO=LRX(LRHYX)
"RTN","LRHY01",193,0)
 Q:$G(LRBINGO)=""
"RTN","LRHY01",194,0)
 W !!
"RTN","LRHY01",195,0)
 W $P(^%ZIS(1,LRBINGO,0),U)
"RTN","LRHY01",196,0)
 W !
"RTN","LRHY01",197,0)
 S LRBINGO=$P(^%ZIS(1,LRBINGO,0),U)
"RTN","LRHY01",198,0)
 QUIT
"RTN","LRHY01",199,0)
LRHYBING ;
"RTN","LRHY01",200,0)
 ; Display Patient on Bingo board.
"RTN","LRHY01",201,0)
 W !,"SENDING TO BINGO BOARD ",LRBINGO H 2
"RTN","LRHY01",202,0)
 S ZTSAVE("PNM")=""
"RTN","LRHY01",203,0)
 S ZTRTN="PRIBB^LRHY01"
"RTN","LRHY01",204,0)
 S ZTDTH=$H
"RTN","LRHY01",205,0)
 S ZTDESC="PPOC BINGO PRINT"
"RTN","LRHY01",206,0)
 S ZTIO=$G(LRBINGO)
"RTN","LRHY01",207,0)
 S:$D(ZTQUEUED) ZTREQ="@" D ^%ZTLOAD
"RTN","LRHY01",208,0)
 ;
"RTN","LRHY01",209,0)
 QUIT
"RTN","LRHY01",210,0)
PRIBB ;
"RTN","LRHY01",211,0)
 W !,$G(PNM)
"RTN","LRHY01",212,0)
 QUIT
"RTN","LRHYA")
0^5^B29657209^B29476770
"RTN","LRHYA",1,0)
LRHYA ;DALOI/HOAK - HOWDY UTILITY-A ;9/16/2000
"RTN","LRHYA",2,0)
 ;;5.2;LAB SERVICE;**405,446**;Sep 27, 1994;Build 1
"RTN","LRHYA",3,0)
 ;
"RTN","LRHYA",4,0)
 ;
"RTN","LRHYA",5,0)
OLT ; This block looks in the Howdy site file for tests that will print
"RTN","LRHYA",6,0)
 ; order labels WILL NOT accession the test.
"RTN","LRHYA",7,0)
 ; order label tests
"RTN","LRHYA",8,0)
 K LRNODONE
"RTN","LRHYA",9,0)
 S LRHYHOK=0
"RTN","LRHYA",10,0)
 S LRTSTS=0
"RTN","LRHYA",11,0)
 S LRPLICK=1
"RTN","LRHYA",12,0)
 F  S LRTSTS=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS)) Q:+LRTSTS'>0  D
"RTN","LRHYA",13,0)
 .  S ^TMP("LRHYDY",$J,LRDFN,LR3DTN,LRTSTS)=""
"RTN","LRHYA",14,0)
 .  K LRNPZZX
"RTN","LRHYA",15,0)
 .  S LRIENZZ=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS,0))
"RTN","LRHYA",16,0)
 .  S LRORD=^LRO(69,LR3DTN,1,LR3SN,.1)
"RTN","LRHYA",17,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'="" S LRNODUP=1 S LRNOTST(LRTSTS)="" S LRNPZZX(LRORD,LR3SN,LRTSTS)="" QUIT
"RTN","LRHYA",18,0)
 .  I $D(^LRHY(69.86,LRHYSITE,25,"B",LRTSTS)) S LRHYHOK=1 D
"RTN","LRHYA",19,0)
 ..  S LROLT1(LR3DTN,LR3SN)=LRTSTS
"RTN","LRHYA",20,0)
 ..  S LRNOTST(LRTSTS)=""
"RTN","LRHYA",21,0)
 ..  D ^LRHYBLD ;print order labels
"RTN","LRHYA",22,0)
 D DONE
"RTN","LRHYA",23,0)
 QUIT
"RTN","LRHYA",24,0)
 ;
"RTN","LRHYA",25,0)
LTE ; This block looks in the Howdy site file for those test to exclude 
"RTN","LRHYA",26,0)
 ; from accessioning by Howdy
"RTN","LRHYA",27,0)
 ;
"RTN","LRHYA",28,0)
 Q:'$G(LRCOL99)
"RTN","LRHYA",29,0)
 K LRNODONE
"RTN","LRHYA",30,0)
 K LRCCOM
"RTN","LRHYA",31,0)
 ;  exclude lab test
"RTN","LRHYA",32,0)
 ;
"RTN","LRHYA",33,0)
 S LRIENZZ=0
"RTN","LRHYA",34,0)
 S LRHYHOK=0
"RTN","LRHYA",35,0)
 S LRTSTS=0
"RTN","LRHYA",36,0)
 ;
"RTN","LRHYA",37,0)
 S LRHYTOK=0
"RTN","LRHYA",38,0)
 K LRNPZZX
"RTN","LRHYA",39,0)
 K LRNODUP
"RTN","LRHYA",40,0)
 F  S LRTSTS=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS)) Q:+LRTSTS'>0  S LRHYHOK=0 D
"RTN","LRHYA",41,0)
 .  ;
"RTN","LRHYA",42,0)
 .  S LRORD=^LRO(69,LR3DTN,1,LR3SN,.1)
"RTN","LRHYA",43,0)
 .  I $D(^LRHY(69.86,LRHYSITE,2,"B",LRTSTS)) S LRHYHOK=1 S LRHYT654=LRTSTS S LRNOTST(LRTSTS)="",LREXORD(LRORD)="" QUIT
"RTN","LRHYA",44,0)
 .  K LRNPZZX
"RTN","LRHYA",45,0)
 .  K LRCCOM
"RTN","LRHYA",46,0)
 .  S LRCOL99=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,3)
"RTN","LRHYA",47,0)
 .  ;
"RTN","LRHYA",48,0)
 .  K LRNODONE
"RTN","LRHYA",49,0)
 .  S LRIENZZ=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS,0))
"RTN","LRHYA",50,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,0))["CA" S LRNODONE=1,LRHYHOK=1 QUIT
"RTN","LRHYA",51,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,0))["CA" QUIT
"RTN","LRHYA",52,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,0))'["CA" S LRHYTOK=LRTSTS
"RTN","LRHYA",53,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'="" S LRNODUP=1 QUIT
"RTN","LRHYA",54,0)
 .  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,0))["CA" QUIT
"RTN","LRHYA",55,0)
 .  ;
"RTN","LRHYA",56,0)
 .  I $D(^LRHY(69.86,LRHYSITE,2,"B",LRTSTS)) S LRHYHOK=1 QUIT
"RTN","LRHYA",57,0)
 .  I LR3DTN=DT I $D(^TMP("LRHYDY",$J,"DUPTEST",LRTSTS,LRCOL99)) D
"RTN","LRHYA",58,0)
 ..  ; duplicate auto np function
"RTN","LRHYA",59,0)
 ..  ;
"RTN","LRHYA",60,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,2,"B",LRTSTS))  ;no excepted test
"RTN","LRHYA",61,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,25,1,"B",LRTSTS))  ;no order label tests
"RTN","LRHYA",62,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,4,"B",LRCOL99))
"RTN","LRHYA",63,0)
 ..  ;
"RTN","LRHYA",64,0)
 ..  S LRIENZZ=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS,0))
"RTN","LRHYA",65,0)
 ..  K ^TMP("LRHYDY",$J,"KILL",LR3DTN,LR3SN)
"RTN","LRHYA",66,0)
 ..  K LRNPZZX
"RTN","LRHYA",67,0)
 ..  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'="" S LRHYHOK=1 QUIT
"RTN","LRHYA",68,0)
 ..  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'="" S LRNPZZX(LRORD,LR3SN,LRTSTS)="" S LRNODUP=1 S LRHYHOK=+LRTSTS QUIT
"RTN","LRHYA",69,0)
 ..  ; a future enhancement may be used to cancel a test
"RTN","LRHYA",70,0)
 ..  S LRT(LRTSTS)=LR3SN_U_LRIENZZ_U_LRTSTS S LRJ=LRTSTS
"RTN","LRHYA",71,0)
 ..  ;
"RTN","LRHYA",72,0)
 ..  K LRCCOMX,LRCCOM0,LRCCOM1
"RTN","LRHYA",73,0)
 ..  I $G(^LRHY(69.86,LRHYSITE,52))="" S LRNODUP=1
"RTN","LRHYA",74,0)
 ..  I $G(^LRHY(69.86,LRHYSITE,52))="N" S LRNODUP=1
"RTN","LRHYA",75,0)
 ..  Q:$G(LRNODUP)  S LRHYHOK=1 K LRCCOM S ZTRTN="FX2^LRHYDEL",ZTSAVE("L*")="",ZTDTH=$H,ZTIO="NULL" S:$D(ZTQUEUED) ZTREQ="@" D ^%ZTLOAD
"RTN","LRHYA",76,0)
 .  E  D
"RTN","LRHYA",77,0)
 ..  Q:$D(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))
"RTN","LRHYA",78,0)
 ..  Q:$D(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))
"RTN","LRHYA",79,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,2,"B",LRTSTS))  ;no excepted test
"RTN","LRHYA",80,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,25,1,"B",LRTSTS))  ;no order label tests
"RTN","LRHYA",81,0)
 ..  Q:$D(^LRHY(69.86,LRHYSITE,4,"B",LRCOL99))
"RTN","LRHYA",82,0)
 ..  Q:$D(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))
"RTN","LRHYA",83,0)
 ..  K LRNPZZX
"RTN","LRHYA",84,0)
 ..  I $G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'="" S LRNPZZX(LRORD,LR3SN,LRTSTS)="" S LRNODUP=1 S LRHYHOK=+LRTSTS QUIT
"RTN","LRHYA",85,0)
 ..  ;
"RTN","LRHYA",86,0)
 ..  I LR3DTN=DT S ^TMP("LRHYDY",$J,"DUPTEST",LRTSTS,LRCOL99)=""
"RTN","LRHYA",87,0)
 ;
"RTN","LRHYA",88,0)
 D DONE
"RTN","LRHYA",89,0)
 QUIT
"RTN","LRHYA",90,0)
 ;
"RTN","LRHYA",91,0)
CSE ; This block checks for collection sample exclusion
"RTN","LRHYA",92,0)
 S LRHYHOK=0
"RTN","LRHYA",93,0)
 S LRHYSPC7=$P($G(^LAB(62,LRCOL99,0)),U,2)
"RTN","LRHYA",94,0)
 I $G(LRHYSPC7) I $D(^LRHY(69.86,LRHYSITE,6,"B",LRHYSPC7)) S LRHYHOK=1
"RTN","LRHYA",95,0)
 K LRNODONE
"RTN","LRHYA",96,0)
 I $D(^LRHY(69.86,LRHYSITE,4,"B",LRCOL99)) S LRHYHOK=1
"RTN","LRHYA",97,0)
 I LRHYHOK=1 S LRHYCS33(LR3DTN,LR3SN)=LRCOL99
"RTN","LRHYA",98,0)
 QUIT
"RTN","LRHYA",99,0)
 ;
"RTN","LRHYA",100,0)
CSTATUS ; This block checks for collection types to exclude
"RTN","LRHYA",101,0)
 S LRORD=^LRO(69,LR3DTN,1,LR3SN,.1)
"RTN","LRHYA",102,0)
 K LRNODONE
"RTN","LRHYA",103,0)
 K LRWCZZZ
"RTN","LRHYA",104,0)
 S LRHYHOK=0
"RTN","LRHYA",105,0)
 I $D(^LRHY(69.86,LRHYSITE,8,"B",LRCSTAT)) S LRHYHOK=1 S LRWCZZZ=1
"RTN","LRHYA",106,0)
 I LRHYHOK=1 S ^TMP("LRHYDY",$J,"STATUS",LRORD)=""
"RTN","LRHYA",107,0)
 D DONE
"RTN","LRHYA",108,0)
 QUIT
"RTN","LRHYA",109,0)
 ;
"RTN","LRHYA",110,0)
EXLOC ; This block checks for Hospital locations to exclude
"RTN","LRHYA",111,0)
 I $D(^LRHY(69.86,LRHYSITE,16,"B",LRLLOC66)) S LRHYHOK=1 D DONE S ^TMP("LRHYDY",$J,"EXLOC",LRORD,LRLLOC66,LR3SN)=""
"RTN","LRHYA",112,0)
 QUIT
"RTN","LRHYA",113,0)
DONE ;
"RTN","LRHYA",114,0)
 Q:$D(LROLT1)
"RTN","LRHYA",115,0)
 Q:$G(LRHYT654)
"RTN","LRHYA",116,0)
 I $G(LRHYTOK) S LRHYHOK=0
"RTN","LRHYA",117,0)
 Q:$G(LRNODONE)
"RTN","LRHYA",118,0)
 I LRHYHOK=1 S ^TMP("LRHYDY",$J,"KILL",LR3DTN,LR3SN,1)=""
"RTN","LRHYA",119,0)
 I LRHYHOK>1 S ^TMP("LRHYDY",$J,"KILL",LR3DTN,LR3SN,LRHYHOK)=""
"RTN","LRHYA",120,0)
 QUIT
"RTN","LRHYA",121,0)
URG ;
"RTN","LRHYA",122,0)
 S LRHYHOK=0
"RTN","LRHYA",123,0)
 S LRTSTS=0
"RTN","LRHYA",124,0)
 F  S LRTSTS=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS)) Q:+LRTSTS'>0!(LRHYHOK)  D URGP
"RTN","LRHYA",125,0)
 QUIT
"RTN","LRHYA",126,0)
 D DONE
"RTN","LRHYA",127,0)
 QUIT
"RTN","LRHYA",128,0)
URGP ;
"RTN","LRHYA",129,0)
 S LR3ZTST=0
"RTN","LRHYA",130,0)
 S LR3ZTST=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTS,LR3ZTST)) Q:+LR3ZTST'>0!(LRHYHOK)  D URG1  Q:LRHYHOK
"RTN","LRHYA",131,0)
 QUIT
"RTN","LRHYA",132,0)
URG1 ;
"RTN","LRHYA",133,0)
 S LRURGZ19=$P(^LRO(69,LR3DTN,1,LR3SN,2,LR3ZTST,0),U,2)
"RTN","LRHYA",134,0)
 I $D(^LRHY(69.86,LRHYSITE,30,"B",LRURGZ19)) S LRHYHOK=1 S LRHYURG3(LR3DTN,LR3SN)=LR3ZTST
"RTN","LRHYA",135,0)
 I LRHYHOK=1 S ^TMP("LRHYDY",$J,"KILL",LR3DTN,LR3SN,1)=""
"RTN","LRHYA",136,0)
 S LRORD=^LRO(69,LR3DTN,1,LR3SN,.1)
"RTN","LRHYA",137,0)
 I LRHYHOK=1 S ^TMP("LRHYDY",$J,"URG",LRORD)=""
"RTN","LRHYA",138,0)
 QUIT
"RTN","LRHYB")
0^2^B41402354^B40872404
"RTN","LRHYB",1,0)
LRHYB ;DALOI/HOAK - HOWDY B DRIVER ;9/16/2000
"RTN","LRHYB",2,0)
 ;;5.2;LAB SERVICE;**405,417,446**;Sep 27, 1994;Build 1
"RTN","LRHYB",3,0)
 ;
"RTN","LRHYB",4,0)
TEST ;
"RTN","LRHYB",5,0)
 S DIC=2 S DIC(0)="AEMQZ" D ^DIC
"RTN","LRHYB",6,0)
 Q:Y=-1
"RTN","LRHYB",7,0)
 S LRDFN=$G(^DPT(+Y,"LR"))
"RTN","LRHYB",8,0)
 ;
"RTN","LRHYB",9,0)
 ;
"RTN","LRHYB",10,0)
 ;
"RTN","LRHYB",11,0)
ORDCHK ; Here is where the search for an order number starts
"RTN","LRHYB",12,0)
 K LRHYT654
"RTN","LRHYB",13,0)
 ; The Howdy site file will help determine which orders the site
"RTN","LRHYB",14,0)
 ; will accept. Once an order has been selected it is handed off
"RTN","LRHYB",15,0)
 ; to LRORDST to start the accessioning process.
"RTN","LRHYB",16,0)
 ;
"RTN","LRHYB",17,0)
 K LRWCZZZ,LRDTF
"RTN","LRHYB",18,0)
 K LRHYCS33
"RTN","LRHYB",19,0)
 K ^TMP("LRHYDY",$J,"KILL")
"RTN","LRHYB",20,0)
 ;
"RTN","LRHYB",21,0)
 ;
"RTN","LRHYB",22,0)
 K ^TMP("LRHYDY",$J,"MULTD")
"RTN","LRHYB",23,0)
 K ^TMP("LRHYDY",$J,"DUPTEST")
"RTN","LRHYB",24,0)
 K LRHYCS
"RTN","LRHYB",25,0)
 K ^TMP("LRHYDY",$J,"MT")
"RTN","LRHYB",26,0)
 S LRHOWDY=1
"RTN","LRHYB",27,0)
 S LREND=0
"RTN","LRHYB",28,0)
 S LRORD=""
"RTN","LRHYB",29,0)
 Q:'LRDFN
"RTN","LRHYB",30,0)
 ;
"RTN","LRHYB",31,0)
 K ^TMP("LRHYDY",$J,"LRSN"),LRNPZZX
"RTN","LRHYB",32,0)
 S LRHYOK=0
"RTN","LRHYB",33,0)
 ;
"RTN","LRHYB",34,0)
 ;  18 days ahead
"RTN","LRHYB",35,0)
 ;  20 days back
"RTN","LRHYB",36,0)
 ;
"RTN","LRHYB",37,0)
 S X2=0 K LRNPZZX
"RTN","LRHYB",38,0)
 S LRAHEAD=$G(^LRHY(69.86,LRHYSITE,18))
"RTN","LRHYB",39,0)
 S LRPAST=$G(^LRHY(69.86,LRHYSITE,20))
"RTN","LRHYB",40,0)
 K LRWCZZZ,LREXORD
"RTN","LRHYB",41,0)
 F LRI=-LRPAST:1:LRAHEAD D  ;Search window set by site file.
"RTN","LRHYB",42,0)
 .  S X1=DT S X2=LRI D C^%DTC S LR3DTN=X
"RTN","LRHYB",43,0)
 .  I $D(^LRO(69,LR3DTN,1,"AA",LRDFN)) S LRHYOK=1 D
"RTN","LRHYB",44,0)
 ..  S LR3SN=0
"RTN","LRHYB",45,0)
 ..  F  S LR3SN=$O(^LRO(69,LR3DTN,1,"AA",LRDFN,LR3SN)) Q:+LR3SN'>0  D
"RTN","LRHYB",46,0)
 ...  Q:$P($G(^LRO(69,LR3DTN,1,LR3SN,1)),U,4)="C"  ;collected
"RTN","LRHYB",47,0)
 ...  K LRWCZZZ
"RTN","LRHYB",48,0)
 ...  ;
"RTN","LRHYB",49,0)
 ...  K LRCOL99 S LRCOL99=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,3)
"RTN","LRHYB",50,0)
 ...  K LRCSTAT S LRCSTAT=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,4)
"RTN","LRHYB",51,0)
 ...  D CSTATUS^LRHYA Q:LRHYHOK  ;Check collection status
"RTN","LRHYB",52,0)
 ...  ;
"RTN","LRHYB",53,0)
 ...  D OLT^LRHYA  ;print order label tests
"RTN","LRHYB",54,0)
 ...  Q:LRHYHOK
"RTN","LRHYB",55,0)
 ...  ;
"RTN","LRHYB",56,0)
 ...  ;
"RTN","LRHYB",57,0)
 ...  K LRNOTST
"RTN","LRHYB",58,0)
 ...  S LRNODUP=0 D LTE^LRHYA Q:LRHYHOK  ;check for excluded lab tests
"RTN","LRHYB",59,0)
 ...  ;
"RTN","LRHYB",60,0)
 ...  S LRORD=^LRO(69,LR3DTN,1,LR3SN,.1)
"RTN","LRHYB",61,0)
 ...  S LRLLOC66=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,9)
"RTN","LRHYB",62,0)
 ...  D EXLOC^LRHYA Q:LRHYHOK  ;check for locations to exclude
"RTN","LRHYB",63,0)
 ...  ;
"RTN","LRHYB",64,0)
 ...  S LRLLOC=$G(LRLLOC66)
"RTN","LRHYB",65,0)
 ...  S LRORD24=0
"RTN","LRHYB",66,0)
 ...  D OLT^LRHYA Q:LRHYHOK  ;print order label tests
"RTN","LRHYB",67,0)
 ...  ;
"RTN","LRHYB",68,0)
 ...  D URG^LRHYA Q:LRHYHOK  ;;  CHECK URGENCY
"RTN","LRHYB",69,0)
 ...  K LRCOL99 S LRCOL99=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,3)
"RTN","LRHYB",70,0)
 ...  D CSE^LRHYA Q:LRHYHOK  ;check for excluded collection samples
"RTN","LRHYB",71,0)
 ...  ;
"RTN","LRHYB",72,0)
 ...  I $O(^TMP("LRHYDY",$J,"EXLOC",LRORD,0))=$G(LRLLOC66) I $O(^LRO(69,"C",LRORD,0))'=DT QUIT
"RTN","LRHYB",73,0)
 ...  ;  CHECK URGENCY
"RTN","LRHYB",74,0)
 ...  S LRTST6=0 ; micro test
"RTN","LRHYB",75,0)
 ...  F  S LRTST6=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTST6)) Q:+LRTST6'>0  D
"RTN","LRHYB",76,0)
 ....  S LRTSTZ99(LRTST6)=""
"RTN","LRHYB",77,0)
 ....  I LRTST6 S LRSUB1=$P(^LAB(60,LRTST6,0),U,4) ; subscript
"RTN","LRHYB",78,0)
 ....  Q:$D(LRNPZZX(^LRO(69,LR3DTN,1,LR3SN,.1),LR3SN,LRTST6))
"RTN","LRHYB",79,0)
 ....  S LRORD=$G(^LRO(69,LR3DTN,1,LR3SN,.1))
"RTN","LRHYB",80,0)
 ....  I $G(LRORD) I $D(^TMP("LRHYDY",$J,"STATUS",LRORD)) QUIT
"RTN","LRHYB",81,0)
 ....  I $D(LRNOTST) I $D(LRNOTST(LRTST6)) K LRORD QUIT
"RTN","LRHYB",82,0)
 ....  S ^TMP("LRHYDY",$J,"LRSN",LR3DTN,^LRO(69,LR3DTN,1,LR3SN,.1))=""
"RTN","LRHYB",83,0)
 ....  S LRDTX=""
"RTN","LRHYB",84,0)
 ....  S LRDTX=$O(^LRO(69,"C",^LRO(69,LR3DTN,1,LR3SN,.1),0))
"RTN","LRHYB",85,0)
 ....  I '$D(^LRHY(69.86,LRHYSITE,16,"B",LRLLOC66)) I $G(LRDTX) S ^TMP("LRHYDY",$J,"MT",LRDTX)=""
"RTN","LRHYB",86,0)
 ;
"RTN","LRHYB",87,0)
 ;
"RTN","LRHYB",88,0)
 K LRMULT
"RTN","LRHYB",89,0)
 I $G(LRWCMULT) W !!!!,"Multple Orders Present" S LRMULT=1 D LOG1^LRHY0 K LRWCMULT QUIT
"RTN","LRHYB",90,0)
 ; per Libba 1/14/2002
"RTN","LRHYB",91,0)
 I $D(^TMP("LRHYDY",$J,"LRSN",DT)) S LR3DTN=DT ; I prefer today's orders but...
"RTN","LRHYB",92,0)
 E  S LR3DTN=$O(^TMP("LRHYDY",$J,"LRSN",0)) ; I'll take whatever ya got
"RTN","LRHYB",93,0)
 I 'LR3DTN K LRORD QUIT
"RTN","LRHYB",94,0)
 ;
"RTN","LRHYB",95,0)
 I '$D(^LRHY(69.86,LRHYSITE,16,"B",LRLLOC66)) I $O(^TMP("LRHYDY",$J,"LRSN",LR3DTN)) W !,"MULTIPLE DAYS WITH ORDERS" S LRMULT=1 D LOG1^LRHY0 QUIT
"RTN","LRHYB",96,0)
 ;
"RTN","LRHYB",97,0)
 S LRTIC=0
"RTN","LRHYB",98,0)
 S LRMULT=0
"RTN","LRHYB",99,0)
 ;
"RTN","LRHYB",100,0)
 F  S LRTIC=$O(^TMP("LRHYDY",$J,"LRSN",LRTIC)) Q:+LRTIC'>0  S LRMULT=LRMULT+1
"RTN","LRHYB",101,0)
 I '$D(^LRHY(69.86,LRHYSITE,16,"B",LRLLOC66)) I LRMULT>1 W !,"MULTIPLE DAYS WITH ORDERS" S LRMULT=0 D LOG1^LRHY0 QUIT
"RTN","LRHYB",102,0)
 ;MODIFIED BY HOAK to flag when wc and sp are on same visit
"RTN","LRHYB",103,0)
 ;
"RTN","LRHYB",104,0)
 ;
"RTN","LRHYB",105,0)
MOVE ;
"RTN","LRHYB",106,0)
 I $D(LRNOTST) I $G(LRHYT654) I $D(LRNOTST(LRHYT654)) K LRORD QUIT
"RTN","LRHYB",107,0)
 I $G(LRORD),$D(LREXORD(LRORD)) K LRORD QUIT
"RTN","LRHYB",108,0)
 S LRHY3SN3=0
"RTN","LRHYB",109,0)
 S LRHY3DT3=0
"RTN","LRHYB",110,0)
 I $D(^TMP("LRHYDY",$J,"URG",LRORD)) K LRORD QUIT
"RTN","LRHYB",111,0)
 I $D(^LRHY(69.86,LRHYSITE,30,"B",LRURGZ19)) K LRORD QUIT
"RTN","LRHYB",112,0)
 S LRTIC=0
"RTN","LRHYB",113,0)
 S LRMULT=0
"RTN","LRHYB",114,0)
 F  S LRTIC=$O(^TMP("LRHYDY",$J,"MT",LRTIC)) Q:+LRTIC'>0  S LRMULT=LRMULT+1
"RTN","LRHYB",115,0)
 S LR3MULT=LRMULT
"RTN","LRHYB",116,0)
 I LRMULT>1 W !,"MULTIPLE DAYS WITH ORDERS" S LRORD=0 QUIT
"RTN","LRHYB",117,0)
 E  S LRMULT=0
"RTN","LRHYB",118,0)
 ; may be accessioned.
"RTN","LRHYB",119,0)
 ; Setting up task to continue based on the specimen.
"RTN","LRHYB",120,0)
 K LR3ZTST
"RTN","LRHYB",121,0)
MOVE1 ;
"RTN","LRHYB",122,0)
 S LRORD=0
"RTN","LRHYB",123,0)
 F  S LRORD=$O(^TMP("LRHYDY",$J,"LRSN",LR3DTN,LRORD)) Q:+LRORD'>0  D
"RTN","LRHYB",124,0)
 .  S:'$G(LR3ORD) LR3ORD=LRORD
"RTN","LRHYB",125,0)
 .  I $D(^TMP("LRHYDY",$J,"URG",LRORD)) QUIT
"RTN","LRHYB",126,0)
 .  S LRHYORDZ=LRORD
"RTN","LRHYB",127,0)
 .  ;
"RTN","LRHYB",128,0)
 .  S ZTSAVE("^TMP(""LRHYDY"",$J,")=""
"RTN","LRHYB",129,0)
 .  S ZTRTN="PAST^LRHYPH0",ZTSAVE("L*")="",ZTDTH=$H,ZTDESC="HOWDY"
"RTN","LRHYB",130,0)
 .  S ZTIO="NULL"
"RTN","LRHYB",131,0)
 .  S ZTSAVE("L*")=""
"RTN","LRHYB",132,0)
 .  S:$D(ZTQUEUED) ZTREQ="@" D ^%ZTLOAD
"RTN","LRHYB",133,0)
 .  S LRGOTIT=1
"RTN","LRHYB",134,0)
 .  S LRORD=LRHYORDZ
"RTN","LRHYB",135,0)
 .  K LRSTOPZ(LRORD)
"RTN","LRHYB",136,0)
 K ^TMP("LRHYDY",$J,"MULTD")
"RTN","LRHYB",137,0)
 S LRORD=$G(LR3ORD) K LR3ORD
"RTN","LRHYB",138,0)
 K LRHOWDY,LR3SN24,LR3DTN24,LR3ZTST
"RTN","LRHYB",139,0)
 ; Remove collection info on order label tests
"RTN","LRHYB",140,0)
 S LR3DTN=0
"RTN","LRHYB",141,0)
 F  S LR3DTN=$O(LROLT1(LR3DTN)) Q:+LR3DTN'>0  D
"RTN","LRHYB",142,0)
 .  S LR3SN=0
"RTN","LRHYB",143,0)
 .  F  S LR3SN=$O(LROLT1(LR3DTN,LR3SN)) Q:+LR3SN'>0  D
"RTN","LRHYB",144,0)
 ..  S ^LRO(69,LR3DTN,1,LR3SN,1)=""
"RTN","LRHYB",145,0)
 K LROLT1
"RTN","LRHYB",146,0)
 I $G(LRORD) I $D(LRSTOPZ(LRORD)) K LRORD,LRSTOPZ QUIT
"RTN","LRHYB",147,0)
 ;
"RTN","LRHYB",148,0)
 QUIT
"RTN","LRHYB",149,0)
 ;
"RTN","LRHYB",150,0)
MMM ;
"RTN","LRHYB",151,0)
 N LRI S LRI=0
"RTN","LRHYB",152,0)
 N LR3DTN,LR3SN,LRIENZZ,LRTSTX
"RTN","LRHYB",153,0)
 K LRHYMORD
"RTN","LRHYB",154,0)
 K LRHYMULT
"RTN","LRHYB",155,0)
 F LRI=-LRPAST:1:LRAHEAD D
"RTN","LRHYB",156,0)
 .  S X1=DT S X2=LRI D C^%DTC S LR3DTN=X
"RTN","LRHYB",157,0)
 .  ;
"RTN","LRHYB",158,0)
 .  I $D(^LRO(69,LR3DTN,1,"AA",LRDFN)) D
"RTN","LRHYB",159,0)
 ..  S LR3SN=0
"RTN","LRHYB",160,0)
 ..  F  S LR3SN=$O(^LRO(69,LR3DTN,1,"AA",LRDFN,LR3SN)) Q:+LR3SN'>0  D
"RTN","LRHYB",161,0)
 ...  ;
"RTN","LRHYB",162,0)
 ...  Q:$P($G(^LRO(69,LR3DTN,1,LR3SN,1)),U,4)="C"  ;collected
"RTN","LRHYB",163,0)
 ...  S LRTSTX=0
"RTN","LRHYB",164,0)
 ...  F  S LRTSTX=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTX)) Q:+LRTSTX'>0  D
"RTN","LRHYB",165,0)
 ....  S LRIENZZ=$O(^LRO(69,LR3DTN,1,LR3SN,2,"B",LRTSTX,0))
"RTN","LRHYB",166,0)
 ....  ;
"RTN","LRHYB",167,0)
 ....  Q:$G(^LRO(69,LR3DTN,1,LR3SN,2,LRIENZZ,1.1,1,0))'=""
"RTN","LRHYB",168,0)
 ....  K LRCOL99 S LRCOL99=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,3)
"RTN","LRHYB",169,0)
 ....  S LRHYHOK=0 D CSE^LRHYA Q:LRHYHOK
"RTN","LRHYB",170,0)
 ....  S LRCSTAT=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,4)
"RTN","LRHYB",171,0)
 ....  S LRHYHOK=0 D CSTATUS^LRHYA Q:LRHYHOK
"RTN","LRHYB",172,0)
 ....  S LRLLOC66=$P(^LRO(69,LR3DTN,1,LR3SN,0),U,9)
"RTN","LRHYB",173,0)
 ....  S LRHYHOK=0 D EXLOC^LRHYA Q:LRHYHOK
"RTN","LRHYB",174,0)
 ....  S LRHYMULT(LR3DTN,LR3SN,LRIENZZ)=LRTSTX
"RTN","LRHYB",175,0)
 N CNT
"RTN","LRHYB",176,0)
 S CNT=0
"RTN","LRHYB",177,0)
 S LR3DTN=0
"RTN","LRHYB",178,0)
 F  S LR3DTN=$O(LRHYMULT(LR3DTN)) Q:+LR3DTN'>0  S CNT=CNT+1
"RTN","LRHYB",179,0)
 I CNT>1 S LRHYMORD=1
"RTN","LRHYBC1")
0^6^B68703748^B64831523
"RTN","LRHYBC1",1,0)
LRHYBC1 ;DALOI/HOAK - LAB PHLEB AND COLLECTION TIME UPDATER ;11/8/10 1:50pm
"RTN","LRHYBC1",2,0)
 ;;5.2;LAB SERVICE;**405,417,430,446**;Sep 27, 1994;Build 1
"RTN","LRHYBC1",3,0)
 ;
"RTN","LRHYBC1",4,0)
 ; This routine will be used to capture the phlebotomist and the
"RTN","LRHYBC1",5,0)
 ; specimen collection time.
"RTN","LRHYBC1",6,0)
 ;
"RTN","LRHYBC1",7,0)
 ; The barcoded specimen tubes will be waunded.
"RTN","LRHYBC1",8,0)
 ; The phlebotomist ID will then be waunded.
"RTN","LRHYBC1",9,0)
 ;
"RTN","LRHYBC1",10,0)
CONTROL ;
"RTN","LRHYBC1",11,0)
 K LRPTARIV
"RTN","LRHYBC1",12,0)
 K ^TMP("LRHY ASH",$J)
"RTN","LRHYBC1",13,0)
 K LRSCAN
"RTN","LRHYBC1",14,0)
 K DIC,LRHYTECH,LRHYDUZ,LRPHLEB,LRRECVR
"RTN","LRHYBC1",15,0)
 K DIR,DIC,DIE,LRARIVE,LRDRAW
"RTN","LRHYBC1",16,0)
 K DIC,LRHYTECH,LRHYDUZ,LRPHLEB
"RTN","LRHYBC1",17,0)
 K DIR,DIC,DIE,LRARIVE,LRDRAW
"RTN","LRHYBC1",18,0)
 S LRPL=1
"RTN","LRHYBC1",19,0)
 S LREND=0
"RTN","LRHYBC1",20,0)
 D TECH
"RTN","LRHYBC1",21,0)
 I U[X D END QUIT
"RTN","LRHYBC1",22,0)
 Q:X=""  D SINGLE
"RTN","LRHYBC1",23,0)
 D PTSCAN
"RTN","LRHYBC1",24,0)
 Q:X[U
"RTN","LRHYBC1",25,0)
 K LRPL
"RTN","LRHYBC1",26,0)
 K LRPTARIV
"RTN","LRHYBC1",27,0)
 QUIT
"RTN","LRHYBC1",28,0)
FINDER ;
"RTN","LRHYBC1",29,0)
 S DIC="^VA(200,"
"RTN","LRHYBC1",30,0)
 S DIC(0)="AEMQZ"
"RTN","LRHYBC1",31,0)
 S DIC("A")="Please enter employee number: "
"RTN","LRHYBC1",32,0)
 D ^DIC
"RTN","LRHYBC1",33,0)
 QUIT
"RTN","LRHYBC1",34,0)
TECH ;
"RTN","LRHYBC1",35,0)
 K DIC,LRHYTECH,LRHYDUZ,LRPHLEB,LRRECVR
"RTN","LRHYBC1",36,0)
 K DIR,DIC,DIE,LRARIVE,LRDRAW
"RTN","LRHYBC1",37,0)
 ;
"RTN","LRHYBC1",38,0)
 S X=""
"RTN","LRHYBC1",39,0)
 ;
"RTN","LRHYBC1",40,0)
 I X="" S X=DUZ G PST
"RTN","LRHYBC1",41,0)
 I U[X QUIT
"RTN","LRHYBC1",42,0)
 I $L(X)'=9 K DIC,LRHYTECH,LRHYDUZ,LRPHLEB,LRRECV G TECH
"RTN","LRHYBC1",43,0)
 ;
"RTN","LRHYBC1",44,0)
 ;
"RTN","LRHYBC1",45,0)
 ;
"RTN","LRHYBC1",46,0)
 ;
"RTN","LRHYBC1",47,0)
 K DIC
"RTN","LRHYBC1",48,0)
 K DIC,LRHYTECH,LRHYDUZ
"RTN","LRHYBC1",49,0)
 K Y
"RTN","LRHYBC1",50,0)
 S DIC=200
"RTN","LRHYBC1",51,0)
 S DIC(0)="MQZ"
"RTN","LRHYBC1",52,0)
 D ^DIC
"RTN","LRHYBC1",53,0)
 ;
"RTN","LRHYBC1",54,0)
 W Y
"RTN","LRHYBC1",55,0)
 ;
"RTN","LRHYBC1",56,0)
 I X[U QUIT
"RTN","LRHYBC1",57,0)
PST S Y=DUZ
"RTN","LRHYBC1",58,0)
 S (LRHYDUZ,LRHYTECH,LRPHLEB,LRRECVR)=+Y
"RTN","LRHYBC1",59,0)
 S LRHYDUZ=$P($G(^VA(200,LRHYDUZ,0)),U)
"RTN","LRHYBC1",60,0)
 QUIT
"RTN","LRHYBC1",61,0)
 ;
"RTN","LRHYBC1",62,0)
TIME ;
"RTN","LRHYBC1",63,0)
 ;
"RTN","LRHYBC1",64,0)
 ;
"RTN","LRHYBC1",65,0)
 ;
"RTN","LRHYBC1",66,0)
 S LREND=0
"RTN","LRHYBC1",67,0)
 S DIC="^DPT("
"RTN","LRHYBC1",68,0)
 S DIC(0)="AEMQZ"
"RTN","LRHYBC1",69,0)
 D ^DIC
"RTN","LRHYBC1",70,0)
 S DFN=+Y
"RTN","LRHYBC1",71,0)
 S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","LRHYBC1",72,0)
 D ^VADPT,INP^VADPT
"RTN","LRHYBC1",73,0)
 ;
"RTN","LRHYBC1",74,0)
 QUIT
"RTN","LRHYBC1",75,0)
 ;
"RTN","LRHYBC1",76,0)
SINGLE ;
"RTN","LRHYBC1",77,0)
 ; This block calls up the testing demographics.
"RTN","LRHYBC1",78,0)
 ;  LRHYD123 IS LRUID
"RTN","LRHYBC1",79,0)
 W !!
"RTN","LRHYBC1",80,0)
 S LRACC=""
"RTN","LRHYBC1",81,0)
 I $G(LRHYD123)'="" D EN^LA7ADL(LRHYD123)
"RTN","LRHYBC1",82,0)
 ;
"RTN","LRHYBC1",83,0)
 K LRHYD123
"RTN","LRHYBC1",84,0)
 ;
"RTN","LRHYBC1",85,0)
 K LRHN0,LRHNODE,LRN0,LR0NODE,LRPHLEB
"RTN","LRHYBC1",86,0)
 S X="D"
"RTN","LRHYBC1",87,0)
 D ^LRHYU5
"RTN","LRHYBC1",88,0)
 I LRAN<1 QUIT
"RTN","LRHYBC1",89,0)
SETFILE ;
"RTN","LRHYBC1",90,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) W !,"Doesn't exist." G SINGLE
"RTN","LRHYBC1",91,0)
 S LRUNC=1
"RTN","LRHYBC1",92,0)
 S LRORDT1=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,4)
"RTN","LRHYBC1",93,0)
 S LRHYD123=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRHYBC1",94,0)
 I $G(LRHYD123)>0,$D(^LRHY(69.87,"B",LRHYD123)) D  Q
"RTN","LRHYBC1",95,0)
 . W !,"Sorry, Collection Time already recorded!!.",! H 2
"RTN","LRHYBC1",96,0)
 . I $G(LRCNTX) S LRCNTX=LRCNTX-1
"RTN","LRHYBC1",97,0)
 ;  modified by Hoak per Joe for prior to free t-4
"RTN","LRHYBC1",98,0)
 I '$O(^LRHY(69.87,"B",LRHYD123,0)) D
"RTN","LRHYBC1",99,0)
 .  S DA=$P(^LRHY(69.87,0),U,3)
"RTN","LRHYBC1",100,0)
 .  S DA=DA+1
"RTN","LRHYBC1",101,0)
 .  S X=LRHYD123
"RTN","LRHYBC1",102,0)
 .  S DIE="^LRHY(69.87,"
"RTN","LRHYBC1",103,0)
 .  S DR=".01///"_X
"RTN","LRHYBC1",104,0)
 .  S DIK=DIE
"RTN","LRHYBC1",105,0)
 .  D ^DIE
"RTN","LRHYBC1",106,0)
 I '$G(DA) S DA=$P(^LRHY(69.87,0),U,3)+1
"RTN","LRHYBC1",107,0)
 S LRUID=LRHYD123
"RTN","LRHYBC1",108,0)
 S $P(^LRHY(69.87,0),U,3)=DA,$P(^LRHY(69.87,0),U,4)=DA
"RTN","LRHYBC1",109,0)
 S LRSPIEN=$O(^LRHY(69.87,"B",LRUID,0)) I $G(LRSPIEN) D
"RTN","LRHYBC1",110,0)
 .  N LRDT,LRSCAN
"RTN","LRHYBC1",111,0)
 .  S LRDT=$$NOW^XLFDT
"RTN","LRHYBC1",112,0)
 .  I '$G(LRLABTIM) S LRLABTIM=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,3))
"RTN","LRHYBC1",113,0)
 .  S LRSCAN=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,3))
"RTN","LRHYBC1",114,0)
 .  K DIE S DIE="^LRHY(69.87," S DR="2///"_LRSCAN S DA=LRSPIEN D ^DIE
"RTN","LRHYBC1",115,0)
 .  K DIE S DIE="^LRHY(69.87," S DR="4///"_LRDT S DA=LRSPIEN D ^DIE
"RTN","LRHYBC1",116,0)
 .  K DIE S DIE="^LRHY(69.87," S DR="6////"_LRHYTECH S DA=LRSPIEN D ^DIE
"RTN","LRHYBC1",117,0)
 .  K DIE S DIE="^LRHY(69.87," S DR="8///"_LRDT S DA=LRSPIEN D ^DIE
"RTN","LRHYBC1",118,0)
 S DIK=DIE D IX1^DIK
"RTN","LRHYBC1",119,0)
ZZ1 ;
"RTN","LRHYBC1",120,0)
 QUIT:$G(XQY0)'["PPOC"
"RTN","LRHYBC1",121,0)
 H 3
"RTN","LRHYBC1",122,0)
 S ^TMP("LRHY ASH",$J,LRAA,LRAD,LRAN)=""
"RTN","LRHYBC1",123,0)
 G SINGLE
"RTN","LRHYBC1",124,0)
 G END
"RTN","LRHYBC1",125,0)
 ;  Adding urgency to the display
"RTN","LRHYBC1",126,0)
 S LRTEST=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0))
"RTN","LRHYBC1",127,0)
 S LRURG=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTEST,0)),U,2)
"RTN","LRHYBC1",128,0)
 ;
"RTN","LRHYBC1",129,0)
 ; Blink urgency if MED-EMERGE
"RTN","LRHYBC1",130,0)
 W !,$S($D(^LAB(62.05,+LRURG,0)):$P(^(0),U),1:"")," "
"RTN","LRHYBC1",131,0)
 ;
"RTN","LRHYBC1",132,0)
 ;
"RTN","LRHYBC1",133,0)
 D EDIT
"RTN","LRHYBC1",134,0)
 ;
"RTN","LRHYBC1",135,0)
 ;
"RTN","LRHYBC1",136,0)
 I $G(LREND) W !,"Please start over..." K LREND,LRIDTNEW
"RTN","LRHYBC1",137,0)
 D END
"RTN","LRHYBC1",138,0)
 QUIT
"RTN","LRHYBC1",139,0)
 ;
"RTN","LRHYBC1",140,0)
END ;
"RTN","LRHYBC1",141,0)
 K ^TMP("LRHY ASH",$J)
"RTN","LRHYBC1",142,0)
 K LRAA,LRAD,LRAN,LRBLOOD,LRARIVE,LRBLOOD,LRCE,LRDAT,LRDFN,LRIDT
"RTN","LRHYBC1",143,0)
 K LRDLA,LRDLC,LRDPF,LRDRAW,LRDT0,LRDTO,LRHYDUZ,LRHYNISH,LRPRAC
"RTN","LRHYBC1",144,0)
 K LRSN,LRTEST,LRURG,PNM,SSN,VAIN,VADM,LRHYTECH
"RTN","LRHYBC1",145,0)
 QUIT
"RTN","LRHYBC1",146,0)
 ;
"RTN","LRHYBC1",147,0)
EDIT ;
"RTN","LRHYBC1",148,0)
 S LRDFN=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U)
"RTN","LRHYBC1",149,0)
 S LRIDT=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U,5) ; old LRIDT
"RTN","LRHYBC1",150,0)
CHECK ;
"RTN","LRHYBC1",151,0)
 ;
"RTN","LRHYBC1",152,0)
PAST ;
"RTN","LRHYBC1",153,0)
 K LRHYDUZ
"RTN","LRHYBC1",154,0)
 ; look at Micro And CH subscripted tests
"RTN","LRHYBC1",155,0)
 I $D(^LR(LRDFN,"CH",LRIDT)) S LRSS="CH"
"RTN","LRHYBC1",156,0)
 E  S LRSS="MI"
"RTN","LRHYBC1",157,0)
 ;
"RTN","LRHYBC1",158,0)
 ;  run review option here and show it there has been a previous 
"RTN","LRHYBC1",159,0)
 ;  updating of this accession
"RTN","LRHYBC1",160,0)
 ;
"RTN","LRHYBC1",161,0)
 K LRARIVE
"RTN","LRHYBC1",162,0)
 ;
"RTN","LRHYBC1",163,0)
 ;
"RTN","LRHYBC1",164,0)
 W !
"RTN","LRHYBC1",165,0)
 ;  WE need an event to stop non-LRLAB key holders from entering
"RTN","LRHYBC1",166,0)
 ;  LAB ARRIVAL TIME
"RTN","LRHYBC1",167,0)
BACK G:'$D(^XUSEC("LRLAB",DUZ)) THERE
"RTN","LRHYBC1",168,0)
 G THERE
"RTN","LRHYBC1",169,0)
THERE ;
"RTN","LRHYBC1",170,0)
 W !
"RTN","LRHYBC1",171,0)
 K %DT
"RTN","LRHYBC1",172,0)
 D NOW^%DTC
"RTN","LRHYBC1",173,0)
 S %DT="AESRZ"
"RTN","LRHYBC1",174,0)
 S %DT("A")="Please enter updated DRAW/COLLECTION TIME: "
"RTN","LRHYBC1",175,0)
 ;
"RTN","LRHYBC1",176,0)
 ; Only default if lrlab owner
"RTN","LRHYBC1",177,0)
 I +LRDRAW7>0 S LRDRAW7=$$Y2K^LRX(LRDRAW7)
"RTN","LRHYBC1",178,0)
 E  S LRDRAW7=$$Y2K^LRX($P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U))
"RTN","LRHYBC1",179,0)
 I $D(^XUSEC("LRLAB",DUZ)) S %DT("B")=$P(LRDRAW7,"@")_"@"_$E($P(LRDRAW7,"@",2),1,5)
"RTN","LRHYBC1",180,0)
 ;
"RTN","LRHYBC1",181,0)
 I X="" G THERE
"RTN","LRHYBC1",182,0)
 I $D(DTOUT)!($D(DUOUT)) S LREND=1 QUIT
"RTN","LRHYBC1",183,0)
 I Y=-1 S LRUP="YES"
"RTN","LRHYBC1",184,0)
 E  S LRUP="NO"
"RTN","LRHYBC1",185,0)
 D NOW^%DTC S LRDRAW=%
"RTN","LRHYBC1",186,0)
 ;
"RTN","LRHYBC1",187,0)
 ;
"RTN","LRHYBC1",188,0)
 I $D(^XUSEC("LRLAB",DUZ)) G TIC
"RTN","LRHYBC1",189,0)
 ;
"RTN","LRHYBC1",190,0)
GUY ;  COLLECTOR DEMOGRAPHICS stuff this into LR...99 COMMENT FIELD.
"RTN","LRHYBC1",191,0)
 K LRPON
"RTN","LRHYBC1",192,0)
 S LRHYNISH=$P(^VA(200,LRHYTECH,0),U,2)
"RTN","LRHYBC1",193,0)
 I '$D(^XUSEC("LRLAB",LRHYTECH)) S LRPON=$P($G(^VA(200,LRHYTECH,0)),U)
"RTN","LRHYBC1",194,0)
 W !!!
"RTN","LRHYBC1",195,0)
 ;
"RTN","LRHYBC1",196,0)
 ; This global serves as an interim solution until lab files can
"RTN","LRHYBC1",197,0)
 ; be updated
"RTN","LRHYBC1",198,0)
TIC ;
"RTN","LRHYBC1",199,0)
 S LRARIVE=$G(LRARIVE,$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U,3))
"RTN","LRHYBC1",200,0)
 S LRPTARIV=$G(LRPTARIV,LRARIVE)
"RTN","LRHYBC1",201,0)
 ;
"RTN","LRHYBC1",202,0)
 S LRAAX5=LRAA,LRADX6=LRAD,LRANX6=LRAN
"RTN","LRHYBC1",203,0)
 S LRHYDUZ=LRHYTECH
"RTN","LRHYBC1",204,0)
SET ;
"RTN","LRHYBC1",205,0)
 S $P(^LRO(69,LRDAT,1,LRSN,3),U)=$G(LRDRAW)
"RTN","LRHYBC1",206,0)
 S $P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U,3)=$G(LRDRAW)
"RTN","LRHYBC1",207,0)
 S $P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U)=$G(LRDRAW)
"RTN","LRHYBC1",208,0)
 ;
"RTN","LRHYBC1",209,0)
 H 2
"RTN","LRHYBC1",210,0)
 G SINGLE
"RTN","LRHYBC1",211,0)
 QUIT
"RTN","LRHYBC1",212,0)
PTSCAN ;
"RTN","LRHYBC1",213,0)
 ;
"RTN","LRHYBC1",214,0)
 W !!,"Please swipe PATIENT ID CARD or Type SSN: "
"RTN","LRHYBC1",215,0)
 R X:9999999 W !
"RTN","LRHYBC1",216,0)
 Q:X[U
"RTN","LRHYBC1",217,0)
 Q:X=""
"RTN","LRHYBC1",218,0)
 I $L(X)'=9 W !,"NO SUCH PATIENT" QUIT
"RTN","LRHYBC1",219,0)
 S DFN=$O(^DPT("SSN",X,0))
"RTN","LRHYBC1",220,0)
 S PNM=$P(^DPT(DFN,0),U) W !,PNM
"RTN","LRHYBC1",221,0)
 S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","LRHYBC1",222,0)
ACCNX ;
"RTN","LRHYBC1",223,0)
 S LRAA=0
"RTN","LRHYBC1",224,0)
 F  S LRAA=$O(^TMP("LRHY ASH",$J,LRAA)) Q:+LRAA'>0  D
"RTN","LRHYBC1",225,0)
 .  S LRAD=0
"RTN","LRHYBC1",226,0)
 .  F  S LRAD=$O(^TMP("LRHY ASH",$J,LRAA,LRAD)) Q:+LRAD'>0  D
"RTN","LRHYBC1",227,0)
 ..  S LRAN=0
"RTN","LRHYBC1",228,0)
 ..  F  S LRAN=$O(^TMP("LRHY ASH",$J,LRAA,LRAD,LRAN)) Q:+LRAN'>0  D P2
"RTN","LRHYBC1",229,0)
 QUIT
"RTN","LRHYBC1",230,0)
P2 ;
"RTN","LRHYBC1",231,0)
 N LRX S LRX=0
"RTN","LRHYBC1",232,0)
 F  S LRX=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,"B",LRX)) Q:+LRX'>0  D
"RTN","LRHYBC1",233,0)
 .  I LRDFN'=+^LRO(68,LRAA,1,LRAD,1,LRAN,0) W !,"WRONG PATIENT" QUIT
"RTN","LRHYBC1",234,0)
 .  W !,^LRO(68,LRAA,1,LRAD,1,LRAN,.2),?20,$P(^LAB(60,LRX,0),U)
"RTN","LRHYBC1",235,0)
 .  W !,"EVERYTHING MATCHES UP ",$P($P(^VA(200,LRHYTECH,0),U),",",2),", GREAT JOB!"
"RTN","LRHYBC1",236,0)
 .  H 3
"RTN","LRHYBC1",237,0)
 QUIT
"RTN","LRHYBC1",238,0)
LABIN ;
"RTN","LRHYBC1",239,0)
 D ^LRHYU4
"RTN","LRHYBC1",240,0)
 ;
"RTN","LRHYBC1",241,0)
 Q:LRAN=-1
"RTN","LRHYBC1",242,0)
 ;
"RTN","LRHYBC1",243,0)
 I $L(X)'=10 S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRHYBC1",244,0)
 S LRUID=X
"RTN","LRHYBC1",245,0)
 S DA=$O(^LRHY(69.87,"B",LRUID,0))
"RTN","LRHYBC1",246,0)
 I '$G(DA) W !,"Incorrect UID try again..." H 2 G LABIN
"RTN","LRHYBC1",247,0)
 I $D(^LRHY(69.87,DA,10)) W !,"Sorry, Lab Arrival Time already recorded!!",! H 2 G LABIN
"RTN","LRHYBC1",248,0)
 D NOW^%DTC K LRLABIN S LRLABIN=%
"RTN","LRHYBC1",249,0)
 K DIE
"RTN","LRHYBC1",250,0)
 S DIE=69.87
"RTN","LRHYBC1",251,0)
 S DR="10///"_LRLABIN_";12///"_DUZ
"RTN","LRHYBC1",252,0)
 D ^DIE
"RTN","LRHYBC1",253,0)
 G LABIN
"RTN","LRHYBC1",254,0)
DISPLAY ;
"RTN","LRHYBC1",255,0)
 S X="D"
"RTN","LRHYBC1",256,0)
 D ^LRHYU5 I 'LRAN W !,"MUST ENTER UID, TRY AGAIN" H 2 QUIT
"RTN","LRHYBC1",257,0)
 S LRUID=X
"RTN","LRHYBC1",258,0)
 S ZTRTN="D1^LRHYBC1" D IO^LRWU
"RTN","LRHYBC1",259,0)
 QUIT
"RTN","LRHYBC1",260,0)
D1 ;
"RTN","LRHYBC1",261,0)
 I $L(LRUID)'=10 S LRUID=X
"RTN","LRHYBC1",262,0)
 S LRDA=$O(^LRHY(69.87,"B",LRUID,0))
"RTN","LRHYBC1",263,0)
 ;
"RTN","LRHYBC1",264,0)
 ; FIX FOR NOT RUN PL
"RTN","LRHYBC1",265,0)
 I +$G(LRDA)'>0 W !,"NO Entry in HOWDY SPECIMEN TIMES BY UID File. Run Phlebotomy log." H 1 QUIT
"RTN","LRHYBC1",266,0)
 I '$G(^LRHY(69.87,LRDA,2)) D
"RTN","LRHYBC1",267,0)
 .  K DA,DR S DIE="^LRHY(69.87,",DA=LRDA,DR="2///"_$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U) D ^DIE
"RTN","LRHYBC1",268,0)
 W !,"UID: ",LRUID
"RTN","LRHYBC1",269,0)
 W !,"WALK-UP SCAN TIME:",?50,$$Y2K^LRX(^LRHY(69.87,LRDA,2))
"RTN","LRHYBC1",270,0)
 W !,"COLLECTOR:",?50,?50,$P(^VA(200,^LRHY(69.87,LRDA,6),0),U)
"RTN","LRHYBC1",271,0)
 W !,"TIME SPECIMEN COLLECTED:",?50,$$Y2K^LRX(^LRHY(69.87,LRDA,8))
"RTN","LRHYBC1",272,0)
 Q:'$D(^LRHY(69.87,LRDA,10))
"RTN","LRHYBC1",273,0)
 W !,"TIME SCANNED INTO LAB:",?50,$$Y2K^LRX(^LRHY(69.87,LRDA,10))
"RTN","LRHYBC1",274,0)
 I $G(^LRHY(69.87,LRDA,12)) W !,"RECEIVED INTO LAB BY: ",?50,$P(^VA(200,^LRHY(69.87,LRDA,12),0),U)
"RTN","LRHYBC1",275,0)
 QUIT
"RTN","LRHYBC1",276,0)
BINBRD ;
"RTN","LRHYBC1",277,0)
 S ZTRTN="D2^LRHYBC1",ZTSAVE("PNM")=""
"RTN","LRHYBC1",278,0)
 S LRBBRD=$O(^LRHY(69.86,7,54,"B",0)) I $G(LRBBRD) S ZTIO=LRBBRD,ZTDTH=$H S:$D(ZTQUEUED) ZTREQ="@" D ^%ZTLOAD
"RTN","LRHYBC1",279,0)
 QUIT
"RTN","LRHYBC1",280,0)
D2 ;
"RTN","LRHYBC1",281,0)
 U IO
"RTN","LRHYBC1",282,0)
 W !,"PT:",PNM
"RTN","LRHYBC1",283,0)
 D ^%ZISC
"RTN","LRHYBC1",284,0)
 QUIT
"VER")
8.0^22.0
"BLD",9706,6)
^355
**END**
**END**

