Released LR*5.2*444 SEQ #356
Extracted from mail message
**KIDS**:LR*5.2*444^

**INSTALL NAME**
LR*5.2*444
"BLD",9681,0)
LR*5.2*444^LAB SERVICE^0^3140925^y
"BLD",9681,1,0)
^^13^13^3140811^^
"BLD",9681,1,1,0)
This patch is a VM patch that addresses 5 issues in the Lab package:
"BLD",9681,1,2,0)
 
"BLD",9681,1,3,0)
1.      Properly defined tests on an order not accessioning when one
"BLD",9681,1,4,0)
        test is not properly defined.
"BLD",9681,1,5,0)
 
"BLD",9681,1,6,0)
2.      Improperly defined test causes subsequent tests/orders to not
"BLD",9681,1,7,0)
        be accessioned.
"BLD",9681,1,8,0)
 
"BLD",9681,1,9,0)
3.      No warnings when panel test can't be accessioned.
"BLD",9681,1,10,0)
 
"BLD",9681,1,11,0)
4.      Howdy accessioning sometimes generates an <UNDEFINED> error.
"BLD",9681,1,12,0)
 
"BLD",9681,1,13,0)
5.      Accession labels sometimes don't print in Howdy.
"BLD",9681,4,0)
^9.64PA^^
"BLD",9681,6)
3^
"BLD",9681,6.3)
5
"BLD",9681,"ABPKG")
n
"BLD",9681,"KRN",0)
^9.67PA^779.2^20
"BLD",9681,"KRN",.4,0)
.4
"BLD",9681,"KRN",.401,0)
.401
"BLD",9681,"KRN",.402,0)
.402
"BLD",9681,"KRN",.403,0)
.403
"BLD",9681,"KRN",.5,0)
.5
"BLD",9681,"KRN",.84,0)
.84
"BLD",9681,"KRN",3.6,0)
3.6
"BLD",9681,"KRN",3.8,0)
3.8
"BLD",9681,"KRN",9.2,0)
9.2
"BLD",9681,"KRN",9.8,0)
9.8
"BLD",9681,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9681,"KRN",9.8,"NM",1,0)
LROE2^^0^B10836155
"BLD",9681,"KRN",9.8,"NM",2,0)
LRWLST^^0^B35513968
"BLD",9681,"KRN",9.8,"NM",3,0)
LRHYPH2^^0^B12043127
"BLD",9681,"KRN",9.8,"NM","B","LRHYPH2",3)

"BLD",9681,"KRN",9.8,"NM","B","LROE2",1)

"BLD",9681,"KRN",9.8,"NM","B","LRWLST",2)

"BLD",9681,"KRN",19,0)
19
"BLD",9681,"KRN",19.1,0)
19.1
"BLD",9681,"KRN",101,0)
101
"BLD",9681,"KRN",409.61,0)
409.61
"BLD",9681,"KRN",771,0)
771
"BLD",9681,"KRN",779.2,0)
779.2
"BLD",9681,"KRN",870,0)
870
"BLD",9681,"KRN",8989.51,0)
8989.51
"BLD",9681,"KRN",8989.52,0)
8989.52
"BLD",9681,"KRN",8994,0)
8994
"BLD",9681,"KRN","B",.4,.4)

"BLD",9681,"KRN","B",.401,.401)

"BLD",9681,"KRN","B",.402,.402)

"BLD",9681,"KRN","B",.403,.403)

"BLD",9681,"KRN","B",.5,.5)

"BLD",9681,"KRN","B",.84,.84)

"BLD",9681,"KRN","B",3.6,3.6)

"BLD",9681,"KRN","B",3.8,3.8)

"BLD",9681,"KRN","B",9.2,9.2)

"BLD",9681,"KRN","B",9.8,9.8)

"BLD",9681,"KRN","B",19,19)

"BLD",9681,"KRN","B",19.1,19.1)

"BLD",9681,"KRN","B",101,101)

"BLD",9681,"KRN","B",409.61,409.61)

"BLD",9681,"KRN","B",771,771)

"BLD",9681,"KRN","B",779.2,779.2)

"BLD",9681,"KRN","B",870,870)

"BLD",9681,"KRN","B",8989.51,8989.51)

"BLD",9681,"KRN","B",8989.52,8989.52)

"BLD",9681,"KRN","B",8994,8994)

"BLD",9681,"QUES",0)
^9.62^^
"BLD",9681,"REQB",0)
^9.611^2^2
"BLD",9681,"REQB",1,0)
LR*5.2*424^2
"BLD",9681,"REQB",2,0)
LR*5.2*405^2
"BLD",9681,"REQB","B","LR*5.2*405",2)

"BLD",9681,"REQB","B","LR*5.2*424",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
444^3140925^33274
"PKG",26,22,1,"PAH",1,1,0)
^^13^13^3140925
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 5 issues in the Lab package:
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1.      Properly defined tests on an order not accessioning when one
"PKG",26,22,1,"PAH",1,1,4,0)
        test is not properly defined.
"PKG",26,22,1,"PAH",1,1,5,0)
 
"PKG",26,22,1,"PAH",1,1,6,0)
2.      Improperly defined test causes subsequent tests/orders to not
"PKG",26,22,1,"PAH",1,1,7,0)
        be accessioned.
"PKG",26,22,1,"PAH",1,1,8,0)
 
"PKG",26,22,1,"PAH",1,1,9,0)
3.      No warnings when panel test can't be accessioned.
"PKG",26,22,1,"PAH",1,1,10,0)
 
"PKG",26,22,1,"PAH",1,1,11,0)
4.      Howdy accessioning sometimes generates an <UNDEFINED> error.
"PKG",26,22,1,"PAH",1,1,12,0)
 
"PKG",26,22,1,"PAH",1,1,13,0)
5.      Accession labels sometimes don't print in Howdy.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LRHYPH2")
0^3^B12043127^B12074115
"RTN","LRHYPH2",1,0)
LRHYPH2 ;DALOI/HOAK - HOWDY ORDER NUMBER SELECTION ;12/10/10 6:00pm
"RTN","LRHYPH2",2,0)
 ;;5.2;LAB SERVICE;**405,444**;Sep 27, 1994;Build 5
"RTN","LRHYPH2",3,0)
 ;
"RTN","LRHYPH2",4,0)
 ; Reference to ^ORCSAVE2 supported by DBIA #2747.
"RTN","LRHYPH2",5,0)
 ;
"RTN","LRHYPH2",6,0)
 ;
"RTN","LRHYPH2",7,0)
Q15 ;
"RTN","LRHYPH2",8,0)
 ;
"RTN","LRHYPH2",9,0)
 I $G(LRBUTZ) K LRBUTZ G BUT
"RTN","LRHYPH2",10,0)
 Q:$D(LRSTOPZ(LRORD))
"RTN","LRHYPH2",11,0)
 ;
"RTN","LRHYPH2",12,0)
BUT ;
"RTN","LRHYPH2",13,0)
 I $D(^TMP("LRHYDY",$J,"KILL",LRODT,LRSN,1)) S LRSTOPZ(LRORD)="" D LOG^LRHY0 QUIT
"RTN","LRHYPH2",14,0)
 ;
"RTN","LRHYPH2",15,0)
 Q:'$D(^LRO(69,LRODT,1,LRSN,0))
"RTN","LRHYPH2",16,0)
 I M9>1 D LRSPEC^LROE1 S S1=$S($D(^LAB(61,+LRSPEC,0)):$P(^(0),U),1:"") D
"RTN","LRHYPH2",17,0)
 .  S S2=$P(^LAB(62,LRSAMP,0),U),S4=$P(^(0),U,3)
"RTN","LRHYPH2",18,0)
 .  S S3=S1_$S(S1'=S2:"  "_S2,1:"")
"RTN","LRHYPH2",19,0)
 .  K S1,S2,S3,S4 S %=2
"RTN","LRHYPH2",20,0)
 S DA=DT,LRDFN=+^LRO(69,LRODT,1,LRSN,0),LRDPF=+$P(^LR(LRDFN,0),U,2)
"RTN","LRHYPH2",21,0)
 ; MODIFIED FOR VERSION 8 10/31
"RTN","LRHYPH2",22,0)
 I $D(LRSND),$P(^LRO(69,LRODT,1,LRSN,0),U,4)="LC",$D(^(1)) S LRLLOC=$P(^(0),U,7),LROLLOC=$P(^(0),U,9),LRNT=$S($D(LRNT):LRNT,$D(LRTIM):LRTIM,$D(LRCDT):+LRCDT,1:"") D P15^LRPHITEM G PH
"RTN","LRHYPH2",23,0)
 I $D(LRSND) N LRHYCOMB S LRHYCOMB=$P($G(^LRO(69,LRODT,1,LRSN,1)),U,7) D
"RTN","LRHYPH2",24,0)
 .  S DIE="^LRO(69,"_LRODT_",1,",DA(1)=LRODT,DA=LRSN,DR="10////"_LRTIM D ^DIE
"RTN","LRHYPH2",25,0)
 .  S DIE="^LRO(69,"_LRODT_",1,",DA(1)=LRODT,DA=LRSN,DR="12////"_DUZ D ^DIE
"RTN","LRHYPH2",26,0)
 .  S DIE="^LRO(69,"_LRODT_",1,",DA(1)=LRODT,DA=LRSN,DR="13////"_LRSTATUS D ^DIE
"RTN","LRHYPH2",27,0)
PH G Q16:LRORD D ORDER^LROW2 G Q16A
"RTN","LRHYPH2",28,0)
Q16 S J=0 D CHECK^LROW2 I J D BAD^LROW2
"RTN","LRHYPH2",29,0)
Q16A I $D(LRLONG),$D(LRSND) S LRSN=LRSND,^TMP("LRHYDY",$J,"LROE",$J,"LRORD")=LRORD_U_LRODT_U_LRTIM_U_PNM_U_SSN
"RTN","LRHYPH2",30,0)
 K DR S LRTSTS=0
"RTN","LRHYPH2",31,0)
 S LRSN=0 F  S LRSN=$O(LRSN(LRSN)) Q:'LRSN  D Q17
"RTN","LRHYPH2",32,0)
 I $D(LRLONG),$D(LRSND) S LRSN=LRSND D LROE^LRFAST S X=^TMP("LRHYDY",$J,"LROE",$J,"LRORD"),LRORD=+X,LRODT=$P(X,"^",2),LRTIM=$P(X,"^",3),LRLONG="",PNM=$P(X,"^",4),SSN=$P(X,"^",5)
"RTN","LRHYPH2",33,0)
 Q
"RTN","LRHYPH2",34,0)
Q17 ;
"RTN","LRHYPH2",35,0)
 I $D(LRHYCS33(LRODT,LRSN)) I $D(^LRHY(69.86,LRHYSITE,4,"B",LRHYCS33(LRODT,LRSN))) K LRHYCS33(LRODT,LRSN) QUIT
"RTN","LRHYPH2",36,0)
 S LRHYDJOB=$O(^TMP("LRHYDY",0))
"RTN","LRHYPH2",37,0)
 S I=$O(^LRO(69,LRODT,1,LRSN,6,0)),J=$O(^(1)) S:'$D(IOM) IOM=80 K LRSPCDSC S:J LRSPCDSC=^(J,0) S:I DA=LRSN,DA(1)=LRODT,DR=6,DIC="^LRO(69,"_LRODT_",1," D EN^DIQ:I D LRSPEC^LROE1
"RTN","LRHYPH2",38,0)
 ;
"RTN","LRHYPH2",39,0)
 Q:$D(^TMP("LRHYDY",$J,"KILL",LRODT,LRSN))
"RTN","LRHYPH2",40,0)
 S LRLABLIO=LRDEV S ZTIO=LRDEV
"RTN","LRHYPH2",41,0)
 D ^LRHYBL1
"RTN","LRHYPH2",42,0)
 I $G(LRLABSTP)'="" S LRLABLIO=$P(^%ZIS(1,LRDEV,0),U)_";"_LRLABSTP
"RTN","LRHYPH2",43,0)
 ; get around comments on Howdy screen
"RTN","LRHYPH2",44,0)
 Q:$D(^TMP("LRHYDY",$J,"KILL",LRODT,LRSN))
"RTN","LRHYPH2",45,0)
 S DTIME=.5
"RTN","LRHYPH2",46,0)
 ;
"RTN","LRHYPH2",47,0)
 S LRQUIET=1
"RTN","LRHYPH2",48,0)
 Q:$D(LROLT1(LRODT,LRSN))
"RTN","LRHYPH2",49,0)
 K LRCCOM,X,LRCCOMX,LRCCOM0
"RTN","LRHYPH2",50,0)
 ; The call to OLD^LRORDST hands off the accessioning process and
"RTN","LRHYPH2",51,0)
 ; updating of lab files
"RTN","LRHYPH2",52,0)
 ;
"RTN","LRHYPH2",53,0)
 S LR33ORD=LRORD
"RTN","LRHYPH2",54,0)
 ;K LRORD
"RTN","LRHYPH2",55,0)
 D OLD^LRORDST
"RTN","LRHYPH2",56,0)
 S LRORD=LR33ORD
"RTN","LRHYPH2",57,0)
 I $G(LRUID)'="" D NOW^%DTC S ^TMP("LRHYHOW1",$J,LRUID)=%_U_DUZ
"RTN","LRHYPH2",58,0)
 S DTIME=$$DTIME^XUP(DUZ)
"RTN","LRHYPH2",59,0)
 D D1^LRHYU
"RTN","LRHYPH2",60,0)
 ;
"RTN","LRHYPH2",61,0)
 S ^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LRHYPH2",62,0)
 S LRORIEN=$P($G(^LRO(69,LRODT,1,LRSN,0)),U,11)
"RTN","LRHYPH2",63,0)
 I $G(LRORIEN) D
"RTN","LRHYPH2",64,0)
 .  D STATUS^ORCSAVE2(LRORIEN,6)
"RTN","LRHYPH2",65,0)
 Q:$G(LRNOTEST)  D
"RTN","LRHYPH2",66,0)
 .  K DA,DR S DIE="^LRO(69,"_LRODT_",1,",DA(1)=LRODT,DA=LRSN,DR="12////"_DUZ D ^DIE
"RTN","LRHYPH2",67,0)
 .  K DA,DR S DIE="^LRO(69,"_LRODT_",1,",DA(1)=LRODT,DA=LRSN,DR="13////C" D ^DIE
"RTN","LRHYPH2",68,0)
 Q
"RTN","LROE2")
0^1^B10836155^B11045939
"RTN","LROE2",1,0)
LROE2 ;DALISC/FHS - CONTINUED MORE ORDER ENTRY ;8/11/97
"RTN","LROE2",2,0)
 ;;5.2;LAB SERVICE;**121,424,444**;Sep 27, 1994;Build 5
"RTN","LROE2",3,0)
 ;Formerly apart of LROE1
"RTN","LROE2",4,0)
Q15 ;from LROE1
"RTN","LROE2",5,0)
 Q:'$D(^LRO(69,LRODT,1,LRSN,0))
"RTN","LROE2",6,0)
 I $D(^LRO(69,LRODT,1,LRSN,1)),$P(^(1),"^",4)="U" W !,"This specimen has already been marked as UNCOLLECTED. Are you sure" S %=2 D YN^DICN Q:%'=1  S ^(1)=LRTIM_"^^"_DUZ,DA=LRSN,DA(1)=LRODT,DIE="^LRO(69,"_DA(1)_",1,",DR=16 D ^DIE
"RTN","LROE2",7,0)
 I M9>1 D LRSPEC^LROE1 S S1=$S($D(^LAB(61,+LRSPEC,0)):$P(^(0),U),1:""),S2=$P(^LAB(62,LRSAMP,0),U),S4=$P(^(0),U,3),S3=S1_$S(S1'=S2:"  "_S2,1:"") W !,"Do you have the  ",S3,"  ",S4 K S1,S2,S3,S4 S %=2 D YN^DICN G Q15:%=0 Q:%'=1
"RTN","LROE2",8,0)
 S DA=DT,LRDFN=+^LRO(69,LRODT,1,LRSN,0),LRDPF=+$P(^LR(LRDFN,0),U,2)
"RTN","LROE2",9,0)
 IF '$D(^LRO(69,LRODT,1,LRSN,1)) S LRSTATUS="C",DA=LRODT I '$D(LRSND) D P15^LROE1 Q:LRCDT<1
"RTN","LROE2",10,0)
 I $D(LRSND),$P(^LRO(69,LRODT,1,LRSN,0),U,4)="LC",$D(^(1)) S LRLLOC=$P(^(0),U,7),LROLLOC=$P(^(0),U,9),LRNT=$S($D(LRNT):LRNT,$D(LRTIM):LRTIM,$D(LRCDT):+LRCDT,1:"") D P15^LRPHITEM G PH
"RTN","LROE2",11,0)
 I $D(LRSND) N COMB S COMB=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7) S ^LRO(69,LRODT,1,LRSN,1)=LRTIM_"^"_LRUN_"^"_DUZ_"^"_LRSTATUS_"^^^"_COMB_"^"_DUZ(2) S:LRSTATUS="C" ^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LROE2",12,0)
PH G Q16:LRORD D ORDER^LROW2 G Q16A
"RTN","LROE2",13,0)
Q16 S J=0 D CHECK^LROW2 I J D BAD^LROW2
"RTN","LROE2",14,0)
Q16A I $D(LRLONG),$D(LRSND) S LRSN=LRSND,^TMP("LROE",$J,"LRORD")=LRORD_U_LRODT_U_LRTIM_U_PNM_U_SSN
"RTN","LROE2",15,0)
 K DR S LRTSTS=0
"RTN","LROE2",16,0)
 S LRSN=0 F  S LRSN=$O(LRSN(LRSN)) Q:'LRSN  D Q17
"RTN","LROE2",17,0)
 I $D(LRLONG),$D(LRSND) S LRSN=LRSND D LROE^LRFAST S X=^TMP("LROE",$J,"LRORD"),LRORD=+X,LRODT=$P(X,"^",2),LRTIM=$P(X,"^",3),LRLONG="",PNM=$P(X,"^",4),SSN=$P(X,"^",5)
"RTN","LROE2",18,0)
 Q
"RTN","LROE2",19,0)
Q17 S I=$O(^LRO(69,LRODT,1,LRSN,6,0)),J=$O(^(1)) S:'$D(IOM) IOM=80 K LRSPCDSC S:J LRSPCDSC=^(J,0) S:I DA=LRSN,DA(1)=LRODT,DR=6,DIC="^LRO(69,"_LRODT_",1," D EN^DIQ:I D LRSPEC^LROE1
"RTN","LROE2",20,0)
 D OLD^LRORDST K ^TMP("LR",$J,"TMP")
"RTN","LROE2",21,0)
 S $P(^LRO(69,LRODT,1,LRSN,1),U,4)="C",$P(^LRO(69,LRODT,1,LRSN,1),U,8)=DUZ(2),^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LROE2",22,0)
 Q
"RTN","LRWLST")
0^2^B35513968^B33834407
"RTN","LRWLST",1,0)
LRWLST ;FHS/DALOI - ACCESSION SETUP. LROE1,LRSTIK & LRFAST CALL HERE ; Aug 9, 2004
"RTN","LRWLST",2,0)
 ;;5.2;LAB SERVICE;**46,65,100,121,153,202,290,424,444**;Sep 27, 1994;Build 5
"RTN","LRWLST",3,0)
 N LRPWL,LRPWDT,LRPWLE
"RTN","LRWLST",4,0)
 D DT^LRX
"RTN","LRWLST",5,0)
 Q:$G(LRKIL)
"RTN","LRWLST",6,0)
 D:$D(XRTL) T0^%ZOSV ; START RESPONSE TIME LOGGING
"RTN","LRWLST",7,0)
 S LRCDT=+^LRO(69,LRODT,1,LRSN,1),LREAL=$P(^(1),U,2),X=^(0),LRLLOC=$P(X,U,7),LROLLOC=$P(X,U,9),LRORIFN=$P(X,"^",11)
"RTN","LRWLST",8,0)
 D LRAA,^LRWLST1
"RTN","LRWLST",9,0)
 S LRCDT=(+LRCDT)_"^"_LREAL
"RTN","LRWLST",10,0)
 I '$L($P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7)) S CONTROL=$S($L(LRORIFN):"SC",1:"SN") D NEW^LR7OB1(LRODT,LRSN,CONTROL,,,6)
"RTN","LRWLST",11,0)
 K LRTSTS,LRAAMSG,^TMP("LR",$J,"TMP"),LRNM,DIC,I,LRORIFN,LRBACK
"RTN","LRWLST",12,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV ; STOP RESPONSE TIME LOGGING
"RTN","LRWLST",13,0)
 Q
"RTN","LRWLST",14,0)
 ;
"RTN","LRWLST",15,0)
LRAA ;
"RTN","LRWLST",16,0)
 K LRTSTS,LRAAMSG,^TMP("LR",$J,"TMP")
"RTN","LRWLST",17,0)
 S LRTSTS=0,LRIX=0,S5=0,LRTN=0
"RTN","LRWLST",18,0)
 F  S LRTN=$O(^LRO(69,LRODT,1,LRSN,2,LRTN)) Q:LRTN<1  D
"RTN","LRWLST",19,0)
 . N LRX
"RTN","LRWLST",20,0)
 . S LRX=^(LRTN,0) I '$P(LRX,U,3),'$P(LRX,U,6),'$P(LRX,U,8),'$P(LRX,U,11) S LRORIFN=$P(LRX,"^",7),LRBACK=$P(LRX,"^",14) D SET
"RTN","LRWLST",21,0)
WL1 ;
"RTN","LRWLST",22,0)
 ; LRDAA is used by POC interface to specify the POC accession area.
"RTN","LRWLST",23,0)
 S LRIX=0
"RTN","LRWLST",24,0)
 F  S LRIX=$O(^TMP("LR",$J,"TMP",LRIX)) Q:LRIX<1  D
"RTN","LRWLST",25,0)
 . S X=^(LRIX),LRTSTS=+X,LRURG=$P(X,"^",2),LRORIFN=$P(X,"^",4),LRBACK=$P(X,"^",5)
"RTN","LRWLST",26,0)
 . S LRST=^LAB(60,LRTSTS,0)
"RTN","LRWLST",27,0)
 . S LRAA=$S($G(LRDAA)>0:LRDAA,$D(^LAB(60,LRTSTS,8,$S($G(LRDUZ(2))>0:LRDUZ(2),1:DUZ(2)),0)):$P(^(0),U,2),1:"")
"RTN","LRWLST",28,0)
 . S LRNM=$P(LRST,U),LRUNQ=+$P(LRST,U,7)
"RTN","LRWLST",29,0)
 . D WL2
"RTN","LRWLST",30,0)
 Q
"RTN","LRWLST",31,0)
 ;
"RTN","LRWLST",32,0)
WL2 ;
"RTN","LRWLST",33,0)
 D FWL:$G(LRAA)="" Q:LRAA=""
"RTN","LRWLST",34,0)
 S LRWL0=^LRO(68,LRAA,0),LRSS=$P(LRWL0,U,2),LRIDIV=$S($L($P(LRWL0,U,19)):$P(LRWL0,U,19),1:"CP")
"RTN","LRWLST",35,0)
 I '$D(LRPHSET),$D(LRNCWL) W !,LRNM," TO ",$P(^LRO(68,LRAA,0),U)," accessions","? Y//" D YN Q:X="^"  IF X["N" S LRAA="" G WL2
"RTN","LRWLST",36,0)
 ;added following line to support unique ID/DALISC/JRR
"RTN","LRWLST",37,0)
 I $P($G(^LRO(68,LRAA,.4)),U)="" D  S LRAA="" Q
"RTN","LRWLST",38,0)
 . W:'$D(LRPHSET) !!?5,"You must enter a 'Numeric Identifier' in field .4 of the Accession file!!",!?10,"Accession Area ",$P($G(^LRO(68,+$G(LRAA),0)),U),!
"RTN","LRWLST",39,0)
 . D UNDO
"RTN","LRWLST",40,0)
 S LRPWL=$P($G(^LRO(68,LRAA,0)),U,4)
"RTN","LRWLST",41,0)
 I LRPWL,$P($G(^LRO(68,LRPWL,.4)),U)="" D  S LRAA="" Q
"RTN","LRWLST",42,0)
 . I $G(LRQUIET) D UNDO Q
"RTN","LRWLST",43,0)
 . W:'$D(LRPHSET) !!?5,"You must enter a 'Numeric Identifier' in field .4 of the Accession file!!"
"RTN","LRWLST",44,0)
 . W !?10,"COMMON Accession Area ",$P($G(^LRO(68,+$G(LRPWL),0)),U),!
"RTN","LRWLST",45,0)
 . D UNDO
"RTN","LRWLST",46,0)
 ;
"RTN","LRWLST",47,0)
 S LRWLC=$P(LRWL0,U,4)
"RTN","LRWLST",48,0)
 S:'LRWLC LRWLC=LRAA
"RTN","LRWLST",49,0)
 S LRTSTS(LRWLC,LRUNQ,LRAA)=LRSS_U_$P(LRWL0,U,12),LRTSTS(LRWLC,LRUNQ,LRAA,LRIX)=^TMP("LR",$J,"TMP",LRIX)
"RTN","LRWLST",50,0)
 Q
"RTN","LRWLST",51,0)
SET ;
"RTN","LRWLST",52,0)
 I $G(LRORDRR)="R" S LRTEST(LRTN)=$G(^LRO(69,LRODT,1,LRSN,2,LRTN,0))
"RTN","LRWLST",53,0)
 S S5=S5+1,I5=$G(^LRO(69,LRODT,1,LRSN,2,LRTN,0))
"RTN","LRWLST",54,0)
 I I5 S ^TMP("LR",$J,"TMP",S5)=$P(I5,U)_U_$P(I5,U,2)_U_LRTN_U_LRORIFN_U_LRBACK_U_$S($G(LRTSP):LRTSP,1:$P(I5,U)),I5=LRTN
"RTN","LRWLST",55,0)
 Q
"RTN","LRWLST",56,0)
FWL ;
"RTN","LRWLST",57,0)
 I $O(^LAB(60,LRTSTS,2,0))>0 D EXP S $P(^LRO(69,LRODT,1,LRSN,2,$P(^TMP("LR",$J,"TMP",LRIX),U,3),0),U,8)=1 Q
"RTN","LRWLST",58,0)
 ;
"RTN","LRWLST",59,0)
 I '$D(LRNCWL) D
"RTN","LRWLST",60,0)
 . N LRTEST,LRPARENT
"RTN","LRWLST",61,0)
 . S LRTEST=$P(^TMP("LR",$J,"TMP",LRIX),U)
"RTN","LRWLST",62,0)
 . S LRPARENT=$P(^TMP("LR",$J,"TMP",LRIX),U,6)
"RTN","LRWLST",63,0)
 . I LRPARENT'="",LRTEST'=LRPARENT,'$D(LRAAMSG(LRPARENT)) D
"RTN","LRWLST",64,0)
 . . W !,$P(^LAB(60,LRPARENT,0),U)," does not have an appropriate accession area",!
"RTN","LRWLST",65,0)
 . . S LRAAMSG(LRPARENT)=""
"RTN","LRWLST",66,0)
 ;
"RTN","LRWLST",67,0)
 I '$D(LRNCWL),$D(LRPHSET),LRPHSET W !,"NO ACCESSION AREA FOR ORDER NUMBER ",^LRO(69,LRODT,1,LRSN,.1)," TEST ",$P(^LAB(60,LRTSTS,0),U),! D UNDO Q
"RTN","LRWLST",68,0)
 I '$D(LRNCWL) W !,LRNM," does not have an appropriate accession area.",!,"ORDER # ",LRORD," IS NOT ACCESSIONED",! S LRAA="" D UNDO Q
"RTN","LRWLST",69,0)
 W !,"For test: ",LRNM
"RTN","LRWLST",70,0)
 K DIC
"RTN","LRWLST",71,0)
 S DIC("S")="I '$L($P(^(0),U,17))",DIC="^LRO(68,",DIC(0)="AEFOQZ"
"RTN","LRWLST",72,0)
 D ^DIC
"RTN","LRWLST",73,0)
 K DIC
"RTN","LRWLST",74,0)
 I $D(DUOUT) S LRAA="" Q
"RTN","LRWLST",75,0)
 G:Y<1 FWL
"RTN","LRWLST",76,0)
 S LRAA=+Y
"RTN","LRWLST",77,0)
 Q
"RTN","LRWLST",78,0)
EXP ;
"RTN","LRWLST",79,0)
 S I=0
"RTN","LRWLST",80,0)
 F  S I=$O(^LAB(60,LRTSTS,2,I)) Q:I<1  S J=+^(I,0),S5=S5+1,I5=I5+1,^TMP("LR",$J,"TMP",S5)=J_"^"_LRURG_"^"_I5_"^"_LRORIFN_"^"_LRBACK_"^"_$S($G(LRTSP):LRTSP,1:LRTSTS)
"RTN","LRWLST",81,0)
 Q
"RTN","LRWLST",82,0)
PRESET ;
"RTN","LRWLST",83,0)
 I '($D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2) K ^LRO(68,LRAA,1,LRAD,1,LRAN) Q
"RTN","LRWLST",84,0)
 S LROLRDFN=+^LRO(68,LRAA,1,LRAD,1,LRAN,0)
"RTN","LRWLST",85,0)
 I $L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,5)) S LRDPF=$P(^LR(LROLRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,"  ",SSN," has that log #." S LREND=1 Q  ;W !,"   OK to change it? N//" D YN I X=""!(X'["Y") S LREND=1 Q
"RTN","LRWLST",86,0)
 S LRIDT=9999999-^LRO(68,LRAA,1,LRAD,1,LRAN,3)
"RTN","LRWLST",87,0)
 Q:'$D(^LR(LROLRDFN,LRSS,LRIDT,0))
"RTN","LRWLST",88,0)
PR2 ;
"RTN","LRWLST",89,0)
 S LRNIDT=9999999-LRCDT
"RTN","LRWLST",90,0)
 F  Q:'$D(^LR(LRDFN,LRSS,LRNIDT,0))  D
"RTN","LRWLST",91,0)
 . S LRCDT=$$FMADD^XLFDT(LRCDT,,,,1)
"RTN","LRWLST",92,0)
 . S LRNIDT=9999999-LRCDT
"RTN","LRWLST",93,0)
 I $P(^LR(LROLRDFN,LRSS,LRIDT,0),U,3) S LREND=1 W !,$C(7),"CAN'T DO IT.  The data has been verified for that log number." Q
"RTN","LRWLST",94,0)
 S ^LR(LRDFN,LRSS,LRNIDT,0)=LRCDT_U_LREAL_U_$P(^LR(LROLRDFN,LRSS,LRIDT,0),U,3,4)_U_U_$P(^(0),U,6,99)
"RTN","LRWLST",95,0)
 S J=0 F  S J=$O(^LR(LROLRDFN,LRSS,LRIDT,J)) Q:J<1  S ^LR(LRDFN,LRSS,LRNIDT,J)=^LR(LROLRDFN,LRSS,LRIDT,J)
"RTN","LRWLST",96,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LROSN=$P(X,U,5),LROID=$P(X,U,6),LROCN=$S($D(^(.1)):$P(^(.1),U),1:"")
"RTN","LRWLST",97,0)
 K:$L(LROID) ^LRO(68,LRAA,1,LRAD,1,"C",LROID,LRAN)
"RTN","LRWLST",98,0)
 K:$L(LROCN) ^LRO(68,LRAA,1,LRAD,1,"D",LROCN,LRAN)
"RTN","LRWLST",99,0)
 K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LR(LROLRDFN,LRSS,LRIDT)
"RTN","LRWLST",100,0)
 Q
"RTN","LRWLST",101,0)
YN ;
"RTN","LRWLST",102,0)
 R X:DTIME
"RTN","LRWLST",103,0)
 S:'$T DTOUT=1
"RTN","LRWLST",104,0)
 Q:X=""!(X["N")!(X["Y")
"RTN","LRWLST",105,0)
 W !,"Answer 'Y' or 'N': " G YN
"RTN","LRWLST",106,0)
UNDO ;Clean up ^LRO(69
"RTN","LRWLST",107,0)
 N X,TST
"RTN","LRWLST",108,0)
 S LRIFN=+$O(^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS,0))  Q:LRIFN<1
"RTN","LRWLST",109,0)
 S $P(^LRO(69,LRODT,1,LRSN,2,LRIFN,0),"^",3,6)="^^^"
"RTN","LRWLST",110,0)
 S $P(^LRO(69,LRODT,1,LRSN,1),U,4)="U" ;,$P(^(1),U,6)=LRNM_" NOT ACCESSIONED - TEST DEFINITION INCOMPLETE"
"RTN","LRWLST",111,0)
 Q
"RTN","LRWLST",112,0)
 S X=$G(^LRO(69,LRODT,1,LRSN,2,LRIFN,0)) Q:'X  S TST(+X)=""
"RTN","LRWLST",113,0)
 S X=$S($D(^LRO(69,LRODT,1,LRSN,2,LRIFN,1.1,0)):$P(^(0),"^",3),1:0)+1,^(0)="^^"_X_"^"_X_"^"_DT,^(X,0)="Not accessioned - Test definition incomplete"
"RTN","LRWLST",114,0)
 D NEW^LR7OB1(LRODT,LRSN,"OC",,.TST)
"RTN","LRWLST",115,0)
 S $P(^LRO(69,LRODT,1,LRSN,2,LRIFN,0),"^",3,6)="^^^",$P(^(0),"^",9,11)="CA^L^"_DUZ
"RTN","LRWLST",116,0)
 Q
"RTN","LRWLST",117,0)
OR ;from LRPHITEM
"RTN","LRWLST",118,0)
 I $G(LRORDRR)="R" S LRTEST(LRTN)=$G(^LRO(69,LRODT,1,LRSN,2,LRTN,0)) Q
"RTN","LRWLST",119,0)
 Q
"VER")
8.0^22.0
"BLD",9681,6)
^356
**END**
**END**

