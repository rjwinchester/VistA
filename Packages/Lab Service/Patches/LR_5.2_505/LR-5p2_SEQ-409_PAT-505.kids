Released LR*5.2*505 SEQ #409
Extracted from mail message
**KIDS**:LR*5.2*505^

**INSTALL NAME**
LR*5.2*505
"BLD",10747,0)
LR*5.2*505^LAB SERVICE^0^3180710^y
"BLD",10747,1,0)
^^1^1^3180423^
"BLD",10747,1,1,0)
NOTIFY TIER 2 OF FILE 60 UNDEF IF PRESENT
"BLD",10747,4,0)
^9.64PA^^
"BLD",10747,6.3)
4
"BLD",10747,"KRN",0)
^9.67PA^779.2^20
"BLD",10747,"KRN",.4,0)
.4
"BLD",10747,"KRN",.401,0)
.401
"BLD",10747,"KRN",.402,0)
.402
"BLD",10747,"KRN",.403,0)
.403
"BLD",10747,"KRN",.5,0)
.5
"BLD",10747,"KRN",.84,0)
.84
"BLD",10747,"KRN",3.6,0)
3.6
"BLD",10747,"KRN",3.8,0)
3.8
"BLD",10747,"KRN",9.2,0)
9.2
"BLD",10747,"KRN",9.8,0)
9.8
"BLD",10747,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10747,"KRN",9.8,"NM",1,0)
LRCAPPH3^^0^B57510272
"BLD",10747,"KRN",9.8,"NM","B","LRCAPPH3",1)

"BLD",10747,"KRN",19,0)
19
"BLD",10747,"KRN",19.1,0)
19.1
"BLD",10747,"KRN",101,0)
101
"BLD",10747,"KRN",409.61,0)
409.61
"BLD",10747,"KRN",771,0)
771
"BLD",10747,"KRN",779.2,0)
779.2
"BLD",10747,"KRN",870,0)
870
"BLD",10747,"KRN",8989.51,0)
8989.51
"BLD",10747,"KRN",8989.52,0)
8989.52
"BLD",10747,"KRN",8994,0)
8994
"BLD",10747,"KRN","B",.4,.4)

"BLD",10747,"KRN","B",.401,.401)

"BLD",10747,"KRN","B",.402,.402)

"BLD",10747,"KRN","B",.403,.403)

"BLD",10747,"KRN","B",.5,.5)

"BLD",10747,"KRN","B",.84,.84)

"BLD",10747,"KRN","B",3.6,3.6)

"BLD",10747,"KRN","B",3.8,3.8)

"BLD",10747,"KRN","B",9.2,9.2)

"BLD",10747,"KRN","B",9.8,9.8)

"BLD",10747,"KRN","B",19,19)

"BLD",10747,"KRN","B",19.1,19.1)

"BLD",10747,"KRN","B",101,101)

"BLD",10747,"KRN","B",409.61,409.61)

"BLD",10747,"KRN","B",771,771)

"BLD",10747,"KRN","B",779.2,779.2)

"BLD",10747,"KRN","B",870,870)

"BLD",10747,"KRN","B",8989.51,8989.51)

"BLD",10747,"KRN","B",8989.52,8989.52)

"BLD",10747,"KRN","B",8994,8994)

"BLD",10747,"QUES",0)
^9.62^^
"BLD",10747,"REQB",0)
^9.611^1^1
"BLD",10747,"REQB",1,0)
LR*5.2*291^1
"BLD",10747,"REQB","B","LR*5.2*291",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950611
"PKG",26,22,1,"PAH",1,0)
505^3180710
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3180710
"PKG",26,22,1,"PAH",1,1,1,0)
NOTIFY TIER 2 OF FILE 60 UNDEF IF PRESENT
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRCAPPH3")
0^1^B57510272^B41949665
"RTN","LRCAPPH3",1,0)
LRCAPPH3 ;DALOI/FHS/PC - CHECK CPT CODE AND FILE POINTERS ;Apr 20,2018@12:12pm
"RTN","LRCAPPH3",2,0)
 ;;5.2;LAB SERVICE;**263,291,505**;Sep 27, 1994;Build 4
"RTN","LRCAPPH3",3,0)
 ;Called from LRCAPPH,LRCAPPH4
"RTN","LRCAPPH3",4,0)
EN ;
"RTN","LRCAPPH3",5,0)
 K ^TMP("LRCAPPH",$J),LRSEP S LRSEP(1)="==================="
"RTN","LRCAPPH3",6,0)
 S LRSEP(2)="****************"
"RTN","LRCAPPH3",7,0)
 K %DT S %DT="",X="T+5" D ^%DT S LRPGDT=Y
"RTN","LRCAPPH3",8,0)
 S ^TMP("LRCAPPH",$J,0)=Y_U_$$NOW^XLFDT_U_"LAB CPT DATA CHECKER"
"RTN","LRCAPPH3",9,0)
 S ^TMP("LRCAPPH60",$J,0)=Y_U_$$NOW^XLFDT_U_"LAB 60 CPT DATA CHECKER"
"RTN","LRCAPPH3",10,0)
 K %DT S %DT="" S X="T-1" D ^%DT S LRINADT=$$FMTE^XLFDT(Y,1)
"RTN","LRCAPPH3",11,0)
 S LRINADTX=Y K %DT
"RTN","LRCAPPH3",12,0)
AA  ;Look for CPT processing errors
"RTN","LRCAPPH3",13,0)
 D
"RTN","LRCAPPH3",14,0)
 . N LRAAN,LRCE,LRTXT,LRX
"RTN","LRCAPPH3",15,0)
 . S LRAAN="^LRO(69,""AA"")"
"RTN","LRCAPPH3",16,0)
 . F  S LRAAN=$Q(@LRAAN) Q:$QS(LRAAN,2)'="AA"  D
"RTN","LRCAPPH3",17,0)
 . . S LRX=@LRAAN Q:'LRX  S LRCE=$QS(LRAAN,3)
"RTN","LRCAPPH3",18,0)
 . . K LRTXT
"RTN","LRCAPPH3",19,0)
 . . S LRTXT="Lab Order Number "_LRCE_" "
"RTN","LRCAPPH3",20,0)
 . . I LRX<1 D
"RTN","LRCAPPH3",21,0)
 . . . S LRTXT(1)=LRTXT_" was rejected by the PCE API "
"RTN","LRCAPPH3",22,0)
 . . I LRX=2 D
"RTN","LRCAPPH3",23,0)
 . . . S LRTXT(1)=LRTXT_"has no Institution for the ordering location."
"RTN","LRCAPPH3",24,0)
 . . I LRX=3 D
"RTN","LRCAPPH3",25,0)
 . . . S LRTXT(1)=LRTXT_"Provider is InActive."
"RTN","LRCAPPH3",26,0)
 . . I LRX=4 D
"RTN","LRCAPPH3",27,0)
 . . . S LRTXT(1)=LRTXT_"Not Processed  "
"RTN","LRCAPPH3",28,0)
 . . . S LRTXT(2)=" - No DEFAULT LAB OOS LOCATION defined."
"RTN","LRCAPPH3",29,0)
 . . I LRX=5 D
"RTN","LRCAPPH3",30,0)
 . . . S LRTXT(1)=LRTXT_"Ordering Location "
"RTN","LRCAPPH3",31,0)
 . . . S LRTXT(2)=" has no STOP CODE NUMBER defined."
"RTN","LRCAPPH3",32,0)
 . . I $D(LRTXT(1)) S LRTXT(10)=LRSEP(1) D MSGSET("LRCAPPH",.LRTXT)
"RTN","LRCAPPH3",33,0)
LAM ;Look for inactive Codes and broken pointers.
"RTN","LRCAPPH3",34,0)
 ;in ^LAM
"RTN","LRCAPPH3",35,0)
 N LRI,LRXDT,LRY,LRII
"RTN","LRCAPPH3",36,0)
 S LRI=0 F  S LRI=$O(^LAM(LRI)) Q:LRI<1  D  I '$D(ZTQUEUED) W:'(LRI#50) "."
"RTN","LRCAPPH3",37,0)
 . I '$G(LRACT) Q:'$O(^LAM(LRI,7,0))
"RTN","LRCAPPH3",38,0)
 . S LRII=0 F  S LRII=$O(^LAM(LRI,4,LRII)) Q:LRII<1  D
"RTN","LRCAPPH3",39,0)
 . . I '$G(^LAM(LRI,4,LRII,0)) W:'$D(ZTQUEUED) !,"@@@@@@@@@@@",LRI,! D  Q
"RTN","LRCAPPH3",40,0)
 . .  . I '$L($P($G(^LAM(LRI,4,LRII,0)),U)) K ^LAM(LRI,4,LRII) Q
"RTN","LRCAPPH3",41,0)
 . .  . N DR,DA,DIE,DIK
"RTN","LRCAPPH3",42,0)
 . .  . S DA=LRII,DA(1)=LRI,DIK="^LAM("_LRI_",4," D ^DIK
"RTN","LRCAPPH3",43,0)
 . . K LRX S LRX=^LAM(LRI,4,LRII,0) D CK
"RTN","LRCAPPH3",44,0)
LAB ;Look for inactive Codes in ^LAB
"RTN","LRCAPPH3",45,0)
 N LRJ,LRN,LRSPEC,LRBECPT,MSGTYPE,MSGFLAG,DEFAULT,HCPCS,Y
"RTN","LRCAPPH3",46,0)
 S LRJ=0 F  S LRJ=$O(^LAB(60,LRJ)) Q:'LRJ  D
"RTN","LRCAPPH3",47,0)
 . ;
"RTN","LRCAPPH3",48,0)
 . ;LR*5.2*505 KAM Added the following to capure data and email to 
"RTN","LRCAPPH3",49,0)
 . ;CLIN 2 to assist in diagnosing an UNDEF issue
"RTN","LRCAPPH3",50,0)
 . ;
"RTN","LRCAPPH3",51,0)
 . I '$D(^LAB(60,LRJ,0)) D  Q
"RTN","LRCAPPH3",52,0)
 .. N XMSUB,XMY,XMTEST,XMDUZ,EDITUSER
"RTN","LRCAPPH3",53,0)
 .. I $D(^LAB(60,LRJ,15,1,0)) D
"RTN","LRCAPPH3",54,0)
 ... S EDITUSER=$P($G(^LAB(60,LRJ,15,1,0)),"^",2)
"RTN","LRCAPPH3",55,0)
 .. S XMSUB="Lab Test IN FILE 60 is missing data "_$$FMTE^XLFDT($$NOW^XLFDT,"1S")
"RTN","LRCAPPH3",56,0)
 .. S XMY(DUZ)=""
"RTN","LRCAPPH3",57,0)
 .. S XMY("G.HPS T3 Clinical DEV@FORUM.DOMAIN.EXT")=""
"RTN","LRCAPPH3",58,0)
 .. S XMDUZ=.5
"RTN","LRCAPPH3",59,0)
 .. S ^TMP($J,"LABERR",1)="Lab Test "_LRJ_" Does Not Have a Zero Node"
"RTN","LRCAPPH3",60,0)
 .. S ^TMP($J,"LABERR",2)="and Will Cause an UNDEF Error"
"RTN","LRCAPPH3",61,0)
 .. S ^TMP($J,"LABERR",3)="Record Skipped and Needs Attention"
"RTN","LRCAPPH3",62,0)
 .. I $D(EDITUSER) S ^TMP($J,"LABERR",4)="Test edited by - "_$P(^VA(200,EDITUSER,0),"^",1)
"RTN","LRCAPPH3",63,0)
 .. S ^TMP($J,"LABERR",5)="Site Generating the email is "_$P($$SITE^VASITE,"^",2)
"RTN","LRCAPPH3",64,0)
 .. S ^TMP($J,"LABERR",6)="     "
"RTN","LRCAPPH3",65,0)
 .. S ^TMP($J,"LABERR",7)="Notes for HPS T3 Clinical DEV:"
"RTN","LRCAPPH3",66,0)
 .. S ^TMP($J,"LABERR",8)="     "
"RTN","LRCAPPH3",67,0)
 .. S ^TMP($J,"LABERR",9)="This email pertains to an attempt to determine"
"RTN","LRCAPPH3",68,0)
 .. S ^TMP($J,"LABERR",10)="the cause of missing data in FILE 60."
"RTN","LRCAPPH3",69,0)
 .. S ^TMP($J,"LABERR",11)="RTC Ticket Numbers 717838 and 717839"
"RTN","LRCAPPH3",70,0)
 .. S ^TMP($J,"LABERR",12)="CA/SDM Tickets R18921259FY18 and I19185899FY18"
"RTN","LRCAPPH3",71,0)
 .. S XMTEXT="^TMP($J,""LABERR"","
"RTN","LRCAPPH3",72,0)
 .. D ^XMD
"RTN","LRCAPPH3",73,0)
 .. K ^TMP($J,"LABERR")
"RTN","LRCAPPH3",74,0)
 . ; End of Coding changes for LR*5.2*505
"RTN","LRCAPPH3",75,0)
 . ;
"RTN","LRCAPPH3",76,0)
 . S MSGFLAG=0
"RTN","LRCAPPH3",77,0)
 . S X=^LAB(60,LRJ,0),LRN=$P(X,U,1)
"RTN","LRCAPPH3",78,0)
 . I ($P(X,U,4)'="CH")&($P(X,U,4)'="MI") Q
"RTN","LRCAPPH3",79,0)
 . S LRSPEC=0 F  S LRSPEC=$O(^LAB(60,LRJ,1,LRSPEC)) Q:'LRSPEC  D
"RTN","LRCAPPH3",80,0)
 . . K LRBECPT
"RTN","LRCAPPH3",81,0)
 . . D IACPT(LRJ,DT,LRSPEC)
"RTN","LRCAPPH3",82,0)
 . . Q:('$D(LRBECPT(LRJ)))
"RTN","LRCAPPH3",83,0)
 . . S X=$O(LRBECPT(LRJ,1,0)) Q:'X
"RTN","LRCAPPH3",84,0)
 . . S MSGTYPE="SPECIMEN ("_LRSPEC_") CPT"
"RTN","LRCAPPH3",85,0)
 . . D MSG2(MSGTYPE)
"RTN","LRCAPPH3",86,0)
 . S X=$G(^LAB(60,LRJ,1.1)) S DEFAULT=$P(X,U,1),HCPCS=$P(X,U,2)
"RTN","LRCAPPH3",87,0)
 . I HCPCS D
"RTN","LRCAPPH3",88,0)
 . . S MSGTYPE="HCPCS CPT"
"RTN","LRCAPPH3",89,0)
 . . S X=HCPCS,Y=$$CPT^ICPTCOD(X,,,) I '$P(Y,U,7) S X=$P(Y,U,2) D MSG2(MSGTYPE)
"RTN","LRCAPPH3",90,0)
 . I DEFAULT D
"RTN","LRCAPPH3",91,0)
 . . S MSGTYPE="DEFAULT CPT"
"RTN","LRCAPPH3",92,0)
 . . S X=DEFAULT,Y=$$CPT^ICPTCOD(X,,,) I '$P(Y,U,7) S X=$P(Y,U,2) D MSG2(MSGTYPE)
"RTN","LRCAPPH3",93,0)
 . I MSGFLAG D MSGSET("LRCAPPH60",.LRMSG)
"RTN","LRCAPPH3",94,0)
 Q
"RTN","LRCAPPH3",95,0)
 ;
"RTN","LRCAPPH3",96,0)
IACPT(LRBETST,LRBECDT,LRSPEC) ; Get inactive specimen CPT
"RTN","LRCAPPH3",97,0)
 N A,ARR,LRBEAX,LRBEIEN,LRBEAR60,X
"RTN","LRCAPPH3",98,0)
 S LRBEIEN=LRSPEC_","_LRBETST_",",(LRI,LRBECPT)=""
"RTN","LRCAPPH3",99,0)
 D GETS^DIQ(60.01,LRBEIEN,"96*","I","LRBEAR60")
"RTN","LRCAPPH3",100,0)
 S A="" F  S A=$O(LRBEAR60(60.196,A)) Q:A=""  D
"RTN","LRCAPPH3",101,0)
 . Q:$G(LRBEAR60(60.196,A,1,"I"))=""
"RTN","LRCAPPH3",102,0)
 . S ARR($G(LRBEAR60(60.196,A,1,"I")))=$G(LRBEAR60(60.196,A,.01,"I"))
"RTN","LRCAPPH3",103,0)
 S X=$O(ARR(LRBECDT),-1) I X D
"RTN","LRCAPPH3",104,0)
 .S LRBEAX=ARR(X)
"RTN","LRCAPPH3",105,0)
 .S LRBEAX=$$CPT^ICPTCOD(LRBEAX,LRBECDT)
"RTN","LRCAPPH3",106,0)
 .I '$P(LRBEAX,U,7) S LRBECPT(LRBETST,1,$P(LRBEAX,U,2))="SPECIMEN CPT"
"RTN","LRCAPPH3",107,0)
 Q
"RTN","LRCAPPH3",108,0)
 ;
"RTN","LRCAPPH3",109,0)
EN0 ;Entry point for scan 64, scan 60, and mail reports to G.LMI
"RTN","LRCAPPH3",110,0)
 ;Called from LRCAPPH
"RTN","LRCAPPH3",111,0)
 D EN
"RTN","LRCAPPH3",112,0)
 D MAIL
"RTN","LRCAPPH3",113,0)
 D MAIL2
"RTN","LRCAPPH3",114,0)
END ;Called from LRCAPPH4
"RTN","LRCAPPH3",115,0)
 I $E($G(IOST),1,2)="P-" W @IOF
"RTN","LRCAPPH3",116,0)
 K DA,DIC,DIE,DIK,DR,I
"RTN","LRCAPPH3",117,0)
 K LRACT,LRCMT,LRINADT,LRINADTX,LRI,LRII,LRMSG,LRN,LRPGDT,LRTST,LRSEP,LRX
"RTN","LRCAPPH3",118,0)
 K LRTXT,X,XMTEXT,XMSUB,Y
"RTN","LRCAPPH3",119,0)
 K ^TMP("LRCAPPH",$J),^TMP("LRCAPPH60",$J)
"RTN","LRCAPPH3",120,0)
 D ^%ZISC
"RTN","LRCAPPH3",121,0)
 Q
"RTN","LRCAPPH3",122,0)
ACTIVE ;Print only WKLD CODES that have associated test assigned
"RTN","LRCAPPH3",123,0)
 ;and do not have inactivation dates
"RTN","LRCAPPH3",124,0)
 S LRACT=1 D EN0
"RTN","LRCAPPH3",125,0)
 Q
"RTN","LRCAPPH3",126,0)
CK ;
"RTN","LRCAPPH3",127,0)
 I '$G(LRACT) Q:$P(LRX,U,4)
"RTN","LRCAPPH3",128,0)
 K X,Y,DIC,LRMSG
"RTN","LRCAPPH3",129,0)
 F I=1:1:5 S LRX(I)=$P(LRX,U,I)
"RTN","LRCAPPH3",130,0)
 I LRX(2)="CPT" D  Q
"RTN","LRCAPPH3",131,0)
 . S X=$P(LRX(1),";")
"RTN","LRCAPPH3",132,0)
 . S Y=$$CPT^ICPTCOD(X,,,) I $S('$P(Y,U,7):1,LRX(4):1,1:0) D
"RTN","LRCAPPH3",133,0)
 . . S ^TMP("LRCAPPH",$J,"ICPT",X)=""
"RTN","LRCAPPH3",134,0)
 . . S Y(0)=$P(Y,U,2,3)_"^^1"
"RTN","LRCAPPH3",135,0)
 . . D MSG
"RTN","LRCAPPH3",136,0)
 S DIC(0)="XOZ",X=+LRX(1),DIC=U_$P(LRX(1),";",2)
"RTN","LRCAPPH3",137,0)
 S:$E(LRX(2))="L" DIC("S")="I '$P($G(^(4)),U)"
"RTN","LRCAPPH3",138,0)
 D ^DIC
"RTN","LRCAPPH3",139,0)
 I Y<1 D MSG Q
"RTN","LRCAPPH3",140,0)
 I $G(LRX(4)) D MSG
"RTN","LRCAPPH3",141,0)
 Q
"RTN","LRCAPPH3",142,0)
MSG ;
"RTN","LRCAPPH3",143,0)
 K LRMSG
"RTN","LRCAPPH3",144,0)
 S LRN=^LAM(LRI,0)
"RTN","LRCAPPH3",145,0)
 S LRCMT=$P($G(^TMP("LRCAPPH",$J,0)),U,4)+1
"RTN","LRCAPPH3",146,0)
 S LRMSG(LRCMT)=$P(LRN,U,2)_" ["_LRI_"]  "_$P(LRN,U),LRCMT=LRCMT+1
"RTN","LRCAPPH3",147,0)
 I Y<1 D  Q
"RTN","LRCAPPH3",148,0)
 . S LRMSG(LRCMT)="*** Has an invalid "_LRX(2)_" code of "_+X_" ."
"RTN","LRCAPPH3",149,0)
 . D TST
"RTN","LRCAPPH3",150,0)
 . I '$P(^LAM(LRI,4,LRII,0),U,4) S $P(^(0),U,4)=LRINADTX D
"RTN","LRCAPPH3",151,0)
 . . S LRCMT=LRCMT+1,LRMSG(LRCMT)="Inactivation date of "_LRINADT_" has been entered."
"RTN","LRCAPPH3",152,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=LRSEP(1)
"RTN","LRCAPPH3",153,0)
 . D MSGSET("LRCAPPH",.LRMSG)
"RTN","LRCAPPH3",154,0)
 I $P($G(Y(0)),U,4) D
"RTN","LRCAPPH3",155,0)
 . N LRXDT
"RTN","LRCAPPH3",156,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=$P(Y(0),U)_"  "_$P(Y(0),U,2),LRCMT=LRCMT+1
"RTN","LRCAPPH3",157,0)
 . S LRMSG(LRCMT)="Is an inactive "_LRX(2)_" code."
"RTN","LRCAPPH3",158,0)
 . D TST
"RTN","LRCAPPH3",159,0)
 . S:'$P(^LAM(LRI,4,LRII,0),U,4) $P(^(0),U,4)=LRINADTX
"RTN","LRCAPPH3",160,0)
 . S LRXDT=$P(^LAM(LRI,4,LRII,0),U,4)
"RTN","LRCAPPH3",161,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)="Inactivation date of "_$$FMTE^XLFDT(LRXDT,1)_" has been entered."
"RTN","LRCAPPH3",162,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=LRSEP(2)
"RTN","LRCAPPH3",163,0)
 . D MSGSET("LRCAPPH",.LRMSG)
"RTN","LRCAPPH3",164,0)
 Q
"RTN","LRCAPPH3",165,0)
MAIL ;Send message to G.LMI local mail group
"RTN","LRCAPPH3",166,0)
 Q:'$O(^TMP("LRCAPPH",$J,0))
"RTN","LRCAPPH3",167,0)
 N DUZ,XMDUZ,XMSUB,XMTEXT
"RTN","LRCAPPH3",168,0)
 S LRCMT=$G(LRCMT)+1
"RTN","LRCAPPH3",169,0)
 S ^TMP("LRCAPPH",$J,LRCMT,0)="Listing of all offending codes:"
"RTN","LRCAPPH3",170,0)
 S LRCMT=$G(LRCMT)+1,^TMP("LRCAPPH",$J,LRCMT,0)=""
"RTN","LRCAPPH3",171,0)
 S LRC="^TMP(""LRCAPPH"",$J,""A"")" F  S LRC=$Q(@LRC) Q:$QS(LRC,2)'=$J  D
"RTN","LRCAPPH3",172,0)
 . S LRCMT=LRCMT+1,^TMP("LRCAPPH",$J,LRCMT,0)="   "_$QS(LRC,3)_"     "_$QS(LRC,4)
"RTN","LRCAPPH3",173,0)
 S XMSUB=" NIGHTLY WKLD CODE CHECK REPORT "_$$FMTE^XLFDT($$NOW^XLFDT,"1S")
"RTN","LRCAPPH3",174,0)
 S XMY("G.LMI")="",XMTEXT="^TMP(""LRCAPPH"","_$J_","
"RTN","LRCAPPH3",175,0)
 D ^XMD
"RTN","LRCAPPH3",176,0)
 Q
"RTN","LRCAPPH3",177,0)
TST  ;
"RTN","LRCAPPH3",178,0)
 Q:'$O(^LAM(LRI,7,0))
"RTN","LRCAPPH3",179,0)
 K LRT N X
"RTN","LRCAPPH3",180,0)
 S LRCMT=$G(LRCMT)+1 S LRMSG(LRCMT)="Associated Tests"
"RTN","LRCAPPH3",181,0)
 S LRT=0 F  S LRT=$O(^LAM(LRI,7,LRT)) Q:LRT<1  S LRTST=$G(^(LRT,0)) D
"RTN","LRCAPPH3",182,0)
 . S X=+LRTST
"RTN","LRCAPPH3",183,0)
 . S LRTST="^"_$P(LRTST,";",2)_$P(LRTST,";")_",0)",LRCMT=LRCMT+1
"RTN","LRCAPPH3",184,0)
 . S LRMSG(LRCMT)="     "_$P(@LRTST,U)_"  {"_X_"}"
"RTN","LRCAPPH3",185,0)
 Q
"RTN","LRCAPPH3",186,0)
MSGSET(SUB,TXT) ;SUB=subscript - TXT = array containing the message
"RTN","LRCAPPH3",187,0)
 N I        ;
"RTN","LRCAPPH3",188,0)
 S LRCMT=$P($G(^TMP(SUB,$J,0)),U,4)
"RTN","LRCAPPH3",189,0)
 S I=0 F  S I=$O(TXT(I)) Q:I<1  D
"RTN","LRCAPPH3",190,0)
 . S LRCMT=LRCMT+1,^TMP(SUB,$J,LRCMT,0)=TXT(I)
"RTN","LRCAPPH3",191,0)
 S $P(^TMP(SUB,$J,0),U,4)=LRCMT
"RTN","LRCAPPH3",192,0)
 Q
"RTN","LRCAPPH3",193,0)
 ;
"RTN","LRCAPPH3",194,0)
MSG2(MSGTYPE) ;
"RTN","LRCAPPH3",195,0)
 I 'MSGFLAG D
"RTN","LRCAPPH3",196,0)
 . K LRMSG
"RTN","LRCAPPH3",197,0)
 . S LRCMT=$P($G(^TMP("LRCAPPH",$J,0)),U,4)+1,LRMSG(LRCMT)="  "
"RTN","LRCAPPH3",198,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=$P(LRN,U,1)_" ["_LRJ_"]"
"RTN","LRCAPPH3",199,0)
 S LRCMT=LRCMT+1
"RTN","LRCAPPH3",200,0)
 S LRMSG(LRCMT)="*** Has an inactive "_MSGTYPE_" Code of "_X_".",MSGFLAG=1
"RTN","LRCAPPH3",201,0)
 Q
"RTN","LRCAPPH3",202,0)
 ;
"RTN","LRCAPPH3",203,0)
MAIL2 ;Send message to G.LMI local mail group
"RTN","LRCAPPH3",204,0)
 N DUZ,XMDUZ,XMSUB,XMTEXT
"RTN","LRCAPPH3",205,0)
 Q:'$O(^TMP("LRCAPPH60",$J,0))
"RTN","LRCAPPH3",206,0)
 S LRCMT=$G(LRCMT)+1,^TMP("LRCAPPH60",$J,LRCMT,0)="  "
"RTN","LRCAPPH3",207,0)
 S XMSUB="NIGHTLY FILE #60 CPT CODE CHECK REPORT "_$$FMTE^XLFDT($$NOW^XLFDT,"1S")
"RTN","LRCAPPH3",208,0)
 S XMY("G.LMI")="",XMTEXT="^TMP(""LRCAPPH60"","_$J_","
"RTN","LRCAPPH3",209,0)
 D ^XMD
"RTN","LRCAPPH3",210,0)
 Q
"VER")
8.0^22.2
"BLD",10747,6)
^409
**END**
**END**

