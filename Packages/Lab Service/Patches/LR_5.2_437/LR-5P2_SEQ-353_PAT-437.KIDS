Released LR*5.2*437 SEQ #353
Extracted from mail message
**KIDS**:LR*5.2*437^

**INSTALL NAME**
LR*5.2*437
"BLD",9575,0)
LR*5.2*437^LAB SERVICE^0^3140303^y
"BLD",9575,1,0)
^^8^8^3140303^^^^
"BLD",9575,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package.
"BLD",9575,1,2,0)
 
"BLD",9575,1,3,0)
1.      Execute code does not perform correctly when a lab test is added 
"BLD",9575,1,4,0)
        to a previously verified accession.
"BLD",9575,1,5,0)
 
"BLD",9575,1,6,0)
2.      Convert delta checks to new format.
"BLD",9575,1,7,0)
 
"BLD",9575,1,8,0)
3.      <STORE> error when array fills up in micro
"BLD",9575,4,0)
^9.64PA^^
"BLD",9575,6)
1^
"BLD",9575,6.3)
3
"BLD",9575,"ABPKG")
n
"BLD",9575,"KRN",0)
^9.67PA^779.2^20
"BLD",9575,"KRN",.4,0)
.4
"BLD",9575,"KRN",.401,0)
.401
"BLD",9575,"KRN",.402,0)
.402
"BLD",9575,"KRN",.403,0)
.403
"BLD",9575,"KRN",.5,0)
.5
"BLD",9575,"KRN",.84,0)
.84
"BLD",9575,"KRN",3.6,0)
3.6
"BLD",9575,"KRN",3.8,0)
3.8
"BLD",9575,"KRN",9.2,0)
9.2
"BLD",9575,"KRN",9.8,0)
9.8
"BLD",9575,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9575,"KRN",9.8,"NM",1,0)
LRVER4^^0^B82283549
"BLD",9575,"KRN",9.8,"NM",2,0)
LRVR5^^0^B12268085
"BLD",9575,"KRN",9.8,"NM",3,0)
LRMIPSZ5^^0^B61637205
"BLD",9575,"KRN",9.8,"NM",4,0)
LR7OSMZ5^^0^B62120859
"BLD",9575,"KRN",9.8,"NM","B","LR7OSMZ5",4)

"BLD",9575,"KRN",9.8,"NM","B","LRMIPSZ5",3)

"BLD",9575,"KRN",9.8,"NM","B","LRVER4",1)

"BLD",9575,"KRN",9.8,"NM","B","LRVR5",2)

"BLD",9575,"KRN",19,0)
19
"BLD",9575,"KRN",19,"NM",0)
^9.68A^^
"BLD",9575,"KRN",19.1,0)
19.1
"BLD",9575,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9575,"KRN",101,0)
101
"BLD",9575,"KRN",101,"NM",0)
^9.68A^^
"BLD",9575,"KRN",409.61,0)
409.61
"BLD",9575,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9575,"KRN",771,0)
771
"BLD",9575,"KRN",771,"NM",0)
^9.68A^^
"BLD",9575,"KRN",779.2,0)
779.2
"BLD",9575,"KRN",870,0)
870
"BLD",9575,"KRN",8989.51,0)
8989.51
"BLD",9575,"KRN",8989.52,0)
8989.52
"BLD",9575,"KRN",8994,0)
8994
"BLD",9575,"KRN","B",.4,.4)

"BLD",9575,"KRN","B",.401,.401)

"BLD",9575,"KRN","B",.402,.402)

"BLD",9575,"KRN","B",.403,.403)

"BLD",9575,"KRN","B",.5,.5)

"BLD",9575,"KRN","B",.84,.84)

"BLD",9575,"KRN","B",3.6,3.6)

"BLD",9575,"KRN","B",3.8,3.8)

"BLD",9575,"KRN","B",9.2,9.2)

"BLD",9575,"KRN","B",9.8,9.8)

"BLD",9575,"KRN","B",19,19)

"BLD",9575,"KRN","B",19.1,19.1)

"BLD",9575,"KRN","B",101,101)

"BLD",9575,"KRN","B",409.61,409.61)

"BLD",9575,"KRN","B",771,771)

"BLD",9575,"KRN","B",779.2,779.2)

"BLD",9575,"KRN","B",870,870)

"BLD",9575,"KRN","B",8989.51,8989.51)

"BLD",9575,"KRN","B",8989.52,8989.52)

"BLD",9575,"KRN","B",8994,8994)

"BLD",9575,"QUES",0)
^9.62^^
"BLD",9575,"REQB",0)
^9.611^2^2
"BLD",9575,"REQB",1,0)
LR*5.2*286^2
"BLD",9575,"REQB",2,0)
LR*5.2*350^2
"BLD",9575,"REQB","B","LR*5.2*286",1)

"BLD",9575,"REQB","B","LR*5.2*350",2)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
437^3140303^33274
"PKG",26,22,1,"PAH",1,1,0)
^^8^8^3140303
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package.
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1.      Execute code does not perform correctly when a lab test is added 
"PKG",26,22,1,"PAH",1,1,4,0)
        to a previously verified accession.
"PKG",26,22,1,"PAH",1,1,5,0)
 
"PKG",26,22,1,"PAH",1,1,6,0)
2.      Convert delta checks to new format.
"PKG",26,22,1,"PAH",1,1,7,0)
 
"PKG",26,22,1,"PAH",1,1,8,0)
3.      <STORE> error when array fills up in micro
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","LR7OSMZ5")
0^4^B62120859^B61988118
"RTN","LR7OSMZ5",1,0)
LR7OSMZ5 ;DALOI/STAFF - Silent Micro rpt - BACTERIA, ANTIBIOTICS ;05/24/11  14:47
"RTN","LR7OSMZ5",2,0)
 ;;5.2;LAB SERVICE;**121,187,244,350,437**;Sep 27, 1994;Build 3
"RTN","LR7OSMZ5",3,0)
 ;
"RTN","LR7OSMZ5",4,0)
BACT ;from LR7OSMZ2
"RTN","LR7OSMZ5",5,0)
 ;
"RTN","LR7OSMZ5",6,0)
 N A,I,J,K,L,LRABCNT,LRCOMMAX,LRCOMTAB,LRBUG,LRDCOM,LRFMT,LR1PASS,LRBN,LRI,LRINT,LRMAX,LRORG,LRRES,LRSECT,LRTAB,LRWIDTH,LRX,LRY,X,Y
"RTN","LR7OSMZ5",7,0)
 ;
"RTN","LR7OSMZ5",8,0)
 Q:+$O(^LR(LRDFN,"MI",LRIDT,3,0))<1
"RTN","LR7OSMZ5",9,0)
 ;
"RTN","LR7OSMZ5",10,0)
 S LRFMT=$P(^LAB(69.9,1,0),U,11),LRFMT=$S(LRFMT="":"I",1:LRFMT)
"RTN","LR7OSMZ5",11,0)
 ;
"RTN","LR7OSMZ5",12,0)
 ; Check each organism identified on the specimen.
"RTN","LR7OSMZ5",13,0)
 ;         A = number of organisms on report that have susceptibilities
"RTN","LR7OSMZ5",14,0)
 S (A,LRBUG)=0
"RTN","LR7OSMZ5",15,0)
 F  S LRBUG=+$O(^LR(LRDFN,"MI",LRIDT,3,LRBUG)) Q:LRBUG<1  D
"RTN","LR7OSMZ5",16,0)
 . I +$O(^LR(LRDFN,"MI",LRIDT,3,LRBUG,2))'["2." Q
"RTN","LR7OSMZ5",17,0)
 . S A=A+1 D CHECK
"RTN","LR7OSMZ5",18,0)
 ;
"RTN","LR7OSMZ5",19,0)
 S (LRBN,LRABCNT)=0
"RTN","LR7OSMZ5",20,0)
 F  S LRBN=+$O(LRRES(LRBN)) Q:LRBN<1  S LRABCNT=LRABCNT+1
"RTN","LR7OSMZ5",21,0)
 Q:'LRABCNT
"RTN","LR7OSMZ5",22,0)
 ;
"RTN","LR7OSMZ5",23,0)
 ; Scan result to find longest value, set mininium field width = 4
"RTN","LR7OSMZ5",24,0)
 S (LRI,LRMAX(1))=0
"RTN","LR7OSMZ5",25,0)
 F  S LRI=$O(LRRES(LRI)) Q:'LRI  D
"RTN","LR7OSMZ5",26,0)
 . F I=1:1:A D
"RTN","LR7OSMZ5",27,0)
 . . S X=$L($P(LRRES(LRI),"^",I))
"RTN","LR7OSMZ5",28,0)
 . . I X<4 S X=4
"RTN","LR7OSMZ5",29,0)
 . . I X>$G(LRWIDTH(I,1)) S LRWIDTH(I,1)=X
"RTN","LR7OSMZ5",30,0)
 . . I X>LRMAX(1) S LRMAX(1)=X
"RTN","LR7OSMZ5",31,0)
 ;
"RTN","LR7OSMZ5",32,0)
 ; Scan interpretations to find longest value
"RTN","LR7OSMZ5",33,0)
 S (LRI,LRMAX(2))=0
"RTN","LR7OSMZ5",34,0)
 F  S LRI=$O(LRINT(LRI)) Q:'LRI  D
"RTN","LR7OSMZ5",35,0)
 . F I=1:1:A D
"RTN","LR7OSMZ5",36,0)
 . . S X=$L($P(LRINT(LRI),"^",I))
"RTN","LR7OSMZ5",37,0)
 . . I X<4 S X=4
"RTN","LR7OSMZ5",38,0)
 . . I X>$G(LRWIDTH(I,2)) S LRWIDTH(I,2)=X
"RTN","LR7OSMZ5",39,0)
 . . I X>LRMAX(2) S LRMAX(2)=X
"RTN","LR7OSMZ5",40,0)
 ;
"RTN","LR7OSMZ5",41,0)
 ; Find longest antibiotic display comment to display on report
"RTN","LR7OSMZ5",42,0)
 S (LRCOMMAX,LRI)=0
"RTN","LR7OSMZ5",43,0)
 F  S LRI=$O(^LAB(62.06,LRI)) Q:'LRI  D
"RTN","LR7OSMZ5",44,0)
 . S LRX=$G(^LAB(62.06,LRI,0)) Q:$P(LRX,"^",3)=""
"RTN","LR7OSMZ5",45,0)
 . I '$P(LRX,"^",2) Q
"RTN","LR7OSMZ5",46,0)
 . S LRY=0
"RTN","LR7OSMZ5",47,0)
 . F  S LRY=$O(^LR(LRDFN,"MI",LRIDT,3,LRY)) Q:'LRY  D
"RTN","LR7OSMZ5",48,0)
 . . I $D(^LR(LRDFN,"MI",LRIDT,3,LRY,$P(LRX,"^",2))) S X=$L($P(LRX,"^",3)) S:X>LRCOMMAX LRCOMMAX=X
"RTN","LR7OSMZ5",49,0)
 ;
"RTN","LR7OSMZ5",50,0)
 ; Check display width so that at least one organsism's values will display when display width is limited
"RTN","LR7OSMZ5",51,0)
 ; 31 character for antibiotic name, possibly 40 character display comments does not leave much space for actual results.
"RTN","LR7OSMZ5",52,0)
 I LRCOMMAX>10,GIOM'>80 D
"RTN","LR7OSMZ5",53,0)
 . I LRFMT="B" S X=LRMAX(1)+LRMAX(2)+4
"RTN","LR7OSMZ5",54,0)
 . I LRFMT="R" S X=LRMAX(1)+2
"RTN","LR7OSMZ5",55,0)
 . I LRFMT="I" S X=LRMAX(2)+2
"RTN","LR7OSMZ5",56,0)
 . S X=X+31
"RTN","LR7OSMZ5",57,0)
 . I (X+LRCOMMAX)>GIOM S LRCOMMAX=GIOM-X
"RTN","LR7OSMZ5",58,0)
 ;
"RTN","LR7OSMZ5",59,0)
 ; Determine tab position (column) of each organism and associated results
"RTN","LR7OSMZ5",60,0)
 ;  LRSECT will indicate if multiple sections needed when number of organisms, results and display comments exceed right margin.
"RTN","LR7OSMZ5",61,0)
 S (LRI,LRWIDTH(0,1),LRWIDTH(0,2))=0,LRSECT=1,LRTAB(LRSECT,0)=29
"RTN","LR7OSMZ5",62,0)
 F  S LRI=$O(LRWIDTH(LRI)) Q:'LRI  D
"RTN","LR7OSMZ5",63,0)
 . S LRX=LRTAB(LRSECT,LRI-1)
"RTN","LR7OSMZ5",64,0)
 . I LRFMT="B" D  Q
"RTN","LR7OSMZ5",65,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,1)+LRWIDTH(LRI-1,2)+4
"RTN","LR7OSMZ5",66,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,1)+LRWIDTH(LRI,2))>GIOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LR7OSMZ5",67,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LR7OSMZ5",68,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LR7OSMZ5",69,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+2
"RTN","LR7OSMZ5",70,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LR7OSMZ5",71,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+LRWIDTH(LRI,2)+4
"RTN","LR7OSMZ5",72,0)
 . I LRFMT="I" D  Q
"RTN","LR7OSMZ5",73,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,2)+4
"RTN","LR7OSMZ5",74,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,2))>GIOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LR7OSMZ5",75,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LR7OSMZ5",76,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LR7OSMZ5",77,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)
"RTN","LR7OSMZ5",78,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LR7OSMZ5",79,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,2)+2
"RTN","LR7OSMZ5",80,0)
 . I LRFMT="R" D  Q
"RTN","LR7OSMZ5",81,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,1)+4
"RTN","LR7OSMZ5",82,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,1))>GIOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LR7OSMZ5",83,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LR7OSMZ5",84,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LR7OSMZ5",85,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)
"RTN","LR7OSMZ5",86,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LR7OSMZ5",87,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+2
"RTN","LR7OSMZ5",88,0)
 ;
"RTN","LR7OSMZ5",89,0)
 D LINE^LR7OSUM4,LINE^LR7OSUM4
"RTN","LR7OSMZ5",90,0)
 S X="ANTIBIOTIC SUSCEPTIBILITY TEST RESULTS:"
"RTN","LR7OSMZ5",91,0)
 I $D(^XUSEC("LRLAB",DUZ))&'$D(LRWRDVEW) S X=X_"  ('*' indicates display is suppressed)"
"RTN","LR7OSMZ5",92,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSMZ5",93,0)
 D LINE^LR7OSUM4
"RTN","LR7OSMZ5",94,0)
 ;
"RTN","LR7OSMZ5",95,0)
 S LRSECT=0
"RTN","LR7OSMZ5",96,0)
 F  S LRSECT=$O(LRTAB(LRSECT)) Q:'LRSECT  D SECT
"RTN","LR7OSMZ5",97,0)
 ;
"RTN","LR7OSMZ5",98,0)
 Q
"RTN","LR7OSMZ5",99,0)
 ;
"RTN","LR7OSMZ5",100,0)
 ;
"RTN","LR7OSMZ5",101,0)
SECT ; Print antibiotic susceptibility for each section
"RTN","LR7OSMZ5",102,0)
 ;
"RTN","LR7OSMZ5",103,0)
 N LRAO
"RTN","LR7OSMZ5",104,0)
 ;
"RTN","LR7OSMZ5",105,0)
 D BUGHDR
"RTN","LR7OSMZ5",106,0)
 ;
"RTN","LR7OSMZ5",107,0)
 ; Display antibiotics by print order
"RTN","LR7OSMZ5",108,0)
 S LRAO=0
"RTN","LR7OSMZ5",109,0)
 F  S LRAO=$O(^LAB(62.06,"AO",LRAO)) Q:LRAO<.001  D
"RTN","LR7OSMZ5",110,0)
 . S B=$O(^LAB(62.06,"AO",LRAO,0))
"RTN","LR7OSMZ5",111,0)
 . I B>0,$D(^LAB(62.06,B,0)) D AB
"RTN","LR7OSMZ5",112,0)
 ;
"RTN","LR7OSMZ5",113,0)
 D LINE^LR7OSUM4
"RTN","LR7OSMZ5",114,0)
 ;
"RTN","LR7OSMZ5",115,0)
 Q
"RTN","LR7OSMZ5",116,0)
 ;
"RTN","LR7OSMZ5",117,0)
 ;
"RTN","LR7OSMZ5",118,0)
CHECK ;
"RTN","LR7OSMZ5",119,0)
 ;
"RTN","LR7OSMZ5",120,0)
 N B,B1,B2,B3,LRBN,LRFLAG,LR1PASS
"RTN","LR7OSMZ5",121,0)
 ;
"RTN","LR7OSMZ5",122,0)
 S LRFLAG=0,LRBN=2
"RTN","LR7OSMZ5",123,0)
 F  S LRBN=+$O(^LR(LRDFN,"MI",LRIDT,3,LRBUG,LRBN)) Q:LRBN'["2."  D
"RTN","LR7OSMZ5",124,0)
 . S B=^LR(LRDFN,"MI",LRIDT,3,LRBUG,LRBN),B1=$P(B,U),B2=$P(B,U,2)
"RTN","LR7OSMZ5",125,0)
 . I B1'="" D FIRST
"RTN","LR7OSMZ5",126,0)
 ;
"RTN","LR7OSMZ5",127,0)
 S LRBN=2
"RTN","LR7OSMZ5",128,0)
 F  S LRBN=+$O(LR1PASS(LRBN)) Q:LRBN<1  D
"RTN","LR7OSMZ5",129,0)
 . S B=LR1PASS(LRBN),B1=$P(B,U),B2=$P(B,U,2),B3=$P(B,U,3)
"RTN","LR7OSMZ5",130,0)
 . D LAB
"RTN","LR7OSMZ5",131,0)
 ;
"RTN","LR7OSMZ5",132,0)
 S LRBUG(A)=LRBUG
"RTN","LR7OSMZ5",133,0)
 ;
"RTN","LR7OSMZ5",134,0)
 Q
"RTN","LR7OSMZ5",135,0)
 ;
"RTN","LR7OSMZ5",136,0)
 ;
"RTN","LR7OSMZ5",137,0)
FIRST ;
"RTN","LR7OSMZ5",138,0)
 ;
"RTN","LR7OSMZ5",139,0)
 ; If format is 'interpretation only' and no interpretation for this sensitivity then display sensitivity result in it's place.
"RTN","LR7OSMZ5",140,0)
 I B2="" S B2=$S(LRFMT="I":B1,1:" ")
"RTN","LR7OSMZ5",141,0)
 ;
"RTN","LR7OSMZ5",142,0)
 S B3=$P(B,U,3)
"RTN","LR7OSMZ5",143,0)
 I B2'=" ",$E(B2)'="R","A"[B3 S LRFLAG=1
"RTN","LR7OSMZ5",144,0)
 S LR1PASS(LRBN)=B1_U_B2_U_B3
"RTN","LR7OSMZ5",145,0)
 Q
"RTN","LR7OSMZ5",146,0)
 ;
"RTN","LR7OSMZ5",147,0)
 ;
"RTN","LR7OSMZ5",148,0)
LAB ;
"RTN","LR7OSMZ5",149,0)
 I $D(^XUSEC("LRLAB",DUZ)),'$D(LRWRDVEW) D  Q
"RTN","LR7OSMZ5",150,0)
 . S $P(LRRES(LRBN),U,A)=$S(B3="N"!(B3="R"&LRFLAG):B1_"*",1:B1)
"RTN","LR7OSMZ5",151,0)
 . S $P(LRINT(LRBN),U,A)=$S(B3="N"!(B3="R"&LRFLAG):B2_"*",1:B2)
"RTN","LR7OSMZ5",152,0)
 ;
"RTN","LR7OSMZ5",153,0)
 I B3=""!(B3="A")!(B3="R"&'LRFLAG) S $P(LRRES(LRBN),U,A)=B1,$P(LRINT(LRBN),U,A)=B2
"RTN","LR7OSMZ5",154,0)
 Q
"RTN","LR7OSMZ5",155,0)
 ;
"RTN","LR7OSMZ5",156,0)
 ;
"RTN","LR7OSMZ5",157,0)
AB ;
"RTN","LR7OSMZ5",158,0)
 ;
"RTN","LR7OSMZ5",159,0)
 N LRX
"RTN","LR7OSMZ5",160,0)
 ;
"RTN","LR7OSMZ5",161,0)
 S LRX=$G(^LAB(62.06,B,0)),J=$P(LRX,"^",2)
"RTN","LR7OSMZ5",162,0)
 I J<1 Q
"RTN","LR7OSMZ5",163,0)
 ;
"RTN","LR7OSMZ5",164,0)
 I '$D(LRINT(J)) Q
"RTN","LR7OSMZ5",165,0)
 I LRINT(J)'="",LRINT(J)?."^" Q
"RTN","LR7OSMZ5",166,0)
 ;
"RTN","LR7OSMZ5",167,0)
 D LINE^LR7OSUM4
"RTN","LR7OSMZ5",168,0)
 ;
"RTN","LR7OSMZ5",169,0)
 ; Write name of antibiotic
"RTN","LR7OSMZ5",170,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,$$LJ^XLFSTR($P(LRX,U),30,"."))
"RTN","LR7OSMZ5",171,0)
 ;
"RTN","LR7OSMZ5",172,0)
 ; Antibiotic display comment from file #62.06
"RTN","LR7OSMZ5",173,0)
 K LRDCOM(0)
"RTN","LR7OSMZ5",174,0)
 S LRDCOM=$P(LRX,U,3)
"RTN","LR7OSMZ5",175,0)
 ; If longer than comment window (GIOM-LRCOMTAB) then format to fit within window.
"RTN","LR7OSMZ5",176,0)
 I $L(LRDCOM)>(GIOM-LRCOMTAB(LRSECT)) D
"RTN","LR7OSMZ5",177,0)
 . N J,K,L
"RTN","LR7OSMZ5",178,0)
 . S J=$L(LRDCOM),K=0,L=GIOM-LRCOMTAB(LRSECT)-1 S:L<1 L=1
"RTN","LR7OSMZ5",179,0)
 . F  Q:LRDCOM=""  S K=K+1,LRDCOM(0,K)=$E(LRDCOM,1,L),LRDCOM=$E(LRDCOM,L+1,J)
"RTN","LR7OSMZ5",180,0)
 ;
"RTN","LR7OSMZ5",181,0)
 D SIR
"RTN","LR7OSMZ5",182,0)
 Q
"RTN","LR7OSMZ5",183,0)
 ;
"RTN","LR7OSMZ5",184,0)
 ;
"RTN","LR7OSMZ5",185,0)
BUGHDR ;
"RTN","LR7OSMZ5",186,0)
 ;
"RTN","LR7OSMZ5",187,0)
 N A,J
"RTN","LR7OSMZ5",188,0)
 F J=1:1 S LRBUG=$P(LRSECT(LRSECT),"^",J) Q:LRBUG=""  D
"RTN","LR7OSMZ5",189,0)
 . S LRORG=$P(^LR(LRDFN,"MI",LRIDT,3,LRBUG(LRBUG),0),U),LRORG=$P(^LAB(61.2,LRORG,0),U)
"RTN","LR7OSMZ5",190,0)
 . I +$O(^LR(LRDFN,"MI",LRIDT,3,LRBUG(LRBUG),2))'["2." Q
"RTN","LR7OSMZ5",191,0)
 . D ORG
"RTN","LR7OSMZ5",192,0)
 ;
"RTN","LR7OSMZ5",193,0)
 I LRFMT="B" D
"RTN","LR7OSMZ5",194,0)
 . D LN^LR7OSMZ1
"RTN","LR7OSMZ5",195,0)
 . S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSMZ5",196,0)
 . F J=1:1 S A=$P(LRSECT(LRSECT),"^",J) Q:A=""  S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,A),CCNT,":")
"RTN","LR7OSMZ5",197,0)
 ;
"RTN","LR7OSMZ5",198,0)
 D LN^LR7OSMZ1
"RTN","LR7OSMZ5",199,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSMZ5",200,0)
 ;
"RTN","LR7OSMZ5",201,0)
 F J=1:1 S A=$P(LRSECT(LRSECT),"^",J) Q:A=""  D
"RTN","LR7OSMZ5",202,0)
 . I LRFMT'="B" S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,A),CCNT,":")
"RTN","LR7OSMZ5",203,0)
 . I LRFMT="B" D
"RTN","LR7OSMZ5",204,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,A,1),CCNT,"SUSC")
"RTN","LR7OSMZ5",205,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,A,2),CCNT,"INTP")
"RTN","LR7OSMZ5",206,0)
 ;
"RTN","LR7OSMZ5",207,0)
 Q
"RTN","LR7OSMZ5",208,0)
 ;
"RTN","LR7OSMZ5",209,0)
 ;
"RTN","LR7OSMZ5",210,0)
ORG ;
"RTN","LR7OSMZ5",211,0)
 ;
"RTN","LR7OSMZ5",212,0)
 ; LR2ORMOR flag indicating 2 or more organsims on report - set in LRMIPSZ2.
"RTN","LR7OSMZ5",213,0)
 ;
"RTN","LR7OSMZ5",214,0)
 N J
"RTN","LR7OSMZ5",215,0)
 ;
"RTN","LR7OSMZ5",216,0)
 D LINE^LR7OSUM4
"RTN","LR7OSMZ5",217,0)
 ;
"RTN","LR7OSMZ5",218,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSMZ5",219,0)
 ;
"RTN","LR7OSMZ5",220,0)
 I LRBUG>$P(LRSECT(LRSECT),"^") F J=1:1 Q:$P(LRSECT(LRSECT),"^",J)=LRBUG  S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,$P(LRSECT(LRSECT),"^",J)),CCNT,":")
"RTN","LR7OSMZ5",221,0)
 ;
"RTN","LR7OSMZ5",222,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,LRBUG),CCNT,$S(LR2ORMOR:LRBUG(LRBUG)_". ",1:"")_LRORG)
"RTN","LR7OSMZ5",223,0)
 ;
"RTN","LR7OSMZ5",224,0)
 Q
"RTN","LR7OSMZ5",225,0)
 ;
"RTN","LR7OSMZ5",226,0)
 ;
"RTN","LR7OSMZ5",227,0)
SIR ; Display the susceptibility results/interpretations
"RTN","LR7OSMZ5",228,0)
 ;
"RTN","LR7OSMZ5",229,0)
 N II,K
"RTN","LR7OSMZ5",230,0)
 ;
"RTN","LR7OSMZ5",231,0)
 F K=1:1 S II=$P(LRSECT(LRSECT),"^",K) Q:II=""  D
"RTN","LR7OSMZ5",232,0)
 . I LRFMT="B" D  Q
"RTN","LR7OSMZ5",233,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,II,1),CCNT,$P(LRRES(J),U,II))
"RTN","LR7OSMZ5",234,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,II,2),CCNT,$P(LRINT(J),U,II))
"RTN","LR7OSMZ5",235,0)
 . I LRFMT="I" S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,II,2),CCNT,$P(LRINT(J),U,II)) Q
"RTN","LR7OSMZ5",236,0)
 . I LRFMT="R" S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRTAB(LRSECT,II,1),CCNT,$P(LRRES(J),U,II)) Q
"RTN","LR7OSMZ5",237,0)
 ;
"RTN","LR7OSMZ5",238,0)
 D DCOM
"RTN","LR7OSMZ5",239,0)
 Q
"RTN","LR7OSMZ5",240,0)
 ;
"RTN","LR7OSMZ5",241,0)
 ;
"RTN","LR7OSMZ5",242,0)
DCOM ; Show antibiotic's display comments
"RTN","LR7OSMZ5",243,0)
 ;
"RTN","LR7OSMZ5",244,0)
 I LRDCOM'="" D
"RTN","LR7OSMZ5",245,0)
 . I LRCOMTAB(LRSECT)<$X,$L(LRDCOM)>(GIOM-$X) D LINE^LR7OSUM4 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSMZ5",246,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRCOMTAB(LRSECT),CCNT,LRDCOM)
"RTN","LR7OSMZ5",247,0)
 ;
"RTN","LR7OSMZ5",248,0)
 I $D(LRDCOM(0)) D
"RTN","LR7OSMZ5",249,0)
 . N J
"RTN","LR7OSMZ5",250,0)
 . S J=0
"RTN","LR7OSMZ5",251,0)
 . F  S J=$O(LRDCOM(0,J)) Q:'J  D
"RTN","LR7OSMZ5",252,0)
 . . I J>1 D LINE^LR7OSUM4 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSMZ5",253,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRCOMTAB(LRSECT),CCNT,LRDCOM(0,J))
"RTN","LR7OSMZ5",254,0)
 ;
"RTN","LR7OSMZ5",255,0)
 I $D(LRDCOM(J)) D
"RTN","LR7OSMZ5",256,0)
 . S K=0,A=0
"RTN","LR7OSMZ5",257,0)
 . F  S A=+$O(LRDCOM(J,A)) Q:A<1  D
"RTN","LR7OSMZ5",258,0)
 . . D:'('K&(LRDCOM="")) LINE^LR7OSUM4
"RTN","LR7OSMZ5",259,0)
 . . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(LRCOMTAB(LRSECT),CCNT,LRDCOM(J,A)),K=1
"RTN","LR7OSMZ5",260,0)
 Q
"RTN","LRMIPSZ5")
0^3^B61637205^B61501584
"RTN","LRMIPSZ5",1,0)
LRMIPSZ5 ;DALOI/STAFF - MICRO PATIENT REPORT - BACTERIA, ANTIBIOTICS ;05/24/11  14:37
"RTN","LRMIPSZ5",2,0)
 ;;5.2;LAB SERVICE;**350,437**;Sep 27, 1994;Build 3
"RTN","LRMIPSZ5",3,0)
 ;
"RTN","LRMIPSZ5",4,0)
 Q
"RTN","LRMIPSZ5",5,0)
 ;
"RTN","LRMIPSZ5",6,0)
BACT ;
"RTN","LRMIPSZ5",7,0)
 ; from LRMIPSZ2
"RTN","LRMIPSZ5",8,0)
 N A,I,J,K,L,LRABCNT,LRCOMMAX,LRCOMTAB,LRBUG,LRDCOM,LRFMT,LR1PASS,LRBN,LRI,LRINT,LRMAX,LRORG,LRRES,LRSECT,LRTAB,LRWIDTH,LRX,LRY,X,Y
"RTN","LRMIPSZ5",9,0)
 Q:+$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,0))<1
"RTN","LRMIPSZ5",10,0)
 S LRFMT=$P(^LAB(69.9,1,0),U,11),LRFMT=$S(LRFMT="":"I",1:LRFMT)
"RTN","LRMIPSZ5",11,0)
 ;
"RTN","LRMIPSZ5",12,0)
 ; Check each organism identified on the specimen.
"RTN","LRMIPSZ5",13,0)
 ;         A = number of organisms on report that have susceptibilities
"RTN","LRMIPSZ5",14,0)
 S (A,LRBUG)=0
"RTN","LRMIPSZ5",15,0)
 F  S LRBUG=+$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG)) Q:LRBUG<1  D
"RTN","LRMIPSZ5",16,0)
 . I +$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG,2))'["2." Q
"RTN","LRMIPSZ5",17,0)
 . S A=A+1 D CHECK
"RTN","LRMIPSZ5",18,0)
 ;
"RTN","LRMIPSZ5",19,0)
 S (LRBN,LRABCNT)=0
"RTN","LRMIPSZ5",20,0)
 F  S LRBN=+$O(LRRES(LRBN)) Q:LRBN<1  S LRABCNT=LRABCNT+1
"RTN","LRMIPSZ5",21,0)
 Q:'LRABCNT!($G(LREND))
"RTN","LRMIPSZ5",22,0)
 ;
"RTN","LRMIPSZ5",23,0)
 ; Scan result to find longest value, set mininium field width = 4
"RTN","LRMIPSZ5",24,0)
 S (LRI,LRMAX(1))=0
"RTN","LRMIPSZ5",25,0)
 F  S LRI=$O(LRRES(LRI)) Q:'LRI  D
"RTN","LRMIPSZ5",26,0)
 . F I=1:1:A D
"RTN","LRMIPSZ5",27,0)
 . . S X=$L($P(LRRES(LRI),"^",I))
"RTN","LRMIPSZ5",28,0)
 . . I X<4 S X=4
"RTN","LRMIPSZ5",29,0)
 . . I X>$G(LRWIDTH(I,1)) S LRWIDTH(I,1)=X
"RTN","LRMIPSZ5",30,0)
 . . I X>LRMAX(1) S LRMAX(1)=X
"RTN","LRMIPSZ5",31,0)
 ;
"RTN","LRMIPSZ5",32,0)
 ; Scan interpretations to find longest value
"RTN","LRMIPSZ5",33,0)
 S (LRI,LRMAX(2))=0
"RTN","LRMIPSZ5",34,0)
 F  S LRI=$O(LRINT(LRI)) Q:'LRI  D
"RTN","LRMIPSZ5",35,0)
 . F I=1:1:A D
"RTN","LRMIPSZ5",36,0)
 . . S X=$L($P(LRINT(LRI),"^",I))
"RTN","LRMIPSZ5",37,0)
 . . I X<4 S X=4
"RTN","LRMIPSZ5",38,0)
 . . I X>$G(LRWIDTH(I,2)) S LRWIDTH(I,2)=X
"RTN","LRMIPSZ5",39,0)
 . . I X>LRMAX(2) S LRMAX(2)=X
"RTN","LRMIPSZ5",40,0)
 ;
"RTN","LRMIPSZ5",41,0)
 ; Find longest antibiotic display comment to display on report
"RTN","LRMIPSZ5",42,0)
 S (LRCOMMAX,LRI)=0
"RTN","LRMIPSZ5",43,0)
 F  S LRI=$O(^LAB(62.06,LRI)) Q:'LRI  D
"RTN","LRMIPSZ5",44,0)
 . S LRX=$G(^LAB(62.06,LRI,0)) Q:$P(LRX,"^",3)=""
"RTN","LRMIPSZ5",45,0)
 . I '$P(LRX,"^",2) Q
"RTN","LRMIPSZ5",46,0)
 . S LRY=0
"RTN","LRMIPSZ5",47,0)
 . F  S LRY=$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRY)) Q:'LRY  D
"RTN","LRMIPSZ5",48,0)
 . . I $D(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRY,$P(LRX,"^",2))) S X=$L($P(LRX,"^",3)) S:X>LRCOMMAX LRCOMMAX=X
"RTN","LRMIPSZ5",49,0)
 ;
"RTN","LRMIPSZ5",50,0)
 ; Check display width so that at least one organsism's values will display when display width is limited
"RTN","LRMIPSZ5",51,0)
 ; 31 character for antibiotic name, possibly 40 character display comments does not leave much space for actual results.
"RTN","LRMIPSZ5",52,0)
 I LRCOMMAX>10,IOM'>80 D
"RTN","LRMIPSZ5",53,0)
 . I LRFMT="B" S X=LRMAX(1)+LRMAX(2)+4
"RTN","LRMIPSZ5",54,0)
 . I LRFMT="R" S X=LRMAX(1)+2
"RTN","LRMIPSZ5",55,0)
 . I LRFMT="I" S X=LRMAX(2)+2
"RTN","LRMIPSZ5",56,0)
 . S X=X+31
"RTN","LRMIPSZ5",57,0)
 . I (X+LRCOMMAX)>IOM S LRCOMMAX=IOM-X
"RTN","LRMIPSZ5",58,0)
 ;
"RTN","LRMIPSZ5",59,0)
 ; Determine tab position (column) of each organism and associated results
"RTN","LRMIPSZ5",60,0)
 ;  LRSECT will indicate if multiple sections needed when number of organisms, results and display comments exceed right margin.
"RTN","LRMIPSZ5",61,0)
 S (LRI,LRWIDTH(0,1),LRWIDTH(0,2))=0,LRSECT=1,LRTAB(LRSECT,0)=29
"RTN","LRMIPSZ5",62,0)
 F  S LRI=$O(LRWIDTH(LRI)) Q:'LRI  D
"RTN","LRMIPSZ5",63,0)
 . S LRX=LRTAB(LRSECT,LRI-1)
"RTN","LRMIPSZ5",64,0)
 . I LRFMT="B" D  Q
"RTN","LRMIPSZ5",65,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,1)+LRWIDTH(LRI-1,2)+4
"RTN","LRMIPSZ5",66,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,1)+LRWIDTH(LRI,2))>IOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LRMIPSZ5",67,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LRMIPSZ5",68,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LRMIPSZ5",69,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+2
"RTN","LRMIPSZ5",70,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LRMIPSZ5",71,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+LRWIDTH(LRI,2)+4
"RTN","LRMIPSZ5",72,0)
 . I LRFMT="I" D  Q
"RTN","LRMIPSZ5",73,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,2)+4
"RTN","LRMIPSZ5",74,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,2))>IOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LRMIPSZ5",75,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LRMIPSZ5",76,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LRMIPSZ5",77,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)
"RTN","LRMIPSZ5",78,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LRMIPSZ5",79,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,2)+2
"RTN","LRMIPSZ5",80,0)
 . I LRFMT="R" D  Q
"RTN","LRMIPSZ5",81,0)
 . . S LRY=LRX+LRWIDTH(LRI-1,1)+4
"RTN","LRMIPSZ5",82,0)
 . . I (LRY+LRCOMMAX+LRWIDTH(LRI,1))>IOM S LRCOMTAB(LRSECT)=LRY,LRY=LRTAB(1,0)+4,LRSECT=LRSECT+1
"RTN","LRMIPSZ5",83,0)
 . . S LRTAB(LRSECT,LRI)=LRY
"RTN","LRMIPSZ5",84,0)
 . . S LRTAB(LRSECT,LRI,1)=LRTAB(LRSECT,LRI)
"RTN","LRMIPSZ5",85,0)
 . . S LRTAB(LRSECT,LRI,2)=LRTAB(LRSECT,LRI)
"RTN","LRMIPSZ5",86,0)
 . . S LRSECT(LRSECT)=$G(LRSECT(LRSECT))_LRI_"^"
"RTN","LRMIPSZ5",87,0)
 . . S LRCOMTAB(LRSECT)=LRTAB(LRSECT,LRI)+LRWIDTH(LRI,1)+2
"RTN","LRMIPSZ5",88,0)
 ;
"RTN","LRMIPSZ5",89,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",90,0)
 W ! D NP Q:LRABORT
"RTN","LRMIPSZ5",91,0)
 ;
"RTN","LRMIPSZ5",92,0)
 W !,"ANTIBIOTIC SUSCEPTIBILITY TEST RESULTS:"
"RTN","LRMIPSZ5",93,0)
 I $D(^XUSEC("LRLAB",DUZ))&'$D(LRWRDVEW) W "  ('*' indicates display is suppressed)"
"RTN","LRMIPSZ5",94,0)
 ;
"RTN","LRMIPSZ5",95,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",96,0)
 ;
"RTN","LRMIPSZ5",97,0)
 ; If hard copy (LRHC=1)
"RTN","LRMIPSZ5",98,0)
 I LRHC W ! D NP Q:LRABORT
"RTN","LRMIPSZ5",99,0)
 ;
"RTN","LRMIPSZ5",100,0)
 S LRSECT=0
"RTN","LRMIPSZ5",101,0)
 F  S LRSECT=$O(LRTAB(LRSECT)) Q:'LRSECT  D SECT
"RTN","LRMIPSZ5",102,0)
 ;
"RTN","LRMIPSZ5",103,0)
 Q
"RTN","LRMIPSZ5",104,0)
 ;
"RTN","LRMIPSZ5",105,0)
 ;
"RTN","LRMIPSZ5",106,0)
SECT ; Print antibiotic susceptibility for each section
"RTN","LRMIPSZ5",107,0)
 ;
"RTN","LRMIPSZ5",108,0)
 N LRAO
"RTN","LRMIPSZ5",109,0)
 ;
"RTN","LRMIPSZ5",110,0)
 D BUGHDR Q:LRABORT
"RTN","LRMIPSZ5",111,0)
 ;
"RTN","LRMIPSZ5",112,0)
 ; Display antibiotics by print order
"RTN","LRMIPSZ5",113,0)
 S LRAO=0
"RTN","LRMIPSZ5",114,0)
 F  S LRAO=$O(^LAB(62.06,"AO",LRAO)) Q:LRAO<.001!($G(LREND))  D  Q:LRABORT
"RTN","LRMIPSZ5",115,0)
 . S B=$O(^LAB(62.06,"AO",LRAO,0))
"RTN","LRMIPSZ5",116,0)
 . I B>0,$D(^LAB(62.06,B,0)) D AB
"RTN","LRMIPSZ5",117,0)
 ;
"RTN","LRMIPSZ5",118,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",119,0)
 W !
"RTN","LRMIPSZ5",120,0)
 D NP
"RTN","LRMIPSZ5",121,0)
 ;
"RTN","LRMIPSZ5",122,0)
 Q
"RTN","LRMIPSZ5",123,0)
 ;
"RTN","LRMIPSZ5",124,0)
 ;
"RTN","LRMIPSZ5",125,0)
CHECK ;
"RTN","LRMIPSZ5",126,0)
 ;
"RTN","LRMIPSZ5",127,0)
 N B,B1,B2,B3,LRBN,LRFLAG,LR1PASS
"RTN","LRMIPSZ5",128,0)
 ;
"RTN","LRMIPSZ5",129,0)
 S LRFLAG=0,LRBN=2
"RTN","LRMIPSZ5",130,0)
 F  S LRBN=+$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG,LRBN)) Q:LRBN'["2."!($G(LREND))  D
"RTN","LRMIPSZ5",131,0)
 . S B=^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG,LRBN),B1=$P(B,U),B2=$P(B,U,2)
"RTN","LRMIPSZ5",132,0)
 . I B1'="" D FIRST
"RTN","LRMIPSZ5",133,0)
 ;
"RTN","LRMIPSZ5",134,0)
 S LRBN=2
"RTN","LRMIPSZ5",135,0)
 F  S LRBN=+$O(LR1PASS(LRBN)) Q:LRBN<1!($G(LREND))  D
"RTN","LRMIPSZ5",136,0)
 . S B=LR1PASS(LRBN),B1=$P(B,U),B2=$P(B,U,2),B3=$P(B,U,3)
"RTN","LRMIPSZ5",137,0)
 . D LAB
"RTN","LRMIPSZ5",138,0)
 ;
"RTN","LRMIPSZ5",139,0)
 S LRBUG(A)=LRBUG
"RTN","LRMIPSZ5",140,0)
 ;
"RTN","LRMIPSZ5",141,0)
 Q
"RTN","LRMIPSZ5",142,0)
 ;
"RTN","LRMIPSZ5",143,0)
 ;
"RTN","LRMIPSZ5",144,0)
FIRST ;
"RTN","LRMIPSZ5",145,0)
 ;
"RTN","LRMIPSZ5",146,0)
 ; If format is 'interpretation only' and no interpretation for this sensitivity then display sensitivity result in it's place.
"RTN","LRMIPSZ5",147,0)
 I B2="" S B2=$S(LRFMT="I":B1,1:" ")
"RTN","LRMIPSZ5",148,0)
 ;
"RTN","LRMIPSZ5",149,0)
 S B3=$P(B,U,3)
"RTN","LRMIPSZ5",150,0)
 I B2'=" ",$E(B2)'="R","A"[B3 S LRFLAG=1
"RTN","LRMIPSZ5",151,0)
 S LR1PASS(LRBN)=B1_U_B2_U_B3
"RTN","LRMIPSZ5",152,0)
 S $P(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG,LRBN),U,1,3)=LR1PASS(LRBN)
"RTN","LRMIPSZ5",153,0)
 Q
"RTN","LRMIPSZ5",154,0)
 ;
"RTN","LRMIPSZ5",155,0)
 ;
"RTN","LRMIPSZ5",156,0)
LAB ;
"RTN","LRMIPSZ5",157,0)
 I $D(^XUSEC("LRLAB",DUZ)),'$D(LRWRDVEW) D  Q
"RTN","LRMIPSZ5",158,0)
 . S $P(LRRES(LRBN),U,A)=$S(B3="N"!(B3="R"&LRFLAG):B1_"*",1:B1)
"RTN","LRMIPSZ5",159,0)
 . S $P(LRINT(LRBN),U,A)=$S(B3="N"!(B3="R"&LRFLAG):B2_"*",1:B2)
"RTN","LRMIPSZ5",160,0)
 ;
"RTN","LRMIPSZ5",161,0)
 I B3=""!(B3="A")!(B3="R"&'LRFLAG) S $P(LRRES(LRBN),U,A)=B1,$P(LRINT(LRBN),U,A)=B2
"RTN","LRMIPSZ5",162,0)
 Q
"RTN","LRMIPSZ5",163,0)
 ;
"RTN","LRMIPSZ5",164,0)
 ;
"RTN","LRMIPSZ5",165,0)
AB ;
"RTN","LRMIPSZ5",166,0)
 N PGNUM,LRX
"RTN","LRMIPSZ5",167,0)
 Q:$G(LREND)
"RTN","LRMIPSZ5",168,0)
 S LRX=$G(^LAB(62.06,B,0)),J=$P(LRX,"^",2)
"RTN","LRMIPSZ5",169,0)
 I J<1 Q
"RTN","LRMIPSZ5",170,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",171,0)
 I '$D(LRINT(J)) Q
"RTN","LRMIPSZ5",172,0)
 I LRINT(J)'="",LRINT(J)?."^" Q
"RTN","LRMIPSZ5",173,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",174,0)
 ;
"RTN","LRMIPSZ5",175,0)
 ; Write name of antibiotic
"RTN","LRMIPSZ5",176,0)
 W !,$$LJ^XLFSTR($P(LRX,U),30,".")
"RTN","LRMIPSZ5",177,0)
 ;
"RTN","LRMIPSZ5",178,0)
 ; Antibiotic display comment from file #62.06
"RTN","LRMIPSZ5",179,0)
 K LRDCOM(0)
"RTN","LRMIPSZ5",180,0)
 S LRDCOM=$P(LRX,U,3)
"RTN","LRMIPSZ5",181,0)
 ; If longer than comment window (IOM-LRCOMTAB) then format to fit within window.
"RTN","LRMIPSZ5",182,0)
 I $L(LRDCOM)>(IOM-LRCOMTAB(LRSECT)) D
"RTN","LRMIPSZ5",183,0)
 . N J,K,L
"RTN","LRMIPSZ5",184,0)
 . S J=$L(LRDCOM),K=0,L=IOM-LRCOMTAB(LRSECT)-1 S:L<1 L=1
"RTN","LRMIPSZ5",185,0)
 . F  Q:LRDCOM=""  S K=K+1,LRDCOM(0,K)=$E(LRDCOM,1,L),LRDCOM=$E(LRDCOM,L+1,J)
"RTN","LRMIPSZ5",186,0)
 ;
"RTN","LRMIPSZ5",187,0)
 D SIR
"RTN","LRMIPSZ5",188,0)
 ;
"RTN","LRMIPSZ5",189,0)
 S PGNUM=LRPG
"RTN","LRMIPSZ5",190,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",191,0)
 I LRPG>PGNUM D BUGHDR D NP
"RTN","LRMIPSZ5",192,0)
 Q
"RTN","LRMIPSZ5",193,0)
 ;
"RTN","LRMIPSZ5",194,0)
 ;
"RTN","LRMIPSZ5",195,0)
BUGHDR ;
"RTN","LRMIPSZ5",196,0)
 ;
"RTN","LRMIPSZ5",197,0)
 N A,J
"RTN","LRMIPSZ5",198,0)
 F J=1:1 S LRBUG=$P(LRSECT(LRSECT),"^",J) Q:LRBUG=""!($G(LREND))  D
"RTN","LRMIPSZ5",199,0)
 . S LRORG=$P(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG(LRBUG),0),U),LRORG=$P(^LAB(61.2,LRORG,0),U)
"RTN","LRMIPSZ5",200,0)
 . I +$O(^TMP("LRMI",$J,LRDFN,"MI",LRIDT,3,LRBUG(LRBUG),2))'["2." Q
"RTN","LRMIPSZ5",201,0)
 . D ORG
"RTN","LRMIPSZ5",202,0)
 ;
"RTN","LRMIPSZ5",203,0)
 I LRFMT="B" D
"RTN","LRMIPSZ5",204,0)
 . W !
"RTN","LRMIPSZ5",205,0)
 . F J=1:1 S A=$P(LRSECT(LRSECT),"^",J) Q:A=""  W ?LRTAB(LRSECT,A),":"
"RTN","LRMIPSZ5",206,0)
 ;
"RTN","LRMIPSZ5",207,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",208,0)
 W !
"RTN","LRMIPSZ5",209,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",210,0)
 ;
"RTN","LRMIPSZ5",211,0)
 F J=1:1 S A=$P(LRSECT(LRSECT),"^",J) Q:A=""  D
"RTN","LRMIPSZ5",212,0)
 . I LRFMT'="B" W ?LRTAB(LRSECT,A),":"
"RTN","LRMIPSZ5",213,0)
 . I LRFMT="B" W ?LRTAB(LRSECT,A,1),"SUSC",?LRTAB(LRSECT,A,2),"INTP"
"RTN","LRMIPSZ5",214,0)
 ;
"RTN","LRMIPSZ5",215,0)
 D NP
"RTN","LRMIPSZ5",216,0)
 Q
"RTN","LRMIPSZ5",217,0)
 ;
"RTN","LRMIPSZ5",218,0)
 ;
"RTN","LRMIPSZ5",219,0)
ORG ;
"RTN","LRMIPSZ5",220,0)
 ;
"RTN","LRMIPSZ5",221,0)
 ; LR2ORMOR flag indicating 2 or more organsims on report - set in LRMIPSZ2.
"RTN","LRMIPSZ5",222,0)
 ;
"RTN","LRMIPSZ5",223,0)
 N J
"RTN","LRMIPSZ5",224,0)
 W !
"RTN","LRMIPSZ5",225,0)
 D NP Q:LRABORT
"RTN","LRMIPSZ5",226,0)
 ;
"RTN","LRMIPSZ5",227,0)
 I LRBUG>$P(LRSECT(LRSECT),"^") F J=1:1 Q:$P(LRSECT(LRSECT),"^",J)=LRBUG  W ?LRTAB(LRSECT,$P(LRSECT(LRSECT),"^",J)),":"
"RTN","LRMIPSZ5",228,0)
 ;
"RTN","LRMIPSZ5",229,0)
 W ?LRTAB(LRSECT,LRBUG),$S(LR2ORMOR:LRBUG(LRBUG)_". ",1:""),LRORG
"RTN","LRMIPSZ5",230,0)
 D NP
"RTN","LRMIPSZ5",231,0)
 Q
"RTN","LRMIPSZ5",232,0)
 ;
"RTN","LRMIPSZ5",233,0)
 ;
"RTN","LRMIPSZ5",234,0)
SIR ; Display the susceptibility results/interpretations
"RTN","LRMIPSZ5",235,0)
 ;
"RTN","LRMIPSZ5",236,0)
 N II,K
"RTN","LRMIPSZ5",237,0)
 ;
"RTN","LRMIPSZ5",238,0)
 F K=1:1 S II=$P(LRSECT(LRSECT),"^",K) Q:II=""  D
"RTN","LRMIPSZ5",239,0)
 . I LRFMT="B" D  Q
"RTN","LRMIPSZ5",240,0)
 . . W ?LRTAB(LRSECT,II,1),$P($G(LRRES(J)),U,II)
"RTN","LRMIPSZ5",241,0)
 . . W ?LRTAB(LRSECT,II,2),$P(LRINT(J),U,II),"  "
"RTN","LRMIPSZ5",242,0)
 . I LRFMT="I" W ?LRTAB(LRSECT,II,2),$P(LRINT(J),U,II)," " Q
"RTN","LRMIPSZ5",243,0)
 . I LRFMT="R" W ?LRTAB(LRSECT,II,1),$P(LRRES(J),U,II)," " Q
"RTN","LRMIPSZ5",244,0)
 ;
"RTN","LRMIPSZ5",245,0)
 D DCOM
"RTN","LRMIPSZ5",246,0)
 Q
"RTN","LRMIPSZ5",247,0)
 ;
"RTN","LRMIPSZ5",248,0)
 ;
"RTN","LRMIPSZ5",249,0)
DCOM ;
"RTN","LRMIPSZ5",250,0)
 N A,K
"RTN","LRMIPSZ5",251,0)
 ;
"RTN","LRMIPSZ5",252,0)
 I LRDCOM'="" D
"RTN","LRMIPSZ5",253,0)
 . I LRCOMTAB(LRSECT)<$X,$L(LRDCOM)>(IOM-$X) W !
"RTN","LRMIPSZ5",254,0)
 . W ?LRCOMTAB(LRSECT),LRDCOM
"RTN","LRMIPSZ5",255,0)
 ;
"RTN","LRMIPSZ5",256,0)
 I $D(LRDCOM(0)) D
"RTN","LRMIPSZ5",257,0)
 . N J
"RTN","LRMIPSZ5",258,0)
 . S J=0
"RTN","LRMIPSZ5",259,0)
 . F  S J=$O(LRDCOM(0,J)) Q:'J  W:J'=1 ! W ?LRCOMTAB(LRSECT),LRDCOM(0,J)
"RTN","LRMIPSZ5",260,0)
 ;
"RTN","LRMIPSZ5",261,0)
 I $D(LRDCOM(J)) D
"RTN","LRMIPSZ5",262,0)
 . S K=0,A=0
"RTN","LRMIPSZ5",263,0)
 . F  S A=+$O(LRDCOM(J,A)) Q:A<1  D
"RTN","LRMIPSZ5",264,0)
 . . I '('K&(LRDCOM="")) W !
"RTN","LRMIPSZ5",265,0)
 . . W ?LRCOMTAB(LRSECT),LRDCOM(J,A) S K=1
"RTN","LRMIPSZ5",266,0)
 Q
"RTN","LRMIPSZ5",267,0)
 ;
"RTN","LRMIPSZ5",268,0)
 ;
"RTN","LRMIPSZ5",269,0)
NHDR ;
"RTN","LRMIPSZ5",270,0)
 F X=1:1 W ! Q:$Y>(IOSL-LRFLIP)
"RTN","LRMIPSZ5",271,0)
 Q:$G(LREND)  I 'LRHC D FH^LRMIPSU Q
"RTN","LRMIPSZ5",272,0)
 W ! F X=1:1:IOM W "-"
"RTN","LRMIPSZ5",273,0)
 W !,"PATIENT'S IDENTIFICATION",?60,"MICROBIOLOGY REPORT"
"RTN","LRMIPSZ5",274,0)
 W !!,PNM,?$X+3,SSN,?$X+3,SEX,?$X+3,"DOB: ",DOB,"  WARD: ",LRWRD,!,"ADM: ",LRADM,"   ADM DX: ",LRADX
"RTN","LRMIPSZ5",275,0)
 S LRPG=LRPG+1
"RTN","LRMIPSZ5",276,0)
 W @IOF,!,?18,"MICROBIOLOGY LAB ",$$INS^LRU
"RTN","LRMIPSZ5",277,0)
 W ?$X+10,$$HTE^XLFDT($H,"D"),!
"RTN","LRMIPSZ5",278,0)
 F X=1:1:IOM W "-"
"RTN","LRMIPSZ5",279,0)
 W !,"ACCESSION: ",LRACC,?25,"TAKEN:",LRTK,?52,"RECEIVED:",LRRC
"RTN","LRMIPSZ5",280,0)
 Q
"RTN","LRMIPSZ5",281,0)
 ;
"RTN","LRMIPSZ5",282,0)
 ;
"RTN","LRMIPSZ5",283,0)
NP ;
"RTN","LRMIPSZ5",284,0)
 ; Convenience method
"RTN","LRMIPSZ5",285,0)
 D NP^LRMIPSZ1
"RTN","LRMIPSZ5",286,0)
 Q
"RTN","LRVER4")
0^1^B82283549^B82238256
"RTN","LRVER4",1,0)
LRVER4 ;DALOI/STAFF - LAB ROUTINE DATA VERIFICATION ;07/06/10  14:08
"RTN","LRVER4",2,0)
 ;;5.2;LAB SERVICE;**14,42,112,121,140,171,153,188,279,283,286,350,437**;Sep 27, 1994;Build 3
"RTN","LRVER4",3,0)
 ;
"RTN","LRVER4",4,0)
 N LRAMEND,LRRFLAG
"RTN","LRVER4",5,0)
 ;
"RTN","LRVER4",6,0)
LOOP ;
"RTN","LRVER4",7,0)
 S LRLCT=0
"RTN","LRVER4",8,0)
 I '$D(LRGVP) D
"RTN","LRVER4",9,0)
 . S:$D(LRWRDS) LRWRD=LRWRDS
"RTN","LRVER4",10,0)
 . W !!,PNM,"  SSN: ",SSN,"   " S LRLCT=LRLCT+1
"RTN","LRVER4",11,0)
 . I LRDPF=2 W "   LOC: ",$S(LRWRD'="":LRWRD,1:$S($L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,7)):$P(^(0),U,7),1:"??"))
"RTN","LRVER4",12,0)
 ;
"RTN","LRVER4",13,0)
 W !,"Pat Info: ",$P($G(^LR(LRDFN,.091)),U)
"RTN","LRVER4",14,0)
 W ?34," Sex: ",$S(SEX="M":"MALE",SEX="F":"FEMALE",1:SEX)
"RTN","LRVER4",15,0)
 W ?48," Age: ",$$CALCAGE^LRRPU(DOB,LRCDT)," as of ",$$FMTE^XLFDT(LRCDT,"1D")
"RTN","LRVER4",16,0)
 S LRPRAC=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,8)
"RTN","LRVER4",17,0)
 I LRPRAC>0,LRPRAC=+LRPRAC D GETS^DIQ(200,LRPRAC_",",".01;.132;.137;.138","E","LRPRAC(LRPRAC)","LRERR")
"RTN","LRVER4",18,0)
 W !,"Provider: "
"RTN","LRVER4",19,0)
 S LRLCT=LRLCT+2
"RTN","LRVER4",20,0)
 I LRPRAC'="",'$D(LRPRAC(LRPRAC,200)) W LRPRAC
"RTN","LRVER4",21,0)
 I LRPRAC,$D(LRPRAC(LRPRAC,200)) D
"RTN","LRVER4",22,0)
 . W LRPRAC(LRPRAC,200,LRPRAC_",",.01,"E"),?40," Voice pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.137,"E")
"RTN","LRVER4",23,0)
 . W !,"   Phone: ",LRPRAC(LRPRAC,200,LRPRAC_",",.132,"E"),?38," Digital pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.138,"E")
"RTN","LRVER4",24,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",25,0)
 ;
"RTN","LRVER4",26,0)
 N PRAC,PR
"RTN","LRVER4",27,0)
 D PRAC^LR7OMERG(LRAA,LRAD,LRAN,.PRAC)
"RTN","LRVER4",28,0)
 I $O(PRAC(0)) D
"RTN","LRVER4",29,0)
 . S PR=0
"RTN","LRVER4",30,0)
 . F  S PR=$O(PRAC(PR)) Q:PR<1  I $D(^VA(200,PR,0)) W !?14,$P(^(0),"^") S LRLCT=LRLCT+1
"RTN","LRVER4",31,0)
 W ! S LRLCT=LRLCT+1
"RTN","LRVER4",32,0)
 S LRNX=0,LRVRM=2,T=""
"RTN","LRVER4",33,0)
 I $P(^LR(LRDFN,LRSS,LRIDT,0),U,7)'="" D
"RTN","LRVER4",34,0)
 . W !,"VOLUME: ",$P(^(0),U,7)
"RTN","LRVER4",35,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",36,0)
 S LRACC=$P(Z1,U,6)
"RTN","LRVER4",37,0)
 W !,"ACCESSION:",?30,$P(Z2,U,6),?44," ",LRACC_" ["_LRUID,"]"
"RTN","LRVER4",38,0)
 W !,?30,LRDAT(2) W ?44," ",LRDAT
"RTN","LRVER4",39,0)
 S LRLCT=LRLCT+2
"RTN","LRVER4",40,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRVER4",41,0)
 . W !?15 W:$E(IOST,1,2)="C-" @LRVIDO
"RTN","LRVER4",42,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRVER4",43,0)
 . W:$E(IOST,1,2)="C-" @LRVIDOF,$C(7)
"RTN","LRVER4",44,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",45,0)
 ;
"RTN","LRVER4",46,0)
 I '$O(LRORD(0)) W !!?7,$C(7),"This is not a verifiable test/accession ",! Q
"RTN","LRVER4",47,0)
V I $D(LRGVP) D V20 Q
"RTN","LRVER4",48,0)
 G EDIT:($O(^LR(LRDFN,LRSS,LRIDT,1))=""!('LRVF&$D(LRPER)))&'$D(LRNUF)
"RTN","LRVER4",49,0)
 K LRNUF
"RTN","LRVER4",50,0)
 D V20,ND G V37:LRVF&'$D(X)#2,EDIT:LREDIT
"RTN","LRVER4",51,0)
 S LRTEC=$S($D(^LRO(68,LRAA,1,LRAD,2)):$P(^(2),U),1:$S($D(LRUSI):LRUSI,1:"")),LREDIT=0
"RTN","LRVER4",52,0)
V36 ;
"RTN","LRVER4",53,0)
 Q:$D(LRGVP)
"RTN","LRVER4",54,0)
 K DIR
"RTN","LRVER4",55,0)
 S DIR(0)="SAO^E:Edit;C:Comments;W:Workload"
"RTN","LRVER4",56,0)
 S DIR("A")="SELECT ('E' to Edit, 'C' for Comments, 'W' Workload): "
"RTN","LRVER4",57,0)
 D ^DIR
"RTN","LRVER4",58,0)
 I $D(DIRUT) S X="^" G V37
"RTN","LRVER4",59,0)
 S X=Y
"RTN","LRVER4",60,0)
 S:$E(X)="E" LREDIT=1,X=""
"RTN","LRVER4",61,0)
 K LRNC
"RTN","LRVER4",62,0)
 I $E(X)="C" S LRNC=1 D COM K LRNC G V36
"RTN","LRVER4",63,0)
 I $E(X)="W" D  G LOOP
"RTN","LRVER4",64,0)
 . I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D STD^LRCAPV,EN^LRCAPV S LREND=0 Q
"RTN","LRVER4",65,0)
 . W !?10," Workload is not activated."
"RTN","LRVER4",66,0)
 S X=$S(X="@":"",X="":LRTEC,1:X),LRTEC=X
"RTN","LRVER4",67,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,2)) ^(2)="" S ^(2)=X_U_$P(^(2),U,2,99)
"RTN","LRVER4",68,0)
 G EDIT:LREDIT
"RTN","LRVER4",69,0)
V37 Q  ;LEAVE LRVER4, BACK TO LRVER3
"RTN","LRVER4",70,0)
 ;
"RTN","LRVER4",71,0)
 ;
"RTN","LRVER4",72,0)
V20 ;
"RTN","LRVER4",73,0)
 I $G(LRCHG) D V21,LRCFL,DCOM^LRVERA Q
"RTN","LRVER4",74,0)
 S LRNX=$O(LRORD(LRNX)) G V35:LRNX<1 D SUBS
"RTN","LRVER4",75,0)
 G:'$G(LRTS) V20
"RTN","LRVER4",76,0)
 I '$D(LRSB(LRSB)),'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) G V20
"RTN","LRVER4",77,0)
 D V25^LRVER5
"RTN","LRVER4",78,0)
 ;
"RTN","LRVER4",79,0)
 D:$D(LRGVP) PG Q:$D(LRGVP)&($D(DTOUT)!$D(DUOUT))
"RTN","LRVER4",80,0)
 ;
"RTN","LRVER4",81,0)
 W !,$P(^LAB(60,+LRTS,0),U)
"RTN","LRVER4",82,0)
 S X1=""
"RTN","LRVER4",83,0)
 I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRVER4",84,0)
 . S X1=$P(^(LRSB),U),X=X1
"RTN","LRVER4",85,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",86,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRVER4",87,0)
 . . I X="" S X=X1
"RTN","LRVER4",88,0)
 . W:X'="" ?30,@LRFP
"RTN","LRVER4",89,0)
 S (X,LRFLG)=""
"RTN","LRVER4",90,0)
 I $D(LRSB(LRSB)) D
"RTN","LRVER4",91,0)
 . N LRX
"RTN","LRVER4",92,0)
 . K LRNOVER(LRSB)
"RTN","LRVER4",93,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRVER4",94,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRVER4",95,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",96,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRVER4",97,0)
 . . I X="" S X=LRX
"RTN","LRVER4",98,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P($P(LRSB(LRSB),U,5),"!",7) ;$P(LRNG,U,7)
"RTN","LRVER4",99,0)
 . S X=LRX
"RTN","LRVER4",100,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",101,0)
 . S Y=0
"RTN","LRVER4",102,0)
 . I LRDEL'="" S LRQ=1 D XDELTACK^LRVERA K LRQ
"RTN","LRVER4",103,0)
 . W "  "
"RTN","LRVER4",104,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",105,0)
 ;
"RTN","LRVER4",106,0)
 S:$P(X,U)="" $P(LRSB(LRSB),U)=""
"RTN","LRVER4",107,0)
 I $P(X,U)'="" D
"RTN","LRVER4",108,0)
 . N I,LRX,LRY
"RTN","LRVER4",109,0)
 . S $P(LRSB(LRSB),U)=X,$P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRVER4",110,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVER4",111,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVER4",112,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVER4",113,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRVER4",114,0)
 . D
"RTN","LRVER4",115,0)
 . . I $P(LRSB(LRSB),U,4)!($P(LRSB(LRSB),U)="pending") Q
"RTN","LRVER4",116,0)
 . . I '$D(LRSA(LRSB))#2 S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"") Q
"RTN","LRVER4",117,0)
 . . I $P(LRSB(LRSB),U)=$P(LRSA(LRSB),U) S:$P(LRSA(LRSB),U,4) $P(LRSB(LRSB),U,4)=$P(LRSA(LRSB),U,4) S $P(LRSA(LRSB),U,3)=$P(LRSB(LRSB),U,3) Q
"RTN","LRVER4",118,0)
 . . S:'$P(LRSB(LRSB),U,4) $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRVER4",119,0)
 . S $P(LRSB(LRSB),U,5)=$TR(LRNGS,U,"!")
"RTN","LRVER4",120,0)
 I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>22 WT G:$G(Y)'="^" V20
"RTN","LRVER4",121,0)
 ;
"RTN","LRVER4",122,0)
V35 ;
"RTN","LRVER4",123,0)
 D LRCFL:LRCFL]""
"RTN","LRVER4",124,0)
 D DCOM^LRVERA K LRNUF
"RTN","LRVER4",125,0)
 Q
"RTN","LRVER4",126,0)
 ;
"RTN","LRVER4",127,0)
 ;
"RTN","LRVER4",128,0)
LRCFL ;
"RTN","LRVER4",129,0)
 S LREXEC=LRCFL D ^LREXEC:LRCFL[""
"RTN","LRVER4",130,0)
 D:LRLCT>22 WT
"RTN","LRVER4",131,0)
 Q
"RTN","LRVER4",132,0)
 ;
"RTN","LRVER4",133,0)
 ;
"RTN","LRVER4",134,0)
EDIT ;
"RTN","LRVER4",135,0)
 K LROUT
"RTN","LRVER4",136,0)
 D ^LRVER5 S LRVRM=2 G:$G(LRCHG) LOOP G LRCFL:$D(LROUT)!$D(LRPER)
"RTN","LRVER4",137,0)
 G LOOP
"RTN","LRVER4",138,0)
 ;
"RTN","LRVER4",139,0)
 ;
"RTN","LRVER4",140,0)
RANGE ;
"RTN","LRVER4",141,0)
 N LRI,LRFIND
"RTN","LRVER4",142,0)
 S Y=X
"RTN","LRVER4",143,0)
 I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",144,0)
 W "  "
"RTN","LRVER4",145,0)
 F LRI=1:1:$L(X) S LRFIND=$E(X,LRI) Q:LRFIND?1(1N,1A,1".",1"-",1"<",1">")
"RTN","LRVER4",146,0)
 S X=$E(X,LRI,999)
"RTN","LRVER4",147,0)
 ;
"RTN","LRVER4",148,0)
 ; User has indicated specific normality to set - used when entering
"RTN","LRVER4",149,0)
 ; reference lab results and all the info to calculate is not available.
"RTN","LRVER4",150,0)
 I $G(LRRFLAG(LRSB)) S LRFLG=$P("L^L*^H^H*","^",LRRFLAG(LRSB))
"RTN","LRVER4",151,0)
 ;
"RTN","LRVER4",152,0)
 E  D RANGECHK
"RTN","LRVER4",153,0)
 I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",154,0)
RQ S X=Y
"RTN","LRVER4",155,0)
 Q
"RTN","LRVER4",156,0)
 ;
"RTN","LRVER4",157,0)
 ;
"RTN","LRVER4",158,0)
RANGECHK ; Check result against reference ranges and set flag
"RTN","LRVER4",159,0)
 ;
"RTN","LRVER4",160,0)
 ;
"RTN","LRVER4",161,0)
 ; Check for numeric abnormal results
"RTN","LRVER4",162,0)
 I X?.1"-".N.1".".N D  Q
"RTN","LRVER4",163,0)
 . I LRNG4'="",LRNG4?.1"-".N.1".".N,X<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",164,0)
 . I LRNG5'="",LRNG5?.1"-".N.1".".N,X>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",165,0)
 . I LRNG2'="",LRNG2?.1"-".N.1".".N,X<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",166,0)
 . I LRNG3'="",LRNG3?.1"-".N.1".".N,X>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",167,0)
 ;
"RTN","LRVER4",168,0)
 ; Check for <> abnormal results
"RTN","LRVER4",169,0)
 ; "<" results checked against low values
"RTN","LRVER4",170,0)
 ; ">" results checked against high values
"RTN","LRVER4",171,0)
 I X?1(1"<",1">").N.1".".N D  Q
"RTN","LRVER4",172,0)
 . N LRX
"RTN","LRVER4",173,0)
 . S LRX=$E(X,2,$L(X))
"RTN","LRVER4",174,0)
 . I $E(X)="<" D  Q
"RTN","LRVER4",175,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",176,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX=LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",177,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",178,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX=LRNG2 S LRFLG="L" Q
"RTN","LRVER4",179,0)
 . I $E(X)=">" D  Q
"RTN","LRVER4",180,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",181,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX=LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",182,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",183,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX=LRNG3 S LRFLG="H" Q
"RTN","LRVER4",184,0)
 ;
"RTN","LRVER4",185,0)
 ; Check for ranges, i.e. 0-5, 6-10.
"RTN","LRVER4",186,0)
 ; Compare first value to abnormal value
"RTN","LRVER4",187,0)
 I X?1.N1"-"1.N D  Q
"RTN","LRVER4",188,0)
 . I LRNG4'="",LRNG4?.N.1".".N,+X<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",189,0)
 . I LRNG5'="",LRNG5?.N.1".".N,+X>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",190,0)
 . I LRNG2'="",LRNG2?.N.1".".N,+X<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",191,0)
 . I LRNG3'="",LRNG3?.N.1".".N,+X>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",192,0)
 ;
"RTN","LRVER4",193,0)
 Q
"RTN","LRVER4",194,0)
 ;
"RTN","LRVER4",195,0)
 ;
"RTN","LRVER4",196,0)
DISPFLG ; Display critical flags
"RTN","LRVER4",197,0)
 ;
"RTN","LRVER4",198,0)
 I $E(IOST,1,2)="C-" W $C(7),@LRVIDO
"RTN","LRVER4",199,0)
 W "CRITICAL ",$S($E(LRFLG,1)="L":"LOW",$E(LRFLG,1)="H":"HIGH",1:""),"!!"
"RTN","LRVER4",200,0)
 I $E(IOST,1,2)="C-" W @LRVIDOF,$C(7),$C(7)
"RTN","LRVER4",201,0)
 Q
"RTN","LRVER4",202,0)
 ;
"RTN","LRVER4",203,0)
 ;
"RTN","LRVER4",204,0)
SUBS ;
"RTN","LRVER4",205,0)
 S LRSB=LRORD(LRNX),LRTS=$S($D(^TMP("LR",$J,"TMP",LRSB)):^(LRSB),1:0)
"RTN","LRVER4",206,0)
 Q
"RTN","LRVER4",207,0)
 ;
"RTN","LRVER4",208,0)
 ;
"RTN","LRVER4",209,0)
ND ;
"RTN","LRVER4",210,0)
 K X,DIR
"RTN","LRVER4",211,0)
 Q:'LRVF
"RTN","LRVER4",212,0)
 I '$P($G(LRLABKY),U) D  Q
"RTN","LRVER4",213,0)
 . W !,"You're not authorized to edit verified data."
"RTN","LRVER4",214,0)
 . S LREDIT=0
"RTN","LRVER4",215,0)
 S DIR(0)="FO"
"RTN","LRVER4",216,0)
 S DIR("A")="If you need to change something, enter your initials"
"RTN","LRVER4",217,0)
 S DIR("?")="To change verified results, enter your initials."
"RTN","LRVER4",218,0)
 D ^DIR
"RTN","LRVER4",219,0)
 S X=Y K DIR
"RTN","LRVER4",220,0)
 I $$UP^XLFSTR(X)'=$$UP^XLFSTR(LRUSI) S LREDIT=0 K X QUIT
"RTN","LRVER4",221,0)
 I $D(X)#2,'$G(LRCHG) W ! D  S LRCHG=1
"RTN","LRVER4",222,0)
 . K LRSA S LRSA=1
"RTN","LRVER4",223,0)
 . F  S LRSA=$O(^LR(LRDFN,"CH",LRIDT,LRSA)) Q:'LRSA  S LRSA(LRSA)=^(LRSA)
"RTN","LRVER4",224,0)
 Q
"RTN","LRVER4",225,0)
 ;
"RTN","LRVER4",226,0)
 ;
"RTN","LRVER4",227,0)
WT S LRLCT=0 Q:$D(LRGVP)
"RTN","LRVER4",228,0)
 W !,"PRESS ANY KEY TO CONTINUE, '^' TO STOP " R Y:DTIME S:'$T Y="^"
"RTN","LRVER4",229,0)
 Q
"RTN","LRVER4",230,0)
 ;
"RTN","LRVER4",231,0)
 ;
"RTN","LRVER4",232,0)
COM ;from LRVER5
"RTN","LRVER4",233,0)
 Q:$D(LRGVP)
"RTN","LRVER4",234,0)
 K DR
"RTN","LRVER4",235,0)
 S DIE="^LR("_LRDFN_",""CH"",",DA=LRIDT,DA(1)=LRDFN,DR=.99
"RTN","LRVER4",236,0)
 D ^DIE,COM1:$D(LRNC)
"RTN","LRVER4",237,0)
 L +^LR(LRDFN,LRSS,LRIDT):5
"RTN","LRVER4",238,0)
 I $O(^LR(LRDFN,"CH",LRIDT,1,0))="" K ^LR(LRDFN,"CH",LRIDT,1)
"RTN","LRVER4",239,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVER4",240,0)
 Q
"RTN","LRVER4",241,0)
 ;
"RTN","LRVER4",242,0)
 ;
"RTN","LRVER4",243,0)
VOL ;
"RTN","LRVER4",244,0)
 W !,"VOLUME: ",$P(^LR(LRDFN,LRSS,LRIDT,0),U,7),"//" R X:DTIME
"RTN","LRVER4",245,0)
 G VOL:X["?" S:X'=""&(X'[U) ^(0)=$P(^(0),U,1,6)_U_X_U_$P(^(0),U,8,10)
"RTN","LRVER4",246,0)
 G COM
"RTN","LRVER4",247,0)
 ;
"RTN","LRVER4",248,0)
 ;
"RTN","LRVER4",249,0)
COM1 ;
"RTN","LRVER4",250,0)
 N LRX Q:'$P(^LR(LRDFN,LRSS,LRIDT,0),U,3)
"RTN","LRVER4",251,0)
 D XREF^LRVER3A
"RTN","LRVER4",252,0)
 S LRX=0 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S ^LRO(68,"AC",LRDFN,LRIDT,LRX)=""
"RTN","LRVER4",253,0)
 I $L($P(^LR(LRDFN,LRSS,LRIDT,0),U,9)),$E($P(^(0),U,9))'="-" S $P(^(0),U,9)="-"_$P(^(0),U,9)
"RTN","LRVER4",254,0)
 Q
"RTN","LRVER4",255,0)
 ;
"RTN","LRVER4",256,0)
 ;
"RTN","LRVER4",257,0)
PG Q:$Y<(IOSL+5)
"RTN","LRVER4",258,0)
 I $E(IOST,1,2)'="C-" W @IOF Q
"RTN","LRVER4",259,0)
 D PG^LRGVP
"RTN","LRVER4",260,0)
 Q
"RTN","LRVER4",261,0)
 ;
"RTN","LRVER4",262,0)
V21 ;
"RTN","LRVER4",263,0)
 N Y,LREND
"RTN","LRVER4",264,0)
 S LRSB=1,LRLCT=1
"RTN","LRVER4",265,0)
 F  S LRSB=+$O(LRSB(LRSB)) Q:'LRSB!($G(LREND))  D
"RTN","LRVER4",266,0)
 . N LRX
"RTN","LRVER4",267,0)
 . S LRTS=$O(^LAB(60,"C","CH;"_LRSB_";1",0)) Q:'LRTS
"RTN","LRVER4",268,0)
 . D V25^LRVER5
"RTN","LRVER4",269,0)
 . W !,$P(^LAB(60,LRTS,0),U) S X1=""
"RTN","LRVER4",270,0)
 . I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRVER4",271,0)
 . . S X1=$P(^(LRSB),U),(LRDL,X)=X1
"RTN","LRVER4",272,0)
 . . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",273,0)
 . . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRVER4",274,0)
 . . . I X="" S X=X1
"RTN","LRVER4",275,0)
 . . W:X'="" ?30,@LRFP
"RTN","LRVER4",276,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRVER4",277,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRVER4",278,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",279,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRVER4",280,0)
 . . I X="" S X=LRX
"RTN","LRVER4",281,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P(LRNG,U,7)
"RTN","LRVER4",282,0)
 . S X=LRX
"RTN","LRVER4",283,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",284,0)
 . S Y=0
"RTN","LRVER4",285,0)
 . I LRDEL'="" S LRQ=1 D XDELTACK^LRVERA K LRQ
"RTN","LRVER4",286,0)
 . W "  "
"RTN","LRVER4",287,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",288,0)
 . I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>15 WT S:$E($G(Y))="^" LREND=1
"RTN","LRVER4",289,0)
 Q
"RTN","LRVR5")
0^2^B12268085^B12201851
"RTN","LRVR5",1,0)
LRVR5 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;4/20/89  18:02
"RTN","LRVR5",2,0)
 ;;5.2;LAB SERVICE;**1,42,153,263,283,286,437**;Sep 27, 1994;Build 3
"RTN","LRVR5",3,0)
 ;
"RTN","LRVR5",4,0)
 S LRNX=0,LRVRM=11
"RTN","LRVR5",5,0)
V40 ;
"RTN","LRVR5",6,0)
 S LRNX=$O(LRORD(LRNX))
"RTN","LRVR5",7,0)
 G V44:LRNX<1 D SUBS G V40:'LRTS,V40:'$D(LRVTS(LRSB))
"RTN","LRVR5",8,0)
 ;
"RTN","LRVR5",9,0)
 ; Only allow verifying reference lab results which exist in LAH, no
"RTN","LRVR5",10,0)
 ; entering results "on the fly" - use EM options (^LRVER)
"RTN","LRVR5",11,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),'$D(^LAH(LRLL,1,LRSQ,LRSB)) K LRSB(LRSB) G V40
"RTN","LRVR5",12,0)
 ;
"RTN","LRVR5",13,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,LRSB)),^(LRSB)'["pending" D V25^LRVR4 G:LRVF V40
"RTN","LRVR5",14,0)
V42 D V25
"RTN","LRVR5",15,0)
 S X=$S($D(LRSB(LRSB)):$P(LRSB(LRSB),U),1:""),LREDIT=0
"RTN","LRVR5",16,0)
 I X="",LRDV'="" S $P(LRSB(LRSB),"^")=LRDV,X=LRDV
"RTN","LRVR5",17,0)
 S LRTEST=$P(^LAB(60,+LRTS,0),U),LROUT=0 K LRNOVER(LRSB)
"RTN","LRVR5",18,0)
Q42 W !,LRTEST," " W:X'="" @LRFP R "//",X:DTIME I X'?.ANP W $C(7)," No Control Characters Allowed." G V42
"RTN","LRVR5",19,0)
 I X=""&$D(LRSB(LRSB)) S X=$P(LRSB(LRSB),U)
"RTN","LRVR5",20,0)
Q43 S LRDL=X G V40:X="",V45:X'["^",V44:X="^",OUT:X="^^"
"RTN","LRVR5",21,0)
V43 S X=$P(X,U,2),DIC="^LAB(60,",DIC(0)="EOQZ" D ^DIC G:Y<1 Q42
"RTN","LRVR5",22,0)
 S LRPLOC=$P(Y(0),U,5),LRSSQ=$P(LRPLOC,";",1),LRSB=$P(LRPLOC,";",2),LRTS=+Y
"RTN","LRVR5",23,0)
 I LRSSQ="" W !,"Not in this group" G OUT
"RTN","LRVR5",24,0)
 I LRSS'=LRSSQ!'$D(^TMP("LR",$J,"TMP",LRSB)) W !,"Not in this group" G OUT
"RTN","LRVR5",25,0)
 F LRNX=0:0 S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  G V42:LRSB=LRORD(LRNX)
"RTN","LRVR5",26,0)
V44 D COM^LRVR4
"RTN","LRVR5",27,0)
 S LRNUF=1
"RTN","LRVR5",28,0)
 Q
"RTN","LRVR5",29,0)
 ;
"RTN","LRVR5",30,0)
 ;
"RTN","LRVR5",31,0)
V45 ;
"RTN","LRVR5",32,0)
 K LRSKIP
"RTN","LRVR5",33,0)
 S LRDL=X
"RTN","LRVR5",34,0)
 I X="@" D  G V46
"RTN","LRVR5",35,0)
 . S X=$S($D(LRM(LRSB)):"pending",1:"")
"RTN","LRVR5",36,0)
 . S $P(LRSB(LRSB),"^")=X,$P(LRSB(LRSB),"^",2)=""
"RTN","LRVR5",37,0)
 ;
"RTN","LRVR5",38,0)
 S X7=U_$P(^LAB(60,+LRTS,0),U,12),X6=X7_"0)"
"RTN","LRVR5",39,0)
 X:'(X="*"!($E(X)="?")!(X="C")!(X="#")!(X="canc")!(X="pending")) $P(@X6,U,5,99)
"RTN","LRVR5",40,0)
 I '$D(X)#2 D HELP G V42
"RTN","LRVR5",41,0)
 I $D(X)#2,X["?" D HELP G:'($P(@X6,U,2)["S") V42
"RTN","LRVR5",42,0)
 I $D(X)#2,$P(@X6,U,2)["S",X'="*",X'="#",X'="canc",X'="pending" D SET G:'$D(X)#2 V42
"RTN","LRVR5",43,0)
 I $D(X)#2,X="C",$P(@X6,U,2)'["S" D COMP^LRVER5 G V42
"RTN","LRVR5",44,0)
 ;
"RTN","LRVR5",45,0)
V46 G V44:'$D(X)#2
"RTN","LRVR5",46,0)
 S X1=$S($D(^LR(LRDFN,LRSS,LRLDT,LRSB)):$P(^(LRSB),U),1:""),LRFLG=""
"RTN","LRVR5",47,0)
 S:X="*" X="canc" S:X="#" X="comment"
"RTN","LRVR5",48,0)
 K LRQ S Y=0
"RTN","LRVR5",49,0)
 I LRDEL'="" S LRQ=1 D XDELTACK^LRVERA K LRQ
"RTN","LRVR5",50,0)
 D RANGE
"RTN","LRVR5",51,0)
 G:$D(LRNUF) V44
"RTN","LRVR5",52,0)
 K LRNUF
"RTN","LRVR5",53,0)
 G V40:'$D(LRSKIP)
"RTN","LRVR5",54,0)
 S X=LRSKIP
"RTN","LRVR5",55,0)
 G Q43:X["^",V40
"RTN","LRVR5",56,0)
 G RANGE
"RTN","LRVR5",57,0)
 ;
"RTN","LRVR5",58,0)
 ;
"RTN","LRVR5",59,0)
RANGE D RANGE^LRVER5
"RTN","LRVR5",60,0)
RQ S X=Y
"RTN","LRVR5",61,0)
NR ;
"RTN","LRVR5",62,0)
 S:$P(X,U)="" LRSB(LRSB)="" Q:$D(LRQ)
"RTN","LRVR5",63,0)
 I $P(X,U)'="" D
"RTN","LRVR5",64,0)
 . N I,LRX,LRY
"RTN","LRVR5",65,0)
 . S $P(LRSB(LRSB),U,1,2)=X_U_LRFLG
"RTN","LRVR5",66,0)
 . S $P(LRSB(LRSB),U,4)=$G(DUZ)
"RTN","LRVR5",67,0)
 . I $P(LRSB(LRSB),U,9)="" S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRVR5",68,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVR5",69,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVR5",70,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVR5",71,0)
 . S LRX=LRNGS,LRY=$P(LRSB(LRSB),U,5)
"RTN","LRVR5",72,0)
 . F I=1:1:$L(LRX,U) I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,U,I)
"RTN","LRVR5",73,0)
 . S $P(LRSB(LRSB),U,5)=LRY
"RTN","LRVR5",74,0)
 Q
"RTN","LRVR5",75,0)
 ;
"RTN","LRVR5",76,0)
 ;
"RTN","LRVR5",77,0)
SUBS ;
"RTN","LRVR5",78,0)
 D LRSUBS^LRVER5
"RTN","LRVR5",79,0)
 Q
"RTN","LRVR5",80,0)
 ;
"RTN","LRVR5",81,0)
 ;
"RTN","LRVR5",82,0)
SET ;
"RTN","LRVR5",83,0)
 D LRSET^LRVER5
"RTN","LRVR5",84,0)
 Q
"RTN","LRVR5",85,0)
 ;
"RTN","LRVR5",86,0)
 ;
"RTN","LRVR5",87,0)
HUH W !,"CHOOSE:" F I=1:1 S LRSUBS=$P(LRSET,";",I) Q:LRSUBS=""  W !,$P(LRSUBS,":")," FOR ",$P(LRSUBS,":",2)
"RTN","LRVR5",88,0)
 K X
"RTN","LRVR5",89,0)
 Q
"RTN","LRVR5",90,0)
 ;
"RTN","LRVR5",91,0)
 ;
"RTN","LRVR5",92,0)
V25 ; From LRVR4
"RTN","LRVR5",93,0)
 D V25^LRVER5
"RTN","LRVR5",94,0)
 Q
"RTN","LRVR5",95,0)
 ;
"RTN","LRVR5",96,0)
 ;
"RTN","LRVR5",97,0)
OUT S LROUT=1
"RTN","LRVR5",98,0)
 Q
"RTN","LRVR5",99,0)
 ;
"RTN","LRVR5",100,0)
 ;
"RTN","LRVR5",101,0)
HELP ;
"RTN","LRVR5",102,0)
 W !," ??",$C(7)
"RTN","LRVR5",103,0)
 S X5=X7_"3)"
"RTN","LRVR5",104,0)
 W:$D(@X5) " ",@X5
"RTN","LRVR5",105,0)
 W !,"Enter * to report ""canc"" for canceled."
"RTN","LRVR5",106,0)
 W !,"Enter # to report ""comment""."
"RTN","LRVR5",107,0)
 W:'($P(@X6,U,2)["S") !,"Enter C to enter calculate mode."
"RTN","LRVR5",108,0)
 Q
"VER")
8.0^22.0
"BLD",9575,6)
^353
**END**
**END**

