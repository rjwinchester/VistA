Released LR*5.2*421 SEQ #352
Extracted from mail message
**KIDS**:LR*5.2*421^

**INSTALL NAME**
LR*5.2*421
"BLD",8959,0)
LR*5.2*421^LAB SERVICE^0^3131011^y
"BLD",8959,4,0)
^9.64PA^69.5^1
"BLD",8959,4,69.5,0)
69.5
"BLD",8959,4,69.5,2,0)
^9.641^69.54^1
"BLD",8959,4,69.5,2,69.54,0)
ICD DIAGNOSIS  (sub-file)
"BLD",8959,4,69.5,2,69.54,1,0)
^9.6411^^
"BLD",8959,4,69.5,222)
y^y^p^^^^n^^n
"BLD",8959,4,69.5,224)

"BLD",8959,4,"APDD",69.5,69.54)

"BLD",8959,4,"B",69.5,69.5)

"BLD",8959,6)
^313
"BLD",8959,6.3)
48
"BLD",8959,"ABPKG")
n
"BLD",8959,"INIT")
LR421P
"BLD",8959,"KRN",0)
^9.67PA^779.2^20
"BLD",8959,"KRN",.4,0)
.4
"BLD",8959,"KRN",.401,0)
.401
"BLD",8959,"KRN",.402,0)
.402
"BLD",8959,"KRN",.403,0)
.403
"BLD",8959,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",8959,"KRN",.403,"NM",1,0)
LREPI9    FILE #69.5^69.5^0
"BLD",8959,"KRN",.403,"NM","B","LREPI9    FILE #69.5",1)

"BLD",8959,"KRN",.5,0)
.5
"BLD",8959,"KRN",.84,0)
.84
"BLD",8959,"KRN",3.6,0)
3.6
"BLD",8959,"KRN",3.8,0)
3.8
"BLD",8959,"KRN",9.2,0)
9.2
"BLD",8959,"KRN",9.8,0)
9.8
"BLD",8959,"KRN",9.8,"NM",0)
^9.68A^18^15
"BLD",8959,"KRN",9.8,"NM",1,0)
LREPI^^0^B66094816
"BLD",8959,"KRN",9.8,"NM",2,0)
LREPI3^^0^B50368609
"BLD",8959,"KRN",9.8,"NM",3,0)
LREPI5^^0^B7519412
"BLD",8959,"KRN",9.8,"NM",4,0)
LREPIPI^^0^B21641423
"BLD",8959,"KRN",9.8,"NM",6,0)
LREPIRP7^^0^B69807608
"BLD",8959,"KRN",9.8,"NM",8,0)
LR421P^^0^B10419361
"BLD",8959,"KRN",9.8,"NM",9,0)
LREPICD^^0^B3035110
"BLD",8959,"KRN",9.8,"NM",10,0)
LREPIXDG^^0^B1966011
"BLD",8959,"KRN",9.8,"NM",11,0)
LREPI2^^0^B33293208
"BLD",8959,"KRN",9.8,"NM",12,0)
LREPIRP3^^0^B78340966
"BLD",8959,"KRN",9.8,"NM",13,0)
LREPIRP5^^0^B38416569
"BLD",8959,"KRN",9.8,"NM",15,0)
LREPIRS1^^0^B39937424
"BLD",8959,"KRN",9.8,"NM",16,0)
LREPIRS3^^0^B54324401
"BLD",8959,"KRN",9.8,"NM",17,0)
LREPI2A^^0^B25843319
"BLD",8959,"KRN",9.8,"NM",18,0)
LREPISRV^^0^B28774078
"BLD",8959,"KRN",9.8,"NM","B","LR421P",8)

"BLD",8959,"KRN",9.8,"NM","B","LREPI",1)

"BLD",8959,"KRN",9.8,"NM","B","LREPI2",11)

"BLD",8959,"KRN",9.8,"NM","B","LREPI2A",17)

"BLD",8959,"KRN",9.8,"NM","B","LREPI3",2)

"BLD",8959,"KRN",9.8,"NM","B","LREPI5",3)

"BLD",8959,"KRN",9.8,"NM","B","LREPICD",9)

"BLD",8959,"KRN",9.8,"NM","B","LREPIPI",4)

"BLD",8959,"KRN",9.8,"NM","B","LREPIRP3",12)

"BLD",8959,"KRN",9.8,"NM","B","LREPIRP5",13)

"BLD",8959,"KRN",9.8,"NM","B","LREPIRP7",6)

"BLD",8959,"KRN",9.8,"NM","B","LREPIRS1",15)

"BLD",8959,"KRN",9.8,"NM","B","LREPIRS3",16)

"BLD",8959,"KRN",9.8,"NM","B","LREPISRV",18)

"BLD",8959,"KRN",9.8,"NM","B","LREPIXDG",10)

"BLD",8959,"KRN",19,0)
19
"BLD",8959,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8959,"KRN",19,"NM",1,0)
LREPI PARAMETER SETUP^^0
"BLD",8959,"KRN",19,"NM","B","LREPI PARAMETER SETUP",1)

"BLD",8959,"KRN",19.1,0)
19.1
"BLD",8959,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8959,"KRN",101,0)
101
"BLD",8959,"KRN",101,"NM",0)
^9.68A^^
"BLD",8959,"KRN",409.61,0)
409.61
"BLD",8959,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",8959,"KRN",771,0)
771
"BLD",8959,"KRN",771,"NM",0)
^9.68A^^
"BLD",8959,"KRN",779.2,0)
779.2
"BLD",8959,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",8959,"KRN",870,0)
870
"BLD",8959,"KRN",870,"NM",0)
^9.68A^^
"BLD",8959,"KRN",8989.51,0)
8989.51
"BLD",8959,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",8959,"KRN",8989.52,0)
8989.52
"BLD",8959,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",8959,"KRN",8994,0)
8994
"BLD",8959,"KRN",8994,"NM",0)
^9.68A^^
"BLD",8959,"KRN","B",.4,.4)

"BLD",8959,"KRN","B",.401,.401)

"BLD",8959,"KRN","B",.402,.402)

"BLD",8959,"KRN","B",.403,.403)

"BLD",8959,"KRN","B",.5,.5)

"BLD",8959,"KRN","B",.84,.84)

"BLD",8959,"KRN","B",3.6,3.6)

"BLD",8959,"KRN","B",3.8,3.8)

"BLD",8959,"KRN","B",9.2,9.2)

"BLD",8959,"KRN","B",9.8,9.8)

"BLD",8959,"KRN","B",19,19)

"BLD",8959,"KRN","B",19.1,19.1)

"BLD",8959,"KRN","B",101,101)

"BLD",8959,"KRN","B",409.61,409.61)

"BLD",8959,"KRN","B",771,771)

"BLD",8959,"KRN","B",779.2,779.2)

"BLD",8959,"KRN","B",870,870)

"BLD",8959,"KRN","B",8989.51,8989.51)

"BLD",8959,"KRN","B",8989.52,8989.52)

"BLD",8959,"KRN","B",8994,8994)

"BLD",8959,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8959,"QUES",0)
^9.62^^
"BLD",8959,"REQB",0)
^9.611^13^5
"BLD",8959,"REQB",9,0)
LR*5.2*422^2
"BLD",8959,"REQB",10,0)
LEX*2.0*80^2
"BLD",8959,"REQB",11,0)
ICD*18.0*57^2
"BLD",8959,"REQB",12,0)
LR*5.2*429^2
"BLD",8959,"REQB",13,0)
LR*5.2*315^2
"BLD",8959,"REQB","B","ICD*18.0*57",11)

"BLD",8959,"REQB","B","LEX*2.0*80",10)

"BLD",8959,"REQB","B","LR*5.2*315",13)

"BLD",8959,"REQB","B","LR*5.2*422",9)

"BLD",8959,"REQB","B","LR*5.2*429",12)

"FIA",69.5)
LAB SEARCH/EXTRACT
"FIA",69.5,0)
^LAB(69.5,
"FIA",69.5,0,0)
69.5
"FIA",69.5,0,1)
y^y^p^^^^n^^n
"FIA",69.5,0,10)

"FIA",69.5,0,11)

"FIA",69.5,0,"RLRO")

"FIA",69.5,0,"VR")
5.2^LR
"FIA",69.5,69.5)
1
"FIA",69.5,69.5,4)

"FIA",69.5,69.54)
0
"INIT")
LR421P
"KRN",.403,100,-1)
0^1
"KRN",.403,100,0)
LREPI9^@^@^^2961007.1013^^^69.5^0^0^1
"KRN",.403,100,11)

"KRN",.403,100,40,0)
^.4031I^5^5
"KRN",.403,100,40,1,0)
1^^0,0^2
"KRN",.403,100,40,1,1)
Page 1
"KRN",.403,100,40,1,11)

"KRN",.403,100,40,1,40,0)
^.4032IP^457^6
"KRN",.403,100,40,1,40,370,0)
LREPI9HEAD^1^1,1^d
"KRN",.403,100,40,1,40,371,0)
LREPI92^2^6,1^e
"KRN",.403,100,40,1,40,371,2)
3
"KRN",.403,100,40,1,40,372,0)
LREPI93^7^13,2^e
"KRN",.403,100,40,1,40,372,2)
3^^n
"KRN",.403,100,40,1,40,373,0)
LREPI91^4^7,2^d
"KRN",.403,100,40,1,40,380,0)
LREPI911^5^13,54^e
"KRN",.403,100,40,1,40,380,2)
^^^^^
"KRN",.403,100,40,1,40,457,0)
LREPI92B^6^11,2^e
"KRN",.403,100,40,2,0)
2^^1,1^3^1
"KRN",.403,100,40,2,1)
Page 2
"KRN",.403,100,40,2,40,0)
^.4032IP^381^5
"KRN",.403,100,40,2,40,183,0)
LREPI5^5^14,1^e
"KRN",.403,100,40,2,40,183,2)
3
"KRN",.403,100,40,2,40,370,0)
LREPI9HEAD^1^1,1^d
"KRN",.403,100,40,2,40,374,0)
LREPI94^2^9,1^e
"KRN",.403,100,40,2,40,374,2)
3
"KRN",.403,100,40,2,40,375,0)
LREPI96^4^7,1^d
"KRN",.403,100,40,2,40,381,0)
LREPI912^3^9,44^e
"KRN",.403,100,40,2,40,381,2)
3
"KRN",.403,100,40,3,0)
3^^1,1^4^2
"KRN",.403,100,40,3,1)
Page 3
"KRN",.403,100,40,3,40,0)
^.4032IP^378^4
"KRN",.403,100,40,3,40,370,0)
LREPI9HEAD^1^1,1^d
"KRN",.403,100,40,3,40,376,0)
LREPI97^2^7,1^d
"KRN",.403,100,40,3,40,377,0)
LREPI98^3^11,1^e
"KRN",.403,100,40,3,40,377,2)
4
"KRN",.403,100,40,3,40,378,0)
LREPI99^4^11,40^e
"KRN",.403,100,40,3,40,378,2)
4
"KRN",.403,100,40,4,0)
4^^1,1^5^4
"KRN",.403,100,40,4,1)
Page 4
"KRN",.403,100,40,4,40,0)
^.4032IP^382^2
"KRN",.403,100,40,4,40,370,0)
LREPI9HEAD^1^1,1^d
"KRN",.403,100,40,4,40,382,0)
LREPI913^2^7,1^e
"KRN",.403,100,40,5,0)
5^^1,1^1^4
"KRN",.403,100,40,5,1)
Page 5
"KRN",.403,100,40,5,40,0)
^.4032IP^379^2
"KRN",.403,100,40,5,40,370,0)
LREPI9HEAD^1^1,1^d
"KRN",.403,100,40,5,40,379,0)
LREPI910^2^7,1^e
"KRN",.404,183,0)
LREPI5^69.55
"KRN",.404,183,40,0)
^.4044I^3^3
"KRN",.404,183,40,1,0)
1^^3
"KRN",.404,183,40,1,1)
.01
"KRN",.404,183,40,1,2)
2,1^30
"KRN",.404,183,40,2,0)
2^^4
"KRN",.404,183,40,2,2)
2,49^30
"KRN",.404,183,40,2,30)
S Y={.01:64}
"KRN",.404,183,40,3,0)
3^^4
"KRN",.404,183,40,3,2)
2,34^12
"KRN",.404,183,40,3,30)
S Y={.01:64:1}
"KRN",.404,370,0)
LREPI9HEAD^69.5^
"KRN",.404,370,40,0)
^.4044I^6^6
"KRN",.404,370,40,1,0)
1^LABORATORY SEARCH/EXTRACT PARAMETERS INPUT SCREEN^1
"KRN",.404,370,40,1,2)
^^1,15
"KRN",.404,370,40,2,0)
2^NAME^3
"KRN",.404,370,40,2,1)
.01
"KRN",.404,370,40,2,2)
4,7^50^4,1
"KRN",.404,370,40,3,0)
3^INACTIVE: ^3
"KRN",.404,370,40,3,1)
1
"KRN",.404,370,40,3,2)
4,70^3^4,60^1
"KRN",.404,370,40,4,0)
4^________________________________________^1
"KRN",.404,370,40,4,2)
^^5,1
"KRN",.404,370,40,5,0)
5^________________________________________^1
"KRN",.404,370,40,5,2)
^^5,41
"KRN",.404,370,40,6,0)
6^!M^1
"KRN",.404,370,40,6,.1)
S Y="Page "_DDSPG_" of 5"
"KRN",.404,370,40,6,2)
^^1,67
"KRN",.404,371,0)
LREPI92^69.52
"KRN",.404,371,40,0)
^.4044I^3^3
"KRN",.404,371,40,1,0)
1^^3
"KRN",.404,371,40,1,1)
.01
"KRN",.404,371,40,1,2)
3,1^30
"KRN",.404,371,40,2,0)
2^^3
"KRN",.404,371,40,2,1)
1
"KRN",.404,371,40,2,2)
3,35^20
"KRN",.404,371,40,3,0)
3^^3
"KRN",.404,371,40,3,1)
2
"KRN",.404,371,40,3,2)
3,61^15
"KRN",.404,372,0)
LREPI93^69.54
"KRN",.404,372,40,0)
^.4044I^2^2
"KRN",.404,372,40,1,0)
1^^3
"KRN",.404,372,40,1,1)
.01
"KRN",.404,372,40,1,2)
3,1^8
"KRN",.404,372,40,1,12)
D REFRESH^DDSUTL
"KRN",.404,372,40,2,0)
2^^4
"KRN",.404,372,40,2,2)
3,11^68
"KRN",.404,372,40,2,30)
I '$G(DDSERROR,0) S Y=$$LRDSCR^LREPIXDG(DT)
"KRN",.404,373,0)
LREPI91^69.5^
"KRN",.404,373,40,0)
^.4044I^6^6
"KRN",.404,373,40,1,0)
1^Laboratory Test(s)^1
"KRN",.404,373,40,1,2)
^^1,1
"KRN",.404,373,40,2,0)
2^Indicator^1
"KRN",.404,373,40,2,2)
^^1,34
"KRN",.404,373,40,3,0)
3^Value^1
"KRN",.404,373,40,3,2)
^^1,60
"KRN",.404,373,40,4,0)
4^ICD Code^1
"KRN",.404,373,40,4,2)
^^8,1
"KRN",.404,373,40,5,0)
5^ICD Description^1
"KRN",.404,373,40,5,2)
^^8,19
"KRN",.404,373,40,6,0)
6^Cd Set^1
"KRN",.404,373,40,6,2)
^^8,11
"KRN",.404,374,0)
LREPI94^69.53
"KRN",.404,374,40,0)
^.4044I^1^1
"KRN",.404,374,40,1,0)
1^^3
"KRN",.404,374,40,1,1)
.01
"KRN",.404,374,40,1,2)
1,1^35
"KRN",.404,375,0)
LREPI96^69.5^
"KRN",.404,375,40,0)
^.4044I^5^5
"KRN",.404,375,40,1,0)
1^Selected Etiology^1
"KRN",.404,375,40,1,2)
^^1,1
"KRN",.404,375,40,2,0)
2^Antimicrobial Susceptibility^1
"KRN",.404,375,40,2,2)
^^7,1
"KRN",.404,375,40,3,0)
3^NLT Code^1
"KRN",.404,375,40,3,2)
^^7,34
"KRN",.404,375,40,4,0)
4^NLT Description^1
"KRN",.404,375,40,4,2)
^^7,49
"KRN",.404,375,40,5,0)
5^Selected Snomed Codes^1
"KRN",.404,375,40,5,2)
^^1,45
"KRN",.404,376,0)
LREPI97^69.5^
"KRN",.404,376,40,0)
^.4044I^3^3
"KRN",.404,376,40,1,0)
1^Topography Selection^1
"KRN",.404,376,40,1,2)
^^1,27
"KRN",.404,376,40,2,0)
2^Include^1
"KRN",.404,376,40,2,2)
^^3,1
"KRN",.404,376,40,3,0)
3^Exclude^1
"KRN",.404,376,40,3,2)
^^3,40
"KRN",.404,377,0)
LREPI98^69.56
"KRN",.404,377,40,0)
^.4044I^1^1
"KRN",.404,377,40,1,0)
1^^3
"KRN",.404,377,40,1,1)
.01
"KRN",.404,377,40,1,2)
1,1^30
"KRN",.404,378,0)
LREPI99^69.57
"KRN",.404,378,40,0)
^.4044I^1^1
"KRN",.404,378,40,1,0)
1^^3
"KRN",.404,378,40,1,1)
.01
"KRN",.404,378,40,1,2)
1,1^30
"KRN",.404,379,0)
LREPI910^69.5
"KRN",.404,379,40,0)
^.4044I^9^6
"KRN",.404,379,40,3,0)
1^Run Date^3
"KRN",.404,379,40,3,1)
9
"KRN",.404,379,40,3,2)
2,11^20^2,1
"KRN",.404,379,40,4,0)
2^Protocol^3
"KRN",.404,379,40,4,1)
12
"KRN",.404,379,40,4,2)
2,48^25^2,38
"KRN",.404,379,40,5,0)
3^Run Cycle^3
"KRN",.404,379,40,5,1)
10
"KRN",.404,379,40,5,2)
4,12^7^4,1
"KRN",.404,379,40,7,0)
7^General Description^3
"KRN",.404,379,40,7,1)
15
"KRN",.404,379,40,7,2)
8,22^1^8,1
"KRN",.404,379,40,8,0)
4^Lag Days^3
"KRN",.404,379,40,8,1)
10.5
"KRN",.404,379,40,8,2)
4,48^2^4,38
"KRN",.404,379,40,9,0)
8^Previous Cycle^3
"KRN",.404,379,40,9,1)
19
"KRN",.404,379,40,9,2)
6,16^13^6,1
"KRN",.404,380,0)
LREPI911^69.5^
"KRN",.404,380,40,0)
^.4044I^^0
"KRN",.404,381,0)
LREPI912^69.58
"KRN",.404,381,40,0)
^.4044I^1^1
"KRN",.404,381,40,1,0)
1^^3
"KRN",.404,381,40,1,1)
.01
"KRN",.404,381,40,1,2)
1,2^15
"KRN",.404,382,0)
LREPI913^69.5
"KRN",.404,382,40,0)
^.4044I^5^5
"KRN",.404,382,40,1,0)
1^FIRST ENCOUNTER^3
"KRN",.404,382,40,1,1)
11
"KRN",.404,382,40,1,2)
1,18^3^1,1
"KRN",.404,382,40,2,0)
2^FOLLOW PTF^3
"KRN",.404,382,40,2,1)
13
"KRN",.404,382,40,2,2)
1,55^3^1,43
"KRN",.404,382,40,3,0)
3^BEFORE DATE OF BIRTH^3
"KRN",.404,382,40,3,1)
17
"KRN",.404,382,40,3,2)
3,23^11^3,1
"KRN",.404,382,40,4,0)
4^AFTER DATE OF BIRTH^3
"KRN",.404,382,40,4,1)
18
"KRN",.404,382,40,4,2)
3,64^11^3,43
"KRN",.404,382,40,5,0)
5^Select SEX^3
"KRN",.404,382,40,5,1)
16
"KRN",.404,382,40,5,2)
5,13^1^5,1
"KRN",.404,457,0)
LREPI92B^69.5
"KRN",.404,457,40,0)
^.4044I^1^1
"KRN",.404,457,40,1,0)
1^ICD Coding System [ICD-9 or ICD-10]? (9/10)^2
"KRN",.404,457,40,1,2)
2,46^6^2,1
"KRN",.404,457,40,1,3)
!M
"KRN",.404,457,40,1,3.1)
S Y=$S(DT<$$IMPDATE^LEXU("10D"):9,1:10)
"KRN",.404,457,40,1,4)
1
"KRN",.404,457,40,1,11)
K ICDSYS
"KRN",.404,457,40,1,12)
S ICDSYS=$S(X="10":30,1:1)
"KRN",.404,457,40,1,20)
S^^9:ICD-9;10:ICD-10;
"KRN",19,8293,-1)
0^1
"KRN",19,8293,0)
LREPI PARAMETER SETUP^Lab EPI Parameter Setup^^R^^^^^^^^LAB SERVICE^^
"KRN",19,8293,1,0)
^19.06^3^3^3120821^^^^
"KRN",19,8293,1,1,0)
This option is used to define the search criteria along with additional 
"KRN",19,8293,1,2,0)
information associated with the EPI extracts.  This option only allows 
"KRN",19,8293,1,3,0)
editing.  You are not allowed to add local pathogens with this option.
"KRN",19,8293,20)

"KRN",19,8293,25)
EN^LREPIPI
"KRN",19,8293,30)
LAB(69.5,
"KRN",19,8293,31)
AEMQ
"KRN",19,8293,40)

"KRN",19,8293,41)
69.5
"KRN",19,8293,"U")
LAB EPI PARAMETER SETUP
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",14,-1)
1^1
"PKG",14,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",14,20,0)
^9.402P^1^1
"PKG",14,20,1,0)
2^^LRXDRPT
"PKG",14,20,1,1)

"PKG",14,20,"B",2,1)

"PKG",14,22,0)
^9.49I^1^1
"PKG",14,22,1,0)
5.2^2940927^2960610
"PKG",14,22,1,"PAH",1,0)
421^3131011^11748
"PKG",14,22,1,"PAH",1,1,0)
^^3^3^3120820
"PKG",14,22,1,"PAH",1,1,1,0)
 
"PKG",14,22,1,"PAH",1,1,2,0)
This patch will modify routine LRPHLIST (collection label print)
"PKG",14,22,1,"PAH",1,1,3,0)
to allow the print job to be queued to a printer through TASKMAN.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","LR421P")
0^8^B10419361^n/a
"RTN","LR421P",1,0)
LR421P ;DALISC/SED - LR*5.2*421 PATCH POST INIT ROUTINE ;10 Oct 2013  4:49 PM
"RTN","LR421P",2,0)
 ;;5.2;LAB SERVICE;**421**;Sep 27, 1994;Build 48
"RTN","LR421P",3,0)
EN ;
"RTN","LR421P",4,0)
 D BMES^XPDUTL("**** ICD 10 Remediation****")
"RTN","LR421P",5,0)
 D BMES^XPDUTL("**Updating Emerging Pathogen File (69.5) with ICD Codes**")
"RTN","LR421P",6,0)
CONVERT ;
"RTN","LR421P",7,0)
 S LRCSYS="10D"
"RTN","LR421P",8,0)
 I $T(^LREPICD)]"" D ICDCONVT^LREPICD
"RTN","LR421P",9,0)
ICD ;Add the ICD codes to the file.
"RTN","LR421P",10,0)
 ;SET CURRENT CODES TO APPROPRIATE CODE SYSTEMS
"RTN","LR421P",11,0)
 N LRICDDA,LRICDCOD K LRPATH S LRPATH=0 F  S LRPATH=$O(^LAB(69.5,LRPATH)) Q:+LRPATH=0  D
"RTN","LR421P",12,0)
 .I $D(^LAB(69.5,LRPATH,3)) S LRICDDA=0 F  S LRICDDA=$O(^LAB(69.5,LRPATH,3,LRICDDA)) Q:+LRICDDA=0  D
"RTN","LR421P",13,0)
 ..K LRSET S LRICDCOD=+(^LAB(69.5,LRPATH,3,LRICDDA,0)),LRSET=$$CSI^ICDEX(80,LRICDCOD)
"RTN","LR421P",14,0)
 ..S DIE="^LAB(69.5,"_LRPATH_",3,",DA=LRICDDA,DR="1////"_LRSET D ^DIE
"RTN","LR421P",15,0)
 .Q
"RTN","LR421P",16,0)
 ;LEISHMANIASIS   PATH14
"RTN","LR421P",17,0)
 S LRPATH=14
"RTN","LR421P",18,0)
 F LRICDNO=0,1,2,9 S LREPICDX="B55."_LRICDNO_" ",LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",19,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",20,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",21,0)
 .Q:+LRTMP<0
"RTN","LR421P",22,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",23,0)
 ;MALARIA   PATH11
"RTN","LR421P",24,0)
 S LRPATH=11
"RTN","LR421P",25,0)
 F LREPICDX="B50.0 ","B50.8 ","B50.9 ","B51.0 ","B51.8 ","B51.9 ","B52.0 ","B52.8 ","B52.9 ","B53.0 ","B53.1 ","B53.8 ","B54. " S LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",26,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",27,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",28,0)
 .Q:+LRTMP<0
"RTN","LR421P",29,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",30,0)
 ;DENGUE   PATH12
"RTN","LR421P",31,0)
 S LRPATH=12
"RTN","LR421P",32,0)
 F LREPICDX="A90. ","A91. ","A93.8 " S LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",33,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",34,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",35,0)
 .Q:+LRTMP<0
"RTN","LR421P",36,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",37,0)
 ;
"RTN","LR421P",38,0)
 ;JAKOB-CREUTZFELDT DIS   PATH13
"RTN","LR421P",39,0)
 S LRPATH=13
"RTN","LR421P",40,0)
 F LREPICDX="A81.00 ","A81.01 ","A81.09 ","A81.1 ","A81.2 ","A81.81 ","A81.82 ","A81.83 ","A81.89 ","A81.9 " S LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",41,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",42,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",43,0)
 .Q:+LRTMP<0
"RTN","LR421P",44,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",45,0)
 ;
"RTN","LR421P",46,0)
 ;LEGIONELLA   PATH7
"RTN","LR421P",47,0)
 S LRPATH=7
"RTN","LR421P",48,0)
 F LREPICDX="A48.1 ","A48.2 ","A48.8 " S LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",49,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",50,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",51,0)
 .Q:+LRTMP<0
"RTN","LR421P",52,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",53,0)
 ;
"RTN","LR421P",54,0)
 ;CRYPTOSPORIDIUM   PATH9
"RTN","LR421P",55,0)
 S LRPATH=9
"RTN","LR421P",56,0)
 F LREPICDX="A07.2 ","A07.9 " S LRICDIEN=+$$CODEN^ICDEX(LREPICDX,80) D
"RTN","LR421P",57,0)
 .Q:+LRICDIEN'>0
"RTN","LR421P",58,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,,)
"RTN","LR421P",59,0)
 .Q:+LRTMP<0
"RTN","LR421P",60,0)
 .D SETIC(LRICDIEN)
"RTN","LR421P",61,0)
 ;
"RTN","LR421P",62,0)
EXIT K LRPATH,LRINT,X,Y,DA,DIC,DIE,DR,LRICDNO,DD,LRCSYS,LREPICDX,LRICDIEN
"RTN","LR421P",63,0)
 K LRND,LRNDM,LRANT,LRTMP,LRMSG,LRANM
"RTN","LR421P",64,0)
 ;
"RTN","LR421P",65,0)
 Q
"RTN","LR421P",66,0)
SETIC(LRINT) ;ADD THE ENTRY FOR ICD
"RTN","LR421P",67,0)
 Q:$D(^LAB(69.5,LRPATH,3,"B",LRINT))
"RTN","LR421P",68,0)
 S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRINT,,)
"RTN","LR421P",69,0)
 Q:LRTMP'>0
"RTN","LR421P",70,0)
 S LRMSG="Adding "_$P(LRTMP,U,2)_" "_$P(LRTMP,U,4)_" into "
"RTN","LR421P",71,0)
 S LRMSG=LRMSG_$P(^LAB(69.5,LRPATH,0),U,1)
"RTN","LR421P",72,0)
 D BMES^XPDUTL(LRMSG)
"RTN","LR421P",73,0)
 K DD
"RTN","LR421P",74,0)
 S DIC="^LAB(69.5,"_LRPATH_",3,",DIC(0)="L",X=LRINT
"RTN","LR421P",75,0)
 S DIC("P")=$P(^DD(69.5,4,0),U,2),DA(1)=LRPATH
"RTN","LR421P",76,0)
 D FILE^DICN
"RTN","LR421P",77,0)
 S DIE="^LAB(69.5,"_LRPATH_",3,",DR="1////"_$P(LRTMP,U,20) D ^DIE
"RTN","LR421P",78,0)
 Q
"RTN","LREPI")
0^1^B66094816^B57448349
"RTN","LREPI",1,0)
LREPI ;DALOI/SED - EMERGING PATHOGENS SEARCH ;16 Jun 2013  6:03 PM
"RTN","LREPI",2,0)
 ;;5.2;LAB SERVICE;**132,175,260,281,421**;Sep 27, 1994;Build 48
"RTN","LREPI",3,0)
 ; Reference to ^DGPT supported by IA #418
"RTN","LREPI",4,0)
 ; Reference to ^ORD(101 supported by IA #872
"RTN","LREPI",5,0)
 ; Reference to PATS^PXRMXX supported by IA #3134
"RTN","LREPI",6,0)
TEST S LRRPS=3000501,LRRPE=3000531,LRRTYPE=1
"RTN","LREPI",7,0)
 S LREPI(2)="",LREPI(17)="",LREPI(18)="",LREPI(19)=""
"RTN","LREPI",8,0)
 ;S D0=0 F  S D0=$O(^LAB(69.5,D0)) Q:+D0'>0  D
"RTN","LREPI",9,0)
 ;.Q:$P(^LAB(69.5,D0,0),U,2)="1"
"RTN","LREPI",10,0)
 ;.Q:$P(^LAB(69.5,D0,0),U,7)=""
"RTN","LREPI",11,0)
 ;.Q:'$D(^ORD(101,$P(^LAB(69.5,D0,0),U,7),0))
"RTN","LREPI",12,0)
 ;.S LREPI(D0)=""
"RTN","LREPI",13,0)
 S LRBEG=9999999-(LRRPE+.9),LREND=9999999-LRRPS+.999999
"RTN","LREPI",14,0)
EN ;
"RTN","LREPI",15,0)
 ;
"RTN","LREPI",16,0)
INIT ;Set up search criteria
"RTN","LREPI",17,0)
 ;Fix start and stop date problem CKA 6/2/2002
"RTN","LREPI",18,0)
 S LRBEG=(9999999-LRRPE)_".0000001",LREND=9999999-LRRPS+.999999
"RTN","LREPI",19,0)
 ; Determine which Coding to system to activate:
"RTN","LREPI",20,0)
 ; If report beginning date and ending date are prior to ICDx effective date
"RTN","LREPI",21,0)
 ;  report will print patients with ICD diagnosis codes 
"RTN","LREPI",22,0)
 ;  and for summary report, count only ICD codes.
"RTN","LREPI",23,0)
 ; If report beginning date and ending date are on or after ICDx effective date
"RTN","LREPI",24,0)
 ;  report will print patients with ICDx diagnosis codes
"RTN","LREPI",25,0)
 ;  and for summary report, count only ICDx codes.
"RTN","LREPI",26,0)
 ; If report beginning date is prior to ICDx effective date and report ending date is on or after ICDx effective date
"RTN","LREPI",27,0)
 ;  report will print patients that have either ALL valid diagnosis codes
"RTN","LREPI",28,0)
 ;  and count both ALL valid diagnosis codes.
"RTN","LREPI",29,0)
 ;
"RTN","LREPI",30,0)
 N LRBEGSYS,LRENDSYS
"RTN","LREPI",31,0)
 S LRBEGSYS=+$$ICDSYS^LREPICD(LRRPS,"D"),LRENDSYS=+$$ICDSYS^LREPICD(LRRPE,"D")
"RTN","LREPI",32,0)
 K LREPISYS S:LRBEGSYS=0 LRBEGSYS=9 S:LRENDSYS=0 LRENDSYS=9 F LREPISYS=LRBEGSYS:1:LRENDSYS S LREPISYS(LREPISYS)=""
"RTN","LREPI",33,0)
 ;
"RTN","LREPI",34,0)
 K ^TMP($J),^TMP("HLS",$J)
"RTN","LREPI",35,0)
 S D0=0 F  S D0=$O(LREPI(D0)) Q:+D0'>0  D
"RTN","LREPI",36,0)
 .S ^TMP($J,$P(^LAB(69.5,D0,0),U,7))=""
"RTN","LREPI",37,0)
 .S:$P(^LAB(69.5,D0,0),U,8)=1 ^TMP($J,"LREPI",D0)=""
"RTN","LREPI",38,0)
 .S LRPROT=$P(^LAB(69.5,D0,0),U,7)
"RTN","LREPI",39,0)
 .Q:LRPROT=""
"RTN","LREPI",40,0)
 .S D1=0 F  S D1=$O(^LAB(69.5,D0,1,D1)) Q:+D1'>0  D
"RTN","LREPI",41,0)
 ..S TST=$P(^LAB(69.5,D0,1,D1,0),U)
"RTN","LREPI",42,0)
 ..Q:'$D(^LAB(60,TST,0))
"RTN","LREPI",43,0)
 ..Q:$P(^LAB(60,TST,0),U,4)=""
"RTN","LREPI",44,0)
 ..I $P(^LAB(60,TST,0),U,4)="CH" D
"RTN","LREPI",45,0)
 ...Q:$P(^LAB(60,TST,0),U,5)=""
"RTN","LREPI",46,0)
 ...S ^TMP($J,"T",TST,D0)=""
"RTN","LREPI",47,0)
 ...S ^TMP($J,"TPROT",TST,LRPROT)=""
"RTN","LREPI",48,0)
 ...S LRIND=$P(^LAB(69.5,D0,1,D1,0),U,2,3)
"RTN","LREPI",49,0)
 ...S ^TMP($J,$P(^LAB(60,TST,0),U,4),TST)=$P(^LAB(60,TST,0),U,5)_U_LRIND
"RTN","LREPI",50,0)
 ..I $P(^LAB(60,TST,0),U,4)="CY" D
"RTN","LREPI",51,0)
 ...S ^TMP($J,"T",TST,D0)=""
"RTN","LREPI",52,0)
 ...S ^TMP($J,$P(^LAB(60,TST,0),U,4),TST)=""
"RTN","LREPI",53,0)
 .S D1=0 F  S D1=$O(^LAB(69.5,D0,2,D1)) Q:+D1'>0  S ^TMP($J,"E",$P(^LAB(69.5,D0,2,D1,0),U),D0)=""
"RTN","LREPI",54,0)
 .S D1=0 F  S D1=$O(^LAB(69.5,D0,9,D1)) Q:+D1'>0  S ^TMP($J,"SNO",$P(^LAB(69.5,D0,9,D1,0),U),D0)=""
"RTN","LREPI",55,0)
 .S D1=0 F  S D1=$O(^LAB(69.5,D0,3,D1)) Q:+D1'>0  D
"RTN","LREPI",56,0)
 ..S LREPISYS=$S(+$P(^LAB(69.5,D0,3,D1,0),U,2)=30:10,1:9)
"RTN","LREPI",57,0)
 ..S:$D(LREPISYS(LREPISYS))&($P(^LAB(69.5,D0,3,D1,0),U)]"") ^TMP($J,"ICD",$P(^LAB(69.5,D0,3,D1,0),U),D0)=""
"RTN","LREPI",58,0)
 K D0,D1,TST,LRIND
"RTN","LREPI",59,0)
 I $D(^TMP($J,"LREPI")) D SEARCH^LREPI4
"RTN","LREPI",60,0)
 I $D(^TMP($J,"ICD")) D PTF^LREPI5
"RTN","LREPI",61,0)
LAB63 ;Search file 63 for lab data
"RTN","LREPI",62,0)
 K LRIND
"RTN","LREPI",63,0)
 S LRDFN=0 F  S LRDFN=$O(^LR(LRDFN)) Q:+LRDFN'>0  D
"RTN","LREPI",64,0)
 .Q:'$D(^LR(LRDFN,0))
"RTN","LREPI",65,0)
 .Q:$P(^LR(LRDFN,0),U,2)'=2
"RTN","LREPI",66,0)
 .S LRPAT=$P(^LR(LRDFN,0),U,3)
"RTN","LREPI",67,0)
 .I $D(^TMP($J,"CH")) D CH
"RTN","LREPI",68,0)
 .I $D(^TMP($J,"CY")) D CYTST^LREPICY
"RTN","LREPI",69,0)
 .I $D(^TMP($J,"E")) D MI
"RTN","LREPI",70,0)
 .;I '$D(^TMP($J,"ICD"))&($D(^TMP($J,"SNO"))) D CY^LREPICY
"RTN","LREPI",71,0)
 .I $D(^TMP($J,"SNO")) D CY^LREPICY
"RTN","LREPI",72,0)
 ;Retrieve patient list from Clinical Reminders
"RTN","LREPI",73,0)
 S LRPROTX=$O(^ORD(101,"B","LREPI",""))
"RTN","LREPI",74,0)
 I LRPROTX]"" S LRSRXX="",LRSRGO=0 F  S LRSRXX=$O(LREPI(LRSRXX)) Q:'LRSRXX  I $G(^LAB(69.5,LRSRXX,0))["HEPATITIS" D  Q
"RTN","LREPI",75,0)
  . D PATS^PXRMXX(LRRPS,LRRPE,"LREPISRCH")
"RTN","LREPI",76,0)
  . S EPISRCH=0 F  S EPISRCH=$O(^TMP("LREPISRCH",$J,EPISRCH)) Q:'EPISRCH  D
"RTN","LREPI",77,0)
  . . S LRENCDT=$P(^TMP("LREPISRCH",$J,EPISRCH),"^") Q:'LRENCDT
"RTN","LREPI",78,0)
  . . Q:$D(^TMP($J,LRPROTX,EPISRCH,LRENCDT))  ;Encounter date already exists, don't update
"RTN","LREPI",79,0)
  . . S ^TMP($J,LRPROTX,EPISRCH,LRENCDT)=$P(^TMP("LREPISRCH",$J,EPISRCH),"^",2)
"RTN","LREPI",80,0)
 I $G(LRREP) D ^LREPI2A
"RTN","LREPI",81,0)
 I '$G(LRREP) D ^LREPI2
"RTN","LREPI",82,0)
EXIT ;EXIT
"RTN","LREPI",83,0)
 S D0=0
"RTN","LREPI",84,0)
 I $G(LRRTYPE)=0 F  S D0=$O(LREPI(D0)) Q:+D0'>0  D
"RTN","LREPI",85,0)
 .S $P(^LAB(69.5,D0,0),U,4)=DT
"RTN","LREPI",86,0)
 K LREPI,DFN,CNT,DA,DIE,DR,DQ,HL,ENTRY,ENDT,ENC,FD,HLECH,HLFS,HLN,HLQ
"RTN","LREPI",87,0)
 K DDER,D0,HLRST,HLSAN,LRBEG,LRCNT,LRCS,LRDATE,LRDFN,LREFG,LRENCDT
"RTN","LREPI",88,0)
 K LREND,LRETND,LRHL7,LRINV,LRINVD,LRITN,LRND,LRNL,LRNLT,LRNTE,LROBR
"RTN","LREPI",89,0)
 K LRPAT,LRPFG,LRPID,LRPROT,LRPV1,LRRPE,LRRPS,LRRTYPE,LRTND,LRTNM,MSG
"RTN","LREPI",90,0)
 K MSGCNT,PTF,RR,SEG,SP,STDT,TST,UN,TSTNM,VAERR,X,XCNP,XMDUZ,XMZ,ZTSK
"RTN","LREPI",91,0)
 K AF,D,DI,LRENT,LRIND,LRPATH,OV,LRENDT,ADMDT,EPISITE,EPISRCH
"RTN","LREPI",92,0)
 K LR31799Z,LRANTI,LRCHK,LRIC,LRIEN,LRIPT,LRMG,LRMGN,LRNX,LRO,LROK
"RTN","LREPI",93,0)
 K LROVR,LRPCNT,LRPTOT,LRSI,LRSITE,LRCYSP,LRDIS,LRDISI,LRIC,LRICD
"RTN","LREPI",94,0)
 K LRICDI,LRIEN,LRIPT,LRMG,LRMGN,LRMOR,LRMORI,LRMSG,PXRMITEM
"RTN","LREPI",95,0)
 K LRSNM,LRSNO,LRSTOP,LRSUB,LRTOP,LRTOPP,LRWKI,LRPRO,LRPROI
"RTN","LREPI",96,0)
 K LRNDC,LRNTE1,LRFIND,LRDRUG,LRCODE,LRDRSEQ,HLHDR,HLMTIEN,HLMTIENS
"RTN","LREPI",97,0)
 K HLNEXT,HLNODE,HLQUIT,HLRESLT,HLRESLTA,LRANS,LRDRSQ1,LRPROTX,LRPTY
"RTN","LREPI",98,0)
 K LRPVVV,LRSRGO,LRSRXX,LRTOLD,LRTRM,LRPREV,LRPRECYC,X1,X2,X3
"RTN","LREPI",99,0)
 K LRANTIND,LRANTINV,LRREP,LRPV1NUM,LREPISYS
"RTN","LREPI",100,0)
 Q
"RTN","LREPI",101,0)
ENCT ;SET THE ENCOUNTER FOR PV1
"RTN","LREPI",102,0)
 S LRPROT=$P(^LAB(69.5,LRPATH,0),U,7)
"RTN","LREPI",103,0)
 S LRCHK=0 D ADDCHK^LREPI5 Q:LRCHK
"RTN","LREPI",104,0)
 S LRDATE=9999999-LRINV
"RTN","LREPI",105,0)
 K VAIN,DFN,VAINDT S DFN=LRPAT,VAINDT=LRDATE D INP^VADPT
"RTN","LREPI",106,0)
 S LRENCDT=$S(VAIN(7)'="":$P(VAIN(7),U),1:LRDATE)
"RTN","LREPI",107,0)
 I $P(^LAB(69.5,LRPATH,0),U,8)=1 D CHECK^LREPI4
"RTN","LREPI",108,0)
 S:'$D(^TMP($J,LRPROT,LRPAT,LRENCDT)) ^TMP($J,LRPROT,LRPAT,LRENCDT)=$S(VAIN(7)'="":"I",1:"O")_U_$G(VAIN(10))
"RTN","LREPI",109,0)
 S:$P(^TMP($J,LRPROT,LRPAT,LRENCDT),U)="O" ^(LRENCDT)="O"_U_$S($D(LRPATLOC):LRPATLOC,1:"")
"RTN","LREPI",110,0)
 S:'$D(^TMP($J,LRPROT,LRPAT,LRENCDT,LRPATH,LRINV,ND)) ^TMP($J,LRPROT,LRPAT,LRENCDT,LRPATH,LRINV,ND)=""
"RTN","LREPI",111,0)
 I $G(LRANTIND)="",$G(LRANTINV)="" Q
"RTN","LREPI",112,0)
 S:'$D(^TMP($J,LRPROT,LRPATH,LRENCDT,LRPAT,LRINV,ND,LRANTIND,LRANTINV)) ^TMP($J,LRPROT,LRPAT,LRENCDT,LRPATH,LRINV,ND,LRANTIND,LRANTINV)=""
"RTN","LREPI",113,0)
 Q
"RTN","LREPI",114,0)
CH ;Check the 'CH' node
"RTN","LREPI",115,0)
 S LRINV=LRBEG
"RTN","LREPI",116,0)
 F  S LRINV=$O(^LR(LRDFN,"CH",LRINV)) Q:+LRINV'>0!(LRINV>LREND)  D
"RTN","LREPI",117,0)
 .Q:$P(^LR(LRDFN,"CH",LRINV,0),U,3)=""
"RTN","LREPI",118,0)
 .S LRCNT=1,LRTST=0 F  S LRTST=$O(^TMP($J,"CH",LRTST)) Q:+LRTST'>0  D
"RTN","LREPI",119,0)
 ..S LRND=$P($P(^TMP($J,"CH",LRTST),";",2),U,1) Q:+LRND'>0
"RTN","LREPI",120,0)
 ..S LRPC=$P($P(^TMP($J,"CH",LRTST),";",3),U,1) Q:+LRPC'>0
"RTN","LREPI",121,0)
 ..S LRRES=$P($G(^LR(LRDFN,"CH",LRINV,LRND)),U,LRPC) Q:LRRES=""
"RTN","LREPI",122,0)
 ..S LRPATLOC=$P(^LR(LRDFN,"CH",LRINV,0),U,13)
"RTN","LREPI",123,0)
 ..S ^TMP($J,"TST",LRTST)=+$G(^TMP($J,"TST",LRTST))+1
"RTN","LREPI",124,0)
 ..S ^TMP($J,"TST",LRTST,LRDFN)=""
"RTN","LREPI",125,0)
 ..S LRPATH=0 F  S LRPATH=$O(^TMP($J,"T",LRTST,LRPATH)) Q:+LRPATH'>0  D CHKIND
"RTN","LREPI",126,0)
 K LRTST,LRND,LRPC,LRRES,LRNO
"RTN","LREPI",127,0)
 Q
"RTN","LREPI",128,0)
CHKIND ;Check the results
"RTN","LREPI",129,0)
 I '$D(^LAB(69.5,LRPATH,1,"B",LRTST)) Q
"RTN","LREPI",130,0)
 S LRITST=0,ND="CH",LRNO=0
"RTN","LREPI",131,0)
 F  S LRITST=$O(^LAB(69.5,LRPATH,1,"B",LRTST,LRITST)) Q:+LRITST'>0  D  D:'LRNO ENCT
"RTN","LREPI",132,0)
 .S LRNO=0
"RTN","LREPI",133,0)
 .S LRIND=$P(^LAB(69.5,LRPATH,1,LRITST,0),U,2,3)
"RTN","LREPI",134,0)
 .Q:$P(LRIND,U,1)=""
"RTN","LREPI",135,0)
 .I $P(LRIND,U,1)=1 D  Q
"RTN","LREPI",136,0)
 ..Q:'LRRES#2
"RTN","LREPI",137,0)
 ..S LRSPEC=$P($G(^LR(LRDFN,"CH",LRINV,0)),U,5) Q:LRSPEC=""
"RTN","LREPI",138,0)
 ..Q:'$D(^LAB(60,LRTST,1,LRSPEC,0))
"RTN","LREPI",139,0)
 ..S LRLOW=$P(^LAB(60,LRTST,1,LRSPEC,0),U,2),LRHIG=$P(^(0),U,3)
"RTN","LREPI",140,0)
 ..Q:'LRLOW#2!('LRHIG#2)
"RTN","LREPI",141,0)
 ..I LRRES<LRLOW!(LRRES>LRHIG) Q
"RTN","LREPI",142,0)
 ..S LRNO=1
"RTN","LREPI",143,0)
 .I $P(LRIND,U,2)="" Q
"RTN","LREPI",144,0)
 .S LRRES=$$UP^XLFSTR(LRRES),LRIND=$$UP^XLFSTR(LRIND)
"RTN","LREPI",145,0)
 .I $P(LRIND,U,1)=2,(LRRES[$P(LRIND,U,2)) Q
"RTN","LREPI",146,0)
 .I $P(LRIND,U,1)=3,(LRRES>$P(LRIND,U,2)) Q
"RTN","LREPI",147,0)
 .I $P(LRIND,U,1)=4,(LRRES<$P(LRIND,U,2)) Q
"RTN","LREPI",148,0)
 .I $P(LRIND,U,1)=5,(LRRES=$P(LRIND,U,2)) Q
"RTN","LREPI",149,0)
 .S LRNO=1
"RTN","LREPI",150,0)
 K LRITST,LRLOW,LRHIG,LRSPEC
"RTN","LREPI",151,0)
 Q
"RTN","LREPI",152,0)
MI ;Check the 'MI' node
"RTN","LREPI",153,0)
 S LRINV=LRBEG
"RTN","LREPI",154,0)
 F  S LRINV=$O(^LR(LRDFN,"MI",LRINV)) Q:+LRINV'>0!(LRINV>LREND)  D
"RTN","LREPI",155,0)
 .S LRCNT=1
"RTN","LREPI",156,0)
 .F LRMIND=3,6,9,12,17 S LRETND=0 F  S LRETND=$O(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND)) Q:+LRETND'>0  D
"RTN","LREPI",157,0)
 ..I LRMIND=3,$P($G(^LR(LRDFN,"MI",LRINV,1)),U,2)'="F" Q
"RTN","LREPI",158,0)
 ..I LRMIND'=3,$P($G(^LR(LRDFN,"MI",LRINV,(LRMIND-1))),U,2)'="F" Q
"RTN","LREPI",159,0)
 ..S LRETI=$P($G(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND,0)),U)
"RTN","LREPI",160,0)
 ..Q:+LRETI'>0
"RTN","LREPI",161,0)
 ..Q:'$D(^TMP($J,"E",LRETI))
"RTN","LREPI",162,0)
 ..S ^TMP($J,"EPROT",LRETI)=""
"RTN","LREPI",163,0)
 ..S ^TMP($J,"ETI",LRETI)=+$G(^TMP($J,"ETI",LRETI))+1
"RTN","LREPI",164,0)
 ..S ^TMP($J,"ETI",LRETI,LRDFN)=""
"RTN","LREPI",165,0)
 ..S LRPATH=0 F  S LRPATH=$O(^TMP($J,"E",LRETI,LRPATH)) Q:+LRPATH'>0  D
"RTN","LREPI",166,0)
 ...S ND="MI"
"RTN","LREPI",167,0)
 ...D TOP Q:LRTOP
"RTN","LREPI",168,0)
 ...I LRMIND=3 D ANTI Q
"RTN","LREPI",169,0)
 ...D ENCT
"RTN","LREPI",170,0)
 K LRMIND,LRETI
"RTN","LREPI",171,0)
 Q
"RTN","LREPI",172,0)
TOP ;CHECK TO SEE IF SCREEN ON SITE
"RTN","LREPI",173,0)
 S LRTOP=0
"RTN","LREPI",174,0)
 S LRSITE=$P($G(^LR(LRDFN,"MI",LRINV,0)),U,5) Q:+LRSITE'>0
"RTN","LREPI",175,0)
 I ($O(^LAB(69.5,LRPATH,5,0))="")&($O(^LAB(69.5,LRPATH,6,0))="") Q
"RTN","LREPI",176,0)
 I ($O(^LAB(69.5,LRPATH,5,0))'="")&($O(^LAB(69.5,LRPATH,6,0))'="") Q
"RTN","LREPI",177,0)
 I ($O(^LAB(69.5,LRPATH,5,0))'="")&($D(^LAB(69.5,LRPATH,5,"B",LRSITE))) Q
"RTN","LREPI",178,0)
 I ($O(^LAB(69.5,LRPATH,6,0))'="")&('$D(^LAB(69.5,LRPATH,6,"B",LRSITE))) Q
"RTN","LREPI",179,0)
 S LRTOP=1
"RTN","LREPI",180,0)
 Q
"RTN","LREPI",181,0)
ANTI ;LOOK FOR THE ANTIMICROBIAL SUS FOR ORGANISMS
"RTN","LREPI",182,0)
 I $O(^LAB(69.5,LRPATH,4,0))="" D ENCT Q
"RTN","LREPI",183,0)
 S LRANTI=0 F  S LRANTI=$O(^LAB(69.5,LRPATH,4,LRANTI)) Q:+LRANTI'>0  D
"RTN","LREPI",184,0)
 .S LRANT=$G(^LAB(69.5,LRPATH,4,LRANTI,0),U),LRANTIND=$P(^(0),U,2),LRANTINV=$P(^(0),U,3) Q:+LRANT'>0
"RTN","LREPI",185,0)
 .S LRAND=$P($G(^LAB(62.06,LRANT,0)),U,2) Q:LRAND=""
"RTN","LREPI",186,0)
 .Q:'$D(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND,LRAND))
"RTN","LREPI",187,0)
 .Q:$P(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND,LRAND),U,2)=""
"RTN","LREPI",188,0)
 .Q:$$UP^XLFSTR($E($P($G(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND,LRAND)),U,2),1,1))="S"
"RTN","LREPI",189,0)
 .D ENCT
"RTN","LREPI",190,0)
 .;CHECK MIC VALUES
"RTN","LREPI",191,0)
 .I LRANTIND=""!(LRANTINV="") Q
"RTN","LREPI",192,0)
 .S LRRES=$$UP^XLFSTR($E($P($G(^LR(LRDFN,"MI",LRINV,LRMIND,LRETND,LRAND)),U,2),1,1)),LRANTINV=$$UP^XLFSTR(LRANTINV),LRANTIND=$$UP^XLFSTR(LRANTIND)
"RTN","LREPI",193,0)
 .I LRANTIND=1,(LRRES[LRANTINV) D ENCT Q
"RTN","LREPI",194,0)
 .I LRANTIND=2,(LRRES>LRANTINV) D ENCT Q
"RTN","LREPI",195,0)
 .I LRANTIND=3,(LRRES<LRANTINV) D ENCT Q
"RTN","LREPI",196,0)
 .I LRANTIND=4,(LRRES=LRANTINV) D ENCT Q
"RTN","LREPI",197,0)
 Q
"RTN","LREPI",198,0)
 ;
"RTN","LREPI2")
0^11^B33293208^B33309495
"RTN","LREPI2",1,0)
LREPI2 ;DALOI/SED - EMERGING PATHOGENS HL7 BUILD ;23 Apr 2013  4:22 PM
"RTN","LREPI2",2,0)
 ;;5.2;LAB SERVICE;**132,157,175,242,260,281,320,421**;Sep 27, 1994;Build 48
"RTN","LREPI2",3,0)
 ;
"RTN","LREPI2",4,0)
 ;Reference to ^DPT(DFN,0),U,9) supported by IA # 10035
"RTN","LREPI2",5,0)
START ;START WITH THE PROTOCOL USED
"RTN","LREPI2",6,0)
 S LRPROT=0 F  S LRPROT=$O(^TMP($J,LRPROT)) Q:+LRPROT'>0  D
"RTN","LREPI2",7,0)
 .D INIT^HLFNC2(LRPROT,.HL)
"RTN","LREPI2",8,0)
 .S LRCS=$E(HL("ECH")),LRMSGNM=1,LRMSGSZ=0
"RTN","LREPI2",9,0)
 .S LRMSGDF=$S(+$P($G(^LAB(69.4,LRPROT,0)),U,3)>0:+$P($G(^LAB(69.4,LRPROT,0)),U,3),1:30000)
"RTN","LREPI2",10,0)
 .D EN I LRMSGSZ D MOVE,SEND
"RTN","LREPI2",11,0)
 .F LRTND="ETI","TST","HEP" D:$D(^TMP($J,LRTND)) TOTAL
"RTN","LREPI2",12,0)
 .D SEND,ALERT
"RTN","LREPI2",13,0)
 D REPORT^LREPIRP
"RTN","LREPI2",14,0)
 K ^TMP("HLS",$J)
"RTN","LREPI2",15,0)
 K LRMSGDF,LRMSGNM,LRMSGSZ,%,%X
"RTN","LREPI2",16,0)
 Q
"RTN","LREPI2",17,0)
ALERT ;Send a Alert if desired.
"RTN","LREPI2",18,0)
 K XQA,XQAMSG,XQAOPT,XQAROU,XQAID,XQADATA,XQAFLAG
"RTN","LREPI2",19,0)
 Q:+$G(LRRTYPE)=1
"RTN","LREPI2",20,0)
 S X="NOW",%DT="SRT" D ^%DT,DD^%DT
"RTN","LREPI2",21,0)
 S XQAMSG=$P(^LAB(69.4,LRPROT,0),U,5)_" Was processed at "_Y
"RTN","LREPI2",22,0)
 ;GET THE DUZ'S FOR ALERTS
"RTN","LREPI2",23,0)
 S LRIEN=0 F  S LRIEN=$O(^LAB(69.4,LRPROT,1,LRIEN)) Q:+LRIEN'>0  D
"RTN","LREPI2",24,0)
 .S LRDATA=$G(^LAB(69.4,LRPROT,1,LRIEN,0))
"RTN","LREPI2",25,0)
 .I $P(LRDATA,";",2)["VA(200" S XQA($P(LRDATA,";",1))=""
"RTN","LREPI2",26,0)
 .I $P(LRDATA,";",2)["XMB(3.8" D
"RTN","LREPI2",27,0)
 ..S LRMG=$P(LRDATA,";",1) ;Q:'$D(^XMB(3.8,LRMG))
"RTN","LREPI2",28,0)
 ..S LRMGN=$$GET1^DIQ(69.4,LRMG,1) Q:LRMGN=""
"RTN","LREPI2",29,0)
 ..S X=LRMGN,XMDUZ=DUZ D INST^XMA21
"RTN","LREPI2",30,0)
 ..;S LRDUZ=0 F  S LRDUZ=$O(^XMB(3.8,LRMG,1,"B",LRDUZ)) Q:+LRDUZ'>0  S XQA(LRDUZ)=""
"RTN","LREPI2",31,0)
 Q:'$D(XQA)
"RTN","LREPI2",32,0)
 D SETUP^XQALERT
"RTN","LREPI2",33,0)
 Q
"RTN","LREPI2",34,0)
SEND ;SEND THE HL7 MESSAGE
"RTN","LREPI2",35,0)
 D HEAD
"RTN","LREPI2",36,0)
 N HLP
"RTN","LREPI2",37,0)
 S HLP("NAMESPACE")="LR"
"RTN","LREPI2",38,0)
 D GENERATE^HLMA(LRPROT,"GM",1,.HLRST,"",.HLP)
"RTN","LREPI2",39,0)
 S LRMSGNM=LRMSGNM+1,LRMSGSZ=0
"RTN","LREPI2",40,0)
 K ^TMP("HLS",$J)
"RTN","LREPI2",41,0)
 Q
"RTN","LREPI2",42,0)
EN ;ENTRY TO BUILD A MESSAGE
"RTN","LREPI2",43,0)
 S (LRCNT,LRPID)=1,DFN=0
"RTN","LREPI2",44,0)
 F  S DFN=$O(^TMP($J,LRPROT,DFN)) Q:+DFN'>0  D
"RTN","LREPI2",45,0)
 .I LRMSGSZ>5000 D MOVE,SEND
"RTN","LREPI2",46,0)
 .Q:$E($P(^DPT(DFN,0),U,9),1,5)="00000"
"RTN","LREPI2",47,0)
 .D PID^LREPI3
"RTN","LREPI2",48,0)
 .S LRPV1=1,LRENDT=0,LRPFG="",LREFG=0,LRPVVV=0
"RTN","LREPI2",49,0)
 .F  S LRENDT=$O(^TMP($J,LRPROT,DFN,LRENDT)) S LRPFG="" Q:+LRENDT'>0!(LREFG)  D
"RTN","LREPI2",50,0)
 ..D PV1
"RTN","LREPI2",51,0)
 ..I $D(^TMP("LREPISRCH",$J,DFN)),LRPROT=LRPROTX D RXNT^LREPIPH
"RTN","LREPI2",52,0)
 ..S LRPATH=0,LRNTE=1,LRPVVV=1
"RTN","LREPI2",53,0)
 ..F  S LRPATH=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH)) Q:+LRPATH'>0!(LREFG)  D
"RTN","LREPI2",54,0)
 ...D:LRPFG'=LRPATH NTE^LREPI3
"RTN","LREPI2",55,0)
 ...S LRPFG=LRPATH,LROBR=1,LRINVD=0
"RTN","LREPI2",56,0)
 ...F  S LRINVD=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH,LRINVD)) Q:+LRINVD'>0!(LREFG)  D
"RTN","LREPI2",57,0)
 ....S LRND=""
"RTN","LREPI2",58,0)
 ....F  S LRND=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH,LRINVD,LRND)) Q:LRND=""!(LREFG)  D
"RTN","LREPI2",59,0)
 .....S LRDFN=$$LRDFN^LR7OR1(DFN) Q:'LRDFN
"RTN","LREPI2",60,0)
 .....S LREFG=+$P($G(^LAB(69.5,LRPATH,0)),U,6)
"RTN","LREPI2",61,0)
 .....S:LRND'="PTF" LROBR=$$EN^LREPI1(LRDFN,LRND,LRINVD,LROBR)+1
"RTN","LREPI2",62,0)
 .....D:LRND="PTF" DG1^LREPI3
"RTN","LREPI2",63,0)
 .....D MOVE
"RTN","LREPI2",64,0)
 Q
"RTN","LREPI2",65,0)
TOTAL ;Report the total counts  ->    "ETI" or "TST" or "HEP"
"RTN","LREPI2",66,0)
 ;                                \/
"RTN","LREPI2",67,0)
 S LRITN=0 F  S LRITN=$O(^TMP($J,LRTND,LRITN)) Q:+LRITN'>0  D
"RTN","LREPI2",68,0)
 .S (LRNLT,LRTNM)=""
"RTN","LREPI2",69,0)
 .I LRTND="TST" D
"RTN","LREPI2",70,0)
 ..I '$D(^TMP($J,"TPROT",LRITN,LRPROT)) QUIT
"RTN","LREPI2",71,0)
 ..S LRTNM=$P($G(^LAB(60,LRITN,0)),U,1)
"RTN","LREPI2",72,0)
 ..S LRNL=$G(^LAB(60,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2",73,0)
 ..Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2",74,0)
 ..S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2",75,0)
 .I LRTND="ETI" D
"RTN","LREPI2",76,0)
 ..I '$D(^TMP($J,"EPROT",LRITN)) QUIT
"RTN","LREPI2",77,0)
 ..S LRTNM=$P($G(^LAB(61.2,LRITN,0)),U,1)
"RTN","LREPI2",78,0)
 ..S LRNL=$G(^LAB(61.2,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2",79,0)
 ..Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2",80,0)
 ..S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2",81,0)
 .I LRTND="STOT" D
"RTN","LREPI2",82,0)
 ..I '$D(^TMP($J,"SPROT",LRITN,LRPROT)) QUIT
"RTN","LREPI2",83,0)
 ..S LRTNM=""
"RTN","LREPI2",84,0)
 ..S LRNL=LRITN
"RTN","LREPI2",85,0)
 ..S LRNLT=""
"RTN","LREPI2",86,0)
 .I LRTND="HEP" D
"RTN","LREPI2",87,0)
 ..I '$D(^TMP($J,"HEP",LRITN)) QUIT
"RTN","LREPI2",88,0)
 ..S LRNLT=""
"RTN","LREPI2",89,0)
 ..I LRITN=1 S LRTNM="1-Declined Assessment for Hepatitis C"
"RTN","LREPI2",90,0)
 ..I LRITN=2 S LRTNM="2-No Risk Factors for Hepatitis C"
"RTN","LREPI2",91,0)
 ..I LRITN=3 S LRTNM="3-Previously Assessed for Hepatitis C"
"RTN","LREPI2",92,0)
 ..I LRITN=4 S LRTNM="4-Risk Factors for Hepatitis C"
"RTN","LREPI2",93,0)
 ..I LRITN=5 S LRTNM="5-Positive Test for Hepatitis C antibody"
"RTN","LREPI2",94,0)
 ..I LRITN=6 S LRTNM="6-Negative Test for Hepatitis C antibody"
"RTN","LREPI2",95,0)
 ..I LRITN=7 S LRTNM="7- Hepatitis C diagnosis (ICD based)"
"RTN","LREPI2",96,0)
 .K LRDATA
"RTN","LREPI2",97,0)
 .I '$G(LRTNM) D NAME
"RTN","LREPI2",98,0)
 .S LRDATA="NTE"_HLFS_HLFS_"T"_LRCS_LRNLT_LRCS_LRTNM_LRCS_+^TMP($J,LRTND,LRITN)
"RTN","LREPI2",99,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2",100,0)
 .S ^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2",101,0)
 .S ^TMP("LREPIREP",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2",102,0)
 .K LRDATA
"RTN","LREPI2",103,0)
 .S (LRPCNT,LRPTOT)=0
"RTN","LREPI2",104,0)
 .F  S LRPCNT=$O(^TMP($J,LRTND,LRITN,LRPCNT)) Q:+LRPCNT'>0  S LRPTOT=LRPTOT+1
"RTN","LREPI2",105,0)
 .Q:LRPTOT'>0
"RTN","LREPI2",106,0)
 .I '$G(LRTNM) D NAME
"RTN","LREPI2",107,0)
 .S LRDATA="NTE"_HLFS_HLFS_"T"_LRCS_LRNLT_LRCS_"PATIENTS WITH "_LRTNM_LRCS_LRPTOT ;+^TMP($J,LRPCNT,LRITN)
"RTN","LREPI2",108,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2",109,0)
 .S ^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2",110,0)
 .S ^TMP("LREPIREP",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2",111,0)
 Q
"RTN","LREPI2",112,0)
NAME ;
"RTN","LREPI2",113,0)
 Q:LRTND'="TST"
"RTN","LREPI2",114,0)
 S LRTNM=$P($G(^LAB(60,LRITN,0)),U,1)
"RTN","LREPI2",115,0)
 S LRNL=$G(^LAB(60,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2",116,0)
 Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2",117,0)
 S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2",118,0)
 ;
"RTN","LREPI2",119,0)
 QUIT
"RTN","LREPI2",120,0)
HEAD ;ENTER A NTE FOR REPORT HEADER
"RTN","LREPI2",121,0)
 K LRDATA
"RTN","LREPI2",122,0)
 S LRDATA="NTE"_HLFS_HLFS_$S(LRRTYPE:"R",1:"")_LRCS
"RTN","LREPI2",123,0)
 I $G(LR31799Z)=1 S LRDATA=LRDATA_"*** H E P A T I T I S  C  MARCH 17 1999 ***"
"RTN","LREPI2",124,0)
 S LRDATA=LRDATA_"REPORTING DATE FROM "_$$HLDATE^HLFNC(LRRPS)
"RTN","LREPI2",125,0)
 S LRDATA=LRDATA_" TO "_$$HLDATE^HLFNC(LRRPE)
"RTN","LREPI2",126,0)
 S LRDATA=LRDATA_LRCS_LRMSGNM
"RTN","LREPI2",127,0)
 I LRPROTX=LRPROT S LRDATA=LRDATA_LRCS_LRCS_"V3"
"RTN","LREPI2",128,0)
 I '$O(^TMP("HLS",$J,1)) S LRDATA=LRDATA_LRCS_"N"
"RTN","LREPI2",129,0)
 S ^TMP("HLS",$J,1)=$$UP^XLFSTR(LRDATA),LRMSGSZ=LRMSGSZ+$L(LRDATA)
"RTN","LREPI2",130,0)
 S ^TMP("LREPIREP",$J,1)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2",131,0)
 K LRDATA
"RTN","LREPI2",132,0)
 Q
"RTN","LREPI2",133,0)
MOVE S LRMOVE=0
"RTN","LREPI2",134,0)
 F  S LRMOVE=$O(^TMP("HL7",$J,LRMOVE)) Q:+LRMOVE'>0  D
"RTN","LREPI2",135,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2",136,0)
 .S ^TMP("HLS",$J,LRCNT)=^TMP("HL7",$J,LRMOVE)
"RTN","LREPI2",137,0)
 .S ^TMP("LREPIREP",$J,LRCNT)=^TMP("HL7",$J,LRMOVE)
"RTN","LREPI2",138,0)
 .S LRMSGSZ=LRMSGSZ+$L(^TMP("HL7",$J,LRMOVE))
"RTN","LREPI2",139,0)
 K ^TMP("HL7",$J),LRMOVE
"RTN","LREPI2",140,0)
 Q
"RTN","LREPI2",141,0)
 ;
"RTN","LREPI2",142,0)
PV1 ;
"RTN","LREPI2",143,0)
 ;I $O(^TMP($J,LRPROT,DFN,LRENDT,""))!('$D(^TMP("LREPISRCH",$J,DFN)))!($P(LRNDTDA,"^",3))="UPDT" D PV1^LREPI3 S LRPVVV=1
"RTN","LREPI2",144,0)
 I LRPV1>1,$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH))="",$P($G(^TMP($J,LRPROT,DFN,LRENDT)),"^",3)'="UPDT" Q
"RTN","LREPI2",145,0)
 I $P($G(^TMP($J,LRPROT,DFN,LRENDT)),"^",3)="UPDT" D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2",146,0)
 I $O(^TMP($J,LRPROT,DFN,LRENDT,""))]"" D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2",147,0)
 I '$D(^TMP("LREPISRCH",$J,DFN)) D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2A")
0^17^B25843319^B25858178
"RTN","LREPI2A",1,0)
LREPI2A ;DALOI/CKA - EMERGING PATHOGENS HL7 BUILD ;03 Jul 2013  4:27 PM
"RTN","LREPI2A",2,0)
 ;;5.2;LAB SERVICE;**281,421**;Sep 27, 1994;Build 48
"RTN","LREPI2A",3,0)
 ;
"RTN","LREPI2A",4,0)
START ;START
"RTN","LREPI2A",5,0)
 S LRPROT=0 F  S LRPROT=$O(^TMP($J,LRPROT)) Q:+LRPROT'>0  D
"RTN","LREPI2A",6,0)
 .D INIT^HLFNC2(LRPROT,.HL)
"RTN","LREPI2A",7,0)
 .S LRMSGNM=1,LRMSGSZ=0,LRCS=$E(HL("ECH"))
"RTN","LREPI2A",8,0)
 .S LRMSGDF=$S(+$P($G(^LAB(69.4,LRPROT,0)),U,3)>0:+$P($G(^LAB(69.4,LRPROT,0)),U,3),1:30000)
"RTN","LREPI2A",9,0)
 .D EN,MOVE
"RTN","LREPI2A",10,0)
 .F LRTND="ETI","TST","HEP" D:$D(^TMP($J,LRTND)) TOTAL
"RTN","LREPI2A",11,0)
 .D EN,MOVE,SEND
"RTN","LREPI2A",12,0)
 .D ALERT
"RTN","LREPI2A",13,0)
 K LRDUZ,LRMSGDF,%,%X
"RTN","LREPI2A",14,0)
 Q
"RTN","LREPI2A",15,0)
SEND ;BUILD MESSAGE BUT DON'T SEND
"RTN","LREPI2A",16,0)
 D HEAD
"RTN","LREPI2A",17,0)
 I LRREP=2 D SPSHT^LREPIRS3 S ^XTMP("LREPILOCALSPSHT"_LRLRDT,"DONE")=1
"RTN","LREPI2A",18,0)
 I LRREP=1 D REPORT^LREPIRS1 S ^XTMP("LREPILOCALREP"_LRLRDT,"DONE")=1
"RTN","LREPI2A",19,0)
 K ^TMP("HLS",$J)
"RTN","LREPI2A",20,0)
 K LRLC,LRHDGLC,HLFS,LRSEG,LRSPSHT,MSG,LRPID,LROBR,LRX
"RTN","LREPI2A",21,0)
 Q
"RTN","LREPI2A",22,0)
ALERT ;Send a Alert if desired.
"RTN","LREPI2A",23,0)
 K XQA,XQAMSG,XQAOPT,XQAROU,XQAID,XQADATA,XQAFLAG
"RTN","LREPI2A",24,0)
 S X="NOW",%DT="SRT" D ^%DT,DD^%DT
"RTN","LREPI2A",25,0)
 S XQAMSG="The local report/spreadsheet finished generating at "_Y
"RTN","LREPI2A",26,0)
 S XQA(LRDUZ)=""
"RTN","LREPI2A",27,0)
 Q:'$D(XQA)
"RTN","LREPI2A",28,0)
 D SETUP^XQALERT
"RTN","LREPI2A",29,0)
 Q
"RTN","LREPI2A",30,0)
EN ;ENTRY TO BUILD A MESSAGE
"RTN","LREPI2A",31,0)
 S (LRCNT,LRPID)=1,DFN=0
"RTN","LREPI2A",32,0)
 F  S DFN=$O(^TMP($J,LRPROT,DFN)) Q:+DFN'>0  D
"RTN","LREPI2A",33,0)
 .D PID^LREPI3
"RTN","LREPI2A",34,0)
 .S LRPV1=1,LRENDT=0,LRPFG="",LREFG=0,LRPVVV=0
"RTN","LREPI2A",35,0)
 .F  S LRENDT=$O(^TMP($J,LRPROT,DFN,LRENDT)) S LRPFG="" Q:+LRENDT'>0!(LREFG)  D
"RTN","LREPI2A",36,0)
 ..D PV1
"RTN","LREPI2A",37,0)
 ..I $D(^TMP("LREPISRCH",$J,DFN)),LRPROT=LRPROTX D RXNT^LREPIPH
"RTN","LREPI2A",38,0)
 ..S LRPATH=0,LRNTE=1,LRPVVV=1
"RTN","LREPI2A",39,0)
 ..F  S LRPATH=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH)) Q:+LRPATH'>0!(LREFG)  D
"RTN","LREPI2A",40,0)
 ...D:LRPFG'=LRPATH NTE^LREPI3
"RTN","LREPI2A",41,0)
 ...S LRPFG=LRPATH,LROBR=1,LRINVD=0
"RTN","LREPI2A",42,0)
 ...F  S LRINVD=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH,LRINVD)) Q:+LRINVD'>0!(LREFG)  D
"RTN","LREPI2A",43,0)
 ....S LRND=""
"RTN","LREPI2A",44,0)
 ....F  S LRND=$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH,LRINVD,LRND)) Q:LRND=""!(LREFG)  D
"RTN","LREPI2A",45,0)
 .....S LRDFN=$$LRDFN^LR7OR1(DFN) Q:'LRDFN
"RTN","LREPI2A",46,0)
 .....S LREFG=+$P($G(^LAB(69.5,LRPATH,0)),U,6)
"RTN","LREPI2A",47,0)
 .....S:LRND'="PTF" LROBR=$$EN^LREPI1(LRDFN,LRND,LRINVD,LROBR)+1
"RTN","LREPI2A",48,0)
 .....D:LRND="PTF" DG1^LREPI3
"RTN","LREPI2A",49,0)
 .....D MOVE
"RTN","LREPI2A",50,0)
 Q
"RTN","LREPI2A",51,0)
TOTAL ;Report the total counts  ->    "ETI" or "TST" or "HEP"
"RTN","LREPI2A",52,0)
 ;                                \/
"RTN","LREPI2A",53,0)
 S LRITN=0 F  S LRITN=$O(^TMP($J,LRTND,LRITN)) Q:+LRITN'>0  D
"RTN","LREPI2A",54,0)
 .S (LRNLT,LRTNM)=""
"RTN","LREPI2A",55,0)
 .I LRTND="TST" D
"RTN","LREPI2A",56,0)
 ..I '$D(^TMP($J,"TPROT",LRITN,LRPROT)) QUIT
"RTN","LREPI2A",57,0)
 ..S LRTNM=$P($G(^LAB(60,LRITN,0)),U,1)
"RTN","LREPI2A",58,0)
 ..S LRNL=$G(^LAB(60,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2A",59,0)
 ..Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2A",60,0)
 ..S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2A",61,0)
 .I LRTND="ETI" D
"RTN","LREPI2A",62,0)
 ..I '$D(^TMP($J,"EPROT",LRITN)) QUIT
"RTN","LREPI2A",63,0)
 ..S LRTNM=$P($G(^LAB(61.2,LRITN,0)),U,1)
"RTN","LREPI2A",64,0)
 ..S LRNL=$G(^LAB(61.2,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2A",65,0)
 ..Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2A",66,0)
 ..S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2A",67,0)
 .I LRTND="STOT" D
"RTN","LREPI2A",68,0)
 ..I '$D(^TMP($J,"SPROT",LRITN,LRPROT)) QUIT
"RTN","LREPI2A",69,0)
 ..S LRTNM=""
"RTN","LREPI2A",70,0)
 ..S LRNL=LRITN
"RTN","LREPI2A",71,0)
 ..S LRNLT=""
"RTN","LREPI2A",72,0)
 .I LRTND="HEP" D
"RTN","LREPI2A",73,0)
 ..I '$D(^TMP($J,"HEP",LRITN)) QUIT
"RTN","LREPI2A",74,0)
 ..S LRNLT=""
"RTN","LREPI2A",75,0)
 ..I LRITN=1 S LRTNM="1-Declined Assessment for Hepatitis C"
"RTN","LREPI2A",76,0)
 ..I LRITN=2 S LRTNM="2-No Risk Factors for Hepatitis C"
"RTN","LREPI2A",77,0)
 ..I LRITN=3 S LRTNM="3-Previously Assessed for Hepatitis C"
"RTN","LREPI2A",78,0)
 ..I LRITN=4 S LRTNM="4-Risk Factors for Hepatitis C"
"RTN","LREPI2A",79,0)
 ..I LRITN=5 S LRTNM="5-Positive Test for Hepatitis C antibody"
"RTN","LREPI2A",80,0)
 ..I LRITN=6 S LRTNM="6-Negative Test for Hepatitis C antibody"
"RTN","LREPI2A",81,0)
 ..I LRITN=7 S LRTNM="7- Hepatitis C diagnosis (ICD based)"
"RTN","LREPI2A",82,0)
 .K LRDATA
"RTN","LREPI2A",83,0)
 .I '$G(LRTNM) D NAME
"RTN","LREPI2A",84,0)
 .S LRDATA="NTE"_HLFS_HLFS_"T"_LRCS_LRNLT_LRCS_LRTNM_LRCS_+^TMP($J,LRTND,LRITN)
"RTN","LREPI2A",85,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2A",86,0)
 .S ^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2A",87,0)
 .K LRDATA
"RTN","LREPI2A",88,0)
 .S (LRPCNT,LRPTOT)=0
"RTN","LREPI2A",89,0)
 .F  S LRPCNT=$O(^TMP($J,LRTND,LRITN,LRPCNT)) Q:+LRPCNT'>0  S LRPTOT=LRPTOT+1
"RTN","LREPI2A",90,0)
 .Q:LRPTOT'>0
"RTN","LREPI2A",91,0)
 .I '$G(LRTNM) D NAME
"RTN","LREPI2A",92,0)
 .S LRDATA="NTE"_HLFS_HLFS_"T"_LRCS_LRNLT_LRCS_"PATIENTS WITH "_LRTNM_LRCS_LRPTOT ;+^TMP($J,LRPCNT,LRITN)
"RTN","LREPI2A",93,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2A",94,0)
 .S ^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2A",95,0)
 Q
"RTN","LREPI2A",96,0)
NAME ;
"RTN","LREPI2A",97,0)
 Q:LRTND'="TST"
"RTN","LREPI2A",98,0)
 S LRTNM=$P($G(^LAB(60,LRITN,0)),U,1)
"RTN","LREPI2A",99,0)
 S LRNL=$G(^LAB(60,LRITN,64)) Q:+LRNL'>0
"RTN","LREPI2A",100,0)
 Q:'$D(^LAM(LRNL,0))
"RTN","LREPI2A",101,0)
 S LRNLT=$P(^LAM(LRNL,0),U,2)
"RTN","LREPI2A",102,0)
 ;
"RTN","LREPI2A",103,0)
 QUIT
"RTN","LREPI2A",104,0)
HEAD ;ENTER A NTE FOR REPORT HEADER
"RTN","LREPI2A",105,0)
 K LRDATA
"RTN","LREPI2A",106,0)
 S LRDATA="NTE"_HLFS_HLFS_$S(LRRTYPE:"R",1:"")_LRCS
"RTN","LREPI2A",107,0)
 I $G(LR31799Z)=1 S LRDATA=LRDATA_"*** H E P A T I T I S  C  MARCH 17 1999 ***"
"RTN","LREPI2A",108,0)
 S LRDATA=LRDATA_"REPORTING DATE FROM "_$$HLDATE^HLFNC(LRRPS)
"RTN","LREPI2A",109,0)
 S LRDATA=LRDATA_" TO "_$$HLDATE^HLFNC(LRRPE)
"RTN","LREPI2A",110,0)
 S LRDATA=LRDATA
"RTN","LREPI2A",111,0)
 I LRPROTX=LRPROT S LRDATA=LRDATA_LRCS_LRCS_"V3"
"RTN","LREPI2A",112,0)
 I '$O(^TMP("HLS",$J,1)) S LRDATA=LRDATA_LRCS_"N"
"RTN","LREPI2A",113,0)
 S ^TMP("HLS",$J,1)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI2A",114,0)
 K LRDATA
"RTN","LREPI2A",115,0)
 Q
"RTN","LREPI2A",116,0)
MOVE S LRMOVE=0
"RTN","LREPI2A",117,0)
 F  S LRMOVE=$O(^TMP("HL7",$J,LRMOVE)) Q:+LRMOVE'>0  D
"RTN","LREPI2A",118,0)
 .S LRCNT=LRCNT+1
"RTN","LREPI2A",119,0)
 .S ^TMP("HLS",$J,LRCNT)=^TMP("HL7",$J,LRMOVE)
"RTN","LREPI2A",120,0)
 K ^TMP("HL7",$J),LRMOVE
"RTN","LREPI2A",121,0)
 Q
"RTN","LREPI2A",122,0)
 ;
"RTN","LREPI2A",123,0)
PV1 ;
"RTN","LREPI2A",124,0)
 ;I $O(^TMP($J,LRPROT,DFN,LRENDT,""))!('$D(^TMP("LREPISRCH",$J,DFN)))!($P(LRNDTDA,"^",3))="UPDT" D PV1^LREPI3 S LRPVVV=1
"RTN","LREPI2A",125,0)
 I LRPV1>1,$O(^TMP($J,LRPROT,DFN,LRENDT,LRPATH))="",$P($G(^TMP($J,LRPROT,DFN,LRENDT)),"^",3)'="UPDT" Q
"RTN","LREPI2A",126,0)
 I $P($G(^TMP($J,LRPROT,DFN,LRENDT)),"^",3)="UPDT" D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2A",127,0)
 I $O(^TMP($J,LRPROT,DFN,LRENDT,""))]"" D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2A",128,0)
 I '$D(^TMP("LREPISRCH",$J,DFN)) D PV1^LREPI3 S LRPVVV=1 Q
"RTN","LREPI2A",129,0)
 Q
"RTN","LREPI3")
0^2^B50368609^B38193002
"RTN","LREPI3",1,0)
LREPI3 ;DALOI/SED - EMERGING PATHOGENS HL7 SEGMENTS ;19 Jun 2013  2:55 PM
"RTN","LREPI3",2,0)
 ;;5.2;LAB SERVICE;**132,175,260,281,320,315,421**;Sep 27, 1994;Build 48
"RTN","LREPI3",3,0)
 ; Reference to ^DGPT supported by IA #418
"RTN","LREPI3",4,0)
 ; Reference to ^SC supported by IA #10040
"RTN","LREPI3",5,0)
 ; Reference to ^DIC(21 supported by IA #4280
"RTN","LREPI3",6,0)
 ; Reference to ICN supported by IA #2701
"RTN","LREPI3",7,0)
 ; Reference to VAFHLPID supported by IA # 263
"RTN","LREPI3",8,0)
 ; Reference to VAFHLPV1 supporte by IA # 3018
"RTN","LREPI3",9,0)
 ; Reference to ^DIC(5 supported by IA # 10056
"RTN","LREPI3",10,0)
 ; Reference to $$HOMELESS supported by IA #1528
"RTN","LREPI3",11,0)
 ; Reference to VADPT suppoted by IA #10061
"RTN","LREPI3",12,0)
 ; Reference to ^AUPNVPOV supported by IA # 3094
"RTN","LREPI3",13,0)
 ; Reference to ^AUPNVSIT supported by IA #3530
"RTN","LREPI3",14,0)
 ; Reference to $$STA^XUAF4(IEN) supported by IA #2171
"RTN","LREPI3",15,0)
 ; Reference to $$PTR2CODE^DGUTL4 supported by IA #3799
"RTN","LREPI3",16,0)
 ; Reference to $$CODEN^ICDEX supported by IA #5747
"RTN","LREPI3",17,0)
 ;
"RTN","LREPI3",18,0)
NTE ;TO BUILD THE NTE SEGMENT TO DEFINE THE EPI
"RTN","LREPI3",19,0)
 S LRDATA="NTE"_HLFS_LRNTE_HLFS_$P(^LAB(69.5,LRPATH,0),U,9)_LRCS_$P(^LAB(69.5,LRPATH,0),U,1)
"RTN","LREPI3",20,0)
 S LRCNT=LRCNT+1,^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI3",21,0)
 S ^TMP("LREPIREP",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI3",22,0)
 S LRMSGSZ=LRMSGSZ+$L(LRDATA)
"RTN","LREPI3",23,0)
 S LRNTE=LRNTE+1
"RTN","LREPI3",24,0)
 Q
"RTN","LREPI3",25,0)
DG1 ;BUILD THE DG1 FOR ICD CODES
"RTN","LREPI3",26,0)
 K ^TMP($J,"DG1")
"RTN","LREPI3",27,0)
 S IFN=+$G(^TMP($J,LRPROT,DFN,LRENDT,LRPATH,LRINVD,LRND))
"RTN","LREPI3",28,0)
DG11 Q:+IFN'>0
"RTN","LREPI3",29,0)
 Q:'$D(^DGPT(IFN))
"RTN","LREPI3",30,0)
 ; Date of Interest is Discharge Date if present, otherwise Current
"RTN","LREPI3",31,0)
 ; System Date
"RTN","LREPI3",32,0)
 N LRDTINT S LRDTINT=$S($P($G(^DGPT(IFN,70)),U,1)]"":$P(^DGPT(IFN,70),U,1),1:DT)
"RTN","LREPI3",33,0)
 ;SEARCH FOR LEGIONAIRS HERE
"RTN","LREPI3",34,0)
 I $P($G(^DGPT(IFN,300)),U,3)=1 D
"RTN","LREPI3",35,0)
 .I '$D(LRICDX) S LRCSYS=$$ICDSYS^LREPICD(LRDTINT,"D"),LRICDX=$S(LRCSYS="ICD":0,LRCSYS="10D":1,1:-1)
"RTN","LREPI3",36,0)
 .I 'LRICDX S LRICDIEN=+$$CODEN^ICDEX("482.84 ",80) Q:+LRICDIEN'>0  S ^TMP($J,"DG1",LRICDIEN)=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",37,0)
 .I LRICDX,LRICDX'=-1 F XCODE="A48.1","A48.2","A48.8" D  Q:'$D(LRICDIEN)
"RTN","LREPI3",38,0)
 ..S LRICDIEN(XCODE)=+$$CODEN^ICDEX(XCODE,80) I +LRICDIEN(XCODE)'>0 K LRICDIEN(XCODE) Q
"RTN","LREPI3",39,0)
 ..S ^TMP($J,"DG1",LRICDIEN(XCODE))=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",40,0)
 I $D(^DGPT(IFN,70)) F LRI=10,11,16:1:24 D
"RTN","LREPI3",41,0)
 .S LRICDIEN=$P(^DGPT(IFN,70),U,LRI) Q:+LRICDIEN'>0
"RTN","LREPI3",42,0)
 .S ^TMP($J,"DG1",LRICDIEN)=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",43,0)
 ;SEARCH SUB FIELDS
"RTN","LREPI3",44,0)
 S LRMV=0 F  S LRMV=$O(^DGPT(IFN,"M",LRMV)) Q:+LRMV'>0  D
"RTN","LREPI3",45,0)
 .;SEARCH FOR LEGIONAIRS HERE IN SUB FILE
"RTN","LREPI3",46,0)
 .I $P($G(^DGPT(IFN,"M",LRMV,300)),U,3)=1 D
"RTN","LREPI3",47,0)
 ..I 'LRICDX S LRICDIEN=$$CODEN^ICDEX("482.84 ",80) Q:+LRICDIEN'>0  S ^TMP($J,"DG1",LRICDIEN)=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",48,0)
 ..I LRICDX,LRICDX'=-1 F XCODE="A48.1","A48.2","A48.8" D  Q:'$D(LRICDIEN)
"RTN","LREPI3",49,0)
 ...S LRICDIEN(XCODE)=+$$CODEN^ICDEX(XCODE,80) I +LRICDIEN(XCODE)'>0 K LRICDIEN(XCODE) Q
"RTN","LREPI3",50,0)
 ...S ^TMP($J,"DG1",LRICDIEN(XCODE))=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",51,0)
 .I $D(^DGPT(IFN,"M",LRMV,0)) F LRI=5:1:9,11:1:15 D
"RTN","LREPI3",52,0)
 ..S LRICDIEN=$P(^DGPT(IFN,"M",LRMV,0),U,LRI) Q:+LRICDIEN'>0
"RTN","LREPI3",53,0)
 ..S ^TMP($J,"DG1",LRICDIEN)=$P($G(^DGPT(IFN,70)),"^",10)_"^"_$$HLDATE^HLFNC($P($G(^DGPT(IFN,0)),"^",2))
"RTN","LREPI3",54,0)
 Q:'$D(^TMP($J,"DG1"))
"RTN","LREPI3",55,0)
BLD S LRICDIEN=0 F  S LRICDIEN=$O(^TMP($J,"DG1",LRICDIEN)) Q:+LRICDIEN'>0  D
"RTN","LREPI3",56,0)
 .S:'$D(DGCNT) DGCNT=1
"RTN","LREPI3",57,0)
 .N LRTMP,LRXSYS
"RTN","LREPI3",58,0)
 .K LRCSYS S LRCSYS=$$ICDSYS^LREPICD(LRDTINT,"D") Q:$P(LRCSYS,U,1)=-1
"RTN","LREPI3",59,0)
 .S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDIEN,$G(LRDTINT,""),)
"RTN","LREPI3",60,0)
 .K LRDATA,LREPICSY
"RTN","LREPI3",61,0)
 .S LREPICSY=$S($P(LRTMP,U,20)=1:" I9",$P(LRTMP,U,20)=30:"I10",1:"UNKNOWN CODE SYSTEM"),LRXSYS=$S(LRCSYS="ICD":" I9",1:"I10")
"RTN","LREPI3",62,0)
 .Q:LREPICSY'=LRXSYS
"RTN","LREPI3",63,0)
 .S LRDATA="DG1"_HLFS_DGCNT_HLFS_HLFS_$P(LRTMP,U,2)
"RTN","LREPI3",64,0)
 .S LRDATA=LRDATA_LRCS_$P(LRTMP,U,4)_LRCS_LREPICSY
"RTN","LREPI3",65,0)
 .I LRPROT=LRPROTX S LRDATA=LRDATA_HLFS_$P(^TMP($J,"DG1",LRICDIEN),"^",2)_HLFS_HLFS_$S(LRICDIEN=$P(^TMP($J,"DG1",LRICDIEN),"^"):"PR",1:"")
"RTN","LREPI3",66,0)
 .S ^TMP("HL7",$J,DGCNT)=$$UP^XLFSTR(LRDATA),DGCNT=DGCNT+1
"RTN","LREPI3",67,0)
 K ^TMP($J,"DG1"),LRDATA,DGCNT,LRICDIEN,LRMV,LRICDX,LRCSYS,XCODE
"RTN","LREPI3",68,0)
 Q
"RTN","LREPI3",69,0)
PID ;TO BUILD PID SEGMENT
"RTN","LREPI3",70,0)
 K MSG
"RTN","LREPI3",71,0)
 S FLDS="1,2,3,5,7,8,10BT,19,22BT" S MSG=$$EN^VAFHLPID(DFN,FLDS,LRPID)
"RTN","LREPI3",72,0)
 ;MADE CHANGE FOR PID SEGMENTS TOO LONG;CKA;06/30/04
"RTN","LREPI3",73,0)
 D DEM^VADPT
"RTN","LREPI3",74,0)
 I $D(VAFPID(1)) D
"RTN","LREPI3",75,0)
 .S $P(MSG,HLFS,11)=VADM(12),MSG=MSG_VAFPID(1),$P(MSG,HLFS,23)=VADM(11)
"RTN","LREPI3",76,0)
 S ICN=$$GETICN^MPIF001(DFN)
"RTN","LREPI3",77,0)
 S:ICN<0 $P(MSG,HLFS,4)=$P(MSG,HLFS,4)_LRCS_""""""_LRCS_"VAMPI"
"RTN","LREPI3",78,0)
 S:ICN>0 $P(MSG,HLFS,4)=$P(MSG,HLFS,4)_LRCS_ICN_LRCS_"VAMPI"
"RTN","LREPI3",79,0)
 ;ADDITIONAL DATA ADDED HERE HOMELESSNESS
"RTN","LREPI3",80,0)
 S:$$HOMELESS^SOWKHIRM(DFN) $P(MSG,HLFS,12)="HOMELESS"
"RTN","LREPI3",81,0)
 ;NOW GET PERIOD OF SERVICE
"RTN","LREPI3",82,0)
 K VAEL D ELIG^VADPT
"RTN","LREPI3",83,0)
 S:$G(VAEL(2))'="" $P(MSG,HLFS,28)=$P($G(^DIC(21,+VAEL(2),0)),U,3)
"RTN","LREPI3",84,0)
 K VAEL
"RTN","LREPI3",85,0)
 ;GET ZIP IF THERE
"RTN","LREPI3",86,0)
 K VAPA D ADD^VADPT
"RTN","LREPI3",87,0)
 S $P(MSG,HLFS,12)=$P(MSG,HLFS,12)_LRCS_LRCS_LRCS_VAPA(5)_LRCS_$G(VAPA(6))_LRCS_LRCS_LRCS_LRCS
"RTN","LREPI3",88,0)
 I VAPA(7)'="",VAPA(5)'="" S CTY=$P(VAPA(7),U,2),CTYN=$P(VAPA(7),U) I CTYN'="" S CTYCD=$P($G(^DIC(5,$P(VAPA(5),U),1,CTYN,0)),U,3) D
"RTN","LREPI3",89,0)
 .S $P(MSG,HLFS,12)=$P(MSG,HLFS,12)_$G(CTYCD)_"^"_$G(CTY)
"RTN","LREPI3",90,0)
 K VAPA,CTY,CTYN,CTYCD,LRRACE
"RTN","LREPI3",91,0)
 I $P(MSG,HLFS,12)="~~~~~~~~" S $P(MSG,HLFS,12)=""
"RTN","LREPI3",92,0)
 S LRRACE=$$PTR2CODE^DGUTL4($P(VADM(8),U))
"RTN","LREPI3",93,0)
 I $L(MSG)>245 D
"RTN","LREPI3",94,0)
 .S $P(MSG,HLFS,11)=VADM(12),$P(MSG,HLFS,23)=VADM(11)
"RTN","LREPI3",95,0)
 S:$P(MSG,HLFS,11)="""""~""""~0005~""""~""""~CDC" $P(MSG,HLFS,11)=""
"RTN","LREPI3",96,0)
 S:$P(MSG,HLFS,23)="""""~""""~0189~""""~""""~CDC" $P(MSG,HLFS,23)=""
"RTN","LREPI3",97,0)
 S $P(MSG,HLFS,11)=LRRACE_"~"_$P(MSG,HLFS,11)
"RTN","LREPI3",98,0)
 I $P(MSG,HLFS,11)="~" S $P(MSG,HLFS,11)=""
"RTN","LREPI3",99,0)
 S LRPID=LRPID+1,LRCNT=LRCNT+1,^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(MSG)
"RTN","LREPI3",100,0)
 S ^TMP("LREPIREP",$J,LRCNT)=$$UP^XLFSTR(MSG)
"RTN","LREPI3",101,0)
 S LRMSGSZ=LRMSGSZ+$L(MSG)
"RTN","LREPI3",102,0)
 K FLDS,VAEL,ICN,VAFPID,VADM
"RTN","LREPI3",103,0)
 Q
"RTN","LREPI3",104,0)
PV1 ;TO BUILD PV1 SEGMENT
"RTN","LREPI3",105,0)
 K PTF,Y,C,LRDATA,MSG,LRPATLOC
"RTN","LREPI3",106,0)
 S LRDATA=""
"RTN","LREPI3",107,0)
 I $P(^TMP($J,LRPROT,DFN,LRENDT),U)="I" D
"RTN","LREPI3",108,0)
 .S FLDS="1,2,3,36,39,44,45" S LRDATA=$$IN^VAFHLPV1(DFN,LRENDT,FLDS,"","","","")
"RTN","LREPI3",109,0)
 I $P(LRDATA,HLFS)="" S $P(LRDATA,HLFS)="PV1"
"RTN","LREPI3",110,0)
 S $P(LRDATA,HLFS,2)=LRPV1
"RTN","LREPI3",111,0)
 S $P(LRDATA,HLFS,7)=""
"RTN","LREPI3",112,0)
 S $P(LRDATA,HLFS,3)=$P(^TMP($J,LRPROT,DFN,LRENDT),U)
"RTN","LREPI3",113,0)
 I $P(LRDATA,HLFS,3)="O" D
"RTN","LREPI3",114,0)
 .S LRPATLOC=$P(^TMP($J,LRPROT,DFN,LRENDT),U,2)
"RTN","LREPI3",115,0)
 .S LRFILE=$P(LRPATLOC,";",2)
"RTN","LREPI3",116,0)
 .S LRIFN=$P(LRPATLOC,";")
"RTN","LREPI3",117,0)
 .I LRFILE="SC(" D
"RTN","LREPI3",118,0)
 ..I $P($G(^SC(LRIFN,0)),U,4)'="" D
"RTN","LREPI3",119,0)
 ...S LRPATLOC=$$STA^XUAF4($P($G(^SC(LRIFN,0)),U,4))
"RTN","LREPI3",120,0)
 .I LRFILE="DIC(4" D
"RTN","LREPI3",121,0)
 ..I $$STA^XUAF4(LRIFN)'="" D
"RTN","LREPI3",122,0)
 ...S LRPATLOC=$$STA^XUAF4(LRIFN)
"RTN","LREPI3",123,0)
 .S $P(LRDATA,HLFS,39)=LRPATLOC
"RTN","LREPI3",124,0)
 .K LRPATLOC,LRFILE,LRIFN
"RTN","LREPI3",125,0)
 S:$P(^TMP($J,LRPROT,DFN,LRENDT),U,3)="UPDT" $P(LRDATA,HLFS,3)="U"
"RTN","LREPI3",126,0)
 S $P(LRDATA,HLFS,45)=$$HLDATE^HLFNC(LRENDT)
"RTN","LREPI3",127,0)
 S:$P(LRDATA,HLFS,46)="""""" $P(LRDATA,HLFS,46)=""
"RTN","LREPI3",128,0)
 ;MADE CHANGE FOR FUTURE DISCHARGE DATES;CKA 6/30/2004
"RTN","LREPI3",129,0)
 S:$P(LRDATA,HLFS,46)>LRRPE $P(LRDATA,HLFS,46)=""
"RTN","LREPI3",130,0)
 S PTF=$P(^TMP($J,LRPROT,DFN,LRENDT),U,2) I +PTF>0 D
"RTN","LREPI3",131,0)
 .Q:'$D(^DGPT(PTF,0))
"RTN","LREPI3",132,0)
 .Q:$P(^DGPT(PTF,0),U,6)'=3
"RTN","LREPI3",133,0)
 .Q:'$D(^DGPT(PTF,70))
"RTN","LREPI3",134,0)
 .I +$P(^DGPT(PTF,70),U)>0,+$P(^DGPT(PTF,70),U)<LRRPE S $P(LRDATA,HLFS,46)=$$HLDATE^HLFNC($P(^DGPT(PTF,70),U))
"RTN","LREPI3",135,0)
 .S (Y,LRDTY)=$P(^DGPT(PTF,70),U,3)
"RTN","LREPI3",136,0)
 .Q:+Y'>0
"RTN","LREPI3",137,0)
 .S Y=$$EXTERNAL^DILFD(45,72,,Y) ;removed direct reference to ^DD(45,72
"RTN","LREPI3",138,0)
 .;S C=$P(^DD(45,72,0),U,2) D Y^DIQ ;RLM
"RTN","LREPI3",139,0)
 .S $P(LRDATA,HLFS,37)=LRDTY_LRCS_Y_LRCS_"VA45"
"RTN","LREPI3",140,0)
 .S $P(LRDATA,HLFS,40)=$P(^DGPT(PTF,0),U,3)
"RTN","LREPI3",141,0)
 S LRCNT=LRCNT+1,^TMP("HLS",$J,LRCNT)=$$UP^XLFSTR(LRDATA),LRPV1=LRPV1+1
"RTN","LREPI3",142,0)
 S ^TMP("LREPIREP",$J,LRCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI3",143,0)
 S LRMSGSZ=LRMSGSZ+$L(LRDATA)
"RTN","LREPI3",144,0)
 I $P(LRDATA,HLFS,3)="O" D  D MOVE^LREPI2
"RTN","LREPI3",145,0)
 .S VIFN=0
"RTN","LREPI3",146,0)
 .F  S VIFN=$O(^AUPNVPOV("AA",DFN,9999999-$P(LRENDT,"."),VIFN)) Q:+VIFN'>0  D
"RTN","LREPI3",147,0)
 ..S LRVISIT=$P(^AUPNVSIT($P(^AUPNVPOV(VIFN,0),U,3),812),U,2)
"RTN","LREPI3",148,0)
 ..I LRVISIT'=26 S LRVISIT=0 Q
"RTN","LREPI3",149,0)
 ..S LRICDN=$P($G(^AUPNVPOV(VIFN,0)),U)
"RTN","LREPI3",150,0)
 ..Q:LRICDN=""
"RTN","LREPI3",151,0)
 ..N LRTMP
"RTN","LREPI3",152,0)
 ..I $G(LRCSYS)="" S LRCSYS=$$CSI^ICDEX(80,LRICDN)
"RTN","LREPI3",153,0)
 ..S LRTMP=$$ICDDATA^ICDXCODE(LRCSYS,LRICDN,,)
"RTN","LREPI3",154,0)
 ..S:'$D(DGCNT) DGCNT=1
"RTN","LREPI3",155,0)
 ..S LRDATA="DG1"_HLFS_DGCNT_HLFS_LREPICSY_HLFS_$P(LRTMP,U,2)
"RTN","LREPI3",156,0)
 ..S LRDATA=LRDATA_LRCS_$P(LRTMP,U,4)_LRCS_LREPICSY
"RTN","LREPI3",157,0)
 ..S LRDATA=LRDATA_HLFS_$$HLDATE^HLFNC(LRENDT)_HLFS_HLFS_$S($P(^AUPNVPOV(VIFN,0),U,12)="P":"PR",1:"")
"RTN","LREPI3",158,0)
 ..S ^TMP("HL7",$J,DGCNT)=$$UP^XLFSTR(LRDATA)
"RTN","LREPI3",159,0)
 .. S DGCNT=DGCNT+1
"RTN","LREPI3",160,0)
 K DGCNT,VIFN,LRICDN,LRICDIEN,LRDATA,LRVISIT
"RTN","LREPI3",161,0)
 Q:$G(PTF)'>0
"RTN","LREPI3",162,0)
 Q:'$D(^DGPT(PTF,0))
"RTN","LREPI3",163,0)
 Q:$P(^DGPT(PTF,0),U,6)'=3
"RTN","LREPI3",164,0)
 S IFN=PTF D DG11
"RTN","LREPI3",165,0)
 D MOVE^LREPI2
"RTN","LREPI3",166,0)
 K PTF,Y,C,LRDATA,LRDTY,IFN,LRICDIEN,LRICDN,LROLLOC,VIFN
"RTN","LREPI3",167,0)
 Q
"RTN","LREPI3",168,0)
 ;
"RTN","LREPI5")
0^3^B7519412^B5654909
"RTN","LREPI5",1,0)
LREPI5 ;DALOI/SED - EMERGING PATHOGENS SEARCH ;19 Jun 2013  3:17 PM
"RTN","LREPI5",2,0)
 ;;5.2;LAB SERVICE;**281,315,421**;Sep 27, 1994;Build 48
"RTN","LREPI5",3,0)
 ; Reference to ^DGPT supported by IA #418
"RTN","LREPI5",4,0)
 ; Reference to ^ORD supported by IA #872
"RTN","LREPI5",5,0)
 ; Reference to PATS^PXRMXX supported by IA #3134
"RTN","LREPI5",6,0)
 ; Reference to VADPT supported by IA #10061
"RTN","LREPI5",7,0)
 ; Reference to ^AUPNVPOV supported by IA #3094
"RTN","LREPI5",8,0)
 ; Reference to $$CODEN^ICDEX supported by IA #5747
"RTN","LREPI5",9,0)
 Q
"RTN","LREPI5",10,0)
 ;Called from LREPI
"RTN","LREPI5",11,0)
PTF ;SEARCH DISCHARGE DATES; NEED ADDITIONAL LATER SPECS
"RTN","LREPI5",12,0)
 S STDT=(LRRPS-.0001),ENDT=(LRRPE+.9999)
"RTN","LREPI5",13,0)
 F  S STDT=$O(^DGPT("ADS",STDT)) Q:+STDT'>0!(STDT>ENDT)  D
"RTN","LREPI5",14,0)
 .K LRICDX,LRCSYS S LRCSYS=$$ICDSYS^LREPICD(STDT,"D"),LRICDX=$S(LRCSYS="ICD":0,LRCSYS="10D":1,1:-1) Q:LRICDX=-1
"RTN","LREPI5",15,0)
 .S IFN=0 F  S IFN=$O(^DGPT("ADS",STDT,IFN)) Q:+IFN'>0  D
"RTN","LREPI5",16,0)
 ..Q:$P($G(^DGPT(IFN,0)),U,6)'=3
"RTN","LREPI5",17,0)
 ..I $P($G(^DGPT(IFN,300)),U,3)=1 D
"RTN","LREPI5",18,0)
 ...I 'LRICDX S LRICDIEN=+$$CODEN^ICDEX("482.84 ",80) D CHKICD
"RTN","LREPI5",19,0)
 ...I LRICDX F LRXCODE="A48.1","A48.2","A48.8" D
"RTN","LREPI5",20,0)
 ....S LRICDIEN=+$$CODEN^ICDEX(LRXCODE,80) D CHKICD
"RTN","LREPI5",21,0)
 ..I $D(^DGPT(IFN,70)) F LRI=10,11,16:1:24 D
"RTN","LREPI5",22,0)
 ...S LRICDIEN=$P(^DGPT(IFN,70),U,LRI) D CHKICD
"RTN","LREPI5",23,0)
 ..;SEARCH SUB FIELDS
"RTN","LREPI5",24,0)
 ..S LRMV=0 F  S LRMV=$O(^DGPT(IFN,"M",LRMV)) Q:+LRMV'>0  D
"RTN","LREPI5",25,0)
 ...I $P($G(^DGPT(IFN,"M",LRMV,300)),U,3)=1 D
"RTN","LREPI5",26,0)
 ....I 'LRICDX S LRICDIEN=+$$CODEN^ICDEX("482.84 ",80) D CHKICD
"RTN","LREPI5",27,0)
 ....I LRICDX F LRXCODE="A48.1","A48.2","A48.8" D
"RTN","LREPI5",28,0)
 .....S LRICDIEN=+$$CODEN^ICDEX(LRXCODE,80) D CHKICD
"RTN","LREPI5",29,0)
 ...I $D(^DGPT(IFN,"M",LRMV,0)) F LRI=5:1:9,11:1:15 D
"RTN","LREPI5",30,0)
 ....S LRICDIEN=$P(^DGPT(IFN,"M",LRMV,0),U,LRI) D CHKICD
"RTN","LREPI5",31,0)
 K IFN,LRMV,LRICDIEN,LRI,LRXCODE
"RTN","LREPI5",32,0)
 Q
"RTN","LREPI5",33,0)
CHKICD ;CHECK LRICDIEN CODE AND SAVE
"RTN","LREPI5",34,0)
 Q:+LRICDIEN'>0
"RTN","LREPI5",35,0)
 Q:'$D(^TMP($J,"ICD",+LRICDIEN))
"RTN","LREPI5",36,0)
 S LRPROT=$G(LRPROT,999999) S ^TMP($J,"ICDPROT",+LRICDIEN,LRPROT)=""
"RTN","LREPI5",37,0)
 S DFN=$P(^DGPT(IFN,0),U,1),ADMDT=$P(^DGPT(IFN,0),U,2)
"RTN","LREPI5",38,0)
 S LRPATH=0 F  S LRPATH=$O(^TMP($J,"ICD",+LRICDIEN,LRPATH)) Q:+LRPATH'>0  D SET
"RTN","LREPI5",39,0)
 Q
"RTN","LREPI5",40,0)
SET ;SET THE TMP GLOBAL
"RTN","LREPI5",41,0)
 S LRPROT=$P(^LAB(69.5,LRPATH,0),U,7)
"RTN","LREPI5",42,0)
 S LRCHK=0 D ADDCHK Q:LRCHK
"RTN","LREPI5",43,0)
 S:'$D(^TMP($J,LRPROT,DFN,ADMDT)) ^TMP($J,LRPROT,DFN,ADMDT)="I"_U_IFN
"RTN","LREPI5",44,0)
 S ^TMP($J,LRPROT,DFN,ADMDT,LRPATH,(9999999-ADMDT),"PTF")=IFN
"RTN","LREPI5",45,0)
 Q
"RTN","LREPI5",46,0)
ADDCHK ;DO ADDITIONAL CHECKS HERE FOR AGE AND SEX SCREENING.
"RTN","LREPI5",47,0)
 ;
"RTN","LREPI5",48,0)
 I '$G(DFN) S DFN=$G(LRPAT)
"RTN","LREPI5",49,0)
 K VADM
"RTN","LREPI5",50,0)
 I $G(DFN) D DEM^VADPT
"RTN","LREPI5",51,0)
 ;
"RTN","LREPI5",52,0)
 I $P(^LAB(69.5,LRPATH,0),U,10)'="" D
"RTN","LREPI5",53,0)
 .S LRSEX=$P(^LAB(69.5,LRPATH,0),U,10)
"RTN","LREPI5",54,0)
 .I LRSEX="O"&$P(VADM(5),U,1)="M" S LRCHK=1 Q
"RTN","LREPI5",55,0)
 .I LRSEX="O"&$P(VADM(5),U,1)="F" S LRCHK=1 Q
"RTN","LREPI5",56,0)
 .I LRSEX'=$P(VADM(5),U,1) S LRCHK=1
"RTN","LREPI5",57,0)
 I $P(^LAB(69.5,LRPATH,0),U,11)'=""!$P(^LAB(69.5,LRPATH,0),U,12)'="" D
"RTN","LREPI5",58,0)
 .S LRBEF=$P(^LAB(69.5,LRPATH,0),U,11),LRAFT=$P(^LAB(69.5,LRPATH,0),U,12)
"RTN","LREPI5",59,0)
 .I LRBEF'=""&($P(VADM(3),U,1)>LRBEF) S LRCHK=1
"RTN","LREPI5",60,0)
 .I LRAFT'=""&($P(VADM(3),U,1)<LRAFT) S LRCHK=1
"RTN","LREPI5",61,0)
 K LRBEF,LRSEX,LRAFT,VADM
"RTN","LREPI5",62,0)
 Q
"RTN","LREPICD")
0^9^B3035110^n/a
"RTN","LREPICD",1,0)
LREPICD ;ALB/TEJ - EMERGING PATHOGENS ICD UTILITIES;16 Jun 2013  5:55 PM ; 19 Jun 2013  2:37 AM
"RTN","LREPICD",2,0)
 ;;5.2;LAB SERVICE;**421**;Sep 27, 1994;Build 48
"RTN","LREPICD",3,0)
 ;
"RTN","LREPICD",4,0)
 ; ICR 5747 - $$SINFO^ICDEX API supported by this IA
"RTN","LREPICD",5,0)
 ;
"RTN","LREPICD",6,0)
ICDSYS(LREPDOS,LRICDTYP) ;
"RTN","LREPICD",7,0)
 ; Parameters
"RTN","LREPICD",8,0)
 ;  input:  LREPDOS  - date of service (REQ)
"RTN","LREPICD",9,0)
 ;          LRICDTYP - code type requested "D"iag/"P"roc)
"RTN","LREPICD",10,0)
 ;  output: LRICDSYS   - icd system for implementation
"RTN","LREPICD",11,0)
 ; e.g.  (3131001,"D")
"RTN","LREPICD",12,0)
 ;
"RTN","LREPICD",13,0)
 N LRDT,LRCTYP,LRICDSYS
"RTN","LREPICD",14,0)
 S LRDT=$G(LREPDOS),LRCTYP=$S($G(LRICDTYP)="D":"DIAG",$G(LRICDTYP)="P":"PROC",1:"")
"RTN","LREPICD",15,0)
 I LRDT']"" S LRICDSYS="-1^P1(DATE) is REQUIRED" G Q1
"RTN","LREPICD",16,0)
 I LRCTYP']"" S LRICDSYS="-1^P2(CODING_SYSTEM) is REQUIRED" G Q1
"RTN","LREPICD",17,0)
 ; Check date of interest / code type
"RTN","LREPICD",18,0)
 S LRICDSYS=$P($$SINFO^ICDEX(LRCTYP,LRDT),U,3)
"RTN","LREPICD",19,0)
Q1 Q LRICDSYS
"RTN","LREPICD",20,0)
ICDCONVT ; Convert File #69.5 "ICD-9" text entries to "ICD"
"RTN","LREPICD",21,0)
 ;
"RTN","LREPICD",22,0)
 K LREPI695
"RTN","LREPICD",23,0)
 S LREPI695=0 F  S LREPI695=$O(^LAB(69.5,LREPI695)) Q:+LREPI695=0  D
"RTN","LREPICD",24,0)
 .K LREPITXT S LREPIX=$$GET1^DIQ(69.5,LREPI695_",",15,"","LREPITXT") F LRX=1:1 Q:'$D(^LAB(69.5,LREPI695,8,LRX,0))  D
"RTN","LREPICD",25,0)
 ..S LRTXT=@(LREPIX_"("_LRX_")") D:(LRTXT["ICDM-9")!(LRTXT["ICD-9")
"RTN","LREPICD",26,0)
 ...L +^LAB(69.5,LREPI695):999
"RTN","LREPICD",27,0)
 ...S LRP=$S(LRTXT["ICDM-9":"ICDM-9",1:"ICD-9"),^LAB(69.5,LREPI695,8,LRX,0)=$P(LRTXT,LRP)_"ICD"_$P(LRTXT,LRP,2) W !,^LAB(69.5,LREPI695,8,LRX,0)
"RTN","LREPICD",28,0)
 ...L -^LAB(69.5,LREPI695)
"RTN","LREPICD",29,0)
Q2 K LREPIX,LRP,LRTXT,LRX Q
"RTN","LREPICD",30,0)
 ;
"RTN","LREPIPI")
0^4^B21641423^B12589955
"RTN","LREPIPI",1,0)
LREPIPI ;DALOI/CKA - Local Pathogens Input ;19 Jul 2013  4:06 PM
"RTN","LREPIPI",2,0)
 ;;5.2;LAB SERVICE;**281,421**;Sep 27, 1994;Build 48
"RTN","LREPIPI",3,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","LREPIPI",4,0)
 ; Reference to ^ORD(101 supported by IA #872
"RTN","LREPIPI",5,0)
 ; Reference to $$CSI^ICDEX supported by IA #5747
"RTN","LREPIPI",6,0)
 ;
"RTN","LREPIPI",7,0)
EN ;
"RTN","LREPIPI",8,0)
 ;
"RTN","LREPIPI",9,0)
 S LRNO="",SITE=$P($$SITE^VASITE,U)
"RTN","LREPIPI",10,0)
LKUP ;
"RTN","LREPIPI",11,0)
 I $G(XQY0)["PARAMETER SETUP" D PARLKUP G:$D(DTOUT)!($D(DUOUT))!($G(Y)=-1) EXIT G EN
"RTN","LREPIPI",12,0)
 S DIR(0)="FO^3:30",DIR("A")="LOCAL PATHOGEN NAME",DIR("?")="Enter the name of the local pathogen [3-30 characters].  You may also enter part of the name for look up purposes."
"RTN","LREPIPI",13,0)
 S DIR("??")="^S D=""B"",DIC=""^LAB(69.5,"",DIC(0)=""AEMZ"",DIC(""S"")=""I (Y>99)"" D DQ^DICQ K DIC"
"RTN","LREPIPI",14,0)
 D ^DIR K DIR I $D(DIRUT) G EXIT
"RTN","LREPIPI",15,0)
 S LRX=Y
"RTN","LREPIPI",16,0)
 S DIC="^LAB(69.5,",DIC("S")="I Y>99",DIC(0)="EMZ" D ^DIC K DIC S LREPIFN=+Y
"RTN","LREPIPI",17,0)
 I $G(LRDEL) Q
"RTN","LREPIPI",18,0)
 I Y="" D EXIT G EN
"RTN","LREPIPI",19,0)
 I $D(DTOUT) G NOU
"RTN","LREPIPI",20,0)
 I Y'<0 D FND
"RTN","LREPIPI",21,0)
 I Y<0 D ADD D EXIT G EN
"RTN","LREPIPI",22,0)
 G:$G(Y)["^"!($D(DTOUT)) NOU
"RTN","LREPIPI",23,0)
 G:LRNO EN D:LRY EDIT G EN
"RTN","LREPIPI",24,0)
 G EN
"RTN","LREPIPI",25,0)
 Q
"RTN","LREPIPI",26,0)
 ;
"RTN","LREPIPI",27,0)
ADD ;
"RTN","LREPIPI",28,0)
 I $G(LROPTION)="LREPI PARAMETER SETUP" D  I $D(DIRUT) D EXIT Q
"RTN","LREPIPI",29,0)
 .S DIR(0)="E",DIR("A")="Press the return key to continue or '^' to exit"
"RTN","LREPIPI",30,0)
 .S DIR("A",1)="Local Pathogen(s) cannot be added with this option." D ^DIR
"RTN","LREPIPI",31,0)
 .Q
"RTN","LREPIPI",32,0)
 S DIR(0)="Y",DIR("A")="Do you want to add this local pathogen",DIR("B")="YES" D ^DIR G:$D(DTOUT) NOU K DIR
"RTN","LREPIPI",33,0)
 I 'Y Q
"RTN","LREPIPI",34,0)
 S LRNUM=99
"RTN","LREPIPI",35,0)
 F  S LRNUM1=$O(^LAB(69.5,LRNUM)) Q:'LRNUM1  S LRNUM=LRNUM+1
"RTN","LREPIPI",36,0)
 S LRDA=LRNUM+1
"RTN","LREPIPI",37,0)
 K DD,DO
"RTN","LREPIPI",38,0)
 S DIC="^LAB(69.5,"
"RTN","LREPIPI",39,0)
 S DIC(0)="L"
"RTN","LREPIPI",40,0)
 S DLAYGO=69.5
"RTN","LREPIPI",41,0)
 S DINUM=LRDA
"RTN","LREPIPI",42,0)
 S X=LRX_SITE
"RTN","LREPIPI",43,0)
 D FILE^DICN
"RTN","LREPIPI",44,0)
 I Y=-1 D NOU G EN
"RTN","LREPIPI",45,0)
 S $P(^LAB(69.5,LRDA,0),U,2)=0
"RTN","LREPIPI",46,0)
 S $P(^LAB(69.5,LRDA,0),U,9)=LRDA
"RTN","LREPIPI",47,0)
 S LRPROT=0,LRPROT=$O(^ORD(101,"B","LREPI",LRPROT))
"RTN","LREPIPI",48,0)
 S $P(^LAB(69.5,LRDA,0),U,7)=LRPROT
"RTN","LREPIPI",49,0)
 S LREPIFN=LRDA
"RTN","LREPIPI",50,0)
EDIT S DA=LREPIFN
"RTN","LREPIPI",51,0)
 I $D(^LAB(69.5,DA,3,"B")) D
"RTN","LREPIPI",52,0)
 .S LRINT=0
"RTN","LREPIPI",53,0)
 .F  S LRINT=$O(^LAB(69.5,DA,3,"B",LRINT)) Q:+LRINT=0  D
"RTN","LREPIPI",54,0)
 ..S LRTMP=$$ICDDATA^ICDXCODE($$CSI^ICDEX(80,LRINT),LRINT,,)
"RTN","LREPIPI",55,0)
 ..Q:LRTMP'>0
"RTN","LREPIPI",56,0)
 ..S DIE="^LAB(69.5,"_DA_",3,",DR="1////"_$P(LRTMP,U,20) D ^DIE
"RTN","LREPIPI",57,0)
 K DIE,LRINT,LRTMP
"RTN","LREPIPI",58,0)
 S LRDAICD=0 F  S LRDAICD=$O(^LAB(69.5,DA,3,LRDAICD)) Q:'LRDAICD  D
"RTN","LREPIPI",59,0)
 . I $P(^LAB(69.5,DA,3,LRDAICD,0),U,1)="" D
"RTN","LREPIPI",60,0)
 .. K ^LAB(69.5,DA,3,LRDAICD,0)
"RTN","LREPIPI",61,0)
 S DLAYGO=69.5,DDSFILE="^LAB(69.5,"
"RTN","LREPIPI",62,0)
 S DR="[LREPI9]"
"RTN","LREPIPI",63,0)
 D ^DDS
"RTN","LREPIPI",64,0)
 K DDSFILE(1)
"RTN","LREPIPI",65,0)
 W !!
"RTN","LREPIPI",66,0)
 S LRDAICD=0 F  S LRDAICD=$O(^LAB(69.5,DA,3,LRDAICD)) Q:'LRDAICD  D
"RTN","LREPIPI",67,0)
 . N LRCODSET S LRCODSET=$$CSI^ICDEX(80,$P(^LAB(69.5,DA,3,LRDAICD,0),U))
"RTN","LREPIPI",68,0)
 . S $P(^LAB(69.5,DA,3,LRDAICD,0),U,2)=LRCODSET
"RTN","LREPIPI",69,0)
 D EXIT
"RTN","LREPIPI",70,0)
 Q
"RTN","LREPIPI",71,0)
EXIT K ^TMP("ICDEXLK",$J),DA,DD,DDSFILE,DLAYGO,DIC,DIK,DINUM,DIR,DIRUT,DO,DR,DTOUT,DUOUT,L,LRDA,LRDEL,LRDAICD,LRNO,LRNUM,LRNUM1,LREPIFN,LRPROT,LRX,LRXX,LRY,SITE,X,Y Q
"RTN","LREPIPI",72,0)
FND W !,"This pathogen is already entered as a local pathogen.",!
"RTN","LREPIPI",73,0)
 S DIC="^LAB(69.5,",DA=+Y,DR="0:6;8:9" D EN^DIQ
"RTN","LREPIPI",74,0)
 S DIR(0)="Y",DIR("A")="Is this the correct one" D ^DIR K DIR
"RTN","LREPIPI",75,0)
 I 'Y S LRNO=1 W !! Q
"RTN","LREPIPI",76,0)
YN1 S DIR(0)="Y",DIR("A")="Do you want to edit this local pathogen",DIR("B")="NO"
"RTN","LREPIPI",77,0)
 D ^DIR
"RTN","LREPIPI",78,0)
 K DIR
"RTN","LREPIPI",79,0)
 S LRY=Y
"RTN","LREPIPI",80,0)
 W !! Q
"RTN","LREPIPI",81,0)
 Q
"RTN","LREPIPI",82,0)
NOU W !!,$C(7),?20,"NO UPDATING HAS OCCURRED!!!" K DIR G:$D(DTOUT) EXIT W !! G EN
"RTN","LREPIPI",83,0)
DELETE ;DELETE LOCAL PATHOGEN
"RTN","LREPIPI",84,0)
 S LRDEL=1
"RTN","LREPIPI",85,0)
 D EN
"RTN","LREPIPI",86,0)
 I '$D(Y) G EXIT
"RTN","LREPIPI",87,0)
 S LRXX=Y
"RTN","LREPIPI",88,0)
 G:$D(DTOUT)!($D(DUOUT))!(Y="") EXIT
"RTN","LREPIPI",89,0)
 S DIC="^LAB(69.5,"
"RTN","LREPIPI",90,0)
 S DIC(0)="EMZ"
"RTN","LREPIPI",91,0)
 S DIC("S")="I $P(^(0),U,9)>99"
"RTN","LREPIPI",92,0)
 D ^DIC
"RTN","LREPIPI",93,0)
 K DIC
"RTN","LREPIPI",94,0)
 I Y=-1 W !,"NO MATCH FOUND." G DELETE
"RTN","LREPIPI",95,0)
 S LRY=Y
"RTN","LREPIPI",96,0)
 S DIR(0)="Y",DIR("A")="Do you really want to delete this pathogen"
"RTN","LREPIPI",97,0)
 D ^DIR
"RTN","LREPIPI",98,0)
 K DIR
"RTN","LREPIPI",99,0)
 G:$D(DTOUT)!($D(DUOUT)) EXIT
"RTN","LREPIPI",100,0)
 I 'Y G DELETE
"RTN","LREPIPI",101,0)
 I LRY>99 S DA=+LRY D KILL G DELETE
"RTN","LREPIPI",102,0)
 G DELETE
"RTN","LREPIPI",103,0)
 ;
"RTN","LREPIPI",104,0)
KILL S DIK="^LAB(69.5,"
"RTN","LREPIPI",105,0)
 D ^DIK
"RTN","LREPIPI",106,0)
 W !!,"Entry ",$P(LRY,U,2)," deleted."
"RTN","LREPIPI",107,0)
 K DIK
"RTN","LREPIPI",108,0)
 Q
"RTN","LREPIPI",109,0)
INQUIRY S DIC="^LAB(69.5,",DIC("A")="Select Pathogen: ",DIC(0)="AEMQ" D ^DIC K DIC
"RTN","LREPIPI",110,0)
 I Y<0 K DIC,DA,D0,DR,Y Q
"RTN","LREPIPI",111,0)
INQ1 S DIC="^LAB(69.5,",DA=+Y,DR="0:6" D EN^DIQ
"RTN","LREPIPI",112,0)
 D PAUSE^LREPIRS2
"RTN","LREPIPI",113,0)
 I $G(LRQUIT) K DIC,DA,D0,DR,LRQUIT,Y Q
"RTN","LREPIPI",114,0)
 S DR="8:9" D EN^DIQ
"RTN","LREPIPI",115,0)
 K DIC,DA,DO,DR,LRQUIT,Y
"RTN","LREPIPI",116,0)
 G INQUIRY
"RTN","LREPIPI",117,0)
PRINT S L=0,DIC="^LAB(69.5,"
"RTN","LREPIPI",118,0)
 D EN1^DIP
"RTN","LREPIPI",119,0)
 Q
"RTN","LREPIPI",120,0)
 ;
"RTN","LREPIPI",121,0)
DFLT() N LRDATE D NOW^%DTC S LRDATE=X
"RTN","LREPIPI",122,0)
 Q $S(LRDATE'<$$IMPDATE^LEXU("10D"):30,1:1)
"RTN","LREPIPI",123,0)
PARLKUP ;
"RTN","LREPIPI",124,0)
 S DIC("S")="I (Y<100)",DIC="^LAB(69.5,",DIC(0)="AEMQ" D ^DIC K DIC S LREPIFN=+Y
"RTN","LREPIPI",125,0)
 Q:$D(DTOUT)!($D(DUOUT))!(Y=-1)
"RTN","LREPIPI",126,0)
 D EDIT
"RTN","LREPIPI",127,0)
 Q
"RTN","LREPIRP3")
0^12^B78340966^B78489594
"RTN","LREPIRP3",1,0)
LREPIRP3 ;DALOI/CKA - EMERGING PATHOGENS HL7 REPORT CONVERSION ;23 Apr 2013  4:32 PM
"RTN","LREPIRP3",2,0)
 ;;5.2;LAB SERVICE;**281,421**;Sep 27, 1994;Build 48
"RTN","LREPIRP3",3,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","LREPIRP3",4,0)
 ; Reference to ^DIC(21 supported by IA #2504
"RTN","LREPIRP3",5,0)
 Q
"RTN","LREPIRP3",6,0)
 ;NTE findings of 11, 12, 13, or 14.
"RTN","LREPIRP3",7,0)
 ;SAVE PID, PV1, and DG1 data.
"RTN","LREPIRP3",8,0)
 Q
"RTN","LREPIRP3",9,0)
PID ;
"RTN","LREPIRP3",10,0)
 D PID^LREPIRP2
"RTN","LREPIRP3",11,0)
PV1 ;
"RTN","LREPIRP3",12,0)
 D PV1^LREPIRP2
"RTN","LREPIRP3",13,0)
DG1 ;Save DG1 data
"RTN","LREPIRP3",14,0)
 ;^XTMP("LREPIREP"_date,PATHOGEN,dfn,"PV1",#,"DG1",#)
"RTN","LREPIRP3",15,0)
 Q
"RTN","LREPIRP3",16,0)
HDG ;Save title heading in ^XTMP("LREPIREP"_date,"HDG",linecount)
"RTN","LREPIRP3",17,0)
 S SITE=$$SITE^VASITE
"RTN","LREPIRP3",18,0)
 S LRDTHDG=^TMP("LREPIREP",$J,1)
"RTN","LREPIRP3",19,0)
 S MSG=$E(LRSP,1,15)_"DETAILED VERIFICATION REPORT OF EPI EXTRACTED DATA"
"RTN","LREPIRP3",20,0)
 S ^XTMP("LREPIREP"_LRDATE,"HDG",1)=MSG
"RTN","LREPIRP3",21,0)
 S MSG=$E(LRSP,1,80-$L(" FROM STATION "_$P(SITE,U,3)_" "_$P(SITE,U,2))/2)_" FROM STATION "_$P(SITE,U,3)_" "_$P(SITE,U,2)
"RTN","LREPIRP3",22,0)
 S ^XTMP("LREPIREP"_LRDATE,"HDG",2)=MSG
"RTN","LREPIRP3",23,0)
 S MSG="PROCESSING PERIOD: "
"RTN","LREPIRP3",24,0)
 S Y=$$CDT^LREPIRP2($P($P($P(LRDTHDG,HLFS,3),LRCS,2)," ",4))
"RTN","LREPIRP3",25,0)
 S MSG=MSG_Y
"RTN","LREPIRP3",26,0)
 S Y=$$CDT^LREPIRP2($P($P($P(LRDTHDG,HLFS,3),LRCS,2)," ",6))
"RTN","LREPIRP3",27,0)
 S LRHDGL2=MSG_"  through "_Y
"RTN","LREPIRP3",28,0)
 S ^XTMP("LREPIREP"_LRDATE,"HDG",3)=$E(LRSP,1,80-$L(LRHDGL2)/2)_LRHDGL2
"RTN","LREPIRP3",29,0)
 ;Save Heading info in ^XTMP("LREPIREP"_date,nte,"HDG",linecount)
"RTN","LREPIRP3",30,0)
NTE11 ;NTE~11 Report of Malaria heading
"RTN","LREPIRP3",31,0)
 S ^XTMP("LREPIREP"_LRDATE,11,"HDG",1)="NTE~11-Report of Malaria"
"RTN","LREPIRP3",32,0)
 S MSG="These data note persons at your facility during the month who had an ICD"
"RTN","LREPIRP3",33,0)
 S ^XTMP("LREPIREP"_LRDATE,11,"HDG",2)=MSG
"RTN","LREPIRP3",34,0)
 S MSG="coded diagnosis for malaria.  Identifying information has been provided."
"RTN","LREPIRP3",35,0)
 S ^XTMP("LREPIREP"_LRDATE,11,"HDG",3)=MSG
"RTN","LREPIRP3",36,0)
NTE12 ;NTE~12 Report of Dengue heading
"RTN","LREPIRP3",37,0)
 S MSG="NTE~12-Report of Dengue"
"RTN","LREPIRP3",38,0)
 S ^XTMP("LREPIREP"_LRDATE,12,"HDG",1)=MSG
"RTN","LREPIRP3",39,0)
 S MSG="These data note persons at your facility during the month who had an ICD"
"RTN","LREPIRP3",40,0)
 S ^XTMP("LREPIREP"_LRDATE,12,"HDG",2)=MSG
"RTN","LREPIRP3",41,0)
 S MSG="coded diagnosis for dengue.  Identifying information has been provided."
"RTN","LREPIRP3",42,0)
 S ^XTMP("LREPIREP"_LRDATE,12,"HDG",3)=MSG
"RTN","LREPIRP3",43,0)
NTE13 ;NTE~13 Report of Creutzfeldt-Jakob Disease heading
"RTN","LREPIRP3",44,0)
 S MSG="NTE~13-Report of Creutzfeldt-Jakob Disease"
"RTN","LREPIRP3",45,0)
 S ^XTMP("LREPIREP"_LRDATE,13,"HDG",1)=MSG
"RTN","LREPIRP3",46,0)
 S MSG="These data note persons at your facility during the month who had an ICD"
"RTN","LREPIRP3",47,0)
 S ^XTMP("LREPIREP"_LRDATE,13,"HDG",2)=MSG
"RTN","LREPIRP3",48,0)
 S MSG="coded diagnosis for Creutzfeldt-Jakob disease.  Identifying information has been provided."
"RTN","LREPIRP3",49,0)
 S ^XTMP("LREPIREP"_LRDATE,13,"HDG",3)=MSG
"RTN","LREPIRP3",50,0)
NTE14 ;NTE~14 Report of Leishmaniasis heading
"RTN","LREPIRP3",51,0)
 S MSG="NTE~14-Report of Leishmaniasis"
"RTN","LREPIRP3",52,0)
 S ^XTMP("LREPIREP"_LRDATE,14,"HDG",1)=MSG
"RTN","LREPIRP3",53,0)
 S MSG="These data note persons at your facility during the month who had an ICD"
"RTN","LREPIRP3",54,0)
 S ^XTMP("LREPIREP"_LRDATE,14,"HDG",2)=MSG
"RTN","LREPIRP3",55,0)
 S MSG="coded diagnosis for Leishmania.  Identifying information has been provided."
"RTN","LREPIRP3",56,0)
 S ^XTMP("LREPIREP"_LRDATE,14,"HDG",3)=MSG
"RTN","LREPIRP3",57,0)
FOOT ;FOOTER FOR NTE 11,12,13,14
"RTN","LREPIRP3",58,0)
 S MSG="Initally, only inpatient cases will be captured; however, eventually it is"
"RTN","LREPIRP3",59,0)
 S ^XTMP("LREPIREP"_LRDATE,"FOOTNOTE",1)=MSG
"RTN","LREPIRP3",60,0)
 S MSG="anticiapted that this will include outpatient cases also."
"RTN","LREPIRP3",61,0)
 S ^XTMP("LREPIREP"_LRDATE,"FOOTNOTE",2)=MSG
"RTN","LREPIRP3",62,0)
NTE7 ;NTE~7 Report of Legionella/Legionaire's heading
"RTN","LREPIRP3",63,0)
 S MSG="NTE~7- Report of Legionella/Legionaire's"
"RTN","LREPIRP3",64,0)
 S ^XTMP("LREPIREP"_LRDATE,7,"HDG",1)=MSG
"RTN","LREPIRP3",65,0)
 S MSG="These data note persons at your facility during the month who had an EITHER an"
"RTN","LREPIRP3",66,0)
 S ^XTMP("LREPIREP"_LRDATE,7,"HDG",2)=MSG
"RTN","LREPIRP3",67,0)
 S MSG="ICD coded diagnosis for Legionella/Legionaire's disease OR a positive"
"RTN","LREPIRP3",68,0)
 S ^XTMP("LREPIREP"_LRDATE,7,"HDG",3)=MSG
"RTN","LREPIRP3",69,0)
 S MSG="culture result.  Identifying information, along with specimen and culture"
"RTN","LREPIRP3",70,0)
 S ^XTMP("LREPIREP"_LRDATE,7,"HDG",4)=MSG
"RTN","LREPIRP3",71,0)
 S ^XTMP("LREPIREP"_LRDATE,7,"HDG",5)="results have been provided."
"RTN","LREPIRP3",72,0)
NTE9 ;NTE~9 Report of Cryptosporidium heading
"RTN","LREPIRP3",73,0)
 S MSG="NTE~9-Report of Cryptosporidium"
"RTN","LREPIRP3",74,0)
 S ^XTMP("LREPIREP"_LRDATE,9,"HDG",1)=MSG
"RTN","LREPIRP3",75,0)
 S MSG="These data note persons at your facility during the month who had EITHER an"
"RTN","LREPIRP3",76,0)
 S ^XTMP("LREPIREP"_LRDATE,9,"HDG",2)=MSG
"RTN","LREPIRP3",77,0)
 S MSG="ICD coded diagnosis for Cryptosporidium OR a positive culture result."
"RTN","LREPIRP3",78,0)
 S ^XTMP("LREPIREP"_LRDATE,9,"HDG",3)=MSG
"RTN","LREPIRP3",79,0)
 S ^XTMP("LREPIREP"_LRDATE,9,"HDG",4)="Identifying information, along with specimen and culture results have been"
"RTN","LREPIRP3",80,0)
 S ^XTMP("LREPIREP"_LRDATE,9,"HDG",5)="provided."
"RTN","LREPIRP3",81,0)
 ;
"RTN","LREPIRP3",82,0)
NTE2 ;NTE 2 HEP C ANTIBODY POSITIVE HEADING
"RTN","LREPIRP3",83,0)
 S ^XTMP("LREPIREP"_LRDATE,2,"HDG",1)="NTE~2 Report of Hepatitis C antibody positive"
"RTN","LREPIRP3",84,0)
 S ^XTMP("LREPIREP"_LRDATE,2,"HDG",2)="This represents a line listing of persons reported during the month who had a"
"RTN","LREPIRP3",85,0)
 S ^XTMP("LREPIREP"_LRDATE,2,"HDG",3)="positive test for hepatitis C antibody (based on accession date and not"
"RTN","LREPIRP3",86,0)
 S ^XTMP("LREPIREP"_LRDATE,2,"HDG",4)="results reported date).  Definitions for data to be extracted are provided"
"RTN","LREPIRP3",87,0)
 S ^XTMP("LREPIREP"_LRDATE,2,"HDG",5)="in Technical and User Guide documentation for Laboratory EPI LR*5.2*281."
"RTN","LREPIRP3",88,0)
NTE15 ;NTE 15 HEP C ANTIBODY NEGATIVE HEADING
"RTN","LREPIRP3",89,0)
 S ^XTMP("LREPIREP"_LRDATE,15,"HDG",1)="NTE~15 Report of Hepatitis C antibody negative"
"RTN","LREPIRP3",90,0)
 S ^XTMP("LREPIREP"_LRDATE,15,"HDG",2)="This represents a line listing of persons reported during the month who had a"
"RTN","LREPIRP3",91,0)
 S ^XTMP("LREPIREP"_LRDATE,15,"HDG",3)="negative test for hepatitis C antibody (based on accession date and not"
"RTN","LREPIRP3",92,0)
 S ^XTMP("LREPIREP"_LRDATE,15,"HDG",4)="results reported date).  Definitions for data to be extracted are provided"
"RTN","LREPIRP3",93,0)
 S ^XTMP("LREPIREP"_LRDATE,15,"HDG",5)="in Technical and User Guide documentation for Laboratory EPI LR*5.2*281."
"RTN","LREPIRP3",94,0)
NTE16 ;NTE~16 HEP A ANTIBODY POSITIVE HEADINGS
"RTN","LREPIRP3",95,0)
 S ^XTMP("LREPIREP"_LRDATE,16,"HDG",1)="NTE~16 Report of Hepatitis A antibody positive"
"RTN","LREPIRP3",96,0)
 S ^XTMP("LREPIREP"_LRDATE,16,"HDG",2)="This represents a line listing of persons reported during the month who had a"
"RTN","LREPIRP3",97,0)
 S ^XTMP("LREPIREP"_LRDATE,16,"HDG",3)="positive test for hepatitis A antibody (based on accession date and not"
"RTN","LREPIRP3",98,0)
 S ^XTMP("LREPIREP"_LRDATE,16,"HDG",4)="results reported date).  Definitions for data to be extracted are provided"
"RTN","LREPIRP3",99,0)
 S ^XTMP("LREPIREP"_LRDATE,16,"HDG",5)="in Technical and User Guide documentation for Laboratory EPI LR*5.2*281."
"RTN","LREPIRP3",100,0)
NTE17 ;NTE~17 HEP B POSITIVE HEADING
"RTN","LREPIRP3",101,0)
 S ^XTMP("LREPIREP"_LRDATE,17,"HDG",1)="NTE~17 Report of Hepatitis B positive"
"RTN","LREPIRP3",102,0)
 S ^XTMP("LREPIREP"_LRDATE,17,"HDG",2)="This represents a line listing of persons reported during the month who had a"
"RTN","LREPIRP3",103,0)
 S ^XTMP("LREPIREP"_LRDATE,17,"HDG",3)="positive test for hepatitis B (based on accession date and not results"
"RTN","LREPIRP3",104,0)
 S ^XTMP("LREPIREP"_LRDATE,17,"HDG",4)="reported date).  Definitions for data to be extracted are provided in"
"RTN","LREPIRP3",105,0)
 S ^XTMP("LREPIREP"_LRDATE,17,"HDG",5)="Technical and User Guide documentation for Laboratory EPI LR*5.2*281."
"RTN","LREPIRP3",106,0)
UPD ;UPDATES HEADING
"RTN","LREPIRP3",107,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",1)="UPDATES"
"RTN","LREPIRP3",108,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",2)="This section presents patients who had a transmission of information during a"
"RTN","LREPIRP3",109,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",3)="month on an EPI defined topic that was incomplete.  These patients have"
"RTN","LREPIRP3",110,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",4)="information that has been transmitted during the current processing month in"
"RTN","LREPIRP3",111,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",5)="order to complete the EPI files.  This information usually contains inpatient"
"RTN","LREPIRP3",112,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",6)="information about discharge date, ICD coded diagnoses and occasionally will"
"RTN","LREPIRP3",113,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",7)="contain laboratory based testing.  This line listing of patient, SSN, and"
"RTN","LREPIRP3",114,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",8)="admission date and discharge date is provided to assist with analysis should"
"RTN","LREPIRP3",115,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",9)="an processing/error report occur with your monthly automated transmission of"
"RTN","LREPIRP3",116,0)
 S ^XTMP("LREPIREP"_LRDATE,"UPDHDG",10)="this data."
"RTN","LREPIRP3",117,0)
PHARM ;PHARMACY DATA HEADINGS
"RTN","LREPIRP3",118,0)
 S ^XTMP("LREPIREP"_LRDATE,"PHHDG",1)="Pharmacy-based data extracted for EPI data base."
"RTN","LREPIRP3",119,0)
HEPC ;HEP C RISK ASSESSMENT HEADING
"RTN","LREPIRP3",120,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",1)="Detailed Listing of Hepatitis C Risk Assessment"
"RTN","LREPIRP3",121,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",2)="These Health factors/Resolved terms for hepatitis C risk assessment are the"
"RTN","LREPIRP3",122,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",3)="national Health factors used for roll-up of risk assessment data.  They may not"
"RTN","LREPIRP3",123,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",4)="reflect the terms actually utilized (seen) in the Clinical Reminder package at"
"RTN","LREPIRP3",124,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",5)="this facility.  To determine which local/facility Clinical Reminder health"
"RTN","LREPIRP3",125,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",6)="factor(s) correspond(s) to the national term, please contact your facility"
"RTN","LREPIRP3",126,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",7)="Clinical Reminder application coordinator.  Note that hepatitis C infection"
"RTN","LREPIRP3",127,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",8)="is based on a previously ICD coded diagnosis of hepatitis C at your site/"
"RTN","LREPIRP3",128,0)
 S ^XTMP("LREPIREP"_LRDATE,"HEPCHDG",9)="facility."
"RTN","LREPIRP3",129,0)
 Q
"RTN","LREPIRP5")
0^13^B38416569^B38435100
"RTN","LREPIRP5",1,0)
LREPIRP5 ;DALOI/CKA - EMERGING PATHOGENS HL7 REPORT CONVERSION ;23 Apr 2013  4:33 PM
"RTN","LREPIRP5",2,0)
 ;;5.2;LAB SERVICE;**281,320,421**;Sep 27, 1994;Build 48
"RTN","LREPIRP5",3,0)
 Q
"RTN","LREPIRP5",4,0)
SUMMARY ;BUILD SUMMARY REPORT
"RTN","LREPIRP5",5,0)
 ; BUILD SUMMARY INFO
"RTN","LREPIRP5",6,0)
 F LRPATH=1:1:23 S LRTOT(LRPATH)=0
"RTN","LREPIRP5",7,0)
 S LRPATH=0
"RTN","LREPIRP5",8,0)
 F  S LRPATH=$O(^XTMP("LREPIREP"_LRDATE,"TOTAL",LRPATH)) Q:LRPATH=""  D
"RTN","LREPIRP5",9,0)
 .S LRTOT(LRPATH)=^XTMP("LREPIREP"_LRDATE,"TOTAL",LRPATH)
"RTN","LREPIRP5",10,0)
 S MSG="NTE~1-Vancomycin-resistant Enterococcus"
"RTN","LREPIRP5",11,0)
 S MSG=MSG_$E(LRSP,1,17)_$J($P(LRTOT(1),U),5)_"   "_$J($P(LRTOT(1),U,2),5)
"RTN","LREPIRP5",12,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",13,0)
 S MSG="NTE~2-Hepatitis C antibody Positive"
"RTN","LREPIRP5",14,0)
 S MSG=MSG_$E(LRSP,1,21)_$J($P(LRTOT(2),U),5)_"   "_$J($P(LRTOT(2),U,2),5)
"RTN","LREPIRP5",15,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",16,0)
 S MSG="NTE~3-Penicillin-Resistant Streptococcus pneumoniae"
"RTN","LREPIRP5",17,0)
 S MSG=MSG_$E(LRSP,1,5)_$J($P(LRTOT(3),U),5)_"   "_$J($P(LRTOT(3),U,2),5)
"RTN","LREPIRP5",18,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",19,0)
 S MSG="NTE~4-Clostridium difficile"
"RTN","LREPIRP5",20,0)
 S MSG=MSG_$E(LRSP,1,29)_$J($P(LRTOT(4),U),5)_"   "_$J($P(LRTOT(4),U,2),5)
"RTN","LREPIRP5",21,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",22,0)
 S MSG="NTE~5-Tuberculosis"
"RTN","LREPIRP5",23,0)
 S MSG=MSG_LRSP_$E(LRSP,1,8)_$J($P(LRTOT(5),U),5)_"   "_$J($P(LRTOT(5),U,2),5)
"RTN","LREPIRP5",24,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",25,0)
 S MSG="NTE~6-Streptococcus, Group A"
"RTN","LREPIRP5",26,0)
 S MSG=MSG_$E(LRSP,1,28)_$J($P(LRTOT(6),U),5)_"   "_$J($P(LRTOT(6),U,2),5)
"RTN","LREPIRP5",27,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",28,0)
 S MSG="NTE~7-Legionella/Legionaire's Disease"
"RTN","LREPIRP5",29,0)
 S MSG=MSG_$E(LRSP,1,19)_$J($P(LRTOT(7),U),5)_"   "_$J($P(LRTOT(7),U,2),5)
"RTN","LREPIRP5",30,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",31,0)
 S MSG="NTE~8-Candida bloodstream infections"
"RTN","LREPIRP5",32,0)
 S MSG=MSG_$E(LRSP,1,20)_$J($P(LRTOT(8),U),5)_"   "_$J($P(LRTOT(8),U,2),5)
"RTN","LREPIRP5",33,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",34,0)
 S MSG="NTE~9-Crytosporidium"
"RTN","LREPIRP5",35,0)
 S MSG=MSG_LRSP_$E(LRSP,1,6)_$J($P(LRTOT(9),U),5)_"   "_$J($P(LRTOT(9),U,2),5)
"RTN","LREPIRP5",36,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",37,0)
 S MSG="NTE~10-Escherichia coli O157"
"RTN","LREPIRP5",38,0)
 S MSG=MSG_$E(LRSP,1,28)_$J($P(LRTOT(10),U),5)_"   "_$J($P(LRTOT(10),U,2),5)
"RTN","LREPIRP5",39,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",40,0)
 S MSG="NTE~11-Malaria"
"RTN","LREPIRP5",41,0)
 S MSG=MSG_LRSP_$E(LRSP,1,12)_$J($P(LRTOT(11),U),5)_"   "_$J($P(LRTOT(11),U,2),5)
"RTN","LREPIRP5",42,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",43,0)
 S MSG="NTE~12-Dengue"
"RTN","LREPIRP5",44,0)
 S MSG=MSG_LRSP_$E(LRSP,1,13)_$J($P(LRTOT(12),U),5)_"   "_$J($P(LRTOT(12),U,2),5)
"RTN","LREPIRP5",45,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",46,0)
 S MSG="NTE~13-Creutzfeldt-Jakob Disease"
"RTN","LREPIRP5",47,0)
 S MSG=MSG_$E(LRSP,1,24)_$J($P(LRTOT(13),U),5)_"   "_$J($P(LRTOT(13),U,2),5)
"RTN","LREPIRP5",48,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",49,0)
 S MSG="NTE~14-Leishmaniasis"
"RTN","LREPIRP5",50,0)
 S MSG=MSG_LRSP_$E(LRSP,1,6)_$J($P(LRTOT(14),U),5)_"   "_$J($P(LRTOT(14),U,2),5)
"RTN","LREPIRP5",51,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",52,0)
 S MSG="NTE~15-Hepatitis C antibody negative"
"RTN","LREPIRP5",53,0)
 S MSG=MSG_$E(LRSP,1,20)_$J($P(LRTOT(15),U),5)_"   "_$J($P(LRTOT(15),U,2),5)
"RTN","LREPIRP5",54,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",55,0)
 S MSG="NTE~16-Hepatitis A antibody positive"
"RTN","LREPIRP5",56,0)
 S MSG=MSG_$E(LRSP,1,20)_$J($P(LRTOT(16),U),5)_"   "_$J($P(LRTOT(16),U,2),5)
"RTN","LREPIRP5",57,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",58,0)
 S MSG="NTE~17-Hepatitis B positive"
"RTN","LREPIRP5",59,0)
 S MSG=MSG_$E(LRSP,1,29)_$J($P(LRTOT(17),U),5)_"   "_$J($P(LRTOT(17),U,2),5)
"RTN","LREPIRP5",60,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",61,0)
 S MSG="NTE~18-All Staphylococcus Aureus"
"RTN","LREPIRP5",62,0)
 S MSG=MSG_$E(LRSP,1,24)_$J($P(LRTOT(18),U),5)_"   "_$J($P(LRTOT(18),U,2),5)
"RTN","LREPIRP5",63,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",64,0)
 S MSG="NTE~19-Methicillin-Resistant Staphylococcus Aureus (Mrsa)"
"RTN","LREPIRP5",65,0)
 S MSG=MSG_$J($P(LRTOT(19),U),4)_"   "_$J($P(LRTOT(19),U,2),5)
"RTN","LREPIRP5",66,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",67,0)
 S MSG="NTE~20-Vancomycin-Resistant Staphylococcus Aureus (Vrsa)"
"RTN","LREPIRP5",68,0)
 S MSG=MSG_$J($P(LRTOT(20),U),5)_"   "_$J($P(LRTOT(20),U,2),5)
"RTN","LREPIRP5",69,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",70,0)
 S MSG="NTE~21-Vancomycin-Resistant Coagulase Negative"
"RTN","LREPIRP5",71,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",72,0)
 S MSG="       Staphylococci/Staph EPI (Vrse)"
"RTN","LREPIRP5",73,0)
 S MSG=MSG_$E(LRSP,1,19)_$J($P(LRTOT(21),U),5)_"   "_$J($P(LRTOT(21),U,2),5)
"RTN","LREPIRP5",74,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",75,0)
 S MSG="NTE~22-All Streptococcus Pneumoniae"
"RTN","LREPIRP5",76,0)
 S MSG=MSG_$E(LRSP,1,21)_$J($P(LRTOT(22),U),5)_"   "_$J($P(LRTOT(22),U,2),5)
"RTN","LREPIRP5",77,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",78,0)
 S MSG="NTE~23-All Enterococci"
"RTN","LREPIRP5",79,0)
 S MSG=MSG_LRSP_$E(LRSP,1,4)_$J($P(LRTOT(23),U),5)_"   "_$J($P(LRTOT(23),U,2),5)
"RTN","LREPIRP5",80,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",81,0)
 Q
"RTN","LREPIRP5",82,0)
PRTTOT ;Print totals on summary report
"RTN","LREPIRP5",83,0)
 S MSG="",^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",84,0)
 S MSG="Processing Month: "_LRHDGL2_" for site # "_$P(SITE,U,3)_" "_$P(SITE,U,2)
"RTN","LREPIRP5",85,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",86,0)
 S MSG="Site totals"
"RTN","LREPIRP5",87,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",88,0)
 S MSG="",^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",89,0)
 S LRNUM=0
"RTN","LREPIRP5",90,0)
 F  S LRNUM=$O(^XTMP("LREPIREP"_LRDATE,"TOTAL1",LRNUM)) Q:LRNUM=""  D
"RTN","LREPIRP5",91,0)
 .S MSG=$P($P(^XTMP("LREPIREP"_LRDATE,"TOTAL1",LRNUM),HLFS,3),LRCS,3)
"RTN","LREPIRP5",92,0)
 .I 60-$L(MSG)>30 S MSG=MSG_LRSP
"RTN","LREPIRP5",93,0)
 .I 60-$L(MSG)>30 S MSG=MSG_LRSP
"RTN","LREPIRP5",94,0)
 .S MSG=MSG_$E(LRSP,1,60-$L(MSG))
"RTN","LREPIRP5",95,0)
 .S MSG=MSG_$J($P($P(^XTMP("LREPIREP"_LRDATE,"TOTAL1",LRNUM),HLFS,3),LRCS,4),5)
"RTN","LREPIRP5",96,0)
 .S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",97,0)
 Q
"RTN","LREPIRP5",98,0)
PRTHEP ;PRINT HEP C RISK ASSESSMENT TOTALS
"RTN","LREPIRP5",99,0)
 F LRNUM=1:1:7 S LRTOT(LRNUM)=+$G(^XTMP("LREPIREP"_LRDATE,"HEPTOT",LRNUM))
"RTN","LREPIRP5",100,0)
 S MSG="Resolved term-1-Declined Assessment for Hepatitis C"
"RTN","LREPIRP5",101,0)
 S MSG=MSG_$E(LRSP,1,9)_$J($P(LRTOT(1),U),5)
"RTN","LREPIRP5",102,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",103,0)
 S MSG="Resolved term-2-No Risk Factors for Hepatitis C"
"RTN","LREPIRP5",104,0)
 S MSG=MSG_$E(LRSP,1,13)_$J($P(LRTOT(2),U),5)
"RTN","LREPIRP5",105,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",106,0)
 S MSG="Resolved term-3-Previously Assessed for Hepatitis C"
"RTN","LREPIRP5",107,0)
 S MSG=MSG_$E(LRSP,1,9)_$J($P(LRTOT(3),U),5)
"RTN","LREPIRP5",108,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",109,0)
 S MSG="Resolved term-4-Risk Factors for Hepatitis C"
"RTN","LREPIRP5",110,0)
 S MSG=MSG_$E(LRSP,1,16)_$J($P(LRTOT(4),U),5)
"RTN","LREPIRP5",111,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",112,0)
 S MSG="Resolved term-5-Positive Test for Hepatitis C antibody"
"RTN","LREPIRP5",113,0)
 S MSG=MSG_$E(LRSP,1,6)_$J($P(LRTOT(5),U),5)
"RTN","LREPIRP5",114,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",115,0)
 S MSG="Resolved term-6-Negative Test for Hepatitis C antibody"
"RTN","LREPIRP5",116,0)
 S MSG=MSG_$E(LRSP,1,6)_$J($P(LRTOT(6),U),5)
"RTN","LREPIRP5",117,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",118,0)
 S MSG="Resolved term-7-Hepatitis C diagnosis (ICD based)"
"RTN","LREPIRP5",119,0)
 S MSG=MSG_$E(LRSP,1,9)_$J($P(LRTOT(7),U),5)
"RTN","LREPIRP5",120,0)
 S ^TMP($J,"MSG",MSGCNT)=MSG,MSGCNT=MSGCNT+1
"RTN","LREPIRP5",121,0)
 S ^TMP($J,"MSG",MSGCNT)=LRSP_LRSP_"-----"
"RTN","LREPIRP5",122,0)
 S MSGCNT=MSGCNT+1
"RTN","LREPIRP5",123,0)
 S LRTOT=LRTOT(1)+LRTOT(2)+LRTOT(3)+LRTOT(4)+LRTOT(5)+LRTOT(6)+LRTOT(7)
"RTN","LREPIRP5",124,0)
 S ^TMP($J,"MSG",MSGCNT)="Total Hepatitis C Risk Assessment Resolution"_$E(LRSP,1,16)_$J(LRTOT,5)
"RTN","LREPIRP5",125,0)
 S MSGCNT=MSGCNT+1
"RTN","LREPIRP5",126,0)
 ;
"RTN","LREPIRP5",127,0)
 Q
"RTN","LREPIRP7")
0^6^B69807608^B69729328
"RTN","LREPIRP7",1,0)
LREPIRP7 ;DALOI/CKA - EPI-PRINT VERIFICATION REPORT ;23 Apr 2013  4:33 PM
"RTN","LREPIRP7",2,0)
 ;;5.2;LAB SERVICE;**281,320,421**;Sep 27, 1994;Build 48
"RTN","LREPIRP7",3,0)
 ; Reference to X ^DD("DD") supported by IA #10017
"RTN","LREPIRP7",4,0)
 ;USED TO PRINT VERIFICATION REPORT
"RTN","LREPIRP7",5,0)
 W !?5,"Print Detailed Verification Report Option",!!
"RTN","LREPIRP7",6,0)
CHOOSE ;which date report to print
"RTN","LREPIRP7",7,0)
 S LRNODE="LREPIREP",LRDATE=0,LRNUM=1
"RTN","LREPIRP7",8,0)
 F  S LRNODE=$O(^XTMP(LRNODE)) Q:LRNODE=""!(LRNODE'["LREPIREP")  S LRDATE=$E(LRNODE,9,22) D
"RTN","LREPIRP7",9,0)
 .S Y=LRDATE X ^DD("DD") S LRREP(LRNUM)=LRDATE_"^"_Y,LRNUM=LRNUM+1
"RTN","LREPIRP7",10,0)
 F LRNUM=1:1 Q:'$D(LRREP(LRNUM))  W !,LRNUM_" "_$P(LRREP(LRNUM),"^",2),$E(^XTMP("LREPIREP"_$P(LRREP(LRNUM),"^"),"HDG",3),12,99)
"RTN","LREPIRP7",11,0)
 S LRNUM=LRNUM-1
"RTN","LREPIRP7",12,0)
 S DIR(0)="NO^1:"_LRNUM
"RTN","LREPIRP7",13,0)
 S DIR("A")="Choose the number for the report you wish to print"
"RTN","LREPIRP7",14,0)
 D ^DIR
"RTN","LREPIRP7",15,0)
 G:$D(DIRUT) EXIT
"RTN","LREPIRP7",16,0)
 S LRREP=Y
"RTN","LREPIRP7",17,0)
 K DIR,DIRUT
"RTN","LREPIRP7",18,0)
 G:$D(DIRUT) CHOOSE
"RTN","LREPIRP7",19,0)
 S LRDATE=$P(LRREP(LRREP),"^")
"RTN","LREPIRP7",20,0)
 I '$D(^XTMP("LREPIREP"_LRDATE,"DONE")) D  Q
"RTN","LREPIRP7",21,0)
 .W !!
"RTN","LREPIRP7",22,0)
 .W !?5,"This report is not completed generating."
"RTN","LREPIRP7",23,0)
 .W !?5,"Please try again later."
"RTN","LREPIRP7",24,0)
 .S LREND=1
"RTN","LREPIRP7",25,0)
PRIV ;PRIVACY MESSAGE
"RTN","LREPIRP7",26,0)
 W !!!,"This report will contain Confidential Information."
"RTN","LREPIRP7",27,0)
 K DIR S DIR(0)="Y",DIR("A")="Do you wish to continue/proceed"
"RTN","LREPIRP7",28,0)
 S DIR("B")="NO"
"RTN","LREPIRP7",29,0)
 D ^DIR S:$D(DIRUT) LREND=1
"RTN","LREPIRP7",30,0)
 G:'Y EXIT
"RTN","LREPIRP7",31,0)
ALL K DIR,DIRUT
"RTN","LREPIRP7",32,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Include All Pathogens"
"RTN","LREPIRP7",33,0)
 S DIR("?")="Enter (Y)es or return for all entries to be Selected"
"RTN","LREPIRP7",34,0)
 D ^DIR
"RTN","LREPIRP7",35,0)
 S LRALL=+Y
"RTN","LREPIRP7",36,0)
 K DIR
"RTN","LREPIRP7",37,0)
 I +LRALL'>0 D
"RTN","LREPIRP7",38,0)
 .W @IOF
"RTN","LREPIRP7",39,0)
 .F  Q:$D(DIRUT)  D  Q:X=""
"RTN","LREPIRP7",40,0)
 ..S DIR(0)="PAO^69.5:EMZ",DIR("A")="Select Pathogens: "
"RTN","LREPIRP7",41,0)
 ..S DIR("?")="Select the Pathogens. "
"RTN","LREPIRP7",42,0)
 ..S DIR("S")="I Y<100"
"RTN","LREPIRP7",43,0)
 ..D ^DIR
"RTN","LREPIRP7",44,0)
 ..Q:$D(DIRUT)!(Y=-1)
"RTN","LREPIRP7",45,0)
 ..S LREPI($P(^LAB(69.5,+Y,0),U,9))=+Y
"RTN","LREPIRP7",46,0)
 ..K DIR,DTOUT,DUOUT,DIRUT
"RTN","LREPIRP7",47,0)
 G:$D(DTOUT)!$D(DUOUT) Q
"RTN","LREPIRP7",48,0)
 I '$D(LREPI)&('LRALL) W !,"Sorry No Pathogens Selected" G CHOOSE
"RTN","LREPIRP7",49,0)
 D REP
"RTN","LREPIRP7",50,0)
EXIT ;
"RTN","LREPIRP7",51,0)
 D ^%ZISC
"RTN","LREPIRP7",52,0)
 K DIC,D0,LRAUTO,LRBEG,LRDT,LREND,LRRNDT,LREPI,LRRPE,LRRPS,ZTSAVE
"RTN","LREPIRP7",53,0)
 K ZTRTN,ZTIO,ZTDESC,ZTDTH,ZTSK,X,Y,X1,%DT,POP,%ZIS
"RTN","LREPIRP7",54,0)
 K LRCOUNT,LRLC,LRHDG,LRQUIT,LRHDGLC,LRPAGE,LRNODE
"RTN","LREPIRP7",55,0)
 K DIR,DIRUT,DTOUT,DUOUT,J,LRMSGLIN,LRREP,LRSPSHT,MSG
"RTN","LREPIRP7",56,0)
 K LRALL,LRCOUNT,LRDATE,LRDFN,LRDG1,LRDSPCNT,LRNUM,LROBR,LROBX,LRPAGE
"RTN","LREPIRP7",57,0)
 K LRPATH,LRPID,LRSEG,LRTYPE,LRUPDNUM,LRZXECNT
"RTN","LREPIRP7",58,0)
 K LRSBCNT,LRPV1,LRNOPAT,LRADMDT,LRDG1CNT,LRDISDT,LRDSP,LRDTHDG,LRHDGL2
"RTN","LREPIRP7",59,0)
 K LRI,LRNAME,LRNTECNT,LRNUM1,LROBRCNT,LROBXCNT,LRPATHCT,LRPERCNT
"RTN","LREPIRP7",60,0)
 K LRPV1CNT,LRPV1N,LRPV1ND,LRSUBCNT,LRTMP,LRTOT,LRTOTCNT,LRZXE,SITE,SSN
"RTN","LREPIRP7",61,0)
 K ZTREQ
"RTN","LREPIRP7",62,0)
 Q
"RTN","LREPIRP7",63,0)
 ;
"RTN","LREPIRP7",64,0)
REP ;
"RTN","LREPIRP7",65,0)
Q S %ZIS="Q" D ^%ZIS Q:POP  I '$D(IO("Q")) U IO D PRT Q
"RTN","LREPIRP7",66,0)
 S ZTRTN="PRT^LREPIRP7",ZTSAVE("LR*")="",ZTDESC="PRINT EPI VERIFICATION REPORT",ZTREQ="@" D ^%ZTLOAD
"RTN","LREPIRP7",67,0)
 I $D(ZTSK)[0 W !!?5,"Report Cancelled."
"RTN","LREPIRP7",68,0)
 E  W !!?5,"The Task has been queued",!,"Task #",$G(ZTSK) H 5
"RTN","LREPIRP7",69,0)
 D HOME^%ZIS G EXIT
"RTN","LREPIRP7",70,0)
 Q
"RTN","LREPIRP7",71,0)
PRT ;Print report
"RTN","LREPIRP7",72,0)
 I 'LRALL D PATH G EXIT
"RTN","LREPIRP7",73,0)
 S LRPATH=0,LRDFN=0,LRPV1=0,LROBR=0,LROBX=0,LRPAGE=1,LRQUIT=0,LRNUM=0
"RTN","LREPIRP7",74,0)
 S LRPATH=1 D PPRT1^LREPIRP8
"RTN","LREPIRP7",75,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",76,0)
 S LRDFN=0,LRPV1=0,LRDG1=0
"RTN","LREPIRP7",77,0)
 S LRPATH=2 D PPRT3^LREPIRP8
"RTN","LREPIRP7",78,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",79,0)
 S LRDFN=0
"RTN","LREPIRP7",80,0)
 F LRPATH=3,4,5,6 D PPRT1^LREPIRP8 Q:LRQUIT  S LRDFN=0
"RTN","LREPIRP7",81,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",82,0)
 S LRDFN=0,LRPV1=0,LRDG1=0
"RTN","LREPIRP7",83,0)
 S LRPATH=7 D PPRT2^LREPIRP8
"RTN","LREPIRP7",84,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",85,0)
 S LRDFN=0,LRNUM=0
"RTN","LREPIRP7",86,0)
 S LRPATH=8 D PPRT1^LREPIRP8
"RTN","LREPIRP7",87,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",88,0)
 S LRDFN=0,LRPV1=0,LRDG1=0
"RTN","LREPIRP7",89,0)
 S LRPATH=9 D PPRT2^LREPIRP8
"RTN","LREPIRP7",90,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",91,0)
 S LRDFN=0,LRNUM=0
"RTN","LREPIRP7",92,0)
 S LRPATH=10 D PPRT1^LREPIRP8
"RTN","LREPIRP7",93,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",94,0)
 S LRDFN=0,LRPV1=0,LRDG1=0
"RTN","LREPIRP7",95,0)
 F LRPATH=11,12,13,14 D PPRT4^LREPIRP8 Q:LRQUIT  S LRDFN=0
"RTN","LREPIRP7",96,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",97,0)
 S LRDFN=0,LRPV1=0,LROBR=0,LROBX=0,LRDG1=0
"RTN","LREPIRP7",98,0)
 F LRPATH=15,16,17 D PPRT3^LREPIRP8 Q:LRQUIT  S LRDFN=0
"RTN","LREPIRP7",99,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",100,0)
 S LRDFN=0
"RTN","LREPIRP7",101,0)
 F LRPATH=18,19,20,21,22,23 D PPRT1^LREPIRP8 Q:LRQUIT  S LRDFN=0
"RTN","LREPIRP7",102,0)
 I LRQUIT G EXIT
"RTN","LREPIRP7",103,0)
 S LRDFN=0,LRPV1=0,LRDG1=0
"RTN","LREPIRP7",104,0)
 W @IOF
"RTN","LREPIRP7",105,0)
 W !,?70,"  PAGE ",LRPAGE
"RTN","LREPIRP7",106,0)
 S LRHDGLC=0,LRLC=0
"RTN","LREPIRP7",107,0)
 F  S LRHDGLC=$O(^XTMP("LREPIREP"_LRDATE,"UPDHDG",LRHDGLC)) Q:LRHDGLC=""  W !,^(LRHDGLC)
"RTN","LREPIRP7",108,0)
 S LRPAGE=LRPAGE+1
"RTN","LREPIRP7",109,0)
 W !!,"Name                     LAST 4  Admission date     Discharge date"
"RTN","LREPIRP7",110,0)
 W !,"__________________________________________________________________"
"RTN","LREPIRP7",111,0)
 S LRUPDNUM=0
"RTN","LREPIRP7",112,0)
 F  S LRUPDNUM=$O(^XTMP("LREPIREP"_LRDATE,"UPDATES",LRUPDNUM)) Q:LRUPDNUM=""  W !,^(LRUPDNUM) I $Y>(IOSL+14) D NPG
"RTN","LREPIRP7",113,0)
 W @IOF
"RTN","LREPIRP7",114,0)
 W !,?70,"PAGE ",LRPAGE
"RTN","LREPIRP7",115,0)
 S LRHDGLC=0,LRLC=0
"RTN","LREPIRP7",116,0)
 F  S LRHDGLC=$O(^XTMP("LREPIREP"_LRDATE,"PHHDG",LRHDGLC)) Q:LRHDGLC=""  W !,^(LRHDGLC)
"RTN","LREPIRP7",117,0)
 S LRPAGE=LRPAGE+1
"RTN","LREPIRP7",118,0)
 W !!
"RTN","LREPIRP7",119,0)
 S LRTYPE="",LRZXECNT=0,LRCOUNT=0,LRSBCNT=0,LRDFN=0
"RTN","LREPIRP7",120,0)
 F  S LRTYPE=$O(^XTMP("LREPIREP"_LRDATE,"ZXE",LRTYPE)) Q:LRTYPE=""  D  D ZXETOT S LRSBCNT=0
"RTN","LREPIRP7",121,0)
 .W !,LRTYPE
"RTN","LREPIRP7",122,0)
 .F  S LRDFN=$O(^XTMP("LREPIREP"_LRDATE,"ZXE",LRTYPE,LRDFN)) Q:LRDFN=""  D
"RTN","LREPIRP7",123,0)
 ..F  S LRZXECNT=$O(^XTMP("LREPIREP"_LRDATE,"ZXE",LRTYPE,LRDFN,LRZXECNT)) Q:LRZXECNT=""  D
"RTN","LREPIRP7",124,0)
 ...W !,?5,^XTMP("LREPIREP"_LRDATE,"ZXE",LRTYPE,LRDFN,LRZXECNT)
"RTN","LREPIRP7",125,0)
 ...S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",126,0)
 ...I $Y>(IOSL+1) D NPG
"RTN","LREPIRP7",127,0)
 W !,"------------------------------------------------------------"
"RTN","LREPIRP7",128,0)
 W !?5,"COUNT ",LRCOUNT
"RTN","LREPIRP7",129,0)
 W @IOF
"RTN","LREPIRP7",130,0)
 W !?70,"PAGE ",LRPAGE
"RTN","LREPIRP7",131,0)
 S LRHDGLC=0,LRLC=LRLC+1,LRCOUNT=0,LRSUBCNT=0
"RTN","LREPIRP7",132,0)
 F  S LRHDGLC=$O(^XTMP("LREPIREP"_LRDATE,"HEPCHDG",LRHDGLC)) Q:LRHDGLC=""  W !,^(LRHDGLC)
"RTN","LREPIRP7",133,0)
 S LRPAGE=LRPAGE+1
"RTN","LREPIRP7",134,0)
 W !!
"RTN","LREPIRP7",135,0)
 F LRNUM=1:1:7 W !! D
"RTN","LREPIRP7",136,0)
 .I LRNUM=1 W !,"DECLINED ASSESSMENT FOR HEPATITIS C"
"RTN","LREPIRP7",137,0)
 .I LRNUM=2 W !,"NO RISK FACTORS FOR HEPATITIS C"
"RTN","LREPIRP7",138,0)
 .I LRNUM=3 W !,"PREVIOUSLY ASSESSED FOR HEPATITIS C"
"RTN","LREPIRP7",139,0)
 .I LRNUM=4 W !,"RISK FACTORS FOR HEPATITIS C"
"RTN","LREPIRP7",140,0)
 .I LRNUM=5 W !,"POSITIVE TEST FOR HEPATITIS C ANTIBODY"
"RTN","LREPIRP7",141,0)
 .I LRNUM=6 W !,"NEGATIVE TEST FOR HEPATITIS C ANTIBODY"
"RTN","LREPIRP7",142,0)
 .I LRNUM=7 W !,"HEPATITIS C DIAGNOSIS (ICD BASED)"
"RTN","LREPIRP7",143,0)
 .W !,"--------------------------------------"
"RTN","LREPIRP7",144,0)
 .S LRTOT(LRNUM)=$G(^XTMP("LREPIREP"_LRDATE,"HEPTOT",LRNUM))
"RTN","LREPIRP7",145,0)
 .I LRTOT(LRNUM)="" W !!,"NO PATIENTS REPORTED FOR THE REPORT PERIOD" Q
"RTN","LREPIRP7",146,0)
 .S LRTYPE="",LRDSPCNT=0,LRCOUNT=0,LRSBCNT=0,LRDFN=0
"RTN","LREPIRP7",147,0)
 .F  S LRTYPE=$O(^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE)) Q:LRTYPE=""  D  D:LRSBCNT>0 DSPTOT S LRSBCNT=0
"RTN","LREPIRP7",148,0)
 ..F  S LRDFN=$O(^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN)) Q:LRDFN=""  D
"RTN","LREPIRP7",149,0)
 ...F  S LRDSPCNT=$O(^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT)) Q:LRDSPCNT=""  D
"RTN","LREPIRP7",150,0)
 ....I LRNUM=1&(LRTYPE="DECLINED HEP C RISK ASSESSMENT") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) D:($Y>(IOSL+11)) NPG S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",151,0)
 ....I LRNUM=2&(LRTYPE="NO RISK FACTORS FOR HEP C") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) D:($Y>(IOSL+11)) NPG S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",152,0)
 ....I LRNUM=3&(LRTYPE="PREVIOUSLY ASSESSED HEP C RISK") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) D:($Y>(IOSL+11)) NPG S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",153,0)
 ....I LRNUM=4&(LRTYPE="RISK FACTOR FOR HEPATITIS C") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) D:($Y>(IOSL+11)) NPG S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",154,0)
 ....I LRNUM=5&(LRTYPE="HEP C VIRUS ANTIBODY POSITIVE") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",155,0)
 ....I LRNUM=6&(LRTYPE="HEP C VIRUS ANTIBODY NEGATIVE") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",156,0)
 ....I LRNUM=7&(LRTYPE="HEPATITIS C INFECTION") W !?5,^XTMP("LREPIREP"_LRDATE,"DSP",LRTYPE,LRDFN,LRDSPCNT) D:($Y>(IOSL+11)) NPG S LRSBCNT=LRSBCNT+1
"RTN","LREPIRP7",157,0)
 W !,"-----------------------------------------------------------------"
"RTN","LREPIRP7",158,0)
 W !?5,"COUNT ",LRCOUNT
"RTN","LREPIRP7",159,0)
 K MSGLIN,LRSEG
"RTN","LREPIRP7",160,0)
 Q
"RTN","LREPIRP7",161,0)
PATH S LRPATH=0,LRDFN=0,LRPV1=0,LROBR=0,LROBX=0,LRPAGE=1,LRQUIT=0
"RTN","LREPIRP7",162,0)
 F  S LRPATH=$O(LREPI(LRPATH)) Q:'LRPATH  D  Q:LRQUIT  S LRDFN=0
"RTN","LREPIRP7",163,0)
 .I LRPATH=11!(LRPATH=12)!(LRPATH=13)!(LRPATH=14) D PPRT4^LREPIRP8 Q
"RTN","LREPIRP7",164,0)
 .I LRPATH=7!(LRPATH=9) D PPRT2^LREPIRP8 Q
"RTN","LREPIRP7",165,0)
 .I LRPATH=2!(LRPATH=15)!(LRPATH=16)!(LRPATH=17) D PPRT3^LREPIRP8 Q
"RTN","LREPIRP7",166,0)
 .D PPRT1^LREPIRP8
"RTN","LREPIRP7",167,0)
 G EXIT
"RTN","LREPIRP7",168,0)
 Q
"RTN","LREPIRP7",169,0)
ZXETOT ;PRINT PHARMACY SUBTOTALS
"RTN","LREPIRP7",170,0)
 W !,"---------------------------------------------------------------"
"RTN","LREPIRP7",171,0)
 W !,?5,"SUBCOUNT  ",LRSBCNT
"RTN","LREPIRP7",172,0)
 W !!
"RTN","LREPIRP7",173,0)
 S LRCOUNT=LRCOUNT+LRSBCNT
"RTN","LREPIRP7",174,0)
 Q
"RTN","LREPIRP7",175,0)
DSPTOT W !,"---------------------------------------------------------------"
"RTN","LREPIRP7",176,0)
 W !?5,"SUBCOUNT  ",LRSBCNT
"RTN","LREPIRP7",177,0)
 W !!
"RTN","LREPIRP7",178,0)
 S LRCOUNT=LRCOUNT+LRSBCNT
"RTN","LREPIRP7",179,0)
 Q
"RTN","LREPIRP7",180,0)
PAUSE ;
"RTN","LREPIRP7",181,0)
 Q:$G(LREND)
"RTN","LREPIRP7",182,0)
 K DIR S DIR(0)="E" D ^DIR
"RTN","LREPIRP7",183,0)
 S:($D(DTOUT))!($D(DUOUT)) LRQUIT=1
"RTN","LREPIRP7",184,0)
 Q
"RTN","LREPIRP7",185,0)
NPG ;NEW PAGE
"RTN","LREPIRP7",186,0)
 D:$E(IOST,1,2)="C-" PAUSE
"RTN","LREPIRP7",187,0)
 Q:$G(LRQUIT)
"RTN","LREPIRP7",188,0)
 W @IOF
"RTN","LREPIRP7",189,0)
 Q
"RTN","LREPIRP7",190,0)
HDG ;
"RTN","LREPIRP7",191,0)
 W @IOF
"RTN","LREPIRP7",192,0)
 S LRLC=0
"RTN","LREPIRP7",193,0)
 W !,?70,"  PAGE ",LRPAGE
"RTN","LREPIRP7",194,0)
 F LRHDGLC=1:1:3 S LRHDG=$G(^XTMP("LREPIREP"_LRDATE,"HDG",LRHDGLC)) D
"RTN","LREPIRP7",195,0)
 .W !,LRHDG
"RTN","LREPIRP7",196,0)
 .S LRLC=LRLC+1
"RTN","LREPIRP7",197,0)
 W ! S LRLC=LRLC+1
"RTN","LREPIRP7",198,0)
 S LRHDGLC=0
"RTN","LREPIRP7",199,0)
 F  S LRHDGLC=$O(^XTMP("LREPIREP"_LRDATE,LRPATH,"HDG",LRHDGLC)) Q:LRHDGLC=""  D
"RTN","LREPIRP7",200,0)
 .S LRHDG=$G(^XTMP("LREPIREP"_LRDATE,LRPATH,"HDG",LRHDGLC))
"RTN","LREPIRP7",201,0)
 .W !,LRHDG
"RTN","LREPIRP7",202,0)
 .S LRLC=LRLC+1
"RTN","LREPIRP7",203,0)
 S LRPAGE=LRPAGE+1
"RTN","LREPIRP7",204,0)
 Q
"RTN","LREPIRS1")
0^15^B39937424^B38487610
"RTN","LREPIRS1",1,0)
LREPIRS1 ;DALOI/CKA - EMERGING PATHOGENS LOCAL REPORT ;23 Apr 2013  4:34 PM
"RTN","LREPIRS1",2,0)
 ;;5.2;LAB SERVICE;**281,421**;Sep 27, 1994;Build 48
"RTN","LREPIRS1",3,0)
 ; Reference to ^DIC(21 supported by IA #913
"RTN","LREPIRS1",4,0)
 Q
"RTN","LREPIRS1",5,0)
REPORT ;
"RTN","LREPIRS1",6,0)
 S X1=DT,X2=180 D C^%DTC
"RTN","LREPIRS1",7,0)
 S LRSP="                              "
"RTN","LREPIRS1",8,0)
 S ^XTMP("LREPILOCALREP"_LRLRDT,0)=X_"^"_DT_"^EPI Local Report generation^"_$S($D(DUZ):DUZ,1:"UNKNOWN")
"RTN","LREPIRS1",9,0)
 S LRHDGLC=0 D SAVHDG^LREPIRS2
"RTN","LREPIRS1",10,0)
 S MSG=0,LRLC=1,LRSPSHT=""
"RTN","LREPIRS1",11,0)
 F  S MSG=$O(^TMP("HLS",$J,MSG)) Q:'MSG  S LRMSGLIN=^(MSG) D
"RTN","LREPIRS1",12,0)
 .S LRSPSHT=""
"RTN","LREPIRS1",13,0)
 .Q:$P(LRMSGLIN,"|")=""
"RTN","LREPIRS1",14,0)
 .Q:'$D(LRSEG($P(LRMSGLIN,"|")))
"RTN","LREPIRS1",15,0)
 .I $P(LRMSGLIN,"|")="PID" D
"RTN","LREPIRS1",16,0)
 ..S LRSPSHT="********************************************************************************"
"RTN","LREPIRS1",17,0)
 ..S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1
"RTN","LREPIRS1",18,0)
 .I $P(LRMSGLIN,"|")="PID" D
"RTN","LREPIRS1",19,0)
 ..I $D(LRSEG("PID",1)) S LRSPSHT=$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,7-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",20,0)
 ..I $D(LRSEG("PID",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,20)_" "
"RTN","LREPIRS1",21,0)
 ..I $D(LRSEG("PID",3)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,4),LRCS,4) D
"RTN","LREPIRS1",22,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,16-($L($P($P(LRMSGLIN,HLFS,4),LRCS,4))))
"RTN","LREPIRS1",23,0)
 ..I $D(LRSEG("PID",4)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,6),LRCS)_","_$P($P(LRMSGLIN,HLFS,6),LRCS,2)_" "_$P($P(LRMSGLIN,HLFS,6),LRCS,3)_"  " D
"RTN","LREPIRS1",24,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,29-($L($P(LRMSGLIN,HLFS,6))))
"RTN","LREPIRS1",25,0)
 ..I $D(LRSEG("PID",5)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,8)) D
"RTN","LREPIRS1",26,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,9-($L($P(LRMSGLIN,HLFS,8))))
"RTN","LREPIRS1",27,0)
 ..I $D(LRSEG("PID",6)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,9)_"  "
"RTN","LREPIRS1",28,0)
 ..I $D(LRSEG("PID",7)) D  K LRZ,LRY
"RTN","LREPIRS1",29,0)
 ...S LRZ=0,DFN=$P($P(LRMSGLIN,HLFS,4),LRCS) F LRY=1:1 S LRZ=$O(^DPT(DFN,.02,LRZ)) Q:'LRZ
"RTN","LREPIRS1",30,0)
 ...I LRY>2 S LRSPSHT=LRSPSHT_"MULTIPLE "
"RTN","LREPIRS1",31,0)
 ...E  S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,11),LRCS,2)_" "
"RTN","LREPIRS1",32,0)
 ..I $D(LRSEG("PID",8)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,12),LRCS,1)_$E(LRSP,1,9-$L($P($P(LRMSGLIN,HLFS,12),LRCS,1)))
"RTN","LREPIRS1",33,0)
 ..I $D(LRSEG("PID",9)) S LRSPSHT=LRSPSHT_$P($P($P(LRMSGLIN,HLFS,12),LRCS,4),U,2)_"  " D
"RTN","LREPIRS1",34,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,15-$L($P($P($P(LRMSGLIN,HLFS,12),LRCS,4),U,2)))
"RTN","LREPIRS1",35,0)
 ..I $D(LRSEG("PID",10)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,12),LRCS,5)_" "
"RTN","LREPIRS1",36,0)
 ..I $D(LRSEG("PID",11)) S LRSPSHT=LRSPSHT_$P($P($P(LRMSGLIN,HLFS,12),LRCS,9),U,2)_$E(LRSP,1,20-$L($P($P($P(LRMSGLIN,HLFS,12),LRCS,9),U,2)))
"RTN","LREPIRS1",37,0)
 ..I $D(LRSEG("PID",12)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,23),LRCS,2)_$E(LRSP,1,20-$L($P($P(LRMSGLIN,HLFS,23),LRCS,2)))
"RTN","LREPIRS1",38,0)
 ..I $D(LRSEG("PID",13)) D  I LRPOS="" S LRSPSHT=LRSPSHT_"  "
"RTN","LREPIRS1",39,0)
 ...S LRPOS=$P(LRMSGLIN,HLFS,28)
"RTN","LREPIRS1",40,0)
 ...Q:LRPOS=""
"RTN","LREPIRS1",41,0)
 ...S LRPOSN=0
"RTN","LREPIRS1",42,0)
 ...F  S LRPOSN=$O(^DIC(21,LRPOSN)) Q:LRPOSN'>0  I $P($G(^DIC(21,LRPOSN,0)),U,3)=LRPOS S LRPOSNAM=$P(^(0),U) Q
"RTN","LREPIRS1",43,0)
 ...S LRSPSHT=LRSPSHT_LRPOSNAM_"  "
"RTN","LREPIRS1",44,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1 S LRSPSHT=""
"RTN","LREPIRS1",45,0)
 .K LRPOS,LRPOSN,LRPOSNAM
"RTN","LREPIRS1",46,0)
 .I $P(LRMSGLIN,"|")="PV1" D
"RTN","LREPIRS1",47,0)
 ..I $D(LRSEG("PV1",1)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,7-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",48,0)
 ..I $D(LRSEG("PV1",2)) D
"RTN","LREPIRS1",49,0)
 ...S TYPE=$P(LRMSGLIN,HLFS,3),TYPE=$S(TYPE="U":"Update",TYPE="I":"Inpatient",1:"Outpatient")
"RTN","LREPIRS1",50,0)
 ...S LRSPSHT=LRSPSHT_TYPE_$E(LRSP,1,14-$L(TYPE))
"RTN","LREPIRS1",51,0)
 ...K TYPE
"RTN","LREPIRS1",52,0)
 ..I $D(LRSEG("PV1",3)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,4)_$E(LRSP,1,20-$L($P(LRMSGLIN,HLFS,4)))
"RTN","LREPIRS1",53,0)
 ..I $D(LRSEG("PV1",4)) S LRSPSHT=LRSPSHT_$S($P($P(LRMSGLIN,HLFS,37),LRCS,2)'="":$P($P(LRMSGLIN,HLFS,37),LRCS,2),1:"**No Facility**")_$E(LRSP,1,23-$L($P($P(LRMSGLIN,HLFS,37),LRCS,2)))
"RTN","LREPIRS1",54,0)
 ..I $D(LRSEG("PV1",5)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,40)_$E(LRSP,1,9-$L($P(LRMSGLIN,HLFS,40)))
"RTN","LREPIRS1",55,0)
 ..I $D(LRSEG("PV1",6)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,45))_" "
"RTN","LREPIRS1",56,0)
 ..I $D(LRSEG("PV1",7)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,46))
"RTN","LREPIRS1",57,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1 S LRSPSHT=""
"RTN","LREPIRS1",58,0)
 .I $P(LRMSGLIN,"|")="NTE" D
"RTN","LREPIRS1",59,0)
 ..I $D(LRSEG("NTE",1)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,8-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",60,0)
 ..I $D(LRSEG("NTE",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,3)_"  "
"RTN","LREPIRS1",61,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1 S LRSPSHT=""
"RTN","LREPIRS1",62,0)
 .I $P(LRMSGLIN,"|")="OBR" D
"RTN","LREPIRS1",63,0)
 ..I $D(LRSEG("OBR",1)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,7-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",64,0)
 ..I $D(LRSEG("OBR",2)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,5),LRCS,2)_$E(LRSP,1,20-$L($P($P(LRMSGLIN,HLFS,5),LRCS,2)))
"RTN","LREPIRS1",65,0)
 ..I $D(LRSEG("OBR",3)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,8))_$E(LRSP,1,17-$L($$CDT^LREPIRP($P(LRMSGLIN,HLFS,8))))
"RTN","LREPIRS1",66,0)
 ..I $D(LRSEG("OBR",4)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,16),LRCS,3)_$E(LRSP,1,20-$L($P($P(LRMSGLIN,HLFS,16),LRCS,3)))
"RTN","LREPIRS1",67,0)
 ..I $D(LRSEG("OBR",5)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,19)
"RTN","LREPIRS1",68,0)
 ..S LRSPSHT=LRSPSHT_"   "_$P($P(LRMSGLIN,HLFS,27),LRCS,2)
"RTN","LREPIRS1",69,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1 S LRSPSHT=""
"RTN","LREPIRS1",70,0)
 .I $P(LRMSGLIN,"|")="OBX" D
"RTN","LREPIRS1",71,0)
 ..I $P(LRMSGLIN,HLFS,3)="ST" D
"RTN","LREPIRS1",72,0)
 ...S TST=$P(LRMSGLIN,HLFS,4),TSTNM=$P($P(TST,LRCS,2),LRCS)
"RTN","LREPIRS1",73,0)
 ...S OV=$P(LRMSGLIN,HLFS,6)
"RTN","LREPIRS1",74,0)
 ..I $P(LRMSGLIN,HLFS,3)="CE" D
"RTN","LREPIRS1",75,0)
 ...S TSTNM=""
"RTN","LREPIRS1",76,0)
 ...S OV=$P($P(LRMSGLIN,HLFS,6),LRCS,2)
"RTN","LREPIRS1",77,0)
 ..S FD=$$CDT^LREPIRP($P(LRMSGLIN,HLFS,15)),RR=$P(LRMSGLIN,HLFS,9)
"RTN","LREPIRS1",78,0)
 ..S UN=$P(LRMSGLIN,HLFS,7)
"RTN","LREPIRS1",79,0)
 ..I $P($P(LRMSGLIN,HLFS,4),LRCS,9)="LOINC" D
"RTN","LREPIRS1",80,0)
 ...S LOINC=$P($P(LRMSGLIN,HLFS,4),LRCS,7),LOINCN=$P($P(LRMSGLIN,HLFS,4),LRCS,8)
"RTN","LREPIRS1",81,0)
 ..I $D(LRSEG("OBX",1)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,7-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",82,0)
 ..I $D(LRSEG("OBX",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,3)_"  "
"RTN","LREPIRS1",83,0)
 ..I $D(LRSEG("OBX",3)) S LRSPSHT=LRSPSHT_TSTNM_"  "
"RTN","LREPIRS1",84,0)
 ..I $D(LRSEG("OBX",4)) S LRSPSHT=LRSPSHT_$G(LOINC)_"  "
"RTN","LREPIRS1",85,0)
 ..I $D(LRSEG("OBX",5)) S LRSPSHT=LRSPSHT_$G(LOINCN)_"  "
"RTN","LREPIRS1",86,0)
 ..I $D(LRSEG("OBX",6)) S LRSPSHT=LRSPSHT_OV_"  "
"RTN","LREPIRS1",87,0)
 ..I $D(LRSEG("OBX",7)) S LRSPSHT=LRSPSHT_UN_"  "
"RTN","LREPIRS1",88,0)
 ..I $D(LRSEG("OBX",8)) S LRSPSHT=LRSPSHT_RR_"  "
"RTN","LREPIRS1",89,0)
 ..I $D(LRSEG("OBX",9)) S LRSPSHT=LRSPSHT_FD_"  "
"RTN","LREPIRS1",90,0)
 ..S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,5)
"RTN","LREPIRS1",91,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1 S LRSPSHT=""
"RTN","LREPIRS1",92,0)
 ..K TST,TSTNM,LOINC,LOINCN,ENTRY,UN,RR,FD,OV
"RTN","LREPIRS1",93,0)
 .I $P(LRMSGLIN,"|")="DG1" D
"RTN","LREPIRS1",94,0)
 ..I $D(LRSEG("DG1",1)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,2)_$E(LRSP,1,7-$L($P(LRMSGLIN,HLFS,2)))
"RTN","LREPIRS1",95,0)
 ..I $D(LRSEG("DG1",2)) S LRICDSTR=$S($P($P(LRMSGLIN,HLFS,4),LRCS,3)["I10":"ICD10  ",1:"ICD9   "),LRSPSHT=LRSPSHT_LRICDSTR_$P($P(LRMSGLIN,HLFS,4),LRCS,1)_" " D
"RTN","LREPIRS1",96,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,14-$L(LRICDSTR_$P($P(LRMSGLIN,HLFS,4),LRCS,1)))
"RTN","LREPIRS1",97,0)
 ..I $D(LRSEG("DG1",3)) S LRSPSHT=LRSPSHT_$E($P($P(LRMSGLIN,HLFS,4),LRCS,2),1,37) D
"RTN","LREPIRS1",98,0)
 ...S LRSPSHT=LRSPSHT_$E(LRSP,1,39-$L($E($P($P(LRMSGLIN,HLFS,4),LRCS,2),1,37)))
"RTN","LREPIRS1",99,0)
 ..I $D(LRSEG("DG1",4)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,5))_" "
"RTN","LREPIRS1",100,0)
 ..I LRSPSHT'="" S ^XTMP("LREPILOCALREP"_LRLRDT,LRLC)=LRSPSHT S LRLC=LRLC+1
"RTN","LREPIRS1",101,0)
 K MSGLIN,LRSEG,ENTRY,FD,HLFS,LOINC,LOINCN,LRCS,LRHDGLC,LRLC,LRMSGLIN
"RTN","LREPIRS1",102,0)
 K LRICDSTR,LRPOS,LRSP,LRSPSHT,MSG,OV,RR,TST,TSTNM,TYPE,UN,X,X1,X2
"RTN","LREPIRS1",103,0)
 Q
"RTN","LREPIRS3")
0^16^B54324401^B53422919
"RTN","LREPIRS3",1,0)
LREPIRS3 ;DALOI/CKA - EMERGING PATHOGENS LOCAL REPORT-GENERATE SPSHT ;23 Apr 2013  4:34 PM
"RTN","LREPIRS3",2,0)
 ;;5.2;LAB SERVICE;**281,421**;Sep 27, 1994;Build 48
"RTN","LREPIRS3",3,0)
 ; Reference to ^DIC(21 supported by IA #913
"RTN","LREPIRS3",4,0)
 Q
"RTN","LREPIRS3",5,0)
SPSHT ;
"RTN","LREPIRS3",6,0)
 S X1=DT,X2=180 D C^%DTC
"RTN","LREPIRS3",7,0)
 S ^XTMP("LREPILOCALSPSHT"_LRLRDT,0)=X_"^"_DT_"^EPI Local Report generation^"_$S($D(DUZ):DUZ,1:"UNKNOWN")
"RTN","LREPIRS3",8,0)
HDG1 ;
"RTN","LREPIRS3",9,0)
 S LRHDG="",LRLC=1,LRX=0
"RTN","LREPIRS3",10,0)
 I $D(LRSEG("PID")) S LRX("PID")=LRX,LRHDG="|"_LRX("PID")_"| |"
"RTN","LREPIRS3",11,0)
 I $D(LRSEG("PID",1)) S LRHDG=LRHDG_"PID|"
"RTN","LREPIRS3",12,0)
 I $D(LRSEG("PID",2)) S LRHDG=LRHDG_"SSN|"
"RTN","LREPIRS3",13,0)
 I $D(LRSEG("PID",3)) S LRHDG=LRHDG_"MPI|"
"RTN","LREPIRS3",14,0)
 I $D(LRSEG("PID",4)) S LRHDG=LRHDG_"Patient Name|"
"RTN","LREPIRS3",15,0)
 I $D(LRSEG("PID",5)) S LRHDG=LRHDG_"Date of Birth|"
"RTN","LREPIRS3",16,0)
 I $D(LRSEG("PID",6)) S LRHDG=LRHDG_"Sex|"
"RTN","LREPIRS3",17,0)
 I $D(LRSEG("PID",7)) S LRHDG=LRHDG_"Race|"
"RTN","LREPIRS3",18,0)
 I $D(LRSEG("PID",8)) S LRHDG=LRHDG_"Homeless|"
"RTN","LREPIRS3",19,0)
 I $D(LRSEG("PID",9)) S LRHDG=LRHDG_"State|"
"RTN","LREPIRS3",20,0)
 I $D(LRSEG("PID",10)) S LRHDG=LRHDG_"Zip|"
"RTN","LREPIRS3",21,0)
 I $D(LRSEG("PID",11)) S LRHDG=LRHDG_"County|"
"RTN","LREPIRS3",22,0)
 I $D(LRSEG("PID",12)) S LRHDG=LRHDG_"Ethnicity|"
"RTN","LREPIRS3",23,0)
 I $D(LRSEG("PID",13)) S LRHDG=LRHDG_"POS|"
"RTN","LREPIRS3",24,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",25,0)
 I $D(LRSEG("PV1")) S LRX=LRX+1,LRX("PV1")=LRX,LRHDG="|"_LRX_"| |"
"RTN","LREPIRS3",26,0)
 I $D(LRSEG("PV1",1)) S LRHDG=LRHDG_"PV1|"
"RTN","LREPIRS3",27,0)
 I $D(LRSEG("PV1",2)) S LRHDG=LRHDG_"Patient Class|"
"RTN","LREPIRS3",28,0)
 I $D(LRSEG("PV1",3)) S LRHDG=LRHDG_"Hospital Location|"
"RTN","LREPIRS3",29,0)
 I $D(LRSEG("PV1",4)) S LRHDG=LRHDG_"Discharge Disposition|"
"RTN","LREPIRS3",30,0)
 I $D(LRSEG("PV1",5)) S LRHDG=LRHDG_"Facility|"
"RTN","LREPIRS3",31,0)
 I $D(LRSEG("PV1",6)) S LRHDG=LRHDG_"Admit Date/Time|"
"RTN","LREPIRS3",32,0)
 I $D(LRSEG("PV1",7)) S LRHDG=LRHDG_"Discharge Date/Time|"
"RTN","LREPIRS3",33,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",34,0)
 I $D(LRSEG("DG1")) S LRX=LRX+1,LRX("DG1")=LRX,LRHDG="|"_LRX_"| |"
"RTN","LREPIRS3",35,0)
 I $D(LRSEG("DG1",1)) S LRHDG=LRHDG_"DG1|"
"RTN","LREPIRS3",36,0)
 I $D(LRSEG("DG1",2)) S LRHDG=LRHDG_"Diagnosis Code|"
"RTN","LREPIRS3",37,0)
 I $D(LRSEG("DG1",3)) S LRHDG=LRHDG_"Diagnosis|"
"RTN","LREPIRS3",38,0)
 I $D(LRSEG("DG1",4)) S LRHDG=LRHDG_"Admission Date|"
"RTN","LREPIRS3",39,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",40,0)
 I $D(LRSEG("NTE")) S LRX=LRX+1,LRX("NTE")=LRX,LRHDG="|"_LRX_"| |"
"RTN","LREPIRS3",41,0)
 I $D(LRSEG("NTE",1)) S LRHDG=LRHDG_"NTE|"
"RTN","LREPIRS3",42,0)
 I $D(LRSEG("NTE",2)) S LRHDG=LRHDG_"Comment|"
"RTN","LREPIRS3",43,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",44,0)
 I $D(LRSEG("OBR")) S LRX=LRX+1,LRX("OBR")=LRX,LRHDG="|"_LRX_"| |"
"RTN","LREPIRS3",45,0)
 I $D(LRSEG("OBR",1)) S LRHDG=LRHDG_"OBR|"
"RTN","LREPIRS3",46,0)
 I $D(LRSEG("OBR",2)) S LRHDG=LRHDG_"Test Name|"
"RTN","LREPIRS3",47,0)
 I $D(LRSEG("OBR",3)) S LRHDG=LRHDG_"Accession Date/Time|"
"RTN","LREPIRS3",48,0)
 I $D(LRSEG("OBR",4)) S LRHDG=LRHDG_"Specimen|"
"RTN","LREPIRS3",49,0)
 I $D(LRSEG("OBR",5)) S LRHDG=LRHDG_"Accession Number|"
"RTN","LREPIRS3",50,0)
 I LRHDG'="" S LRHDG=LRHDG_"OBR SUBID"
"RTN","LREPIRS3",51,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",52,0)
 I $D(LRSEG("OBX")) S LRX=LRX+1,LRX("OBX")=LRX,LRHDG="|"_LRX_"| |"
"RTN","LREPIRS3",53,0)
 I $D(LRSEG("OBX",1)) S LRHDG=LRHDG_"OBX|"
"RTN","LREPIRS3",54,0)
 I $D(LRSEG("OBX",2)) S LRHDG=LRHDG_"Value Type|"
"RTN","LREPIRS3",55,0)
 I $D(LRSEG("OBX",3)) S LRHDG=LRHDG_"Test Name|"
"RTN","LREPIRS3",56,0)
 I $D(LRSEG("OBX",4)) S LRHDG=LRHDG_"LOINC Code|"
"RTN","LREPIRS3",57,0)
 I $D(LRSEG("OBX",5)) S LRHDG=LRHDG_"LOINC Name|"
"RTN","LREPIRS3",58,0)
 I $D(LRSEG("OBX",6)) S LRHDG=LRHDG_"Test Result|"
"RTN","LREPIRS3",59,0)
 I $D(LRSEG("OBX",7)) S LRHDG=LRHDG_"Units|"
"RTN","LREPIRS3",60,0)
 I $D(LRSEG("OBX",8)) S LRHDG=LRHDG_"Flags or Interp|"
"RTN","LREPIRS3",61,0)
 I $D(LRSEG("OBX",9)) S LRHDG=LRHDG_"Verified Date/Time|"
"RTN","LREPIRS3",62,0)
 I LRHDG'="" S LRHDG=LRHDG_"OBX SUBID"
"RTN","LREPIRS3",63,0)
 I LRHDG]"" S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRHDG S LRHDG="" S LRLC=LRLC+1
"RTN","LREPIRS3",64,0)
 S MSG=0,LRSPSHT="",LRPID="",LROBR=""
"RTN","LREPIRS3",65,0)
 F  S MSG=$O(^TMP("HLS",$J,MSG)) Q:'MSG  S LRMSGLIN=^(MSG) D
"RTN","LREPIRS3",66,0)
 .S LRSPSHT=""
"RTN","LREPIRS3",67,0)
 .Q:$P(LRMSGLIN,"|")=""
"RTN","LREPIRS3",68,0)
 .Q:'$D(LRSEG($P(LRMSGLIN,"|")))
"RTN","LREPIRS3",69,0)
 .I $P(LRMSGLIN,"|")="PID" D
"RTN","LREPIRS3",70,0)
 ..S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRSPSHT,LRLC=LRLC+1
"RTN","LREPIRS3",71,0)
 .I $P(LRMSGLIN,"|")="PID" D
"RTN","LREPIRS3",72,0)
 ..S LRSPSHT="********************************************************************************"
"RTN","LREPIRS3",73,0)
 ..I $D(LRSEG("PID")) S LRPID=$P(LRMSGLIN,HLFS,2),LRSPSHT=LRPID_"|"_LRX("PID")_"| | |"
"RTN","LREPIRS3",74,0)
 ..I $D(LRSEG("PID",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,20)_"|"
"RTN","LREPIRS3",75,0)
 ..I $D(LRSEG("PID",3)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,4),LRCS,4)_"|"
"RTN","LREPIRS3",76,0)
 ..I $D(LRSEG("PID",4)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,6)_"|"
"RTN","LREPIRS3",77,0)
 ..I $D(LRSEG("PID",5)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,8))_"|"
"RTN","LREPIRS3",78,0)
 ..I $D(LRSEG("PID",6)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,9)_"|"
"RTN","LREPIRS3",79,0)
 ..I $D(LRSEG("PID",7)) D  K LRZ,LRY
"RTN","LREPIRS3",80,0)
 ...S LRZ=0,DFN=$P($P(LRMSGLIN,HLFS,4),LRCS) F LRY=1:1 S LRZ=$O(^DPT(DFN,.02,LRZ)) Q:'LRZ
"RTN","LREPIRS3",81,0)
 ...I LRY>2 S LRSPSHT=LRSPSHT_"MULTIPLE|"
"RTN","LREPIRS3",82,0)
 ...E  S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,11),LRCS,2)_"|"
"RTN","LREPIRS3",83,0)
 ..I $D(LRSEG("PID",8)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,12),LRCS,1)_"|"
"RTN","LREPIRS3",84,0)
 ..I $D(LRSEG("PID",9)) S LRSPSHT=LRSPSHT_$P($P($P(LRMSGLIN,HLFS,12),LRCS,4),U,2)_"|"
"RTN","LREPIRS3",85,0)
 ..I $D(LRSEG("PID",10)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,12),LRCS,5)_"|"
"RTN","LREPIRS3",86,0)
 ..I $D(LRSEG("PID",11)) S LRSPSHT=LRSPSHT_$P($P($P(LRMSGLIN,HLFS,12),LRCS,9),U,2)_"|"
"RTN","LREPIRS3",87,0)
 ..I $D(LRSEG("PID",12)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,23),LRCS,2)_"|"
"RTN","LREPIRS3",88,0)
 ..I $D(LRSEG("PID",13)) D  I LRPOS="" S LRSPSHT=LRSPSHT_"||"
"RTN","LREPIRS3",89,0)
 ...S LRPOS=$P(LRMSGLIN,HLFS,28)
"RTN","LREPIRS3",90,0)
 ...Q:LRPOS=""
"RTN","LREPIRS3",91,0)
 ...S LRPOSN=0
"RTN","LREPIRS3",92,0)
 ...F  S LRPOSN=$O(^DIC(21,LRPOSN)) Q:LRPOSN'>0  I $P($G(^DIC(21,LRPOSN,0)),U,3)=LRPOS S LRPOSNAM=$P(^(0),U) Q
"RTN","LREPIRS3",93,0)
 ...S LRSPSHT=LRSPSHT_LRPOSNAM_"|"
"RTN","LREPIRS3",94,0)
 .K LRPOS,LRPOSN,LRPOSNAM
"RTN","LREPIRS3",95,0)
 .I $P(LRMSGLIN,"|")="PV1" D
"RTN","LREPIRS3",96,0)
 ..I $D(LRSEG("PV1")) S LRSPSHT=LRPID_"|"_LRX("PV1")_"|"_$P(LRMSGLIN,HLFS,2)_"| |"
"RTN","LREPIRS3",97,0)
 ..I $D(LRSEG("PV1",2)) D
"RTN","LREPIRS3",98,0)
 ...S TYPE=$P(LRMSGLIN,HLFS,3)
"RTN","LREPIRS3",99,0)
 ...S LRSPSHT=LRSPSHT_$S(TYPE="U":"Update",TYPE="I":"Inpatient",1:"Outpatient")_"|"
"RTN","LREPIRS3",100,0)
 ...K TYPE
"RTN","LREPIRS3",101,0)
 ..I $D(LRSEG("PV1",3)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,4)_"|"
"RTN","LREPIRS3",102,0)
 ..I $D(LRSEG("PV1",4)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,37),LRCS,2)_"|"
"RTN","LREPIRS3",103,0)
 ..I $D(LRSEG("PV1",5)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,40)_"|"
"RTN","LREPIRS3",104,0)
 ..I $D(LRSEG("PV1",6)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,45))_"|"
"RTN","LREPIRS3",105,0)
 ..I $D(LRSEG("PV1",7)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,46))_"|"
"RTN","LREPIRS3",106,0)
 .I $P(LRMSGLIN,"|")="NTE" D
"RTN","LREPIRS3",107,0)
 ..I $D(LRSEG("NTE")) S LRSPSHT=LRPID_"|"_LRX("NTE")_"|"_$P(LRMSGLIN,HLFS,2)_"| |"
"RTN","LREPIRS3",108,0)
 ..I $D(LRSEG("NTE",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,3)_"|"
"RTN","LREPIRS3",109,0)
 .I $P(LRMSGLIN,"|")="OBR" D
"RTN","LREPIRS3",110,0)
 ..I $D(LRSEG("OBR")) S LROBR=$P(LRMSGLIN,HLFS,2),LRSPSHT=LRPID_"|"_LRX("OBR")_"|"_LROBR_"| |"
"RTN","LREPIRS3",111,0)
 ..I $D(LRSEG("OBR",2)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,5),LRCS,2)_"|"
"RTN","LREPIRS3",112,0)
 ..I $D(LRSEG("OBR",3)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P(LRMSGLIN,HLFS,8))_"|"
"RTN","LREPIRS3",113,0)
 ..I $D(LRSEG("OBR",4)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,16),LRCS,3)_"|"
"RTN","LREPIRS3",114,0)
 ..I $D(LRSEG("OBR",5)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,19)_"|"
"RTN","LREPIRS3",115,0)
 ..S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,27),LRCS,2)
"RTN","LREPIRS3",116,0)
 .I $P(LRMSGLIN,"|")="OBX" D
"RTN","LREPIRS3",117,0)
 ..I $D(LRSEG("OBX")) S LRSPSHT=LRPID_"|"_LRX("OBX")_"|"_LROBR_"|"_$P(LRMSGLIN,HLFS,2)_"|"
"RTN","LREPIRS3",118,0)
 ..I $P(LRMSGLIN,HLFS,3)="ST" D
"RTN","LREPIRS3",119,0)
 ...S TSTNM=$P($P(LRMSGLIN,HLFS,4),LRCS,2)
"RTN","LREPIRS3",120,0)
 ...S OV=$P(LRMSGLIN,HLFS,6)
"RTN","LREPIRS3",121,0)
 ..I $P(LRMSGLIN,HLFS,3)="CE" D
"RTN","LREPIRS3",122,0)
 ...S TSTNM=""
"RTN","LREPIRS3",123,0)
 ...S OV=$P($P(LRMSGLIN,HLFS,6),LRCS,2)
"RTN","LREPIRS3",124,0)
 ..S FD=$$CDT^LREPIRP($P(LRMSGLIN,HLFS,15)),RR=$P(LRMSGLIN,HLFS,9)
"RTN","LREPIRS3",125,0)
 ..S UN=$P(LRMSGLIN,HLFS,7)
"RTN","LREPIRS3",126,0)
 ..I $P($P(LRMSGLIN,HLFS,4),LRCS,9)="LOINC" D
"RTN","LREPIRS3",127,0)
 ...S LOINC=$P($P(LRMSGLIN,HLFS,4),LRCS,7),LOINCN=$P($P(LRMSGLIN,HLFS,4),LRCS,8)
"RTN","LREPIRS3",128,0)
 ..I $D(LRSEG("OBX",2)) S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,3)_"|"
"RTN","LREPIRS3",129,0)
 ..I $D(LRSEG("OBX",3)) S LRSPSHT=LRSPSHT_TSTNM_"|"
"RTN","LREPIRS3",130,0)
 ..I $D(LRSEG("OBX",4)) S LRSPSHT=LRSPSHT_$G(LOINC)_"|"
"RTN","LREPIRS3",131,0)
 ..I $D(LRSEG("OBX",5)) S LRSPSHT=LRSPSHT_$G(LOINCN)_"|"
"RTN","LREPIRS3",132,0)
 ..I $D(LRSEG("OBX",6)) S LRSPSHT=LRSPSHT_OV_"|"
"RTN","LREPIRS3",133,0)
 ..I $D(LRSEG("OBX",7)) S LRSPSHT=LRSPSHT_UN_"|"
"RTN","LREPIRS3",134,0)
 ..I $D(LRSEG("OBX",8)) S LRSPSHT=LRSPSHT_RR_"|"
"RTN","LREPIRS3",135,0)
 ..I $D(LRSEG("OBX",9)) S LRSPSHT=LRSPSHT_FD_"|"
"RTN","LREPIRS3",136,0)
 ..S LRSPSHT=LRSPSHT_$P(LRMSGLIN,HLFS,5)
"RTN","LREPIRS3",137,0)
 ..K TST,TSTNM,LOINC,LOINCN,ENTRY,UN,RR,FD,OV
"RTN","LREPIRS3",138,0)
 .I $P(LRMSGLIN,"|")="DG1" D
"RTN","LREPIRS3",139,0)
 ..I $D(LRSEG("DG1")) S LRSPSHT=LRPID_"|"_LRX("DG1")_"|"_$P(LRMSGLIN,HLFS,2)_"| |"
"RTN","LREPIRS3",140,0)
 ..I $D(LRSEG("DG1",2)) S LRSPSHT=LRSPSHT_$S($P($P(LRMSGLIN,HLFS,4),LRCS,3)["I10":"ICD10  ",1:"ICD9   ")_$P($P(LRMSGLIN,HLFS,4),LRCS,1)_"|"
"RTN","LREPIRS3",141,0)
 ..I $D(LRSEG("DG1",3)) S LRSPSHT=LRSPSHT_$P($P(LRMSGLIN,HLFS,4),LRCS,2)_"|"
"RTN","LREPIRS3",142,0)
 ..I $D(LRSEG("DG1",4)) S LRSPSHT=LRSPSHT_$$CDT^LREPIRP($P($P(LRMSGLIN,HLFS,5),LRCS))_"|"
"RTN","LREPIRS3",143,0)
 .S ^XTMP("LREPILOCALSPSHT"_LRLRDT,LRLC)=LRSPSHT,LRLC=LRLC+1
"RTN","LREPIRS3",144,0)
 K MSGLIN,LRSEG,LRZ
"RTN","LREPIRS3",145,0)
 Q
"RTN","LREPISRV")
0^18^B28774078^B27007288
"RTN","LREPISRV",1,0)
LREPISRV ;DALOI/RLM - EPI data server ;11 Oct 2013  9:49 AM
"RTN","LREPISRV",2,0)
 ;;5.2;LAB SERVICE;**260,281,421**;Sep 27, 1994;Build 48
"RTN","LREPISRV",3,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","LREPISRV",4,0)
 ; Reference to ^%ZOSF supported by IA #10096
"RTN","LREPISRV",5,0)
 ; Reference to $$CODEC^ICDEX supported by IA #5747
"RTN","LREPISRV",6,0)
 ; Reference to $$CSI^ICDEX supported by IA #5747
"RTN","LREPISRV",7,0)
 ; Reference to ^ORD(101 supported by IA #872
"RTN","LREPISRV",8,0)
START ;
"RTN","LREPISRV",9,0)
 K ^TMP($J,"LREPDATA")
"RTN","LREPISRV",10,0)
 S LREPST=$P($$SITE^VASITE,"^",2)
"RTN","LREPISRV",11,0)
 ;Determine station number
"RTN","LREPISRV",12,0)
 S X=XQSUB X ^%ZOSF("UPPERCASE") S LREPSUB=Y
"RTN","LREPISRV",13,0)
 S ^TMP($J,"LREPDATA",1)=LREPSUB_" triggered at "_LREPST_" by "_XMFROM_" on "_XQDATE
"RTN","LREPISRV",14,0)
 ;The first line of the message tells who requested the action and when
"RTN","LREPISRV",15,0)
 S ^TMP($J,"LREPDATA",2)="No"_$S(LREPSUB["REPORT":" report generated",1:"thing done")_" at "_LREPST
"RTN","LREPISRV",16,0)
 ;The second line tells when the server is activated and no data can be gathered from the MailMan message.
"RTN","LREPISRV",17,0)
 S LREPLNT=1
"RTN","LREPISRV",18,0)
 I LREPSUB["REPORT" G REPORT
"RTN","LREPISRV",19,0)
 ;If the subject contains "REPORT" send a report
"RTN","LREPISRV",20,0)
EXIT ;If all went well, report that too.
"RTN","LREPISRV",21,0)
 S %H=$H D YMD^%DTC S XMDUN="EPI SYSTEM",XMDUZ=".5",XMSUB=LREPST_" EPI ("_X_%_")",XMTEXT="^TMP($J,""LREPDATA"","
"RTN","LREPISRV",22,0)
 S XMY("G.EPI-SITE@CINCINNATI.DOMAIN.EXT")=""
"RTN","LREPISRV",23,0)
 ;S XMY("ANZALDUA,CAROL@VAHVSS.DOMAIN.EXT")="" ;,XMY("CAROL.ANZALDUA@DOMAIN.EXT")=""
"RTN","LREPISRV",24,0)
 D ^XMD
"RTN","LREPISRV",25,0)
 ;Mail the errors and successes back to the EPI group at Cincinnati.
"RTN","LREPISRV",26,0)
 K ^TMP($J,"LREPDATA")
"RTN","LREPISRV",27,0)
 K %,%DT,%H,D,DIC,X,XMDUN,XMDUZ,XMER,XMFROM,XMREC,XMRG,XMSUB,XMTEXT,XMY,XMZ,XQDATE,XQSUB,Y,LREPA,LREPB,LREPDA,LREPDA1,LREPDATA,LREPDFN,LREPDM,LREPDOC
"RTN","LREPISRV",28,0)
 K LREPDOM,LREPDTA,LREPED,LREPER,LREPLNT,LREPNM,LREPPT,LREPSD1,LREPSDT,LREPSSN,LREPST,LREPSUB,LREPTC,YSPR,LREPWB,LREPX,ZTQUEUED,ZTSK
"RTN","LREPISRV",29,0)
 K LRCSI,LRICD,LRA,LRCOND,LRDATA,LRFILL,LRI,LRLENGTH,LRPATH,LRPCECNT,LRSPACES,LRTEST
"RTN","LREPISRV",30,0)
 Q
"RTN","LREPISRV",31,0)
 ;F  X XMREC Q:XMER<0  S XMRG=$TR(XMRG,"- ","") D
"RTN","LREPISRV",32,0)
REPORT ;send report
"RTN","LREPISRV",33,0)
 S $P(LRFILL," ",256)=""
"RTN","LREPISRV",34,0)
 S LRA=0 F  S LRA=$O(^LAB(69.5,LRA)) Q:'LRA  D
"RTN","LREPISRV",35,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*="
"RTN","LREPISRV",36,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="Pathogen                       Ref# Cy LD Protocol FPTF Active"
"RTN","LREPISRV",37,0)
  . S LRPATH=$G(^LAB(69.5,LRA,0))
"RTN","LREPISRV",38,0)
  . I LRPATH="" S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (NULL)" Q
"RTN","LREPISRV",39,0)
  . I '$P(LRPATH,"^",7) S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (No Protocol)" Q
"RTN","LREPISRV",40,0)
  . S LRDATA=$P(LRPATH,"^")_$E(LRFILL,$L($P(LRPATH,"^")),30)_$J($P(LRPATH,"^",9),4)_$J($P(LRPATH,"^",5),3)_$J($P(LRPATH,"^",3),3)_$J($P(^ORD(101,$P(LRPATH,"^",7),0),"^"),9)_$J($P(LRPATH,"^",8),4)_$J($P(LRPATH,"^",2),4)
"RTN","LREPISRV",41,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=LRDATA
"RTN","LREPISRV",42,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="   Lab Test                                          Indicator      Value"
"RTN","LREPISRV",43,0)
LTEST . S LRI=0 F  S LRI=$O(^LAB(69.5,LRA,1,LRI)) Q:'LRI  D
"RTN","LREPISRV",44,0)
  . . S LRTEST=$G(^LAB(69.5,LRA,1,LRI,0))
"RTN","LREPISRV",45,0)
  . . I $P(LRTEST,"^")="" S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (No Test)" Q
"RTN","LREPISRV",46,0)
  . . S LRCOND=$P(LRTEST,"^",2),LRCOND=$S(LRCOND=1:"Ref. Range",LRCOND=2:"Contains",LRCOND=3:"Greater Than",LRCOND=4:"Less Than",LRCOND=5:"Equal To",1:"Unknown")
"RTN","LREPISRV",47,0)
  . . S LRDATA=$P($G(^LAB(60,$P(LRTEST,"^"),0),0),"^")_$E(LRFILL,$L($P($G(^LAB(60,$P(LRTEST,"^"),0),0),"^")),40)_$J(LRCOND,20)_$J($P(LRTEST,"^",3),10)
"RTN","LREPISRV",48,0)
  . . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=LRDATA
"RTN","LREPISRV",49,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="   Etiology"
"RTN","LREPISRV",50,0)
ETIO . S LRI=0 F  S LRI=$O(^LAB(69.5,LRA,2,LRI)) Q:'LRI  D
"RTN","LREPISRV",51,0)
  . . S LRTEST=$G(^LAB(69.5,LRA,2,LRI,0))
"RTN","LREPISRV",52,0)
  . . I $P(LRTEST,"^")="" S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (No Etiology)" Q
"RTN","LREPISRV",53,0)
  . . S LRCOND=$P(LRTEST,"^",2),LRCOND=$S(LRCOND=1:"Ref. Range",LRCOND=2:"Contains",LRCOND=3:"Greater Than",LRCOND=4:"Less Than",LRCOND=5:"Equal To",1:"Unknown")
"RTN","LREPISRV",54,0)
  . . S LRDATA=$P($G(^LAB(61.2,$P(LRTEST,"^"),0),0),"^")
"RTN","LREPISRV",55,0)
  . . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=LRDATA
"RTN","LREPISRV",56,0)
 .  S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="    ICD"
"RTN","LREPISRV",57,0)
ICD . S LRI=0 F  S LRI=$O(^LAB(69.5,LRA,3,LRI)) Q:'LRI  D
"RTN","LREPISRV",58,0)
  . . S LRICD=$G(^LAB(69.5,LRA,3,LRI,0))
"RTN","LREPISRV",59,0)
  . . I $P(LRICD,"^")="" S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (No ICD)" Q
"RTN","LREPISRV",60,0)
  . . S LRDATA=$$CODEC^ICDEX(80,$P(LRICD,"^"))
"RTN","LREPISRV",61,0)
  . . S LRCSI=$$CSI^ICDEX(80,$P(LRICD,"^"))
"RTN","LREPISRV",62,0)
  . . S LRLENGTH=11-$L(LRDATA),LRSPACES=""
"RTN","LREPISRV",63,0)
  . . F LRPCECNT=1:1:LRLENGTH S LRSPACES=LRSPACES_" "
"RTN","LREPISRV",64,0)
  . . S LRDATA=LRDATA_LRSPACES_"(ICD-"_$S(LRCSI=30:"10",1:"9")_")"
"RTN","LREPISRV",65,0)
  . . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=LRDATA
"RTN","LREPISRV",66,0)
  . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="      Microbial Susceptibility                      Indicator       Value"
"RTN","LREPISRV",67,0)
MICROB . S LRI=0 F  S LRI=$O(^LAB(69.5,LRA,4,LRI)) Q:'LRI  D
"RTN","LREPISRV",68,0)
  . . S LRTEST=$G(^LAB(69.5,LRA,4,LRI,0))
"RTN","LREPISRV",69,0)
  . . I $P(LRTEST,"^")="" S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)="IEN # "_LRA_" damaged. (No Microbial Susceptibility)" Q
"RTN","LREPISRV",70,0)
  . . S LRCOND=$P(LRTEST,"^",2),LRCOND=$S(LRCOND=1:"Contains",LRCOND=2:"Greater Than",LRCOND=3:"Less Than",LRCOND=4:"Equal To",1:"Unknown")
"RTN","LREPISRV",71,0)
  . . S LRDATA="      "_$P($G(^LAB(62.06,$P(LRTEST,"^"),0),0),"^")_$E(LRFILL,$L($P($G(^LAB(62.06,$P(LRTEST,"^"),0),0),"^")),33)_$J(LRCOND,20)_$J($P(LRTEST,"^",3),11)
"RTN","LREPISRV",72,0)
  . . S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=LRDATA
"RTN","LREPISRV",73,0)
 G EXIT
"RTN","LREPISRV",74,0)
OUT S LREPLNT=$G(LREPLNT)+1,^TMP($J,"LREPDATA",LREPLNT)=XMRG_LREPER_LREPST Q
"RTN","LREPISRV",75,0)
 ;Build the text for the return message here.
"RTN","LREPISRV",76,0)
ZEOR ;LREPISRV
"RTN","LREPIXDG")
0^10^B1966011^n/a
"RTN","LREPIXDG",1,0)
LREPIXDG ;ALB/TJ/SS - ICD DIAGNOSIS DESCRIPTION LOOK UP;23 Apr 2013  4:35 PM
"RTN","LREPIXDG",2,0)
 ;;5.2;LAB SERVICE;**421**;Sep 27, 1994;Build 48
"RTN","LREPIXDG",3,0)
 ;; 
"RTN","LREPIXDG",4,0)
 ;ICRs 
"RTN","LREPIXDG",5,0)
 ; 5679 - supported ($$IMPDATE^LEXU)
"RTN","LREPIXDG",6,0)
 ; 5747 - $$CSI^ICDEX, $$SD^ICDEX, $$SNAM^ICDEX supported by this IA
"RTN","LREPIXDG",7,0)
 ;
"RTN","LREPIXDG",8,0)
LRDSCR(LRDATE) I '($G(LRDATE,"")]"") D
"RTN","LREPIXDG",9,0)
 .N LRDATE D NOW^%DTC S LRDATE=X
"RTN","LREPIXDG",10,0)
 N LRICDIEN,LRDSCR S LRICDIEN=^TMP("DDS",$J,$P(DDS,U),DDS3FN,DA_","_DA(1)_",",.01,"D")
"RTN","LREPIXDG",11,0)
 S LRDSCR=$E($$SD^ICDEX(80,LRICDIEN,LRDATE),1,60) S:$P(LRDSCR,U,1)=-1 LRDSCR=""
"RTN","LREPIXDG",12,0)
 I LRDSCR="" D
"RTN","LREPIXDG",13,0)
 . S LRDATE=$$IMPDATE^LEXU("ICD")
"RTN","LREPIXDG",14,0)
 . S LRDSCR=$E($$SD^ICDEX(80,LRICDIEN,LRDATE),1,60) S:$P(LRDSCR,U,1)=-1 LRDSCR=""
"RTN","LREPIXDG",15,0)
 I LRDSCR="" D
"RTN","LREPIXDG",16,0)
 . S LRDATE=$$IMPDATE^LEXU("10D")
"RTN","LREPIXDG",17,0)
 . S LRDSCR=$E($$SD^ICDEX(80,LRICDIEN,LRDATE),1,60) S:$P(LRDSCR,U,1)=-1 LRDSCR=""
"RTN","LREPIXDG",18,0)
 N LRCHBTWN,LRCSIEN,LRCSNAM S LRCSIEN=$$CSI^ICDEX(80,LRICDIEN)
"RTN","LREPIXDG",19,0)
 S LRCSNAM=$$SNAM^ICDEX(LRCSIEN),LRCHBTWN=$S(LRCSIEN=1:" ",1:"")
"RTN","LREPIXDG",20,0)
 Q $P(LRCSNAM,"-",1,2)_LRCHBTWN_"  "_$$TITLE^XLFSTR(LRDSCR)
"RTN","LREPIXDG",21,0)
 ;
"UP",69.5,69.54,-1)
69.5^3
"UP",69.5,69.54,0)
69.54
"VER")
8.0^22.0
"^DD",69.5,69.5,4,0)
ICD DIAGNOSIS^69.54P^^3;0^
"^DD",69.5,69.5,4,21,0)
^.001^1^1^3130507^^^^
"^DD",69.5,69.5,4,21,1,0)
This defines the ICD Diagnoses to search for.
"^DD",69.5,69.5,4,"DT")
3120612
"^DD",69.5,69.54,0)
ICD DIAGNOSIS SUB-FIELD^^1^2
"^DD",69.5,69.54,0,"DT")
3120917
"^DD",69.5,69.54,0,"IX","B",69.54,.01)

"^DD",69.5,69.54,0,"NM","ICD DIAGNOSIS")

"^DD",69.5,69.54,0,"UP")
69.5
"^DD",69.5,69.54,.01,0)
ICD DIAGNOSIS^MP80'^ICD9(^0;1^Q
"^DD",69.5,69.54,.01,1,0)
^.1^^-1
"^DD",69.5,69.54,.01,1,1,0)
69.54^B
"^DD",69.5,69.54,.01,1,1,1)
S ^LAB(69.5,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",69.5,69.54,.01,1,1,2)
K ^LAB(69.5,DA(1),3,"B",$E(X,1,30),DA)
"^DD",69.5,69.54,.01,3)
Select the ICD Diagnosis Code to be included in the search.
"^DD",69.5,69.54,.01,21,0)
^.001^1^1^3121010^^^^
"^DD",69.5,69.54,.01,21,1,0)
This defines an ICD Diagnosis for use in emerging pathogens data search/extract.  
"^DD",69.5,69.54,.01,"DT")
3120917
"^DD",69.5,69.54,1,0)
CODING SYSTEM^P80.4'^ICDS(^0;2^Q
"^DD",69.5,69.54,1,3)
Enter the applicable ICD coding system for this ICD Diagnosis.
"^DD",69.5,69.54,1,21,0)
^^1^1^3130507^
"^DD",69.5,69.54,1,21,1,0)
This defines an ICD coding system associated with an ICD diagnosis for use in emerging pathogens data search/extract.
"^DD",69.5,69.54,1,"DT")
3120810
"BLD",8959,6)
^352
**END**
**END**

